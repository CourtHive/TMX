(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();const Rm=(function(){const t={},e={};let i="gbr";t.define=({ioc:n,idiom:a})=>{e[n]=a},t.set=n=>{if(!n)return i;if(e[n])return i=n,e[n]},t.options=()=>Object.keys(e),t.current=()=>e[i];function r(n){if(!n)return"";let a=e[i];const s=n.split(".");for(;s.length;){const o=s.shift();a=a?.[o]||""}return a}return t.tr=n=>{if(!n)return"";if(r(n))return r(n);let a=e.default;const s=n.split(".");for(;s.length;){const o=s.shift();a=a?.[o]||""}return a},t.obj=n=>n?e?.[i]?.[n]?e[i][n]:e.default[n]?e.default[n]:{}:"",e.default={open:"Open",zoom:"Zoom",addcourts:"Add Courts",login:"Login",logout:"Logout",passwd:"Password",lang:"Language",menu:"Menu",main:"Main Menu",local:"Local Data",save:"Save",side:"Side",bye:"BYE",select:"Select",selected:"Selectd",group:"GROUP",administrator:"Administrator",revoke:"Revoke",tour:"Tour",noresults:"No Results",delete:"Delete",continue:"Do you wish to continue?",notes:"Notes",social:"Social Media",stats:"Statistics",merge:"Merge",week:"Week",warn:"WARNING",add:"Add",remove:"Remove",ptz:"Penalties",replace:"Replace",dl:"Download",or:"or",arp:"All Ranking Points",rlp:"Points - Ranking Lists",trn:"Tournament",tnz:"Tournaments",enable:"Enable",disable:"Disable",rnd:"Round",dt:"Date",fmt:"Format",cat:"Category",cta:"Cat.",team:"Team",tmz:"Teams",rnk:"Rank",rnkz:"Rankings",rtg:"Rating",rtz:"Ratings",prnk:"Rank",trnk:"Rank",rl:"Rank List",rlo:"Rank Order",alpha:"Alphabetical",opnt:"Opponent",ply:"Player",pyr:"Players",sgi:"Sign-In",sgo:"Sign-Out",scr:"Score",pts:"Points",allmatches:"All Matches",allteams:"All Teams",mts:"Matches",emts:"Matches",ests:"Sets",egms:"Games",epts:"Points",mtc:"Match",drw:"Draw",drz:"Draws",ent:"Event",evt:"Events",sch:"Schedule",rename:"Rename",crt:"Courts",ct:"Court",on:"On",off:"Off",id:"ID",nm:"Name",fnm:"First Name",lnm:"Last Name",nnm:"Nickname",attr:"Attribute",bd:"Birthday",yr:"Year",byr:"Birth Year",tot:"Total",sgl:"Singles",dbl:"Doubles",pyo:"Playoff",adh:"Ad-Hoc",snr:"Senior",unk:"Unknown",dup:"Duplicate",stt:"Status",ord:"Order",clb:"Club",scl:"School",cty:"City",state:"State",cnt:"Country",kwn:"Known",ioc:"IOC",act:"Action",agd:"Assigned",igr:"Ignore",igd:"Ignored",edt:"Edit Player",idp:"Identify Player",dlp:"Delete Player",sbt:"Submit",ccl:"Cancel",clr:"Clear",und:"Undo",apt:"Accept",dss:"Dismiss",frm:"From",to:"To",h2h:"Head-to-Head",reg:"Registered",gdr:"Gender",dtp:"Draw Type",drp:"Draw Position",manual:"Manual Draw",adr:"Automated Draw",mdo:"Draw Order",phn:"Phone",view:"View",email:"Email",asn:"Association",start:"Start",end:"End",dates:"Dates",ref:"Referee",time:"Time",duration:"Duration",qualifier:"Qualifier",qualifiers:"Qualifiers",none:"None",keys:"Keys",pos:"Position",seeding:"Seeding",home:"Home",new:"New",inout:"In/Out",indoors:"Indoors",outdoors:"Outdoors",existing:"Existing",success:"Success",loading:"Loading",set:"Settings",version:"Version",messages:"Messages",support:"Support",datastorage:"Data Storage",releasenotes:"Release Notes",documentation:"Documentation",importexport:"Import / Export",newversion:"New Version Available",latitude:"Latitude",longitude:"Longitude",i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},settings:{help:"Help",pagesize:"Page Size",schedule:"Schedule",calendar:"Calendar",search:"Search",documentation:"Documentation Links",hoverhelp:"Hover Hints",diacritics:"Diacritics",lastfirst:"Last name, First name",organization:"Organization",general:"General",categories:"Categories",points:"Points",draws:"Draws",data:"Data",sheetdata:"Sheet Data",publishing:"Publishing",printing:"Printing",savepdfs:"Save PDF",opentabs:"Open in Browser Tabs",compresseddraws:"Compressed Draw Formats",teams:"Teams Displayed",countryflags:"Country Flags Displayed",requireconfirm:"Require Confirmation",publishonscore:"Publish when score entered",publishdrawcreation:"Publish as draw created",matchesbefore:"Matches Before Count",automatedbyes:"Automatic Bye Placement",llallrounds:"LL from All Qualifying Rounds",rrh2hpriority:"RR Head-to-Head priority",qualconsolation:"Qualifying Consolation",consolationalts:"Consolation Alternates",consolationseeds:"Consolation Seeding",gemseeding:"GEM Seeding",adhocelo:"Adhoc ELO Ratings",restrictseedplacement:"Restrict Seed Placement",separate_by_team:"Auto Separate Players by Team",separate_by_ioc:"Auto Separate Players by Country",separate_by_club:"Auto Separate Players by Club",separate_by_school:"Auto Separate Players by School",clear_separation:"Clear Auto Separation",courtdetail:"Court Details",matchtimes:"Match Times",matchdates:"Match Dates",firstday:"Week Starts Monday",time24:"24 Hour Clock",draworderscores:"Scores in Draw Order",schedulecompleted:"Schedule Completed Matches",courtidentifiers:"court identifiers"},round_names:{F:"Final",SF:"Semifinal",QF:"Quarterfinal"},search:{filterplayers:"Filter Players",players:"Search Players",tournaments:"Search Tournaments",clubs:"Search Clubs",approve:"Approve Player",add2team:"Add Team Player",lastfirst:"LAST First",firstlast:"First Last"},formats:{singles:"Singles",doubles:"Doubles",team:"Team"},scoring_format:{set:"Set",sets:"Sets",timedset:"Timed Set",timedsets:"Timed Sets",tiebreak:"Tiebreak",tiebreaks:"Tiebreaks",winby:"Win By",custom:"Custom",bestof:"Best of",tbat:"TB at",finalset:"Final Set",setsto:"Sets to",tbto:"TB to",superto:"To"},scoring:{label:"Scoring",retire:"Retire",default:"Default",walkover:"Walkover",supertiebreak:"Match Tiebreak",normal:"Normal",winloss_abbreviation:"W/L",cancelled:"Cancelled",abandoned:"Abandoned"},draws:{seedlimit:"Seed Limit",blockthreshold:"Block Threshold",generating:"Generating... Please be patient...",generateround:"Generate Round",deleteround:"Delete Round",adhoc:"Adhoc",gemseeding:"GEM Seeding",playerfilter:"Ratings Filter",compass:"Compass",north:"North",south:"South",east:"East",west:"West",northeast:"Northeast",northwest:"Northwest",southeast:"Southeast",southwest:"Southwest",feedin:"Feed-in",staggered:"Staggered",standard:"Standard",elective:"Elective",backdraw:"Backdraw",roundlimit:"Round Limit",structure:"Structure",skiprounds:"Skip Rounds",feedrounds:"Feed Rounds",sequential:"Sequential",brackets:"Brackets",bracketsize:"Bracket Size",roundrobin:"Round Robin",elimination:"Elimination",consolation:"Consolation",qualification:"Qualification",preround:"Pre-Round",incidentals:"Incidentals",remove:"Remove",changestatus:"Change Status",penalty:"Assess penalty",umpire:"Select Referee",matchumpire:"Match Referee",matchtime:"Match Time",starttime:"Start Time",endtime:"Finish Time",resttime:"Rest Time",duration:"Duration",timeheader:"Time Heading",maindraw:"Main Draw",unscheduled:"Unscheduled Matches",scheduled:"Scheduled Matches",completed:"Completed",unpublished:"Unpublished",publisheduptodate:"Up to Date",publishedoutofdate:"Out of Date",published:"Published",publish:"Publish",publishQ:"Publish Draw?",organizers:"Organizers",playerrep:"Representative",playerreps:"Representatives",substitutes:"Substitutes (LL/Alts)",allindraw:"all in draw",lastdirectaccept:"Last Direct Acceptance",clear:"Clear Draw",swap:"Swap Position",alternate:"Alternate",alternatepair:"Alternate Pair",alternateplayer:"Alternate Player",luckyloser:"Lucky Loser",first:"First",last:"Last",seedrange:"Seeds",modifyseeding:"Modify Seeding",playerrange:"All Players",unpublish:"Unpublish Draw",unpublishall:"Unpublish All Events"},print:{publishpdf:"Publish PDF",schedule:"Schedule",draw:"Print",signin:"Sign-In Sheet",ranklist:"Rank List",playerlist:"Player List",matchlist:"Print Match List",matchesbytime:"Matches by Time",pendingmatches:"Pending Matches",matchesbycourt:"Matches by Court",completedmatches:"Completed Matches"},teams:{code:"Code (3 letters)",name:"Name",share:"Share Team",rankings:"Team Rankings",members:"Members",matches:"Matches",winloss:"Won/Lost",newteam:"New Team",createnew:"Create New",submitkey:"Submit Key",nameorkey:"Team Name or Import Key",club:"Club",coaches:"Coaches",school:"School",ioc:"Country",abbreviation:"Abbreviation"},tournament:{organizer_email:"Organizer Email",organizer_phone:"Organizer Phone",judge_email:"Referee Email",judge_phone:"Referee Phone",sponsor:"Sponsor(s)",logo:"Tournament Logo",images:"Tournament Images"},tournaments:{type:"Type",standard:"Standard",dual:"Dual Matches",register:"Register",registration:"Registration Link",team:"Team Tournament",new:"New Tournament",add:"Add Tournament",id:"Tournament ID",loadbyid:"Load by ID",edit:"Edit",copy:"Copy",close:"Close",done:"Finish",import:"Import Record",removeall:"Remove All",addall:"Add All",destroyall:"Destroy All",key:"Authorization",noauth:"Not Authorized",unofficial:"Unofficial",auth:"Authorized",fetch:"Download",fetchtournament:"Download Tournament Record",convert:"Convert to TODS / Save",send:"Upload Tournament Record",export:"Export Tournament Record",renewlist:"Renew List",natlassoc:"National Association",tennisclub:"Tennis Club",received:"Received Tournament Record",existing:"Existing Tournament Record",publishtime:"Publish Time",replacelocal:"Replace Local Copy?",unpublish:"Unpublish Tournament?"},ddlb:{singles:"Singles Tournament Rank:",doubles:"Doubles Tournament Rank:",category:"Tournament Category:",draws:"Select Event:",direction:"Select Draw:"},phrases:{remember_me:"Remember Me",forgot_passwd:"Forgot Password",no_account:"No account? Sign Up",selectlanguage:"Select Language",setupcourts:"Set up your courts",courtsmsg:"Before you can schedule matches we need to know more about your courts. To get started, add some court details.",sortorder:"Sort Order",eventcorrupted:"Event is Corrupted: Development Notified",singlesrankings:"Singles Rankings",doublesrankings:"Doubles Rankings",sectionscroll:"Section Scrolling",dynamicrating:"Dynamic Rating",recalcdynamic:"Re-Calculate Dynamic Rating",comingsoon:"New Feature: Coming Soon!",finalrounds:"Final Rounds",sendplayerdb:"Send Player Database",prerelease:"Pre-release version of TMX",feedback:"Please send all feedback and support requests to",improperauth:"Improper Authorization Credentials",noexportformats:"No Export Formats Enabled",verifyranking:"Please Verify Player Ranking!",nomatches2schedule:"No Matches to Schedule!",addimage:"Enter full website address for an image",addgooglemap:'Enter full URL, not "Link to Share"',retrieveFromServer:"Retrieve from CourtHive Server?",mainmenu:"Main Menu",rankbyrating:"Rank by Rating",dblsrankisrating:"Use Rating as Doubles Ranking?",sheetdataurls:"Enter Google Sheet URLs for Synchronizing Data",playerimport:"Player Import",entersheeturl:"Enter Sheet URL",entergooglemapsurl:"Enter Google Maps link",invalidurl:"Invalid URL(s)",invalidsheeturl:"Invalid Sheet URL",invalidgooglemapsurl:"Invalid Google Maps Link",geolocationdenied:"Geolocation has been denied",unblockgeo:"Unblock in browser settings",usecurrentlocation:"Use your current position?",updatelatlng:"Update Latitude/Longitude?",cleardraw:"Existing Draw will be cleared!",clearselection:"Clear Selection",selectplayer:"Select Player",matches2clear:"Matches to be cleared from the schedule",changeapproved:"Changing Approved will reset the draw and clear the schedule.",qualincomplete:"Qualifying Draw is Incomplete",delegate:"Delegate",delegate2mobile:"Delegate to Mobile",revokedelegation:"Revoke Delegation",delegationrevoked:"Delegation has been revoked",qrcode:"QR Code",scanQRcode:"Scan QR Code with Mobile",ranklists:"Rank Lists for",reset:"Database will be reset",action:"Players requiring some action...",search:"Use the search field above to find players, or click player to edit",assign:"Assign this profile by clicking a player below, or ...",accept:"Accept all players",trnyz:"Loading Tournaments ...",loadplayers:"Load Players",badfile:"File Not Recognized",invalid:"Invalid file type",fileerror:"Error reading file",servererror:"Error Message from Server",notfound:"Not Found",pointcalc:"Point calculation requires tournament category and rank",drawcreated:"Draw Created",drawactive:"Active Draw",notcreated:"Not Created",importdata:"Import Data",exportdata:"Export Data",importtemplate:"Import Template",draganddrop:"Drag and Drop files into this zone",schedulematches:"Schedule Matches",notconfigured:"Not Configured",cannotsignout:"Cannot Sign Out",cannotchangerank:"Cannot Change Rank",cannotchangewinner:"Cannot Change Winner",matchmustbecomplete:"Match Must Be Complete!",approvedplayer:"Player Approved for an Event",locallycreated:"Locally Created Tournament",noremote:"No Remote Registrations to Update",calculateranking:"Calculate Ranking Points",generateranklist:"Generate Rank List",generatekey:"Generate Key",norankingdata:"No Ranking Data",oop_system:"Order of Play",schedulepublished:"Publishing Time:",timestamp:"Date/Time: ",rankedplayers:"Ranked Players",judgesignature:"Signature of Head Umpire:",nopointcalcs:"No Point Calculations for given date",downloadtemplate:"Download Import Template",add2database:"Add Players, Tournaments, Rankings to Database",noconnection:"No Connection",schedulepriority:"Match Scheduling Priority",send:"Send",sendTODS:"Send TODS Tournament Record",export:"Export",pointsvalidfrom:"Points Valid From",linkcopied:"Link Copied to Clipboard",keycopied:"Key Copied to Clipboard",submitkey:"Enter New Key",selectkey:"Select Key",deletereplace:"Delete / Replace",weblink:"Web Link",nomatches:"No Matches",updatedioc:"Update Language File",revokeauth:"Revoke Authorization?",clearalldays:"Clear All Days?",cantdelqual:"Cannot Delete: Qualified Player Active in Main Draw",cantrefresh:"Offline: Cannot Refresh",blocked:"Pop-Up Windows are blocked by your browser",enablepopups:"Please enable Pop-Ups for PDF printing",nopersist:"Data Persistence not guaranteed"},events:{name:"Name",newevent:"New Event",customname:"Custom Name",enableeligibility:"Enable Eligibility Filter",disableeligibility:"Disable Eligibility Filter",teamevent:"Team Event",opponents:"Opponents",matchprofile:"Match Profile",teams:"Teams",draw_type:"Draw Type",draw_size:"Draw Size",created:"Created",category:"Category",rank:"Rank",surface:"Surface",approveteam:"Approve",destroyteam:"Destroy",entered:"Entered",approved:"Approved",eligible:"Eligible",ineligible:"Ineligible",unavailable:"Unavailable",wildcard:"Wildcard",received:"Received Event(s)",toggle:"Toggle Publish State?",modifyranking:"Modify Ranking"},locations:{newlocation:"New Location",abbreviation:"Abbreviation",name:"Name",address:"Address",courts:"Courts",identifiers:"Court IDs"},genders:{male:"Male",male_abbr:"M",female:"Female",female_abbr:"W",mixed:"Mixed"},surfaces:{clay:"Clay",hard:"Hard",grass:"Grass",carpet:"Carpet"},actions:{ok:"OK",actions:"Actions",add_event:"Add Event",save_event:"Save Event",save_team:"Save Team",save_location:"Save Location",done:"Done",cancel:"Cancel",refresh:"Refresh",remakedraw:"Remake Draw",delete_event:"Delete Event",delete_team:"Delete Team",delete_match:"Delete Match",add_player:"Add Player",add_team:"Add Team",create_team:"Create team",generate_team:"Generate Team",publish:"Publish",unpublish:"Unpublish",manage_players:"Manage Players",manage_teams:"Manage Teams",add_location:"Add Location",delete_location:"Delete Location",delete_tournament:"Delete tournament",edit_tournament:"Edit Tournament",copy_tournament:"Copy Tournament",createteambyattr:"Create team",add2localdb:"Add Players to Local Database",signoutunapproved:"Sign Out players not approved for Events"},requests:{syncClubs:"Synchronize Clubs",syncTournaments:"Synchronize Tournaments",syncPlayers:"Synchronize players"},signin:{tournament_date:"Start Date",organization:"Organization",place:"Location",id:"Tournament ID",rank:"Tournament Rank",judge:"Head Umpire",doc_name:"SIGN-IN SHEET",doc_subname:" ",signature:"Signature",registered:"Registered Players",notsignedin:"Not Signed In",signedin:"Signed In",withdrawn:"Withdrawn",medical:"Medical",registration:"Registration",medical_issues:"Medical Expired",create_new_player:"Create New",modifyrankings:"Modify Rankings",acceptrankings:"Accept Rankings",reglink:"Set Link"},schedule:{column:"Column",rows:"Schedule Rows",startrow:"Start Row",alldraws:"All Draws",allevents:"All Events",allrounds:"All Rounds",allcourts:"All Courts",alldual:"All Dual Matches",autoschedule:"Auto Schedule",highlightteam:"Highlight Team",limit:"Limit",clearschedule:"Clear Schedule",clearcompleted:"Clear Completed Matches",orderofplay:"ORDER OF PLAY",matchestime:"Matches => Time",notbefore:"Not Before",nb:"NB",followedby:"Followed By",afterrest:"After Rest",raindelay:"Rain Delay",tba:"TBA",nextavailable:"Next Available",called:"Called",oncourt:"On Court",warmingup:"Warming Up",suspended:"Suspended",abandoned:"Abandoned",clear:"Clear",publish:"Publish Schedule",view:"View Schedule",unpublish:"Unpublish Schedule",timing:"Timing",vs:"vs.",umpirenotes:"Umpire Notes",notice:"Schedule Notice",opponentname:"Opponent Name",scheduled:"Scheduled"},penalties:{fail2signout:"Failed to Sign Out",illegalcoaching:"Illegal Coaching",ballabuse:"Ball Abuse",racquetabuse:"Racquet Abuse",equipmentabuse:"Equipment Abuse",cursing:"Swearing",rudegestures:"Rude Gestures",foullanguage:"Foul Language",timeviolation:"Time Violation",latearrival:"Late Arrival",unsporting:"Unsporting Behavior"},datelocalization:"en-EN"},t})();function Mt(t){return typeof t=="function"}function L_e(t){return typeof t=="string"}function Ad(t){return typeof t=="object"&&!Array.isArray(t)}function $_e(t,e=0){let i=e,r,n;const a=()=>{i-=new Date().getTime()-n.getTime(),window.clearTimeout(r)},s=()=>i=e,o=()=>{n=new Date,r=window.setTimeout(function(){i=e,t()},i)};return o(),{pause:a,resume:o,reset:s}}var H_e=Object.defineProperty,Fi=(t,e)=>{for(var i in e)H_e(t,i,{get:e[i],enumerable:!0})};function TC(){return"2.3.16"}var Wz={};Fi(Wz,{competitionGovernor:()=>Kz,drawsGovernor:()=>rW,entriesGovernor:()=>MK,eventGovernor:()=>kK,generationGovernor:()=>QK,matchUpFormatGovernor:()=>Xx,matchUpGovernor:()=>qK,mocksGovernor:()=>jL,participantGovernor:()=>y6,policyGovernor:()=>eK,publishingGovernor:()=>ZL,queryGovernor:()=>NR,reportGovernor:()=>I6,scheduleGovernor:()=>w6,scoreGovernor:()=>ry,tieFormatGovernor:()=>U6,tournamentGovernor:()=>D6,venueGovernor:()=>R6});var Kz={};Fi(Kz,{getLinkedTournamentIds:()=>q1,getTournamentIds:()=>j1,linkTournaments:()=>Vpe,mutate:()=>zce,query:()=>jpe,unlinkTournament:()=>Qpe,unlinkTournaments:()=>Gpe});var zce={};Fi(zce,{linkTournaments:()=>Vpe,unlinkTournament:()=>Qpe,unlinkTournaments:()=>Gpe});var mI="SINGLES",Er="SINGLES",Ay="DOUBLES",yr="DOUBLES",Cc="TEAM",$r="TEAM",Yz={SINGLES_MATCHUP:mI,SINGLES:Er,DOUBLES_MATCHUP:Ay,DOUBLES:yr,TEAM_MATCHUP:Cc,TEAM:$r},qce={[Er]:[Er,"S"],[yr]:[yr,"D"],[$r]:[$r,"T"],S:[Er,"S"],D:[yr,"D"],T:[$r,"T"]};function la(t,e){return(t??0)-(e??0)}function ri(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function jo(t){return typeof t=="function"}function Lr(t){return typeof t=="string"}function Ki(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function V_e(t,e){if(!Ki(t)||!Ki(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function Wce(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(Ki).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var G_e=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function oj(t,e){if(t===void 0)return null;if(!Ki(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>oj(a))}:{[n]:e?r(t[n]):oj(t[n])}))}function lj(t){return Array.isArray(t)?t.length+t.map(lj).reduce((e,i)=>e+i,0):Ki(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>lj(t[e])).reduce((e,i)=>e+i,0):0}function Q_e(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=lj(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}function rp(t){return Number.isNaN(Number(t))?!1:t>0&&(t&t-1)===0}function GJ(t){if(!t.length)return;let e=[...t].sort(la),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function j_e(t){if(t===1||Number.isNaN(Number(t))||!rp(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function Xz(t){return Number.isNaN(Number(t))?0:t%2&&t+1||t}function Zz(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Sn(t){return!Number.isNaN(Number.parseFloat(t))}function Kce(t){let e=ri(t);if(!Number.isNaN(e))return e===0?!1:(e&-e)===1}function CC(t){if(Number.isNaN(Number(t)))return!1;for(;!rp(t);)t++;return t}function Xc(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function yi(t){return Lr(t)&&!t.trim().length?!1:Number.isSafeInteger(typeof t=="string"?+t:t)}function z_e(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function q_e(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function Yce(t,e,i,r,n=2){let a=1-Math.random(),s=1-Math.random(),o=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*s);return o=o/10+.5,o>1||o<0?o=Yce(t,e,i):(o=Math.pow(o,i),o*=e-t,o+=t),r&&(o=q_e(o,r)),Number.parseFloat(o.toFixed(n))}function Ux(t,e=2){return Number.parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function Ci(t){return Array.isArray(t)?t?.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function W_e(t){return Array.isArray(t)?t?.map(e=>e===null?void 0:e):t}function To(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function dT(t){return yi(t)?t:1/0}function Vl(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function K_e(t){return Xce(Vl(t))}function Xce(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function Y_e(t,e,i){return i.indexOf(t)===e}function Zce(t){return t.filter(Y_e)}function xl(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function Bl(t){let e=Math.floor(Math.random()*t.length);return t[e]}function gt(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function Qp(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function Pn(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function QJ(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function Bo(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function X_e(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function Z_e(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function Oa(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function Jce(t,[e,...i]){return t.length?[t.slice(0,e),...Jce(t.slice(e),[...i,e])]:[]}function J_e(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function eue(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function tue(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function cj(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let s=i?!!(Math.floor(a/e)%2):!1,o=a%e,l=s?e-1-o:o;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function eOe(t,e=1){if(!Array.isArray(t)||!t.every(yi))return[];let i=Math.min(...t,e),r=Math.max(...t);return gt(i,r+1).filter(n=>!t.includes(n))}function XO(t,e){return!Array.isArray(t)||!Lr(e)?!1:Pn(t,qce[e]).length}var se={success:!0},iue="error",rue={SUCCESS:se,ERROR:iue};function nue({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:s}=n;if(typeof a!="number"||typeof s!="number"||s>e||s<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==Ci(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...se}}var KU={};Fi(KU,{addNotice:()=>bi,callListener:()=>X0,createInstanceState:()=>yde,cycleMutationStatus:()=>Dq,deepCopyEnabled:()=>Eq,deleteNotice:()=>Mq,deleteNotices:()=>Cw,disableNotifications:()=>Ide,enableNotifications:()=>cF,getDevContext:()=>Gl,getMethods:()=>Pq,getNotices:()=>Rq,getProvider:()=>yj,getTopics:()=>kc,getTournamentId:()=>Ew,getTournamentRecord:()=>Nq,getTournamentRecords:()=>Hg,globalLog:()=>Cde,handleCaughtError:()=>pF,hasTopic:()=>uF,removeTournamentRecord:()=>Tde,setDeepCopy:()=>Y0,setDevContext:()=>K0,setGlobalLog:()=>bde,setGlobalMethods:()=>wde,setGlobalSubscriptions:()=>OOe,setMethods:()=>Sde,setStateMethods:()=>Ede,setStateProvider:()=>xOe,setSubscriptions:()=>FOe,setTournamentId:()=>Z0,setTournamentRecord:()=>Ude,setTournamentRecords:()=>dF,timeKeeper:()=>_Oe});var uj={message:"Chronological error; time violation.",code:"ANACHRONISM"},q0={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},aue={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},dj={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},yn={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},rt={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},D1={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},pT={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},AI={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},Bt={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},sue={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},Ec={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Zy={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},Jz={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},eq={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},fT={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},oue={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},lue={message:"Schedule conflict: court slot already occupied",code:"ERR_SCHEDULE_CONFLICT_DOUBLE_BOOKING"},cue={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},tOe={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},tq={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},P1={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},R1={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},iOe={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},ww={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},EC={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},iq={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},ZO={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},uue={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},M1={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},fp={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},due={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},pue={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},fue={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},hue={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},mue={message:"Invalid action",code:"ERR_INVALID_ACTION"},pj={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},Aue={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},gue={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},vue={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},rq={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},yue={message:"Existing round",code:"ERR_EXISTING_ROUND"},rOe={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},Bc={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},nn={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},nq={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Jy={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},aq={message:"Missing MAIN structure",code:"ERR_MISSING_MAIN_STRUCTURE"},bue={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},ph={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Vr={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},cu={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},Iue={message:"Event exists",code:"ERR_EXISTING_EVENT"},wue={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},Sue={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},sq={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},Uue={message:"Missing stage",code:"ERR_MISSING_STAGE"},eb={message:"Invalid stage",code:"ERR_INVALID_STAGE"},Tue={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},Cue={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},Eue={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},fj={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},N1={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},wk={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},nOe={message:"Propagated exits downstream",code:"ERR_PROPAGATED_EXITS_DOWNSTREAM"},DC={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Jf={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},oq={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},lq={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},Due={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},PC={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},mo={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},Sw={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},Ys={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},sA={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},Wo={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},bl={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},cq={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},JO={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},aOe={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},Pue={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},uq={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},Rue={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},dq={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},sOe={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},B1={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},oOe={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},pq={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},lOe={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},eF={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},cOe={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},uOe={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},Uw={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Kt={message:"Missing value",code:"ERR_MISSING_VALUE"},Mue={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},Nue={message:"Missing date",code:"ERR_MISSING_DATE"},Bue={message:"No valid dates",code:"ERR_NO_VALID_DATES"},Tx={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},Sk={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},kue={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},fa={message:"Invalid Date",code:"ERR_INVALID_DATE"},ju={message:"Invalid time",code:"ERR_INVALID_TIME"},xue={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},dOe={message:"Missing date range",info:"Event or tournament must have start and end dates",code:"ERR_MISSING_DATE_RANGE"},hj={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},_ue={message:"Invalid score",code:"ERR_INVALID_SCORE"},tF={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},pOe={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},fq={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},Oue={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},iF={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},Fue={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},rF={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},gy={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},np={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Fl={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},Lue={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},ap={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},$ue={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},Tw={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},k1={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},ga={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Hue={message:"Missing qualified participants",code:"ERR_MISSING_QUALIFIED_PARTICIPANTS"},On={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},Vue={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},fOe={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},Gue={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Lg={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},Que={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},jue={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},zue={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},RC={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},nF={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},hq={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},mj={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},que={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},hOe={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},mOe={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},Wue={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},Kue={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},Aj={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},mq={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},Aq={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},Yue={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},gq={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},hT={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},Xue={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},Mm={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},Zue={message:"Court exists",code:"ERR_EXISTING_COURT"},gj={message:"Booking not found",code:"ERR_NOT_FOUND_BOOKING"},Jue={message:"Existing matchUps conflict with booking",code:"ERR_EXISTING_MATCHUPS"},ede={message:"Venue exists",code:"ERR_EXISTING_VENUE"},tb={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},$g={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},tde={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},vq={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},ide={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},rde={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},AOe={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},yq={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},nde={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},bq={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},Iq={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},aF={message:"Missing context",code:"ERR_MISSING_CONTEXT"},ade={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},LI={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},sde={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},MC={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},ode={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},sF={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},lde={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},cde={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},oA={message:"Invalid object",code:"ERR_INVALID_OBJECT"},XD={message:"Invalid gender",code:"ERR_INVALID_GENDER"},W0={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},be={message:"Invalid values",code:"ERR_INVALID_VALUES"},ude={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},wq={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},dde={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},oF={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},Sq={message:"Value unchanged",code:"ABORT_UNCHANGED"},ts={message:"Not found",code:"ERR_NOT_FOUND"},Uq={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},pde={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},Tq={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},fde={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},hde={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},vj={message:"Existing stage",code:"ERR_EXISTING_STAGE"},Cq={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},x1={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},mde={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},_1={message:"Scores present",code:"ERR_SCORES_PRESENT"},Ade={ANACHRONISM:uj,BOOKING_NOT_FOUND:gj,CANNOT_CHANGE_WINNING_SIDE:rF,CANNOT_MODIFY_TIEFORMAT:fq,CANNOT_MODIFY_PARTICIPANT_TYPE:Oue,CANNOT_REMOVE_MAIN_STRUCTURE:aue,CANNOT_REMOVE_PARTICIPANTS:iF,CATEGORY_MISMATCH:Fue,COURT_EXISTS:Zue,COURT_NOT_FOUND:Mm,EXISTING_MATCHUPS:Jue,DRAW_DEFINITION_NOT_FOUND:Ec,DRAW_ID_EXISTS:due,DRAW_POSITION_ACTIVE:R1,DRAW_POSITION_ASSIGNED:fT,DRAW_POSITION_NOT_CLEARED:cue,DRAW_POSITION_NOT_FOUND:tOe,DRAW_SIZE_MISMATCH:uue,DUPLICATE_ENTRY:q0,DUPLICATE_VALUE:ude,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:Kue,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:Wue,EVENT_EXISTS:Iue,EVENT_NOT_FOUND:cu,EXISTING_DRAW_DEFINITIONS:sue,EXISTING_END_TIME:vq,EXISTING_FLIGHT:pde,EXISTING_MATCHUP_ID:hde,EXISTING_OUTCOME:fde,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:RC,EXISTING_PARTICIPANT:nF,EXISTING_POLICY_TYPE:dq,EXISTING_PROFILE:Tq,EXISTING_ROUND:yue,EXISTING_STAGE:vj,EXISTING_STRUCTURE:Cq,INCOMPATIBLE_MATCHUP_STATUS:wk,INCOMPLETE_SOURCE_STRUCTURE:Jz,INSUFFICIENT_DRAW_POSITIONS:Aq,INVALID_ACTION:mue,INVALID_ASSIGNMENT:pj,INVALID_BOOKINGS:Tx,INVALID_CATEGORY:W0,INVALID_COLLECTION_DEFINITION:cde,INVALID_CONFIGURATION:lde,INVALID_DATE_AVAILABILITY:Sk,INVALID_DATE:fa,INVALID_DRAW_DEFINITION:AI,INVALID_DRAW_POSITION_FOR_SEEDING:eq,INVALID_DRAW_POSITION:ww,INVALID_DRAW_SIZE:ZO,INVALID_END_TIME:tde,INVALID_ENTRIES:Sue,INVALID_EVENT_TYPE:ph,INVALID_GAME_SCORES:hj,INVALID_GENDER:XD,INVALID_MATCHUP_FORMAT:oq,INVALID_MATCHUP_STATUS:DC,INVALID_MATCHUP_STATUS_BYE:Eue,INVALID_MATCHUP:bl,INVALID_OBJECT:oA,INVALID_PARTICIPANT_ID:np,INVALID_PARTICIPANT_IDS:Fl,INVALID_PARTICIPANT_ROLE:Lue,INVALID_PARTICIPANT_SEEDING:pue,INVALID_PARTICIPANT_TYPE:ap,INVALID_PARTICIPANT:gy,INVALID_POLICY_DEFINITION:Rue,INVALID_RECORDS:dj,INVALID_SCALE_ITEM:LI,INVALID_SEED_NUMBER:gue,INVALID_SEED_POSITION:vue,INVALID_SET_NUMBER:lOe,INVALID_SIDE_NUMBER:pq,INVALID_SCORE:_ue,INVALID_STAGE:eb,INVALID_START_TIME:rde,INVALID_STRUCTURE:Zy,INVALID_STOP_TIME:ide,INVALID_TIE_FORMAT:Jf,INVALID_TIME:ju,INVALID_TIME_ITEM:yq,INVALID_TOURNAMENT_DATES:xue,INVALID_TOURNAMENT_RECORD:D1,INVALID_VALUES:be,INVALID_WINNING_SIDE:tF,MATCHUP_NOT_FOUND:Ys,METHOD_NOT_FOUND:x1,MISSING_ASSIGNMENTS:sq,MISSING_ASYNC_STATE_PROVIDER:nde,MISSING_AVOIDANCE_POLICY:Pue,MISSING_BIRTH_DATE:Mue,MISSING_COLLECTION_DEFINITION:Due,MISSING_COURT_ID:Uw,MISSING_COURTS_INFO:Xue,MISSING_DATE_AVAILABILITY:kue,MISSING_DATE:Nue,MISSING_DRAW_DEFINITION:Bt,MISSING_DRAW_ID:fp,MISSING_DRAW_POSITION:EC,MISSING_DRAW_POSITIONS:P1,MISSING_DRAW_SIZE:M1,MISSING_ENTRIES:wue,MISSING_EVENT:Vr,MISSING_QUALIFIED_PARTICIPANTS:Hue,MISSING_MATCHUP_FORMAT:lq,MISSING_MATCHUP_ID:mo,MISSING_MATCHUP_IDS:Sw,MISSING_MATCHUP:Wo,MISSING_MATCHUPS:sA,MISSING_PARTICIPANT_COUNT:Que,MISSING_PARTICIPANT_ID:ga,MISSING_PARTICIPANT_IDS:Lg,MISSING_PARTICIPANT_ROLE:$ue,MISSING_PARTICIPANT:Tw,MISSING_PARTICIPANTS:k1,MISSING_PENALTY_ID:gq,MISSING_PENALTY_TYPE:Yue,MISSING_PERSON_DETAILS:zue,MISSING_POLICY_ATTRIBUTES:uq,MISSING_POLICY_DEFINITION:JO,MISSING_POLICY_TYPE:cq,MISSING_POSITION_ASSIGNMENTS:Cue,MISSING_ROUND_NUMBER:rOe,MISSING_SCHEDULE:ade,MISSING_SCORING_POLICY:oOe,MISSING_SEED_ASSIGNMENTS:Aue,MISSING_SEEDCOUNT_THRESHOLDS:hue,MISSING_SEEDING_POLICY:aOe,MISSING_SET_NUMBER:cOe,MISSING_SET_OBJECT:eF,MISSING_SIDE_NUMBER:uOe,MISSING_STAGE:Uue,MISSING_STRUCTURE_ID:Bc,MISSING_STRUCTURE:Jy,MISSING_MAIN_STRUCTURE:aq,MISSING_STRUCTURES:nq,MISSING_TARGET_LINK:rq,MISSING_TIE_FORMAT:PC,MISSING_TIME_ITEM:bq,MISSING_TIME_ITEMS:Iq,MISSING_TOURNAMENT_ID:pT,MISSING_TOURNAMENT_RECORD:rt,MISSING_TOURNAMENT_RECORDS:yn,MISSING_VALUE:Kt,MISSING_VENUE_ID:$g,MODIFICATIONS_FAILED:sde,NO_CANDIDATES:sF,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:mq,NO_MODIFICATIONS_APPLIED:MC,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:Aj,NO_PARTICIPANT_REMOVED:Gue,NO_VALID_ACTIONS:dde,NO_VALID_ATTRIBUTES:oF,NO_VALID_DATES:Bue,NOT_FOUND:ts,NOT_IMPLEMENTED:Uq,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:hq,PARTICIPANT_ID_EXISTS:Vue,PARTICIPANT_NOT_CHECKED_IN:jue,PARTICIPANT_NOT_FOUND:On,PARTICIPANT_PAIR_EXISTS:fOe,PENALTY_NOT_FOUND:hT,POLICY_NOT_ATTACHED:sOe,POLICY_NOT_FOUND:B1,SCHEDULE_NOT_CLEARED:oue,SCHEDULE_CONFLICT_DOUBLE_BOOKING:lue,SCHEDULED_MATCHUPS:mde,SCORES_PRESENT:_1,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:fue,STAGE_SEQUENCE_LIMIT:Tue,STRUCTURE_NOT_FOUND:nn,TEAM_NOT_FOUND:wq,UNABLE_TO_ASSIGN_COURT:ode,UNLINKED_STRUCTURES:bue,UNRECOGNIZED_DRAW_TYPE:tq,UNRECOGNIZED_MATCHUP_FORMAT:N1,UNRECOGNIZED_MATCHUP_STATUS:fj,VALUE_UNCHANGED:Sq,VENUE_EXISTS:ede},tn={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},gde={addNotice:DOe,callListener:BOe,cycleMutationStatus:EOe,deleteNotice:MOe,deleteNotices:ROe,disableNotifications:gOe,enableNotifications:vOe,getMethods:lF,getNotices:POe,getTopics:NOe,getTournamentId:vde,getTournamentRecord:yOe,getTournamentRecords:bOe,removeTournamentRecord:UOe,setMethods:COe,setSubscriptions:TOe,setTournamentId:wOe,setTournamentRecord:IOe,setTournamentRecords:SOe,handleCaughtError:kOe};function gOe(){tn.disableNotifications=!0}function vOe(){tn.disableNotifications=!1}function vde(){return tn.tournamentId}function yOe(t){return tn.tournamentRecords[t]}function bOe(){return tn.tournamentRecords}function IOe(t){let e=t?.tournamentId;return e?(tn.tournamentRecords[e]=t,{success:!0}):{error:D1}}function wOe(t){return t?tn.tournamentRecords[t]?(tn.tournamentId=t,{success:!0}):{error:rt}:(tn.tournamentId=void 0,{success:!0})}function SOe(t){tn.tournamentRecords=t;let e=Object.keys(t);e.length===1?tn.tournamentId=e[0]:e.length||(tn.tournamentId=void 0)}function UOe(t){if(typeof t!="string")return{error:be};if(!tn.tournamentRecords[t])return{error:ts};delete tn.tournamentRecords[t];let e=Object.keys(tn.tournamentRecords);return e.length===1?tn.tournamentId=e[0]:e.length||(tn.tournamentId=void 0),{success:!0}}function TOe(t){return t.subscriptions===null||Object.keys(t.subscriptions).length===0?(tn.subscriptions={},{...se}):typeof t.subscriptions!="object"?{error:be}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?tn.subscriptions[e]=t.subscriptions[e]:delete tn.subscriptions[e]}),{...se})}function COe(t){return typeof t!="object"?{error:be}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(tn.methods[e]=t[e])}),{...se})}function EOe(){let t=tn.modified;return tn.modified=!1,t}function DOe({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(tn.disableNotifications||(tn.modified=!0),!(tn.disableNotifications||!tn.subscriptions[t]&&!r)))return i&&(tn.notices=tn.notices.filter(n=>!(n.topic===t&&n.key===i))),tn.notices.push({topic:t,payload:e,key:i}),{...se}}function lF(){return tn.methods??{}}function POe({topic:t}){return tn.notices.filter(e=>e.topic===t).map(e=>e.payload)}function ROe(){tn.notices=[]}function MOe({topic:t,key:e}){tn.notices=tn.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function NOe(){return{topics:Object.keys(tn.subscriptions)}}function BOe({topic:t,notices:e},i){let r=tn.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i?.[t];n&&typeof n=="function"&&n(e)}function kOe({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:vde(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}var Pr={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},is=gde,jJ=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function xOe(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Pn(Object.keys(t),jJ).length!==jJ.length)throw new Error("Global state provider is missing required methods");return is=t,{success:!0}}function yde(){if(is.createInstanceState){try{is.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:nde}}function Gl(t){return!t||typeof t!="object"?Pr.devContext??!1:typeof Pr.devContext!="object"?!1:Object.keys(t).every(e=>Pr.devContext?.[e]===t[e])&&Pr.devContext}function _Oe(t="reset",e="default"){let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Pr.timers).filter(r=>r!=="default"||Pr.timers[r].startTime).map(r=>{let n=Pr.timers[r],a=n.state==="stopped"?0:(i-(n?.startTime??0))/1e3,s=n.elapsedTime+a;return{state:Pr.timers[r].state,elapsedTime:s.toFixed(2),timer:r}});{let r=Pr.timers[e].state==="stopped"?0:(i-(Pr.timers[e]?.startTime??0))/1e3,n=Pr.timers[e].elapsedTime+r;return{state:Pr.timers[e].state,elapsedTime:n.toFixed(2),timer:e}}}if(!Pr.timers[e]||t==="reset"){if(e==="allTimers")return Pr.timers={default:{elapsedTime:0}},!0;Pr.timers[e]={startTime:i,state:"active",elapsedTime:0}}return Pr.timers[e].elapsedTime||(Pr.timers[e].elapsedTime=0),t==="stop"&&Pr.timers[e].state!=="stopped"&&(Pr.timers[e].state="stopped")&&(Pr.timers[e].elapsedTime+=(i-(Pr.timers[e]?.startTime??0))/1e3),t==="start"&&(Pr.timers[e].startTime=i)&&(Pr.timers[e].state="active"),Pr.timers[e]}function bde(t){jo(t)?Pr.globalLog=t:delete Pr.globalLog}function K0(t){Pr.devContext=t}function Ide(){is.disableNotifications()}function cF(){is.enableNotifications()}function Y0(t,e){typeof t=="boolean"&&(Pr.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Pr.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Pr.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Pr.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Pr.deepCopyAttributes.threshold=e.threshold))}function Eq(){return{enabled:Pr.deepCopy,...Pr.deepCopyAttributes}}function OOe(t){return t?.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Pr.globalSubscriptions[e]=t.subscriptions[e]}),{...se}):{error:Kt,info:"missing subscriptions"}}function FOe(t){return t?.subscriptions?is.setSubscriptions({subscriptions:t.subscriptions}):{error:Kt,info:"missing subscriptions"}}function wde(t){return t?typeof t!="object"?{error:be}:(Object.keys(t).forEach(e=>{jo(t[e])&&(Pr.globalMethods[e]=t[e])}),{...se}):{error:Kt,info:"missing method declarations"}}function Sde(t){return t?typeof t!="object"?{error:be}:is.setMethods(t):{error:Kt,info:"missing method declarations"}}function Dq(){return is.cycleMutationStatus()}function bi(t){if(typeof t?.topic!="string")return;let e=Pr.globalSubscriptions[t.topic];return is.addNotice(t,e)}function Pq(){return{...Pr.globalMethods,...is.getMethods()}}function Rq(t){return is.getNotices(t)}function Mq({key:t,topic:e}){return is.deleteNotice({key:t,topic:e})}function Cw(){return is.deleteNotices()}function kc(){return is.getTopics()}function uF(t){return kc()?.topics?.includes(t)}async function X0(t){return is.callListener(t,Pr.globalSubscriptions)}function Ew(){return is.getTournamentId()}function Nq(t){return is.getTournamentRecord(t)}function Hg(){return is.getTournamentRecords()}function Ude(t){return is.setTournamentRecord(t)}function dF(t){return is.setTournamentRecords(t)}function Z0(t){return is.setTournamentId(t)}function Tde(t){return is.removeTournamentRecord(t)}function yj(){return is}function pF({engineName:t,methodName:e,params:i,err:r}){let n=jo(is.handleCaughtError)&&is.handleCaughtError||gde.handleCaughtError,{tournamentRecord:a,...s}=i;return n({params:s,engineName:t,methodName:e,err:r})}function Cde(t,e){if(Pr.globalLog)try{Pr.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),bde()}else console.log(e,t)}function Ede(t,e,i,r){if(!Ki(t))return{error:be};Sn||(i=1);let n=Array.isArray(e)?e:[],a={},s=(o,l=0)=>{Object.keys(o).forEach(c=>{jo(o[c])?a[c]=o[c]:Ki(o[c])&&(e===!0||n?.includes(c))&&(i===void 0||l<i)&&s(o[c],l+1)})};return s(t),r?wde(a):Sde(a),{methods:a}}function LOe(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function Ft(t,e,i,r){if(typeof t!="object"||t===null)return t;Eq()?.enabled||(r=!0);let n=["",void 0,null];e&&n.push(!1);let a=LOe(t,n,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(o=>Ft(o))}:{[s]:r?t[s]:Ft(t[s])}))}function le({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e?.stack)&&(e.stack=[]),e&&Array.isArray(e?.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&(e.context||(e.context={}),Object.assign(e.context,Ft(t))),e&&!e?.error&&!e?.success&&Object.assign(e,{...se}),e??{success:!0}}var Cs="FEMALE",pm="OTHER",Dw="MIXED",aa="MALE",Fh={FEMALE_ABBR:"F",OTHER_ABBR:"O",MIXED_ABBR:"X",MALE_ABBR:"M",ANY_ABBR:"A",FEMALE:Cs,MIXED:Dw,OTHER:pm,MALE:aa,ANY:"ANY"};function Hv(t){return[Cs,"F"].includes(t)}function lI(t){return[aa,"M"].includes(t)}function Uc(t){return[Dw,"X"].includes(t)}function fh(t){return["ANY","A"].includes(t)}function Ws(t){if(t){if(Hv(t))return Cs;if(Uc(t))return Dw;if(lI(t))return aa;if(fh(t))return"ANY"}return pm}function rf(t){return Hv(t)||lI(t)}var $Oe="MIXED events can not contain mixed singles or { gender: ANY } collections",HOe="events with { gender: ANY } can not contain MIXED singles collections";function fF(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&rf(i)&&Ws(i)!==Ws(n)?le({result:{valid:!1,error:XD},context:{gender:n},stack:e}):Uc(i)&&(fh(n)||Uc(n)&&r!==yr)?le({result:{error:XD,valid:!1},info:$Oe,stack:e}):fh(i)&&Uc(n)&&r!==yr?le({result:{error:XD,valid:!1},info:HOe,stack:e}):{valid:!0}}var VOe="normal",zJ="timed",GOe="final",Bq="NOAD",QOe={S:VOe,F:GOe};function hF(t,e){if(Ki(t)&&(t?.bestOf||t?.exactly)&&t?.setFormat)return jOe(t,e)}function J0(t){return!Number.isNaN(Number(t))&&Number(t)}function Dde(t){let e=`T${t.minutes}`;return t.based==="A"?e+="A":t.based==="P"&&(e+="P"),t.tiebreakFormat?.tiebreakTo&&(e+=`/TB${t.tiebreakFormat.tiebreakTo}`),t.modifier&&(e+=`@${t.modifier}`),e}function jOe(t,e){let i=J0(t.bestOf)||void 0,r=J0(t.exactly)||void 0,n=i||r;if(t.setFormat?.timed&&t.simplified&&n===1)return Dde(t.setFormat);let a=n&&`SET${n}${r&&r!==1?"X":""}`||"",s=qJ(t.setFormat,e),o=s&&`S:${s}`||"",l=qJ(t.finalSetFormat,e),c=n&&n>1&&l&&s!==l&&`F:${l}`||"";if(a&&s)return[a,o,c].filter(Boolean).join("-")}function qJ(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return Dde(t);if(t.tiebreakSet)return WJ(t.tiebreakSet);let i=J0(t.setTo);if(i){let r=t.NoAD&&Bq||"",n=WJ(t.tiebreakFormat),a=n&&`/${n}`||"",s=J0(t.tiebreakAt),o=s&&(s!==i||e)&&`@${s}`||"";if(n!==!1)return`${i}${r}${a}${o}`}}}function WJ(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&J0(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?Bq:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function vs(t){if(Lr(t)){let e=t.startsWith("T")&&zJ||t.startsWith("SET")&&"SET"||"";if(e===zJ){let i=Mde(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e==="SET")return zOe(t)}}function zOe(t){let e=t.split("-"),i=e[0].slice(3),r=i.endsWith("X"),n=r?i.slice(0,-1):i,a=mT(n),s=r&&a!==1?void 0:a,o=r&&a!==1?a:void 0,l=e&&KJ(e[1]),c=e&&KJ(e[2]),u=l&&l.timed||c&&c.timed,d=s&&s<6||u&&o,p=!e[2]||c,f=l,h=Ft({setFormat:l,exactly:o,bestOf:s});if(c&&(h.finalSetFormat=c),d&&f&&p)return h}function KJ(t){if(t?.[1]!==":")return;let e=t.split(":"),i=QOe[e[0]],r=e[1];if(!(!i||!r))return qOe(t,r)}function qOe(t,e){return e.startsWith("TB")?WOe(e):e.startsWith("T")?Mde(e):KOe(t,e)}function WOe(t){let e=Rde(t);return e===!1?!1:typeof e=="object"?{tiebreakSet:e}:void 0}function KOe(t,e){let i=/^[FS]:(\d+)([A-Za-z]*)/.exec(t),r=i&&Nde(i[2])||!1,n=!i?.[2]||r,a=i?mT(i[1]):void 0,s=Pde(e),o=s!==!1,l=o&&s||a,c=Rde(e.split("/")[1]);return!a||!n||c===!1||!o?!1:YOe(a,r,c,l)}function YOe(t,e,i,r){let n={setTo:t};return e&&(n.NoAD=!0),i?(n.tiebreakFormat=i,n.tiebreakAt=r):n.noTiebreak=!0,n}function Pde(t,e=!0){let i=t?.indexOf("@")>0&&t.split("@");if(i)return(e?mT(i[1]):i[1])||!1}function Rde(t){if(t)return t.startsWith("TB")?XOe(t):!1}function XOe(t){let e=Pde(t,!1),i=/^TB(\d+)([A-Za-z]*)/.exec(t),r=i?.[1],n=i&&Nde(i[2]),a=!i?.[2]||n,s=mT(r);if(!s||!a)return!1;let o={tiebreakTo:s};return e&&typeof e=="string"&&!yi(e)&&(o.modifier=e),n&&(o.NoAD=!0),o}function Mde(t){let e=t.slice(1),i=/^(\d+)([PGA])?(?:\/TB(\d+))?(@[A-Za-z]+)?$/.exec(e),r=mT(i?.[1]);if(!r)return;let n={timed:!0,minutes:r},a=i?.[2];a==="A"?n.based="A":a==="P"?n.based="P":a==="G"&&(n.based="G");let s=i?.[3];if(s){let c=mT(s);c&&(n.tiebreakFormat={tiebreakTo:c})}let o=i?.[4],l=[void 0,"P","G",""].includes(o);if(o&&!l){let c=/^(\d+)([PGA])?(?:\/TB\d+)?(@)([A-Za-z]+)$/.exec(e)?.[4];return c?(n.modifier=c,n):void 0}return o&&(n.based=o),n}function Nde(t){return t?.includes(Bq)}function mT(t){let e=Number(t);return Number.isNaN(e)?0:e}function Ql({matchUpFormat:t}){if(!Lr(t)||t==="")return!1;let e=vs(t),i=/-S:([1-9])+\/TB(\d{1,2})@?([1-9]?)/.exec(t),r=i?.[1],n=i?.[2],a=i?.[3],s=/-F:([1-9])+\/TB(\d{1,2})@?([1-9]?)/.exec(t),o=s?.[1],l=s?.[2],c=s?.[3];return hF(e,!!(i&&n&&r===a||s&&l&&o===c))===t.replace(/G/,"")}var Cx=/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1])$/,Bde=/^((0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)([.,]\d{3})?$/,nf=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))([ T](0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/,Vv=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))?([ T]?(0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/;function Ex(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Si(t.scheduledTime)),!e)return;let i=qr(t.scheduledTime),r=Si(e);return r&&i&&(r+=`T${i}`),r}function ZOe(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function NC(t){let e=typeof t=="string"?t?.split(" "):[];if(t&&e?.length>1&&!["AM","PM"].includes(e[1].toUpperCase()))return!1;let i=Pw(t,!0,!0);return!!(!t||i&&Vv.test(i))}function Co(t){return vy(t)||Cx.test(t)}function JOe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+3600*e.getHours();return eFe(i,{displaySeconds:!1})}function eFe(t,e){let i=Number.parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e?.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(tu).join(":")}var kq=t=>{let e=eP(t)||vy(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${tu(r)}-${tu(e.getUTCDate())}`};function tFe(t){let e=eP(t)||vy(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function ed(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&!t.includes("T")&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),s=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,s].join(e):i==="MDY"?[n,a,s].join(e):i==="YDM"?[s,a,n].join(e):i==="DYM"?[a,s,n].join(e):i==="MYD"?[n,s,a].join(e):[s,n,a].join(e)}function Dx(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function iFe(t){return Dx(t).getTime()}function eP(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!Number.isNaN(Number(t))&&new Date(t)||!1;return e&&!Number.isNaN(Number(e.valueOf()))}function rFe(t,e){return t<=e}function AT(t,e){if(!Co(t)||!Co(e))return[];let i=Si(t)+"T00:00",r=Si(e)+"T00:00",n=new Date(i),a=new Date(r),s=eP(a)&&eP(n)&&rFe(n,a),o=[],l=0;if(s){let c=n,u=c.getTime();for(;u<=a.getTime()&&l<300;)l+=1,o.push(new Date(c)),u=c.setDate(c.getDate()+1)}return o.map(c=>ed(c))}var nFe=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function vy(t){return typeof t!="string"?!1:nFe.test(t)}function xq(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!Number.isNaN(Number.parseInt(r)));return!(e.length<2||!i||Number.parseInt(e[0])>23||Number.parseInt(e[1])>60)}function ar(t){let e=qr(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>Number.parseInt(n));return i*60+r}function aFe(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[tu(e),tu(i)].join(":")}function Px(t){return xq(t)?t.split(":").slice(0,2).map(tu).join(":"):void 0}function qr(t){return vy(t)&&t.indexOf("T")>0?Px(t.split("T").reverse()[0]):Px(t)}function Si(t){return vy(t)||nf.test(t)?t.split("T")[0]:""}function ED(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Si(i.toISOString())}function Rx(t){t=typeof t=="string"?t:"00:00";let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,Number.isNaN(Number.parseInt(i.hours))||Number.isNaN(Number.parseInt(i.minutes))||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function sFe(t){let e=Rx(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&Number.parseInt(e.hours)<12&&(e.hours=(e.hours&&Number.parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(tu).join(":")}function oFe(t){let e=Rx(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),e.hours?.[0]==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function Pw(t,e,i){let r=Si(t),n=qr(t),a=r?n:t;return t?e&&(r&&i&&t||sFe(a))||oFe(a):void 0}function kde(t,e){let i=Rx(t),r=Rx(e);if(Number.parseInt(i.hours)<Number.parseInt(r.hours))return-1;if(Number.parseInt(i.hours)>Number.parseInt(r.hours))return 1;if(i.hours===r.hours){if(Number.parseInt(i.minutes)<Number.parseInt(r.minutes))return-1;if(Number.parseInt(i.minutes)>Number.parseInt(r.minutes))return 1}return 0}function _q(t,e=7){let i=Si(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return ed(n)}function lFe(t){return _q(t)}function cFe(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),ed(n,i)}function uFe(t,e,i){let r=new Date(t,0);return ed(new Date(r.setDate(e)),i)}function Zn(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(tu),n=Dx(e).setHours(i,r,0,0);return Dx(n)}function O1(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function ml(t,e){let i=qr(t);if(!i)return"00:00";let r=Number.isNaN(e)?0:e;return qr(Oq(Zn(i),r).toISOString())||"00:00"}function Oq(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function tu(t){return t.toString()[1]?t:"0"+t}function hh(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var xde={addDays:_q,addWeek:lFe,addMinutesToTimeString:ml,convertTime:Pw,getIsoDateString:Ex,getUTCdateString:kq,DateHHMM:JOe,extractDate:Si,extractTime:qr,formatDate:ed,getDateByWeek:cFe,isISODateString:vy,isDate:eP,isTimeString:xq,offsetDate:Dx,offsetTime:iFe,sameDay:hh,timeStringMinutes:ar,timeToDate:Zn,timeUTC:tFe,validTimeValue:NC,validDateString:Cx,timeValidation:Vv,dateValidation:nf},dFe=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),pFe=t=>t.filter(Boolean).every(Sn);function QS(t,e){return`${t}-${e}`}function yy(t){let e=t.category;if(typeof e!="object"||!e)return{error:W0};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s}=e,o=e.categoryName,l;if(!(dFe([i,r,n,o],"string")&&pFe([a,s])&&[r,n].filter(Boolean).every(Co)))return{error:W0};let c=t.consideredDate??Si(new Date().toLocaleDateString("sv"));if(!c||!Co(c))return{error:fa};let[u]=c.split("-").slice(0,3).map(V=>Number.parseInt(V)),d=ED(c,-1);if(!d)return{error:fa};let[p,f]=d.split("-").slice(1,3).map(V=>Number.parseInt(V)),h=`${tu(p)}-${tu(f)}`,m=ED(c,1);if(!m)return{error:fa};let[A,g]=m.split("-").slice(1,3).map(V=>Number.parseInt(V)),v=`${tu(A)}-${tu(g)}`,b=s&&ED(c,-1*365*s),y=a&&ED(c,-1*365*a),I=[],w=V=>!I.includes(V)&&I.push(V);i=i??o;let S=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,D=i?.includes("-"),C=D&&i?.match(T),E=i?.match(S);function P(V){let G=u-V,z=QS(G,v);e.ageMinDate&&e.ageMinDate!==z&&w(`Invalid submitted ageMinDate: ${n}`),n=z,i&&(e.ageMax&&e.ageMax!==V-1&&(w(`Invalid submitted ageMax: ${a}`),y=void 0),a=V-1)}function R(V){let G=u-V-1,z=QS(G,v);e.ageMin&&e.ageMin>V&&w(`Invalid submitted ageMin: ${s}`),e.ageMax&&e.ageMax>V&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==z&&w(`Invalid submitted ageMinDate: ${n}`),n=z,i&&(e.ageMax&&e.ageMax!==V&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=V)}function M(V){let G=u-V,z=QS(G,h);e.ageMaxDate&&e.ageMaxDate!==z&&w(`Invalid submitted ageMaxDate: ${r}`),r=z,i&&(e.ageMin&&e.ageMin!==V+1&&(w(`Invalid submitted ageMin: ${s}`),b=void 0),s=V+1)}function N(V){let G=u-V-1,z=QS(G,h);e.ageMaxDate&&e.ageMaxDate!==z&&w(`Invalid submitted ageMaxDate: ${r}`),r=z,i&&(e.ageMin&&e.ageMin!==V&&(w(`Invalid submitted ageMin: ${s}`),b=void 0),s=V)}function k(V){let G=S.exec(V)||[],[z,Q,j]=G.slice(1),W=Number.parseInt(Q);z==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),P(W)):z==="O"&&M(W),j==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),R(W)):j==="O"&&N(W),r=(r??b)||void 0,n=(n??y)||void 0}function O(){if(r=void 0,n=void 0,a=void 0,s=void 0,e.ageMin){let z=u-e.ageMin;r=QS(z,h)}if(e.ageMax){let z=u-e.ageMax-1;n=QS(z,v)}let[V,G]=(i?.match(T)??[]).slice(1).map(z=>Number.parseInt(z));V<=G?(s=V,a=G,l=!0):w(`Invalid combined age range ${i}`)}function x(){s&&M(s),a&&R(a)}function F(){C?O():D?i?.split("-").forEach(k):E&&i?k(i):x()}F(),a&&e?.ageMin&&e?.ageMin>a&&(w(`Invalid submitted ageMin: ${e?.ageMin}`),s=void 0);let _=Ft({consideredDate:c,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s});return I.length&&(_.errors=I),_}function tP({category:t}){if(!Ki(t))return{error:be};let e=yy({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!Sn(i)?le({result:{error:be},context:{ratingMax:i}}):r&&!Sn(r)?le({result:{error:be},context:{ratingMin:r}}):{...e}}function F1({childCategory:t,withDetails:e,category:i}){let r=tP({category:i}),n=tP({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),s=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),o=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),c=i?.ratingType&&t?.ratingType&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),u=i?.ballType&&t?.ballType&&i.ballType!==t.ballType,d=Ft({invalidRatingRange:c,invalidAgeMinDate:o,invalidAgeMaxDate:l,invalidBallType:u,invalidAgeMax:s,invalidAgeMin:a,valid:!c&&!o&&!l&&!u&&!s&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function L1({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:s}){a=a??s?.gender;let o="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),le({result:{errors:l,error:oA},stack:o});let{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,collectionId:p,matchUpCount:f,matchUpFormat:h,matchUpValue:m,matchUpType:A,scoreValue:g,setValue:v,category:b,gender:y}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof f!="number"&&l.push(`matchUpCount is not type number: ${f}`),A&&!XO([Er,yr],A)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${A}`),[!!c?.length].concat([m,d,g,v].map(yi)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),c&&f){let I=nue({collectionValueProfiles:c,matchUpCount:f});I.errors&&l.push(...I.errors)}if(u&&typeof u!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),h&&!Ql({matchUpFormat:h})&&l.push(`Invalid matchUpFormat: ${h}`),r){let I=fF({referenceGender:a,matchUpType:A,gender:y});if(I.error)return le({context:{referenceGender:a,gender:y},result:I,stack:o})}if(t&&n&&b){let I=F1({category:n,childCategory:b});if(!I.valid)return le({result:{error:W0},context:I,stack:o})}return l.length?le({result:{errors:l,error:cde},stack:o}):{valid:!0}}function Ko(t){let e=!!(t?.enforceCategory!==!1&&t?.category),i=!!(t?.enforceGender!==!1&&t?.gender),r=t?.checkCollectionIds,n=t?.tieFormat,a=t?.event,s="validateTieFormat",o=[],l=fFe({...t,stack:s});if(l?.error)return l;let c,u=n.collectionDefinitions.every(A=>{let{setValue:g,scoreValue:v,collectionValue:b}=A;(g||v)&&!b&&(c=!0);let{valid:y,errors:I}=L1({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:A,checkCollectionIds:r,checkCategory:e,checkGender:i,event:a});return y?!0:(Array.isArray(I)&&o.push(...I),!1)}),d=typeof n.winCriteria?.valueGoal=="number"&&n.winCriteria?.valueGoal>0&&!c||n.winCriteria?.aggregateValue;if(!(d||n.winCriteria?.aggregateValue))return c?o.push("aggregateValue is required"):o.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),le({context:{tieFormat:n,errors:o,aggregateValueImperative:c},result:{error:Jf},stack:s});let p=n.collectionDefinitions.map(({collectionId:A})=>A),f=!r||p.length===Ci(p).length,h=u&&d&&f;return h?{valid:h,errors:o}:le({result:{error:Jf},context:{tieFormat:n,errors:o},stack:s})}function fFe(t){let{tieFormat:e,stack:i}=t;return!t||!e||!Ki(e)?le({result:{error:Jf},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):Ki(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...se}:le({result:{error:Jf},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):le({result:{error:Jf},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var Mx="resourceSubType",Nx="resourceType",gT="identifier",bj="name",_de={RESOURCE_SUB_TYPE:Mx,RESOURCE_TYPE:Nx,IDENTIFIER:gT,NAME:bj};function St(t,e,i,r,n=0){if(yj().makeDeepCopy)return yj().makeDeepCopy(t,e,i,r);let a=Eq(),{stringify:s,toJSON:o,ignore:l,modulate:c}=a||{};if(!a?.enabled&&!i||typeof t!="object"||jo(t)||t===null||typeof a?.threshold=="number"&&n>=a.threshold)return t;let u=Array.isArray(t)?[]:{},d=Object.keys(t).filter(f=>!i||!l||Array.isArray(l)&&!l.includes(f)||jo(l)&&!l(f)),p=(f,h)=>{u[f]=jo(h?.toString)?h.toString():JSON.stringify(h)};for(let f of d){let h=t[f],m=jo(c)?c(h):void 0;if(m!==void 0)u[f]=m;else if(e&&f==="extensions"&&Array.isArray(h)){let A=Fq(h);Object.assign(u,...A)}else r&&f==="extensions"?u[f]=[]:Array.isArray(s)&&s.includes(f)?p(f,h):Array.isArray(o)&&o.includes(f)&&jo(h?.toJSON)?u[f]=h.toJSON():h===null?u[f]=void 0:ZOe(h)?u[f]=new Date(h).toISOString():u[f]=St(h,e,i,r,n+1)}return u}function Fq(t){return t?.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}function Ode(t=1,e){return gt(0,t).map(()=>fr(e))}function fr(t){let e=[];for(let o=0;o<256;o++)e[o]=(o<16?"0":"")+o.toString(16);let i=Math.trunc(Math.random()*4294967295),r=Math.trunc(Math.random()*4294967295),n=Math.trunc(Math.random()*4294967295),a=Math.trunc(Math.random()*4294967295),s=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[r&255]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[n&63|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${s.replaceAll("-","")}`:s}var Fde={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},Lde={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},$de={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},Hde={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},Vde={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},Gde={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},Qde={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},jde={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},zde={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},qde={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},td="SET3-S:6/TB7",hFe="SET3-S:6NOAD",Wde="SET3-S:6/TB7-F:TB10",mFe="SET3-S:4/TB7",AFe="SET3-S:4/TB5@3",gFe="SET1-S:T20",vFe="SET1-S:8/TB7",yFe="SET1-S:8/TB7@7",bFe={FORMAT_STANDARD:td,FORMAT_STANDARD_NOAD:hFe,FORMAT_ATP_DOUBLES:Wde,FORMAT_SHORT_SETS:mFe,FORMAT_FAST4:AFe,FORMAT_PRO_SET:vFe,FORMAT_COLLEGE_PRO_SET:yFe,TIMED20:gFe},Kde={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},Yde={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},Xde={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},Zde={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},Jde={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},epe={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},tpe={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},Bx="COLLEGE_DEFAULT",Ij="COLLEGE_JUCO",wj="COLLEGE_D3",ipe="DOMINANT_DUO",rpe="DOMINANT_DUO_MIXED",npe="LAVER_CUP",ape="TEAM_DOUBLES_3_AGGREGATION",spe="TIME_TENNIS_DUAL",ope="TIME_TENNIS_PRO_CIRCUIT",lpe="USTA_BREWER_CUP",cpe="USTA_OZAKI_CUP",upe="USTA_COLLEGE",dpe="USTA_GOLD_TEAM_CHALLENGE",ppe="USTA_LEVEL_1",fpe="USTA_INTERSECTIONAL",hpe="USTA_SECTION_BATTLE",mpe="USTA_SOUTHERN_LEVEL_5",Ape="USTA_TOC",gpe="USTA_WTT_ITT",vpe="USTA_ZONAL",ype={COLLEGE_D3:wj,COLLEGE_DEFAULT:Bx,COLLEGE_JUCO:Ij,DOMINANT_DUO:ipe,DOMINANT_DUO_MIXED:rpe,LAVER_CUP:npe,TEAM_DOUBLES_3_AGGREGATION:ape,TIME_TENNIS_DUAL:spe,TIME_TENNIS_PRO_CIRCUIT:ope,USTA_BREWER_CUP:lpe,USTA_OZAKI_CUP:cpe,USTA_COLLEGE:upe,USTA_GOLD_TEAM_CHALLENGE:dpe,USTA_INTERSECTIONAL:fpe,USTA_LEVEL_1:ppe,USTA_SECTION_BATTLE:hpe,USTA_SOUTHERN_LEVEL_5:mpe,USTA_TOC:Ape,USTA_WTT_ITT:gpe,USTA_ZONAL:vpe},bpe="STANDARD",YJ={[bpe]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[wj]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:td,matchUpCount:6,matchUpValue:1},tieFormatName:wj,valueGoal:5},[Bx]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:td,matchUpCount:6,matchUpValue:1},tieFormatName:Bx,valueGoal:4},[Ij]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:td,matchUpCount:6,matchUpValue:1},tieFormatName:Ij,valueGoal:5},[npe]:epe,[ipe]:Kde,[rpe]:Qde,[ape]:Lde,[spe]:jde,[ope]:Gde,[lpe]:zde,[cpe]:qde,[upe]:Yde,[dpe]:Fde,[fpe]:Vde,[ppe]:Xde,[hpe]:Hde,[mpe]:$de,[gpe]:Zde,[Ape]:tpe,[vpe]:Jde},IFe=t=>{let e=t?.namedFormat&&Object.keys(YJ).includes(t.namedFormat)?t.namedFormat:bpe,i=Array.isArray(t?.uuids)?t?.uuids:[],r,{category:n,gender:a}=t?.event??{},s=St(YJ[e],!1,!0),o=l=>{if(!t?.isMock&&!t?.event?.isMock||!t.event)return i?.pop()??fr();let c=t?.event?.eventId;return i.pop()??`${c}-COL-${l+1}`};return s.hydrate?(r={winCriteria:{valueGoal:s.valueGoal},collectionDefinitions:[{collectionId:o(0),matchUpFormat:Wde,collectionName:"Doubles",matchUpType:yr,...s.doubles},{collectionId:o(1),matchUpFormat:td,collectionName:"Singles",matchUpType:Er,...s.singles}]},s.tieFormatName&&(r.tieFormatName=s.tieFormatName)):(s.collectionDefinitions.forEach((l,c)=>l.collectionId=o(c)),r=s),t?.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},Nm=IFe,af="SINGLES",$I="SINGLES",uu="DOUBLES",Bm="DOUBLES",ca="TEAM",jl="TEAM",wFe="RATING",SFe="BOTH",Ul={AGE:"AGE",BOTH:SFe,DOUBLES:uu,DOUBLES_EVENT:Bm,RATING:wFe,SINGLES:af,SINGLES_EVENT:$I,TEAM_EVENT:jl,TEAM:ca},Ut="MAIN",zt="QUALIFYING",Os="CONSOLATION",Ya="VOLUNTARY_CONSOLATION",Tn="PLAY_OFF",mF=[Ut,zt,Os,Tn,Ya],HI={[zt]:1,[Ut]:2,[Tn]:3,[Os]:3,[Ya]:4},Ipe="finishingPositions",wpe="aggregateEventStructures",Spe={[Ut]:1,[Tn]:2,[Os]:3,[zt]:4,[Ya]:5},UFe={[Tn]:1,[Ut]:2,[Os]:3,[zt]:4,[Ya]:5},$1="CLUSTER",AF="ADJACENT",Upe="SEPARATE",by="WATERFALL",gF="ITEM",Ao="CONTAINER",Yu="DRAW",vF="RANDOM",Xu="TOP_DOWN",Iy="BOTTOM_UP",mh="POSITION",Ah="WINNER",gh="LOSER",sf="FIRST_MATCHUP",zl="AD_HOC",TFe="AD_HOC",BC="FEED_IN",vT="COMPASS",yT="OLYMPIC",CFe="SINGLE_ELIMINATION",jp="SINGLE_ELIMINATION",H1="DOUBLE_ELIMINATION",bT="FIRST_MATCH_LOSER_CONSOLATION",V1="FIRST_ROUND_LOSER_CONSOLATION",ib="LUCKY_DRAW",yF="CURTIS_CONSOLATION",EFe="CURTIS_CONSOLATION",Lq="FEED_IN_CHAMPIONSHIP_TO_SF",iP="FEED_IN_CHAMPIONSHIP_TO_SF",$q="FEED_IN_CHAMPIONSHIP_TO_QF",rP="FEED_IN_CHAMPIONSHIP_TO_QF",Hq="FEED_IN_CHAMPIONSHIP_TO_R16",nP="FEED_IN_CHAMPIONSHIP_TO_R16",Tpe="MODIFIED_FEED_IN_CHAMPIONSHIP",aP="MODIFIED_FEED_IN_CHAMPIONSHIP",G1="FEED_IN_CHAMPIONSHIP",DFe="DOUBLE_ROUND_ROBIN",gd="ROUND_ROBIN",vh="ROUND_ROBIN_WITH_PLAYOFF",Cpe="DECIDER",Epe="BACKDRAW",Vq={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},Gq={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},wy="WIN_RATIO",Rw="ROUND_OUTCOME",Dpe=[vT,yF,rP,nP,iP,G1,$q,Hq,Lq,bT,V1,ib,aP,yT,Tn,vh],PFe=[zl,vT,yF,H1,rP,nP,iP,G1,BC,bT,V1,ib,aP,yT,Tn,gd,vh,jp],Wn={MAIN:Ut,QUALIFYING:zt,CONSOLATION:Os,ITEM:gF,CONTAINER:Ao,FIRST_MATCHUP:sf,WINNER:Ah,LOSER:gh,AD_HOC:zl,FEED_IN:BC,FLEX_ROUNDS:TFe,COMPASS:vT,PLAY_OFF:Tn,OLYMPIC:yT,KNOCKOUT:CFe,SINGLE_ELIMINATION:jp,DOUBLE_ELIMINATION:H1,CURTIS:yF,FICSF:Lq,FICQF:$q,FICR16:Hq,MFIC:Tpe,VOLUNTARY_CONSOLATION:Ya,FIRST_MATCH_LOSER_CONSOLATION:bT,FIRST_ROUND_LOSER_CONSOLATION:V1,MODIFIED_FEED_IN_CHAMPIONSHIP:aP,FEED_IN_CHAMPIONSHIP_TO_R16:nP,FEED_IN_CHAMPIONSHIP_TO_QF:rP,FEED_IN_CHAMPIONSHIP_TO_SF:iP,FEED_IN_CHAMPIONSHIP:G1,LUCKY_DRAW:ib,ROUND_ROBIN_WITH_PLAYOFF:vh,ROUND_ROBIN:gd,DECIDER:Cpe,BACKDRAW:Epe,COMPASS_ATTRIBUTES:Vq,OLYMPIC_ATTRIBUTES:Gq,DRAW:Yu,RANDOM:vF,TOP_DOWN:Xu,BOTTOM_UP:Iy,CLUSTER:$1,ADJACENT:AF,SEPARATE:Upe,WATERFALL:by,WIN_RATIO:wy,ROUND_OUTCOME:Rw,MULTI_STRUCTURE_DRAWS:Dpe,generatedDrawTypes:PFe,stageOrder:HI,finishOrder:Spe,AGGREGATE_EVENT_STRUCTURES:wpe,FINISHING_POSITIONS:Ipe},RFe=Wn,Xs="tournamentRecords",Qq="policyDefinitions",Sa="tournamentRecord",jq="onlineResource",to="drawDefinition",Ppe="tieFormatName",zq="matchUpFormat",yh="participantId",Rpe="scheduleDates",MFe="tournamentId",NFe="scheduleDate",BFe="roundNumber",bF="structureId",qq="participant",Q1="matchUpIds",Mpe="entryStage",kFe="policyType",Npe="structures",Wq="eventType",Cf="matchUpId",IF="tieFormat",wF="inContext",SF="structure",UF="courtIds",xFe="personId",TF="venueIds",Kq="matchUps",Bpe="courtId",kpe="eventId",Lh="matchUp",xpe="drawId",id="error",lA="event",kC="param",Yq="uuids",_Fe="averageMatchUpMinutes",OFe="recoveryMinutes",FFe="periodLength",LFe="number",pl="object",zs="array",Es="_validate",_pe="_message",Dc="_invalid",il="_ofType",Xq="_anyOf",IT="_oneOf",XJ={[jq]:t=>Pn(Object.keys(t),[Mx,Nx,gT]).length===3,[Ppe]:t=>t&&Nm({namedFormat:t}),[Yq]:t=>!t||Array.isArray(t)&&t.every(Lr),[IF]:t=>!Ko({tieFormat:t}).error,[Wq]:t=>[af,uu,ca].includes(t),[Mpe]:t=>mF.includes(t)},$Fe={[Xs]:yn,[Sa]:rt,[Qq]:JO,[to]:Bt,[yh]:ga,[zq]:lq,[MFe]:pT,[bF]:Bc,[Q1]:Sw,[qq]:Tw,[jq]:oA,[Wq]:ph,[Npe]:nq,[Cf]:mo,[IF]:Jf,[SF]:Jy,[Bpe]:Uw,[Kq]:sA,[kpe]:cu,[Lh]:Wo,[UF]:Kt,[TF]:Kt,[xpe]:fp,[lA]:Vr},HFe={[Xs]:pl,[Qq]:pl,[Sa]:pl,[to]:pl,[jq]:pl,[Rpe]:zs,[qq]:pl,[Q1]:zs,[Npe]:zs,[IF]:pl,[SF]:pl,[UF]:zs,[TF]:zs,[Kq]:zs,[Lh]:pl,[lA]:pl,[Yq]:zs};function Gt(t,e,i){if(!t&&!Ki(t))return{error:be};if(!e?.length||t?._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:be};let{paramError:r,errorParam:n}=QFe(t,e);if(!r)return{valid:!0};let a=r[Es]&&(r[id]||r[Dc])||t?.[n]===void 0&&(r[id]||r[Dc]||$Fe[n]||be)||be,s=n??(r[IT]&&Object.keys(r[IT]).join(", "));return le({info:{param:s,message:r[_pe]},result:{error:a},stack:i})}function Ope(t,e){let i=Object.keys(t),r=Object.keys(e);return Pn(i,r)}function VFe(t,e){if(!e)return;let i=Ope(t,e);return i.length!==1?{error:be}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function GFe(t,e){if(!e)return;let i=Ope(t,e).filter(r=>t[r]);return i.length<1?{error:be}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function QFe(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:s,_validate:o,_info:l,...c})=>{let u=a&&VFe(t,a);if(u?.error)return u.error;u&&Object.assign(c,u);let d=s&&GFe(t,s);if(d?.error)return d.error;d&&Object.assign(c,d);let p=Object.keys(c).filter(h=>typeof c[h]=="boolean"),f=p.find(h=>{let m=o&&!jo(o),A=t[h]!==void 0&&!o&&jFe(t,h,n),g=c[h]&&[void 0,null].includes(t[h]),v=m||A||g||o&&t[h]!==void 0&&!zFe(t[h],o)||XJ[h]&&!XJ[h](t[h]);return v&&(i=h,r=l),v});return!p.length||f}),errorParam:i,paramInfo:r}}function jFe(t,e,i){return i=i||HFe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function zFe(t,e){return jo(e)?e(t):!0}var Zq="DYNAMIC",ug="RANKING",rg="RATING",Sy="SCALE",eh="SEEDING",xC={RANKING:ug,RATING:rg,SCALE:Sy,SEEDING:eh};function _C(t){let e=Gt(t,[{[qq]:!0}]);if(e.error)return e;let i=t.participant.timeItems?.filter(({itemType:n})=>n?.startsWith(Sy)&&[ug,rg,eh].includes(n.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(i?.length){let n=s=>i.filter(o=>o?.itemType===s).sort((o,l)=>new Date(o.createdAt||void 0).getTime()-new Date(l.createdAt||void 0).getTime()).pop(),a=Ci(i.map(({itemType:s})=>s));for(let s of a){let o=n(s);if(o){let[,l,c,u,d]=o.itemType.split("."),p=d?`${u}.${d}`:u,f=l===eh&&"seedings"||l===ug&&"rankings"||"ratings";r[f][c]||(r[f][c]=[]),r[f][c].push({scaleValue:o.itemValue,scaleDate:o.itemDate,scaleName:p})}}}return{...se,...r}}function VI(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,s,o){if(!a||!s)return;let l=Object.keys(a),c=Object.keys(s),u=Object.assign({},...c.filter(f=>f.indexOf("||")).map(f=>f.split("||").map(h=>({[h]:f}))).flat()),d=c.concat(...Object.keys(u)),p=d.includes("*");for(let f of l)if(d.indexOf(f)>=0||p){let h=u[f]||f,m=s[h]||p,A=a[f];if(typeof m=="object"&&typeof A!="function"&&!Array.isArray(m))if(Array.isArray(A)){let g=A.map(v=>{let b={};return n(v,m,b)!==!1?b:void 0}).filter(Boolean);o[f]=g}else A&&(o[f]={},n(A,m,o[f]));else{let g=a[f];if(Array.isArray(m)&&!m.includes(g))return!1;(s[f]||p&&s[f]!==!1)&&(o[f]=g)}}}}var Sj="voluntaryConsolation",fm="competitiveBands",Jq="roundRobinTally",bh="positionActions",Xa="matchUpActions",Uk="rankingPoints",km="roundNaming",OC="participant",sP="progression",Vg="scheduling",oP="avoidance",qFe="participant",WFe="display",du="scoring",Wu="seeding",wT="feedIn",KFe="audit",kx="draws",Gg={POLICY_TYPE_VOLUNTARY_CONSOLATION:Sj,POLICY_TYPE_COMPETITIVE_BANDS:fm,POLICY_TYPE_ROUND_ROBIN_TALLY:Jq,POLICY_TYPE_POSITION_ACTIONS:bh,POLICY_TYPE_MATCHUP_ACTIONS:Xa,POLICY_TYPE_RANKING_POINTS:Uk,POLICY_TYPE_ROUND_NAMING:km,POLICY_TYPE_PARTICIPANT:OC,POLICY_TYPE_PROGRESSION:sP,POLICY_TYPE_SCHEDULING:Vg,POLICY_TYPE_AVOIDANCE:oP,POLICY_TYPE_DISPLAY:WFe,POLICY_TYPE_PRIVACY:qFe,POLICY_TYPE_FEED_IN:wT,POLICY_TYPE_SCORING:du,POLICY_TYPE_SEEDING:Wu,POLICY_TYPE_AUDIT:KFe,POLICY_TYPE_DRAWS:kx};function dg({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let s=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),o=St(s,!1,n);if(o){let l=e?.[OC];if(i?.withScaleValues){let{ratings:c,rankings:u}=_C({participant:o});o.rankings=u,o.ratings=c}if(l?.participant)return VI({template:l.participant,source:o})}return o}var YFe="element required",XFe="missing name";function Eo(t){if(!t||typeof t!="object")return{error:Kt};if(t.element&&typeof t?.element!="object")return{error:be};if(!t?.name)return{error:Kt,info:XFe};if(!t?.element){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=Eo({element:i,name:t.name});if(r.error)return le({result:r,stack:"removeExtension"})}return{...se}}return{error:Kt,info:YFe}}return t?.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>e?.name!==t.name),{...se}):{...se,info:ts}}function of({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function lr(t){if(typeof t!="object")return{error:Kt};let e="addExtension";if(t?.element&&typeof t.element!="object")return le({result:{error:be},stack:e});if(!of({extension:t.extension}))return le({result:{error:be,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=lr({extension:t.extension,element:r});if(n.error)return le({result:n,stack:e})}return{...se}}else return le({result:{error:Kt},stack:e});if(t.element.extensions||(t.element.extensions=[]),t?.creationTime??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...se}}function eW(t){return!t||typeof t!="object"?{error:Kt}:t.tournamentRecord?lr({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:rt}}function CF(t){return!t||typeof t!="object"?{error:Kt}:t.drawDefinition?lr({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:Ec}}function Qg(t){return!t||typeof t!="object"?{error:Kt}:t.event?lr({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:cu}}function Fpe(t){if(!t||typeof t!="object")return{error:Kt};if(!t.participantId)return{error:ga};let e=t.tournamentRecord?.participants||[],i=dg({participantId:t.participantId,tournamentParticipants:e});return i?lr({creationTime:t.creationTime,extension:t.extension,element:i}):{error:On}}function tW(t){return!t||typeof t!="object"?{error:Kt}:t.tournamentRecord?Eo({element:t.tournamentRecord,name:t.name}):{error:rt}}function Lpe(t){return!t||typeof t!="object"?{error:Kt}:t.drawDefinition?Eo({element:t.drawDefinition,name:t.name}):{error:Ec}}function EF(t){return!t||typeof t!="object"?{error:Kt}:t?.event?Eo({element:t.event,name:t.name}):{error:cu}}function $pe(t){if(!t||typeof t!="object")return{error:Kt};if(!t.participantId)return{error:ga};let e=t.tournamentRecord?.participants||[],i=dg({participantId:t.participantId,tournamentParticipants:e});return i?Eo({element:i,name:t.name}):{error:On}}function j1({tournamentRecords:t}){return{tournamentIds:Ki(t)?Object.keys(t):[],...se}}var ZFe="extensionQueries";function Bi({discover:t,element:e,name:i,...r}){if(!e||!i){if(t&&r){let a=Object.keys(r).filter(l=>typeof t=="boolean"||Array.isArray(t)&&t.includes(l)).find(l=>Array.isArray(r[l]?.extensions)?r[l].extensions.find(c=>c?.name===i):!1),s=a&&r[a];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(l=>l.extensions?.length));let o=s?.extensions?.find(l=>l?.name===i);return{extension:o,info:o?void 0:ts}}return le({result:{error:Kt},stack:ZFe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let n=e.extensions.find(a=>a?.name===i);return{extension:n,info:n?void 0:ts}}var JFe="activeSuspension",lP="appliedPolicies",Hpe="context",DF="delegatedOutcome",Yd="disabled",GI="disableAutoCalc",PF="disableLinks",xx="display",ey="drawDeletions",eLe="drawProfile",_x="entryProfile",tLe="eventProfile",iLe="eventWithdrawalRequests",rLe="factory",vd="flightProfile",Uj="groupingAttribute",xm="lineUps",Uy="linkedTournamentsIds",RF="matchUpHistory",iW="participantRepresentatives",FC="personRequests",YU="positionActions",nLe="rankingPoints",aLe="registration",Ef="roundTarget",z1="scheduleLimits",_m="scheduleTiming",QI="schedulingProfile",sLe="statusDetail",ST="subOrder",Om="tally",ZD="tieFormatModification",th={ACTIVE_SUSPENSION:JFe,APPLIED_POLICIES:lP,CONTEXT:Hpe,DELEGATED_OUTCOME:DF,DISABLED:Yd,DISABLE_LINKS:PF,DISABLE_AUTO_CALC:GI,DISPLAY:xx,DRAW_DELETIONS:ey,DRAW_PROFILE:eLe,ENTRY_PROFILE:_x,EVENT_PROFILE:tLe,EVENT_WITHDRAWAL_REQUESTS:iLe,FLIGHT_PROFILE:vd,GROUPING_ATTRIBUTE:Uj,LINEUPS:xm,LINKED_TOURNAMENTS:Uy,MATCHUP_HISTORY:RF,PARTICIPANT_REPRESENTATIVES:iW,PERSON_REQUESTS:FC,POSITION_ACTIONS:YU,RANKING_POINTS:nLe,REGISTRATION:aLe,ROUND_TARGET:Ef,SCHEDULE_LIMITS:z1,SCHEDULE_TIMING:_m,SCHEDULING_PROFILE:QI,STATUS_DETAIL:sLe,SUB_ORDER:ST,TALLY:Om,TIE_FORMAT_MODIFICATIONS:ZD,FACTORY:rLe},ZJ=[DF,Yd,GI,PF,vd,xm,Uy,RF,iW,FC,Ef,z1,_m,QI,ST,Om,ZD];function Vpe({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:yn};let e=j1({tournamentRecords:t}),{tournamentIds:i}=e;return i?.length>1?lr({tournamentRecords:t,discover:!0,extension:{name:Uy,value:{tournamentIds:i}}}):{...se}}function Gpe({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:yn};let e=Eo({name:Uy,tournamentRecords:t,discover:!0});return le({result:e,stack:"unlinkTournaments"})}function Qpe({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:be};if(!e)return{error:pT};let i=j1({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:pT};let n;return r.every(a=>{let s=t[a],{extension:o}=Bi({element:s,name:Uy});if(!o)return!0;let l=o?.value?.tournamentIds||[];if(!l?.length||l.length===1&&l.includes(e)||a===e){let d=tW({name:Uy,tournamentRecord:s});return d.error&&(n=d.error),d.success}let c=l.filter(d=>d!==e);o.value={tournamentIds:c};let u=eW({tournamentRecord:s,extension:o});return u.error&&(n=u.error),u.success}),n?{error:n}:{...se}}var jpe={};Fi(jpe,{getLinkedTournamentIds:()=>q1,getTournamentIds:()=>j1});function q1({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:yn}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{let i=t[e],r=i?.tournamentId,{extension:n}=Bi({element:i,name:Uy}),a=(n?.value?.tournamentIds||[]).filter(s=>s!==r);return{[e]:a}}))}}var rW={};Fi(rW,{adHocPositionSwap:()=>Fhe,addAdHocMatchUps:()=>aL,addDrawDefinitionTimeItem:()=>u5,addFinishingRounds:()=>cR,addGoesTo:()=>Cy,addPlayoffStructures:()=>nL,addQualifyingStructure:()=>Ohe,addVoluntaryConsolationStage:()=>Rhe,addVoluntaryConsolationStructure:()=>XW,allPlayoffPositionsFilled:()=>o5,alternateDrawPositionAssignment:()=>Ahe,assignDrawPosition:()=>vme,assignDrawPositionBye:()=>Oc,attachConsolationStructures:()=>hme,attachPlayoffStructures:()=>C5,attachQualifyingStructure:()=>c5,attachStructures:()=>rL,autoSeeding:()=>fje,automatedPlayoffPositioning:()=>qC,automatedPositioning:()=>vR,checkValidEntries:()=>cL,deleteAdHocMatchUps:()=>bme,drawMatic:()=>Z5,findDrawDefinition:()=>M5,generateAdHocMatchUps:()=>uL,generateAdHocRounds:()=>X5,generateAndPopulatePlayoffStructures:()=>U5,generateDrawDefinition:()=>FR,generateDrawMaticRound:()=>$5,generateDrawStructuresAndLinks:()=>O5,generateDrawTypeAndModifyDrawDefinition:()=>F5,generateQualifyingStructure:()=>A5,generateVoluntaryConsolation:()=>Kme,getAssignedParticipantIds:()=>cb,getAvailableMatchUpsCount:()=>sL,getAvailablePlayoffProfiles:()=>IR,getDrawDefinitionTimeItem:()=>DW,getDrawParticipantRepresentativeIds:()=>P5,getDrawStructures:()=>yd,getDrawTypeCoercion:()=>DR,getEligibleVoluntaryConsolationParticipants:()=>D5,getMatchUpsMap:()=>ss,getParticipantIdFinishingPositions:()=>R5,getPositionAssignments:()=>ET,getPositionsPlayedOff:()=>WC,getRandomQualifierList:()=>x5,getSeedingThresholds:()=>t5,getSeedsCount:()=>PR,getStructureSeedAssignments:()=>pu,getTeamLineUp:()=>Ty,getValidGroupSizes:()=>AR,isAdHoc:()=>Yo,isCompletedStructure:()=>Sh,isValidForQualifying:()=>_5,luckyLoserDrawPositionAssignment:()=>uhe,modifyDrawDefinition:()=>mme,modifyDrawName:()=>E5,modifySeedAssignment:()=>She,mutate:()=>zpe,positionActions:()=>k5,pruneDrawDefinition:()=>gme,qualifierDrawPositionAssignment:()=>l5,qualifierProgression:()=>Uhe,query:()=>Sme,removeDrawPositionAssignment:()=>hP,removeRoundMatchUps:()=>Ime,removeSeededParticipant:()=>_he,removeStructure:()=>Dhe,renameStructures:()=>Ehe,resetDrawDefinition:()=>Ame,resetQualifyingStructure:()=>Mhe,resetVoluntaryConsolationStructure:()=>afe,setDrawParticipantRepresentativeIds:()=>qpe,setPositionAssignments:()=>hhe,setStructureOrder:()=>The,setSubOrder:()=>wme,shiftAdHocRounds:()=>fhe,swapAdHocRounds:()=>mhe,swapDrawPositionAssignments:()=>khe,updateTeamLineUp:()=>Gw,withdrawParticipantAtDrawPosition:()=>ihe});var zpe={};Fi(zpe,{adHocPositionSwap:()=>Fhe,addAdHocMatchUps:()=>aL,addDrawDefinitionTimeItem:()=>u5,addPlayoffStructures:()=>nL,addQualifyingStructure:()=>Ohe,addVoluntaryConsolationStage:()=>Rhe,addVoluntaryConsolationStructure:()=>XW,alternateDrawPositionAssignment:()=>Ahe,assignDrawPosition:()=>vme,assignDrawPositionBye:()=>Oc,attachConsolationStructures:()=>hme,attachPlayoffStructures:()=>C5,attachQualifyingStructure:()=>c5,attachStructures:()=>rL,automatedPlayoffPositioning:()=>qC,automatedPositioning:()=>vR,deleteAdHocMatchUps:()=>bme,luckyLoserDrawPositionAssignment:()=>uhe,modifyDrawDefinition:()=>mme,modifyDrawName:()=>E5,modifySeedAssignment:()=>She,pruneDrawDefinition:()=>gme,qualifierDrawPositionAssignment:()=>l5,qualifierProgression:()=>Uhe,removeDrawPositionAssignment:()=>hP,removeRoundMatchUps:()=>Ime,removeSeededParticipant:()=>_he,removeStructure:()=>Dhe,renameStructures:()=>Ehe,resetDrawDefinition:()=>Ame,resetQualifyingStructure:()=>Mhe,resetVoluntaryConsolationStructure:()=>afe,setDrawParticipantRepresentativeIds:()=>qpe,setPositionAssignments:()=>hhe,setStructureOrder:()=>The,setSubOrder:()=>wme,shiftAdHocRounds:()=>fhe,swapAdHocRounds:()=>mhe,swapDrawPositionAssignments:()=>khe,updateTeamLineUp:()=>Gw,withdrawParticipantAtDrawPosition:()=>ihe});var nW=t=>e=>t[e],aW=(t=[])=>t.map(xa).filter(Boolean),Tj=(t=[])=>t.map(ji).filter(Boolean),ji=(t={})=>nW(t)("participantId"),xa=(t={})=>nW(t)("matchUpId"),cP=(t={})=>nW(t)("drawId");function qpe({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:Ec};if(!Array.isArray(t))return{error:be};let i=Tj(e?.entries||[]);return t.length&&Pn(t,i).length<t.length?{error:be}:CF({drawDefinition:e,extension:{name:iW,value:t}})}var ql="ABANDONED",Mw="AWAITING_RESULT",Df="CANCELLED",Ln="COMPLETED",LC="DEAD_RUBBER",Mr="DEFAULTED",ha="DOUBLE_DEFAULT",mn="DOUBLE_WALKOVER",Dd="IN_PROGRESS",Wl="INCOMPLETE",sW="NOT_PLAYED",Fa="RETIRED",jg="SUSPENDED",Rn="TO_BE_PLAYED",Xr="WALKOVER",Wpe=[Mw,Ln,Mr,Dd,Wl,Fa,jg],oW=[Mw,Ln,Mr,mn,ha,Dd,Wl,Fa,jg,Xr],lW=[ql,Mw,"BYE",Df,Ln,LC,Mr,mn,ha,Dd,Wl,sW,Fa,jg,Rn,Xr],cW=["BYE",mn,ha,Ln,Mr,Fa,Xr],uW=[ql,Mw,Df,LC,Dd,Wl,sW,jg,Rn,void 0],qn=[Df,ql,Ln,LC,Mr,mn,ha,Fa,Xr],MF=[ql,Ln,Mr,mn,ha,Dd,Fa,Xr],dW=[Dd,Wl,jg,Rn],pW={ABANDONED:ql,AWAITING_RESULT:Mw,BYE:"BYE",CANCELLED:Df,COMPLETED:Ln,DEAD_RUBBER:LC,DEFAULTED:Mr,DOUBLE_WALKOVER:mn,DOUBLE_DEFAULT:ha,IN_PROGRESS:Dd,INCOMPLETE:Wl,NOT_PLAYED:sW,RETIRED:Fa,SUSPENDED:jg,TO_BE_PLAYED:Rn,WALKOVER:Xr};function Nw(t,e,i){let r=d=>Bi({element:d,name:Ef})?.extension?.value,n=i?.deprioritizeCompleted,a=i?.mode===wpe&&UFe,s=i?.mode===Ipe&&Spe,o=s||a||HI,l=d=>d?.stage===Ut&&d?.stageSequence===1,c=d=>l(d)?-1:o[d?.stage],u=d=>d?.matchUps.every(({matchUpStatus:p})=>qn.includes(p)?1:-1);return n&&u(t)-u(e)||a&&c(t)-c(e)||(t?.stage&&o[t.stage]||0)-(e?.stage&&o[e.stage]||0)||(r(t)||0)-(r(e)||0)||!s&&!a&&(e?.positionAssignments?.length??1/0)-(t?.positionAssignments?.length??1/0)||(t?.stageSequence??0)-(e?.stageSequence??0)||(Ox(t)||0)-(Ox(e)||0)}function Ox(t){return(t?.matchUps||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((n,a)=>n+a,0);return!e||r<e?r:e},void 0)}function ui(t){let e=Gt(t,[{[to]:!0,[bF]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=yd({drawDefinition:i}),a=n?.map(l=>l.structures?[...l.structures].concat(l):l).flat(),s=a?.find(l=>l.structureId===r);if(!s)return{error:nn};let o=s.structureType===gF?a?.find(l=>l.structures?.some(c=>c.structureId===r)):void 0;return{structure:s,containingStructure:o}}function yd({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:s,stage:o}){let l=!e&&Bt||!e?.structures&&nq||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let c=h=>{let m=Bi({element:h,name:Ef})?.extension?.value;return!n||n===m},u=e?.structures?.filter(p).filter(f).filter(c).sort((h,m)=>Nw(h,m,a))??[],d=t?Object.assign({},...mF.map(h=>{let m=u?.filter(A=>A.stage===h);return m?.length&&{[h]:m}}).filter(Boolean)):{};return{structures:u,stageStructures:d};function p(h){return!o&&!Array.isArray(s)||o&&h.stage===o||Array.isArray(s)&&s.includes(h.stage)}function f(h){return!r&&!Array.isArray(i)||r&&h.stageSequence===r||Array.isArray(i)&&i.includes(h.stageSequence)}}function Kpe({drawDefinition:t}){if(!t)return{error:Bt};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=Ir({structure:i}),a=n?.map(ji).filter(Boolean)??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Ir({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:Bt};if({structure:i,error:r}=ui({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>Ir({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=Cue,{positionAssignments:n,error:r}}function va({drawDefinition:t,structureId:e,structure:i}){let r=Ir({drawDefinition:t,structureId:e,structure:i})?.positionAssignments||[],n=r?.filter(c=>c.participantId??c.bye??c.qualifier),a=r&&r?.length===n?.length,s=r?.filter(c=>!c.participantId&&!c.bye&&!c.qualifier),o=r?.filter(c=>!c.participantId&&c.bye),l=r?.filter(c=>!c.participantId&&c.qualifier);return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:s,assignedPositions:n,qualifierPositions:l,byePositions:o}}var fW="addDrawDefinition",NF="addMatchUps",pg="addParticipants",hW="addScaleItems",Ype="addEvent",Xpe="addVenue",wm="audit",mW="dataIssue",AW="deleteParticipants",gW="deleteVenue",vW="deletedDrawIds",yW="deletedMatchUpIds",bW="modifyDrawDefinition",Zpe="modifyDrawEntries",Jpe="modifyEventEntries",IW="modifyMatchUp",Fs="modifyParticipants",wW="modifyPositionAssignments",SW="modifySeedAssignments",rb="modifyTournamentDetail",cA="modifyVenue",uP="mutations",Cj="publishEvent",efe="publishEventSeeding",tfe="publishOrderOfPlay",ife="publishParticipants",UW="unPublishEvent",TW="unPublishEventSeeding",CW="unPublishOrderOfPlay",oLe="unPublishParticipants",BF="updateInContextMatchUp",rfe={ADD_DRAW_DEFINITION:fW,ADD_MATCHUPS:NF,ADD_PARTICIPANTS:pg,ADD_SCALE_ITEMS:hW,ADD_EVENT:Ype,ADD_VENUE:Xpe,AUDIT:wm,DATA_ISSUE:mW,DELETE_PARTICIPANTS:AW,DELETE_VENUE:gW,DELETED_DRAW_IDS:vW,DELETED_MATCHUP_IDS:yW,MODIFY_DRAW_DEFINITION:bW,MODIFY_DRAW_ENTRIES:Zpe,MODIFY_EVENT_ENTRIES:Jpe,MODIFY_MATCHUP:IW,MODIFY_PARTICIPANTS:Fs,MODIFY_POSITION_ASSIGNMENTS:wW,MODIFY_SEED_ASSIGNMENTS:SW,MODIFY_TOURNAMENT_DETAIL:rb,MODIFY_VENUE:cA,MUTATIONS:uP,PUBLISH_EVENT_SEEDING:efe,PUBLISH_EVENT:Cj,PUBLISH_ORDER_OF_PLAY:tfe,PUBLISH_PARTICIPANTS:ife,UNPUBLISH_EVENT_SEEDING:TW,UNPUBLISH_EVENT:UW,UNPUBLISH_ORDER_OF_PLAY:CW,UPDATE_INCONTEXT_MATCHUP:BF};function kF(t,e){if(!t)return{error:Bt};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let r=new Date(i).toISOString(),n=e?.filter(Boolean);return t.updatedAt=r,t.structures?.filter(Boolean).forEach(a=>{(!n?.length||n?.includes(a.structureId))&&(a.updatedAt=r)}),{...se}}function fg({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&kF(t),bi({payload:{matchUps:i,tournamentId:e,eventId:r},topic:NF}),{...se}}function $h({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&kF(t),bi({topic:yW,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)Mq({key:a});return{...se}}function Yi({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&Br({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),bi({topic:IW,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...se}):(console.log(Wo),{error:Wo})}function lLe({tournamentId:t,inContextMatchUp:e}){return e?(bi({payload:{inContextMatchUp:e,tournamentId:t},topic:BF,key:e.matchUpId}),{...se}):{error:Wo}}function W1({tournamentId:t,eventId:e,drawDefinition:i}){return i?(kF(i),bi({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:fW,key:i.drawId}),{...se}):(console.log(Bt),{error:Bt})}function cLe({tournamentId:t,eventId:e,drawId:i}){return bi({payload:{drawId:i,tournamentId:t,eventId:e},topic:vW,key:i}),Mq({key:i}),{...se}}function Br({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(kF(t,i),bi({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:bW,key:t.drawId}),{...se}):{error:Bt}}function nfe({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:Bt};if(!i)return{error:Jy};let n=i.seedAssignments,a=i.structureId,s=t.drawId;return bi({payload:{tournamentId:e,eventId:r,drawId:s,structureId:a,seedAssignments:n},topic:SW,key:t.drawId}),Br({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...se}}function Fm({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:Bt};if(!i)return{error:Jy};let n=Ir({structure:i}),a=i.structureId,s=t.drawId,o=r?.eventId;return bi({topic:wW,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:o,drawId:s},key:a}),Br({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:o}),{...se}}function afe({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){if(!e)return{error:Bt};let n=e.structures?.find(s=>s.stage===Ya);if(!n)return{error:nn};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],$h({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(s=>s.entryStage!==Ya)),Br({tournamentId:t?.tournamentId,eventId:r?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...se}}function EW({drawPositions:t,structure:e}){if([zt,Ut].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=Ir({structure:e});i?.filter(({drawPosition:r})=>t?.includes(r))?.forEach(r=>{lr({element:r,extension:{name:PF,value:!0}})})}function K1(t){let{appliedPolicies:e,positionAction:i,drawDefinition:r}=t;if(e?.audit?.[YU]===!1)return;let{extension:n}=Bi({name:YU,element:r}),a=Array.isArray(n?.value)?n?.value??[]:[];if(!a?.length){let o=r.structures.find(l=>l.stage===Ut);if(o){let l=Ir({structure:o}).positionAssignments?.map(({drawPosition:c,participantId:u,bye:d,qualifier:p})=>({drawPosition:c,participantId:u,qualifier:p,bye:d}));a.push({name:"initialMainAssignments",initialAssignments:l})}}let s={value:a.concat(i),name:YU};lr({element:r,extension:s})}function $C({tournamentRecord:t,drawDefinition:e,event:i}){let r=(t?.events||i&&[i])?.map(o=>o?.drawDefinitions).flat().filter(Boolean)||e&&[e]||[],n={},a={},s=r.map(o=>o?.structures?.filter(l=>l?.structures)).flat().filter(Boolean);for(let o of s){let{structures:l,structureId:c}=o??{};l&&c&&(n[c]=l?.map(u=>u.structureId))&&l.forEach(u=>a[u.structureId]=o?.structureId)}return{containedStructures:n,containerStructures:a}}function xF(t){let{sides:e,matchUpType:i}=t||{},r=t.potentialParticipants?.length?t.potentialParticipants.flat().map(a=>i===yr?a?.individualParticipantIds||[]:a.participantId).flat():[],n=(e||[]).map(a=>i===yr&&(a?.participant?.individualParticipantIds||[])||a?.participantId&&[a.participantId]||[]).flat();return{individualParticipantIds:n.concat(r).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:r}}function vu(t){return t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var Y1="SIGN_IN_STATUS",sfe="SIGNED_OUT",dP="SIGNED_IN",zo="TEAM",zi="INDIVIDUAL",xc="GROUP",Mi="PAIR",gr="TEAM",XU={TEAM_PARTICIPANT:zo,INDIVIDUAL:zi,GROUP:xc,TEAM:gr,PAIR:Mi},io={INDIVIDUAL:zi,GROUP:xc,PAIR:Mi,TEAM:gr,SIGN_IN_STATUS:Y1,SIGNED_OUT:sfe,SIGNED_IN:dP};function _F({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?St(e,t?.convertExtensions,!0):e,a=n.filter(l=>l.participantType===gr),s=n.filter(l=>l.participantType===xc),o=n.filter(l=>l.participantType===Mi);return n.forEach(l=>{if(l.participantType===zi){let{participantId:c}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(u=>{(u?.individualParticipantIds||[]).forEach(d=>{d===c&&!l.teamParticipantIds?.includes(u.participantId)&&(l.teamParticipantIds.push(u.participantId),r.get(u.participantId)||r.set(u.participantId,{participantName:u.participantName,participantId:u.participantId}),l.teams.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId,teamId:u.teamId}))})}),o.forEach(u=>{(u?.individualParticipantIds||[]).forEach(d=>{d===c&&!l.pairParticipantIds.includes(u.participantId)&&l.pairParticipantIds.push(u.participantId)})}),s.forEach(u=>{(u?.individualParticipantIds||[]).forEach(d=>{d===c&&!l.groupParticipantIds.includes(u.participantId)&&(l.groupParticipantIds.push(u.participantId),l.groups.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}function ofe(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function uLe(t){let e=Object.assign({},...ng.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return ofe(e[t])}var ng=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function lfe({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n?.map(({person:o})=>o)].flat().filter(Boolean);function s(o){let{nationalityCode:l}=o||{};if(l){let c=ng.find(({iso:u})=>u===l);i&&c?.ioc&&!o.iocNationalityCode&&(o.iocNationalityCode=c.ioc),e&&c?.iso2&&!o.iso2NationalityCode&&(o.iso2NationalityCode=c.iso2),c?.label&&!o.countryName&&(o.countryName=c.label)}}a.forEach(s)}function dLe({participantMap:t,template:e}){let i=Object.values(t);for(let r of i){let n=r.participant;if(n.individualParticipantIds?.length){n.individualParticipants=[];for(let a of n.individualParticipantIds){let s=t[a].participant;n.individualParticipants.push(e?VI({template:e,source:s}):s)}}}}function zg(t){let{tournamentRecord:e,participantId:i}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let n of Object.values(r)){let a=n.participants?.find(s=>s.participantId===i);if(a)return{participant:a,tournamentId:n.tournamentId}}return{error:On}}function cfe(t){let{tournamentRecord:e,participantId:i}=t;if(i){let n=zg({tournamentRecord:e,participantId:i});return n.participant??n}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Kt}}function yu(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=cfe(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:be,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:Iq};let a=n.timeItems.filter(o=>o?.itemType===r).filter(o=>!i?.length||i.some(l=>o?.itemSubTypes?.includes(l))).sort((o,l)=>{let c=new Date(o.createdAt||void 0).getTime(),u=new Date(l.createdAt||void 0).getTime();return c-u}),s=St(a.pop(),!1,!0);if(s){let o={timeItem:s,...se};return e&&Object.assign(o,{previousItems:a}),o}else return{info:ts}}function DW({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:fp};if(!e.timeItems)return{info:ts};let{timeItem:n,previousItems:a,info:s}=yu({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function X1({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:Vr};if(!r.timeItems)return{info:ts};let{timeItem:n,previousItems:a,info:s}=yu({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:s}}function OF({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:rt};if(!e.timeItems)return{info:ts};let{timeItem:n,previousItems:a,info:s}=yu({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function PW({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:rt};if(!i)return{error:ga};let a=zg({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:s}=a;if(!s?.timeItems)return{info:ts};let{timeItem:o,previousItems:l,info:c}=yu({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return o&&{timeItem:o,previousItems:l}||{info:c}}var pLe={[xc]:"groupParticipantIds",[Mi]:"pairParticipantIds",[gr]:"teamParticipantIds"},fLe={[xc]:"groups",[gr]:"teams"};function ufe({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,withGroupings:a,internalUse:s,withISO2:o,withIOC:l}){let c=[],u={};for(let p of i.participants??[]){let f=p?.participantId;f&&ALe({participantMap:u,participantId:f})}for(let p of i.participants??[]){let f=St(p,e,s),{participantId:h,individualParticipantIds:m,participantType:A}=f;if(!u[h]){c.push(h);continue}if(Object.assign(u[h].participant,f),m){let g=mLe({individualParticipantIds:m,participantCopy:f,participantMap:u,participantType:A,participantId:h});g.missingParticipantIds.length&&c.push(...g.missingParticipantIds)}if(r&&(u[h].participant.signedIn=hLe(f)),n){let{ratings:g,rankings:v,seedings:b}=_C({participant:f});u[h].participant.seedings=b,u[h].participant.rankings=v,u[h].participant.ratings=g}(l||o)&&lfe({participant:u[h].participant,withISO2:o,withIOC:l})}if(t){let p=Ki(t)?t:void 0;dLe({participantMap:u,template:p})}let d;return a&&(d=_F({participants:Object.values(u).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:c,participantMap:u,groupInfo:d}}function hLe(t){let{timeItem:e}=yu({itemType:Y1,element:t});return e?.itemValue===dP}function mLe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){let a=[];for(let s of t){let o=i[s]?.participant;if(!o){a.push(s);continue}if(o[pLe[r]].push(n),[gr,xc].includes(r)){let{participantRoleResponsibilities:l,participantOtherName:c,participantName:u,participantId:d,teamId:p}=e,f=fLe[r];o[f].push({participantRoleResponsibilities:l,participantOtherName:c,participantName:u,participantId:d,teamId:p})}if(r===Mi){let l=t.find(c=>c!==s);i[s].pairIdMap[n]=l,i[s].pairIdMap[l]=n}}return{missingParticipantIds:a}}function ALe({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[Er]:{...i},[yr]:{...i},[gr]:{...i},...i}}}function nb({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){if(e)return ufe({...t,...r,tournamentRecord:i});let a=St(i.participants,!1,!0)||[];(t?.withIOC||t?.withISO2)&&a.forEach(o=>lfe({participant:o,...t}));let s;if((n||t?.withGroupings)&&a?.length&&({participantsWithGroupings:a,groupInfo:s}=_F({participantsProfile:t,deepCopy:!1,participants:a})),t?.withScaleValues&&a?.length)for(let o of a){let{ratings:l,rankings:c}=_C({participant:o});o.rankings=c,o.ratings=l}return{participants:a,groupInfo:s}}function er({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:cq};let s={};return i&&o(i),a&&o(a),r&&o(r),n&&o(n),{appliedPolicies:s,...se};function o(l){let c=l?.extensions?.find(u=>u.name===lP)?.value;if(c)for(let u of Object.keys(c))(t?e.includes(u):!e.length||e.includes(u))&&(s[u]=St(c[u],!1,!0))}}function uA({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:cq};let{appliedPolicies:a}=er({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),s={};for(let o of t){let l=a?.[o];l&&(s[o]=l)}return Object.keys(s).length?{policyDefinitions:s}:{info:B1.message}}var dfe="WALKOVER",JJ="RETIRED",RW="COMPETITIVE",pP="ROUTINE",fP="DECISIVE",Tk="winRatio",gLe={[fm]:{policyName:"Competitive Bands Default",profileBands:{[fP]:20,[pP]:50}}},MW=gLe;function dA({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let s=uA({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let o=t?.[fm]??s?.[fm]??MW[fm];a.policies[fm]=o}return a}function ab({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:rt};let{appliedPolicies:a}=er({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a?.[i]?{policy:a[i]}:{info:B1?.message}}function Z1({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){e=e??r?.category?.categoryName??r?.category?.ageCategoryCode,i=i??r?.category?.categoryType??r?.category?.subType;let{policy:n}=ab({policyType:Vg,tournamentRecord:t,event:r}),a=(t?Bi({element:t,name:_m}).extension:void 0)?.value,s=(r&&Bi({name:_m,element:r}).extension)?.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:s,categoryName:e,categoryType:i,policy:n}}}function NW({drawDefinition:t,attributes:e}){let{extension:i}=Bi({element:t,name:_x}),r=i?.value||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:_x,value:r},CF({drawDefinition:t,extension:i}),{entryProfile:r}}function J1({drawDefinition:t}){let{extension:e}=Bi({element:t,name:_x});return{entryProfile:e?.value||{}}}var rd="ALTERNATE",eR="CONFIRMED",Il="DIRECT_ACCEPTANCE",tR="FEED_IN",iR="JUNIOR_EXEMPT",Lm="LUCKY_LOSER",rR="ORGANISER_ACCEPTANCE",nR="QUALIFIER",vLe="REGISTERED",aR="SPECIAL_EXEMPT",bu="UNGROUPED",sb="UNPAIRED",UT="WILDCARD",Ih="WITHDRAWN",Ck=[eR,Il,iR,rR,aR],pfe=[tR,Lm,nR],ob=[eR,Il,tR,iR,rR,aR,UT],Pd=[eR,Il,iR,Lm,nR,rR,aR,UT],ffe=[rd,eR,Il,tR,iR,Lm,rR,nR,vLe,aR,bu,sb,UT,Ih],Iu={ALTERNATE:rd,CONFIRMED:eR,DIRECT_ACCEPTANCE:Il,DIRECT_ENTRY_STATUSES:ob,DRAW_SPECIFIC_STATUSES:pfe,EQUIVALENT_ACCEPTANCE_STATUSES:Ck,FEED_IN:tR,JUNIOR_EXEMPT:iR,LUCKY_LOSER:Lm,ORGANISER_ACCEPTANCE:rR,QUALIFIER:nR,SPECIAL_EXEMPT:aR,STRUCTURE_SELECTED_STATUSES:Pd,UNGROUPED:bu,UNPAIRED:sb,VALID_ENTRY_STATUSES:ffe,WILDCARD:UT,WITHDRAWN:Ih};function BW({stage:t,drawDefinition:e}){let{entryProfile:i}=J1({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&mF.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return NW({drawDefinition:e,attributes:n}),!0}return r}function yLe({stage:t,drawDefinition:e}){let{entryProfile:i}=J1({drawDefinition:e});return i[t]?.alternates||0}function bLe({stage:t,drawDefinition:e}){let{entryProfile:i}=J1({drawDefinition:e});return i[t]?.wildcardsCount||0}function Ej({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function Bw({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:s,stages:o,stage:l}){let c=i.entries?.reduce((u,d)=>{let p=Bi({name:Ef,element:d})?.extension?.value,f=l&&d.entryStage===l||o?.length&&d.entryStage&&o.includes(d.entryStage),h=!n||d.entryStatus&&n.includes(d.entryStatus),m=d.entryStageSequence??1;return f&&(!r||m===r)&&h&&(!s||!p||s===p)?u.concat(d):u},[])??[];if(a&&l===Tn){let{playoffEntries:u,error:d}=ILe({provisionalPositioning:t,drawDefinition:i,structureId:a});return d&&console.log("playoff entries error"),(u?.length?u:c).filter(p=>!e||p.placementGroup===e)}return c}function ILe({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===mh&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:s}=n.source,{structure:o}=ui({drawDefinition:e,structureId:s});o?.structureType===Ao&&(o.structures??[]).forEach(l=>{let c=l.positionAssignments??[],{structureId:u}=l,d=u,p=Object.assign({},...c.map(m=>{let{participantId:A}=m,g=Bi({element:m,name:Om}).extension?.value;return g&&A?{[A]:g}:void 0}).filter(Boolean)),f=Object.keys(p).reduce((m,A)=>{let g=p[A],v=g.groupOrder||t&&g.provisionalOrder;return m.includes(v)||m.push(v),m},[]).length===Object.keys(p).length,h=Object.keys(p).filter(m=>{let A=p[m],g=A.groupOrder||t&&A.provisionalOrder;return a?.includes(g)});(!t||f)&&h.forEach(m=>{let A=p[m],{groupOrder:g,provisionalOrder:v,GEMscore:b}=A,y=g||t&&v,I=[...a??[]].sort(la).indexOf(y)+1;r.push({entryStage:Tn,entryStatus:tR,placementGroup:I,groupingValue:d,participantId:m,GEMscore:b})})})}return{playoffEntries:r}}function wLe({stage:t,drawDefinition:e}){return ob.reduce((i,r)=>(Ej({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function pu({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){let a,s=[];n||({structure:n,error:a}=ui({drawDefinition:i,structureId:r}));let o=Ir({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:nn};r||(r=n.structureId);let{stage:l,stageSequence:c}=n,u=l===Tn&&i&&Bw({provisionalPositioning:t,drawDefinition:i,stageSequence:c,structureId:r,stage:l}),d=u?u.filter(h=>h.placementGroup===1).sort((h,m)=>h.GEMscore<m.GEMscore&&1||h.GEMscore>m.GEMscore&&-1||0).map((h,m)=>{let A=m+1;return{participantId:h.participantId,seedValue:A,seedProxy:!0,seedNumber:A}}):[],p=d?.slice(0,e?d.length:o.length/2);p.length?s=p:n.seedAssignments?s=n.seedAssignments:a=Aue;let f=n.seedLimit??n?.positionAssignments?.length;return{seedAssignments:s,stageSequence:c,seedLimit:f,stage:l,error:a}}function Rp(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function JD({item:t,drawDefinition:e,structure:i,event:r}){if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:e.tieFormats?.find(a=>t.tieFormatId===a.tieFormatId)||(r.tieFormat?r.tieFormat:r.tieFormats?.find(a=>t.tieFormatId===a.tieFormatId));if(i?.tieFormat)return i.tieFormat;if(i?.tieFormatId){let n=e.tieFormats?.find(a=>i.tieFormatId===a.tieFormatId);if(n)return n}}}function uo({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:JD({item:i,drawDefinition:t,structure:e,event:r})||JD({item:e,drawDefinition:t,structure:e,event:r})||Rp(t)||Rp(r)}}function SLe({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function ss({drawDefinition:t,structure:e}){let i={},r=[];return(t?.structures??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:s,structures:o}=n,l=Array.isArray(o);if(l)l&&o.forEach(c=>{let{structureName:u}=c,d=c.matchUps;i[c.structureId]={matchUps:d,itemStructureIds:[],structureName:u},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(c.structureId)});else{let c=s;i[a]={matchUps:c,itemStructureIds:[]},c?.forEach(u=>{r.push(u),u.tieMatchUps&&r.push(...u.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function hg({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=e?.mappedMatchUps??t;let n=t[i],a=(n?.itemStructureIds||[]).map(s=>{let{matchUps:o,structureName:l}=t[s];return r?o.map(c=>Object.assign(St(c,!0,!0),{containerStructureId:i,structureId:s,structureName:l})):o}).flat();return(n?.matchUps||[]).concat(...a)}function hfe({groupedOrder:t,roundPositionsCount:e}){if(!t||t?.length<=e)return t;let i=Oa(t,t.length/e).map(n=>n.reduce((a,s)=>a+s)),r=i.slice().sort(la);return i.map(n=>r.indexOf(n)+1)}function FF(t){if(!Ki(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>yi(a)||a===void 0||a===null);return r&&n}function wu(t){return Array.isArray(t)?t.every(FF):!1}function ULe(t,e){return e?.find(i=>t.includes(i))}function ko({matchUps:t=[],interpolate:e}){if(!wu(t))return{roundMatchUps:[],error:be};let i=t.reduce((d,p)=>{let f=typeof p.roundNumber=="string"?ri(p.roundNumber):p.roundNumber;return!p.roundNumber||d.includes(f)?d:d.concat(f)},[]).sort(la).map(d=>{let p=t.filter(m=>m.roundNumber===d),f=p.find(({matchUpType:m})=>m===$r)?p.filter(({matchUpType:m})=>m===$r):p,h=m=>m.sort((A,g)=>la(A.roundPosition,g.roundPosition));return{[d]:h(f)}}),r=t.reduce((d,p)=>{let f=typeof p.roundNumber=="string"?ri(p.roundNumber):p.roundNumber;return d[f]||(d[f]=Ft({abbreviatedRoundName:p.abbreviatedRoundName,finishingRound:p.finishingRound,roundName:p.roundName})),d},{}),n=Object.assign({},...i);if(e){let d=Math.max(...Object.keys(n).map(f=>ri(f)).filter(f=>!Number.isNaN(f))),p=n[d]?.length;if(p>1&&rp(p)){let f=d+1,h=f+p/2;gt(f,h).forEach((m,A)=>{n[m]=gt(0,p/(2+A*2)).map(()=>({}))})}}let a=0,s=Object.assign({},...Object.keys(n).map(d=>{let p=n[d]?.length,f=n[d]?.filter(m=>!qn.includes(m.matchUpStatus)&&!m.score?.scoreStringSide1)?.length,h=p&&p===f;return a=Math.max(a,p),{[d]:{matchUpsCount:p,inactiveCount:f,inactiveRound:h}}})),o=0,l=0,c=Object.keys(n).map(d=>ri(d)).filter(d=>!Number.isNaN(d));c.forEach(d=>{let p=n[d].sort((h,m)=>h.roundPosition-m.roundPosition),f=p.flatMap(h=>h?.drawPositions||[]);if(s[d].roundNumber=d,s[d].roundFactor=s[d].matchUpsCount?a/s[d].matchUpsCount:1,s[d].finishingRound=r[d]?.finishingRound,s[d].roundName=r[d]?.roundName,s[d].abbreviatedRoundName=r[d]?.abbreviatedRoundName,s[d].finishingPositionRange=n[d]?.[0]?.finishingPositionRange,d===1||!s[d-1]){let h=f.sort(la),m=Oa(h,2);s[d].drawPositions=h,s[d].pairedDrawPositions=m}else{let h=s[d-1],m=h.drawPositions,A=h.matchUpsCount/s[d].matchUpsCount,g=Oa(m,A),v=p.map(b=>{let{roundPosition:y}=b,I=[...b.drawPositions||[],void 0,void 0].slice(0,2);if(!y)return I;let w=I?.filter(Boolean)||[];if(!w?.length)return[void 0,void 0];if(d<3&&w?.length===2)return I?.slice().sort(la);let S=Pn(m,w).length!==w?.length;if(w?.length&&S)return w?.length===1?[w[0],void 0]:I?.slice().sort(la);let T=(y-1)*2;return g.slice(T,T+2).map(D=>ULe(D,w))});s[d].drawPositions=v?.flat(),s[d].pairedDrawPositions=v}s[d+1]?.matchUpsCount===s[d].matchUpsCount&&(s[d+1].feedRound=!0,s[d+1].feedRoundIndex=l,s[d].preFeedRound=!0,l+=1),s[d]&&!s[d].feedRound&&(s[d].roundIndex=o,o+=1)});let u=!!Object.values(s).some(({matchUpsCount:d})=>!rp(d));return{hasNoRoundPositions:t.some(d=>!d.roundPosition),roundsNotPowerOf2:u,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:c,roundProfile:s,...se}}function Ek(t){if(!Array.isArray(t))return"";let e=t.filter(Sn);return e.length?Ci([Math.min(...e),Math.max(...e)]).join("-"):""}function TLe({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:Bt};if(!e)return{error:Bc};let{structure:r}=ui({drawDefinition:t,structureId:e});if(r?.stage!==Os)return{error:eb,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=n?.filter(d=>d.target.structureId===e)||[],s=a?.reduce((d,p)=>{let{structureId:f}=p.source;return d.includes(f)?d:d.concat(f)},[])||[],o=Object.assign({},...s.map(d=>{let p=hg({structureId:d,matchUpsMap:i}),f=ko({matchUps:p}).roundProfile;return{[d]:f}})),l=hg({matchUpsMap:i,structureId:e}),{roundProfile:c}=ko({matchUps:l}),u={};return a?.forEach(d=>{let{structureId:p,roundNumber:f}=d.source,{feedProfile:h,groupedOrder:m,positionInterleave:A,roundNumber:g}=d.target,v=o[p],b=v[1]?.drawPositions,y=v[f]?.matchUpsCount;if(!y)return;let I=y?b.length/y:0,w=b.length/I,S=b.slice(),T=hfe({roundPositionsCount:w,groupedOrder:m}),D=T?.length||1;if(D<=w){let P=b.length/D,R=Oa(S,P);h===Iy&&R.forEach(M=>M.reverse()),S=T?.length&&T?.map(M=>R[M-1]).flat()||R.flat()}let C=Oa(S,I);if(A){let P=gt(0,A.interleave).map(()=>{}),R=gt(0,A.offset).map(()=>{});C=C.map(N=>[N,...P]),C.unshift(R),C=C.flat(1);let M=C.length-A.offset;C=C.slice(0,M)}u[g]||(u[g]={});let E=c?.[g]?.feedRound?2:1;C.forEach((P,R)=>{let M=1+R*E;u[g][M]||(u[g][M]=Ek(P))})}),{sourceDrawPositionRanges:u}}function mfe({drawDefinition:t}){if(typeof t!="object")return{error:AI};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((s,o)=>{let{stage:l}=o;return s[l]?s[l].push(o):s[l]=[o],s},{});for(let s of Object.keys(n)){let o=n[s].find(({stageSequence:c})=>c===1);if(!o)continue;let{structureId:l}=o;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:s})}return{exitProfiles:e};function a({exitProfiles:s,exitProfile:o,structureId:l,targetRound:c,aggregator:u,stage:d}){s[l]||(s[l]=[]),o==="0"&&[Os,Tn].includes(d)||s[l].push(o);let p=r.filter(f=>f.source.structureId===l&&f.source.roundNumber>=c);for(let f of p){let h=f.source.roundNumber,m=f.target.roundNumber,A=f.target.structureId,g=i.find(b=>b.structureId===A).stage,v=[g,A,m,h].join("|");if(u[v])return;u[v]=!0,a({exitProfile:`${o}-${h}`,structureId:A,exitProfiles:s,targetRound:m,aggregator:u,stage:g})}}}function CLe({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){if(!t)return{error:Bt};if(!i)return{error:Bc};if(!e){let s=hg({matchUpsMap:r,structureId:i});if({roundProfile:e}=ko({matchUps:s}),!e)return{error:Kt}}let n=(Math.min(...e?.[1]?.drawPositions??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{let o=e?.[s]?.matchUpsCount,l=e?.[1]?.drawPositions??[],c=Oa(l,l.length/o),u=c.map(Ek),d=c.map(A=>A.map(g=>g-n)).map(Ek),p=a.map(A=>{if(A>s)return;let g=e?.[A]?.drawPositions??[];return Oa(g,g.length/o)}).filter(Boolean),f=gt(0,o).map(A=>p.map(g=>g[A]).flat().filter(Boolean).sort(la)).map(A=>Ci(A)),h=f.map(A=>J_e(A).map(Ek).join(", ")),m=Object.assign({},...gt(0,o).map(A=>({[A+1]:{firstRoundDrawPositionsRange:u[A],firstRoundOffsetDrawPositionsRange:d[A],possibleDrawPositions:f[A],drawPositionsRange:h[A]}})));return{[s]:m}}))}}function kW({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){if(!i)return!1;r=r??i.matchUps??[],t=t??ko({matchUps:r}).roundsNotPowerOf2;let n=!!i.positionAssignments?.find(({drawPosition:a})=>a)||!!r?.find(({drawPositions:a})=>a?.length);return(!e?.drawType||e.drawType!==ib)&&!i?.structures&&t&&n}function Yo({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!e?.find(n=>n?.roundPosition),r=!!e?.find(n=>n?.drawPositions?.length);return!t?.structures&&t?.stage!==Ya&&(!e.length||!i&&!r)}var xW={[km]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Ut]:"",[Tn]:"P",[zt]:"Q",[Os]:"C"}}},ELe=xW;function Afe({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){let{roundProfile:n,roundMatchUps:a}=ko({matchUps:r}),{structureAbbreviation:s,stage:o}=i,l=Yo({structure:i}),c=kW({structure:i}),u=i.structures,d={},p=xW[km],f=i.stage===zt,h=f?Math.max(...(e?.structures??[]).filter(P=>P.stage===zt).map(({stageSequence:P})=>P??1),0):0,m=(i.stageSequence??1)<h?i.stageSequence??1:"",A=m&&(t?.affixes?.preQualifying||p.affixes.preQualifying)||"",g=t?.roundNamingMap||p.roundNamingMap||{},v=t?.abbreviatedRoundNamingMap||p.abbreviatedRoundNamingMap||{},b=t?.affixes?.preFeedRound||p.affixes.preFeedRound,y=t?.affixes?.roundNumber||p.affixes.roundNumber,I=(t?.namingConventions||p.namingConventions).round,w=o&&o!==Ut?o[0]:"",S=t?.stageConstants||p.stageConstants,T=o&&S?.[o]||w,D=`${A}${T}${m}`,C=n?Object.keys(n):[],E=f&&S?.[zt]?`${S?.[zt]}-`:"";if(u||l||c)Object.assign(d,...C.map(P=>{let R=`${E}${I} ${P}`,M=`${y}${P}`;return{[P]:{roundName:R,abbreviatedRoundName:M}}}));else{let P=f&&(t?.qualifyingFinishMap||p?.qualifyingFinishMap||{});Object.assign(d,...C.map(R=>{if(!n?.[R])return;let{matchUpsCount:M,preFeedRound:N}=n[R],k=M*2,O=P?.[n?.[R].finishingRound]||P&&`${y}${k}`||g[M]||`${y}${k}`,x=N?`-${b}`:"",F=`${O}${x}`,_=[D,s,F].filter(Boolean).join("-"),V=`${v[M]||`${y}${k}`}${x}`,G=[D,s,V].filter(Boolean).join("-");return{[R]:{abbreviatedRoundName:G,roundName:_}}}))}return{roundNamingProfile:d,roundProfile:n,roundMatchUps:a}}var DLe=(t,e)=>(t||0)+(e||0);function gfe(t,e){let i=Array.isArray(t)?t[0]:t;return Number.isNaN(i)&&dfe||i<=e[fP]&&fP||i<=e[pP]&&pP||RW}function vfe({score:t}){let e=t?.sets||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(DLe)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function PLe(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function yfe(t){return t.map(PLe).sort().map(e=>parseFloat(e.toFixed(2)))}function sR({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:Wo};let{score:r,winningSide:n}=i;if(!n)return{error:be};let a=!e&&t&&ab({policyType:fm,tournamentRecord:t}).policy,s=e||a?.profileBands||MW[fm].profileBands,o=vfe({score:r}),l=yfe([o]),c=gfe(l,s),u=Array.isArray(l)?l[0]:l;return{...se,competitiveness:c,pctSpread:u}}function bfe({matchUp:t}){if(!t)return{error:Wo};if(t&&!t.sides)return{error:bl};if(t&&!t.hasContext)return{error:aF};let e=(t.sides??[])?.map(s=>s?.participantId).filter(Boolean),i=t.sides?.filter(s=>s.participant?.participantType===zi).map(s=>s.participantId).filter(Boolean)??[],r=((t.sides??[])?.map(s=>s.participant?.individualParticipants).filter(Boolean)??[]).map(s=>(s??[]).map(o=>o?.participantId).filter(Boolean)),n=[...i,...r.flat()].filter(Boolean)??[],a=Ci(n.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:r,allRelevantParticipantIds:a,individualParticipantIds:n,sideParticipantIds:e,...se}}var Fx="CHECK_IN",Lx="CHECK_OUT",RLe="SCHEDULE",kw="SCHEDULE.ASSIGNMENT.VENUE",wh="SCHEDULE.ALLOCATION.COURTS",mg="SCHEDULE.ASSIGNMENT.COURT",LF="SCHEDULE.COURT.ORDER",xw="SCHEDULE.DATE",MLe="COMPLETED.DATE",_W="HOME_PARTICIPANT_ID",OW="SCHEDULE.ASSIGN.OFFICIAL",_w="SCHEDULE.TIME.SCHEDULED",Qd="SCHEDULE.TIME.START",Sm="SCHEDULE.TIME.STOP",ih="SCHEDULE.TIME.RESUME",$m="SCHEDULE.TIME.END",$F="SCHEDULE.TIME.MODIFIERS",Ife="TO_BE_ANNOUNCED",wfe="NEXT_AVAILABLE",Sfe="FOLLOWED_BY",Ufe="AFTER_REST",Tfe="RAIN_DELAY",NLe="NOT_BEFORE",Dj=[Ife,wfe,Sfe,Ufe,Tfe],BLe="ELIGIBILITY",kLe="REGISTRATION",xLe="SUSPENSION",_Le="MEDICAL",OLe="PENALTY",Cfe="SCALE",Efe="RATING",Dfe="RANKING",FW="SEEDING",qg="PUBLISH",_c="PUBLIC",Wg="STATUS",FLe="MODIFICATION",LLe="RETRIEVAL",$Le="other",HF={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:Dj,AFTER_REST:Ufe,ALLOCATE_COURTS:wh,ASSIGN_COURT:mg,ASSIGN_OFFICIAL:OW,ASSIGN_VENUE:kw,CHECK_IN:Fx,CHECK_OUT:Lx,COMPLETED_DATE:MLe,COURT_ORDER:LF,ELIGIBILITY:BLe,END_TIME:$m,FOLLOWED_BY:Sfe,MEDICAL:_Le,MODIFICATION:FLe,NEXT_AVAILABLE:wfe,NOT_BEFORE:NLe,OTHER:$Le,PENALTY:OLe,PUBLIC:_c,PUBLISH:qg,RANKING:Dfe,RATING:Efe,RAIN_DELAY:Tfe,REGISTRATION:kLe,RESUME_TIME:ih,RETRIEVAL:LLe,SCALE:Cfe,SCHEDULE:RLe,SCHEDULED_DATE:xw,SCHEDULED_TIME:_w,SEEDING:FW,START_TIME:Qd,STATUS:Wg,STOP_TIME:Sm,SUSPENSION:xLe,TIME_MODIFIERS:$F,TO_BE_ANNOUNCED:Ife};function Ow({matchUp:t}){if(!t)return{error:Wo};if(!t.hasContext)return{error:aF};if(!t.sides||t?.sides.filter(Boolean).length!==2)return{error:bl};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=bfe({matchUp:t}),n=(t.timeItems??[]).filter(o=>o?.itemType&&[Fx,Lx].includes(o.itemType)).sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(o=>o.itemValue).filter(o=>n.filter(l=>l?.itemValue===o).reverse()[0].itemType===Fx);e?.forEach((o,l)=>{let c=r?.[l],u=o?.length&&o.every(d=>a.includes(d));c&&u&&!a.includes(c)&&a.push(c)}),r?.forEach((o,l)=>{a.includes(o)&&(e?.[l]??[]).forEach(c=>{c&&!a.includes(c)&&a.push(c)})});let s=r?.reduce((o,l)=>a.includes(l)&&o,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:s,checkedInParticipantIds:a,...se}}var $n=t=>e=>{let i=Ki(e)&&e?.matchUpType||Lr(e)&&e;return i&&qce[t].includes(i)};function e0(t){let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},r=e?.map(({matchUpFormatCodes:a})=>a?.filter(s=>s===i)).flat().filter(Boolean).sort((a,s)=>(a?.length||0)-(s?.length||0))||[],n=r.includes(i)?i:r[0];return e?.find(({matchUpFormatCodes:a,averageTimes:s})=>a?.find(o=>n===o)&&s)?.averageTimes}function t0(t){let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:r}=t||{};return e?.find(({matchUpFormatCodes:n,averageTimes:a,recoveryTimes:s})=>{if(a&&i){let{greaterThan:o=0,lessThan:l=360}=a;if(i>o&&i<l)return!0}return n?.find(o=>o===r)&&s})?.recoveryTimes}function Pfe({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>(a.categoryNames?.length||0)-(n.categoryNames?.length||0)).find(({categoryTypes:n,categoryNames:a})=>!a?.length&&!n?.length||a?.includes(e)||n?.includes(i))).find(Boolean)}function HLe({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:s,policy:o}){let l=e?.matchUpRecoveryTimes&&t0({...e,averageMinutes:i,matchUpFormat:n}),c=t?.matchUpRecoveryTimes&&t0({...t,averageMinutes:i,matchUpFormat:n}),u=o?.matchUpRecoveryTimes&&t0({...o,averageMinutes:i,matchUpFormat:n}),d=[l,c,u,o?.defaultTimes?.recoveryTimes,r?.recoveryTimes];return Pfe({categoryName:a,categoryType:s,timesBlockArray:d})}function VLe({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:s}){let o=a?.matchUpAverageTimes&&e0({...a,matchUpFormat:t}),l=n?.matchUpAverageTimes&&e0({...n,matchUpFormat:t}),c=s?.matchUpAverageTimes&&e0({...s,matchUpFormat:t}),u=[o,l,c,s?.defaultTimes?.averageTimes,r?.averageTimes];return Pfe({categoryName:e,categoryType:i,timesBlockArray:u})}var Rfe="DOUBLES_SINGLES",Mfe="SINGLES_DOUBLES",nd="total",Pj="participantConflict",qA="matchUpConflict",Nfe="courtDoubleBooking",Bfe="ISSUE_IDS",WA="CONFLICT",Dv="WARNING",Rj="ERROR",Mj="ISSUE",Dk="STATE",GLe="BLOCKED",QLe="PRACTICE",jLe="MAINTENANCE",kfe={SINGLES_DOUBLES:Mfe,DOUBLES_SINGLES:Rfe,TOTAL:nd,CONFLICT_MATCHUP_ORDER:qA,CONFLICT_PARTICIPANTS:Pj,CONFLICT_COURT_DOUBLE_BOOKING:Nfe,SCHEDULE_ISSUE_IDS:Bfe,SCHEDULE_CONFLICT:WA,SCHEDULE_WARNING:Dv,SCHEDULE_ERROR:Rj,SCHEDULE_ISSUE:Mj,SCHEDULE_STATE:Dk,BLOCKED:GLe,PRACTICE:QLe,MAINTENANCE:jLe};function oR({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:o}){if(!i)return{error:rt};s=s??o?.eventType??$I;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:c}=Z1({tournamentRecord:i,categoryName:n,categoryType:a,event:o}),u={...c,matchUpFormat:r,categoryType:a,defaultTiming:l};return VF({eventType:s,timingDetails:u})}function VF({timingDetails:t,eventType:e}){let i=VLe(t),r=Object.keys(i?.minutes||{}),n=i?.minutes&&(r?.includes(e)&&i.minutes[e]||i.minutes.default),a=HLe({...t,averageMinutes:n}),s=Object.keys(a?.minutes||{}),o=a?.minutes&&(s?.includes(e)&&a.minutes[e]||a.minutes.default),l=$n($I)(e)?Mfe:Rfe,c=a?.minutes&&(s?.includes(l)&&a.minutes[l]||o);return{averageMinutes:n,recoveryMinutes:o,typeChangeRecoveryMinutes:c}}function mV(t){return t.createdAt?new Date(t.createdAt).getTime():0}function lb({timeItems:t,itemType:e}){let i=t.filter(n=>n&&n.itemType===e).sort((n,a)=>mV(n)-mV(a)).pop(),r=i&&mV(i);return{itemValue:i?.itemValue,timeStamp:r}}function xfe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=lb({timeItems:i?.timeItems||[],itemType:_w});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledTime:r}:e}function Fw({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=lb({timeItems:i?.timeItems||[],itemType:xw});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledDate:r}:e}function Qb(t){if(Bde.test(t)){let e=kq();return new Date(`${e}T${t}`)}else return new Date(t)}function zLe({matchUp:t}){if(!t)return{error:Wo};if(!t.timeItems)return{error:Iq};let e=t.timeItems.filter(r=>[Qd,Sm,ih,$m].includes(r?.itemType)).sort((r,n)=>Qb(r.itemValue).getTime()-Qb(n.itemValue).getTime()),i=e.reduce((r,n)=>{let a,s=n?.itemType?.split("."),o=`SCHEDULE.TIME.${n?.itemType?.startsWith("SCHEDULE.TIME")&&s[2]}`;switch(o){case Qd:a=0;break;case $m:if(r.lastValue&&[Qd,ih].includes(r.lastType)){let l=Qb(n.itemValue).getTime()-Qb(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;case Sm:if([Qd,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let l=Qb(n.itemValue).getTime()-Qb(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;default:a=r.milliseconds;break}return{milliseconds:a,lastType:o,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([Qd,ih].includes(i.lastType)){let r=new Date().getTime()-Qb(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:qLe(i.milliseconds),relevantTimeItems:e}}function qLe(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function WLe({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:e.reduce((r,n)=>{let a=n.itemType===Qd&&n;return a&&(!r||i(a)<i(r))?a:r},void 0)?.itemValue}}function lR(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:be};let n=vu(t);i.venueId||(i.venueId=fr());let a;for(let s of Object.values(n)){let o=KLe({disableNotice:!0,tournamentRecord:s,context:r,venue:i});if(o?.error)return o;a=o.venue}return e||bi({topic:Xpe,payload:{venue:i}}),Ft({...se,venue:a})}function KLe({tournamentRecord:t,disableNotice:e,context:i,venue:r}){return t?r?(t.venues||(t.venues=[]),r.venueId||(r.venueId=fr()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0)?{error:ede}:(i&&lr({element:r,extension:{value:i,name:Hpe}}),t.venues.push(r),{...se,venue:St(r)})):{error:Kt,info:"missing venue"}:{error:rt}}function Hh({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:rt};if(!i)return{error:$g};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(q1({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let s=t[a],o=Hh({tournamentRecord:s,venueId:i});if(o.success&&o.venue)return lR({tournamentRecord:e,venue:o.venue}),{...se,venue:r}}}return r?{...se,venue:r}:{error:tb}}function LW({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=Hh({tournamentRecords:i,tournamentRecord:r,venueId:n});return St(a,t,!0)}function Kg({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:rt};if(!i)return{error:Uw};let r="findCourt",n,a;if((e.venues??[]).forEach(s=>{(s.courts??[]).forEach(o=>{o.courtId===i&&(n=o,a=s)})}),n)return{...se,court:n,venue:a};if(t){let s=(q1({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let o of s){let l=t[o],c=Kg({tournamentRecord:l,courtId:i});if(c.success)return c.venue&&lR({tournamentRecord:e,venue:c.venue}),{...se,court:n,venue:a}}}return le({result:{error:Mm},stack:r})}function $W(t){return St(Kg(t),!1,!0)}function GF({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:rt};if(!i)return{error:Uw};let r=Kg({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:h,notes:m})=>({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:h,notes:m}))(r.court);return{...se,courtInfo:St(n,!1,e)}}function TT(t){let e=Gt(t,[{[Sa]:!0},{venueId:!0,[id]:$g}]);if(e.error)return e;let{tournamentRecord:i,venueId:r}=t,n=Hh({tournamentRecord:i,venueId:r});if(n.error)return n;let a=(n.venue?.courts??[]).map(l=>(({courtInfo:c})=>({...c}))(GF({courtId:l.courtId,internalUse:!0,tournamentRecord:i}))),s=n.venue&&(({venueId:l,venueName:c,venueAbbreviation:u})=>({venueAbbreviation:u,venueName:c,venueId:l}))(n.venue),o=s&&{...s,courtsInfo:a};return{...se,venueData:St(o,!1,!0)}}function YLe({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:e.reduce((r,n)=>{let a=n.itemType===$m&&n;return a&&(!r||i(a)>i(r))?a:r},void 0)?.itemValue}}function Bn({event:t,eventId:e}){if(!t)return{error:Vr};let i=Bi({name:vd,element:t})?.extension,r=e?St(i?.value,!1,!0):i?.value;return e&&t.drawDefinitions?.forEach(n=>{r?.flights?.forEach(a=>{a.drawId===n.drawId&&Object.assign(a,{drawDefinition:n})})}),{flightProfile:r}}function Xo(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},s=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},o=Object.values(s).map(({events:c,tournamentId:u})=>(c&&c.forEach(d=>{a[d.eventId]={tournamentId:u}}),c??[])).flat(),l;if(r){let c,u=o.find(d=>{let p=(d?.drawDefinitions??[]).find(f=>f.drawId===r);if(p)c=p,l=a[d.eventId].tournamentId;else{let f=(d&&Bn({event:d})?.flightProfile)?.flights?.find(h=>h.drawId===r);if(f)return l=a[d.eventId].tournamentId,{entries:f.drawEntries,drawName:f.drawName,tournamentId:l,drawId:r}}return p});if(u)return{event:u,drawDefinition:c,tournamentId:l}}if(i){let c=o.find(u=>u?.eventId===i);if(c)l=a[c.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...le({result:{error:cu},stack:n})};return{event:c,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...le({result:{error:Ec},context:{drawId:r,eventId:i},stack:n})}}function QF(t){let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:r,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:s,scheduleTiming:o,matchUpFormat:l,publishStatus:c,matchUp:u}=t;if(!u)return{error:Wo};if(n&&!u.matchUpType&&!t.matchUpType&&(e||a)&&u.drawId){let I=t.drawDefinition||e?.drawDefinitions?.find(S=>S.drawId===u.drawId);!I&&a&&({drawDefinition:I,event:e}=Xo({drawId:u.drawId,tournamentRecord:a}));let w=u.structureId&&I?.structures?.find(({structureId:S})=>S===u.structureId);i=t.matchUpType||w?.matchUpType||I?.matchUpType||e?.eventType!==ca&&e?.eventType}let{milliseconds:d,time:p}=zLe({matchUp:u}),{startTime:f}=WLe({matchUp:u}),{endTime:h}=YLe({matchUp:u}),m,{eventIds:A,drawIds:g}=r??{};if((!A||A.includes(u.eventId))&&(!g||g.includes(u.drawId))){let I=ie=>ie.createdAt?new Date(ie.createdAt).getTime():0,w=new Map,S=u.timeItems?.toSorted((ie,ue)=>I(ie)-I(ue))??[];for(let ie of S)w.set(ie.itemType,ie.itemValue);let T=w.get(_W),D=w.get(wh),C=w.get(_w),E=w.get($F),P=w.get(xw),R=w.get(OW),M=w.get(LF),N=w.get(kw),k=w.get(mg),O,x,F,_,V,G=u.matchUpType??i;if(o&&C&&n&&G){let ie={matchUpFormat:u.matchUpFormat??l,...o};({averageMinutes:x=0,recoveryMinutes:F=0,typeChangeRecoveryMinutes:_=0}=VF({timingDetails:ie,eventType:G})),(x||F)&&(O=h?ml(qr(h),F):ml(C,x+F)),_&&(V=h?ml(qr(h),_):ml(C,x+_))}!P&&C&&(P=Si(C));let z=Ex({scheduledDate:P,scheduledTime:C}),Q={},j=(a&&N&&TT({tournamentRecord:a,venueId:N}))?.venueData||{};N&&(Q[N]=j);let{venueName:W,venueAbbreviation:Y,courtsInfo:X}=j,J=(k&&X?.find(ie=>ie.courtId===k))?.courtName;for(let ie of D||[]){if(!a)break;ie.venueId&&!Q[ie.venueid]&&(Q[ie.venueId]=TT({venueId:ie.venueId,tournamentRecord:a})?.venueData);let ue=Q[ie.venueId];ie.venueName=ue?.venueName;let ne=ue?.courtsInfo?.find(ge=>ge.courtId===ie.courtId);ie.courtName=ne?.courtName}m=Ft({typeChangeTimeAfterRecovery:V,timeAfterRecovery:O,scheduledDate:P,scheduledTime:C,isoDateString:z,homeParticipantId:T,venueAbbreviation:Y,allocatedCourts:D,timeModifiers:E,venueName:W,venueId:N,courtOrder:M,courtName:J,courtId:k,official:R,typeChangeRecoveryMinutes:_,recoveryMinutes:F,averageMinutes:x,milliseconds:d,startTime:f,endTime:h,time:p})}else m=Ft({milliseconds:d,startTime:f,endTime:h,time:p});let{scheduledDate:v}=Fw({matchUp:u}),{scheduledTime:b}=xfe({matchUp:u});if(s&&c?.displaySettings?.draws){let I=c.displaySettings.draws,w=(I?.[u.drawId]??I?.default)?.scheduleDetails;if(w){let S=(w.find(T=>v&&T.dates?.includes(v))??w.find(T=>!T.dates?.length))?.attributes;if(S){let T=Object.assign({},...Object.keys(m).map(D=>({[D]:!0})),S);m=VI({source:m,template:T})}}}let y=u.matchUpStatus&&qn.includes(u.matchUpStatus)&&(Si(h)||Si(v)||Si(b))||void 0;return{schedule:m,endDate:y}}function XLe({drawPositions:t,roundProfile:e,roundNumber:i}){let r=[void 0,void 0];if(tue(t))return{orderedDrawPositions:r,displayOrder:r};let n=e?.[i],a=n?.pairedDrawPositions?.find(o=>Bo(o||[],t.filter(Boolean)))??r,s=n?.feedRound;if(eue(t)){let o=[...t].sort(la);return{orderedDrawPositions:o.length===2?o:a,displayOrder:s?o:a}}if(s){let o=[t.find(l=>!isNaN(ri(l))),void 0];return{orderedDrawPositions:o,displayOrder:o}}return{orderedDrawPositions:a,displayOrder:a}}function $x({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=o=>o===void 0?-1:o,s=i.map(o=>{let{collectionAssignments:l,participantId:c}=o,u=l?.find(d=>d.collectionPosition===t&&d.collectionId===e);return u&&{participantId:c,...u}}).filter(Boolean).sort((o,l)=>a(o.substitutionOrder)-a(l.substitutionOrder));for(let o of s){let{participantId:l,previousParticipantId:c,substitutionOrder:u}=o;r.includes(l)||(c&&n.push({previousParticipantId:c,substitutionOrder:u,participantId:l}),r=r.filter(d=>d!==c),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function bd({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:rt};if(!Array.isArray(i)||i.length>2)return{error:Fl};if(!i.length)return le({result:{error:Lg},stack:r});t=t??e?.participants??[];let n=t.filter(o=>o.participantType===Mi&&Pn(i,o.individualParticipantIds).length===i.length&&o.individualParticipantIds.length===i.length),a=n[0];if(!a)return le({result:{error:On},stack:r});let s=St(n.slice(1),!1,!0);return{participant:St(a),duplicatedPairParticipants:s,...se}}function Ty({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:Bt};if(typeof e!="string")return{error:ga};let{extension:i}=Bi({element:t,name:xm});return{lineUp:(i?.value||{})[e]}}function ZLe({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:s,sideLineUps:o,matchUpType:l}){if(!s||!i)return{};let c=({attribute:d,lineUp:p,teamParticipant:f})=>{let{assignedParticipantIds:h,substitutions:m}=$x({collectionPosition:i,collectionId:s,lineUp:p});if(l===yr){if(h?.length<=2){let A=n?.[h[0]]?.pairIdMap?.[h[1]],g=(A&&n[A]?.participant||bd({participantIds:h,tournamentParticipants:t}).participant)?.participantId;return{[d]:{participantId:g,teamParticipant:f,substitutions:m}}}else if(h?.length>2)return{[d]:{teamParticipant:f,substitutions:m}}}else{let A=h?.[0];return A&&{[d]:{participantId:A,teamParticipant:f,substitutions:m}}}};if(!r?.length){let d=o?.map(p=>{let{teamParticipant:f,sideNumber:h}=p,m=p.lineUp||Ty({participantId:f.teamParticipantId,drawDefinition:a})?.lineUp;return c({attribute:h,lineUp:m,teamParticipant:f})}).filter(Boolean)||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let u=r?.map(d=>{let p=e.find(A=>A.drawPosition===d)?.participantId,f=o?.find(A=>A?.drawPosition===d),h=f?.teamParticipant||p&&n?.[p]?.participant||t?.find(({participantId:A})=>A===p),m=f?.lineUp||Ty({participantId:p,drawDefinition:a})?.lineUp;return c({attribute:d,lineUp:m,teamParticipant:h})}).filter(Boolean)||{};return{drawPositionCollectionAssignment:Object.assign({},...u)}}function jF(t){let e=Gt(t,[{[Lh]:!0}]);if(e.error)return e;let i=t?.matchUp,r=i?.matchUpType;if(!r&&i?.sides?.length){let n=i.sides.find(({participant:a})=>a)?.participant?.participantType;r=n===zi&&Er||n===Mi&&yr||n===gr&&gr||void 0}return{matchUpType:r}}function JLe({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:s,sideNumber:o}){let l=i.find(f=>f.drawPosition&&f.drawPosition===a),c=a&&t,u=o&&e,d=c?c[a]?.participantId:l?.participantId,p=l?e2e({displaySideNumber:r,seedAssignments:n,participantId:d,assignment:l,sideNumber:o}):{...u?.[o]};if(s&&(o===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&c){let f=c[a]?.teamParticipant,h=c[a]?.participant,m=c[a]?.substitutions;h&&(p.participant=h),m&&(p.substitutions=m),f&&(p.teamParticipant=f)}return p}function e2e({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let s=t2e({seedAssignments:e,participantId:i});Object.assign(a,s,{participantId:i}),s?.seedNumber&&s?.seedValue===""&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function t2e({seedAssignments:t,participantId:e}){return t?.find(i=>!i.seedProxy&&i.participantId===e)}function _fe({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:s,initialRoundOfPlay:o,additionalContext:l,roundNamingProfile:c,tournamentRecord:u,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:f,seedAssignments:h,usePublishState:m,participantMap:A,contextContent:g,scheduleTiming:v,contextProfile:b,drawDefinition:y,publishStatus:I,scoringActive:w,matchUpTieId:S,isRoundRobin:T,roundProfile:D,sideLineUps:C,structure:E,context:P,matchUp:R,event:M}){l=l??{};let N=uo({drawDefinition:y,structure:E,matchUp:R,event:M})?.tieFormat,{roundOffset:k,structureId:O,structureName:x,stage:F,stageSequence:_}=E,{drawId:V,drawName:G,drawType:z}=y??{},Q=N?.collectionDefinitions,j=R.collectionId&&Q?.find(pe=>pe.collectionId===R.collectionId),W=R.collectionId?j?.matchUpFormat:R.matchUpFormat??E?.matchUpFormat??y?.matchUpFormat??M?.matchUpFormat,Y=R.matchUpType||j?.matchUpType||E?.matchUpType||y?.matchUpType||!$n(ca)(M?.eventType)&&M?.eventType,X=f?"BYE":R.matchUpStatus,{schedule:J,endDate:ie}=QF({scheduleVisibilityFilters:t,afterRecoveryTimes:s,tournamentRecord:u,usePublishState:m,scheduleTiming:v,drawDefinition:y,matchUpFormat:W,publishStatus:I,matchUpType:Y,matchUp:R,event:M}),ue=d??R.drawPositions??[],{collectionPosition:ne,collectionId:ge,roundPosition:he}=R,Ie=R.roundNumber??l.roundNumber,xe=ge?ZLe({tournamentParticipants:i,positionAssignments:r,collectionPosition:ne,participantMap:A,drawDefinition:y,drawPositions:ue,collectionId:ge,sideLineUps:C,matchUpType:Y}):void 0,Je=c?.[Ie]?.roundName||l.roundName,qe=c?.[Ie]?.abbreviatedRoundName||l.abbreviatedRoundName,dt=D?.[Ie]?.feedRound,ft=D?.[Ie]?.preFeedRound,je=D?.[Ie]?.roundFactor,Tt=n?.[Ie],Oe=he?Tt?.[he]:void 0,mt=e?.[Ie],Le=j?.category?{...P?.category,...j.category}:P?.category??M?.category,lt=R.processCodes?.length&&R.processCodes||j?.processCodes?.length&&j?.processCodes||E?.processCodes?.length&&E?.processCodes||y?.processCodes?.length&&y?.processCodes||M?.processCodes?.length&&M?.processCodes||u?.processCodes,it=b?.withCompetitiveness&&sR({...g,matchUp:R}),Fe=R.finishingPositionRange??l.finishingPositionRange,Xe=F!==zt&&yi(o)&&o+(Ie||0),ct=pe=>Ft(pe,void 0,!0),We={...ct(P),...ct({matchUpFormat:Y===ca?void 0:W,tieFormat:Y===ca?N:void 0,gender:j?.gender??M?.gender,endDate:R.endDate??ie,discipline:M?.discipline,category:Le,finishingPositionRange:Fe,abbreviatedRoundName:qe,drawPositionsRange:Oe,competitiveProfile:it,structureName:x,stageSequence:_,drawPositions:ue,matchUpStatus:X,processCodes:lt,isRoundRobin:T,matchUpTieId:S,preFeedRound:ft,matchUpType:Y,roundFactor:je,roundOffset:k,structureId:O,roundNumber:Ie,roundOfPlay:Xe,feedRound:dt,roundName:Je,drawName:G,drawType:z,schedule:J,drawId:V,stage:F}),...St(ct(R),!0,!0)};if(W&&R.score?.scoreStringSide1){let pe=vs(W),{bestOf:Se,finalSetFormat:ye,setFormat:ke}=pe??{};(ye?.tiebreakSet||ke?.tiebreakSet||ke?.timed)&&(We.score.sets=We.score.sets.sort((Ce,Ke)=>Ce.setNumber-Ke.setNumber).map((Ce,Ke)=>{let _e=Ke+1===Se&&ye?ye:ke,wt=_e?.tiebreakSet&&!_e?.timed,ut=_e?.timed;return wt?(Ce.tiebreakSet=!0,[1,2].includes(Ce.winningSide)&&(Ce.side1Score=Ce.winningSide===1?1:0,Ce.side2Score=Ce.winningSide===2?1:0)):ut&&(Ce.timed=!0),Ce}))}if(Array.isArray(ue)){let{orderedDrawPositions:pe,displayOrder:Se}=XLe({drawPositions:ue,roundProfile:D,roundNumber:Ie}),ye=D?.[Ie]?.feedRound,ke=Se[0]!==pe[0],Ce=pe.concat(void 0,void 0).slice(0,2).map((Ke,_e)=>{let wt=_e+1,ut=ke?3-wt:wt,Ct=JLe({...xe,positionAssignments:r,displaySideNumber:ut,seedAssignments:h,drawPosition:Ke,isFeedRound:ye,sideNumber:wt}),Gi=R.sides?.find($i=>$i.sideNumber===wt),Wt=he?(he-1)*2+_e+1:void 0,Ji=Wt?mt?.[Wt]:void 0;return ct({sourceDrawPositionRange:Ji,...Gi,...Ct})});Object.assign(We,St({sides:Ce},!0,!0))}if(i&&We.sides){let pe=p?.[OC],Se=ye=>{let ke=A?.[ye]?.participant;return ke&&VI({template:pe?.participant,source:ke})};if(We.sides.filter(Boolean).forEach(ye=>{if(ye.participantId){let ke=St(Se(ye.participantId)||(i?dg({policyDefinitions:p,participantId:ye.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:b}):void 0),void 0,!0);if(ke){let Ce,Ke;if(y?.entries){let _e=y.entries.find(ut=>ut.participantId===ye.participantId),wt=M?.entries?.find(ut=>ut.participantId===ye.participantId);Ce=_e?.entryStatus||wt?.entryStatus,ke.entryStatus=Ce,_e?.entryStage&&(Ke=_e.entryStage,ke.entryStage=Ke)}a===!1?Object.assign(ye,{participant:{entryStage:Ke,entryStatus:Ce}}):Object.assign(ye,{participant:ke})}}if(ye?.participant?.individualParticipantIds?.length&&!ye.participant.individualParticipants?.length){let ke=ye.participant.individualParticipantIds.map(Ce=>Se(Ce)||(i?dg({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:b,participantId:Ce}):void 0));a!==!1&&Object.assign(ye.participant,{individualParticipants:ke})}}),!We.matchUpType){let{matchUpType:ye}=jF({matchUp:We});ye&&Object.assign(We,{matchUpType:ye})}if(b?.inferGender&&(!We.gender||We.gender===Dw)&&We.sides?.length===2&&We.matchUpType!==ca){let ye=We.sides.map(ke=>{if($n(Er)(We.matchUpType))return ke.participant?.person?.sex;if(ke.participant?.individualParticipants?.length===2){let Ce=Ci(ke.participant.individualParticipants.map(Ke=>Ke.person?.sex)).filter(Boolean);if(Ce.length===1)return Ce[0]}});if(ye.filter(Boolean).length===2&&Ci(ye).length===1){let ke=ye[0];We.inferredGender=ke}}}if(We.tieMatchUps){let pe=We.matchUpStatus==="BYE",Se=We.sides?.map(({participant:ye,drawPosition:ke,sideNumber:Ce,lineUp:Ke})=>{let _e=ye?.participantType===ca&&ye;return{teamParticipant:_e&&Ft({participantRoleResponsibilities:_e.participantRoleResponsibilities,participantOtherName:_e.participanOthertName,participantName:_e.participantName,participantId:_e.participantId,teamId:_e.teamId}),drawPosition:ke,sideNumber:Ce,lineUp:Ke}});We.tieMatchUps=We.tieMatchUps.map(ye=>{let ke=We.matchUpId,Ce={finishingPositionRange:We.finishingPositionRange,abbreviatedRoundName:qe,roundNumber:Ie,roundName:Je};return _fe({tieDrawPositions:ue,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:Se,drawPositionsRanges:n,initialRoundOfPlay:o,roundNamingProfile:c,additionalContext:Ce,appliedPolicies:p,isCollectionBye:pe,usePublishState:m,publishStatus:I,matchUpTieId:ke,isRoundRobin:T,roundProfile:D,matchUp:ye,event:M,tournamentParticipants:i,positionAssignments:r,tournamentRecord:u,seedAssignments:h,participantMap:A,contextContent:g,scheduleTiming:v,contextProfile:b,drawDefinition:y,scoringActive:w,structure:E,context:P})})}let ht=We.sides?.filter(pe=>pe?.participantId).length===2,xt=!We.winningSide;if(Object.assign(We,{readyToScore:w&&ht&&xt,hasContext:!0}),ht){let{allParticipantsCheckedIn:pe,checkedInParticipantIds:Se}=Ow({matchUp:We});Object.assign(We,{allParticipantsCheckedIn:pe,checkedInParticipantIds:Se})}return Array.isArray(b?.exclude)&&b?.exclude.forEach(pe=>delete We[pe]),We}function i2e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=lb({timeItems:i?.timeItems||[],itemType:wh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{allocatedCourts:St(r,!1,!0)}:e}function r2e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=lb({timeItems:i?.timeItems||[],itemType:mg});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{courtId:r}:e}function n2e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=lb({timeItems:i?.timeItems||[],itemType:kw});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{venueId:r}:e}function hm(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:s,matchUpFormats:o,roundPositions:l,matchUpFormat:c,collectionIds:u,isMatchUpTie:d,roundNumbers:p,matchUpIds:f,roundNames:h,filterMatchUpTypes:m=!0,filterMatchUpIds:A=!0,stageSequences:g,scheduledDates:v,scheduledDate:b,participantIds:y,processContext:I,tournamentIds:w,matchUpTypes:S,structureIds:T,readyToScore:D,courtIds:C,eventIds:E,venueIds:P,drawIds:R,stages:M}=t,N=Array.isArray(y)?y.filter(Boolean):[],k=Array.isArray(a)?a.filter(Boolean):[],O=Array.isArray(i)?i.filter(Boolean):[],x=Array.isArray(M)?M.filter(Boolean):[],F=Array.isArray(g)?g.filter(Boolean):[],_=Array.isArray(u)?u.filter(Boolean):[],V=Array.isArray(h)?h.filter(Boolean):[],G=Array.isArray(p)?p.filter(Boolean):[],z=Array.isArray(l)?l.filter(Boolean):[],Q=Array.isArray(f)&&A?f.filter(Boolean):[],j=Array.isArray(S)&&m?S.filter(Boolean):[],W=Array.isArray(C)?C.filter(Boolean):[],Y=Array.isArray(P)?P.filter(Boolean):[],X=Array.isArray(o)&&o.filter(Boolean)||typeof c=="string"&&[c]||[],J=Array.isArray(v)&&v.filter(Boolean)||typeof b=="string"&&b.length&&[b]||[],ie=Array.isArray(w)?w.filter(Boolean):[],ue=Array.isArray(E)?E.filter(Boolean):[],ne=Array.isArray(R)?R.filter(Boolean):[],ge=Array.isArray(T)?T.filter(Boolean):[];return e.filter(he=>{if(D&&!$n(Cc)(he)&&!he.readyToScore||he.winningSide&&s&&![1,2].includes(he.winningSide)||d!==void 0&&(d&&!he.tieMatchUps||!d&&he.tieMatchUps)||n!==void 0&&(n&&!he.collectionId||!n&&he.collectionId)||x.length&&!x.includes(he.stage)||F.length&&!F.includes(he.stageSequence)||_.length&&(!he.collectionId||!_.includes(he.collectionId))||V.length&&(!he.roundName||!V.includes(he.roundName))||G.length&&(!he.roundNumber||!G.includes(he.roundNumber))||z.length&&(!he.roundPosition||!z.includes(he.roundPosition))||k.length&&(!he.matchUpStatus||!k.includes(he.matchUpStatus))||O.length&&he.matchUpStatus&&O.includes(he.matchUpStatus)||Q.length&&!Q.includes(he.matchUpId)||j.length&&(!he.matchUpType||!XO(j,he.matchUpType))||X.length&&(!he.matchUpFormat||!X.includes(he.matchUpFormat)))return!1;if(J?.length){let{scheduledTime:Ie}=xfe({matchUp:he}),{scheduledDate:xe}=Fw({matchUp:he}),Je=Si(Ie)||xe;if(!J.find(qe=>hh(qe,Je)))return!1}if(W.length){let{courtId:Ie}=r2e({matchUp:he}),{allocatedCourts:xe}=i2e({matchUp:he}),Je=xe?.map(({courtId:qe})=>qe);if(!W.filter(Boolean).includes(Ie)||Je?.includes(Ie))return!1}if(Y.length){let{venueId:Ie}=n2e({matchUp:he});if(!Y.filter(Boolean).includes(Ie))return!1}if(I){if(ie.length&&!ie.includes(he.tournamentId)||ue.length&&!ue.includes(he.eventId)||ne.length&&!ne.includes(he.drawId)||ge.length&&!ge.includes(he.structureId))return!1;let Ie=he.sides?.map(({participantId:xe})=>xe).filter(Boolean)??[];if(r&&Ie.length<r||N.length&&!N.some(xe=>Ie.includes(xe)))return!1}return!0})}function cr(t){let{provisionalPositioning:e,tournamentRecord:i,contextFilters:r,matchUpFilters:n,contextProfile:a,drawDefinition:s,context:o={},structure:l,inContext:c,event:u}=t,{seedAssignments:d,contextContent:p,exitProfiles:f,matchUpsMap:h}=t,m={},A={};if(!l)return{collectionPositionMatchUps:m,error:Jy,roundMatchUps:A,matchUps:[]};let g=Array.isArray(n?.eventIds)?n?.eventIds.filter(Boolean):[],v=Array.isArray(n?.structureIds)?n?.structureIds.filter(Boolean):[],b=Array.isArray(n?.drawIds)?n?.drawIds.filter(Boolean):[],y=!o?.eventId||!g?.length&&!r?.eventIds?.filter(Boolean).length||g?.includes(o.eventId)||r?.eventIds?.includes(o.eventId),I=!v?.length||v.includes(l.structureId),w=!s||!b?.length||b.includes(s.drawId);if(!y||!I||!w)return{collectionPositionMatchUps:m,roundMatchUps:A,matchUps:[]};a&&!p&&(p=dA({tournamentRecord:i,contextProfile:a,drawDefinition:s}));let{appliedPolicies:S}=er({drawDefinition:s}),T={...t.tournamentAppliedPolicies,...S,...t.policyDefinitions},D=T?.scoring?.structures,C=l.stage&&D?.stage?.[l.stage],E=l.stageSequence&&C?.stageSequence?.[l.stageSequence],P=T?.scoring?.requireAllPositionsAssigned||C?.requireAllPositionsAssigned||E?.requireAllPositionsAssigned;h||(h=ss({drawDefinition:s,structure:l}));let{positionAssignments:R,allPositionsAssigned:M}=va({structure:l}),N=!P||M,{seedAssignments:k}=pu({provisionalPositioning:e,drawDefinition:s,structure:l});d=d??k;let{structureId:O}=l;f=f||s&&mfe({drawDefinition:s}).exitProfiles;let x=f?.[O],F=x?.length&&(x[0].split("-").map(W=>parseInt(W)).reduce((W,Y)=>W+Y)||0),_=!!l.structures,V=hg({matchUpsMap:h,structureId:O,inContext:c}),G=T?.[km],z=Afe({roundNamingPolicy:G,drawDefinition:s,structure:l,matchUps:V}),{roundNamingProfile:Q,roundProfile:j}=z;if(A=z?.roundMatchUps??[],n&&(V=hm({matchUps:V,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),c){let{sourceDrawPositionRanges:W}=TLe({drawDefinition:s,matchUpsMap:h,structureId:O}),Y=s?CLe({drawDefinition:s,roundProfile:j,matchUpsMap:h,structureId:O}).drawPositionsRanges:void 0,X=t.tournamentParticipants,J=t.participantMap;!X?.length&&!J&&i&&({participants:X=[],participantMap:J}=nb({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:i,contextProfile:a,inContext:c})),V=V.map(ie=>_fe({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:W,tournamentParticipants:X,positionAssignments:R,drawPositionsRanges:Y,initialRoundOfPlay:F,roundNamingProfile:Q,tournamentRecord:i,appliedPolicies:T,seedAssignments:d,contextContent:p,participantMap:J,contextProfile:a,drawDefinition:s,scoringActive:N,isRoundRobin:_,roundProfile:j,structure:l,context:o,matchUp:ie,event:u})),(V?.filter(ie=>Array.isArray(ie.tieMatchUps))).forEach(ie=>{let ue=ie.tieMatchUps;V=V.concat(...ue)}),r&&(V=hm({processContext:!0,...r,matchUps:V}))}else(V?.filter(W=>Array.isArray(W.tieMatchUps))).forEach(W=>{let Y=W.tieMatchUps;V=V.concat(...Y)});return n&&(V=hm({matchUps:V,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(n?.matchUpTypes||n?.matchUpIds)&&(V=hm({matchUpTypes:n.matchUpTypes,matchUpIds:n.matchUpIds,matchUps:V})),(n?.matchUpTypes||n?.matchUpIds||c)&&(A=ko({matchUps:V}).roundMatchUps??[]),uo({drawDefinition:s,structure:l,event:u})?.tieFormat&&({collectionPositionMatchUps:m}=SLe({matchUps:V})),{collectionPositionMatchUps:m,roundMatchUps:A,isRoundRobin:_,roundProfile:j,matchUpsMap:h,matchUps:V}}function ty({matchUp:t}){return t?qn.includes(t?.matchUpStatus)||t?.winningSide:!1}function zF({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:c,contextFilters:u,contextContent:d,participantMap:p,scheduleTiming:f,publishStatus:h,contextProfile:m,drawDefinition:A,exitProfiles:g,matchUpsMap:v,structureId:b,inContext:y,structure:I,context:w,event:S}){!I&&b&&({structure:I}=ui({drawDefinition:A,structureId:b}));let T=cr({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:c,contextFilters:u,contextContent:d,participantMap:p,scheduleTiming:f,publishStatus:h,contextProfile:m,drawDefinition:A,exitProfiles:g,matchUpsMap:v,structure:I,inContext:y,context:w,event:S}),D=[],C=[],E=[],P=[],R=[];if(T.error)return T;let{matchUps:M}=T,{assignedPositions:N}=va({structure:I}),k=N?.filter(x=>x.participantId).map(x=>x.drawPosition),O;return M.filter(x=>{let F=c?.matchUpTypes?.length===1&&c.matchUpTypes[0]===$r;return!(x.matchUpType!==$r&&F)}).forEach(x=>{if(x.matchUpStatus===ql){D.push(x);return}x.matchUpType===$r&&(O=!0);let F=!!x.collectionId,_=F&&x.sides?.every(W=>W.participantId),V=!F&&x.drawPositions?.filter(Boolean).length===2,G=!F&&x.drawPositions?.every(W=>k?.includes(W)),z=N?.filter(W=>W.bye).map(W=>W.drawPosition),Q=!F&&x.drawPositions?.find(W=>z?.includes(W)),j=dW.includes(x.matchUpStatus)&&(_||V&&(!t||G));return Q?R.push(x):ty({matchUp:x})?C.push(x):j?E.push(x):P.push(x)}),{includesTeamMatchUps:O,abandonedMatchUps:D,completedMatchUps:C,upcomingMatchUps:E,pendingMatchUps:P,byeMatchUps:R,structure:I}}function a2e({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:Bt};if(!i)return{error:Bc};let{links:r}=HC({drawDefinition:t,structureId:i}),n=r.source.reduce((s,o)=>!o.source.roundNumber||o.source.roundNumber===e?s.concat(o):s,[]),a=r.target.reduce((s,o)=>!o.target.roundNumber||o.target.roundNumber===e?s.concat(o):s,[]);return{links:{source:n,target:a}}}function AV({finishingPositions:t,linkCondition:e,linkType:i,source:r}){let n=r.find(a=>{let s=!a.source?.finishingPositions||!t||Bo(t,a.source?.finishingPositions);return e===a.linkCondition&&s&&a.linkType===i});return[Ah,gh].includes(n?.linkType)&&!n?.source?.roundNumber?le({result:{error:be},stack:"getTargetLink",context:n}):n}function HC({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>(n.source?.structureId===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),n.target?.structureId===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r),{source:[],target:[]})}:{error:Bc}:{error:Bt}}function s2e({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(s=>s.roundNumber===i&&!s.matchUpTieId),a=t.filter(s=>s.roundNumber===i+1&&!s.matchUpTieId);if(a.length){let s;return a.length===n.length?s=a.find(o=>o.roundPosition===r):a.length===n.length/2&&(s=a.find(o=>o.roundPosition===Math.ceil(r/2))),{matchUp:s}}return{message:"no progression found"}}function gV({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){if(!n)return{error:rq};let{target:{structureId:a,feedProfile:s,groupedOrder:o,roundNumber:l,positionInterleave:c}}=n,{structure:u}=ui({drawDefinition:r,structureId:a}),{positionAssignments:d}=Ir({structure:u}),p=(e?.filter(D=>D.structureId===u?.structureId)).filter(D=>D.roundNumber===l&&!D.matchUpTieId),f=p.length,h=gt(1,f+1),m=f/t,A=Math.ceil(m*i),g=1-i%2;if(c?.interleave&&m!==.5){let D=c.offset+(i-1)*c.interleave,C=i+D;A=Math.ceil(C/2),g=1-C%2}let v=h,b=h[A-1],y=hfe({roundPositionsCount:h.length,groupedOrder:o}),I=y?.length||1;if(I<=h.length){let D=f/I,C=Oa(h,D);s===Iy&&C.forEach(E=>E.reverse()),v=y?.length&&y?.map(E=>C[E-1]).flat()||v}s===Xu?b=v[A-1]:s===Iy?((!y?.length||I>h.length)&&(A=p.length+1-A),b=v[A-1]):s===vF&&Gl()&&console.log(Uq,{feedProfile:s});let w=b&&p.reduce((D,C)=>C.roundPosition===b?C:D,void 0),S;w?.feedRound?(g=0,S=Math.min(...(w.drawPositions||[]).filter(Boolean))):S=w?.drawPositions?.length===2&&w?.drawPositions[g];let T=d?.find(({drawPosition:D})=>D===S);if(T){let{extension:D}=Bi({element:T,name:PF});if(D?.value)return{disabledDrawPosition:S}}return{matchUp:w,targetDrawPosition:S,matchUpDrawPositionIndex:g}}function xo({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(o=>o.matchUpId===n));let{structure:s}=ui({structureId:a?.structureId,drawDefinition:r});return s?.finishingPosition===Rw?o2e({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:s,matchUp:a}):l2e({matchUp:a})}function o2e({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){let{winnerMatchUpId:a,loserMatchUpId:s}=n,{links:o}=a2e({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),l=o?.source,c=AV({source:l,linkType:Ah}),u=AV({linkCondition:sf,linkType:gh,source:l}),d=AV({source:l,linkType:gh}),p=u&&d;d||(d=u);let f=c?.target?.feedProfile,h=d?.target?.feedProfile,m=u?.target?.feedProfile,A,g,v,b,y,I,w,S,T,D;if(e&&(a||s)&&(w=a&&f!==Yu&&t.find(({matchUpId:P})=>P===a),b=s&&h!==Yu&&t.find(({matchUpId:P})=>P===s),w||b))return{matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:c},targetMatchUps:{loserMatchUp:b,winnerMatchUp:w}};let{roundPosition:C}=n;D=D||t.filter(P=>P.structureId===r.structureId);let E=D.reduce((P,R)=>R.roundNumber===n.roundNumber&&!R.matchUpTieId?P+1:P,0);return d&&!b&&h!==Yu&&({matchUpDrawPositionIndex:I,targetDrawPosition:y,matchUp:b}=gV({targetLink:d,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:C,drawDefinition:i})),p&&m!==Yu&&({matchUpDrawPositionIndex:v,targetDrawPosition:g,matchUp:A}=gV({targetLink:u,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:C,drawDefinition:i})),c&&!w&&f!==Yu&&({matchUpDrawPositionIndex:T,targetDrawPosition:S,matchUp:w}=gV({targetLink:c,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:C,drawDefinition:i})),w||(D=D||t.filter(P=>P.structureId===r.structureId),{matchUp:w}=s2e({structureMatchUps:D,matchUp:n})),Ft({matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:c,byeTargetLink:u},targetMatchUps:{winnerMatchUpDrawPositionIndex:T,loserMatchUpDrawPositionIndex:I,byeMatchUpDrawPositionIndex:v,winnerTargetDrawPosition:S,loserTargetDrawPosition:y,byeTargetDrawPosition:g,winnerMatchUp:w,loserMatchUp:b,byeMatchUp:A},targetMatchUpIds:!!(a||s)})}function l2e({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function c2e({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{let{matchUpId:n,structureId:a,drawPositions:s=[]}=r,{structure:o}=ui({drawDefinition:t,structureId:a});if(o?.finishingPosition===wy){let{roundNumber:l}=r,c=l&&ri(l)+1,u=o.matchUps??[],{roundMatchUps:d}=ko({matchUps:u});if(c&&d?.[c]){let p=[...s].sort(la).map((f,h)=>{let m=d[c].find(A=>A.drawPositions?.includes(f));return{matchUpId:m?.matchUpId,roundNumber:c,schedule:m?.schedule,sideNumber:h+1,structureName:o.structureName}});Object.assign(r,{sidesTo:p})}}else{let l=xo({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:n}),{winnerMatchUp:c}=l.targetMatchUps,{loserMatchUp:u}=l.targetMatchUps;!r.winnerMatchUpId&&c&&(r.winnerMatchUpId=c.matchUpId),!r.loserMatchUpId&&u&&(r.loserMatchUpId=u.matchUpId);let d=vV({upcomingMatchUp:c}),p=vV({upcomingMatchUp:u});if(r.matchUpStatus!=="BYE"&&u?.matchUpStatus==="BYE"){let{matchUp:h}=Ofe({matchUp:u,drawDefinition:t,inContextDrawMatchUps:e})||{};p=h&&vV({upcomingMatchUp:h})||p}let f=r.schedule?.timeAfterRecovery;if(f&&(d?.schedule?.scheduledTime&&ar(d.schedule.scheduledTime)<ar(f)&&(i[d.matchUpId]=r.matchUpId,d.schedule.scheduleConflict=r.matchUpId),p?.schedule?.scheduledTime&&ar(p.schedule.scheduledTime)<ar(f)&&(i[p.matchUpId]=r.matchUpId,p.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:d,loserTo:p}),r.drawPositions?.filter(Boolean).length){let h=l.targetLinks?.loserTargetLink?.linkCondition===sf,m=u2e(r);if(m.length){let A=Tj(c?.sides),g=Tj(u?.sides),v=m.find(({participantId:y})=>A.includes(y))?[]:m,b=m.find(({participantId:y})=>g.includes(y))?[]:m;u&&h&&b.length<2&&b.push({bye:!0,tbd:!0}),v?.length&&c&&(!l.targetMatchUpIds&&c&&(c=e.find(({matchUpId:y})=>y===c.matchUpId)),c.potentialParticipants||(c.potentialParticipants=[]),c.potentialParticipants.push(v)),b?.length&&u&&(l.targetMatchUpIds||(c=e.find(({matchUpId:y})=>y===u.matchUpId)),u.potentialParticipants||(u.potentialParticipants=[]),u.potentialParticipants.push(b))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function u2e(t){return t?.sides?.map(({participant:e,participantId:i,qualifier:r})=>e||i&&{participantId:i}||r&&{qualifier:r}).filter(Boolean)||[]}function Ofe({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){let{matchUpId:r,matchUpStatus:n,structureId:a}=t||{};if(!t||!a||t?.matchUpStatus===Rn)return{matchUp:t};if(n==="BYE"){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:o})=>o===t.winnerMatchUpId):{winnerMatchUp:s}=xo({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r})?.targetMatchUps||{},Ofe({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function vV(t){if(t?.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s}))(t.upcomingMatchUp)}function ea(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=VC(t);if(i.error)return le({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:s,byeMatchUps:o,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...s??[],...o??[]),matchUpsMap:l}}function VC(t){if(!t?.drawDefinition)return{error:Bt};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:s,participantsProfile:o,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:f,scheduleTiming:h,participantMap:m,publishStatus:A,contextProfile:g,drawDefinition:v,nextMatchUps:b,inContext:y,context:I,event:w}=t,S=[],T=[],D=[],C=[],E=[];g&&!i&&(i=dA({policyDefinitions:c,tournamentRecord:u,contextProfile:g,event:w}));let P;!e?.length&&u&&(e=u?.participants,(y||o?.withGroupings)&&e?.length&&({participantsWithGroupings:e,groupInfo:P}=_F({participants:e,participantsProfile:o})));let{structures:R}=yd({drawDefinition:v});if(!R)return{error:nn};r||(r=ss({drawDefinition:v}));let M=v&&mfe({drawDefinition:v}).exitProfiles;R.forEach(O=>{let{byeMatchUps:x=[],pendingMatchUps:F=[],upcomingMatchUps:_=[],completedMatchUps:V=[],abandonedMatchUps:G=[]}=zF({matchUpFilters:b?void 0:f,contextFilters:b?void 0:p,inContext:y||b||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:s,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:h,publishStatus:A,contextProfile:g,drawDefinition:v,exitProfiles:M,matchUpsMap:r,structure:O,context:I,event:w});S=S.concat(...G),T=T.concat(...V),D=D.concat(..._),C=C.concat(...F),E=E.concat(...x)});let N=O=>(!f&&!b&&!p||(f&&(O=hm({matchUps:O,...f})),p&&(O=hm({matchUps:O,...p,processContext:!0}))),O),k={abandonedMatchUps:N(S),completedMatchUps:N(T),upcomingMatchUps:N(D),pendingMatchUps:N(C),byeMatchUps:N(E),matchUpsMap:r,...se,groupInfo:P};if(b){let O=typeof b=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:x,completed:F,upcoming:_,pending:V,bye:G}=O,z=[].concat(...x&&S||[],...F&&T||[],..._&&D||[],...V&&C||[],...G&&E||[]);c2e({inContextDrawMatchUps:z,drawDefinition:v})}return k}function Vh(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:h,nextMatchUps:m,inContext:A,context:g,event:v}=t;if(!v)return{error:Vr};let{eventId:b,eventName:y,endDate:I,eventType:w,category:S,gender:T,matchUpFormat:D}=v??{},C={...g,...Ft({indoorOutDoor:v.indoorOutdoor??u?.indoorOutdoor,surfaceCategory:v.surfaceCategory??u?.surfaceCategory,endDate:v.endDate??u?.endDate,tournamentId:u?.tournamentId,matchUpFormat:D,eventName:y,eventType:w,category:S,eventId:b,gender:T})};I&&(C.endDate=I),h&&!i&&(i=dA({policyDefinitions:l,tournamentRecord:u,contextProfile:h,event:v}));let E;if(!e?.length&&!r&&u){let M=nb({participantsProfile:s,useParticipantMap:c,tournamentRecord:u,contextProfile:h,inContext:A});r=M.participantMap,e=M.participants??[],E=M.groupInfo}let P=v.drawDefinitions??[],R=Z1({tournamentRecord:u,event:v}).scheduleTiming;return{matchUps:P.flatMap(M=>{let{matchUps:N}=ea({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:C,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextFilters:p,contextProfile:h,drawDefinition:M,contextContent:i,matchUpFilters:f,participantMap:r,scheduleTiming:R,nextMatchUps:m,inContext:A,event:v});return N??[]}),groupInfo:E}}function La(t){let e=Gt(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!t?.tournamentRecord)return{error:rt};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:s,useParticipantMap:o,policyDefinitions:l,tournamentRecord:c,inContext:u=!0,usePublishState:d,contextProfile:p,matchUpFilters:f,contextFilters:h,nextMatchUps:m,context:A}=t,g=t.tournamentId??c.tournamentId,v=c?.events??[];r||({participants:r,participantMap:i}=nb({participantsProfile:a,useParticipantMap:o,tournamentRecord:c,contextProfile:p,inContext:u}));let{appliedPolicies:b}=er({tournamentRecord:c}),y={...A,tournamentId:g,indoorOutDoor:c.indoorOutdoor,surfaceCategory:c.surfaceCategory,endDate:c.endDate},I=dA({policyDefinitions:l,tournamentRecord:c,contextProfile:p});return{matchUps:v.flatMap(w=>(y.eventDrawsCount=w.drawDefinitions?.length??0,Vh({context:y,scheduleVisibilityFilters:n,tournamentAppliedPolicies:b,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:I,contextFilters:h,contextProfile:p,matchUpFilters:f,participantMap:i,nextMatchUps:m,participants:r,inContext:u,event:w}).matchUps??[])).concat(...c.matchUps??[])}}function sp({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:c}){if(typeof r!="object"||!Object.keys(r).length)return{error:yn};let u=Object.keys(r).map(d=>{let p=r[d];return La({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:p,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:c}).matchUps??[]}).flat();return{...se,matchUps:u}}function Lw(t,e){return d2e(t,e)||(t?.stageSequence||0)-(e?.stageSequence||0)||t?.roundNumber&&e.roundNumber&&t?.roundNumber-e?.roundNumber||(t?.roundPosition??0)-(e?.roundPosition??0)}function d2e(t,e){return(HI[t?.stage]||0)-(HI[e?.stage]||0)}function Do(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,matchUpFilters:d,contextFilters:p,contextProfile:f,drawDefinition:h,nextMatchUps:m,inContext:A,context:g,event:v}=t,{eventId:b,eventName:y,endDate:I,eventType:w,category:S,gender:T,matchUpFormat:D}=v??{},C={...g,surfaceCategory:v?.surfaceCategory??u?.surfaceCategory,indoorOutDoor:v?.indoorOutdoor??u?.indoorOutdoor,matchUpFormat:D,eventType:w,eventName:y,category:S,eventId:b,endDate:I,gender:T},E;return!e?.length&&!i&&u&&({participants:e=[],participantMap:i,groupInfo:E}=nb({participantsProfile:s,useParticipantMap:c,tournamentRecord:u,contextProfile:f,inContext:A})),f&&!r&&(r=dA({policyDefinitions:l,tournamentRecord:u,contextProfile:f,drawDefinition:h,event:v})),{...ea({context:C,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,drawDefinition:h,contextContent:r,contextFilters:p,contextProfile:f,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:A,event:v}),groupInfo:E}}function iy({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=St(t),r=e.split("."),n=[],a;o({targetElement:i,attributes:r});let s={value:a};return n.length&&(s.values=n),s;function o({targetElement:l,attributes:c=[],significantCharacters:u}){for(let[p,f]of c.entries())if(l?.[f]){let h=c.slice(p+1);h.length?Array.isArray(l[f])?l[f].forEach(m=>o({targetElement:m,attributes:h})):(l=l[f],d({targetElement:l,index:p})):(a||(a=l[f]),n.includes(l[f])||n.push(l[f]))}function d({targetElement:p,index:f}){if(p&&f===c.length-1&&["string","number"].includes(typeof p)){let h=u?p.slice(0,u):p;a?n.includes(h)||n.push(h):(a=h,n.push(h))}}}}var Ffe=t=>e=>!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(i=>({[i]:iy({element:e,accessor:i})?.value}))||typeof t=="object"&&Object.keys(t).map(i=>({[i]:iy({element:e,accessor:i})?.value}))||(typeof t=="string"&&iy({element:e,accessor:t}))?.value,Kl=Ffe;function cR({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:s,fmlc:o}){if(!wu(a))return[];let{roundProfile:l,roundNumbers:c=[]}=ko({interpolate:!0,matchUps:a});r=r??Math.max(...c,0);let u=n?r-n:0,d=u&&l?.[r-u]?.matchUpsCount,p=l&&Object.values(l).map(Kl("matchUpsCount")),f=(A,g)=>{let v=Math.min(...A);d&&g&&v===1&&(v=d);let b=Math.max(...A);return e&&b>e&&(b=e),[v,b]},h=l&&Object.assign({},...c.map(A=>{let g=(r??0)+1-A-u,v=l[A].matchUpsCount,b={finishingPositionRange:{},finishingRound:g},y=p?.slice(A-1).reduce((P,R)=>P+(R||0),0),I=o&&A!==1,w=1+t+(I?i??0:0),S=1,T=gt(w,s?w+v*2:y+w+S),D=y+S-v,C=f(T.slice(D)),E=f(T.slice(0,D),!0);return b.finishingPositionRange={loser:C,winner:E},{[A]:b}})),m=Gl({finishingRound:!0});return a.filter(Boolean).forEach(A=>{let g=A.roundNumber&&h[A.roundNumber];m&&!g&&console.log({roundFinishingData:h,matchUp:A}),A.finishingRound=g?.finishingRound,A.finishingPositionRange=g?.finishingPositionRange}),a}function Cy({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){if(!e)return{error:Bt};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=ea({inContext:!0,drawDefinition:e,matchUpsMap:i})),!i?.drawMatchUps.some(n=>n.finishingPositionRange)&&e?.structures?.length===1&&!e?.structures[0].structures){let n=i?.drawMatchUps??[];cR({matchUps:n})}return(t??[]).filter(({collectionId:n})=>!n).forEach(n=>{let{matchUpId:a,structureId:s}=n,o=xo({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:a}),{winnerMatchUp:l,loserMatchUp:c}=o.targetMatchUps,u=l?.matchUpId,d=c?.matchUpId,p=hg({matchUpsMap:i,structureId:s}).find(f=>f.matchUpId===a);if(p&&(u&&(r.winnerMatchUpIds[p.matchUpId]=u,Object.assign(p,{winnerMatchUpId:u}),Object.assign(n,{winnerMatchUpId:u})),d&&(r.loserMatchUpIds[p.matchUpId]=d,n.loserMatchUpId=d,p.loserMatchUpId=d,n.finishingPositionRange))){let f=c.finishingPositionRange&&[...n.finishingPositionRange.loser,...c.finishingPositionRange.loser],h=f&&[Math.min(...f),Math.max(...f)];n.finishingPositionRange.loser=h,p.finishingPositionRange.loser=h}}),{inContextDrawMatchUps:t,goesToMap:r}}function Rd(t){let e=vu(t),i=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:s}=t;if(!Array.isArray(i))return{error:sA};if(!Array.isArray(r))return{error:fp};let o=t.matchUpIds?.length?t.matchUpIds:i.map(v=>v.matchUpId);if(!Array.isArray(o))return{error:Sw};let l={},c={},u={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),f=p.reduce((v,b)=>v.concat(b.events??[]).map(y=>(y.drawDefinitions||[]).map(I=>I.links||[])).flat(1/0),[]).filter(({linkType:v})=>v===mh),h=i;if(f.length){h=sp({nextMatchUps:!0,tournamentRecords:e}).matchUps;let v=f.reduce((b,y)=>{let I=y.source?.structureId,w=y.target?.structureId;return I&&w&&(u[w]=I),I&&!b.includes(I)&&b.push(I),b},[]);for(let b of v)l[b]=[];for(let b of h??[]){let y=b.containerStructureId||b.structureId;v.includes(y)&&l[y].push(b.matchUpId)}}let m=v=>{c[v]||(c[v]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[v]=[])},A=(v,b)=>{c[v].matchUpIds.forEach(y=>{c[b].matchUpIds.push(y)}),c[b].matchUpIds.push(v),c[v].dependentMatchUpIds.push(b),n&&c[v].participantIds.forEach(y=>c[b].participantIds.push(y))},g=v=>{let b=Object.keys(l).length;for(let y of v||[]){let{matchUpId:I,winnerMatchUpId:w,loserMatchUpId:S}=y;if(!o.length||o.includes(I)){if(m(I),n){let{individualParticipantIds:C}=xF(y);c[I].participantIds=C}w&&(m(w),A(I,w),d[w].push(I)),S&&(m(S),A(I,S),d[S].push(I)),c[I].sources.push(d[I]);let T=d[I].map(C=>c[C].sources[0]).flat(),D=d[I].map(C=>c[C].sources[1]).flat();if(c[I].sources.push(T,D),b){let C=y.containerStructureId||y.structureId,E=u[C];if(l[E])for(let P of l[E])m(P),A(P,I),d[P].push(I)}}}};if(s)Cy({drawDefinition:s}),h?.length||(h=Do({drawDefinition:s}).matchUps),g(h);else{if(h?.length||(h=sp({nextMatchUps:!0,tournamentRecords:e}).matchUps),!r.length){let v=p?.length?p.map(({events:b=[]})=>b.map(({drawDefinitions:y=[]})=>y.map(({drawId:I})=>I))).flat(1/0):[];v&&(r=v)}for(let v of r){let b=h?.filter(y=>y.drawId===v).sort(Lw);if(!b?.find(({roundPosition:y})=>!y)){let y=b?.find(({tournamentId:w})=>w),{drawDefinition:I}=Xo({tournamentRecord:e[y?.tournamentId],drawId:v});I&&Cy({drawDefinition:I})}g(b)}}return{positionDependencies:l,matchUpDependencies:c,sourceMatchUpIds:d,matchUps:h,...se}}function ya(t){let e=t?.matchUp,i=t?.score||e?.score,r=i?.sets?.[0],{side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o,side1PointScore:l,side2PointScore:c}=r||{},u=n||a||s||o||l||c;return!!(i?.sets?.length>1||u)}function uR({matchUpStatus:t}){return cW.includes(t)}function p2e({matchUpStatus:t}){return MF.includes(t)}function Nj({matchUpStatus:t}){return uW.includes(t)}function HW({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){let a=r?.find(({participantId:o})=>o),s=i?.filter(HW)?.length;return ya({score:n})||s||e&&a||t&&p2e({matchUpStatus:t})&&![Mr,Xr,Dd].includes(t)}function GC(t){let{drawDefinition:e,findContainer:i,structureId:r,event:n}=t,a=t.structure,{containedStructures:s}=$C({drawDefinition:e}),o=r?s[r]||[]:[],l={isCollectionMatchUp:!1};if(!a){let S=ui({drawDefinition:e,structureId:r});if(S.error)return S;a=i?S.containingStructure??S.structure:S.structure}if(Yo({structure:a}))return{structure:a,isAdHoc:!0,error:ww};let{matchUps:c}=ea({inContext:!0,matchUpFilters:l,drawDefinition:e,event:n}),u=c?.filter(S=>S.structureId===r||o.includes(S.structureId)),{matchUpDependencies:d}=Rd({drawIds:[e.drawId],matchUps:c,drawDefinition:e}),p=[],f=[],h={},m=[];for(let S of c??[]){if(S.structureId===r||o.includes(S.structureId)){f.push(...S.drawPositions??[]);let T=S.roundNumber;for(let D of(S.drawPositions??[]).filter(Boolean))(!h[D]||T&&h[D]>T)&&(h[D]=T)}HW(S)&&(m.push(S),p.push(S.matchUpId,...d?.[S?.matchUpId]?.matchUpIds||[]))}let A=Ci(f.filter(Boolean)).sort(la),g=Ci(p),v=Ci(u?.map(({matchUpId:S,drawPositions:T})=>g.includes(S)?T:[]).flat().filter(Boolean)).sort(la),{positionAssignments:b}=Ir({drawDefinition:e,structure:a}),y=b?.filter(S=>S.bye).map(S=>S.drawPosition),I=b?.filter(S=>S.qualifier).map(S=>S.drawPosition),w=A?.filter(S=>!v.includes(S))||[];return{allDrawPositions:A,inContextStructureMatchUps:u,drawPositionInitialRounds:h,activeDependentMatchUpIds:g,qualifyingDrawPositions:I,inactiveDrawPositions:w,positionAssignments:b,activeDrawPositions:v,byeDrawPositions:y,activeMatchUps:m,structure:a}}function jI({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&i?.includes(t)).map(({roundNumber:i})=>i).sort(la)[0]}}var FA={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},VW=[];function vl(t,e){Lr(t)&&(t={method:t}),(e||Gl())&&VW.push(t)}function f2e(t){return VW.slice()}function h2e(t){let e=f2e().map(i=>{let{color:r,keyColors:n,method:a,newline:s}=i,o=Object.keys(FA).includes(r)?FA[r]:FA.cyan,l=Object.keys(i).filter(u=>!["color","keyColors","method","newline"].includes(u)).map(u=>{let d=n&&Object.keys(n).includes(u)&&FA[n[u]]?FA[n[u]]:FA.brightwhite;return`${FA.white}${u}: ${d}${i[u]}`}).join(", "),c=a?.length<15?"		":"	";return[s?`
`:"",o,a,c,FA.white,l,FA.reset,`
`].join("")});e?.length&&console.log(...e)}function m2e(){VW.length=0}function GW(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,containsParticipant:r,filled:e||i||r}}function Ms(t){return[Mr,Xr,Fa].includes(t)}function Oc({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,loserMatchUp:a,matchUpsMap:s,structureId:o,structure:l,event:c}){if(!r)return{error:Bt};if(l||({structure:l}=ui({drawDefinition:r,structureId:o})),!l)return{error:nn};o||({structureId:o}=l);let u="assignDrawPositionBye";vl({method:u,color:"cyan",drawPosition:n}),s??=ss({drawDefinition:r});let{positionAssignments:d}=Ir({structure:l}),{activeDrawPositions:p}=GC({drawDefinition:r,structureId:o});if(d?.find(E=>E.drawPosition===n)?.bye)return{...se};let f=!!(a&&s.drawMatchUps.some(E=>E.loserMatchUpId===a?.matchUpId&&Ms(E.matchUpStatus)));if(p?.includes(n)&&!f)return{error:R1};let h=d?.find(E=>E.drawPosition===n);if(!h)return{error:ww};let{filled:m,containsBye:A,containsParticipant:g}=GW(h);if(A)return{...se};if(m&&!A&&!f)return le({result:{error:fT},stack:u});let v=er({tournamentRecord:i,drawDefinition:r,event:c}).appliedPolicies??{},b=ea({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[],y={isCollectionMatchUp:!1},{matchUps:I}=cr({provisionalPositioning:t,drawDefinition:r,matchUpFilters:y,matchUpsMap:s,structure:l});if(d?.forEach(E=>{E.drawPosition===n&&(E.bye=!0,f&&(E.participantId=void 0))}),l.structureType===Ao)return A2e({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:I}),Fm({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:c}),eee({assignedParticipantId:g,isPositionAction:e,appliedPolicies:v,drawDefinition:r,drawPosition:n,structureId:o,stack:u});let{roundProfile:w,roundMatchUps:S}=ko({matchUps:I}),T=(w&&Object.keys(w).map(E=>Number.parseInt(E)).reverse())?.find(E=>w?.[E].drawPositions?.includes(n)),D=T?S?.[T].find(({drawPositions:E})=>E?.includes(n)):void 0;D&&Lfe({tournamentRecord:i,drawDefinition:r,matchUp:D,event:c});let C=D?.drawPositions?.find(E=>E!==n);if(D&&C){let E=QW({sourceDrawPositions:D.drawPositions,matchUpId:D.matchUpId,inContextDrawMatchUps:b,drawPositionToAdvance:C,tournamentRecord:i,drawDefinition:r,matchUpsMap:s});if(E.error)return E}return Fm({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:c}),eee({assignedParticipantId:g,isPositionAction:e,appliedPolicies:v,drawDefinition:r,drawPosition:n,structureId:o,stack:u})}function eee({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&K1({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),le({result:{...se},stack:s})}function Lfe({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:"BYE",score:void 0,winningSide:void 0}),Yi({tournamentId:t?.tournamentId,eventId:i??n?.eventId,context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function A2e({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{a.drawPositions?.includes(i)&&Lfe({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function QW({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:s,event:o}){vl({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(b=>b.matchUpId===s),c=e.find(b=>b.matchUpId===s)?.structureId,{structure:u}=ui({drawDefinition:n,structureId:c}),{positionAssignments:d}=Ir({structure:u}),p=d?.filter(b=>b.bye).map(b=>b.drawPosition),f=l?.drawPositions?.find(b=>b!==t),h=f&&p?.includes(f),{targetLinks:{loserTargetLink:m},targetMatchUps:{loserMatchUp:A,winnerMatchUp:g,loserTargetDrawPosition:v}}=xo({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:s});if(g&&g.structureId===u?.structureId&&g2e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:g,matchUpsMap:a,event:o}),A&&h&&A.structureId!==u?.structureId){let{roundNumber:b}=A;if(b===1){let y=Oc({structureId:m.target.structureId,drawPosition:v,tournamentRecord:r,drawDefinition:n,event:o});if(y.error)return y}else $fe({loserTargetDrawPosition:v,tournamentRecord:r,loserTargetLink:m,drawDefinition:n,loserMatchUp:A,matchUpsMap:a,event:o})}return{...se}}function g2e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:s,event:o}){let l="advanceWinner",c=s.drawMatchUps.find(M=>M.matchUpId===a.matchUpId),u=e.find(M=>M.matchUpId===a.matchUpId)?.structureId,{structure:d}=ui({drawDefinition:n,structureId:u}),{positionAssignments:p}=Ir({structure:d}),f=p?.find(({drawPosition:M})=>M===t)?.bye,h=c.drawPositions?.filter(Boolean),m=p?.filter(M=>h?.includes(M.drawPosition)),A=p?.find(({drawPosition:M})=>M===t),g=i?.find(M=>M!==t),v=(g&&m?.find(({drawPosition:M})=>M===g))?.bye,b=f&&v;if(b&&console.log({isByeAdvancedBye:b}),h?.length>1&&f&&!v)return le({result:{error:fT},stack:l});let y=h?.find(M=>M!==t),I=b,w=[...(c.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),S=w.map(M=>!M&&!I||M===t?(I=!0,t):M).sort(la);if(!I)return console.log("@@@@@@@",{advancingAssignmentIsBye:A,drawPositionToAdvance:t,existingAssignments:m}),le({result:{error:fT},stack:l});let T=p?.find(({drawPosition:M})=>M===y)?.bye,D=p?.find(({drawPosition:M})=>M===t)?.bye;Object.assign(c,{matchUpStatus:D||T?"BYE":Rn,score:void 0,winningSide:void 0,drawPositions:S});let C=c.drawPositions.find(M=>!w.includes(M));vl({method:l,color:"brightyellow",changedDrawPosition:C,pairedDrawPositionIsBye:T,drawPositionIsBye:D}),Yi({tournamentId:r?.tournamentId,matchUp:c,eventId:o?.eventId,context:l,drawDefinition:n});let{targetLinks:{loserTargetLink:E},targetMatchUps:{loserMatchUp:P,loserTargetDrawPosition:R}}=xo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(T||D){let M=T?t:y;if(M)QW({drawPositionToAdvance:M,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:s});else if(D&&E&&P)if(P.feedRound)$fe({loserTargetDrawPosition:R,tournamentRecord:r,loserTargetLink:E,drawDefinition:n,loserMatchUp:P,matchUpsMap:s});else{let N=1-a.roundPosition%2,k=P.drawPositions[N],O=Oc({structureId:E.target.structureId,drawPosition:k,tournamentRecord:r,drawDefinition:n,event:o});if(O.error)return O}}}function $fe({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{roundNumber:o}=n;vl({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=(a?.mappedMatchUps||{})[n.structureId].matchUps,{initialRoundNumber:c}=jI({drawPosition:t,matchUps:l});if(c===o){let u=Oc({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:s});if(u.error)return u}}function Hfe({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:s}=cr({drawDefinition:i,matchUpsMap:r,structure:n,event:a});s.forEach(o=>{let l=t.filter(({drawPosition:c})=>o.drawPositions?.includes(c)).filter(c=>c.bye).length;o.winningSide||(Object.assign(o,{matchUpStatus:l?"BYE":Rn}),Yi({tournamentId:e?.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a?.eventId,drawDefinition:i,matchUp:o}))})}function dR(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:s,matchUpsMap:o,event:l}=t,{structure:c}=ui({drawDefinition:a,structureId:s}),u=(va({drawDefinition:a,structure:c}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(u&&i&&!r&&(r=u?.drawPosition),!r)return{error:EC};i||(i=u?.participantId);let{activeDrawPositions:d}=GC({drawDefinition:a,structureId:s});return d.includes(r)?{error:R1}:(e||({matchUps:e}=ea({inContext:!0,drawDefinition:a,matchUpsMap:o})),Bj({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:s,drawPosition:r,matchUpsMap:o,event:l}).drawPositionCleared?(Fm({tournamentId:n?.tournamentId,drawDefinition:a,structure:c,event:l}),{...se,participantId:i}):{error:cue})}function Bj({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:s}){let{structure:o}=ui({drawDefinition:i,structureId:a});if(!o)return{error:nn};let l=va({drawDefinition:i,structure:o}).positionAssignments||[],c=l.some(g=>{if(g.drawPosition===r)return delete g.participantId,delete g.qualifier,delete g.bye,!0});if(o.structureType===Ao)return Hfe({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:o}),{drawPositionCleared:c,...se};let u={isCollectionMatchUp:!1},{matchUps:d}=cr({drawDefinition:i,matchUpFilters:u,matchUpsMap:n,structure:o,event:s}),{roundProfile:p,roundMatchUps:f}=ko({matchUps:d}),h=(p&&Object.keys(p))?.map(g=>ri(g)),m=r,A=h?.map(g=>{let v=p?.[g]?.pairedDrawPositions?.find(C=>C.includes(m)),b=v?.find(C=>C!==m),y=l.find(C=>C.drawPosition===b),I=p?.[g+1],w=y?.bye,S=I?.pairedDrawPositions?.find(C=>C.includes(b)),T=w&&S&&I&&I.drawPositions?.includes(b),D=v&&{pairedDrawPositionByeAdvancedPair:!T&&S,pairedDrawPosition:b,targetDrawPosition:m,relevantPair:v,roundNumber:g};return T&&(m=b),D}).filter(g=>g?.targetDrawPosition)?.reduce((g,v)=>{let{roundNumber:b,relevantPair:y,targetDrawPosition:I,pairedDrawPosition:w,pairedDrawPositionByeAdvancedPair:S}=v,T={roundNumber:b,targetDrawPosition:I,relevantPair:y},D=S&&{roundNumber:b+1,targetDrawPosition:w,relevantPair:S,subsequentRoundRemoval:!0},C=[T,D].filter(Boolean);return g.concat(...C)},[]);return A?.forEach(({roundNumber:g,targetDrawPosition:v,relevantPair:b})=>{let y=f?.[g].find(I=>Bo(I.drawPositions?.filter(Boolean),b.filter(Boolean)));y&&(v2e({inContextDrawMatchUps:t,targetDrawPosition:v,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:g,matchUpsMap:n}),Vfe({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:y,drawPosition:r,matchUpsMap:n,structure:o,event:s}))}),{tasks:A,drawPositionCleared:c,positionAssignments:l}}function v2e({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:s}){let{structure:o}=ui({drawDefinition:r,structureId:s});if(!o)return{error:nn};if(o.structureType===Ao)return;n=n||ss({drawDefinition:r});let l=(n?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:c}=jI({drawPosition:e,matchUps:l}),u=l?.filter(p=>p.roundNumber>=a&&p.roundNumber!==c&&p.drawPositions?.includes(e)),d=Ir({drawDefinition:r,structureId:s}).positionAssignments??[];return u?.forEach(p=>Vfe({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:o})),{...se}}function Vfe({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let c="removeDrawPosition",u=n.drawPositions?.slice(),d=n.matchUpStatus,p=n.winningSide;s=s??ss({drawDefinition:r});let f=s.mappedMatchUps[o.structureId].matchUps,{initialRoundNumber:h}=jI({drawPosition:a,matchUps:f});if(n.roundNumber&&h&&n.roundNumber>h){let S=(n.drawPositions??[]).map(T=>T===a?void 0:T);n.drawPositions=S}if(n.matchUpType===$r){let S=(t?.find(T=>T.matchUpId===n.matchUpId)?.sides??[]).reduce((T,D,C)=>D.drawPosition===a?C:T,void 0);S!==void 0&&n.sides?.[S]?.lineUp&&(delete n.sides?.[S].lineUp,Yi({tournamentId:i?.tournamentId,context:`${c}-TEAM`,eventId:l?.eventId,matchUp:n,drawDefinition:r}))}let m=xo({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:A},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v,loserMatchUpDrawPositionIndex:b}}=m,y=e.filter(({drawPosition:S})=>n.drawPositions?.includes(S)).filter(S=>S.bye).length,I=y&&"BYE"||n.matchUpStatus&&Ms(n.matchUpStatus)&&n.matcHUpStatus||Rn;n.matchUpStatus=I,n.matchUpStatus&&Ms(n.matchUpStatus)&&(n.winningSide=void 0);let w=u?.find(S=>!n.drawPositions?.includes(S));if(u?.includes(a)&&d===n.matchUpStatus&&p===n.winningSide||(w&&vl({method:c,color:"brightyellow",removedDrawPosition:w}),Yi({tournamentId:i?.tournamentId,context:`${c}-${a}`,eventId:l?.eventId,matchUp:n,drawDefinition:r})),g&&g.structureId!==m.matchUp.structureId&&!y){let{drawPositions:S,roundNumber:T}=g;if(T===1){let D=S[b];Bj({structureId:g.structureId,drawPosition:D,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s})}else{let D=Math.min(...S.filter(Boolean)),C=y2e({loserMatchUpDrawPosition:D,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:g,matchUpsMap:s,event:l});if(C.error)return le({result:C,stack:c});let E=(s?.mappedMatchUps||{})[g.structureId].matchUps,{initialRoundNumber:P}=jI({drawPosition:D,matchUps:E});P===1&&(vl({method:c,color:"brightyellow",loserMatchUpDrawPosition:D}),Bj({structureId:g.structureId,drawPosition:D,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s}))}}return v&&v.structureId!==m.matchUp.structureId&&A.target.feedProfile,{...se}}function y2e({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{structure:o}=ui({structureId:n.structureId,drawDefinition:r}),{positionAssignments:l}=Ir({structure:o});if(l?.find(c=>c.drawPosition===t)?.bye){let c=dR({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:s});if(c.error)return c}return{...se}}function cb({drawDefinition:t,stages:e}){if(!t)return{error:Bt};let i=(t?.structures??[]).filter(n=>!e?.length||n.stage&&e.includes(n.stage)),r=Ci(i.map(n=>{let{positionAssignments:a}=Ir({structure:n});return a?a.map(ji):[]}).flat().filter(Boolean));return{...se,assignedParticipantIds:r}}function Xd(t){let e=(t?.entries??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:s}=n,o=`_${a||Ut}${s||""}`;return r[o]||(r[o]=[]),r[o].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let s=a+1;return{...n,entryPosition:s}})).flat()}function Gv(t){return[sb,bu].includes(t)}function Hx({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:s,extension:o,eventSync:l,drawId:c,stage:u,event:d}){if(!n||!Array.isArray(n))return{error:np,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:Vr};if(a&&!ffe.includes(a))return{error:mj};if(s&&!mF.includes(s))return{error:eb};let p="modifyEntriesStatus",f=[];if(!a&&!o)return le({result:{error:Kt},info:"Missing entryStatus",stack:p});if(o&&!of({extension:o,requiredAttributes:["name"]}))return le({result:{error:be},info:"Invalid extension",context:{extension:o},stack:p});let h=[];d?.drawDefinitions?.forEach(D=>{let C=cb({stages:u&&[u],drawDefinition:D}).assignedParticipantIds??[];h.push(...C)});let m=i?.participants??[];if(!n.every(D=>{let C=dg({tournamentParticipants:m,participantId:D})?.participantType;return!(C&&[Mi,zo].includes(C)&&Gv(a))&&!(a&&d?.eventType&&C===zi&&[uu,jl].includes(d.eventType)&&[rd,...Ck].includes(a))}))return{error:mj};let A=d&&Bn({event:d}).flightProfile,g=A?.flights?.find(D=>D.drawId===c),v=D=>{let C=(D||[]).filter(P=>!u||!P.entryStage||u===P.entryStage).filter(({participantId:P})=>n.includes(P)),E=P=>a&&h.includes(P.participantId)&&!(Ck.includes(P.entryStatus)&&Ck.includes(a));return C.every(P=>E(P)&&!e?!1:(a&&(P.entryStatus=a,delete P.entryPosition),s&&(P.entryStage=s,delete P.entryPosition),o&&(o.value?lr({element:P,extension:o}):Eo({element:P,name:o.name})),!0))?{...se}:{error:RC}},b=({flight:D,drawDefinition:C})=>{d&&(d.entries=Xd({entries:d.entries??[]})),D&&(D.drawEntries=Xd({entries:D.drawEntries})),C&&(C.entries=Xd({entries:C.entries}))},y=D=>{let{flight:C,drawDefinition:E}=D,P="updateDrawEntries";if(C){let R=v(C.drawEntries);if(R.error)return le({result:R,stack:P})}if(E){let R=v(E.entries);if(R.error)return le({result:R,stack:P});f.includes(E.drawId)||f.push(E.drawId)}return{...se}},I=d?.entries?.find(({entryPosition:D})=>D)??(g?.drawEntries?.find(({entryPosition:D})=>D)||r?.entries?.find(({entryPosition:D})=>D));if(t&&!I&&b({flight:g,drawDefinition:r}),g||r){let D=y({flight:g,drawDefinition:r});if(D.error)return le({result:D,stack:p})}let w=d?.drawDefinitions?.map(({drawId:D})=>D)??[],S=A?.flights?.filter(D=>!w.includes(D.drawId))||[];for(let D of S){let C=D&&y({flight:D});if(C?.error)return le({result:C,stack:p})}let T=A?.flights?.length===1&&(d?.drawDefinitions?.length??0)<=A?.flights?.length;if(!g&&!r&&a&&pfe.includes(a))return{error:Kue};if(!g&&!r||a===Ih||l&&T){let D=v(d?.entries);if(D?.error)return le({result:D,stack:p});let C;if(a===Ih&&(A?.flights?.every(E=>{let P=v(E.drawEntries);return P.error?(C=P.error,!1):(E.drawEntries=E.drawEntries.filter(({participantId:R})=>!n.includes(R)),!0)}),d?.drawDefinitions?.every(E=>{let P=v(E.entries);return P.error?(C=P.error,!1):(E.entries=E.entries?.filter(({participantId:R})=>!n.includes(R)),!0)})),C)return le({result:{error:C},stack:p})}t&&b({flight:g,drawDefinition:r});for(let D of d?.drawDefinitions??[])f.length&&!f.includes(D.drawId)||Br({tournamentId:i.tournamentId,eventId:d?.eventId,drawDefinition:D});return{...se}}function rh({requireTimeStamp:t,scaleAttributes:e,participant:i}){if(!i)return{error:Tw};if(!Ki(e))return{error:be};if(i.timeItems??=[],Array.isArray(i.timeItems)){let{accessor:r,scaleType:n,eventType:a,scaleName:s}=e,o=[Sy,n,a,s].join("."),l=i.timeItems.filter(c=>c?.itemType===o).filter(c=>!t||c?.itemDate).sort((c,u)=>(c.createdAt?new Date(c.createdAt).getTime():0)-(u.createdAt?new Date(u.createdAt).getTime():0)).pop();if(l){let[c,u,d,p]=l.itemType?.split(".")??[];if(c!==Sy)return{error:LI};let f=r&&iy({element:l.itemValue,accessor:r}),h=f?.value||l.itemValue,m={rawValue:f&&l.itemValue,eventType:d,scaleDate:l.itemDate,scaleValue:h,scaleName:p,scaleType:u};return{...se,scaleItem:m}}}return{...se,scaleItem:void 0}}function b2e({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){let a={},s=u=>[Sy,eh,n.eventType,u].join("."),o=Object.assign({},...(r.timeItems||[]).filter(({itemType:u})=>u.split(".")[1]===eh).map(({itemType:u,itemValue:d})=>({[u]:d}))),l=(t?.stageSeedingScaleNames&&Object.values(t?.stageSeedingScaleNames)||Array.isArray(t?.seedingScaleNames)&&t.seedingScaleNames||[]).map(s),c=Pn(Object.keys(o),l);if((!e||!Object.keys(o).length&&!t?.drawIds?.length||c.length)&&c.length){if(t?.stageSeedingScaleNames){let u=Object.keys(t.stageSeedingScaleNames).map(p=>{let f=s(t.stageSeedingScaleNames[p]),h=o[f];return[p,h]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...u);a.seedAssignments=d}else if(c){let u=c.map(d=>o[d]);a.seedValue=u.pop()}}else if(!e&&typeof i=="object"){let u=Object.keys(i).map(p=>{let f=s(i[p]),h=o[f];return[p,h]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...u);a.seedAssignments=d}else{let{categoryName:u,ageCategoryCode:d}=n.category||{},p=[d,n.eventId,u].filter(Boolean),f;for(let h of p){let m={eventType:n.eventType,scaleType:eh,scaleName:h},A=rh({scaleAttributes:m,participant:r});if(A.scaleItem){f=A.scaleItem;break}}if(f&&(!e||t?.published&&!t?.published?.drawIds?.length)){let h=f.scaleValue;a.seedValue=h}}return a}function I2e({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:s,entry:o}){let{entryStatus:l,entryStage:c,entryPosition:u,extensions:d}=o,p=d?.length&&t?Object.assign({},...Fq(d??[])):{},f=Object.assign(p,{entryPosition:u,entryStatus:l,entryStage:c,ranking:s,eventId:a});i.events[a]=Ft(f,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function pR(t){let e=Gt(t,[{[Sa]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:r=_c}=t,n=`${qg}.${Wg}`;return St(OF({tournamentRecord:i,itemType:n})?.timeItem?.itemValue?.[r],!1,!0)}function w2e(t){let{tournamentId:e}=t??{};return!!e}function Su({event:t,status:e=_c}){let i=`${qg}.${Wg}`;return X1({itemType:i,event:t})?.timeItem?.itemValue?.[e]}function jW({drawDetails:t,drawId:e}){return t?.[e]?.publishingDetail?.published}function $w(t){let{tournamentRecord:e,drawDefinition:i,eventIds:r,eventId:n,drawIds:a,drawId:s,event:o}=t??{};if(e&&!w2e(e))return{error:be};if(n&&!o)return{error:cu};if(Array.isArray(r)&&r?.length){let d={};for(let p of r){if(!Lr(p))return{error:be};let f=Xo({tournamentRecord:e,eventId:p})?.event;if(!f)return{error:cu};let h=yV({event:f});d[p]=h}return{...se,publishState:d}}if(o){let d=yV({event:o}),p={};if(s)return i?{publishState:{status:{published:!!d.status.publishedDrawIds?.includes(s),drawDetail:d.status.drawDetails?.[s]},...se}}:{error:Ec};if(Array.isArray(a)&&a?.length){let f=o.drawDefinitions?.map(cP)??[];for(let h of a){if(!Lr(h))return{error:be};if(!f.includes(h))return{error:Ec};p[h]={status:{published:!!d.status.publishedDrawIds.includes(h),drawDetail:d.status.drawDetails?.[h]}}}}else p=d;return{...se,publishState:p}}let l=[],c=!1,u={};for(let d of e?.events??[]){let p=yV({event:d});u[d.eventId]=p,p.status.published&&(l.push(d.eventId),c=!0);for(let{drawId:f}of d.drawDefinitions??[]){let h=p.status?.publishedDrawIds?.includes(f);h&&(u[f]={status:{published:h}})}}if(e){let d=pR({tournamentRecord:e});u.tournament=d??{},(d?.orderOfPlay?.published||d?.participants?.published)&&(c=!0),u.tournament.status={published:c,publishedEventIds:l}}return{...se,publishState:u}}function yV({event:t}){let e=Su({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let r=e.drawDetails??{};for(let o of t.drawDefinitions?.map(cP)||[])r[o]||(r[o]={publishingDetail:{published:!1}});let n=r&&Object.keys(r).length&&Object.keys(r).filter(o=>jW({drawDetails:r,drawId:o})),a=n?.length?n:e.drawIds??[];if(a?.length&&!n?.length)for(let o of a)r[o]={publishingDetail:{published:!0}};let s=a?.length>0;return{status:{publishedDrawIds:a,publishedSeeding:i,drawDetails:r,published:s}}}function Gfe(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:c,schedule:u,drawId:d,score:p}=t;!u||!Object.keys(u).length||r==="BYE"||e[i].scheduleItems.push({...u,scheduledDate:Si(u?.scheduledDate),scheduledTime:qr(u?.scheduledTime),checkScoreHasValue:ya({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:c,drawId:d})}function S2e({finishingPositionRange:t={winner:[],loser:[]},participantMap:e,finishingRound:i,participantWon:r,matchUpStatus:n,participantId:a,stageSequence:s,roundNumber:o,structureId:l,matchUpId:c,drawId:u,stage:d}){let p=e[a],f=v=>Math.abs(v[0]-v[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:s,winCount:0,structureId:l,drawId:u});let h=p.structureParticipation[l],{winner:m,loser:A}=t,g=r?m:A;r&&(h.winCount+=1,n===Xr&&(h.walkoverWinCount+=1),n===Mr&&(h.defaultWinCount+=1)),g&&(!h.finishingPositionRange||f(g)<f(h.finishingPositionRange))&&(h.finishingPositionRange=g),i&&((!h.finishingRound||i<h.finishingRound)&&(h.finishingMatchUpId=c,h.finishingRound=i,h.roundNumber=o),i===1&&(h.participantWon=r))}function tee(t){let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:r,participantMap:n,withOpponents:a,withMatchUps:s,withEvents:o,withDraws:l,finishingPositionRange:c,finishingRound:u,matchUpStatus:d,stageSequence:p,roundNumber:f,structureId:h,score:m,stage:A,withRankingProfile:g,tieWinningSide:v,roundPosition:b,matchUpTieId:y,matchUpSides:I,collectionId:w,matchUpType:S,winningSide:T,matchUpId:D,schedule:C,eventId:E,drawId:P,sides:R}=t,M=a&&R?.length===2&&Object.assign({},...R.map(({sideNumber:N},k)=>{let O=R[1-k].participantId;return N&&{[N]:O}}).filter(Boolean));for(let N of R){let{participantId:k,sideNumber:O,bye:x}=N;if(x)continue;let F=T===O,_=z=>{let Q=n[z]?.participant,j=Q?.participantType,W=[{participantId:z,participantType:j}];if(j!==zo)for(let Y of Q?.individualParticipantIds||[]){let X=n[Y]?.participant;W.push({participantType:X?.participantType,participantId:Y})}return W},V=(z,Q)=>{if(s){if(n[z].matchUps[D]={participantWon:F,matchUpType:S,structureId:h,sideNumber:O,matchUpId:D,eventId:E,drawId:P,stage:A},a){let j=_(Q);n[z].matchUps[D].opponentParticipantInfo=j}w&&(n[z].matchUps[D].collectionId=w)}a&&Q&&(n[z].opponents[Q]={participantId:Q,matchUpId:D,eventId:E,drawId:P}),g&&S2e({finishingPositionRange:c,participantMap:n,participantWon:F,finishingRound:u,matchUpStatus:d,participantId:z,stageSequence:p,roundNumber:f,structureId:h,matchUpId:D,drawId:P,stage:A}),(i||e)&&Gfe({participantMap:n,participantId:z,matchUpStatus:d,roundPosition:b,matchUpType:S,roundNumber:f,structureId:h,matchUpId:D,schedule:C,drawId:P,score:m})},G=({participant:z,partnerParticipantId:Q})=>{let j=(W,Y)=>{W&&(W.partnerParticipantIds||(W.partnerParticipantIds=[]),W.partnerParticipantIds.includes(Y)||W.partnerParticipantIds.push(Y))};l&&j(z?.draws?.[P],Q),o&&j(z?.events?.[E],Q),s&&j(z?.matchUps?.[D],Q)};if(k&&n[k]){let z=M?.[O];V(k,z);let Q=n[k]?.participant.participantType===Mi,j=n[k]?.participant.individualParticipantIds||[];if(y){if(r){let W=Y=>n[Y].matchUps[y]={participantWon:v===O,matchUpId:y,matchUpType:$r,sideNumber:O};W(k),j.forEach(W)}if(l&&!n[k].draws[P]){let W=I.find(J=>J.sideNumber===O)?.participant?.participantId,Y=n[W]?.draws?.[P]?.entryStatus,X=J=>n[J].draws[P]={entryStatus:Y,eventId:E,drawId:P};X(k),j.forEach(X)}}if(Q&&(j.forEach(W=>n[W]&&V(W,z)),j.forEach((W,Y)=>{let X=j[1-Y],J=n[W];J&&G({participant:J,partnerParticipantId:X})}),o&&I)){let W=I.find(Y=>Y.sideNumber===O)?.participant?.participantId;if(W){let Y=n[W]?.events[E];Y?(n[k].events[E]={...Y},j.forEach(X=>n[X].events[E]={...Y})):console.log("Missing teamEntry",{eventId:E,teamParticipantId:W})}}if(T){let W=Y=>{F?(n[Y].counters[S].wins+=1,n[Y].counters.wins+=1,d===Xr&&(n[Y].counters[S].walkoverWins+=1,n[Y].counters.walkoverWins+=1),d===Mr&&(n[Y].counters[S].defaultWins+=1,n[Y].counters.defaultWins+=1)):(n[Y].counters[S].losses+=1,n[Y].counters.losses+=1,d===Xr&&(n[Y].counters[S].walkovers+=1,n[Y].counters.walkovers+=1),d===Mr&&(n[Y].counters[S].defaults+=1,n[Y].counters.defaults+=1))};W(k),j.forEach(W)}}}}function qF(t,e){return(t||"").localeCompare(e||"")}function U2e(t){let{participantFilters:e,convertExtensions:i,policyDefinitions:r,tournamentRecord:n,usePublishState:a,contextFilters:s,matchUpFilters:o,participantMap:l,contextProfile:c,withPotentialMatchUps:u,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:f,withTeamMatchUps:h,withStatistics:m,withOpponents:A,withMatchUps:g,withSeeding:v,withEvents:b,withDraws:y}=t,I=e?.participantIds,w=N=>{let k=[N];return l[N]?.participant.individualParticipantIds?.forEach(O=>k.push(O)),k.some(O=>!I?.length||I.includes(O))?k:[]},S={withMatchUps:g||d,withEvents:b||d,withDraws:y||d,withPotentialMatchUps:u,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:f,withTeamMatchUps:h,withStatistics:m,participantMap:l,withOpponents:A,withSeeding:v},T=[],D={},C=[],E={},P={},R={},M=({eventType:N,scaleNames:k,participantId:O})=>l[O]?.participant?.rankings?.[N]?.find(x=>k.includes(x.scaleName))?.scaleValue;for(let N of n?.events||[]){if(e?.eventIds&&!e.eventIds.includes(N.eventId))continue;let{drawDefinitions:k=[],extensions:O=[],eventType:x,eventName:F,category:_,entries:V,eventId:G,gender:z}=N,{flightProfile:Q}=Bn({event:N}),j=Q?.flights??[],W=$w({event:N}).publishState;W&&(E[G]=W);let Y=W?.status?.publishedSeeding;if(b||v||d){let J=i?Object.assign({},...Fq(O??[])):{};P[G]={...J,eventName:F,eventType:x,category:_,eventId:G,gender:z};let ie=[_?.categoryName,_?.ageCategoryCode].filter(Boolean);for(let ue of V){let{participantId:ne}=ue;if(!ne||!l[ne])continue;let ge=M({eventType:x,scaleNames:ie,participantId:ne}),he,Ie;if(v){let Je=l[ne].participant;({seedAssignments:he,seedValue:Ie}=b2e({publishedSeeding:Y,usePublishState:a,withSeeding:v,participant:Je,event:N}))}let xe=Je=>{if(l[Je]?.events?.[G])return;let qe=l[Je];I2e({convertExtensions:i,seedAssignments:he,participant:qe,withSeeding:v,seedValue:Ie,eventId:G,ranking:ge,entry:ue})};xe(ne),(l[ne].participant.individualParticipantIds||[]).forEach(xe)}}let X=E?.[G]?.publishedSeeding;if(y||d||v){let J=ue=>ue?Object.assign({},...ue.map(({participantId:ne,seedValue:ge,seedNumber:he})=>({[ne]:{seedValue:ge,seedNumber:he}}))):void 0,ie=Ci([...k.map(cP),...j.map(cP)]);for(let ue of ie){let ne=k.find(pe=>pe.drawId===ue),ge=[_?.categoryName,_?.ageCategoryCode].filter(Boolean),{structures:he=[],drawOrder:Ie,drawName:xe,drawType:Je}=ne??{},qe=j?.find(pe=>pe.drawId===ue),dt=ne?.entries||qe?.drawEntries,ft=qe?.flightNumber,je=(ne?.structures||[]).sort((pe,Se)=>Nw(pe,Se)).map(({structureId:pe,structures:Se})=>[pe,...(Se||[]).map(({structureId:ye})=>ye)]).flat(1/0),Tt,Oe,mt,Le,lt=0,it=new Set(he.filter(({stage:pe,stageSequence:Se})=>pe===Ut&&Se===1||pe===zt).flatMap(pe=>{let{positionAssignments:Se}=Ir({structure:pe}),{seedAssignments:ye,stageSequence:ke,stage:Ce}=pe;return Ce===Ut?(lt=Se?.length??0,mt=Se,Le=ye):ke===1&&(Tt=Se,Oe=ye),Se}).map(({participantId:pe})=>pe).filter(Boolean)),Fe=J(Le),Xe=J(Oe),ct=ne?dt.filter(({participantId:pe})=>it.has(pe)):dt,We=!a||X?.published&&(X?.drawIds?.length===0||X?.drawIds?.includes(ue));for(let pe of ct){if(!l[pe.participantId])continue;let{entryStatus:Se,entryStage:ye,entryPosition:ke,participantId:Ce}=pe,Ke=M({participantId:Ce,scaleNames:ge,eventType:x}),_e=wt=>{if(!l[wt]||l[wt].draws?.[ue])return;let ut=v&&We,Ct=ut?{}:void 0,Gi=ut?Fe?.[Ce]?.seedValue||Fe?.[Ce]?.seedNumber:void 0,Wt=Gi?Fe?.[Ce]:void 0,Ji=ut?Xe?.[Ce]?.seedValue||Xe?.[Ce]?.seedNumber:void 0,$i=Ji?Xe?.[Ce]:void 0;Ct&&Gi&&(Ct[Ut]=Wt),Ct&&Ji&&(Ct[zt]=$i);let xi=Gi||Ji;xi&&(l[wt].participant.seedings[x]||(l[wt].participant.seedings[x]=[]),Wt&&l[wt].participant.seedings[x].push({...Wt,scaleName:ue}),$i&&l[wt].participant.seedings[x].push({...$i,scaleName:ue}),Ct&&(l[wt].events[G].seedAssignments||(l[wt].events[G].seedAssignments={}),Object.keys(Ct).forEach(en=>l[wt].events[G].seedAssignments[en]=Ct[en]))),(y||d)&&(l[wt].draws[ue]=Ft({seedAssignments:Ct,entryPosition:ke,entryStatus:Se,entryStage:ye,seedValue:xi,eventId:G,ranking:Ke,drawId:ue},!1,!1,!0))};[bu,sb].includes(Se)||(_e(Ce),(l[Ce].participant.individualParticipantIds||[])?.forEach(_e))}let ht=(ne?.structures??[]).reduce((pe,Se)=>(pe.includes(Se.stage)||pe.push(Se.stage),pe),[]),xt=(ne?.links??[]).length;R[ue]={qualifyingPositionAssignments:Tt,qualifyingSeedAssignments:Oe,mainPositionAssignments:mt,qualifyingSeedingMap:Xe,mainSeedAssignments:Le,orderedStructureIds:je,mainSeedingMap:Fe,flightNumber:ft,linksCount:xt,drawOrder:Ie,drawName:xe,drawType:Je,drawSize:lt,drawId:ue,stages:ht}}}if(d||f||h||m||A||g||y){let J=!!f||u,ie=Vh({afterRecoveryTimes:!!f,policyDefinitions:r,tournamentRecord:n,inContext:!0,participantMap:l,contextFilters:s,matchUpFilters:o,contextProfile:c,nextMatchUps:J,event:N})?.matchUps??[];for(let ue of ie){let{finishingPositionRange:ne,potentialParticipants:ge,tieMatchUps:he=[],sides:Ie=[],winningSide:xe,matchUpType:Je,matchUpId:qe,eventId:dt,drawId:ft,collectionId:je,containerStructureId:Tt,stageSequence:Oe,finishingRound:mt,matchUpStatus:Le,roundPosition:lt,roundNumber:it,structureId:Fe,schedule:Xe,score:ct,stage:We}=ue;D[qe]=ue;let ht={finishingPositionRange:ne,containerStructureId:Tt,finishingRound:mt,stageSequence:Oe,roundPosition:lt,collectionId:je,roundNumber:it,structureId:Fe,schedule:Xe,eventId:dt,drawId:ft,score:ct,stage:We};tee({...ht,...S,matchUpStatus:Le,winningSide:xe,matchUpType:Je,matchUpId:qe,sides:Ie});for(let xt of he){let{winningSide:pe,sides:Se=[],matchUpId:ye,matchUpStatus:ke,matchUpType:Ce}=xt;tee({...ht,...S,winningSide:pe,tieWinningSide:xe,matchUpTieId:qe,matchUpId:ye,sides:Se,matchUpSides:Ie,matchUpStatus:ke,matchUpType:Ce})}Array.isArray(ge)&&(J||f||p)&&ge.flat().map(ji).filter(Boolean)?.forEach(xt=>{w(xt)?.forEach(pe=>{l[pe]&&(l[pe].potentialMatchUps[qe]=Ft({tournamentId:n?.tournamentId,matchUpId:qe,eventId:dt,drawId:ft}))}),(f||p)&&Gfe({potential:!0,participantMap:l,participantId:xt,matchUpStatus:Le,roundPosition:lt,structureId:Fe,matchUpType:Je,roundNumber:it,matchUpId:qe,schedule:Xe,drawId:ft,score:ct})})}C.push(...ie)}}if(m||d||f){let N=Object.values(l);for(let k of N){let{wins:O,losses:x,[Er]:{wins:F,losses:_},[yr]:{wins:V,losses:G}}=k.counters,z=(Q,j,W)=>{let Y=j+W,X=j,J=Y&&X/Y;k.statistics[Q]={denominator:Y,numerator:X,statValue:J,statCode:Q}};if(m&&(z(Tk,O,x),z(`${Tk}.${Er}`,F,_),z(`${Tk}.${yr}`,V,G)),d){let Q=(j=[])=>Math.abs(j[0]-j[1]);for(let j of Object.keys(k.draws)){let{orderedStructureIds:W=[],flightNumber:Y}=R[j]||{};if(k.structureParticipation&&W.length){let X,J=0,ie=W.map(ue=>{let ne=k.structureParticipation[ue];if(!ne)return;X||(X=ne?.finishingPositionRange),Q(X)>Q(ne?.finishingPositionRange)&&(X=ne?.finishingPositionRange);let ge=ne.stage!==zt;return ge&&(J+=1),Ft({...ne,participationOrder:ge?J:void 0,flightNumber:Y})}).filter(Boolean);k.draws[j]&&(k.draws[j].finishingPositionRange=X,k.draws[j].structureParticipation=ie)}}}if(f){let Q=Ki(f)?f.scheduledMinutesDifference:0,j=k.scheduleItems||[],W=k.potentialMatchUps||{},Y=j.reduce((J,ie)=>{let{scheduledDate:ue,scheduledTime:ne}=ie;return J[ue]||(J[ue]=[]),ne&&J[ue].push(ie),J},{});Object.values(Y).forEach(J=>J.sort(kde));for(let J of j){let{typeChangeTimeAfterRecovery:ie,timeAfterRecovery:ue,scheduledDate:ne,scheduledTime:ge}=J,he=Y[ne],Ie=ar(ge);for(let xe of he){if(xe.matchUpId===J.matchUpId||Ms(xe.matchUpStatus)&&!xe.checkScoreHasValue)continue;let Je=J.matchUpType!==xe.matchUpType&&ie||ue,qe=J.drawId===xe.drawId,dt=W[J.matchUpId]&&W[xe.matchUpId],ft=ar(xe.scheduledTime),je=Math.abs(ft-Ie),Tt=ft>=Ie;if((Q&&!Number.isNaN(Q)?je<=Q:Tt&&ar(xe.scheduledTime)<ar(Je))&&!(dt&&qe)&&Tt){let Oe=[J.matchUpId,xe.matchUpId].sort(qF).join("|");k.scheduleConflicts[Oe]={priorScheduledMatchUpId:J.matchUpId,matchUpIdWithConflict:xe.matchUpId}}}}let X=k.participant.participantId;Object.keys(k.scheduleConflicts).length&&T.push(X),l[X].scheduleConflicts=k.scheduleConflicts}}}return{participantIdsWithConflicts:T,eventsPublishStatuses:E,derivedEventInfo:P,derivedDrawInfo:R,mappedMatchUps:D,participantMap:l,matchUps:C}}function fR({participantFilters:t={},tournamentRecord:e,participants:i=[]}){if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:s,participantRoles:o,participantRoleResponsibilities:l,participantTypes:c,participantIds:u,signInStatus:d,enableOrFiltering:p,eventIds:f,genders:h}=t,m=Ff(f)&&e?.events?.filter(y=>f?.includes(y.eventId))||e?.events||[],A=n&&T2e({drawEntryStatuses:n,tournamentEvents:m}),g=s&&C2e({eventEntryStatuses:s,tournamentEvents:m}),v=a!==void 0&&[!0,!1].includes(a)&&m.reduce((y,I)=>y.concat(...(I.drawDefinitions||[]).map(w=>Kpe({drawDefinition:w}).allPositionedParticipantIds).filter(Boolean)),[]),b=y=>r?.reduce((I,w)=>{let{accessor:S,value:T}=w,{values:D}=iy({element:y,accessor:S});return I&&D?.includes(T)},!0);if(i=i?.filter(y=>{let I=yu({element:y,itemType:Y1})?.timeItem?.itemValue,{participantRoleResponsibilities:w,participantType:S,participantRole:T,participantId:D,person:C}=y,E=Array.isArray(h)&&h?.length&&C?.sex&&h.includes(C.sex);return p?h&&E||a&&v.includes(D)||a===!1&&!v.includes(D)||A?.includes(D)||g?.includes(D)||u?.includes(D)||d&&I===d||c&&S&&Ff(c)&&c.includes(S)||o&&T&&Ff(o)&&o.includes(T)||l&&Ff(w)&&Ff(l)&&l.find(P=>w?.includes(P))||r?.length&&Ff(r)&&b(y):(!h||E)&&(a===void 0||a&&v.includes(D)||a===!1&&!v.includes(D))&&(!A||A.includes(D))&&(!g||g.includes(D))&&(!u||u.includes(D))&&(!d||I===d)&&(!c||S&&Ff(c)&&c.includes(S))&&(!o||T&&Ff(o)&&o.includes(T))&&(!l||Ff(w)&&Ff(l)&&l.find(P=>w?.includes(P)))&&(!r?.length||Ff(r)&&b(y))}),m.length&&f){let y=new Set(m.filter(I=>f.includes(I.eventId)).flatMap(I=>{let w=(I.entries||[]).map(T=>T.participantId);if($n(af)(I.eventType))return w;let S=(e?.participants??[]).filter(T=>w.includes(T.participantId)).flatMap(T=>T.individualParticipantIds);return w.concat(...S)}));i=i?.filter(I=>y.has(I.participantId))}return i}function Ff(t){return t&&Array.isArray(t)&&t.length}function T2e({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return Ci(e.reduce((r,n)=>{let{flightProfile:a}=Bn({event:n}),s=a?.flights?.flatMap(({drawEntries:l})=>Array.isArray(l)?l.filter(i).map(ji):[])||[],o=n.drawDefinitions?.map(({entries:l})=>l?l.filter(i).map(ji):[])||[];return r.concat(...s,...o)},[]))}function C2e({eventEntryStatuses:t,tournamentEvents:e}){return Ci(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(ji);return i.concat(...n)},[]))}function gn(t){let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:r,withRankingProfile:n,convertExtensions:a,policyDefinitions:s,withScheduleItems:o,tournamentRecord:l,scheduleAnalysis:c,withSignInStatus:u,withTeamMatchUps:d,withScaleValues:p,usePublishState:f,withStatistics:h,contextFilters:m,matchUpFilters:A,contextProfile:g,withOpponents:v,withMatchUps:b,internalUse:y,withSeeding:I,withEvents:w,withDraws:S,withISO2:T,withIOC:D}=t,C="getParticipants";if(!l)return le({stack:C,result:{error:rt}});(b||n)&&Rd({tournamentRecord:l});let E=ufe({convertExtensions:a,tournamentRecord:l,withSignInStatus:u,withScaleValues:p,internalUse:y,withISO2:T,withIOC:D}),{participantMap:P}=E,R=U2e({withMatchUps:b??n,withEvents:w??n,withDraws:S??n,withPotentialMatchUps:r,participantFilters:i,withRankingProfile:n,convertExtensions:a,withScheduleItems:o,policyDefinitions:s,tournamentRecord:l,scheduleAnalysis:c,withTeamMatchUps:d,usePublishState:f,withStatistics:h,contextFilters:m,matchUpFilters:A,participantMap:P,withOpponents:v,contextProfile:g,withSeeding:I}),{participantIdsWithConflicts:M,eventsPublishStatuses:N,derivedEventInfo:k,derivedDrawInfo:O,mappedMatchUps:x}=R,F=R.matchUps;P=R.participantMap;let _=c??r,V=({potentialMatchUps:Y,scheduleConflicts:X,scheduleItems:J,participant:ie,statistics:ue,opponents:ne,matchUps:ge,events:he,draws:Ie})=>{let xe=Object.values(Ie),Je=Object.values(ne);return v&&xe?.forEach(qe=>{qe.opponents=Je.filter(dt=>dt.drawId===qe.drawId)}),Ft({...ie,scheduleConflicts:c?Object.values(X):void 0,draws:S||n?xe:void 0,events:w||n?Object.values(he):void 0,matchUps:b||n?Object.values(ge):void 0,opponents:v?Je:void 0,potentialMatchUps:_?Object.values(Y):void 0,statistics:h?Object.values(ue):void 0,scheduleItems:o?J:void 0},!1,!1,!0)},G=new Map;for(let Y of Object.keys(P))G.set(Y,V(P[Y]));let z=[...G.values()],Q=s?.[OC]?.participant,j=fR({participants:z,participantFilters:i,tournamentRecord:l});if(e){let Y=Ki(e)?e:void 0;for(let X of j)for(let J of X.individualParticipantIds??[]){X.individualParticipants??=[];let ie=G.get(J),ue=Y?VI({template:Y,source:ie}):ie;X.individualParticipants.push(ue)}}let W=Q?j.map(Y=>VI({source:Y,template:Q})):j;return{participantMap:t.returnParticipantMap!==!1?P:void 0,mappedMatchUps:t.returnMatchUps!==!1?x:void 0,matchUps:t.returnMatchUps!==!1?F:void 0,missingParticipantIds:E.missingParticipantIds,participantIdsWithConflicts:M,eventsPublishStatuses:N,derivedEventInfo:k,derivedDrawInfo:O,participants:W,...se}}function zI(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:ga};let{participant:a,tournamentId:s}=zg({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...rh({participant:a,scaleAttributes:i}),tournamentId:s}:{error:On}}function E2e(t,e){let i=t.startDate||e?.startDate,r=t.endDate||e?.endDate;return!i||!r?{error:dOe}:!Co(i)||!Co(r)?{error:fa}:{startDate:i,endDate:r}}function iee(t,e){let i=new Date(Si(t)),r=new Date(Si(e)),n=r.getFullYear()-i.getFullYear(),a=r.getMonth()-i.getMonth();return(a<0||a===0&&r.getDate()<i.getDate())&&n--,n}function ree(t,e,i){return!(e!==void 0&&t<e||i!==void 0&&t>i)}function D2e(t){return/^C\d{1,2}-\d{1,2}$/.test(t.ageCategoryCode||"")}function P2e(t,e,i,r){if(D2e(e))return{valid:!0};let n=e.ageMin,a=e.ageMax;if(e.ageCategoryCode&&!n&&!a){let d=yy({consideredDate:i,category:e});d.error||(n=d.ageMin,a=d.ageMax)}if(!n&&!a)return{valid:!0};let s=t.person?.birthDate;if(!s)return{valid:!1,reason:"Missing birthDate",details:{requiredMin:n,requiredMax:a}};let o=iee(s,i),l=iee(s,r),c=ree(o,n,a),u=ree(l,n,a);if(!c){let d=[n===void 0?null:`min: ${n}`,a===void 0?null:`max: ${a}`].filter(Boolean).join(", ");return{valid:!1,reason:`Age ${o} at event start (${i}) outside range [${d}]`,details:{birthDate:s,ageAtStart:o,ageAtEnd:l,requiredMin:n,requiredMax:a}}}if(!u){let d=[n===void 0?null:`min: ${n}`,a===void 0?null:`max: ${a}`].filter(Boolean).join(", ");return{valid:!1,reason:`Age ${l} at event end (${r}) outside range [${d}]`,details:{birthDate:s,ageAtStart:o,ageAtEnd:l,requiredMin:n,requiredMax:a}}}return{valid:!0}}function R2e(t,e,i,r){if(!e.ratingMin&&!e.ratingMax)return{valid:!0};if(!e.ratingType)return{valid:!0};let n={scaleType:"RATING",scaleName:e.ratingType,eventType:i.eventType},{scaleItem:a}=zI({tournamentRecord:r,participantId:t.participantId,scaleAttributes:n});if(!a?.scaleValue)return{valid:!1,reason:`Missing ${e.ratingType} rating`,details:{ratingType:e.ratingType,requiredMin:e.ratingMin,requiredMax:e.ratingMax}};let s;if(typeof a.scaleValue=="object"){let o=iy({element:a.scaleValue,accessor:a.scaleValue?.accessor});if(o===void 0)return{valid:!1,reason:`Cannot extract rating value from ${e.ratingType} scale item`,details:{ratingType:e.ratingType,requiredMin:e.ratingMin,requiredMax:e.ratingMax}};s=o}else s=a.scaleValue;return e.ratingMin!==void 0&&s<e.ratingMin?{valid:!1,reason:`${e.ratingType} rating ${s} below minimum ${e.ratingMin}`,details:{ratingType:e.ratingType,ratingValue:s,requiredMin:e.ratingMin,requiredMax:e.ratingMax}}:e.ratingMax!==void 0&&s>e.ratingMax?{valid:!1,reason:`${e.ratingType} rating ${s} above maximum ${e.ratingMax}`,details:{ratingType:e.ratingType,ratingValue:s,requiredMin:e.ratingMin,requiredMax:e.ratingMax}}:{valid:!0}}function M2e(t){let e=t.person;if(!e)return"Unknown";let i=e.standardGivenName||e.passportGivenName,r=e.standardFamilyName||e.passportFamilyName;return[i,r].filter(Boolean).join(" ")||"Unknown"}function N2e(t,e,i,r,n,a){let s=P2e(t,e,r,n),o=R2e(t,e,i,a);if(!s.valid||!o.valid){let l={participantId:t.participantId,participantName:M2e(t),rejectionReasons:[]};return s.valid||l.rejectionReasons.push({type:"age",reason:s.reason,details:s.details||{}}),o.valid||l.rejectionReasons.push({type:"rating",reason:o.reason,details:o.details||{}}),l}return null}function gI({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){if(!e)return{error:Bt};let n=e.entries?.find(a=>a.participantId===t&&(!i||i===a.entryStatus)&&(!r||r===a.entryStage));return t&&n}function B2e({relevantLinks:t,drawDefinition:e,provisionalPositioning:i,roundQualifiersCounts:r}){let n=0;for(let a of t){let s=ui({structureId:a.source.structureId,drawDefinition:e})?.structure;if(s?.stage===zt){let o=a.source.roundNumber,l=a.target.roundNumber,c;if(s.structureType===Ao){let u=s.structures?.length??0,d=a.source.finishingPositions?.length??0;c=u*d}else c=cr({matchUpFilters:{roundNumbers:[o]},structure:s,afterRecoveryTimes:!1,provisionalPositioning:i,inContext:!1}).matchUps?.length||0;r[l]||(r[l]=0),r[l]+=c,n+=c}}return n}function QC(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,structureId:n,stage:a}=t;if(!i)return{error:Bt};let{entryProfile:s}=J1({drawDefinition:i}),o=a&&r&&s?.[a]?.stageSequence?.[r]?.qualifiersCount||a&&s?.[a]?.qualifiersCount||0,l={};if(!n)return{qualifiersCount:o,roundQualifiersCounts:l};let{structure:c}=ui({drawDefinition:i,structureId:n}),u=i.links?.filter(f=>f?.target?.structureId===c?.structureId),d=0;u?.length&&(d=B2e({relevantLinks:u,drawDefinition:i,provisionalPositioning:e,roundQualifiersCounts:l}));let p=Object.keys(l);if(p.length<=1){let f=p[0]||1;l[f]=Math.max(l[f]||0,o)}return d=Math.max(d,o),{qualifiersCount:d,roundQualifiersCounts:l}}function Vx({stage:t,drawDefinition:e}){let{entryProfile:i}=J1({drawDefinition:e});return i?.[t]?.drawSize||0}function k2e(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=Vx({stage:n,drawDefinition:i}),{qualifiersCount:s}=QC({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-s}function Qfe({stage:t,drawDefinition:e}){return!!(t===Ya||BW({stage:t,drawDefinition:e})&&Vx({stage:t,drawDefinition:e}))}function jfe({entryStatus:t=Il,drawDefinition:e,stageSequence:i,stage:r}){if(t===rd)return yLe({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...se}:{error:Wue};let n=k2e({drawDefinition:e,stageSequence:i,stage:r}),a=bLe({drawDefinition:e,stage:r}),s=Ej({entryStatus:UT,drawDefinition:e,stage:r}),o=Ej({entryStatus:Il,drawDefinition:e,stage:r}),l=s+o,c=l>=n,u=n-l;return r!==Ya&&c?{error:Aj}:t===UT?s<a?{...se}:{error:Aj}:{positionsAvailable:u,...se}}function zW(t){let e=Gt(t,[{[to]:!0,[Mpe]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:r=Il,entryStageSequence:n,entryStage:a=Ut,ignoreStageSpace:s,drawDefinition:o,entryPosition:l,participant:c,roundTarget:u,extensions:d,extension:p,drawType:f,event:h}=t,m="addDrawEntry";if(f!==zl&&!Qfe({stage:a,drawDefinition:o}))return le({result:{error:eb},stack:m});let A=jfe({stageSequence:n,stage:a,drawDefinition:o,entryStatus:r});if(!s&&!A.success&&(!f||f!==zl))return{error:A.error};if(p&&!of({extension:p}))return le({result:{error:be},info:"Invalid extension",context:{extension:p},stack:m});let g=t.participantId||c?.participantId;if(!g)return le({result:{error:ga},stack:m});let v=r===Lm&&gI({participantId:g,drawDefinition:o,entryStatus:r}),b=a===Ya&&gI({participantId:g,drawDefinition:o,entryStage:a}),y=gI({participantId:g,drawDefinition:o}),I=r!==Lm&&a!==Ya&&y;if(I)return i?(bi({payload:{drawId:o.drawId,eventId:h?.eventId,error:q0,participantId:g},topic:mW}),{...se}):le({result:{error:q0},context:{participantId:g},stack:m});if(v||b)return le({context:{invalidEntry:I,invalidLuckyLoser:v,invalidVoluntaryConsolation:b},result:{error:nF},stack:m});let w=Ft({entryStageSequence:n,participantId:g,entryPosition:l,entryStatus:r,entryStage:a,extensions:d});return p&&lr({element:w,extension:p}),u&&lr({extension:{name:"roundEntry",value:u},element:w}),o.entries||(o.entries=[]),o.entries.push(w),Br({drawDefinition:o}),{...se}}function x2e(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=Il,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:s,drawDefinition:o,stageSequence:l,stage:c=Ut,roundTarget:u,extension:d,event:p}=t,f=o.drawType===zl;if(!c)return{error:Uue};if(!o)return{error:Bt};if(!Array.isArray(s))return{error:Fl};if(!f&&!Qfe({stage:c,drawDefinition:o}))return{error:eb};if(d&&!of({extension:d}))return le({result:{error:be},info:"Invalid extension",context:{extension:d},stack:e});let h=jfe({drawDefinition:o,stageSequence:l,entryStatus:r,stage:c});if(!a&&!h.success&&!f)return{error:h.error};let m=h.positionsAvailable??0;if(!a&&!f&&c!==Ya&&m<s.length)return{error:hq};let A=[],g=o.drawId,v=p?.eventId,b=s.reduce((y,I)=>{let w=r===Lm&&gI({participantId:I,drawDefinition:o,entryStatus:r}),S=c===Ya&&gI({entryStage:c,drawDefinition:o,participantId:I}),T=gI({participantId:I,drawDefinition:o});return r!==Lm&&c!==Ya&&T&&(A.push(I),i&&bi({payload:{error:q0,participantId:I,eventId:v,drawId:g},topic:mW})),w||S?y.concat(I):y},[]);return A.length&&!i?le({context:{eventId:v,drawId:g,duplicateEntries:A},result:{error:q0},stack:e}):(s.filter(y=>y&&!b.includes(y)).forEach(y=>{let I={entryStageSequence:l,entryStage:c,participantId:y,entryStatus:r};d&&lr({element:I,extension:d}),u&&lr({extension:{name:Ef,value:u},element:I}),o.entries||(o.entries=[]),o.entries.push(I)}),n&&(o.entries=Xd({entries:o.entries})),Br({drawDefinition:o}),b?.length||A?.length?{info:"some participantIds could not be added",participantIdsNotAdded:b,duplicateEntries:A,...se}:{...se})}function qW({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,entryStage:l,extension:c,drawId:u,event:d}){if(!n?.length)return{error:Lg};if(!d)return{error:cu};if(!u)return{error:fp};let p=(d.entries||[]).map(ji);if(n.filter(m=>!p.includes(m)).length)return{error:wue};if(a){let m=x2e({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,extension:c});if(m.error)return m}let{flightProfile:f}=Bn({event:d}),h=f?.flights.find(m=>m.drawId===u);return h?.drawEntries&&(n.forEach(m=>{let A=s===Lm&&bV({participantId:m,entryStatus:s,flight:h}),g=l===Ya&&bV({participantId:m,entryStage:l,flight:h});!(s!==Lm&&l!==Ya&&bV({flight:h,participantId:m}))&&!A&&!g&&h.drawEntries.push({participantId:m,entryStatus:s,entryStage:l})}),e&&(h.drawEntries=Xd({entries:h.drawEntries}))),{...se}}function bV({participantId:t,entryStatus:e,entryStage:i,flight:r}){let n=r.drawEntries?.find(a=>a.participantId===t&&(!e||e===a.entryStatus)&&(!i||i===a.entryStage));return t&&n}function hR({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){let a="removeEventEntries";if(!n?.eventId)return{error:Vr};if(!Array.isArray(e)||e.some(d=>!Lr(d)))return le({result:{error:np},stack:a});let s=(n.drawDefinitions??[]).flatMap(d=>cb({drawDefinition:d}).assignedParticipantIds??[]),o=(i?.length&&n.entries?.filter(d=>d.entryStatus&&i.includes(d.entryStatus))||[]).map(ji).filter(d=>!s.includes(d)),l=(r&&n.entries?.filter(d=>d.entryStage&&d.entryStage===r)||[]).map(ji).filter(d=>!s.includes(d));if(e.length?e=e.filter(d=>(!i?.length||o.includes(d))&&(!r||l.includes(d))):o.length&&l.length?e=Pn(o,l):o.length?e=o:l.length&&(e=l),e?.length&&s.some(d=>e.includes(d)))return le({result:{error:RC},stack:a});if(!e?.length)return{...se,participantIdsRemoved:[]};let c=[];n.entries=(n.entries??[]).filter(d=>{let p=!e.includes(d?.participantId);return p||c.push(d.participantId),p}),t&&(n.entries=Xd({entries:n.entries}));let{flightProfile:u}=Bn({event:n});return u?.flights?.forEach(d=>{d.drawEntries=(d.drawEntries||[]).filter(p=>!e.includes(p.participantId))}),n.drawDefinitions?.forEach(d=>{d.entries=(d.entries??[]).filter(p=>!e.includes(p.participantId))}),{...se,participantIdsRemoved:c}}var zfe={[Xa]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},jC=zfe;function _2e(t,e,i,r){return e.gender&&i&&!(Uc(e.gender)||fh(e.gender))&&Ws(e.gender)!==Ws(t.person?.sex)?(r.push({participantId:t.participantId,sex:t.person?.sex}),!1):!0}function O2e({participantIds:t,typedParticipantIds:e,checkTypedParticipants:i}){return t.filter(r=>!i||e.includes(r))}function F2e({tournamentRecord:t,participantIds:e,event:i,entryStatus:r,genderEnforced:n,mismatchedGender:a}){function s(u,d,p){return $n(Er)(d.eventType)&&u.participantType===zi&&!Gv(p)}function o(u,d,p){return d.eventType===yr&&u.participantType===Mi&&!Gv(p)}function l(u,d,p,f,h){return d.eventType===yr&&u.participantType===zi&&Gv(p)?d.gender&&f&&!(Uc(d.gender)||fh(d.gender))&&Ws(d.gender)!==Ws(u.person?.sex)?(h.push({participantId:u.participantId,sex:u.person?.sex}),!1):!0:!1}function c(u,d,p){return d.eventType===gr&&(u.participantType===gr||Gv(p)&&u.participantType===zi)}return t?.participants?.filter(u=>e.includes(u.participantId)?s(u,i,r)&&(!i.gender||!n||Uc(i.gender)||fh(i.gender)||Ws(i.gender)===Ws(u.person?.sex))||o(u,i,r)||l(u,i,r,n,a)?!0:s(u,i,r)&&!_2e(u,i,n,a)?!1:c(u,i,r):!1).map(u=>u.participantId)??[]}function L2e({typedParticipantIds:t,categoryRejections:e,tournamentRecord:i,startDate:r,endDate:n,event:a}){let s=[];for(let o of t){let l=i.participants?.find(c=>c.participantId===o);if(l)if(a.category){let c=N2e(l,a.category,a,r,n,i);c?e.push(c):s.push(o)}else s.push(o)}return s}function $2e({enforceCategory:t,event:e,tournamentRecord:i,typedParticipantIds:r,categoryRejections:n}){if(t&&e.category&&i){let a=E2e(e,i);if(!("error"in a)){let{startDate:s,endDate:o}=a;return L2e({typedParticipantIds:r,tournamentRecord:i,event:e,startDate:s,endDate:o,categoryRejections:n})}}return r}function H2e({validParticipantIds:t,existingIds:e,entryStatus:i,entryStage:r,extensions:n,extension:a,roundTarget:s,entryStageSequence:o,addedParticipantIdEntries:l,event:c}){t.forEach(u=>{if(!e.has(u)){let d=Ft({participantId:u,entryStatus:i,entryStage:r,extensions:n});a&&lr({element:d,extension:a}),s&&lr({extension:{name:Ef,value:s},element:d}),o&&(d.entryStageSequence=o),l.push(d.participantId),c.entries?.push(d)}})}function V2e({tournamentRecord:t,removedEntries:e,event:i}){if(i.eventType&&[Bm,jl].includes(i.eventType)){let r=new Set((i.entries||[]).map(l=>l.participantId)),n=(i.entries||[]).filter(l=>Gv(l.entryStatus)).map(l=>l.participantId),a=t?.participants??[],s=new Set(a.filter(l=>r.has(l.participantId)&&l.participantType&&[Mi,gr].includes(l.participantType)).map(l=>l.individualParticipantIds).flat(1/0)),o=n.filter(l=>s.has(l));o.length&&(e.push(...o),hR({participantIds:o,autoEntryPositions:!1,event:i}))}}function G2e(t,e){if(!Array.isArray(t.participantIds))return le({result:{error:Fl},stack:e});let i=Ci(t.participantIds??[]);return t.event?i?.length?t.event?.eventId?{participantIds:i}:{error:cu}:le({result:{error:Lg},stack:e}):{error:Vr}}function Q2e({policyDefinitions:t,tournamentRecord:e,event:i,enforceGender:r}){let n=er({tournamentRecord:e,event:i}).appliedPolicies??{},a=t?.[Xa]??n?.[Xa]??jC[Xa],s=(r??a?.participants?.enforceGender)!==!1;return{matchUpActionsPolicy:a,genderEnforced:s}}function j2e(t,e,i){return t&&(!Array.isArray(t)||!t.every(r=>of({extension:r})))||e&&!of({extension:e})?le({context:Ft({extension:e,extensions:t}),result:{error:be},info:"Invalid extension(s)",stack:i}):null}function zp(t){let{suppressDuplicateEntries:e=!0,entryStatus:i=Il,autoEntryPositions:r=!0,enforceCategory:n=!1,enforceGender:a=!0,entryStageSequence:s,policyDefinitions:o,entryStage:l=Ut,tournamentRecord:c,ignoreStageSpace:u,drawDefinition:d,roundTarget:p,extensions:f,extension:h,drawId:m,event:A}=t,g="addEventEntries",v=G2e(t,g);if("error"in v)return v;let b="participantIds"in v?v.participantIds:[],y=j2e(f,h,g);if(y)return y;let{genderEnforced:I}=Q2e({policyDefinitions:o,tournamentRecord:c,event:A,enforceGender:a}),w=[],S=[],T=!!c,D=[],C,E=F2e({tournamentRecord:c,participantIds:b,event:A,entryStatus:i,genderEnforced:I,mismatchedGender:D}),P=[];E=$2e({enforceCategory:n,event:A,tournamentRecord:c,typedParticipantIds:E,categoryRejections:P});let R=O2e({participantIds:b,typedParticipantIds:E,checkTypedParticipants:T});A.entries??=[];let M=new Set(A.entries.map(O=>O.participantId||O.participant?.participantId));if(H2e({validParticipantIds:R,existingIds:M,entryStatus:i,entryStage:l,extensions:f,extension:h,roundTarget:p,entryStageSequence:s,addedParticipantIdEntries:w,event:A}),m&&!Gv(l)){let O=qW({participantIds:R,suppressDuplicateEntries:e,autoEntryPositions:r,entryStageSequence:s,ignoreStageSpace:u,drawDefinition:d,entryStatus:i,roundTarget:p,entryStage:l,extension:h,drawId:m,event:A});O.error&&(C=O.error)}if(V2e({event:A,tournamentRecord:c,removedEntries:S}),R.length!==b.length)return le({context:Ft({categoryRejections:P.length?P:void 0,mismatchedGender:D.length?D:void 0,gender:A.gender}),result:{error:Fl},stack:g});r&&(A.entries=Xd({entries:A.entries||[]}));let N=w.length,k=S.length;return le({result:{...se,addedEntriesCount:N,removedEntriesCount:k,...P.length&&{context:Ft({categoryRejections:P})}},stack:g,info:C})}var qfe="ADMINISTRATION",z2e="CAPTAIN",q2e="COACH",Ns="COMPETITOR",Wfe="MEDIA",Kfe="MEDICAL",WW="OFFICIAL",Yfe="OTHER",Xfe="SECURITY",Yg={ADMINISTRATION:qfe,CAPTAIN:z2e,COACH:q2e,COMPETITOR:Ns,MEDIA:Wfe,MEDICAL:Kfe,OFFICIAL:WW,OTHER:Yfe,SECURITY:Xfe};function KW({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return le({result:{error:rt},stack:a});if(!i||!e)return le({result:{error:Kt},stack:a});let s=(r.participants??[]).find(u=>u.participantId===i);if(!s)return le({result:{error:On},stack:a});if(![gr,xc].includes(s.participantType))return le({result:{participantType:s.participantType,error:ap},stack:a});let o=Zfe({individualParticipantIds:e,groupingParticipant:s,tournamentRecord:r,suppressErrors:n}),{removed:l,error:c}=o;if(c)return le({result:o,stack:a});if(t)for(let u of r.events??[]){let d=(u.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l?.filter(f=>!d.includes(f));zp({participantIds:p,entryStatus:bu,tournamentRecord:r,event:u})}}return l&&bi({topic:Fs,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...se,...o}}function Zfe({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){let s=[];if(!e)return{removed:s};let o=[],l=[];a||({participants:a,mappedMatchUps:n}=gn({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let c=a?.find(({participantId:p})=>p===e.participantId)?.events?.map(({eventId:p})=>p),u=(e.individualParticipantIds??[]).filter(p=>{let f=t?.includes(p),h=f&&a?.find(A=>A.participantId===p)?.matchUps.filter(({eventId:A})=>c.includes(A)).map(({matchUpId:A})=>n?.[A]).filter(({winningSide:A,score:g})=>A||ya({score:g})),m=f&&!h?.length;if(f&&!m&&l.push(p),m){s.push(p);for(let A of i.events??[])for(let g of A.drawDefinitions??[]){let{extension:v}=Bi({element:g,name:xm}),b=v?.value[e.participantId];v&&b&&(v.value[e.participantId]=b.filter(I=>I.participantId!==p),lr({element:g,extension:v}),W1({drawDefinition:g}));let y=Do({drawDefinition:g,inContext:!1}).matchUps??[];for(let I of y){let w=I.sides??[];for(let S of w){let T=S.lineUp??[];T.find(D=>D.participantId===p)&&(S.lineUp=T.filter(D=>D.participantId!==p),Yi({tournamentId:i?.tournamentId,drawDefinition:g,matchUp:I}))}}}}else o.push(p);return!m});e.individualParticipantIds=u;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:o,removed:s};return l.length&&!r&&{...d,cannotRemove:l,error:iF}||d}function WF({participantRole:t=Ns,individualParticipantIds:e=[],groupingTypes:i=[zo,xc],tournamentRecord:r}){if(!r)return{error:rt};let n=r.participants??[],{participants:a,mappedMatchUps:s}=gn({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),o=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:c}=Zfe({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:s,participants:a});c&&o++}),o?se:{error:Gue}}function Hw(t){let e=Gt(t,[{[Sa]:!0},{participantIds:!0,[il]:zs,[id]:Lg}]);if(e.error)return e;let{addIndividualParticipantsToEvents:i,tournamentRecord:r,participantIds:n}=t,a=r.participants?.length||0;if(!a)return{...se};let s=(r.events||[])?.filter(({eventType:h})=>h===ca).map(h=>h?.drawDefinitions?.map(({drawId:m})=>m)).flat(1/0),o=gn({participantFilters:{participantIds:n},tournamentRecord:r,withDraws:!0}).participants??[],l=h=>{let m=(La({matchUpFilters:{drawIds:h,matchUpTypes:[yr]},tournamentRecord:r}).matchUps??[]).flatMap(({sides:A})=>A?.map(({participantId:g})=>g||[])).filter(Boolean);return Pn(m,n)},c=s?.length?l(s):[],u=o.filter(h=>h.draws?.filter(m=>(!s?.length||!s?.includes(m.drawId))&&m.positionAssignments).length);if(c?.length||u.length)return{error:RC};let d={},p={};for(let h of r.events||[]){let m=hR({participantIds:n,event:h});if(m.error)return m;d[h.eventId]=m.participantIdsRemoved}r.participants=(r.participants??[]).filter(h=>{let m=n.includes(h.participantId)||h.participantType===Mi&&h.individualParticipantIds?.some(A=>n.includes(A));if(!m&&h.participantType===ca&&h.individualParticipantIds?.some(A=>n.includes(A))&&(h.individualParticipantIds=h.individualParticipantIds.filter(A=>!n.includes(A))),m&&i&&h.participantType&&[Mi,gr].includes(h.participantType))for(let A of h.individualParticipantIds||[])n.includes(A)||(p[h.participantId]||(p[h.participantId]=[]),p[h.participantId].push(A));return!m});let f=a-r.participants.length;if(WF({individualParticipantIds:n,tournamentRecord:r}),i)for(let h of r.events||[]){let m=d[h.eventId].map(A=>p[A]||[]).flat();zp({participantIds:m,entryStatus:bu,tournamentRecord:r,event:h})}return f&&bi({payload:{participantIds:n,tournamentId:r.tournamentId},topic:AW}),f?{...se,participantsRemovedCount:f}:{error:iF}}function Jfe({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){let s=n.entries??[];if(r){let{flightProfile:l}=Bn({event:n}),c=l?.flights?.find(u=>u.drawId===r);c?s=c.drawEntries:e.entries&&(s=e?.entries)}let o=s.filter(l=>(!i?.length||!l.entryStatus||i.includes(l.entryStatus))&&(!a||!l.entryStage||l.entryStage===a)&&(!t||l.entryStatus&&Pd.includes(l.entryStatus)));return{entries:s,stageEntries:o}}function ehe({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:s}){let o="destroyGroupEntry";if(!e)return{error:rt};if(!r)return le({result:{error:ga},stack:o});if(!s)return{error:Vr};if(!s.eventType||![Bm,jl].includes(s.eventType))return le({result:{error:ph},stack:o});let l=e.participants??[],c=l.find(g=>g.participantId===r);if(!c)return le({result:{error:On},stack:o});if(!c.participantType||![Mi,zo].includes(c.participantType)||c.participantType===zo&&s.eventType!==jl||c.participantType===Mi&&s.eventType!==Bm)return{error:ap};let u=(s.entries??[]).find(g=>g.participantId===r);if(!u)return{error:que};let{stageEntries:d}=Jfe({selected:!1,drawDefinition:i,drawId:n,event:s,stage:a}),p=d.map(ji),f=l.filter(({participantId:g})=>p.includes(g)).map(({individualParticipantIds:g})=>g).flat().filter(Boolean),h=c.individualParticipantIds?.filter(g=>Qp(g,f).length===1),m=hR({participantIds:[r],event:s});if(m.error||h?.length&&(m=zp({participantIds:h,entryStatus:bu,entryStage:u.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:s}),m.error))return m;let A;return t&&Hw({participantIds:[r],tournamentRecord:e}).success&&(A=!0),{...se,participantRemoved:A}}function YW({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return ehe({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function the(t){if(!t.tournamentRecord)return{error:rt};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let s=ehe({participantId:a,...i});s.success&&(r+=1),s.error&&n.push(s.error)}return r?{destroyedCount:r,...se}:{error:n}}function hP(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:s,drawId:o}=t,l="removeDrawPositionAssignment",c=dR(t);if(c.error)return le({result:c,stack:l});let{participantId:u}=c,{drawPosition:d,event:p,structureId:f}=t,h=er({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([rd,Ih].includes(a)&&u){let{tournamentRecord:A}=t,{participant:g}=zg({tournamentRecord:A,participantId:u}),{participantType:v,individualParticipantIds:b}=g??{};if(n&&v===Mi){let y=YW({tournamentRecord:A,drawDefinition:r,participantId:u,event:p});if(y.error)return le({result:y,stack:l});b&&Hx({participantIds:b,tournamentRecord:A,drawDefinition:r,entryStatus:a,drawId:o,event:p})}else Hx({participantIds:[u],tournamentRecord:A,drawDefinition:r,entryStatus:a,drawId:o,event:p})}if(i){let A=Oc({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:f,matchUpsMap:s,event:p});if(A.error)return le({result:A,stack:l})}let{structure:m}=ui({drawDefinition:r,structureId:f});return EW({structure:m,drawPositions:[d]}),K1({appliedPolicies:h,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:f}}),c}function ihe(t){return Object.assign(t,{entryStatus:Ih}),hP(t)}var ag=({finishingPosition:t=Rw,hasExistingDrawDefinition:e,qualifyingRoundNumber:i,structureAbbreviation:r,seedAssignments:n=[],stageSequence:a=1,qualifyingOnly:s,structureOrder:o,seedingProfile:l,matchUpFormat:c,structureType:u,structureName:d,matchUps:p=[],matchUpType:f,structureId:h,roundOffset:m,roundLimit:A,stageOrder:g,structures:v,tieFormat:b,stage:y})=>{let I={structureId:h??fr(),structureAbbreviation:r,finishingPosition:t,seedAssignments:n,matchUpFormat:c,stageSequence:a,structureName:d};(s||e&&b)&&(I.tieFormat=b),o&&(I.structureOrder=o),u&&(I.structureType=u),l&&(typeof l=="string"?I.seedingProfile=l:typeof l=="object"&&typeof l.positioning=="string"&&(I.seedingProfile=l.positioning)),f&&(I.matchUpType=f),m&&(I.roundOffset=m),g&&(I.stageOrder=g),A&&(I.roundLimit=A),y&&(I.stage=y),i&&(I.qualifyingRoundNumber=i);let w=p.flatMap(({drawPositions:S})=>S).filter(Boolean);return v?I.structures=v:(I.matchUps=p,I.positionAssignments=Ci(w).sort((S,T)=>S-T).map(S=>({drawPosition:S}))),I},iu=ag;function kj(t){return Lr(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function Bs(t){return Lr(t)?kj(t.replace(/_/g," ")):""}function XW({structureName:t=Bs(Ya),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:Bt};let a=iu({stage:Ya,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),Br({drawDefinition:i,structureIds:[a.structureId]}),{...se}}function W2e({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(la),e.reverse(),e}function K2e({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function Y2e({positioning:t,size:e}){let i=W2e({size:e}),r=[],n=[],a=p=>p[0],s=p=>p[p.length-1],o=(p,f)=>(t&&[$1,AF,by].includes(t)&&f%2?s(p):a(p))||a(p),l=(p,f)=>{if(p.every(h=>!n.includes(h))){let h=o(p,f);return n.push(h),h}},c=p=>{let f=p.filter(h=>!n.includes(h));if(f.length)return n.push(...f),f},u=(p,f)=>{let h=o(p,f);if(!n.includes(h))return n.push(h),h},d=gt(1,e+1);for(let p of i)if(p===1){let f=Oa(d,2),h=f.map(l).filter(Boolean);h.length&&r.push(h);let m=f.flatMap(c).filter(Boolean);m.length&&r.push(m)}else{let f=Oa(d,p).map(u).filter(Boolean);f.length&&r.push(f)}return{divisions:i,divisionGroupings:r}}function ZW({drawPositions:t}){if(!t?.length)return{error:P1};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=Ci(i.map(KF)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function KF(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(la).join("|")}function rhe({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,f)=>f),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),s=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((A,g)=>{n[p].push([a[g],s[g]])});let f=a.shift(),h=a.pop(),m=s.shift();a=[f,m,...a].filter(Boolean),s=[...s,h].filter(Boolean)});let o=a.shift(),l=a.pop(),c=s.shift();a=[o,c,...a].filter(Boolean),s=[...s,l].filter(Boolean);let u=d=>d[0].reduce((p,f)=>p+f);return[...n].reverse().sort((d,p)=>u(d)-u(p)).map(d=>d.filter(p=>p.every(f=>f<=t)).map(p=>{let f=p.map(h=>h+e);return KF(f)}))}function X2e({rounds:t,hash:e}){return t?.length?t?.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Kt}}var Z2e={getRoundRobinGroupMatchUps:ZW,determineRoundNumber:X2e,drawPositionsHash:KF,groupRounds:rhe};function mR(t){let{hasExistingDrawDefinition:e,groupNameBase:i="Group",playoffAttributes:r,stageSequence:n=1,structureOptions:a,appliedPolicies:s,qualifyingOnly:o,seedingProfile:l,stage:c=Ut,matchUpType:u,roundTarget:d,structureId:p,groupNames:f,tieFormat:h,drawSize:m,idPrefix:A,isMock:g,uuids:v}=t,b=t.structureName??r?.["0"]?.name??Bs(Ut),{groupCount:y,groupSize:I}=J2e({structureOptions:a,appliedPolicies:s,drawSize:m}),w=wy,S,T=gt(1,y+1).map(C=>{let E=e$e({groupSize:I,structureOrder:C,matchUpType:u,drawSize:m,idPrefix:A,isMock:g});S=Array.isArray(E)?Math.max(...E.map(({roundNumber:R})=>R??0)):0;let P=f?.[C-1]??`${i} ${C}`;return ag({structureId:v?.pop(),hasExistingDrawDefinition:e,structureType:gF,finishingPosition:w,qualifyingOnly:o,structureOrder:C,structureName:P,tieFormat:h,matchUps:E})}),D=ag({structureId:p??v?.pop(),hasExistingDrawDefinition:e,structureType:Ao,finishingPosition:w,seedingProfile:l,structureName:b,stageSequence:n,structures:T,tieFormat:h,stage:c});return d&&lr({extension:{name:Ef,value:d},element:D}),{structures:[D],maxRoundNumber:S,groupCount:y,links:[],groupSize:I,...se}}function J2e({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e?.groupSize,n=e?.groupSizeLimit||8,{validGroupSizes:a}=AR({groupSizeLimit:n,drawSize:i}),s=a&&Math.max(...a);r&&a?.includes(r)||(r&&r>4||!a?.includes(4)?r=s:r=4);let o=Math.ceil(i/r);return{groupSize:r,groupCount:o}}function AR(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=gt(3,e+1).filter(n=>{let a=Math.ceil(i/n),s=a*n-i,o=Math.ceil(i/a),l=Math.ceil(s/a);return(!s||s<n)&&o===n&&o>=3&&l<2});return{...se,validGroupSizes:r}}function e$e({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:s}){let o=(t-1)*i,l=gt(1+o,i+1+o),c=ZW({drawPositions:l}).uniqueMatchUpGroupings??[],u=rhe({groupSize:i,drawPositionOffset:o});return c.map(p).sort((f,h)=>(f.roundNumber??1/0)-(h.roundNumber??1/0));function d(f){return u.reduce((h,m,A)=>m.includes(f)?A+1:h,void 0)}function p(f){let h=KF(f),m=d(h),A=[1,r],g=t$e({structureOrder:t,drawPositions:f,roundNumber:m,idPrefix:n,uuids:s}),v={matchUpStatus:m?Rn:"BYE",matchUpType:e,finishingPositionRange:{winner:A,loser:A},drawPositions:f,roundNumber:m,matchUpId:g};return a&&(v.isMock=!0),v}}function t$e({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:n?.pop()||fr()}function JW(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!yi(i))return{seedBlocks:void 0,...le({result:{error:be},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=CC(i);if(e){let f=Math.min(e,n),h=[],m=1;for(gt(0,f).forEach(()=>{h.push([m]),m++});m<n;){let A=gt(m,m+f);m+=f,h.push(A)}return{...se,seedBlocks:h}}let a=gt(1,n+1),s=[],o=n/2;for(;o>1;){let f=Oa(a,o),h=f.length;f.forEach((m,A)=>{let g,v=A<h/2,b=A%2===0,y=m[0],I=m[m.length-1];r&&h>4?h===8?g=v?I:y:g=b?y:I:g=v?y:I,Bo(m,s)||s.push(g)}),o=o/2}let l=a.filter(f=>!s.includes(f));for(;l.length;)l.length%2===0?s.push(l.pop()):s.push(l.shift());let c=gt(0,20).map(f=>Math.pow(2,f));c.unshift(1);let u=c.indexOf(n),d=0,p=[];return gt(0,u).forEach(f=>{p.push(s.slice(d,d+c[f])),d+=c[f]}),{...se,seedBlocks:p}}function e5({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!yi(e))return{seedGroups:void 0,...le({result:{error:be},context:{drawSize:e},stack:i})};if(t){if(!yi(t))return{seedGroups:void 0,...le({context:{roundRobinGroupsCount:t},result:{error:be},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:gt(0,n).map(()=>{let a=gt(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=JW({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function t5({roundRobinGroupsCount:t,participantsCount:e}){if(t){let{validGroupSizes:n}=AR({drawSize:e});if(!n?.map(a=>Math.ceil(e/a))?.includes(t))return le({context:{roundRobinGroupsCount:t},result:{error:be}})}let{seedGroups:i}=e5({drawSize:e,roundRobinGroupsCount:t}),r=i?.map(n=>Math.min(...n))||[];return{...se,seedingThresholds:r}}function CT(t){if(!t)return 1/0;if(yi(t))return ri(t);let e=t.split("-")[0];return yi(e)?ri(e):1/0}function Vw({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:s}){let o=[];if(!s)return{error:Jy};let{matchUps:l,roundMatchUps:c}=cr({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:s}),{seedAssignments:u}=pu({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:s}),{positionAssignments:d}=va({structure:s}),p=d?.length,f=u?.length??0,h=[],m=Object.keys(c).map(k=>Number.parseInt(k)).sort((k,O)=>k-O).map(k=>{let O=c[k].map(F=>F.drawPositions).flat(1/0).filter(Boolean),x=O.filter(F=>!h.includes(F));return h=h.concat(...O),x}).filter(k=>k.length).reverse(),A=m.pop()??[],g=A&&Math.min(...A)-1||0;r=r??i?.seeding?.seedingProfile;let v=A?.length||0,b=m.filter(k=>k.filter(O=>O<=f).length),{stage:y,structureType:I,roundLimit:w}=s,S=I===Ao,T=!S&&m?.length,D=!S&&y===zt&&w,C=b.flat(1/0),E=T?C?.length:0,P=a?p:f,R=kW({drawDefinition:n,structure:s,matchUps:l}),M=R?0:!T&&P||P&&C.length<P&&P-C.length||0;if(D){let k=s?.matchUps?s.matchUps.filter(({roundNumber:x})=>x===s.roundLimit).length:0,O=A.length/k;if(!T){let x=gR(r),F=Oa(A,O),_=1,V=gt(0,F[0].length).map(()=>{let G=gt(_,_+F.length);return _+=F.length,G});({validSeedBlocks:o}=nhe({drawPositionBlocks:F,nonRandom:r?.nonRandom,positioning:x,seedGroups:V}))}}else S?{validSeedBlocks:o}=i$e({nonRandom:r?.nonRandom,seedingProfile:r,structure:s}):T?o=b.map(k=>({seedNumbers:k,drawPositions:k})):R&&Oa(A,2).map((k,O)=>({drawPositions:[k[0]],seedNumbers:[O+1]})).forEach(k=>o.push(k));if(!S&&!R&&!D){let{blocks:k}=r$e({drawPositionOffset:g,seedNumberOffset:E,seedCountGoal:M,seedingProfile:r,baseDrawSize:v});k.forEach(O=>o.push(O))}let N=o.flatMap(k=>k.drawPositions).reduce((k,O)=>A?.includes(O)&&k,!0);return!R&&!T&&!S&&!N?{error:vue,validSeedBlocks:[],isContainer:S,isFeedIn:T}:{isLuckyStructure:R,validSeedBlocks:o,isContainer:S,isFeedIn:T}}function i$e({seedingProfile:t,structure:e,nonRandom:i}){let r=e.structures||[],n=r.length,a=Ir({structure:e})?.positionAssignments,s=gR(t),o=a?.length??0,{seedGroups:l}=e5({roundRobinGroupsCount:n,drawSize:o}),c=r.map(u=>Ir({structure:u}).positionAssignments?.map(d=>d.drawPosition));return nhe({drawPositionBlocks:c,positioning:s,seedGroups:l,nonRandom:i})}function nhe({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=Y2e({size:i.length,positioning:e}),s=[];return i.forEach((o,l)=>{let c=K2e({blockPattern:a,index:l});o.forEach((u,d)=>{let p=l%2?t.length-d-1:d,f=t[p].slice().filter((m,A)=>c.includes(A+1)&&m);e!==by?f=r?f:To(f):l%2&&f.reverse();let h=f.find(m=>!s.includes(m));h&&(s.push(h),n.push({drawPositions:[h],seedNumbers:[u]}))})}),{validSeedBlocks:n}}function r$e(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:s}=t,o,l=[],{seedBlocks:c}=JW({cluster:[$1,AF].includes(gR(n)),participantsCount:s,roundRobinGroupsCount:i});o=0;for(let u of c){if(o+1>a)break;let d=u.map(f=>f+e),p=n$e(o+1,u.length).map(f=>+f+r);o+=u.length,l.push({drawPositions:d,seedNumbers:p})}return{blocks:l}}function n$e(t,e){return Array.from(new Array(e),(i,r)=>r+t)}function Gx({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){let{structure:s}=ui({drawDefinition:e,structureId:n});t??=er({drawDefinition:e}).appliedPolicies;let o=i?.validSeedBlocks;return!o&&s&&(o=Vw({appliedPolicies:t,drawDefinition:e,structure:s})?.validSeedBlocks),t?.seeding?.validSeedPositions?.ignore?!0:t?.seeding?.validSeedPositions?.strict?(o.find(l=>l.seedNumbers.includes(a))?.drawPositions||[]).includes(r):o.flatMap(l=>l.drawPositions).includes(r)}function ahe(t){let{provisionalPositioning:e,drawDefinition:i,seedingProfile:r,seedBlockInfo:n,structureId:a,randomize:s}=t,{structure:o}=ui({drawDefinition:i,structureId:a}),{seedAssignments:l}=pu({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:o}),{positionAssignments:c}=va({structure:o}),u=c?.filter(P=>P.participantId??P.bye??P.qualifier)?.map(P=>P.drawPosition).filter(Boolean),{appliedPolicies:d}=er({drawDefinition:i}),p=(n?.validSeedBlocks||o&&Vw({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:r,structure:o})?.validSeedBlocks||[]).find(P=>P.drawPositions.filter(R=>!u?.includes(R)).length),f=l?.map(P=>P.participantId).filter(Boolean),h=c?.map(P=>P.participantId).filter(Boolean),m=f?.filter(P=>h?.includes(P)),A=f?.filter(P=>!h?.includes(P)),g=l?.filter(P=>A?.includes(P.participantId)),v=l?.filter(P=>!P.participantId),b=(g?.length&&g.length>0?g.length:v?.length??0)&&p?.drawPositions.filter(P=>!u?.includes(P))||[],y=s?To(b):b,I=[],w=y.map(()=>{let P=E(g,I)?.participantId;return P&&I.push(P),P}).filter(Boolean),S=l?.filter(P=>m?.includes(P.participantId)).map(P=>P.seedNumber),T=(p?.seedNumbers||[]).filter(P=>!S?.includes(P)),D=l?.filter(P=>T.includes(P.seedNumber)).map(P=>P.participantId),C=d?.seeding?.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:typeof C!="boolean"||C?w:D,unplacedSeedNumbers:T,unfilledPositions:y,unplacedSeedAssignments:g};function E(P,R){let M=P.filter(O=>!R.includes(O.participantId)),N=Math.min(...M.map(O=>CT(O.seedValue))),k=M.filter(O=>CT(O.seedValue)===N);return To(k).pop()}}function gR(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function zC({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:s,seedNumber:o,seedValue:l,eventId:c,event:u}){let d="assignSeed",{structure:p}=ui({drawDefinition:i,structureId:s}),{positionAssignments:f}=va({structure:p}),h=pu({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,m=h.map(I=>I.seedNumber),A=gI({drawDefinition:i,participantId:n});if(n&&!A)return le({result:{error:np},context:{participantId:n},stack:d});let g=u?Bn({event:u}).flightProfile?.flights?.length:0,v=g&&g>1,b=f?.find(I=>I.participantId===n)?.drawPosition;if(b&&!Gx({drawPosition:b,drawDefinition:i,seedBlockInfo:a,structureId:s,seedNumber:o}))return le({result:{error:eq},context:{assignedDrawPosition:b},info:"invalid seed position",stack:d});m.includes(o)||h.push({seedNumber:o,seedValue:l});let y;return h.forEach(I=>{I.participantId===n&&I.seedNumber!==o&&(I.participantId=void 0),I.seedNumber===o&&(I.participantId=n,!r?.groupSeedingThreshold&&!v&&(I.seedValue=l??o),y=!0)}),y?(nfe({tournamentId:e?.tournamentId,drawDefinition:i,structure:p,eventId:c}),{...se}):le({result:{error:gue},stack:d})}function i5({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:s}){let o=t?.sides?.[e]?.sideNumber,l=o&&a.sides?.find(p=>p.sideNumber===o),{extension:c}=Bi({element:n,name:xm}),u=c?.value||{},d=St(u[i],!1,!0);if(l)a?.sides?.forEach(p=>{p.sideNumber===o&&(p.lineUp=d)});else{a.sides=[1,2].map(f=>({...a.sides?.find(h=>h.sideNumber===f)??{},sideNumber:f}));let p=a.sides.find(f=>f.sideNumber===o);p&&(p.lineUp=d)}Yi({tournamentId:r?.tournamentId,context:"updateSidLineUp",eventId:s?.eventId,drawDefinition:n,matchUp:a})}function she(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,s=i.roundNumber>1&&i.roundNumber-1,o=hg({structureId:r.structureId,matchUpsMap:n});!e&&a&&(e=o.find(({drawPositions:h,roundNumber:m})=>m===s&&h?.includes(a)));let l=e?.roundPosition,c=l%2?1:-1,u=l+c,d=s&&o.find(({roundNumber:h,roundPosition:m})=>h===s&&m===u),p=d?.matchUpStatus,f=[mn,ha].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:f}}function a$e({drawPosition:t,drawPositions:e}){let i=!1,r=!!e?.includes(t);return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(la).filter(Boolean),positionAdded:i,positionAssigned:r}}function ohe({structureId:t,matchUpsMap:e,matchUp:i}){let r=i?.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:hg({matchUpsMap:e,structureId:t}).find(({roundNumber:s,roundPosition:o})=>s===i?.roundNumber&&o===a)}}function lhe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(o=>o.matchUpId===i),{pairedPreviousMatchUp:s}=ohe({structureId:a?.structureId,matchUp:a,matchUpsMap:r});if(a&&s){let o=s?.matchUpId,l=t.find(u=>u.matchUpId===o),c=a?.structureId===l?.structureId?a?.roundPosition<l?.roundPosition&&1||2:a.structureId===l?.structureId&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(u=>{let d=Lr(u)||!isNaN(u)?{code:u}:u;return d.sideNumber===c?{...d,previousMatchUpStatus:e}:d})}}function Pk({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,s)=>a.drawPositions?.includes(e)?s+1:n,void 0)}function vI({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:s,matchUpsMap:o,matchUpId:l,event:c}){let u="assignMatchUpDrawPosition";o||(o=ss({drawDefinition:n})),t||(t=ea({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[]);let d=t.find(R=>R.matchUpId===l),p=d?.structureId,f=n?.structures?.find(R=>R.structureId===p);if(!f)return{error:nn};let h=o?.drawMatchUps?.find(R=>R.matchUpId===l),m=h?.drawPositions??[],{positionAdded:A,positionAssigned:g,updatedDrawPositions:v}=a$e({drawPositions:m,drawPosition:s}),{positionAssignments:b}=Ir({drawDefinition:n,structure:f}),y=b?.filter(R=>v.includes(R.drawPosition))?.find(({bye:R})=>R),I=h?.matchUpStatus&&Ms(h.matchUpStatus)&&v.filter(Boolean).length<2;a=y&&"BYE"||a||I&&h.matchUpStatus||h?.matchUpStatus&&[mn,ha].includes(h.matchUpStatus)&&h.matchUpStatus||Rn;let w=!!(Ms(h?.matchUpStatus)&&h?.winningSide);if(h&&A){t=ea({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[];let R=I&&Pk({inContextDrawMatchUps:t,drawPosition:s,matchUpId:l})||w&&h.winningSide||void 0;h?.matchUpStatusCodes&&lhe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:o,matchUp:h}),Object.assign(h,{drawPositions:v,winningSide:R,matchUpStatus:w?h?.matchUpStatus:a}),Yi({tournamentId:i?.tournamentId,eventId:d?.eventId,context:u,drawDefinition:n,matchUp:h})}let S=xo({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:T,loserMatchUp:D,loserTargetDrawPosition:C},targetLinks:{loserTargetLink:E}}=S,P=hg({structureId:f.structureId,matchUpsMap:o});if(g&&y){if(T)if(["BYE",mn,ha].includes(a)){let R=vI({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(R.error)return R}else{let{structureId:R}=T;R!==f.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(g&&w){if(T){let R=vI({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(R.error)return R}}else if(T&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:R}=she({targetMatchUp:h,drawPosition:s,matchUpsMap:o,structure:f});if(R){let M=vI({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(M.error)return M}}if(h?.matchUpType===$r){let R=t?.find(({matchUpId:k})=>k===h.matchUpId),M=(R?.sides??[]).reduce((k,O,x)=>O.drawPosition===s?x:k,void 0),N=b?.find(k=>k.drawPosition===s)?.participantId;N&&M!==void 0&&i5({inContextTargetMatchUp:R,drawPositionSideIndex:M,teamParticipantId:N,tournamentRecord:i,drawDefinition:n,matchUp:h})}if(E?.linkCondition===sf&&v.filter(Boolean).length===2&&!y&&P.filter(({drawPositions:R,roundNumber:M})=>M===1&&Bo(R,v)).every(({matchUpStatus:R})=>[Ln,Fa].includes(R))&&D){let{structureId:R}=D,M=Oc({drawPosition:C,tournamentRecord:i,drawDefinition:n,structureId:R,matchUpsMap:o,event:c});if(M.error)return M}return g?{...se}:le({result:{error:fT},context:{drawPosition:s},stack:u})}function che({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){let a=$C({drawDefinition:e})?.containedStructures?.[n.structureId]?.map(({structureId:u})=>u)||[];a.push(n?.structureId);let s=i?.map(({drawPosition:u})=>u)||[],o=t?.filter(u=>a.includes(u.structureId)&&Pn(u.drawPositions??[],s).length)??[],l=o.map(({matchUpId:u})=>u),c=r?.drawMatchUps?.filter(u=>l.includes(u.matchUpId))??[];return{drawPositions:s,matchUps:c,targetMatchUps:o}}function r5({lineUp:t}){if(!Array.isArray(t))return;let e={};return Ci(t.flatMap(({collectionAssignments:i})=>i?.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:s}=$x({collectionPosition:a,collectionId:r,lineUp:t});s.forEach(o=>{e[o]||(e[o]=[]),e[o].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function Ey(t){return`${t} must be an array`}function YF({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(Ey("lineUp")),{valid:!1,errors:i,error:be};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:s,collectionAssignments:o}=a;return s?typeof s!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(o)?o.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:c}=l;return typeof c!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(Ey("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=Ci(t.map(ji)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?be:void 0}}function Gw({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:Bt};if(typeof e!="string")return{error:ga};let n=YF({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=Bi({element:t,name:xm}),s=a?.value||{};return s[e]=r5({lineUp:r}),lr({element:t,extension:{name:xm,value:s}}),W1({drawDefinition:t}),{...se}}function n5({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:s,event:o}){if(!r)return{error:Bt};let{drawPositions:l,matchUps:c,targetMatchUps:u}=che({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:s});for(let d of u)d.matchUpType===Cc&&(d.sides??[]).forEach((p,f)=>{if(p?.drawPosition&&l?.includes(p.drawPosition)){let h=c.find(({matchUpId:m})=>m===d.matchUpId);if(h?.sides?.[f]){if(delete h.sides[f].lineUp,e===!1){let m=d.tieFormat,A=p.participantId;m&&A&&Gw({drawDefinition:r,participantId:A,lineUp:[],tieFormat:m})}Yi({tournamentId:i?.tournamentId,context:"resetLineUps",eventId:o?.eventId,drawDefinition:r,matchUp:h})}}});return{...se}}function lf({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:o,seedBlockInfo:l,drawPosition:c,matchUpsMap:u,structureId:d,event:p}){let f="assignDrawPosition";if(!o&&!i)return le({result:{error:ga},stack:f});u=u??ss({drawDefinition:a}),e||({matchUps:e}=ea({inContext:!0,drawDefinition:a,matchUpsMap:u}));let h=ui({drawDefinition:a,structureId:d});if(h.error)return le({result:h,stack:f});let{structure:m}=h;if(!m)return{error:nn};if(Yo({structure:m}))return le({result:{error:bl},stack:f});let{seedAssignments:A}=pu({provisionalPositioning:t,drawDefinition:a,structure:m}),g=A?.find(D=>D.participantId===o)?.seedNumber,{appliedPolicies:v}=er({tournamentRecord:n,drawDefinition:a,structure:m,event:p});if(g&&!Gx({seedNumber:g,appliedPolicies:v,drawDefinition:a,seedBlockInfo:l,drawPosition:c,structureId:d}))return le({result:{error:eq},context:{drawPosition:c},stack:f});let b=va({structure:m}).positionAssignments||[],y=b?.find(D=>D.drawPosition===c);if(!y)return le({result:{error:ww},context:{drawPosition:c},stack:f});if(b?.map(ji).includes(o))return le({result:{error:RC},context:{drawPosition:c},stack:f});let{containsParticipant:I,containsBye:w}=GW(y);if(w){let D=dR({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:c,structureId:d,matchUpsMap:u,event:p});if(D.error)return le({result:D,stack:f})}if(I&&y.participantId!==o){let{activeDrawPositions:D}=GC({drawDefinition:a,structureId:d});if(D.includes(c))return le({result:{error:R1},stack:f});n5({assignments:[y],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:u,structure:m})}if(y.participantId=o,i&&(y.qualifier=!0),m.stage===Ut&&(!m.stageSequence||m.stageSequence>1)||m.stage&&[Os,Tn].includes(m.stage)){let D=m.stage===zt?zt:Ut,C=(a.structures?.find(E=>E?.stage===D&&E?.stageSequence===1)?.seedAssignments??[]).find(E=>E.participantId===o);if(C?.participantId){let{participantId:E,seedNumber:P,seedValue:R}=C;zC({eventId:p?.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:E,seedNumber:P,seedValue:R,structureId:d,event:p})}}if(m.structureType===Ao){Hfe({positionAssignments:b,tournamentRecord:n,drawDefinition:a,matchUpsMap:u,structure:m});let{drawPositions:D,matchUps:C,targetMatchUps:E}=che({assignments:[y],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:u,structure:m});if(D&&C?.length===1&&C[0].matchUpType===$r){let P=(E?.[0].sides??[]).reduce((R,M,N)=>D?.includes(M.drawPosition)?N:R,void 0);i5({inContextTargetMatchUp:E[0],teamParticipantId:o,matchUp:C[0],drawPositionSideIndex:P,tournamentRecord:n,drawDefinition:a})}}else s$e({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:c,matchUpsMap:u,structure:m,event:p});let S=a.entries?.find(D=>D.participantId===o),T=p?.entries?.find(D=>D.participantId===o);return!S&&T&&zW({entryStatus:T.entryStatus,entryStage:m.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:o,event:p}),Fm({tournamentId:n?.tournamentId,drawDefinition:a,structure:m,event:p}),{positionAssignments:b,...se}}function s$e({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let c={isCollectionMatchUp:!1},{matchUps:u}=cr({provisionalPositioning:t,matchUpFilters:c,drawDefinition:n,matchUpsMap:s,structure:o,event:l}),{roundMatchUps:d}=ko({matchUps:u}),{initialRoundNumber:p}=jI({drawPosition:a,matchUps:u}),f=p&&d?.[p].find(h=>h.drawPositions?.includes(a));if(f){let h=vI({matchUpId:f.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s});if(h.error)return le({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:h})}return{...se}}function a5(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,event:c}=t,u="positionParticipantAction";if(!a)return{error:Bt};let d=er({tournamentRecord:n,drawDefinition:a,event:c}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:f}=t;f||(f=ss({drawDefinition:a}),Object.assign(t,{matchUpsMap:f})),p||({matchUps:p}=ea({inContext:!0,drawDefinition:a,matchUpsMap:f}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:h}=Ir({drawDefinition:a,structureId:l}),m=h?.find(y=>y.drawPosition===o);if(m?.participantId){let y=m.participantId,I=lf({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:f,event:c});return I.success?b({appliedPolicies:d,removedParticipantId:y}):le({result:I,stack:u})}let A=dR({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:o,structureId:l,matchUpsMap:f,event:c});if(A.error)return le({result:A,stack:u});let g=A.participantId,v=lf({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:f,event:c});if(!v.success)return le({result:v,stack:u});return b({appliedPolicies:d,removedParticipantId:g});function b({appliedPolicies:y,removedParticipantId:I}){let{structure:w}=ui({drawDefinition:a,structureId:l});EW({drawPositions:[o],structure:w});let S={[e]:s,name:r,drawPosition:o,structureId:l};return K1({appliedPolicies:y,drawDefinition:a,positionAction:S}),le({context:{removedParticipantId:I},result:{...se},stack:u})}}function o$e({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return a5({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function uhe(t){return o$e(t)}function dhe({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let s of i.matchUps)e[s.matchUpId]&&(s.roundNumber=e[s.matchUpId],Yi({tournamentId:r?.tournamentId,eventId:a?.eventId,drawDefinition:n,matchUp:s}))}function phe(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=Gt(t,i);if(r.error)return r;let n=ui(t);if(n.error)return n;let a=n.structure;if(!Yo({structure:a}))return le({result:{error:Zy,message:"structure must be adHoc"}});let{roundMatchUps:s=[],roundNumbers:o}=ko({matchUps:a?.matchUps});return o?.length?{valid:!0,structure:a,roundMatchUps:s,roundNumbers:o}:{error:sA}}function fhe(t){let e=phe(t,[{targetRoundNumber:!0,roundNumber:!0,[il]:LFe}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e,{targetRoundNumber:a,roundNumber:s}=t;if(!n?.includes(s)||!n?.includes(a))return le({result:{error:be},info:"roundNumbers must be valid rounds"});let o=a>s,l=o?gt(s+1,a+1):gt(a,s),c={};return l.forEach(u=>(r?.[u]??[]).forEach(({matchUpId:d})=>{c[d]=u-(o?1:-1)})),r?.[s]?.forEach(({matchUpId:u})=>c[u]=a),dhe({params:t,modMap:c,structure:i}),{...se}}function hhe({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){if(!r)return{error:Bt};if(!Array.isArray(t))return{error:be};let a="setPositionAssignments";for(let o of t){let{structureId:l,positionAssignments:c}=o;if(!c)continue;let u=ui({drawDefinition:r,structureId:l});if(u.error)return u;let d=u.structure;if(!d)return{error:nn};let p=Ir({structure:d}).positionAssignments?.map(({drawPosition:A})=>A),f=c?.map(({drawPosition:A})=>A);if(Pn(p,f).length!==p?.length)return le({result:{error:be},info:"drawPositions do not match",stack:a});let h=ss({drawDefinition:r}),{matchUps:m}=ea({inContext:!0,drawDefinition:r,matchUpsMap:h});for(let A of c||[]){let{drawPosition:g,participantId:v,bye:b,qualifier:y}=A;if(b){let I=Oc({tournamentRecord:i,drawDefinition:r,drawPosition:g,matchUpsMap:h,structureId:l,structure:d,event:n});if(I?.error)return I}else if(y)c.forEach(I=>{I.drawPosition===g&&(I.qualifier=!0,delete I.participantId,delete I.bye)});else if(v){let I=lf({provisionalPositioning:e,inContextDrawMatchUps:m,tournamentRecord:i,drawDefinition:r,participantId:v,drawPosition:g,matchUpsMap:h,structureId:l,event:n});if(I?.error)return I}}Fm({tournamentId:i?.tournamentId,drawDefinition:r,structure:d,event:n})}let s=t.map(({structureId:o})=>o);return Br({tournamentId:i?.tournamentId,eventId:n?.eventId,drawDefinition:r,structureIds:s}),{...se}}function mhe(t){let e=phe(t,[{roundNumbers:!0,[il]:zs,[Es]:s=>s.length===2&&s.every(Sn)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(s=>n?.includes(s)))return le({result:{error:be,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((s,o)=>(r?.[s]??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-o]})),dhe({params:t,modMap:a,structure:i}),{...se}}function Ahe({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return a5({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function ghe({drawDefinition:t,structureId:e}){if(!t)return{error:Bt};let{structure:i}=ui({drawDefinition:t,structureId:e}),r=(t?.links||[]).filter(n=>n.source?.structureId===e).map(n=>n.target?.structureId);return{playoffStructures:(t?.structures||[]).filter(n=>r.includes(n.structureId)),structure:i}}function XF({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:s}){if(!a)return{error:Vr};let o={},l=[];for(let c of a.drawDefinitions||[]){let{structures:u,stageStructures:d}=yd({withStageGrouping:t,stageSequences:e,drawDefinition:c,stageSequence:i,roundTarget:r,stages:n,stage:s});if(l.push(...u),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function s5({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:s}){if(!e)return{error:rt};let o={},l=[];for(let c of e.events||[]){let{structures:u,stageStructures:d}=XF({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:c,stage:s});if(u&&l.push(...u),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function Sh(t){if(!t?.drawDefinition)return!1;let e=zF(t),i=e?.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r?.filter(({matchUpType:s})=>s===$r),n=n?.filter(({matchUpType:s})=>s===$r),a=a?.filter(({matchUpType:s})=>s===$r)),!!(r?.length&&!n?.length&&!a?.length)}function o5(t){let{drawDefinition:e,structureId:i}=t;if(!e)return{error:Bt};let{playoffStructures:r}=ghe({drawDefinition:e,structureId:i});if(!r?.length)return!1;let n=e?.entries?.filter(s=>s?.entryStatus&&Pd.includes(s.entryStatus))?.length??0,a=0;return(r||[]).reduce((s,o)=>!!((Ir({structure:o}).positionAssignments??[])?.filter(l=>(l.participantId&&a++,l?.bye??l?.participantId)).length&&s),!!r.length)||a===n}function xj({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i?.[n]){let s=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(o=>{let l=xj({accessors:s,significantCharacters:t,value:o});r.push(...l)});else if(i=i[n],s.length){let o=xj({accessors:s,significantCharacters:t,value:i});r.push(...o)}else a({value:i})}function a({value:s}){if(s&&["string","number"].includes(typeof s)){let o=t?s.slice(0,t):s;r.push(o)}}return r}function l$e({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:uq};if(!Array.isArray(r))return{error:k1};let n={};return t.forEach(a=>{let s=r.find(l=>l.participantId===a),{values:o}=vhe({policyAttributes:e,idCollections:i,participants:r,participant:s});o&&o.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function vhe({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:uq};if(!r)return{error:Tw};let n=[];return t.forEach(a=>{let{directive:s,groupings:o,key:l,significantCharacters:c}=a||{};if(l){let u=l.split(".");n.push(...xj({significantCharacters:c,value:r,accessors:u}))}else if(s){let u=a?.includeIds,d=(e?.[s]||[]).filter(p=>!u||u.includes(p));d?.length&&i?.length&&d.forEach(p=>{let f=i.find(h=>h.participantId===p);if(f?.individualParticipantIds?.includes(r.participantId)){let h=f?.participantId;n.push(h)}})}else o&&Object.keys(o).forEach(u=>{o[u].includes(r.participantId)&&n.push(u)})}),{values:Ci(n)}}function nee({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let s=n[a.participantId],{values:o}=vhe({participants:e,policyAttributes:i,idCollections:r,participant:s});return{...a,values:o}})}function yhe({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r?.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,s=t?t[a]||[]:[],o=!!i.some(l=>s.includes(l));return{[n]:{participantGroups:s,includesGroupsToAvoid:o}}}))}function c$e(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=yhe(t);return i.map(a=>{let s=e.filter(c=>a.includes(c)),o=n(s),l=s.filter(c=>!o.includes(c)).filter(c=>{let u=aee(c);return!r[u]?.includesGroupsToAvoid});return{unassigned:s,unpaired:o,pairedNoConflict:l}});function n(a){return a.filter(o=>!s(o));function s(o){let l=aee(o);return!a.includes(l)}}}function u$e(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=yhe(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),s=a.length===n.length?a:[],o=n.filter(l=>r[l]?.includesGroupsToAvoid).length;return{unassigned:a,unpaired:s,pairedNoConflict:o?[]:a,conflictsCount:o}})}function aee(t){return Number(t%2?t+1:t-1)}function d$e({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function p$e({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let s=r.map(o=>a?u$e({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):c$e({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let o=s.map(u=>u.map(d=>d.unassigned).filter(d=>d?.length)).filter(u=>u?.length).sort((u,d)=>(d.length||0)-(u.length||0)),l=s.map(u=>u.map(d=>d.unpaired).filter(d=>d?.length)).filter(u=>u?.length),c=s.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(u=>u?.length).sort((u,d)=>(d.length||0)-(u.length||0));return{unassigned:o,unpaired:l,pairedNoConflict:c}}else{let o=s.map(u=>u.map(d=>d.unassigned).filter(d=>d?.length)).filter(u=>u?.length),l=s.map(u=>u.map(d=>d.unpaired).filter(d=>d?.length)).filter(u=>u?.length),c=s.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(u=>u?.length);return{unassigned:o,unpaired:l,pairedNoConflict:c}}}function bhe({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function f$e({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){let a=Object.assign({},...Object.keys(r).map(c=>[c,r[c].filter(u=>e.includes(u))]).filter(c=>c[1].length).map(([c,u])=>({[c]:u}))),s=Object.keys(a).reduce((c,u)=>a[u].length>c?a[u].length:c,0),o=Object.keys(a).filter(c=>a[c].length===s),l=Bl(i?o:Object.keys(a));return n=t&&a[n]?.length?n:l,{participantId:n&&a[n]?Bl(a[n]):Bl(e),groupKey:n}}function h$e({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function m$e({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:s,groupKey:o}){let l=n.reduce((T,D)=>D.length>T?D.length:T,0)<=2,c=bhe({positionAssignments:t,participantIds:e}),u=h$e({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=f$e({targetParticipantIds:c,useSpecifiedGroupKey:l,allGroups:s,groupKey:o}),f=d$e({participantId:d,allGroups:s}),h=p$e({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:f,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:u}),{unassigned:m,unpaired:A,pairedNoConflict:g}=h,v=g?.length&&g[0],b=A?.length&&A[0],y=a&&v?v:b,I=a?b:v,w=y?.length&&y||I?.length&&I,S;if(w?.length){let T=xl(w);S=xl(T)}else{let T=xl(m[0]);S=xl(T)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:S}}function _j({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(o=>o.drawPosition),a=ZW({drawPositions:n}).uniqueMatchUpGroupings??[],s=Object.assign({},...r.map(o=>({[o.drawPosition]:o})));a.forEach(o=>{Bo(s[o[0]].values||[],s[o[1]].values||[])&&(i.push(o),r.conflict=!0)})}):e.forEach(r=>{Bo(r[0]?.values||[],r[1]?.values||[])&&(i.push(r),r.conflict=!0)}),i}function A$e(t,e){let i=t.find(r=>r.includes(e));if(i)return i.find(r=>r!==e)}function see(t,e){return t.find(i=>i.drawPosition===e)}function g$e({moveableParticipant:t,possibleDrawPosition:e,positionedParticipants:i,drawPositionGroups:r,isRoundRobin:n,getAvoidanceConflicts:a}){let s=A$e(r,e),o=see(i,s),l=a({isRoundRobin:n,groupedParticipants:[[t,o]]}),c=[see(i,e),o],u=a({isRoundRobin:n,groupedParticipants:[c]});return!l.length&&!u.length}function v$e({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.flatMap(a=>{let s=a.map(o=>o.drawPosition);return a.filter(o=>e.includes(o.drawPosition)).map(o=>{let l=e.filter(c=>!s?.includes(c)).filter(c=>g$e({moveableParticipant:o,possibleDrawPosition:c,positionedParticipants:t,drawPositionGroups:i,isRoundRobin:n,getAvoidanceConflicts:_j}));if(l.length)return{drawPosition:o.drawPosition,possibleDrawPositions:l}}).filter(Boolean)})}function oee(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:s,idCollections:o,allGroups:l}=t,c=[],u,d=Math.min(...(a||[]).map(b=>b?.length).filter(Boolean)),p=d>2,f=St(e,!1,!0).filter(b=>!b.qualifier),h=e.filter(b=>!b.participantId&&(!b.bye||n?.includes(b.drawPosition))).map(b=>b.drawPosition);gt(0,r).forEach(()=>{let{newGroupKey:b,selectedParticipantId:y,targetDrawPosition:I}=m$e({...t,candidatePositionAssignments:f,allGroups:l,groupKey:u});u=b,f.forEach(w=>{w.drawPosition===I&&(w.participantId=y)})});let m=nee({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),A=Oa(m,d),g=_j({groupedParticipants:A,isRoundRobin:p}),v=0;for(;v<20&&g.length;){let b=v$e({positionedParticipants:m,potentialDrawPositions:h,avoidanceConflicts:g,drawPositionGroups:a,isRoundRobin:p});if(b.length){let y=y$e({candidatePositionAssignments:f,swapOptions:b});y.error&&console.log({result:y}),m=nee({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),A=Oa(m,d),g=_j({groupedParticipants:A,isRoundRobin:p}),v++}else v=20}return f.forEach(b=>{if(b.bye&&b.participantId){let y=pj;c.push(y)}if(b.qualifier&&b.participantId){let y=pj;c.push(y)}}),{positionAssignments:f,conflicts:g.length,groupedParticipants:A,errors:c}}function y$e({candidatePositionAssignments:t,swapOptions:e}){let i=xl(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=xl(i.possibleDrawPositions),a=t.find(c=>c.drawPosition===r),s=t.find(c=>c.drawPosition===n)??{},o={participantId:s?.participantId,qualifier:s?.qualifier,bye:s?.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,o),Object.assign(s,l),{...se}}function b$e({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,avoidance:u,drawSize:d,event:p}){if(!u)return{error:Pue};let{candidatesCount:f=1,policyAttributes:h,targetDivisions:m}=u,{roundsToSeparate:A}=u,g="randomUnseededSeparation",{structure:v}=ui({drawDefinition:a,structureId:c}),{matchUps:b}=cr({provisionalPositioning:t,matchUpsMap:l,structure:v,event:p});if(m&&rp(m)&&!A){let V=j_e(m)||0,G=b.reduce((z,Q)=>Q.roundNumber>z?Q.roundNumber:z,0);A=G<V?1:G-V+1}let{positionAssignments:y}=va({structure:v}),I=_F({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:o}).participantsWithGroupings,w=y?.filter(V=>!V.participantId),S=y?.map(V=>V.drawPosition),T=v?.structureType===Ao,D=T?{structure:v,matchUps:b,allDrawPositions:S,roundsToSeparate:A}:{matchUps:b,allDrawPositions:S,roundsToSeparate:A},{drawPositionGroups:C,drawPositionChunks:E}=T?I$e(D):w$e(D),P={groupParticipants:o.filter(V=>V.participantType===xc).map(V=>V.participantId),teamParticipants:o.filter(V=>V.participantType===gr).map(V=>V.participantId),pairParticipants:o.filter(V=>V.participantType===Mi).map(V=>V.participantId)},R=l$e({targetParticipantIds:e,policyAttributes:h,idCollections:P,participants:o});if(R.error)return le({result:R,stack:g});let M=Object.assign({},...e.map(V=>{let G=Object.keys(R).filter(z=>(R[z]??[]).includes(V));return{[V]:G}})),N=bhe({participantIds:e,positionAssignments:y});if(N.length>(w?.length||0))return{error:Aq};let k,O=N.length,x=gt(0,f).map(()=>oee({initialPositionAssignments:y,participantsWithGroupings:I,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:C,policyAttributes:h,idCollections:P,allGroups:R,drawSize:d}));if(k=x.reduce((V,G)=>!V||(G.conflicts||0)<(V.conflicts||0)?G:V,void 0),!k||k.conflicts){let V=gt(0,f).map(()=>oee({initialPositionAssignments:y,participantsWithGroupings:I,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:C,policyAttributes:h,idCollections:P,allGroups:R,drawSize:d}));k=x.concat(...V).filter(G=>!G.errors?.length).reduce((G,z)=>!G||(z.conflicts||0)<(G.conflicts||0)?z:G,void 0)}if(!k)return{error:sF};let F=(Ir({structure:v})?.positionAssignments??[]).filter(V=>V.participantId).map(V=>V.participantId),_=k.positionAssignments.filter(V=>!F.includes(V.participantId));for(let V of _)if(V.bye){let G=Oc({tournamentRecord:n,drawDefinition:a,structureId:c,matchUpsMap:l,event:p,...V});if(G.error)return le({result:G,stack:g})}else if(V.participantId){let G=lf({inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:c,matchUpsMap:l,event:p,...V});if(G.error)return le({result:G,stack:g,context:{assignment:V}})}return{...se}}function I$e(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function w$e({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(u=>u.roundNumber===1).map(u=>u.drawPositions),n=r.flat().sort(la),a=Math.max(...n),s=t.filter(u=>u>a),o=n.length,l=gt(o===2?1:2,o).filter(u=>u===Zz(u)),c=l.slice(0,e||l.length).reverse().map(u=>Oa(n,u));return s.length&&console.log({fedDrawPositions:s}),{drawPositionGroups:r,drawPositionChunks:c}}function S$e({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,structure:u,drawSize:d,event:p}){let f="positionUnseededParticipants";u||({structure:u}=ui({drawDefinition:a,structureId:c})),c||({structureId:c}=u);let{positionAssignments:h}=va({structure:u}),{seedAssignments:m}=pu({provisionalPositioning:t,drawDefinition:a,structure:u}),A=m?.map(D=>D.participantId).filter(Boolean),{stage:g,stageSequence:v}=u,b=g===zt?Bi({element:u,name:Ef})?.extension?.value:void 0,y=Bw({provisionalPositioning:t,drawDefinition:a,stageSequence:v,entryStatuses:ob,structureId:c,roundTarget:b,stage:g}),I=y.filter(D=>!A?.includes(D.participantId)).map(D=>D.participantId),w=h?.filter(D=>!D.participantId&&!D.bye&&!D.qualifier).map(D=>D.drawPosition);if(!r&&I.length>(w?.length||0))return le({result:{error:Aq},context:{unseededParticipantsCount:I.length,unfilledDrawPositionsCount:w?.length},stack:f});let{appliedPolicies:S}=er({tournamentRecord:n,drawDefinition:a,event:p}),T=S?.[oP];if(u.stage===Tn){let D=y.reduce((C,E)=>(C[E.groupingValue]||(C[E.groupingValue]=[]),C[E.groupingValue].push(E.participantId),C),{});Object.keys(D).length&&(T||(T={policyName:"Playoff Avoidance"}),T.policyAttributes||(T.policyAttributes=[]),T.policyAttributes.push({groupings:D}))}return T&&o?b$e({provisionalPositioning:t,unseededParticipantIds:I,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,avoidance:T,drawSize:d}):U$e({provisionalPositioning:t,unseededParticipantIds:I,inContextDrawMatchUps:e,unfilledDrawPositions:w,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:c,matchUpsMap:l,drawSize:d,event:p})}function U$e({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,matchUpsMap:l,structureId:c,drawSize:u,event:d}){let p=u>2?To(r):r.reverse();for(let f of e){let h=p.pop();if(!n||h){let m=lf({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,participantId:f,drawPosition:h,matchUpsMap:l,structureId:c,event:d});if(m?.error&&console.log("!!!!!",{result:m}),m?.error)return le({result:m,stack:"randomUnseededDistribution"})}}return{...se}}function T$e(t){let e=t.structure??ui(t).structure,i="positionQualifiers",r=[];if(e.stage===Os)return le({result:{error:eb},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:s}=C$e(t);for(let o of Object.keys(n)){let l=a?.filter(c=>s[o].includes(c.drawPosition)&&!c.participantId&&!c.qualifier&&!c.bye).map(c=>c.drawPosition);if(n[o]>(l||0))return le({result:{error:mq},context:{unfilledDrawPositions:l},stack:i});gt(0,n[o]).forEach(()=>{let c=xl(l);r.push(c),a?.forEach(u=>{u.drawPosition===c&&(u.qualifier=!0,delete u.participantId,delete u.bye)})})}return{...se,qualifierDrawPositions:r}}function C$e({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=ui({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=va({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:s,roundQualifiersCounts:o}=QC({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(o?Object.keys(o):[]).map(m=>ri(m)),{matchUps:c}=cr({structure:e}),{roundProfile:u}=ko({matchUps:c}),d=Object.assign({},...l.filter(m=>u?.[m]).map(m=>({[m]:u?.[m]?.drawPositions?.filter(Boolean)??[]}))),p=r?.filter(m=>m.qualifier).map(m=>m.drawPosition),f=s-(p?.length??0),h=p?.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let A=r?.filter(g=>g.qualifier&&d[m]?.drawPositions?.includes(g.drawPosition)).map(g=>g.drawPosition);return{[m]:(o?.[m]??0)-(A?.length??0)}})),unplacedQualifiersCount:f,placedQualifiersCount:h,roundQualifiersCounts:o,positionAssignments:r,roundDrawPositions:d,qualifiersCount:s}}function Ihe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,groupsCount:c,structureId:u,matchUpsMap:d,structure:p,event:f}){let h=[],m=[],A=0;if(p||({structure:p}=ui({drawDefinition:a,structureId:u})),u||(u=p?.structureId),r||(r=er({drawDefinition:a}).appliedPolicies),!n){let g=p&&Vw({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:s,structure:p});g?.error&&m.push(g.error),n=g?.validSeedBlocks}return c=c??n?.length??0,gt(0,c).forEach(()=>{if(A<(c||0)){let g=E$e({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,structureId:u,matchUpsMap:d,event:f});g?.success&&(A++,h.push(...g.seedPositions??[])),g.error&&m.push({seedPositionError:g.error})}}),m.length?{error:m}:{...se,seedPositions:h}}function E$e({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:s,structureId:o,matchUpsMap:l,event:c}){let{unplacedSeedParticipantIds:u,unfilledPositions:d}=ahe({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:o}),{appliedPolicies:p}=er({drawDefinition:r}),{avoidance:f}=p??{};f&&s&&u?.length>2;let h=[];for(let m of u){let A=d.pop();if(!A)return{error:EC};h.push(A);let g=lf({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:m,seedBlockInfo:a,drawPosition:A,matchUpsMap:l,structureId:o,event:c});if(!g.success)return g}return{...se,seedPositions:h}}function D$e({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=va({structure:i}),{seedAssignments:n}=pu({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(s=>s.participantId).map(s=>({[s.participantId]:s})));return r?.map(s=>a[s.participantId]?{...s,seedNumber:a[s.participantId].seedNumber,seedValue:a[s.participantId].seedValue}:"").filter(Boolean)}function P$e({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>R$e(a,i,r,t));let n=r.map(a=>Array.isArray(a)?To(a):a).flat(1/0);return Kce(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function R$e(t,e,i,r){if(e-i.length>t.drawPositions.length)i.push(...t.drawPositions);else{let n=Oj(Oa(t.drawPositions,2));M$e(n,i,r)}}function M$e(t,e,i){let r,n=i[e.length];for(;r=Rk(t,n);)e.push(r),n=i[e.length]}function Rk(t,e){return Array.isArray(t)&&t.length!==2?t.pop():Array.isArray(t[0])?B$e(t,e):N$e(t,e)}function N$e(t,e){return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift()}function B$e(t,e){let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return Rk(e?n:t[Math.round(Math.random())],e)}return i<r?Rk(t[1],e):Rk(t[0],e)}function Oj(t){let e=Math.floor(t.length/2);return t.length>2?[Oj(t.slice(0,e)),Oj(t.slice(e))]:t}function k$e({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:s,structure:o}){a||(a=Vw({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:o}));let{isFeedIn:l,isLuckyStructure:c,isContainer:u}=a,{validSeedBlocks:d}=a;i?.seeding?.containerByesIgnoreSeeding&&(d=[]);let p=D$e({provisionalPositioning:t,drawDefinition:r,structure:o})??[],f=Ci([].concat(...e.map(y=>y.drawPositions))),h=p.filter(y=>f.includes(y.drawPosition)),m=(y,I)=>CT(y.seedValue)-CT(I.seedValue),A=d.reduce((y,I)=>{let w=h.filter(S=>I.drawPositions?.includes(S.drawPosition)).sort(m);return y.concat(...w)},[]).map(y=>y.drawPosition),g=P$e({orderedSortedFirstRoundSeededDrawPositions:A,validSeedBlocks:d,byesToPlace:s}),v=lee({orderedSeedDrawPositions:A,relevantMatchUps:e}).slice(0,s),b=lee({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,s);return{strictSeedOrderByePositions:v,blockSeedOrderByePositions:b,isLuckyStructure:c,positionedSeeds:p,isContainer:u,isFeedIn:l}}function lee({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r?.sort((n,a)=>n-a)).filter(r=>r?.[0]+1===r?.[1]);return t.map(r=>i.find(n=>n?.includes(r))).filter(Boolean).map(r=>r?.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function x$e({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:s,isFeedIn:o}){let l=r?.seeding?.seedingProfile,c=s.stage===zt,{positionAssignments:u}=va({structure:s}),d=u?.filter(N=>N.participantId).map(N=>N.drawPosition),p={isCollectionMatchUp:!1},{matchUps:f,roundMatchUps:h}=cr({provisionalPositioning:t,matchUpFilters:p,structure:s}),m=h?.[1]||[],A=s.structureType===Ao?f:m,g=Ci([].concat(...A.map(N=>N.drawPositions))),v=Math.min(...g)-1,b=d?.filter(N=>g.includes(N)),y=N=>{let k=Math.ceil(N.length/2),O=[N.slice(0,k),N.slice(k)],x=O.map(W=>[].concat(...W.flat(1/0)).length),F=Math.min(...x.flat(1/0)),_=Math.max(...x.flat(1/0)),V=x.indexOf(_),G=F!==_,z=To(O),[Q,j]=!F||G?[O[V],O[1-V]]:[z[0],z[1]];return{greaterHalf:Q,lesserHalf:j}},I=N=>{let{greaterHalf:k,lesserHalf:O}=y(N),{greaterHalf:x,lesserHalf:F}=y(k),_=To(x.flat(1/0)).pop(),V=x.flat().filter(G=>G!==_);return{newlyFilteredChunks:[...O,...F,V],drawPosition:_}},w=N=>!e.includes(N),S=N=>!b?.includes(N),T=N=>{let k=Oa(N.sort(la),Math.ceil(N.length/4)).map(F=>F.filter(S)),O=[].concat(...k.flat(1/0)).length,x=[];for(let F=0;F<O;F++){let{newlyFilteredChunks:_,drawPosition:V}=I(k);x.push(V),k=_}return x},{validSeedBlocks:D}=Vw({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:s}),C=D?.map(N=>N.drawPositions?.map(k=>k+v)),E;if(o){let N=g.length,{seedBlocks:k}=JW({cluster:[$1,AF].includes(gR(l)),participantsCount:N});E=k.map(O=>O.map(x=>x+v)).map(T).filter(O=>O.length)}else c?E=C?.map(N=>N.filter(S)):E=C?.map(T).filter(N=>N.length);let P=A.map(N=>N.drawPositions).map(N=>N?.sort((k,O)=>k-O)).filter(N=>N?.[0]+1===N?.[1]),R=N=>P.reduce((k,O)=>O.includes(N)?O.reduce((x,F)=>F!==N?F:x,void 0):k,void 0),M=E.map(N=>N.map(R)).flat(1/0).filter(S).filter(w).filter(Boolean);if(c&&!s.structures){let N=a%4,k=M.slice(0,N),O=h[s.roundLimit]?.length,x=Oa(M.slice(N),O).map(To).flat();M=k.concat(x)}return{unseededByePositions:M}}function _$e({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){let a={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:o}=cr({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:r,event:n}),l=o?.[1]||[],c=r?.structureType===Ao,u=c?s:l,d=c?r?.structures?.length||0:s.length,{structureId:p,stage:f,stageSequence:h}=r,m=Bw({entryStatuses:Pd,provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:f}),{qualifiersCount:A}=QC({provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:f}),g=m.length+A,{positionAssignments:v,unassignedPositions:b}=va({structure:r}),y=b?.map(C=>C.drawPosition),I=v?.filter(C=>C.bye).length,w=v?.filter(C=>C.bye).map(C=>C.drawPosition),S=u.map(C=>C.drawPositions).filter(C=>C?.reduce((E,P)=>!w?.includes(P)&&E,!0)).flat(1/0).filter(C=>y?.includes(C)),T=v?.length,D=T?T-g:0;return D>d&&r.stageSequence===1&&r.stage!==Os&&(D=d),{placedByes:I,byesCount:D,relevantMatchUps:u,placedByePositions:w,roundMatchUps:o,positionsToAvoidDoubleBye:S}}function whe({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:s,structureId:o,structure:l,seedLimit:c,seedsOnly:u,event:d}){l||({structure:l}=ui({drawDefinition:r,structureId:o})),o||(o=l?.structureId);let p=!(l?.structures??l?.stage===zt),{byesCount:f,placedByes:h,relevantMatchUps:m}=_$e({provisionalPositioning:t,drawDefinition:r,matchUpsMap:s,structure:l,event:d}),A=f-(h||0);if(A<=0)return{...se};let{strictSeedOrderByePositions:g,blockSeedOrderByePositions:v,isLuckyStructure:b,isFeedIn:y}=k$e({provisionalPositioning:t,relevantMatchUps:m,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:A,structure:l}),I=l?.structureType&&[Ao,gF].includes(l.structureType)&&i?.seeding?.containerByesIgnoreSeeding,w=p&&v?.length?v:g,{unseededByePositions:S}=x$e({provisionalPositioning:t,seedOrderByePositions:w,isLuckyStructure:b,appliedPolicies:i,drawDefinition:r,seedLimit:c,structure:l,isFeedIn:y}),T=P=>P%2,D=(P,R)=>(P||[]).every(M=>T(M)?R!==M+1:R!==M-1),C=[].concat(...w);if(!u)for(;S.length;){let P=S.find(R=>D(C,R));P?(C.push(P),S=S.filter(R=>R!==P)):(C.push(...S),S=[])}I&&(C=To(C),Gl({ignoreSeededByes:I})&&console.log({byePositions:C}));let E=C.slice(0,A);for(let P of E){let R=Oc({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:P,matchUpsMap:s,structureId:o,structure:l,event:d});if(R?.error)return R}return{...se,unseededByePositions:S,byeDrawPositions:E}}function eD(t,e){return e||cF(),le({result:t,stack:"automatedPositioning"})}function O$e(t,e){return e||cF(),t}function F$e(t,e,i,r){let n=ui({drawDefinition:e,structureId:i});if(n.error)return{error:n.error};let a=n.structure;if(!a)return{error:nn};let s=t.appliedPolicies||er({drawDefinition:e,structure:a,event:r})?.appliedPolicies,{qualifiersCount:o}=QC({stageSequence:a.stageSequence,provisionalPositioning:t.provisionalPositioning,stage:a.stage,drawDefinition:e,structureId:i}),l=ob,c=Bw({stageSequence:a.stageSequence,provisionalPositioning:t.provisionalPositioning,stage:a.stage,placementGroup:t.placementGroup,drawDefinition:e,entryStatuses:l,structureId:i});return{structure:a,appliedPolicies:s,qualifiersCount:o,entries:c}}function L$e({placeByes:t,provisionalPositioning:e,tournamentRecord:i,appliedPolicies:r,drawDefinition:n,seedBlockInfo:a,matchUpsMap:s,structure:o,seedLimit:l,seedsOnly:c,event:u,structureSeedingProfile:d,seedingProfile:p,inContextDrawMatchUps:f,participants:h,positioningReport:m}){let A=t?whe({provisionalPositioning:e,tournamentRecord:i,appliedPolicies:r,drawDefinition:n,seedBlockInfo:a,matchUpsMap:s,structure:o,seedLimit:l,seedsOnly:c,event:u}):void 0;if(A?.error)return{error:A.error};let g=A?.unseededByePositions;return m.push({action:"positionByes",unseededByePositions:g}),A=Ihe({seedingProfile:d?{positioning:d}:p,provisionalPositioning:e,inContextDrawMatchUps:f,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:a.validSeedBlocks,drawDefinition:n,seedBlockInfo:a,participants:h,matchUpsMap:s,structure:o,event:u}),A.error?{error:A.error}:(m.push({seedPositions:A.seedPositions,action:"positionSeedBlocks"}),{unseededByePositions:g})}function $$e({drawType:t,LUCKY_DRAW:e,structureSeedingProfile:i,seedingProfile:r,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:s,appliedPolicies:o,validSeedBlocks:l,drawDefinition:c,seedBlockInfo:u,participants:d,matchUpsMap:p,structure:f,event:h,placeByes:m,seedLimit:A,seedsOnly:g,positioningReport:v}){let b;if(t!==e){let I=Ihe({seedingProfile:i?{positioning:i}:r,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:s,appliedPolicies:o,validSeedBlocks:l,drawDefinition:c,seedBlockInfo:u,participants:d,matchUpsMap:p,structure:f,event:h});if(I.error)return{error:I.error};v.push({action:"positionSeedBlocks",seedPositions:I.seedPositions})}let y=m?whe({provisionalPositioning:n,tournamentRecord:s,appliedPolicies:o,drawDefinition:c,seedBlockInfo:u,matchUpsMap:p,structure:f,seedLimit:A,seedsOnly:g,event:h}):void 0;return y?.error?{error:y.error}:(b=y?.unseededByePositions,v.push({action:"positionByes",byeDrawPositions:y?.byeDrawPositions,unseededByePositions:b}),{unseededByePositions:b})}function H$e({seedsOnly:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structure:c,positionQualifiers:u,positionUnseededParticipants:d,provisionalPositioning:p,unseededByePositions:f,multipleStructures:h,structureId:m,drawSize:A,event:g,positioningReport:v,conflicts:b}){if(t)return{};let y=u({inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structure:c});return y.error?{error:y.error}:(y.conflicts&&(b.qualifierConflicts=y.conflicts),v.push({action:"positionQualifiers",qualifierDrawPositions:y.qualifierDrawPositions}),y=d({provisionalPositioning:p,inContextDrawMatchUps:e,unseededByePositions:f,multipleStructures:h,tournamentRecord:i,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:m,structure:c,drawSize:A,event:g}),y.error?{error:y.error}:(y.conflicts&&(b.unseededConflicts=y.conflicts),v.push({action:"positionUnseededParticipants"}),{}))}function vR(t){let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:r,multipleStructures:n,placeByes:a=!0,tournamentRecord:s,seedingProfile:o,structureId:l,seedLimit:c,seedsOnly:u,drawType:d,drawSize:p,event:f}=t,h=[];i||(Ide(),e=St(e,!1,!0));let{structure:m,appliedPolicies:A,qualifiersCount:g,entries:v,error:b}=F$e(t,e,l,f);if(b)return eD(b,i);if(!v?.length&&!g)return O$e({...se},i);let y=t.matchUpsMap??ss({drawDefinition:e}),I=t.inContextDrawMatchUps??ea({inContext:!0,drawDefinition:e,matchUpsMap:y})?.matchUps,w=Vw({provisionalPositioning:r,appliedPolicies:A,drawDefinition:e,seedingProfile:o,structure:m});if(w.error)return eD(w,i);let{validSeedBlocks:S}=w;h.push({validSeedBlocks:S});let T=t.participants||(s?gn({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:s})?.participants:[]),D;if(gR(m.seedingProfile||o)===by){let R=L$e({placeByes:a,provisionalPositioning:r,tournamentRecord:s,appliedPolicies:A,drawDefinition:e,seedBlockInfo:w,matchUpsMap:y,structure:m,seedLimit:c,seedsOnly:u,event:f,structureSeedingProfile:m.seedingProfile,seedingProfile:o,inContextDrawMatchUps:I,participants:T,positioningReport:h});if(R?.error)return eD(R.error,i);D=R.unseededByePositions}else{let R=$$e({drawType:d,LUCKY_DRAW:ib,structureSeedingProfile:m.seedingProfile,seedingProfile:o,provisionalPositioning:r,inContextDrawMatchUps:I,tournamentRecord:s,appliedPolicies:A,validSeedBlocks:S,drawDefinition:e,seedBlockInfo:w,participants:T,matchUpsMap:y,structure:m,event:f,placeByes:a,seedLimit:c,seedsOnly:u,positioningReport:h});if(R?.error)return eD(R.error,i);D=R.unseededByePositions}let C={},E=H$e({seedsOnly:u,inContextDrawMatchUps:I,tournamentRecord:s,appliedPolicies:A,validSeedBlocks:S,drawDefinition:e,seedBlockInfo:w,participants:T,matchUpsMap:y,structure:m,positionQualifiers:T$e,positionUnseededParticipants:S$e,provisionalPositioning:r,unseededByePositions:D,multipleStructures:n,structureId:l,drawSize:p,event:f,positioningReport:h,conflicts:C});if(E?.error)return eD(E.error,i);let{positionAssignments:P}=Ir({drawDefinition:e,structure:m});return Br({drawDefinition:e,structureIds:[l]}),i||cF(),{positionAssignments:P,conflicts:C,...se,positioningReport:h}}function qC(t){let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,placeByes:o,seedsOnly:l}=t;if(!n)return{error:Ec};if(!Sh({drawDefinition:n,structureId:s})&&!i)return{error:Jz};let c=ghe({drawDefinition:n,structureId:s}).playoffStructures?.sort((p,f)=>Ox(p)-Ox(f)),u=[],d=[];if(c)for(let p of c){let{structureId:f}=p,h=vR({structureId:f,provisionalPositioning:i,applyPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,placeByes:o,seedsOnly:l});if(h.error)return h;h.positionAssignments&&u.push({positionAssignments:h.positionAssignments,structureId:f}),h.positioningReport&&d.push(h.positioningReport)}return{...se,structurePositionAssignments:u,positioningReports:d}}function She({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:s}){if(!i)return{error:Bt};if(!n)return{error:Bc};let o=(e?.participants??[]).find(p=>p.participantId===r);if(e&&!o)return{error:np};let{structure:l}=ui({drawDefinition:i,structureId:n});if(!l)return{error:nn};if(!(!t||Sn(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Sn(p)&&ri(p)>0)))return{error:be};let{seedAssignments:c}=pu({drawDefinition:i,structure:l}),u=c?.map(p=>p.seedNumber),d=c?.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(f=>parseInt(f)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...u||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return nfe({tournamentId:e?.tournamentId,eventId:s?.eventId,drawDefinition:i,structure:l}),{...se}}function l5({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return a5({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function mP({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=HC({drawDefinition:i,structureId:r})||{},s=(a?.target||[]).filter(({linkType:o})=>o===n).filter(({target:o})=>!t||t===o.roundNumber).map(o=>{let l=o.source.structureId,{structure:c}=ui({structureId:l,drawDefinition:i});if(!(e&&c?.finishingPosition!==e))return o}).filter(Boolean);return{sourceStructureIds:s.map(({source:o})=>o.structureId),relevantLinks:s}}var V$e=(t,e)=>{let i=[...new Set(e.slice(0,t.length))],r=[...i].sort((o,l)=>o-l),n=new Set,a=[];i.forEach(o=>{let l=t.indexOf(o);if(l!==-1&&!n.has(l))a.push(l),n.add(l);else{let c=r.indexOf(o),u=t.findIndex((d,p)=>!n.has(p));for(;n.has(u)&&u===-1&&n.size<t.length;)u=t.findIndex((d,p)=>!n.has(p)&&p>u);a.push(c),n.add(c)}});let s=t.filter((o,l)=>!n.has(l));return[...a,...s]};function Uhe({targetRoundNumber:t=1,tournamentRecord:e,drawDefinition:i,event:r,randomList:n}){let a=Gt({drawDefinition:i,event:r,tournamentRecord:e},[{[to]:!0,[lA]:!0,[Sa]:!0}]);if(a.error)return a;let s=[],o=[],l=i.structures?.find(A=>A.stage===Ut&&A.stageSequence===1);if(!l)return le({result:{error:aq}});let c=(er({tournamentRecord:e,drawDefinition:i,structure:l,event:r}).appliedPolicies??{})[bh]?.requireCompletedStructures,{qualifierPositions:u,positionAssignments:d}=va({structure:l});if(!u.length)return le({result:{error:mq}});let p=gt(0,u.length);n&&(p=V$e(p,n));let f=d.map(A=>A.participantId).filter(Boolean),{relevantLinks:h}=mP({structureId:l.structureId,targetRoundNumber:t,linkType:Ah,drawDefinition:i})||{},{relevantLinks:m}=mP({structureId:l.structureId,targetRoundNumber:t,linkType:mh,drawDefinition:i})||{};for(let A of h){let g=i.structures?.find(b=>b.structureId===A.source.structureId);if(g?.stage!==zt)continue;let v=Sh({structureId:A.source.structureId,drawDefinition:i});if(!c||v){let b=g.qualifyingRoundNumber,{matchUps:y}=cr({matchUpFilters:{...b&&{roundNumbers:[b]},isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,inContext:!0,structure:g});for(let I of y){let w=I.matchUpStatus==="BYE"&&I.sides?.find(({participantId:T})=>T),S=I.sides.find(T=>T?.sideNumber===I.winningSide);if(S||w){let{participantId:T}=S||w||{};T&&!f.includes(T)&&o.push(T)}}}}for(let A of m){let g=i?.structures?.find(v=>v.structureId===A.source.structureId);if(g?.stage===zt&&Sh({structureId:A.source.structureId,drawDefinition:i})){let{positionAssignments:v}=Ir({structure:g}),b=v?.map(y=>{let I=y.participantId,w=Bi({element:y,name:Om}).extension?.value;return w?{participantId:I,groupOrder:w?.groupOrder}:{}}).filter(({groupOrder:y,participantId:I})=>y===1&&!f.includes(I)).map(({participantId:y})=>y)??[];b&&o.push(...b)}}return o.length?(p.forEach((A,g)=>{let v=o[g],b=u[A].drawPosition;v&&l5({qualifyingParticipantId:v,structureId:l.structureId,drawPosition:b,tournamentRecord:e,drawDefinition:i})?.success&&s.push({participantId:v,drawPosition:b})}),le({result:Ft({...se,assignedParticipants:s})})):le({result:{error:Hue}})}function The({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>yi(i)))&&le({result:{error:be},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>dT(i.structureOrder)-dT(r.structureOrder)),{...se}):{error:Bt}}function ZF({drawDefinition:t}){let e=t.structures??[],i=t.links??[],r=new Map,n=A=>{let g=r.get(A)||r.set(A,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&r.get(A);if(g&&!g?.stage){let v=e.find(b=>b.structureId===A);g.stage=v?.stage}return g},a={},s={},o=i.map(A=>{let g=A.source.structureId,v=A.target.structureId,b=n(g),y=n(v);return[Iy,Xu,vF,by].includes(A.target.feedProfile)?(b?.targets.push(v),y?.sources.push(g)):A.target.feedProfile===Yu&&(y?.drawSources.push(g),b?.drawTargets.push(v)),s[v]=s[v]||A.target.feedProfile===Yu,a[v]=Ci([...a[v]||[],g]).filter(Boolean),[A.source.structureId,A.target.structureId]});for(let A of r.keys()){let g=r.get(A);if(g){let v=g.targets??[];for(;v.length;){let b=v.pop(),y=b&&r[b];y?.targets?.length?v.push(...y.targets):y&&(g.rootStage=y.stage)}if(g.rootStage||(g.rootStage=g.stage),!g.targets?.length){let b=g.sources??[];for(;b.length;){let y=b.pop(),I=y&&r[y];if(I?.sources?.length){for(let w of I.sources)g.progeny?.includes(w)||g.progeny?.push(w);b.push(...I.sources)}}}}}let l=0;for(let A of r.keys()){let g=r.get(A);if(g&&g.rootStage===zt){let v=[g.drawTargets?.[0]],b=0;for(;v.length;){b+=1;let y=v.pop(),I=y?r.get(y):void 0;I?.drawTargets?.length&&v.push(I.drawTargets[0])}g.distanceFromMain=b,b>l&&(l=b)}}let c=o.length;gt(0,Math.ceil(c/2)).forEach(()=>{o=gt(0,c).map(A=>{let g=o[A],v=o.reduce((b,y)=>Bo(g,y)?b.concat(...y):b,[])||[];return Ci(g.concat(...v))})});let u=o[0],d=(A,g)=>Pn(A,g).length===A.length,p=o.slice(1).reduce((A,g)=>A&&d(g,u),!0),f=[u].filter(Boolean),h=[u].filter(Boolean);e.forEach(A=>{let{structureId:g,stage:v}=A;f.find(b=>b.includes(g))||(f.push([g]),v!==Ya&&h.push([g]))});let m=p&&h.length===1;return!i?.length&&e.length===1&&n(e[0].structureId),{structureProfiles:Object.fromEntries(r),allStructuresLinked:m,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:s,structureGroups:f}}function Che({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=ZF({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...se}}function c5(t){let e=Gt(t,[{[Sa]:!0,[to]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=t;return G$e({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function G$e(t){let e=Gt(t,[{[to]:!0,[SF]:!0},{link:!0,[il]:pl,[iue]:rq}]);if(e.error)return e;let{drawDefinition:i,tournamentId:r,structure:n,eventId:a,link:s}=t,o=s.target.structureId,l=ui({drawDefinition:i,structureId:o});if(l.error)return le({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:l});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(n),i.links.push(s),Che({drawDefinition:i});let c=cr({structure:n})?.matchUps||[];return fg({drawDefinition:i,tournamentId:r,matchUps:c,eventId:a}),Br({drawDefinition:i,structureIds:[n.structureId]}),{...se}}function Ehe({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:be};if(!t)return{error:Bt};let i=Object.assign({},...e.map(r=>{if(!Ki(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Kt};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let s=i[a.structureId];s&&(a.structureName=s)}}return{...se}}function u5({drawDefinition:t,timeItem:e}){if(!t)return{error:Ec};if(!e)return{error:bq};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:yq};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),W1({drawDefinition:t}),{...se}}function Dhe(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,event:n}=t,a=Gt(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let s=i.structures??[],o=s.find(g=>g.structureId===r);if(!o)return{error:nn};let l=s.find(({stage:g,stageSequence:v})=>g===Ut&&v===1),c=r===l?.structureId,u=s.filter(({stage:g})=>g===zt).map(Kl("structureId"));if(c&&!u.length)return{error:aue};let d=u.includes(r),p=Q$e({isQualifyingStructure:d,structure:o,...t});if(p?.error)return p;let{structureIdsToRemove:f,relatedStructureIdsMap:h}=z$e({qualifyingStructureIds:u,isQualifyingStructure:d,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureId:r}),{removedMatchUpIds:m,removedStructureIds:A}=q$e({relatedStructureIdsMap:h,qualifyingStructureIds:u,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:f,structureId:r});if(j$e({removedMatchUpIds:m,drawDefinition:i}),c){let g=(l.matchUps??[])?.map(Kl("matchUpId"));m.push(...g),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&Che({drawDefinition:i}),$h({tournamentId:e?.tournamentId,matchUpIds:m,action:"removeStructure",eventId:n?.eventId,drawDefinition:i}),Br({drawDefinition:i,eventId:n?.eventId}),{...se,removedMatchUpIds:m,removedStructureIds:A}}function Q$e({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:s}){let o=[r];if(t){let l=u=>i.links?.find(d=>d.target.structureId===u),c=l(r)?.source.structureId;for(;c;)o.push(c),c=l(c)?.source.structureId}if(ea({matchUpFilters:{structureIds:o},drawDefinition:i}).matchUps?.some(({score:l})=>ya({score:l}))){let l=er({tournamentRecord:e,drawDefinition:i,structure:n,event:a})?.appliedPolicies;if(!(s??l?.[du]?.allowDeletionWithScoresPresent?.structures))return{error:_1}}return{...se}}function j$e({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=ea({drawDefinition:e});i?.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function z$e({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let s=(n.structures??[]).map(Kl("structureId")),o=u=>n.links?.map(d=>d.source.structureId===u&&d.target.structureId!==r?.structureId&&d.target.structureId).filter(Boolean)??[],l=u=>n.links?.map(d=>t.includes(d.source.structureId)&&d.target.structureId===u&&d.source.structureId).filter(Boolean)??[],c=new Map;return s.forEach(u=>c.set(u,e?l(u):o(u))),{structureIdsToRemove:i?c.get(a):[a],relatedStructureIdsMap:c}}function q$e({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:s}){let o=[],l=[];for(;a?.length;){let c=a.pop();l.push(...Y$e({idBeingRemoved:c,drawDefinition:n}));let u=K$e({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:c,drawDefinition:n,structureId:s});o.push(...u.removedStructureIds);let d=W$e({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:c,structureId:s});d?.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:o}}function W$e({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){return t&&e.get(t)?.filter(n=>n!==i?.structureId||r===i.structureId)}function K$e({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){let a=[];return r.links=r.links?.filter(s=>s.source.structureId!==i&&s.target.structureId!==i)??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function Y$e({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=ui({structureId:t,drawDefinition:e}),r=cr({structure:i}).matchUps;return aW(r)}function Qx({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:Bt};if(!BW({drawDefinition:e,stage:r}))return{error:eb};let n=wLe({drawDefinition:e,stage:r}),{qualifiersCount:a}=QC({drawDefinition:e,stageSequence:t,stage:r}),s=n+a;if(i<s)return{error:uue};let{entryProfile:o}=NW({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return Br({drawDefinition:e}),{...se,entryProfile:o}}function Phe({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?BW({drawDefinition:e,stage:i})?(NW({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),Br({drawDefinition:e}),{...se}):{error:eb}:{error:Bt}}function X$e({drawDefinition:t,drawSize:e}){if(!t)return{error:Bt};let i=Qx({stage:Ya,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(Br({drawDefinition:t}),{...se})}function Rhe(t){return X$e(t)}function Mhe({tournamentRecord:t,drawDefinition:e,event:i,structureId:r}){if(!e)return{error:Bt};let n=e.structures?.find(s=>s.stage===zt&&s.structureId===r);if(!n)return{error:nn};if(n.matchUps?.some(({matchUpStatus:s,score:o})=>ya({score:o})??qn.includes(s)))return{error:_1};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],$h({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),Br({tournamentId:t?.tournamentId,eventId:i?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...se}}var Z$e="qualifierDrawPositionAssignment",J$e="withdrawParticipantAtDrawPosition",eHe="alternateDrawPositionAssignment",tHe="luckyLoserDrawPositionAssignment",cee="removeDrawPositionAssignment",Nhe="swapDrawPositionAssignments",iHe="modifyPairAssignment",rHe="adHocPositionSwap",nHe="modifyParticipantOtherName",uee="assignDrawPosition",aHe="removeSeededParticipant",sHe="assignDrawPositionBye",oHe="modifySeedAssignment",Bhe="addPenalty",d5="MODIFY_PAIR",JF="QUALIFIER",p5="ALTERNATE",f5="WITHDRAW",qI="ASSIGN",Fj="REMOVE",h5="LUCKY",i0="REMOVE_SEED",eL="SWAP",AP="NICKNAME",yI="SEED_VALUE",WI="PENALTY",Qw={MODIFY_PAIR_ASSIGNMENT:d5,QUALIFYING_PARTICIPANT:JF,ALTERNATE_PARTICIPANT:p5,WITHDRAW_PARTICIPANT:f5,ASSIGN_PARTICIPANT:qI,LUCKY_PARTICIPANT:h5,REMOVE_ASSIGNMENT:Fj,SWAP_PARTICIPANTS:eL,ADD_NICKNAME:AP,REMOVE_SEED:i0,ADD_PENALTY:WI,ASSIGN_BYE:"BYE",SEED_VALUE:yI};function khe({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:Bt};if(!r)return{error:Bc};if(i?.length!==2)return{error:be,drawPositions:i};let a=ss({drawDefinition:e}),{matchUps:s}=ea({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:o}=ui({drawDefinition:e,structureId:r});if(!o)return{error:nn};let l=er({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},c;if(o.structureType===Ao?c=uHe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}):c=lHe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}),c.error)return c;if(EW({structure:o,drawPositions:i}),K1({appliedPolicies:l,drawDefinition:e,positionAction:{name:Nhe,drawPositions:i,structureId:r}}),Fm({tournamentId:t?.tournamentId,drawDefinition:e,structure:o,event:n}),n.eventType===jl){let u=cr({matchUpFilters:{matchUpTypes:[Cc]},inContext:!0,structure:o}).matchUps.filter(p=>p.drawPositions?.some(f=>i.includes(f))),d=cr({matchUpFilters:{matchUpTypes:[Cc]},structure:o}).matchUps;u.forEach(p=>{(p.sides||[]).forEach(f=>{let h=f?.drawPosition;if(i.includes(h)){let m=f.participantId,A=d.find(({matchUpId:v})=>v===p.matchUpId),g=p?.sides?.reduce((v,b,y)=>b.drawPosition===h?y:v,void 0);i5({inContextTargetMatchUp:p,drawPositionSideIndex:g,teamParticipantId:m,tournamentRecord:t,drawDefinition:e,matchUp:A,event:n})}})})}return Br({drawDefinition:e,structureIds:[r]}),{...se}}function lHe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a?.positionAssignments.filter(c=>r?.includes(c.drawPosition));if(!o)return{error:be,structure:a,info:"Missing positionAssignments"};if(o.filter(({bye:c})=>c).length===2)return{...se};if(o.filter(({qualifier:c})=>c).length===2)return{...se};let l=o.some(({qualifier:c})=>c);return o.some(({bye:c})=>c)&&!l?xhe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s}):cHe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s})}function xhe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=r.find(({bye:h})=>h),l=r.find(({participantId:h})=>h),c=o.drawPosition,{participantId:u,drawPosition:d}=l,{structureId:p}=a,f=hP({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return f.error||(f=hP({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),f.error)||(Oc({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:s}),f=lf({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:u,matchUpsMap:n,event:s}),f.error)?f:{...se}}function cHe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=Object.assign({},...r.map((l,c)=>{let{drawPosition:u}=l,d={...r[1-c],drawPosition:u};return{[u]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>o[l.drawPosition]||l),n5({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:s}),{...se}}function uHe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a.structures?.reduce((c,u)=>{let d=u?.positionAssignments.filter(p=>r?.includes(p.drawPosition));return d&&c.push(...d),c},[]);if(o.filter(({bye:c})=>c).length===2)return{...se};if(o.filter(({qualifier:c})=>c).length===2)return{...se};n5({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:o,structure:a,event:s});let l=o.some(({qualifier:c})=>c);if(o.some(({bye:c})=>c)&&!l)xhe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s});else{let c=St(o,!1,!0);o.forEach((u,d)=>{let p=c[1-d].participantId;u.qualifier=c[1-d].qualifier,u.participantId=p})}return{...se}}function _he({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){let n="removeSeededParticipant";if(!t)return{error:rt};if(!e)return{error:Bt};let a=(e.structures??[]).find(s=>s.structureId===r);return a?!a.stage||![Ut,zt].includes(a.stage)||a.stage===Ut&&a.stageSequence!==1?le({result:{error:Zy},stack:n}):a.seedAssignments?.find(s=>s.participantId===i)?{...se}:le({info:"participant not seeded",result:{error:ts},context:{participantId:i}}):le({result:{error:nn},stack:n})}function yR({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=Ah}){return!r||!n?{error:Bc}:{link:Ft({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:Yu,roundNumber:t,structureId:n}})}}function jw({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>bR({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function bR({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:s,matchUpType:o,collectionId:l,processCodes:c}=e||{},u=i??s??0,d=p=>{if(!n&&!r?.isMock)return a?.pop()??fr();let f=e?.collectionId;return a?.pop()??`${r?.matchUpId}-${f}-TMU-${p+1}`};return gt(0,u).map(p=>{let f=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Rn,collectionPosition:f,collectionId:l,processCodes:c,matchUpType:o,isMock:n}})}function m5({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:r?.pop()||fr()}function jx({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:s,nodes:o}){let l=0,c=[],u=1,d=i-1,p=o?.length;for(;l<(p||0);){let f=o?.[l],h=o?.[l+1];d&&(f.roundNumber=d),h&&d&&(h.roundNumber=d);let m=m5({roundPosition:u,roundNumber:i,idPrefix:n,uuids:s}),A={roundPosition:u,children:[f,h],matchUpId:m};c.push(A);let g={drawPositions:A.children.map(v=>v?.drawPosition).filter(Boolean),matchUpStatus:Rn,matchUpId:A.matchUpId,roundPosition:u,roundNumber:i};t&&e&&(g.matchUpType=e),a&&(g.isMock=!0),r.push(g),u++,l+=2}return{roundNodes:c,matchUps:r}}function cf({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:s,drawSize:o,isMock:l,uuids:c}){if(isNaN(o)||o<2||r&&o<=r)return{matchUps:[],roundsCount:0};if(r&&(!rp(o)||o%r)){let A=r;for(;A<o;)A=2*A;o=A}let u=r&&!(o%2)&&(!isNaN(r)||i&&!isNaN(i))&&(o/r===Math.round(o/r)||i&&o/i===Math.round(o/i));if(!rp(o)&&!u)return{matchUps:[],roundsCount:0};let d=gt(1,o+1).map(A=>({drawPosition:A})),p,f=[],h=1;for({roundNodes:p,matchUps:f}=jx({matchUpType:n,roundNumber:h,idPrefix:s,matchUps:f,isMock:l,nodes:d,uuids:c}),h++,a=a??i;p.length>1;)r&&p.length===r&&(a=h-1),{roundNodes:p,matchUps:f}=jx({nodes:p,matchUpType:n,roundNumber:h,idPrefix:s,matchUps:f,isMock:l,uuids:c}),h++;let m=h-1;return f=cR({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:a,matchUps:f}),a?f=f.filter(A=>a&&(A.roundNumber??0)<=a):a=h-1,{drawSize:o,matchUps:f,roundsCount:m,roundLimit:a}}function dHe(t,e){return t.drawDefinition?t.drawSize&&!yi(t.drawSize)||t.participantsCount&&!yi(t.participantsCount)||t.qualifyingPositions&&!yi(t.qualifyingPositions)?le({result:{error:be},stack:e}):t.drawSize?t.qualifyingPositions&&t.qualifyingPositions>=t.drawSize?le({result:{error:be},context:{drawSize:t.drawSize,qualifyingPositions:t.qualifyingPositions},stack:e}):null:le({result:{error:M1},context:{drawSize:t.drawSize},stack:e}):le({result:{error:Bt},stack:e})}function pHe(t,e,i){let{structureProfiles:r}=ZF({drawDefinition:t});return r[e]||le({result:{error:nn},context:{targetStructureId:e},stack:i})}function fHe(t){let{maxRoundNumber:e,structures:i,groupCount:r}=mR(t);return{qualifiersCount:r,roundLimit:e,structure:i[0],finishingPositions:[1]}}function hHe(t){let{drawSize:e,matchUps:i,roundLimit:r,roundsCount:n}=cf(t);r||(r=n);let a=iu({structureName:t.structureName,structureId:t.structureId,qualifyingRoundNumber:r,stage:zt,matchUpFormat:t.matchUpFormat,stageSequence:t.stageSequence,matchUpType:t.matchUpType,roundLimit:r,matchUps:i});t.roundTarget&&lr({extension:{name:Ef,value:t.roundTarget},element:a});let s=i?.filter(o=>o.roundNumber===r)?.length??0;return{drawSize:e,structure:a,matchUps:i,roundLimit:r,qualifiersCount:s}}function A5(t){let e="generateQualifyingStructure",i=dHe(t,e);if(i)return i;let r=t.drawSize??Xz(t.participantsCount),{hasExistingDrawDefinition:n,qualifyingRoundNumber:a,qualifyingPositions:s,targetStructureId:o,structureOptions:l,appliedPolicies:c,qualifyingOnly:u,drawDefinition:d,matchUpFormat:p,structureName:f,structureId:h,roundTarget:m,tieFormat:A,drawType:g,idPrefix:v,isMock:b,uuids:y}=t,I=pHe(d,o,e);if(I?.error)return I;let w=d.matchUpType,S=1,T=m?`${m}-`:"",D=typeof I=="object"&&"stage"in I&&I.stage===zt,C=c?.[km]?.namingConventions?.pre??ELe[km]?.namingConventions?.pre,E=D&&C?`${C}-`:"",P=f??(T?`${E}${Bs(zt)} ${T}`:`${E}${Bs(zt)}`),R,M,N,k,O;if(g===gd){let _=fHe({structureName:f??P,structureId:h??y?.pop(),hasExistingDrawDefinition:n,stage:zt,structureOptions:l,appliedPolicies:c,qualifyingOnly:u,stageSequence:S,matchUpType:w,roundTarget:m,tieFormat:A,idPrefix:v,drawSize:r,isMock:b,uuids:y});k=_.qualifiersCount,N=_.roundLimit,R=_.structure,O=_.finishingPositions}else{let _=hHe({qualifyingRoundNumber:a,qualifyingPositions:s,matchUpType:w,idPrefix:v,drawSize:r,isMock:b,uuids:y,structureName:f??P,structureId:h??y?.pop(),matchUpFormat:p,stageSequence:S,roundTarget:m});r=_.drawSize,R=_.structure,N=_.roundLimit,k=_.qualifiersCount}let x=g===gd?mh:Ah,F=R&&N&&yR({sourceStructureId:R.structureId,sourceRoundNumber:N,targetStructureId:o,finishingPositions:O,linkType:x})?.link;return A&&(M=cr({structure:R})?.matchUps||[],M?.forEach(_=>{let{tieMatchUps:V}=jw({tieFormat:A,matchUp:_,isMock:b});Object.assign(_,{tieMatchUps:V,matchUpType:w})})),{qualifyingDrawPositionsCount:r,qualifiersCount:k,...se,structure:R,link:F}}function Ohe(t){if(!t.tournamentRecord)return{error:rt};let e=mHe(t);return e.error,e}function mHe(t){if(!t.drawDefinition)return{error:Bt};if(!t.targetStructureId)return{error:Bc};let e=A5(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:be}:c5({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function Fhe(t){let e=Gt(t,[{[to]:!0,[bF]:!0,[Cf]:!0},{[BFe]:!0,[Es]:d=>Number.isInteger(d)&&d>0},{[Es]:d=>Array.isArray(d)&&d.length===2&&d.every(Lr),[Dc]:Fl,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r,tournamentRecord:n,event:a}=t,{structure:s}=ui({drawDefinition:i,structureId:r});if(!s)return{error:nn};if(!Yo({structure:s}))return{error:Zy};let o=d=>d.sides?.map(p=>p.participantId).some(p=>t.participantIds.includes(p)),l=d=>d.roundNumber===t.roundNumber,c=d=>!ya(d),u=(s?.matchUps??[]).filter(l).filter(c).filter(o);if(u.length!==2)return{error:Fl};for(let d of u){let p=d?.sides?.find(f=>t.participantIds.includes(f?.participantId));if(p){let f=t.participantIds.find(h=>h!==p?.participantId);p.participantId=f,Yi({tournamentId:n?.tournamentId,eventId:a?.eventId,drawDefinition:i,matchUp:d})}}return Br({drawDefinition:i,structureIds:[r]}),{...se}}function AHe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:s,uuids:o,nodes:l,fed:c}){let u=l.length,d=e?e-u:void 0,p=gt(0,u).map(m=>d?d+m:void 0),f=[];for(let m=0;m<u;m++){let A=p.shift(),g={drawPosition:A,fed:c+1,feed:!0},v=l[m];v.roundNumber=i-1;let b=m5({roundPosition:v.roundPosition,roundNumber:i,idPrefix:n,uuids:o}),y={roundPosition:v.roundPosition,drawPositions:[A],matchUpStatus:Rn,roundNumber:i,matchUpId:b};t&&(y.matchUpType=r),s&&(y.isMock=!0),a.push(y);let I={children:[v,g]};f.push(I)}let h=e?e-u:void 0;return{roundNodes:f,matchUps:a,drawPosition:h}}function Ag(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:s,finishingPositionOffset:o,linkFedRoundNumbers:l,feedsFromFinal:c,isConsolation:u,matchUpType:d,idPrefix:p,isMock:f,uuids:h,fmlc:m}=t;a=a??M(e);let A=gHe({drawSize:a}),g=A.length,v=0;if(i?.length)v=i.reduce((N,k)=>N+k,0);else if(e){let N=e-a;i=A.filter(k=>k<=N?(N-=k,!0):!1),v=i.reduce((k,O)=>k+O,0),r=i.length}else n>=g?r=0:c&&(r=g-c,n=0),i=A.filter((N,k)=>c&&!r||r&&k>=n+r||k<n?0:N),v=i.reduce((N,k)=>N+k,0),r=i.length;let b=[...A,...i].sort((N,k)=>k-N),y=b.length,I=[...(l??[]).map(N=>N-1),...(s??[]).map(N=>y-N)].map(N=>b[N]).reduce((N,k)=>N+k,0);v=v-I;let w=0,S=[],T,D=1,C=gt(0,a).map((N,k)=>({drawPosition:k+1+v})),E=v+1;for(let N of A){if({roundNodes:T,matchUps:S}=jx({matchUpType:d,roundNumber:D,idPrefix:p,matchUps:S,isMock:f,nodes:C,uuids:h}),D++,i.includes(N)){let k=Vl(i)[N],O=gt(0,k),x=y+1-D,F=s?.includes(x)??l?.includes(D);O.forEach(()=>{({roundNodes:T,matchUps:S,drawPosition:E}=AHe({drawPosition:!F&&E||void 0,nodes:T,matchUpType:d,roundNumber:D,idPrefix:p,matchUps:S,isMock:f,uuids:h,fed:w})),D++,w+=1})}C=T}y!==D-1&&console.log("ERROR");let P=a-v;S=cR({finishingPositionOffset:u?P:o,positionsFed:v,roundsCount:y,matchUps:S,fmlc:m});let R=T?.length?T[0]:T;return R&&(R.roundNumber=D-1,R.matchUps=S),{draw:R,matchUps:S,roundsCount:y};function M(N){let k=Zz(N);return k>N?k/2:k}}function gHe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return gt(0,e).reverse().map(i=>Math.pow(2,i))}function ZU(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,stageSequence:o=1,exitProfile:l="0",exitProfileLimit:c,roundOffsetLimit:u,roundOffset:d=0,drawDefinition:p,staggeredEntry:f,sequenceLimit:h,stage:m=Ut,drawSize:A,idPrefix:g,isMock:v,uuids:b}=t;if(!(!s||!c||s?.[l])||A<2||h&&o>h)return{};let y=[],I=[],w=[],S=t.matchUpType??p?.matchUpType,T=e+1,D=e+A,C=`${T}-${D}`,E=s?.[l],P=r&&`${r} `||"",R=s?.[C]??n?.[C],M=t.structureName||R?.name||E?.name&&(i?`${P}${E?.name}`:E.name)||`${P}${C}`,N=R?.abbreviation??E?.abbreviation,k=t.structureId??E?.structureId??b?.pop(),O={idPrefix:g&&`${g}-${M}-RP`,finishingPositionOffset:e,matchUpType:S,drawSize:A,isMock:v,uuids:b},{matchUps:x}=f?Ag(O):cf(O),F=iu({structureAbbreviation:N,stageSequence:o,structureName:M,matchUpType:S,roundOffset:d,structureId:k,matchUps:x,stage:m});y.push(...x),I.push(F);let _=Math.ceil(Math.log(A)/Math.log(2)),V=u?Math.min(u-d,_):(!a||T<a)&&_||0;return A>2&&gt(1,V+1).forEach(z=>G(z)),{structureId:F.structureId,matchUps:y,structureName:M,structures:I,links:w,...se};function G(z){let Q=A/Math.pow(2,z);if(Q<2)return;let j=A/Math.pow(2,z)+e;if(a&&j+1>a)return;let{structures:W,structureId:Y,matchUps:X,links:J}=ZU({finishingPositionOffset:j,exitProfile:`${l}-${z}`,roundOffset:d+z,stageSequence:o+1,drawSize:Q,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,exitProfileLimit:c,roundOffsetLimit:u,drawDefinition:p,sequenceLimit:h,matchUpType:S,idPrefix:g,uuids:b,stage:m});if(F.structureId&&Y){let ie={linkType:gh,source:{roundNumber:z,structureId:F.structureId},target:{roundNumber:1,feedProfile:Xu,structureId:Y}};J&&F&&J.push(ie),J?.length&&w.push(...J)}return W?.length&&I.push(...W),X?.length&&y.push(...X),{structureId:Y,childLinks:J,structures:I}}}function g5({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=ui({drawDefinition:t,structureId:i});if(r.error)return le({result:r});let{matchUps:n}=cr({structure:r.structure,matchUpsMap:e});return{...ko({matchUps:n}),matchUps:n,matchUpsMap:e}}function dee({finishingPositions:t,drawDefinition:e,structureId:i}){let{roundProfile:r}=g5({drawDefinition:e,structureId:i});return(r&&Object.keys(r))?.reduce((n,a)=>(Lhe(r?.[a]).forEach(s=>{t.forEach(o=>{vHe({position:o,rangeDefinition:s})&&(n[o]={roundNumber:a})})}),n),{})}function vHe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return gt(i,(r||i)+1).includes(t)}function Lhe(t){return[Ci(t?.finishingPositionRange?.loser||[]),Ci(t?.finishingPositionRange?.winner||[])]}function yHe(t){return Lhe(t).map(e=>gt(e[0],e[1]&&e[1]+1||e[0]+1))}function WC({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:be,context:{structureIds:e}};if(!t)return{error:Bt};e=e??(t.structures??[]).filter(a=>a.stage!==zt).map(({structureId:a})=>a);let r=e.map(a=>{let{roundProfile:s}=g5({drawDefinition:t,matchUpsMap:i,structureId:a});return(s&&Object.values(s))?.map(yHe).flat()}).flat(),n=r.filter(a=>a?.length===1).sort(la).flat();return{positionsNotPlayedOff:Ci(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function $he({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:Bt};if(!r)return{error:Bc};if(!e)return{error:Kt,info:"missing playoffPositions"};let n=WC({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,s=e.filter(g=>!a.includes(g)),o=dee({finishingPositions:s,drawDefinition:i,structureId:r}),l=Object.values(o).reduce((g,v)=>g.includes(v.roundNumber)?g:g.concat(v.roundNumber),[]).map(g=>ri(g)).filter(g=>!t.includes(g)),c=dee({finishingPositions:a,drawDefinition:i,structureId:r}),u=c?Object.values(c):[],d=c?u.reduce((g,v)=>g.includes(v.roundNumber)?g:g.concat(v.roundNumber),[]).map(g=>ri(g)):[],p=l.filter(g=>!d.includes(g)).sort(la),{roundProfile:f}=g5({drawDefinition:i,structureId:r}),h=p.map(g=>{let v=f?.[g].finishingPositionRange.loser,[b,y]=v??[0,0];return gt(b,(y||b)+1)}).flat().sort(la),{playoffRoundsRanges:m}=bHe({playoffSourceRounds:p,roundProfile:f}),A=[...p,...d];return{playoffPositionsReturned:h,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:A,roundProfile:f}}function bHe({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,s=gt(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:s,roundNumber:i}})}}function IR({drawDefinition:t,structureId:e}){if(!t)return{error:Bt};let{matchUps:i,matchUpsMap:r}=Do({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=WC({drawDefinition:t,matchUpsMap:r}),{structures:s}=yd({drawDefinition:t}),o=s.filter(c=>!e&&c.stage!==Ya||c.structureId===e),l={};for(let c of o){let u=c?.structureId,d=IHe({playoffPositions:n,drawDefinition:t,structure:c,matchUps:i}),{error:p,...f}=d;if(p)return d;l[u]={structureId:u,...f}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function IHe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){let n=i?.structureId,{links:a}=HC({drawDefinition:e,structureId:n});if(i.structureType===Ao||i.structures){let f=Ir({structure:i})?.positionAssignments?.length,h=i.structures.length,m=(f??0)/h,A=a.source?.flatMap(({source:C})=>C?.finishingPositions||[])||[],g=gt(1,m+1).filter(C=>!A.includes(C)),v=r.find(C=>C.containerStructureId===n&&C.finishingPositionRange)?.finishingPositionRange?.winner||[0,1],b=a?.source.map(({target:C})=>C.structureId),{positionsPlayedOff:y=[],positionsNotPlayedOff:I=[]}=WC({structureIds:b,drawDefinition:e}),w=new Set([...y,...I]),S=gt(v[0],v[1]+1).filter(C=>!w.has(C)),T=Oa(S,S.length/g.length),D=g.map((C,E)=>{let P=T[E],R=[Math.min(...P||[]),Math.max(...P||[])].join("-");return{finishingPosition:C,finishingPositions:P,finishingPositionRange:R}});return{positionsNotPlayedOff:S,playoffFinishingPositionRanges:D,finishingPositionsAvailable:g,finishingPositionsPlayedOff:A,positionsPlayedOff:y,groupCount:h,groupSize:m}}let s=a?.source?.filter(f=>f.linkCondition!==sf).map(f=>f.source?.roundNumber)||[],o=a?.source?.filter(f=>f.linkCondition===sf).map(f=>f.source?.roundNumber)||[],l=$he({excludeRoundNumbers:s,playoffPositions:t,drawDefinition:e,structureId:n}),c=l?.playoffSourceRounds?[...l?.playoffSourceRounds||[]]:void 0,u=[...l?.playoffRoundsRanges||[]],{roundProfile:d,error:p}=l;for(let f of o){let h=a?.source.find(b=>b.source.roundNumber===f),m=h?.target.roundNumber,A=h?.target.structureId,g=r.filter(({roundNumber:b,structureId:y})=>y===A&&b===m),v=g.filter(({sides:b})=>b.find(y=>y.participantFed&&!y.participantId)).length;if(c&&v===g.length){c.push(f);let b=d?.[f]?.finishingPositionRange?.loser;if(b){let y=Math.min(...b),I=y+v,w=gt(y,I),S={finishingPositionRange:[y,I-1].join("-"),finishingPositions:w,roundNumber:f};u.push(S)}}}return c&&c.sort(la),u.sort((f,h)=>f.roundNumber-h.roundNumber),{playoffRounds:c,playoffRoundsRanges:u,error:p}}function wHe({playoffGroups:t,drawDefinition:e,structureId:i}){if(!e)return{error:Bt};if(!Lr(i)||!Array.isArray(t))return{error:be};let r=t.map(({finishingPositions:n})=>n).flat();return{positionRangeMap:IR({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges?.filter(n=>r.includes(n.finishingPosition))?.reduce((n,a)=>(n[a.finishingPosition]=a,n),{})}}function Hhe(t){let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:r=1,staggeredEntry:n,structureName:a,stage:s=Ut,matchUpType:o,structureId:l,idPrefix:c,drawSize:u,isMock:d,uuids:p}=t,f={finishingPositionOffset:e,matchUpType:o,drawSize:u,idPrefix:c,isMock:d,uuids:p},{matchUps:h}=n?Ag(f):cf(f),m=iu({structureName:a||i?.["0"]?.name||Bs(Ut),structureId:l||p?.pop(),stageSequence:r,matchUpType:o,matchUps:h,stage:s}),A=[m],g=[];if(u>2){let v=u/2,{matchUps:b}=cf({finishingPositionOffset:e+v,idPrefix:c&&`${c}-c`,drawSize:v,matchUpType:o,isMock:d}),y=Bs(Os),I=i?.["0-1"]?.name??t.consolationStructureName??(a?`${a} ${y}`:y),w=iu({structureName:I,matchUps:b,structureId:p?.pop(),stage:Os,stageSequence:1,matchUpType:o});A.push(w);let S={linkType:gh,source:{roundNumber:1,structureId:m.structureId},target:{roundNumber:1,feedProfile:Xu,structureId:w.structureId}};g.push(S)}return{...se,structures:A,links:g}}function Vhe({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let s=t.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),o=n?.roundGroupedOrder||[],l=n?.roundFeedProfiles;return gt(1+e,r+1+e).map(c=>{let u=l?.[c-1]?l[c-1]:c%2&&Xu||Iy,d=c-e<=2?c-e:(c-e-2)*2+2,p={linkType:gh,source:{roundNumber:c,structureId:i.structureId},target:{feedProfile:u,roundNumber:d,structureId:t.structureId}},f=o[c-1];return f&&(p.target.groupedOrder=f),Gl()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),c===2&&a&&(p.linkCondition=sf,p.target.feedProfile=Xu),s.includes(d)?p:void 0}).filter(Boolean)}function Ghe(t){let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:r=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:s,stage:o=Ut,matchUpType:l,structureId:c,drawSize:u,idPrefix:d,isMock:p,uuids:f}=t,h={finishingPositionOffset:i,matchUpType:l,drawSize:u,idPrefix:d,isMock:p,uuids:f},{matchUps:m,roundsCount:A}=s?Ag(h):cf(h),g=t.structureName??n?.["0"]?.name??Bs(Ut),v=ag({structureId:c||f?.pop(),structureName:g,stageSequence:r,matchUpType:l,matchUps:m,stage:o}),b=[v],y=[];if(u>2){let I=[0,2].slice(0,u/16).map((w,S)=>{let T=S+1,{consolationStructure:D}=SHe({idPrefix:d&&`${d}-c${S}`,structureId:f?.pop(),playoffStructureNameBase:e,playoffAttributes:n,structureNameMap:a,stageSequence:T,roundOffset:w,matchUpType:l,drawSize:u,isMock:p,index:S,uuids:f});b.push(D);let C=Vhe({consolationStructure:D,roundsCount:2,mainStructure:v,roundOffset:w});return{consolationStructure:D,links:C}}).map(w=>w.links).flat();if(y.push(...I),u>=4&&u<=16||u>32){let{matchUps:w}=cf({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),S=n?.["3-4"]?.name??Bs(Tn),T=a?.[S]||S,D=e?`${e} ${T}`:T,C=ag({structureId:f?.pop(),matchUps:w,stageSequence:2,stage:Tn,structureName:D,matchUpType:l}),E={linkType:gh,source:{roundNumber:A-1,structureId:v.structureId},target:{structureId:C.structureId,feedProfile:Xu,roundNumber:1}};b.push(C),y.push(E)}}return{structures:b,links:y,...se}}function SHe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:s,idPrefix:o,drawSize:l,isMock:c,index:u,uuids:d}){let p=l/(2*Math.pow(2,n)),{matchUps:f,roundsCount:h}=Ag({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:o,isMock:c,uuids:d}),m=u===0&&i?.["0-1"]?.name||u===1&&i?.["0-3"]?.name||`${Bs(Os)} ${u+1}`,A=r?.[m]||m,g=t?`${t} ${A}`:A;return{consolationStructure:ag({matchUps:f,stage:Os,structureName:g,stageSequence:e,matchUpType:a,structureId:s}),consolationRoundsCount:h}}function Yb(t){let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:r,feedsFromFinal:n,staggeredEntry:a,structureName:s,stage:o=Ut,structureId:l,matchUpType:c,skipRounds:u,feedRounds:d,idPrefix:p,drawSize:f,isMock:h,uuids:m,fmlc:A}=t,g=t.feedPolicy||t.policyDefinitions?.[wT]||t.appliedPolicies?.[wT],v={finishingPositionOffset:e,matchUpType:c,skipRounds:u,drawSize:f,idPrefix:p,isMock:h,uuids:m},{matchUps:b}=a?Ag(v):cf(v),y=iu({structureName:s||r?.["0"]?.name||Bs(Ut),structureId:l||m?.pop(),stageSequence:i,matchUpType:c,matchUps:b,stage:o}),I=[y],w=[],S=f/2,{matchUps:T,roundsCount:D}=Ag({finishingPositionOffset:S,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:S,matchUpType:c,feedRounds:d,skipRounds:u,isMock:h,uuids:m,fmlc:A});if(f>2){let C=r?.["0-1"]?.name??Bs(Os),E=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${C}`:C,P=iu({matchUps:T,structureId:m?.pop(),stage:Os,stageSequence:1,structureName:E,matchUpType:c});I.push(P);let R=Vhe({consolationStructure:P,mainStructure:y,roundsCount:D,feedPolicy:g,fmlc:A});w.push(...R)}return{...se,structures:I,links:w}}function Qhe({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:s,playoffGroups:o,matchUpType:l,feedPolicy:c,groupCount:u,idPrefix:d,isMock:p,uuids:f}){c=c||n?.[wT];let h="processPlayoffGroups",m=0,A=[],g=[],v=[],{error:b,positionRangeMap:y}=wHe({structureId:r,drawDefinition:s,playoffGroups:o});if(b)return le({result:{error:b},stack:h});if(!(!y||o?.every(I=>{let{finishingPositions:w=[]}=I;if(!w.length)return!1;let S=[...w].sort(la).map((T,D)=>(w[D+1]||T)-T).every(T=>T<2);return(!t||S)&&w.every(T=>y[T])})))return le({context:{validFinishingPositions:Object.values(y)},result:{error:be},stack:h});for(let I of o){let w=I.finishingPositions,S=y&&w.flatMap(N=>y[N]?.finishingPositions??[]),T=u*w.length,D=CC(T),C=D===2&&jp||I.drawType||jp;S&&(m=Math.min(...S)-1);let E=S&&`${Math.min(...S)}-${Math.max(...S)}`,P=I.structureName||E&&I.playoffAttributes?.[E]?.name||I.playoffAttributes?.["0"]?.name,R={addNameBaseToAttributeName:I.addNameBaseToAttributeName,playoffStructureNameBase:I.playoffStructureNameBase,finishingPositionNaming:I.finishingPositionNaming,finishingPositionLimit:I.finishingPositionLimit,structureId:I.structureId??f?.pop(),playoffAttributes:I.playoffAttributes,structureNameMap:I.structureNameMap,sequenceLimit:I.sequenceLimit,structureName:P,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:m,stage:Tn,stageSequence:a,matchUpType:l,drawSize:D,isMock:p,uuids:f},M=({playoffStructures:N,playoffLinks:k})=>{let[O]=N,x=JN({playoffStructureId:O.structureId,finishingPositions:w,sourceStructureId:r});v.push(x,...k),g.push(...N),A.push({structureId:O.structureId,finishingPositions:w}),m+=T};if(C===jp){let{matchUps:N}=cf({finishingPositionLimit:m+T,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,matchUpType:l,drawSize:D,isMock:p,uuids:f}),k=iu({structureId:I.structureId??f?.pop(),matchUpFormat:e,stage:Tn,structureName:P,stageSequence:a,matchUps:N});g.push(k);let O=JN({playoffStructureId:k.structureId,finishingPositions:w,sourceStructureId:r});v.push(O),m+=T,A.push({structureId:k.structureId,finishingPositions:w})}else if([vT,yT,Tn].includes(C)){let N={playoffAttributes:I.playoffAttributes??i,playoffStructureNameBase:I.playoffStructureNameBase,structureId:I.structureId??f?.pop(),structureName:I.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:m,stage:Tn,roundOffset:0,stageSequence:a,drawSize:D,isMock:p,uuids:f};C===vT?Object.assign(N,{playoffAttributes:I?.playoffAttributes??i??Vq,roundOffsetLimit:3}):C===yT&&Object.assign(N,{playoffAttributes:I?.playoffAttributes??i??Gq,roundOffsetLimit:2});let k=ZU(N);if(k.error)return k;if(k.links?.length&&v.push(...k.links),k.structures?.length&&g.push(...k.structures),g.sort(Nw),k.structureId){let O=JN({playoffStructureId:k.structureId,finishingPositions:w,sourceStructureId:r});v.push(O),A.push({structureId:k.structureId,finishingPositions:w})}m+=T}else if([bT,G1,nP,rP,iP,aP].includes(C)){let N=[f?.pop(),f?.pop()],k={playoffStructureNameBase:I.playoffStructureNameBase,structureId:I.structureId??f?.pop(),playoffAttributes:I.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,uuids:N,stage:Tn,structureName:P,matchUpType:l,feedPolicy:c,drawSize:D,isMock:p},O={[bT]:{fmlc:!0,feedRounds:1},[aP]:{feedRounds:1},[nP]:{feedsFromFinal:3},[rP]:{feedsFromFinal:2},[iP]:{feedsFromFinal:1}};Object.assign(k,O[C]||{});let{structures:x,links:F}=Yb(k),[_]=x,V=JN({playoffStructureId:_.structureId,finishingPositions:w,sourceStructureId:r});v.push(V,...F),g.push(...x),A.push({structureId:_.structureId,finishingPositions:w}),m+=T}else if([gd].includes(C)){let{structures:N,links:k}=mR({...R,structureOptions:I.structureOptions||{groupSize:4}});M({playoffStructures:N,playoffLinks:k})}else if([V1].includes(C)){let{structures:N,links:k}=Hhe(R);M({playoffStructures:N,playoffLinks:k})}else if([EFe].includes(C)){let{structures:N,links:k}=Ghe(R);M({playoffStructures:N,playoffLinks:k})}else if([zl].includes(C)){let N=iu({structureId:I.structureId??f?.pop(),structureName:I.structureName,finishingPosition:Tk,stage:Tn,stageSequence:a,matchUps:[]});M({playoffStructures:[N],playoffLinks:[]})}}return{finishingPositionTargets:A,positionRangeMap:y,structures:g,links:v}}function JN({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:mh,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:Yu,roundNumber:1}}}function UHe(t){let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return le({result:{error:Kt},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:r,tournamentRecord:n,drawDefinition:a,playoffGroups:s,groupCount:o,groupSize:l,event:c}=t,u=Qhe({requireSequential:r,sourceStructureId:i,playoffGroups:s,groupCount:o,...t});if(u.error)return le({result:u,stack:e});let{structures:d=[],links:p=[],finishingPositionTargets:f,positionRangeMap:h}=u,m=f?.map(({finishingPositions:T})=>T).flat().map(T=>h[T].finishingPositions).flat();a.structures.push(...d),a.links.push(...p);let{matchUps:A,matchUpsMap:g}=ea({inContext:!0,drawDefinition:a}),v=d.map(({structureId:T})=>T),b=A?.filter(({structureId:T})=>v.includes(T)).map(xa),y=g?.drawMatchUps?.filter(({matchUpId:T})=>b?.includes(T));if(y?.length){let T=uo({drawDefinition:a,event:c})?.tieFormat;T&&y.forEach(D=>{let{tieMatchUps:C}=jw({isMock:t.isMock,tieFormat:T,matchUp:D});Object.assign(D,{tieMatchUps:C,matchUpType:Cc})})}let{positionAssignments:I}=Ir({structureId:i,drawDefinition:a}),w={};I?.forEach(T=>{let D=Bi({element:T,name:Om})?.extension?.value?.groupOrder;D&&(w[D]||(w[D]=[]),w[D].push(T.participantId))});let S=qC({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:n,drawDefinition:a});return S.error&&S.error?.code!==Jz.code?le({result:S,stack:e}):{structures:d,links:p,positionsPlayedOff:m,drawDefinition:a,...se}}function _U({value:t,sourceRange:e,targetRange:i}){if(!Array.isArray(e)||e.length!==2)return 0;let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),s=Math.max(...i);return(t-r)*(s-a)/(n-r)+a}var jhe="NTRP",zhe="DUPR",qhe="UTR_P",Whe="UTPR",Khe="SQUASH_LEVELS",Yhe="US_SQUASH",Xhe="USATT",Zhe="ITTF",Jhe="USAR",eme={ELO:"ELO",NTRP:jhe,TRN:"TRN",UTR:"UTR",WTN:"WTN",DUPR:zhe,UTR_P:qhe,UTPR:Whe,PSA:"PSA",SQUASH_LEVELS:Khe,US_SQUASH:Yhe,USATT:Xhe,ITTF:Zhe,USAR:Jhe,BWF:"BWF"},THe={ELO:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!1},[jhe]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!1,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!1,range:[1,16]},WTN:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!0,decimalsCount:2,range:[40,1]},[zhe]:{defaultInitialization:3.5,accessors:["duprRating","reliabilityScore"],accessor:"duprRating",attributes:{reliabilityScore:{generator:!0,range:[0,100]}},decimalsCount:3,ascending:!1,range:[2,8]},[qhe]:{defaultInitialization:5,accessors:["utrpRating","verified"],accessor:"utrpRating",attributes:{verified:{type:"boolean"},provisional:{type:"string"}},decimalsCount:1,ascending:!1,range:[1,10]},[Whe]:{defaultInitialization:3.5,accessor:"utprRating",decimalsCount:1,ascending:!1,range:[2,5],deprecated:!0},PSA:{defaultInitialization:500,accessor:"psaPoints",decimalsCount:0,ascending:!1,range:[0,3e3],attributes:{tournaments:{generator:!0,range:[1,20]},divisor:{generator:!0,range:[10,20]}}},[Khe]:{defaultInitialization:2e3,accessor:"squashLevel",decimalsCount:0,ascending:!1,range:[0,7e3]},[Yhe]:{defaultInitialization:3.5,accessor:"usSquashRating",decimalsCount:1,ascending:!1,range:[2,6]},[Xhe]:{defaultInitialization:1e3,accessor:"usattRating",decimalsCount:0,ascending:!1,range:[200,3e3]},[Zhe]:{defaultInitialization:500,accessor:"ittfPoints",decimalsCount:0,ascending:!1,range:[0,2e4]},[Jhe]:{defaultInitialization:1e4,accessor:"usarRanking",decimalsCount:0,ascending:!0,range:[1,25e3]},BWF:{defaultInitialization:5e3,accessor:"bwfPoints",decimalsCount:0,ascending:!0,range:[0,15e4],attributes:{tournaments:{generator:!0,range:[1,10]}}}},za=THe;function CHe({sourceRatingType:t,sourceRating:e}){let i=za[t]?.range,r=i?.[0]>i?.[1],n=za.ELO.range;return _U({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function EHe({targetRatingType:t,sourceRating:e}){let i=za[t]?.decimalsCount||0,r=za[t]?.range,n=r?.[0]>r?.[1],a=Math.max(...r),s=za.ELO?.range,o=_U({targetRange:r,sourceRange:s,value:e}),l=Number.parseFloat(o?.toFixed(i))||0;return n?a-l:l}function pee(t){let e=Gt(t,[{ratings:!0,[il]:pl}]);if(e.error)return e;let i=t.matchUpType&&[Er,yr].includes(t.matchUpType)?t.matchUpType:Er,r=Object.keys(za),n=t.targetRatingType&&r.includes(t.targetRatingType)?t.targetRatingType:"ELO",a=t.ratings[i]?t.ratings[i].reduce((p,f)=>p.includes(f.scaleName)?p:p.concat(f.scaleName),[]):[];if(!a)return{error:ts};let s=t.ratings[i]?.find(p=>p.scaleName===n)??t.ratings[i]?.[0];if(a[0]===n)return s;let o=s?.scaleName,l=za[s?.scaleName]?.accessor,c=l&&s.scaleValue[l]||s?.scaleValue,u=CHe({sourceRatingType:o,sourceRating:c}),d=EHe({targetRatingType:n,sourceRating:u});return d?{convertedRating:d,sourceRating:c}:{error:be}}function DHe({participantResults:t,sides:e,score:i}){let r=e?.find(({sideNumber:o})=>o===1),n=e?.find(({sideNumber:o})=>o===2),a=r?.participant?.ratings,s=n?.participant?.ratings;if(a?.[Er]&&s?.[Er]){let o="ELO",{convertedRating:l}=pee({ratings:a,targetRatingType:o}),{convertedRating:c}=pee({ratings:s,targetRatingType:o}),{side1pressure:u,side2pressure:d}=PHe({side1ConvertedRating:l,side2ConvertedRating:c,score:i});u&&t[r?.participantId].pressureScores.push(u),d&&t[n?.participantId].pressureScores.push(d);let p=Math.max(...za.ELO.range),f=Ux((c-l)/p),h=Ux((l-c)/p);t[r?.participantId].ratingVariation.push(f),t[n?.participantId].ratingVariation.push(h)}}function PHe({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){let r=Math.max(t,e),n=Math.min(t,e),a=Math.abs(t-e),s=za.ELO.range,o=Math.max(...s),l=(o-r)*0,c=(r+l)/o*a,u=i?.sets?.reduce((v,b)=>v+(b?.side1Score??0),0),d=i?.sets?.reduce((v,b)=>v+(b.side2Score??0),0),p=t>e?2:1,f=(u||0)*(n+(p===1?c:0)),h=(d||0)*(n+(p===2?c:0)),m=f+h,A=m?Ux(f/m):0,g=m?Ux(h/m):0;return{side1pressure:A,side2pressure:g}}function v5({winningSide:t,matchUpFormat:e=td,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],s=n?.sets,o=typeof t=="number"&&t-1,l=vs(e),c=y5(l?.bestOf??1);if(typeof o=="number"&&(i===Mr&&r?.setsCreditForDefaults||i===Xr&&r?.setsCreditForWalkovers))a[o]=c;else for(let u of s||[]){let{winningSide:d}=u;d&&(a[d-1]+=1)}return typeof o=="number"&&i===Fa&&(+a[1-o]===c&&(a[1-o]-=1),r?.setsCreditForRetirements&&(a[o]=c)),a}function tme({matchUpFormat:t=td,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){let{sets:a}=n||{};if(!a)return[0,0];let s=typeof e=="number"&&e-1,o=vs(t),l=o?.bestOf??1,c=y5(l),u=o?.setFormat?.tiebreakAt||0,d=[[],[]];if(typeof s=="number"&&(i===Mr&&r?.gamesCreditForDefaults||i===Xr&&r?.gamesCreditForWalkovers)){let p=o?.setFormat?.setTo||0,f=c*p;d[s].push(f)}else a.forEach((p,f)=>{let h=(p.setNumber||f+1)>c&&o?.finalSetFormat?"finalSetFormat":"setFormat",m=o?.[h]?.based,A=o?.[h].tiebreakSet,{side1Score:g,side2Score:v}=p;fee(m)&&!A&&(d[0].push(ri(g||0)),d[1].push(ri(v||0))),A&&p.winningSide&&r?.gamesCreditForTiebreakSets!==!1&&d[p.winningSide-1].push(1)});if(i===Fa&&typeof s=="number"){let p=a.length>c&&o?.finalSetFormat?"finalSetFormat":"setFormat",f=o?.[p];if(fee(f.based)){let h=f?.setTo||0,m=g=>{if(!(!o||g===""))return+g===u-1||+g===u?ri(u||0)+1:+g<u?h:u},A=v5({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(d.map(g=>g[s]<=g[1-s]).reduce((g,v)=>g+(v?1:0),0)>A[1-s]){let g=d[s].length,v=m(d[1-s][g-1]);v&&(d[s][g-1]=v)}c>d[s].length&&r?.gamesCreditForRetirements&&d[s].push(h)}}return[d[0].reduce((p,f)=>p+f,0),d[1].reduce((p,f)=>p+f,0)]}function ime({matchUpFormat:t,score:e}){let i=t?vs(t):void 0,r=i?.bestOf??1,n=y5(r),a=[0,0],s=[0,0];return e?.sets?.forEach((o,l)=>{let c=(o.setNumber||l+1)>n&&i?.finalSetFormat?"finalSetFormat":"setFormat",u=i?.[c]?.based;if(rme(u)){let{side1Score:d,side2Score:p}=o;d&&(s[0]+=ri(d||0)),p&&(s[1]+=ri(p||0))}else o.side1TiebreakScore&&(s[0]+=ri(o.side1TiebreakScore||0)),o.side2TiebreakScore&&(s[1]+=ri(o.side2TiebreakScore||0)),(o.side1TiebreakScore||o.side2TiebreakScore)&&o.winningSide&&(a[o.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:a}}function y5(t){return t&&Math.ceil(t/2)||1}function rme(t){return t==="P"}function fee(t){return!rme(t)}function RHe({participantResults:t,groupingTotal:e,matchUpFormat:i,tallyPolicy:r,totalGames:n,perPlayer:a,totalSets:s}){let o=i&&vs(i)||{},l=o.bestOf,c=l&&Math.ceil(l/2)||1,u=o.setFormat?.setTo,d=Math.pow(10,r?.precision||3);Object.keys(t).forEach(p=>{let f=t[p].setsWon,h=t[p].setsLost,m=r?.groupTotalSetsPlayed||e==="setsPct"?s:a*c||f+h,A=Math.round(f/m*d)/d;(A===1/0||Number.isNaN(A))&&(A=m);let g=t[p].tieMatchUpsWon,v=t[p].tieMatchUpsLost,b=g+v,y=Math.round(g/b*d)/d;(y===1/0||Number.isNaN(y))&&(y=g);let I=t[p].matchUpsWon,w=t[p].matchUpsLost,S=I+w,T=Math.round(I/S*d)/d;(T===1/0||Number.isNaN(T))&&(T=I);let D=t[p].gamesWon||0,C=t[p].gamesLost||0,E=(a||0)*c*(u||0),P=r?.groupTotalGamesPlayed||e==="gamesPct"?n:Math.max(E,D+C),R=Math.round(D/P*d)/d;(R===1/0||Number.isNaN(R))&&(R=0);let M=t[p].pointsWon+t[p].pointsLost,N=Math.round(t[p].pointsWon/M*d)/d;(N===1/0||Number.isNaN(N))&&(N=0),t[p].setsWon=f,t[p].setsLost=h,t[p].setsPct=A,t[p].tieMatchUpsWon=g,t[p].tieMatchUpsPct=y,t[p].matchUpsPct=T,t[p].gamesWon=D,t[p].gamesLost=C,t[p].gamesPct=R,t[p].pointsPct=N,t[p].result=`${t[p].matchUpsWon}/${t[p].matchUpsLost}`})}function wR({participantIds:t,pressureRating:e,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,perPlayer:a,matchUps:s}){let o={},l=n?.excludeMatchUpStatuses||[],c=s?.filter(f=>(f.tieMatchUps||!l.includes(f.matchUpStatus))&&(!t?.length||Pn(t,[OU(f,0),OU(f,1)]).length===2)),u=c?.flatMap(({score:f,tieMatchUps:h})=>h?h.filter(({matchUpStatus:m})=>!l.includes(m)).flatMap(({score:m})=>m?.sets?.length??0):f?.sets?.length??0)?.reduce((f,h)=>f+h,0),d=f=>f?.sets?.reduce((h,m)=>h+(m?.side1Score??0)+(m?.side2Score??0),0)??0,p=c?.flatMap(({score:f,tieMatchUps:h})=>h?h.filter(({matchUpStatus:m})=>!l.includes(m)).flatMap(({score:m})=>d(m)):d(f))?.reduce((f,h)=>f+h,0);for(let f of c??[]){let{matchUpStatus:h,tieMatchUps:m,tieFormat:A,score:g,winningSide:v,sides:b}=f,y=A&&f._disableAutoCalc&&A.collectionDefinitions.every(({scoreValue:S})=>S),I=v&&MHe(f),w=v&&NHe(f);if(!I&&!w)if(h&&qn.includes(h)){let S=OU(f,0),T=OU(f,1);S&&(KA(o,S),o[S].matchUpsCancelled+=1),T&&(KA(o,T),o[T].matchUpsCancelled+=1)}else if(m?.length){a=0;for(let S of m){if(S.winningSide){let T=b?.find(({sideNumber:C})=>C===S.winningSide)?.participantId,D=b?.find(({sideNumber:C})=>C===S.winningSide)?.participantId;T&&D&&(KA(o,T),KA(o,D),o[T].tieMatchUpsWon+=1,o[D].tieMatchUpsLost+=1,$n(Er)(S.matchUpType)?(o[T].tieSinglesWon+=1,o[D].tieSinglesLost+=1):$n(yr)(S.matchUpType)&&(o[T].tieDoublesWon+=1,o[D].tieDoublesLost+=1))}hee({score:S.score,manualGamesOverride:y,participantResults:o,sides:b})}}else hee({manualGamesOverride:y,participantResults:o,score:g,sides:b});else if(KA(o,I),KA(o,w),m?.length){a=0;for(let S of m){let{matchUpType:T}=S,D=$n(yr)(T),C=$n(Er)(T);S.winningSide&&(S.winningSide===v?(I&&(o[I].tieMatchUpsWon+=1,C&&(o[I].tieSinglesWon+=1),D&&(o[I].tieDoublesWon+=1)),w&&(o[w].tieMatchUpsLost+=1,C&&(o[w].tieSinglesLost+=1),D&&(o[w].tieDoublesLost+=1))):S.winningSide!==v&&(w&&(o[w].tieMatchUpsWon+=1,C&&(o[w].tieSinglesWon+=1),D&&(o[w].tieDoublesWon+=1)),I&&(o[I].tieMatchUpsLost+=1,C&&(o[I].tieSinglesLost+=1),D&&(o[I].tieDoublesLost+=1)))),mee({matchUpFormat:S.matchUpFormat,matchUpStatus:S.matchUpStatus,matchUpType:S.matchUpType,score:S.score,sides:S.sides,winningParticipantId:I,losingParticipantId:w,manualGamesOverride:y,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:n,winningSide:v})}nme({winningParticipantId:I,losingParticipantId:w,participantResults:o,matchUpStatus:h})}else mee({matchUpFormat:f.matchUpFormat??r,matchUpType:f.matchUpType,isTieMatchUp:void 0,winningParticipantId:I,manualGamesOverride:y,losingParticipantId:w,participantResults:o,pressureRating:e,matchUpStatus:h,tallyPolicy:n,winningSide:v,score:g,sides:b});if(y){let S=g?.sets?.reduce((E,P)=>E+(P?.side1Score??0),0),T=g?.sets?.reduce((E,P)=>E+(P.side2Score??0),0),D=b?.find(({sideNumber:E})=>E===1)?.participantId,C=b?.find(({sideNumber:E})=>E===2)?.participantId;KA(o,D),KA(o,C),D&&(o[D].gamesWon+=S,o[D].gamesLost+=T),C&&(o[C].gamesWon+=T,o[C].gamesLost+=S)}}return RHe({participantResults:o,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,totalGames:p,perPlayer:a,totalSets:u}),{participantResults:o}}function MHe(t){let e=t.winningSide-1;return OU(t,e)}function NHe(t){let e=1-(t.winningSide-1);return OU(t,e)}function OU(t,e){if(!t?.sides)return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function KA(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function hee({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],s=[0,0];for(let l of n||[]){let{winningSide:c,side1Score:u,side2Score:d}=l;c&&(s[c-1]+=1),a[0].push(ri(u||0)),a[1].push(ri(d||0))}let o=[a[0].reduce((l,c)=>l+c,0),a[1].reduce((l,c)=>l+c,0)];r.forEach((l,c)=>{let{participantId:u}=l;u&&(KA(e,u),e[u].setsWon+=s[c],e[u].setsLost+=s[1-c],t||(e[u].gamesWon+=o[c],e[u].gamesLost+=o[1-c]))})}function mee({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:s,isTieMatchUp:o,matchUpType:l,tallyPolicy:c,winningSide:u,score:d,sides:p}){let f=u&&u-1,h=1-f;n&&l===Er&&DHe({participantResults:r,sides:p,score:d}),o||nme({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:s});let m=v5({matchUpStatus:s,matchUpFormat:a,tallyPolicy:c,winningSide:u,score:d}),A=tme({matchUpStatus:s,matchUpFormat:a,tallyPolicy:c,winningSide:u,score:d}),{pointsTally:g}=ime({score:d,matchUpFormat:a});t&&(r[t].setsWon+=m[f],r[t].setsLost+=m[h],e||(r[t].gamesWon+=A[f],r[t].gamesLost+=A[h]),r[t].pointsWon+=g[f],r[t].pointsLost+=g[h]),i&&(r[i].setsWon+=m[h],r[i].setsLost+=m[f],e||(r[i].gamesWon+=A[h],r[i].gamesLost+=A[f]),r[i].pointsWon+=g[h],r[i].pointsLost+=g[f])}function nme({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===Xr&&(i[e].walkovers+=1),r===Mr&&(i[e].defaults+=1),r===Fa&&(i[e].retirements+=1),Ms(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function BHe(t,e,i,r){t.groups&&Object.keys(t.groups).sort(r).forEach(n=>{let a=t.groups[n].map(o=>e[o]).join(", "),s=`${n} ${t.attribute}: ${a}`;i.push(s)})}function kHe(t,e,i,r){if(t.excludedDirectives?.length){let n=t.excludedDirectives.map(({attribute:o})=>o).join(", "),a=`${n.length} directives were excluded due to participants limit}`;r.push(a);let s=`Excluded: ${n}`;r.push(s)}else{let n=(c,u)=>Number.parseFloat(t.reversed?c:u)-Number.parseFloat(t.reversed?u:c),a=t.groups?Object.values(t.groups).flat(1/0).length:t.participantIds?.length??0,s=t.reversed?" in reverse order":"",o=t.groups?"grouped":"separated",l=`Step ${e+1}: ${a} particiants were ${o}${s} by ${t.attribute}`;if(r.push(l),t.idsFilter){let c=`${t.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(c)}BHe(t,i,r,n)}r.push("----------------------")}function xHe({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(s=>{s.participantId&&s.participant&&(r[s.participantId]=s.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,s)=>{kHe(a,s,r,n)}),n.push("Final Order:"),e.forEach(a=>{let{participantId:s,resolved:o}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[s]} => resolved: ${!!o}`)}),n.join(`\r
`)}function ame({participantResults:t,participantIds:e,attribute:i}){return sme({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:s}=n,o=s?.[i];return!isNaN(o)&&a&&(r[o]?r[o].push(a):r[o]=[a]),r},{})}function sme(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var _He=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],IV={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function Aee(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!OHe(t))return{};let s=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n?.groupOrderKey)?n.groupOrderKey:"matchUpsWon",o=ame({participantResults:i,attribute:s});a.push({attribute:s,groups:o});let l=Object.keys(o).map(A=>Number.parseFloat(A)).sort((A,g)=>g-A).map(A=>o[A]).map(A=>{let g=ome({participantIds:A,...t});return a.push(...g.report??[]),g.order}).flatMap((A,g)=>A.map(v=>v.resolved?v:{...v,subGroup:[g].concat(...v.subGroup??[])})),c,u=0,d=1,p;l.forEach((A,g)=>{g&&(A.resolved||p&&!A.resolved)&&(d+=1),p=A.resolved;let v=Number.parseInt(A.subGroup?.join("")||0);A.resolved?(A.position=g+1,d=A.position):(c&&v>c&&(d+=u,u=0),A.position=d,u+=1),c=v});let f=l.map(({position:A})=>A),h=Vl(f);return l.forEach(A=>{let{participantId:g,position:v}=A||{},b=i[g];A.GEMscore=m(b);let y=h[v];A?.position!==void 0&&(y>1&&(A.ties=y,r&&(A.subOrder=r[g])),A.rankOrder=v,A.groupOrder=v+(A.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function m(A){return(Array.isArray(n?.GEMscore)?Object.keys(IV).filter(g=>n.GEMscore.includes(g)):Object.keys(IV)).map(g=>(A[g]||0)*Math.pow(10,IV[g].toFixed(3))).reduce((g,v)=>g+v,0)}}function OHe({participantResults:t,participantsCount:e}){let i=sme({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function FHe({disableHeadToHead:t,participantIds:e,matchUpFormat:i,groupTotals:r,tallyPolicy:n,attribute:a,idsFilter:s,matchUps:o,reversed:l}){let{participantResults:c}=wR({participantIds:s&&e,groupingTotal:r&&a,matchUpFormat:i,tallyPolicy:n,matchUps:o}),u=ame({participantResults:c,participantIds:e,attribute:a}),d=[{attribute:a,reversed:l,groups:u,idsFilter:s,groupTotals:r}],p;return Object.keys(u).length>1&&e.length&&(p=Object.keys(u).map(f=>Number.parseFloat(f)).sort((f,h)=>l?f-h:h-f).map(f=>u[f]).map(f=>{let h=ome({participantResults:c,disableHeadToHead:t,participantIds:f,matchUpFormat:i,tallyPolicy:n,matchUps:o});return d.push(...h.report??[]),h.order}).flatMap((f,h)=>f.map(m=>m.resolved?m:{...m,subGroup:[h].concat(...m.subGroup??[])}))),{order:p,report:d}}function ome({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let s=[],o=[],l;if(i?.length===1)return{order:[{resolved:!0,participantId:i[0]}]};if(i?.length===2&&(!n?.headToHead||!n.headToHead.disabled&&!e)){let u=LHe({participantIds:i,participantResults:t});if(u){let d=u[0].participantId;return o.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:u,headToHeadWinner:d,report:o}}}let c=(n?.tallyDirectives||_He).filter(u=>{let d=!(Sn(u.maxParticipants)&&i?.length>u.maxParticipants);return d||s.push(u),d});return s.length&&o.push({excludedDirectives:s,participantIds:i}),c.every(({attribute:u,reversed:d,idsFilter:p,groupTotals:f,disableHeadToHead:h})=>(l=FHe({disableHeadToHead:h,participantIds:i,matchUpFormat:r,groupTotals:f,tallyPolicy:n,attribute:u,idsFilter:p,matchUps:a,reversed:d}),o.push(l.report),!l.order)),l.order?{order:l.order,report:o}:{order:i?.map(u=>({participantId:u})),report:o}}function LHe({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function KC({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:s}){if(!n?.length||!wu(n))return{error:sA};let o=Ci(n.map(({structureId:y})=>y));if(o.length!==1)return le({result:{error:be,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let l=n.filter(y=>y&&y.matchUpStatus!=="BYE"),c=l.length&&Ci(l.flatMap(({drawPositions:y})=>y)).length,u=l.filter(y=>ty({matchUp:y})).length===l.length;u||(s=0);let d=n.every(({matchUpType:y,tieMatchUps:I})=>y===$r&&I?.every(w=>ty({matchUp:w}))),p=t?.[Jq],f=n.filter(y=>ty({matchUp:y})??y.matchUpType===$r),{participantResults:h}=wR({matchUps:f,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:s}),m,A,{groupOrder:g,report:v}=Aee({matchUps:f,participantResults:h,participantsCount:c,matchUpFormat:r,subOrderMap:a,tallyPolicy:p});if(i&&$He({participantResults:h}),u&&g)m=v,A=g,g.forEach(y=>{let{participantId:I,groupOrder:w,rankOrder:S,subOrder:T,ties:D,GEMscore:C}=y,E=h[I];Object.assign(E,{groupOrder:w,rankOrder:S,GEMscore:C,subOrder:T,ties:D})});else{let{groupOrder:y,report:I}=Aee({requireCompletion:!1,participantResults:h,participantsCount:c,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});m=I,A=y,y&&y.forEach(w=>{let{participantId:S,groupOrder:T,GEMscore:D}=w,C=h[S];Object.assign(C,{provisionalOrder:T,GEMscore:D})})}let b={completedTieMatchUps:d,readableReport:"",participantResults:h,bracketComplete:u,order:[],report:m};if((u||d)&&(b.order=A),e||Gl({tally:!0})){let y=xHe({matchUps:n,report:m,order:A});Gl({tally:!0})&&console.log(y),b.readableReport=y}return b}function $He({participantResults:t}){let e=n=>n.reduce((a,s)=>a+parseFloat(s),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:s}=a,o=s?.length?i(s):0;return{participantId:n,averagePressure:o}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function lme({positionAssignments:t}){let e=(t||[]).filter(Kl(yh)).map(n=>{let{extension:a}=Bi({element:n,name:ST}),s=ri(a?.value),o=!isNaN(s)&&s;return o&&{participantId:n.participantId,subOrder:o}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=Vl(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function b5({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!wu(n))return{error:be};if(!t)return{error:be};let{policyDefinitions:s}=uA({policyTypes:[Jq],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:o}=lme({positionAssignments:t}),l=n.length?KC({policyDefinitions:s,matchUpFormat:r,subOrderMap:o,matchUps:n}):void 0;if(l?.error)return l;let{participantResults:c={},bracketComplete:u,report:d}=l??{},p=Object.keys(c);return t.forEach(f=>{let{participantId:h}=f;if(p.includes(h)){let m={value:c[h],name:Om};lr({element:f,extension:m}),c[h].ties||Eo({element:f,name:ST})}else Eo({element:f,name:Om}),Eo({element:f,name:ST})}),Br({drawDefinition:i}),{...se,participantResults:c,bracketComplete:u,report:d}}function cme({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function Wr(t){let e=Gt(t,[{[to]:!0,[Cf]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:s,matchUpId:o,inContext:l,context:c,event:u}=t,{structures:d=[]}=yd({drawDefinition:a}),p=t.contextContent||n&&dA({contextProfile:n,drawDefinition:a});for(let f of d){let{matchUps:h}=cr({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:s,inContext:l,structure:f,context:c,event:u}),{matchUp:m}=cme({matchUps:h,matchUpId:o});if(m)return{matchUp:m,structure:f}}return{error:Ys}}function tL(t){return!Ki(t)||!t.notes?{error:Kt}:Ki(t.element)?!Lr(t.notes)&&!t.notes?.testing?{error:be}:(Object.assign(t.element,{notes:t.notes}),{...se}):{error:be}}function I5(t){return Ki(t)?Ki(t.element)?(t.element.notes&&delete t.element.notes,{...se}):{error:be}:{error:Kt}}var iL={matchUpStatus:Rn,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function qp(t){let e="modifyMatchUpScore",i=t.matchUpFormat,r=t.matchUp,n,{matchUpStatusCodes:a,tournamentRecord:s,drawDefinition:o,matchUpStatus:l,removeScore:c,winningSide:u,matchUpId:d,event:p,notes:f,score:h}=t,m=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:er({policyTypes:[du],tournamentRecord:s,drawDefinition:o,structure:n,event:p})?.appliedPolicies,A=r.matchUpType===$r;if(A&&o){if(d&&r.matchUpId!==d){let S=Wr({drawDefinition:o,matchUpId:d,event:p});if(!S.matchUp)return{error:Ys};({matchUp:r,structure:n}=S)}}else r.matchUpId!==d&&console.log("!!!!!");l&&[Xr,mn].includes(l)||c?Object.assign(r,{...iL}):h&&(r.score=h);let g=l&&r?.matchUpStatus===Mr&&l!==Mr;l&&(r.matchUpStatus=l),i&&(r.matchUpFormat=i),a&&(r.matchUpStatusCodes=a),u&&(r.winningSide=u),t.removeWinningSide&&(r.winningSide=void 0),!n&&o&&({structure:n}=Wr({drawDefinition:o,matchUpId:d,event:p})),l&&!r.winningSide&&ya(r)&&!qn.includes(l)&&![Mw,jg,Wl].includes(l)&&(r.matchUpStatus=Dd);let v;if((g&&r?.processCodes?.length||l===Mr)&&(v=m?.[du]?.processCodes?.incompleteAssignmentsOnDefault),!r.collectionId){let S=n?.structureType===Ao,T=Yo({structure:n});if(kW({drawDefinition:o,structure:n})||T||S){let D=P=>{i=A?"SET1-S:T100":i??r.matchUpFormat??P?.matchUpFormat??o?.matchUpFormat??p?.matchUpFormat;let R=A?{matchUpTypes:[$r]}:void 0,{matchUps:M}=cr({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:R,drawDefinition:o,structure:P,event:p});return T&&(P.positionAssignments=Ci(M.flatMap(N=>(N.sides??[]).map(k=>k.participantId)).filter(Boolean)).map(N=>({participantId:N}))),b5({positionAssignments:P.positionAssignments,tournamentRecord:s,drawDefinition:o,matchUpFormat:i,matchUps:M,event:p})},C=S&&n.structures.find(P=>P?.matchUps.find(R=>R.matchUpId===d)),E=D(C||n);if(E.error)return le({result:E,stack:e})}}if(f){let S=tL({element:r,notes:f});if(S.error)return le({result:S,stack:e})}let b=s?.tournamentId,y=kc().topics.includes(BF),I=(y||v)&&ss({drawDefinition:o}),w=I&&ea({matchUpFilters:{matchUpIds:[d]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:o,matchUpsMap:I}).matchUps?.[0];if(y&&w&&lLe({tournamentId:b,inContextMatchUp:w}),Array.isArray(v)&&w&&!w.sides?.every(({participantId:S})=>S))if(l===Mr)r.processCodes=Ci([...r.processCodes??[],...v]);else for(let S of v||[]){let T=S&&r?.processCodes?.lastIndexOf(S);r?.processCodes?.splice(T,1)}return Yi({eventId:p?.eventId,context:e,drawDefinition:o,tournamentId:b,matchUp:r}),{...se}}function w5(t){let{propagateExitStatus:e,matchUpStatusCodes:i,autoCalcDisabled:r,inContextMatchUp:n,matchUpStatus:a,dualMatchUp:s,structure:o,matchUp:l}=t,c=uR({matchUpStatus:a})||[Df,ql].includes(a)&&s||r,u=l?.sides?.map(m=>m.participantId).filter(Boolean).length||n?.sides?.map(m=>m.participantId).filter(Boolean).length,d="attemptToModifyScore";if(!(Yo({structure:o})&&u===1||a===Mr&&u||HHe({structure:o,matchUp:l,inContextMatchUp:n})||t.appliedPolicies?.[du]?.requireParticipantsForScoring===!1||Ms(a)&&u===1&&e))return le({result:{error:sq},stack:d});let p=[Xr].includes(a),f=c?a:t.winningSide&&Ln||Wl,h=qp({...t,winningSide:t.winningSide,matchUpStatusCodes:c&&i||[],matchUpStatus:f,removeScore:p});return le({result:h,stack:d})}function HHe({structure:t,matchUp:e,inContextMatchUp:i}){let{drawPositions:r}=e,{positionAssignments:n}=va({structure:t}),a=n?.filter(o=>r?.includes(o.drawPosition)&&o.participantId),s=i?.sides?.every(o=>o.participantId);return a?.length===2||s}function ume({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>yi(r?.groupValue)&&r?.groupNumber).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>ri(r));return{groupValueGroups:e,groupValueNumbers:i}}function VHe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(v=>v.collectionId===t.collectionId),s=[0,0],o=[0,0],l=a.every(v=>qn.includes(v.matchUpStatus)),{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,matchUpValue:p,winCriteria:f,scoreValue:h,setValue:m}=t,A=u&&e.includes(u),g=[0,0];if(a.forEach(v=>{v.winningSide&&(g[v.winningSide-1]+=1)}),yi(p)?a.forEach(v=>{v.winningSide&&(s[v.winningSide-1]+=p)}):yi(m)?a.forEach(v=>{v.score?.sets?.forEach(b=>{b.winningSide&&(s[b.winningSide-1]+=m)})}):yi(h)?a.forEach(v=>{v.score?.sets?.forEach(b=>{let{side1TiebreakScore:y=0,side2TiebreakScore:I=0,side1Score:w=0,side2Score:S=0}=b;(v.matchUpStatus===Ln||v.winningSide||b.winningSide)&&(w||S?(s[0]+=w,s[1]+=S):(y||I)&&b.winningSide&&(s[b.winningSide-1]+=1))})}):Array.isArray(c)&&a.forEach(v=>{if(v.winningSide){let b=v.collectionPosition,y=GHe({collectionDefinition:t,collectionPosition:b});yi(y)&&(s[v.winningSide-1]+=y)}}),yi(d)){let v;if(f?.aggregateValue)l&&(yi(p||m||h)&&s[0]!==s[1]?v=s[0]>s[1]?1:2:g[0]!==g[1]&&(v=g[0]>g[1]?1:2));else if(f?.valueGoal)v=s.reduce((b,y,I)=>y>=f.valueGoal?I+1:b,0);else{let b=Math.floor(t.matchUpCount/2)+1;v=g.reduce((y,I,w)=>I>=b?w+1:y,0)}v&&(A?i[u].values[v-1]+=d:o[v-1]+=d)}else A?(i[u].values[0]+=s[0]||0,i[u].values[1]+=s[1]||0):o=s;A?(i[u].sideWins[0]+=g[0]||0,i[u].sideWins[1]+=g[1]||0,i[u].allGroupMatchUpsCompleted=i[u].allGroupMatchUpsCompleted&&l,i[u].matchUpsCount+=a.length):o.forEach((v,b)=>r[b]+=v||0)}function GHe({collectionDefinition:t,collectionPosition:e}){return(t.collectionValueProfiles||[])?.find(i=>i.collectionPosition===e)?.matchUpValue}function SR(t){let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:r,matchUpsMap:n,structure:a,matchUp:s,event:o}=t;if(!Array.isArray(e)||e.length!==2||Number.isNaN(e.reduce((y,I)=>y+I)))return{error:be};if(!s)return{error:Wo};let l=uo({matchUp:s,drawDefinition:r,structure:a,event:o})?.tieFormat||t?.tieFormat;if(!l)return{error:PC};let c=Ko({tieFormat:l});if(c.error)return c;let u=l?.collectionDefinitions||[],d=s?.tieMatchUps??[],p=[0,0],{groupValueGroups:f,groupValueNumbers:h}=ume(l);for(let y of u)VHe({collectionDefinition:y,groupValueNumbers:h,groupValueGroups:f,sideTieValues:p,tieMatchUps:d});for(let y of h){let I=f[y],{allGroupMatchUpsCompleted:w,matchUpCount:S,winCriteria:T,groupValue:D,sideWins:C,values:E}=I,P;if(T?.aggregateValue)w&&E[0]!==E[1]&&(P=E[0]>E[1]?1:2);else if(T?.valueGoal)P=E.reduce((R,M,N)=>M>=T.valueGoal?N+1:R,void 0);else{let R=Math.floor(S/2)+1;P=C.reduce((M,N,k)=>N>=R?k+1:M,void 0)}P&&(p[P-1]+=D||0)}let m=p.map((y,I)=>(y||0)+e[I]),A={side1Score:m[0],side2Score:m[1],winningSide:void 0},g=m.join(i),v=m.slice().reverse().join(i),b;if(l?.winCriteria){let{valueGoal:y,aggregateValue:I,tallyDirectives:w}=l.winCriteria;if(y?b=m.map((S,T)=>({sideNumber:T+1,points:S})).find(({points:S})=>S>=y)?.sideNumber:I&&d.every(S=>S.matchUpStatus&&qn.includes(S.matchUpStatus)||S.winningSide)&&m[0]!==m[1]&&(b=m[0]>m[1]?1:2),!b&&w){let S=s.matchUpId,T=s.hasContext?s:n?.drawMatchUps?.[S]||r&&Wr({inContext:!0,drawDefinition:r,matchUpId:S})?.matchUp;if(T){let{completedTieMatchUps:D,order:C}=KC({matchUps:[T]});if(D&&C?.length){let E=C[0].participantId;b=T.sides.find(({participantId:P})=>P===E)?.sideNumber}}}}return b&&(A.winningSide=b),{scoreStringSide1:g,scoreStringSide2:v,winningSide:b,set:A}}function UR({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){if(r){t||(t=Wr({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e})?.matchUp);let{extension:a}=Bi({element:e,name:xm}),s=St(a?.value||{},!1,!0),o=({displaySideNumber:l,drawPosition:c,sideNumber:u})=>({drawPosition:c,sideNumber:u,displaySideNumber:l});r.sides=t?.sides?.map(l=>{let c=l.participantId,u=c&&s[c]||void 0,{lineUp:d,...p}=r.sides?.find(({sideNumber:h})=>h===l.sideNumber)??{},f=d?.length?d:u;return{...o(l),...p,lineUp:f}}),Yi({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function Ss(t){if(t)return St(t,!1,!0)}function S5(t){let e=Gt(t,[{[Xs]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:o})=>o),s=n.map(o=>(o.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...s),i.eventIds.push(...a),i.drawIds.push(...s),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function dme({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=S5({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&r?.[n].includes(e)||i&&r?.[n].includes(i))}function pA(t){let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:r,removeScore:n,matchUpsMap:a,matchUpId:s,event:o}=t,l=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord?.tournamentId]:t.tournamentRecord}||{},c=t.tournamentId||t.tournamentRecord?.tournamentId;l&&dme({tournamentRecords:l,...t});let u=c&&l[c];if(!u)return{error:rt};let d=Wr({drawDefinition:i,event:o,matchUpId:s});if(d.error)return d;if(!d.matchUp)return{error:Ys};let{matchUp:p,structure:f}=d;if(!p.tieMatchUps)return{error:bl};UR({tournamentId:u?.tournamentId,eventId:o?.eventId,dualMatchUp:p,drawDefinition:i});let{extension:h}=Bi({name:GI,element:p});if(h?.value)if(n)Eo({element:p,name:GI});else return{...se,score:p.score};let m=uo({drawDefinition:i,structure:f,matchUp:p,event:o})?.tieFormat;p.tieFormat=Ss(m);let A=SR({drawDefinition:i,matchUpsMap:a,structure:f,matchUp:p,event:o}),{winningSide:g,set:v,scoreStringSide1:b,scoreStringSide2:y}=A,I=v?.side1Score||v?.side2Score;if(e&&!p.score&&!I)return{...se};let w={scoreStringSide1:b,scoreStringSide2:y,sets:v?[v]:[]},S=g&&[1,2].includes(g),T=S&&Ln||HW({matchUpStatus:r??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:w})&&Dd||Rn,D=!!(p.winningSide&&!S),C=p.tieMatchUps.find(({score:P,winningSide:R,matchUpStatus:M})=>P?.sets?.length&&(P.sets[0].side1Score||P.sets[0].side2Score)||M&&qn.includes(M)||R),E;if(p.tieFormat&&!S&&!C){let P=uo({drawDefinition:i,structure:f,event:o})?.tieFormat;P&&JSON.stringify(m)===JSON.stringify(P)&&(p.tieFormatId=void 0,p.tieFormat=void 0,E=!0)}return qp({appliedPolicies:t.appliedPolicies,matchUpStatus:T,score:w,removeWinningSide:D,tournamentRecord:u,drawDefinition:i,removeScore:n,winningSide:g,matchUpId:s,matchUp:p,event:o}),{...se,score:w,removeWinningSide:D,tieFormatRemoved:E,winningSide:g}}function QHe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:s,sourceMatchUpId:o,drawDefinition:l,winnerMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}){let f="directWinner";if(s){let h=c.drawPositions||[],m=h[t],A=s.source.structureId,g=ui({structureId:A,drawDefinition:l});if(g.error)return g;let{structure:v}=g,{positionAssignments:b}=va({structureId:A,drawDefinition:l}),y=b?.find(C=>C.drawPosition===n)?.participantId,I=s.target.structureId,{positionAssignments:w}=va({structureId:I,drawDefinition:l}),S=w?.find(C=>C.participantId===y)?.drawPosition,T=w?.filter(C=>{let E=h.includes(C.drawPosition),P=!C.participantId&&!C.bye&&!C.qualifier;return E&&P}).map(C=>C.drawPosition),D=T?.includes(m);if(y&&s.target.roundNumber===1&&D)lf({drawPosition:m,participantId:y,structureId:I,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(y&&T?.length){let C=T.pop();C&&lf({participantId:y,structureId:I,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:C,matchUpsMap:d,event:p})}else if(S){let C=vI({drawPosition:S,matchUpId:c.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(C.error)return le({result:C,stack:f})}else if(v?.stage!==zt){let C="winner target position unavaiallble";console.log(C),le({stack:f,result:{error:C}})}if(v?.seedAssignments&&v.structureId!==I){let C=v.seedAssignments.find(({participantId:P})=>P===y),E=C?.participantId;C&&E&&zC({eventId:c?.eventId,structureId:I,...C,tournamentRecord:a,drawDefinition:l,participantId:E})}}else{let h=vI({matchUpId:c.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(h.error)return h}if(u&&i){let h=u.sides?.find(m=>m.sideNumber===i);if(h?.lineUp){let m=u.roundPosition,A=c.roundPosition,g=m===A&&m!==1||Math.floor(m/2)===A?2:1,v=d?.drawMatchUps?.find(({matchUpId:I})=>I===c.matchUpId),b=[1,2].map(I=>({...v.sides?.find(w=>w.sideNumber===I)||{},sideNumber:I}));v.sides=b;let y=v.sides.find(I=>I.sideNumber===g);if(y){let I=h.lineUp?.filter(w=>w?.participantId);y.lineUp=r5({lineUp:I}),Yi({tournamentId:a?.tournamentId,eventId:c?.eventId,matchUp:v,context:f,drawDefinition:l})}}}return{...se}}function jHe(t){let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:r,propagateExitStatus:n,sourceMatchUpStatus:a,loserDrawPosition:s,tournamentRecord:o,loserTargetLink:l,drawDefinition:c,loserMatchUp:u,dualMatchUp:d,matchUpsMap:p,event:f}=t,h="directLoser",m=l.linkCondition,A=u.drawPositions||[],g=m===sf&&u.roundNumber===2&&Math.min(...A.filter(Boolean)),v=g||A[e],b=g||A[1-e],y=l.source.structureId,{structure:I}=ui({structureId:y,drawDefinition:c}),{matchUps:w}=cr({afterRecoveryTimes:!1,inContext:!0,drawDefinition:c,structure:I,event:f}),S=w.filter(Q=>Q.drawPositions?.includes(s)).filter(Q=>{let j=Q.sides.find(Y=>Y.drawPosition===s),W=Q.matchUpStatus===Xr||Q.matchUpStatus===Mr&&!ya(Q);return j?.sideNumber===Q.winningSide&&!W}),T=m===sf&&S.length===0,{positionAssignments:D}=va({structureId:y,drawDefinition:c}),C=D?.find(Q=>Q.drawPosition===s)?.participantId,E={loserParticipantId:C},P=l.target.structureId,{positionAssignments:R}=va({structureId:P,drawDefinition:c}),M=R?.filter(({drawPosition:Q})=>A.includes(Q)),N=M?.some(Q=>Q.participantId&&C&&Q.participantId===C),k=n&&[Fa,Xr,Mr].includes(a||"");if(N)return{...se,stack:h};let O=M?.filter(Q=>{let j=A.includes(Q.drawPosition),W=!Q.participantId&&!Q.bye&&!Q.qualifier;return j&&W}).map(Q=>Q.drawPosition),x=O?.includes(v),F=l.target.roundNumber>1&&O?.length,_=l.target.roundNumber===1&&x;if(g){let Q=V();if(Q.context&&Object.assign(E,Q.context),Q.error)return le({result:Q,stack:h})}else if(_){let Q=z();if(Q.context&&Object.assign(E,Q.context),Q.error)return le({result:Q,stack:h})}else if(C&&F){O.sort(la);let Q=O[0],j=lf({participantId:C,structureId:P,drawPosition:Q,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:c,matchUpsMap:p,event:f});if(j.error)return le({result:j,stack:h});if(!j.error&&k&&n)return{stack:h,context:{progressExitStatus:!0,loserParticipantId:C}}}else return le({context:{loserDrawPosition:s,loserTargetLink:l,targetDrawPositionIsUnfilled:x},result:{error:x?ww:iOe},stack:h});if(I?.seedAssignments&&I.structureId!==P){let Q=I.seedAssignments.find(({participantId:W})=>W===C),j=Q?.participantId;Q&&j&&zC({eventId:u?.eventId,structureId:P,...Q,tournamentRecord:o,drawDefinition:c,participantId:j})}if(d&&r){let Q=d.sides?.find(j=>j.sideNumber===3-r);if(Q?.lineUp){let{roundNumber:j,eventId:W}=u,{roundPosition:Y}=d,X=j===1?2-Y%2:1,J=p?.drawMatchUps?.find(({matchUpId:ne})=>ne===u.matchUpId),ie=[1,2].map(ne=>({...J.sides?.find(ge=>ge.sideNumber===ne)||{},sideNumber:ne}));J.sides=ie;let ue=J.sides.find(ne=>ne.sideNumber===X);ue&&(ue.lineUp=r5({lineUp:Q.lineUp}),Yi({tournamentId:o?.tournamentId,matchUp:J,context:h,drawDefinition:c,eventId:W}))}}return le({result:{...se},stack:h,context:E});function V(){let Q="loserLinkFedFMLC";return le(T?{result:z(),stack:Q}:{result:G(),stack:Q})}function G(){let Q=Oc({drawPosition:b,structureId:P,tournamentRecord:o,drawDefinition:c,event:f});return le({result:Q,stack:"assignLoserPositionBye"})}function z(){let Q=C?lf({drawPosition:v,participantId:C,structureId:P,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:c,matchUpsMap:p,event:f}):{error:ga};return!Q.error&&k&&n?{stack:h,context:{progressExitStatus:!0}}:le({result:Q,stack:"assignLoserDrawPosition"})}}function pme(t){let e="directParticipants",i=w5(t);if(i.error)return le({result:i,stack:e});let r=uR({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,matchUpStatusCodes:l,tournamentRecord:c,drawDefinition:u,matchUpStatus:d,dualMatchUp:p,matchUpsMap:f,winningSide:h,targetData:m,matchUpId:A,structure:g,matchUp:v,event:b}=t,y=!!v.collectionId,I=Yo({structure:g}),w=v.drawPositions,S;if(y){let{matchUpTieId:T,matchUpsMap:D}=t,C=pA({appliedPolicies:t.appliedPolicies,matchUpId:T,tournamentRecord:c,drawDefinition:u,matchUpsMap:D,event:b});if(S=C&&{tieMatchUpResult:C},w=a.find(({matchUpId:E})=>E===T)?.drawPositions,!n)return le({result:{...se,...S},stack:e})}if(I)return le({result:{...se,...S},stack:e});if(w){let T=s?s-1:h-1,D=1-T,C=w[T],E=w[D],P={},{targetLinks:{loserTargetLink:R,winnerTargetLink:M,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:k,loserMatchUpDrawPositionIndex:O,winnerMatchUp:x,loserMatchUp:F,byeMatchUp:_}}=m;if(x){let V=QHe({sourceMatchUpStatus:r&&d||Ln,winnerMatchUpDrawPositionIndex:k,sourceMatchUpId:A,inContextDrawMatchUps:a,projectedWinningSide:s,winningDrawPosition:C,tournamentRecord:c,winnerTargetLink:M,drawDefinition:u,winnerMatchUp:x,dualMatchUp:p,matchUpsMap:f,event:b});if(V.error)return le({result:V,stack:e})}if(F){let V=jHe({sourceMatchUpStatus:r&&d||Ln,loserMatchUpDrawPositionIndex:O,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,loserDrawPosition:E,tournamentRecord:c,loserTargetLink:R,drawDefinition:u,loserMatchUp:F,matchUpsMap:f,dualMatchUp:p,event:b});if(V.context?.progressExitStatus&&Object.assign(P,V.context,{sourceMatchUpStatus:r&&d||Ln,sourceMatchUpStatusCodes:l||[],loserMatchUp:F,matchUpsMap:f}),V.error)return le({result:V,stack:e})}if(_){let V=_.drawPositions||[],G=Math.min(...V.filter(Boolean)),z=N.target.structureId,Q=Oc({drawPosition:G,structureId:z,tournamentRecord:c,drawDefinition:u,event:b});if(Q.error)return le({result:Q,stack:e})}return le({result:{...se,...S},stack:e,context:P})}else return le({result:{error:P1},stack:e})}function U5(t){let e="genPlayoffStructure";if(!t.drawDefinition)return le({result:{error:Bt},stack:e});let i=IR(t);if(i.error)return le({result:i,stack:e});let{structureId:r,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:s,finishingPositionLimit:o,playoffAttributes:l,playoffPositions:c,roundOffsetLimit:u,tournamentRecord:d,exitProfileLimit:p,roundProfiles:f,roundNumbers:h,idPrefix:m,isMock:A,event:g,uuids:v}=t,b=St(t.drawDefinition,!1,!0),{structure:y}=ui({structureId:r,drawDefinition:b});if(!y)return le({result:{error:nn},stack:e});if(y.structureType===Ao||y.structures)return UHe({sourceStructureId:y.structureId,...t,...i,drawDefinition:b});let{playoffRoundsRanges:I,playoffRounds:w}=i,{playoffPositionsReturned:S,error:T,playoffSourceRounds:D,playoffRoundsRanges:C}=$he(t);if(T)return le({result:{error:T},stack:e});let E=f?.length&&Object.assign({},...f),P=h||typeof f=="object"&&f.map(Y=>Object.keys(Y)).flat(),R=Array.isArray(P)&&P.map(Y=>!isNaN(Y)&&ri(Y)).filter(Boolean);if(R){if(!Array.isArray(R))return le({result:{error:be},context:{validRoundNumbers:R},stack:e});R.forEach(Y=>{if(!w?.includes(Y))return le({result:{error:be},context:{roundNumber:Y},stack:e})})}c&&c.forEach(Y=>{if(!S?.includes(Y))return le({result:{error:be},context:{playoffPosition:Y},stack:e})});let M=R||D,N=R?I:C,k=[],O=[];for(let Y of M??[]){let X=N?.find(xe=>xe.roundNumber===Y);if(!X)return le({result:{error:be},context:{roundNumber:Y},stack:e});let J=X.finishingPositions.length,ie=Math.min(...X.finishingPositions)-1,ue=2,ne=Y&&E?.[Y]&&ue+E[Y]-1,ge=ZU({exitProfile:`0-${Y}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:ie,playoffAttributes:l,exitProfileLimit:p,stage:Tn,roundOffset:0,drawDefinition:b,sequenceLimit:ne,stageSequence:ue,drawSize:J,idPrefix:m,isMock:A,uuids:v,finishingPositionNaming:s,finishingPositionLimit:o,roundOffsetLimit:u});if(ge.error)return le({result:ge,stack:e});let{structures:he,links:Ie}=ge;if(he?.length&&k.push(...he),Ie?.length&&O.push(...Ie),ge.structureId&&Y){let xe={linkType:gh,source:{structureId:r,roundNumber:Y},target:{structureId:ge.structureId,feedProfile:Xu,roundNumber:1}};O.push(xe)}}if(!k.length)return le({result:{error:be},info:"No structures generated",stack:e});b.structures.push(...k),b.links.push(...O);let{matchUps:x,matchUpsMap:F}=ea({inContext:!0,drawDefinition:b}),_=k.map(({structureId:Y})=>Y),V=x?.filter(({structureId:Y})=>_.includes(Y)).map(xa),G=F?.drawMatchUps?.filter(({matchUpId:Y})=>V?.includes(Y));if(G?.length){let Y=uo({drawDefinition:b,event:g})?.tieFormat;Y&&G.forEach(X=>{let{tieMatchUps:J}=jw({matchUp:X,tieFormat:Y,isMock:A});Object.assign(X,{tieMatchUps:J,matchUpType:$r})})}x?.filter(Y=>ty({matchUp:Y})&&Y.structureId===r)?.forEach(Y=>{let{matchUpId:X,score:J,winningSide:ie}=Y,ue=xo({inContextDrawMatchUps:x,drawDefinition:b,matchUpId:X}),ne=pme({inContextDrawMatchUps:x,tournamentRecord:d,drawDefinition:b,matchUpsMap:F,winningSide:ie,targetData:ue,matchUpId:X,structure:y,matchUp:Y,score:J,event:g});ne.error&&console.log(ne.error)}),x?.filter(Y=>Y.matchUpStatus==="BYE"&&Y.structureId===r)?.forEach(Y=>{let{matchUpId:X}=Y,J=xo({inContextDrawMatchUps:x,drawDefinition:b,matchUpId:X}),{targetLinks:{loserTargetLink:ie},targetMatchUps:{loserMatchUpDrawPositionIndex:ue,loserMatchUp:ne}}=J;if(ie&&ne){let ge=ie.target.structureId,he=ne.drawPositions[ue],Ie=Oc({drawPosition:he,structureId:ge,tournamentRecord:d,drawDefinition:b,event:g});Ie.error&&console.log(Ie.error)}});let z=[],Q=Cy({inContextDrawMatchUps:x,drawDefinition:b,matchUpsMap:F}).goesToMap,{structure:j}=ui({drawDefinition:t.drawDefinition,structureId:r}),{matchUps:W}=cr({structure:j});return W.forEach(Y=>{let X=Q?.loserMatchUpIds[Y.matchUpId];if(X&&Y.loserMatchUpId!==X){Y.loserMatchUpId=X;let ie={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:Y};z.push(ie)}let J=Q?.winnerMatchUpIds[Y.matchUpId];if(J&&Y.winnerMatchUpId!==J){Y.winnerMatchUpId=J;let ie={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:Y};z.push(ie)}}),{structures:k,matchUpModifications:z,links:O,drawDefinition:b,...se}}function fme({element:t}){if(!t)return{error:be};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:be};let e=(i,r)=>(n,a)=>(a[i]&&(n[a[i]]=a[r]),n);return t.timeItems.reduce(e("itemType","itemValue"),{})}function Pf(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:bq};let a=cfe(t);if(a.error)return a;if(!(Ki(n)&&Lr(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:yq};if(!a.timeItems)a.timeItems=[];else if(zHe({element:a,duplicateValues:e,timeItem:n}))return{...se};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let s=new Date().toISOString();Object.assign(n,{createdAt:s})}return r&&(a.timeItems=a.timeItems.filter(({itemType:s})=>n.itemType!==s)),r&&!n.itemValue||a.timeItems.push(n),{...se}}function zHe({element:t,duplicateValues:e,timeItem:i}){let{itemType:r,itemSubTypes:n,itemValue:a}=i,s=r&&yu({itemSubTypes:n,itemType:r,element:t})?.timeItem;return s&&JSON.stringify(s?.itemValue)===JSON.stringify(a)&&!e}function T5({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:rt};if(!n)return{error:ga};let s=zg({tournamentRecord:i,participantId:n});return s.error?s:Pf({element:s.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function TR(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;if(!i)return{error:rt};let s=Pf({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a});if(s.error)return s;let o=fme({element:i});return bi({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:o},topic:rb}),s}function zw(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?Pf({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:cu}}function hme(t){return rL({...t,itemType:"attachConsolationStructures"})}function C5(t){return rL({...t,itemType:"attachPlayoffStructures"})}function rL({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:s}){let o="attachStructures";if(!r)return{error:Bt};if(!Array.isArray(n)||!Array.isArray(a))return le({result:{error:be},stack:o});let l=A=>[A.source.structureId,A.source.roundNumber||A.source.finishingPositions?.join("|"),A.target.roundNumber].join("|"),c=r.links?.map(l);if(a.some(A=>{let g=l(A);return c?.includes(g)}))return le({result:{error:Cq},info:"playoff structure exists",stack:o});a.length&&r.links?.push(...a);let u=n.map(({structureId:A})=>A),d=r.structures?.map(({structureId:A})=>A);r.structures=(r.structures??[]).map(A=>u.includes(A.structureId)?n.find(({structureId:g})=>g===A.structureId):A);let p=n?.filter(({structureId:A})=>!d?.includes(A));p.length&&r.structures.push(...p),Cy({drawDefinition:r});let f=n.map(A=>cr({structure:A})?.matchUps||[]).flat();fg({tournamentId:i?.tournamentId,eventId:s?.eventId,drawDefinition:r,matchUps:f});let h=n.map(({structureId:A})=>A);if(Br({drawDefinition:r,structureIds:h}),e?.length){let A={};e.forEach(v=>{let b=v.matchUp?.matchUpId;b&&(A[b]=v)});let g=v=>{v.matchUps.forEach(b=>{if(A[b.matchUpId]){let{tieMatchUps:y,...I}=A[b.matchUpId].matchUp;if(Object.assign(b,I),y?.length){let w={};y.forEach(S=>A[S.matchUpId]=S),b.tieMatchUps.forEach(S=>Object.assign(S,w[S.matchUpId]))}A[b.matchUpId].matchUp=b,Yi(A[b.matchUpId])}})};r.structures.forEach(v=>{if(d?.includes(v.structureId))if(v.structures)for(let b of v.structures)g(b);else g(v)})}let m=p.map(Kl("structureId"));if(i){let A={itemValue:{structureIds:h,drawId:r.drawId},itemType:t};Pf({element:i,timeItem:A})}return{...se,addedStructureIds:m}}function nL(t){let{structures:e,links:i,matchUpModifications:r,error:n}=U5(t);if(n)return{error:n};let a=t.drawDefinition;return C5({tournamentId:t.tournamentRecord?.tournamentId,eventId:t.event?.eventId||t.eventId,matchUpModifications:r,drawDefinition:a,structures:e,links:i})}function Dy(t){let e=Gt(t,[{_anyOf:{[Xs]:!1,[Sa]:!1,[to]:!1,[lA]:!1},[Qq]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=gee(t,r);if(n.error)return n;i.push(...n?.applied??[]),t.drawDefinition&&Br({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:rt};for(let a of n){let s=t.tournamentRecords[a],o=gee(t,s);if(o.error)return o;i.push(...o?.applied??[])}}else return{error:rt};return i.length?{...se,applied:i}:{error:dq}}function gee(t,e){let i=er(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:JO};for(let a of n)if(!i[a]||t.allowReplacement){let s=t.policyDefinitions[a];if(!s)continue;if(!Ki(s))return{error:be};let{policyName:o,...l}=s;if(!l||!Object.keys(l).length||o&&!Lr(o))return{error:be};i[a]=t.policyDefinitions[a],r.push(a)}return r?.length?{...lr({element:e,extension:{name:lP,value:i}}),applied:r}:{applied:r,error:dq}}function E5({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){if(!r||typeof r!="string")return le({result:{error:be},context:{drawName:r}});i||(i=Bn({event:a}).flightProfile);let s=i?.flights?.find(o=>o.drawId===n);if(s){s.drawName=r;let o={name:vd,value:{...i,flights:i.flights}};Qg({event:a,extension:o})}return e&&(e.drawName=r,Br({tournamentId:t?.tournamentId,drawDefinition:e})),!s&&!e?{error:Bt}:{...se,flight:s}}function mme({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){if(!Ki(i))return{error:be};let a=Bn({event:n}).flightProfile,s=i.drawName&&E5({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:r,event:n});if(s?.error)return s?.error;let o=s?.flight||a?.flights?.find(l=>l.drawId===r);if(!o&&!e)return{error:Bt};if(o){let l={name:vd,value:{...a,flights:a.flights}};Qg({event:n,extension:l})}return e&&(i.policyDefinitions&&Dy({policyDefinitions:i.policyDefinitions,drawDefinition:e}),Br({tournamentId:t?.tournamentId,drawDefinition:e})),{...se}}function Ame({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){if(!i)return{error:Bt};let r=ss({drawDefinition:i}),n=s=>r?.drawMatchUps?.find(o=>o.matchUpId===s);for(let s of i.structures||[]){let{positionAssignments:o,stage:l,stageSequence:c}=s;o&&(c!==1||![zt,Ut].includes(l))&&(s.positionAssignments=o.map(p=>(delete p.participantId,p)),s.seedAssignments=[]);let{matchUps:u,isRoundRobin:d}=cr({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:s});for(let p of u){let{matchUpId:f,roundNumber:h}=p,m=p.sides||[],A=n(f);if(A){if(delete A.extensions,delete A.notes,A.matchUpStatus!=="BYE"&&Object.assign(A,iL),h&&h>1&&A.drawPositions?.length&&!d){let g=m?.map(({drawPosition:b,participantFed:y})=>!y&&b).filter(Boolean),v=A.drawPositions.map(b=>g.includes(b)?void 0:b);A.drawPositions=v}e?delete A.timeItems:A.timeItems?.length&&(A.timeItems=A.timeItems.filter(g=>g.itemType&&![wh,mg,kw,OW,xw,_w].includes(g.itemType))),Yi({tournamentId:t?.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:A})}}}i.extensions=i.extensions.filter(s=>s.name!==YU);let a=(i.structures||[]).map(({structureId:s})=>s);return Br({drawDefinition:i,structureIds:a}),{...se}}function CR({tournamentRecord:t}){if(!t)return{error:rt};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return(t.events?.flatMap(r=>{let n=r.eventId;return i[n]=r,(r?.drawDefinitions||[]).map(a=>({drawDefinition:a,eventId:n}))}).filter(Boolean)).forEach(({drawDefinition:r,eventId:n})=>{let a=0,s=0,o=0,{allStructuresLinked:l}=ZF({drawDefinition:r}),c=i[n],u=(r?.structures||[]).map(b=>{let{stage:y,stageSequence:I,structureId:w}=b,S=HI[y],{inContextStructureMatchUps:T}=GC({drawDefinition:r,structure:b,event:c}),D=T?.filter(({winningSide:G})=>G),C=D.filter(Boolean).length||0;s+=C,o+=T.length-s;let E=Math.max(D.filter(({roundNumber:G})=>G===1).map(({roundPosition:G})=>G)),{positionAssignments:P}=Ir({structure:b}),R=P?.filter(({participantId:G})=>G);a+=R?.length??0;let M=(P?.length??0)-(R?.length??0),{roundMatchUps:N,roundProfile:k,roundNumbers:O,maxMatchUpsCount:x}=ko({matchUps:T}),F=k&&Object.keys(k).filter(G=>!k[G].inactiveRound).map(G=>Number.parseInt(G)),_=k&&Object.keys(k).filter(G=>k[G].inactiveRound).map(G=>Number.parseInt(G)),V=k&&Object.values(k).every(G=>G.inactiveRound);return{positionsAssignedCount:R?.length??0,maxWinningSideFirstRoundPosition:E,unassignedPositionsCount:M,inactiveStructure:V,maxMatchUpsCount:x,inactiveRounds:_,roundMatchUps:N,activeRounds:F,roundNumbers:O,roundProfile:k,structureId:w,stageSequence:I,orderNumber:S,stage:y}}),d=u.find(b=>b.orderNumber===2&&b.stageSequence===1),p=u.filter(({inactiveStructure:b})=>!b).length,{links:f}=HC({structureId:d.structureId,drawDefinition:r}),h=ri(d.activeRounds[0])===1&&d.activeRounds.length===1&&p===1,m=u?.every(({inactiveStructure:b})=>b),A=!f.length&&d.activeRounds.length&&(d.roundProfile[1].inactiveCount||d.inactiveRounds.length),g=r.drawId;a&&!s&&e.positionsNoOutcomes.push(g),m&&e.inactive.push(g),h&&e.matchPlay.push(g),A&&e.canBePruned.push(g);let v={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:o,positionsAssignedCount:a,allStructuresLinked:l,structuresData:u,inactiveDraw:m,isMatchPlay:h,drawId:g};e.drawAnalysis[g]=v}),{...se,drawsAnalysis:e}}function gme({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){if(!e)return{error:rt};if(!i)return{error:Bt};let n=[],{drawsAnalysis:a}=CR({tournamentRecord:e});if(a.canBePruned.includes(r)){let s=a.matchPlay.includes(r),o=a.drawAnalysis[r],{structures:[l]}=yd({stageSequence:1,drawDefinition:i,stage:Ut}),c=o.structuresData.find(({structureId:f})=>l.structureId===f),u=(l.matchUps??[]).sort((f,h)=>f.roundPosition-h.roundPosition);n=u.filter(({roundNumber:f})=>!c.inactiveRounds.includes(f));let d=n.map(xa),p=u.map(xa).filter(f=>!d.includes(f));if(s){let f=n.filter(({roundNumber:v})=>!c.inactiveRounds.includes(v)).filter(({winningSide:v})=>v),h=f.map(xa),m=d.filter(v=>!h.includes(v));p.push(...m);let A=f.flatMap(v=>v.drawPositions??[]).filter(Boolean).flat(),g=Object.assign({},...A.map((v,b)=>({[v]:b+1})));if(f.forEach(v=>{t?v.drawPositions=v.drawPositions.map(b=>g[b]):delete v.drawPositions}),t){let v=l?.positionAssignments?.filter(b=>A.includes(b.drawPosition)).map(b=>(b.drawPosition=g[b.drawPosition],b));l.positionAssignments=v}else l.positionAssignments=[];l.matchUps=f,n=f}$h({tournamentId:e?.tournamentId,matchUpIds:p,drawDefinition:i}),Br({drawDefinition:i})}return{...se,matchUps:n}}function qHe({isPositionAction:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,loserMatchUp:n,matchUpsMap:a,structureId:s,structure:o,event:l}){if(!i)return{error:Bt};if(o||({structure:o}=ui({drawDefinition:i,structureId:s})),!o)return{error:nn};s||({structureId:s}=o);let c="assignDrawPositionQualifier";vl({method:c,color:"cyan",drawPosition:r}),a??=ss({drawDefinition:i});let{positionAssignments:u}=Ir({structure:o}),{activeDrawPositions:d}=GC({drawDefinition:i,structureId:s});if(u?.find(g=>g.drawPosition===r)?.qualifier)return{...se};let p=!!(n&&a.drawMatchUps.some(g=>g.loserMatchUpId===n?.matchUpId&&Ms(g.matchUpStatus)));if(d?.includes(r)&&!p)return{error:R1};let f=u?.find(g=>g.drawPosition===r);if(!f)return{error:ww};let{containsQualifier:h,containsParticipant:m}=GW(f);if(h)return{...se};let A=er({tournamentRecord:e,drawDefinition:i,event:l}).appliedPolicies??{};return u?.forEach(g=>{g.drawPosition===r&&(g.qualifier=!0,p&&(g.participantId=void 0,console.log("oddity: invalid participantId on qualifier position cleared")))}),Fm({tournamentId:e?.tournamentId,drawDefinition:i,structure:o,event:l}),WHe({assignedParticipantId:m,isPositionAction:t,appliedPolicies:A,drawDefinition:i,drawPosition:r,structureId:s,stack:c})}function WHe({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&K1({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),le({result:{...se},stack:s})}function vme({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:s,bye:o}){if(!e)return{error:Bt};if(!r)return{error:EC};if(!n)return{error:Bc};if(o){let l=Oc({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else if(a){let l=qHe({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else{let l=lf({participantId:i,tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}return{...se}}function yme(t){let e=t.matchUpIds??[],{drawDefinition:i}=t,r=t.structureId??i?.structures?.find(l=>l.matchUps?.some(({matchUpId:c})=>e.includes(c)))?.structureId??i?.structures?.[0]?.structureId;if(!r)return{error:nn};let n=i.structures?.find(l=>l.structureId===r);if(!n)return{error:nn};let a=n?.matchUps,s=a?.find(l=>!!l.roundPosition);if(n.structures||s||n.finishingPosition===Rw)return{error:Zy};let o=a.filter(({roundNumber:l})=>t.roundNumbers?.includes(l)).map(xa);return e=e.filter(l=>!o.includes(l)),t.roundNumbers&&!e.length&&(e=o),{existingMatchUps:a,matchUpIds:e,structureId:r,structure:n}}function bme(t){let e=Gt(t,[{[to]:!0},{[IT]:{[Q1]:!1,roundNumbers:!1},[Dc]:be,[il]:zs}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:s,event:o}=t,l=yme(t);if(l.error)return l;let{structure:c,structureId:u,existingMatchUps:d,matchUpIds:p}=l,f=[],h=d?.filter(({matchUpId:g,score:v,winningSide:b})=>{if(b&&!n)return!1;if(b||ya({score:v})){if(!b&&!i)return!1;f.push(g)}else if(!r)return!1;return p?.includes(g)})??[],m=h.map(xa),A=h.map(({tieMatchUps:g})=>g?.map(xa)).filter(Boolean).flat();if(m.length){c.matchUps=(c.matchUps??[]).filter(({matchUpId:b})=>!m.includes(b)),$h({tournamentId:a?.tournamentId,matchUpIds:[...A,...m],action:"deleteAdHocMatchUps",eventId:o?.eventId,drawDefinition:s});let g=Ci(c.matchUps.map(Kl("roundNumber"))),v=eOe(g);if(v.length){v.reverse();for(let b of v)c.matchUps.forEach(y=>{y.roundNumber&&y.roundNumber>b&&(y.roundNumber-=1,Yi({tournamentId:a?.tournamentId,context:["adHoc round deletion"],eventId:o?.eventId,drawDefinition:s,matchUp:y}))})}if(f.length){c.positionAssignments=Ci(c.matchUps.flatMap(S=>(S.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(S=>({participantId:S}));let b=c?.matchUpFormat??s?.matchUpFormat??o?.matchUpFormat,y=l.existingMatchUps.some(S=>S.matchUpType===Cc)?{matchUpTypes:[Cc]}:void 0,{matchUps:I}=cr({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:y,structure:c,event:o});Yo({structure:c})&&(c.positionAssignments=Ci(I.flatMap(S=>(S.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(S=>({participantId:S})));let w=b5({positionAssignments:c.positionAssignments,tournamentRecord:a,drawDefinition:s,matchUpFormat:b,matchUps:I,event:o});w.error&&console.log(w)}Br({structureIds:[u],eventId:o?.eventId,drawDefinition:s})}return!m.length&&p.length?{error:_1}:{...se,deletedMatchUpsCount:[...m,...A].length}}function Ime({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:rt};if(!i)return{error:Bt};if(!n)return le({result:{error:Kt},info:"roundNumber required"});let s=ui({drawDefinition:i,structureId:r});if(s.error)return s;let o=s.structure;return o?.structures?{error:Zy}:Yo({structure:o})?KHe({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:o}):(console.log("not implemented"),{...se})}function KHe({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let s=n?.matchUps??[],o=[],l=[],c=!1;if(s.reduce((u,d)=>{let p=d?.roundNumber;return p?u.includes(p)?u:u.concat(p):u},[]).sort(la).includes(r)){let u=s.filter(d=>{let p=d.roundNumber===r&&(!qn.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&o.push(...d.tieMatchUps.map(xa))),!p});l.length&&($h({matchUpIds:[...o,...l],drawDefinition:e,tournamentId:i,eventId:a}),u.some(d=>d.roundNumber===r)||(u.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,Yi({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),c=!0),n.matchUps=u)}return{deletedMatchUpsCount:l.length,roundRemoved:c,...se}}function aL(t){let{suppressNotifications:e,tournamentRecord:i,drawDefinition:r,matchUps:n,event:a}=t;if(typeof r!="object")return{error:Bt};let s=t?.structureId;if(!s&&r.structures?.length===1&&(s=r.structures?.[0]?.structureId),typeof s!="string")return{error:Bc};if(!wu(n))return{error:be,info:Ey("matchUps")};let o=r.structures?.find(p=>p.structureId===s);if(!o)return{error:nn};let l=(o?.matchUps).find(p=>!!p.roundPosition);if(o.structures||l||o.finishingPosition===Rw)return{error:Zy};let c=La({tournamentRecord:i,inContext:!1})?.matchUps?.map(xa)??[],u=n.map(xa);if(Bo(c,u))return{error:hde,info:"One or more matchUpIds already present in tournamentRecord"};o.matchUps.push(...n);let d=n.map(({tieMatchUps:p})=>p).filter(Boolean).flat();return e||(fg({tournamentId:i?.tournamentId,matchUps:[...d,...n],eventId:a?.eventId,drawDefinition:r}),Br({drawDefinition:r,structureIds:[s]})),{...se}}function wme({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){if(!e)return{error:Bt};if(!r)return{error:Bc};if(!i)return{error:EC};let{structure:s}=ui({drawDefinition:e,structureId:r});if(!s)return{error:nn};let o=s;s.structures&&s.structureType===Ao&&(o=s.structures?.find(f=>f.positionAssignments?.find(h=>h.drawPosition===i)));let l=o?.positionAssignments,c=l?.find(f=>f.drawPosition===i);c&&lr({element:c,extension:{name:ST,value:n}});let u=(a?.eventType===$r||e.matchUpType===$r||(a?.tieFormat??e?.tieFormat??s?.tieFormat))&&{matchUpTypes:[$r]},{matchUps:d}=cr({structure:o,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:u,event:a}),p=s?.matchUpFormat??e.matchUpFormat;return b5({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),Br({drawDefinition:e,structureIds:[r]}),{...se}}var Sme={};Fi(Sme,{addGoesTo:()=>Cy,allPlayoffPositionsFilled:()=>o5,checkValidEntries:()=>cL,findDrawDefinition:()=>M5,getAssignedParticipantIds:()=>cb,getAvailableMatchUpsCount:()=>sL,getAvailablePlayoffProfiles:()=>IR,getDrawDefinitionTimeItem:()=>DW,getDrawParticipantRepresentativeIds:()=>P5,getDrawStructures:()=>yd,getDrawTypeCoercion:()=>DR,getEligibleVoluntaryConsolationParticipants:()=>D5,getMatchUpsMap:()=>ss,getParticipantIdFinishingPositions:()=>R5,getPositionAssignments:()=>ET,getPositionsPlayedOff:()=>WC,getRandomQualifierList:()=>x5,getSeedingThresholds:()=>t5,getSeedsCount:()=>PR,getStructureSeedAssignments:()=>pu,getTeamLineUp:()=>Ty,getValidGroupSizes:()=>AR,isAdHoc:()=>Yo,isCompletedStructure:()=>Sh,isValidForQualifying:()=>_5,positionActions:()=>k5});function D5({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:s,drawDefinition:o,matchUpsLimit:l,requirePlay:c,requireLoss:u,allEntries:d,winsLimit:p,event:f}){if(!o)return{error:Bt};let h=[Ut,Tn];i&&h.push(zt);let m=f?.eventType?{matchUpTypes:[f.eventType]}:void 0,A=o?.matchUpType?{matchUpTypes:[o.matchUpType]}:void 0,g=e&&f?Vh({contextFilters:{stages:h},matchUpFilters:m,tournamentRecord:s,inContext:!0,event:f})?.matchUps??[]:Do({contextFilters:{stages:h},matchUpFilters:A,tournamentRecord:s,inContext:!0,drawDefinition:o})?.matchUps??[],v=Bw({stage:Ya,drawDefinition:o}),b=new Set(v.map(({participantId:F})=>F)),y={},I={},w={},S={};n??=uA({policyTypes:[Sj],tournamentRecord:s,drawDefinition:o,event:f}).policyDefinitions;let T=n?.[Sj];t=t.length&&t||T?.excludedMatchUpStatuses||[],e=e??T?.includeEventParticipants,d=d??T?.allEntries,r=r??T?.finishingRoundLimit,a=a??T?.roundNumberLimit,l=l??T?.matchUpsLimit,c??=T?.requirePlay??!0,u??=T?.requireLoss??!0,p=p??T?.winsLimit;for(let F of g){if(c&&F.winningSide&&![1,2].includes(F.winningSide)&&F.matchUpStatus!==mn||F.finishingRound&&r&&F.finishingRound>=r||F.finishingRound&&a&&F.finishingRound<=a)continue;let _=F.sides?.find(({sideNumber:G})=>F.winningSide&&G===3-F.winningSide),V=F.sides?.find(({sideNumber:G})=>F.winningSide&&G===F.winningSide);if(F.sides?.forEach(G=>{let z=G?.participant?.participantId;z&&(w[z]=G.participant,F.matchUpStatus===mn&&!c&&(I[z]=G.participant,y[z]||(y[z]=0),(!F.matchUpStatus||!t.includes(F.matchUpStatus))&&(y[z]+=1)))}),_?.participant){let G=_.participant.participantId;I[G]=_.participant,y[G]||(y[G]=0),F.matchUpStatus&&!t.includes(F.matchUpStatus)&&(y[G]+=1)}if(V?.participant){let G=V.participant.participantId;S[G]||(S[G]=0),S[G]+=1,y[G]||(y[G]=0),F.matchUpStatus&&!t.includes(F.matchUpStatus)&&(y[G]+=1)}}let D=s?.participants&&!c&&!u&&d,C;e&&f?C=f.entries:C=o.entries;let E=D?(C??[]).filter(F=>![Ih,bu].includes(F.entryStatus)).map(({participantId:F})=>F):[],P=Object.keys(I),R=D?(s?.participants??[]).filter(({participantId:F})=>E.includes(F)):u&&Object.values(I)||Object.values(w),M=F=>!u||P.includes(F),N=F=>!c||(y[F]||0)>=0,k=F=>!p||(S[F]||0)<=p,O=F=>!l||y[F]<=l,x=F=>!b.has(F);return{eligibleParticipants:R.filter(F=>M(F.participantId)&&N(F.participantId)&&k(F.participantId)&&O(F.participantId)&&x(F.participantId)).map(F=>({...F,individualParticipants:F.individualParticipantIds?.map(_=>s?.participants?.find(V=>V.participantId===_))})),losingParticipantIds:P,...se}}function sL(t){let e=Gt(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:r}=t,n=t.structureId??(i.structures?.length===1&&i.structures?.[0]?.structureId);if(typeof n!="string")return{error:Bc};let a=i.structures?.find(h=>h.structureId===n);if(!a)return{error:nn};let s,o=(a.matchUps??[])?.reduce((h,m)=>(m.roundPosition&&(s=!0),(m?.roundNumber||0)>h?m.roundNumber:h),0);if(a.structures||s||a.finishingPosition===Rw)return{error:Zy};let l=i?.entries?.filter(h=>{let m=h.entryStatus;return Pd.includes(m)})??[],c=Math.floor(l?.length/2)||1,u=r??o??1,d=a.matchUps?.filter(h=>h.roundNumber===u)?.length??0,p=c-d,f=p>0?p:0;return{...se,availableMatchUpsCount:f,lastRoundNumber:o,roundMatchUpsCount:c}}function P5({drawDefinition:t}){let e=Bi({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:e.extension?.value||[]}}function YHe({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:Bt};let r=ea({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=St(r.matchUps,!1,!0),a=Ci(n.reduce((o,l)=>o.concat(...l.sides.map(c=>c.participantId).filter(Boolean)),[])),s=Object.assign({},...a.map(o=>{let l=n.filter(c=>c.sides.map(u=>u.participantId).filter(Boolean).includes(o));return{[o]:l}}));return{participantIds:a,participantIdMatchUps:s}}function ET({tournamentRecord:t,drawDefinition:e,stage:i=Ut,structureId:r,structure:n}){if(!t)return{error:rt};if(!n&&!e)return{error:Bt};if(!n&&!r&&e?.structures?.filter(o=>o.stage===i).length===1&&(n=e.structures.find(o=>o.stage===i)),!n&&!r)return{error:Bc};let{error:a,positionAssignments:s}=Ir({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:s??[],structureId:n?.structureId,error:a}}function Ume({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:s,category:o,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:f,notes:h})=>({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:s,category:o,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:f,notes:h}))(t)}}var XHe={[OC]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},ZHe=XHe;function qw(t){let{tournamentRecord:e}=t??{};if(!e)return{error:rt};let i=(({tournamentId:o,tournamentRank:l,tournamentStatus:c,formalName:u,tournamentName:d,promotionalName:p,onlineResources:f,localTimeZone:h,activeDates:m,startDate:A,endDate:g,hostCountryCode:v,venues:b,notes:y,updatedAt:I})=>({tournamentId:o,tournamentRank:l,tournamentStatus:c,formalName:u,tournamentName:d,promotionalName:p,onlineResources:f,localTimeZone:h,activeDates:m,startDate:A,endDate:g,hostCountryCode:v,venues:b,notes:y,updatedAt:I}))(e),r=gn({participantFilters:{participantRoles:[qfe,WW,Wfe,Kfe,Xfe]},policyDefinitions:ZHe,tournamentRecord:e})?.participants??[];r&&(i.tournamentContacts=r);let n=$w({tournamentRecord:e})?.publishState,a=n?.tournament?.status?.publishedEventIds||[],s=[];for(let o of e.events??[])if(!t?.usePublishState||a.includes(o.eventId)){let l=Ume({event:o}).eventInfo;l&&s.push(l)}return i.timeItemValues=fme({element:e}),i.publishState=n?.tournament,i.eventInfo=s,{tournamentInfo:St(Ft(i),!1,!0),...se}}function Tme({publishStatus:t,drawId:e}){return t?.drawDetails?t.drawDetails?.[e]?.publishingDetail?.published:t?.drawIds?t.drawIds.includes(e):!0}var Cme="PUBLIC",JHe="ADMIN",Eme={PUBLIC_DISPLAY:Cme,ADMIN_DISPLAY:JHe};function oL(t){let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:r,tournamentRecord:n,inContext:a=!0,usePublishState:s,status:o=_c,pressureRating:l,refreshResults:c,contextProfile:u,drawDefinition:d,noDeepCopy:p,sortConfig:f,context:h,event:m}=t;if(!d)return{error:Bt};let{matchUpFormat:A,updatedAt:g,drawType:v,drawName:b,drawId:y}=d,I={matchUpFormat:A,updatedAt:g,drawName:b,drawType:v,drawId:y};I.display=Bi({element:d,name:xx}).extension?.value;let w={},S,T,{allStructuresLinked:D,sourceStructureIds:C,hasDrawFeedProfile:E,structureGroups:P}=ZF({drawDefinition:d});if(!D)return{error:bue};let R=t?.eventPublishState??$w({event:m}).publishState,M=t?.publishStatus??Su({event:m,status:o}),N=R?.status?.drawDetails?.[d.drawId],k=!!R?.status?.published,O=N?.structureDetails,x=!1,F=!1,_=P.map(V=>{let G={},z=V.map(Q=>{let{structure:j}=ui({drawDefinition:d,structureId:Q}),{seedAssignments:W}=pu({drawDefinition:d,structure:j});return j?.stage===Ut&&j.stageSequence===1&&(S=W),j?.stage===zt&&(w[j.stageSequence??0]=W),j}).sort((Q,j)=>Nw(Q,j,f)).map(Q=>{if(!Q)return;let j=Q?.structureId,W=[];Q.stage&&[Ut,Os,Tn].includes(Q.stage)&&(W=S),Q?.stage===zt&&(W=w[Q.stageSequence??0]);let{matchUps:Y,roundMatchUps:X,roundProfile:J}=cr({seedAssignments:Q?.seedAssignments?.length?void 0:W,context:{drawId:I.drawId,...h},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:e,policyDefinitions:r,tournamentRecord:n,usePublishState:s,publishStatus:M,contextProfile:u,drawDefinition:d,inContext:a,structure:Q,event:m}),{positionAssignments:ie}=Ir({structure:Q}),ue=ie?.filter(Kl(yh)).map(Ie=>{let xe=Bi({element:Ie,name:Om})?.extension?.value,{drawPosition:Je,participantId:qe}=Ie;return F=!0,{participantResult:xe,participantId:qe,drawPosition:Je}});if(Y.length&&(!ue?.length&&t.allParticipantResults||c&&!Q.structures)){let{subOrderMap:Ie}=lme({positionAssignments:ie}),xe=Y.some(qe=>qe.matchUpType===Cc)?Y.filter(qe=>qe.matchUpType===Cc):Y,Je=KC({matchUpFormat:Q.matchUpFormat,matchUps:xe,policyDefinitions:r,pressureRating:l,subOrderMap:Ie});T=Je?.report,ue=ie?.filter(Kl(yh)).map(qe=>{let{drawPosition:dt,participantId:ft}=qe;return F=!0,{participantResult:ft&&Je?.participantResults?.[ft],participantId:ft,drawPosition:dt}})}let ne=Q?{stageSequence:Q.stageSequence,structureName:Q.structureName,structureType:Q.structureType,matchUpFormat:Q.matchUpFormat,stage:Q.stage}:{},ge=Bi({element:Q,name:xx}).extension?.value;ne.display=ge?.[Cme]??ge,ne.sourceStructureIds=C[j],ne.hasDrawFeedProfile=E[j],ne.positionAssignments=ie,ne.structureActive=Y.reduce((Ie,xe)=>{let Je=[mn,ha,Dd,Ln,Df,Mr,Fa,Xr].includes(xe.matchUpStatus);return Ie||Je||!!xe.winningSide||!!xe.score?.scoreStringSide1},!1);let he=Y.every(Ie=>[...qn,"BYE"].includes(Ie.matchUpStatus));return ne.structureCompleted=he,G[j]=he,ne.structureActive&&(x=!0),{...ne,participantResults:ue,seedAssignments:W,roundMatchUps:X,roundProfile:J,structureId:j,report:T}});return z.forEach(Q=>{i||delete Q.positionAssignments,Q.sourceStructuresComplete=Q.sourceStructureIds?.every(j=>G[j])}),z}).flat().filter(V=>!s||O?.[V?.structureId]?.published||!0);return I.drawActive=x,I.participantPlacements=F,I.drawGenerated=_?.reduce((V,G)=>V||!!G?.roundMatchUps,!1),I.drawCompleted=_?.reduce((V,G)=>V&&G.structureCompleted,!0),I.drawPublished=s?k&&Tme({publishStatus:M,drawId:I.drawId}):void 0,{structures:!s||I.drawPublished?p&&_||St(_,!1,!0):void 0,drawInfo:p?I:St(I,!1,!0),...se}}function ER(t){let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:r,usePublishState:n,status:a=_c,contextProfile:s,sortConfig:o}=t,l=Gt(t,[{tournamentRecord:!0},{[Xq]:{event:!1,eventId:!1}}]);if(l.error)return l;let c=St(t.tournamentRecord,!1,!0),u=t.event==null?Xo({tournamentRecord:c,eventId:t.eventId}).event:void 0,d=t.event?St(t.event,!1,!0):u&&St(u,!1,!0)||void 0;if(!d)return{error:cu};let{eventId:p}=d,{tournamentId:f,endDate:h}=c,m=Su({event:d,status:a}),A=$w({event:d}).publishState??{},g=!!A?.status?.published,{participants:v}=gn({participantFilters:t.participantFilters,withEvents:!1,withDraws:!1,policyDefinitions:r,...i,tournamentRecord:c}),b=({stage:R,drawId:M})=>{if(!n)return!0;let N=m?.drawDetails?.[M]?.stageDetails;return!N||!Object.keys(N).length?!0:N[R]?.published},y=({structureId:R,drawId:M})=>{if(!n)return!0;let N=m?.drawDetails?.[M]?.structureDetails;return!N||!Object.keys(N).length?!0:N[R]?.published},I=({drawId:R})=>n?Tme({publishStatus:m,drawId:R}):!0,w=({drawId:R,structure:M})=>{if(!n)return M;let N=m?.drawDetails?.[R]?.structureDetails?.[M.structureId]?.roundLimit;if(yi(N)){let k=gt(1,N+1),O={},x={};for(let F of k)M.roundMatchUps[F]&&(O[F]=M.roundMatchUps[F],x[F]=M.roundProfile[F]);M.roundMatchUps=O,M.roundProfile=x}return M},S=d.drawDefinitions||[],T=!n||g?S.filter(I).map(R=>(({drawInfo:M,structures:N})=>({...M,structures:N}))(oL({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:p,tournamentId:f,endDate:h},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:v,eventPublishState:A,noDeepCopy:!0,policyDefinitions:r,tournamentRecord:c,usePublishState:n,contextProfile:s,drawDefinition:R,publishStatus:m,sortConfig:o,event:d}))).map(({structures:R,...M})=>{let N=R?.filter(({stage:k,structureId:O})=>y({structureId:O,drawId:M.drawId})&&b({stage:k,drawId:M.drawId})).map(k=>w({drawId:M.drawId,structure:k}));return{...M,structures:N}}).filter(R=>R.structures?.length):void 0,D=(Array.isArray(c.venues)?c.venues:[]).map(R=>{let{venueData:M}=TT({venueId:R.venueId,tournamentRecord:c});return{...M}}),C=(({eventId:R,eventName:M,eventType:N,eventLevel:k,surfaceCategory:O,matchUpFormat:x,category:F,gender:_,startDate:V,endDate:G,ballType:z,discipline:Q})=>({eventId:R,eventName:M,eventType:N,eventLevel:k,surfaceCategory:O,matchUpFormat:x,category:F,gender:_,startDate:V,endDate:G,ballType:z,discipline:Q}))(d);C.display=Bi({element:d,name:xx}).extension?.value;let{tournamentInfo:E}=qw({tournamentRecord:c}),P={tournamentInfo:E,venuesData:D,eventInfo:C,drawsData:T};return P.eventInfo.publishState=A,P.eventInfo.published=A?.status?.published,{...se,eventData:P,participants:v}}function R5({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i,event:r}){if(!i)return{error:Bt};let{participantIds:n,participantIdMatchUps:a}=YHe({tournamentParticipants:e?.participants,drawDefinition:i}),s=Object.values(a).some(p=>p.some(f=>f.containerStructureId)),o=(s&&ER({tournamentRecord:e,event:r}))?.eventData?.drawsData?.find(p=>p.drawId===i.drawId)?.structures,l=i?.structures?.find(p=>p.stage===Ut&&p.stageSequence===1),c=l?.structureType===Ao&&l.structures,u=(s?ET({tournamentRecord:e,drawDefinition:i,structureId:l?.structureId})?.positionAssignments:void 0)?.length||0,d=n?.map(p=>{let f=a[p].filter(g=>[Ln,"BYE"].includes(g.matchUpStatus)||g.winningSide),h=f.map(g=>{let v=g.sides.find(y=>y.bye),b=g.sides.find(y=>y.participantId===p).sideNumber;if(g.containerStructureId){let y=eVe({containedStructures:c,drawPositionsCount:u,drawDataStructures:o,drawDefinition:i,participantId:p,matchUp:g});if(y)return y}return(g.winningSide||t&&v&&b)===b?g.finishingPositionRange.winner:g.finishingPositionRange.loser}),m=g=>Math.abs(g[0]-g[1]),A=h.reduce((g,v)=>g&&m(g)<m(v)?g:v,void 0);return{[p]:{finishingPositionRanges:h,finishingPositionRange:A,relevantMatchUps:f}}})||[];return Object.assign({},...d)}function eVe({containedStructures:t,drawPositionsCount:e,drawDataStructures:i,drawDefinition:r,participantId:n,matchUp:a}){let s=t?.find(f=>f.structureId===a.structureId)?.positionAssignments?.length,o=i.find(f=>f.structureId===a.containerStructureId)?.participantResults?.find(f=>f.participantId===n)?.participantResult,{ties:l,groupOrder:c,provisionalOrder:u}=o||{},d=t?.length,p=r.structure?.find(f=>f.stage===Tn);if(Gl()&&console.log({drawPositionsCount:e,provisionalOrder:u,bracketsCount:d,bracketSize:s,groupOrder:c,ties:l}),e===s&&c)return[c,c];if(d>1&&c&&!p)return[1,d];if(d>1&&c&&p){let f=r.links?.find(m=>m.source.structureId===a.containerStructureId)?.source?.finishingPositions,h=f.length*d;if(c in f)return[1,h];{let m=(s-c)*d;return[h+1,e-m]}}}function Xg({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:rt};if(!r)return{error:fp};if(!e&&t){if(typeof i!="string"&&(i=dme({tournamentRecords:t,drawId:r}),!i))return{error:pT};if(e=t[i],!e)return{error:rt}}let n=e&&Xo({tournamentRecord:e,drawId:r});return n?.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...se}:le({result:{error:Ec},stack:"findDrawDefinition"})}function M5(t){let{drawDefinition:e,error:i}=Xg(t);return i?{error:i}:{drawDefinition:St(e)}}function tVe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){let s=a?.entries?.filter(({entryStatus:o})=>[bu,sb].includes(o)).map(({participantId:o})=>o)||[];if(s.length){let o=r.individualParticipantIds,l=e?t.filter(({participantId:u})=>s.includes(u)):void 0,c=e?t.filter(({participantId:u})=>o.includes(u)):void 0;return{validModifyAssignedPairAction:Ft({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:iHe,availableIndividualParticipantIds:s,availableIndividualParticipants:l,existingIndividualParticipantIds:o,existingIndividualParticipants:c,type:d5},!1,!1,!0)}}return{}}function Py(t){let{inContextDrawMatchUps:e,targetData:i,drawDefinition:r,relevantLink:n}=t;if(n?.linkCondition===sf&&i?.matchUp?.matchUpStatus==="BYE")return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:s},targetLinks:o}=i,l=a&&xo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),c=l?.targetMatchUps?.loserMatchUp,u=l?.targetMatchUps?.loserMatchUpDrawPositionIndex,d=c?.sides[u]?.participant,p=Ms(a?.matchUpStatus),f=p&&!d,h=a?.sides?.filter(b=>b?.participant).length??0,m=a?.winningSide&&p&&h===1,A=s?.drawPositions?.filter(Boolean).length||0;if(!m&&(a?.winningSide&&!f||s?.winningSide&&A===2&&(!s.feedRound||!Ms(s?.matchUpStatus))))return!0;let g=s&&xo({matchUpId:s.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),v=l&&Py({relevantLink:o?.loserTargetLink,targetData:l,inContextDrawMatchUps:e,drawDefinition:r});return!!(g&&Py({targetData:g,inContextDrawMatchUps:e,drawDefinition:r})||v)}var Dme={[bh]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[zt,Ut],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[AP,WI,JF,yI],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},Mk="positionAction",Lj="matchUpAction";function Pme({actionType:t=Mk,appliedPolicies:e,drawDefinition:i,structure:r}){let n=t===Mk&&bh||t===Lj&&Xa,a=t===Mk&&Dme||t===Lj&&zfe,s=n&&(e?.[n]||a?.[n]),o=i.links?.filter(d=>d?.target?.structureId===r?.structureId)?.map(({target:d})=>d.feedProfile)??[],{enabledStructures:l,disabledStructures:c}=s||{},u=c?.find(d=>{let{stages:p,stageSequences:f,structureTypes:h,feedProfiles:m}=d;return(!m?.length||Array.isArray(m)&&m.some(A=>o.includes(A)))&&(!p?.length||Array.isArray(p)&&p?.includes(r?.stage))&&(!h?.length||Array.isArray(h)&&h?.includes(r?.structureType))&&(!f?.length||Array.isArray(f)&&f.includes(r?.stageSequence))});return{enabledStructures:l,actionsDisabled:u,actionsPolicy:s}}function iVe({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function Rme({enabledStructures:t,drawDefinition:e,structure:i}){if(t===!1)return{};if(!t?.length)return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:r,stageSequence:n,structureType:a}=i||{},s=e.links?.filter(o=>o?.target?.structureId===i?.structureId)?.map(({target:o})=>o.feedProfile)||[];return{policyActions:t.find(o=>{let{stages:l,stageSequences:c,structureTypes:u,feedProfiles:d}=o||{},p=!l?.length||Array.isArray(l)&&l.includes(r),f=!c?.length||Array.isArray(c)&&c.includes(n),h=!u?.length||Array.isArray(u)&&u.includes(a),m=!d?.length||Array.isArray(d)&&d.some(A=>s.includes(A));return f&&h&&m&&o&&p})}}function Al({action:t,policyActions:e}){let i=!e?.enabledActions||e?.disabledActions?.length&&e.disabledActions.includes(t);return i?!1:(e?.enabledActions.length===0||e?.enabledActions.includes(t))&&!i}var Mme="replaceTieMatchUpParticipantId",Nme="assignTieMatchUpParticipantId",$j="removeTieMatchUpParticipantId",vee="assignMatchUpSideParticipant",rVe="removeMatchUpSideParticipant",Bme="substituteParticipant",Hj="REMOVE_SUBSTITUTION",kme="REPLACE_PARTICIPANT",N5="REMOVE_PARTICIPANT",Vj="setMatchUpStatus",Gj="SUBSTITUTION",xme="SCHEDULE",nVe="PENALTY",Qj="REFEREE",_me="STATUS",jj="START",Ome="SCORE",B5={REPLACE_TEAM_POSITION_METHOD:Mme,ASSIGN_TEAM_POSITION_METHOD:Nme,REMOVE_TEAM_POSITION_METHOD:$j,REPLACE_PARTICIPANT:kme,SUBSTITUTION_METHOD:Bme,REMOVE_SUBSTITUTION:Hj,REMOVE_PARTICIPANT:N5,SCHEDULE_METHOD:Vj,SUBSTITUTION:Gj,SCHEDULE:xme,PENALTY:nVe,REFEREE:Qj,STATUS:_me,SCORE:Ome,START:jj,END:"END"};function aVe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:s,participantId:o,sideNumber:l,matchUpId:c,matchUp:u,drawId:d,side:p}){let f=[],h=n.sides?.find(M=>M.participant),m=Uc(n.gender)&&n.sideNumber&&n.sides?.filter(M=>M.particiapntId).length===1&&h?.participant?.person?.sex,A=n.matchUpType,g=(s??r?.participants?.enforceGender)!==!1?n.gender:void 0,v=n.sides?.flatMap(M=>M.participant?.individualParticipants||M.participant).filter(Boolean)?.map(ji),b=n.sides?.filter(M=>!l||M.sideNumber===l).flatMap(M=>M.participant?.individualParticipants||M.participant).filter(Boolean),y=b?.map(ji),I=e?.find(M=>M.matchUpId===n.matchUpTieId)?.sides?.map(M=>M?.participant?.individualParticipants?.filter(({participantId:N,person:k})=>!y?.includes(N)&&(!g||fh(g)||k.sex===g||Uc(g)&&!m||m&&k.sex!==m))),w=l?I?.[l-1]:I?.map((M,N)=>({participants:M,sideNumber:N+1})),S=l?I?.[l-1]?.map(ji):I?.map((M,N)=>({participants:M?.map(ji),sideNumber:N+1})),T=l&&($n(mI)(A)&&!y?.length||$n(Ay)(A)&&(y?.length??0)<2)||!l&&($n(mI)(A)&&(y?.length??0)<2||$n(Ay)(A)&&(y?.length??0)<4),D=S?.filter(M=>!v?.includes(M)),C=w?.filter(({participantId:M})=>D.includes(M));if(T&&D?.length&&f.push({availableParticipantIds:D,method:Nme,availableParticipants:C,type:qI,payload:{participantId:void 0,tieMatchUpId:c,sideNumber:l,drawId:d}}),y?.length&&(!ya(u)||p?.substitutions?.length)&&f.push({method:$j,type:N5,existingParticipantIds:y,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}}),C?.length&&(!l&&y?.length||l&&p?.participant)&&f.push({availableParticipantIds:D,method:Mme,availableParticipants:C,type:kme,existingParticipantIds:y,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:c,drawId:d}}),Al({policyActions:a,action:Hj})&&p?.substitutions?.length){let M=p.participant?.participantType===zi&&[p.participantId]||p.participant?.participantType===Mi&&p.participant.individualParticipantIds||[],N=p.substitutions.map(k=>k.participantId).filter(k=>M.includes(k));(!o||N.includes(o))&&f.push({method:$j,type:Hj,substitutedParticipantIds:N,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}})}let E=t?.[Xa],P=E?.substituteWithoutScore,R=E?.substituteAfterCompleted;if(Al({policyActions:a,action:Gj})&&i.length===2&&(!l&&y?.length||l&&p?.participant)&&(P||ya(u))&&(R||u.matchUpStatus&&!qn.includes(u.matchUpStatus))&&b?.length&&w.length){let M=b.map(ji);f.push({info:"list of team players available for substitution",method:Bme,availableParticipantIds:S,existingParticipantIds:M,availableParticipants:w,existingParticipants:b,type:Gj,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:c,drawId:d}})}return f}function sVe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:s,drawPosition:o,validActions:l,structureId:c,structure:u,drawId:d,event:p}){if(i.includes(o))return{};let f=l.find(S=>S.type===qI)?.availableParticipantIds,h=a?.[bh]?.otherFlightEntries,m=a?.[bh]?.restrictQualifyingAlternates,A=(s.entries??[]).filter(({entryStage:S})=>!m||(u.stage===zt?S===zt:S!==zt)).sort((S,T)=>(S.entryPosition??1/0)-(T.entryPosition??1/0)).map(({participantId:S})=>S).filter(Boolean),{allPositionedParticipantIds:g}=Kpe({drawDefinition:s}),v=r.map(S=>S.participantId).filter(Boolean),b=A.filter(S=>u.stage&&[zt,Ut,Tn].includes(u.stage)?!g?.includes(S):!v.includes(S)),y=(p?.entries??[]).filter(S=>S.entryStatus===rd&&Fme({restrictQualifyingAlternates:m,structure:u,entry:S})&&(u.stage&&[zt,Ut,Tn].includes(u.stage)?!g?.includes(S.participantId):!v.includes(S.participantId))).sort((S,T)=>(S.entryPosition??1/0)-(T.entryPosition??1/0)).map(S=>S.participantId),I=Ci(b.concat(y));if(h){let S=(p?Bn({event:p}).flightProfile:void 0)?.flights?.filter(T=>T.drawId!==d).map(T=>T.drawEntries.filter(D=>D.participantId&&![Ih,bu,sb].includes(D.entryStatus)&&!A.includes(D.participantId)).map(({participantId:D})=>D)).flat().filter(Boolean);S?.length&&I.push(...S)}f?.length&&(I=I.filter(S=>!f.includes(S)));let w=n?t?.filter(S=>I.includes(S.participantId)):void 0;return w?.forEach(S=>{let T=(s.entries??[]).find(D=>D.participantId===S.participantId);S.entryPosition=T?.entryPosition}),w?.sort((S,T)=>(S.entryPosition||1/0)-(T.entryPosition||1/0)),I.length?{validAlternatesAction:Ft({payload:{drawId:d,structureId:c,drawPosition:o},willDisableLinks:e,method:eHe,availableAlternatesParticipantIds:I,type:p5,availableAlternates:w})}:{}}function Fme({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===zt&&!t||i.entryStage===Ut&&r===Os)return!0}function oVe({eventEntries:t,structure:e}){let i=n=>n.entryStatus===rd&&Fme({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(ji)}function lVe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:s,matchUpId:o,structure:l,matchUp:c,drawId:u,event:d}){let p=[],f=l?.matchUps??[],h=c.sides?.find(T=>T.sideNumber===s)?.participantId,m=f.filter(({roundNumber:T})=>T===c.roundNumber),A=n?.entries?.filter(({entryStatus:T})=>T&&ob.includes(T)).map(ji)??[],g=m.map(T=>(T.sides??[]).flatMap(ji)).flat().filter(Boolean),v=A.filter(T=>!i.includes(T)&&(!t||!g.includes(T))),b=e?.filter(T=>v?.includes(T.participantId)).map(T=>St(T,void 0,!0));b?.forEach(T=>{let D=(n.entries??[]).find(C=>C.participantId===T.participantId);T.entryPosition=D?.entryPosition}),v.length&&p.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},method:vee,type:qI,availableParticipantIds:v,participantsAvailable:b});let y=d?.entries??[],I=oVe({eventEntries:y,structure:l}),w=Ci(A.concat(I));if(r){let T=(d?Bn({event:d}):void 0)?.flights?.filter(D=>D.drawId!==u).flatMap(D=>D.drawEntries.filter(C=>C.participantId&&![Ih,bu,sb].includes(C.entryStatus)).map(({participantId:C})=>C)).filter(Boolean);T?.length&&w.push(...T)}w=w.filter(T=>!i.includes(T)&&!v.includes(T)&&(!t||!g.includes(T)));let S=e?.filter(T=>w.includes(T.participantId)).map(T=>St(T,void 0,!0));if(S?.forEach(T=>{let D=(n.entries??[]).find(C=>C.participantId===T.participantId);T.entryPosition=D?.entryPosition}),S?.sort((T,D)=>(T.entryPosition||1/0)-(D.entryPosition||1/0)),w.length&&p.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},availableParticipantIds:w,participantsAvailable:S,method:vee,type:rd}),!ya(c)&&s&&h){p.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},method:rVe,type:N5});let T=k=>k.sides.map(ji),D=({matchUpId:k})=>k!==c.matchUpId,C=k=>!ya(k),E=c.sides?.find(k=>k.sideNumber!==s)?.participantId,P=f.filter(({roundNumber:k})=>k!==c.roundNumber).filter(D).map(T),R=[E,...P.filter(k=>k.includes(h)).flat()].filter(Boolean),M=k=>!R.flat().includes(k),N=m.filter(C).filter(D).map(T).flat().filter(M);if(N.length){let k=e?.filter(O=>N.includes(O.participantId)).map(O=>St(O,void 0,!0));p.push({payload:{participantIds:[h],roundNumber:c.roundNumber,structureId:a,sideNumber:s,matchUpId:o,drawId:u},swappableParticipantIds:N,method:rHe,type:eL,swappableParticipants:k})}}return p}function lL(t){if(!t)return{error:be};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:r=!0,policyDefinitions:n,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l}=t,c=t.tournamentRecord??(t.tournamentId&&Lr(t.tournamentId)&&t.tournamentRecords?.[t.tournamentId]);if(!c)return{error:rt};if(!l||!Lr(l))return{error:mo};if(o&&![1,2].includes(o))return le({result:{error:be},context:{sideNumber:o}});if(!e){let J=(La({tournamentRecord:c}).matchUps??[]).find(ue=>ue.matchUpId===l);i=(c?.events??[]).find(ue=>ue.eventId===J?.eventId);let ie=(i?.drawDefinitions??[]).find(ue=>ue.drawId===J?.drawId);ie&&(e=ie)}if(!e)return{error:Bt};let u=gn({withIndividualParticipants:!0,tournamentRecord:c}).participants,{drawId:d}=e,{matchUp:p,structure:f}=Wr({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:Ys};let h=er({tournamentRecord:c,drawDefinition:e,structure:f,event:i}).appliedPolicies??{};Object.assign(h,n??{});let m=h?.[bh]?.otherFlightEntries,A=h?.[Xa]??jC[Xa],{enabledStructures:g}=Pme({actionType:Lj,appliedPolicies:h,drawDefinition:e,structure:f}),{policyActions:v}=Rme({enabledStructures:g,drawDefinition:e,structure:f}),b=t.matchUpsMap??ss({drawDefinition:e}),y=t.inContextDrawMatchUps??ea({tournamentParticipants:u,inContext:!0,drawDefinition:e,matchUpsMap:b,event:i}).matchUps,I=y?.find(J=>J.matchUpId===l),w=o&&I?.sides?.find(J=>J.sideNumber===o),S=I?.sides?.map(J=>J.participantId||J.participant?.participantid).filter(Boolean)??[],{assignedPositions:T,allPositionsAssigned:D}=va({structure:f}),{structureId:C}=f??{},E=[];if(!C)return{validActions:E};let P=Yo({structure:f}),R=!!p.collectionId;if(P&&!R){let J=lVe({restrictAdHocRoundParticipants:r,tournamentParticipants:u,matchUpParticipantIds:S,otherFlightEntries:m,drawDefinition:e,structureId:C,sideNumber:o,matchUpId:l,structure:f,matchUp:p,drawId:d,event:i});E.push(...J)}let M=Sh({drawDefinition:e,structure:f}),N=T?.filter(J=>J.participantId).map(J=>J.drawPosition),k=T?.filter(J=>J.bye).map(J=>J.drawPosition),O=p.matchUpStatus==="BYE"||!R&&p.drawPositions?.reduce((J,ie)=>k?.includes(ie)||J,!1);if(O)return{validActions:E,isByeMatchUp:O};Al({policyActions:v,action:Qj})&&E.push({type:Qj,payload:{matchUpId:l}});let x=!uR({matchUpStatus:p.matchUpStatus}),F=h?.scoring?.structures,_=f?.stage&&F?.stage?.[f.stage],V=f?.stageSequence&&_?.stageSequence?.[f.stageSequence],G=!(h?.scoring?.requireAllPositionsAssigned||_?.requireAllPositionsAssigned||V?.requireAllPositionsAssigned)||D,z=p.sides?.filter(J=>J?.participantId).length===2,Q=p.matchUpStatus&&[mn,ha].includes(p.matchUpStatus),j=xo({inContextDrawMatchUps:y,drawDefinition:e,matchUpId:l}),W=Py({inContextDrawMatchUps:y,drawDefinition:e,targetData:j}),Y=(I?.drawPositions?.length===2&&I.drawPositions.every(J=>N?.includes(J))&&I?.sides?.length===2&&I.sides.every(({participantId:J})=>J)||z)&&!(Q&&W),X={method:Bhe,type:WI,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(x&&E.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:Vj,type:xme}),Al({policyActions:v,action:WI})&&(w?.participant||!o&&S?.length)&&E.push(X),x&&Y&&E.push({type:_me}),G&&Y){let{matchUpId:J,matchUpFormat:ie}=p,ue={drawId:d,matchUpId:J,matchUpFormat:ie,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};E.push({info:"set outcome and winningSide",method:Vj,type:Ome,payload:ue}),Al({policyActions:v,action:jj})&&E.push({type:jj}),Al({policyActions:v,action:"END"})&&E.push({type:"END"})}if(R&&I){let J=aVe({specifiedPolicyDefinitions:n,inContextDrawMatchUps:y,matchUpParticipantIds:S,matchUpActionsPolicy:A,inContextMatchUp:I,policyActions:v,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l,matchUp:p,drawId:d,side:w});E.push(...J)}return{structureIsComplete:M,validActions:E,isDoubleExit:Q,...se}}function cVe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:s,drawPosition:o,structureId:l,structure:c,drawId:u,event:d}){if(n.includes(o)||r&&!e)return{};let{sourceStructureIds:p,targetStructureIds:f}=s.links?.reduce((g,v)=>{let b=v.source?.structureId,y=v.target?.structureId;return g.sourceStructureIds.includes(b)||g.sourceStructureIds.push(b),g.targetStructureIds.includes(y)||g.targetStructureIds.push(y),g},{sourceStructureIds:[],targetStructureIds:[]})||{},h=[],m=s.links?.filter(g=>g.target?.structureId===c.structureId)??[];for(let g of m){let v=g?.source?.structureId,{structure:b}=ui({structureId:v,drawDefinition:s}),y=b?.finishingPosition===Rw&&(p?.length!==1||f?.length!==1),I={};if(y){let{matchUps:T}=cr({drawDefinition:s,structure:c,event:d}),{initialRoundNumber:D}=jI({drawPosition:o,matchUps:T}),C=s.links?.find(E=>E.target?.structureId===c?.structureId&&E.target.roundNumber===D)?.source?.roundNumber;I.roundNumbers=[C]}let{completedMatchUps:w}=zF({structureId:v,inContext:!0,matchUpFilters:I,drawDefinition:s}),S=a.map(T=>T.participantId).filter(Boolean);w?.filter(({matchUpType:T,winningSide:D})=>D&&(d?.eventType!==ca||T===ca)).map(({winningSide:T,sides:D})=>T&&D?.[1-(T-1)]).map(ji).filter(T=>T&&!S.includes(T))?.forEach(T=>{h.includes(T)||h.push(T)})}let A=t?.filter(g=>h?.includes(g.participantId));return A?.forEach(g=>{let v=(s.entries??[]).find(b=>b.participantId===g.participantId);g.entryPosition=v?.entryPosition}),h?.length?{validLuckyLosersAction:{type:h5,method:tHe,availableLuckyLosers:A,availableLuckyLoserParticipantIds:h,willDisableLinks:i,payload:{drawId:u,structureId:l,drawPosition:o}}}:{}}function uVe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:c,seedingProfile:u,isByePosition:d,drawPosition:p,structureId:f,event:h}){let{drawId:m}=c,A=[],g,v,b=[],y=l?.[Wu]?.validSeedPositions?.ignore;if(y||({unplacedSeedParticipantIds:g,unplacedSeedAssignments:v,unfilledPositions:b}=ahe({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:c,seedingProfile:u,structureId:f})),b?.length||(b=s.filter(I=>!I.participantId&&!I.bye&&!I.qualifier).map(I=>I.drawPosition)),d||A.push({payload:{drawId:m,structureId:f,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:sHe,type:"BYE"}),a&&y){let I=s.map(C=>C.participantId).filter(Boolean),w={structureIds:t},{completedMatchUps:S}=VC({inContext:!0,matchUpFilters:w,drawDefinition:c}),T=Ci((S??[]).filter(({matchUpType:C})=>h?.eventType!==ca||C===ca)?.map(({sides:C})=>C?.map(ji)).flat().filter(C=>C&&!I.includes(C))),D=o?n?.filter(C=>T?.includes(C.participantId)).map(C=>St(C,void 0,!0)):void 0;return D?.forEach(C=>{let E=(c.entries??[]).find(P=>P.participantId===C.participantId);C.entryPosition=E?.entryPosition}),D?.length&&A.push(Ft({payload:{drawId:m,structureId:f,drawPosition:p},willDisableLinks:i,method:uee,type:qI,availableParticipantIds:T,participantsAvailable:D})),{validAssignmentActions:A}}if(b.includes(p)||d){let I;if(v?.length){let S=v.filter(T=>g?.includes(T.participantId));S.sort(dVe),I=S.map(T=>T.participantId)}else I=e;let w=o?n?.filter(S=>I.includes(S.participantId)).map(S=>St(S,void 0,!0)):void 0;w?.length&&A.push(Ft({payload:{drawId:m,structureId:f,drawPosition:p},willDisableLinks:i,method:uee,type:qI,availableParticipantIds:I,participantsAvailable:w}))}return{validAssignmentActions:A}}function dVe(t,e){return t.bye||CT(t.seedValue)<CT(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function pVe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:s,structureId:o,drawId:l}){let c=[],u=[],d=[],p=[],f=new Set(i.map(I=>I.participantId).filter(Boolean)),h=n?.[bh],m=!h?.disableRoundRestrictions&&t[s],A=h?.requireCompletedStructures,{sourceStructureIds:g,relevantLinks:v}=mP({targetRoundNumber:m,linkType:Ah,drawDefinition:a,structureId:o})||{};g?.length&&p.push(...g);let{sourceStructureIds:b,relevantLinks:y}=mP({targetRoundNumber:m,linkType:mh,drawDefinition:a,structureId:o})||{};b?.length&&p.push(...b);for(let I of v){let w=a.structures?.find(T=>T.structureId===I.source.structureId);if(w?.stage!==zt)continue;let S=Sh({structureId:I.source.structureId,drawDefinition:a});if(!A||S){let T=w.qualifyingRoundNumber,{matchUps:D}=cr({matchUpFilters:{roundNumbers:[T],isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:w});for(let C of D){let E=C.sides.find(R=>R?.sideNumber===C.winningSide),P=C.matchUpStatus==="BYE"&&C.sides?.find(({participantId:R})=>R);if(E||P){let{participantId:R,participant:M}=E||P||{};R&&!f.has(R)&&(M&&r&&c.push(M),u.push(R))}}}}for(let I of y){let w=a.structures?.find(T=>T.structureId===I.source.structureId);if(w?.stage!==zt)continue;let S=Sh({structureId:I.source.structureId,drawDefinition:a});if(!A||S){let{positionAssignments:T}=Ir({structure:w}),D=T?.map(C=>{let E=C.participantId,P=Bi({element:C,name:Om}).extension?.value;return P?{participantId:E,groupOrder:P?.groupOrder}:{}}).filter(({groupOrder:C,participantId:E})=>C===1&&!f.has(E)).map(({participantId:C})=>C)??[];if(D&&u.push(...D),r){let C=e.filter(({participantId:E})=>D.includes(E));c.push(...C)}}}return u.length&&d.push(Ft({qualifyingParticipants:r?c:void 0,method:Z$e,type:JF,qualifyingParticipantIds:u,payload:{qualifyingParticipantId:void 0,drawPosition:s,structureId:o,drawId:l}})),{validAssignmentActions:d,sourceStructureIds:p}}function fVe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:s,byeDrawPositions:o,drawDefinition:l,isByePosition:c,drawPosition:u,structureId:d,structure:p,drawId:f,event:h}){if(n.includes(u))return{};let m=C=>!t||C.participantId||C.qualifier||C.bye,A=r?.filter(C=>C!==u&&!(c&&o.includes(C))),g=a?.filter(C=>m(C)&&A?.includes(C.drawPosition))??[],v=g.map(({drawPosition:C})=>C),{matchUps:b}=cr({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:h}),y=b.filter(({drawPositions:C})=>Bo(C,v)),I=Object.assign({},...y.map(C=>C.sides?.filter(({sourceDrawPositionRange:E})=>E).map(({drawPosition:E,sourceDrawPositionRange:P})=>({[E]:P}))).flat()),w=g.map(C=>C.participantId).filter(Boolean),S=(i??[]).filter(C=>w.includes(C.participantId)),T=Object.assign({},...S.map(C=>({[C.participantId]:C}))),D=g.map(C=>{let E=T?.[C.participantId],P=I[C.drawPosition];return Ft({...C,participant:s?St(E,!1,!0):void 0,sourceDrawPositionRange:P})});return D.length?{validSwapAction:{payload:{drawId:f,structureId:d,drawPositions:[u]},willDisableLinks:e,method:Nhe,type:eL,availableAssignments:D}}:{}}function hVe(t,e){return t.filter(i=>!e.includes(i.participantId)).map(i=>i.participantId)}function mVe({validActions:t,policyActions:e,isActiveDrawPosition:i,positionAssignments:r,disablePlacementActions:n,positionAssignment:a,isByePosition:s,getValidAssignmentActions:o,positionSourceStructureIds:l,unassignedParticipantIds:c,possiblyDisablingAction:u,isWinRatioFedStructure:d,tournamentParticipants:p,returnParticipants:f,appliedPolicies:h,drawDefinition:m,drawPosition:A,structureId:g,event:v}){if(Al({policyActions:e,action:qI})&&!i&&r&&!n&&(!a||s)){let{validAssignmentActions:b}=o({positionSourceStructureIds:l,unassignedParticipantIds:c,possiblyDisablingAction:u,isWinRatioFedStructure:d,tournamentParticipants:p,positionAssignments:r,returnParticipants:f,appliedPolicies:h,drawDefinition:m,isByePosition:s,drawPosition:A,structureId:g,event:v});b?.forEach(y=>t.push(y))}}function AVe({validActions:t,policyActions:e,isActiveDrawPosition:i,getValidQualifiersAction:r,drawPositionInitialRounds:n,tournamentParticipants:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:c,drawPosition:u,structureId:d,drawId:p}){if(Al({policyActions:e,action:JF})&&!i){let{validAssignmentActions:f}=r({drawPositionInitialRounds:n,tournamentParticipants:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:c,drawPosition:u,structureId:d,drawId:p});f?.forEach(h=>t.push(h))}}function gVe({validActions:t,policyActions:e,isActiveDrawPosition:i,drawId:r,structureId:n,drawPosition:a,possiblyDisablingAction:s,isByePosition:o}){Al({policyActions:e,action:Fj})&&!i&&(t.push({type:Fj,method:cee,payload:{drawId:r,structureId:n,drawPosition:a},willDisableLinks:s}),o||t.push({type:f5,method:J$e,payload:{drawId:r,structureId:n,drawPosition:a},willDisableLinks:s}),Al({policyActions:e,action:"BYE"})&&!o&&t.push({type:"BYE",method:cee,payload:{drawId:r,structureId:n,drawPosition:a,replaceWithBye:!0},willDisableLinks:s}))}function vVe({validActions:t,policyActions:e,activePositionsCheck:i,activePositionOverrides:r,activeDrawPositions:n,drawDefinition:a,structureId:s,drawPosition:o,structure:l,isByePosition:c,participantId:u,participant:d,drawId:p}){let f=l.stage===zt||l.stage===Ut&&l.stageSequence===1;if(!c&&i({activePositionOverrides:r,activeDrawPositions:n,action:yI})&&Al({policyActions:e,action:yI})&&Gx({drawDefinition:a,structureId:s,drawPosition:o})&&f){let{seedAssignments:h}=pu({returnAllProxies:!0,drawDefinition:a,structure:l}),{seedNumber:m,seedValue:A}=h?.find(g=>g.participantId===u)??{};t.push({type:yI,method:oHe,participant:d,seedNumber:m,payload:{drawId:p,structureId:s,participantId:u,seedValue:A}})}if(!c&&i({activePositionOverrides:r,activeDrawPositions:n,action:i0})&&Al({policyActions:e,action:i0})&&Gx({drawDefinition:a,structureId:s,drawPosition:o})&&f){let{seedAssignments:h}=pu({returnAllProxies:!0,drawDefinition:a,structure:l}),{seedNumber:m}=h?.find(A=>A.participantId===u)??{};t.push({method:aHe,type:i0,participant:d,seedNumber:m,payload:{participantId:u,structureId:s,drawId:p}})}}function yVe({validActions:t,policyActions:e,isByePosition:i,participantId:r,participant:n,drawId:a}){if(!i&&r){if(Al({policyActions:e,action:WI})){let s={type:WI,method:Bhe,participant:n,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:a}};t.push(s)}if(Al({policyActions:e,action:AP})){let s={type:AP,method:nHe,participant:n,payload:{participantId:r,otherName:void 0}};t.push(s)}}}function bVe({validActions:t,policyActions:e,getValidSwapAction:i,possiblyDisablingAction:r,tournamentParticipants:n,inactiveDrawPositions:a,activeDrawPositions:s,positionAssignments:o,returnParticipants:l,byeDrawPositions:c,drawDefinition:u,isByePosition:d,drawPosition:p,structureId:f,structure:h,drawId:m}){if(Al({policyActions:e,action:eL})){let{validSwapAction:A}=i({possiblyDisablingAction:r,tournamentParticipants:n,inactiveDrawPositions:a,activeDrawPositions:s,positionAssignments:o,returnParticipants:l,byeDrawPositions:c,drawDefinition:u,isByePosition:d,drawPosition:p,structureId:f,structure:h,drawId:m});A&&t.push(A)}}function IVe({validActions:t,policyActions:e,getValidAlternatesAction:i,possiblyDisablingAction:r,tournamentParticipants:n,positionAssignments:a,activeDrawPositions:s,returnParticipants:o,appliedPolicies:l,drawDefinition:c,drawPosition:u,structureId:d,structure:p,drawId:f,event:h,disablePlacementActions:m}){if(Al({policyActions:e,action:p5})&&!m){let{validAlternatesAction:A}=i({possiblyDisablingAction:r,tournamentParticipants:n,positionAssignments:a,activeDrawPositions:s,returnParticipants:o,appliedPolicies:l,drawDefinition:c,drawPosition:u,validActions:t,structureId:d,structure:p,drawId:f,event:h});A&&t.push(A)}}function wVe({validActions:t,policyActions:e,getValidLuckyLosersAction:i,sourceStructuresComplete:r,possiblyDisablingAction:n,isWinRatioFedStructure:a,tournamentParticipants:s,activeDrawPositions:o,positionAssignments:l,drawDefinition:c,drawPosition:u,structureId:d,structure:p,drawId:f,disablePlacementActions:h,isActiveDrawPosition:m}){if(Al({policyActions:e,action:h5})&&!h&&!m&&l){let{validLuckyLosersAction:A}=i({sourceStructuresComplete:r,possiblyDisablingAction:n,isWinRatioFedStructure:a,tournamentParticipants:s,activeDrawPositions:o,positionAssignments:l,drawDefinition:c,drawPosition:u,structureId:d,structure:p,drawId:f});A&&t.push(A)}}function SVe({validActions:t,policyActions:e,getValidModifyAssignedPairAction:i,participant:r,tournamentParticipants:n,returnParticipants:a,drawPosition:s,drawId:o,event:l}){if(r?.participantType===Mi&&Al({policyActions:e,action:d5})){let{validModifyAssignedPairAction:c}=i({tournamentParticipants:n,returnParticipants:a,drawPosition:s,participant:r,drawId:o,event:l});c&&t.push(c)}}function k5(t){return UVe(t)}function UVe(t){let e=Gt(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:r=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:s,drawPosition:o,event:l}=t,c=t.tournamentParticipants??(a&&gn({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],u=ui({structureId:t.structureId,drawDefinition:s});if(u.error)return u;let d=u.containingStructure||u.structure;if(!d)return{error:nn};let p=d.structureId;if(u=GC({drawDefinition:s,structureId:p}),o===void 0&&!u.isAdHoc)return{error:EC};if(u.isAdHoc)return lL(t);if(u.error)return u;let{drawPositionInitialRounds:f,inactiveDrawPositions:h,activeDrawPositions:m,byeDrawPositions:A}=u,g=er({tournamentRecord:a,drawDefinition:s,structure:d,event:l}).appliedPolicies??{};Object.assign(g,i??{});let{actionsPolicy:v,enabledStructures:b,actionsDisabled:y}=Pme({actionType:Mk,appliedPolicies:g,drawDefinition:s,structure:d}),I=v?.activePositionOverrides||[],{sourceStructureIds:w}=mP({finishingPosition:wy,targetRoundNumber:1,linkType:mh,drawDefinition:s,structureId:p})||{},S;w?.length&&(S=w.every(X=>Sh({structureId:X,drawDefinition:s})));let T=w.length,D=w.length&&!S,{policyActions:C}=Rme({enabledStructures:b,drawDefinition:s,structure:d}),E=![zt,Ut].includes(d.stage)||d.stageSequence!==1,{drawId:P}=s,R=[],{assignedPositions:M,positionAssignments:N}=va({structure:d}),k=M?.find(X=>X.drawPosition===o),O=!!k;if(!N?.map(X=>X.drawPosition)?.includes(o))return{error:ww};let{stage:x,stageSequence:F}=d,_=[x];x===Os&&_.push(Ut),x===Ut&&_.push(Os);let V=Bw({entryStatuses:ob,provisionalPositioning:n,drawDefinition:s,stageSequence:F,structureId:p,stages:_}),G=cb({drawDefinition:s,stages:_}).assignedParticipantIds??[],z=hVe(V,G),Q=A.includes(o),j=m.includes(o);if(y)return{info:"Actions Disabled for structure",isActiveDrawPosition:j,isDrawPosition:!0,hasPositionAssigned:O,validActions:[],isByePosition:Q};mVe({validActions:R,policyActions:C,isActiveDrawPosition:j,positionAssignments:N,disablePlacementActions:D,positionAssignment:k,isByePosition:Q,getValidAssignmentActions:uVe,positionSourceStructureIds:w,unassignedParticipantIds:z,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:c,returnParticipants:r,appliedPolicies:g,drawDefinition:s,drawPosition:o,structureId:p,event:l}),AVe({validActions:R,policyActions:C,isActiveDrawPosition:j,getValidQualifiersAction:pVe,drawPositionInitialRounds:f,tournamentParticipants:c,positionAssignments:N,returnParticipants:r,appliedPolicies:g,drawDefinition:s,drawPosition:o,structureId:p,drawId:P});let{participantId:W}=k||{},Y=W&&c.find(X=>X.participantId===W);return k&&(gVe({validActions:R,policyActions:C,isActiveDrawPosition:j,drawId:P,structureId:p,drawPosition:o,possiblyDisablingAction:E,isByePosition:Q}),vVe({validActions:R,policyActions:C,activePositionsCheck:iVe,activePositionOverrides:I,activeDrawPositions:m,drawDefinition:s,structureId:p,drawPosition:o,structure:d,isByePosition:Q,participantId:W,participant:Y,drawId:P}),yVe({validActions:R,policyActions:C,isByePosition:Q,participantId:W,participant:Y,drawId:P}),bVe({validActions:R,policyActions:C,getValidSwapAction:fVe,possiblyDisablingAction:E,tournamentParticipants:c,inactiveDrawPositions:h,activeDrawPositions:m,positionAssignments:N,returnParticipants:r,byeDrawPositions:A,drawDefinition:s,isByePosition:Q,drawPosition:o,structureId:p,structure:d,drawId:P})),IVe({validActions:R,policyActions:C,getValidAlternatesAction:sVe,possiblyDisablingAction:E,tournamentParticipants:c,positionAssignments:N,activeDrawPositions:m,returnParticipants:r,appliedPolicies:g,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:P,event:l,disablePlacementActions:D}),wVe({validActions:R,policyActions:C,getValidLuckyLosersAction:cVe,sourceStructuresComplete:S,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:c,activeDrawPositions:m,positionAssignments:N,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:P,disablePlacementActions:D,isActiveDrawPosition:j}),SVe({validActions:R,policyActions:C,getValidModifyAssignedPairAction:tVe,participant:Y,tournamentParticipants:c,returnParticipants:r,drawPosition:o,drawId:P,event:l}),{isActiveDrawPosition:j,isDrawPosition:!0,hasPositionAssigned:O,isByePosition:Q,validActions:R,...se}}function DR({policyDefinitions:t,appliedPolicies:e,drawType:i}){let r=t?.[kx]?.drawTypeCoercion,n=e?.[kx]?.drawTypeCoercion;return(typeof r=="boolean"?r:void 0)??(i&&r?.[i])??(typeof n=="boolean"?n:void 0)??(i&&n?.[i])??!0}var x5=({drawDefinition:t})=>{let e=Gt({drawDefinition:t},[{[to]:!0}]);if(e.error)return e;let i=t.structures?.find(n=>n.stage===Ut&&n.stageSequence===1);if(!i)return le({result:{error:aq}});let{qualifierPositions:r}=va({structure:i});return gt(0,r.length).sort(()=>Math.random()-.5)};function _5({structureId:t,drawDefinition:e}){if(!e)return{error:Bt};if(!Lr(t))return{error:be};let i=HC({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!Pn([Iy,Xu,vF,by],r).length;return{...se,valid:n}}function Lme({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:be};let i=CC(t);return i?{drawSize:i}:le({result:{error:be},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function PR(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:s,event:o}=t||{},l="getSeedsCount",c=t?.participantsCount??t?.participantCount;if(!i){let h=uA({tournamentRecord:a,drawDefinition:s,event:o});if(h.error)return le({result:h,stack:l});i=h.policyDefinitions}let u=yi(c);if(c&&!u)return le({result:{error:be},context:{participantsCount:c},stack:l});if(n&&!u)return le({result:{error:Que},stack:l});if(Number.isNaN(Number(r)))if(c)({drawSize:r}=Lme({participantsCount:c}));else return le({result:{error:M1},stack:l});let d=n&&c||r;if(d&&d>r)return{error:hq};let p=i?.[Wu];if(!p)return{error:Rue};let f=p.seedsCountThresholds;return f?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:f.filter(h=>e?h.drawSize<=r:r===h.drawSize).reduce((h,m)=>c&&c>=m.minimumParticipantCount?m.seedsCount:h,0)}):{error:hue}}function cL({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:s,event:o}){if((!s||!n)&&i&&({participants:s,participantMap:n}=gn({tournamentRecord:i})),!s)return{error:k1};if(!Array.isArray(s))return{error:be};if(!o)return{error:Vr};let l=e?.[Xa]??r?.[Xa]??jC[Xa],c=(a??l?.participants?.enforceGender)!==!1,{eventType:u,gender:d}=o,p=u===Bm,f=u===jl&&gr||p&&Mi||zi,h=Object.assign({},...(t??o.entries??[]).map(g=>({[g.participantId]:g.entryStatus}))),m=Object.keys(h),A=s.filter(g=>m.includes(g.participantId)).filter(g=>{let v=TVe({participant:g,participantType:f,eventType:u,entryStatusMap:h}),b=CVe({genderEnforced:c,participantMap:n,eventGender:d,participant:g,isDoubles:p,mismatch:v});return v||!b});if(A.length){let g=A.map(v=>v.participantId);return{error:Sue,invalidParticipantIds:g}}return{...se,valid:!0}}function TVe({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[Bm,jl].includes(i)&&t.participantType===zi&&(Gv(n)||n===Ih);return t.participantType!==e&&!a}function CVe(t){let{participant:e,participantMap:i,eventGender:r,mismatch:n,isDoubles:a,genderEnforced:s}=t,o=!n&&a&&Ci(e?.individualParticipantIds?.map(d=>i?.[d]?.participant?.person?.sex).filter(Boolean)??[])||[],l=!r||!o?.length||fh(r)||rf(r)&&Ws(o[0])===Ws(r)||Uc(r)&&(o.length===1&&e.individualParticipantIds?.length===1||o.length===2),c=e?.person?.sex,u=!e?.person||!r||Uc(r)||fh(r)||rf(r)&&Ws(c)===Ws(r);return!s||l&&u}function $me({hasExistingDrawDefinition:t,qualifyingProfiles:e,appliedPolicies:i,qualifyingOnly:r,tieFormat:n,idPrefix:a,isMock:s,uuids:o}){let l="generateQualifyingSTructures",c=[],u=[],d=[],p=(v,b)=>v.stageSequence-b.stageSequence,f=(v,b)=>v.roundTarget-b.roundTarget,h=0,m=0,A,g=1;for(let v of e.sort(f)){let b=v.structureProfiles||[];g=v.roundTarget||g;let y=1,I=0,w,S,T;for(let D of(b||[]).sort(p)){let C=Xz(D.drawSize||D.participantsCount),{qualifyingRoundNumber:E,structureOptions:P,matchUpFormat:R,structureName:M,structureId:N,drawType:k}=D,O=D.matchUpType,x=D.qualifyingPositions||EVe({drawSize:C,qualifyingRoundNumber:E}),F,_,V;if(!yi(C))return le({result:{error:M1},stack:l});let G=e.length>1?`${g}-`:"",z=b.length>1||G?y:"",Q=M||(G||z?`${Bs(zt)} ${G}${z}`:Bs(zt));if(k===gd){let{structures:j,groupCount:W,maxRoundNumber:Y}=mR({structureName:D.structureName||Q,structureId:N||o?.pop(),hasExistingDrawDefinition:t,stage:zt,structureOptions:P,appliedPolicies:i,qualifyingOnly:r,stageSequence:y,matchUpType:O,roundTarget:g,tieFormat:n,drawSize:C,idPrefix:a,isMock:s,uuids:o});I=W,F=Y,_=j[0],A=[1]}else({drawSize:C,matchUps:V,roundLimit:F}=cf({qualifyingRoundNumber:E,qualifyingPositions:x,matchUpType:O,drawSize:C,idPrefix:a,isMock:s,uuids:o})),_=iu({structureName:D.structureName||Q,structureId:N||o?.pop(),qualifyingRoundNumber:F,hasExistingDrawDefinition:t,stage:zt,qualifyingOnly:r,matchUpFormat:R,stageSequence:y,matchUpType:O,roundLimit:F,tieFormat:n,matchUps:V}),g&&lr({extension:{name:Ef,value:g},element:_}),I=V?.filter(j=>j.roundNumber===F)?.length||0;if(y>1){let{link:j}=yR({sourceStructureId:S,sourceRoundNumber:w,targetStructureId:_.structureId,finishingPositions:T===mh?[1]:void 0,linkType:T});d.push(j),h+=(C||0)-I}else h+=C||0;T=k===gd?mh:Ah,S=_.structureId,w=F,n&&(V=cr({structure:_})?.matchUps||[],V?.forEach(j=>{let{tieMatchUps:W}=jw({tieFormat:n,matchUp:j,isMock:s});Object.assign(j,{tieMatchUps:W,matchUpType:O})})),u.push(_),y+=1}m+=I,c.push({qualifiersCount:I,finalQualifyingRoundNumber:w,finalQualifyingStructureId:S,finishingPositions:A,roundTarget:g,linkType:T}),g+=1}return{qualifiersCount:m,qualifyingDrawPositionsCount:h,qualifyingDetails:c,structures:u,...se,links:d}}function EVe({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function Hme(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=ri(t.drawSize),n=e&&t.drawType!==zl&&(typeof e=="boolean"||e<=2)&&r===2&&jp||t.drawType||jp,a=Dpe.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=jp;else if(r<4&&i)return{...le({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:ZO},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function DVe(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:Bs(Ut),...t,stage:Ut},{structures:a,groupCount:s}=mR(n);if(s<1)return{error:lde};let o=i?.playoffGroups||[{finishingPositions:[1],structureName:Bs(Tn)}],[l]=a,{structures:c,links:u}=Qhe({sourceStructureId:l.structureId,requireSequential:r,drawDefinition:e,playoffGroups:o,groupCount:s,...t});return c&&a.push(...c),{...se,structures:a,links:u}}function PVe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),n=t.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),a=e.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),s=r.map((c,u)=>{let d=r.indexOf(c)%2?Xu:Iy,p=1+u;return{linkType:gh,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:c,structureId:e.structureId}}}),o={linkType:Ah,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Xu,roundNumber:n,structureId:t.structureId}},l=[{linkType:Ah,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Xu,roundNumber:1,structureId:i.structureId}},{linkType:gh,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Xu,roundNumber:1,structureId:i.structureId}}];return[...s,o,...l]}function RVe({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let s=[],{matchUps:o}=Ag({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=ag({structureName:t||Bs(Ut),structureId:a?.pop(),stageSequence:1,stage:Ut,matchUpType:e,matchUps:o});s.push(l);let c=r/2,{matchUps:u}=Ag({finishingPositionOffset:c,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=ag({structureName:Bs(Epe),matchUps:u,structureId:a?.pop(),stage:Os,stageSequence:2,matchUpType:e});s.push(d);let{matchUps:p}=cf({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),f=ag({structureName:Bs(Cpe),matchUps:p,structureId:a?.pop(),stageSequence:3,stage:Tn,matchUpType:e});s.push(f);let h=PVe({mainStructure:l,consolationStructure:d,deciderStructure:f});return{structures:s,links:h,...se}}function MVe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:s,isMock:o,uuids:l}=t;if(!yi(s)||s<2)return{matchUps:[],roundsCount:0};if(rp(s))return cf(t);let c=NVe(s),u=c.shift(),d=gt(1,(u?.participantsCount||0)+1).map(A=>({drawPosition:A})),p=[],f=1;({matchUps:p}=jx({roundNumber:f,matchUpType:n,idPrefix:a,matchUps:p,isMock:o,nodes:d,uuids:l})),f++;let h=t.roundLimit||e;for(let A of c){let g=A.participantsCount/2,v=gt(1,g+1);r&&g===r&&(h=f-1);let b=v.map(y=>{let I=m5({roundPosition:y,roundNumber:f,idPrefix:a,uuids:l});return{roundPosition:y,roundNumber:f,matchUpId:I}});p.push(...b),f++}let m=f-1;return p=cR({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:h,matchUps:p}),h&&(p=p.filter(A=>A.roundNumber<=h)),{matchUps:p,roundsCount:m,roundLimit:h}}function NVe(t){let e=ri(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),s=a===1,o=!!(!s&&a%2);i=!s&&o?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:o})}return n}function Vme(t){let{playoffAttributes:e,stageSequence:i=1,stage:r=Ut,tieFormat:n,matchUpType:a,drawSize:s,uuids:o}=t,l=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,c=t.structureId||l()||o?.pop(),u=t.appliedPolicies??er(t),d=t.policyDefinitions?.[wT]||u?.[wT];t.skipRounds=t.skipRounds||s<=4&&(d?.feedFromMainFinal?0:1)||0;let p=t.structureName??e?.["0"]?.name??Bs(Ut),f=()=>{let{matchUps:h}=cf(t);return{structures:[iu({stageSequence:i,structureName:p,matchUpType:a,structureId:c,tieFormat:n,matchUps:h,stage:r})],links:[],...se}};return{generators:{[zl]:()=>({structures:[iu({finishingPosition:wy,stageSequence:i,structureName:p,matchUps:[],matchUpType:a,structureId:c,stage:r})],links:[],...se}),[ib]:()=>{let{matchUps:h}=MVe(t);return{structures:[iu({stageSequence:i,structureName:p,matchUpType:a,structureId:c,matchUps:h,stage:r})],links:[],...se}},[jp]:()=>f(),[H1]:()=>RVe(t),[vT]:()=>ZU({...t,roundOffsetLimit:3,playoffAttributes:e??Vq}),[yT]:()=>ZU({...t,roundOffsetLimit:2,playoffAttributes:e??Gq}),[Tn]:()=>ZU(t),[BC]:()=>{let{matchUps:h}=Ag({drawSize:s,uuids:o,matchUpType:a});return{structures:[iu({stageSequence:i,structureName:p,matchUpType:a,structureId:c,stage:Ut,tieFormat:n,matchUps:h})],links:[],...se}},[V1]:()=>Hhe(t),[bT]:()=>Yb({...t,feedRounds:1,fmlc:!0}),[Tpe]:()=>Yb({...t,feedRounds:1}),[Lq]:()=>Yb({...t,feedsFromFinal:1}),[$q]:()=>Yb({...t,feedsFromFinal:2}),[Hq]:()=>Yb({...t,feedsFromFinal:3}),[G1]:()=>Yb(t),[yF]:()=>Ghe(t),[gd]:()=>mR(t),[vh]:()=>DVe(t)}}}function O5(t){let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:r,qualifyingOnly:n,staggeredEntry:a,drawDefinition:s,tieFormat:o,isMock:l,uuids:c}=t||{},u=ri(t.drawSize),d=t.drawTypeCoercion??DR({appliedPolicies:r,drawType:t.drawType}),p="generateDrawStructuresAndLinks",f=Hme({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:d,drawSize:u});if(f.error)return f;let h=f.drawType,m=[],A=[],g=t?.matchUpType??Er,v=s?.structures?.filter(({stage:z})=>z===zt);v&&m.push(...v);let b=v?.map(({structureId:z})=>z),y=s?.structures?.find(({stage:z,stageSequence:Q})=>z===Ut&&Q===1),I=s?.links?.filter(z=>z.target.structureId===y?.structureId&&b?.includes(z.source.structureId)),w=(z,Q)=>{if(z.linkType===mh&&Q?.structures){let j=z.source.finishingPositions||[];return Q.structures.length*j.length}else if(z.linkType===Ah&&Q?.matchUps?.length){let j=z.source.roundNumber;return Q.matchUps.filter(({roundNumber:W})=>W===j).length}},S=v?.map(z=>{let Q=I?.find(J=>J.target.structureId===z.structureId),j=Ir({structure:z})?.positionAssignments?.length??0;if(!Q)return j;let W=Q?.source.structureId,Y=s.structures?.find(J=>J.structureId===W),X=w(Q,Y)||0;return j-X}).filter(Boolean).reduce((z,Q)=>z+Q,0),T=I?.map(z=>{let Q=z.source.structureId,j=v?.find(W=>W.structureId===Q);return w(z,j)}).filter(Boolean).reduce((z,Q)=>z+Q,0),D=!!(y&&!y?.matchUps?.length);if(v?.length&&!D)return{error:vj};let C=!v?.length&&t.qualifyingProfiles,E=C?.length&&$me({idPrefix:t.idPrefix,qualifyingProfiles:C,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,isMock:l,uuids:c});if(E?.error)return E;let{qualifyingDrawPositionsCount:P,qualifyingDetails:R,qualifiersCount:M}=E||{qualifyingDrawPositionsCount:S,qualifiersCount:T};P&&(E?.structures&&m.push(...E.structures),E?.links&&A.push(...E.links)),Object.assign(t,Ft({drawSize:u,matchUpType:g,tieFormat:o}));let N=h!==zl&&(!u||u<2||!a&&![BC,ib].includes(h)&&([vh,gd].includes(h)&&u<3||![gd,vh].includes(h)&&!rp(u)));if(N&&!P)return le({context:{drawSize:u,invalidDrawSize:N},result:{error:ZO},stack:p});let{generators:k,error:O}=Vme(t);if(O)return{error:O};let x=k[h];if(!x)return{error:tq};let F=x?.();if(F.error)return F;let{structures:_,links:V}=F;if(_?.length){let z=_.find(({stage:Q,stageSequence:j})=>Q===Ut&&j===1);if(y&&z){if(D){let Q=z.structureId;if(z.structureId=y.structureId,V?.length)for(let j of V)j.source.structureId===Q&&(j.source.structureId=y.structureId),j.target.structureId===Q&&(j.target.structureId=y.structureId)}else if(!i)return{error:vj}}m.push(..._)}m.sort(Nw),V?.length&&A.push(...V);let G=F.structures.find(({stage:z,stageSequence:Q})=>z===Ut&&Q===1);for(let z of R||[]){let{finalQualifyingRoundNumber:Q,finalQualifyingStructureId:j,roundTarget:W,finishingPositions:Y,linkType:X}=z,J=G&&yR({targetStructureId:G.structureId,sourceStructureId:j,sourceRoundNumber:Q,finishingPositions:Y,targetEntryRound:W,linkType:X})?.link;if(J?.error)return J;J&&A.push(J)}return I&&A.push(...I),{...se,qualifyingResult:{qualifyingDrawPositionsCount:P,qualifiersCount:M},structures:m,links:A}}function F5(t){let{modifyOriginal:e=!0,stageSequence:i=1,isMock:r}=t||{},n="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return le({result:{error:Bt},stack:n});let a=e?t.drawDefinition:St(t.drawDefinition,!1,!0),{tieFormat:s,matchUpType:o}=t;if(s){let b=Ko({tieFormat:s});if(b.error)return b}s=Ss(s??uo({drawDefinition:a})?.tieFormat),o=o??(a.matchUpType||Er),t.tieFormat=s,t.matchUpType=o;let l=Vx({drawDefinition:a,stage:Ut});t.drawSize=t.drawSize??l,!l&&t.drawSize&&Qx({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:Ut});let c=ss({drawDefinition:a}).drawMatchUps.map(xa),u=O5(t);if(u.error)return le({result:u,stack:n});let{structures:d,links:p,qualifyingResult:f}=u;a.structures=d,a.links=p;let h=Math.max(t.qualifiersCount??0,f?.qualifiersCount||0);if(f?.qualifyingDrawPositionsCount&&!Vx({stage:zt,drawDefinition:a})){let b=Qx({drawSize:f.qualifyingDrawPositionsCount,stage:zt,drawDefinition:a});if(b.error)return b}if(h){let b=Phe({qualifiersCount:h,drawDefinition:a,stage:Ut});if(b.error)return b}let m=t.drawSize??l;Object.assign(t,Ft({drawSize:m,matchUpType:o,tieFormat:s}));let{matchUps:A,matchUpsMap:g}=ea({drawDefinition:a});s&&A?.forEach(b=>{if(!c.includes(b.matchUpId)){let{tieMatchUps:y}=jw({tieFormat:s,matchUp:b,isMock:r});Object.assign(b,{tieMatchUps:y,matchUpType:o})}});let{inContextDrawMatchUps:v}=Cy({drawDefinition:a,matchUpsMap:g});return Br({tournamentId:t.tournamentRecord?.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:v,drawDefinition:a,matchUpsMap:g,...se,structures:d,matchUps:A,links:p}}function RR(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,s;if(!Qme({scaleItem:n}))return{error:LI};if(r&&Array.isArray(i.participants)&&(s=i.participants.find(o=>o.participantId===r),s)){if(s.participantType===zo&&n?.eventType!==jl)return{error:LI};let o=jme({removePriorValues:e,participant:s,scaleItem:n});if(o.error)return o;a=!o.valueChanged;let{topics:l}=kc();l.includes(Fs)&&bi({topic:Fs,payload:{tournamentId:i.tournamentId,participants:[s]}})}return a&&{...se,info:Sq,existingValue:n?.scaleValue}||s&&{...se,newValue:n?.scaleValue}||{error:On}}function Gme(t){let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:r,auditData:n,context:a}=t;if(!r)return{error:rt};if(!r.participants)return{error:k1};let s=0,o={},l=[];for(let d of e){let p=d?.participantId;if(Array.isArray(d?.scaleItems))for(let f of d.scaleItems)if(Qme({scaleItem:f}))Array.isArray(o[p])||(o[p]=[]),o[p].push(f);else return{error:LI}}for(let d of r.participants){let{participantId:p}=d||{};if(Array.isArray(o[p]))for(let f of o[p]){if(d.participantType===zo&&f?.eventType!==jl)return le({context:{participantId:p,scaleItem:f,participantType:d.participantType},info:"Invalid participantType for eventType",result:{error:LI}});jme({participant:d,scaleItem:f,removePriorValues:i}),l.push(d),s++}}let c=s?void 0:MC,{topics:u}=kc();if(u.includes(Fs)&&s&&bi({topic:Fs,payload:{tournamentId:r.tournamentId,participants:l}}),a){let{eventId:d,drawId:p,...f}=a,h=f.scaleAttributes?.scaleType&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){let m={itemType:hW,itemValue:f};if(h&&(m.itemSubTypes=h),p||d){let{drawDefinition:A,event:g}=Xo({tournamentRecord:r,eventId:d,drawId:p});p&&u5({drawDefinition:A,timeItem:m}),d&&zw({event:g,timeItem:m})}else TR({tournamentRecord:r,timeItem:m})}}return n&&u.includes(wm)&&bi({topic:wm,payload:n}),Ft({...se,modificationsApplied:s,info:c})}function Qme({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e?.includes(r)).length===i.length}function jme({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:Tw};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(c=>r.includes(c)&&i[c]).length!==n.length)return{error:LI};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:s}=rh({scaleAttributes:i,participant:e}),o=c=>[void 0,null,""].includes(c),l=!(o(s?.scaleValue)&&o(i.scaleValue))&&JSON.stringify(s?.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:c,eventType:u,scaleName:d}=i,p=[Sy,c,u,d].join("."),f=Ft({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(f.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(h=>h.itemType!==p)),e.timeItems.push(f)}return{...se,valueChanged:l,newValue:i.scaleValue}}function L5(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=Gt(t,[{[Sa]:!0},{modifiedScaleValues:!0,[il]:pl}]);if(n.error)return n;for(let a in i){let s=RR({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(s.error)return s}return{...se}}var BVe=(t=0)=>250/Math.pow(t+5,.4),kVe=()=>1;function xVe(t=3,e=2){let i=t/e;return Number.isNaN(i)?yU.kDefault():i}var yU={nSpread:400,diffThreshold:.125,kCalc:BVe,kMultiplier:xVe,kDefault:kVe};function zme(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=za,winnerCountables:n=1,loserCountables:a=0,ratingType:s="ELO",maxCountables:o,countables:l}=t||{},c=r?.[s];if(!c)return{error:Kt};let u=c.range||t.ratingRange;e=e||c.defaultInitialization,i=i||c.defaultInitialization;let d=u[0]>u[1],p=c.decimalsCount||0,f=d?u.slice().reverse():u,h=(k,O)=>Number.parseFloat(O)>=Math.min(...k)&&Number.parseFloat(O)<=Math.max(...k);(!h(u,e)||!h(u,i))&&(h(u,e)||(e=c.defaultInitialization),h(u,i)||(i=c.defaultInitialization));let m=_U({targetRange:za.ELO.range,sourceRange:f,value:d?u[0]-e:e}),A=_U({targetRange:za.ELO.range,sourceRange:f,value:d?u[0]-i:i}),g=(k,O)=>1/(1+Math.pow(10,(O-k)/yU.nSpread)),v=g(m,A),b=g(A,m),y=yU.kCalc(n),I=yU.kCalc(a),w=yU.kMultiplier(o,l),S=m+w*y*(1-v),T=A+w*I*(0-b),D=_U({sourceRange:za.ELO.range,value:S,targetRange:f}),C=_U({sourceRange:za.ELO.range,value:T,targetRange:f}),E=d?u[0]-D:D,P=Number.parseFloat(E.toFixed(p)),R=d?u[0]-C:C,M=Number.parseFloat(R.toFixed(p)),N=Math.max(...u)?Math.abs(e-i)/Math.max(...u):0;return(D>C&&N>yU.diffThreshold||P<0||M<0)&&(P=e,M=i),{newWinnerRating:P,newLoserRating:M}}var _Ve=t=>t?.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0])||[0,0];function qme(t){let e=Gt(t,[{[Sa]:!0},{matchUpIds:!0,[il]:zs,[id]:Sw},{ratingType:!1,[Es]:v=>za[v]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:r=!0,tournamentRecord:n,ratingType:a="ELO",refreshDynamic:s,considerGames:o,drawDefinition:l,matchUpIds:c,asDynamic:u}=t,d=za[a],{accessor:p}=d,f={},h=(t.matchUps||s&&Do({drawDefinition:l,tournamentRecord:n,inContext:!0,matchUpFilters:{matchUpStatuses:qn}}).matchUps||La({matchUpFilters:{matchUpIds:c,matchUpStatuses:qn},tournamentRecord:n,inContext:!0}).matchUps)??[],m=`${a}.${Zq}`,A=u?m:a;h.sort(Lw);for(let v of h){let{endDate:b,matchUpFormat:y,score:I,sides:w,winningSide:S}=v,T=v.matchUpType,D={eventType:T,scaleName:a,scaleType:rg},C={scaleName:m,eventType:T,scaleType:rg},E=Object.assign({},...(w??[]).map(_=>{let{sideNumber:V,participant:G}=_;return V&&{[V]:[G?.participantId,...G?.individualParticipantIds??[]].filter(Boolean).flat()}})),P=Object.assign({},...Object.values(E).flat().map(_=>{let V=f[_],G=!s||V?zI({scaleAttributes:C,tournamentRecord:n,participantId:_}).scaleItem:void 0,z=zI({tournamentRecord:n,scaleAttributes:D,participantId:_}).scaleItem,Q=p?{[p]:void 0}:void 0;return _&&{[_]:G??z??{scaleName:A,eventType:T,scaleDate:b,scaleType:rg,scaleValue:Q}}})),R=y?vs(y):{},M=R?.bestOf||1,N=R?.setsTo||1,k=o?M&N:M,O=I?.sets&&_Ve(I.sets)||S===1&&[1,0]||[0,1],x=S?E[S]:[],F=S?E[3-S]:[];for(let _ of x){let V=P[_]?.scaleValue,G=typeof V=="object"?V[p]:V;for(let z of F){let Q=P[z]?.scaleValue,j=typeof Q=="object"?Q[p]:Q,W=S?O[S]:[0,0],Y=S?O[3-S]:[0,0],{newWinnerRating:X,newLoserRating:J}=zme({winnerCountables:W,loserCountables:Y,maxCountables:k,winnerRating:G,loserRating:j,ratingType:a}),ie=p?{...V,[p]:X}:X,ue=p?{...Q,[p]:J}:J;P[_].scaleValue=ie,P[z].scaleValue=ue,P[_].scaleName=A,P[z].scaleName=A}}Object.assign(f,P),i&&L5({tournamentRecord:n,modifiedScaleValues:f,removePriorValues:r})}let g=h.map(({matchUpId:v})=>v);return{...se,modifiedScaleValues:f,outputScaleName:A,processedMatchUpIds:g}}function uL(t){let{matchUpIds:e=[],drawDefinition:i,roundNumber:r,newRound:n,isMock:a,event:s}=t;if(typeof i!="object")return{error:Bt};let{participantIdPairings:o,matchUpsCount:l}=t,c=sL(t);if(c.error)return le({result:c});let{lastRoundNumber:u,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=c;if(!l)n?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return le({result:{error:be,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(o&&!Array.isArray(o)||l&&!yi(l)||e&&!Array.isArray(e)||!o&&!l)return{error:be,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:be,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(u||0))return{error:be,info:"roundNumber error"};let f=r??(n&&(u??0)+1||u||1);o=o??gt(0,l).map(()=>({participantIds:[void 0,void 0]}));let h=A=>{if(!t.idPrefix)return;let g=i.drawId,v=t.idPrefix??"ah";return`${g}-${v}-${f}-${A}`},m=o?.map((A,g)=>{let v=A?.participantIds??[void 0,void 0];v.push(void 0,void 0);let b=v.slice(0,2).map((I,w)=>Ft({sideNumber:w+1,participantId:I})),y=e[g]??h(g)??fr();return{roundNumber:f,matchUpStatus:Rn,matchUpId:y,sides:b}});if(m?.length){let A=uo({drawDefinition:i,event:s})?.tieFormat;A&&m.forEach(g=>{let{tieMatchUps:v}=jw({tieFormat:A,matchUp:g,isMock:a});Object.assign(g,{tieMatchUps:v,matchUpType:$r})})}return{roundNumber:f,matchUpsCount:m?.length??0,matchUps:m,...se}}function OVe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(v=>({[v.pairing]:v.value}))),s=Object.keys(i),o=[],l=yee({actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),c=[wV(l)];o.push(l);let u=l.value,d=l,p=1,f=0,h=s.length,m;do h-=1,m=s.length*i[s[0]].length;while(m>t&&h>5);let A=[];s.forEach(v=>{i[v].slice(0,h).forEach(b=>{f+=1;let y=bI(v,b.opponent);if(!A.includes(y)){let I=yee({stipulated:[[v,b.opponent]],actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!c.includes(wV(I))){c.push(wV(I)),o.push(I);let{maxDelta:w,value:S}=I;w<d.maxDelta&&(d=I),(S<u||S===u&&Math.round(Math.random()))&&(u=S),A.push(y),p+=1}}}),o=o.filter(b=>Math.abs(b.value-u)<5)}),o.sort((v,b)=>v.maxDiff-b.maxDiff);let g=xl(o);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:f,candidate:g}}function wV(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function yee({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let s=e.flat(),o=[],l=0;e.filter(Boolean).forEach(d=>{let[p,f]=d,h=bI(p,f),m=i[h];o.push({participantIds:d,value:m}),l+=i[h]}),Oa(t,a).flatMap(d=>To(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((f,h)=>s.includes(h)||f,!1)){s.push(...p);let f=d.value;l+=f,o.push({participantIds:p,value:f})}}),o.sort((d,p)=>d.value-p.value);let c=o.reduce((d,p)=>{let[f,h]=p.participantIds,m=bI(f,h),A=r[m];return Math.max(A,d)},0),u=o.reduce((d,p)=>{let[f,h]=p.participantIds,m=bI(f,h),A=n[m];return Math.max(A,d)},0);return{value:l,participantIdPairings:o,maxDelta:c,maxDiff:u}}function bI(t,e){return[t,e].sort(qF).join("|")}function Wme({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let s=bI(a,n);i.includes(s)||i.push(s)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function FVe({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(ji);if(r.length===2){let[n,a]=r,s=bI(n,a);e.includes(s)||e.push(s)}}return{encounters:e}}function LVe({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(s=>r(n,s));i[n]=a.sort((s,o)=>s.value-o.value)}function r(n,a){let s=bI(n,a);return{opponent:a,value:e[s]}}return{pairingValues:i}}var $Ve=0;function HVe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){let a=za[r]?.defaultInitialization??$Ve;return n.split("|").map(s=>{if(i===uu){let o=t?.find(l=>l.participantId===s)?.individualParticipantIds;return o?o?.map(l=>e[l]||a):a*2}else return e[s]||a})}function VVe(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:s,deltaObjects:o,valueObjects:l,eventType:c,scaleName:u,salted:d}=t;n.forEach(b=>{let y=HVe({tournamentParticipants:e,adHocRatings:i,scaleName:u,eventType:c,pairing:b}),I=typeof d=="number"&&d||.5,w=d&&(Math.round(Math.random())?I:I*-1)||0,S=Math.abs(y[0]-y[1])+w,T=Math.abs(y[0]-y[1]);o[b]=T,l[b]||(l[b]=0),l[b]+=S?Math.pow(S,2):0});let p=n.map(b=>({pairing:b,value:l[b]})).sort((b,y)=>b.value-y.value),{pairingValues:f}=LVe({possiblePairings:r,valueObjects:l}),{candidate:h,candidatesCount:m,deltaCandidate:A,iterations:g}=OVe({valueSortedPairings:p,maxIterations:a,pairingValues:f,deltaObjects:o,valueObjects:l}),{participantIdPairings:v}=s?A:h;return{participantIdPairings:v,candidatesCount:m,deltaCandidate:A,iterations:g,candidate:h}}var GVe=100,QVe=100,jVe=4e3;function $5(t){let{encounterValue:e=GVe,sameTeamValue:i=QVe,maxIterations:r=jVe,updateParticipantRatings:n,generateMatchUps:a=!0,ignoreLastRoundNumber:s,iterationMatchUps:o,tournamentRecord:l,dynamicRatings:c,refreshDynamic:u,participantIds:d,drawDefinition:p,roundNumber:f,structureId:h,matchUpIds:m,eventType:A,scaleName:g,idPrefix:v,isMock:b,salted:y,event:I}=t;if(!p)return{error:Bt};if(!t.structure&&!h)return{error:nn};let w=t.structure||ui({drawDefinition:p,structureId:h}).structure;if(!Ki(w))return{error:Jy};if(!d?.length)return{error:Lg};let S=[...o??[],...w?.matchUps??[]],{encounters:T}=FVe({matchUps:S}),D=l?.participants??[],C={};if(c){let W=Ci(w?.matchUps?w.matchUps.map(({roundNumber:X})=>X):[]),Y=Math.max(...W,0);if(Y){let X=w?.matchUps?.filter(({roundNumber:ie})=>ie===Y).map(({matchUpId:ie})=>ie),J=qme({ratingType:g??I?.category?.ratingType,updateParticipantRatings:n,tournamentRecord:l,asDynamic:!0,refreshDynamic:u,drawDefinition:p,matchUpIds:X});if(J.error)return J;J.modifiedScaleValues&&(C=J.modifiedScaleValues)}}let{valueObjects:E}=zVe({tournamentParticipants:D,encounterValue:e,sameTeamValue:i,encounters:T}),{uniquePairings:P,possiblePairings:R,deltaObjects:M}=Wme({participantIds:d}),N=Object.values(C).length?C:t.adHocRatings,k={tournamentParticipants:D,possiblePairings:R,uniquePairings:P,maxIterations:r,adHocRatings:N,deltaObjects:M,valueObjects:E,eventType:A,scaleName:g,salted:y},{candidatesCount:O,participantIdPairings:x,deltaCandidate:F,iterations:_,candidate:V}=VVe(k);if(!O)return{error:sF};let G,z;if(a){let W=uL({structureId:w?.structureId,ignoreLastRoundNumber:s,participantIdPairings:x,newRound:!0,drawDefinition:p,roundNumber:f,matchUpIds:m,idPrefix:v,isMock:b,event:I});if(W.error)return W;G=W.roundNumber,z=W.matchUps}let{maxDelta:Q,maxDiff:j}=V;return{roundNumber:G,participantIdPairings:x,modifiedScaleValues:C,candidatesCount:O,deltaCandidate:F,...se,iterations:_,matchUps:z,maxDelta:Q,maxDiff:j}}function zVe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let s of t)n[s]||(n[s]=0),n[s]+=i;let a=e?.filter(({participantType:s})=>s===gr);if(a)for(let s of a){let o=s.individualParticipantIds??[],{uniquePairings:l}=Wme({participantIds:o});for(let c of l)n[c]||(n[c]=0),n[c]+=r}return{valueObjects:n}}function Kme(t){let{drawType:e=jp,attachConsolation:i=!0,applyPositioning:r=!0,tournamentRecord:n,staggeredEntry:a,automated:s,placeByes:o,isMock:l,event:c}=t,u=t?.drawDefinition;if(!u)return{error:Bt};let d=Ya,p=Bw({stageSequence:1,drawDefinition:u,stage:d}),f=[gd,H1,vh].includes(e)?p.length:CC(p.length);if(!a&&e===BC&&p.length<2||e===gd&&p.length<3)return{error:ZO};let{tieFormat:h,matchUpType:m}=t;if(h){let E=Ko({tieFormat:h});if(E.error)return E}h=Ss(h??uo({drawDefinition:u})?.tieFormat),m=m??u.matchUpType;let{structures:A}=yd({stageSequence:1,drawDefinition:u,stage:d});if(A.length>1)return{error:Tue};if(A?.[0]?.matchUps?.length)return{error:Cq};let g=A?.[0]?.structureId;Object.assign(t,Ft({structureName:t.structureName??Bs(Ya),structureId:g,matchUpType:m,tieFormat:h,drawSize:f,stage:d}));let v=Vme(t);if(v.error)return v;let b=v.generators[e];if(!b)return{error:tq};let y=b?.();if(y.error)return y;let{structures:I,links:w}=y,S=I.map(E=>cr({structure:E}).matchUps).flat();h&&S.forEach(E=>{let{tieMatchUps:P}=jw({matchUp:E,tieFormat:h,isMock:l});Object.assign(E,{tieMatchUps:P,matchUpType:m})}),(!r||!i)&&(u=St(u,!1,!0)),u.links||(u.links=[]),w.length&&u.links.push(...w);let T=I.map(({structureId:E})=>E);u.structures||(u.structures=[]);let D=u.structures.map(({structureId:E})=>E);u.structures=u.structures.map(E=>T.includes(E.structureId)?I.find(({structureId:P})=>P===E.structureId):E);let C=I.filter(({structureId:E})=>!D.includes(E));return C.length&&u.structures.push(...C),s&&vR({seedingProfile:t.seedingProfile,applyPositioning:r,tournamentRecord:n,drawDefinition:u,structureId:g,placeByes:o,drawSize:f,event:c}),i&&Br({drawDefinition:u}),{links:w,structures:I,...se}}var ry={};Fi(ry,{addGame:()=>rAe,addPoint:()=>iAe,addSet:()=>aAe,addShot:()=>nAe,analyzeScore:()=>W5,analyzeSet:()=>vP,calculateHistoryScore:()=>Jme,checkScoreHasValue:()=>ya,checkSetIsComplete:()=>fL,clearHistory:()=>tAe,generate:()=>Yme,generateScoreString:()=>Zd,generateTieMatchUpScore:()=>SR,getSetComplement:()=>Y5,getTiebreakComplement:()=>gL,helpers:()=>cAe,isValidMatchUpFormat:()=>Ql,keyValueScore:()=>PAe,mutate:()=>Zme,parseMatchUpFormat:()=>vs,parseScoreString:()=>MR,query:()=>kAe,redo:()=>sAe,reverseScore:()=>Xme,setServingSide:()=>eAe,stringifyMatchUpFormat:()=>hF,tidyScore:()=>BAe,umo:()=>lAe,undo:()=>oAe,validateMatchUpScore:()=>xAe,validateScore:()=>K5,validateSetScore:()=>q5,validateTieFormat:()=>Ko});var Yme={};Fi(Yme,{generateScoreString:()=>Zd,generateTieMatchUpScore:()=>SR,reverseScore:()=>Xme});function Zd(t){let{winnerFirst:e=!0,setTBlast:i=!0,addOutcomeString:r,reversed:n=!1,matchUpStatus:a,matchUpFormat:s,autoComplete:o,winningSide:l,sets:c}=t;if(!c)return{error:Kt,info:"missing sets"};let u=s&&vs(s),{bestOf:d,finalSetFormat:p,setFormat:f}=u??{},h=n||!(!e||!l||l===1),m=r?qVe({matchUpStatus:a}):"",A=c?.sort(WVe).map(g).filter(Boolean).join(" ")||"";if(!m)return A;if(l===2)return`${m} ${A}`;return`${A} ${m}`;function g(v){let b=d&&v.setNumber===d&&p?p:f,y=z=>Sn(z?.side1Score)||Sn(z?.side2Score),I=(z=>Sn(z?.side1TiebreakScore)||Sn(z?.side2TiebreakScore))(v),w=b?.tiebreakSet||!y(v)&&I,{side1Score:S,side2Score:T,side1TiebreakScore:D,side2TiebreakScore:C}=v,E=D||(Sn(D)||I&&o?0:""),P=C||(Sn(C)||I&&o?0:"");if(w){let z=y(v)&&!I,Q=z?S:E,j=z?T:P;return`[${(h?[j,Q]:[Q,j]).join("-")}]`}let R=I?Math.min(E,P):"",M=R===E?1:2,N=Sn(R)?`(${R})`:"",k=S||(Sn(S)||o?0:""),O=T||(Sn(T)||o?0:""),x=z=>!i&&M===z?N:"",F=`${k}${x(1)}`,_=`${O}${x(2)}`,V=i&&I?`(${R})`:"",G=h?`${[_,F].join("-")}${V}`:`${[F,_].join("-")}${V}`;return["-"," "].includes(G)&&(G=""),G}}function qVe({matchUpStatus:t}){let e={[Fa]:"RET",[Xr]:"WO",[ha]:"DF/DF",[mn]:"WO/WO",[jg]:"SUS",[ql]:"ABN",[Mr]:"DEF",[LC]:"DR"};return t&&e[t]||""}function WVe(t,e){return t.setNumber-e.setNumber}function Xme(t){if(!t?.score)return{error:Kt};let{sets:e}=t.score,i=e.map(s=>{let{side1TiebreakScore:o,side2TiebreakScore:l,winningSide:c,side1Score:u,side2Score:d,setNumber:p}=s;return Ft({winningSide:c?3-c:void 0,side1TiebreakScore:l,side2TiebreakScore:o,side1Score:d,side2Score:u,setNumber:p})}),r=t?.setTBlast,n=Zd({setTBlast:r,sets:i}),a=Zd({sets:i,reversed:!0,setTBlast:r});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:a},...se}}var Zme={};Fi(Zme,{addGame:()=>rAe,addPoint:()=>iAe,addSet:()=>aAe,addShot:()=>nAe,calculateHistoryScore:()=>Jme,clearHistory:()=>tAe,redo:()=>sAe,setServingSide:()=>eAe,umo:()=>lAe,undo:()=>oAe});function ub({matchUp:t}){let{extension:e}=Bi({name:RF,element:t});if(!e)return{error:ts};let{history:i=[],undoHistory:r=[]}=e.value;return{history:i,undoHistory:r,...se}}function Jme(t){if(!t)return{error:Kt};let{matchUp:e,updateScore:i}=t;if(!e)return{error:Wo};let r=ub({matchUp:e})?.history||[];if(!Array.isArray(r))return{error:be,info:"history is not an array"};let{matchUpFormat:n}=e;if(!n)return{error:lq};if(!Ql({matchUpFormat:n}))return{error:oq};let a=vs(n),{bestOf:s,finalSetFormat:o,setFormat:l}=a,c=["0","15","30","40","A","G"],u={sets:[]},d=[],p,f=[0,0],h=1,m=0,A,g=0,v=C=>[1,2].includes(C),b=()=>(m+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:m,games:[]}),y=()=>({winningSide:void 0,points:[]}),I=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),w=I(),S=y(),T=b(),D=0;for(let C of r){D+=1,A=u.sets.length+1===s;let E=A&&o?o:l,{tiebreakAt:P,setTo:R,NoAD:M,tiebbreakFormat:N}=E,k=T.side1Score===P&&T.side1Score===T.side2Score,O=!!E.tiebreakSet,x=O?E.tiebreakSet:N,{tiebreakTo:F,NoAD:_}=x||{},V=()=>{p=void 0,f=[0,0],h=3-h,T.side1TiebreakScore="",T.side2TiebreakScore="",T.side1PointScore="",T.side2PointScore="",g=0},G=j=>{T.winningSide=j;let{s:W,...Y}=T;u.sets.push(Y),w=I(),S=y(),T=b(),V()},z=j=>{S.winningSide=j;let{g:W,...Y}=S;T.games.push(Y),w=I(),S=y(),V();let X=`side${j}Score`;T[X]+=1},Q=j=>{w.winningSide=j;let{p:W,...Y}=w;S.points.push(Y),w=I(),g=0;let X=()=>f.reduce((ie,ue)=>ie+ue)%4/4>.5?h:3-h,J=j-1;if(k||O){f[J]+=1,p=X(),T[`side${j}TiebreakScore`]=f[J],T[`side${3-j}TiebreakScore`]=f[1-J];let ie=_?1:2;if(f[J]>=F&&f[J]>=f[1-J]+ie)return z(j),{gameCompleted:!0}}else if(f[1-J]===4&&f[J]===3?f[1-J]-=1:f[J]+=1,T.side1PointScore=c[f[0]],T.side2PointScore=c[f[1]],f[J]===5||f[J]===4&&f[1-J]<3||M&&f[J]===4)return z(j),{gameCompleted:!0}};if(v(C.srv)&&(h=C.srv),["p","s","g","o"].includes(C.u)&&d.push(C.u),C.shotOutcome&&(w.shots.push(C),C.shotType==="SERVE"&&["OUT","NET"].includes(C.shotOutcome)&&(g+=1),g===2)){let j=3-h;Q(j)}if(v(C.p)||yi(C.pointNumber)){let j=C.winningSide||C.p;if(Q(j)?.gameCompleted)continue}if(v(C.g)||yi(C.gameNumber)){let j=C.winningSide||C.g;S.winningSide=j;let W=`side${j}Score`,Y=`side${3-j}Score`;if(d.length&&(d.includes("p"),d=[]),z(j),T[W]===R&&T[W]-T[Y]>=(M?1:2)&&(G(j),A))break}if(v(C.s)||yi(C.setNumber)){let j=C.winningSide||C.s;if(G(j),d.length&&(d.includes("p"),d.includes("g"),d=[]),A)break}}return D!==r.length&&console.log({error:"Match completed with excess history"}),(T.side1Score||T.side2Score||T.games.length||T.side1TiebreakScore||T.side2TiebreakScore)&&u.sets.push(T),u.scoreStringSide1=Zd({...u,matchUpFormat:n}),u.scoreStringSide2=Zd({...u,matchUpFormat:n,reversed:!0}),h=p||h,i&&(e.score=u),{...se,servingSide:h,score:u}}function db({undoHistory:t,history:e,matchUp:i}){return lr({element:i,extension:{value:{history:e,undoHistory:t},name:RF}})}function eAe({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:pq};let{history:i=[]}=ub({matchUp:t});return i.push({srv:e}),db({matchUp:t,history:i})}function tAe({matchUp:t}){return db({matchUp:t})}function iAe({matchUp:t,point:e}){if(!e||!t)return{error:Kt};if(typeof e!="object")return{error:be,context:{point:e}};let{history:i=[]}=ub({matchUp:t});return i.push(e),db({matchUp:t,history:i})}function rAe({matchUp:t,game:e}){if(typeof e!="object")return{error:be,context:{game:e}};let{history:i=[]}=ub({matchUp:t});return i.push(e),db({matchUp:t,history:i})}function nAe({matchUp:t,shot:e}){if(typeof e!="object")return{error:Kt};let{history:i=[]}=ub({matchUp:t});return i.push(e),db({matchUp:t,history:i})}function aAe({matchUp:t,set:e}){if(typeof e!="object")return{error:Kt};let{history:i=[]}=ub({matchUp:t});return i.push(e),db({matchUp:t,history:i})}function sAe({matchUp:t}){let{history:e=[],undoHistory:i=[]}=ub({matchUp:t});return i.length&&e.push(i.pop()),db({matchUp:t,history:e,undoHistory:i})}function oAe({matchUp:t}){let{history:e=[],undoHistory:i=[]}=ub({matchUp:t});return i.push(e.pop()),db({matchUp:t,history:e,undoHistory:i})}var lAe={},cAe={};Fi(cAe,{keyValueScore:()=>PAe,parseMatchUpFormat:()=>vs,stringifyMatchUpFormat:()=>hF,tidyScore:()=>BAe});var KVe="COMPLETED",YVe="WO/WO",uAe=["RET","DEF","WO",YVe,"ABN","SUS","INT"],zj="DEFAULTED",dAe="WALKOVER",pAe="ABANDONED",fAe="SUSPENDED",hAe="RETIRED",mAe="INTERRUPTED",XVe=[hAe,zj,dAe],ZVe="Enter Score",KI="()",Ry="[]",H5=["up","left","shift+tab"],V5=["enter","down","tab","right"],zx="backspace",AAe="r",gAe="s",vAe="a",yAe="d",bAe="w",IAe="i",dL=[AAe,yAe,bAe,vAe,gAe,IAe],pL="space",SV=["[","("],qx=[...H5,...V5,pL,"]"],wAe="-",JVe="/",II=wAe,nh=wAe,SAe=[JVe],eGe=0,tGe=["=","+","num_1","num_2","shift+=","shift+-"],Vf=["0","1","2","3","4","5","6","7","8","9"].concat(dL),UAe=Vf.map(t=>`shift+${t}`),G5=[II,zx].concat(qx,SAe),TAe=[Vf,UAe,G5].join(","),iGe=[TAe,H5,V5,tGe].join(",");[].concat(...Vf,...Vf,...G5,...Vf,...Vf,...Vf,...Vf,...Vf,...Vf);var Q5={OUTCOMEKEYS:dL,SIDE1KEYS:Vf,SIDE2KEYS:UAe,MODIFIERS:G5,PROMPT:ZVe,MOVEUP:H5,MOVEDOWN:V5,HOTKEYS:iGe};function jS({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=CAe({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==" "?" ":"";return t+r+i}else return i+" "+t}function CAe({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of uAe){let r=t?.indexOf(i);r===0?t=t.slice(i.length+1).trim()+" ":r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t?.trim()||(t=""),{scoreString:t,removed:e}}function qj({analysis:t,scoreString:e,sets:i,lowSide:r}){let n,a;if(!e)return{scoreString:e,sets:i};let{scoreString:s,removed:o}=CAe({scoreString:e});if(e=s,o)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},c=Object.values(l).filter(m=>m!==void 0).length;l.setNumber&&c===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:u}=t.setFormat,{tiebreakTo:d,NoAD:p}=u||{},{isTiebreakEntry:f}=JU({brackets:Ry,scoreString:e}),h=nGe(e);if(h>=0){n=e.slice(0,h);let{isTiebreakEntry:m}=JU({brackets:KI,scoreString:n}),{lastOpenBracketIndex:A,isTiebreakEntry:g}=JU({brackets:Ry,scoreString:n}),v=n&&n[n.length-1].trim(),b=n&&!isNaN(v),y=t.isIncompleteSetScore;if(f&&g){let I=n.slice(A+1).split(nh),w=I?.length>0&&I[0]!==void 0&&!isNaN(parseInt(I[0]))&&parseInt(I[0])||void 0,S=I?.length>1&&I[1]!==void 0&&parseInt(I[1])||void 0,T=[w,S];if(S){let D=r===1?1:0;T[D]=(T?.[1-D]||0)+(p?1:2),(T[D]||0)<d&&(T[D]=d),n=e.slice(0,A+1),n+=T.join(nh)}else w!==void 0?(n=e.slice(0,A+1),n+=w):(n=e.slice(0,A),y=!0);l.side1TiebreakScore=T[0]||0,l.side2TiebreakScore=T[1]||0}if(n.length||(n=void 0),y){let I=l.side1Score?.toString();if(I){let w=I?.slice(0,I.length-1);l.side1Score=!isNaN(w)&&parseInt(w)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:i?.slice(0,i.length-1)||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]}else if(b){let I=l.side2Score?.toString(),w=l.side1Score?.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let S=I?.slice(0,I.length-1);l.side2Score=!isNaN(S)&&parseInt(S)||void 0}else{let S=w?.slice(0,w.length-1);l.side1Score=!isNaN(S)&&parseInt(S)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else m?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(f&&!g?a=i?.slice(0,i.length-1)||[]:(a=i,a[i.length-1]=l),f||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:e,sets:i}}function JU({brackets:t=KI,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...Qp(i,n)),s=Math.max(...Qp(r,n));return{isTiebreakEntry:a>s,lastOpenBracketIndex:a}}function rGe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=Ry.split(""),a=t.split(""),s=Math.max(...Qp(r,a)),o=Math.max(...Qp(n,a)),l=Math.max(...Qp(nh,a));return i&&s>o&&l>s}function nGe(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function EAe(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function bee({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){let n=vs(t),{bestOf:a}=n,s=Math.ceil(a/2),o=r?.reduce((l,c)=>{let{winningSide:u}=c;return u&&l[u-1]++,l},[0,0])?.indexOf(s)+1||void 0;return XVe.includes(e)&&i&&(o=i),{matchUpWinningSide:o}}function fL({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:s}){if(!s)return{error:Kt,info:"missing set"};e=e||i&&vs(i);let o=n&&e.finalSetFormat||e?.setFormat||{},{side1Score:l,side2Score:c}=s,{setTo:u,tiebreakAt:d}=o,p=l||c,f=hL({set:s}),h=Math.abs(l-c),m=l>=u||c>=u,A=r||l>=u&&c>=u||d&&d<u&&(l===d||c===d),g=t||A&&(f===1&&s.side1TiebreakScore>s.side2TiebreakScore||f===2&&s.side2TiebreakScore>s.side1TiebreakScore),v=!A&&o.NoAD||A||r&&o.tiebreakFormat?.NoAD?1:2,b=h>=v;return!!((a&&p||m&&(b||A)||r)&&(!A||g))}function hL({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function j5({analysis:t,set:e}){let i=hL({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return fL({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function aGe({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!i?.length)return{sets:[]};let a=i[i.length-1];r=ri(r);let{validSide2Score:s,requiresTiebreak:o}=sGe({analysis:t,set:a,value:r});if(s){n=!0,e=(e||"")+r,a.side2Score=r;let l=j5({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,o){let c=KI.split("")[0];e+=c}else t.isDecidingSet||(e+=" ")}return{sets:i,scoreString:e,updated:n}}function sGe({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:s}=r,{side1Score:o}=e,l,c;return n&&n<a?o===n?l=i<=a:l=i<=n:o===a?s?l=i<a:l=i<=a+1:o===a-1?s?l=i<=a:l=i<=a+1:o===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?c=o===a&&i===n||o===n&&i===a:c=o>=a&&i>=a&&o!==i),{validSide2Score:l,requiresTiebreak:c}}function DAe({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let s;return e===AAe?r?(s=!0,r=jS({scoreString:r,lowSide:t,outcome:"RET"}),n=t===2?1:2,a=hAe):(s=!0,r=jS({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=zj):e===yAe?(s=!0,r=jS({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=zj):e===bAe?(s=!0,i=[],r="WO",n=t===2?1:2,a=dAe):e===gAe&&r?(s=!0,r=jS({scoreString:r,lowSide:t,outcome:"SUS"}),a=fAe,n=void 0):e===vAe?(s=!0,r=jS({scoreString:r,lowSide:t,outcome:"ABN"}),a=pAe,n=void 0):e===IAe&&r&&(s=!0,r=jS({scoreString:r,lowSide:t,outcome:"INT"}),a=mAe,n=void 0),{updated:s,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function oGe(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:s,lowSide:o,value:l}=t,c,u;!e?.length&&l!==zx&&(e=[{setNumber:1}]);let d=e.length-1;if(dL.includes(l)){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p;f&&!h?i="missing side2Score":s.finalSetIsComplete||n?i="final set is already complete":s.isIncompleteSetScore?i="incomplete set scoreString":s.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:c}=DAe({lowSide:o,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===zx){if({scoreString:r,sets:e,outcomeRemoved:u}=qj({analysis:s,scoreString:r,sets:e}),r?.trim()===""&&(r=r.trim()),r||(e=[]),u){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p;if(f&&h){let m=f>h&&1||h>f&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,c=!0}else if(s.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===pL){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p,m=f>h&&1||h>f&&2||void 0;m&&!n&&!s.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),r+=" ",c=!0)}else if(l===II&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&s.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,c=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let f=ri((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=ri(f),p=e[d].side1Score.toString(),c=!0}else{let f=ri((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=ri(f),p=[e[d].side1Score,e[d].side2Score].join("-"),c=!0}if(c){let f=(e.slice(0,d)||[]).filter(h=>h).map(h=>{let{side1Score:m,side2Score:A}=h;return[m,A].join("-")}).join(" ");f?r=f+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:c}}function lGe({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){let s,o,{tiebreakSet:{tiebreakTo:l,NoAD:c}}=t.setFormat,[u]=Ry.split("");if(t.isMatchTiebreakEntry||(r+=u),n[t.setNumber-1]){let{lastOpenBracketIndex:d}=JU({brackets:Ry,scoreString:r}),p=(r.slice((d??0)+1)+(e?"":a)).split(nh);if((p[i-1]?.length||0)>=2)o="tiebreak digit limit";else if(e){i===1&&(p[0]=(p[0]||"")+a),i===2&&(p[1]=(p[1]||"")+a);let f=[p[0]||0,p[1]||0].map(A=>ri(A)),h=i===1?1:0;f[h]=f[1-h]+(c?1:2),f[h]<l&&(f[h]=l);let m=n[n.length-1];m.side1TiebreakScore=f[0],m.side2TiebreakScore=f[1],r=r.slice(0,(d??0)+1),r+=f.join(nh),s=!0}else{let f=[p[0]||0,p[1]||0].map(m=>ri(m)),h=n[n.length-1];h.side1TiebreakScore=f[0],h.side2TiebreakScore=f[1],r+=a,s=!0}}else{let d=EAe({lowValue:ri(a||0),tiebreakTo:l,NoAD:c}),p=[ri(a),d];i===2&&p.reverse();let f={side1TiebreakScore:p[0],side2TiebreakScore:p[1],setNumber:n?.length+1||1};n.push(f),r+=p.join(nh),s=!0}return{info:o,scoreString:r,sets:n,updated:s}}function cGe({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:s}=t?.setFormat||{},o=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(s&&r===n||r>n)return{scoreString:i};let l=h(),c=[r,l];e===2&&c.reverse();let u=KI.split("")[0],d=c.join(II)+(o?u:" ");i=(i||"")+d;let p={side1Score:c[0],side2Score:c[1]},f=j5({analysis:t,set:p});return p.winningSide=f||void 0,{scoreString:i,set:p};function h(){return o?r+1:r+1===n?r+(s?1:2):n}}function uGe({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){let a=(n?.filter(F=>F?.winningSide)?.length||0)+(i?0:1),s=vs(t),o=a===s?.bestOf,l=o&&s?.finalSetFormat||s?.setFormat||{},c=l?.timed,u=o&&n[s?.bestOf-1],d=u?.winningSide,{isTiebreakEntry:p}=JU({brackets:KI,scoreString:e}),{isTiebreakEntry:f}=JU({brackets:Ry,scoreString:e}),h=p||f,m=!!l.tiebreakSet,A=e?.[e.length-1]?.trim(),g=e&&!isNaN(A),v=!h&&A===II,b=p&&SV.includes(A),y=f&&SV.includes(A),I=f&&A===nh,w=e?.split(""),[S]=Ry.split(""),T=w&&Math.max(...Qp(S,w)),D=w&&Math.max(...Qp(nh,w)),C=w&&D>T,E=n[n.length-1]?.winningSide,P=n?.length&&!E,R=uAe.find(F=>e?.indexOf(F)>=0),M=!isNaN(r),N=r===pL,k=qx.includes(r),O=e?.split("").find(F=>SV.includes(F)),x=k&&f&&!y&&(I||!rGe({scoreString:e}));return{isTiebreakSetValue:m&&M,matchUpScoringFormat:s,setNumber:a,setFormat:l,matchTiebreakHasJoiner:C,isGameScoreEntry:P,isSpace:N,isCloser:k,isTiebreakCloser:k&&O&&h&&g,isDecidingSet:o,isTiebreakSet:m,isTimedSet:c,isNumericEnding:g,isNumericValue:M,hasOpener:O,hasOutcome:R,finalSet:u,finalSetIsComplete:d,lastSetIsComplete:E,isInvalidSetTiebreakValue:N&&h&&b,isInvalidMatchTiebreakValue:x,isTiebreakEntry:h,isSetTiebreakEntry:p,isMatchTiebreakEntry:f,isIncompleteSetScore:v,isIncompleteSetTiebreak:b,isIncompleteMatchTiebreak:y,isPartialMatchTiebreakValue:I}}function PAe(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:s}=t,{matchUpFormat:o,shiftFirst:l,auto:c=!0}=t,u,d,p=l&&e===2||!l&&e===1;if(!TAe.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:f}=bee({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});a=f;let h=uGe({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:o});if(SAe.includes(i)&&(i=II),h.hasOpener&&h.isTiebreakEntry&&!h.isTiebreakSet&&p&&ri(i)===0&&(h.isTiebreakCloser=!0),qx.includes(i)&&h.hasOpener&&(i=""),qx.includes(i)&&(i=pL),h.lastSetIsComplete){let m=r?.length&&r[r.length-1];r&&m!==" "&&(r+=" ")}if(h.isTimedSet)({info:d,sets:n,scoreString:r,updated:u,matchUpStatus:s,winningSide:a}=oGe({analysis:h,lowSide:e,scoreString:r,sets:n,matchUpStatus:s,winningSide:a,value:i}));else if(dL.includes(i))h.finalSetIsComplete||a?d="final set is already complete":!h.isTiebreakEntry&&!h.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:s,winningSide:a,updated:u}=DAe({lowSide:e,sets:n,scoreString:r,matchUpStatus:s,winningSide:a,value:i}):h.isTiebreakEntry||h.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===zx)u=!0,{scoreString:r,sets:n}=qj({analysis:h,scoreString:r,sets:n,lowSide:e}),r||(n=[]),s=void 0,a=void 0;else if(h.hasOutcome)d="has outcome";else if(i===II&&!h.isMatchTiebreakEntry)(!h.isSetTiebreakEntry||h.isSetTiebreakEntry&&!h.isNumericEnding)&&(u=!0,{scoreString:r,sets:n}=qj({analysis:h,scoreString:r,sets:n,lowSide:e}),s=void 0);else if(i===nh&&h.isMatchTiebreakEntry&&!h.isSetTiebreakEntry)h.matchTiebreakHasJoiner?d="existing joiner":h.isNumericEnding&&(u=!0,r+=nh);else if([II,nh].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(h.isIncompleteSetScore)h.isNumericValue&&({sets:n,scoreString:r,updated:u}=aGe({analysis:h,scoreString:r,sets:n,value:i}));else if(h.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(h.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(h.isTiebreakCloser){let m=h.isSetTiebreakEntry?KI:Ry,A=m.split("").reverse()[0],g=m.split("")[0],v=n[n.length-1],{tiebreakFormat:b}=h.setFormat,{tiebreakTo:y,NoAD:I}=b||{},w=hL({set:v});if(!h.isTiebreakSet){let T=Number.parseInt(r.split(g).reverse()[0]),D=EAe({lowValue:T,tiebreakTo:y,NoAD:I});w===1?(v.side1TiebreakScore=D,v.side2TiebreakScore=T):(v.side1TiebreakScore=T,v.side2TiebreakScore=D)}r=(r||"")+A,h.isDecidingSet||(r+=" ");let S=j5({analysis:h,set:v});v.winningSide=S||void 0,u=!0}else if(h.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:u}=lGe({analysis:h,auto:c,lowSide:e,scoreString:r,sets:n,value:i}));else if(h.isSetTiebreakEntry){let[m]=KI.split(""),A=Math.max(...Qp(m,r.split(""))),g=r.slice(A+1),v=g&&ri(g)===eGe,b=ri(g?g+i:i),{tiebreakFormat:y}=h.setFormat,{tiebreakTo:I,NoAD:w}=y||{};!v&&g.length<2?w&&b>I-1?d="invalid low value for NoAD tiebreak":(u=!0,r=(r||"")+i):d=v?"tiebreak begins with zero":"tiebreak digit limit"}else if(h.isCloser)d=`invalid key: ${i}`;else if(h.isGameScoreEntry)d="game scoreString entry";else if(h.lastSetIsComplete||!n.length){u=!0;let{scoreString:m,set:A}=cGe({analysis:h,lowSide:e,scoreString:r,value:ri(i)});A&&(A.setNumber=n?.length+1||1),n=n?.concat(A).filter(Boolean)||[A],r=m||void 0}else console.log("error: unknown outcome")}if(u){n=n?.filter(Boolean);let{matchUpWinningSide:m}=bee({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});return a=m,m&&(!s||[Rn,Wl].includes(s))?(s=KVe,n=n.filter(A=>{let{side1Score:g,side2Score:v,side1TiebreakScore:b,side2TiebreakScore:y}=A;return g||v||b||y})):r&&!a&&![fAe,pAe,mAe].includes(s)&&(s=void 0),{updated:u,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}return{updated:u,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}var mL="\\d+-\\d+",gP="\\d+-\\d+\\(\\d+\\)",z5="\\[\\d+-\\d+\\]",dGe="\\d+-\\d+\\(\\d+-\\d+\\)",pGe=new RegExp(`(${mL}),`,"g"),fGe=new RegExp(`(${gP}),`,"g"),hGe=[mL,gP,z5,dGe],mGe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],AGe=mGe.map(t=>{let e=t.split("").map(i=>hGe[i]).join(" ");return new RegExp(`^${e}$`)});function Iee(t){return!t||AGe.some(e=>e.test(t))}function gGe(t){let e="[];()",i=["[","("],r=Object.assign({},...e.split("").map(s=>({[s]:0}))),n="",a=t.split("").map(s=>{let o=e.includes(s)&&s,l=i.includes(o);if(l&&o)return r[o]+=1,n=o,s;if(!l&&o&&n&&o!==n){r[n]-=1;let c="[];".includes(n)&&"[];"||"()".includes(n)&&"()"||"",u=c.split("").find(d=>d!==n);if(c.includes(o))r[n]||(n="");else return r[o]||(n=""),u}return s}).join("");return t!==a?a:t}function Nk(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function vGe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function DT(t){let e=(i=>i?.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function Wx(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function wee(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function yGe(t){return t.startsWith("(")&&t.endsWith(")")}function bGe({score:t,applied:e}){t=gGe(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let S=w.replace(")",") ");t=t.replace(w,S)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let w of a||[]){let[S]=w.match(n).slice(1),T=S.replace(/ /g,"");t=t.replace(w,`(${T})`)}let s=/\(\(\d-\d\)\)/g;if(s.test(t)){let w=t.match(s);w.length&&w.forEach(S=>{let T=S.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(S,T)})}if(s=/\(\((\d)\)\)/g,s.test(t)){let w=t.match(s);w.length&&w.forEach(S=>{let T=S.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(S,T)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);t=t.replace(o,"-"),["- "," -"].forEach(w=>{let S=new RegExp(`(\\d+)${w}(\\d+)`,"g"),T=t.match(S);T&&T.forEach(D=>t=t.replace(D,D.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[S]=w.match(/\((\d+), \)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"&&(t=t.replace(w,"(6-0)"))});let c=/\((\d+)\/\)/g;c.test(t)&&t.match(c).forEach(w=>{let[S]=w.match(/\((\d+)\/\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${S})`)});let u=/\d\/\d\/,/g;u.test(t)&&t.match(u).forEach(w=>{let[S]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${S},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[S]=w.match(/\(\/(\d+)\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&parseInt(S)<6?t=t.replace(w,`(6-${S})`):t=t.replace(w,`(${S})`)});let p,f,h,m,A,g=()=>{A=Vl(t.split("")),f=A["("]===(A[")"]||0)+1,p=(A["("]||0)+1===A[")"],h=A["["]===A["]"]+1,m=f&&!h};g();let v=/(\d+-\d+\(\d+)0,/;if(v.test(t)){let[w]=t.match(v).slice(1);t=t.replace(v,w+")")}if(A["("]===A[")"]&&A["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(yGe)?t=w.map(S=>{let T=S.slice(1,S.length-1);return T.length>2?T:S}).join(" "):t=w.join(" ")}g();let b=/[A-Za-z]+/.test(t),y=/\d+/.test(t);if(!b&&!y)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>A[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&A["("]===1&&A[")"]===1&&"[]/,".split("").some(w=>A[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),A["("]>(A[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",g()),A["("]===1&&!A[")"]&&t[0]==="("&&(t=t+")",g()),A["("]>(A[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],S=0;for(let T of t.split("").reverse())T===")"&&(S?w.push("("):S+=1),T==="("&&(S-=1),w.push(T);w.reverse(),t=w.join("")}g()}if(A[")"]>(A["("]||0)&&t[0]===")"&&(t="("+t.slice(1),g()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",g()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",g()),m){let w="",S=0;for(let T of t.split(""))T==="("&&(S?w+=")":S+=1),T===")"&&(S-=1),w+=T;t=w}g(),h&&!f&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),g()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),g(),A[")"]===1&&!A["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&A["("]===1&&A[")"]===1&&(t=t.slice(1,t.length-1),g());let I=w=>{let S=w.indexOf("("),T=w.indexOf(")");return S>=0&&T>=0&&S<T};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&A["("]===A[")"]){let w=t.slice(1,t.length-1);I(w)&&(t=w,g())}return{score:t,applied:e}}function AL(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=Qp("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,s)=>s%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function IGe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[pGe,fGe].forEach(i=>{let r=t.match(i);r?.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(AL).join(" "),{score:t,applied:e}}function wGe({score:t}){if(typeof t!="string")return{score:t};let e=p=>p?.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let f=/^-(\d+)$/;if(f.test(p)){let[h]=p.match(f).slice(1);if(h.length===2)return h.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(Nk),a=0,s="";for(let p of n){let f=Qp(p,r).find(g=>!a||g>a),h=r.slice(a,f-1),m=r[f-1],A=e(m);if(/^\d+$/.test(A)&&A.length===2){let g=A.split(""),v=Math.abs(g.reduce((b,y)=>+b-+y));if(v===1){let b=[h.join(" "),[m,p].join("")].join(" ");s+=b,a=f+1}else if(v===0){let b=Math.max(...g);if([4,5,6,7,8,9].includes(b)){let y=[6,4].includes(b)?b+1:b-1,I=[b,y].sort().reverse().join("-"),w=[h.join(" "),[I,p].join("")].join(" ");s+=w,a=f+1}}}}if(n.length&&s.length){let p=r.slice(a).join(" ");return s=[s,p].join(" "),{score:s.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((f,h)=>+f-+h,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let o=r.map(p=>vGe(p)&&"bracket"||DT(p)&&"set");if(o.includes("set")&&o.includes("bracket")){let p,f="";return r.forEach((h,m)=>{o[m]==="bracket"&&p==="set"?(h=i(h),f+=h):f+=` ${h}`,p=o[m]}),{score:f.trim()}}r=t.split(" ");let l,c=r.map(p=>{let f=new RegExp(/^(\d+)-(\d+)$/);if(f.test(p)){let[h,m]=p.match(f).slice(1),A=Math.abs([h,m].reduce((v,b)=>+v-+b,0)),g=Math.max(h,m);if(A===1)return l="tiebreakSet",l;if(A>=2&&g>=7&&l==="tiebreakSet")return l="tiebreak",l}}),u=Qp("tiebreak",c);if(u.length){let p="";r.forEach((f,h)=>{u.includes(h)?p+=`(${f}) `:u.includes(h+1)?p+=`${f}`:p+=`${f} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,f,h]=t.match(d).slice(1),m=Math.max(f,h)>=10;!DT(p)&&m&&(t=t.replace(d,`${p} [${f}-${h}]`))}return c=[],t=t.split(" ").map(p=>{let f=/^\((.*)\)$/,h=f.test(p),m=new RegExp(z5).test(p)&&"super"||new RegExp(gP).test(p)&&"tiebreak"||new RegExp(mL).test(p)&&"standard"||"unknown";return c.push(m),m==="standard"&&h?p.match(f)[1]:p}).join(" "),{score:t}}function SGe({score:t,applied:e}){for(let T of[".",","," ","/"]){let D=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(D.test(t)){let C=t.match(D).slice(1).map(P=>parseInt(P)),E=Math.abs(C[0]-C[1]);E<=10&&E>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[T,D,C,E,P,R]=t.match(i).slice(1);t=t.replace(i,`${T}${D}-${C} ${E}-${P}${R}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(T=>(n.test(T)&&(T=T.replace("("," (")),a.test(T)&&(T=T.replace(")",") ")),T)).join(" "),e.push("spaceConsiderationPatterns")});let s=AL(t);s!==t&&(t=s,e.push("deDashMash"));let o=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(o.test(t)){let[T,D,C]=t.match(o).slice(1),[E,P]=D.split("");t=`${T}-${E} ${P}-${C}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,c=/^([\d -]+)\/([\d -]+)$/;if(c.test(t)){let[T,D]=t.match(c).slice(1),C=T.trim(),E=D.trim();if(l.test(C)&&l.test(E)){let P=C.match(l).slice(1,3).join("-"),R=E.match(l).slice(1,3).join("-");t=`${P} ${R}`,e.push("slashSeparationPattern")}}let u=/^([\d -]+),([\d -]+)$/;if(u.test(t)){let[T,D]=t.match(u).slice(1),C=T.trim(),E=D.trim();if(l.test(C)&&l.test(E)){let P=C.match(l).slice(1,3).join("-"),R=E.match(l).slice(1,3).join("-");t=`${P} ${R}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let T=t.match(d)[0],D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("singleSetCommaSeparationPattern")}let p=0,f=/(\d+)-(\d{2})-(\d+)/;for(;f.test(t)&&p<3;){let[T,D,C]=t.match(f).slice(1),E=D.split(""),P=`${T}-${E[0]} ${E[1]}-${C}`;t=t.replace(f,P),e.push("noSetSeparationPattern"),p+=1}let h=/(^|\s)7-6\s(\d+)\s/g,m=t.match(h);if(m?.length){let T=/(^|\s)7-6\s(\d+)\s/;m.forEach(D=>{let C=D.match(T).slice(2)[0];t=t.replace(D,`7-6(${C}) `),e.push("floatingTiebreakPattern1")})}let A=t.match(/\d \d /);A?.forEach(T=>{let D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern1")}),A=t.match(/ \d \d$/),A?.forEach(T=>{let D=" "+T.slice(1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern2")});let g=/^\d, *\d\/\d, *\d/;if(g.test(t)){let T=t.match(g)[0],D=T.split("/").map(C=>`(${C})`).join(" ")+" ";t=t.replace(T,D),e.push("slashCommaSetPattern")}let v=/\(6-\)/g;v.test(t)&&(t=t.replace(v,"(6-0)"),e.push("missingZeroPattern2"));let b=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(b.test(t)){let T=t.match(b),D=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),C=t;T.forEach(E=>{let[P,R]=E.match(D).slice(1),M=`${P}-${R}`;C=C.replace(E,M)}),t=C,e.push("slashSetPattern")}let y=/(.*)\s(1\d)\s(\d+)$/;if(y.test(t)){let[T,D,C]=t.match(y).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${D}${C}`,e.push("spaceSeparatedSuperPattern"))}let I=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of t.match(I)||[]){let[D,C,E,P]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[R,M]=C.split("-").map(N=>parseInt(N));Math.abs(R-M)===1&&(t=t.replace(T,`${D}${C}(${E})${P}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of t.match(w)||[]){let D=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[C,E,P]=T.match(D).slice(1),[R,M]=C.split("-").map(N=>parseInt(N));Math.abs(R-M)===1&&(t=t.replace(T,`${C}(${E})${P}`),e.push("floatingTiebreakPattern2"))}let S=/(^|\s)(\d \d)\(/g;for(let T of t.match(S)||[]){let D=/(^|\s)(\d \d)\(/,[C,E]=T.match(D).slice(1);t=t.replace(T,`${C}${E.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function UGe({score:t,matchUpStatus:e}){let i=t?.split(" ");t=i.map(o=>{if(o.endsWith("]")){let l=o.split("[");if(DT(l[0]))return l[0]+`(${l[1].slice(0,-1)})`}return o}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let o of t.match(r)){let l=o.replace(" ","-").match(/\((.*)\)/)?.[1];if(Sn(l)&&l?.[0]>2){if([2,4].includes(l.length))l=l.split("").join("-");else if(l.length===3){let c=l.indexOf("1");l=Wx(l.split(""),c)}}t=t.replace(o,`(${l})`)}i=t?.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((o,l)=>{let c=[void 0,"","COMPLETED"].includes(e)||l!==a;if(n.test(o)&&c){let[u,d,p]=Array.from(o.match(n)).slice(1),f=Math.min(d,p);return`${u}(${f})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l,c]=Array.from(o.match(n)).slice(1),u=l.split("");return`${u[0]}-${u[1]}(${c})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(o=>{if(n.test(o)){let[l,c]=Array.from(o.match(n)).slice(1);return DT(l)?`${l}(${c})`:l}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l]=o.match(n).slice(1);return`[${l<9?10:Number.parseInt(l)+2}-${l}]`}return o}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let o=t.match(s)[1];t=t.replace(s,`(${o}) `)}return{score:t}}function TGe({score:t,attributes:e,identifier:i}){if(typeof t!="string")return{score:t,identifier:i};let r=new RegExp(/\([\d,/ ]+\)/g),n=t.match(r);for(let u of n||[]){let d=u.match(/^\((.*)\)$/)?.slice(1)?.[0],p=t.split(u)[0].split(")").reverse()[0].replace(/\D/g,"");if(d?.length===2&&p?.length>=2){let m=p.slice(p.length-2).split("").map(A=>parseInt(A));if(Math.abs(m[0]-m[1])===1)continue}let f=wee(d),h=AL(f);t=t.replace(u,`(${h})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);t.match(a)?.forEach(u=>{let d=wee(u.match(/^\[(.*)\]$/)[1]);t=t.replace(u,`(${d}) `).trim()});let s=[")","]"],o=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&s.some(u=>t.endsWith(u))&&o.some(u=>t.includes(u))){let u="",d=t.split(/[)\]]/).filter(Boolean).map(A=>(A.startsWith(",")&&(A=A.slice(1)),A.trim())),p=d.every(A=>A.includes(",")||Nk(A)),f=d.every(A=>A.includes("/")||Nk(A)),h=d.every(A=>A.includes("-")||Nk(A)),m=p&&","||h&&"-"||f&&"/";if(m){let A;d.forEach(g=>{if(g.startsWith("("))if(A==="set"&&(u+=" "),g.includes(m))u+=g.slice(1).split(m).map(v=>v.trim()).join("-"),A="set";else{let v=g.slice(1);u+=`(${v}) `,A="tiebreak"}else if(g.startsWith("[")){let v=g.slice(1).split(m).map(y=>parseInt(y.trim())),b=Math.min(...v);A==="set"?u+=`(${b}) `:u+=`[${v.join("-")}] `,A="tiebreak"}}),t=u.trim()}}let l=Vl(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&DT(t)&&Sn(e?.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let c=/\(\)/g;return c.test(t)&&(t=t.replace(c,"").trim()),{score:t}}function RAe({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let o=`${r[0]}-${r[1]}`;return r[2]&&(o+=` (${r[2]})`),n(),r.push(r),o};n();let s=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let o=e.shift(),l=Sn(o)&&parseInt(o),c=r[0]!==void 0&&r[1]!==void 0;if(Sn(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,s())){i.push(a()),r=[void 0,void 0];continue}if(c&&e.length===1&&Sn(e[0])){let u=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=u,i.push(a()),r=[void 0,void 0]}c&&s()}}return{sets:i}}function Wj(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=Wx(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=Wx(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function MAe(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e?.toString().split(""),a=n?.every(o=>Sn(o)),s=o=>Math.abs(o[0]-o[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let o=a?n.map(c=>parseInt(c)):e.split("").map(c=>parseInt(c)),{sets:l}=RAe({score:e});if(o.length,e.length===3&&s(o.slice(0,2))===1){let[c,u,d]=o;e=`${c}-${u}(${d})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&o[0]===1){let[c,u,d]=o;e=`[${c}${u}-${d}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&s(o.slice(0,2))===1&&"987654".split("").includes(o[0].toString())){let[c,u,d,p]=o,f=Math.min(d,p);e=`${c}-${u}(${f})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&o[0]===1&&o[2]===1){let[c,u,d,p]=o;e=`[${c}${u}-${d}${p}]`,i.push("bigSuper")}else if(e.length===4){let[c,u,d,p]=o;e=`${c}${u} ${d}${p}`,i.push("split4")}else if(e.length===5&&s(o.slice(0,2))===1){let[c,u,d,p,f]=o;e=`${c}-${u}(${d}) ${p}-${f}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&s(o.slice(3))===1){let[c,u,d,p,f]=o;e=`${c}-${u} ${d}-${p}(${f})`,i.push("numericTiebreakPattern5")}else if(o.length===7)if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&o[4]===1){let[c,u,d,p,f,h,m]=o;e=`${c}-${u} ${d}-${p} [${f}${h}-${m}]`,i.push("numericTiebreakPattern6")}else if(s(o.slice(0,2))===1&&s(o.slice(3,5))>1&&s(o.slice(5,7))>1){let[c,u,d,p,f,h,m]=o;e=`${c}-${u}(${d}) ${p}-${f} ${h}-${m}`,i.push("numericTiebreakPattern7")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))===1&&s(o.slice(5,7))>1){let[c,u,d,p,f,h,m]=o;e=`${c}-${u} ${d}-${p}(${f}) ${h}-${m}`,i.push("numericTiebreakPattern8")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&s(o.slice(4,6))===1){let[c,u,d,p,f,h,m]=o;e=`${c}-${u} ${d}-${p} ${f}-${h}(${m})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let c=Wj(e);c&&e!==c&&i.push("parsedSuperPattern"),e=c??e}else{let c=Oa(e.split(""),2).map(g=>g.join("")),u=c.map(g=>{let[v,b]=g.split("").map(w=>parseInt(w)),y=Math.abs(v-b),I=v>b?1:2;return y>1&&I||I*-1}),d=u.reduce((g,v)=>g>0&&v>0,1),p=Vl(u),f=u.map(g=>Math.abs(g)),h=Vl(f),m=u[0]<0,A=!m&&u[1]<0;if(u[0]>0&&u[1]>0&&u[0]!==u[1])e=[c.slice(0,2).join(" "),c.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(d)e=c.join(" "),i.push("chunkSplit");else if(o.length===6){if(p[1]===2||p[2]===2)if(!Object.values(h).includes(3))e=c.join(" "),i.push("chunkSplit");else{let[g,v,b,y,I,w]=o,S=u.reduce((T,D,C)=>D<0?C:T,void 0);if(S===0){let T=Math.min(b,y);e=`${g}-${v}(${T}) ${I}-${w}`,i.push("chunkSplitTiebreak1")}else if(S===1){let T=Math.min(I,w);e=`${g}-${v} ${b}-${y}(${T})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${b}-${y}`,i.push("chunkSplitTrimExtraneous")}}else if(o.length===8){let[g,v,b,y,I,w,S,T]=o;m||A?o[5]===1&&(m?e=`${g}-${v}(${b}) ${y}-${I} [${w}${S}-${T}]`:e=`${g}-${v} ${b}-${y}(${I}) [${w}${S}-${T}]`):(u[0],u[1])}}}return{score:e,applied:i,matchUpStatus:r}}function NAe(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let c=l.match(n).slice(1).map(d=>Number.parseInt(d)),u=c[0]>c[1]&&1||c[1]>c[0]&&2;u&&(e[u-1]+=1,i.push(u))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,s=e[0]>0&&e[0]===e[1],o=e.reduce((l,c)=>l+c,0);return{setsWon:e,setsTied:s,setWinners:i,totalSets:o,winningSide:a}}function CGe({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),s=a.length;t=a.map((u,d)=>{if(new RegExp(gP).test(u)){let f=u.slice(3),h=u.slice(0,3),m=h.split("-");if(!DT(h)&&!e){let A=Math.max(...m),g=h.indexOf(A),v=[A,A-1];return g&&v.reverse(),v.join("-")+f}}else if(u.length===2&&Sn(u))return u.split("").join("-");u=AL(u);let p=new RegExp(`^${z5}$`).test(u)&&"super"||new RegExp(`^${gP}$`).test(u)&&"tiebreak"||new RegExp(`^${mL}$`).test(u)&&"standard"||"unknown";if(r.push(p),s>1&&p==="standard"&&d<2){let[f,h]=u.split("-"),m=Math.abs(parseInt(f)-parseInt(h)),A=Math.max(f,h),g=Math.min(f,h),v=[parseInt(f),parseInt(h)].indexOf(g);if(A>9&&m>2){let b=A.toString().split(""),y=b.find(I=>parseInt(I)>g||d&&parseInt(I)<=n)??b[0];y&&(u=v?[y,g].join("-"):[g,y].join("-"))}A>(n||0)&&(n=A)}if(p==="standard"){let[f,h]=u.split("-");if(!Math.abs(parseInt(f)-parseInt(h))&&e!=="RETIRED")return""}return u}).filter(Boolean).join(" ");let{setsWon:o,setWinners:l,totalSets:c}=NAe(t);if(c===1&&i?.removed==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...o)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...o)>2){let u=[0,0];t=t.split(" ").map((d,p)=>(u[l[p]]+=1,Math.max(...u)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function EGe({score:t}){let{setsTied:e,winningSide:i}=NAe(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let o=t.match(r).slice(1)[0],l=o<=8?10:o+2;t=t.replace(r,` [${l}-${o}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let s=a.split("(").join("").split(")").join("").split("-");if(!s.every(o=>Sn(o)))return{score:t};if(s[0]==="76"){let o=s[1].length===2?Math.min(...s[1].split("").map(l=>parseInt(l))):s[1];t=[...n.slice(0,n.length-1),`7-6(${o})`].join(" ")}else{s=s.map(c=>parseInt(c));let o=Math.max(...s),l=Math.abs(s[0]-s[1]);if(o>=10){if(l>2&&s.every(c=>+c>=10)){let c=s.map(u=>u===o?u-10:10).sort();l=Math.abs(c[0]-c[1]),l>2&&(s=c)}t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" ")}else n.length===3&&o>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" "))}return{score:t}}function DGe({score:t}){return t=t?.toString().toLowerCase()||"",{score:t}}function PGe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function RGe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=Wx(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=MAe({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function MGe({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&Wj(t)?{score:Wj(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function NGe({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t?.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function BGe({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let n=e?.matchUpStatuses?.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function kGe({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(def|defaulted)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleDefaulted"),{score:s.trim(),matchUpStatus:"defaulted",applied:i}}let n=e?.matchUpStatuses?.defaulted,a=["dft",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleDefaulted"),{matchUpStatus:"defaulted",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function xGe({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function _Ge({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function OGe({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function FGe({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function LGe({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[s,o]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${s}-${o}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Sn(i))&&e.length===4&&(t=e)}return{score:t}}function $Ge({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var HGe={handleTiebreakSlashSeparation:FGe,handleSetSlashSeparation:_Ge,punctuationAdjustments:bGe,handleGameSeparation:OGe,joinFloatingTiebreak:wGe,handleBracketSpacing:IGe,handleSpaceSeparator:LGe,separateScoreBlocks:RGe,matchKnownPatterns:SGe,removeDanglingBits:xGe,removeErroneous:MGe,handleDefaulted:kGe,handleWalkover:NGe,properTiebreak:UGe,handleNumeric:MAe,handleRetired:BGe,containedSets:TGe,sensibleSets:CGe,stringScore:DGe,superSquare:EGe,setBuilder:RAe,excisions:$Ge,replaceOh:PGe},UV={},VGe=["handleNumeric","handleWalkover","handleRetired","handleDefaulted","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],GGe=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function BAe(t){if(!t.score)return{error:be};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:s,profile:o}=t,l=[],c,u=[],d,p,f=e,h=A=>{A.forEach(g=>{p=HGe[g]({profile:o,identifier:r,matchUpStatus:c,attributes:d,applied:u,score:f});let v=p.score!==f;v&&l.push({method:g,score:p.score}),a&&(s||v||p.matchUpStatus!==c)&&console.log(c?{score:p.score,matchUpStatus:c}:{score:p.score},g),p.matchUpStatus&&(c=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(u=p.applied),f=p.score})};h(VGe);let m=Iee(f);return m||(f=e.toString().replaceAll(/\D/g,""),d?.removed&&(d.removed=void 0),h(GGe),m=Iee(f),m||(f="")),u.forEach(A=>{UV[A]||(UV[A]=0),UV[A]+=1}),{matchUpStatus:c?.toUpperCase(),modifications:l,attributes:d,isValid:m,score:f}}var kAe={};Fi(kAe,{analyzeScore:()=>W5,analyzeSet:()=>vP,checkScoreHasValue:()=>ya,checkSetIsComplete:()=>fL,getSetComplement:()=>Y5,getTiebreakComplement:()=>gL,isValidMatchUpFormat:()=>Ql,parseScoreString:()=>MR,validateMatchUpScore:()=>xAe,validateScore:()=>K5,validateSetScore:()=>q5,validateTieFormat:()=>Ko});function QGe(t,e,i,r,n,a=!1){return n?{isValid:!0}:t===0&&e===0?{isValid:!1,error:"Tiebreak-only set requires both scores"}:t<r?{isValid:!1,error:`Tiebreak-only set winner must reach at least ${r}, got ${t}`}:i<(a?1:2)?{isValid:!1,error:a?`Tiebreak-only set (NoAD) must be won by at least 1 point, got ${t}-${e}`:`Tiebreak-only set must be won by at least 2 points, got ${t}-${e}`}:a?{isValid:!0}:t===r&&e>r-2?{isValid:!1,error:`Tiebreak-only set at ${r}-${e} requires playing past ${r}`}:t>r&&i!==2?{isValid:!1,error:`Tiebreak-only set past ${r} must be won by exactly 2 points, got ${t}-${e}`}:{isValid:!0}}function jGe(t,e,i,r){let n=r===i?i+1:i,a=r;return t!==n?{isValid:!1,error:`Tiebreak set winner must have ${n} games, got ${t}`}:e!==a?{isValid:!1,error:`Tiebreak set loser must have ${a} games, got ${e}`}:{isValid:!0}}function zGe(t,e,i){let r=Math.max(t||0,e||0),n=Math.min(t||0,e||0),a=r-n,s=i.tiebreakTo||7;return r<s?{isValid:!1,error:`Tiebreak winner must reach ${s} points, got ${r}`}:a<2?{isValid:!1,error:`Tiebreak must be won by 2 points, got ${r}-${n}`}:n>=s-1&&a>2?{isValid:!1,error:`Tiebreak score ${r}-${n} is invalid`}:{isValid:!0}}function qGe(t,e,i,r){return r?t===i+1&&e<i-1?{isValid:!1,error:`With tiebreak format, if side 1 has ${i+1} games, side 2 must be at least ${i-1}, got ${e}`}:e===i+1&&t<i-1?{isValid:!1,error:`With tiebreak format, if side 2 has ${i+1} games, side 1 must be at least ${i-1}, got ${t}`}:{isValid:!0}:{isValid:!0}}function WGe(t,e,i,r,n){if(t<r)return{isValid:!1,error:`Set winner must reach ${r} games, got ${t}`};let a=n&&t===r&&e===n&&i===1;if(i<2&&!a)return{isValid:!1,error:`Set must be won by at least 2 games, got ${t}-${e}`};if(n){if(e>=n&&!a)return{isValid:!1,error:`When tied at ${n}-${n}, must play tiebreak. Use format like ${n+1}-${n}(5)`};let s=n===r?r+1:r;if(t>s)return{isValid:!1,error:`With tiebreak format, set score cannot exceed ${s}-${n}. Got ${t}-${e}`}}else if(t>r+10)return{isValid:!1,error:`Set score ${t}-${e} exceeds reasonable limits`};return{isValid:!0}}function KGe(t,e,i){let r=t.side1TiebreakScore,n=t.side2TiebreakScore,a=e&&i?r:t.side1Score||t.side1||0,s=e&&i?n:t.side2Score||t.side2||0;return{side1Score:a,side2Score:s,side1TiebreakScore:r,side2TiebreakScore:n}}function YGe(t,e,i,r,n,a,s){if(i&&r){let o=jGe(t,e,i,r);if(!o.isValid)return o}return(n!==void 0||a!==void 0)&&s?zGe(n,a,s):{isValid:!0}}function XGe(t,e,i){return i&&(t>i+10||e>i+10)?{isValid:!1,error:`Set score ${t}-${e} exceeds expected range for ${i}-game sets`}:{isValid:!0}}function ZGe(t,e,i){let{side1:r,side2:n,winner:a,loser:s,diff:o}=t,{setTo:l,tiebreakAt:c}=e;if(l&&c){let u=qGe(r,n,l,c);if(!u.isValid)return u}return i?XGe(a,s,l):l?WGe(a,s,o,l,c):{isValid:!0}}function q5(t,e,i,r){if(!e)return{isValid:!0};let n=vs(e);if(!n)return{isValid:!0};let a=i&&n.finalSetFormat?n.finalSetFormat:n.setFormat;if(!a)return{isValid:!0};if(a.timed){if(!r){let w=t.side1Score??0,S=t.side2Score??0;if(w===0&&S===0)return{isValid:!1,error:"Timed set requires at least one side to have scored"};if(a.based==="P"&&w===S&&w>0&&a.tiebreakFormat&&!(t.side1TiebreakScore!==void 0||t.side2TiebreakScore!==void 0))return{isValid:!1,error:"Tied timed set requires tiebreak"}}return{isValid:!0}}let{setTo:s,tiebreakAt:o,tiebreakFormat:l,tiebreakSet:c}=a,u=c?.tiebreakTo,d=!!u&&!s,p=t.side1TiebreakScore!==void 0&&t.side2TiebreakScore!==void 0,{side1Score:f,side2Score:h,side1TiebreakScore:m,side2TiebreakScore:A}=KGe(t,d,p),g=Math.max(f,h),v=Math.min(f,h),b=g-v;if(d){let w=t.NoAD??a.tiebreakSet?.NoAD??!1;return QGe(g,v,b,u,r??!1,w)}let y=m!==void 0||A!==void 0,I=s&&g===s+1&&v===s;return y||I?YGe(g,v,s,o,m,A,l):ZGe({side1:f,side2:h,winner:g,loser:v,diff:b},{setTo:s,tiebreakAt:o},r)}function xAe(t,e,i){if(!t||t.length===0)return{isValid:!0};let r=e?.match(/SET(\d+)/)?.[1],n=r?Number.parseInt(r):3,a=[Fa,Xr,Mr].includes(i||"");for(let s=0;s<t.length;s++){let o=t[s],l=s+1===n,c=o.winningSide!==void 0,u=q5(o,e,l,a||i===void 0&&!c);if(!u.isValid)return{isValid:!1,error:`Set ${s+1}: ${u.error}`}}return{isValid:!0}}function JGe(t,e,i,r,n,a){let{tiebreakTo:s,NoAD:o}=t||{},l=Math.max(e??0,i??0);return!(o&&l>s||l<s&&r&&(n&&!a||!n))}function eQe(t,e,i,r,n,a){let s=e+1===r,{side1Score:o,side2Score:l,side1TiebreakScore:c,side2TiebreakScore:u,winningSide:d}=t,p=Math.max(o??0,l??0),f=c??u,{finalSetFormat:h,setFormat:m}=i,A=s&&h||m;return f&&!JGe(A?.tiebreakFormat,c,u,d,n,a)?!1:A.setTo?!(!A.noTiebreak&&p>A.setTo+1):!0}function tQe(t){let e=t.reduce((i,r)=>((r.side1Score!==void 0||r.side2Score!==void 0)&&(i[0]+=r.side1Score??0,i[1]+=r.side2Score??0),i),[0,0]);return e[0]>e[1]?1:e[1]>e[0]?2:t.find(i=>i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)?.winningSide}function iQe(t,e,i,r,n){return(!n||t===e)&&i===1&&r.indexOf(t)+1||void 0}function W5({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){let a=n?.sets??[],s=(a?.filter(w=>w?.winningSide)||[]).reduce((w,S)=>{let{winningSide:T}=S;if(!T)return w;let D=T-1;return w[D]++,w},[0,0]),o=r?r-1:void 0,l=o!==void 0&&[0,1].includes(o)?1-o:void 0,c=o!==void 0&&s[o],u=l!==void 0&&s[l],d=e?vs(e):void 0,p=Math.max(...s),f=Vl(s)[p],h=d?.setFormat?.timed||d?.finalSetFormat?.timed,m=d?.bestOf||d?.exactly,A=m&&Math.ceil(m/2)||1,g=i??t,v=!!(g&&[Mr,Fa,Xr].includes(g)),b=!d||!a.length||a.every((w,S)=>eQe(w,S,d,m??0,S===a.length-1,v)),y=d?.setFormat?.based==="A"||d?.finalSetFormat?.based==="A",I=y&&a.length>0?tQe(a):iQe(p,A,f,s,e);return{valid:!!(b&&(r&&y&&r===I||r&&!y&&c>u&&r===I||r&&v||!r&&!I&&(![Ln,Mr,Fa,Xr].includes(g)||h&&g===Ln)))}}function K5({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:be};let{sets:a,scoreStringSide1:s,scoreStringSide2:o}=n,l="scoreString must be a string!";if(s!==void 0&&typeof s!="string")return{error:be,info:l};if(o!==void 0&&typeof o!="string")return{error:be,info:l};if(a!==void 0&&!Array.isArray(a))return{error:be,info:Ey("sets")};if(a?.length){let c=a.map(d=>d?.setNumber).filter(Boolean);if(c.length!==Ci(c).length)return{error:be,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:f,side1TiebreakScore:h,side2TiebreakScore:m,side1PointScore:A,side2PointScore:g,winningSide:v,setNumber:b}=d;if(![[p,f],[h,m],[A,g]].filter(y=>y.some(I=>![void 0,null].includes(I))).every(y=>y.every(I=>yi(I))))return{error:be,info:"non-numeric values"};if(![b,v].filter(y=>![void 0,null].includes(y)).every(y=>yi(y)))return{error:be,info:"non-numeric values"};if(v&&![1,2].includes(v))return{error:be,info:"winningSide must be 1 or 2"}}let{valid:u}=W5({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!u)return{error:_ue,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var Y5=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let s=ri(i);s?.toString().length>2&&(s=Number.parseInt(s.toString().slice(0,2))),n&&n<r&&s>n&&(s=n);let o;return a&&!n?s>r?o=r:o=s<r?r:r-1:o=s+1<r&&r||n&&n<r&&s===n&&r||!n&&s+2||r+1,[e?s:o,e?o:s]},gL=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?Number.parseInt(i):i;a?.toString().length>2&&(a=Number.parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let s=rQe({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:s,e?s:a]};function rQe(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function Kj(t,e){return t>e&&1||t<e&&2||void 0}function nQe(t,e){return e?{side1Score:t[0],side2Score:t[1],winningSide:Kj(t[0],t[1])}:{side1TiebreakScore:t[0],side2TiebreakScore:t[1],winningSide:Kj(t[0],t[1])}}function MR({tiebreakTo:t=7,scoreString:e="",matchUpFormat:i}){let r,n=3;if(i)try{r=vs(i);let u=/SET(\d+)/.exec(i)?.[1];n=u?Number.parseInt(u):3}catch{}return e?.split(" ").filter(Boolean).map((u,d)=>c({set:u,setNumber:d+1}));function a(u,d){if(!r||!d)return!1;let p=u===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;if(!p)return!1;let f=p.tiebreakSet?.tiebreakTo,h=p.setTo;return!!f&&!h}function s(u){if(!r)return t;let d=u===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;return d?.tiebreakSet?.tiebreakTo??d?.tiebreakFormat?.tiebreakTo??t}function o(u,d,p){let f=u[1],h=s(p),m=gL({lowValue:f,isSide1:d===2,tiebreakTo:h});return Array.isArray(m)?[m[0],m[1]]:[void 0,void 0]}function l(u,d,p,f){let h=(d&&u.replace(d[0],"")||p&&u.replace(p[0],"")||u).split("-").map(y=>Number.parseInt(y)),m=h[0],A=h[1],g=Kj(m,A),v,b;if(d&&([v,b]=o(d,g,f)),p){let y=p[1].split("-").map(I=>Number.parseInt(I));v=y[0],b=y[1]}return{side1Score:m,side2Score:A,side1TiebreakScore:v,side2TiebreakScore:b,winningSide:g}}function c({set:u,setNumber:d}){let p=/\(([^)]+)\)/,f=/\[([^\]]+)\]/,h=p.exec(u),m=f.exec(u),A=u?.startsWith("[")&&m,g=a(d,!!A),v=s(d),b=g&&v===1,y;if(A){let I=m[1].split("-").map(w=>Number.parseInt(w));y=nQe(I,g)}else y=l(u,h,m,d);return{side1Score:y.side1Score,side2Score:y.side2Score,side1TiebreakScore:y.side1TiebreakScore,side2TiebreakScore:y.side2TiebreakScore,winningSide:y.winningSide,setNumber:d,...b&&{NoAD:!0},...g&&{tiebreakSet:!0}}}}function aQe({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=hL({set:n});return fL({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r})&&a||void 0}function vP(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:eF};let{setNumber:r}=e||{},{bestOf:n,exactly:a}=i||{},s=n||a,o=!!(r&&s&&r===s),l=o&&i?.finalSetFormat||i?.setFormat,c=!!l?.tiebreakSet,u=!!l?.timed,d=!c&&!u,p=!!(r&&s&&r<=s),f=[e?.side1Score,e?.side2Score],h=[e?.side1PointScore,e?.side2PointScore],m=[e?.side1TiebreakScore,e?.side2TiebreakScore],A=f.filter(x=>x!==void 0).length,g=h.filter(x=>x!==void 0).length,v=m.filter(x=>x!==void 0).length,b=f?.filter(x=>!isNaN(x)).length,y=m?.filter(x=>!isNaN(x)).length,{tiebreakAt:I}=l||{},w=I&&f.filter(x=>x>=I).length===2,S=w&&(f[0]>f[1]&&1||f[1]>f[0]&&2||void 0),T=!!(y&&!b),D=!!e?.winningSide,{error:C,result:E}=sQe({sideTiebreakScores:m,sideGameScores:f,setFormat:l,setObject:e}),{error:P,result:R}=oQe({sideTiebreakScores:m,setObject:e,setFormat:l}),M=d&&!T&&E||c&&T&&R||u,N=p&&!(c&&!T)&&!(d&&T)&&(!D||M),k=aQe({isTimedSet:u,matchUpScoringFormat:i,isDecidingSet:o,isTiebreakSet:T,setObject:e}),O={expectTiebreakSet:c,expectTimedSet:u,hasTiebreakCondition:w,isCompletedSet:D,isDecidingSet:o,isTiebreakSet:T,isValidSet:N,isValidSetNumber:p,isValidSetOutcome:M,leadingSide:S,setFormat:l,sideGameScores:f,sideGameScoresCount:A,sidePointScores:h,sidePointScoresCount:g,sideTiebreakScores:m,sideTiebreakScoresCount:v,winningSide:k};return e?.winningSide!==void 0&&(T?(O.isValidTiebreakSetOutcome=R,R||(O.tiebreakSetError=P)):(O.isValidStandardSetOutcome=E,E||(O.standardSetError=C))),O}function sQe({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:eF};let n=!!e?.tiebreakSet,a=!!e?.timed;if(!e||n||a)return{result:!1,error:be};if(i?.filter(S=>!isNaN(S)).length!==2)return{result:!1,error:hj};let{setTo:s,tiebreakAt:o,tiebreakFormat:l,NoAD:c}=e||{};if(!(s&&i?.find(S=>S>=s)))return{result:!1,error:hj};let u=[1,2].includes(t?.winningSide);if(!t||!u)return{result:!1,error:tF};let d=t?.winningSide-1,p=1-d,f=i[d],h=i[p],m=f-h;if(!(f>h))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let A=o&&l,g=r?.filter(S=>!isNaN(S)).length===2,v=r?.[d],b=r?.[p],y=o&&i.filter(S=>S>=o).length===2;if(A){let{NoAD:S,tiebreakTo:T}=l;if(y){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!g)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(T))return{result:!1,error:{message:"tiebreakTo error"}};if(!(T&&r?.find(R=>R>=T)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let D=o<s?s:s+1;if(f>D)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!v||!b||v<b)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let C=S?1:2,E=v-b,P=b>=T-1;if(E&&P&&E<C)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(f>s&&!y)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let I=c?1:2,w=h>=s-1;return m&&w&&!y&&m<I?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>I&&f>s?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function oQe({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:eF};let r=!!e?.tiebreakSet,n=!!e?.timed;if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t?.winningSide);if(!t||!a)return{result:!1,error:tF};let{tiebreakSet:s}=e||{},{NoAD:o,tiebreakTo:l}=s||{};if(i?.filter(A=>!isNaN(A)).length!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!i?.find(A=>A>=l))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let c=t?.winningSide-1,u=1-c,d=i[c],p=i[u];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let f=o?1:2,h=d-p,m=p>=l-1;return h&&m&&h<f?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}function lQe(t){let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:r,tieFormatName:n,matchUpType:a,eventType:s,isMock:o,event:l}=t,{tieFormat:c,matchUpFormat:u}=t;if(a===ca&&s===ca){let d=e?.structures?.find(({stage:p})=>p===Ut)?.tieFormat;c=c||d||n&&l?.tieFormat?.tieFormatName===n&&l.tieFormat||n&&Nm({namedFormat:n,hydrateCollections:i,isMock:o,event:l})||l?.tieFormat||Nm({event:l,isMock:o,hydrateCollections:i}),u=void 0}else u||(c=void 0,l?.matchUpFormat||(u=td));if(c){let d=Ko({gender:l?.gender,enforceGender:r,tieFormat:c});if(d.error)return d}return{tieFormat:c,matchUpFormat:u}}function cQe(t){let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:r,qualifyingOnly:n,drawEntries:a,structureId:s,tieFormat:o,idPrefix:l,isMock:c,event:u}=t,d=t.qualifyingProfiles,p=d?.length?$me({hasExistingDrawDefinition:!0,uuids:t.uuids,qualifyingProfiles:d,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,idPrefix:l,isMock:c}):void 0;if(p?.error)return p;e.structures=e.structures?.filter(({structureId:I})=>I!==i),e.links=e.links?.filter(({source:I})=>I.structureId!==i);let{qualifiersCount:f,qualifyingDrawPositionsCount:h,qualifyingDetails:m}=p??{};h&&(p?.structures&&e.structures?.push(...p.structures),p?.links&&e.links?.push(...p.links));let A=e.structures?.find(({stage:I,stageSequence:w})=>I===Ut&&w===1),{qualifiersCount:g}=QC({stageSequence:1,drawDefinition:e,structureId:s,stage:Ut}),v=Math.max(f??0,g??0),b=Phe({qualifiersCount:v,drawDefinition:e,stage:Ut});if(b.error||(b=Qx({drawSize:h,stage:zt,drawDefinition:e}),b.error))return b;uQe({drawDefinition:e,drawEntries:a,event:u});let y=dQe({mainStructure:A,qualifyingDetails:m,drawDefinition:e});return y.error?y:{drawDefinition:e,structureId:s}}function uQe({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===zt)){let n={...r,entryStage:r.entryStage??Ut,drawDefinition:t,event:i};zW(n)}}function dQe({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){for(let r of e||[]){let{finalQualifyingRoundNumber:n,finalQualifyingStructureId:a,roundTarget:s,finishingPositions:o,linkType:l}=r,c=t&&yR({targetStructureId:t.structureId,sourceStructureId:a,sourceRoundNumber:n,finishingPositions:o,targetEntryRound:s,linkType:l})?.link;if(c?.error)return c;c&&(i.links||(i.links=[]),i.links.push(c))}return{error:void 0}}function _Ae(t){let{participantIds:e}=t,i=t.drawDefinition?.entries?.filter(r=>{let n=r.entryStatus;return!t.restrictEntryStatus||Pd.includes(n)}).map(ji)??[];if(e){let r=e.filter(n=>!i?.includes(n));if(r?.length)return le({result:{error:np},info:{invalidParticipantIds:r}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:be,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:be,info:"roundsCount must be less than 32"}:{participantIds:e}}function X5(t){let e=[],{roundsCount:i=1,drawDefinition:r,matchUpsCount:n,structureId:a,idPrefix:s,isMock:o,event:l}=t,c,u=_Ae(t);if(u.error)return u;for(let d of gt(1,i+1)){let p=uL({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!c,newRound:!c,drawDefinition:r,matchUpsCount:n,structureId:a,roundNumber:c,idPrefix:s,isMock:o,event:l});if(p.error)return le({result:p,info:{iteration:d}});p.matchUps?.length&&e.push(...p.matchUps),c=(p?.roundNumber??1)+1}return{matchUps:e}}function pQe(t){let{tournamentRecord:e,participantIds:i,scaleName:r,eventType:n,adHocRatings:a={}}=t,s=t.scaleAccessor??za[r]?.accessor,o=e.participants??[];for(let l of i??[]){let c=o?.find(d=>d.participantId===l),u=See({scaleName:`${r}.${Zq}`,participant:c,eventType:n});!u&&r&&(u=See({scaleAccessor:s,participant:c,scaleName:r,eventType:n})),u&&!a[l]&&(a[l]=u)}return a}function See({scaleType:t=rg,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){let a=(i&&rh({scaleAttributes:{eventType:n??$I,scaleType:t,scaleName:r},participant:i}))?.scaleItem?.scaleValue;return e&&Ki(a)?a[e]:a}function Z5(t){let e=hQe(t);if(e?.error)return e;let i=_Ae(t);if(i.error)return i;let r=fQe(t);if(r.error)return r;let n=pQe(t),a=t.tournamentRecord?.isMock??t.isMock,s=t.eventType??t.event?.eventType,o=[],l=[],c;for(let u of gt(1,(t.roundsCount??1)+1)){let d=$5({...t,participantIds:i.participantIds,structure:r.structure,ignoreLastRoundNumber:!0,iterationMatchUps:o,adHocRatings:n,roundNumber:c,eventType:s,isMock:a});if(d.error)return d;let{matchUps:p,...f}=d;f.modifiedScaleValues&&(n=f.modifiedScaleValues),l.push({...f,iteration:u,matchUpsCount:p?.length}),c=(f?.roundNumber??1)+1,p?.length&&o.push(...p)}return{...se,matchUps:o,roundResults:l}}function fQe(t){if(t.structureId)return t.structureId;let e=t.drawDefinition,i=e?.structures?.filter(n=>n.stageSequence===1)?.reduce((n,a)=>{let s=a.stage&&HI[a.stage];return Yo({structure:a})&&s>(HI[n?.stage]||1)?a:n},void 0),r=e?.structures?.find(n=>n.structureId===i?.structureId);return r?Yo({structure:r})?{structure:r}:{error:AI}:{error:nn}}function hQe(t){return t.roundsCount&&typeof t.roundsCount!="number"?{error:be,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==zl?{error:AI}:!Array.isArray(t.drawDefinition?.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:be,info:"Missing Entries"}:{error:void 0}}function mQe(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,idPrefix:n,isMock:a,event:s}=t,o=s?.entries?.filter(({entryStage:u,entryStatus:d})=>(!u||u===Ut)&&d&&Pd.includes(d)),l=o?.map(ji),c=o?Math.floor(o.length/2):0;if(t.automated)return AQe({...t,participantIds:l});{let u=X5({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:c,idPrefix:n,isMock:a,event:s});if(u.error)return u;u.matchUps?.length&&aL({matchUps:u.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:r,event:s})}return{...se}}function AQe(t){let{restrictEntryStatus:e,generateMatchUps:i,structureId:r,matchUpIds:n,scaleName:a,scaleAccessor:s}=t.drawMatic??{},o=Z5({...t,eventType:t.drawMatic?.eventType??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:s??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:r,matchUpIds:n});return o.error?o:(o?.matchUps?.length&&aL({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:o.matchUps,event:t.event,structureId:r}),{...se})}function gQe({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,seedsCount:c}){r=r??n;let u=ui({drawDefinition:s,structureId:l});if(u.error)return u;let d=u.structure;if(!d)return{error:nn};let{positionAssignments:p}=va({structure:d}),f=p?.length||0;if(c>f)return{error:fue};let h=d.structures?.length,m=yi(o?.groupSeedingThreshold)&&o?.groupSeedingThreshold,A=e5({roundRobinGroupsCount:h,drawSize:f})?.seedGroups,{seedsCount:g}=PR({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:f});return g&&a?.[Wu]&&c>g&&e&&(c=g),d.seedLimit=c,d.seedAssignments=gt(1,c+1).map(v=>{let b=A?.find(w=>w.includes(v)),y=b&&Math.min(...b),I=m&&v>=m?y:v;return{participantId:void 0,seedNumber:v,seedValue:I}}),Br({drawDefinition:s,structureIds:[l]}),{...se,seedLimit:c}}function Ww({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:s,stage:o}){if(!e)return{error:rt};a=a??s?.entries??[];let l=a.filter(f=>(!o||!f.entryStage||f.entryStage===o)&&(!n||!f.entryStageSequence||f.entryStageSequence===n)&&Pd.includes(f.entryStatus)),c={...i};return{scaledEntries:l.map(f=>{let{participantId:h}=f,{scaleItem:m}=zI({tournamentRecord:e,scaleAttributes:i,participantId:h});return{...f,...m}}).filter(f=>{let h=f.scaleValue;return!r&&(Number.isNaN(h)||!Number.parseFloat(h))?!1:h}).sort(r||(t||c?.ascending===!1?d:u))};function u(f,h){return p(f)-p(h)}function d(f,h){return p(h)-p(f)}function p(f){return Number.parseFloat(f.scaleValue||(t?-1:1e5))}}function OAe(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=yd({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r?.find(({structureId:f})=>!n.includes(f));if(!a)return le({result:{error:nn},stack:e});let s=a?.structureId,{seedsCount:o,stageEntries:l,seedLimit:c}=TQe({...t,structureId:s});(t.seededParticipants||t.event||t.seedingScaleName)&&bQe({...t,seedsCount:o,structure:a,structureId:s});let u=t.automated!==!1&&t.drawType!==zl&&!(t.qualifyingOnly&&t.stage!==zt),d=(r?.length||0)>1,p=u?yQe({...t,multipleStructures:d,seedLimit:c,structureId:s}):{};return p?.error?le({result:p,stack:e}):{...p,stageEntries:l,structureId:s,seedsCount:o}}function vQe({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{let a=Bi({name:Ef,element:n})?.extension?.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!a||a===r)&&ob.includes(n.entryStatus)})}function yQe(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=vR({...t,seedsOnly:e});if(i.error)return i;let r=i?.positionAssignments,n=i?.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function bQe(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(ji);e?IQe({...t,enteredParticipantIds:a}):(n||i)&&wQe({...t,enteredParticipantIds:a})}function IQe(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,structure:c,event:u}=t,d=c?Vw({provisionalPositioning:e,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structure:c}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,f)=>p.seedNumber<f.seedNumber?-1:p.seedNumber<f.seedNumber?1:0).forEach(p=>{let{participantId:f,seedNumber:h,seedValue:m}=p;zC({provisionalPositioning:e,tournamentRecord:n,drawDefinition:s,seedingProfile:o,participantId:f,seedBlockInfo:d,structureId:l,seedNumber:h,seedValue:m,event:u})})}function wQe(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:s,drawDefinition:o,seedByRanking:l,seedingProfile:c,structureId:u,event:d}=t,{categoryName:p,ageCategoryCode:f}=d?.category||{};d?.eventType;let h=SQe({...t})||l&&UQe({...t}),m=h?.length??0;m<e&&(e=m),h?.filter(({participantId:A})=>r.includes(A)).slice(0,a||e).forEach((A,g)=>{let v=g+1,{participantId:b,scaleValue:y}=A,I=n?.[v]||y||v;zC({provisionalPositioning:i,tournamentRecord:s,drawDefinition:o,seedingProfile:c,participantId:b,structureId:u,seedNumber:v,seedValue:I,event:d})})}function SQe(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:s}=t,{categoryName:o,ageCategoryCode:l}=s?.category||{},c=s?.eventType,u={scaleName:i||o||l||s.eventId,scaleType:eh,eventType:c};return Ww({scaleAttributes:u,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function UQe(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:s,ageCategoryCode:o}=r?.category||{},l=r?.eventType;return Ww({scaleAttributes:{scaleName:s||o,scaleType:ug,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function TQe(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=vQe(t);e>i.length&&(e=i.length);let{seedLimit:r}=gQe({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function CQe(t){let e=F5({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:s,seedingProfile:o,participants:l,drawEntries:c,placeByes:u,drawSize:d,drawType:p,entries:f}=t,h=[],m=[],A=EQe({ignoreStageSpace:n,drawDefinition:i,drawEntries:c,drawType:p,entries:f});if(A.error)return A;let g=p===ib?0:ri(t.seedsCount??0),v=OAe({...t,qualifyingOnly:!d||s,appliedPolicies:a,drawDefinition:i,seedingProfile:o,participants:l,stage:Ut,seedsCount:g,placeByes:u,drawSize:d,entries:f});if(v.error&&!v.conflicts)return v;v.positioningReport?.length&&h.push({[Ut]:v.positioningReport});let b=v.structureId;return v.conflicts&&(m=v.conflicts),p===zl&&t.roundsCount&&mQe({...t,drawDefinition:i,structureId:b}),{drawDefinition:i,positioningReports:h,conflicts:m,structureId:b}}function EQe(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let s of a){if(r&&s.entryStage&&s.entryStage!==Ut)continue;let o={...s,ignoreStageSpace:e??n===zl,entryStage:s.entryStage??Ut,event:t.event,drawDefinition:i,drawType:n},l=zW(o);if(r&&l.error)return l}return{error:void 0}}var DQe=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),PQe=DQe;function RQe(t){let{drawId:e=fr(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=PQe();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function J5(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:s,event:o}=t,l=Gt(t,[{[to]:!0,[zq]:!0}]);if(l.error)return l;if(!Ql({matchUpFormat:n}))return{error:N1};let c="setMatchUpFormat";if(s){let u=Wr({drawDefinition:r,matchUpId:s,event:o});if(u.error)return u;let d=u.matchUp;if(d?.matchUpType===ca)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:bl};d&&(d.matchUpFormat=n,Yi({tournamentId:i?.tournamentId,eventId:o?.eventId,context:c,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if(o?.eventType===ca)return{error:ph};for(let u of e){let d=ui({drawDefinition:r,structureId:u});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if(o?.eventType===ca)return{error:ph};let u=ui({drawDefinition:r,structureId:a});if(u.error)return u;u.structure&&(u.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),Br({drawDefinition:r,structureIds:e}),{...se}}function MQe({tieFormat:t}){let e=Ko({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=fr());return{tieFormat:t}}function NQe({existingQualifyingStructures:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUpType:n,tieFormat:a,event:s}){if((r||a)&&!(r&&s?.matchUpFormat===r||s?.tieFormat&&a&&JSON.stringify(s.tieFormat)===JSON.stringify(a))){if(a){let o=MQe({tieFormat:a});if(o.error)return o;let l=t?.every(c=>c.tieFormat);(!t?.length||l)&&(i.tieFormat=o.tieFormat??a)}else if(r){let o=J5({tournamentRecord:e,drawDefinition:i,matchUpFormat:r,event:s});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}n&&(i.matchUpType=n)}return{error:void 0}}var eK={};Fi(eK,{attachPolicies:()=>Dy,findPolicy:()=>ab,getAppliedPolicies:()=>er,getPolicyDefinitions:()=>uA,mutate:()=>FAe,query:()=>$Ae,removePolicy:()=>LAe});var FAe={};Fi(FAe,{attachPolicies:()=>Dy,removePolicy:()=>LAe});function LAe(t){let e=Gt(t,[{[kFe]:!0,_anyOf:{[Xs]:!1,[Sa]:!1,[to]:!1,[lA]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return Uee(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:rt};for(let a of n){let s=t.tournamentRecords[a],o=Uee(t,s);if(o.error)return o;i=!0}}else return{error:rt};return i?{...se}:{error:B1}}function Uee(t,e){let i=er(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?lr({element:e,extension:{name:lP,value:i}}):Eo({element:e,name:lP}),{...se}):{error:B1}}var $Ae={};Fi($Ae,{findPolicy:()=>ab,getAppliedPolicies:()=>er,getPolicyDefinitions:()=>uA});var HAe={[Wu]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[vh]:{positioning:by},[gd]:{positioning:by}},positioning:Upe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},Yj=HAe;function BQe({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return le({info:"policyDefinitions must be an object",result:{error:be},stack:r});let n={[oP]:t?.[oP]};return e?kQe({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&Dy({drawDefinition:i,policyDefinitions:n}),!t?.[Wu]&&!e?.[Wu]&&(Dy({policyDefinitions:Yj,drawDefinition:i}),t&&Object.assign(t,Yj)),{error:void 0}}function kQe({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e?.[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(Dy({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function xQe(t){let{tournamentRecord:e,policyDefinitions:i,appliedPolicies:r,matchUpFormat:n,matchUpType:a,tieFormat:s,drawType:o,stack:l,event:c}=t,u=t.drawId?c?.drawDefinitions?.find(g=>g.drawId===t.drawId):void 0,d=u?.structures?.find(g=>g.stage===Ut&&g.stageSequence===1)?.structureId,p=u?u.structures?.filter(g=>g.stage===zt):[],f=p?.length===1&&!p[0].matchUps?.length&&p[0].structureId;u&&o!==u.drawType&&(u.drawType=o);let h=u??RQe({processCodes:t.processCodes,drawId:t.drawId,drawType:o}),m=NQe({existingQualifyingStructures:p,tournamentRecord:e,drawDefinition:h,matchUpFormat:n,matchUpType:a,tieFormat:s,event:c});if(m.error)return le({result:m,stack:l});let A=BQe({appliedPolicies:r,policyDefinitions:i,drawDefinition:h,stack:l});return A.error?A:{drawDefinition:h,structureId:d,existingDrawDefinition:u,existingQualifyingPlaceholderStructureId:f}}function _Qe(t){let e="generateOrGetExisting",i=[],r=[],n=xQe(t);if(n.error)return le({result:n,stack:e});let a=n.existingDrawDefinition,s,o,l=t.drawEntries??t.eventEntries??[],c=n.existingQualifyingPlaceholderStructureId&&cQe({...t,...n})||CQe({...t,...n,entries:l});return c.error?le({result:c,stack:e}):(c.positioningReports?.length&&i.push(...c.positioningReports??[]),c.conflicts?.length&&r.push(...c.conflicts??[]),s=c.drawDefinition,o=c.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:s,structureId:o,conflicts:r,entries:l})}function OQe(t){let{qualifyingPlaceholder:e,existingDrawDefinition:i,positioningReports:r,qualifyingProfiles:n,appliedPolicies:a,qualifyingOnly:s,drawDefinition:o,seedingProfile:l,participants:c,structureId:u,tieFormat:d,entries:p,stack:f}=t,h=e&&!n?.length&&!i,m=[];if(n){let A=(y,I)=>y.stageSequence-I.stageSequence,g=(y,I)=>y.roundTarget-I.roundTarget,v=[],b=1;n.sort(g);for(let y of n){if(!Array.isArray(y.structureProfiles))return le({info:Ey("structureProfiles"),result:{error:Kt},stack:f});b=y.roundTarget||b;let I=y.structureProfiles?.sort(A)||[],w=1;for(let S of I){let{qualifyingRoundNumber:T,qualifyingPositions:D,seededParticipants:C,seedingScaleName:E,seedsCount:P=0,seedByRanking:R,placeByes:M,drawSize:N}=S,k=OAe({...t,seedingProfile:S.seedingProfile??l,stageSequence:w,qualifyingRoundNumber:T,preparedStructureIds:v,qualifyingPositions:D,seededParticipants:C,stage:zt,seedingScaleName:E,appliedPolicies:a,drawDefinition:o,qualifyingOnly:s,seedByRanking:R,participants:c,roundTarget:b,seedsCount:P,placeByes:M,drawSize:N,entries:p});if(k.error)return k;k.structureId&&v.push(k.structureId),w+=1,k.conflicts?.length&&m.push(...k.conflicts),k.positioningReport?.length&&r.push({[zt]:k.positioningReport})}b+=1}}else if(u&&h){let A=iu({structureName:Bs(zt),stage:zt,qualifyingOnly:s,tieFormat:d}),{link:g}=yR({sourceStructureId:A.structureId,targetStructureId:u,sourceRoundNumber:0,linkType:mh});o.structures||(o.structures=[]),o.structures.push(A),o.links||(o.links=[]),o.links.push(g)}return{qualifyingConflicts:m,error:void 0}}var NR={};Fi(NR,{addGoesTo:()=>Cy,allCompetitionMatchUps:()=>sp,allDrawMatchUps:()=>Do,allEventMatchUps:()=>Vh,allPlayoffPositionsFilled:()=>o5,allTournamentMatchUps:()=>La,analyzeDraws:()=>CR,analyzeMatchUp:()=>bP,analyzeTournament:()=>uK,bulkUpdatePublishedEventIds:()=>pK,calculateWinCriteria:()=>Kw,categoryCanContain:()=>F1,checkMatchUpIsComplete:()=>ty,checkValidEntries:()=>cL,compareTieFormats:()=>Hm,competitionScheduleMatchUps:()=>OR,courtGridRows:()=>EL,credits:()=>FQe,drawMatchUps:()=>CK,eventMatchUps:()=>RL,filterMatchUps:()=>hm,filterParticipants:()=>fR,findDrawDefinition:()=>M5,findExtension:()=>Bi,findVenue:()=>Hh,getAggregateTeamResults:()=>cK,getAllDrawMatchUps:()=>ea,getAllEventData:()=>fK,getAllStructureMatchUps:()=>cr,getAllowedDrawTypes:()=>vL,getAllowedMatchUpFormats:()=>sK,getAppliedPolicies:()=>er,getAssignedParticipantIds:()=>cb,getAvailableMatchUpsCount:()=>sL,getAvailablePlayoffProfiles:()=>IR,getCategoryAgeDetails:()=>yy,getCheckedInParticipantIds:()=>Ow,getCompetitionDateRange:()=>bL,getCompetitionMatchUps:()=>yP,getCompetitionParticipants:()=>tK,getCompetitionPenalties:()=>oK,getCompetitionVenues:()=>BR,getCourtInfo:()=>GF,getCourts:()=>EK,getDrawData:()=>oL,getDrawDefinitionTimeItem:()=>DW,getDrawParticipantRepresentativeIds:()=>P5,getDrawStructures:()=>yd,getDrawTypeCoercion:()=>DR,getEligibleVoluntaryConsolationParticipants:()=>D5,getEntriesAndSeedsCount:()=>DL,getEvent:()=>RK,getEventData:()=>ER,getEventMatchUpFormatTiming:()=>gK,getEventProperties:()=>DK,getEventPublishStatus:()=>Su,getEventStructures:()=>XF,getEventTimeItem:()=>X1,getEvents:()=>PK,getFlightProfile:()=>Bn,getHomeParticipantId:()=>IK,getLinkedTournamentIds:()=>q1,getMatchUpCompetitiveProfile:()=>sR,getMatchUpContextIds:()=>wK,getMatchUpDailyLimits:()=>NL,getMatchUpDailyLimitsUpdate:()=>vK,getMatchUpDependencies:()=>Rd,getMatchUpFormat:()=>SK,getMatchUpFormatTiming:()=>oR,getMatchUpFormatTimingUpdate:()=>AK,getMatchUpScheduleDetails:()=>QF,getMatchUpType:()=>jF,getMatchUpsMap:()=>ss,getMatchUpsStats:()=>UK,getMatchUpsToSchedule:()=>SL,getMaxEntryPosition:()=>mK,getModifiedMatchUpFormatTiming:()=>PL,getPairedParticipant:()=>bd,getParticipantEventDetails:()=>iK,getParticipantIdFinishingPositions:()=>R5,getParticipantMembership:()=>rK,getParticipantResults:()=>wR,getParticipantScaleItem:()=>zI,getParticipantSchedules:()=>nK,getParticipantSignInStatus:()=>aK,getParticipantTimeItem:()=>PW,getParticipants:()=>gn,getPersonRequests:()=>pb,getPolicyDefinitions:()=>uA,getPositionAssignments:()=>ET,getPositionsPlayedOff:()=>WC,getPredictiveAccuracy:()=>bK,getProfileRounds:()=>CL,getPublishState:()=>$w,getRandomQualifierList:()=>x5,getRoundMatchUps:()=>ko,getRounds:()=>TK,getScaleValues:()=>_C,getScaledEntries:()=>Ww,getScheduledRoundsDetails:()=>kR,getSchedulingProfile:()=>hA,getSchedulingProfileIssues:()=>hK,getSeedingThresholds:()=>t5,getSeedsCount:()=>PR,getStructureSeedAssignments:()=>pu,getTeamLineUp:()=>Ty,getTieFormat:()=>wL,getTimeItem:()=>yu,getTournamentIds:()=>j1,getTournamentInfo:()=>qw,getTournamentPenalties:()=>yL,getTournamentPersons:()=>lK,getTournamentPoints:()=>IL,getTournamentPublishStatus:()=>pR,getTournamentStructures:()=>s5,getTournamentTimeItem:()=>OF,getValidGroupSizes:()=>AR,getVenueData:()=>TT,getVenuesAndCourts:()=>fA,isAdHoc:()=>Yo,isCompletedStructure:()=>Sh,isValidForQualifying:()=>_5,isValidMatchUpFormat:()=>Ql,matchUpActions:()=>lL,participantScaleItem:()=>rh,participantScheduledMatchUps:()=>yK,positionActions:()=>k5,publicFindCourt:()=>$W,publicFindVenue:()=>LW,tallyParticipantResults:()=>KC,tieFormatGenderValidityCheck:()=>fF,tournamentMatchUps:()=>ML,validMatchUp:()=>FF,validMatchUps:()=>wu,validateCollectionDefinition:()=>L1,validateLineUp:()=>YF});function FQe(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Miro, Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var VAe={};Fi(VAe,{filterParticipants:()=>fR,getCompetitionParticipants:()=>tK,getPairedParticipant:()=>bd,getParticipantEventDetails:()=>iK,getParticipantMembership:()=>rK,getParticipantScaleItem:()=>zI,getParticipantSchedules:()=>nK,getParticipantSignInStatus:()=>aK,getParticipantTimeItem:()=>PW,getParticipants:()=>gn,getScaleValues:()=>_C,participantScaleItem:()=>rh,validateLineUp:()=>YF});function tK(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:yn};let i=[],r={},n={},a={},s=[],o={},l=[];for(let c of Object.values(e)){let{participantIdsWithConflicts:u,mappedMatchUps:d,participantMap:p,participants:f,matchUps:h,derivedEventInfo:m,derivedDrawInfo:A}=gn({...t,tournamentRecord:c});Object.assign(o,d),Object.assign(r,p),Object.assign(n,m),Object.assign(a,A),i.push(...f??[]),s.push(...h??[]),u?.forEach(g=>{l.includes(g)||l.push(g)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:o,participants:i,...se,matchUps:s}}function iK({tournamentRecord:t,participantId:e}){if(!t)return{error:rt};if(!e)return{error:ga};let i=[e].concat((t.participants??[]).filter(r=>r?.participantType&&[gr,Mi].includes(r.participantType)&&r.individualParticipantIds?.includes(e)).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=(r?.entries??[]).map(a=>a.participantId);return Bo(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function rK({tournamentRecord:t,participantId:e}){if(!t)return{error:rt};if(!e)return{error:ga};let{participants:i}=gn({participantFilters:{participantTypes:[gr,Mi,xc]},tournamentRecord:t});return(i??[]).filter(r=>r.individualParticipantIds?.includes(e)).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function nK({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:rt};if(typeof t!="object")return{error:oA,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=La({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),s=Rd({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],o={};for(let l of a){let{sides:c}=l,u,d=c?.map(f=>{if(f.participant)return[f.participant].concat(...f.participant.individualParticipants||[]);s[l.matchUpId]&&!u&&(u=(s[l.matchUpId]||[]).map(h=>n[h]).filter(({winningSide:h,bye:m})=>!h&&!m))}).filter(Boolean).flat()??[];for(let f of d){let{participantId:h}=f;o[h]||(o[h]={potentialMatchUps:[],participant:f,matchUps:[]}),o[h].matchUps.push(l)}let p=u?.map(({sides:f})=>f).flat().map(({participant:f})=>f&&[f].concat(...f.individualParticipants||[])).filter(Boolean).flat()||[];for(let f of p){let{participantId:h}=f;o[h]||(o[h]={potentialMatchUps:[],participant:f,matchUps:[]}),o[h].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(o).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...se}}function aK({tournamentRecord:t,participantId:e}){if(!t)return{error:rt};if(!e)return{error:ga};let{participant:i}=zg({tournamentRecord:t,participantId:e});if(!i)return{error:On};let{timeItem:r}=yu({itemType:Y1,element:i});return r&&r.itemValue===dP&&dP}var GAe={};Fi(GAe,{analyzeDraws:()=>CR,analyzeTournament:()=>uK,getAggregateTeamResults:()=>cK,getAllowedDrawTypes:()=>vL,getAllowedMatchUpFormats:()=>sK,getAppliedPolicies:()=>er,getCompetitionDateRange:()=>bL,getCompetitionPenalties:()=>oK,getPolicyDefinitions:()=>uA,getTournamentInfo:()=>qw,getTournamentPenalties:()=>yL,getTournamentPersons:()=>lK,getTournamentPoints:()=>IL,getTournamentStructures:()=>s5,getTournamentTimeItem:()=>OF});function sK({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:rt};let{appliedPolicies:r}=er({tournamentRecord:t});return(r?.[du]?.matchUpFormats||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function vL({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:rt};let{appliedPolicies:r}=er({tournamentRecord:t});return(r?.[kx]?.allowedDrawTypes||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function yL({tournamentRecord:t}){if(!t)return{error:rt};let e=(t?.participants??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:s}=a||{};i[s]?i[s].participants.push(n):i[s]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function oK({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:yn};let e=[];for(let i of Object.values(t)){let{penalties:r}=yL({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function bL({tournamentRecords:t}){if(!Ki(t))return{error:yn};let e=Object.keys(t??{}).reduce((n,a)=>{let s=t[a],{tournamentInfo:{startDate:o,endDate:l}}=qw({tournamentRecord:s}),c=o&&Si(o),u=c&&new Date(c);(!n.startDate||u&&u<n.startDate)&&(n.startDate=u);let d=l&&Si(l),p=d&&new Date(d);return(!n.endDate||p&&p>n.endDate)&&(n.endDate=p),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&Si(e.startDate.toISOString()),r=e.endDate&&Si(e.endDate.toISOString());return!i||!r?{error:Nue}:{startDate:i,endDate:r}}function lK({tournamentRecord:t,participantFilters:e}){if(!t)return{error:rt};let i=t.participants||[];e&&(i=fR({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:s}=a.person;r[s]?r[s].participantIds.push(a.participantId):r[s]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function cK(t){let e=Gt(t,[{[Sa]:!0}]);if(e.error)return e;let i=t.finishingPositionRangeBounsPoints||{},r={},n=d=>{let p=d?.individualParticipants?.map(f=>f.teams?.length===1&&f.teams[0]);return d?.teams?.length===1&&d?.teams?.[0]||p?.[0].participantId===p?.[1].participantId&&p?.[0]},{matchUps:a,participants:s}=gn({participantFilters:{participantTypes:[zi]},withRankingProfile:!0,withStatistics:!0,...t});for(let d of s??[]){if(d.participantType===zo)continue;d.draws?.[0]?.drawId==="draw-0-3"&&console.log(d.participantType,d.draws[0].finishingPositionRange);let p=n(d);if(p)for(let f of d?.draws??[]){let h=f?.finishingPositionRange?.join("-");if(h&&i?.[h]){let m=p?.participantId,A=f?.drawId,g=`${m}|${A}|${h}`;r[g]=i[h]}}}let o=d=>({teamName:d,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),l=(d,p,f)=>{d[p]===void 0&&(d[p]=0),d[p]+=f},c={},u={};for(let d of a??[]){let{sides:p,matchUpFormat:f}=d,h=f&&vs(f);if(p?.length===2&&h.setFormat?.timed&&(!h.finalSetFormat||h.finalSetFormat?.timed))for(let m of p){let A=n(m.participant),g=A?.participantId,v=m.participant?.participantId,b=A?.participantName,y=m.sideNumber,I=m.participant?.individualParticipantIds||v&&[v]||[];if(I.forEach(w=>{w&&!c[w]&&(c[w]=o(b))}),g&&y){u[g]||(u[g]=o(b));let w=[...I.map(T=>c[T]),u[g]];d.winningSide&&(y===d.winningSide?w.forEach(T=>l(T,"win",1)):w.forEach(T=>l(T,"loss",1)));let S=d.score?.sets||[];for(let T of S){let D=T?.[`side${3-y}Score`]||0,C=T?.[`side${y}Score`]||0,E=C-D;w.forEach(P=>l(P,"pointsPlayed",C+D)),w.forEach(P=>l(P,"points",C)),w.forEach(P=>l(P,"diff",E))}}}}for(let d of Object.keys(r)){let[p]=d.split("|");u[p]&&(u[p].bonus+=r[d],u[p].pointsPct=parseFloat((u[p].points/u[p].pointsPlayed).toFixed(2)),u[p].standingPoints=u[p].win+u[p].bonus)}for(let d of Object.keys(c))c[d].pointsPct=parseFloat((c[d].points/c[d].pointsPlayed).toFixed(2));return{...se,individualResults:c,teamResults:u}}function LQe(t){let e=t.participants?.filter(({participantType:a})=>a===gr)?.length===2,i=t.events?.length===1&&t.events[0],r=i?.drawDefinitions?.length===1&&i.drawDefinitions[0],n=(r?.structures?.length===1&&r.structures[0])?.positionAssignments?.length===2;return!!(i.tieFormat&&e&&n)}function uK({tournamentRecord:t}){if(!t)return{error:rt};let{drawsAnalysis:e}=CR({tournamentRecord:t}),i={isDual:LQe(t),drawsAnalysis:e},r=gn({tournamentRecord:t});return r.missingParticipantIds?.length&&(i.missingParticipantIds=r.missingParticipantIds),{...se,analysis:i}}function QAe(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function $Qe(t){let{participation:e={},awardProfiles:i,startDate:r,eventType:n,drawSize:a,drawType:s,category:o,endDate:l,level:c}=t,{participationOrder:u,flightNumber:d,rankingStage:p}=e,f=h=>!r&&!l||!h.dateRanges?!0:h.dateRanges.some(m=>{let A=!r||!m.startDate||new Date(r)>new Date(m.startDate),g=!l||!m.endDate||new Date(l)<=new Date(m.endDate);return A&&g});return{awardProfile:i.find(h=>f(h)&&(!h.maxFlightNumber||d<=h.maxFlightNumber)&&(!h.drawTypes?.length||h.drawTypes?.includes(s))&&(!h.drawSizes?.length||h.drawSizes.includes(a))&&(!h.stages?.length||h.stages.includes(p))&&(!h.levels?.length||h.levels.includes(c))&&(!h.maxDrawSize||a<=h.maxDrawSize)&&(!h.drawSize||h.drawSize===a)&&(!h.maxLevel||c<=h.maxLevel)&&(!d||!h.flights?.flightNumbers?.length||h.flights.flightNumbers.includes(d))&&(!h.participationOrder||h.participationOrder===u)&&(!h.category?.ageCategoryCodes||h.category.ageCategoryCodes.includes(o?.ageCategoryCode))&&(!h.eventTypes?.length||h.eventTypes?.includes(n)))}}function Tee({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){let s=(h,m)=>{if(h){if(Array.isArray(m)){let A=m.find(g=>g.flight===h||g.f===h);return A.value||A.v}if(typeof m=="object"){let A=m.flights||m.f;if(Array.isArray(A))return A[h-1]}}},o=(h,m)=>{let A=h?.value||h?.v||(yi(h)?h:0),g=QAe(a,h?.level);return{value:s(m,g)||yi(g)&&g||A}},l=0,c,u,d,p,f=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let h=i.find(g=>g.drawSize===r||g.drawSizes?.includes(r)),m=i.find(g=>g.drawSize&&g.threshold&&r>g.drawSize),A=i.find(g=>!g.drawSize&&!g.drawSizes?.length);f!==void 0&&(h=h?.[f],m=m?.[f],A=A?.[f]),u=o(h,e).value,d=o(m,e).value,p=o(A,e).value,l=u||d||p,c=u&&h.requireWin||d&&m.requireWin||A?.requireWin}else if(typeof i=="object"){let h=i?.drawSizes?.[r],m=i;f!==void 0&&(h=h?.[f],m=m?.[f]),u=o(h,e).value,p=o(m,e).value,l=u||p,c=u?h.requireWin:m?.requireWin}else yi(i)&&f===void 0&&(l=i);return e&&n?.pct?.[e]&&(l=Math.round(l*n.pct[e])),{awardPoints:l,requireWin:c}}function IL({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){if(!i)return{error:rt};let{policyDefinitions:n}=uA({policyTypes:[Uk],tournamentRecord:i}),a=e?.[Uk]??n?.[Uk];if(!a)return{error:JO};let s=a.awardProfiles,o=a.requireWinFirstRound,l=a.requireWinForPoints,{participants:c,derivedEventInfo:u,derivedDrawInfo:d,mappedMatchUps:p}=gn({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),f=c?.filter(g=>g.draws?.length),h={},m={},A={};for(let g of f??[]){let{participantType:v,participantId:b,person:y,draws:I}=g;for(let w of I){let{drawId:S,structureParticipation:T,eventId:D}=w,C=u[D],E=d[S],P=E?.drawType,{category:R,eventType:M}=C||{},N=w.startDate||C.startDate||i.startDate,k=w.endDate||C.endDate||i.endDate;if(M===jl&&b!==zo)continue;let O;if(s){let x=l,F=0,_=0,V=0,G;for(let z of T){let{finishingPositionRange:Q,participationOrder:j,participantWon:W,flightNumber:Y,rankingStage:X,winCount:J}=z;F+=J||0;let ie=E?.drawSize,{awardProfile:ue}=$Qe({awardProfiles:s,participation:z,eventType:M,startDate:N,category:R,drawSize:ie,drawType:P,endDate:k,level:r});if(ue){if(!ie)continue;let ne=Array.isArray(Q)&&Math.max(...Q),ge=Ci(Q||[]).join("-"),he=ne&&X!==zt&&Q?.includes(ie);ue.requireWinForPoints!==void 0&&(x=ue.requireWinForPoints),ue.requireWinFirstRound!==void 0&&(o=ue.requireWinFirstRound);let{finishingPositionPoints:Ie={},finishingPositionRanges:xe,finishingRound:Je,pointsPerWin:qe,flights:dt}=ue,ft=Array.isArray(ue.perWinPoints)?ue.perWinPoints?.find(mt=>mt.participationOrders?.includes(j)):ue.perWinPoints,je=Ie.participationOrders,Tt=0,Oe;if((!je||je.includes(j))&&xe&&ne){let mt=xe[ne];mt&&({awardPoints:Tt,requireWin:Oe}=Tee({flightNumber:Y,valueObj:mt,drawSize:ie,flights:dt,level:r}))}if(!Tt&&Je&&j===1&&ne){let mt=Je[ne];mt&&({awardPoints:Tt,requireWin:Oe}=Tee({participantWon:W,flightNumber:Y,valueObj:mt,drawSize:ie,flights:dt,level:r}))}if(he&&o!==void 0&&(x=o),Oe!==void 0&&(x=Oe),Tt>_&&(!x||J)&&(_=Tt,G=ne),!Tt&&qe&&J&&(V+=J*qe,G=ge),!Tt&&J&&ft){let mt=QAe(r,ft?.level);mt?V+=J*mt:ft.value&&(V+=J*ft.value)}}if(O=_+V,v===zo){let ne=(g.matchUps||[]).filter(({structureId:ge})=>ge===z.structureId);for(let{matchUpId:ge}of ne){let he=p[ge],Ie=he.sides.find(xe=>xe.participantId===b).sideNumber;if(he.winningSice===Ie)for(let xe of he.tieMatchUps)xe.winningSide}}}if(V||_){let z={winCount:F,positionPoints:_,rangeAccessor:G,perWinPoints:V,eventType:M,drawId:S,points:O},Q=y?.personId;Q?(h[Q]||(h[Q]=[]),h[Q].push(z)):v===Mi?(A[b]||(A[b]=[]),A[b].push(z)):v===zo&&(m[b]||(m[b]=[]),m[b].push(z))}}}}return{participantsWithOutcomes:f,personPoints:h,pairPoints:A,teamPoints:m,...se}}var jAe={};Fi(jAe,{compareTieFormats:()=>Hm,getTieFormat:()=>wL,tieFormatGenderValidityCheck:()=>fF,validateCollectionDefinition:()=>L1});function Kx(t){if(!t)return{};let e=[],i=t.tieFormatName,r=t.collectionDefinitions?.map(n=>{let{matchUpType:a,matchUpFormat:s,matchUpCount:o,category:l,gender:c}=n;e.includes(s)||e.push(s);let u=l?.ageCategoryCode;return[o,a===Ay?"D":"S",u,s,c].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:r}}function Hm({considerations:t={},descendant:e,ancestor:i}){let r={},n={},{matchUpFormats:a,tieFormatDesc:s}=Kx(e),{matchUpFormats:o,tieFormatDesc:l}=Kx(i),c=Ci((a??[]).filter(I=>!(o??[]).includes(I)).concat((o??[]).filter(I=>!(a??[]).includes(I)))),u=!!(t?.collectionName&&e.collectionDefinitions.map(({collectionName:I})=>I).join("|")!==i.collectionDefinitions.map(({collectionName:I})=>I).join("|")),d=!!(t?.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:I})=>I).join("|")!==i.collectionDefinitions.map(({collectionOrder:I})=>I).join("|")),p=Object.assign({},...(e?.collectionDefinitions||[]).map(I=>({[I.collectionId]:I}))),f=Object.assign({},...(i?.collectionDefinitions||[]).map(I=>({[I.collectionId]:I})));r.collectionIds=QJ(Object.keys(p),Object.keys(f)),n.collectionIds=QJ(Object.keys(f),Object.keys(p)),r.collectionsValue=Cee(p),n.collectionsValue=Cee(f),r.groupsCount=i?.collectionGroups?.length??(0-(e?.collectionGroups?.length??0)||0),n.groupsCount=r.groupsCount?-1*r.groupsCount:0;let h=r.collectionsValue.totalValue-n.collectionsValue.totalValue,m=r.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,A=n.collectionsValue.assignmentValues.length!==r.collectionsValue.assignmentValues.length,g=n.collectionsValue.assignmentValues.some((I,w)=>{let S=r.collectionsValue.assignmentValues[w];return!S||I.valueKey!==S.valueKey||I.value!==S.value?!0:Array.isArray(I.value)?I.value.every((T,D)=>S.value[D]===T):!1}),v=u||d||l!==s||A||g||h!==0,b=[...n.collectionsValue.invalidValues,...r.collectionsValue.invalidValues],y=b.length&&b;return{matchUpFormatDifferences:c,matchUpCountDifference:m,descendantDifferences:r,ancestorDifferences:n,orderDifference:d,valueDifference:h,nameDifference:u,descendantDesc:s,ancestorDesc:l,...se,different:v,invalid:y}}function Cee(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort(qF).reduce((n,a)=>{let s=t[a],{collectionValueProfiles:o,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=s,f={collectionValueProfiles:o,collectionValue:l,matchUpValue:u,scoreValue:d,setValue:p},h=Object.keys(f).filter(A=>![void 0,null].includes(f[A])&&(!Array.isArray(f[A])||f[A].length>0));h.length!==1&&e.push({collectionId:a});let m=h[0];if(m){let A=m==="collectionValueProfiles"?Object.values(o):f[m];i.push({valueKey:m,value:A})}return r+=c,o?.length?n+o.reduce((A,g)=>A+g.value,0):c?yi(u)?n+u*c:yi(d)?n+d*c:yi(p)?n+p*c:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function dK(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=zAe(t);return{matchUp:St(e,!0,!0),error:i}}function zAe({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,matchUpId:o,inContext:l,eventId:c,drawId:u,event:d}){if(!i)return{error:rt};if(typeof o!="string")return{error:mo};if(!a||!d){let h=(La({tournamentRecord:i,nextMatchUps:s}).matchUps??[]).find(m=>m.matchUpId===o);if(!h)return{error:Ys};({eventId:c,drawId:u}=h),{event:d,drawDefinition:a}=Xo({tournamentRecord:i,eventId:c,drawId:u})}if(!a)return{error:Ec};n&&!r&&(r=dA({tournamentRecord:i,contextProfile:n}));let p={surfaceCategory:d?.surfaceCategory??i.surfaceCategory,indoorOutDoor:d?.indoorOutdoor??i.indoorOutdoor,endDate:d?.endDate??i.endDate,tournamentId:i.tournamentId,eventId:c??d?.eventId,drawId:u},{participants:f=[]}=nb({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(s){let h=(Do({context:l?p:void 0,participants:f,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,inContext:l,event:d}).matchUps??[]).find(A=>A.matchUpId===o);if(!h)return{error:Ys};let m=a?.structures?.find(A=>A.structureId===h.structureId);return{drawDefinition:a,structure:m,matchUp:h}}else{let{matchUp:h,structure:m}=Wr({context:l?p:void 0,tournamentParticipants:f,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:o,inContext:l,event:d});return{matchUp:h,structure:m,drawDefinition:a}}}function wL({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:s,event:o}){if(!t)return{error:rt};if(!s&&!o&&!i&&!r)return le({result:{error:Kt},stack:"getTieFormat"});a&&!o&&(o=t.events?.find(f=>f.eventId===a));let l=dK({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:s,event:o});if(r&&l?.error)return l;if(!e&&l?.drawDefinition&&(e=l?.drawDefinition),n=n??l?.structure,!n&&i&&!r){if(!e)return{error:fp};let f=ui({drawDefinition:e,structureId:i});if(f.error)return f;n=f.structure}let c=(n?.tieFormat||n?.tieFormatId)&&uo({structure:n,drawDefinition:e,event:o})?.tieFormat,u=(e?.tieFormat||e?.tieFormatId)&&uo({drawDefinition:e,event:o})?.tieFormat,d=uo({event:o})?.tieFormat,p=uo({matchUp:l?.matchUp,drawDefinition:e,structure:n,event:o})?.tieFormat;return{...se,matchUp:l?.matchUp,structureDefaultTieFormat:Ss(c),eventDefaultTieFormat:Ss(d),drawDefaultTieFormat:Ss(u),tieFormat:Ss(p),structure:n}}var qAe={};Fi(qAe,{bulkUpdatePublishedEventIds:()=>pK,getAllEventData:()=>fK,getCourtInfo:()=>GF,getDrawData:()=>oL,getEventData:()=>ER,getEventPublishStatus:()=>Su,getPublishState:()=>$w,getTournamentPublishStatus:()=>pR,getVenueData:()=>TT});function pK({tournamentRecord:t,outcomes:e}){if(!t)return{error:rt};if(!e?.length)return{error:Kt,info:"Missing outcomes"};let i=e.reduce((n,a)=>{let{drawId:s,eventId:o}=a;return o&&s&&(n[o]?n[o].includes(s)||n[o].push(s):n[o]=[s]),n},{}),r=Object.keys(i);return{publishedEventIds:(t.events?.filter(n=>r.includes(n.eventId))).filter(n=>{let a=Su({event:n}),{drawDetails:s,drawIds:o}=a??{},{eventId:l}=n;return i[l].filter(c=>{let u=s?Object.keys(a.drawDetails).filter(d=>jW({drawId:d,drawDetails:s})):[];return o?.includes(c)||u.includes(c)}).length}).map(n=>n.eventId),eventIdPublishedDrawIdsMap:i}}function WAe({dates:t=[],extension:e}){if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=Ki(e.value)?e.value?.dates:void 0;if(Array.isArray(i))return i?.length?!!i.filter(r=>!t.length||t.includes(r)).length:!1}function KAe({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){let n={...St(r,t,!0),venueId:i.venueId},{extension:a}=Bi({name:Yd,element:r});if(e&&a){let s=Ki(a.value)?a.value?.dates:void 0,o=a?.value===!0?[]:n.dateAvailability.map(l=>{let c=l.date;if(!(!c||s.includes(c)))return l}).filter(Boolean);n.dateAvailability=o}return{inContextCourt:n}}function HQe(t,e,i){if(e.length&&!e.includes(t.venueId))return!1;if(i){let{extension:r}=Bi({name:Yd,element:t});if(r?.value)return!1}return!0}function VQe({venue:t,convertExtensions:e,ignoreDisabled:i,dates:r,uniqueVenueIds:n,venues:a,uniqueCourtIds:s,courts:o}){n.includes(t.venueId)||(a.push(St(t,e,!0)),n.push(t.venueId));for(let l of t.courts??[])if(!s.includes(l.courtId)){if(i){let{extension:u}=Bi({name:Yd,element:l});if(WAe({extension:u,dates:r}))continue}let{inContextCourt:c}=KAe({convertExtensions:e,ignoreDisabled:i,venue:t,court:l});o.push(c),s.push(l.courtId)}}function fA(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},s=[],o=[],l=[],c=[];return Object.keys(a).filter(u=>!t.tournamentId||u===t.tournamentId).forEach(u=>{let d=a[u];for(let p of d.venues??[])HQe(p,r,!!i)&&VQe({venue:p,convertExtensions:e,ignoreDisabled:i,dates:n,uniqueVenueIds:s,venues:c,uniqueCourtIds:o,courts:l})}),{courts:l,venues:c,...se}}function GQe({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:yn};let n=St(e.venues??[],t).filter(s=>{if(!i)return s;let{extension:o}=Bi({name:Yd,element:s});return!o?.value&&s}).filter(Boolean),a=n.reduce((s,o)=>{let l=(o?.courts||[]).filter(c=>{if(!i&&!r?.length)return c;let{extension:u}=Bi({name:Yd,element:c});return WAe({extension:u,dates:r})}).filter(Boolean).map(c=>{let{inContextCourt:u}=KAe({convertExtensions:t,ignoreDisabled:i,venue:o,court:c});return u});return l.length?s.concat(l):s},[]);return{venues:n,courts:a}}function BR({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:yn}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:s}=GQe({tournamentRecord:a,dates:i});return s?.forEach(o=>{let{venueId:l,courts:c}=o;(!e||c?.length)&&!r.venueIds.includes(l)&&(r.venues.push(o),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function fK({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:rt};let i=t.events||[],r=t?.participants||[],{tournamentInfo:n}=qw({tournamentRecord:t}),{venues:a}=fA({tournamentRecord:t}),s=i.map(o=>{let{eventId:l}=o,c=Ume({event:o}).eventInfo,u=Z1({tournamentRecord:t,event:o}).scheduleTiming,d=(o.drawDefinitions||[]).map(f=>{let{drawId:h,drawName:m,matchUpFormat:A,updatedAt:g}=f,v={drawId:h,drawName:m,matchUpFormat:A,updatedAt:g},{abandonedMatchUps:b,completedMatchUps:y,upcomingMatchUps:I,pendingMatchUps:w}=VC({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:u,drawDefinition:f,event:o});return{drawInfo:v,matchUps:{abandonedMatchUps:b,completedMatchUps:y,upcomingMatchUps:I,pendingMatchUps:w}}}),p=Su({event:o});return Object.assign(c,{drawsData:d,publish:p}),c});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:s}}}var YAe={};Fi(YAe,{courtGridRows:()=>EL,findVenue:()=>Hh,getMatchUpsToSchedule:()=>SL,getPersonRequests:()=>pb,getProfileRounds:()=>CL,getScheduledRoundsDetails:()=>kR,getSchedulingProfile:()=>hA,getSchedulingProfileIssues:()=>hK,publicFindCourt:()=>$W});function PT({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){let{individualParticipantIds:n}=xF(r);i=i??r.schedule?.timeAfterRecovery;let a=c=>{t[c]||(t[c]=[]),t[c]=Ci(t[c].concat(...n))},s=c=>{i&&(!e[c]||i>e[c])&&(e[c]=i)},o=r.winnerTo?.matchUpId||r.winnerMatchUpId;o&&(i&&s(o),a(o));let l=r.loserTo?.matchUpId||r.loserMatchUpId;l&&(i&&s(l),a(l)),r.sidesTo?.length&&r.sidesTo.forEach(({matchUpId:c})=>{c&&(i&&s(c),a(c))})}function SL(t){let e=Gt(t,[{[Kq]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,orderedMatchUpIds:o,clearDate:l,matchUps:c}=t,u=s?Object.keys(s):[],d=(o??[]).map(f=>c.find(h=>h.matchUpId===f)).filter(Boolean).filter(f=>{let h=!l&&(r.includes(f.matchUpId)||u.includes(f.matchUpId)),m=["BYE",Mr,Ln,ql,Fa,Xr,mn,ha].includes(f?.matchUpStatus);return n||!h&&!f.winningSide&&!m}),p=i&&a?d.reduce((f,h)=>{let{drawId:m,tournamentId:A}=h;return f.matchUpMap[A]||(f.matchUpMap[A]={}),f.matchUpMap[A][m]?f.matchUpMap[A][m].push(h):f.matchUpMap[A][m]=[h],PT({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:h}),f},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function UL({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:s,eventType:o,eventId:l}){if(!Ql({matchUpFormat:r}))return{error:N1};let c=Object.keys(i).filter(d=>!s||d===s),u;return c.forEach(d=>{if(u)return;let p=i[d],f=l?Xo({tournamentRecord:p,eventId:l})?.event:void 0;return u=oR({tournamentRecord:p,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:f}),u?.averageMinutes||u?.recoveryMinutes}),{recoveryMinutes:u?.recoveryMinutes||t,averageMinutes:u?.averageMinutes||e,typeChangeRecoveryMinutes:u?.typeChangeRecoveryMinutes||u?.recoveryMinutes||t}}function kR(t){let e=Gt(t,[{[Xq]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[il]:zs}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:r=30}=t,n=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof n!="object")return{error:yn};let a={},s=[],o=t.rounds.toSorted((h,m)=>(h.sortOrder??0)-(m.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(n).map(h=>$C({tournamentRecord:h}).containedStructures)),c=t.matchUps??sp({nextMatchUps:!0,tournamentRecords:n}).matchUps,u=0,d={},p={},f={};return{scheduledRoundsDetails:o.flatMap(h=>{let m=h.periodLength||r,A=[];l?.[h.structureId]?A.push(...l[h.structureId]):A.push(h.structureId);let g=c?hm({tournamentIds:[h.tournamentId],roundNumbers:[h.roundNumber],matchUpIds:h.matchUpIds,eventIds:[h.eventId],drawIds:[h.drawId],processContext:!0,structureIds:A,matchUps:c}).sort(Lw):[],{segmentNumber:v,segmentsCount:b}=h.roundSegment||{};if(yi(v)&&rp(g?.length)&&rp(b)&&v>0&&v<=b&&b<g?.length&&!h.matchUpIds?.length){let S=g.length/b,T=S*(v-1);g=g.slice(T,T+S)}let y=n[h.tournamentId],I=Xo({drawId:h.drawId,tournamentRecord:y}).event,w=[];for(let S of g){let T=S.matchUpFormat;T&&(a[T]||(a[T]=[],a[T].push(S)),w.push(T))}for(let S of w){let{eventType:T,category:D}=I??{},{categoryName:C,ageCategoryCode:E}=D??{},{typeChangeRecoveryMinutes:P,recoveryMinutes:R,averageMinutes:M,error:N}=UL({categoryName:C??E,categoryType:D?.categoryType,tournamentId:h.tournamentId,eventId:h.eventId,tournamentRecords:n,matchUpFormat:S,eventType:T});if(N)return{error:N,round:h};let k=g.filter(x=>(i||!qn.includes(x.matchUpStatus))&&x.matchUpStatus!=="BYE").map(xa);k.forEach(x=>{f[x]={typeChangeRecoveryMinutes:P,recoveryMinutes:R,averageMinutes:M},d[x]=R,p[x]=M}),s.push(...k),u=Math.max(M||0,u);let O=`${M}|${m}`;return{roundPeriodLength:m,recoveryMinutes:R,averageMinutes:M,matchUpIds:k,hash:O}}}),greatestAverageMinutes:u,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:s,minutesMap:f,...se}}function XAe({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t?.map(o=>{let l=Si(o?.scheduleDate);if(!l){n.push(`Invalid date: ${o?.scheduledDate}`);return}let c=(o?.venues||[]).map(u=>{let{rounds:d,venueId:p}=u;if(!e?.includes(p)){n.push(`Missing venueId: ${p}`);return}let f=d.filter(h=>{let m=i.includes(h.eventId)&&r.includes(h.drawId);return m||n.push(`Invalid eventId: ${h.eventId} or drawId: ${h.drawId}`),m});if(f.length)return{venueId:p,rounds:f}}).filter(Boolean);return c.length&&l&&{...o,venues:c}}).filter(Boolean),s=n.length;return{updatedSchedulingProfile:a,modifications:s,issues:n}}function TL({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:be};let{venueIds:i,tournamentsMap:r}=jQe({tournamentRecords:t}),n,a,s=e.every(o=>{let{scheduleDate:l,venues:c}=o;return Co(l)?c.every(u=>{let{venueId:d,rounds:p}=u;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(f=>{if(!f)return a="empty round",!1;let{roundSegment:h,tournamentId:m,structureId:A,roundNumber:g,eventId:v,drawId:b}=f,y=r?.[m]?.[v]?.[b]?.[A]?.includes(g);y||(a="Invalid rounds");let{segmentNumber:I,segmentsCount:w}=h||{},S=!h||yi(I)&&rp(w)&&I<=w;return S||(a="Invalid segment"),y&&S}):(n=tb,!1):(a="rounds should be an array",!1)}):!1});return!s&&!n&&(n=be),{valid:!!s,error:n,info:a}}function QQe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],s=[],o=[],l=(e?.venues||[]).map(({venueId:u,courts:d})=>(!r||d?.length)&&u),c=e?.tournamentId;if(c){n.push(c),i[c]={};let u=e?.events||[];for(let d of u){let p=d.eventId;s.push(p),i[c][p]={};let f=h=>parseInt(h);for(let h of d.drawDefinitions||[]){let m=h.drawId;o.push(m),i[c][p][m]={};let{structures:A}=yd({drawDefinition:h});for(let g of A||[]){let v=g.structureId,{matchUps:b}=cr({structure:g}),{roundMatchUps:y}=ko({matchUps:b}),I=y&&Object.keys(y).map(f);if(i[c][p][m][v]=I,a.push(v),g.structures?.length)for(let w of g.structures)a.push(w.structureId),i[c][p][m][w.structureId]=I}}}}return{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:s,drawIds:o}}function jQe(t){let e=t?.tournamentRecords&&Object.values(t?.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:s,tournamentIds:o}=e.reduce((l,c)=>{let{tournamentIds:u,tournamentMap:d,structureIds:p,venueIds:f,eventIds:h,drawIds:m}=QQe({tournamentRecord:c});return f.forEach(A=>{l.venueIds.includes(A)||l.venueIds.push(A)}),l.tournamentIds.push(...u),l.structureIds.push(...p),l.eventIds.push(...h),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:o,structureIds:s,venueIds:r,eventIds:n,drawIds:a}}function hA({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:yn};let{extension:i}=Bi({element:e,name:QI,tournamentRecords:t,discover:!0}),r=i?.value||[];if(r.length){let{venueIds:n}=BR({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:s}=S5({tournamentRecords:t}),{updatedSchedulingProfile:o,modifications:l,issues:c}=XAe({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:s});if(l){r=o;let u=YC({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return u.error?u:{schedulingProfile:r,modifications:l,issues:c}}}return{schedulingProfile:r,modifications:0}}function YC({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=TL({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?lr({tournamentRecords:t,discover:!0,extension:{name:QI,value:i}}):Eo({element:e,name:QI,tournamentRecords:t,discover:!0})}function xR(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:c,issues:u}=hA({tournamentRecords:i,tournamentRecord:e});return{success:!c,modifications:c,issues:u}}let{venueIds:r}=BR({tournamentRecords:i}),{eventIds:n,drawIds:a}=S5({tournamentRecords:i}),{updatedSchedulingProfile:s,modifications:o,issues:l}=XAe({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return o?{...YC({schedulingProfile:s,tournamentRecords:i}),modifications:o,issues:l}:{...se,modifications:o,issues:l}}function hK(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:D1};if(!Array.isArray(e))return{error:be};if(!e.every(Co))return{error:fa};let n=[],a=0,s={},{schedulingProfile:o}=hA({tournamentRecords:i});if(!o)return{issues:n,...se};let{matchUps:l}=sp({nextMatchUps:!0,tournamentRecords:i});for(let u of o){let{scheduleDate:d,venues:p=[]}=u;if(!e?.length||e.includes(d)){for(let f of p||[])if(f){let{rounds:h}=f,m=[],{orderedMatchUpIds:A,scheduledRoundsDetails:g}=kR({tournamentRecords:i,periodLength:r,matchUps:l,rounds:h}),{matchUpDependencies:v}=Rd({tournamentRecords:i,matchUps:l}),b=y=>{let I;return g?.find((w,S)=>{let T=w.matchUpIds.includes(y);return T&&(I=S),T}),I};if(A?.forEach((y,I)=>{let w=A.slice(I+1),S=Pn(w,v?.[y]?.matchUpIds||[]);S.length&&m.push({matchUpId:y,shouldBeAfter:S})}),m.length){a+=m.length;let y=m.map(({matchUpId:I,shouldBeAfter:w})=>{let S=b(I),T=Ci(w.map(b));return s[d]||(s[d]={}),s[d][S]||(s[d][S]=[]),T.forEach(D=>{s[d][S].includes(D)||s[d][S].push(D)}),{matchUpId:I,matchUpRoundIndex:S,earlierRoundIndices:T,shouldBeAfter:w}});n.push(...y)}}}}let c={matchUpIdShouldBeAfter:Object.assign({},...n.map(u=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:f}=u;return{[d]:{earlierRoundIndices:f,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:c,roundIndexShouldBeAfter:s,...se}}function pb(t){let{tournamentRecords:e,requestType:i}=t,r=Gt(t,[{[Xs]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:s}=Bi({element:a,name:FC}),o=s?.value||[];for(let l of o){let{personId:c,requests:u}=l||{};n[c]||(n[c]=[]);for(let d of u)i&&d.requestType!==i||n[c].push(d)}}return{personRequests:n,...se}}function Xj(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:s,eventId:o,drawId:l}=t,c=r?e:s,u=[n,o,l,c,a].join("|");return Ft({structureId:c,roundSegment:i,tournamentId:n,roundNumber:a,eventId:o,drawId:l,id:u})}function Eee({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:s,categoryType:o}=n||{},{categoryName:l,ageCategoryCode:c}=s||{},u=Vl(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(u).forEach(p=>{let f=u[p],h=UL({categoryName:l||c,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:o,eventType:a});if(h.error)return h;let m=h.averageMinutes*f;isNaN(d)||(d+=m)}),{roundMinutes:d}}function zQe(t){return(t||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((a,s)=>a+s,0),n=(i.finishingPositionRange?.winner||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:n}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function Dee(t){let e=t.length,i=t.filter(({sides:c})=>c?.some(({bye:u})=>u)).length||0,r=t.filter(({winningSide:c,matchUpStatus:u})=>c||qn.includes(u)).length||0,n=t.filter(({schedule:c,matchUpStatus:u})=>c?.scheduledDate&&c?.scheduledTime&&u!=="BYE").length||0,a=e-i,s=a===r,o=a-n,l=a-n;return{unscheduledCount:o,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:s,byeCount:i}}function CL({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:D1};t={[i.tournamentId]:i}}if(e){let a=TL({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=hA({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:ts};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:s})=>a.map(({rounds:o})=>o.map(l=>{let c=Xj(l);return c.roundSegment?.segmentsCount&&(n[c.id]=c.roundSegment.segmentsCount),Ft({id:r?c.id:void 0,scheduleDate:s,...c})}))).flat(1/0),segmentedRounds:n}}function gg({court:t,date:e}){let i=e&&t.dateAvailability?.find(n=>hh(n.date,e)),r=t.dateAvailability?.find(n=>!n.date);return i||r}function qQe({court:t,date:e}){let i=gg({court:t,date:e}),r=new Map,n=[];return(i?.bookings||[]).forEach(a=>{if(typeof a.courtOrder=="number"){let s=a.rowCount||1;for(let o=0;o<s;o++)r.set(a.courtOrder+o,a)}else n.push(a)}),{gridBookings:r,timeBookings:n}}function EL({courtPrefix:t="C|",minRowsCount:e,courtsData:i,scheduledDate:r}){if(!Array.isArray(i))return{error:be};let n=i?.reduce((o,l)=>{let c=l.matchUps||[],u=Math.max(0,...c.map(d=>d.schedule.courtOrder||0));return Math.max(u,o)},1),a=Math.max(e||0,n),s=gt(0,a).map(o=>({matchUps:gt(0,i.length).map(l=>{let c=i[l],{courtId:u,venueId:d}=c;if(r){let{gridBookings:p}=qQe({court:c,date:r});if(p.has(o+1)){let f=p.get(o+1);return{schedule:{courtOrder:o+1,venueId:d,courtId:u},isBlocked:!0,booking:f}}}return{schedule:{courtOrder:o+1,venueId:d,courtId:u}}})}));return i.forEach((o,l)=>{for(let c of o.matchUps){let u=c.schedule?.courtOrder;u&&(s[u-1].matchUps[l]=c)}}),{courtPrefix:t,rows:s.map((o,l)=>Object.assign({rowId:`rowId-${l+1}`},...o.matchUps.map((c,u)=>({[`${t}${u}`]:c}))))}}var ZAe={};Fi(ZAe,{getEntriesAndSeedsCount:()=>DL,getMaxEntryPosition:()=>mK});function DL({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:Vr};let{entries:s,stageEntries:o}=Jfe({drawDefinition:e,drawId:r,stage:a,event:n}),l=o.length,{drawSize:c}=Lme({participantsCount:l}),u=PR({drawSize:i??c,participantsCount:l,policyDefinitions:t});if(u.error)return le({result:u,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=u;return{entries:s,seedsCount:d,stageEntries:o}}function mK(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>ri(n||0)),0)}var JAe={};Fi(JAe,{allCompetitionMatchUps:()=>sp,allDrawMatchUps:()=>Do,allEventMatchUps:()=>Vh,allTournamentMatchUps:()=>La,analyzeMatchUp:()=>bP,calculateWinCriteria:()=>Kw,checkMatchUpIsComplete:()=>ty,competitionScheduleMatchUps:()=>OR,drawMatchUps:()=>CK,eventMatchUps:()=>RL,filterMatchUps:()=>hm,getAllDrawMatchUps:()=>ea,getAllStructureMatchUps:()=>cr,getCheckedInParticipantIds:()=>Ow,getCompetitionMatchUps:()=>yP,getEventMatchUpFormatTiming:()=>gK,getHomeParticipantId:()=>IK,getMatchUpCompetitiveProfile:()=>sR,getMatchUpContextIds:()=>wK,getMatchUpDailyLimits:()=>NL,getMatchUpDailyLimitsUpdate:()=>vK,getMatchUpDependencies:()=>Rd,getMatchUpFormat:()=>SK,getMatchUpFormatTiming:()=>oR,getMatchUpFormatTimingUpdate:()=>AK,getMatchUpScheduleDetails:()=>QF,getMatchUpType:()=>jF,getMatchUpsStats:()=>UK,getModifiedMatchUpFormatTiming:()=>PL,getParticipantResults:()=>wR,getPredictiveAccuracy:()=>bK,getRoundMatchUps:()=>ko,getRounds:()=>TK,isValidMatchUpFormat:()=>Ql,matchUpActions:()=>lL,participantScheduledMatchUps:()=>yK,tallyParticipantResults:()=>KC,tournamentMatchUps:()=>ML,validMatchUp:()=>FF,validMatchUps:()=>wu});function ege({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:yn};let i=[],r;for(let n of Object.values(t)){let{extension:a}=Bi({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let s=n.events??[];for(let o of s){let{eventId:l}=o,{extension:c}=Bi({name:e,element:o});c&&i.push({params:{eventId:l,extension:c},method:"addEventExtension"})}}return{methods:i}}function AK({tournamentRecords:t}){return ege({extensionName:_m,tournamentRecords:t})}var TV="ADULT",CV="JUNIOR",eB="WHEELCHAIR",tge={[Vg]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[yr]:30,default:60}}]},defaultDailyLimits:{[Er]:2,[yr]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[td],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[eB],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[TV,eB],minutes:{default:60,[yr]:30}},{categoryTypes:[CV],minutes:{default:60,[yr]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[TV,eB],minutes:{default:30}},{categoryTypes:[CV],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[TV,CV],minutes:{default:30}},{categoryTypes:[eB],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},WQe=tge;function gK({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:Vr};let n,a;if(e?.length){let d=[];n=e.map(p=>{let f=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(f?.matchUpFormat)&&Ql({matchUpFormat:f?.matchUpFormat}))return d.push(f.matchUpFormat),f}).filter(Boolean)}else{let{policy:d}=ab({policyType:du,tournamentRecord:t,event:r});if(d?.matchUpFormats)n=d?.matchUpFormats;else{let{extension:p}=Bi({name:_m,element:r}),f,h;p?.value?{matchUpAverageTimes:f,matchUpRecoveryTimes:h}=p.value:{matchUpAverageTimes:f,matchUpRecoveryTimes:h}=WQe[Vg],n=Ci([...(f||[]).map(m=>m.matchUpFormatCodes),...(h||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),a="default scheduling policy in use"}}let{eventType:s,eventId:o,category:l}=r,c=l?.categoryName??l?.ageCategoryCode??o;if(!o)return{error:Vr};let u=n.map(({matchUpFormat:d,description:p})=>{let f=oR({tournamentRecord:t,matchUpFormat:d,categoryName:c,categoryType:i,eventType:s,event:r});return{matchUpFormat:d,description:p,...f}});return Ft({eventMatchUpFormatTiming:u,info:a})}function PL(t){let e=Gt(t,[{[Sa]:!0},{[Es]:m=>Ql({matchUpFormat:m}),[Dc]:N1,[zq]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=Bi({name:_m,element:n}),s=a?.value,{extension:o}=Bi({element:i,name:_m}),l=o?.value,c=s?.matchUpAverageTimes&&e0({...s,matchUpFormat:r}),u=l?.matchUpAverageTimes&&e0({...l,matchUpFormat:r}),d=[c,u].find(m=>m),p=s?.matchUpRecoveryTimes&&t0({...s,matchUpFormat:r}),f=l?.matchUpRecoveryTimes&&t0({...l,matchUpFormat:r}),h=[p,f].find(m=>m);return{matchUpFormat:r,recoveryTimes:h,averageTimes:d}}function vK({tournamentRecords:t}){return ege({extensionName:z1,tournamentRecords:t})}var _R=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function yK({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!wu(e))return{error:sA};if(!Array.isArray(t))return{error:be};let i=e.filter(Boolean).filter(({schedule:r})=>_R({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,s=Si(a?.scheduledDate),o=qr(a?.scheduledTime);return s&&o&&(r[s]?r[s].push(n):r[s]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>kde(qr(n.schedule?.scheduledTime),qr(a.schedule?.scheduledTime)))}),{...se,scheduledMatchUps:i}}function KQe({tournamentRecords:t}){let e={},i=[];for(let r of Object.values(t))for(let n of r.events??[]){let a=Su({event:n}),s=a?.drawDetails;Ki(s)?(Object.assign(e,s),i.push(...Object.keys(s).filter(o=>jW({drawId:o,drawDetails:s})))):a?.drawIds?.length&&i.push(...a.drawIds)}return{drawIds:i,detailsMap:e}}function Yx({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:o,drawId:l,structureId:c,roundNumber:u})=>`${o}|${l}|${c}${u}`;t?.length&&t.flatMap(({venues:o})=>o.map(({rounds:l})=>l)).forEach(o=>{o.sort((l,c)=>(l.sortOrder||0)-(c.sortOrder||0)).forEach(({eventId:l,drawId:c,structureId:u,roundNumber:d},p)=>{let f=r({eventId:l,drawId:c,structureId:u,roundNumber:d});i[f]=p})});let n=[],a={noScheduledDate:[]};for(let o of e){let l=o.schedule||{},c=l.scheduledDate&&Si(l.scheduledDate)||l.scheduledTime&&Si(l.scheduledTime)||"noScheduledDate";a[c]||(a[c]=[]),a[c].push(o)}let s=Object.keys(a).sort((o,l)=>o.localeCompare(l));for(let o of s){let l=a[o],c={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},f=p.scheduledTime&&qr(p.scheduledTime)||"noScheduledTime";c[f]||(c[f]=[]),c[f].push(d)}for(let d of Object.keys(c)){let p=c[d].sort((f,h)=>(f.roundNumber||0)-(h.roundNumber||0));c[d]=p}let u=Object.keys(c).sort((d,p)=>d.localeCompare(p));for(let d of u){let p=c[d];p.sort((f,h)=>{let m=i[r(f)]||0,A=i[r(h)]||0;return m-A}),n.push(...p)}}return n}function RL(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:h,nextMatchUps:m,tournamentId:A,inContext:g,context:v,event:b}=t;if(!b)return{error:Vr};let{eventId:y,eventName:I,endDate:w,eventType:S,category:T,gender:D}=b??{},C={...v,...Ft({surfaceCategory:b.surfaceCategory??u?.surfaceCategory,indoorOutDoor:b.indoorOutdoor??u?.indoorOutdoor,tournamentId:A??u?.tournamentId,endDate:w??u?.endDate,eventName:I,eventType:S,category:T,eventId:y,gender:D})},E;!e&&u&&({participants:e,participantMap:r,groupInfo:E}=nb({participantsProfile:s,useParticipantMap:c,tournamentRecord:u,contextProfile:h,inContext:g})),h&&!i&&(i=dA({policyDefinitions:l,tournamentRecord:u,contextProfile:h,event:b}));let P=Su({event:b});return{...(b.drawDefinitions??[]).reduce((R,M)=>{let N=VC({hydrateParticipants:t.hydrateParticipants,context:C,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:f,participantMap:r,publishStatus:P,contextProfile:h,drawDefinition:M,nextMatchUps:m,inContext:g,event:b});return Object.keys(N)?.forEach(k=>{Array.isArray(N[k])&&(R[k]||(R[k]=[]),R[k]=R[k].concat(N[k]))}),R},{}),...se,groupInfo:E}}function ML(t){if(!t?.tournamentRecord)return{error:rt};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,inContext:o=!0,usePublishState:l,contextFilters:c,matchUpFilters:u,contextProfile:d,nextMatchUps:p,context:f}=t,h=t.tournamentId??s.tournamentId,m=s?.events??[],{participants:A,participantMap:g,groupInfo:v}=nb({participantsProfile:r,tournamentRecord:s,contextProfile:d,inContext:o});d&&!e&&(e=dA({policyDefinitions:a,tournamentRecord:s,contextProfile:d}));let{appliedPolicies:b}=er({tournamentRecord:s}),y=c?.eventIds??[];return{...m.filter(I=>!y.includes(I.eventId)).map(I=>{let w={eventDrawsCount:Bn({event:I}).flightProfile?.flights?.length||I.drawDefinitions?.length||0,...f};return RL({hydrateParticipants:t.hydrateParticipants,context:w,tournamentAppliedPolicies:b,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,contextFilters:c,contextProfile:d,contextContent:e,matchUpFilters:u,participantMap:g,participants:A,tournamentId:h,nextMatchUps:p,inContext:o,event:I})}).reduce((I,w)=>((w&&Object.keys(w).filter(S=>!["success","matchUpsMap"].includes(S)))?.forEach(S=>{Array.isArray(w[S])&&(I[S]||(I[S]=[]),I[S]=I[S].concat(w[S]),I.matchUpsCount!==void 0?I.matchUpsCount+=w[S].length:I.matchUpsCount=w[S].length)}),I),{matchUpsCount:0}),groupInfo:v,participants:A}}function yP({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:r,useParticipantMap:n,policyDefinitions:a,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:c,inContext:u}){if(typeof r!="object"||!Object.keys(r).length)return{error:yn};let d=Object.keys(r).map(h=>{let m=r[h];return ML({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,policyDefinitions:a,tournamentRecord:m,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:c,inContext:u})}),p={},f={};return{...d.reduce((h,m)=>(Object.keys(m).forEach(A=>{if(A==="groupInfo")Object.assign(f,m[A]);else if(A==="participants")for(let g of m[A]??[])p[g.participantId]=g;else Array.isArray(m[A])&&(h[A]||(h[A]=[]),h[A]=h[A].concat(m[A]))}),h),{}),groupInfo:f,mappedParticipants:p}}function OR(t){if(typeof t?.tournamentRecords!="object"||!Object.keys(t?.tournamentRecords).length)return{error:yn};let{courts:e,venues:i}=fA(t),r=hA(t).schedulingProfile,{sortDateMatchUps:n=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:s,activeTournamentId:o,tournamentRecords:l,withCourtGridRows:c,minCourtGridRows:u,usePublishState:d,status:p=_c,sortCourtsData:f}=t,h=o??Ew()??Object.keys(l)[0],m=d?pR({tournamentRecord:l[h],status:p}):void 0,A=s?yP({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[Ln]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!m?.orderOfPlay?.published)return{completedMatchUps:A,dateMatchUps:[],courtsData:[],venues:i};let g,v;d&&({drawIds:g,detailsMap:v}=KQe({tournamentRecords:l})),g?.length&&(t.contextFilters??={},t.contextFilters.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(M=>g.includes(M)):t.contextFilters.drawIds=g),m?.eventIds?.length&&(t.matchUpFilters??={},t.matchUpFilters?.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(M=>m.eventIds.includes(M)):t.matchUpFilters.eventIds=m.eventIds),m?.scheduledDates?.length&&(t.matchUpFilters??={},t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(M=>m.scheduledDates.includes(M)):t.matchUpFilters.scheduledDates=m.scheduledDates),s&&(t.matchUpFilters??={},t.matchUpFilters?.excludeMatchUpStatuses?.length?t.matchUpFilters.excludeMatchUpStatuses.includes(Ln)||t.matchUpFilters.excludeMatchUpStatuses.push(Ln):t.matchUpFilters.excludeMatchUpStatuses=[Ln]);let{completedMatchUps:b,upcomingMatchUps:y,pendingMatchUps:I,abandonedMatchUps:w,groupInfo:S,mappedParticipants:T}=yP({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),D=[...y??[],...I??[]];v&&(!g?.length||Object.keys(v).length)&&(D=D.filter(M=>{let{drawId:N,structureId:k,stage:O}=M;if(!v?.[N]?.publishingDetail?.published)return!1;let x=Object.keys(v[N].stageDetails??{});if(x.length){let _=x.filter(G=>!v[N].stageDetails[G].published),V=x.filter(G=>v[N].stageDetails[G].published);return _.length&&_.includes(O)?!1:V.length&&V.includes(O)?!0:_.length&&!_.includes(O)&&!V.length}let F=Object.keys(v[N].structureDetails??{});if(F.length){let _=F.filter(G=>!v[N].structureDetails[G].published),V=F.filter(G=>v[N].structureDetails[G].published);return _.length&&_.includes(k)?!1:V.length&&V.includes(k)?!0:_.length&&!_.includes(k)&&!V.length}return!0}));let C=n?Yx({matchUps:D,schedulingProfile:r}):D,E=e?.map(M=>{let N=R(M);return{surfaceCategory:M?.surfaceCategory??"",matchUps:N,...M}}),P={completedMatchUps:s?A:b,mappedParticipants:t.hydrateParticipants?void 0:T,dateMatchUps:C,courtsData:E,groupInfo:S,venues:i};if(c){let M=t.matchUpFilters?.scheduledDate,{rows:N,courtPrefix:k}=EL({minRowsCount:Math.max(u||0,C.length||0),scheduledDate:M,courtsData:E});P.courtPrefix=k,P.rows=N}return{...P,...se};function R({courtId:M}){let N=(a?C.concat(b??[],w??[]):C).filter(k=>k.schedule?.courtId===M||k.schedule?.allocatedCourts?.map(({courtId:O})=>O).includes(M));return f?Yx({matchUps:N,schedulingProfile:r}):N}}function NL({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:yn};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:s}=YQe({tournamentRecord:a});r=s}),{matchUpDailyLimits:r}}function YQe(t){let e=Gt(t,[{[Sa]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:r}=ab({policyType:Vg,tournamentRecord:i}),{extension:n}=Bi({element:i,name:z1}),a=n?.value?.dailyLimits,s=r?.defaultDailyLimits;return{matchUpDailyLimits:a||s}}function bK(t){let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:r,drawDefinition:n,excludeMargin:a,exclusionRule:s,zoneDoubling:o,matchUpType:l,scaleName:c,eventId:u,zonePct:d,drawId:p,event:f}=t;if(!r&&!e)return{error:rt};if(l&&![Er,yr].includes(l))return{error:be,info:{matchUpType:l}};if(e&&!wu(e))return{error:be,context:{matchUps:e}};let h=za[c],m=h?.ascending??t.ascending??!1,A=h?.accessor??t.valueAccessor,g=Array.isArray(h?.range)?Math.abs(h.range[0]-h.range[1]):0,v=yi(d)&&g?(d??0/100)*g:t.zoneMargin??g,b={withScaleValues:!0,withCompetitiveness:!0},y={matchUpTypes:l?[l]:[Er,yr]},I=r?.participants;e?.[0]?.hasContext?p?e=e.filter(M=>M.drawId===p):u&&(e=e.filter(M=>M.eventId===u)):e??=p&&!n&&[]||!p&&u&&!f&&[]||p&&Do({inContext:!0,drawDefinition:n,contextFilters:y,contextProfile:b,participants:I})?.matchUps||!p&&u&&Vh({inContext:!0,contextFilters:y,contextProfile:b,participants:I,event:f})?.matchUps||La({tournamentRecord:r,contextFilters:y,contextProfile:b})?.matchUps||[],l&&(e=e.filter(M=>M.matchUpType===l));let w=e.filter(({winningSide:M,score:N,sides:k,matchUpStatus:O})=>![Fa,Mr,Xr,LC,ql].includes(O??"")&&ya({score:N})&&k?.length===2&&M),S=ZQe({matchUps:w,excludeMargin:a,exclusionRule:s,valueAccessor:A,ascending:m,scaleName:c}),T=!o||$n(Er)(l)?v:(v||0)*2,D=v?w.map(({competitiveProfile:M,matchUpType:N,score:k,sides:O})=>{let x=ige({singlesForDoubles:i,valueAccessor:A,matchUpType:N,scaleName:c,sides:O}),F=Math.abs(x[0].value-x[1].value);return{competitiveness:M?.competitiveness,valuesGap:F,score:k}}).filter(({valuesGap:M})=>M<=T):[],C=XQe({zoneData:D}),E=C&&Object.values(C).flat().length,P=E&&Object.assign({},...Object.keys(C).map(M=>({[M]:Math.round(1e4*C[M].length/E)/100}))),R=w.length-(D?.length||0);return{...se,relevantMatchUps:w,zoneDistribution:P,zoneData:D,accuracy:S,nonZone:R}}function XQe({zoneData:t}){let e={[RW]:[],[pP]:[],[fP]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function ige({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let s=e?.range.sort(),o=l=>{let c=l?.[e?.valueAccessor];return{exclude:e&&c>=s[0]&&c<=s[1],exclusionValue:c}};return a.sort((l,c)=>l.sideNumber-c.sideNumber).map(({participant:l})=>{let c=[],u=l?.individualParticipants;if(u?.length){let d=[],p=0;for(let f of u){let{scaleValue:h,value:m}=Pee({singlesForDoubles:t,valueAccessor:i,participant:f,matchUpType:r,scaleName:n}),{exclude:A,exclusionValue:g}=o(h);A&&c.push(g),d.push(h),m&&!Number.isNaN(Number(p))?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:c,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=Pee({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:f,exclusionValue:h}=o(d);return f&&c.push(h),{participantName:l.participantName,exclusionValues:c,scaleValue:d,value:p}}else return{}})}function Pee({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){let a=t?Er:i,s=r?.rankings?.[a]?.find(c=>c.scaleName===n),o=(r?.ratings?.[a]?.find(c=>c.scaleName===n)||s)?.scaleValue,l=e?o?.[e]:o;return{scaleValue:o,value:l}}function ZQe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let s={affirmative:[],negative:[],excluded:[]};for(let c of a)JQe({matchUp:c,accuracy:s,excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n});let o=s.affirmative.length+s.negative.length,l=o&&s.affirmative.length/o*100;return s.percent=l?Math.round(100*l)/100:0,s}function JQe({matchUp:t,accuracy:e,excludeMargin:i,exclusionRule:r,valueAccessor:n,ascending:a,scaleName:s}){let{matchUpType:o,sides:l,score:c,winningSide:u}=t;if(!u)return;if(r&&(!r.valueAccessor||!r.range)){e.error={info:"exclusionRule requires valueAccessor and range",error:Kt};return}let d=u-1,p=ige({exclusionRule:r,valueAccessor:n,matchUpType:o,scaleName:s,sides:l});if(eje({exclusionRule:r,sideValues:p,accuracy:e,score:c,winningSide:u}))return;if(tje(p)){e.excluded.push({scoreString:c?.scoreStringSide1,missingValues:!0,winningSide:u,sideValues:p});return}let f=p[d].value-p[1-d].value;if(ije({excludeMargin:i,valuesGap:f})){e.excluded.push({scoreString:c?.scoreStringSide1,excludeMargin:i,winningSide:u,excludeGap:!0,sideValues:p,valuesGap:f});return}let h=a?f:f*-1,m=u===1?c?.scoreStringSide1:c?.scoreStringSide2;h>0?e.affirmative.push({winningScoreString:m,winningSide:u,sideValues:p,valuesGap:f,score:c}):e.negative.push({winningScoreString:m,winningSide:u,sideValues:p,valuesGap:f,score:c})}function eje({exclusionRule:t,sideValues:e,accuracy:i,score:r,winningSide:n}){if(t){let a=e.flatMap(({exclusionValues:s})=>s);if(a.length)return i.excluded.push({scoreString:r?.scoreStringSide1,exclusionValues:a,winningSide:n,sideValues:e}),!0}return!1}function tje(t){return t.filter(e=>![void 0,"",null].includes(e.value)).length<2}function ije({excludeMargin:t,valuesGap:e}){let i=Number.parseFloat(t||0);return i&&Math.abs(e)<i}function Kw({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=ume({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:s,collectionGroupNumber:o,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=a,f=o&&r.includes(o);if(yi(p||d))n=!0;else{if(f)continue;if(typeof l=="number"&&yi(l))i+=l;else if(Array.isArray(s)&&s?.length)for(let h of s)i+=h.matchUpValue;else typeof u=="number"&&yi(u)&&(i+=(c??0)*u)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...se}:{valueGoal:Math.floor(i/2)+1,...se}}function IK(t){let{timeStamp:e,schedule:i,matchUp:r}=t,n=Gt(t,[{[Lh]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:s}=lb({timeItems:r?.timeItems||[],itemType:_W});return!i||s&&e&&new Date(s).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function wK({matchUps:t,matchUpId:e}){if(!wu(t))return{error:be};let i=t.find(o=>o.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:s}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:s}}function XC(t,e){if(!Ki(t))return{error:be};if(!Array.isArray(e))return{error:be};let i={};for(let{param:r,error:n,attr:a}of e){let s=rje({params:t,param:r,attr:a,error:n});if(s?.error)return s;i[r]=s}return i}function rje({params:t,param:e,attr:i,error:r}){if(e===SF&&Ki(t.drawDefinition)&&Lr(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===Lh){let n=zAe({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:ts,info:{param:e}}}function SK(t){let{structureId:e,matchUpId:i,event:r}=t,n=t.drawDefinition,a=Gt(t,[{[Sa]:!0},{[Xq]:{[bF]:!1,[Cf]:!1,[xpe]:!1,[lA]:!1}}]);if(a[id])return a;let s=XC(t,[{[kC]:Lh,[id]:Kt}])?.matchUp;if(i&&s?.error)return s;!n&&s?.drawDefinition&&(n=s?.drawDefinition);let o=s?.structure;if(!o&&e&&!i){if(!n)return{error:fp};let p=ui({drawDefinition:n,structureId:e});if(p.error)return p;o=p.structure}let l=o?.matchUpFormat,c=n?.matchUpFormat,u=r?.matchUpFormat,d=s?.matchUp?.matchUpFormat||l||c||u;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:u,drawDefaultMatchUpFormat:c,matchUpFormat:d}}function UK({profileBands:t,tournamentRecord:e,matchUps:i}){if(!wu(i))return{error:sA};let r=!t&&ab({policyType:fm,tournamentRecord:e}).policy,n=t||r?.profileBands||MW[fm].profileBands,a=i.filter(({winningSide:p})=>p),s=a.map(vfe),o=(p,f)=>{let h=gfe(f,n);return p[h]+=1,p},l=yfe(s).reduce((p,f)=>o(p,f),{[RW]:0,[pP]:0,[fP]:0,[dfe]:0}),c=Object.keys(l).reduce((p,f)=>(l[f]||0)+p,0),u=Object.keys(l).map(p=>{let f=Number.parseFloat((l[p]/c).toFixed(4));return{[p]:f*100}}),d=a.filter(({matchUpStatus:p})=>p===JJ).length;return u.push({[JJ]:Number.parseFloat((d/c).toFixed(4))*100}),{competitiveBands:Object.assign({},...u),...se}}var{stageOrder:Ree}=RFe;function nje(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(Ree[t?.stage]||0)-(Ree[e?.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function TK({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:s,withSplitRounds:o,matchUpFilters:l,scheduleDate:c,withRoundId:u,venueId:d,context:p}){if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:be,inContextMatchUps:r};if(s&&!n){if(typeof s!="object")return{error:D1};n={[s.tournamentId]:s}}let f=typeof n!="object"||!Object.keys(n).length;if((d||c||!r||!a&&(t||i||a||o))&&f)return{error:yn};let h=Object.assign({},...Object.values(n??{}).map(({venues:w=[],tournamentId:S})=>({[S]:w?.map(({venueId:T})=>T)}))),m=Object.values(n??{}).map(({events:w=[],tournamentId:S,startDate:T,endDate:D})=>w.map(C=>({...C,validVenueIds:h[S],startDate:C.startDate??T,endDate:C.endDate??D}))).flat(),{segmentedRounds:A,profileRounds:g}=n&&(t||i||a||o)&&CL({tournamentRecords:n,schedulingProfile:a})||{},v=t&&Object.assign({},...g.map(w=>({[w.id]:w}))),b=r||n&&sp({tournamentRecords:n,matchUpFilters:l})?.matchUps||[],y=[],I=b&&Object.values(b.reduce((w,S)=>{let T=Xj(S).id,D=A?.[T],C=[...w[T]?.matchUps??[],S],{containerStructureId:E,stageSequence:P,structureName:R,tournamentId:M,isRoundRobin:N,matchUpType:k,roundNumber:O,roundOffset:x,structureId:F,eventName:_,roundName:V,drawName:G,eventId:z,drawId:Q}=S,j=N?E:F;return{...w,[T]:{id:u?T:void 0,structureId:j,stageSequence:P,segmentsCount:D,structureName:R,tournamentId:M,matchUpType:k,roundNumber:O,roundOffset:x,eventName:_,roundName:V,drawName:G,matchUps:C,eventId:z,drawId:Q}}},{})).map(w=>{let{minFinishingSum:S,winnerFinishingPositionRange:T}=zQe(w.matchUps),D=w.segmentsCount;if(D){let O=w.matchUps.length/D;return Oa(w.matchUps.sort((x,F)=>x.roundPosition-F.roundPosition),O).map((x,F)=>{let{unscheduledCount:_,incompleteCount:V,matchUpsCount:G,isScheduled:z,isComplete:Q,byeCount:j}=Dee(x),W=Eee({matchUps:w.matchUps,tournamentRecords:n,events:m,round:w});return Ft({...w,...p,roundSegment:{segmentsCount:D,segmentNumber:F+1},winnerFinishingPositionRange:T,unscheduledCount:_,incompleteCount:V,minFinishingSum:S,matchUpsCount:G,isScheduled:z,roundTiming:W,isComplete:Q,byeCount:j,matchUps:x})})}let{unscheduledCount:C,incompleteCount:E,matchUpsCount:P,isScheduled:R,isComplete:M,byeCount:N}=Dee(w.matchUps),k=Eee({matchUps:w.matchUps,tournamentRecords:n,events:m,round:w});return Ft({...w,...p,winnerFinishingPositionRange:T,unscheduledCount:C,incompleteCount:E,minFinishingSum:S,matchUpsCount:P,isScheduled:R,roundTiming:k,isComplete:M,byeCount:N})}).flat().filter(w=>{if(t){let F=Si(t),_=u?w.id:Xj(w).id;if(F&&v[_]&&Si(v[_].scheduleDate)===F)return!1}let{isComplete:S,isScheduled:T}=w,D=!i||!S,C=!e||!T,E=d||c?m?.find(({eventId:F})=>F===w.eventId):void 0,P=E?.startDate??s?.startDate,R=E?.endDate??s?.endDate,M=!c||!P||new Date(c)>=new Date(P),N=!c||!R||new Date(c)<=new Date(R),k=M&&N,O=!d||E?.validVenueIds.includes(d),x=D&&C&&O&&k;return x||y.push(w),x}).sort(nje)||[];return{...se,rounds:I,excludedRounds:y}}function bP(t){let{matchUp:e,sideNumber:i,setNumber:r,isTiebreakValue:n,isPointValue:a}=t||{},{matchUpFormat:s}=t||{};if(!e)return{error:Wo};s=s||e?.matchUpFormat;let o=vs(s),l=!!e?.winningSide,c=e.score?.sets,u=c?.length,d=r&&r-1,p=!!c?.find((j,W)=>j.setNumber===r&&W===d),f=c?.filter(j=>j?.winningSide)||[],h=f?.length||0,m=r&&c?.slice(r)||[],A=!!(u&&r&&m?.reduce((j,W)=>(!W||!W.side1Score&&!W.side2Score&&!W.side1TiebreakScore&&!W.side2TiebreakScore&&!W.side1PointScore&&!W.side2PointScore)&&j,!0)),g=r<=u&&c.find(j=>j.setNumber===r),v=g&&vP({setObject:g,matchUpScoringFormat:o}),{isCompletedSet:b,sideGameScores:y,sideTiebreakScores:I}=v||{},w=!!(g&&!b&&A||r&&r===u+1&&!l),S=[1,2].includes(i),T=S?i-1:0,D=g&&S&&(!n&&!a&&y[T]!==void 0&&y[T]||n&&I[T]!==void 0&&I[T]),C=!!D,E=f?.map(j=>vP({setObject:j,matchUpScoringFormat:o}).isValidSetOutcome).reduce((j,W)=>j&&W,!0),P=f.reduce((j,W)=>{let{winningSide:Y}=W,X=Y-1;return j[X]++,j},[0,0]),R=e?.winningSide,M=R&&R-1,N=1-M,k=P[M],O=P[N],x=Math.max(...P),F=Vl(P)[x],{bestOf:_,exactly:V}=o??{},G=_&&Math.ceil(_/2)||V||1,z=x===G&&F===1&&P.indexOf(x)+1||void 0,Q=k>O&&R===z;return{completedSetsHaveValidOutcomes:E,validMatchUpWinningSide:Q,calculatedWinningSide:z,matchUpScoringFormat:o,validMatchUpOutcome:z&&E&&Q,isLastSetWithValues:A,completedSetsCount:h,isCompletedMatchUp:l,isValidSideNumber:S,hasExistingValue:C,existingValue:D,isExistingSet:p,isActiveSet:w,...v}}function CK({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:s,tournamentRecord:o,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,publishStatus:f,contextProfile:h,drawDefinition:m,nextMatchUps:A,tournamentId:g,inContext:v,context:b,event:y}){let{eventId:I,eventName:w,endDate:S,eventType:T,category:D,gender:C}=y??{},E={...b,...Ft({surfaceCategory:y?.surfaceCategory??o?.surfaceCategory,indoorOutDoor:y?.indoorOutdoor??o?.indoorOutdoor,endDate:S??y?.endDate??o?.endDate,tournamentId:g??o?.tournamentId,eventName:w,eventType:T,category:D,eventId:I,gender:C})},P;return!t?.length&&o&&({participants:t,participantMap:p,groupInfo:P}=nb({participantsProfile:r,useParticipantMap:s,tournamentRecord:o,contextProfile:h,inContext:v})),y&&h&&!u&&(u=dA({policyDefinitions:a,tournamentRecord:o,contextProfile:h,drawDefinition:m,event:y})),{...VC({context:E,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,participantMap:p,contextContent:u,contextFilters:c,matchUpFilters:d,publishStatus:f,contextProfile:h,drawDefinition:m,nextMatchUps:A,inContext:v,event:y}),groupInfo:P}}var rge={};Fi(rge,{getCompetitionVenues:()=>BR,getCourts:()=>EK,getVenuesAndCourts:()=>fA,publicFindVenue:()=>LW});function EK({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=St(r.courts||[]);return a.forEach(s=>Object.assign(s,{venueId:n})),a}).flat()}:{error:rt}}var nge={};Fi(nge,{categoryCanContain:()=>F1,getCategoryAgeDetails:()=>yy,getEvent:()=>RK,getEventProperties:()=>DK,getEventStructures:()=>XF,getEventTimeItem:()=>X1,getEvents:()=>PK,getFlightProfile:()=>Bn,getScaledEntries:()=>Ww});function DK({tournamentRecord:t,event:e}){if(!t)return{error:rt};if(!e)return{error:Vr};let i=e.entries||[],r=t.participants||[],n=e.category?.categoryName||e.category?.ageCategoryCode,{eventType:a}=e,s=new Set(i.map(d=>d.participantId)),o=r.filter(d=>s.has(d.participantId)),l,c,u;return{entryScaleAttributes:o.map(d=>{let{participantId:p,participantName:f,name:h}=d,m={scaleType:FW,eventType:a,scaleName:n},A=rh({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;m={scaleType:Dfe,eventType:a,scaleName:n};let g=rh({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;m={scaleType:Efe,eventType:a,scaleName:n};let v=rh({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;return l=!!(l||A),c=!!(c||g),u=!!(u||v),{participantId:p,participantName:f||h,seed:A,ranking:g,rating:v}}),hasSeededParticipants:l,hasRankedParticipants:c,hasRatedParticipants:u}}function PK({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:s}){if(!t)return{error:rt};let{tournamentId:o}=t,l=(t.events??[]).filter(({eventId:u})=>!n||Array.isArray(n)&&n.includes(u)).map(u=>{let d=u.drawDefinitions?.map(cP);if(a?.length&&!Pn(a,d).length)return;let p=St(u);return r&&Object.assign(p,{tournamentId:o}),s&&Object.assign(p,s),p}).filter(Boolean),c={};if(e){let u=gn({withScaleValues:!0,tournamentRecord:t}).participantMap,d=p=>p.reduce((f,h)=>f+Number.parseFloat(h),0);for(let p of l){let f=i??p.eventType,h=p.eventId;c[h]||(c[h]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let m=(p.entries??[]).filter(({entryStatus:w})=>Pd.includes(w)).map(ji),A=w=>{if(w?.ratings?.[f])for(let S of w?.ratings?.[f]??[]){let T=S.scaleName;c[h].ratings[T]||(c[h].ratings[T]=[]);let D=za[T]?.accessor;if(D){let C=Number.parseFloat(S.scaleValue?.[D]);C&&c[h].ratings[T].push(C)}}if(w?.rankings?.[f])for(let S of w?.rankings?.[f]??[]){let T=S.scaleName;c[h].ranking[T]||(c[h].ranking[T]=[]),S.scaleValue&&c[h].ranking[T].push(S.scaleValue)}};for(let w of m){let S=u?.[w]?.participant;if(S?.participantType===zi)A(S);else for(let T of S?.individualParticipantIds??[]){let D=u?.[T]?.participant;A(D)}}let g=c[h].ratings;for(let w of Object.keys(g)){let S=g[w];if(!S.length)continue;let T=GJ(S)?.toFixed(2);c[h].ratingsStats[w]={avg:Number.parseFloat((d(S)/S.length).toFixed(2)),median:T?Number.parseFloat(T):void 0,max:Math.max(...S),min:Math.min(...S)}}let v=(w,S)=>{let T=D=>{if(c[h].draws?.[w]&&D?.ratings?.[f])for(let C of D?.ratings?.[f]??[]){let E=C.scaleName;c[h].draws[w]?.ratings[E]||(c[h].draws[w].ratings[E]=[]);let P=za[E]?.accessor;if(P){let R=Number.parseFloat(C.scaleValue?.[P]);R&&c[h].draws[w].ratings[E].push(R)}}if(c[h].draws?.[w]&&D?.rankings?.[f])for(let C of D?.rankings?.[f]??[]){let E=C.scaleName;c[h].draws[w]?.ranking[E]||(c[h].draws[w].ranking[E]=[]);let P=C.scaleValue;P&&c[h].draws[w].ranking[E].push(P)}};for(let D of S.filter(Boolean)){let C=u?.[D]?.participant;if(C?.participantType===zi)T(C);else for(let E of C?.individualParticipantIds??[]){let P=u?.[E]?.participant;T(P)}}},b=[],y=w=>a?.length&&a.includes(w)||b.includes(w);for(let w of p.drawDefinitions??[]){let S=w.drawId;if(y(S))continue;let T=cb({drawDefinition:w}).assignedParticipantIds??[];c[h].draws[S]||(c[h].draws[S]={ratingsStats:{},ratings:{},ranking:{}}),b.push(S),v(S,T)}let I=Bn({event:p}).flightProfile;for(let w of I?.flights??[]){let S=w.drawId;if(y(S))continue;let T=w.drawEntries.map(ji);v(S,T)}for(let w of b){let S=c[h].draws[w].ratings;for(let T of Object.keys(S)){let D=S[T];if(!D.length)continue;let C=GJ(D)?.toFixed(2);c[h].draws[w].ratingsStats[T]={avg:Number.parseFloat((d(D)/D.length).toFixed(2)),median:C?Number.parseFloat(C):void 0,max:Math.max(...D),min:Math.min(...D)}}}}}return Ft({eventScaleValues:c,events:l,...se})}function RK({tournamentRecord:t,drawDefinition:e,context:i,event:r}){if(!t)return{error:rt};if(!r)return{error:Vr};let n=St(r);i&&Object.assign(n,i);let a=e&&n.drawDefinitions?.find(({drawId:s})=>e.drawId===s);return Ft({drawDefinition:a,event:n})}function aje(t){let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:r}=lje(t),n=cje({...t,policyDefinitions:r,appliedPolicies:i}),a=oje(t),s=uje({...t,consideredEntries:a,appliedPolicies:i});if(s?.error)return le({result:s,stack:e});let o=dje({...t,consideredEntries:a}),l=sje({...t,appliedPolicies:i,policyDefinitions:r,drawSize:o});if(l.error)return le({result:l,stack:e});let c=l.drawType;if(isNaN(o)&&c!==zl)return le({result:{error:M1},stack:e});let u=r?.[Wu]??i?.[Wu],d=t.seedingProfile??u?.seedingProfile?.drawTypes?.[c??""]??u?.seedingProfile;t.seedingProfile&&(r[Wu]||(r[Wu]={...Yj[Wu]}),r[Wu].seedingProfile=d);let p=pje({...t,drawType:c});return p?.error?le({result:p,stack:e}):{drawSize:o,drawType:c,enforceGender:n,seedingProfile:d,appliedPolicies:i,policyDefinitions:r}}function sje(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??DR({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),s=Hme({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return s.error?s:{drawType:s.drawType}}function age(t){return t?.filter(e=>e.entryStatus&&[...Pd,nR].includes(e.entryStatus))}function oje({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||age(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===Ut)}function lje(t){let{tournamentRecord:e,event:i}=t,r={...t?.appliedPolicies,...er({tournamentRecord:e,event:i}).appliedPolicies??{}},n=St(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function cje({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){return t??e?.[Xa]?.participants?.enforceGender??i?.[Xa]?.participants?.enforceGender}function uje(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:s,event:o}=t;return o&&s&&cL({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:s,event:o})}function dje(t){return!t.drawSize&&t.consideredEntries.length&&![zl,H1,BC,gd,vh].includes(t.drawType??"")&&CC(t.consideredEntries.length)||t.drawSize&&ri(t.drawSize)||!1}function pje(t){let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:r,drawType:n}=t,a=!r&&e&&vL({tournamentRecord:e,categoryType:i?.category?.categoryType,categoryName:i?.category?.categoryName});return a?.length&&!a.includes(n)?{error:iq}:{...se}}function sge(t){let{drawDefinition:e,appliedPolicies:i}=t,r=i?.[km],n=ss({drawDefinition:e});return e.structures?.forEach(a=>{let s=hg({structureId:a.structureId,matchUpsMap:n}),o=Afe({roundNamingPolicy:r,drawDefinition:e,structure:a,matchUps:s}),{roundNamingProfile:l,roundProfile:c}=o;(a.structures||[a]).forEach(u=>{(u.matchUps??[]).forEach(d=>{let p=d?.roundNumber?.toString();if(p){let f=l?.[p]?.roundName,h=l?.[p]?.abbreviatedRoundName,m=c?.[p]?.feedRound;Object.assign(d,{abbreviatedRoundName:h,feedRound:m,roundName:f})}})})}),{drawDefinition:e}}function FR(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:s}=gn({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),o=age(r?.entries)??[],l=aje({...t,participantMap:s,participants:a,eventEntries:o});if(l.error)return le({result:l,stack:n});let{appliedPolicies:c,policyDefinitions:u,drawSize:d,drawType:p,enforceGender:f,seedingProfile:h}=l,m=r?.eventType,A=t.matchUpType??m,g=lQe({...t,enforceGender:f,eventType:m,matchUpType:A});if(g.error)return le({result:g,stack:n});let{matchUpFormat:v,tieFormat:b}=g;if(t.drawId&&typeof t.drawId!="string")return le({result:{error:be},stack:n});let y=_Qe({...t,policyDefinitions:u,tournamentRecord:i,appliedPolicies:c,matchUpFormat:v,seedingProfile:h,participants:a,eventEntries:o,matchUpType:A,tieFormat:b,drawSize:d,drawType:p,event:r});if(y.error)return le({result:y,stack:n});let{existingDrawDefinition:I,positioningReports:w,drawDefinition:S,structureId:T,conflicts:D,entries:C}=y;if(!S)return le({result:{error:be},stack:n});let E=OQe({...t,existingDrawDefinition:I,positioningReports:w,appliedPolicies:c,drawDefinition:S,seedingProfile:h,participants:a,structureId:T,entries:C,params:t,stack:n});if(E.error)return E;let{qualifyingConflicts:P}=E;return S.drawName=t.drawName??(p&&Bs(p)),d&&typeof e=="object"&&d>=4&&XW({...e,drawDefinition:S,matchUpType:A}),t.hydrateRoundNames&&c?.[km]&&sge({drawDefinition:S,appliedPolicies:c}),{existingDrawDefinition:!!I,qualifyingConflicts:P,positioningReports:w,drawDefinition:S,structureId:T,...se,conflicts:D}}function oge({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Kt,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:o},l)=>({[o]:l+1})));n=n||t.scaleName;let s=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:o})=>({scaleItems:[{scaleValue:a[o],eventType:t.eventType,scaleType:eh,scaleName:n,scaleDate:s}],participantId:o}))}}function fje({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:s,event:o,stage:l,sortDescending:c,scaleSortMethod:u}){let d=DL({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:s,event:o,stage:l});if(d.error)return d;let{entries:p,seedsCount:f,stageEntries:h}=d;if(!h||!f)return{error:be};let m=Ww({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:u,sortDescending:c,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:A}=oge({scaleAttributes:r,scaledEntries:m,stageEntries:h,seedsCount:f,scaleName:n});return{scaleItemsWithParticipantIds:A}}var MK={};Fi(MK,{addDrawEntries:()=>qW,addEventEntries:()=>zp,addEventEntryPairs:()=>pge,destroyPairEntries:()=>the,destroyPairEntry:()=>YW,getEntriesAndSeedsCount:()=>DL,getMaxEntryPosition:()=>mK,modifyEntriesStatus:()=>Hx,modifyEventEntries:()=>fge,mutate:()=>lge,promoteAlternate:()=>uge,promoteAlternates:()=>BK,query:()=>ZAe,removeDrawEntries:()=>dge,removeEventEntries:()=>hR,setEntryPosition:()=>NK,setEntryPositions:()=>cge});var lge={};Fi(lge,{addDrawEntries:()=>qW,addEventEntries:()=>zp,addEventEntryPairs:()=>pge,destroyPairEntries:()=>the,destroyPairEntry:()=>YW,modifyEntriesStatus:()=>Hx,modifyEventEntries:()=>fge,promoteAlternate:()=>uge,promoteAlternates:()=>BK,removeDrawEntries:()=>dge,removeEventEntries:()=>hR,setEntryPosition:()=>NK,setEntryPositions:()=>cge});function NK({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let s="setEntryPositions";if(!t)return{error:rt};if(!i)return le({result:{error:ga},stack:s});if(r!==void 0&&!Number.isSafeInteger(r))return{error:be,entryPosition:r};(a?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),(e?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let o=l=>{l.entries.forEach(c=>{c.entryPosition===r&&c.participantId!==i&&(c.entryPosition+=.1)})};return n||(a?.entries&&(o(a),a.entries=Xd({entries:a.entries})),e?.entries&&(o(e),e.entries=Xd({entries:e.entries}))),{...se}}function cge({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:rt};if(!Array.isArray(e))return{error:be};for(let n of e){let{participantId:a,entryPosition:s}=n,o=NK({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:s,event:r});if(o.error)return o}return r?.entries&&(r.entries=Xd({entries:r.entries})),i?.entries&&(i.entries=Xd({entries:i.entries})),{...se}}function uge(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:be,participantId:e}:BK({...t,participantIds:[e].filter(Boolean)})}function BK({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=Ut,eventId:a,event:s}){if(!t)return{error:rt};if(!Array.isArray(i))return{error:be,participantIds:i};if(!s)return{error:Vr};let o="promoteAlternates";if(s){let l=Mee({element:s,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=Mee({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?le({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...se},stack:o}):l}return{...se}}function Mee({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===rd),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),s=n.reduce((d,p)=>{let{entryPosition:f}=p;return isNaN(f)&&d||(!d||f<d.entryPosition)&&p||d},void 0),o=a.length?a:[s].filter(Boolean);if(!o?.length)return{error:que};let l=o.filter(({entryStatus:d})=>d!==rd);if(l.length)return{error:mj,invalidEntryStatus:l};let c=o.filter(({entryStage:d})=>d&&d!==r);if(c.length)return{error:hOe,invalidStage:c};let u=e&&o.filter(d=>d.stageSequence!==e);if(u?.length)return{error:mOe,invalidStageSequence:u};for(let d of o){d.entryStatus=Il;let p=d?.entryPosition;isNaN(p)||i.entries.forEach(h=>{h.entryStatus===rd&&h.entryPosition>p&&(h.entryPosition=h.entryPosition-1)});let f=Math.max(...i.entries.filter(h=>h.entryStatus===Il&&!isNaN(h.entryPosition)).map(({entryPosition:h})=>ri(h||0)),0);d.entryPosition=f||0}return{...se}}function dge({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){if(!a)return{error:Vr};if(!r)return{error:fp};if(!e?.length)return{error:Lg};let s=cb({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(Bo(s,e))return{error:RC};let o=u=>{let d=u.participantId;return!e.includes(d)},{flightProfile:l}=Bn({event:a}),c=l?.flights?.find(u=>u.drawId===r);return c?.drawEntries&&(c.drawEntries=c.drawEntries.filter(o),t&&(c.drawEntries=Xd({entries:c.drawEntries}))),i?.entries&&(i.entries=i.entries.filter(o),t&&(i.entries=Xd({entries:i.entries}))),{...se}}function uf(t){let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:r,disableNotice:n,pairOverride:a,participant:s}=t,o=t.tournamentId?t.tournamentRecords?.[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&t.tournamentRecords?.[t.activeTournamentId]);if(!o)return{error:rt};if(!s)return le({result:{error:Tw},stack:e});s.participantId||(s.participantId=fr()),o.participants||(o.participants=[]);let{participantId:l,individualParticipantIds:c}=s;if(o.participants.reduce((m,A)=>A.participantId===l||m,!1))return{error:Vue};let{participantType:u,participantRole:d}=s;if(!u||!Object.keys(XU).includes(u))return{error:ap,participantType:u};if(!d)return{error:$ue};let p=o.participants||[],f=p.filter(m=>m.participantType===zi).map(m=>m.participantId);if(u!==zi&&s.person)return{error:be,person:s.person};if(c&&!Array.isArray(c))return{error:be,individualParticipantIds:c};if(u===Mi){if(s.person)return{error:be,person:s.person};if(s.individualParticipantIds){if(s.individualParticipantIds.length!==2&&!a)return le({info:"PAIR must be 2 individualParticipantIds",result:{error:Fl},stack:e});{let g=p.filter(v=>v.participantType===zi).map(v=>v.participantId);if(!Array.isArray(s.individualParticipantIds))return le({result:{error:Fl},stack:e});if(!s.individualParticipantIds.reduce((v,b)=>g.includes(b)&&v,!0))return le({result:{error:Fl},stack:e})}}else return le({result:{error:Lg},stack:e});let m=p.filter(g=>g.participantType===Mi).map(g=>({individualParticipantIds:g.individualParticipantIds,participant:g})),A=s.participantType===Mi&&m.find(g=>Pn(g.individualParticipantIds,s.individualParticipantIds).length===2);if(A&&!i)return{...se,existingParticipant:!0,participant:r&&St(A.participant)};if(!s.participantName){let g=p.filter(b=>s.individualParticipantIds?.includes(b.participantId)),v=g.map(b=>b.person?.standardFamilyName).filter(Boolean).join("/");g.length===1&&(v+="/Unknown"),s.participantName=v}}else if(u===zi){if(!s.person?.standardFamilyName||!s.person?.standardGivenName)return{error:zue};if(!s.participantName){let m=`${s.person.standardFamilyName.toUpperCase()}, ${s.person.standardGivenName}`;s.participantName=m}}else if(u&&[gr,xc].includes(u)){if(c||(s.individualParticipantIds=[]),s.individualParticipantIds?.length)for(let m of s.individualParticipantIds){if(typeof m!="string")return le({result:{participantId:m,error:be},stack:e});if(!f.includes(m))return le({result:{participantId:m,error:On},stack:e})}}else return{error:ap};o.participants.push(s),n||bi({payload:{tournamentId:o.tournamentId,participants:[s]},topic:pg});let h={participant:r&&St(s),...se};return Ft(h)}function Id({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:rt};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=fr())});let a=r.filter(d=>!n.includes(d.participantId)),s=r.filter(d=>n.includes(d.participantId)),o=a.filter(d=>d.participantType===zi),l=a.filter(d=>d.participantType!==zi),c=o.concat(...l),u=[];if(c.length){for(let p of c){let f=uf({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(f.error)return f;f.success&&!f.existingParticipant&&u.push(f.participant)}u.length&&bi({topic:pg,payload:{tournamentId:i.tournamentId,participants:u}});let d={participants:e&&St(u),addedCount:u.length,...se};return s.length&&Object.assign(d,{notAdded:s,info:nF}),Ft(d)}else return{info:"No new participants to add",addedCount:0,...se}}function pge(t){let e=Gt(t,[{[Sa]:!0,[lA]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=rd,participantIdPairs:n=[],entryStage:a=Ut,tournamentRecord:s,drawDefinition:o,event:l,uuids:c}=t;if(l.eventType!==yr)return{error:ph};let u=[],d=new Map;for(let y of s.participants??[]){let{participantType:I,participantId:w,person:S,individualParticipantIds:T}=y;I===zi&&S?.sex?d.set(w,S.sex):I===Mi&&T&&u.push(T)}let p=n.filter(y=>{if(y.length!==2)return!0;if(!l.gender||fh(l.gender))return!1;if(!d.has(y[0])||!d.has(y[1]))return!0;let I=y.map(S=>d.get(S)),w=lI(l.gender)&&(!lI(I[0])||!lI(I[1]))||Hv(l.gender)&&(!Hv(I[0])||!Hv(I[1]));return Uc(l.gender)&&(I.sort(qF),(!Hv(I[0])||!lI(I[1]))&&(w=!0)),w});if(p.length)return{error:Fl,invalidParticipantIdPairs:p};let f=n.map(y=>({participantId:c?.pop()??fr(),participantRole:Ns,individualParticipantIds:y,participantType:Mi})),h=i?f:f.filter(y=>!u.find(I=>Pn(I,y.individualParticipantIds).length===2)),m,A=[];if(h){let y=Id({allowDuplicateParticipantIdPairs:i,participants:h,returnParticipants:!0,tournamentRecord:s});if(y.error)return y;A=y.participants||[],m=y.info}let g=n.map(y=>{let I=A.find(S=>Pn(S.individualParticipantIds,y).length===2);if(I)return I;let{participant:w}=bd({tournamentRecord:s,participantIds:y});return w}).map(y=>y.participantId),v=zp({participantIds:g,tournamentRecord:s,drawDefinition:o,entryStatus:r,entryStage:a,event:l});h.length&&bi({payload:{participants:h},topic:pg});let b=h.map(ji);return{...v,info:m,newParticipantIds:b}}function fge({entryStatus:t=Il,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=Ut,tournamentRecord:n,event:a}){if(!n)return{error:rt};if(!a)return{error:Vr};let s=n.participants??[],o=s.filter(m=>m.participantType===zi).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!o.includes(m));if(l.length)return{error:Fl,invalidParticipantIds:l};let c=i.filter(m=>m.length!==2);if(c.length)return{error:Fl,invalidParticipantIdPairs:c};let u=s.filter(m=>m.participantType===Mi).map(m=>m.individualParticipantIds),d=i.filter(m=>!u.find(A=>Pn(A,m).length===2)).map(m=>({participantType:Mi,participantRole:Ns,individualParticipantIds:m})),p=Id({participants:d,tournamentRecord:n});if(p.error)return p;let f=i.map(m=>{let{participant:A}=bd({tournamentRecord:n,participantIds:m});return A}).map(m=>({participantId:m,entryStatus:t,entryStage:r})),h=e.map(m=>({entryStatus:bu,participantId:m,entryStage:r}));return a.entries=(a.entries??[]).filter(m=>m.entryStage===r),a.entries=a.entries.concat(...f,...h),{...se}}var kK={};Fi(kK,{addDrawDefinition:()=>LR,addEvent:()=>ZC,addFlight:()=>_L,assignSeedPositions:()=>Cge,attachFlightProfile:()=>VK,categoryCanContain:()=>F1,deleteDrawDefinitions:()=>BL,deleteEvents:()=>Dge,deleteFlightAndFlightDraw:()=>Uge,deleteFlightProfileAndFlightDraws:()=>bge,generate:()=>hge,generateEventsFromTieFormat:()=>Age,getCategoryAgeDetails:()=>yy,getEvent:()=>RK,getEventProperties:()=>DK,getEventStructures:()=>XF,getEventTimeItem:()=>X1,getEvents:()=>PK,getFlightProfile:()=>Bn,getScaledEntries:()=>Ww,modifyEvent:()=>Pge,modifyEventMatchUpFormatTiming:()=>Ige,modifyPairAssignment:()=>Tge,mutate:()=>gge,query:()=>nge,refreshEventDrawOrder:()=>HK,removeEventMatchUpFormatTiming:()=>kL,removeScaleValues:()=>GK,removeSeeding:()=>Ege,setEventDates:()=>LK,setEventDisplay:()=>xL,setEventEndDate:()=>FK,setEventStartDate:()=>OK,updateDrawIdsOrder:()=>$K,validateCategory:()=>tP});var hge={};Fi(hge,{generateEventsFromTieFormat:()=>Age});function hje({tournamentId:t,event:e}){return e?(bi({payload:{tournamentId:t,event:e},key:e.eventId,topic:Ype}),{...se}):{error:Vr}}var mje={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},Aje={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},gje={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},mge={COLLEGE_D3:mje,COLLEGE_DEFAULT:Aje,COLLEGE_JUCO:gje,DOMINANT_DUO:Kde,DOMINANT_DUO_MIXED:Qde,LAVER_CUP:epe,TEAM_DOUBLES_3_AGGREGATION:Lde,TIME_TENNIS_DUAL:jde,TIME_TENNIS_PRO_CIRCUIT:Gde,USTA_BREWER_CUP:zde,USTA_OZAKI_CUP:qde,USTA_COLLEGE:Yde,USTA_GOLD_TEAM_CHALLENGE:Fde,USTA_INTERSECTIONAL:Vde,USTA_LEVEL_1:Xde,USTA_SECTION_BATTLE:Hde,USTA_SOUTHERN_LEVEL_5:$de,USTA_TOC:tpe,USTA_WTT_ITT:Zde,USTA_ZONAL:Jde};function ZC({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){if(!e)return{error:rt};if(e.events||(e.events=[]),!r)return{error:Vr};let{startDate:n,endDate:a}=e;if(!i&&(r.entries?.length||r.drawDefinitions?.length)){let o=Ft({drawDefinitions:!!r.drawDefinitions?.length,entries:!!r.entries?.length});return{info:"entries/drawDefinitions cannot exist",error:be,context:o}}let s={eventType:$I,drawDefinitions:[],entries:[],startDate:n,endDate:a,...r};if(r.eventType===jl){if(r.tieFormat){let o=Ko({tieFormat:r.tieFormat});if(o.error)return o}else if(r.tieFormatName){if(!mge[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:be};let o=Nm({isMock:e?.isMock,namedFormat:r.tieFormatName,event:r});s.tieFormat=o}}if(s.eventId||(s.eventId=fr()),e.events.reduce((o,l)=>o||l.eventId===s.eventId,void 0))return{error:Iue};{let o=s;if(e.events.push(o),!t){let{topics:l}=kc();if(l.includes(NF)){let d=Vh({event:r}).matchUps??[];fg({tournamentId:e?.tournamentId,eventId:r.eventId,matchUps:d})}let{drawDefinitions:c,...u}=r;for(let d of c||[])W1({drawDefinition:d});hje({tournamentId:e?.tournamentId,event:u})}return{...se,event:s}}}function Age(t){let e=Gt(t,[{[IT]:{[IF]:!0,[Ppe]:!0}},{[Sa]:!0}]);if(e.error)return e;let i=t.tieFormat||Nm({namedFormat:t.tieFormatName}),r=t.uuids||[Ode(i.collectionDefinitions.length)],n={[aa]:[],[Cs]:[]};if(t.addEntriesFromTeams){let s=t.tournamentRecord.participants?.filter(o=>o.participantType===zo)?.flatMap(o=>o.individualParticipantIds??[]);for(let o of t.tournamentRecord.participants??[])if(s?.includes(o.participantId)){let l=o.person?.sex;if(l&&rf(l)){let c=Ws(l);c&&n[c].push(o.participantId)}}}let a=[];for(let s of i.collectionDefinitions??[]){let o=r?.pop()?.toString()||fr(),l=s.matchUpType,c=s.gender,u={matchUpFormat:s.matchUpFormat,eventName:s.collectionName,category:s.category,gender:c,eventType:l,eventId:o};if(t.addEntriesFromTeams){let d=l===Bm?bu:t.entryStatus||Il,p=Uc(c)?[...n[aa],...n[Cs]]:n[Ws(c)||pm]??[];if(p.length){let f=zp({participantIds:p,entryStatus:d,event:u});if(f.error)return f}}if(a.push(u),t.addEvents!==!1){let d=ZC({internalUse:!0,tournamentRecord:t.tournamentRecord,event:u});if(d.error)return d}}return{...se,events:a}}var gge={};Fi(gge,{addDrawDefinition:()=>LR,addEvent:()=>ZC,addFlight:()=>_L,assignSeedPositions:()=>Cge,attachFlightProfile:()=>VK,deleteDrawDefinitions:()=>BL,deleteEvents:()=>Dge,deleteFlightAndFlightDraw:()=>Uge,deleteFlightProfileAndFlightDraws:()=>bge,modifyEvent:()=>Pge,modifyEventMatchUpFormatTiming:()=>Ige,modifyPairAssignment:()=>Tge,refreshEventDrawOrder:()=>HK,removeEventMatchUpFormatTiming:()=>kL,removeScaleValues:()=>GK,removeSeeding:()=>Ege,setEventDates:()=>LK,setEventDisplay:()=>xL,setEventEndDate:()=>FK,setEventStartDate:()=>OK,updateDrawIdsOrder:()=>$K,validateCategory:()=>tP});function JC({removePriorValues:t=!0,status:e=_c,statusObject:i,event:r}){if(!Ki(i))return{error:be};let n=Su({event:r,status:e}),a=`${qg}.${Wg}`,s={itemValue:{[e]:{...n,...i}},itemType:a};return zw({timeItem:s,removePriorValues:t,event:r})}function eE(t){let e=Gt(t,[{[Sa]:!0,[lA]:!0},{eventDataParams:!1,[il]:pl}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:r,tournamentRecord:n,status:a=_c,event:s,drawIdsToRemove:o,drawIdsToAdd:l}=t,{appliedPolicies:c}=er({tournamentRecord:n,event:s}),u={...c,...t.policyDefinitions},d=s?.drawDefinitions?.map(({drawId:I})=>I)??[],p=t.drawDetails?Object.keys(t.drawDetails):[],f=p.length?[]:t.drawIds,h=(l??[]).concat(...o??[],...f??[],...p),m=h.filter(I=>!d.includes(I));if(m.length)return le({result:{error:Ec},context:{invalidDrawIds:m}});let A=Su({event:s,status:a}),g=Object.keys(A?.drawDetails||{}).filter(I=>d.includes(I)).reduce((I,w)=>(I[w]=A.drawDetails[w],I),{});for(let I of d)if((!h.length||h.includes(I))&&(o?.includes(I)||f?.length&&!f.includes(I)?g[I]={...g[I],publishingDetail:{published:!1}}:(l?.includes(I)||f?.includes(I)||!f?.length)&&(g[I]={...g[I],publishingDetail:{published:!0}})),t.drawDetails?.[I]){let w=t.drawDetails[I],S=w.structureDetails??g[I].structureDetails,T=w.stageDetails??g[I].stageDetails??{},{structureIdsToRemove:D=[],structureIdsToAdd:C=[],publishingDetail:E={},stagesToRemove:P=[],stagesToAdd:R=[]}=w;if((C||R)&&(E.published=!0),g[I]={publishingDetail:E,structureDetails:S,stageDetails:T},C.length||D.length){let N=(s?.drawDefinitions?.find(O=>O.drawId===I)?.structures??[]).map(({structureId:O})=>O),k=(C??[]).concat(D??[]).filter(O=>!N.includes(O));if(k.length)return le({result:{error:nn},context:{invalidStructureIds:k}});S=S??{};for(let O of N)D.includes(O)?S[O]={published:!1}:S[O]={published:!0};g[I].structureDetails=S}let M=(s?.drawDefinitions?.find(N=>N.drawId===I)?.structures??[]).map(({stage:N})=>N);if(R.length){for(let N of R)T[N]={published:!0};for(let N of M)T[N]||(T[N]={published:!1})}if(R.length||P.length){for(let N of P)T[N]={published:!1};for(let N of M)T[N]||(T[N]={published:!0})}(R.length||P.length)&&(g[I].stageDetails=T)}JC({statusObject:{drawDetails:g},removePriorValues:r,status:a,event:s});let{topics:v}=kc(),b=v.includes(Cj),y=b||t.returnEventData?ER({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:n,policyDefinitions:u,event:s})?.eventData:void 0;return b&&bi({payload:{eventData:y,tournamentId:n.tournamentId},topic:Cj}),{...se,eventData:y}}var vge="deleteDrawDefinitions",Zj="autoSchedulingAudit",Bk="deleteEvents",yge={AUTO_SCHEDULING_AUDIT:Zj,DELETE_EVENTS:Bk,DELETE_DRAW_DEFINITIONS:vge};function BL(t){if(!t.tournamentRecord)return{error:rt};let e="deleteDrawDefinitions",i=t.drawIds??[],r=t.event,{autoPublish:n=!0,tournamentRecord:a,auditData:s,eventId:o,force:l}=t,{appliedPolicies:c}=er({tournamentRecord:a,event:r}),u={...c,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!r){let T=Xo({tournamentRecord:a,eventId:o,drawId:d});if(T.error)return T;r=T.event}let p=[],f=[],h=[];if(!r?.drawDefinitions)return le({info:"event has no drawDefinition",result:{...se},stack:e});let m=r.drawDefinitions.map(({drawId:T})=>T);if(i.length||(i=m),i=i.filter(T=>m.includes(T)),!i.length)return le({info:"nothing to do; no matching drawIds in event.",result:{...se},stack:e});let A=St(Bn({event:r}).flightProfile,!1,!0),g=({participantId:T,drawPosition:D,qualifier:C,bye:E})=>({bye:E,qualifier:C,drawPosition:D,participantId:T}),v=l??c?.[du]?.allowDeletionWithScoresPresent?.drawDefinitions,b=Su({event:r})??{},y=b.drawIds??(b.drawDetails&&Object.keys(b.drawDetails))??[],I,w=[],S=r.drawDefinitions.filter(T=>{if(i.includes(T.drawId)){let D=Do({event:r,drawDefinition:T})?.matchUps??[];if(D.some(({score:F})=>ya({score:F}))&&!v)return w.push(T.drawId),!0;let{drawId:C,drawType:E,drawName:P}=T,R=A?.flights?.find(F=>F.drawId===T.drawId);R&&(R.drawEntries=R.drawEntries?.filter(F=>Pd.includes(F.entryStatus))),y.includes(C)&&(y=y.filter(F=>F!==C),I=!0);let M=yd({stageSequence:1,drawDefinition:T,stage:Ut})?.structures?.[0],N=(M?ET({structureId:M.structureId,tournamentRecord:a,drawDefinition:T}):void 0)?.positionAssignments?.map(g),k=yd({stage:zt,drawDefinition:T})?.structures,O=k?.length?k.map(F=>{let _=F.stageSequence;return{positionAssignments:ET({structureId:F.structureId,tournamentRecord:a,drawDefinition:T})?.positionAssignments.map(g),stageSequence:_}}):void 0,x={action:vge,payload:{drawDefinitions:[T],eventId:o??r?.eventId,auditData:s}};h.push(x),p.push(Ft({tournamentId:a.tournamentId,eventId:o??r?.eventId,qualifyingPositionAssignments:O,positionAssignments:N,auditData:s,drawType:E,drawName:P,drawId:C})),D?.forEach(({matchUpId:F})=>f.push(F))}return!i.includes(T.drawId)});if(w.length&&!l)return le({context:{drawIdsWithScoresPresent:w},result:{error:_1},stack:e});if(r.drawDefinitions=S,A&&Qg({event:r,extension:{name:vd,value:A}}),xR({tournamentRecord:a}),I){let T={};for(let C of y)T[C]=b.drawDetails?.[C]??{published:!0};let D=JC({statusObject:{drawDetails:T},event:r});if(D.error)return{error:D.error}}if(h.length)if(uF(wm)){let T=a.tournamentId;bi({topic:wm,payload:{tournamentId:T,detail:h}});let D=(yu({element:r,itemType:ey})?.timeItem?.itemValue||0)+1;Pf({element:r,timeItem:{itemType:ey,itemValue:D},removePriorValues:!0})}else vje({appliedPolicies:c,event:r,deletedDrawsDetail:p,auditData:s});if(f.length&&$h({tournamentId:a?.tournamentId,matchUpIds:f}),i.forEach(T=>cLe({drawId:T})),n&&I){let T=eE({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:u,tournamentRecord:a,event:r});if(T.error)return{...se,info:T.error}}return{...se}}function vje({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){if(t?.audit?.[ey]===!1)return;let{extension:n}=Bi({name:ey,element:e}),a={...r,deletedDrawsDetail:i},s={value:Array.isArray(n?.value)?n?.value.concat(a):[a],name:ey};lr({element:e,extension:s})}function bge({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){if(!e)return{error:rt};if(!r)return{error:Vr};let{flightProfile:a}=Bn({event:r});if(a){let s=a.flights?.map(({drawId:l})=>l).filter(Boolean),o=BL({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return o.error?o:EF({event:r,name:vd})}return{...se}}function xK(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,s=t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(s).length)return{error:yn};let o=Object.keys(s).filter(c=>!n||n===c);if(n&&!o.includes(n))return{error:be};let l;for(let c of o){let u=s[c],{event:d}=Xo({tournamentRecord:u,eventId:a});a&&d&&(l=!0);let p=yje({tournamentRecord:u,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...se}:{error:cu}}function yje({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:rt};if(r&&!Array.isArray(r))return{error:be};if(e&&!Array.isArray(e))return{error:be};let a=_m;if(n){let{extension:s}=Bi({element:n,name:a}),o=s?.value||{},l=Nee({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});lr({element:n,extension:{name:a,value:l}})}else{let{extension:s}=Bi({element:t,name:a}),o=s?.value||{},l=Nee({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});lr({extension:{name:a,value:l},element:t})}return{...se}}function Nee(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let s=n?.length&&i.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(c=>c!==r)}:l).filter(({matchUpFormatCodes:l})=>l?.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let o=a?.length&&e.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(c=>c!==r)}:l).filter(({matchUpFormatCodes:l,averageTimes:c})=>l?.length||c).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:s?.length&&s||i,matchUpRecoveryTimes:o?.length&&o||e}}function Ige(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:s,event:o}=t;if(!e)return{error:rt};if(!Ql({matchUpFormat:n}))return{error:be};if(!o)return{error:Vr};let{averageTimes:l=[],recoveryTimes:c=[]}=PL({tournamentRecord:e,matchUpFormat:n,event:o}),u=o.category,d=u?.categoryName||u?.ageCategoryCode||o?.eventId,p={categoryNames:[d],minutes:{}},f={categoryNames:[d],minutes:{}},h=b=>{if(b.categoryTypes?.includes(a)&&console.log("encountered:",{categoryType:a}),!(b.categoryNames?.includes(d)&&(b.categoryNames=b.categoryNames.filter(y=>y!==d),p={minutes:b.minutes,categoryNames:[d]},!b.categoryNames.length)))return b},m=r&&!isNaN(ri(r)),A=i&&!isNaN(ri(i)),g=l.map(h).filter(b=>b?.categoryNames?.length),v=c.map(h).filter(b=>b?.categoryNames?.length);return m&&(Object.assign(p.minutes,{[o?.eventType||Er]:r}),g.push(p)),A&&(Object.assign(f.minutes,{[o?.eventType||Er]:i}),v.push(f)),!m&&!A?{error:be}:xK({averageTimes:m&&g,recoveryTimes:A&&v,tournamentRecord:e,matchUpFormat:n,eventId:s})}function kL(t){if(t.event)return Bee({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=Gt(t,[{[Xs]:!0,[kpe]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=Xo({tournamentRecord:n,eventId:r});if(a)return Bee({event:a})}}return{error:cu}}function Bee({event:t}){return EF({event:t,name:_m})}var _K={MON:"MON",TUE:"TUE",WED:"WED",THU:"THU",FRI:"FRI",SAT:"SAT",SUN:"SUN"};function wge(t){return!Array.isArray(t)||Ci(t).length!==t.length?!1:t.every(e=>Object.keys(_K).includes(e))}function OK({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:rt};if(!e)return{error:Vr};if(!nf.test(i))return{error:fa};let r=Sge(t),n="setEventStartDate";if(r.error)return le({result:r,stack:n});let{tournamentStartDate:a,tournamentEndDate:s}=r,o=new Date(Si(i)).getTime();if(!a||!s||o<a||o>s)return le({result:{error:fa},stack:n,info:"startDate must be within tournament start and end dates"});let l=e.endDate&&new Date(Si(e.endDate)).getTime();return l&&o>l&&(e.endDate=i),e.startDate=i,{...se}}function FK(t){let{tournamentRecord:e,event:i,endDate:r}=t;if(!e)return{error:rt};if(!i)return{error:Vr};if(!nf.test(r))return{error:fa};let n=Sge(e);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:s}=n,o=new Date(Si(r)).getTime();if(!a||!s||o<a||o>s)return{error:fa};let l=i.startDate&&new Date(Si(i.startDate)).getTime();return l&&o<l&&(i.startDate=r),i.endDate=r,{...se}}function LK(t){let e="setEventDates",i=Gt(t,[{tournamentRecord:!0,event:!0},{[Es]:c=>nf.test(c),[Dc]:fa,startDate:!1,endDate:!1},{[Es]:c=>c.filter(Boolean).every(u=>nf.test(u)),[Dc]:fa,activeDates:!1},{[Es]:wge,weekdays:!1}]);if(i.error)return i;let{tournamentRecord:r,weekdays:n,event:a,startDate:s,endDate:o}=t,l=t.activeDates?.filter(Boolean);if(s&&o){let c=new Date(Si(s)).getTime(),u=new Date(Si(o)).getTime();if(c>u)return le({result:{error:be},stack:e,info:"startDate cannot be after endDate"})}if(l){let c=s||r.startDate,u=o||r.endDate,d=!c||l.every(f=>new Date(f)>=new Date(c)),p=!u||l.every(f=>new Date(f)<=new Date(u));if(!d||!p)return le({result:{error:fa},stack:e})}if(s){let c=OK({tournamentRecord:r,event:a,startDate:s});if(c.error)return le({result:c,stack:e})}if(o){let c=FK({tournamentRecord:r,event:a,endDate:o});if(c.error)return le({result:c,stack:e})}return l&&(a.activeDates=l),n&&(a.weekdays=n),{...se}}function Sge(t){let{startDate:e,endDate:i}=t;return!nf.test(e)||!nf.test(i)?le({result:{error:xue},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Si(e)).getTime(),tournamentEndDate:new Date(Si(i)).getTime()}}function $K({event:t,orderedDrawIdsMap:e}){if(typeof t!="object")return{error:Vr};if(!e)return{error:Kt,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:be,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(n=>!Number.isNaN(Number(n))))return{error:be,info:"drawOrder must be numeric"};if(Ci(i).length!==i.length)return{info:"drawOrder values must be unique",error:be};if(t.drawDefinitions?.length){let n=(t.drawDefinitions||[]).map(({drawId:s})=>s),a=Object.keys(e);if(a?.length&&Pn(n,a).length!==n.length)return{error:be,info:"Missing drawIds"};t.drawDefinitions.forEach(s=>{s.drawOrder=e[s.drawId]})}let{flightProfile:r}=Bn({event:t});return r?.flights?.forEach(n=>{n.flightNumber=e[n.drawId]}),{...se}}function HK({tournamentRecord:t,event:e}){if(!t)return{error:rt};if(!e)return{error:Vr};let{flightProfile:i}=Bn({event:e}),r=i?.flights?.sort((s,o)=>s.flightNumber-o.flightNumber).map(s=>s.drawId).filter(Boolean),n=e.drawDefinitions?.sort((s,o)=>s.drawOrder-o.drawOrder).map(s=>s.drawId).filter(Boolean).filter(s=>!r?.includes(s)),a=Object.assign({},...[...r||[],...n||[]].map((s,o)=>({[s]:o+1})));return a?$K({event:e,orderedDrawIdsMap:a}):{...se}}function Uge({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){if(!e)return{error:rt};if(!r)return{error:fp};if(!n)return{error:Vr};let{flightProfile:s}=Bn({event:n});if(s&&s.flights?.find(o=>o.drawId===r)){let o=s.flights.filter(c=>c.drawId!==r),l={name:vd,value:{...s,flights:o}};Qg({event:n,extension:l})}if(n.drawDefinitions?.find(o=>o.drawId===r)){let o=BL({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(o.error)return o}return HK({tournamentRecord:e,event:n})}function Tge(t){let e=Gt(t,[{[lA]:!0,[Sa]:!0,[Yq]:!1},{replacementIndividualParticipantId:!0,[Es]:A=>Lr(A),existingIndividualParticipantId:!0,[id]:ga,participantId:!0}]),{replacementIndividualParticipantId:i,existingIndividualParticipantId:r,tournamentRecord:n,drawDefinition:a,participantId:s,event:o,uuids:l}=t;if(e.error)return e;if(o?.eventType!==uu)return{error:ph};if(!(o?.entries?.filter(({entryStatus:A})=>[bu,sb].includes(A)).map(({participantId:A})=>A)||[]).includes(i))return{error:np};let c=(n.participants||[]).find(A=>A.participantId===s);if(c?.participantType!==Mi)return{error:gy,participant:c};let u=c.individualParticipantIds,d=[i,...u.filter(A=>A!==r)],{participant:p}=bd({participantIds:d,tournamentRecord:n}),f;if(p)f=p.participantId;else{let A={participantId:l?.pop(),participantRole:Ns,individualParticipantIds:d,participantType:Mi},g=uf({participant:A,returnParticipant:!0,tournamentRecord:n});if(g.error)return g;f=g.participant.participantId}let{flightProfile:h}=Bn({event:o});if(a){let A=h?.flights?.find(({drawId:g})=>g===a.drawId);A&&(A.drawEntries=A.drawEntries.map(g=>g.participantId===s?{...g,participantId:f}:g)),a.entries=a.entries.map(g=>g.participantId===s?{...g,participantId:f}:g);for(let g of a.structures||[])if(g.structures){g.positionAssignments=void 0;for(let v of g.structures)v.positionAssignments=v.positionAssignments.map(b=>b.participantId===s?{...b,participantId:f}:b)}else g.positionAssignments&&(g.positionAssignments=g.positionAssignments.map(v=>v.participantId===s?{...v,participantId:f}:v))}o.entries=o.entries.map(A=>A.participantId===s&&{...A,participantId:f}||A.participantId===i&&{...A,participantId:r}||A);let m=n.events.some(({entries:A,eventId:g,drawDefinitions:v})=>o.eventId===g?v.some(({drawId:b,entries:y})=>b===a?.drawId?!1:y?.find(I=>I.participantId===s)):A?.find(b=>b.participantId===s));if(!m){let A=Hw({addIndividualParticipantsToEvents:!1,participantIds:[s],tournamentRecord:n});if(A.error)return A}return{...se,participantOtherEntries:m,newPairParticipantId:f}}function LR(t){let{flight:e,suppressNotifications:i,modifyEventEntries:r,existingDrawCount:n,allowReplacement:a,checkEntryStatus:s,tournamentRecord:o,drawDefinition:l,event:c}=t;if(!l)return{error:Bt};if(!c)return{error:Vr};c.drawDefinitions||(c.drawDefinitions=[]);let{drawId:u,drawName:d,entries:p}=l,{entries:f}=c,h=0;if(n!==void 0&&n!==c.drawDefinitions.length)return{error:be,info:"drawDefintions count mismatch"};let{flightProfile:m}=Bn({event:c}),A=e&&m?.flights?.find(P=>P.flightNumber===e.flightNumber),g=m?.links?.find(P=>P?.target?.drawId===u)?.source?.drawId;if(g&&!c.drawDefinitions.find(P=>P.drawId===g))return le({result:{error:Bt},info:{sourceDrawId:g}});if(A&&A.drawId!==l.drawId)return le({result:{error:AI},info:{relevantFlight:A}});let v=p?.every(({participantId:P,entryStatus:R})=>{let M=A?.drawEntries.find(N=>N.participantId===P);return!R||M?.entryStatus===R}),b=!s||f&&p?.every(({participantId:P,entryStatus:R,entryStage:M})=>f.find(N=>N.participantId===P&&(!N.entryStage||N.entryStage===M))?.entryStatus===R);if(A&&!v)return le({result:{error:AI},context:{drawEntriesPresentInFlight:v,matchingEventEntries:b,relevantFlight:A},info:"Draw entries are not present in flight or do not match entryStatuses"});if(r&&p?.filter(Boolean).forEach(P=>{if(P?.entryStatus&&Pd.includes(P?.entryStatus)){let R=f?.filter(Boolean).find(M=>M.participantId===P.participantId);R&&P.entryStatus&&R?.entryStatus!==P.entryStatus&&(R.entryStatus=P.entryStatus,h+=1)}}),f&&!b)return le({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:b,eventEntries:f},error:AI}});let y=m?.flights?.map(({flightNumber:P})=>!isNaN(P)&&ri(P))?.filter(Boolean)||[],I=c.drawDefinitions.map(({drawOrder:P})=>P&&ri(P))?.filter(Boolean)||[],w=Math.max(0,...I,...y)+1,S=m?.flights?.find(P=>P.drawId===u),T;if(S){S.drawName=l.drawName,T={name:vd,value:{...m,flights:m.flights}};let P=S.flightNumber;P&&!I.includes(P)?w=P:S.flightNumber=w}else{let P=m?.flights||[];P.push({manuallyAdded:!0,flightNumber:w,drawEntries:p,drawName:d,drawId:u}),T={name:vd,value:{...m||{},flights:P}}}Qg({event:c,extension:T}),Object.assign(l,{drawOrder:w});let D=c.drawDefinitions.find(P=>P.drawId===u),C=o?.tournamentId,E=c.eventId;if(D){if(!a)return{error:due};let P=Do({drawDefinition:D})?.matchUps?.map(xa)??[],R=Do({drawDefinition:l})?.matchUps;if(!i){P?.length&&$h({matchUpIds:P,action:"modifyDrawDefinition",tournamentId:C,eventId:E}),R?.length&&fg({matchUps:R,tournamentId:C,eventId:E}),c.drawDefinitions=c.drawDefinitions.map(N=>N.drawId===u?l:N);let M=l.structures?.map(({structureId:N})=>N);Br({drawDefinition:l,tournamentId:C,structureIds:M,eventId:E})}}else if(c.drawDefinitions.push(l),!i){let{matchUps:P}=Do({drawDefinition:l,event:c});P&&fg({tournamentId:o?.tournamentId,matchUps:P}),W1({drawDefinition:l,tournamentId:C,eventId:E})}return{...se,modifiedEventEntryStatusCount:h}}function Cge(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,assignments:o,drawId:l,event:c}=t,u=0;if(!o?.length)return{error:sq};if(!r)return{error:rt};if(!l)return{error:fp};let d=pu({provisionalPositioning:e,drawDefinition:n,structureId:s});if(d.error)return d;let{seedAssignments:p,seedLimit:f}=d,h=Object.assign({},...(p??[]).filter(g=>g.seedNumber).map(g=>({[g.seedNumber]:g})));o.forEach(g=>{let{seedNumber:v}=g;f&&v<=f&&(!i||h[v])&&(h[v]=g)});let m=Object.values(h),A=m.map(g=>g?.participantId).filter(Boolean);if(A.length!==Zce(A).length)return{error:pue};for(let g of m){let v=zC({...g,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,event:c});if(v?.error)return v;v?.success&&u++}return u?{...se,modifications:u}:{error:MC}}function VK({deleteExisting:t,event:e,flightProfile:i}){let r="attachFlightProfile";if(!i)return le({result:{error:Kt},stack:r});if(!e)return le({result:{error:Vr},stack:r});let{flightProfile:n}=Bn({event:e});return n&&!t?le({result:{error:Tq},stack:r}):e.drawDefinitions?.length?le({result:{error:sue},stack:r}):(Qg({event:e,extension:{name:vd,value:i}}),{flightProfile:St(i,!1,!0),...se})}function bje({tournamentRecord:t,scaleAttributes:e,participantIds:i}){if(!t)return{error:rt};if(!i)return{error:Lg};if(!e)return{error:Kt,info:"scaleAttributes required"};let{scaleType:r,eventType:n,scaleName:a}=e,s=[Cfe,r,n,a].join(".");return t.participants?.forEach(o=>{i.includes(o.participantId)&&o.timeItems&&(o.timeItems=o.timeItems.filter(l=>l&&l?.itemType!==s))}),{...se}}function GK({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:s}){if(!a)return{error:Vr};if(r&&!Array.isArray(r))return le({result:{error:be},info:Ey("entryStatus"),stack:"removeScaleValues"});let o=a.entries;if(n){let{flightProfile:c}=Bn({event:a}),u=c?.flights?.find(d=>d.drawId===n);u?o=u.drawEntries:o=i?.entries}let l=(o||[]).filter(c=>(!s||!c.entryStage||c.entryStage===s)&&(!r||r.includes(c.entryStatus))).map(ji);return bje({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function xL({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=_c,event:n}){if(!e)return le({result:{error:rt}});if(!n)return le({result:{error:Vr}});if(!Ki(i))return le({result:{error:Kt}});if(Ki(i.draws))for(let s of Object.keys(i.draws)){let o=i.draws[s].scheduleDetails??[];if(o.length){let l=[];for(let c of o){let u=l.find(d=>V_e(d.attributes,c.attributes));u?.dates&&c.dates?u.dates.push(...c.dates):l.push(c)}i.draws[s].scheduleDetails=l}}let a=JC({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...se}}function Ege({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:s}){if(!t)return{error:rt};if(!a)return{error:Vr};r=r||a.category?.categoryName||a.category?.ageCategoryCode;let o={eventType:a.eventType,scaleType:eh,scaleName:r};return GK({tournamentRecord:t,scaleAttributes:o,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:s})}function Dge(t){let e=Gt(t,[{[Sa]:!0},{eventIds:!0,[il]:zs}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=t,a=[],s=[],o=[],l=[];if(r.events=(r.events||[]).filter(c=>{if(n.includes(c.eventId)){let p={action:Bk,payload:{events:[c]}};a.push(p),s.push({tournamentId:r.tournamentId,eventName:c.eventName,eventType:c.eventType,category:c.category,eventId:c.eventId,gender:c.gender})}let u=c.eventType===uu?(c.entries||[]).map(({entryStatus:p,participantId:f})=>p!==bu&&f).filter(Boolean):[],d=n.includes(c.eventId);return d?l.push(...u):o.push(...u),!d}),i){let c=l.filter(u=>!o.includes(u));r.participants=r.participants.filter(({participantId:u})=>!c.includes(u))}if(xR({tournamentRecord:r}),a.length)if(uF(wm)){let c=r.tournamentId;bi({topic:wm,payload:{type:Bk,tournamentId:c,detail:a}})}else TR({tournamentRecord:r,timeItem:{itemValue:s,itemType:Bk}});return{...se}}function Pge(t){let e=Gt(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:pl}]);if(e.error)return e;let{eventUpdates:i,event:r}=t,n="modifyEvent",a=Tje(t),s=Cje({enteredParticipants:a}),{enteredParticipantGenders:o,enteredParticipantTypes:l}=s,c=Bn({event:r})?.flightProfile?.flights,u=!r.drawDefinitions?.length&&!c?.length,d=Eje({noFlightsNoDraws:u,enteredParticipantGenders:o,eventUpdates:i,stack:n});if(d.error)return d;let p=Dje({enteredParticipantTypes:l,eventUpdates:i,stack:n});if(p.error)return p;let f=Ije({...t,...s,enteredParticipants:a,stack:n});if(f.error)return f;let h=Uje({...t,stack:n});return h.error?h:(i.eventType&&(r.eventType=i.eventType),i.eventName&&(r.eventName=i.eventName),i.gender&&(r.gender=i.gender),{...se})}function Ije(t){let e=t.eventUpdates?.category;if(!e)return{...se};let i=tP({category:e});if(i.error)return i;if(t.event.eventType===ca){let r=wje(t);if(r.error)return r}if(t.enteredParticipants?.length){let r=Sje(t,e);if(r.error)return r}return{...se}}function wje(t){let e=t.event?.drawDefinitions?.map(n=>Rp(n))??[],i=Rp(t.event),r=(Vh(t)?.matchUps??[]).map(n=>Rp(n))??[];return[i,...e,...r].filter(Boolean).every(n=>n.collectionDefinitions.every(a=>!a.category||F1({category:t.eventUpdates.category,childCategory:a.category})))?{...se}:le({result:{error:W0},stack:t.stack})}function Sje(t,e){let i=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,r=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,n=t.enteredParticipants.flatMap(o=>o.participantType===zi?[o]:o.individualParticpants??[]),a=yy({category:e,consideredDate:i}),s=yy({category:e,consideredDate:r});if(a?.ageMinDate||a?.ageMaxDate||s?.ageMinDate||s?.ageMaxDate)for(let o of n){let l=o.person?.birthDate;if(!l)return le({result:{error:Mue},stack:t.stack});let c=new Date(l).getTime(),u=kee(c,a,t.stack);if(u)return u;let d=kee(c,s,t.stack);if(d)return d}return{...se}}function kee(t,e,i){if(!e)return null;if(e.ageMinDate||e.ageMaxDate){let r=new Date(e.ageMinDate).getTime(),n=new Date(e.ageMaxDate).getTime();if(t<r||t>n)return le({result:{error:Fue},stack:i})}return null}function Uje(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=LK({startDate:i.startDate||r.startDate||e.startDate,endDate:i.endDate||r.endDate||e.endDate,tournamentRecord:e,event:r});if(a.error)return le({result:a,stack:n})}return{...se}}function Tje(t){let{tournamentRecord:e,event:i}=t,r=i?.entries?.filter(({entryStatus:n})=>{let a=n;return[...Pd,rd].includes(a)}).map(({participantId:n})=>n)??[];return r?gn({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function Cje({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{let s=a.person?.sex?[a.person.sex]:a.individualParticpants?.map(o=>o.person?.sex)||[];return e.push(...s),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=Ci(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function Eje({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:r}){let n=!e.length||!i.gender||fh(i.gender)||e.length===1&&e[0]===i.gender||t&&Uc(i.gender);return i.gender&&!n?le({context:{gender:i.gender,validGender:n},result:{error:XD},stack:r}):{...se}}function Dje({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(ca)&&[ca]||t.includes(zi)&&[af]||t.includes(Mi)&&[uu]||[uu,af,ca]).includes(e.eventType??"");return e.eventType&&!r?le({context:{participantType:e.eventType,validEventType:r},result:{error:ph},stack:i}):{...se}}function _L({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){let s="addFlight";if(!n)return le({result:{error:Vr},stack:s});if(!i)return le({result:{error:Kt},stack:s});if(e?.length){let f=(n.entries??[]).map(ji),h=e.map(ji);if(Pn(h,f).length!==h.length)return le({result:{error:be},stack:s})}let o=Bn({event:n})?.flightProfile,l=o?.flights?.map(({flightNumber:f})=>!isNaN(f)&&ri(f))?.filter(Boolean)||[],c=Math.max(0,...l)+1,u={drawId:r||fr(),flightNumber:c,drawEntries:e,drawName:i};if(a&&(u.stage=a),t&&(u.qualifyingPositions=t),(o?.flights||[]).find(({drawId:f})=>f===u.drawId))return le({result:{error:pde},stack:s});let d=(o?.flights||[]).concat(u),p={name:vd,value:{...o||{},flights:d}};return Qg({event:n,extension:p})}var QK={};Fi(QK,{drawMatic:()=>Z5,garman:()=>Oge,generateAdHocMatchUps:()=>uL,generateAdHocRounds:()=>X5,generateAndPopulatePlayoffStructures:()=>U5,generateCourts:()=>jK,generateDrawDefinition:()=>FR,generateDrawMaticRound:()=>$5,generateDrawStructuresAndLinks:()=>O5,generateDrawTypeAndModifyDrawDefinition:()=>F5,generateFlightProfile:()=>Rje,generateLineUps:()=>_ge,generateQualifyingStructure:()=>A5,generateSeedingScaleItems:()=>oge,generateStatCrew:()=>Mje,generateVoluntaryConsolation:()=>Kme,roundRobinGroups:()=>Z2e});var Pje="splitLevelBased",Rge="splitWaterfall",Mge="splitShuttle",Nge={SPLIT_LEVEL_BASED:Pje,SPLIT_WATERFALL:Rge,SPLIT_SHUTTLE:Mge};function Rje(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:s,sortDescending:o,drawNames:l=[],flightsCount:c,splitMethod:u,uuids:d=[],event:p,stage:f}=t;if(!p)return{error:Vr};let h=p.entries??[],{flightProfile:m}=Bn({event:p});if(m&&i&&!s)return{error:Tq};let A=t.scaledEntries??Ww({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:o,event:p,stage:f}).scaledEntries,g=new Set(A.map(ji)),v=To(h.filter(({participantId:C})=>!g.has(C)).filter(C=>(!f||!C.entryStage||C.entryStage===f)&&(!C.entryStatus||ob.includes(C.entryStatus)))),b=A.concat(...v),y=b.length,I=Math.ceil(y/c),w=Oa(b,I);u===Rge?w=cj(b,c):u===Mge&&(w=cj(b,c,!0));function S(C){return(C||[]).map(({participantId:E,scaleValue:P})=>{let R=h.find(M=>M.participantId===E);return R?.scaleValue&&P&&(R.scaleValue=P),R}).sort((E,P)=>E.scaleValue-P.scaleValue).map((E,P)=>(E.scaleValue&&(E.seedNumber=P+1),E))}let T=gt(0,c).map(C=>{let E=C+1;return{flightNumber:E,drawId:d?.pop()??fr(),drawEntries:S(w[C]),drawName:l?.length&&l[C]||`${e} ${E}`}}),D={scaleAttributes:n,splitMethod:u,flights:T};if(i){let C=VK({flightProfile:D,deleteExisting:s,event:p});return{splitEntries:Gl()&&w||void 0,...C}}else return{flightProfile:D,...se}}function Bge({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(s=>typeof s=="object"&&Object.keys(s).length===1)})),r=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),n=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return kge({tagName:e,attributes:n,childArrays:i,childObjects:r})}function kge(t){let{tagName:e,attributes:i=[],childArrays:r=[],childObjects:n}=t,a=`\r
`,s=f=>{let h=Object.keys(f)[0],m=f[h];return{key:h,value:m}},o=r?.map(({key:f,value:h})=>kge({tagName:f,childObjects:h.map(s)})).join(`\r
`),l=n?.map(({key:f,value:h})=>Bge({tagName:f,json:h??[]})).join(`\r
`),c=i?.map(({key:f,value:h})=>`${f}="${h}"`).join(" "),u=c?` ${c}`:"";if(e==="childArray")return l;let d=l?.length?`${a}${l}${a}`:"",p=o?.length?`${a}${o}${a}`:"";return`<${e}${u}>${d}${p}</${e}>`}function Mje(t){let e=Gt(t,[{[Sa]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{startDate:r,tournamentId:n,tournamentName:a}=i,{participantMap:s,matchUps:o,mappedMatchUps:l}=gn({withMatchUps:!0,withEvents:!0,tournamentRecord:i}),c=i.participants.filter(b=>b.participantType===gr),u=o?.filter(b=>b.matchUpType===gr)??[],d=u?.reduce((b,y)=>{let I=y?.tieMatchUps??[];return I&&[...b,...I]},[])??[],p=o?.filter(b=>b.matchUpType===Er)??[],f=o?.filter(b=>b.matchUpType===yr)??[],h=d.length===p.length+f.length,m=u.length===1&&h,A={mappedMatchUps:l,participantMap:s,tournamentName:a,tournamentId:n,tournament:h?"N":"Y",startDate:r},g=[],v=[];if(m){let b=u[0],{json:y,xml:I}=xee({teamParticipants:c,teamMatchUp:b,...A,doubles:f,singles:p});v.push(y),g.push(I)}else for(let b of u){let y=b?.sides?.map(({participant:T})=>T?.participantId).filter(Boolean);if(y?.length!==2)continue;let I=y.map(T=>T&&s?.[T]?.participant),{xml:w,json:S}=xee({doubles:b.tieMatchUps?.filter(T=>T.matchUpType===yr),singles:b.tieMatchUps?.filter(T=>T.matchUpType===Er),teamParticipants:I,teamMatchUp:b,...A});v.push(S),g.push(w)}return{json:v,xml:g,...se}}function xee({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:s,startDate:o,doubles:l,singles:c}){let u=t?.find(y=>y.participantRoleResponsibilities?.includes("Home")),d=t?.filter(y=>y.participantId!==u?.participantId),p=ed(o,"/","MDY"),f=u?.participantName||d?.[1]?.participantName,h=u?.participantId||d?.[1]?.participantId,m=d?.[0]?.participantName,A=d?.[0]?.participantId,g={},v=t.map(y=>({team:{...kje({teamParticipant:y,teamMatchUp:a,uniValues:g,participantMap:i,mappedMatchUps:e,homeid:h})}})),b=Ft({venue:{tournamentname:s?r:void 0,neutralgame:u?"N":"Y",gameid:n,officials:{},tournament:s,rules:{},homename:f,visname:m,homeid:h,visid:A,date:p},childArray:v,singles_matches:c?.map(y=>_ee({matchUp:y,homeid:h,uniValues:g})),doubles_matches:l?.map(y=>_ee({matchUp:y,homeid:h,uniValues:g}))});return{json:b,xml:Bge({json:b,tagName:"tngame"})}}function Nje({homeid:t,uniValues:e,participant:i}){if(!i)return{};let r=i.individualParticipants?.length===2,n=r?Ci(i.individualParticipants?.map(m=>m.teams?.[0]?.participantId)):[],a=r?Ci(i.individualParticipants?.map(m=>m.teams?.[0]?.teamId)):[],s=!r&&i.teams?.[0]?.participantId||n?.length===1&&n[0]||void 0,o=!r&&i.teams?.[0]?.teamId||a?.length===1&&a[0]||s,l=r?void 0:i.participantName,c=i.individualParticipants?.[0]?.participantName,u=i.individualParticipants?.[1]?.participantName,d=t&&(s===t?"H":"V")||"",p=r?void 0:e[s][i.participantId],f=e[s][i.individualParticipants?.[0]?.participantId],h=e[s][i.individualParticipants?.[1]?.participantId];return Ft({vh:d,uni:p,uni_1:f,uni_2:h,team:o,name:l,name_1:c,name_2:u})}function Bje({sets:t,sideNumber:e}){return Object.assign({},...t?.map(i=>{let{setNumber:r,side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o}=i,l=`set_${r}`,c=`tie_${r}`,u=e===1?n:a,d=e===1?s:o;return{[l]:u,[c]:d}})??[])}function kje({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){let{participantId:s,participantName:o}=t,l=n&&(s===n?"H":"V")||"",c=i?.[s]?.matchUps,u=c&&Object.keys(c),d=e?.sides?.find(({participant:y})=>y.participantId===s)?.sideNumber,p=e?.score?.sets?.[0]?.[`side${d}Score`]??0;a[s]={};let f={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},h=[],m=[],A=0;for(let y of u??[]){let I=r?.[y],w=I.sides.find(({participant:T})=>T.participantId===s)?.sideNumber,S=I.score?.sets?.[0]?.[`side${w}Score`]??0;A+=S;for(let T of I.tieMatchUps??[]){let{matchUpType:D,winningSide:C}=T,E=C&&(C===w?"w":"l")||"";E&&(f[D][E]+=1);let P=E==="w"?"1":"0",R=E==="l"?"1":"0";if(D===Er){let M=m.length+1;m.push({singles_pair:{pair:M,won:P,lost:R,tied:"0"}})}else if(D===yr){let M=h.length+1;h.push({doubles_pair:{pair:M,won:P,lost:R,tied:"0"}})}}}let g=[{singles:{childArray:m,won:f.SINGLES.w,lost:f.SINGLES.l}},{doubles:{childArray:h,won:f.DOUBLES.w,lost:f.DOUBLES.l}}],v=[],b=1;for(let y of t.individualParticipantIds){let I=i?.[y];if(I){let{participant:w,counters:S}=I,T={won:S?.DOUBLES?.wins||0,lost:S?.DOUBLES?.losses||0},D={won:S?.SINGLES?.wins||0,lost:S?.SINGLES?.losses||0},{participantName:C,participantId:E}=w;a[s][E]=b,v.push({player:{name:C,uni:b,singles:D,doubles:T}})}b+=1}return{vh:l,id:s,name:o,score:p||A,totals:g,childArray:v}}function _ee({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:s}=t??{},o=s?.map(l=>{let{sideNumber:c,participant:u}=l,d=Bje({sets:t.score?.sets,sideNumber:c});return{[a===Er?"singles_score":"doubles_score"]:{...Nje({homeid:e,uniValues:i,participant:u}),...d}}});return{[a===Er?"singles_match":"doubles_match"]:{match:r,order:n,childArray:o}}}var xje="DESC",Jj="DESC",xge={ASC:"ASC",ASCENDING:"ASC",DESC:xje,DESCENDING:Jj};function _ge(t){let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:r,drawDefinition:n,scaleAccessor:a,singlesOnly:s,attach:o,event:l}=t;if(l?.eventType!==jl)return{error:ph};if(!r)return{error:rt};if(!e&&!n)return{error:Ec};if(e=e??uo({drawDefinition:n,event:l})?.tieFormat,Ko({tieFormat:e}).error)return{error:Jf};if(typeof a!="object"&&!i)return{error:be,context:{scaleAccessor:a}};let c={},u=(n?.entries??l?.entries??[]).filter(E=>E?.entryStatus===Il).map(ji),{participants:d=[]}=gn({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:r}),p=d.filter(({participantId:E})=>u.includes(E)),f=E=>E===ug?"rankings":"ratings",h=l?.category?.categoryName??l?.category?.ageCategoryCode,{scaleName:m=h,scaleType:A=ug,sortOrder:g,accessor:v}=a||{},b=f(A),y=(E,P)=>{let R=E[b]?.[P];if(!R&&i&&(R=E[b]?.[mI]),Array.isArray(R)){let M=R.find(N=>N.scaleName===m)?.scaleValue;if(Sn(M))return M;if(v&&typeof M=="object")return M[v]}return 0},I=(E,P,R)=>{let M=g===Jj?P:E,N=g===Jj?E:P;return y(M,R)-y(N,R)},w=(E,P)=>I(E,P,mI),S=(E,P)=>I(E,P,Ay),T=[],D=e?.collectionDefinitions??[];for(let E of p){let P=E.individualParticipants?.sort(w)??[],R=s?P:E.individualParticipants?.sort(S)??[],M={};for(let k of D){let O=[],{collectionId:x,matchUpCount:F,matchUpType:_,gender:V}=k,G=$n(mI)(_);gt(0,F).forEach(z=>{let Q=G?P:R??[],j=z+1,W=[];gt(0,G?1:2).forEach(Y=>{let X=Q?.find(J=>{let ie=Ws(V),ue=ie&&(rf(V)&&ie||Uc(V)&&[aa,Cs][Y]);return(!ue||ue===J.person?.sex)&&!O.includes(J.participantId)})?.participantId;X&&(W.push(X),O.push(X),M[X]||(M[X]=[]),M[X].push({collectionPosition:j,collectionId:x}))}),G||T.push(W)})}let N=Object.keys(M).map(k=>({collectionAssignments:M[k],participantId:k}));c[E.participantId]=N}let C=[];for(let E of T){let{participant:P}=bd({tournamentParticipants:d,participantIds:E});if(!P){let R={individualParticipantIds:E,participantRole:Ns,participantType:Mi};C.push(R)}}if(o){for(;C.length;)uf({participant:C.pop(),tournamentRecord:r});lr({element:n,extension:{name:xm,value:c}})}return{...se,lineUps:c,participantsToAdd:C}}function jK(t){if(!t)return{error:Kt};let e=Gt(t,[{dates:!1,[Es]:s=>Array.isArray(s)&&s.every(Co)},{uuids:!1,[Es]:s=>Array.isArray(s)&&s.every(Lr)},{startTime:!1,endTime:!1,[Es]:xq},{idPrefix:!1,namePrefix:!1,[Es]:Lr},{count:!0,[Es]:Sn}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&AT(i,r)||[],a=gt(1,t.count+1).map(s=>Ft({courtId:t.uuids?.pop()??(t.idPrefix&&`${t.idPrefix}-${s}`)??fr(),courtName:t.courtNames?.pop()??(t.namePrefix&&`${t.namePrefix} ${s}`),dateAvailability:n.map(o=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:o}))}));return{...se,courts:a}}var Oge={};Fi(Oge,{default:()=>Fje,garman:()=>$ge});function tE(t){let e=Gt(t,[{courtDate:!0,_ofType:pl}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=Zn(r.startTime);(r.bookings||[]).filter(o=>!o.bookingType||!i.includes(o.bookingType)).sort((o,l)=>(Px(o.startTime)||"").localeCompare(Px(l.startTime)||"")).forEach(o=>{let l={startTime:qr(a.toISOString()),endTime:o.startTime};Zn(o.startTime)>a&&n.push(l),Zn(o.endTime)>a&&(a=Zn(o.endTime))});let s={startTime:qr(a.toISOString()),endTime:r.endTime};return Zn(r.endTime)>a&&n.push(s),{timeSlots:n}}function _je({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=s=>{let{timeSlots:o}=tE({includeBookingTypes:e,courtDate:s});return!!o?.filter(a)?.length};function a(s){let o=Zn(s.startTime),l=Zn(s.endTime);return o>i||l<r?!1:O1(i,l)>=t}return{enoughTime:n}}function Fge(t){let e=Gt(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:zs}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,s=t.courts,o=Zn(n),l=Oq(o,i),{enoughTime:c}=_je({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:o,periodEndTime:l});return{availableToScheduleCount:(s?.filter(u=>{if(!Array.isArray(u.dateAvailability))return!1;let d=gg({date:a,court:u});return!!(d&&c(d))})||[]).length,...se}}function OL(t){let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:r=30,scheduleDate:n,courts:a=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(a)||!a.length)return{error:be,courts:a};if(!Array.isArray(s))return{error:Tx};if(!Co(n))return{error:fa};i&&(Array.isArray(i)?i.includes(n)&&(s=[]):s=[]);let{courtBookings:o,unassignedBookings:l}=s.reduce((p,f)=>{let{courtId:h}=f;return h?p.courtBookings[h]?p.courtBookings[h].push(f):p.courtBookings[h]=[f]:p.unassignedBookings.push(f),p},{courtBookings:{},unassignedBookings:[]}),c=a.map((p,f)=>{let{courtId:h,courtName:m}=p,A=o[h]||[],g=gg({date:n,court:p})||{},{bookings:v=[],startTime:b,endTime:y,date:I}=g,w=[e[f]&&{startTime:b,endTime:e[f]},...St(v,!1,!0),...A].filter(Boolean);return{courtId:h,courtName:m,dateAvailability:{bookings:w,startTime:b,endTime:y,date:I}}});l.sort((p,f)=>ar(p.startTime)-ar(f.startTime));let u=()=>c.flatMap(p=>{let f=p.dateAvailability,{timeSlots:h=[]}=tE({courtDate:f});return{courtName:p.courtName,courtId:p.courtId,timeSlots:h}}),d=[];for(let p of l){let{startTime:f,endTime:h,averageMinutes:m,recoveryMinutes:A,matchUpId:g}=p,v=ar(f),b=ar(h),y=u().reduce((I,{courtId:w,courtName:S,timeSlots:T})=>{let D;return T.find(({startTime:C,endTime:E})=>{D=ar(C)-v;let P=v>=ar(C);return b<=ar(E)&&I.startDifference!==0&&((D===0||D+r>=0)&&(I.startDifference===void 0||D<I.startDifference)||P)})?{courtName:S,courtId:w,startDifference:D}:I},{});if(y.courtId){let I={averageMinutes:m,recoveryMinutes:A,matchUpId:g,startTime:f,endTime:h};d.push(I),c.find(({courtId:w})=>w===y.courtId)?.dateAvailability.bookings.push(I)}else console.log({unassignedBooking:p})}return{virtualCourts:c.map(({courtId:p,courtName:f,dateAvailability:h})=>({dateAvailability:[h],courtName:f,courtId:p})),assignedBookings:d}}function FL({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function Lge(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return gt(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function RT({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,s)=>{let o=gg({date:t,court:s}),l=n&&(o?.[n]||s[n]);return l&&(!a||e&&ar(l)<ar(a)||i&&ar(l)>ar(a))?l:a},void 0)}function Oje({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||RT({courts:r,scheduleDate:n,startTime:!0}),i=i||RT({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let s=Zn(e),o=Zn(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let c=gg({court:l,date:n}),{timeSlots:u}=tE({courtDate:c});u?.forEach(d=>{let p=Zn(d.startTime),f=Zn(d.endTime);if(p>o||p<s||f<s)return!1;if(O1(p,f)>=t){let h=qr(p.toISOString());h&&(!a||h<a)&&(a=h)}})}}return{firstTimeSlotStartTime:a}}function zK(t){let e=Gt(t,[{courts:!0,_ofType:zs}]);if(e.error)return e;let{date:i=kq(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:s}=t,{calculateStartTimeFromCourts:o=!0,remainingScheduleTimes:l,averageMatchUpMinutes:c,clearScheduleDates:u,courtsCount:d,bookings:p}=t;a=a||FL({averageMatchUpMinutes:c}),i=Si(i),r=qr(r),n=qr(n);let f=0,h=0,m=0,A=0,g=0;!s&&d&&(s=Lge({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:v}=OL({remainingScheduleTimes:l,clearScheduleDates:u,scheduleDate:i,periodLength:a,bookings:p,courts:s}),{firstTimeSlotStartTime:b}=Oje({averageMinutes:c,courts:v,startTime:r,endTime:n,date:i});o&&b&&(r=b??r);let y=ar(r),I=ar(n)-y,w=Math.floor(I/a),S=gt(0,w+1).map(T=>{let D=y+T*a,C=aFe(D),E=Fge({courts:v??[],averageMatchUpMinutes:c,periodStart:C,date:i});if(E.error)return{error:E.error};let{availableToScheduleCount:P=0}=E,R=P>h?P-h:0;g+=T?P:0;let M=T?g/T:P,N=a*M/c,k=T?N*(T-1)+M:M,O=P?h&&k-f||R:0;f=k,h=P,m+=O;let x=ri(m)-A;return A+=x,{periodStart:C,add:x,availableToScheduleCount:P,newCourts:R,totalMatchUps:A}});return{scheduleTimes:S.reduce((T,D)=>{let C=gt(0,D.add).map(()=>({scheduleTime:D.periodStart}));return T.concat(...C)},[]).flat(),timingProfile:S,totalMatchUps:A}}var $ge={getCourtsAvailableAtPeriodStart:Fge,generateTimeSlots:tE,getScheduleTimes:zK,courtGenerator:Lge},Fje=$ge,Xx={};Fi(Xx,{isValid:()=>Ql,isValidMatchUpFormat:()=>Ql,parse:()=>vs,stringify:()=>hF});var qK={};Fi(qK,{allCompetitionMatchUps:()=>sp,allDrawMatchUps:()=>Do,allEventMatchUps:()=>Vh,allTournamentMatchUps:()=>La,analyzeMatchUp:()=>bP,applyLineUps:()=>cve,assignMatchUpSideParticipant:()=>Vge,assignTieMatchUpParticipantId:()=>Zx,bulkMatchUpStatusUpdate:()=>ave,calculateWinCriteria:()=>Kw,checkInParticipant:()=>KK,checkMatchUpIsComplete:()=>ty,checkOutParticipant:()=>WK,competitionScheduleMatchUps:()=>OR,disableTieAutoCalc:()=>ive,drawMatchUps:()=>CK,enableTieAutoCalc:()=>Jge,eventMatchUps:()=>RL,filterMatchUps:()=>hm,findMatchUp:()=>dK,getAllDrawMatchUps:()=>ea,getAllStructureMatchUps:()=>cr,getCheckedInParticipantIds:()=>Ow,getCompetitionMatchUps:()=>yP,getEventMatchUpFormatTiming:()=>gK,getHomeParticipantId:()=>IK,getMatchUpCompetitiveProfile:()=>sR,getMatchUpContextIds:()=>wK,getMatchUpDailyLimits:()=>NL,getMatchUpDailyLimitsUpdate:()=>vK,getMatchUpDependencies:()=>Rd,getMatchUpFormat:()=>SK,getMatchUpFormatTiming:()=>oR,getMatchUpFormatTimingUpdate:()=>AK,getMatchUpScheduleDetails:()=>QF,getMatchUpType:()=>jF,getMatchUpsStats:()=>UK,getModifiedMatchUpFormatTiming:()=>PL,getParticipantResults:()=>wR,getPredictiveAccuracy:()=>bK,getRoundMatchUps:()=>ko,getRounds:()=>TK,isValidMatchUpFormat:()=>Ql,matchUpActions:()=>lL,mutate:()=>Hge,participantScheduledMatchUps:()=>yK,query:()=>JAe,removeDelegatedOutcome:()=>eve,removeMatchUpSideParticipant:()=>ZK,removeTieMatchUpParticipantId:()=>Qge,replaceTieMatchUpParticipantId:()=>XK,resetAdHocMatchUps:()=>ove,resetMatchUpLineUps:()=>a6,resetScorecard:()=>o6,resetTieFormat:()=>s6,setDelegatedOutcome:()=>sve,setMatchUpFormat:()=>rve,setMatchUpState:()=>fb,setMatchUpStatus:()=>$R,setOrderOfFinish:()=>lve,substituteParticipant:()=>tve,tallyParticipantResults:()=>KC,toggleParticipantCheckInState:()=>LL,tournamentMatchUps:()=>ML,updateTieMatchUpScore:()=>pA,validMatchUp:()=>FF,validMatchUps:()=>wu});var Hge={};Fi(Hge,{applyLineUps:()=>cve,assignMatchUpSideParticipant:()=>Vge,assignTieMatchUpParticipantId:()=>Zx,bulkMatchUpStatusUpdate:()=>ave,checkInParticipant:()=>KK,checkOutParticipant:()=>WK,disableTieAutoCalc:()=>ive,enableTieAutoCalc:()=>Jge,findMatchUp:()=>dK,removeDelegatedOutcome:()=>eve,removeMatchUpSideParticipant:()=>ZK,removeTieMatchUpParticipantId:()=>Qge,replaceTieMatchUpParticipantId:()=>XK,resetAdHocMatchUps:()=>ove,resetMatchUpLineUps:()=>a6,resetScorecard:()=>o6,resetTieFormat:()=>s6,setDelegatedOutcome:()=>sve,setMatchUpFormat:()=>rve,setMatchUpState:()=>fb,setMatchUpStatus:()=>$R,setOrderOfFinish:()=>lve,substituteParticipant:()=>tve,toggleParticipantCheckInState:()=>LL,updateTieMatchUpScore:()=>pA});function Vge({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){if(i&&typeof i!="string")return{error:np};if(!e)return{error:Bt};if(!n)return{error:mo};let s=r===void 0;if(s&&(r=1),![1,2].includes(r))return le({result:{error:be,context:{sideNumber:r}}});let{matchUp:o,structure:l}=Wr({drawDefinition:e,matchUpId:n,event:a});if(!o)return{error:Ys};if(!(!l?.structures&&!(e.drawType&&e.drawType!==zl)&&!l?.matchUps?.find(({roundPosition:c})=>!!c)))return{error:iq};if(!i&&(o?.score?.scoreStringSide1||qn.includes(o?.matchUpstatus)||o?.matchUpStatus&&[mn,ha].includes(o.matchUpStatus)))return{error:iF,info:"matchUp has completed status or score"};if(o){if(o.sides=[1,2].map(c=>{let u=o.sides?.find(d=>d.sideNumber===c)??{sideNumber:c};return r===c?{...u,participantId:i}:u}),s)for(let c of o.sides)c.sideNumber&&(c.sideNumber=3-c.sideNumber);Yi({tournamentId:t?.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:o})}return{...se,sidesSwapped:s}}function Yl({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s,event:o}){let{matchUp:l}=Wr({drawDefinition:r,event:o,matchUpId:a});if(!l)return{error:Ys};let c=Pf({removePriorValues:t,element:l,duplicateValues:i,timeItem:s});return n||Yi({tournamentId:e?.tournamentId,eventId:o?.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),c}function WK(t){let e=[{[Sa]:!0},{[to]:!0},{[yh]:!0},{[Cf]:!0}],i=Gt(t,e);if(i.error)return i;let r=XC(t,[{[kC]:Lh,attr:{[wF]:!0}}]);if(r.error)return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=r?.matchUp?.matchUp,{matchUpStatus:c,score:u}=l??{};if(c&&MF.includes(c)||c&&qn.includes(c)||ya({score:u}))return{error:mue};let d=Ow({matchUp:l});if(d?.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:f}=d??{};if(!f?.includes(s))return{error:np};if(!p?.includes(s))return{error:jue};let h=bfe({matchUp:l});if(h?.error)return h;let{sideParticipantIds:m,nestedIndividualParticipantIds:A}=h??{},g=m?.indexOf(s);return g!==void 0&&[0,1].includes(g)&&(A?.[g]??[]).forEach(v=>{Yl({drawDefinition:a,matchUpId:o,timeItem:{itemType:Lx,itemValue:v}})}),Yl({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:Lx}}),{...se,checkedOut:!0}}function KK(t){let e=[{[Sa]:!0},{[to]:!0},{[yh]:!0},{[Cf]:!0}],i=Gt(t,e);if(i[id])return i;let r=XC(t,[{[kC]:Lh,attr:{[wF]:!0}}]);if(r[id])return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=Ow({matchUp:r?.matchUp?.matchUp});if(l?.error)return l;let{checkedInParticipantIds:c,allRelevantParticipantIds:u}=l??{};if(!u?.includes(s))return{[id]:np};let d={...se,checkedIn:!0};return c?.includes(s)||Yl({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:Fx}}),d}function LL(t){let e=Gt(t,[{[yh]:!0,[to]:!0,[Cf]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,r=t.tournamentRecord??(i&&t.tournamentRecords?.[i]);if(!r)return{error:rt};let n=XC(t,[{[kC]:Lh,attr:{[wF]:!0},[id]:Ys}]).matchUp?.matchUp;if(!n)return{error:Ys};let{checkedInParticipantIds:a=[]}=Ow({matchUp:n}),{participantId:s,matchUpId:o,drawDefinition:l}=t;return s&&a.includes(s)?WK({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n}):KK({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n})}function YK({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){if(!t)return{error:rt};if(!e)return{error:fp};if(!r)return{error:cu};let n=ss({drawDefinition:e}),{matchUp:a}=Wr({matchUpId:i,drawDefinition:e,matchUpsMap:n});if(!a)return{error:Ys};let{matchUp:s,structure:o}=Wr({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:n,event:r});if(!s)return{error:Ys};let{collectionPosition:l,drawPositions:c,collectionId:u,matchUpTieId:d,matchUpType:p}=s;if(p&&!XO([Er,yr],p))return{error:bl};let{positionAssignments:f}=Ir({structure:o}),h=f?.filter(w=>c?.includes(w.drawPosition)),{matchUp:m}=Wr({matchUpId:d,drawDefinition:e,matchUpsMap:n}),A=m?.sides?.map(ji)??[],g=h?.map(ji)??[],v=[...A,...g],{participants:b}=gn({tournamentRecord:t,participantFilters:{participantTypes:[gr],participantIds:v}}),{matchUp:y}=Wr({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:n}),I=uo({matchUp:m,drawDefinition:e,structure:o,event:r})?.tieFormat;return{inContextDualMatchUp:y,inContextTieMatchUp:s,relevantAssignments:h,collectionPosition:l,teamParticipants:b,collectionId:u,matchUpType:p,dualMatchUp:m,tieMatchUp:a,tieFormat:I,structure:o,...se}}function XK(t){let e=YK(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:r,tournamentRecord:n,newParticipantId:a,drawDefinition:s,substitution:o,event:l}=t;if(!r||!a)return le({result:{error:ga},stack:i});if(r===a)return{...se};let{inContextDualMatchUp:c,inContextTieMatchUp:u,collectionPosition:d,collectionId:p,dualMatchUp:f,tieMatchUp:h,tieFormat:m}=e,A=u?.matchUpType,g=u?.sides?.find(x=>x.participant?.participantId===r||x.participant?.individualParticipantIds?.includes(r));if(!g)return{error:On};let v=gn({tournamentRecord:n,participantFilters:{participantIds:[r,a]}})?.participants??[];if(v.length!==2)return le({result:{error:ga},stack:i});if(v[0].participantType!==v[1].participantType)return le({result:{error:ap},stack:i});let{appliedPolicies:b}=er({tournamentRecord:n,drawDefinition:s,event:l}),y=t.policyDefinitions?.[Xa]??b?.[Xa]??jC[Xa],I=v.find(({participantId:x})=>x===a);if((t.enforceGender??y?.participants?.enforceGender)!==!1&&rf(u?.gender)&&Ws(u?.gender)!==Ws(I?.person?.sex))return{error:gy,info:"Gender mismatch"};let w=y?.processCodes?.substitution;UR({tournamentId:n.tournamentId,eventId:l.eventId,inContextDualMatchUp:c,drawDefinition:s,dualMatchUp:f});let S=f?.sides?.find(({sideNumber:x})=>x===g.sideNumber);if(!S)return le({result:{sideNumber:g.sideNumber,existingParticipantId:r,error:ts},stack:i});if(u?.sides?.flatMap(x=>x.participant?.individualParticipantIds||x.participant?.participantId||[])?.includes(a))return le({result:{error:nF},stack:i});let T=c?.sides?.find(({sideNumber:x})=>x===g.sideNumber)?.participantId,D=S.lineUp,C=D?.find(({participantId:x})=>a===x),E=D?.reduce((x,F)=>F.substitutionOrder>x?F.substitutionOrder:x,0),P=D?.map(x=>{let F=St(x,!1,!0);if(![r,a].includes(F.participantId))return F;if(!o&&[r,a].includes(F.participantId)&&(F.collectionAssignments=F.collectionAssignments?.filter(_=>!(_.collectionPosition===d&&_.collectionId===p))),o&&r===F.participantId&&(F.collectionAssignments=F.collectionAssignments.map(_=>_.collectionPosition===d&&_.collectionId===p&&_.substitutionOrder===void 0?{..._,substitutionOrder:E}:_)),F.participantId===a){F.collectionAssignments||(F.collectionAssignments=[]);let _={collectionId:p,collectionPosition:d};o&&(_.previousParticipantId=r,_.substitutionOrder=(E??0)+1),F.collectionAssignments.push(_)}return F})??[];if(!C){let x={collectionId:p,collectionPosition:d};o&&(x.substitutionOrder=(E??0)+1,x.previousParticipantId=r);let F={collectionAssignments:[x],participantId:a};P.push(F)}let R=A===yr,{assignedParticipantIds:M}=$x({lineUp:D,collectionPosition:d,collectionId:p}),{assignedParticipantIds:N}=$x({lineUp:P,collectionPosition:d,collectionId:p});if(S.lineUp=P,T&&m){let x=Gw({participantId:T,lineUp:P,drawDefinition:s,tieFormat:m});if(x.error)return le({result:x,stack:i})}else console.log("team participantId not found");let k,O;if(R){let{tournamentRecord:x}=t,F=bd({participantIds:N,tournamentRecord:x});if(!F.participant){let V=uf({returnParticipant:!0,pairOverride:!0,tournamentRecord:x,participant:{participantRole:Ns,individualParticipantIds:N,participantType:Mi}});if(V.error)return le({result:V,stack:i});k=V.participant?.participantId}F=bd({participantIds:M,tournamentRecord:x});let _=F.participant?.participantId;_&&Hw({participantIds:[_],tournamentRecord:x}).success&&(O=_)}if(o||g.substitutions?.length===1){if(o)w&&h&&(h.processCodes=Ci([...h?.processCodes??[],...w]));else for(let x of w||[]){let F=h?.processCodes?.lastIndexOf(x);F!==void 0&&h?.processCodes?.splice(F,1)}h&&Yi({tournamentId:n?.tournamentId,matchUp:h,context:i,drawDefinition:s})}return f&&Yi({tournamentId:n?.tournamentId,matchUp:f,context:i,drawDefinition:s}),{...se,modifiedLineUp:P,participantRemoved:O,participantAdded:k}}function Gge({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){if(!a||!t||!Array.isArray(n))return{modifiedLineUp:i?.lineUp||[],error:be};let s=i?.lineUp||Ty({participantId:e,drawDefinition:r})?.lineUp,o=[],l=[];return{modifiedLineUp:s?.map(c=>{if(!n.includes(c.participantId))return c;let u=c.collectionAssignments?.filter(d=>{let p=d.collectionId===a&&d.collectionPosition===t;return p&&(d.previousParticipantId&&o.push(d.previousParticipantId),l.push({participantId:c.participantId,...d})),!p});return{participantId:c.participantId,collectionAssignments:u}}).filter(Boolean)||[],assignmentsRemoved:l,previousParticipantIds:o}}function Lje({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r=(i.events||[]).filter(a=>a?.eventType===ca&&a?.entries?.some(s=>s.participantId===e)),n=a=>!t.includes(a.participantId);for(let a of r){a.entries=(a.entries||[]).filter(n);let{flightProfile:s}=Bn({event:a});s?.flights?.forEach(o=>{o.drawEntries=(o.drawEntries||[]).filter(n)}),a?.drawDefinitions?.forEach(o=>{o.entries=(o.entries||[]).filter(n)})}return{...se}}function $L({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return le({result:{error:rt},stack:n});if(!e||!t)return le({result:{error:Kt},stack:n});let a=r.participants??[],s=a.find(d=>d.participantId===e);if(!s)return le({result:{error:On},stack:n});if(s?.participantType&&![gr,xc].includes(s.participantType))return le({context:{participantType:s.participantType},result:{error:ap},stack:n});let o=t.filter(d=>a.find(p=>p.participantId===d)?.participantType!==zi);if(o.length)return le({result:{error:Fl,invalidParticipantIds:o},stack:n});s.individualParticipantIds||(s.individualParticipantIds=[]);let l=s.individualParticipantIds,c=t.filter(d=>!l.includes(d));c.length&&(i&&WF({individualParticipantIds:c,tournamentRecord:r}),s.individualParticipantIds=s.individualParticipantIds.concat(...c));let{topics:u}=kc();if(u.includes(Fs)){let d=a.find(({participantId:p})=>p===e);bi({topic:Fs,payload:{participants:[d]}})}return Lje({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:St(s,!1,!0),added:c.length,...se}}function HL(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:s}=t;if(!n)return{error:rt};if(!s)return{error:Tw};if(!s.participantId)return uf({tournamentRecord:n,participant:s});let{participant:o}=zg({participantId:s.participantId,tournamentRecord:n});if(!o)return uf({tournamentRecord:n,participant:s});let{participantRoleResponsibilties:l,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:p,participantType:f,onlineResources:h,contacts:m,person:A}=s;if(f&&o.participantType!==f)return{error:Oue};let g={};if(m&&(g.contacts=m),h&&(g.onlineResources=h),u&&Lr(u)&&(g.participantOtherName=u),d&&Lr(d)&&(g.participantName=d),Array.isArray(c)){let{participants:v}=gn({participantFilters:{participantTypes:[zi]},tournamentRecord:n}),b=v?.map(ji);if(b){let y=c.filter(I=>Lr(I)&&b.includes(I));([xc,$r].includes(f||o.participantType)||f===Mi&&(y.length===2||a))&&(g.individualParticipantIds=y),o.participantType===XU.PAIR&&e&&(g.participantName=$je({individualParticipants:v,newValues:g}))}}return Object.keys(Yg).includes(p)&&(g.participantRole=p),Object.keys(XU).includes(f)&&(g.participantType=f),Array.isArray(l)&&(g.participantRoleResponsibilties=l),o.participantType===XU.INDIVIDUAL&&A&&Hje({updateParticipantName:e,existingParticipant:o,newValues:g,person:A}),Object.assign(o,Ft(g)),i&&$L({individualParticipantIds:[o.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),bi({topic:Fs,payload:{tournamentId:n.tournamentId,participants:[o]}}),{participant:St(o),...se}}function $je({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n?.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function Hje({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:s,nationalityCode:o,personId:l,birthdate:c,tennisId:u,sex:d}=r;d&&Object.keys(Fh).includes(d)&&(n.sex=d);let p;if(Lr(l)&&(n.personId=l),o&&Lr(o)&&(Vje(o)||o==="")&&(n.nationalityCode=o),a&&typeof Lr(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),s&&typeof Lr(s)&&s.length>1&&(n.standardGivenName=s,p=!0),p&&t){let f=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=f}c&&Co(c)&&(n.birthdate=c),u&&Lr(u)&&(n.tennisId=u),Object.assign(e.person,n)}function Vje(t){return ng.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function Zx(t){let e=YK(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",r=t.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:s,event:o}=t;if(!s)return le({result:{error:ga},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return le({result:{error:pq},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:c,relevantAssignments:u,collectionPosition:d,teamParticipants:p,collectionId:f,matchUpType:h,dualMatchUp:m,tieFormat:A}=e;if(c?.sides?.flatMap(_=>_.participant?.individualParticipantIds||_.participant?.participantId||[])?.includes(s))return le({result:{...se},stack:i});r=r??(t.sideNumber?l?.sides?.find(_=>_.sideNumber===t.sideNumber)?.participantId:void 0);let g=gn({participantFilters:{participantIds:[s]},tournamentRecord:n})?.participants?.[0];if(!g)return le({result:{error:On},stack:i});let{appliedPolicies:v}=er({tournamentRecord:n,drawDefinition:a,event:o}),b=t.policyDefinitions?.[Xa]??v?.[Xa]??jC[Xa];if((t.enforceGender??b?.participants?.enforceGender)!==!1&&rf(c?.gender)&&Ws(c?.gender)!==Ws(g.person?.sex))return{error:gy,info:"Gender mismatch"};let{individualParticipantIds:y,participantType:I}=g;if($n(Er)(h)&&I!==zi)return{error:ap};let w=I===zi?[s]:y,S=r&&p?.find(({participantId:_})=>_===r)||p?.find(({individualParticipantIds:_})=>Bo(w,_));if(!S)return{error:wq};if(r||(r=S.participantId),!r)return{error:On};let T=u?.find(_=>_.participantId===S?.participantId)?.drawPosition,D=m?.sides?.find(_=>_.participantId===r)?.sideNumber,C=c?.sides?.find(_=>T&&_.drawPosition===T)?.sideNumber,E=D??C??t.sideNumber;if(!A)return{error:PC};if(!A.collectionDefinitions?.find(_=>_.collectionId===f))return{error:Due};UR({tournamentId:n.tournamentId,eventId:o.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:m});let P=m?.sides?.find(_=>_.sideNumber===E),R=c?.sides?.find(_=>_.sideNumber===E),M=(P?.lineUp??Ty({participantId:r,drawDefinition:a})?.lineUp)?.filter(_=>_.collectionAssignments?.find(V=>V.collectionPosition===d&&V.collectionId===f&&!V.previousParticipantId))?.map(_=>_?.participantId),N=M?.length>1&&M||(I===Mi?g.individualParticipantIds:[s]),k=Gge({collectionPosition:d,teamParticipantId:r,dualMatchUpSide:P,drawDefinition:a,participantIds:N,collectionId:f});if(k.error)return le({result:k,stack:i});let{modifiedLineUp:O}=k,x;if(h===yr){if(I!==Mi){let _=EV({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:s,collectionId:f,tieFormat:A});if(_?.error)return le({result:_,stack:i});if(_=F({side:R}),_.error)return _;x=_.deletedParticipantId,P&&(P.lineUp=O),m&&Yi({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:a})}else if(I===Mi)for(let _ of N)EV({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:_,collectionId:f,tieFormat:A})}else{let _=EV({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:s,collectionId:f,tieFormat:A});if(_?.error)return _}if(P&&(P.lineUp=O),m&&Yi({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:a}),x){let{error:_}=Hw({participantIds:[x],tournamentRecord:n});_&&console.log("cleanup")}return{...se,modifiedLineUp:O};function F({side:_}){let V;if(_.participant){let G=_.participant.individualParticipantIds||[];if(G.filter(Boolean).length===1){let{participant:z}=bd({participantIds:G,tournamentRecord:n});G.push(s);let{participant:Q}=bd({participantIds:G,tournamentRecord:n});if(!Q&&z){z.individualParticipantIds=G;let j=HL({pairOverride:!0,tournamentRecord:n,participant:z});if(j.error)return j}else V=z?.participantId}}else{let G=uf({participant:{individualParticipantIds:[s],participantRole:Ns,participantType:Mi},pairOverride:!0,tournamentRecord:n});if(G.error)return G}return{...se,deletedParticipantId:V}}}function EV({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:s}){let o=Ty({participantId:e,drawDefinition:i})?.lineUp,l=(r||o)?.find(u=>u?.participantId===n),c={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(c);else{let u={collectionAssignments:[c],participantId:n};r.push(u)}return Gw({participantId:e,lineUp:r,drawDefinition:i,tieFormat:s})}function Qge(t){let{tournamentRecord:e,drawDefinition:i,participantId:r,event:n}=t,a="removeTieMatchUpParticiapantId";if(!r)return le({result:{error:ga},stack:a});let s=YK(t);if(s.error)return s;let{appliedPolicies:o}=er({tournamentRecord:e,drawDefinition:i,event:n}),l=(t.policyDefinitions?.[Xa]??o?.[Xa]??jC[Xa])?.processCodes?.substitution,{inContextDualMatchUp:c,inContextTieMatchUp:u,relevantAssignments:d,collectionPosition:p,teamParticipants:f,collectionId:h,matchUpType:m,dualMatchUp:A,tieMatchUp:g,tieFormat:v}=s;if(!A)return le({result:{error:Wo},stack:a});let b=u?.sides?.find(E=>E.participant?.participantId===r||E.participant?.individualParticipantIds?.includes(r));if(!b)return le({result:{error:On},stack:a});let y=t.policyDefinitions?.[du]??o?.[du];if(!b.substitutions?.length&&(ya({score:u?.score})||u?.winningSide)&&y?.requireParticipantsForScoring!==!1)return le({result:{error:fde},stack:a});let I=c?.sides?.find(({sideNumber:E})=>E===b.sideNumber)?.participantId;if(!I)return le({result:{error:On},stack:a});let w=gn({participantFilters:{participantIds:[r]},tournamentRecord:e})?.participants?.[0];if(!w)return le({result:{error:On},stack:a});if(m===Er&&w.participantType===Mi)return le({result:{error:gy},stack:a});let S=w.participantType===zi?[r]:w.individualParticipantIds;UR({tournamentId:e.tournamentId,eventId:n.eventId,inContextDualMatchUp:c,drawDefinition:i,dualMatchUp:A});let T=A.sides?.find(({sideNumber:E})=>E===b.sideNumber);if(!T&&(A.sides?.filter(({lineUp:E})=>!E).length||0)<2){let E=f?.map(({participantId:P})=>({drawPosition:d?.find(R=>R.participantId===P)?.drawPosition,teamParticipantId:P}));T=A.sides?.find(P=>E?.find(({drawPosition:R})=>R===P.drawPosition)?.teamParticipantId===I)}if(!T)return le({result:{error:On,context:{participantId:r}}});let{modifiedLineUp:D,previousParticipantIds:C}=Gge({collectionPosition:p,teamParticipantId:I,dualMatchUpSide:T,participantIds:S,drawDefinition:i,collectionId:h});if(T.lineUp=D,I&&v&&Gw({participantId:I,lineUp:D,drawDefinition:i,tieFormat:v}),m===yr&&w.participantType===zi){let E=u?.sides?.find(M=>M.sideNumber===T?.sideNumber),{participantId:P}=E??{},R=P&&gn({participantFilters:{participantIds:[P]},tournamentRecord:e,withDraws:!0})?.participants?.[0];if(R){let M=R?.individualParticipantIds?.filter(N=>N!==r)??[];if(C&&M.push(...C),M.length>2)return le({result:{error:Fl},stack:a});if(R.draws?.length){if(M.length===1){let{participant:N}=bd({participantIds:M,tournamentRecord:e});if(!N){let k=uf({participant:{participantRole:Ns,individualParticipantIds:M,participantType:Mi},pairOverride:!0,tournamentRecord:e});if(k.error)return le({result:k,stack:a})}}}else if(M.length){R.individualParticipantIds=M;let N=HL({participant:R,pairOverride:!0,tournamentRecord:e});if(N.error)return le({result:N,stack:a})}else{let N=Hw({participantIds:[P],tournamentRecord:e});N.error&&console.log("cleanup",{result:N})}}else return le({result:{error:On},stack:a})}if(b.substitutions?.length===1&&!u?.sides?.find(E=>E.sideNumber!==b.sideNumber)?.substitutions?.length&&g?.processCodes?.length){for(let E of l||[]){let P=g.processCodes.lastIndexOf(E);g.processCodes.splice(P,1)}Yi({tournamentId:e?.tournamentId,matchUp:g,context:a,drawDefinition:i})}return Yi({tournamentId:e?.tournamentId,matchUp:A,context:a,drawDefinition:i}),{...se,modifiedLineUp:D}}function ZK(t){let e=Gt(t,[{[Sa]:!0,[to]:!0,[Cf]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:r,matchUpId:n,event:a}=t;if(r&&![1,2].includes(r))return{error:be,sideNumber:r};let{matchUp:s,structure:o}=Wr({drawDefinition:i,matchUpId:n,event:a});return s?Yo({structure:o})?(s.sides?.forEach(l=>{(!r||l.sideNumber===r)&&delete l.participantId}),Yi({tournamentId:t.tournamentRecord?.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:s}),{...se}):{error:iq}:{error:Ys}}function Gje({matchUpStatuses:t=["BYE",Xr,Mr],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){let n=e?.reduce((u,d)=>!u||d.roundNumber>u.roundNumber?d:u,void 0),a=n?.drawPositions?.find(u=>u!==i),s=r.filter(u=>u?.drawPositions?.includes(a)).map(u=>u.matchUpStatus),o=r.filter(u=>u?.drawPositions?.includes(i)).map(u=>u.matchUpStatus),l=Bo(s||[],t),c=Bo(o||[],t);return{sourceMatchUp:n,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:s,loserHadMatchUpStatus:c,loserMatchUpStatuses:o}}function Qje({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:s,dualMatchUp:o,roundNumber:l,matchUpsMap:c,event:u}){let{structure:d}=ui({drawDefinition:a,structureId:s});if(d?.structureType===Ao)return{...se};c=c??ss({drawDefinition:a});let p=(c?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:f}=jI({drawPosition:i,matchUps:p}),h=p?.filter(A=>A.roundNumber>=l&&A.roundNumber!==f&&A.drawPositions?.includes(i)),{positionAssignments:m}=Ir({drawDefinition:a,structureId:s});for(let A of h??[])jje({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:o,matchUpsMap:c,matchUp:A,event:u});return{...se}}function jje({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:s,dualMatchUp:o,matchUpsMap:l,matchUp:c,event:u}){let d="removeSubsequentDrawPosition";if(o){let f=t.find(({matchUpId:m})=>c.matchUpId===m).sides?.find(m=>m.drawPosition===r)?.sideNumber,h=c.sides?.find(m=>m.sideNumber===f);h&&delete h.lineUp}c.drawPositions=(c.drawPositions||[]).map(f=>f===r?void 0:f).filter(Boolean);let p=e.filter(({drawPosition:f})=>c.drawPositions?.includes(f)).filter(f=>f.bye).length;return c.matchUpStatus=p&&"BYE"||Ms(c.matchUpStatus)&&c.matchUpStatus||Rn,Ms(c.matchUpStatus)&&(c.winningSide=void 0),c.matchUpStatusCodes&&lhe({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:c}),Yi({tournamentId:n?.tournamentId,eventId:u?.eventId,context:`${d}-${r}`,drawDefinition:s,matchUp:c}),{...se}}function iE(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:s,dualMatchUp:o,targetData:l,matchUpId:c,structure:u,event:d}=t,p=!!t.matchUp.collectionId,f=Yo({structure:u}),{drawPositions:h,winningSide:m}=l.matchUp||{};if(!f&&!h)return{error:P1};let{targetLinks:{loserTargetLink:A,winnerTargetLink:g,byeTargetLink:v},targetMatchUps:{loserMatchUp:b,winnerMatchUp:y,byeMatchUp:I}}=l,w=qp({...t,matchUpStatus:a||Rn,removeWinningSide:!0});if(w.error)return w;let S;if(p){let{matchUpTieId:O,matchUpsMap:x}=t;if(S=pA({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:r,drawDefinition:n,matchUpsMap:x,event:d}),!e&&!S.removeWinningSide)return{...se}}if(f)return{...se};let{matchUps:T}=cr({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:s,structure:u}),{positionAssignments:D}=va({structure:u}),C=m-1,E=1-C,P=h[C],R=h[E],{winnerParticipantId:M,loserParticipantId:N}=D?.reduce((O,x)=>(x.drawPosition===R&&(O.loserParticipantId=x.participantId),x.drawPosition===P&&(O.winnerParticipantId=x.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0})||{},k=T.filter(O=>O.drawPositions?.includes(R));if(y&&jge({sourceMatchUpStatus:a,sourceMatchUpId:c,inContextDrawMatchUps:i,winningDrawPosition:P,winnerParticipantId:M,tournamentRecord:r,winnerTargetLink:g,drawDefinition:n,winnerMatchUp:y,dualMatchUp:o,matchUpsMap:s}),b){let{winnerHadMatchUpStatus:O}=Gje({drawPositionMatchUps:k,loserDrawPosition:R,sourceMatchUps:T}),x=A.linkCondition===sf;if(O&&x){let _=Math.min(...b.drawPositions);e4({targetLink:A,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:_,matchUpsMap:s,event:d})}let F=zje({sourceMatchUpStatus:a,sourceMatchUpId:c,loserParticipantId:N,tournamentRecord:r,loserTargetLink:A,drawDefinition:n,loserMatchUp:b,dualMatchUp:o,matchUpsMap:s,event:d});if(F.error)return F}if(I){let O=Math.min(...I.drawPositions);e4({targetLink:v,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:O,matchUpsMap:s,event:d})}return{...se,...S&&{tieMatchUpResult:S}}}function jge({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:s,drawDefinition:o,winnerMatchUp:l,matchUpsMap:c,dualMatchUp:u,event:d}){let{structureId:p,roundNumber:f}=l,h="removeDirectedWinner";if(a){let m=a.target.structureId,{structure:A}=ui({drawDefinition:o,structureId:m});if(!A)return{error:nn};let{positionAssignments:g}=va({structure:A});A.seedAssignments=(A.seedAssignments??[]).filter(S=>S.participantId!==r);let v=g?.find(S=>S.participantId===r)?.drawPosition,{matchUps:b}=cr({drawDefinition:o,structure:A,event:d}),y=b.map(S=>S.drawPositions).flat(1/0).filter(Boolean),I=Vl(y);if((v?I[v]:void 0)===1)g?.forEach(S=>{S.participantId===r&&delete S.participantId});else{let S=b.filter(({drawPositions:T})=>T.includes(v));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:S,winnerTargetLink:a})}let w=c?.drawMatchUps?.find(({matchUpId:S})=>S===l.matchUpId);w&&Yi({tournamentId:n?.tournamentId,eventId:d?.eventId,matchUp:w,context:h,drawDefinition:o})}return f&&Qje({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:s,drawDefinition:o,dualMatchUp:u,matchUpsMap:c,roundNumber:f,structureId:p}),{...se}}function zje({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,dualMatchUp:l,event:c}){let u="removeDirectedLoser",d=r.target.structureId,{structure:p}=ui({drawDefinition:a,structureId:d});if(!p)return{error:nn};let{positionAssignments:f}=va({structure:p}),h=f?.find(m=>m.participantId===e)?.drawPosition;if(f?.forEach(m=>{m.participantId===e&&delete m.participantId}),n&&t){let m=o?.drawMatchUps?.find(({matchUpId:A})=>A===s.matchUpId);m.matchUpStatusCodes=t===mn?["WO","WO"]:[]}if(p.seedAssignments=(p.seedAssignments??[]).filter(m=>m.participantId!==e),l){let m=s?.sides.reduce((v,b,y)=>b.drawPosition===h?y:v,void 0),A=o?.drawMatchUps?.find(({matchUpId:v})=>v===s.matchUpId),g=A?.sides?.[m];g&&(delete g.lineUp,Yi({tournamentId:i?.tournamentId,eventId:c?.eventId,matchUp:A,context:u,drawDefinition:a}))}return{...se}}function e4({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:s}){let o=a.target.structureId,l="removeDirectedBye";vl({color:"brightyellow",method:l,drawPosition:r});let c=dR({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:o,event:s});return le({result:c,stack:l})}function qje(t){let{matchUpFormat:e,score:i}=t,r=i?.sets?.length,n=e&&vs(e),{setFormat:a,finalSetFormat:s,bestOf:o}=n??{};return(o&&r===o&&s||a)?.timed||!1}function Wje({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){let n="attemptToSetMatchUpStatusBYE";if(r?.winningSide)return le({result:{error:DC},context:{matchUpStatus:"BYE"},stack:n});let{positionAssignments:a}=va({structure:i}),s=a?.filter(o=>o.bye).map(o=>o.drawPosition);return r.drawPositions?.some(o=>s?.includes(o))?(r.matchUpStatus="BYE",r.matchUpStatusCodes=[],Yi({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:r}),{...se}):le({result:{error:Eue},info:"matchUp does not include BYE",stack:n})}function r0(t){let{tournamentRecord:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,structure:s,event:o}=t,l="doubleExitAdvancement";if(s.structureType===Ao)return le({result:{...se},stack:l});let{matchUp:c,targetMatchUps:u,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:f,loserTargetDrawPosition:h}=u,m=Ms(p?.matchUpStatus)&&!p.sides?.map(g=>g.participantId??g.participant).filter(Boolean).length,A=p?.matchUpStatus===mn;if(p&&p.matchUpStatus!=="BYE"){let{loserTargetLink:g}=d;if(i?.progression?.doubleExitPropagateBye||p.feedRound&&p.sides?.[0]?.participantFed){let v=zge({loserTargetDrawPosition:h,tournamentRecord:e,loserTargetLink:g,drawDefinition:r,loserMatchUp:p,matchUpsMap:n,event:o});if(v.error)return le({result:v,stack:l})}else if(!A){let{feedRound:v,drawPositions:b,matchUpId:y}=p,I=v?2:2-b.indexOf(h);I=m?p.winningSide:I;let w=Oee({...t,targetMatchUp:p,walkoverWinningSide:I,tournamentRecord:e,sourceMatchUp:c,matchUpId:y});if(w.error)return le({result:w,stack:l})}}if(f){let g=Oee({...t,matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:e,sourceMatchUp:c});if(g.error)return le({result:g,stack:l})}return le({result:{...se},stack:l})}function Oee(t){let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s}=t,o=r.structures.find(({structureId:j})=>j===a.structureId),l=t.matchUpStatus===ha?ha:mn,c=t.matchUpStatus===ha?Mr:Xr,u="conditionallyAdvanceDrawPosition",d=s.drawMatchUps.find(j=>j.matchUpId===a.matchUpId);if(!d)return{error:Wo};let p=n?.drawPositions||[],f=d.drawPositions?.filter(Boolean),h=n?.structureId===a.structureId;if(h&&Bo(p,f)&&(f=f.filter(j=>!p.includes(j))),h&&f.length>1)return le({result:{error:fT},stack:u});let{pairedPreviousMatchUpIsDoubleExit:m,pairedPreviousMatchUp:A}=she(t),g=xo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:v,targetLinks:b}=g,{loserTargetDrawPosition:y,winnerMatchUp:I,loserMatchUp:w}=v;if(w){let{loserTargetLink:j}=b,W=zge({loserTargetDrawPosition:y,loserMatchUp:w,tournamentRecord:i,loserTargetLink:j,drawDefinition:r,matchUpsMap:s});if(W.error)return le({result:W,stack:u})}let S=d.drawPositions?.filter(Boolean)||[],T=S.length===1,D=t.walkoverWinningSide||T&&Pk({drawPosition:S[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,C=Ms(d.matchUpStatus)&&!S.length,E=d.finishingRound===1,P=C&&!E?l:c,R=e.find(j=>j.matchUpId===A.matchUpId),M=[],N;n&&(n?.structureId===R?.structureId?n.roundPosition<A?.roundPosition?N=1:N=2:a.feedRound?n.structureId===a.structureId?N=2:N=1:D&&(N=3-D));let k=t.matchUpStatus,O=A?.matchUpStatus;N===1?M=[{matchUpStatus:tB(k),previousMatchUpStatus:k,sideNumber:1},{matchUpStatus:tB(O),previousMatchUpStatus:O,sideNumber:2}]:N===2&&(M=[{matchUpStatus:tB(O),previousMatchUpStatus:O,sideNumber:1},{matchUpStatus:tB(k),previousMatchUpStatus:k,sideNumber:2}]),M.length&&(M=M.map(j=>Ft(j)));let x=qp({...t,winningSide:D,matchUp:d,matchUpStatusCodes:M,matchUpStatus:P});if(x.error)return le({result:x,stack:u});if(C)return r0({...t,matchUpStatus:P,targetData:g});if(!I)return le({result:{...se},stack:u});let F=f.length===2?f[D-1]:f[0],{positionAssignments:_}=Ir({structure:o}),V=_?.find(j=>j.drawPosition===F),G=s.drawMatchUps.find(j=>j.matchUpId===I.matchUpId),z=G?.drawPositions?.filter(Boolean),Q=z.length===1;if(F){if(V?.bye){let j=xo({matchUpId:G.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(Q){let W=z.filter(Boolean)[0],Y=Pk({drawPosition:W,matchUpId:G.matchUpId,inContextDrawMatchUps:e}),X=qp({appliedPolicies:t.appliedPolicies,matchUpId:G.matchUpId,matchUp:G,matchUpStatus:c,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,winningSide:Y});return X.error?le({result:X,stack:u}):QW({drawPositionToAdvance:W,matchUpId:G.matchUpId,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}else if(Ms(I.matchUpStatus)){let W=r0({...t,matchUpId:G.matchUpId,matchUpStatus:P,targetData:j});if(W.error)return le({result:W,stack:u})}return le({result:{...se},stack:u})}return vI({matchUpId:I.matchUpId,drawPosition:F,inContextDrawMatchUps:e,drawDefinition:r})}else if(m){if(!G)return{error:Wo};if(Q){let Y=z[0],X=Pk({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:Y});console.log("existing drawPosition is winningSide",{walkoverWinningSide:X})}let j=Ms(G.matchUpStatus)?c:l,W=qp({matchUpId:G.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:G,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,matchUpStatus:j});if(W.error)return le({result:W,stack:u});if(j===l){let Y=r0({...t,matchUpId:a.matchUpId,matchUpStatus:j,targetData:g});if(Y.error)return Y}}return le({result:{...se},stack:u})}function zge(t){let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:r,drawDefinition:n,matchUpsMap:a,event:s,loserMatchUp:o}=t,l=r?.target?.structureId,{structure:c}=ui({drawDefinition:n,structureId:l});return c?Oc({drawPosition:e,tournamentRecord:i,drawDefinition:n,structureId:l,matchUpsMap:a,loserMatchUp:o,event:s}):{error:Jy}}function tB(t){return t===mn?Xr:t===ha?Mr:t}function Kje(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,s=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(g=>g.matchUpId===a.matchUpId).containerStructureId),o="attemptToSetMatchUpStatus",l=r==="BYE",c=a.winningSide,u=[mn,ha].includes(r),d=uR({matchUpStatus:r}),p=Nj({matchUpStatus:r}),f=!d&&!p,h=t.matchUpTieId||c&&d&&!u,m=c&&u,A=()=>qp({...t,removeScore:[Df,Xr].includes(r),matchUpStatus:r||Rn});return f&&{error:fj}||h&&kk(t)||m&&Yje(t)||c&&iE(t)||p&&A()||l&&Wje({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:fj}||u&&Xje(t)||s&&kk(t)||t.propagateExitStatus&&kk(t)||le({result:{error:DC,info:"matchUpStatus: "+r},stack:o})}function Yje(t){let e=iE(t);return e.error?e:r0(t)}function Xje(t){let e=kk({...t,removeScore:!0});return e.error?e:r0(t)}function kk(t){let e="scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide){let n=iE(t);if(n.error)return le({result:n,stack:e})}let i=!!t.matchUp.collectionId,r=qp({...t});if(i){let{matchUpTieId:n,drawDefinition:a,matchUpsMap:s}=t,o=pA({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,event:t.event,drawDefinition:a,matchUpsMap:s});if(o.error)return le({result:o,stack:e});Object.assign(r,{tieMatchUpResult:o})}return le({result:r,stack:e})}function Zje({drawDefinition:t,structure:e,matchUp:i}){let{drawPositions:r}=i,{positionAssignments:n}=Ir({drawDefinition:t,structure:e}),a=n?.filter(({drawPosition:l})=>r?.includes(l))?.map(l=>{let{extension:c}=Bi({element:l,name:Om});return c?.value?.groupOrder}),{containerStructures:s}=$C({drawDefinition:t}),o=s[e.structureId];return{structureIds:HC({drawDefinition:t,structureId:o})?.links?.source?.filter(l=>Bo(a,l.source?.finishingPositions||[])).map(l=>l.source.structureId)}}function qge({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===wy&&Sh({drawDefinition:t,structure:e})){let{structureIds:n}=Zje({drawDefinition:t,structure:e,matchUp:i});n?.length&&r.push(...n)}return{connectedStructureIds:r}}function Jje(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===Yu){let o=r.sides.find(({sideNumber:c})=>c!==a).participantId,l=i.find(c=>c.structureId===s.target.structureId&&c.roundNumber===s.target.roundNumber&&c.sides.some(({participantId:u})=>u===o));if(l?.matchUpStatus===Rn){let c=xo({matchUpId:l.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Py({inContextDrawMatchUps:i,drawDefinition:n,targetData:c})){let{structure:u}=ui({structureId:l.structureId,drawDefinition:n}),d=Ir({structure:u}).positionAssignments;for(let p of d||[])if(p.participantId===o){let f=r.sides.find(({sideNumber:h})=>h===a).participantId;if(p.participantId=f,u?.positionAssignments)u.positionAssignments=d;else if(u?.structures){let h=Object.assign({},...(d||[]).map(m=>({[m.drawPosition]:m.participantId})));for(let m of u.structures)m.positionAssignments?.forEach(A=>A.participantId=h[A.drawPosition])}Fm({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:u}),e=!0}}}}return{...se,qualifierReplaced:e}}function e4e(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===Yu){let o=r.sides.find(({sideNumber:u})=>u===a)?.participantId,l=i.filter(u=>u.structureId===s.target.structureId&&u.roundNumber===s.target.roundNumber&&u.sides.some(({participantId:d,qualifier:p})=>p&&!d)),c=Bl(l);if(c?.matchUpStatus===Rn){let u=xo({matchUpId:c.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Py({inContextDrawMatchUps:i,drawDefinition:n,targetData:u})){let d=c.sides.find(h=>h.qualifier&&!h.participantId)?.drawPosition,{structure:p}=ui({structureId:c.structureId,drawDefinition:n});if(!p)return{error:nn};let f=Ir({structure:p}).positionAssignments;for(let h of f||[])if(h.drawPosition===d&&!h.participantId){if(h.participantId=o,p.positionAssignments)p.positionAssignments=f;else if(p.structures){let m=Object.assign({},...(f||[]).map(A=>({[A.drawPosition]:A.participantId})));for(let A of p.structures)A.positionAssignments?.forEach(g=>g.participantId=m[g.drawPosition])}Fm({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:p}),e=!0}}}}return{...se,qualifierPlaced:e}}function t4e(t){let e="attemptToSetWinningSide",i,r={},{appliedPolicies:n,disableAutoCalc:a,drawDefinition:s,dualMatchUp:o,winningSide:l,structure:c,matchUp:u}=t;if(o?._disableAutoCalc&&a!==!1)return w5(t);if(u.winningSide&&u.winningSide!==l){let{connectedStructureIds:h}=qge({drawDefinition:s,structure:c,matchUp:u});h.length&&(console.log({connectedStructureIds:h}),i=!0);let m=iE(t);if(m.error)return m}let d=pme(t);if(d.context?.progressExitStatus&&Object.assign(r,d.context),d.error)return le({result:d,stack:e});let p,f;return t.qualifierChanging&&n?.[sP]?.autoReplaceQualifiers&&(p=Jje(t).qualifierReplaced),t.qualifierAdvancing&&n?.[sP]?.autoPlaceQualifiers&&(f=e4e(t).qualifierPlaced),le({result:Ft({...se,...d,connectedStructures:i,qualifierReplaced:p,qualifierPlaced:f,context:r}),stack:e})}var xk={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function Wge(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,matchUp:s}=t,{matchUpId:o}=s,{iteration:l=0}=t;l+=1;let c="removeDoubleExit";vl({color:"brightyellow",method:c,matchUpId:o,iteration:l,keyColors:xk});let{targetMatchUps:{loserMatchUp:u,winnerMatchUp:d,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:f}}=a;if(d&&d.matchUpStatus!=="BYE"){let{stage:A,roundNumber:g,roundPosition:v,structureName:b}=d;vl({winner:"winner",roundPosition:v,structureName:b,roundNumber:g,keyColors:xk,stage:A}),Fee({...t,targetMatchUp:d,sourceMatchUp:s,iteration:l})}let h=u?.matchUpStatus==="BYE"&&(u?.feedRound||u?.roundNumber===1),m=a?.targetLinks?.loserTargetLink?.linkCondition===sf;if(h&&m){let A=e.filter(({roundNumber:b,structureId:y})=>y===s.structureId&&b===1),g=A.map(({roundPosition:b})=>b),v=Oa(g.sort(),2).find(b=>b.includes(s.roundPosition));if((A.filter(({roundPosition:b})=>v.includes(b))?.map(({matchUpStatus:b})=>b)).every(b=>[ha,mn].includes(b)))return le({result:{...se},stack:c})}if(u&&(u.matchUpStatus!=="BYE"||h)){let A=e.find(({matchUpId:S})=>S===u.matchUpId),{structure:g}=ui({drawDefinition:r,structureId:A.structureId}),{stage:v,roundNumber:b,roundPosition:y,feedRound:I,structureName:w}=u;if(vl({loser:"loser",roundPosition:y,structureName:w,roundNumber:b,keyColors:xk,feedRound:I,stage:v}),i?.progression?.doubleExitPropagateBye||h)e4({drawPosition:p,targetLink:f,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:n});else{let S=Fee({...t,targetMatchUp:u,structure:g,iteration:l});if(S.error)return le({result:S,stack:c})}}return le({result:{...se},stack:c})}function Fee(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s,structure:o,iteration:l}=t,c="conditionallyRemoveDrawPosition";vl({method:c,structureName:o?.structureName,iteration:l});let u=xo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:{winnerMatchUp:d}}=u,p=s?.drawMatchUps.find(b=>b.matchUpId===a.matchUpId),f,h,m;if(a.feedRound)m=d?.drawPositions?.filter(Boolean)?.find(b=>a.drawPositions.includes(b));else if(n==null)m=Pn(a?.drawPositions||[],d?.drawPositions||[])?.[0];else{h=ohe({structureId:o.structureId,matchUp:n,matchUpsMap:s})?.pairedPreviousMatchUp,f=[mn,ha].includes(h?.matchUpStatus);let b=h?.drawPositions?.filter(Boolean)||[];if([...qn,"BYE"].includes(h?.matchUpStatus)||h?.winningSide){let y=n.drawPositions||[],I=a.drawPositions?.filter(Boolean);Bo(y,I)&&(I=I?.filter(w=>!y.includes(w))),m=y.concat(b).find(w=>I?.includes(w))}}if(d&&m){let{stage:b,roundNumber:y,roundPosition:I,structureName:w}=d;vl({method:"removeDirectedWinner",drawPositionToRemove:m,color:"brightgreen",roundPosition:I,structureName:w,roundNumber:y,keyColors:xk,stage:b}),jge({winningDrawPosition:m,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}let A=Wge({targetData:u,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:s,structure:o,iteration:l});if(A.error)return le({result:A,stack:c});let g=i4e({pairedPreviousDoubleExit:f,noContextTargetMatchUp:p}),v=!f;return A=qp({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],matchUpStatus:g,removeScore:v,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),A.error?le({result:A,stack:c}):{...se}}function i4e({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus==="BYE"?"BYE":t?[ha,Mr].includes(e?.matchUpStatus)?Mr:Xr:Rn}function r4e(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n}=t,a=t.targetData.targetLinks?.winnerTargetLink;if(a.target.feedProfile===Yu){let s=r.sides?.find(({sideNumber:l})=>l===r.winningSide)?.participantId,o=i.find(l=>l.structureId===a.target.structureId&&l.roundNumber===a.target.roundNumber&&l.sides?.some(({participantId:c})=>c===s));if(o&&o.matchUpStatus===Rn){let l=xo({matchUpId:o.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Py({inContextDrawMatchUps:i,drawDefinition:n,targetData:l})){let{structure:c}=ui({structureId:o.structureId,drawDefinition:n}),u=Ir({structure:c}).positionAssignments;for(let d of u||[])if(d.participantId===s){if(d.participantId=void 0,c?.positionAssignments)c.positionAssignments=u;else if(c?.structures){let p=Object.assign({},...(u||[]).map(f=>({[f.drawPosition]:f.participantId})));for(let f of c?.structures||[])f.positionAssignments?.forEach(h=>h.participantId=p[h.drawPosition])}Fm({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:c}),e=!0}}}}return{qualifierRemoved:e}}function n4e(t){let{matchUp:e,matchUpStatus:i,score:r,winningSide:n}=t,a="noDownStreamDependencies";if([mn,ha].includes(e?.matchUpStatus)&&![mn,ha].includes(i)){let A=Wge(t);if(A.error)return le({result:A,stack:a})}let s=i===mn,o=ya({score:r})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!n),l=t?.inContextMatchUp?.collectionId&&qje(t.inContextMatchUp),c=t.removeScore||!l&&![Wl,ql].includes(i||Wl),u=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!n&&!ya({score:r}),d=A=>{let g,{structure:v,drawDefinition:b,dualMatchUp:y,disableAutoCalc:I}=t;if(y?._disableAutoCalc&&I!==!1)return w5({...t,removeWinningSide:u});let{connectedStructureIds:w}=qge({drawDefinition:b,structure:v,matchUp:e});w.length&&(console.log({connectedStructureIds:w}),g=!0),Object.assign(t,{removeScore:A});let S=iE(t);if(S.error)return S;if(t.removingQualifier&&t.appliedPolicies?.[sP]?.autoRemoveQualifiers){let T=r4e(t);return{...se,connectedStructures:g,...T}}return{...se,connectedStructures:g}};if(u&&n&&t.isCollectionMatchUp)return Lee(t);let p=[Df,ql].includes(i)&&t.dualWinningSideChange,f=i&&i!==Rn,h=t.propagateExitStatus&&Ms(i),m=(n||p||h)&&t4e(t)||o&&d(c)||f&&Kje(t)||u&&d(c)||e&&Lee({...t,removeScore:!0})||{...se};return le({result:m,stack:a})}function Lee(t){let e="ndd:scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide&&!t.autoCalcDisabled){let r=iE(t);if(r.error)return r}let i=qp({...t});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:n,event:a,matchUpsMap:s}=t,{removeWinningSide:o}=pA({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:n,matchUpsMap:s,event:a});o&&console.log("REMOVE WINNING SIDE")}return le({result:i,stack:e})}function JK(t){let e=Gt(t,[{[Sa]:!0,[to]:!0,[Cf]:!0},{homeParticipantId:!0,[id]:ga}]);if(e.error)return e;let i=XC(t,[{[kC]:Lh,attr:{[wF]:!0}}]);if(i.error)return i;let r=i?.matchUp?.matchUp?.sides?.map(u=>u?.participantId);if(t.homeParticipantId&&!r?.includes(t.homeParticipantId))return{error:np};let{disableNotice:n,homeParticipantId:a,removePriorValues:s,tournamentRecord:o,drawDefinition:l,matchUpId:c}=t;return Yl({duplicateValues:!1,removePriorValues:s,tournamentRecord:o,drawDefinition:l,disableNotice:n,matchUpId:c,timeItem:{itemType:_W,itemValue:a}})}function Kge({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=lb({timeItems:i?.timeItems||[],itemType:$F});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{timeModifiers:r}:e}function Zg(t){let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,scheduledTime:o,matchUpId:l}=t;if(!l)return le({result:{error:mo},stack:e});if(!NC(o))return le({result:{error:ju},stack:e});if(!i){let f=Wr({drawDefinition:a,matchUpId:l});if(f.error)return le({result:f,stack:e});i=f.matchUp}let c=Si(o),u=Fw({matchUp:i}).scheduledDate,d=c&&!u;if((Kge({matchUp:i}).timeModifiers||[])?.length){let f=Yge({disableNotice:!0,removePriorValues:r,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(f?.error)return le({result:f,stack:e})}let p=Pw(o,!0,d);return Yl({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,matchUpId:l,timeItem:{itemType:_w,itemValue:p}})}function Yge({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:s}){let o="addMatchUpTimeModifiers";if(!a)return le({result:{error:mo},stack:o});if(n!==void 0&&!Array.isArray(n))return le({info:Ey("timeModifiers"),result:{error:be},stack:o});if(!s){let d=Wr({drawDefinition:i,matchUpId:a});if(d.error)return le({result:d,stack:o});s=d.matchUp}let l=Kge({matchUp:s}).timeModifiers||[],c=n.filter(d=>!l.includes(d));if(n.length&&!c.length)return{...se};if(c.some(d=>Dj.includes(d))){l=l.filter(p=>!Dj.includes(p));let d=Zg({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return le({result:d,stack:o})}let u=n?.length?[...c,...l]:void 0;return Yl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:$F,itemValue:u}})}function VL({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:mo};let s=t&&nf.test(t);if(t&&!s)return{error:fa};let o={itemValue:Si(t),itemType:xw};return Yl({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o})}function GL({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtIds:o}){if(!i&&!e)return{error:rt};if(!s)return{error:mo};let l=Wr({drawDefinition:r,matchUpId:s});if(l.error)return l;if(l?.matchUp?.matchUpType!==Cc)return{error:bl};if(!(o===void 0||Array.isArray(o)&&o.length&&o.every(u=>typeof u=="string")))return{error:be,context:{courtIds:o}};let c;if(o){let u=e||i&&{[i.tournamentId]:i},d=fA({tournamentRecords:u});if(d.error)return d;let p=d.courts?.filter(f=>o.includes(f.courtId));if(p?.length!==o.length)return{error:be,context:{courtIds:o}};c=p?.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return Yl({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:wh,itemDate:a,itemValue:c}})}function rE({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:s}){if(!i)return{error:rt};if(!a)return{error:mo};if(s){let o=Hh({tournamentRecords:e,tournamentRecord:i,venueId:s});if(o.error)return o}return Yl({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:kw,itemValue:s}})}function Yw({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtId:o}){if(!i&&!e)return{error:rt};if(!s)return{error:mo};if(o){let l=Kg({tournamentRecords:e,tournamentRecord:i,courtId:o});if(l.error)return l;let c=l.venue?.venueId;rE({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,venueId:c})}return Yl({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:mg,itemDate:a,itemValue:o}})}function Lp(t,e){let i=Bde.test(t)?t:qr(t),r=Si(t)||Si(e)||ed(new Date);return new Date(`${r}T${i}`).getTime()}function QL(t){let e="addMatchUpScheduleItems",i=Gt(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[il]:pl}],e);if(i.error)return i;let{matchUpDependencies:r,inContextMatchUps:n}=t,{proConflictDetection:a=!1,errorOnAnachronism:s=!1,checkChronology:o=!0,removePriorValues:l,tournamentRecords:c,tournamentRecord:u,drawDefinition:d,disableNotice:p,drawMatchUps:f,matchUpId:h,schedule:m,event:A}=t,g,v;if(f)g=f.find(k=>k.matchUpId===h);else{let k=Wr({drawDefinition:d,event:A,matchUpId:h});if(k.error)return k;g=k.matchUp}let{endTime:b,courtId:y,courtIds:I,courtOrder:w,resumeTime:S,homeParticipantId:T,scheduledDate:D,scheduledTime:C,startTime:E,stopTime:P,timeModifiers:R,venueId:M}=m;o&&(!r||!n)&&({matchUpDependencies:r,matchUps:n}=Rd({drawDefinition:d}));let N=r?.[h]?.matchUpIds;if(m.scheduledDate&&o&&N){let k=n?.filter(O=>(O.schedule?.scheduledDate||Si(O.schedule?.scheduledTime))&&N.includes(O.matchUpId)).map(({schedule:O})=>{let x=Ex(O);return new Date(x??"").getTime()});if(k?.length){let O=Ex(m),x=new Date(O??"").getTime();if(Math.max(...k)>=x){if(s)return le({result:{error:uj},stack:e});v=uj}}}if(D!==void 0){let k=VL({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,scheduledDate:D,matchUpId:h});if(k?.error)return le({result:k,stack:e,context:{scheduledDate:D}})}if(C!==void 0){let k=Zg({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,scheduledTime:C,matchUpId:h,matchUp:g});if(k?.error)return le({result:k,stack:e,context:{scheduledTime:C}})}if(E!==void 0){let k=t6({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,matchUpId:h,startTime:E,event:A});if(k?.error)return le({result:k,stack:e,context:{startTime:E}})}if(P!==void 0){let k=r6({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,matchUpId:h,stopTime:P,event:A});if(k?.error)return le({result:k,stack:e,context:{stopTime:P}})}if(S!==void 0){let k=n6({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,resumeTime:S,matchUpId:h,event:A});if(k?.error)return le({result:k,stack:e,context:{resumeTime:S}})}if(b!==void 0){let k=i6({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,matchUpId:h,endTime:b,event:A});if(k?.error)return le({result:k,stack:e,context:{endTime:b}})}if(I!==void 0){let k=GL({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,matchUpId:h,courtIds:I});if(k?.error)return le({result:k,stack:e,context:{courtIds:I}})}if(a&&y!==void 0&&D!==void 0&&w!==void 0&&yi(w)){let k=ri(w),O=(La({tournamentRecord:u})?.matchUps??[]).find(x=>{if(x.matchUpId===h)return!1;let F=x.schedule?.courtOrder?ri(x.schedule.courtOrder):void 0;return x.schedule?.courtId===y&&F===k&&x.schedule?.scheduledDate===D});if(O)return le({result:{error:lue,info:`Court slot already occupied by matchUp ${O.matchUpId}`},stack:e,context:{courtId:y,courtOrder:w,scheduledDate:D}})}if(y!==void 0&&D!==void 0){let k=Yw({courtDayDate:D,disableNotice:!0,removePriorValues:l,tournamentRecords:c,tournamentRecord:u,drawDefinition:d,matchUpId:h,courtId:y});if(k?.error)return le({result:k,stack:e,context:{courtId:y}})}if(M!==void 0){let k=rE({disableNotice:!0,removePriorValues:l,tournamentRecords:c,tournamentRecord:u,drawDefinition:d,matchUpId:h,venueId:M});if(k?.error)return le({result:k,stack:e,context:{venueId:M}})}if(w!==void 0&&yi(w)){let k=e6({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,courtOrder:w,matchUpId:h});if(k?.error)return le({result:k,stack:e,context:{courtOrder:w}})}if(R!==void 0){let k=Yge({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,timeModifiers:R,matchUpId:h,matchUp:g});if(k?.error)return le({result:k,stack:e,context:{timeModifiers:R}})}return Lr(T)&&JK({disableNotice:!0,homeParticipantId:T,removePriorValues:l,tournamentRecord:u,drawDefinition:d,matchUpId:h}),p||Yi({tournamentId:u?.tournamentId,eventId:A?.eventId,context:e,drawDefinition:d,matchUp:g}),v?{...se,warnings:[v]}:{...se}}function e6({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:mo};if(n&&!yi(n))return{error:be,info:"courtOrder must be numeric"};let s=n&&ri(n);return Yl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:LF,itemValue:s}})}function Xge({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:s}){if(!s)return{error:mo};if(!n)return{error:ga};if(e){let l=gn({tournamentRecord:e,participantFilters:{participantTypes:[zi],participantRoles:[WW]}}).participants??[];if(!dg({tournamentParticipants:l,participantId:n}))return{error:On}}let o={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(o.itemSubTypes=[a]),Yl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:s,timeItem:o})}function t6({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:s}){if(!n)return{error:mo};if(!NC(a))return{error:ju};let{matchUp:o}=Wr({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=Fw({matchUp:o}),c=(o?.timeItems??[]).filter(u=>[Sm,ih,$m].includes(u?.itemType)).map(u=>Lp(u.itemValue,l)).reduce((u,d)=>!u||d<u?d:u,void 0);if(!c||Lp(a,l)<c){o?.timeItems&&(o.timeItems=o.timeItems.filter(d=>d.itemType!==Qd));let u=Pw(a,!0,!0);return Yl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:Qd,itemValue:u}})}else return{error:rde}}function i6({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:s,event:o}){if(!a)return{error:mo};if(!NC(s))return{error:ju};let{matchUp:l}=Wr({drawDefinition:r,event:o,matchUpId:a}),{scheduledDate:c}=Fw({matchUp:l}),u=(l?.timeItems??[]).filter(d=>[Qd,ih,Sm].includes(d?.itemType)).map(d=>Lp(d.itemValue,c)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!u||Lp(s,c)>u){l?.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==$m));let d=Pw(s,!0,!0);return Yl({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:$m,itemValue:d}})}else return{error:tde}}function r6({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:s}){if(!n)return{error:mo};if(!NC(a))return{error:ju};let{matchUp:o}=Wr({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=Fw({matchUp:o}),c=o?.timeItems??[];if(c.reduce((h,m)=>m.itemType===$m||h,void 0))return{error:vq};let u=c.filter(h=>[Qd,ih,Sm].includes(h?.itemType)).sort((h,m)=>Lp(h.itemValue,l)-Lp(m.itemValue,l)),d=u.at(-1),p=d?.itemType===Sm,f=u.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>Lp(h.itemValue,l)).reduce((h,m)=>!h||m>h?m:h,void 0);if(Lp(a,l)>f){if(o?.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(A=>A.createdAt!==m)}let h={itemValue:Pw(a,!0,!0),itemType:Sm};return Yl({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:h})}else return{error:ide}}function n6({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:s}){if(!a)return{error:mo};if(!NC(n))return{error:ju};let{matchUp:o}=Wr({drawDefinition:i,event:s,matchUpId:a}),{scheduledDate:l}=Fw({matchUp:o}),c=o?.timeItems??[];if(c.reduce((h,m)=>m.itemType===$m||h,void 0))return{error:vq};let u=c.filter(h=>[Qd,ih,Sm].includes(h?.itemType)).sort((h,m)=>Lp(h.itemValue,l)-Lp(m.itemValue,l)),d=u.at(-1),p=d?.itemType===ih,f=u.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>Lp(h.itemValue,l)).reduce((h,m)=>!h||m>h?m:h,void 0);if(Lp(n,l)>f){if(o?.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(A=>A.createdAt!==m)}let h={itemValue:Pw(n,!0,!0),itemType:ih};return Yl({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:h})}else return{error:AOe}}function a4e(t){let{targetData:e,matchUpsMap:i}=t,{targetMatchUps:{loserMatchUp:r}}=e,n=Ms(r?.matchUpStatus),a=!!i?.drawMatchUps.find(s=>s.loserMatchUpId===r?.matchUpId&&Ms(s.matchUpStatus));return a&&r?.matchUpStatus===mn||a&&n}function s4e({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:s,matchUp:o,event:l,score:c}){let u=St(n,void 0,!0);for(let p of u?.tieMatchUps||[])p.matchUpId===o.matchUpId&&(p.winningSide=r,p.score=c,!ya({score:c})&&!e?Object.assign(p,{...iL}):e&&(p.matchUpStatus=e));a=a??uo({matchUp:o,structure:s,drawDefinition:t,event:l})?.tieFormat;let{winningSide:d}=SR({matchUp:u,drawDefinition:t,matchUpsMap:i,structure:s,tieFormat:a,event:l});return{projectedWinningSide:d}}function o4e(t){let{tournamentRecord:e,inContextMatchUp:i,structure:r,drawDefinition:n}=t,a=i.roundNumber,s=i.sides.find(I=>I.sideNumber===i.winningSide),o=i.sides.find(I=>I.sideNumber!==i.winningSide),{drawPosition:l,participantId:c}=s,{drawPosition:u,participantId:d}=o,p="swapWinnerLoser",{matchUps:f}=cr(t),h=f.filter(({drawPositions:I,roundNumber:w})=>I?.includes(l)&&w>a);Gl({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:h}),h.forEach(I=>{I.drawPositions=I.drawPositions?.map(w=>w===l?u:w)||[],Yi({tournamentId:e?.tournamentId,eventId:t.event?.eventId,context:p,drawDefinition:n,matchUp:I})});let{stage:m,stageSequence:A}=r,g=n.structures.filter(({stage:I,stageSequence:w})=>I===m&&w>A).map(({structureId:I})=>I),{targetLinks:{loserTargetLink:v,winnerTargetLink:b}}=t.targetData,y=[v?.target.structureId,b?.target?.structureId].filter(Boolean);return n.structures.filter(({stage:I,structureId:w})=>I!==m&&y.includes(w)).forEach(({stage:I,stageSequence:w,structureId:S})=>{g.includes(S)||g.push(S),n.structures.filter(({stage:T,stageSequence:D})=>T===I&&D>w).forEach(({structureId:T})=>{g.includes(T)||g.push(T)})}),n.structures.filter(({structureId:I})=>g.includes(I)).forEach(I=>{let{positionAssignments:w}=Ir({structure:I}),S=w?.find(({participantId:D})=>D===c),T=w?.find(({participantId:D})=>D===d);S&&(S.participantId=d),T&&(T.participantId=c)}),qp({...t})}function fb(t){let e="setMatchUpStatus";t.matchUpStatus&&[Xr,mn].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:r,propagateExitStatus:n,tournamentRecords:a,tournamentRecord:s,disableAutoCalc:o,enableAutoCalc:l,drawDefinition:c,matchUpStatus:u,winningSide:d,matchUpId:p,event:f,score:h}=t;if(!c)return{error:Bt};if(u&&[Df,Wl,ql,Rn].includes(u)&&d)return{error:be,winningSide:d,matchUpStatus:u};if(![void 0,...lW].includes(u))return le({result:{error:DC},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let m=ss({drawDefinition:c}),{matchUps:A}=ea({nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:c,matchUpsMap:m,event:f}),g=m.drawMatchUps.find(z=>z.matchUpId===p),v=A?.find(z=>z.matchUpId===p);if(!g||!A)return{error:Ys};if((g.winningSide||d)&&u==="BYE")return{context:"Cannot have Bye with winningSide",error:wk,matchUpStatus:u};let b=v?.structureId,{structure:y}=ui({drawDefinition:c,structureId:b}),I=$n($r)(g.matchUpType),w=v?.drawPositions?.filter(Boolean),S=v?.matchUpTieId,T=xo({matchUpId:S||p,inContextDrawMatchUps:A,drawDefinition:c});Object.assign(t,{inContextDrawMatchUps:A,inContextMatchUp:v,matchUpTieId:S,matchUpsMap:m,targetData:T,structure:y,matchUp:g});let D=u===Rn&&h?.scoreStringSide1===""&&h?.scoreStringSide2===""&&!d;if(a4e(t)&&D)return{error:nOe};let C=Py(t),E;if(I){if(o)lr({extension:{name:GI,value:!0},element:g});else if(l){let z=g.winningSide,{winningSide:Q,scoreStringSide1:j,scoreStringSide2:W,set:Y}=SR({drawDefinition:c,matchUpsMap:m,structure:y,matchUp:g,event:f}),X={scoreStringSide1:j,scoreStringSide2:W,sets:Y?[Y]:[]};if(E=Q!==z,C&&E)return le({stack:"winningSideWithDownstreamDependencies",result:{error:rF},context:{winningSide:d,matchUp:g}});Eo({name:GI,element:g}),Object.assign(t,{winningSide:Q,dualWinningSideChange:E,projectedWinningSide:Q,score:X})}UR({tournamentId:s?.tournamentId,inContextDualMatchUp:v,eventId:f?.eventId,dualMatchUp:g,drawDefinition:c})}if(I&&u&&[Mw].includes(u))return{info:"Not supported for matchUpType: TEAM",error:be};if(h&&!I&&!r){let z=g.matchUpFormat??y?.matchUpFormat??c?.matchUpFormat??f?.matchUpFormat,Q=K5({existingMatchUpStatus:g.matchUpStatus,matchUpFormat:z,matchUpStatus:u,winningSide:d,score:h});if(Q.error)return Q}let P=er({policyTypes:[sP,du],tournamentRecord:s,drawDefinition:c,event:f})?.appliedPolicies??{};Ki(t.policyDefinitions)&&Object.assign(P,t.policyDefinitions);let R=c4e({assignedDrawPositions:w,propagateExitStatus:n,inContextMatchUp:v,appliedPolicies:P,drawDefinition:c,matchUpStatus:u,structure:y,matchUp:g});if(R?.error)return R;let M=v?.stage===zt&&v.finishingRound===1,N=M&&d,k=M&&g.winningSide&&!d&&(!t.matchUpStatus||t.matchUpStatus&&Nj({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!ya({outcome:t.outcome})),O=N&&d!==g.winningSide&&g.winningSide;if(Object.assign(t,{qualifierAdvancing:N,qualifierChanging:O,removingQualifier:k,appliedPolicies:P}),S){let{matchUp:z}=Wr({matchUpId:S,inContext:!0,drawDefinition:c,matchUpsMap:m,event:f});if(z){let Q=uo({matchUp:z,drawDefinition:c,structure:y,event:f})?.tieFormat,{projectedWinningSide:j}=s4e({drawDefinition:c,matchUpStatus:u,dualMatchUp:z,matchUpsMap:m,winningSide:d,tieFormat:Q,structure:y,matchUp:g,event:f,score:h}),W=z.winningSide;E=j!==W;let Y=z._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:E,projectedWinningSide:j,autoCalcDisabled:Y,matchUpTieId:S,dualMatchUp:z,tieFormat:Q})}}let x=uR({matchUpStatus:u});if(!S){if(C&&!d&&(u&&Nj({matchUpStatus:u})||u&&[mn,ha].includes(u)))return{error:wk,activeDownstream:C,winningSide:d};if(d&&d===g.winningSide&&u&&!x)return{context:"winningSide must include directing matchUpStatus",error:wk,directingMatchUpStatus:x,matchUpStatus:u}}let{schedule:F}=t;if(F){let z=QL({disableNotice:!0,tournamentRecords:a,tournamentRecord:s,drawDefinition:c,matchUpId:p,schedule:F});if(z.error)return z}let _=!I&&!E&&d&&g.winningSide&&g.winningSide!==d;if(i&&_&&g.roundPosition)return o4e(t);let V=d&&!S||t.projectedWinningSide;vl({activeDownstream:C,matchUpWinner:V,method:e,winningSide:d});let G=!C&&n4e(t)||V&&l4e(t)||(x||t.autoCalcDisabled)&&Zge(t)||{error:dde};return le({result:G,stack:e})}function l4e(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?Zge(t):le({stack:"winningSideWithDownstreamDependencies",result:{error:rF},context:{winningSide:i,matchUp:e}})}function Zge(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!ya({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&Rn||t.winningSide&&Ln||Wl:t.matchUpStatus||Ln,s=t.removeScore||[Df,Xr].includes(a)&&![Wl,ql].includes(a),o=qp({...t,matchUpStatus:a,removeWinningSide:n,removeScore:s});if(o.error)return o;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:c,matchUpsMap:u}=t,d=pA({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:c,matchUpsMap:u,event:r});if(d.error)return d;Object.assign(o,{tieMatchUpResult:d})}return o}function c4e({assignedDrawPositions:t,propagateExitStatus:e,inContextMatchUp:i,appliedPolicies:r,drawDefinition:n,matchUpStatus:a,structure:s,matchUp:o}){if(r?.[du]?.requireParticipantsForScoring===!1)return{...se};let l=i?.sides?.map(d=>d.participantId).filter(Boolean).length,c=o?.sides?[]:Ir({structureId:s?.structureId,drawDefinition:n}).positionAssignments,u=l&&l===2||o.collectionId&&Yo({structure:s})&&l&&l>=1||t?.length===2&&c?.filter(d=>t.includes(d.drawPosition)).every(d=>d.participantId);return a&&[Xr,Mr,mn].includes(a)&&l===1&&e?{...se}:a&&oW.includes(a)&&!u?le({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:a,requiredParticipants:u},result:{error:DC}}):{...se}}function Jge({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:Bt};let{matchUp:n}=Wr({drawDefinition:e,matchUpId:i,event:r});return n?.matchUpType!==Cc?{error:bl}:fb({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function eve({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:Bt};if(!i)return{error:mo};let{matchUp:r}=Wr({drawDefinition:t,event:e,matchUpId:i});return r?Eo({name:DF,element:r}):{error:Ys}}function u4e({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:s}){let o="substituteParticipant";if(!r)return{error:Bt};if(!a)return{error:mo};if(!e||!t)return le({result:{error:ga},stack:o});let{matchUp:l}=Wr({drawDefinition:r,matchUpId:a,event:s});if(!l)return{error:Ys};if(!l.collectionId)return le({result:{error:bl},stack:o});let c=ss({drawDefinition:r}),{matchUps:u}=ea({tournamentParticipants:i?.participants,inContext:!0,drawDefinition:r,matchUpsMap:c}),d=u?.find(f=>f.matchUpId===a),p=u?.find(f=>f.matchUpId===d?.matchUpTieId)?.sides?.find(f=>f.participant.individualParticipants.some(({participantId:h})=>h===e));return!p||n&&p.sideNumber!==n?{error:np}:p.participant?.individualParticipants?.map(ji).filter(f=>f!==e)?.includes(t)?XK({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:s}):le({result:{error:np},stack:o})}function tve(t){return u4e(t)}function ive({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:Bt};let{matchUp:r}=Wr({drawDefinition:t,matchUpId:e,event:i});return lr({extension:{name:GI,value:!0},element:r})}function rve(t){let e="setMatchUpFormat",i=Gt(t,[{tournamentRecord:!0},{[Es]:I=>Ql({matchUpFormat:I}),[Dc]:N1,matchUpFormat:!0}]);if(i.error)return le({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:s,matchUpFormat:o,structureId:l,eventType:c,matchUpId:u,eventId:d,stages:p,drawId:f,event:h,force:m}=t;if(a&&!Array.isArray(a))return le({result:{error:be,scheduledDates:a},stack:e});if(c&&!XO([af,uu],c))return le({result:{error:ph},stack:e});let A=0,g=t.structureIds||l&&[l].filter(Boolean)||[],v=t.eventIds||d&&[d].filter(Boolean)||[],b=t.drawIds||f&&[f].filter(Boolean)||[];if((l||g?.length)&&!n)return le({result:{error:Bt},stack:e});if(f&&u&&n){let I=J5({tournamentRecord:r,drawDefinition:n,matchUpFormat:o,structureIds:g,structureId:l,matchUpId:u});if(I.error)return I;A+=1}let y=I=>{let w=[];for(let S of I.structures||[]){if(Array.isArray(p)&&!p.includes(S.stage)||Array.isArray(s)&&!s.includes(S.stageSequence)||g?.length&&!g.includes(S.structureId))continue;g?.length&&S.matchUpFormat!==o&&(S.matchUpFormat=o,w.push(S.structureId),A+=1);let T=((m||a)&&cr({matchUpFilters:{matchUpStatuses:[Rn]},structure:S}).matchUps)??[],D=(a&&cr({matchUpFilters:{matchUpStatuses:[Rn]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:S}).matchUps)??[];if(T?.length){let C=D?D.map(xa):T.map(xa);for(let E of T)C.includes(E.matchUpId)&&(E.matchUpFormat=a?.length?o:void 0,Yi({tournamentId:r?.tournamentId,eventId:h?.eventId,context:e,drawDefinition:I,matchUp:E}))}}return!w.length&&I.matchUpFormat!==o&&(I.matchUpFormat=o,A+=1),w};for(let I of r?.events||[])if(!(v?.length&&!v.includes(I.eventId)||c&&c!==I.eventType||c===ca))if(Array.isArray(s)||Array.isArray(p)||g?.length||b?.length)for(let w of I.drawDefinitions||[]){if(Array.isArray(b)&&!b.includes(w.drawId))continue;let S=y(w);Br({structureIds:S,drawDefinition:w})}else I.matchUpFormat!==o&&(I.matchUpFormat=o,A+=1);return A?{...se,modificationsCount:A}:{...se,info:MC}}function a6({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){if(!i)return{error:Bt};let a=Wr({drawDefinition:i,matchUpId:r})?.matchUp;if(!a?.tieMatchUps)return{error:bl};let s=Wr({inContext:!0,drawDefinition:i,matchUpId:r,event:n})?.matchUp,o=0;return(a?.sides||[]).forEach(l=>{l.lineUp&&delete l.lineUp}),(s?.sides||[]).forEach(l=>{if(o+=1,t===!1){let c=s?.tieFormat,u=l.participantId;c&&u&&Gw({drawDefinition:i,participantId:u,lineUp:[],tieFormat:c})}Yi({tournamentId:e?.tournamentId,context:"resetMatchUpLineUps",eventId:n?.eventId,drawDefinition:i,matchUp:a})}),{...se,modificationsCount:o}}function nve(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n,setTBlast:a}=t;if(!n)return{sets:[]};let s=n.sets||[],o=Zd({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),l=Zd({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),c=Zd({matchUpFormat:e,matchUpStatus:i,winningSide:r,setTBlast:a,sets:s}),u=o===c?l:o;return r&&(o=r===1?c:u,l=r===2?c:u),{score:{sets:s,scoreStringSide1:o,scoreStringSide2:l}}}function d4e({sourceMatchUpStatusCodes:t,propagateExitStatus:e,sourceMatchUpStatus:i,loserParticipantId:r,tournamentRecord:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,event:l}){let c="progressExitStatus";vl({matchUpId:s?.matchUpId,matchUpStatus:i,color:"magenta",method:c});let u=Ms(i)&&i!==Fa&&i||Xr,d=ea({inContext:!0,drawDefinition:a,matchUpsMap:o})?.matchUps,p=u,f=d?.find(h=>h.matchUpId===s?.matchUpId);if(f?.matchUpId&&p){let h,m=f.matchUpStatusCodes?.map(v=>typeof v=="string"?v:"WO")??[],A=f.sides?.find(v=>v.participantId===r);if(A?.sideNumber)if(f?.sides?.reduce((v,b)=>b?.participantId?v+1:v,0)===1&&m.length===0)h=A.sideNumber===1?2:1,m[0]=t[0];else if(!Ms(s.matchUpStatus))h=A.sideNumber===1?2:1,m[0]=t[0];else{let v=m[0];m[A.sideNumber-1]=t[0];let b=A.sideNumber===1?2:1;m[b-1]=v,p=mn,h=void 0}let g=fb({matchUpStatus:p,matchUpId:s.matchUpId,matchUpStatusCodes:m,allowChangePropagation:!0,propagateExitStatus:e,tournamentRecord:n,drawDefinition:a,winningSide:h,event:l});return le({result:g,stack:c,context:{progressExitStatus:!0}})}return le({result:{error:Wo},stack:c})}function $R(t){let e=Gt(t,[{[Cf]:!0,[to]:!0}]);if(e.error)return e;let i="setMatchUpStatus",r=vu(t);if(!t.drawDefinition){let I=t.tournamentRecord??(t.tournamentId&&r[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=I);let w=Xo({eventId:t.eventId,drawId:t.drawId,tournamentRecord:I});if(w.error)return w;w.drawDefinition&&(t.drawDefinition=w.drawDefinition),t.event=w.event}let{disableScoreValidation:n,propagateExitStatus:a,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:c,drawDefinition:u,matchUpId:d,schedule:p,event:f,notes:h}=t,m=t.matchUpFormat||t.outcome?.matchUpFormat,{policy:A}=ab({policyType:du,tournamentRecord:o,event:f}),g=t.allowChangePropagation!==void 0&&t.allowChangePropagation||A?.allowChangePropagation!==void 0&&A.allowChangePropagation||void 0,{outcome:v,setTBlast:b}=t;if(v?.winningSide&&![1,2].includes(v.winningSide))return{error:tF};if(m){let I=J5({tournamentRecord:o,drawDefinition:u,matchUpFormat:m,matchUpId:d,event:f});if(I.error)return I}if(v?.score?.sets&&!v.score.scoreStringSide1){let{score:I}=nve({...v,setTBlast:b});v.score=I,v.score.sets=v.score.sets.filter(w=>w.side1Score||w.side2Score||w.side1TiebreakScore||w.side2TiebreakScore)}let y=fb({matchUpStatusCodes:v?.matchUpStatusCodes,matchUpStatus:v?.matchUpStatus,winningSide:v?.winningSide,allowChangePropagation:g,disableScoreValidation:n,score:v?.score,propagateExitStatus:a,tournamentRecords:r,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:c,drawDefinition:u,matchUpFormat:m,matchUpId:d,schedule:p,event:f,notes:h});if(y.context?.progressExitStatus){let I=!0,w=0;for(;I&&w<10;){I=!1,w+=1;let S=d4e({sourceMatchUpStatusCodes:y.context.sourceMatchUpStatusCodes,sourceMatchUpStatus:y.context.sourceMatchUpStatus,loserParticipantId:y.context.loserParticipantId,propagateExitStatus:t.propagateExitStatus,tournamentRecord:t.tournamentRecord,loserMatchUp:y.context.loserMatchUp,matchUpsMap:y.context.matchUpsMap,drawDefinition:t.drawDefinition,event:t.event});S.context?.loserMatchUp&&(Object.assign(y.context,S.context),I=!0)}}return le({result:y,stack:i})}function ave(t){if(!t?.outcomes)return{error:Kt};if(!Array.isArray(t.outcomes))return{error:Kt,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:rt};let s=i.filter(o=>o.tournamentId===n);if(s.length){let o=p4e({outcomes:s,tournamentRecord:a});if(o.error)return o}}return{...se}}function p4e(t){let{tournamentRecords:e,tournamentRecord:i,outcomes:r,policyDefinitions:n}=t,a={};r.forEach(s=>{let{eventId:o}=s;a[o]||(a[o]=[]),a[o].push(s)});for(let s of Object.keys(a)){let{event:o}=Xo({tournamentRecord:i,eventId:s});for(let l of a[s]){let{drawId:c}=l,u=o?.drawDefinitions?.find(d=>d.drawId===c);if(u&&c){let{matchUpFormat:d,matchUpId:p}=l,f=$R({schedule:l?.schedule,tournamentRecords:e,policyDefinitions:n,tournamentRecord:i,drawDefinition:u,matchUpFormat:d,matchUpId:p,outcome:l,drawId:c,event:o});if(f.error)return f}}}return{...se}}function f4e({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){if(!r&&!t)return{error:Bt};if(!i)return{error:Kt,info:"missing outcome"};if(!r&&!e)return{error:Wo};if(!r){let n=Wr({drawDefinition:t,matchUpId:e});if(n.error)return n;r=n.matchUp}return typeof i!="object"||!i.score?.scoreStringSide1||!i.score?.scoreStringSide2?{error:be}:lr({element:r,extension:{name:DF,value:i}})}function sve(t){return f4e(t)}function s6(t){let e="resetTieFormat",{drawDefinition:i,event:r,uuids:n}=t,a=Gt(t,[{[Sa]:!0,[Cf]:!0}],e);if(a.error)return a;let s=XC(t,[{[kC]:Lh}]);if(s[id])return s;let o=t.tournamentRecord?.tournamentId,{matchUp:l,structure:c}=s?.matchUp??{};if(!l?.tieMatchUps)return le({result:{error:bl},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...se};let u=uo({structure:c,drawDefinition:i,event:r})?.tieFormat;if(!u)return le({result:{error:ts},info:"No inherited tieFormat",stack:e});let d=[],p=[],f=[],h=[];for(let m of u.collectionDefinitions){let{matchUpCount:A,collectionId:g}=m;p.push(g);let v=(l.tieMatchUps||[]).filter(b=>b.collectionId===g);if(v.length>A)v.sort((b,y)=>(b.matchUpStatus===Rn?1:0)-(y.matchUpStatus===Rn?1:0)),f.push(...v.slice(0,A)),d.push(...v.slice(3).map(xa));else if(f.push(...v),v.length<A){let b=A-v.length,y=bR({collectionDefinition:m,matchUpsLimit:b,matchUp:l,uuids:n});h.push(...y)}}for(let m of l?.tieMatchUps||[])m.collectionId&&!p.includes(m.collectionId)&&d.push(m.matchUpId);return h.length&&(f.push(...h),fg({eventId:r?.eventId,matchUps:h,drawDefinition:i,tournamentId:o})),d.length&&$h({matchUpIds:d,eventId:r?.eventId,drawDefinition:i,tournamentId:o}),l&&(l.tieMatchUps=f,l.tieFormatId=void 0,l.tieFormat=void 0,Yi({structureId:c?.structureId,eventId:r?.eventId,context:e,drawDefinition:i,tournamentId:o,matchUp:l})),{...se,newMatchUps:h,deletedMatchUpIds:d}}function o6(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}=t,a="resetScorecard";if(!i)return le({result:{error:Bt},stack:a});if(!r)return le({result:{error:mo},stack:a});if(!Lr(r))return le({result:{error:be,matchUpId:r},stack:a});let s=ss({drawDefinition:i}),{matchUps:o}=ea({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:s}),l=s.drawMatchUps.find(m=>m.matchUpId===r),c=o?.find(m=>m.matchUpId===r);if(!l||!o)return{error:Ys};if(l.matchUpType!==jl)return{error:bl};let u=xo({inContextDrawMatchUps:o,drawDefinition:i,matchUpId:r}),d=c?.structureId,{structure:p}=ui({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:o,inContextMatchUp:c,matchUpsMap:s,targetData:u,structure:p,matchUp:l}),Py(t))return{error:rF};if(l.tieMatchUps?.length)for(let m of l.tieMatchUps){let A=fb({matchUpId:m.matchUpId,matchUpTieId:r,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:n});if(A.error)return le({result:A,stack:a})}let f=er({tournamentRecord:e,drawDefinition:i,event:n})?.appliedPolicies,h=pA({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:f,drawDefinition:i,matchUpsMap:s,matchUpId:r});if(h.error)return le({result:h,stack:a});if(t.tiebreakReset&&!h.tieFormatRemoved){let m=uo({drawDefinition:i,structure:p,event:n})?.tieFormat;if(l.tieFormat&&m){let{matchUpCountDifference:A,descendantDifferences:g,ancestorDifferences:v,valueDifference:b}=Hm({descendant:l.tieFormat,ancestor:m});if(g.collectionIds.length===1&&!v.collectionIds.length&&!v.groupsCount&&A===1&&b===1){let y=s6({tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n});if(y.error)return y}}}return{...se}}function ove(t){let e=Gt(t,[{[to]:!0,[lA]:!0},{[IT]:{[Q1]:!1,roundNumbers:!1},[_pe]:"At least one must be provided",[il]:zs}]);if(e.error)return e;let i=yme(t);if(i.error)return i;let{matchUpIds:r}=i,n=$n(jl)(t.event.eventType),{tournamentRecord:a,drawDefinition:s,event:o}=t;for(let l of r){if(n){let u=o6({tiebreakReset:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(u.error||t.removeAssignments&&a6({inheritance:!1,drawDefinition:s,matchUpId:l}).error)return u}let c=fb({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(c.error)return c;if(t.removeAssignments){let u=ZK({...t,matchUpId:l});if(u.error)return u}}return{...se}}function h4e({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){if(!e)return{error:Bt};let r="setOrderOfFinish";if(!Array.isArray(i))return le({info:Ey("finishingOrder"),result:{error:be},stack:r});let{completedMatchUps:n,matchUpsMap:a}=VC({inContext:!0,drawDefinition:e}),s=n?.map(xa)??[],o=i.map(xa),{matchUpTypes:l,roundNumbers:c,structureIds:u,matchUpTieIds:d}=(n??[]).filter(({matchUpId:v})=>o.includes(v)).reduce((v,b)=>{let{matchUpTieId:y,matchUpType:I,roundNumber:w,structureId:S}=b;return v.matchUpTypes.includes(I)||v.matchUpTypes.push(I),v.roundNumbers.includes(w)||v.roundNumbers.push(w),v.structureIds.includes(S)||v.structureIds.push(S),v.matchUpTieIds.includes(y)||v.matchUpTieIds.push(y),v},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||c.length>1||u.length>1)return le({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:be},stack:r});let p,f,h={},m=[],A=[];if(!i.every(({orderOfFinish:v,matchUpId:b})=>(m.push(b),v&&A.push(v),h[b]=v,p=s.includes(b),f=v===void 0||yi(v)&&Math.floor(v)>0,p&&f)))return le({result:{error:p?be:DC},info:!p&&"matchUps must be completed"||!f&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:r});let g=n?.filter(v=>v.structureId===u[0]&&v.roundNumber===c[0]&&v.matchUpType===l[0]&&v.matchUpTieId===d[0]&&!m.includes(v.matchUpId));for(let v of g??[]){let{orderOfFinish:b}=v||{};if(b){if(!yi(b))return le({context:{orderOfFinish:b,matchUp:v},result:{error:be},stack:r});A.push(b)}}if(Zce(A).length!==A.length||Math.max(...A)>A.length)return le({info:"Values not unique or greater than expected number of values",result:{error:be},stack:r});if(u.length){let v=zF({matchUpFilters:{matchUpIds:o},structureId:u[0],drawDefinition:e,matchUpsMap:a});if(v.error)return le({result:v,stack:r});v.completedMatchUps?.forEach(b=>{b.orderOfFinish=h[b.matchUpId],Yi({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:b})})}return{...se}}function lve(t){return h4e(t)}function cve(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,lineUps:n,event:a}=t,s="applyLineUps",o=Gt(t,[{[Sa]:!0,[to]:!0,[Cf]:!0},{lineUps:!0,[il]:zs}],s);if(o.error)return o;let l=e.participants||[],c=Wr({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:r});if(c.error)return c;if(!c.matchUp)return{error:Ys};let{matchUp:u,structure:d}=c,{drawPositions:p,matchUpType:f}=u;if(f!==$r)return{error:bl};if(!p?.length)return{error:P1};let h=uo({matchUp:u,drawDefinition:i,structure:d,event:a})?.tieFormat,m={};for(let g of n){if(!Array.isArray(g))return{error:be,lineUp:g};let v={},b=[];for(let T of g){if(typeof T!="object")return{error:be,lineUpAssignment:T};let{participantId:D,collectionAssignments:C=[]}=T;if(!Array.isArray(C))return{error:be,collectionAssignments:C};let E=l.find(R=>R.participantId===D);if(!E)return{error:On};if(E.participantType!==zi)return{error:ap};let P=u.sides?.find(R=>R.participant?.individualParticipantIds?.includes(D))?.sideNumber;P&&b.push(P);for(let R of C){if(typeof R!="object")return{error:be,collectionAssignment:R};let{collectionId:M,collectionPosition:N}=R,k=h?.collectionDefinitions?.find(F=>F.collectionId===M);if(!k)return{error:be,collectionId:M};let O=`${M}-${N}`;v[O]||(v[O]=[]);let x=v[O].length;if($n(Er)(k.matchUpType)&&x||k.matchUpType===yr&&x>1)return{info:"Excessive collectionPosition assignments",error:be};v[O].push(D)}}let y=Object.values(v);for(let T of y)if(T.length===2){let{participant:D}=bd({tournamentParticipants:l,participantIds:T});if(!D){let C=uf({participant:{participantType:Mi,participantRole:Ns,individualParticipantIds:T},pairOverride:!0,tournamentRecord:e});if(C.error)return C}}let I=Vl(b),w=(I[1]||0)>(I[2]||0)&&1||(I[2]||0)>(I[1]||0)&&2||void 0,S=Object.keys(m).map(T=>parseInt(T));w&&!S.includes(w)&&(m[w]=g)}if(!Object.keys(m).length)return{error:Sq};if(c=Wr({drawDefinition:i,matchUpId:r}),c.error)return c;if(!c.matchUp)return{error:Ys};let{matchUp:A}=c;A.sides||(A.sides=[]);for(let g of[1,2]){let v=A.sides.find(y=>y.sideNumber===g),b=m[g];if(b)v?v.lineUp=b:A.sides.push({lineUp:b,sideNumber:g});else continue}return Yi({tournamentId:e?.tournamentId,context:s,drawDefinition:i,matchUp:A}),{...se}}var jL={};Fi(jL,{anonymizeTournamentRecord:()=>Nve,generate:()=>uve,generateEventWithDraw:()=>YL,generateOutcome:()=>m6,generateOutcomeFromScoreString:()=>l6,generateParticipants:()=>nE,generateTournamentRecord:()=>Rve,modifyTournamentRecord:()=>kve,mutate:()=>Mve});var uve={};Fi(uve,{generateEventWithDraw:()=>YL,generateOutcome:()=>m6,generateOutcomeFromScoreString:()=>l6,generateParticipants:()=>nE,generateTournamentRecord:()=>Rve});function m4e(t){let e=t.reduce((i,r)=>((r.side1Score!==void 0||r.side2Score!==void 0)&&(i.side1+=r.side1Score??0,i.side2+=r.side2Score??0),i),{side1:0,side2:0});return e.side1>e.side2?1:e.side2>e.side1?2:t.find(i=>i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)?.winningSide}function A4e(t){let e={side1:0,side2:0};if(t.forEach(i=>{i.winningSide===1?e.side1++:i.winningSide===2&&e.side2++}),e.side1>e.side2)return 1;if(e.side2>e.side1)return 2}function g4e(t,e,i){if(t||!e||!i)return t;let r=vs(e);return r?.setFormat?.based==="A"||r?.finalSetFormat?.based==="A"?m4e(i):A4e(i)}function v4e(t,e,i){let r=MR({scoreString:t,matchUpFormat:e});return{sets:r,scoreStringSide1:Zd({sets:r,matchUpFormat:e,setTBlast:i}),scoreStringSide2:Zd({sets:r,reversed:!0,matchUpFormat:e,setTBlast:i})}}function y4e(t,e,i,r){let n=Zd({sets:t,matchUpFormat:i,setTBlast:r}),a=Zd({sets:t,reversed:!0,matchUpFormat:i,setTBlast:r});if(typeof n!="string")return n;if(typeof a!="string")return a;let s=e===2?a:n,o=e===2?n:a;return{sets:MR({scoreString:s,matchUpFormat:i}),scoreStringSide1:s,scoreStringSide2:o}}function l6(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n,setTBlast:a,preserveSideOrder:s=!1}=t;if(!n)return{outcome:{...iL,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:be,winningSide:r};let o=n&&MR({scoreString:n,matchUpFormat:e}),l=n?.trim().startsWith("["),c=g4e(r,e,o),u=vs(e),d=u?.setFormat?.based==="A"||u?.finalSetFormat?.based==="A",p=s||l||d?v4e(n,e,a):y4e(o,c,e,a);return Ft({outcome:{matchUpStatus:i,winningSide:c,score:p}})}function c6({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){let n=(e?.[r.matchUpId]?.matchUpIds||[]).filter(a=>i.includes(a)).filter(a=>!t[a]);return{dependenciesScheduled:!n?.length,remainingDependencies:n}}function HR({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function b4e({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function IP({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:s=0,scheduleTime:o,matchUp:l}){let c=qr(l?.schedule?.endTime),u=c?ml(c,ri(s)):ml(o,ri(r)+ri(s)),d=i&&(c?ml(qr(c),i):ml(o,ri(r)+ri(i))),p=a?.[l.matchUpId]?.participantIds||[],f=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(h=>{HR({individualParticipantProfiles:e,participantId:h});let m=e[h].priorMatchUpType!==l.matchUpType&&d||u;f.includes(h)?b4e({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:m,participantId:h,scheduleTime:o}):(e[h].timeAfterRecovery=m,e[h].bookings.push({scheduleTime:o,timeAfterRecovery:m}))}),PT({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:u,matchUp:l})}function dve({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){let a,s=n.minutesMap?.[r]?.recoveryMinutes,o=(n.minutesMap?.[r]?.averageMinutes||0)+(s||0),l=ml(i,o),c=e?.[r]?.dependentMatchUpIds||[];if(c.length){let u=c.reduce((d,p)=>{let f=t[p];if(!f)return d;let h={scheduleTime:f,matchUpId:p};return f&&!d.matchUpId||ar(f)<ar(d.scheduleTime)?h:d},{});u.scheduleTime&&ar(l)>ar(u.scheduleTime)&&(a=u)}return{scheduledDependent:a}}function I4e(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>i===yr&&(r?.participant?.individualParticipants||[])||r?.participant&&[r.participant]||[]).flat()}var VR="DO_NOT_SCHEDULE",pve={DO_NOT_SCHEDULE:VR};function u6({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:s}){let o=I4e(s).map(({person:f})=>f?.personId);if(i){let f=(s?.potentialParticipants||[]).flat().map(({person:h})=>h?.personId);o.push(...f)}let l=o.map(f=>r[f]?.map(h=>({...h,personId:f}))).filter(Boolean).flat().filter(f=>f.requestType===VR&&hh(a,f.date)),c=[],u=s?.matchUpId,d=Zn(qr(n),Si(a)),p=qr(Oq(d,t).toISOString());for(let f of l){let{requestId:h,startTime:m,endTime:A}=f;(n>m&&n<A||p&&p>m&&p<A)&&(c.push({matchUpId:u,request:f,scheduleTime:n}),e[h]?(e[h].scheduleTimes.includes(n)||e[h].scheduleTimes.push(n),e[h].matchUpIds.includes(u)||e[h].matchUpIds.push(u)):e[h]={request:f,scheduleTimes:[n],matchUpIds:[u]})}return{conflicts:c}}function t4({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=xF(i),s=(t[i.matchUpId]||[]).filter(o=>!Bo(o,a)).flat();[...a,...s].forEach(o=>{if(HR({individualParticipantProfiles:e,participantId:o}),!e[o].potentialCounted[i.drawId]){let l=e[o].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[nd]?l[nd]+=r:r>0&&(l[nd]=r),s.includes(o)&&(e[o].potentialCounted[i.drawId]=!0)}})}function w4e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,matchUpDependencies:o,clearScheduleDates:l,scheduleDate:c,minutesMap:u,matchUps:d}){let p=[];i||(n=d?.filter(m=>{let A=m.schedule||{},g=m.matchUpStatus==="BYE";return g&&p.push({tournamentId:m.tournamentId,matchUpId:m.matchUpId}),!g&&_R({schedule:A})&&(!c||m.schedule.scheduledDate===c)}),i=n.map(xa));let f=Array.isArray(l)?l.includes(c):l,h=f?[]:d.filter(({matchUpId:m})=>i.includes(m));for(let m of h){t4({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:m});let A=m.schedule?.scheduledTime;if(A){s[m.matchUpId]=A;let g=u?.[m.matchUpId]?.recoveryMinutes;IP({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:o,averageMatchUpMinutes:r,recoveryMinutes:g,scheduleTime:A,matchUp:m})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:f}}function zL({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:s,matchUps:o}){if(typeof r!="object")return{error:yn};if(!wu(o)&&!Array.isArray(i))return{error:sA};a=a??FL({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:f}=Z1({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:f}}})).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=o?.filter(d=>{let p=d.schedule;return _R({schedule:p})&&(!s||d.schedule.scheduledDate===s)}));let u=i?.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!=="BYE");return{bookings:u?.map(({eventId:d,schedule:p,matchUpFormat:f})=>{let{event:h,scheduleTiming:m}=l[d],A=h?.eventType,g={...m,defaultTiming:c,matchUpFormat:f},{averageMinutes:v,recoveryMinutes:b}=VF({timingDetails:g,eventType:A}),{courtId:y,venueId:I}=p,w=qr(p.scheduledTime),S=ml(w,v);return{recoveryMinutes:b,averageMinutes:v,periodLength:a,startTime:w,courtId:y,endTime:S,venueId:I}}).filter(Boolean),relevantMatchUps:u,dateScheduledMatchUps:i}}function S4e({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:s,periodLength:o,scheduleDate:l,startTime:c,venueIds:u,matchUps:d,endTime:p}){if(s&&!a&&(a={[s.tournamentId]:s}),typeof a!="object"||!Object.keys(a).length)return{error:yn};o=o??FL({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:f,venues:h}=fA({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),m=f?.filter(I=>!u||u.includes(I.venueId))??[];c=c??RT({courts:m,scheduleDate:l,startTime:!0}),p=p??RT({courts:m,scheduleDate:l,endTime:!0});let{bookings:A,dateScheduledMatchUps:g}=zL({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:o,venueIds:u,matchUps:d}),v={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:o,startTime:c,bookings:A,endTime:p,courts:m},{scheduleTimes:b}=zK(v),y=u?.length===1&&u[0]||h?.length===1&&h[0].venueId||void 0;return{dateScheduledMatchUpIds:g?.map(Kl("matchUpId")),dateScheduledMatchUps:g,scheduleTimes:b,venueId:y}}function U4e({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,s,o,l;for(let c of t.filter(Boolean))l||(l=c.hash),(c.hash===l||i)&&(n=n.concat(c.matchUpIds)),c.hash,o=e,s=c.recoveryMinutes,a=c.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:s,averageMinutes:o}),{groupedRounds:r}}function fve({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,tournamentRecords:l,periodLength:c,scheduleDate:u,useGarman:d,matchUps:p,courts:f,venues:h}){let m={},A=[],g=[],v=[];for(let b of h){let{rounds:y=[],venueId:I}=b,{scheduledRoundsDetails:w,greatestAverageMinutes:S,orderedMatchUpIds:T,minutesMap:D}=kR({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:c,matchUps:p,rounds:y});v.push(...T??[]);let{groupedRounds:C}=U4e({scheduledRoundsDetails:w,greatestAverageMinutes:S,garmanSinglePass:!0}),E,P=[];d&&({scheduleTimes:P,dateScheduledMatchUpIds:E}=S4e({averageMatchUpMinutes:C[0]?.averageMinutes,scheduleDate:Si(u),venueIds:[b.venueId],clearScheduleDates:o,tournamentRecords:l,periodLength:c,matchUps:p}));let R=w4e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:E,greatestAverageMinutes:S,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,scheduleDate:u,minutesMap:D,matchUps:p});({dateScheduledMatchUpIds:E}=R);let M=R,{byeScheduledMatchUpDetails:N,clearDate:k}=R;N?.length&&g.push(...N);let{matchUpsToSchedule:O,matchUpMap:x}=SL({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:E,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:T,clearDate:k,matchUps:p}),F=f.filter(_=>_.venueId===I);m[I]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:S,scheduledRoundsDetails:w,dateScheduledMatchUps:M,matchUpsToSchedule:O,scheduleTimes:P,groupedRounds:C,venueCourts:F,minutesMap:D,matchUpMap:x},o||A.push(...E)}return{allDateScheduledByeMatchUpDetails:g,allDateScheduledMatchUpIds:A,venueScheduledRoundDetails:m,allDateMatchUpIds:v}}function T4e(t,e){let i=ar(t.scheduleTime),r=ar(t.timeAfterRecovery),n=ar(e.scheduleTime),a=ar(e.timeAfterRecovery),s=i===n||r===a,o=i>n&&i<a,l=n>i&&n<r,c=r>n&&r<a,u=a>i&&a<r;return Ft({hasOverlap:s||o||c||l||u,startAisContained:o,endAisContained:c,startBisContained:l,endBisContained:u},!0)}function d6({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){let s=(i?.[n.matchUpId]?.participantIds||[]).flat(),o=a?.minutesMap?.[n.matchUpId]?.averageMinutes||0,l=a?.minutesMap?.[n.matchUpId]?.recoveryMinutes||0,c=s.every(p=>{HR({individualParticipantProfiles:t,participantId:p});let f=t[p];if(!f.timeAfterRecovery)return!0;let h=qr(n?.schedule?.endTime),m=h?ml(h,ri(l)):ml(r,ri(o)+ri(l));return![...Object.keys(f.potentialBookings).filter(A=>A!==n.drawId).map(A=>f.potentialBookings[A]).flat(),...f.bookings].find(A=>T4e({scheduleTime:r,timeAfterRecovery:m},A).hasOverlap)}),u=e[n.matchUpId],d=(u?O1(Zn(u),Zn(r),!1):0)>=0;return{enoughTime:c&&d}}function hve({autoSchedulingAudit:t,tournamentRecords:e}){bi({topic:wm,payload:t});let i=s=>s?Object.values(s).reduce((o,l)=>o+l.length||0,0):0,r=(t?.schedulingProfile||[]).reduce((s,o)=>s+o.venues.reduce((l,c)=>l+c.rounds.length,0),0),n={scheduledDatesCount:t.scheduledDates?.length,noTimeMatchUpIdsCount:i(t?.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t?.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t?.overLimitMatchUpIds),requestConflictsCount:i(t?.requestConflicts),profileRoundsCount:r},a={itemType:Zj,itemValue:n};for(let s of Object.values(e)){let o=s.tournamentId;uF(wm)?bi({payload:{type:Zj,tournamentId:o,detail:n},topic:wm}):TR({tournamentRecord:s,timeItem:a})}}function p6({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=xF(r),{matchUpId:a,matchUpType:s}=r,o=(r.roundPosition&&t[a]||[]).flat(),l=Ci(n.concat(...o));return l.forEach(c=>{HR({individualParticipantProfiles:e,participantId:c})}),{participantIdsAtLimit:l.filter(c=>{let u=e[c];if(u)return[s,nd].find(d=>{let p=u.counters?.[d]||0,f=i[d]||0;return p&&f&&p>=f})}),relevantParticipantIds:l}}function wP({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:s,tournamentRecord:o,matchUpDetails:l,matchUpIds:c,schedule:u}){if(!o)return{error:rt};if(!l&&(!c||!Array.isArray(c)))return{error:Sw};if(!l&&(!u||typeof u!="object"))return{error:ade};let d,p=[],f=0;if(r&&!n){let A=Rd({tournamentRecords:s,tournamentRecord:o});n=A.matchUpDependencies,d=A.matchUps}d||(d=La({tournamentRecord:o})?.matchUps??[]);let h=d.reduce((A,g)=>{let{matchUpId:v,drawId:b,matchUpStatus:y}=g;return(e||y!=="BYE")&&(t||!qn.includes(y))&&(A[b]?A[b].push(v):A[b]=[v]),A},{}),m=l?.map(A=>A.matchUpId);for(let A of Object.keys(h)){let{drawDefinition:g}=Xg({tournamentRecord:o,drawId:A});if(!g)continue;let v=h[A].filter(y=>c?.includes(y)??m?.includes(y)),b=Do({inContext:!1,drawDefinition:g}).matchUps;for(let y of v){let I=l?.find(S=>S.matchUpId===y)?.schedule||u,w=QL({schedule:I,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:s,tournamentRecord:o,checkChronology:r,drawDefinition:g,drawMatchUps:b,matchUpId:y});if(w?.warnings?.length&&p.push(...w.warnings),w?.success&&(f+=1),w.error)return w}}return p.length?{...se,scheduled:f,warnings:p}:{...se,scheduled:f}}function GR(t){let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:r,matchUpContextIds:n,removePriorValues:a,tournamentRecords:s,checkChronology:o,matchUpDetails:l,schedule:c}=t;if(t.matchUpIds&&!n)return wP(t);let u=Gt(t,[{[Xs]:!0},{[IT]:{matchUpContextIds:!1,matchUpDetails:!1},[Dc]:be,[il]:zs}]);if(u.error)return u;if((!l||n)&&!c)return{error:Kt,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:f}=Rd({tournamentRecords:s});for(let h of Object.values(s)){let{tournamentId:m}=h,A=n?.filter(v=>v.tournamentId===m).map(xa),g=l?.filter(v=>v?.tournamentId===m);if(A?.length||g?.length){let v=wP({matchUpDetails:g,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:f,errorOnAnachronism:r,removePriorValues:a,tournamentRecords:s,tournamentRecord:h,checkChronology:o,matchUpIds:A,schedule:c});if(v.warnings?.length&&d.push(...v.warnings),v.scheduled&&(p+=v.scheduled),v.error)return v}}return d.length?{...se,scheduled:p,warnings:d}:{...se,scheduled:p}}function C4e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:c,schedulingProfile:u,personRequests:d,periodLength:p,matchUps:f,courts:h,dryRun:m}){let A={},g={},v={},b={},y={},I={},w={},S={},T={},D={};for(let P of n){let R=Si(P?.scheduleDate),M=P?.venues||[],N={},k={},O=(W,Y)=>{W.forEach(X=>{let J=k[X].counters;J[Y]?J[Y]+=1:J[Y]=1,J[nd]?J[nd]+=1:J[nd]=1})};v[R]={},b[R]={},A[R]={},g[R]={},w[R]=[],S[R]=[],T[R]=[],D[R]=[];let x={};f.forEach(W=>{W.schedule?.scheduledDate&&hh(R,Si(W.schedule.scheduledDate))&&PT({matchUpPotentialParticipantIds:N,matchUpNotBeforeTimes:x,matchUp:W})});let{allDateScheduledByeMatchUpDetails:F,venueScheduledRoundDetails:_,allDateMatchUpIds:V}=fve({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:x,matchUpScheduleTimes:I,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:c,useGarman:!0,periodLength:p,scheduleDate:R,matchUps:f,courts:h,venues:M}),G=10,z=0,Q,j=10;for(;!Q;){for(let{venueId:W}of M){let Y=0,X=_[W];for(;X.courtsCount&&X.scheduleTimes?.length&&X.matchUpsToSchedule?.length&&Y<=X.courtsCount;){let{scheduleTime:J,attempts:ie=0}=X.scheduleTimes.shift(),ue=X.matchUpsToSchedule.find(ne=>{let{matchUpId:ge,matchUpType:he}=ne,{participantIdsAtLimit:Ie,relevantParticipantIds:xe}=p6({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,matchUpDailyLimits:o,matchUp:ne});if(Ie.length)return S[R].includes(ge)||S[R].push(ge),!1;let{scheduledDependent:Je}=dve({matchUpScheduleTimes:I,matchUpDependencies:s,scheduleTime:J,matchUpId:ge,details:X});if(Je)return!1;let{dependenciesScheduled:qe,remainingDependencies:dt}=c6({matchUpScheduleTimes:I,matchUpDependencies:s,allDateMatchUpIds:V,matchUp:ne});if(!qe)return b[R][ge]||(b[R][ge]=[]),b[R][ge].push({scheduleTime:J,remainingDependencies:dt}),!1;let{enoughTime:ft}=d6({individualParticipantProfiles:k,matchUpNotBeforeTimes:x,matchUpDependencies:s,scheduleTime:J,details:X,matchUp:ne});if(!ft)return v[R][ge]||(v[R][ge]=[]),v[R][ge].push({scheduleTime:J}),!1;let je=X.greatestAverageMinutes,{conflicts:Tt}=u6({potentials:e,averageMatchUpMinutes:je,requestConflicts:D,personRequests:d,scheduleTime:J,scheduleDate:R,matchUp:ne});if(Tt?.length)return y[R]||(y[R]=[]),y[R].push(...Tt),!1;O(xe,he);let Oe=X.minutesMap?.[ge]?.recoveryMinutes;return IP({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,matchUpNotBeforeTimes:x,averageMatchUpMinutes:je,matchUpDependencies:s,recoveryMinutes:Oe,scheduleTime:J,matchUp:ne}),I[ge]=J,!0});X.matchUpsToSchedule=X.matchUpsToSchedule.filter(({matchUpId:ne})=>ne!==ue?.matchUpId),ue?Y+=1:(g[R][W]||(g[R][W]=[]),g[R][W].push({scheduleTime:J,attempts:ie+1}))}X.matchUpsToSchedule?.length&&(g[R][W]=g[R][W]?.filter(J=>{let ie=J.attempts<G;return ie&&X.scheduleTimes.push(J),!ie})),(!X.scheduleTimes?.length||!X.matchUpsToSchedule?.length)&&(X.complete=!0)}z+=1,Q=M.every(({venueId:W})=>_[W].complete)||z===j}for(let{venueId:W}of M){let Y=_[W].matchUpMap;Object.keys(Y).forEach(X=>{let J=c[X];J&&Object.keys(Y[X]).forEach(ie=>{let{drawDefinition:ue}=Xg({tournamentRecord:J,drawId:ie});ue&&Y[X][ie].forEach(({matchUpId:ne})=>{let ge=I[ne];if(ge){let he=ge.split(":").map(tu).join(":"),Ie=`${Si(R)}T${he}`;m?w[R].push(ne):(Zg({drawDefinition:ue,scheduledTime:Ie,matchUpId:ne}).success&&w[R].push(ne),W&&rE({tournamentRecord:J,drawDefinition:ue,matchUpId:ne,venueId:W}))}})})}),T[R]=_[W].matchUpsToSchedule.map(xa),A[R][W]=_[W].scheduleTimes.sort((X,J)=>ar(X.scheduleTime)-ar(J.scheduleTime))}!m&&F?.length&&GR({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let W of P.venues)for(let Y of W.rounds){let X=(Y.matchUps?.map(({matchUpId:ie})=>ie)||[]).filter(ie=>w[R].includes(ie));Y.canScheduledMatchUpIds=X;let J=Math.round(X.length/Y.matchUpsCount*1e4)/100;(J===1/0||isNaN(J))&&(J=0),Y.possibleToSchedulePct=J,Y.matchUpsCount===X.length&&(Y.possibleToSchedule=!0)}}let C=n.map(({scheduleDate:P})=>P),E={timeStamp:Date.now(),overLimitMatchUpIds:S,scheduledMatchUpIds:w,schedulingProfile:u,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:C};return hve({tournamentRecords:c,autoSchedulingAudit:E}),{...se,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:A,dateSchedulingProfiles:n,skippedScheduleTimes:g,recoveryTimeDeferredMatchUpIds:v,dependencyDeferredMatchUpIds:b,matchUpScheduleTimes:I,overLimitMatchUpIds:S,scheduledMatchUpIds:w,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:C}}function $ee({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Kt,stack:"getEarliestCourtTime"};let a=RT({scheduleDate:n,courts:[r],startTime:!0}),s=RT({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||s;let o=gg({court:r,date:n}),{timeSlots:l}=tE({courtDate:o}),c=Zn(e),u=Zn(i);return{earliestCourtTime:l?.reduce((d,p)=>{let f=Zn(p.startTime),h=Zn(p.endTime);if(f>u||h<c)return d;let m=c>f?c:f;if(O1(m,h)>=t){let A=qr(m.toISOString());A&&(!d||A<d)&&(d=A)}return d},void 0),courtStartTime:a,courtEndTime:s}}function E4e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:c,periodLength:u=30,schedulingProfile:d,personRequests:p,matchUps:f=[],courts:h,dryRun:m}){let A={},g={},v={},b={},y={},I={},w={},S={},T={};for(let E of n??[]){let P=Si(E?.scheduleDate),R=E?.venues||[],M={},N={},k=(ue,ne)=>{ue.forEach(ge=>{let he=N[ge].counters;he[ne]?he[ne]+=1:he[ne]=1,he[nd]?he[nd]+=1:he[nd]=1})};A[P]={},g[P]={},I[P]=[],w[P]=[],S[P]=[],T[P]=[];let O={};f?.forEach(ue=>{ue.schedule?.scheduledDate&&hh(P,Si(ue.schedule.scheduledDate))&&PT({matchUpPotentialParticipantIds:M,matchUpNotBeforeTimes:O,matchUp:ue})});let{allDateScheduledByeMatchUpDetails:x,allDateScheduledMatchUpIds:F,venueScheduledRoundDetails:_,allDateMatchUpIds:V}=fve({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:O,matchUpScheduleTimes:y,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:c,periodLength:u,scheduleDate:P,matchUps:f,courts:h,venues:R}),G=f?.filter(({matchUpId:ue})=>F.includes(ue)),{bookings:z}=zL({dateScheduledMatchUps:G,tournamentRecords:c,scheduleDate:P,periodLength:u}),{virtualCourts:Q}=OL({scheduleDate:P,periodLength:u,bookings:z,courts:h}),j=Q?.reduce((ue,ne)=>{let{earliestCourtTime:ge,courtEndTime:he}=$ee({date:P,averageMinutes:0,court:ne});return(!ue.startTime||Zn(ge)<Zn(ue.startTime))&&(ue.startTime=ge),(!ue.endTime||Zn(he)>Zn(ue.endTime))&&(ue.endTime=he),ue},{}),W=j.startTime,Y=({courtId:ue,booking:ne})=>Q?.find(ge=>ge.courtId===ue)?.dateAvailability[0].bookings.push(ne),X=10,J=0,ie;for(;!ie;){for(let{venueId:ue}of R){let ne=_[ue],ge=ne.matchUpsToSchedule.length,he=[],Ie=[],xe,Je=0;for(;!xe;){for(let qe of ne.matchUpsToSchedule){if(Ie.length===ne.courtsCount||he.length===ne.courtsCount){xe=!0;break}let{matchUpId:dt,matchUpType:ft}=qe,{participantIdsAtLimit:je,relevantParticipantIds:Tt}=p6({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,matchUpDailyLimits:o,matchUp:qe});if(je.length){w[P].includes(dt)||w[P].push(dt);continue}let{dependenciesScheduled:Oe,remainingDependencies:mt}=c6({matchUpScheduleTimes:y,matchUpDependencies:s,allDateMatchUpIds:V,matchUp:qe});if(!Oe){g[P][dt]||(g[P][dt]=[]),g[P][dt].push({remainingDependencies:mt});continue}let Le=[],lt=Q?.reduce((it,Fe)=>{if(Ie.includes(Fe.courtId))return it;let{earliestCourtTime:Xe}=$ee({averageMinutes:ne.greatestAverageMinutes,startTime:W,date:P,court:Fe});if(it.scheduleTime&&ar(Xe)>=ar(it.scheduleTime))return it;let{scheduledDependent:ct}=dve({matchUpScheduleTimes:y,matchUpDependencies:s,scheduleTime:Xe,matchUpId:dt,details:ne});if(ct)return it;let{enoughTime:We}=d6({individualParticipantProfiles:N,matchUpNotBeforeTimes:O,matchUpDependencies:s,scheduleTime:Xe,details:ne,matchUp:qe});if(!We)return A[P][dt]||(A[P][dt]=[]),A[P][dt].includes(Xe)||A[P][dt].push(Xe),it;let ht=ne.minutesMap?.[dt]?.averageMinutes||ne.greatestAverageMinutes,{conflicts:xt}=u6({potentials:e,averageMatchUpMinutes:ht,requestConflicts:T,personRequests:p,scheduleTime:Xe,scheduleDate:P,matchUp:qe});if(xt?.length)return Le.push(...xt),!1;k(Tt,ft);let pe=ne.minutesMap?.[dt]?.recoveryMinutes;return IP({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,matchUpNotBeforeTimes:O,averageMatchUpMinutes:ht,matchUpDependencies:s,recoveryMinutes:pe,scheduleTime:Xe,matchUp:qe}),(!it.scheduleTime||ar(Xe)<ar(it.scheduleTime))&&(it.averageMatchUpMinutes=ht,it.recoveryMinutes=pe,it.scheduleTime=Xe,it.courtName=Fe.courtName,it.courtId=Fe.courtId),it},{});if(lt.scheduleTime){let{averageMatchUpMinutes:it,recoveryMinutes:Fe,scheduleTime:Xe,courtId:ct}=lt;y[dt]=Xe,b[dt]=ct,he.push(dt),Ie.push(ct);let We=Xe,ht=ml(We,it);Y({courtId:ct,booking:{averageMatchUpMinutes:it,recoveryMinutes:Fe,periodLength:u,matchUpId:dt,startTime:We,courtId:ct,endTime:ht,venueId:ue}}),ne.matchUpsToSchedule=ne.matchUpsToSchedule.filter(xt=>xt.matchUpId!==dt)}else Le?.length&&(v[P]||(v[P]=[]),v[P].push(...Le))}(Ie.length===ne.courtsCount||he.length===ne.courtsCount||!ne.matchUpsToSchedule.length)&&(xe=!0),ne.matchUpsToSchedule.length&&he<ne.courtsCount&&(Zn(W)<Zn(j.endTime)?W=ml(W,u):(xe=!0,ne.complete=!0)),Je+=1,!xe&&Je>=ge&&(xe=!0)}ne.matchUpsToSchedule?.length||(ne.complete=!0)}J+=1,ie=R.every(({venueId:ue})=>_[ue].complete)||J===X}for(let{venueId:ue}of R){let ne=_[ue].matchUpMap;Object.keys(ne).forEach(ge=>{let he=c[ge];he&&Object.keys(ne[ge]).forEach(Ie=>{let{drawDefinition:xe}=Xg({tournamentRecord:he,drawId:Ie});xe&&ne[ge][Ie].forEach(({matchUpId:Je})=>{let qe=y[Je],dt=b[Je];if(qe){let ft=qe.split(":").map(tu).join(":"),je=`${Si(P)}T${ft}`;m||(Zg({drawDefinition:xe,scheduledTime:je,matchUpId:Je}),Yw({courtDayDate:P,tournamentRecords:c,tournamentRecord:he,drawDefinition:xe,matchUpId:Je,courtId:dt})),I[P].push(Je)}})})}),S[P]=_[ue].matchUpsToSchedule.map(xa)}!m&&x?.length&&GR({matchUpDetails:x,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let ue of E.venues)for(let ne of ue.rounds){let ge=(ne.matchUps??[]).map(({matchUpId:Ie})=>Ie)?.filter(Ie=>I[P].includes(Ie));ne.canScheduledMatchUpIds=ge;let he=Math.round((ge?.length||0)/ne.matchUpsCount*1e4)/100;(he===1/0||isNaN(he))&&(he=void 0),ne.possibleToSchedulePct=he,ne.matchUpsCount===ge?.length&&(ne.possibleToSchedule=!0)}}let D=(n??[]).map(({scheduleDate:E})=>E),C={timeStamp:Date.now(),overLimitMatchUpIds:w,scheduledMatchUpIds:I,schedulingProfile:d,noTimeMatchUpIds:S,requestConflicts:T,scheduledDates:D};return hve({tournamentRecords:c,autoSchedulingAudit:C}),{...se,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:A,dependencyDeferredMatchUpIds:g,matchUpScheduleTimes:y,overLimitMatchUpIds:w,scheduledMatchUpIds:I,noTimeMatchUpIds:S,requestConflicts:T,scheduledDates:D}}function qL(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=qn,scheduledDates:r,venueIds:n}=t,a=vu(t),s=Ki(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!s?.length)return{error:yn};let o=0;for(let l of s){let c=a[l],u=D4e({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:c,scheduledDates:r,venueIds:n});if(u.error)return u;o+=u.clearedScheduleCount??0}return{...se,clearedScheduleCount:o}}function D4e({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=qn,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:rt};if(!Array.isArray(e)||!Array.isArray(n))return{error:be};n.length&&t.push("venueId");let a=La({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],s={};a.forEach(({matchUpStatus:c,schedule:u,drawId:d,matchUpId:p})=>{(!c||!e.includes(c))&&_R({schedule:u,scheduleAttributes:t})&&(!n?.length||n.includes(u.venueId))&&(s[d]||(s[d]=[]),s[d].push(p))});let o=i.tournamentId,l=0;for(let c in s){let{event:u,drawDefinition:d}=Xo({tournamentRecord:i,drawId:c}),p=Do({drawDefinition:d,matchUpFilters:{matchUpIds:s[c]}}).matchUps??[];for(let f of p){let h=!1;f.timeItems=(f.timeItems??[]).filter(m=>{let A=m?.itemType&&![wh,mg,kw,LF,xw,_w].includes(m?.itemType);return A||(h=!0),A}),h&&(Yi({context:"clear schedules",eventId:u?.eventId,drawDefinition:d,tournamentId:o,matchUp:f}),l+=1)}}return{...se,clearedScheduleCount:l}}function WL(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:s,useGarman:o,dryRun:l,pro:c}=t,u=Gt(t,[{[Xs]:!0},{[Es]:D=>!D||Array.isArray(D)&&D.every(Co),[Rpe]:!1,[il]:zs}]);if(u.error)return u;let d=hA({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...se};let{modifications:p,issues:f=[],schedulingProfile:h=[]}=d,m=Object.assign({},...Object.values(a).map(D=>$C({tournamentRecord:D}).containedStructures)),A=n.map(D=>{if(Co(D))return Si(D)}).filter(Boolean),g=h.map(D=>D.scheduleDate).map(D=>Co(D)&&Si(D)).filter(D=>D&&(!n.length||A.includes(D)));if(!g.length)return{error:Bue};if(r&&!l){let D=Array.isArray(r)?r:[];qL({tournamentRecords:a,scheduledDates:D})}let v=fA({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:b}=sp({matchUpFilters:{matchUpTypes:[Er,yr]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:y}=Rd({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:b}),{matchUpDailyLimits:I}=NL({tournamentRecords:a}),{personRequests:w}=pb({requestType:VR,tournamentRecords:a}),S=h.filter(D=>{let C=Si(D?.scheduleDate);return g.includes(C)}).sort((D,C)=>new Date(D.scheduleDate).getTime()-new Date(C.scheduleDate).getTime()),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:f,dateSchedulingProfiles:S,containedStructureIds:m,matchUpDependencies:y,matchUpDailyLimits:I,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:h,personRequests:w,periodLength:s,matchUps:b,dryRun:l,courts:v};return c?E4e(T):C4e(T)}function KL(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:r,...n}=t||{};return n.tournamentId||(n.tournamentId=fr()),n.startDate&&!vy(n.startDate)&&!Cx.test(n.startDate)?{error:fa}:n.endDate&&!vy(n.endDate)&&!Cx.test(n.endDate)?{error:fa}:(n.extensions&&(n.extensions=n.extensions.filter(of)),{...n})}function f6({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:s}){if(!i)return{error:rt};let o={},l=(i.participants??[]).filter(({participantType:h,participantRole:m})=>h===zi&&m===Ns),c=0;for(let h of l){let m=a&&iy({element:h,accessor:a})?.value||r&&h.person?.[r]||e&&h[e];if(m){if(!Object.keys(o).includes(m)){o[m]={participantName:n?.[c]??m,participantId:s?.pop()??fr(),individualParticipantIds:[],participantRole:Ns,participantType:gr};let A={value:r??e,name:Uj};lr({element:o[m],extension:A}),c+=1}o[m].individualParticipantIds.push(h.participantId)}}let u=Object.keys(o),d=(i.participants??[]).map(h=>{if(h.participantType!==gr||h.participantRole!==Ns)return;let{extension:m}=Bi({name:Uj,element:h}),A=m?.value;if(u.includes(A))return h.participantId}).filter(Boolean),p=0,f=[];return Object.keys(o).forEach(h=>{let m=o[h],{participantId:A}=m;d.includes(A)||(i.participants||(i.participants=[]),t&&i.participants.push(m),f.push(m),p++)}),t&&p?(bi({payload:{tournamentId:i.tournamentId,participants:f},topic:pg}),{...se,participantsAdded:p}):f.length?{...se,newParticipants:f}:{error:pOe}}var P4e=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],R4e=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function mve({count:t=1,participantsCount:e=32}={}){let i=To(R4e),r=i.slice(0,t);return{cities:gt(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Bl(r))}}function Ave({count:t=1,participantsCount:e=32}={}){let i=To(P4e),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:gt(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Bl(r))}}function gve({count:t=1,participantsCount:e=32}={}){let i=gt(0,t).map(()=>gt(0,5).map(()=>Xc(0,9)).join(""));return{postalCodes:gt(0,e).map(r=>r<t?i[r]:Bl(i))}}function Jx({idPrefix:t,participantType:e,index:i,uuids:r}){let n=Lr(e)?e[0]:"X";return t?`${t}-${n}-${i}`:r?.pop()||fr()}function vve(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r?.[a],state:i?.[a],city:e?.[a],countryCode:n}}var M4e={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood","Zecic"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Miro","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function DV(t){let{count:e=100,sex:i}=t||{};if(!e||i&&!rf(i))return{personData:[],error:be};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:s}=M4e,o=ng.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(r/n.length),c=Math.ceil(r/a.length),u=Math.ceil(r/s.length),d=gt(0,l).flatMap(()=>{let m=St(n,!1,!0);return gt(0,n.length).map(()=>xl(m))}),p=gt(0,c).flatMap(()=>{let m=St(a,!1,!0);return gt(0,a.length).map(()=>xl(m))}),f=gt(0,u).flatMap(()=>{let m=St(s,!1,!0);return gt(0,s.length).map(()=>xl(m))}),h={};for(let m=0;m<r;m++){let A=d.pop(),g=i||Bl([aa,Cs]),v=g===aa?f.pop():p.pop(),b=Bl(o);h[`${v}${A}`]={nationalityCode:b,sex:g,firstName:v,lastName:A}}return{personData:Object.values(h).slice(0,e)}}function yve(t){let e=t?.count||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:s,category:o,sex:l}=t||{};if(Number.isNaN(Number(e)))return{error:be};let c=a?.[aa]||lI(l)&&e||0,u=a?.[Cs]||Hv(l)&&e||0;e=Math.max(e,c+u);let d=e-(c+u),p=c&&DV({count:c,sex:aa}).personData||[],f=u&&DV({count:u,sex:Cs}).personData||[],h=[...p,...f,...d&&DV({count:d}).personData||[]],m=h.filter(T=>!l||c&&u||T.sex===l),A=[];if(Array.isArray(s)){let T=s.filter(D=>typeof D.firstName!="string"||typeof D.lastName!="string"||D.sex&&![aa,Cs].includes(D.sex)||D.nationalityCode&&(typeof D.nationalityCode!="string"||D.nationalityCode.length>3||!ng.some(({iso:C,ioc:E})=>[C,E].includes(D.nationalityCode)))?!1:(D.nationalityCode&&A.push(D.nationalityCode),!0));if(T.length)m=T;else return{error:be}}let g=s?m:To(m);if(g.length<e){let{maleFirstNames:T,maleLastNames:D,femaleFirstNames:C,femaleLastNames:E,nationalityCodes:P}=h.reduce((R,M)=>{let{firstName:N,lastName:k,nationalityCode:O}=M;return M.sex===aa?(R.maleFirstNames.includes(N)||R.maleFirstNames.push(N),R.maleLastNames.includes(k)||R.maleLastNames.push(k)):(R.femaleFirstNames.includes(N)||R.femaleFirstNames.push(N),R.femaleLastNames.includes(k)||R.femaleLastNames.push(k)),R.nationalityCodes.includes(O)||R.nationalityCodes.push(O),R},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});gt(0,e-g.length).forEach(()=>{let R=l||Bl([aa,Cs]),M=Bl(P),N=Bl(R===aa?T:C),k=Bl(R===aa?D:E),O={firstName:N,lastName:k,sex:R,nationalityCode:M};g.push(O)})}let{ageMinDate:v,ageMaxDate:b}=yy({consideredDate:r,category:o}),y=ri(v?.slice(0,4)||0)||ri(b?.slice(0,4)||0)-3,I=ri(b?.slice(0,4)||0)||ri(v?.slice(0,4)||0)+3,w=(v||b)&&[y,I],S=g.slice(0,e).map((T,D)=>{let[C,E]=w||[],P=w&&xl(gt(C,E)),R=xl(gt(0,365)),M=P&&uFe(P,R);return Object.assign(Ft({extensions:i||[{name:"regionCode",value:D+1}],birthDate:M,isMock:n}),T)});return{persons:S.length&&S||g[0],nationalityCodes:A}}var N4e=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function e_({nameRoot:t="TEAM",count:e=1}={}){let i=To(N4e).slice(0,e);return i.length<e&&gt(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function nE(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=za,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:s,categories:o,category:l,nationalityCodesCount:c,nationalityCodeType:u,nationalityCodes:d,participantsCount:p=32,participantType:f,teamSize:h=8,personIds:m,idPrefix:A,uuids:g,personExtensions:v,addressProps:b,gendersCount:y,matchUpType:I,personData:w,sex:S,inContext:T,withISO2:D,withIOC:C,scaleAllParticipants:E}=t,P=f===Mi||I===Ay,R=f===gr||I===gr;i&&(!Array.isArray(i)||!i.every(Oe=>Sn(Oe))||i.length!==2)&&(i=void 0),e=E?p:e;let M=1e3,N=e&&e>M?e:M;i=i||[1,N],i[1]+=1;let k=p*(P&&2||R&&(h??8)||1),O=yve({count:k,personExtensions:v,consideredDate:s,gendersCount:y,personData:w,category:l,sex:S});if(O.error)return O;let{nationalityCodes:x,persons:F}=O,_={},V={},G={},z={},Q=Oe=>{Object.assign(_,Oe.doublesRankings),Object.assign(V,Oe.singlesRankings),Object.assign(z,Oe.doublesRatings),Object.assign(G,Oe.singlesRatings)};if(Ki(l)){let Oe=Hee({scaledParticipantsCount:e,ratingsParameters:r,participantType:f,ratingsValues:a,rankingRange:i,category:l});Q(Oe)}Array.isArray(o)&&o.forEach(Oe=>{let mt=Hee({scaledParticipantsCount:e,ratingsParameters:r,participantType:f,ratingsValues:a,rankingRange:i,category:Oe});Q(mt)});let j=ng.filter(Oe=>u==="IOC"&&Oe.ioc||Oe.iso);function W(Oe){let mt=Math.ceil(k/Oe);return n&&mt>n?Math.ceil(k/n):Oe}let{postalCodesProfile:Y,postalCodesCount:X,statesProfile:J,citiesProfile:ie,citiesCount:ue,statesCount:ne}=b||{},ge=Oe=>Object.keys(Oe).map(mt=>gt(0,J[mt]).map(()=>mt)).flat(),he=ie&&ge(ie)||b?.cities||mve({count:ue||k,participantsCount:k}).cities,Ie=J&&ge(J)||b?.states||Ave({count:ne||k,participantsCount:k}).states,xe=Y&&ge(Y)||b?.postalCodes||gve({count:X||k,participantsCount:k}).postalCodes,Je={cities:he,states:Ie,postalCodes:xe},qe=W(c),dt=qe?To(j).slice(0,c):d&&j.filter(Oe=>d.includes(Oe.iso))||j,ft=To(gt(0,Math.ceil(k/(qe||1))).map(()=>dt).flat(1/0)),je=e_({count:p}).names;return{participants:gt(0,p).map(Oe=>{let mt=P&&2||R&&(h??8)||1,Le=gt(0,mt).map(ct=>{let We=Oe*mt+ct;return Tt(We)}),lt=Le.map(ct=>ct.participantId),it=Le.map(ct=>ct.person.standardFamilyName).join("/"),Fe=P?Mi:gr,Xe={participantId:Jx({participantType:Fe,index:Oe,idPrefix:A,uuids:g}),participantName:P?it:je[Oe],participantRole:Ns,individualParticipantIds:lt,participantType:Fe};return T&&(Xe.individualParticipants=Le),P||R?[Xe,...Le]:Le}).flat(),...se};function Tt(Oe){let mt=F[Oe],{nationalityCode:Le,participantExtensions:lt,participantTimeItems:it,extensions:Fe,firstName:Xe,birthDate:ct,lastName:We,personId:ht,sex:xt}=mt||{},pe=Xe||"GivenName",Se=We||"FamilyName",ye=`${pe} ${Se}`,ke=ft[Oe],Ce=x?.length&&Le||ke&&(u==="IOC"?ke.ioc||ke.iso:ke.iso||ke.ioc)||Le;ft?.length&&!Ce&&!Le&&console.log("%c Invalid Nationality Code",{participantIndex:Oe,country:ke});let Ke=vve({...Je,participantIndex:Oe,nationalityCode:Ce}),_e=Ft({participantId:Jx({participantType:zi,index:Oe,idPrefix:A,uuids:g}),extensions:lt,timeItems:it,participantRole:Ns,participantType:zi,participantName:ye,person:{personId:ht||m?.length&&m[Oe]||fr(),birthDate:Co(ct)?ct:void 0,addresses:[Ke],standardFamilyName:Se,standardGivenName:pe,nationalityCode:Ce,extensions:Fe,sex:xt}});if(C&&Ce){let ut=ng.find(({iso:Ct})=>Ct===Ce);ut?.ioc&&(_e.person.iocNationalityCode=ut.ioc),ut?.label&&(_e.person.countryName=ut.label)}if(D&&Ce){let ut=ng.find(({iso:Ct})=>Ct===Ce);ut?.iso2&&(_e.person.iso2NationalityCode=ut.iso2),ut?.label&&(_e.person.countryName=ut.label)}let wt=ut=>{let Ct=ut.categoryName||ut.ratingType||ut.ageCategoryCode,Gi=V[Ct]?.[Oe],Wt=_[Ct]?.[Oe];iB({scaleValue:Gi,eventType:$I,scaleType:ug,participant:_e,category:ut}),iB({scaleValue:Wt,eventType:Bm,scaleType:ug,participant:_e,category:ut});let Ji=G[Ct]?.[Oe],$i=z[Ct]?.[Oe];iB({scaleValue:Ji,eventType:$I,scaleType:rg,participant:_e,category:ut}),iB({scaleValue:$i,eventType:Bm,scaleType:rg,participant:_e,category:ut})};return Array.isArray(o)?o.forEach(ut=>wt(ut)):l&&wt(l),_e}}function iB({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,s=[Sy,r,i,a].join("."),o={itemValue:t,itemType:s};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(o))}function Hee(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,s=e.rankingRange||t.rankingRange||[1,1e3],o={},l={},c={},u={},{categoryName:d,ageCategoryCode:p,ratingType:f}=e,h=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!f){let[m,A]=s||[];if(l[h]=To(gt(m,A)).slice(0,i||Xc(20,30)),[Mi,gr].includes(n)){let[g,v]=s||[];o[h]=To(gt(g,v)).slice(0,i||Xc(20,30))}}if(f&&r[f]){let{ratingMax:m,ratingMin:A,ratingAttributes:g}=e,v={...r[f],...g||{}},{attributes:b={},decimalsCount:y,accessors:I,range:w,step:S}=v,T=R=>{let M={},N=Object.keys(R||{});for(let k of N){let O=R[k];if(typeof O=="object"&&O.generator){let{range:x}=O,[F,_]=x.slice().sort();M[k]=Xc(F,_)}else M[k]=O}return M},D=w[0]>w[1]?2:.7,[C,E]=w.slice().sort(),P=gt(0,2e3).map(()=>Yce(C,E,D,S,y)).filter(R=>(!m||R<=m)&&(!A||R>=A)).slice(0,i||Xc(20,30)).map(R=>I?Object.assign({},...I.map(M=>({[M]:R})),T(b)):R);c[h]=[...a,...P],[Mi,gr].includes(n)&&(u[h]=[...a,...P])}return{singlesRankings:l,doublesRankings:o,singlesRatings:c,doublesRatings:u}}function h6(t){let{alternatesCount:e=0,tieFormatName:i,drawSize:r}=t,n=0,a=0,s=0,o=0,l={},c={[aa]:0,[Cs]:0,[Dw]:0,[pm]:0,ANY:0};(Ki(t.tieFormat)?t.tieFormat:Nm({namedFormat:i}))?.collectionDefinitions?.filter(Boolean).forEach(f=>{let{category:h,collectionId:m,matchUpType:A,matchUpCount:g,gender:v}=f;if(rf(v)){let b=Ws(v),y=g*(A===yr?2:1);b&&c[b]<y&&(c[b]=y)}else Uc(v)&&(c[aa]<g&&(c[aa]=g),c[Cs]<g&&(c[Cs]=g));if(h){let b=JSON.stringify(h);l[b]=h}if(m||(f.collectionId=fr()),$n(yr)(A)){let b=g;o+=g,n=Math.max(n,b)}if($n(Er)(A)){let b=g;s+=g,a=Math.max(a,b)}});let u=Object.keys(l).length?Math.max(s,o*2):Math.max(a,n*2),d=n*(r+e),p=a*(r+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:u,genders:c}}function B4e({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=zi}=t||{},a=r||0,s={[Cs]:0,[Dw]:0,[pm]:0,[aa]:0,ANY:0},o=0,l=0,c=0,u=0,d=0,p=({alternatesCount:h=0,uniqueParticipants:m,tieFormatName:A,drawSize:g=0,eventType:v,tieFormat:b,category:y,gender:I,stage:w})=>{let S=v===uu,T=v===ca,D=!!(m||w===zt||y||I);if(T){u=Math.max(u,g+h),b=typeof b=="object"?b:Nm({namedFormat:A});let{teamSize:C,maxDoublesDraw:E,maxSinglesDraw:P,genders:R}=h6({alternatesCount:h,tieFormatName:A,tieFormat:b,drawSize:g});c=Math.max(c,C),l=Math.max(l,P),D||(o=Math.max(o,E)),Object.keys(R).forEach(M=>s[M]+=R[M])}else if(S)if(D){let C=(g+h)*2;d+=C,I&&(s[I]+=C)}else g+h&&g+h>o&&(o=g+h);else if(D){let C=g+h;I&&(s[I]+=C),d+=C}else g&&g>l&&(l=g+h)};if(e?.forEach(h=>{let{tieFormatName:m,tieFormat:A,drawProfiles:g,eventType:v,category:b,gender:y}=h;if(g)for(let I of g){let{tieFormatName:w,tieFormat:S}=I;p({...I,tieFormatName:w||m,tieFormat:S||A,eventType:v,category:b,gender:y})}}),Array.isArray(i))for(let h of i)p(h);let f=Math.max(u*c,o*2,l);return o&&(n=Mi),(r||a)<f&&(r=f),r&&o&&[Mi,ca].includes(n)&&(l&&Math.floor(l/2)>o?r=Math.floor(l/2):(!l||o*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!e?.length&&!i?.length?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:u,largestTeamSize:c,participantType:n,gendersCount:s}}function bve({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if(t?.participantsCount===0)return{addedCount:0,...se};let{participantsCount:s,participantType:o,largestTeamDraw:l,largestTeamSize:c,gendersCount:u}=B4e({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t?.teamKey,p=nE({consideredDate:n,...t,participantsCount:s,participantType:o,gendersCount:u,uuids:a}).participants,f=0,h=Id({tournamentRecord:e,participants:p});if(h.error)return h;if(f+=h.addedCount,d){let v=f6({tournamentRecord:e,...d});if(v.error)return v}let m=p.filter(({participantType:v})=>v===zi).map(ji),A=t?.idPrefix?`${gr}-${t.idPrefix}`:void 0,g=gt(0,l).map(v=>{let b=m.slice(v*c,(v+1)*c),y=Jx({index:v,participantType:o,idPrefix:A,uuids:a});return{participantName:`Team ${v+1}`,participantRole:Ns,individualParticipantIds:b,participantType:gr,participantId:y}});return h=Id({participants:g,tournamentRecord:e}),h.error?h:(f+=h.addedCount,{addedCount:f,...se})}function Ive({drawProfiles:t,category:e,gender:i}){let r={},n=t?.reduce((s,o)=>{let{qualifyingPositions:l=0,participantsCount:c=0,uniqueParticipants:u,stage:d=Ut,drawSize:p=0}=o||{};Object.keys(s).includes(d)||(s[d]=0);let f=(c||p)-l;return u||i||e||d===zt?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=f):s[d]=Math.max(s[d],f),s},{}),a=Object.keys(r);return a.forEach(s=>n[s]+=r[s]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function wve({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[Ut]||0,a=e[zt]||0;return{stageParticipants:{QUALIFYING:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(0,a),MAIN:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(a,a+n)}}}var k4e={[Xr]:2,[mn]:1,[ha]:1,[Fa]:1,[Mr]:4};function m6(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=k4e,matchUpFormat:n=td,pointsPerMinute:a=1,sideWeight:s=4}=t;if(!Ql({matchUpFormat:n}))return{error:oq};if(typeof r!="object")return{error:be};if(e>100&&(e=100),Number.isNaN(Number(e))||Number.isNaN(Number(a))||Number.isNaN(Number(s)))return{error:be};let o=Object.keys(r).filter(C=>Object.keys(pW).includes(C)&&C!==Ln);if(Object.keys(o).reduce((C,E)=>C+r[E],0)>100)return{error:be,matchUpStatusProfile:r};let l=o.reduce((C,E)=>(C.pointer=C.pointer+r[E],C.valueMap.push([C.pointer,E]),C),{pointer:0,valueMap:[]}),c=Xc(1,100),u=(l.valueMap.find(C=>c<=C[0])??[100,Ln])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if(Ms(u)){i=i||Xc(1,2);let C={score:d,matchUpStatus:u,winningSide:i};if(!(u===Mr&&Xc(1,100)>100-e))return{outcome:C}}else if([mn,ha].includes(u))return{outcome:{score:d,matchUpStatus:u}};let p=vs(n),{bestOf:f=1,exactly:h,setFormat:m,finalSetFormat:A}=p??{},g=[],v=Xc(0,1),b=i?[i-1]:[...gt(0,s).map(()=>v),1-v],y=[Fa,Mr,Wl,jg].includes(u)&&(xl(gt(1,h||f))||1),I,w=gt(1,(h??f)+1);for(let C of w){let E=C===(h??f),{set:P,incomplete:R,winningSideNumber:M}=x4e({setFormat:E&&A||m,incomplete:y===C,pointsPerMinute:a,matchUpStatus:u,weightedRange:b,setNumber:C});if(g.push(P),R){I=M;break}if(bP({matchUp:{score:{sets:g},matchUpFormat:n}}).calculatedWinningSide)break}let S=bP({matchUp:{score:{sets:g},matchUpFormat:n,winningSide:i}}),T=I?i||I:S.calculatedWinningSide,{score:D}=nve({winningSide:T,score:{sets:g},matchUpStatus:u});return{outcome:{winningSide:T,matchUpStatus:u,score:D}}}function x4e({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let s={setNumber:a},{setTo:o,tiebreakFormat:l,tiebreakAt:c,tiebreakSet:u,timed:d,minutes:p}=n,f=Xc(0,t.length-1),h=t[f],m;if(d){let A=p*e,g=Math.round(A*.2),v=A+xl([1,-1])*g,b=z_e(v,2),y=[b,v-b];h&&y.reverse(),m=t[f]+1;let I=y[0]>y[1]&&1||y[1]>y[0]&&2||0;if(r){let[T,D]=y;return Object.assign(s,{side1Score:T,side2Score:D}),qn.includes(i)?{set:s,incomplete:r,winningSideNumber:m}:{set:s,incomplete:r}}I||(y[Xc(0,1)]+=1),I=y[0]>y[1]?1:2,I!==m&&y.reverse();let[w,S]=y;return Object.assign(s,{side1Score:w,side2Score:S,winningSide:m}),{set:s}}else{if(r)return s.side1Score=Xc(0,c),s.side2Score=Xc(0,c),qn.includes(i)&&(m=t[f]+1),{set:s,incomplete:r,winningSideNumber:m};{let A=gt(1,o+1).flatMap(S=>gt(0,o+2-S).map(()=>S)),g=A[Xc(0,A.length-1)],v=o&&Y5({isSide1:!0,tiebreakAt:c,lowValue:g,setTo:o}),b=!v,y=t.length===1&&t[f]+1;if(!b){y?(v[0]>v[1]?1:2)!==y&&v.reverse():h&&v.reverse();let[S,T]=v;Object.assign(s,{side1Score:S,side2Score:T})}let I=vP({matchUpScoringFormat:{setFormat:n},setObject:s}),w;if(I.hasTiebreakCondition||b){let{NoAD:S,tiebreakTo:T}=l||u||{},D=gt(1,T+1).flatMap(P=>gt(0,T+2-P).map(()=>P)),C=D[Xc(0,D.length-1)],E=gL({isSide1:!0,tiebreakNoAd:S,tiebreakTo:T,lowValue:C});if(E)if(b){let P=E[0]>E[1]?1:2;y?P!==y&&E.reverse():h&&E.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=E,w=E[0]>E[1]&&1||E[1]>E[0]&&2||void 0}else I.leadingSide===2?[s.side1TiebreakScore,s.side2TiebreakScore]=E:[s.side2TiebreakScore,s.side1TiebreakScore]=E}s.winningSide=I.winningSide||I.leadingSide||y||w}}return{set:s}}function _4e({firstRoundDualMatchUps:t,event:e,tournamentRecord:i,drawDefinition:r}){let n=e?.category?.ageCategoryCode||e?.category?.categoryName;if(n){let d=_ge({singlesOnly:!0,tournamentRecord:i,drawDefinition:r,scaleAccessor:{scaleName:n,sortOrder:"ASC",scaleType:ug},event:e});if(d.error)return d;let{lineUps:p,participantsToAdd:f}=d;Id({tournamentRecord:i,participants:f}),lr({element:r,extension:{name:xm,value:p}});return}let a=t[0]?.structureId,{positionAssignments:s}=Ir({drawDefinition:r,structureId:a});if(!s?.length)return;let{participants:o}=gn({participantFilters:{participantTypes:[$r]},tournamentRecord:i});function l(d){return o?.find(p=>{let{participantId:f}=p;return s.find(h=>h.participantId===f)?.drawPosition===d})}function c(d,p,f){d.sides.forEach(h=>{let{drawPosition:m}=h,A=l(m);if(A){let g=A.individualParticipantIds?.[p];g&&Zx({teamParticipantId:A.participantId,participantId:g,tournamentRecord:i,drawDefinition:r,tieMatchUpId:f,event:e});return}})}function u(d,p,f){d.sides.forEach(h=>{let{drawPosition:m}=h,A=l(m);A&&A.individualParticipantIds?.slice(p*2,p*2+2)?.forEach(g=>{Zx({teamParticipantId:A.participantId,participantId:g,tournamentRecord:i,drawDefinition:r,tieMatchUpId:f,event:e})})})}t.forEach(d=>{let p=d.tieMatchUps.filter($n(Er)),f=d.tieMatchUps.filter($n(yr));p.forEach((h,m)=>{let A=h.matchUpId;c(h,m,A)}),f.forEach((h,m)=>{let A=h.matchUpId;u(h,m,A)})})}function O4e({structure:t,matchUpsMap:e,drawDefinition:i,tournamentRecord:r,event:n,matchUpStatusProfile:a,matchUpFormat:s,matchUpStatus:o,scoreString:l,randomWinningSide:c,completionGoal:u,completedCount:d}){let p=cr({contextFilters:{matchUpTypes:[yr,Er]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:i,matchUpsMap:e,structure:t,event:n}).matchUps.filter(({winningSide:f})=>!f).sort(Lw).map(xa);for(let f of p){if(!Number.isNaN(Number(u))&&d.value>=u)break;let{matchUps:h}=cr({matchUpFilters:{matchUpTypes:[yr,Er]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:i,matchUpsMap:e,structure:t,event:n}),m=h.find(g=>g.matchUpId===f),A=[mn,ha].includes(m.matchUpStatus);if(m?.readyToScore&&!A){let g=F4e({matchUpStatusProfile:a,tournamentRecord:r,drawDefinition:i,targetMatchUp:m,matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:!c&&1,event:n});if(g?.error)return g;d.value+=1}}}function t_(t){let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:r,tournamentRecord:n,completionGoal:a,drawDefinition:s,event:o}=t;if(!s)return{error:Bt};let l=t.matchUpFormat||s.matchUpFormat||o?.matchUpFormat,c=s.structures.slice().sort(Nw),u={value:0},{matchUps:d,matchUpsMap:p}=ea({matchUpFilters:{matchUpTypes:[$r],roundNumbers:[1]},contextFilters:{stages:[Ut,zt]},inContext:!0,drawDefinition:s});if(d?.length){let g=_4e({firstRoundDualMatchUps:d,event:o,tournamentRecord:n,drawDefinition:s});if(g?.error)return g}let f=typeof i=="string"&&i,h=f&&Ln,m=c.length===2&&c[0].finishingPosition===wy&&Pn(c.map(({stage:g})=>g),[Ut,Tn]).length===2,A=c.map(({structureId:g})=>g);for(let g of A){if(u.value>=a)break;let v=s.structures.find(y=>y.structureId===g),b=O4e({structure:v,matchUpsMap:p,drawDefinition:s,tournamentRecord:n,event:o,matchUpStatusProfile:e,matchUpFormat:l,matchUpStatus:h,scoreString:f,randomWinningSide:r,completionGoal:a,completedCount:u});if(b?.error)return b;m&&v.finishingPosition===wy&&t.completeRoundRobinPlayoffs&&qC({structureId:v.structureId,applyPositioning:!0,drawDefinition:s})}return{...se,completedCount:u.value}}function Sve(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:s,matchUpFormat:o,scoreString:l,winningSide:c,event:u}=t;if(!a||a.matchUpStatus==="BYE")return;let{matchUpId:d}=a||{},{outcome:p}=l6({matchUpFormat:o,matchUpStatus:s,scoreString:l,winningSide:c});return e&&(p.matchUpStatusCodes=e),$R({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:u})}function F4e(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:s,targetMatchUp:o,scoreString:l,winningSide:c,event:u}=t;if(l||a)return Sve(t);let{matchUpId:d}=o||{},{outcome:p}=m6({matchUpStatusProfile:e,matchUpFormat:s,winningSide:c});return $R({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:u})}function Uve({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:s}){let o=Bn({event:s}).flightProfile,{eventName:l,eventType:c,category:u}=s,{startDate:d}=r,p=[],f=u?.categoryName||u?.ageCategoryCode||u?.ratingType,h=s.drawDefinitions?.map(({drawId:m})=>m);if(Array.isArray(o?.flights))for(let[m,A]of o.flights.entries()){let{drawId:g,stage:v,drawName:b,drawEntries:y}=A;p.push(A.drawId);let I=n[m],{seedsCount:w,generate:S=!0}=I||{};if(S){let T=y.filter(Kl(yh)).map(Kl(yh)),D=f||l;if(r&&w&&w<=T.length&&gt(1,w+1).forEach((M,N)=>{let k={scaleValue:M,scaleName:D,scaleType:eh,eventType:c,scaleDate:d},O=T[N];RR({tournamentRecord:r,participantId:O,scaleItem:k})}),h?.includes(g))break;let C=FR({...I,matchUpType:c,seedingScaleName:D,tournamentRecord:r,drawEntries:y,drawName:b,drawId:g,isMock:a,event:s,stage:v});if(C.error)return{error:C.error,drawIds:[]};let{drawDefinition:E}=C;if(!E)return{error:Ec};let P=n[m]?.drawExtensions;if(Array.isArray(P)&&P.filter(of).forEach(M=>lr({element:E,extension:M})),C=LR({suppressNotifications:!0,tournamentRecord:r,drawDefinition:E,event:s}),C.error)return{error:C.error,drawIds:[]};if(I?.withPlayoffs){let M=E.structures?.[0].structureId,N=nL({idPrefix:I.idPrefix,...I.withPlayoffs,tournamentRecord:r,drawDefinition:E,structureId:M,isMock:a,event:s});if(N?.error)return N}let R=I?.completionGoal;if(I?.automated!==!1&&(e||R)){let M=I?.matchUpFormat,N=t_({completeAllMatchUps:!R&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:R,drawDefinition:E,matchUpFormat:M,event:s});if(N.error)return{error:N.error,drawIds:[]};let k=N.completedCount;if(I?.drawType===vh){let O=E.structures?.find(_=>_.stage===Ut);if(!O)return{error:nn};let x=qC({structureId:O.structureId,tournamentRecord:r,drawDefinition:E});if(x.error)return{error:x.error,drawIds:[]};let F=R?R-(k??0):void 0;if(x=t_({completeAllMatchUps:!R&&e,completionGoal:R?F:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:E,matchUpFormat:M,event:s}),x.error)return{error:x.error,drawIds:[]}}}}}return{...se,drawIds:p}}function Tve(t){let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:r,tournamentRecord:n,eventProfile:a,eventIndex:s,event:o,uuids:l}=t,{category:c,gender:u,eventType:d}=o,p=$n(af)(d)&&zi||$n(uu)(d)&&Mi||d,f=i[Ut]||0,h=i[zt]||0,m=a.drawProfiles?.length?f+h:a.participantsProfile?.participantsCount??0,A=rf(u)?u:void 0,g=e?.idPrefix?`E-${s}-${e?.idPrefix}`:void 0,{participants:v}=nE({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n?.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:m,ratingsParameters:r,category:c,idPrefix:g,sex:A}),b=Id({tournamentRecord:n,participants:v});if(b.error)return b;let y=v?.filter(({participantType:w})=>w===p),I=v?.map(ji);return{uniqueDrawParticipants:y,uniqueParticipantIds:I}}function L4e({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=jp,qualifyingPositions:s=0,stage:o=Ut,drawSize:l=0,drawName:c,drawId:u}=r,d=l-s,p=i.slice(0,d).map(ji);if(p.length){let m=zp({participantIds:p,autoEntryPositions:t,entryStage:o,tournamentRecord:e,event:n});if(m.error)return m}let f=p.map(m=>({entryStatus:Il,entryStage:o,participantId:m})),h=_L({drawName:c||a,qualifyingPositions:s,drawEntries:f,drawId:u,event:n,stage:o});return h.error?h:{...se}}function Cve({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:s,event:o}){let l=0;for(let c of n){let{qualifyingPositions:u=0,uniqueParticipants:d,stage:p=Ut,drawSize:f=0}=c,h=f-u,m=d||s||a||p===zt,A=m?t.slice(l,l+h):i[p||Ut]||[];m&&(l+=h);let g=L4e({autoEntryPositions:e,drawParticipants:A,tournamentRecord:r,drawProfile:c,event:o});if(g.error)return g}return{...se}}function Eve(t){let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,publish:p,isMock:f,uuids:h}=t,m=u.gender,A=u.eventName,{eventType:g=af,policyDefinitions:v,drawProfiles:b=[],eventExtensions:y,surfaceCategory:I,tieFormatName:w,processCodes:S,discipline:T,eventLevel:D,timeItems:C,ballType:E,category:P}=u,R=u.eventId||fr(),M=u.tieFormat||(g===ca?Nm({namedFormat:w,event:{eventId:R,category:P,gender:m},hydrateCollections:s,isMock:f}):void 0),N=c.participants;for(let J of b)!m&&J.gender&&(m=J?.gender);let{stageParticipantsCount:k,uniqueParticipantsCount:O,uniqueParticipantStages:x}=Ive({drawProfiles:b,category:P,gender:m}),F=$n(af)(g)&&zi||$n(uu)(g)&&Mi||g,{uniqueDrawParticipants:_=[],uniqueParticipantIds:V=[]}=x?Tve({event:{eventType:g,category:P,gender:m},uniqueParticipantsCount:O,participantsProfile:r,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,uuids:h}):{},{eventAttributes:G}=u;typeof G!="object"&&(G={});let z=P?.categoryName||P?.ageCategoryCode||P?.ratingType;A=A||z||"Generated Event";let Q={...G,surfaceCategory:I,processCodes:S,discipline:T,eventLevel:D,eventName:A,eventType:g,tieFormat:M,ballType:E,category:P,eventId:R,gender:m};if(y?.length&&Array.isArray(y)){let J=y.filter(of);J?.length&&Object.assign(Q,{extensions:J})}if(Array.isArray(C)&&C.forEach(J=>zw({event:Y,timeItem:J})),typeof v=="object")for(let J of Object.keys(v))Dy({policyDefinitions:{[J]:v[J]},event:Q});Q.category&&(Q.category.categoryName=z);let j,W=ZC({suppressNotifications:!1,internalUse:!0,tournamentRecord:c,event:Q});if(W.error)return W;let Y=W?.event,{stageParticipants:X}=wve({allUniqueParticipantIds:e,stageParticipantsCount:k,eventParticipantType:F,targetParticipants:N});if(b?.length){let J=Cve({uniqueDrawParticipants:_,autoEntryPositions:a,stageParticipants:X,tournamentRecord:c,drawProfiles:b,category:P,gender:m,event:Y});if(J.error)return J;let ie=Uve({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:o,tournamentRecord:c,drawProfiles:b,isMock:f,event:Y});if(ie.error)return ie;j=ie.drawIds}else if(u?.participantsProfile?.participantsCount){let J=_.map(ji);if(J.length){let ie=zp({participantIds:J,autoEntryPositions:a,tournamentRecord:c,entryStage:Ut,event:Y});if(ie.error)return ie}}return p&&eE({tournamentRecord:c,event:Y}),{drawIds:j,eventId:R,uniqueParticipantIds:V}}function A6({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!Co(e))return{error:fa};let n="addSchedulingProfileRound",{extension:a}=Bi({name:QI,tournamentRecords:t,discover:!0}),s=a?.value||[],o=s.find(p=>hh(e,p.scheduleDate));if(!o){let{startDate:p,endDate:f}=bL({tournamentRecords:t}),h=new Date(e);if(p&&h<new Date(p)||f&&h>new Date(f))return{error:fa};o={scheduleDate:e,venues:[]},s.push(o)}let l=o.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},o.venues.push(l));let c=["notBeforeTime"],u=p=>Object.keys(p).filter(f=>!c.includes(f)).sort().map(f=>Ki(p[f])?u(p[f]):p[f]).flat().join("|");if(l.rounds.find(p=>u(p)===u(r)))return le({result:{error:yue},stack:n});l.rounds.push(r);let d=YC({tournamentRecords:t,schedulingProfile:s});return d.error?d:{...se}}function $4e({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:be};let i=$C({tournamentRecord:e}).containedStructures,r=La({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let s of t){let{scheduleDate:o,venues:l=[]}=s;for(let c of l){let{rounds:u,venueId:d}=c;for(let p of u){let{drawId:f,winnerFinishingPositionRange:h,roundSegment:m}=p,A=r.filter(g=>{let v=h?.indexOf("-")>0&&h.split("-").map(y=>+y),b=g.finishingPositionRange?.winner;return g.drawId===f&&(!p.roundNumber||g.roundNumber===p.roundNumber)&&(!b||!v||Pn(b,v).length===2||Ci(b).length===Ci(v).length&&Pn(b,v).length===Ci(b).length)})[0];if(A){let{eventId:g,roundNumber:v,drawName:b,structureName:y,roundName:I}=A,w=A.structureId;v&&!h&&(w=Object.keys(i).find(D=>i[D].includes(w))??w);let S={tournamentId:n,structureId:w,roundNumber:v,roundSegment:m,eventId:g,drawId:f},T=A6({tournamentRecords:{[n]:e},round:S,scheduleDate:o,venueId:d});if(T.error)return T;a.push({structureName:y,roundName:I,drawName:b,...S})}}}}return{scheduledRounds:a}}function YL(t){let e=Gt(t,[{drawProfile:!0,_ofType:pl}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:r={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:s,hydrateCollections:o,randomWinningSide:l,ratingsParameters:c,tournamentRecord:u,isMock:d=!0,drawProfile:p,startDate:f,drawIndex:h,uuids:m}=t,A=St(p,!1,!0),{excessParticipantAlternates:g=!0,matchUpFormat:v=td,drawType:b=jp,tournamentAlternates:y=0,alternatesCount:I=0,qualifyingPositions:w,qualifyingProfiles:S,generate:T=!0,eventExtensions:D,drawExtensions:C,completionGoal:E,tieFormatName:P,buildTeams:R,seedsCount:M,timeItems:N,drawName:k,category:O,idPrefix:x,publish:F,gender:_,stage:V}=A,G=A.drawSize||(A.ignoreDefaults?void 0:32),z=A.eventId||fr(),Q=p.eventType||p.matchUpType||af,j=Q===uu?Mi:zi,W=Ki(p.tieFormat)&&p.tieFormat||Q===gr&&Nm({event:{eventId:z,category:O,gender:_},namedFormat:P,hydrateCollections:o,isMock:d})||void 0,Y=O?.categoryName||O?.ageCategoryCode||O?.ratingType,X=p.eventName||Y||`Generated ${Q}`,J=u?.participants||[],ie=(S?.map(Le=>Le.structureProfiles||[]).flat().reduce((Le,lt)=>{let it=!lt.participantsCount||lt.participantsCount>lt.drawSize?lt.drawSize:lt.participantsCount||0;return Le+it},0)||0)*(j===Mi?2:1),ue=(!p.participantsCount||p.participantsCount>G?G:p.participantsCount)||0,ne={eventName:X,eventType:Q,tieFormat:W,category:O,eventId:z,gender:_};Array.isArray(N)&&N.forEach(Le=>zw({event:ne,timeItem:Le}));let{eventAttributes:ge}=p;if(typeof ge!="object"&&(ge={}),Object.assign(ne,ge),D?.length&&Array.isArray(D)){let Le=D.filter(of);Le?.length&&Object.assign(ne,{extensions:Le})}let he=[];if(r?.participantsCount===0||p.uniqueParticipants||ie||!u||_||O){let Le=(ue||0)+I+ie,lt=Le,it={[aa]:0,[Cs]:0},Fe,Xe;Q===gr&&({teamSize:Fe,genders:Xe}=h6({alternatesCount:I,tieFormatName:P,tieFormat:W,drawSize:G}),Object.keys(Xe).forEach(ht=>{let xt=Ws(ht);xt&&rf(ht)&&Xe[xt]&&(it[xt]=G*Xe[xt])}),lt=Fe*((G||0)+ie));let ct=r?.idPrefix?`D-${h}-${r?.idPrefix}`:void 0,We=nE({...r,scaledParticipantsCount:p.scaledParticipantsCount||r.scaledParticipantsCount,participantsCount:lt,consideredDate:u?.startDate,sex:_||r?.sex,rankingRange:p.rankingRange,uuids:p.uuids||m,ratingsParameters:c,participantType:j,gendersCount:it,idPrefix:ct,category:O}).participants;if(ne.category&&(ne.category.categoryName=Y),u){let ht=Id({participants:We,tournamentRecord:u});if(ht.error)return ht}if(We.forEach(({participantId:ht})=>he.push(ht)),J=We,Q===gr){let ht=Xe[aa]?We.filter(({participantType:ut,person:Ct})=>ut===zi&&Ct?.sex===aa).map(ji):[],xt=Xe[Cs]?We.filter(({participantType:ut,person:Ct})=>ut===zi&&Hv(Ct?.sex)).map(ji):[],pe=We.filter(({participantType:ut})=>ut===zi).map(ji).filter(ut=>!ht.includes(ut)&&!xt.includes(ut)),Se=[...A.teamNames??[],...e_({count:Le}).names],ye=Fe-(Xe[aa]+Xe[Cs]),ke=0,Ce=0,Ke=0,_e=gt(0,Le).map(ut=>{let Ct=xt.slice(ke,ke+Xe[Cs]),Gi=ht.slice(Ce,Ce+Xe[aa]),Wt=pe.slice(Ke,Ke+ye);ke+=Xe[Cs],Ce+=Xe[aa],Ke+=ye;let Ji=R!==!1?[...Ct,...Gi,...Wt]:[];return{participantName:Se[ut]||`Team ${ut+1}`,participantOtherName:`TM${ut+1}`,participantRole:Ns,individualParticipantIds:Ji,participantType:gr,participantId:fr()}}),wt=Id({participants:_e,tournamentRecord:u});if(!wt.success)return wt;J=_e}}let Ie=Le=>{let{participantType:lt}=Le;return $n(af)(Q)&&lt===zi||$n(uu)(Q)&&lt===Mi?!0:Q===gr&&lt===gr},xe=Le=>!p.gender||Le.person?.sex===p.gender?!0:Le.individualParticipantIds?.some(lt=>{let it=J.find(Fe=>Fe.participantId===lt);return it&&xe(it)}),Je=J.filter(Ie).filter(xe).filter(({participantId:Le})=>!i.includes(Le)),qe=Je.slice(0,ue).map(Le=>Le.participantId);if(d&&qe?.length){let Le=zp({autoEntryPositions:s,entryStage:V,tournamentRecord:u,participantIds:qe,event:ne});if(Le.error)return Le}let dt=ie?Je.slice(ue,ue+ie).map(Le=>Le.participantId):0;if(d&&dt?.length){let Le=0,lt=1,it=(Xe,ct)=>Xe.stageSequence-ct.stageSequence,Fe=(Xe,ct)=>Xe.roundTarget-ct.roundTarget;for(let Xe of S.sort(Fe)){lt=Xe.roundTarget||lt;let ct=1,We;for(let ht of Xe.structureProfiles.sort(it)){let xt=(ht.drawSize||Xz(ht.participantsCount))-(We||0),pe=dt.slice(Le,Le+xt),Se=zp({entryStage:zt,entryStageSequence:ct,autoEntryPositions:s,tournamentRecord:u,participantIds:pe,roundTarget:lt,event:ne});if(Se.error)return Se;We=ht.qualifyingPositions,Le+=xt,ct+=1}lt+=1}}let ft=g&&u?.participants?.filter(({participantId:Le})=>!qe.includes(Le)).filter(Ie).filter(xe).slice(0,I||G-ue||y).map(Le=>Le.participantId);if(d&&ft?.length){let Le=zp({participantIds:ft,autoEntryPositions:!1,entryStatus:rd,tournamentRecord:u,event:ne});if(Le.error)return Le.error}let je=Y||X;u&&M&&M<=qe.length&&gt(1,M+1).forEach((Le,lt)=>{let it={scaleName:je,scaleDate:f,scaleType:FW,scaleValue:Le,eventType:Q},Fe=qe[lt];RR({tournamentRecord:u,participantId:Fe,scaleItem:it})});let Tt=FR({...St(p,!1,!0),tournamentRecord:u,seedingScaleName:je,matchUpFormat:v,eventId:z,isMock:d,event:ne});if(Tt.error)return Tt;if(!Tt.drawDefinition)return{error:Ec};let{drawDefinition:Oe}=Tt,mt=Oe.drawId;if(Array.isArray(C)&&C.filter(of).forEach(Le=>lr({element:Oe,extension:Le})),T){if(LR({drawDefinition:Oe,event:ne,suppressNotifications:!0}),p.withPlayoffs){let lt=Oe.structures?.[0].structureId,it=nL({...p.withPlayoffs,tournamentRecord:u,drawDefinition:Oe,structureId:lt,idPrefix:x,isMock:d,event:ne});if(it?.error)return it}let Le=p.automated===!1;if(d&&!Le){let lt=it=>{let Fe=t_({completeAllMatchUps:it.completeAllMatchUps,completionGoal:it.completionGoal,matchUpStatusProfile:n,randomWinningSide:l,tournamentRecord:u,drawDefinition:Oe,matchUpFormat:v,event:ne});if(Fe.error)return Fe;let Xe=Fe.completedCount;if(b===vh){let ct=Oe.structures?.find(xt=>xt.stage===Ut);if(!ct)return{error:nn};qC({structureId:ct.structureId,tournamentRecord:u,drawDefinition:Oe});let We=E?E-(Xe??0):void 0,ht=t_({completionGoal:E?We:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:u,drawDefinition:Oe,matchUpFormat:v,event:ne});if(ht.error)return ht}};if(E&&lt({completionGoal:E}),p.outcomes){let{matchUps:it}=Do({inContext:!0,drawDefinition:Oe,event:ne});for(let Fe of p.outcomes){let{matchUpStatus:Xe=Ln,matchUpStatusCodes:ct,stageSequence:We=1,matchUpIndex:ht=0,structureOrder:xt,matchUpFormat:pe,drawPositions:Se,roundPosition:ye,stage:ke=Ut,roundNumber:Ce,winningSide:Ke,scoreString:_e}=Fe,wt=it?.reduce((Wt,Ji)=>{let{structureId:$i,matchUpId:xi}=Ji;return Wt[$i]?Wt[$i].push(xi):Wt[$i]=[xi],Wt},{})??[],ut=Object.assign({},...Object.keys(wt).map((Wt,Ji)=>({[Wt]:Ji+1}))),Ct=it?.filter(Wt=>(!ke||Wt.stage===ke)&&(!We||Wt.stageSequence===We)&&(!Ce||Wt.roundNumber===Ce)&&(!ye||Wt.roundPosition===ye)&&(!xt||ut[Wt.structureId]===xt)&&(!Se||Pn(Se,Wt.drawPositions).length===2))?.[ht],Gi=Sve({matchUpStatusCodes:ct,tournamentRecord:u,drawDefinition:Oe,targetMatchUp:Ct,matchUpFormat:pe,matchUpStatus:Xe,scoreString:_e,winningSide:Ke});if(Gi?.error)return Gi}}a&&lt({completeAllMatchUps:a})}F&&eE({tournamentRecord:u,event:ne})}else{let Le=_L({drawEntries:Oe.entries,drawName:k||b,qualifyingPositions:w,drawId:mt,event:ne,stage:V});if(Le.error)return Le}return{...se,event:Ft(ne),uniqueParticipantIds:he,targetParticipants:J,drawDefinition:Oe,eventId:z,drawId:mt}}var Dve=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,indoorOutdoor:void 0,floodlit:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),H4e=Dve;function i_(t){return parseInt(t)}function Vee({startTime:t="",endTime:e=""}={}){if(!t||!e||!Vv.test(t)||!Vv.test(e))return!1;let[i,r]=t.split(":").map(i_),[n,a]=e.split(":").map(i_);return n<i?!1:!(i===n&&a<r)}function V4e(t,e){let[i,r]=t.startTime.split(":").map(i_),[n,a]=e.startTime.split(":").map(i_);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function Pve({dateAvailability:t}){if(!t)return{error:kue};if(!Array.isArray(t))return{error:Sk};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:Sk};let{date:n,startTime:a,endTime:s,bookings:o=[]}=r;if(!a||!s)return{error:Sk};if(n&&!nf.test(n))return{error:fa,dateAvailability:{date:n},info:e};if(!Vv.test(a))return{error:ju,dateAvailability:{startTime:a},info:i};if(!Vv.test(s))return{error:ju,dateAvailability:{endTime:s},info:i};if(a===s)return{error:ju,dateAvailability:{startTime:a,endTime:s},info:"startTime and endTime are equivalent"};if(!Vee({startTime:a,endTime:s}))return{error:ju,dateAvailability:{startTime:a,endTime:s},info:"endTime must be after startTime"};if(o){if(!Array.isArray(o))return{error:Tx};for(let l of o){if(typeof l!="object")return{error:Tx};let{startTime:c,endTime:u}=l;if(!Vv.test(c))return{error:ju,booking:{startTime:c},info:i};if(!Vv.test(u))return{error:ju,booking:{endTime:u},info:i};if(c===u)return{error:ju,dateAvailability:{startTime:c,endTime:u},info:"startTime and endTime are equivalent"};if(!Vee({startTime:c,endTime:u}))return{error:ju,dateAvailability:{startTime:c,endTime:u},info:"endTime must be after startTime"}}}}return{valid:!0}}function XL({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=Hh({tournamentRecord:t,venueId:i});if(!a)return{error:tb};a.courts||(a.courts=[]);let s={...Dve(),venueId:i,courtId:r};if(s.courtId||(s.courtId=fr()),a.courts.some(o=>o.courtId===s.courtId))return{error:Zue};{let o=(n?.dateAvailability||[]).map(u=>({...u,date:Si(u.date),startTime:qr(u.startTime),endTime:qr(u.endTime),bookings:u.bookings?.map(({startTime:d,endTime:p,bookingType:f})=>({startTime:qr(d),endTime:qr(p),bookingType:f}))})),l=Object.keys(s);for(let u of l)if(n?.[u])if(u==="dateAvailability"){let d=Pve({dateAvailability:o});if(!d.valid&&d.error)return d;s.dateAvailability=o}else s[u]=n[u];let c=s;return a.courts.push(c),e||bi({payload:{venue:a,tournamentId:t.tournamentId},topic:cA,key:a.venueId}),{...se,court:St(s),venueId:i}}}function g6(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:$g};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let s of Object.values(r)){let{venue:o}=Hh({tournamentRecord:s,venueId:i});if(o){let l=G4e({...t,tournamentRecord:s});for(let c of l?.courts??[])n.push(c?.courtId);if(l.error)return l;a=!0}}return a?{...se,courtIds:n}:{error:tb}}function G4e({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:s,startTime:o,courtIds:l,endTime:c,idPrefix:u,venueId:d,dates:p}){if(!d)return{error:$g};let f=Hh({tournamentRecord:r,venueId:d});if(f.error)return f;let{venue:h}=f;if(!Sn(s)||!n)return{error:Xue};s=s??n.length;let m=gt(0,s).map(A=>{let g=a?.[A],v=g?p.map(b=>({date:ed(b),startTime:o,endTime:c,...g})):e;return g&&o&&c&&v.push({startTime:o,endTime:c}),{courtName:n[A]||i&&h?.venueAbbreviation&&`${h?.venueAbbreviation} ${A+1}`||`${t} ${A+1}`,dateAvailability:v}}).map((A,g)=>{let v=l?.pop()||u&&`${u}-${g+1}`;return XL({disableNotice:!0,tournamentRecord:r,courtId:v,venueId:d,court:A})}).map(A=>A.court).filter(Boolean);return m.length!==s?le({info:"not all courts could be generated",result:{error:be}}):(h&&bi({payload:{venue:h,tournamentId:r.tournamentId},topic:cA,key:h.venueId}),{...se,courts:St(m)})}function v6({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,s=[];for(let[o,l]of i.entries()){let{venueAbbreviation:c,venueId:u=r?.pop()??fr(),dateAvailability:d,startTime:p="07:00",endTime:f="19:00",courtTimings:h,courtsCount:m,courtNames:A,venueName:g,idPrefix:v,courtIds:b}=l,y={venueName:g||`Venue ${o+1}`,venueAbbreviation:c,venueId:u},I=lR({tournamentRecord:t,venue:y});if(I.error){if(e)continue;return I}s.push(u);let w=AT(n,a),S=!Array.isArray(d)&&[{startTime:p,endTime:f}].concat(w.map(T=>({date:ed(T),startTime:p,endTime:f})));if(m||A){let T=g6({dateAvailability:d||S,tournamentRecord:t,courtTimings:h,courtsCount:m,courtNames:A,startTime:p,idPrefix:v,courtIds:b,endTime:f,venueId:u,dates:w});if(T.error)return T}}return s}function Q4e(t){let{tournamentRecord:e,leagueProfiles:i,eventIds:r,venueIds:n,drawIds:a,allUniqueParticipantIds:s,uuids:o}=t,l=0;for(let u of i){let d=[],{tieFormatName:p=Bx,teamProfiles:f=[],teamsCount:h=0,category:m,idPrefix:A,gender:g}=u,v=u.leagueName??u.eventName??`League ${l+1}`,b=u.leagueId??u.eventId??o?.pop()??fr();r.push(b);let y=Ki(u.tieFormat)&&u.tieFormat||Nm({event:{eventId:b,category:m,gender:g},namedFormat:p,isMock:t.isMock})||void 0;if(!y)return{error:PC};let I=Math.max(h,f.length),w=gt(0,I),{genders:S,teamSize:T}=h6({tieFormat:y,drawSize:I}),D={[Cs]:0,[Dw]:0,[pm]:0,[aa]:0,ANY:0};Object.keys(S).forEach(E=>D[E]+=S[E]);for(let E of w){let P=f?.[E]?.teamName??`Team ${E+1}`,R=f?.[E]?.teamId||o?.pop()||fr(),M=u.startDate??t.startDate,N=nE({...u?.participantsProfile,participantsCount:T,consideredDate:M,gendersCount:D,category:m,uuids:o}).participants,k=N.map(G=>G.participantId),O=gr,x=R??Jx({participantType:O,idPrefix:A,index:E,uuids:o});d.push({participantId:x,entryStatus:Il,entryStage:Ut});let F=f?.[E]?.venueIds??[],_={participantId:x,participantRole:Ns,participantName:P,individualParticipantIds:k,participantType:O,homeVenueIds:F};F.forEach(G=>!n.includes(G)&&n.push(G)),s.push(...k,x);let V=Id({participants:[_,...N],tournamentRecord:e});if(V.error)return V}let C={eventName:v,entries:d,eventType:gr,tieFormat:y,category:m,eventId:b,gender:g};if(e.events||(e.events=[]),e.events.push(C),d.length){let E=(Sn(u.roundsCount)&&u.roundsCount)??u.roundsCount===DFe?(I-1)*2:I-1,P=FR({automated:u.automated,tournamentRecord:e,drawType:zl,roundsCount:E,drawSize:I,event:C});if(P.error)return P;let{drawDefinition:R}=P;if(R){let M=R?.drawId;LR({drawDefinition:R,event:C,suppressNotifications:!0}),a.push(M)}}l++}let c=n.map(u=>({venueId:u}));v6({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:c,uuids:o})}var j4e=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function Rve(t){let{startDate:e,endDate:i}=t??{},{tournamentName:r=xl(j4e),ratingsParameters:n=za,tournamentExtensions:a,policyDefinitions:s,schedulingProfile:o,venueProfiles:l,uuids:c}=t??{},u=t?.isMock===!1?void 0:!0;if(e&&!Co(e)||i&&!Co(i))return{error:fa};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:be};if(!e){let v=new Date;e=ed(i??v),i=ed(v.setDate(v.getDate()+7))}if(!i){let v=new Date(e);i=ed(v.setDate(v.getDate()+7))}let d=KL({...t.tournamentAttributes??{},tournamentName:r,startDate:e,endDate:i,isMock:u}),p=l?.length?v6({tournamentRecord:d,venueProfiles:l,uuids:c}):[];if(a?.length&&Array.isArray(a)){let v=a.filter(b=>of({extension:b}));v?.length&&Object.assign(d,{extensions:v,isMock:u})}if(typeof s=="object")for(let v of Object.keys(s))Dy({policyDefinitions:{[v]:s[v]},tournamentRecord:d});if(!t?.leagueProfiles?.length||t.eventProfiles?.length||t.drawProfiles?.length||t.participantsProfile){let v=bve({tournamentRecord:d,...t});if(!v.success)return v}let f=[],h=[],m=[];if(t.leagueProfiles){let v=Q4e({allUniqueParticipantIds:f,tournamentRecord:d,...t,eventIds:h,venueIds:p,drawIds:m});if(v?.error)return v}if(t.drawProfiles){let v=z4e({allUniqueParticipantIds:f,ratingsParameters:n,tournamentRecord:d,...t,eventIds:h,drawIds:m});if(v?.error)return v}if(t.eventProfiles){let v=q4e({allUniqueParticipantIds:f,ratingsParameters:n,tournamentRecord:d,...t,eventIds:h,drawIds:m});if(v?.error)return v}let{scheduledRounds:A=void 0,schedulerResult:g={}}=o?W4e({...t,tournamentRecord:d}):{};return Dq(),Ft({...se,tournamentRecord:d,scheduledRounds:A,schedulerResult:g,eventIds:h,venueIds:p,drawIds:m})}function z4e(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,s=0;for(let o of i){let l=YL({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:o,drawIndex:s,...t});if(l.error)return l;let{drawId:c,eventId:u,event:d,uniqueParticipantIds:p}=l;if(o?.addEvent!==!1){if(l=ZC({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;c&&a.push(c),n.push(u)}p?.length&&r.push(...p),s+=1}}function q4e(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let s of e){let o=Eve({...t,eventIndex:a,eventProfile:s});if(o.error)return o;let{eventId:l,drawIds:c,uniqueParticipantIds:u}=o;c&&n.push(...c),r.push(l),u?.length&&i.push(...u),a+=1}}function W4e(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,s=$4e({schedulingProfile:e,tournamentRecord:i});if(s.error)return s;let o=s.scheduledRounds;if(r){let{tournamentId:l}=i,c={[l]:i};return{schedulerResult:WL({scheduleCompletedMatchUps:a,tournamentRecords:c,periodLength:n}),scheduledRounds:o}}return{scheduledRounds:o}}var Mve={};Fi(Mve,{anonymizeTournamentRecord:()=>Nve,modifyTournamentRecord:()=>kve});function Nve({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){if(!i)return{error:rt};let s=Array.isArray(t)?ZJ.concat(...t):ZJ,o=x=>Array.isArray(t)?x?.extensions?.filter(F=>s.includes(F.name)):x?.extensions,l={};i.extensions=o(i);let c=a||fr();l[i.tournamentId]=c,i.tournamentId=c,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${ed(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let x of i.participants||[]){x.extensions=o(x),x.onlineResources=[];let F=fr();l[x.participantId]=F,x.participantId=F}for(let x of i.participants||[])Array.isArray(x.individualParticipantIds)&&(x.individualParticipantIds=x.individualParticipantIds.map(F=>l[F]));let u=0;for(let x of i.venues||[]){x.venueAbbreviation=`V${u}`,x.extensions=o(x),x.venueName=`Venue #${u}`,x.onlineResources=[],x.addresses=[];let F=fr();l[x.venueId]=F,x.isMock=!0,u+=1;let _=0;for(let V of x.courts||[])V.courtName=`V${u}C${_}`,V.extensions=o(V),V.onlineResources=[],V.isMock=!0,_+=1}let d=1;for(let x of i.events||[]){x.extensions=o(x),x.onlineResources=[],x.isMock=!0;let F=fr();l[x.eventId]=F,x.eventId=F;let _=x.category?.categoryName||x.category?.ageCategoryCode||x.category?.ratingType||x.gender;if(x.eventName=`Event ${d} ${_}`,Array.isArray(x.entries))for(let G of x.entries)G.participantId=l[G.participantId];for(let G of x.drawDefinitions||[]){G.extensions=o(G);let z=fr();if(l[G.drawId]=z,G.drawId=z,G.isMock=!0,Array.isArray(G.entries))for(let j of G.entries)j.participantId=l[j.participantId];let Q=j=>{j.extensions=o(j);let W=fr();l[j.structureId]=W,j.structureId=W;for(let Y of j.positionAssignments||[])Y.participantId&&(Y.participantId=l[Y.participantId]);for(let Y of j.seedAssignments||[])Y.participantId&&(Y.participantId=l[Y.participantId]);for(let Y of j.matchUps||[]){Y.isMock=!0;for(let X of Y.sides||[])X.lineUp&&(X.lineUp=X.lineUp.map(({participantId:J,collectionAssignments:ie})=>({participantId:l[J],collectionAssignments:ie})))}};for(let j of G.structures||[])if(Q(j),Array.isArray(j.structures))for(let W of j.structures)Q(W);for(let j of G.links||[])j.source.structureId=l[j.source.structureId],j.target.structureId=l[j.target.structureId]}let{extension:V}=Bi({name:vd,element:x});Array.isArray(V?.value?.flights)&&V?.value.flights?.forEach(G=>{if(G.drawId=l[G.drawId],Array.isArray(G.drawEntries))for(let z of G.drawEntries)z.participantId=l[z.participantId]}),d+=1}let p=i.startDate||ed(new Date),f=(i.participants||[]).filter(({participantType:x})=>x===zi),h=f.reduce((x,F)=>{let _=F.person?.sex,V=Ws(_);return V&&rf(_)?x[V]+=1:x[pm]+=1,x},{[aa]:0,[Cs]:0,[pm]:0}),m=Object.assign({},...Object.keys(h).map(x=>({[x]:yve({category:{ageCategoryCode:"O18"},count:h[x],personExtensions:[],consideredDate:p,sex:x})?.persons||[]}))),A={[aa]:0,[Cs]:0,[pm]:0},g=f.length,v=f.reduce((x,F)=>{let _=F.person?.addresses?.[0]||{},{city:V,state:G,postalCode:z}=_;return x.cities.includes(V)||x.cities.push(V),x.states.includes(G)||x.states.push(G),x.postalCodes.includes(z)||x.postalCodes.push(z),x},{cities:[],postalCodes:[],states:[]}),b=v.postalCodes.length,y=v.cities.length,I=v.states.length,{cities:w}=mve({count:y||g,participantsCount:g}),{states:S}=Ave({count:I||g,participantsCount:g}),{postalCodes:T}=gve({count:b||g,participantsCount:g}),D={cities:w,states:S,postalCodes:T};f.forEach((x,F)=>{let _=x?.person,V=_?.sex||pm,G=Si(_?.birthDate)?.split("-")[0],z=A[V],Q=m[V][z];if(A[V]+=1,G){let[,j,W]=Q?.birthDate?.split("-")||[],Y=[G,j,W].join("-");Q.birthDate=Y}if(_?.addresses){let j=vve({...D,participantIndex:F,nationalityCode:Q.nationalityCode});Q.addresses=[j]}Q.personId=n?.[F]||fr(),e?(Q.standardFamilyName=Q.lastName,Q.standardGivenName=Q.firstName,x.participantName=`${Q.standardGivenName} ${Q.standardFamilyName}`):(Q.standardFamilyName=_?.standardFamilyName,Q.standardGivenName=_?.standardGivenName),delete Q.firstName,delete Q.lastName,Q.extensions=o(_),x.person=Q,l[_?.personId]=Q.personId}),(i.participants||[]).filter(({participantType:x})=>x===Mi).forEach(x=>{let{individualParticipantIds:F}=x;x.participantName=K4e({individualParticipantIds:F,individualParticipants:f})});let C=(i.participants||[]).filter(({participantType:x})=>x===gr),E=C.length,P=e_({count:E}).names;C.forEach((x,F)=>{x.participantName=P[F]});let R=(i.participants||[]).filter(({participantType:x})=>x===xc),M=R.length,N=e_({count:M,nameRoot:"Group"}).names;R.forEach((x,F)=>{x.participantName=N[F]});let{extension:k}=Bi({element:i,name:QI});Array.isArray(k?.value)&&k?.value.forEach(x=>{x.tournamentId=l[x.tournamentId],x.structureId=l[x.structureId],x.eventId=l[x.eventId],x.drawId=l[x.drawId]});let{extension:O}=Bi({element:i,name:FC});return Array.isArray(O?.value)&&O?.value.forEach(x=>{x.personId=l[x.personId]}),{...se}}function K4e({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r?.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function Y4e({event:t,eventProfile:e,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n}){let{gender:a,category:s,eventType:o}=t,{drawProfiles:l,publish:c}=e,u=$n(af)(o)&&zi||$n(uu)(o)&&Mi||o;if(l){let{stageParticipantsCount:d,uniqueParticipantsCount:p,uniqueParticipantStages:f}=Ive({drawProfiles:l,category:s,gender:a}),{uniqueDrawParticipants:h=[],uniqueParticipantIds:m=[]}=f?Tve({event:{eventType:o,category:s,gender:a},uniqueParticipantsCount:p,participantsProfile:e.participantsProfile,ratingsParameters:e.ratingsParameters,tournamentRecord:i,eventProfile:e,uuids:e.uuids}):{};r.push(...m);let{stageParticipants:A}=wve({targetParticipants:i.participants||[],allUniqueParticipantIds:r,stageParticipantsCount:d,eventParticipantType:u}),g=Cve({uniqueDrawParticipants:h,autoEntryPositions:e.autoEntryPositions,stageParticipants:A,tournamentRecord:i,drawProfiles:l,category:s,gender:a,event:t});if(g.error||(g=Uve({matchUpStatusProfile:e.matchUpStatusProfile,completeAllMatchUps:e.completeAllMatchUps,randomWinningSide:e.randomWinningSide,tournamentRecord:i,drawProfiles:l,isMock:e.isMock,event:t}),g.error))return g;n.push(...g.drawIds)}return c&&eE({tournamentRecord:i,event:t}),se}function Bve(t,e){return t?.find((i,r)=>e.eventIndex!==void 0&&r===e.eventIndex||e.eventName&&i.eventName===e.eventName||e.eventId&&i.eventId===e.eventId)}function X4e({event:t,eventProfile:e,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n,params:a}){return Y4e({event:t,eventProfile:{...e,...a},tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n})}function Z4e({eventProfile:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a,eventIndex:s}){let o=Eve({startDate:e.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,randomWinningSide:a.randomWinningSide,ratingsParameters:t.ratingsParameters,tournamentRecord:e,eventProfile:t,eventIndex:s,uuids:a.uuids});if(o.error)return o;let{eventId:l,drawIds:c,uniqueParticipantIds:u}=o;return c&&n.push(...c),r.push(l),u?.length&&i.push(...u),{eventIndexIncrement:1}}function J4e({eventProfiles:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let s=e.events?.length||0;for(let o of t){let l=Bve(e.events,o);if(l){let c=X4e({event:l,eventProfile:o,tournamentRecord:e,allUniqueParticipantIds:i,drawIds:n,params:a});if(c?.error)return c}else{let c=Z4e({eventProfile:o,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a,eventIndex:s});if(c?.error)return c;s+=c?.eventIndexIncrement||1}}return se}function e3e({drawProfiles:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let s=(e.events||[]).flatMap(o=>o.drawDefinitions?.map(()=>1)||[]).reduce((o,l)=>o+l,0);for(let o of t){let l=YL({startDate:e.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,hydrateCollections:a.hydrateCollections,randomWinningSide:a.randomWinningSide,ratingsParameters:a.ratingsParameters,tournamentRecord:e,drawProfile:o,drawIndex:s,uuids:a.uuids});if(l.error)return l;let{drawId:c,eventId:u,event:d,uniqueParticipantIds:p}=l;if(l=ZC({tournamentRecord:e,event:d,internalUse:!0}),l.error)return l;c&&n.push(c),r.push(u),p?.length&&i.push(...p),s+=1}return se}function t3e({schedulingProfile:t,autoSchedule:e,periodLength:i,tournamentRecord:r}){let n=[],a={};if(t?.length){let s={[r.tournamentId]:r},o=YC({tournamentRecords:s,schedulingProfile:t});if(o.error)return o;if(e){let{tournamentId:l}=r,c={[l]:r};a=WL({tournamentRecords:c,periodLength:i})}}return{scheduledRounds:n,schedulerResult:a}}function kve(t){let{participantsProfile:e={},schedulingProfile:i,tournamentRecord:r,autoSchedule:n,eventProfiles:a,periodLength:s,venueProfiles:o,drawProfiles:l,uuids:c}=t;if(!r)return{error:rt};let u=[],d=[],p=[];a?.forEach(b=>{let y=Bve(r.events,b);y?.gender&&(b.gender=y.gender)});let f=r.participants?.length||void 0;f&&e?.idPrefix&&(e.idPrefix=`${e.idPrefix}-${f}`);let h=bve({startDate:r.startDate,participantsProfile:e,tournamentRecord:r,eventProfiles:a,drawProfiles:l,uuids:c});if(!h.success)return h;if(a){let b=J4e({eventProfiles:a,tournamentRecord:r,allUniqueParticipantIds:u,eventIds:d,drawIds:p,params:t});if(b.error)return b}if(l){let b=e3e({drawProfiles:l,tournamentRecord:r,allUniqueParticipantIds:u,eventIds:d,drawIds:p,params:t});if(b.error)return b}let m=o?.length?v6({tournamentRecord:r,venueProfiles:o}):[],A=t3e({tournamentRecord:r,schedulingProfile:i,autoSchedule:n,periodLength:s});if(A.error)return A;let{scheduledRounds:g,schedulerResult:v}=A;return{totalParticipantsCount:r.participants.length,scheduledRounds:g,schedulerResult:v,...se,eventIds:d,venueIds:m,drawIds:p}}var y6={};Fi(y6,{addDynamicRatings:()=>L5,addIndividualParticipantIds:()=>$L,addParticipant:()=>uf,addParticipants:()=>Id,addPenalty:()=>tye,addPersonRequests:()=>$ve,addPersons:()=>iye,createGroupParticipant:()=>zve,createTeamsFromParticipantAttributes:()=>f6,deleteParticipants:()=>Hw,filterParticipants:()=>fR,findParticipant:()=>jve,getCompetitionParticipants:()=>tK,getPairedParticipant:()=>bd,getParticipantEventDetails:()=>iK,getParticipantMembership:()=>rK,getParticipantScaleItem:()=>zI,getParticipantSchedules:()=>nK,getParticipantSignInStatus:()=>aK,getParticipantTimeItem:()=>PW,getParticipants:()=>gn,getScaleValues:()=>_C,mergeParticipants:()=>eye,modifyIndividualParticipantIds:()=>Hve,modifyParticipant:()=>HL,modifyParticipantName:()=>qve,modifyParticipantOtherName:()=>Gve,modifyParticipantsSignInStatus:()=>Vve,modifyPenalty:()=>Zve,modifyPersonRequests:()=>Fve,mutate:()=>xve,participantScaleItem:()=>rh,query:()=>VAe,regenerateParticipantNames:()=>Qve,removeIndividualParticipantIds:()=>KW,removeParticipantIdsFromAllTeams:()=>WF,removePenalty:()=>Yve,removePersonRequests:()=>Lve,removeRatings:()=>Kve,scaledTeamAssignment:()=>Wve,setParticipantScaleItem:()=>RR,setParticipantScaleItems:()=>Gme,validateLineUp:()=>YF});var xve={};Fi(xve,{addDynamicRatings:()=>L5,addIndividualParticipantIds:()=>$L,addParticipant:()=>uf,addParticipants:()=>Id,addPenalty:()=>tye,addPersonRequests:()=>$ve,addPersons:()=>iye,createGroupParticipant:()=>zve,createTeamsFromParticipantAttributes:()=>f6,deleteParticipants:()=>Hw,findParticipant:()=>jve,mergeParticipants:()=>eye,modifyIndividualParticipantIds:()=>Hve,modifyParticipant:()=>HL,modifyParticipantName:()=>qve,modifyParticipantOtherName:()=>Gve,modifyParticipantsSignInStatus:()=>Vve,modifyPenalty:()=>Zve,modifyPersonRequests:()=>Fve,regenerateParticipantNames:()=>Qve,removeIndividualParticipantIds:()=>KW,removeParticipantIdsFromAllTeams:()=>WF,removePenalty:()=>Yve,removePersonRequests:()=>Lve,removeRatings:()=>Kve,scaledTeamAssignment:()=>Wve,setParticipantScaleItem:()=>RR,setParticipantScaleItems:()=>Gme});function _ve(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function Ove({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:s,endTime:o}=n;return n.requestType===VR&&(a=Si(a),s=qr(s),o=qr(o),a&&s&&o)?{date:a,startTime:s,endTime:o,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=_ve(),t[e].push(n);return{mergeCount:r.length}}function b6(t){let{tournamentRecords:e,personRequests:i}=t,r=Gt(t,[{[Xs]:!0}]);if(r.error)return r;if(!i)return{...se};let n=Object.values(e);for(let a of n){let s=a.participants??[],o=[];for(let l of Object.keys(i))if(dg({tournamentParticipants:s,personId:l})){let c=i[l];c.length&&o.push({personId:l,requests:c})}Object.keys(o).length&&lr({element:a,extension:{value:o,name:FC}})}return{...se}}function Fve(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=Gt(t,[{[Xs]:!0},{requests:!0,[il]:zs,[Dc]:be}]);if(n.error)return n;let a=i.map(({requestId:c})=>c).filter(Boolean),{personRequests:s}=pb({tournamentRecords:e}),o=c=>{s&&(s[c]=s[c].map(u=>{if(!a.includes(u.requestId))return u;let d=i.find(p=>p.requestId===u.requestId);if(d.requestType)return Object.assign(u,d)}).filter(Boolean))};if(r&&s?.[r])o(r);else if(s)for(let c of Object.keys(s))o(c);let l=i.filter(c=>!c.requestId);return l.length&&Ove({personRequests:s,personId:r,requests:l}),b6({tournamentRecords:e,personRequests:s})}function Lve(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,s=Gt(t,[{[Xs]:!0}]);if(s.error)return s;let{personRequests:o}=pb({tournamentRecords:e}),l=u=>{o&&(o[u]=o[u].filter(d=>(!i||d.requestType!==i)&&(!r||d.requestId!==r)&&(!a||d.date!==a)),o?.[u]?.length||delete o[u])},c=!i&&!r&&!n&&!a;if(!c){if(n&&o?.[n])l(n);else if(o)for(let u of Object.keys(o))l(u)}return c||!o||!Object.keys(o).length?Eo({name:FC,tournamentRecords:e,discover:!0}):b6({tournamentRecords:e,personRequests:o})}function $ve(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=Gt(t,[{[Xs]:!0,[xFe]:!0},{requests:!0,[il]:zs,[Dc]:be}]);if(n.error)return n;let{personRequests:a}=pb({tournamentRecords:e}),{mergeCount:s}=Ove({personRequests:a,personId:i,requests:r});return s&&a?b6({tournamentRecords:e,personRequests:a}):{error:be}}function Hve({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return le({result:{error:rt},stack:r});if(!e||!t)return le({result:{error:Kt},stack:r});let n=i.participants||[],a=n.find(f=>f.participantId===e);if(!a)return le({result:{error:On},stack:r});if(![gr,xc].includes(a.participantType))return le({result:{error:ap},context:{participantType:a.participantType},stack:r});let s=t.filter(f=>n.find(h=>h.participantId===f)?.participantType!==zi);if(s.length)return le({result:{error:Fl,invalidParticipantIds:s},stack:r});let o=a.individualParticipantIds||[],l=t.filter(f=>!o.includes(f)),c=o.filter(f=>!t.includes(f)),u=$L({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(u.error)return le({result:u,stack:r});let d=KW({individualParticipantIds:c,groupingParticipantId:e,tournamentRecord:i});if(d.error)return le({result:d,stack:r});let{topics:p}=kc();if(p.includes(Fs)){let f=n.find(({participantId:h})=>h===e);bi({topic:Fs,payload:{tournamentId:i.tournamentId,participants:[f]}})}return{...u,...d}}function Vve({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:rt};if(!Array.isArray(e))return{error:Kt};if(![dP,sfe].includes(i))return{error:be,signInState:i};let r=t.participants||[];if(!r.length)return{error:k1};let n=r.map(ji),a=e.filter(c=>!n.includes(c));if(a.length)return{error:be,context:{invalidParticipantIds:a}};let s=[],o=new Date().toISOString();for(let c of r){let{participantId:u}=c;if(e.includes(u)){let d=T5({duplicateValues:!1,tournamentRecord:t,participantId:u,timeItem:{itemType:Y1,itemValue:i,createdAt:o}});if(d.error)return d;s.push(c)}}let{topics:l}=kc();return s.length&&l.includes(Fs)&&bi({topic:Fs,payload:{tournamentId:t.tournamentId,participants:s}}),{...se}}function Gve({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:rt};if(!e)return{error:ga};let{participant:r}=zg({tournamentRecord:t,participantId:e});if(!r)return{error:On};r.participantOtherName=i;let{topics:n}=kc();return n.includes(Fs)&&bi({topic:Fs,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...se}}function Gee({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),r=m=>/^[a-z]*$/.test(i(m)),n=m=>/^[A-Z]*$/.test(i(m)),a=m=>/^[LAST]{4}/.test(i(m)),s=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),o=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,c=m=>m.toLowerCase().indexOf("f")<0,u=m=>m.indexOf(" ")>0;if(!e)return;let d=u(t)?" ":"",p=kj(e?.standardGivenName??""),f=kj(e?.standardFamilyName??"");if(!t)return`${p}${d}${f}`;l(t)&&!o(t)&&!s(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),f=f.toLowerCase()):n(t)?(p=p.toUpperCase(),f=f.toUpperCase()):a(t)&&(f=f.toUpperCase());let h=`${p}${d}${f}`;return c(t)?h=f:s(t)&&(o(t)?h=`${f},${d}${p}`:h=`${f}${d}${p}`),h}function i3e({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,s=r&&i[r];if(r!==zo&&s){let{personFormat:o,doublesJoiner:l}=s;r===zi&&(e.participantName=Gee({person:a,personFormat:o})),r===Mi&&(e.participantName=n?.map(c=>{let u=t[c]?.person;return Gee({person:u,personFormat:o})}).filter(Boolean).join(l??"/"))}}function Qve({tournamentRecord:t,formats:e}){if(!t)return{error:rt};if(!Ki(e))return{error:Kt};let i=t.participants??[],r=Wce(i,"participantId");for(let n of i)i3e({participant:n,participantMap:r,formats:e});return{...se}}function jve(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,s=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Kt,stack:"publicFindParticipant"};let o,l;for(let c of Object.values(s)){l=c.tournamentId;let u=c.participants||[];if(o=dg({tournamentParticipants:u,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),o)break}return{participant:o,tournamentId:l,...se}}function zve({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=Yfe,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:rt};if(!a)return{error:Kt,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:be};let s=(gn({participantFilters:{participantTypes:[zi]},tournamentRecord:r}).participants??[]).map(u=>u.participantId);for(let u of t)if(!s.includes(u))return{error:ap,participantId:u};let o=Ft({participantId:n||fr(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:xc,participantRole:i}),l=uf({participant:o,tournamentRecord:r});if(l.error)return l;let{topics:c}=kc();return c.includes(pg)&&bi({topic:pg,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...se,participant:St(o)}}function qve({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:rt};if(!i)return{error:ga};if(!e)return{error:Kt,info:"Missing participantName"};let{participant:r}=zg({tournamentRecord:t,participantId:i});if(!r)return{error:On};r.participantName=e;let{topics:n}=kc();return n.includes(Fs)&&bi({topic:Fs,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...se}}function Wve({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:s,scaleAttributes:o,teamNameBase:l,teamsCount:c,eventId:u,event:d}){if(!s)return{error:rt};if(!Array.isArray(a)&&!yi(c)&&!u||!yi(r)||n&&!Array.isArray(n)||o&&(typeof o!="object"||!Object.keys(o).length))return{error:be};if(!o&&!n.length||!n&&!(e&&o))return{error:Kt,info:"Missing scaling details"};if(u&&!a){if(d?.eventType!==jl)return{error:ph};a=d?.entries?.filter(({entryStatus:g})=>g===Il).map(ji)}if(!a?.length&&!c)return{info:"Missing teamParticipantIds or teamsCount",error:Kt};let p=e??n.map(({participantId:g})=>g);i&&(a?.reverse(),r+=1),r>(a?.length||0)-1&&(r=0);let f=a?.slice(r).concat(...a.slice(0,r))??[],h=[];for(let g of s.participants??[]){let{participantId:v,participantType:b}=g;if(f.includes(v)){if(b!==zo)return{error:ap,participant:g};h.push(g)}}if(c&&h.length<c){let g=c-(h?.length||0),v=l??"Team",b=gt(0,g).map(S=>({participantName:`${v} ${S+1}`,participantType:zo,participantRole:Ns})),{participants:y=[]}=Id({participants:b,returnParticipants:!0,tournamentRecord:s}),I=y.map(ji),w=s.participants?.filter(({participantId:S})=>I.includes(S))??[];h.push(...w)}if(!h.length)return{error:wq};if(t)for(let g of h)g.individualParticipantIds=[];else{let g=h.map(v=>v).flat();e?.length?p=p.filter(v=>!g.includes(v)):n=n?.filter(({participantId:v})=>!g.includes(v))}if(!e?.length&&!n?.length)return{error:sF,info:"Nothing to be done"};if(!n.length){for(let g of s.participants??[]){let{participantId:v,participantType:b}=g;if(!p.includes(v))continue;if(b!==zi)return{error:ap,participant:g};let y=rh({scaleAttributes:o,participant:g})?.scaleItem,I=o?.accessor?y?.scaleValue?.[o?.accessor]:y?.scaleValue,w={participantId:v,scaleValue:I};n.push(w)}if(!n.length)return{error:On}}n.sort((g,v)=>o?.sortOrder?(v?.scaleValue||0)-(g?.scaleValue||0):(g?.scaleValue||1/0)-(v?.scaleValue||1/0));for(let g of n)if(!g.participantId)return{error:be,scaledParticipant:g};let m=0;for(;m<n.length;){for(let g of h){if(m+1>n.length)break;let v=n[m];g.individualParticipantIds.push(v.participantId),m++}h.reverse()}let A=h.map(ji);for(let g of s.events??[]){if(g.eventType!==jl)continue;let v=(g.entries??[]).filter(b=>A.includes(b.participantId));for(let b of v){let y=b.participantId,I=h.find(S=>S.participantId===y)?.individualParticipantIds;g.entries=(g.entries??[]).filter(S=>!I.includes(S.participantId)),(g.drawDefinitions??[]).forEach(S=>{S.entries=(S.entries??[]).filter(T=>!I.includes(T.participantId))});let{flightProfile:w}=Bn({event:g});(w?.flights||[]).forEach(S=>{S.drawEntries=(S.drawEntries||[]).filter(T=>!I.includes(T.participantId))})}}return{...se,scaledParticipants:n}}function Kve(t){let e=Gt(t,[{[Sa]:!0,[Wq]:!0},{ratingType:!1,[Es]:s=>za[s]}]);if(e.error)return e;let i=`${t.ratingType}.${Zq}`,r=t.asDynamic?i:t.ratingType,n=[Sy,rg,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let s of a)s.timeItems&&(s.timeItems=s.timeItems.filter(o=>o.itemType!==n));return{...se}}function Yve(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:yn};for(let i of Object.values(e)){let r=r3e({...t,tournamentRecord:i});if(r.error&&r.error!==hT)return r}return{...se}}function r3e({tournamentRecord:t,penaltyId:e}){if(!t)return{error:rt};if(!e)return{error:gq};let i=t?.participants??[],r=[],n=!1,a;return i.forEach(s=>{let o=!1;s.penalties=(s.penalties??[]).filter(l=>(l.penaltyId===e&&(o=!0,n||(a=l,n=!0)),o&&r.push(s),l.penaltyId!==e))}),a&&bi({topic:Fs,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...se,penalty:a}:{error:hT}}var n3e=({penaltyId:t=fr()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),Xve=n3e;function Zve(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:yn};for(let i of Object.values(e)){let r=a3e({...t,tournamentRecord:i});if(r.error&&r.error!==hT||r.success)return r}return{error:hT}}function a3e({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:rt};if(!e)return{error:be,modifications:e};if(!i)return{error:gq};let r=t?.participants??[],n=Object.keys(Xve()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:oF};let s,o=[];return r.forEach(l=>{let c=!1;l.penalties=(l.penalties??[]).map(u=>(u.penaltyId===i&&(c=!0,a.forEach(d=>Object.assign(u,{[d]:e[d]})),s||(s=u)),u)),c&&o.push(l)}),s&&bi({topic:Fs,payload:{tournamentId:t.tournamentId,participants:o}}),s?{...se,penalty:s}:{error:hT}}function Jve(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:Ci(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=Ci(t[n].map(s=>JSON.stringify(s)).concat(e[n].map(s=>JSON.stringify(s)))).map(s=>JSON.parse(s));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=Jve(t[n],e[n],i):r[n]=e[n];return r},{})}function eye({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:rt};e.participants||(e.participants=[]);let r=t.filter(Kl(yh)).map(c=>({[c.participantId]:c})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(c=>{if(n[c.participantId]){let u=Jve(c,n[c.participantId],i);return a.push(u),u}return c});let s=e.participants.map(Kl(yh))||[],o=t.filter(({participantId:c})=>!s.includes(c)),{topics:l}=kc();return o.length&&(e.participants=e.participants.concat(...o),l.includes(pg)&&bi({topic:pg,payload:{participants:o}})),a.length&&l.includes(Fs)&&bi({topic:Fs,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:o.length,...se}}function tye(t){let{tournamentRecord:e,participantIds:i}=t,r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n;for(let a of Object.values(r)){let s=(gn({tournamentRecord:a}).participants??[])?.map(ji).filter(o=>i.includes(o));s.length&&(n=s3e({...t,penaltyId:t.penaltyId??n,tournamentRecord:a,participantIds:s}).penaltyId)}return n?{...se,penaltyId:n}:{error:On}}function s3e({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:s,matchUpId:o,issuedAt:l,notes:c}){if(!e)return{error:rt};if(!i)return{error:ga};if(!n)return{error:Yue};let u=(e?.participants??[]).filter(f=>i.includes(f.participantId));if(!u.length)return{error:On};let d=new Date().toISOString(),p=Object.assign(Xve({penaltyId:s}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:o,createdAt:d,issuedAt:l,notes:c});return Array.isArray(a)&&a.forEach(f=>lr({element:p,extension:f})),u.forEach(f=>{f.penalties||(f.penalties=[]),f.penalties.push(p)}),bi({topic:Fs,payload:{tournamentId:e.tournamentId,participants:u}}),{...se,penaltyId:p.penaltyId}}function iye({participantRole:t=Ns,tournamentRecord:e,persons:i}){if(!e)return{error:rt};if(!Array.isArray(i))return{error:be};if(!Object.keys(Yg).includes(t))return{error:Lue};let r=new Set((e.participants||[]).map(({person:h})=>h?.personId).filter(Boolean)),n=[],a=i.filter(h=>h&&(!h.personId||!r.has(h.personId))).map(h=>(h.personId||(h.personId=fr()),n.push(h.personId),h)),s=(h,m)=>Object.assign({},...Object.keys(h).filter(A=>!m.includes(A)).map(A=>({[A]:h[A]}))),o=a.map(h=>Ft({extensions:h.participantExtensions,timeItems:h.participantTimeItems,participantType:zi,participantRole:t,person:s(h,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,c,u=Id({participants:o,tournamentRecord:e});if(u.error)return u;c=u.addedCount||0;let d=[],p=gn({participantFilters:{participantTypes:[zi]},tournamentRecord:e})?.participants??[];if(t===Ns&&i.filter(({pairedPersons:h})=>h).forEach(({personId:h,pairedPersons:m})=>{Array.isArray(m)&&m.forEach(A=>{let g=[h,A.personId].map(v=>dg({tournamentParticipants:p,personId:v})).filter(Boolean);if(g.length===2){let v=g.map(ji);d.push(Ft({extensions:A.participantExtensions,timeItems:A.timeItems,participantRole:Ns,individualParticipantIds:v,participantType:Mi}))}})}),d.length){if(u=Id({participants:d,tournamentRecord:e}),u.error)return u;l=u.addedCount||0}let f=c+l;return{...se,addedCount:f,newPersonIds:n}}var ZL={};Fi(ZL,{bulkUpdatePublishedEventIds:()=>pK,getAllEventData:()=>fK,getCourtInfo:()=>GF,getDrawData:()=>oL,getEventData:()=>ER,getEventPublishStatus:()=>Su,getPublishState:()=>$w,getTournamentPublishStatus:()=>pR,getVenueData:()=>TT,mutate:()=>rye,publishEvent:()=>eE,publishEventSeeding:()=>nye,publishOrderOfPlay:()=>cye,publishParticipants:()=>lye,query:()=>qAe,setEventDisplay:()=>xL,unPublishEvent:()=>uye,unPublishEventSeeding:()=>aye,unPublishOrderOfPlay:()=>oye,unPublishParticipants:()=>sye});var rye={};Fi(rye,{publishEvent:()=>eE,publishEventSeeding:()=>nye,publishOrderOfPlay:()=>cye,publishParticipants:()=>lye,setEventDisplay:()=>xL,unPublishEvent:()=>uye,unPublishEventSeeding:()=>aye,unPublishOrderOfPlay:()=>oye,unPublishParticipants:()=>sye});function nye({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=_c,drawIds:a=[],event:s}){if(!r)return{error:rt};if(!s)return{error:Vr};let o=Su({event:s,status:n}),l=(o?.seeding?.seedingScaleNames||i)&&{...o?.seeding?.seedingScaleNames,...i},c=(o?.seeding?.stageSeedingScaleNames||e)&&{...o?.seeding?.stageSeedingScaleNames,...e},u=Ft({stageSeedingScaleNames:c,seedingScaleNames:l,published:!0,drawIds:a});return JC({statusObject:{seeding:u},removePriorValues:t,status:n,event:s}),bi({topic:efe,payload:{tournamentId:r.tournamentId,eventId:s.eventId,drawIds:a}}),{...se}}function aye({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=_c,drawIds:n,stages:a,event:s}){if(!i)return{error:rt};if(!s)return{error:Vr};let o=Su({event:s});if(o){let l=o.seeding;if(Array.isArray(a)&&l.stageSeedingScaleNames)for(let c of a)l.stageSeedingScaleNames[c]&&delete l.stageSeedingScaleNames[c];Array.isArray(e)&&l?.seedingScaleNames&&(l.seedingScaleNames=l.seedingScaleNames.filter(c=>!e.includes(c))),Array.isArray(n)&&l?.drawIds&&(l.drawIds=l.drawIds.filter(c=>!n.includes(c))),(!Object.values(l.stageSeedingScaleNames??{}).length&&!l.seedingScaleNames?.length&&!l.drawIds?.length||!a&&!e&&!n?.length)&&(delete l.stageSeedingScaleNames,delete l.seedingScaleNames,delete l.drawIds,l.published=!1),JC({statusObject:{seeding:l},removePriorValues:t,status:r,event:s})}return bi({topic:TW,payload:{tournamentId:i.tournamentId,eventId:s.eventId}}),{...se}}function sye(t){let e=vu(t);if(!Object.keys(e).length)return{error:yn};for(let i of Object.values(e)){let r=o3e({tournamentRecord:i,...t});if(r.error)return r}return{...se}}function o3e({removePriorValues:t=!0,tournamentRecord:e,status:i=_c}){if(!e)return{error:rt};let r=`${qg}.${Wg}`,{timeItem:n}=yu({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].participants,Pf({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),bi({payload:{tournamentId:e.tournamentId},topic:oLe}),{...se}}function oye(t){let e=vu(t);if(!Object.keys(e).length)return{error:yn};for(let i of Object.values(e)){let r=l3e({tournamentRecord:i,...t});if(r.error)return r}return{...se}}function l3e({removePriorValues:t=!0,tournamentRecord:e,status:i=_c}){if(!e)return{error:rt};let r=`${qg}.${Wg}`,{timeItem:n}=yu({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Pf({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),bi({topic:CW,payload:{tournamentId:e.tournamentId}}),{...se}}function lye(t){let e=vu(t);if(!Object.keys(e).length)return{error:yn};for(let i of Object.values(e)){let r=c3e({tournamentRecord:i,...t});if(r.error)return r}return{...se}}function c3e({removePriorValues:t,tournamentRecord:e,status:i=_c}){if(!e)return{error:rt};let r=`${qg}.${Wg}`,{timeItem:n}=yu({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i].participants={published:!0},Pf({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),bi({payload:{tournamentId:e.tournamentId},topic:ife}),{...se}}function cye(t){let e=vu(t);if(!Object.keys(e).length)return{error:yn};for(let i of Object.values(e)){let r=u3e({tournamentRecord:i,...t});if(r.error)return r}return{...se}}function u3e({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=_c,eventIds:n=[]}){if(!i)return{error:rt};let a=`${qg}.${Wg}`,{timeItem:s}=yu({element:i,itemType:a}),o=s?.itemValue||{[r]:{}};return o[r].orderOfPlay={published:!0,scheduledDates:t,eventIds:n},Pf({timeItem:{itemValue:o,itemType:a},element:i,removePriorValues:e}),bi({topic:tfe,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...se}}function uye({removePriorValues:t=!0,tournamentRecord:e,status:i=_c,event:r}){if(!e)return{error:rt};if(!r)return{error:Vr};let n=`${qg}.${Wg}`,{timeItem:a}=X1({itemType:n,event:r}),s=a?.itemValue||{[i]:{}};return delete s[i].structureIds,delete s[i].drawDetails,delete s[i].drawIds,zw({event:r,timeItem:{itemValue:s,itemType:n},removePriorValues:t}),JC({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),bi({topic:UW,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...se}}var I6={};Fi(I6,{getEntryStatusReports:()=>p3e,getParticipantStats:()=>d3e,getStructureReports:()=>h3e,getVenuesReport:()=>b3e});function d3e({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:s,matchUps:o}){if(!n)return{error:rt};if(o&&!Array.isArray(o))return{error:bl};if(o=o??La({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!o?.length)return{error:sA};let l=[];e&&l.push(e),r&&l.push(r);let c=l.length?{participantIds:l}:{participantTypes:[zo]},u=gn({participantFilters:c,tournamentRecord:n}).participants??[];if(!u.every(({participantType:S})=>S===zo))return{error:Fl};l.length||l.push(...u.map(ji));let d=new Map,p=new Map,f=new Map,h=new Map,m=(S,T="")=>p.get(S)||p.set(S,{participantName:T,participantId:S,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(S);for(let S of u){let{participantId:T,individualParticipantIds:D}=S;h.set(T,D??[]),m(T,S.participantName)}if(r&&!h.get(r))return le({result:{error:On},context:{teamParticipantId:r}});if(e&&!h.get(e))return le({result:{error:On},context:{opponentParticipantId:e}});let A=[],g=S=>{let T=[[],[]];for(let C of S){let E=C.participant;if(E?.participantName){d.set(E.participantId,{participantName:E.participantName,ratings:E.ratings});let P=p.get(E.participantId);P&&(P.participantName=E.participantName)}}let D=({side:C,individualParticipantIds:E})=>C.participantId&&(!E?.length||E.includes(C.participantId))&&[C.participantId]||C.participant?.individualParticipantIds?.length&&(!E?.length||Pn(E,C.participant?.individualParticipantIds).length===C.participant?.individualParticipantIds?.length)&&C.participant.individualParticipantIds;if(h.size){let C=(E,P)=>{for(let R of S){if(!R.participant)continue;let M=D({individualParticipantIds:P,side:R});if(M?.length){let N=R.sideNumber;if(!N)continue;let k=[E];i&&k.push(...M),T[N-1]=k;let O=p.get(E);for(let x of M.filter(Boolean))O&&!O.competitorIds.includes(x)&&O.competitorIds.push(x)}}};if(r)(!e||S.every(E=>E.participant&&(D({individualParticipantIds:h.get(r),side:E})||D({individualParticipantIds:h.get(e),side:E}))))&&C(r,h.get(r));else for(let[E,P]of h)C(E,P)}else if(i)for(let C of S){if(!C.participant)continue;let E=D({individualParticipantIds:[],side:C}),P=C.sideNumber;P&&(T[P-1]=E)}return T};for(let S of o){if(!Ki(S))return{error:bl};let{matchUpStatus:T,matchUpFormat:D,matchUpType:C,winningSide:E,score:P,sides:R}=S;if(!R||!P||C===Cc||T==="BYE")continue;let M=g(R);if(!M.filter(Boolean).length)continue;let N=t&&E&&sR({matchUp:S})?.competitiveness;A.push(S);let k=v5({matchUpStatus:T,matchUpFormat:D,tallyPolicy:s,winningSide:E,score:P}),O=tme({matchUpStatus:T,matchUpFormat:D,tallyPolicy:s,winningSide:E,score:P}),{pointsTally:x,tiebreaksTally:F}=ime({matchUpFormat:D,score:P});M.forEach((_,V)=>{for(let G of _){let z=d.get(G)?.participantName,Q=m(G,z);if(Q){let j=(ie,ue)=>ue.forEach((ne,ge)=>Q[ie][ge]+=ne),W=V?[...F].reverse():F,Y=V?[...x].reverse():x,X=V?[...O].reverse():O,J=V?[...k].reverse():k;if(j("tiebreaks",W),j("points",Y),j("games",X),j("sets",J),E){let ie=E-1===V?0:1;Q.matchUps[ie]+=1}if(N){let ie=N.toLowerCase();Q.competitiveness[ie]||(Q.competitiveness[ie]=[0,0]),Q.competitiveness[ie][V]+=1}if(T){let ie=T.toLowerCase();Q.matchUpStatuses[ie]||(Q.matchUpStatuses[ie]=0),Q.matchUpStatuses[ie]+=1}}}})}let v=["tiebreaks","matchUps","points","games","sets"],b=["competitive","routine","decisive"],y=new Map,I=(S,T)=>(S??0)+(T??0);for(let[S,T]of p.entries()){for(let D of v){let C=T[D].reduce(I);if(C){let E=T[D][0]/C,P=`${D}Ratio`,R=parseFloat(E.toFixed(2));T[P]=R,f.set(S,!0),y.has(P)||y.set(P,[]),y.get(P)?.push(R)}}for(let D of b){let C=T.competitiveness?.[D]?.reduce(I);if(C){let E=T.competitiveness[D][0]/C,P=`${D}Ratio`,R=parseFloat(E.toFixed(2));T[P]=R}}}if(!r){let S=(T,D)=>D-T;for(let T of p.values())for(let D of v){let C=`${D}Ratio`;if(typeof T[C]=="number"){let E=y.get(C)?.sort(S).indexOf(T[C]);if(typeof E=="number"&&E>=0){let P=`${D}Rank`;T[P]=E+1}}}}let w={relevantMatchUps:A,...se};return r?(w.teamStats=p.get(r),e&&(w.opponentStats=p.get(e))):w.participatingTeamsCount=f.size,w.allParticipantStats=[...p.values()],w}function r_({participant:t,eventType:e}){let i=t?.person?.personId,r=t?.person?.personOtherIds?.[0],n=t?.person?.tennisId,a=t?.ratings?.[e]?.find(({scaleName:c})=>c==="WTN"),s=a?.scaleValue,{wtnRating:o,confidence:l}=s||{};return{timeStamp:a?.scaleDate,personOtherId:r,confidence:l,wtnRating:o,personId:i,tennisId:n}}function p3e({tournamentRecord:t}){if(!t)return{error:rt};let e=t.tournamentId,{participantMap:i}=gn({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(La({matchUpFilters:{matchUpTypes:[mI,Ay]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:f,matchUpType:h})=>f?.flatMap(m=>h===Ay?m?.participant?.individualParticipantIds:m?.participant?.participantId||m.participantId).filter(Boolean)).filter(Boolean),n=[],a={},s={},o={},l=0,c=({id:f,entry:h,eventId:m,eventType:A})=>{let{qualifyingSeeding:g,mainSeeding:v,entryStatus:b,entryStage:y,drawId:I}=h;a[f]||(a[f]=[]);let{participant:w,events:S}=i?.[f]??{},T=r_({participant:w,eventType:A}),D=S?.[m]?.ranking;b===f5&&n.push(f),a[f].push({participantType:w?.participantType,participantId:f,tournamentId:e,eventType:A,eventId:m,drawId:I,entryStatus:b,entryStage:y,...T,ranking:D,mainSeeding:v,qualifyingSeeding:g})};for(let f of t.events??[]){let h={},m=S=>{h[S]||(h[S]={count:0}),h[S].count+=1},{drawDefinitions:A=[],eventType:g,eventId:v}=f,b=A.flatMap(S=>{let{drawId:T,entries:D}=S;l+=1;let C=({stage:M,stageSequence:N})=>M===Ut&&N===1||M===zt,E=(S.structures??[]).filter(C).flatMap(({positionAssignments:M})=>M).filter(Boolean).map(({participantId:M})=>M),P=({participantId:M})=>E.includes(M),R=M=>{let{participantId:N,entryStatus:k,entryStage:O}=M;m(k);let x=i?.[N]?.draws?.[T]?.seedAssignments?.[Ut];return{qualifyingSeeding:i?.[N]?.draws?.[T]?.seedAssignments?.[zt],participantId:N,mainSeeding:x,entryStatus:k,entryStage:O,drawId:T}};return D?.filter(P).map(R)}),y=S=>{let T=S.participantId,D=i?.[T].participant.individualParticipantIds?.filter(C=>r.includes(C));return T&&{[T]:{individualParticipantIds:D}}};g===Bm?(()=>{let S=Object.assign({},...b.map(y).filter(Boolean)),T=D=>{S[D.participantId].individualParticipantIds.forEach(C=>{c({id:C,eventType:g,eventId:v,entry:D})})};b.forEach(T)})():b.forEach(S=>{c({id:S?.participantId,eventType:g,eventId:v,entry:S})});let I=Object.values(h).reduce((S,T)=>S+T.count,0);Object.keys(h).forEach(S=>{h[S].pct=h[S].count/I*100}),o[v]={tournamentId:e,eventId:v,entries:b,entryStatuses:h};let w=Object.assign({},...Pd.flatMap(S=>[{[S+"_count"]:h[S]?.count},{[S+"_pct"]:h[S]?.pct}]));s[v]={tournamentId:e,eventId:v,...w}}let u=Object.values(i??{}).filter(({participant:{participantType:f,participantRole:h}})=>f===zi&&h===Ns),d=u.filter(({participant:f})=>!r.includes(f.participantId)).map(({participant:f})=>f.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:u.length,eventsCount:Object.values(o).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(s).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(o).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function f3e({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=h=>{let m=h?.matchUpFormat;m&&(n[m]||(n[m]=0),n[m]+=1)},s=e.filter(h=>i?h.eventId===i:h.drawId===r).reduce((h,m)=>(a(m),(m.sides??[]).flatMap(A=>(A?.participant?.individualParticipants||[A?.participant]).filter(Boolean)).forEach(A=>h[A.participantId]=A),h),{}),o=Object.values(s),l=o.map(h=>r_({participant:h,eventType:t})).filter(({wtnRating:h})=>h),c=(o.length-l.length)/o.length*100,u=l.reduce((h,m)=>{let{wtnRating:A,confidence:g}=m;return h.totalWTN+=A,h.totalConfidence+=g,h},{totalWTN:0,totalConfidence:0}),d=l?.length?u.totalWTN/l.length:0,p=l?.length?u.totalConfidence/l.length:0,f=Object.values(n).reduce((h,m)=>h+(m||0),0);return{matchUpFormatCounts:n,matchUpsCount:f,avgConfidence:p,pctNoRating:c,avgWTN:d}}function h3e(t){let{tournamentRecord:e,extensionProfiles:i,firstFlightOnly:r,firstStageSequenceOnly:n=!0}=t;if(!e)return{error:pT};let a=[],s={},o={},l=[],c=A=>g=>g.structureId===A,u=Object.assign({},...(i??[]).map(({name:A,label:g,accessor:v})=>{let b=Bi({element:e,name:A})?.extension?.value,y=v?iy({element:b,accessor:v})?.value:b;return{[g??A]:y}})),d=e?.tournamentId,p=La({participantsProfile:{withScaleValues:!0},tournamentRecord:e}).matchUps??[],f=A=>yu({itemType:hW,itemSubTypes:[eh],element:{timeItems:A}})?.timeItem?.itemValue?.scaleBasis,h=({positionManipulations:A})=>{A?.forEach(g=>{let{structureId:v,name:b}=g,y=g.drawPositions??[g.drawPosition];s[v]??=[],s[v].push(`${b}: ${y.join("/")}`)})},m=e?.events?.flatMap(({timeItems:A,drawDefinitions:g=[],extensions:v,eventType:b,eventName:y,eventId:I,category:w})=>{let S=v?.find(N=>N.name===vd)?.value?.flights?.map(N=>({[N.drawId]:N.flightNumber})),T=S&&Object.assign({},...S),D=v?.find(N=>N.name===ey),C=A?.find(N=>N.itemType===ey),E=D?.value?.length??C?.itemValue??0,P=Object.values(T??{}),R=T&&Math.min(...P),M=f(A);return o[I]={seedingBasis:M?JSON.stringify(M):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:E,tournamentId:d,eventId:I},g.filter(N=>!r||!S||T[N.drawId]===R).flatMap(N=>{let{matchUpFormat:k,tieFormat:O,timeItems:x,extensions:F,structures:_,drawName:V,drawType:G,drawId:z}=N,{matchUpFormatCounts:Q,matchUpsCount:j,avgConfidence:W,pctNoRating:Y,avgWTN:X}=f3e({eventType:b,matchUps:p,drawId:z}),J=f(x)??M,ie=m3e({extensions:F}),ue=ie?.length??0;return h({positionManipulations:ie}),o[I].totalPositionManipulations+=ue,o[I].generatedDrawsCount+=1,ue>o[I].maxPositionManipulations&&(o[I].maxPositionManipulations=ue),_?.filter(ne=>(ne.stageSequence===1||!n)&&[zt,Ut,Os,Tn].includes(ne.stage)).map(ne=>{let ge=[Ut,Tn].includes(ne.stage)?A3e(p,ne.structureId):void 0;ne.stage===Ut&&a.push({eventName:y,drawName:V,structureId:ne.structureId});let he=g3e(ge)?.participant,Ie=v3e(he),xe=y3e(he),Je=r_({participant:xe?.[0]??he,eventType:b}),{personId:qe,personOtherId:dt,tennisId:ft,confidence:je,wtnRating:Tt}=Je||{},Oe=r_({participant:xe?.[1],eventType:b}),{personId:mt,personOtherId:Le,tennisId:lt,confidence:it,wtnRating:Fe}=Oe||{},{ageCategoryCode:Xe,categoryName:ct,subType:We}=w??{},ht=ne.matchUpFormat??k,xt=(Q[ht]??0)/j*100,{tieFormatName:pe,tieFormatDesc:Se}=Kx(O),{tieFormatName:ye,tieFormatDesc:ke}=Kx(ne.tieFormat),Ce=Se===ke,Ke=!Ce&&ye,_e=ne.tieFormat&&!Ce&&ke,wt=ie?.filter(c(ne.structureId))?.length??0;return{...u,tournamentId:d,eventId:I,structureId:ne.structureId,drawId:z,eventType:b,category:We,categoryName:ct,ageCategoryCode:Xe,flightNumber:T?.[z],drawType:G,stage:ne.stage,seedingBasis:J?JSON.stringify(J):void 0,winningPersonId:qe,winningPersonOtherId:dt,winningPersonTennisId:ft,winningPersonWTNrating:Tt,winningPersonWTNconfidence:je,winningPerson2Id:mt,winningPerson2OtherId:Le,winningPerson2TennisId:lt,winningPerson2WTNrating:Fe,winningPerson2WTNconfidence:it,winningTeamId:Ie,positionManipulations:wt,pctNoRating:Y,matchUpFormat:ht,pctInitialMatchUpFormat:xt,matchUpsCount:j,drawTieFormatName:pe,drawTieFormatDesc:Se,tieFormatName:Ke,tieFormatDesc:_e,avgConfidence:W,avgWTN:X}})})});return a.forEach(({eventName:A,drawName:g,structureId:v})=>{s[v]?.length&&l.push({eventName:A,drawName:g,actions:s[v]})}),{eventStructureReports:Object.values(o),structureReports:m,flightReports:l}}function m3e({extensions:t}){return t?.find(({name:e})=>e===YU)?.value?.slice(1)}function A3e(t,e){return t.find(i=>i.structureId===e&&i.finishingRound===1&&i.winningSide)}function g3e(t){if(t?.sides)return t.sides.find(e=>e.sideNumber===t.winningSide)}function v3e(t){return t?.participantType===zo?t.participantId:void 0}function y3e(t){return t?.participantType===Mi?t.individualParticipants??[]:[]}function b3e({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){if(!Array.isArray(n))return{error:be,dates:n};if(!Array.isArray(r))return{error:be,venueIds:r};if(!(e&&Object.keys(e).filter(u=>!i||u===i)||[]).length)return{error:yn};if(!n.every(Co))return{error:fa};let a=fA({tournamentRecords:e,ignoreDisabled:t,dates:n});if(a.error)return a;let s=a?.venues?.filter(({venueId:u})=>!r?.length||r.includes(u)),o=a.courts?.reduce((u,d)=>(d.dateAvailability?.forEach(p=>{let f=p.date;u.includes(f)||u.push(f)}),u),[]).filter(u=>!n.length||n.includes(u)),l={venueIds:s?.map(({venueId:u})=>u)},{matchUps:c}=sp({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:s?.map(u=>I3e(o,u,c))}}function I3e(t,e,i){let{venueId:r,courts:n,venueName:a}=e,s={};return t.forEach(o=>{let l=0,c=0,u=0;for(let f of n){let h=f.dateAvailability.find(A=>A.date===o),m=(h&&tE({courtDate:h}).timeSlots)?.reduce((A,g)=>{let{startTime:v,endTime:b}=g,y=ar(b)-ar(v);return A+y},0);m&&(u+=1),l+=m}let d=i.filter(({schedule:f})=>f.venueId===r&&hh(o,f.scheduledDate));d.forEach(({schedule:f})=>{let h=qr(f.scheduledTime),m=ml(h,f.averageMinutes),A=ar(m)-ar(h);c+=A});let p=l?(c/l*100).toFixed(2):"100";s[o]={scheduledMatchUpsCount:d.length,availableCourts:u,availableMinutes:l,scheduledMinutes:c,percentUtilization:p}}),{venueId:r,venueName:a,venueReport:s}}var w6={};Fi(w6,{addCourtGridBooking:()=>wye,addMatchUpCourtOrder:()=>e6,addMatchUpEndTime:()=>i6,addMatchUpOfficial:()=>Xge,addMatchUpResumeTime:()=>n6,addMatchUpScheduleItems:()=>QL,addMatchUpScheduledDate:()=>VL,addMatchUpScheduledTime:()=>Zg,addMatchUpStartTime:()=>t6,addMatchUpStopTime:()=>r6,addSchedulingProfileRound:()=>A6,allocateTeamMatchUpCourts:()=>GL,assignMatchUpCourt:()=>Yw,assignMatchUpVenue:()=>rE,bulkRescheduleMatchUps:()=>vye,bulkScheduleMatchUps:()=>GR,bulkScheduleTournamentMatchUps:()=>wP,bulkUpdateCourtAssignments:()=>hye,calculateScheduleTimes:()=>S6,clearMatchUpSchedule:()=>bye,clearScheduledMatchUps:()=>qL,courtGridRows:()=>EL,findMatchUpFormatTiming:()=>UL,findVenue:()=>Hh,generateBookings:()=>zL,generateVirtualCourts:()=>OL,getMatchUpsToSchedule:()=>SL,getPersonRequests:()=>pb,getProfileRounds:()=>CL,getScheduledRoundsDetails:()=>kR,getSchedulingProfile:()=>hA,getSchedulingProfileIssues:()=>hK,matchUpScheduleChange:()=>yye,modifyMatchUpFormatTiming:()=>xK,mutate:()=>dye,proAutoSchedule:()=>fye,proConflicts:()=>Aye,publicFindCourt:()=>$W,query:()=>YAe,removeCourtGridBooking:()=>Sye,removeEventMatchUpFormatTiming:()=>kL,removeMatchUpCourtAssignment:()=>pye,reorderUpcomingMatchUps:()=>gye,scheduleMatchUps:()=>mye,scheduleProfileRounds:()=>WL,setMatchUpDailyLimits:()=>Iye,setMatchUpHomeParticipantId:()=>JK,setSchedulingProfile:()=>YC,toggleParticipantCheckInState:()=>LL,validateSchedulingProfile:()=>TL});var dye={};Fi(dye,{addCourtGridBooking:()=>wye,addMatchUpCourtOrder:()=>e6,addMatchUpEndTime:()=>i6,addMatchUpOfficial:()=>Xge,addMatchUpResumeTime:()=>n6,addMatchUpScheduleItems:()=>QL,addMatchUpScheduledDate:()=>VL,addMatchUpScheduledTime:()=>Zg,addMatchUpStartTime:()=>t6,addMatchUpStopTime:()=>r6,addSchedulingProfileRound:()=>A6,allocateTeamMatchUpCourts:()=>GL,assignMatchUpCourt:()=>Yw,assignMatchUpVenue:()=>rE,bulkRescheduleMatchUps:()=>vye,bulkScheduleMatchUps:()=>GR,bulkScheduleTournamentMatchUps:()=>wP,bulkUpdateCourtAssignments:()=>hye,calculateScheduleTimes:()=>S6,clearMatchUpSchedule:()=>bye,clearScheduledMatchUps:()=>qL,findMatchUpFormatTiming:()=>UL,generateBookings:()=>zL,generateVirtualCourts:()=>OL,matchUpScheduleChange:()=>yye,modifyMatchUpFormatTiming:()=>xK,proAutoSchedule:()=>fye,proConflicts:()=>Aye,removeCourtGridBooking:()=>Sye,removeEventMatchUpFormatTiming:()=>kL,removeMatchUpCourtAssignment:()=>pye,reorderUpcomingMatchUps:()=>gye,scheduleMatchUps:()=>mye,scheduleProfileRounds:()=>WL,setMatchUpDailyLimits:()=>Iye,setMatchUpHomeParticipantId:()=>JK,setSchedulingProfile:()=>YC,toggleParticipantCheckInState:()=>LL,validateSchedulingProfile:()=>TL});function S6({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:s,scheduleDate:o,startTime:l,venueIds:c,endTime:u}){if(typeof a!="object"||!Object.keys(a).length)return{error:yn};s=s??FL({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=fA({dates:[o],ignoreDisabled:!0,tournamentRecords:a}),f=d?.filter(C=>!c||c.includes(C.venueId));l||(l=f?.reduce((C,E)=>{let P=E.dateAvailability?.find(R=>!R.date||hh(o,R.date))?.startTime??E.startTime;return P&&(!C||ar(P)<ar(C))?P:C},void 0)),u||(u=f?.reduce((C,E)=>{let P=E.dateAvailability?.find(R=>!R.date||hh(o,R.date))?.endTime??E.endTime;return P&&(!C||ar(P)>ar(C))?P:C},void 0));let h=Object.values(a),m=Object.assign({},...h.map(C=>(C.events??[]).map(E=>{let{scheduleTiming:P}=Z1({tournamentRecord:C,event:E});return{[E.eventId]:{event:E,scheduleTiming:P}}})).flat()),A=OR({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:o,venueIds:c}}),g=A?.dateMatchUps??[],v=A?.completedMatchUps??[],b=[];b.push(...g),b.push(...v);let y={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},I=b?.map(({eventId:C,schedule:E,matchUpFormat:P})=>{let{event:R,scheduleTiming:M}=m[C],N=R?.eventType,k={...M,defaultTiming:y,matchUpFormat:P},{averageMinutes:O,recoveryMinutes:x}=VF({eventType:N,timingDetails:k}),{courtId:F,venueId:_}=E,V=qr(E.scheduledTime),G=ml(V,O);return{recoveryMinutes:x,averageMinutes:O,periodLength:s,startTime:V,endTime:G,courtId:F,venueId:_}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:o,clearScheduleDates:n,periodLength:s,startTime:l,endTime:u,bookings:I,courts:f},{scheduleTimes:S}=zK(w),T=c?.length===1&&c[0]||p?.length===1&&p[0].venueId||void 0,D=b.map(xa);return{venueId:T,scheduleTimes:S,dateScheduledMatchUpIds:D}}function pye(t){let e=Gt(t,[{[Xs]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:r,tournamentId:n,courtDayDate:a,matchUpId:s,courtId:o,drawId:l}=t,c=r[n];if(!c)return{error:rt};let{drawDefinition:u,event:d}=Xg({tournamentRecord:c,drawId:l});if(!u)return{error:Bt};let p=Wr({drawDefinition:u,event:d,matchUpId:s});if(p.error)return p;if(p?.matchUp?.matchUpType===Cc){let{itemValue:f}=lb({timeItems:p.matchUp.timeItems??[],itemType:wh}),h=o&&f.filter(m=>m.courtId!==o);return Yl({duplicateValues:!1,removePriorValues:i,tournamentRecord:c,drawDefinition:u,matchUpId:s,timeItem:{itemType:wh,itemValue:h}})}else return Yw({tournamentRecord:c,drawDefinition:u,courtDayDate:a,courtId:"",matchUpId:s})}function fye({scheduleCompletedMatchUps:t,minCourtGridRows:e=10,tournamentRecords:i,scheduledDate:r,matchUps:n}){if(!wu(n))return{error:be};if(n.some(({hasContext:h})=>!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:aF};let a=OR({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:e,tournamentRecords:i,matchUpFilters:{localPerspective:!0,scheduledDate:r}});if(a.error)return a;let{rows:s}=a,o=[],l=h=>[(h.sides||[]).map(m=>[m.participantId,m.participant?.individualParticipantIds]),(h.potentialParticipants||[]).flat().map(m=>[m.participantId,m.individualParticipantIds])].flat(1/0).filter(Boolean),c=s?.reduce((h,m)=>{let A=[],g=[];Object.values(m).forEach(b=>{if(Ki(b)&&(b.matchUpId&&(A.push(b.matchUpId),o.push(b)),b.sides)){let y=l(b);g.push(...y)}});let v=Object.values(m).filter(b=>Ki(b)&&!b.matchUpId&&!b.isBlocked);return h.concat({matchUpIds:A,availableCourts:v,rowId:m.rowId,participantIds:g})},[]);n.filter(({matchUpStatus:h})=>h&&h!=="BYE"&&(t||!qn.includes(h))).sort(Lw);let u=Rd({matchUps:n.concat(o),includeParticipantDependencies:!0,tournamentRecords:i}).matchUpDependencies,d=[],p=[];for(;n.length&&c.length;){let h=c.shift(),m=[];for(;n.length&&h.availableCourts.length;){let A=n.concat(m).map(D=>D.matchUpId),g=n.shift(),v=g?.matchUpId,b=v&&u[v].matchUpIds.concat(u[v].dependentMatchUpIds),y=v&&A.some(D=>u[v].matchUpIds.includes(D)),I=v&&p.some(D=>u[v].dependentMatchUpIds.includes(D)),w=h.matchUpIds.some(D=>b.includes(D)),S=l(g),T=h.participantIds.some(D=>S.includes(D));if(g&&!w&&!y&&!T&&!I){let D=h.availableCourts.shift();Object.assign(g.schedule,D.schedule),Object.assign(D,g),d.push(g),h.participantIds.push(...S),h.matchUpIds.push(v)}else g&&m.push(g)}n.push(...m),p.push(...h.matchUpIds)}let f=d.map(({matchUpId:h,tournamentId:m,schedule:A,drawId:g})=>({tournamentId:m,matchUpId:h,drawId:g,schedule:{...A,scheduledDate:r}}));return a=GR({tournamentRecords:i,matchUpDetails:f}),{...a,scheduled:d,notScheduled:n}}function hye(t){let{courtDayDate:e}=t,i=Gt(t,[{courtAssignments:!0,[il]:zs,[Dc]:Kt},{[Xs]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,s)=>{let{tournamentId:o}=s;return a[o]||(a[o]=[]),a[o].push(s),a},{}),n;return Object.keys(r).every(a=>{let s=t[Xs][a];if(!s)return n={error:rt},!1;let o=r[a].reduce((l,c)=>{let{drawId:u}=c;return l[u]||(l[u]=[]),l[u].push(c),l},{});Object.keys(o).every(l=>{let{drawDefinition:c}=Xo({tournamentRecord:s,drawId:l});return c?(o[l].every(u=>{let{matchUpId:d,courtId:p}=u,f=Yw({tournamentRecord:s,drawDefinition:c,courtDayDate:e,matchUpId:d,courtId:p});if(f.success)return f?.success;n={error:ode}}),!0):(n={error:Bt},!1)})}),n||se}function mye(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:o={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:c={},checkPotentialRequestConflicts:u=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:f=30,scheduleDate:h,matchUpIds:m,venueIds:A,startTime:g,endTime:v,dryRun:b}=t,y=Gt(t,[{[Xs]:!0,[Q1]:!0},{[Es]:Co,[Dc]:fa,[NFe]:!0},{[Es]:j=>!j||!isNaN(j),[_Fe]:!1,[Dc]:be,[OFe]:!1,[FFe]:!1}]);if(y.error)return y;let I=t.competitionMatchUps??sp({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??Rd({includeParticipantDependencies:!0,matchUps:I,tournamentRecords:e}).matchUpDependencies;I.forEach(j=>{j.schedule?.scheduledDate&&hh(h,Si(j.schedule.scheduledDate))&&PT({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:j})});let S=m.map(j=>I.find(W=>W.matchUpId===j)).filter(Boolean),{venueId:T,scheduleTimes:D,dateScheduledMatchUpIds:C}=S6({tournamentRecords:e,remainingScheduleTimes:d,startTime:qr(g),endTime:qr(v),scheduleDate:Si(h),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:f,venueIds:A}),E={},P=[],R={},M={},N={};I.filter(({matchUpId:j})=>C?.includes(j)).forEach(j=>{t4({matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUp:j,value:1});let W=j.schedule?.scheduledTime;if(W){R[j.matchUpId]=W;let Y=a?.[j.matchUpId];IP({recoveryMinutes:Y||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:W,matchUp:j})}});let k=S.filter(j=>{let W=C?.includes(j.matchUpId),Y=["BYE",Mr,Ln,ql,Fa,Xr].includes(j?.matchUpStatus);return!W&&!j.winningSide&&!Y}),{matchUpMap:O,overLimitMatchUpIds:x,participantIdsAtLimit:F}=k.reduce((j,W)=>{let{drawId:Y,tournamentId:X,matchUpType:J}=W,{participantIdsAtLimit:ie,relevantParticipantIds:ue}=p6({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,matchUpDailyLimits:c,matchUp:W});return ie?.length?(j.overLimitMatchUpIds.push(W.matchUpId),j.participantIdsAtLimit.push(...ie),j):(ue.forEach(ne=>{HR({individualParticipantProfiles:o,participantId:ne});let ge=o[ne].counters;ge[J]?ge[J]+=1:ge[J]=1,ge[nd]?ge[nd]+=1:ge[nd]=1}),j.matchUpMap[X]||(j.matchUpMap[X]={}),j.matchUpMap[X][Y]?j.matchUpMap[X][Y].push(W):j.matchUpMap[X][Y]=[W],PT({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:W}),j)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});k=k.filter(({matchUpId:j})=>!x.includes(j));let _=0,V=D?.length??0,{personRequests:G}=pb({tournamentRecords:e,requestType:VR});for(;D?.length&&k.length&&_<=V;){_++;let{scheduleTime:j}=D.shift(),W=k.find(Y=>{let{matchUpId:X}=Y,{dependenciesScheduled:J,remainingDependencies:ie}=c6({matchUpScheduleTimes:R,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:Y});if(!J)return N[X]||(N[X]=[]),N[X].push({scheduleTime:j,remainingDependencies:ie}),!1;let{enoughTime:ue}=d6({individualParticipantProfiles:o,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:j,matchUp:Y});if(!ue)return M[X]||(M[X]=[]),M[X].push({scheduleTime:j}),!1;let{conflicts:ne}=u6({potentials:u,averageMatchUpMinutes:r,requestConflicts:E,personRequests:G,scheduleTime:j,scheduleDate:h,matchUp:Y});if(ne?.length)return!1;let ge=a?.[Y.matchUpId];return IP({recoveryMinutes:ge||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:j,matchUp:Y}),R[Y.matchUpId]=j,!0});k=k.filter(({matchUpId:Y})=>Y!==W?.matchUpId),W||P.push(j)}k.forEach(j=>{t4({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,value:-1,matchUp:j})});let z=[];Object.keys(O).forEach(j=>{let W=e[j];W&&Object.keys(O[j]).forEach(Y=>{let{drawDefinition:X}=Xg({tournamentRecord:W,drawId:Y});X&&O[j][Y].forEach(({matchUpId:J})=>{let ie=R[J];if(ie){let ue=ie.split(":").map(tu).join(":"),ne=`${Si(h)}T${ue}`;b?z.push(J):(Zg({drawDefinition:X,matchUpId:J,scheduledTime:ne}).success&&z.push(J),T&&rE({tournamentRecords:e,tournamentRecord:W,drawDefinition:X,matchUpId:J,venueId:T}))}})})});let Q=aW(k);return{...se,requestConflicts:Object.values(E),remainingScheduleTimes:D?.map(({scheduleTime:j})=>j),individualParticipantProfiles:o,matchUpNotBeforeTimes:l,participantIdsAtLimit:F,skippedScheduleTimes:P,overLimitMatchUpIds:x,scheduledMatchUpIds:z,noTimeMatchUpIds:Q,recoveryTimeDeferred:M,dependencyDeferred:N}}function Aye({tournamentRecords:t,matchUps:e}){if(!wu(e))return{error:sA};if(e.some(({matchUpId:v,hasContext:b})=>v&&!b))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:aF};let i=Math.max(...e.map(({schedule:v})=>v?.courtOrder||1).map(v=>ri(v))),r=gt(1,i+1).map(v=>e.filter(b=>ri(b.schedule?.courtOrder)===v)),n={},a={},s={};r.flat().filter(Boolean).sort(Lw).forEach(({schedule:v})=>delete v[Dk]);let o=Ci(e.map(({drawId:v})=>v)),l=Rd({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:o}).matchUpDependencies,c=r.map((v,b)=>v.reduce((y,I)=>{if(!I.matchUpId)return y;let{matchUpId:w,winnerMatchUpId:S,loserMatchUpId:T,schedule:D,sides:C,potentialParticipants:E}=I,P=D?.courtId;n[w]=b,a[P]=[],y.matchUpIds.push(w),s[w]=I;let R=l[w].matchUpIds;R.length&&y.sourceMatchUpIds.push(...R);let M=C?.flatMap(k=>[k.participant?.individualParticipantIds,k.participantId]).flat().filter(Boolean)??[],N=E?.flat().flatMap(({individualParticipantIds:k,participantId:O})=>[k,O]).flat().filter(Boolean)||[];return y.participantIds.push(...N,...M),S&&y.targetMatchUpIds.push(S),T&&y.targetMatchUpIds.push(T),y},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),u=(v,b)=>l[v].sources.reduce((y,I,w)=>I.includes(b)&&w+1||y,0),d=c.map(()=>[]),p=(v,b,y)=>{y[v]||(y[v]={}),y[v][Dv]||(y[v][Dv]=b.filter(I=>I!==v))},f=(v,b,y)=>{b.participantIds.filter(I=>v.participantIds.includes(I)).forEach(I=>{let w=b.matchUpIds.concat(v.matchUpIds).filter(S=>l[S].participantIds.includes(I));w.forEach(S=>{p(S,w,y)})})},h=(v,b,y)=>{y[v]||(y[v]={}),y[v][WA]||(y[v][WA]=b.filter(I=>I!==v))},m=v=>{let b={},y=Vl(v.participantIds),I=new Set(Object.keys(y).filter(S=>y[S]>1)),w=v.matchUpIds.filter(S=>l[S].participantIds.some(T=>I.has(T)));return w.forEach(S=>{h(S,w,b)}),b},A=v=>{let b={},y={};return v.forEach(I=>{let{matchUpId:w,schedule:S}=I;if(!w||!S?.courtId||!S?.scheduledDate)return;let T=`${S.courtId}|${S.scheduledDate}`;y[T]||(y[T]=[]),y[T].push(w)}),Object.values(y).forEach(I=>{I.length>1&&I.forEach(w=>{b[w]=I.filter(S=>S!==w)})}),b},g=(v,b,y,I)=>{if(!s[v].schedule[Dk]){s[v].schedule[Dk]=b,s[v].schedule[Bfe]=I,d[n[v]].push({matchUpId:v,issueType:y,issueIds:I,issue:b});let w=s[v].schedule.courtId;a[w]||(a[w]=[]),a[w].push({matchUpId:v,issue:b,issueType:y,issueIds:I})}};return c.forEach((v,b)=>{let y=b?c[b-1]:void 0,I=c.slice(b+1),w=m(v),S=A(r[b].filter(T=>v.matchUpIds.includes(T.matchUpId)));y&&f(y,v,w),v.matchUpIds.forEach(T=>{let D=l[T].matchUpIds;for(let E of I){let P=E.matchUpIds.filter(R=>D.includes(R));P?.length&&(P.forEach(R=>g(R,Rj,qA,[T])),g(T,Rj,qA,P))}if(S[T]&&g(T,WA,Nfe,S[T]),w[T]?.[WA]&&g(T,WA,Pj,w[T][WA]),v.sourceMatchUpIds.includes(T)){let E=v.matchUpIds.filter(P=>l[P].matchUpIds.includes(T));g(T,WA,qA,E),v.matchUpIds.filter(P=>l[P].matchUpIds.includes(T)).forEach(P=>g(P,WA,qA,[T]))}let C=y?.matchUpIds?.filter(E=>u(T,E)>1);if(C?.length&&(g(T,Mj,qA,C),C.forEach(E=>g(E,Mj,qA,[T]))),w[T]?.[Dv]&&g(T,Dv,Pj,w[T][Dv]),y?.targetMatchUpIds?.includes(T)){let E=s[T].schedule.courtId,P=D.filter(R=>y.matchUpIds.includes(R));P.some(R=>s[R].schedule.courtId===E)||(P.forEach(R=>g(R,Dv,qA,[T])),g(T,Dv,qA,P))}})}),{courtIssues:a,rowIssues:d}}function gye(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return le({result:{error:yn},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return le({result:{error:Kt},stack:e});let a=r?.length;if(!a)return{...se};let s=0;return r.forEach((l,c)=>{let{tournamentId:u,drawId:d,matchUpId:p}=l,f=c+(n?-1:1);f<0&&(f=a-1),f===a&&(f=0);let h=r[f].schedule.scheduledTime,m=o({tournamentId:u,scheduledTime:h,matchUpId:p,drawId:d});if(m.success)s++;else return m}),s===a?se:le({result:{error:sde},stack:e});function o({tournamentId:l,scheduledTime:c,matchUpId:u,drawId:d}){let p=i[l],{drawDefinition:f}=Xg({tournamentRecord:p,drawId:d});return f?Zg({drawDefinition:f,scheduledTime:c,matchUpId:u}):{error:Ec}}}function vye(t){let{scheduleChange:e,matchUpIds:i,dryRun:r}=t;if(!i||!Array.isArray(i))return{error:Sw};if(typeof e!="object")return{error:be};let n=vu(t),a=[],s=[];for(let l of Object.values(n)){let c=w3e({tournamentRecord:l,scheduleChange:e,matchUpIds:i,dryRun:r});if(c.error)return c;Array.isArray(c.notRescheduled)&&s.push(...c.notRescheduled);let u=aW(c.notRescheduled),d=[];c.rescheduled?.forEach(p=>{let{matchUpId:f}=p;u.includes(f)&&d.push(f),a.push(p)}),d.length&&(s=c?.notRescheduled?.filter(({matchUpId:p})=>!d.includes(p))||[])}let o=!!(a.length&&!s.length);return{...se,rescheduled:a,notRescheduled:s,allRescheduled:o}}function w3e({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){if(!t)return{error:rt};if(!i||!Array.isArray(i))return{error:Sw};if(typeof e!="object")return{error:be};let n=[],a=[],{minutesChange:s,daysChange:o}=e;if(!s&&!o)return{...se};if(s&&isNaN(s))return{error:be};if(o&&isNaN(o))return{error:be};let{matchUps:l}=La({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),c=({matchUpStatus:y})=>!qn.includes(y),u=l?.filter(y=>_R({schedule:y.schedule})).filter(y=>c({matchUpStatus:y.matchUpStatus}));if(!u?.length)return{...se};let{tournamentInfo:d}=qw({tournamentRecord:t}),{startDate:p,endDate:f}=d,h=u?.reduce((y,I)=>{let{matchUpId:w,drawId:S}=I;return y[S]?y[S].push(w):y[S]=[w],y},{}),m=1440;for(let y of Object.keys(h)){let I=Xg({tournamentRecord:t,drawId:y});if(I.error)return I;let w=I.drawDefinition,S=h[y].filter(T=>i.includes(T));for(let T of S)if(T&&w){let D=u.find(N=>N.matchUpId===T)?.schedule,{scheduledTime:C,scheduledDate:E}=D,P,R,M;if(!P&&o&&E){let N=Si(E);M=ED(N,o),P=new Date(M)<new Date(p)||new Date(M)>new Date(f)}if(s&&C){let N=Si(C),k=ar(qr(C))+s;if(P=k<0||k>m,!P){let O=ml(C,s),x=N&&M||E===N&&N;R=x?`${x}T${O}`:O}}if(P)a.push(T);else{if(!r){if(R){let N=Zg({scheduledTime:R,drawDefinition:w,matchUpId:T});if(N.error)return N}if(M){let N=VL({scheduledDate:M,drawDefinition:w,matchUpId:T});if(N.error)return N}}(R||M)&&n.push(T)}}}let A=La({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],g=A.filter(({matchUpId:y})=>n.includes(y)),v=A.filter(({matchUpId:y})=>a.includes(y)),b=g.length&&!v.length;return{...se,rescheduled:g,notRescheduled:v,allRescheduled:b}}function yye(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:yn};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:s,courtDayDate:o}=t||{},{drawId:l,matchUpId:c,tournamentId:u}=r||{},{drawId:d,matchUpId:p,tournamentId:f}=n||{};if(!c&&!p)return le({result:{error:Kt},stack:e});let{matchUps:h}=sp({matchUpFilters:{matchUpIds:[c,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=h?.find(({matchUpId:y})=>y===c),A=h?.find(({matchUpId:y})=>y===p),g=0;if(s&&c&&!p){let y=v({tournamentId:u,matchUpId:c,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(y?.success&&g++,y.error)return le({result:y,stack:e})}else if(a&&s&&c&&p){let y=v({tournamentId:u,matchUpId:c,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(y.success&&g++,y.error)return le({result:y,stack:e,info:"source"});let I=v({tournamentId:f,sourceCourtId:s,matchUpId:p,matchUp:A,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:o});if(I.success&&g++,I.error)return le({result:I,stack:e,info:"target"})}else return{error:Kt};return g?se:le({result:{error:MC},stack:e});function v(y){let{tournamentRecords:I,tournamentId:w,matchUp:S,drawId:T}=y,D=I[w],{drawDefinition:C}=Xg({tournamentRecord:D,drawId:T});return S.matchUpType===$r?b({...y,tournamentRecord:D,drawDefinition:C}):Yw({...y,tournamentRecord:D,drawDefinition:C})}function b({removePriorValues:y,tournamentRecords:I,tournamentRecord:w,drawDefinition:S,sourceCourtId:T,courtDayDate:D,matchUpId:C,matchUp:E,courtId:P}){let R=[P].concat(E.schedule.allocatedCourts.map(({courtId:M})=>M).filter(M=>M!==T));return GL({removePriorValues:y,tournamentRecords:I,tournamentRecord:w,drawDefinition:S,courtDayDate:D,matchUpId:C,courtIds:R})}}function bye({scheduleAttributes:t=[wh,mg,kw,xw,_w,Qd,$m,ih,Sm],tournamentRecord:e,drawDefinition:i,matchUpId:r}){let n="clearMatchUpSchedule",a=i?Do({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps?.[0]:La({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps?.[0];if(!a)return{error:Ys};let s=(a.timeItems??[]).filter(o=>o?.itemType&&!t.includes(o?.itemType));return a.timeItems=s,Yi({tournamentId:e.tournamentId,context:n,drawDefinition:i,matchUp:a}),{...se}}function Iye(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:yn};if(typeof r!="object")return{error:oA};let a=Object.keys(n).filter(s=>!i||i===s);if(i&&!a.includes(i))return{error:be};for(let s of a){let o=n[s],l=lr({extension:{name:z1,value:{dailyLimits:r}},element:o});if(l.error)return l}return{...se}}function wye(t){let{tournamentRecord:e,disableNotice:i,scheduledDate:r,bookingType:n,courtOrder:a,rowCount:s=1,courtId:o,notes:l}=t;if(!e)return le({result:{error:be},info:"tournamentRecord is required"});if(!o)return{error:Mm};if(!r)return le({result:{error:be},info:"scheduledDate is required"});if(!n)return le({result:{error:be},info:"bookingType is required"});if(a==null)return le({result:{error:be},info:"courtOrder is required"});if(!Number.isInteger(a)||a<1)return le({result:{error:be},info:"courtOrder must be a positive integer"});if(!Number.isInteger(s)||s<1)return le({result:{error:be},info:"rowCount must be a positive integer"});let{court:c,venue:u}=Kg({tournamentRecord:e,courtId:o});if(!c)return{error:Mm};if(!gg({court:c,date:r})){c.dateAvailability||(c.dateAvailability=[]);let f={date:r,bookings:[]};c.dateAvailability.push(f)}let d=gg({court:c,date:r});if(d.bookings){for(let f of d.bookings)if(typeof f.courtOrder=="number"){let h=f.courtOrder,m=h+(f.rowCount||1)-1,A=a,g=a+s-1;if(A<=m&&g>=h)return le({result:{error:Jue},info:`Booking conflicts with existing booking at rows ${h}-${m}`})}}let p={courtOrder:a,rowCount:s,bookingType:n,notes:l,createdAt:new Date().toISOString()};return d.bookings||(d.bookings=[]),d.bookings.push(p),!i&&u&&bi({payload:{venue:u,tournamentId:e.tournamentId},topic:cA,key:u.venueId}),{...se,booking:p}}function Sye(t){let{tournamentRecord:e,disableNotice:i,scheduledDate:r,courtOrder:n,courtId:a}=t;if(!e)return le({result:{error:be},info:"tournamentRecord is required"});if(!a)return{error:Mm};if(!r)return le({result:{error:be},info:"scheduledDate is required"});if(n==null)return le({result:{error:be},info:"courtOrder is required"});let{court:s,venue:o}=Kg({tournamentRecord:e,courtId:a});if(!s)return{error:Mm};let l=gg({court:s,date:r});if(!l?.bookings)return le({result:{error:gj},info:"No bookings found for this date"});let c=l.bookings.findIndex(d=>d.courtOrder===n);if(c===-1)return le({result:{error:gj},info:`No booking found at row ${n}`});let u=l.bookings.splice(c,1)[0];return!i&&o&&bi({payload:{venue:o,tournamentId:e.tournamentId},topic:cA,key:o.venueId}),{...se,booking:u}}var U6={};Fi(U6,{addCollectionDefinition:()=>E6,addCollectionGroup:()=>Pye,aggregateTieFormats:()=>Mye,compareTieFormats:()=>Hm,getTieFormat:()=>wL,modifyCollectionDefinition:()=>T6,modifyTieFormat:()=>Rye,mutate:()=>Uye,orderCollectionDefinitions:()=>Eye,query:()=>jAe,removeCollectionDefinition:()=>C6,removeCollectionGroup:()=>Cye,tieFormatGenderValidityCheck:()=>fF,validateCollectionDefinition:()=>L1});var Uye={};Fi(Uye,{addCollectionDefinition:()=>E6,addCollectionGroup:()=>Pye,aggregateTieFormats:()=>Mye,modifyCollectionDefinition:()=>T6,modifyTieFormat:()=>Rye,orderCollectionDefinitions:()=>Eye,removeCollectionDefinition:()=>C6,removeCollectionGroup:()=>Cye});function My({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:s}){let o="getTieFormat",l;if(e=r?.structureId??e,i=n?.matchUpId??i,(i||e)&&!t)return{error:Bt};if(a&&s)l=Rp(s);else if(i){if(t&&(!n||!r)){let c=Wr({drawDefinition:t,matchUpId:i});if(c.error)return c;if(c.matchUp?.matchUpType!==Cc)return le({result:{error:bl},stack:o});r||(r=c.structure),n||(n=c.matchUp)}l=JD({item:n,drawDefinition:t,structure:r,event:s})||JD({item:r,drawDefinition:t,structure:r,event:s})||Rp(t)||Rp(s)}else if(t&&e){if(!r){let c=ui({drawDefinition:t,structureId:e});if(c.error)return c;r=c?.structure}l=JD({item:r,drawDefinition:t,structure:r,event:s})||Rp(t)||Rp(s)}else l=Rp(t)||Rp(s);return l?{...se,structure:r,tieFormat:l,matchUp:n}:le({result:{error:PC},stack:o})}function n_({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![qn].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==Dd&&!ya(t))}function PV({from:t,to:e}){let i=Object.keys(t),r=Pn(i,Object.keys(e)).length===i.length,n=i.filter(s=>t[s]!==e[s]).map(s=>({countChange:e[s]-t[s],collectionId:s})),a=i.every(s=>t[s]===e[s]);return{equivalent:r&&a,matchUpsCountChanges:n}}function S3e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:s,event:o,uuids:l}){let c="updateTieFormat",u=e?.tournamentId,d=0,p=0,f=0,h=0,m=n?.collectionDefinitions.reduce((w,S)=>(w[S.collectionId]=(w[S.collectionId]||0)+S.matchUpCount,w),{}),A=({tieFormat:w})=>{let S=w?.collectionDefinitions.reduce((T,D)=>(T[D.collectionId]=(T[D.collectionId]||0)+D.matchUpCount,T),{});return PV({from:S,to:m}).equivalent},g=My({drawDefinition:i})?.tieFormat,v=My({event:o})?.tieFormat;if(o&&a){for(let w of o.drawDefinitions??[])b({drawDefinition:w});o.tieFormat=Ss(n),h+=1}else if(s){if(!s.tieMatchUps)return le({result:{error:bl},stack:c});let w=Vl(s.tieMatchUps?.map(({collectionId:E})=>E)),S=PV({to:m,from:w}),{changes:T,changesArePossible:D,cannotChangeReaon:C}=Qee({matchUp:s,check:S});if(S.equivalent)if(n_({matchUp:s,updateInProgressMatchUps:t}))s.tieFormat=Ss(n),h+=1;else return le({result:{error:fq},info:"matchUp is IN_PROGRESS or COMPLETE",stack:c});else if(D)I({tieFormat:n,matchUp:s,changes:T,uuids:l});else return le({context:{collectionMap:m,matchUpMap:w},result:{error:Jf},info:C||"specified changes not possible",stack:c});p+=1,Yi({eventId:o?.eventId,context:c,drawDefinition:i,tournamentId:u,matchUp:s})}else if(r){let w=y({inheritedTieFormat:g??v,structure:r})?.modifiedMatchUpsCount;w&&(p+=w,d+=1,h+=1);let S=!r.tieFormat||Hm({ancestor:r.tieFormat,descendant:n}).different;S&&(r.tieFormat=Ss(n),d+=1,h+=1),(w||S)&&i&&Br({structureIds:[r.structureId],eventId:o?.eventId,drawDefinition:i})}else if(i)b({drawDefinition:i}),i.tieFormat=Ss(n),h+=1;else return{error:Bt};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:f,modifiedCount:h,...se,tieFormat:n};function b({drawDefinition:w}){let S=w.structures||[],T=[];for(let D of S){if(D.tieFormat)continue;let C=y({inheritedTieFormat:v,structure:D})?.modifiedMatchUpsCount;if(C){d+=1,p+=C;let E=D.structureId;T.push(E)}}return Br({structureIds:T,eventId:o?.eventId,drawDefinition:w}),T.length}function y({inheritedTieFormat:w,structure:S}){let T=0,D=cr({matchUpFilters:{matchUpTypes:[$r]},structure:S})?.matchUps||[];for(let C of D){let E=n_({matchUp:C,updateInProgressMatchUps:t}),P=!1,R=Vl(C.tieMatchUps?.map(({collectionId:N})=>N)),M=PV({from:R,to:m});if(M.equivalent)C.tieFormat&&A(C)&&E&&(C.tieFormat=Ss(n),P=!0);else{let{changes:N,changesArePossible:k}=Qee({matchUp:C,check:M});if(k&&!C.tieFormat)I({changes:N,matchUp:C,tieFormat:n,uuids:l});else if(w)(!C.tieFormat||Hm({ancestor:w,descendant:C.tieFormat}).different)&&(C.tieFormat=w,P=!0);else return le({result:{error:PC},stack:c})}P&&(T+=1,Yi({tournamentId:e?.tournamentId,drawDefinition:i,context:c,eventId:a,matchUp:C}))}return{modifiedMatchUpsCount:T}}function I({uuids:w,matchUp:S,tieFormat:T,changes:D}){S.tieFormat=Ss(T);let C=[],E=[];return D.forEach(P=>{if(P.countChange>0){let R=Math.max(0,...S.tieMatchUps.filter(k=>k.collectionId===P.collectionId).map(Kl("collectionPosition"))),M=T.collectionDefinitions.find(k=>k.collectionId===P.collectionId),N=bR({matchUpsLimit:P.countChange,collectionPositionOffset:R,collectionDefinition:M,matchUp:S,uuids:w});E.push(...St(N,!1,!0)),f+=E.length,S.tieMatchUps.push(...N)}else{let R=P.toBePlayedTieMatchUpIds.slice(0,Math.abs(P.countChange));console.log("remove",R.length),C.push(...R),S.tieMatchUps=S.tieMatchUps.filter(({matchUpId:M})=>!R.includes(M))}}),E.length&&fg({matchUps:E,drawDefinition:i,tournamentId:u,eventId:a}),C.length&&$h({matchUpIds:C,action:"updateTieFormat",drawDefinition:i,tournamentId:u,eventId:a}),{matchUpIdsRemoved:C,matchUpsAdded:E}}}function Qee({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let s=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===Rn).map(Kl("matchUpId")),o=s.length+a>=0||a>0;return!o&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:s,collectionId:n,countChange:a}),o}),changes:r,cannotChangeReaon:i}}function JL({appliedPolicies:t,drawDefinition:e,auditData:i}){if(!t?.audit?.[ZD])return;let{extension:r}=Bi({name:ZD,element:e}),n={value:Array.isArray(r?.value)?r?.value.concat(i):[i],name:ZD};lr({element:e,extension:n})}function T6({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:s,matchUpCount:o,collectionId:l,matchUpType:c,structureId:u,matchUpId:d,category:p,eventId:f,gender:h,event:m,collectionValueProfiles:A,collectionValue:g,matchUpValue:v,scoreValue:b,setValue:y}){let I="modifyCollectionDefinition";if(s&&!Ql({matchUpFormat:s}))return le({result:{error:be},context:{matchUpFormat:s},stack:I});if(r&&typeof r!="string")return le({result:{error:be},context:{collectionName:r},stack:I});if(h&&!Object.values(Fh).includes(h))return le({result:{error:be},context:{gender:h},stack:I});if(p&&typeof p!="object")return le({result:{error:be},context:{category:p},stack:I});let w={collectionValueProfiles:A,collectionValue:g,matchUpValue:v,scoreValue:b,setValue:y};if(!Object.values(w).filter(Boolean).length&&!i&&!r&&!s&&!o&&!c)return le({result:{error:Kt},stack:I});if(Object.values(w).filter(Boolean).length>1)return le({info:"Only one value assignment allowed per collectionDefinition",result:{error:be},stack:I});let S=My({drawDefinition:a,structureId:u,matchUpId:d,eventId:f,event:m});if(S.error)return le({result:S,stack:I});let{matchUp:T,structure:D,tieFormat:C}=S,E=Ss(C),P=C?.collectionDefinitions.find(z=>z.collectionId===l),R=E?.collectionDefinitions.find(z=>z.collectionId===l);if(!P)return le({info:"source collectionDefinition",result:{error:ts},context:{collectionId:l},stack:I});let M=g??v??b??y;if(A?.length){let z=nue({matchUpCount:o??P?.matchUpCount??0,collectionValueProfiles:A});if(z.errors)return le({result:{error:be},info:z.errors,stack:I})}else if(M&&!yi(M))return le({result:{error:be},info:"value is not an integer",context:{value:M},stack:I});let N=(z,Q)=>Pn(Object.keys(z),Object.keys(Q)).length===Object.keys(z).length&&Pn(Object.values(z),Object.values(Q)).length===Object.values(z).length,k=A&&(!P.collectionValueProfiles||!N(P.collectionValueProfiles,A)),O=yi(g)&&P.collectionValue!==g||yi(v)&&P.matchUpValue!==v||yi(b)&&P.scoreValue!==b||yi(y)&&P.setValue!==y||k,x=[];if(O&&(R.collectionValueProfiles=void 0,R.collectionValue=void 0,R.matchUpValue=void 0,R.scoreValue=void 0,R.setValue=void 0,Object.assign(R,w),x.push({collectionId:l,...Ft(w)})),(yi(b)||yi(y))&&R.collectionGroupNumber){let z=R.collectionGroupNumber;E.collectionDefinitions=E.collectionDefinitions.map(Q=>{let{collectionGroupNumber:j,...W}=Q;return j===z?W:Q}),E.collectionGroups=E.collectionGroups.filter(({groupNumber:Q})=>Q!==z),x.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:F,valueGoal:_}=Kw(E),V=Ft({aggregateValue:F,valueGoal:_});if((V.aggregateValue!==C?.winCriteria.aggregateValue||V.valueGoal!==C?.winCriteria.valueGoal)&&(E.winCriteria=V,x.push({collectionId:l,winCriteria:V})),yi(i)&&P.collectionOrder!==i&&(R.collectionOrder=i,x.push({collectionId:l,collectionOrder:i})),r&&P.collectionName!==r&&(R.collectionName=r,x.push({collectionId:l,collectionName:r})),s&&P.matchUpFormat!==s&&(R.matchUpFormat=s,x.push({collectionId:l,matchUpFormat:s})),yi(o)&&P.matchUpCount!==o&&(R.matchUpCount=o,x.push({collectionId:l,matchUpCount:o})),c&&P.matchUpType!==c)return le({result:{error:Uq},context:{matchUpType:c},stack:I});p&&P.category!==p&&(R.category=p,x.push({collectionId:l,category:p})),h&&P.gender!==h&&(R.gender=h,x.push({collectionId:l,gender:h}));let G=Ft(E);if(S=Ko({tieFormat:G}),S.error)return le({result:S,stack:I});if(!x.length)return le({result:{...se,modifications:x}});if(C?.tieFormatName!==n?(G.tieFormatName=n,x.push({tieFormatName:n})):x.length&&(delete G.tieFormatName,x.push("tieFormatName removed: modifications without new tieFormatName")),S=S3e({tieFormat:G,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:D,eventId:f,matchUp:T,event:m}),!S.error){let{appliedPolicies:z}=er({tournamentRecord:e}),Q=Ft({collectionDefinition:R,drawId:a?.drawId,action:I,structureId:u,matchUpId:d,eventId:f});JL({appliedPolicies:z,drawDefinition:a,auditData:Q})}return le({result:{...S,modifications:x},stack:I})}function U3e({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){let s=[];return n&&a?s=[a]:i&&r?s=cr({matchUpFilters:{matchUpTypes:[$r]},structure:r})?.matchUps??[]:e&&(s=Do({matchUpFilters:{matchUpTypes:[$r]},drawDefinition:e})?.matchUps??[]),{targetMatchUps:s.filter(o=>!o.winningSide&&o.matchUpStatus!==Ln&&(t||o.matchUpStatus!==Dd&&!ya(o)))}}function T3e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let s of r){let o=!!s.tieFormat;o&&(s.tieFormat=Ss(n));let l;if(t){let c=er({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,u=pA({matchUpId:s.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:c,drawDefinition:i,event:a});if(u.error)return u;l=u.score}o&&!l&&Yi({tournamentId:e?.tournamentId,context:"updateTargetTeamMatchUps",eventId:a?.eventId,matchUp:s,drawDefinition:i})}return{...se}}function Tye({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:s,structure:o,tieFormat:l,matchUpId:c,matchUp:u,eventId:d,event:p}){let{aggregateValue:f,valueGoal:h}=Kw(l);l.winCriteria=Ft({aggregateValue:f,valueGoal:h}),(e&&e!==h||f&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:m}=U3e({updateInProgressMatchUps:t,drawDefinition:a,structureId:s,structure:o,matchUpId:c,matchUp:u});T3e({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:a,tieFormat:l,event:p});let A=Ft(l),g=Ko({tieFormat:A});if(g.error)return g;if(d&&p)p.tieFormat=A;else if(c&&u)u.tieFormat=l;else if(o)o.tieFormat=A;else if(a)a.tieFormat=A;else if(!u||!a)return{error:Bt};return Br({drawDefinition:a,eventId:p?.eventId}),{...se}}function Cye({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:s,matchUp:o,eventId:l,event:c}){if(!e)return{error:Kt};if(isNaN(e))return{error:be};let u="removeCollectionGroup",d=o?void 0:My({drawDefinition:r,structureId:a,matchUpId:s,eventId:l,event:c});if(d?.error)return le({result:d,stack:u});let p=d?.structure;o=o??d?.matchUp;let f=d?.tieFormat,h=f?.winCriteria.valueGoal,m=f?.winCriteria.aggregateValue,A=Ss(f);if(d=Ko({tieFormat:A}),d.error)return le({result:d,stack:u});let g=[];if(A.collectionDefinitions=A.collectionDefinitions.map(v=>{let{collectionGroupNumber:b,...y}=v;return b!==e?v:(g.push(v.collectionId),y)}),A.collectionGroups=A.collectionGroups.filter(({groupNumber:v})=>v!==e),d=Tye({updateInProgressMatchUps:t,originalValueGoal:h,wasAggregateValue:m,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:A,matchUpId:s,matchUp:o,eventId:l,event:c}),!d.error){let{appliedPolicies:v}=er({tournamentRecord:i}),b=Ft({drawId:r?.drawId,collectionGroupNumber:e,action:u,structureId:a,matchUpId:s,eventId:l});JL({appliedPolicies:v,drawDefinition:r,auditData:b})}return le({result:{...d,modifiedCollectionIds:g},stack:u})}function MT({tieFormat:t,orderMap:e}){let i=Ss(t);return i.collectionDefinitions?.forEach(r=>{let n=e[r.collectionId];n&&(r.collectionOrder=n)}),i.collectionDefinitions?.sort((r,n)=>dT(r.collectionOrder)-dT(n.collectionOrder)),i}function Eye({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:s,event:o}){if(typeof n!="object"||!Object.values(n).every(u=>yi(u)))return le({result:{error:be},context:{orderMap:n}});let l=i?ui({drawDefinition:e,structureId:i}):void 0;if(l?.error)return l;let c=l?.structure;if(a&&o?.tieFormat)jee({tournamentRecord:t,event:o,orderMap:n});else if(r){let u=e&&Wr({drawDefinition:e,matchUpId:r});if(u?.error)return u;if(s=u.matchUp,!s)return{error:Wo};let d=wL({tournamentRecord:t,matchUpId:r,structure:c,drawDefinition:e,event:o})?.tieFormat;s.tieFormat=MT({tieFormat:d,orderMap:n}),Yi({tournamentId:t?.tournamentId,eventId:o?.eventId,drawDefinition:e,matchUp:s})}else if(i)if(c?.tieFormat)c.tieFormat=MT({tieFormat:c.tieFormat,orderMap:n}),Dye({eventId:o?.eventId,tournamentRecord:t,drawDefinition:e,structure:c,orderMap:n}),Br({drawDefinition:e,structureIds:[c.structureId]});else if(e.tieFormat)i4({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else if(o?.tieFormat)jee({structureIds:[i],tournamentRecord:t,orderMap:n,event:o});else return{error:ts};else if(e?.tieFormat)i4({tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else return{error:ts};return{...se}}function jee({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=MT({tieFormat:r.tieFormat,orderMap:i});e?.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])i4({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function i4({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??n?.tieFormat,s=MT({tieFormat:a,orderMap:r});i?.length||(e.tieFormat=s);let o=[];for(let l of e.structures??[])i?.length&&!i.includes(l.structureId)||((l.tieFormat||i?.includes(l.structureId))&&(l.tieFormat=MT({tieFormat:l.tieFormat??e.tieFormat??n?.tieFormat,orderMap:r})),Dye({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),o.push(l.structureId));Br({drawDefinition:e,structureIds:o})}function Dye({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){let a=cr({matchUpFilters:{matchUpTypes:[$r]},structure:i})?.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=MT({tieFormat:s.tieFormat,orderMap:r}),Yi({tournamentId:t?.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function C6({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:s,matchUpId:o,eventId:l,matchUp:c,event:u}){let d="removeCollectionDefinition",p=c?void 0:My({drawDefinition:r,structureId:s,matchUpId:o,eventId:l,event:u});if(p?.error)return le({result:p,stack:d});let f=p?.structure;c=c??p?.matchUp;let h=p?.tieFormat,m=Ss(h);if(p=Ko({tieFormat:m}),p.error)return le({result:p,stack:d});let A=m?.collectionDefinitions?.find(E=>E.collectionId===a);if(!A)return le({result:{error:ts,collectionId:a}});m.collectionDefinitions=m.collectionDefinitions.filter(E=>E.collectionId!==a),A.collectionGroupNumber&&(m.collectionDefinitions=m.collectionDefinitions.map(E=>{let{collectionGroupNumber:P,...R}=E;return R}),m.collectionGroups=m.collectionGroups.filter(({groupNumber:E})=>E!==A.collectionGroupNumber));let{aggregateValue:g,valueGoal:v}=Kw(m);m.winCriteria=Ft({aggregateValue:g,valueGoal:v});let b=h?.winCriteria.valueGoal,y=h?.winCriteria.aggregateValue;(b&&b!==v||g&&!y)&&(n?m.tieFormatName=n:delete m.tieFormatName);let I=[];o&&c?I=[c]:s&&f?I=cr({matchUpFilters:{matchUpTypes:[$r]},structure:f})?.matchUps??[]:r?I=Do({matchUpFilters:{matchUpTypes:[$r]},drawDefinition:r})?.matchUps??[]:u&&(I=Vh({matchUpFilters:{matchUpTypes:[$r]}})?.matchUps??[]);let w=(I||[]).filter(E=>{let P=E.tieMatchUps?.filter(M=>M.collectionId===a)?.some(ya),R=e&&E.tieFormat?Hm({descendant:E.tieFormat,ancestor:m})?.different:!1;return t&&!P||!E.winningSide&&E.matchUpStatus!==Ln&&(t||E.matchUpStatus!==Dd&&!ya(E)&&!R)});if(!w.length)return{error:MC};let{appliedPolicies:S}=er({tournamentRecord:i});if(o&&c&&t){let E=c.tieMatchUps?.filter(P=>P.collectionId===a);for(let P of E??[]){let R=fb({matchUpId:P.matchUpId,tieMatchUpId:c?.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:S,drawDefinition:r,event:u});if(R.error||(R=Wr({drawDefinition:r,matchUpId:o}),R.error))return R;c=R?.matchUp}}let T=[];for(let E of w){for(let P of E?.sides??[])P.lineUp=(P.lineUp??[]).map(R=>({participantId:R.participantId,collectionAssignments:(R?.collectionAssignments??[]).filter(M=>M.collectionId!==a)}));if(E.tieMatchUps=(E.tieMatchUps??[]).filter(P=>{let R=P.collectionId===a;return R&&T.push(P.matchUpId),!R}),E.tieFormat&&(E.tieFormat=Ss(m)),t){let P=pA({matchUpId:E.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:S,drawDefinition:r,event:u});if(P.error)return P}Yi({tournamentId:i?.tournamentId,eventId:u?.eventId,drawDefinition:r,context:d,matchUp:E})}T.length&&$h({tournamentId:i?.tournamentId,matchUpIds:T,eventId:u?.eventId,drawDefinition:r});let D=Ft(m);if(p=Ko({tieFormat:D}),p.error)return le({result:p,stack:d});if(l&&u)u.tieFormat=D;else if(o&&c)c.tieFormat=D;else if(f)f.tieFormat=D;else if(r)r.tieFormat=D;else if(!c||!r)return{error:Bt};Br({drawDefinition:r,eventId:u?.eventId});let C=Ft({drawId:r?.drawId,action:d,collectionId:a,structureId:s,matchUpId:o,eventId:l});return JL({appliedPolicies:S,drawDefinition:r,auditData:C}),{tieFormat:D,deletedMatchUpIds:T,targetMatchUps:w,...se}}function Pye({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:s,matchUpId:o,matchUp:l,eventId:c,event:u}){let d="addCollectionGroup";if(!Array.isArray(n))return le({result:{error:Kt},stack:d});let p=l?void 0:My({drawDefinition:r,structureId:s,matchUpId:o,eventId:c,event:u});if(p?.error)return le({result:p,stack:d});let f=p?.structure;l=l||p?.matchUp;let h=p?.tieFormat,m=h?.winCriteria.valueGoal,A=Ss(h);if(p=Ko({tieFormat:A}),p.error)return le({result:p,stack:d});for(let v of A.collectionDefinitions){let{collectionId:b,collectionGroupNumber:y}=v;if(y&&n.includes(b))return le({info:"collectionIds cannot be part of other collectionGroups",result:{error:be},stack:d})}let g=(A.collectionGroups||[]).reduce((v,b)=>b.groupNumber>v?b.groupNumber:v,0)+1;return i.groupNumber=g,A.collectionDefinitions=A.collectionDefinitions.map(v=>n.includes(v.collectionId)?{...v,collectionGroupNumber:g}:v),A.collectionGroups=[...A.collecitonGroups||[],i],Tye({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:s,structure:f,tieFormat:A,matchUpId:o,matchUp:l,eventId:c,event:u})}function E6({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:s,drawDefinition:o,tieFormatName:l,enforceGender:c,structureId:u,matchUpId:d,matchUp:p,eventId:f,uuids:h,event:m}){let A="addCollectionDefinition",g=er({tournamentRecord:r,drawDefinition:o,event:m}).appliedPolicies??{},v=n?.[Xa]??g?.[Xa];a=a??v?.participants?.enforceCategory;let b=(c??v?.participants?.enforceGender)!==!1,y=!!((i??m?.category)&&a!==!1),I=!!((s??m?.gender)&&b),w=L1({referenceCategory:i??m?.category,collectionDefinition:e,referenceGender:s,checkCategory:y,checkGender:I,event:m});if(w.error)return le({result:w,stack:A});let S=p?.tieFormat?void 0:My({drawDefinition:o,structureId:u,matchUpId:d,eventId:f,event:m});if(S?.error)return le({result:{error:S.error},stack:A});let T=S?.structure;p=p??S?.matchUp;let D=p?.tieFormat??S?.tieFormat,C=Ss(D);if(S=Ko({tieFormat:C}),S?.error)return le({result:{error:S.error},stack:A});if(!e.collectionId)e.collectionId=fr();else if(C.collectionDefinitions.map(({collectionId:_})=>_).includes(e.collectionId))return le({context:{collectionId:e.collectionId},result:{error:ude}});C.collectionDefinitions.push(e),C.collectionDefinitions.sort((_,V)=>(_.collectionOrder||0)-(V.collectionOrder||0)).forEach((_,V)=>_.collectionOrder=V+1);let{aggregateValue:E,valueGoal:P}=Kw(C);C.winCriteria=Ft({aggregateValue:E,valueGoal:P});let R=D?.winCriteria.valueGoal,M=D?.winCriteria.aggregateValue;(R&&R!==P||E&&!M)&&(l?C.tieFormatName=l:delete C.tieFormatName);let N=[],k=[],O=[],x=Ft(C);if(S=Ko({tieFormat:x}),S?.error)return le({result:{error:S.error},stack:A});if(f&&m){m.tieFormat=x;for(let _ of m.drawDefinitions??[])if(!_.tieFormat)for(let V of _.structures??[]){if(V.tieFormat)continue;let G=RV({updateInProgressMatchUps:t,collectionDefinition:e,structure:V,uuids:h});k.push(...G.newMatchUps),O.push(...G.targetMatchUps),N.push(V.structureId)}rB({modifiedMatchUps:O,eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:k,stack:A})}else if(u&&T){T.tieFormat=x;let _=RV({updateInProgressMatchUps:t,collectionDefinition:e,structure:T,uuids:h});k.push(..._.newMatchUps),O=_.targetMatchUps,rB({modifiedMatchUps:O,eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:k,stack:A})}else if(d&&p){if(!n_({matchUp:p,updateInProgressMatchUps:t}))return le({result:{error:fq},stack:A});p.tieFormat=x;let _=bR({collectionDefinition:e,matchUp:p,uuids:h});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(..._),k.push(..._),rB({modifiedMatchUps:[p],eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:k,stack:A})}else if(o){o.tieFormat=x;for(let _ of o.structures??[]){let V=RV({updateInProgressMatchUps:t,collectionDefinition:e,structure:_,uuids:h});N.push(_.structureId),k.push(...V.newMatchUps),O.push(...V.targetMatchUps)}rB({modifiedMatchUps:O,eventId:m?.eventId,tournamentRecord:r,drawDefinition:o,addedMatchUps:k,stack:A})}else return{error:Bt};let F=Ft({drawId:o?.drawId,collectionDefinition:e,action:A,structureId:u,matchUpId:d,eventId:f});return JL({appliedPolicies:g,drawDefinition:o,auditData:F}),{tieFormat:x,targetMatchUps:O,addedMatchUps:k,...se}}function RV({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){let n=[],a=(cr({matchUpFilters:{matchUpTypes:[$r]},structure:i})?.matchUps).filter(s=>n_({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let o=bR({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...o),n.push(...o)}return{newMatchUps:n,targetMatchUps:a}}function rB({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:s}){fg({tournamentId:e?.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i?.forEach(o=>{Yi({tournamentId:e?.tournamentId,drawDefinition:r,context:s,matchUp:o,eventId:a})}),Br({structureIds:t,drawDefinition:r,eventId:a})}function Rye({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,uuids:c,event:u}){let d="modifyTieFormat";if(!Ko({tieFormat:i}).valid)return le({result:{error:Jf},info:"falied validation",stack:d});let p=My({drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:u});if(p.error)return le({result:p,stack:d});let{matchUp:f,tieFormat:h}=p,m=Ss(h),A=Hm({descendant:i,ancestor:m,considerations:n});if(A.invalid)return le({context:{invalid:A.invalid},result:{error:Jf},stack:d});if(!A?.different)return le({result:{...se},info:"Nothing to do",stack:d});let g=m.collectionDefinitions.map(({collectionId:D})=>D),v=i.collectionDefinitions.map(({collectionId:D})=>D),b=g.filter(D=>!v.includes(D)),y=i.collectionDefinitions.filter(({collectionId:D})=>!g.includes(D)),I=y.map(Kl("collectionId")),w=[],S,T=i.tieFormatName;for(let D of i.collectionDefinitions){if(I.includes(D.collectionId))continue;let C=T6({updateInProgressMatchUps:t,...D,tournamentRecord:r,tieFormatName:T,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:u});if(C.modifications&&w.push(...C.modifications),C.error)return le({result:C,stack:d});C.tieFormat&&(S=C.tieFormat)}for(let D of y){let C=E6({updateInProgressMatchUps:t,collectionDefinition:D,tournamentRecord:r,drawDefinition:a,tieFormatName:T,structureId:s,matchUpId:o,matchUp:f,eventId:l,uuids:c,event:u});if(C.error)return le({result:C,stack:d});C.tieFormat&&(S=C.tieFormat)}for(let D of b){let C=C6({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:T,collectionId:D,structureId:s,matchUpId:o,eventId:l,matchUp:f,event:u});if(C.error)return le({result:C,stack:d});C.tieFormat&&(S=C.tieFormat)}return h?.tieFormatName!==T?(S.tieFormatName=T,w.push({tieFormatName:T})):(w.length||I.length||b.length)&&(delete S.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),S.collectionDefinitions=S.collectionDefinitions.sort((D,C)=>dT(D.collectionOrder)-dT(C.collectionOrder)).map((D,C)=>({...D,collectionOrder:C+1})),{processedTieFormat:Ss(S),modifications:w,...se}}function Mye({tournamentRecord:t}){if(!t)return{error:rt};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=c=>{if(!c.tieFormat)return;let u;for(let d of r)Hm({descendant:c.tieFormat,ancestor:d}).different||(u=d.tieFormatId);if(u)c.tieFormatId=u,delete c.tieFormat;else{let d=St(c.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=fr()),c.tieFormatId=d.tieFormatId,delete c.tieFormat,r.push(d),e+=1}};i.eventType,n({tieFormat:i.tieFormat});for(let c of i.drawDefinitions??[]){n({tieFormat:c.tieFormat});for(let u of c.structures??[])n({tieFormat:u.tieFormat})}let a=(c,u)=>{let d=o.matchUps?.find(p=>p.matchUpId===c);d&&(d.tieFormatId=u,delete d.tieFormat,Yi({tournamentId:t?.tournamentId,eventId:i.eventId,matchUp:d}))},s=c=>{let u=St(c.tieFormat,void 0,!0);u.tieFormatId||(u.tieFormatId=fr()),r.push(u),e+=1,a(c.matchUpId,u.tieFormatId)},o=Vh({matchUpFilters:{matchUpTypes:[Cc]},event:i}),l=o.matchUps??[];for(let c of l){let u;for(let d of r)c.tieFormat&&Hm({descendant:c.tieFormat,ancestor:d}).different||(u=d.tieFormatId);u?a(c.matchUpId,u):s(c)}r.length&&(i.tieFormats=r)}return{...se,addedCount:e}}var D6={};Fi(D6,{addDrawDefinitionExtension:()=>CF,addEventExtension:()=>Qg,addEventTimeItem:()=>zw,addExtension:()=>lr,addNotes:()=>tL,addOnlineResource:()=>Fye,addParticipantExtension:()=>Fpe,addParticipantTimeItem:()=>T5,addTimeItem:()=>Pf,addTournamentExtension:()=>eW,addTournamentTimeItem:()=>TR,analyzeDraws:()=>CR,analyzeTournament:()=>uK,copyTournamentRecord:()=>Bye,createTournamentRecord:()=>KL,generate:()=>Nye,getAggregateTeamResults:()=>cK,getAllowedDrawTypes:()=>vL,getAllowedMatchUpFormats:()=>sK,getAppliedPolicies:()=>er,getCompetitionDateRange:()=>bL,getCompetitionPenalties:()=>oK,getPolicyDefinitions:()=>uA,getTournamentInfo:()=>qw,getTournamentPenalties:()=>yL,getTournamentPersons:()=>lK,getTournamentPoints:()=>IL,getTournamentStructures:()=>s5,getTournamentTimeItem:()=>OF,hydrateTournamentRecord:()=>xye,mutate:()=>kye,query:()=>GAe,removeDrawDefinitionExtension:()=>Lpe,removeEventExtension:()=>EF,removeExtension:()=>Eo,removeNotes:()=>I5,removeOnlineResource:()=>Oye,removeParticipantExtension:()=>$pe,removeTournamentExtension:()=>tW,setTournamentCategories:()=>Hye,setTournamentDates:()=>e2,setTournamentEndDate:()=>Gye,setTournamentName:()=>Lye,setTournamentNotes:()=>$ye,setTournamentStartDate:()=>Vye,setTournamentStatus:()=>_ye});var Nye={};Fi(Nye,{copyTournamentRecord:()=>Bye,createTournamentRecord:()=>KL});function Bye(t){let e=Gt(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord,n=1440*60*1e3,a=(i&&r?new Date(Si(r)).getTime()-new Date(Si(i)).getTime():0)/n,s=t.endDate||_q(t.startDate,a),o=p=>p?.filter(({itemType:f})=>t.itemTypeList?.includes(f)),l=p=>p?.filter(({name:f})=>t.extensionList?.includes(f)),c=p=>{let{timeItems:f,extensions:h,...m}=p;return St({...m,timeItems:o(f),extensions:l(h)},!1,!0)},u=p=>{let{drawDefinitions:f,timeItems:h,extensions:m,startDate:A,endDate:g,...v}=p;return St({extensions:l(m),timeItems:o(h),startDate:t.startDate,endDate:s,...v},!1,!0)},d={participants:t.copyParticipants?t.tournamentRecord.participants?.map(c)??[]:[],parentOrganisation:St({...t.tournamentRecord.parentOrganisation},!1,!0),venues:St(t.tournamentRecord.venues??[],!1,!0),extensions:l(t.tournamentRecord.extensions),timeItems:o(t.tournamentRecord.timeItems),events:t.tournamentRecord.events?.map(u)??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:fr(),endDate:s};return{...se,tournamentRecord:d}}var kye={};Fi(kye,{addDrawDefinitionExtension:()=>CF,addEventExtension:()=>Qg,addEventTimeItem:()=>zw,addExtension:()=>lr,addNotes:()=>tL,addOnlineResource:()=>Fye,addParticipantExtension:()=>Fpe,addParticipantTimeItem:()=>T5,addTimeItem:()=>Pf,addTournamentExtension:()=>eW,addTournamentTimeItem:()=>TR,hydrateTournamentRecord:()=>xye,removeDrawDefinitionExtension:()=>Lpe,removeEventExtension:()=>EF,removeExtension:()=>Eo,removeNotes:()=>I5,removeOnlineResource:()=>Oye,removeParticipantExtension:()=>$pe,removeTournamentExtension:()=>tW,setTournamentCategories:()=>Hye,setTournamentDates:()=>e2,setTournamentEndDate:()=>Gye,setTournamentName:()=>Lye,setTournamentNotes:()=>$ye,setTournamentStartDate:()=>Vye,setTournamentStatus:()=>_ye});function xye(t){let{tournamentRecord:e,eventProfiles:i=[],directives:r,policyDefinitions:n}=t;return e?((e.events||[]).forEach(a=>{let s=i.find(o=>o.eventId&&o.eventId===a.eventId);(s?.directives?.hydrateRoundNames||r?.hydrateRoundNames)&&a.drawDefinitions?.forEach(o=>{(s?.policyDefinitions?.[km]||n?.[km])&&sge({drawDefinition:o,appliedPolicies:n})})}),{tournamentRecord:e}):{error:rt}}var C3e="ABANDONED",E3e="ACTIVE",D3e="CANCELLED",P3e="COMPLETED",R3e="IN_PROGRESS",P6={ABANDONED:C3e,ACTIVE:E3e,CANCELLED:D3e,COMPLETED:P3e,IN_PROGRESS:R3e};function _ye({tournamentRecord:t,status:e}){return t?e&&!Object.keys(P6).includes(e)?{error:be,info:"Unknown status"}:(t.tournamentStatus=e,{...se}):{error:rt}}function Oye(t){let e=Gt(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return le({result:{error:ts}});zS({element:i.parentOrganisation,onlineResource:r})}else if(a||s){let c=(i.participants??[]).find(u=>s&&u.person?.personId===s||u.participantId===a);if(!c)return le(s?{result:{error:ts}}:{result:{error:On}});if(s){if(c.person?.personId!==s)return le({result:{error:gy}});zS({element:c.person,onlineResource:r})}else zS({element:c,onlineResource:r})}else if(o){let c=(i.venues??[]).filter(u=>!l||u.venueId===l).flatMap(u=>(u.courts??[]).filter(d=>d.courtId===o))?.[0];if(!c)return le({result:{error:Mm}});zS({element:c,onlineResource:r})}else if(l){let c=(i.venues??[]).find(u=>u.venueId===l);if(!c)return le({result:{error:tb}});zS({element:c,onlineResource:r})}else zS({element:i,onlineResource:r}),bi({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:rb});return{...se}}function zS({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!(r?.[Mx]===e[Mx]&&r?.[Nx]===e[Nx]&&r?.[gT]===e[gT]));t.onlineResources=i}function Fye(t){let e=Gt(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return le({result:{error:ts}});qS({element:i.parentOrganisation,onlineResource:r})}else{if(a&&s&&a!==s)return le({result:{error:gy}});if(a||s){let c=(i.participants??[]).find(u=>s&&u.person?.personId===s||u.participantId===a);if(!c)return le(s?{result:{error:ts}}:{result:{error:On}});if(s){if(c.person?.personId!==s)return le({result:{error:gy}});qS({element:c.person,onlineResource:r})}else qS({element:c,onlineResource:r})}else if(o){let c=(i.venues??[]).filter(u=>!l||u.venueId===l).flatMap(u=>(u.courts??[]).filter(d=>d.courtId===o))?.[0];if(!c)return le({result:{error:Mm}});qS({element:c,onlineResource:r})}else if(l){let c=(i.venues??[]).find(u=>u.venueId===l);if(!c)return le({result:{error:tb}});qS({element:c,onlineResource:r})}else qS({element:i,onlineResource:r}),bi({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:rb})}return{...se}}function qS({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>r?.[bj]!==e[bj]&&r?.[gT]!==e[gT]);return i.push(e),t.onlineResources=i,{...se}}function Lye({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:rt};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&bi({topic:rb,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...se}}function $ye({tournamentRecord:t,notes:e}){if(!t)return{error:rt};let i=e?tL({element:t,notes:e}):I5({element:t});return i.error?i:(bi({topic:rb,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...se})}function Hye({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,bi({topic:rb,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...se}):{error:rt}}function M3e({tournamentRecord:t}){if(!t)return{error:rt};let{startDate:e,endDate:i}=t,r=AT(e,i),n=[];for(let a of t.venues||[])a?.courts?.length&&n.push(...a.courts);for(let a of n){let{startTime:s,endTime:o}=(a.dateAvailability??[]).reduce((u,d)=>{let p=ar(u.startTime),f=ar(u.endTime);return d.startTime&&ar(d.startTime)<p&&(u.startTime=d.startTime),d.endTime&&ar(d.endTime)>f&&(u.endTime=d.endTime),u},{startTime:"08:00",endTime:"18:00"}),l=r.map(u=>a.dateAvailability?.find(d=>d.date===u)??{date:u,startTime:s,endTime:o}),c=a.dateAvailability?.find(u=>!u.date);c&&l.unshift(c),a.dateAvailability=l}return{...se}}function e2(t){let{tournamentRecord:e,startDate:i,endDate:r,weekdays:n}=t,a=t.activeDates?.filter(Boolean),s=Gt(t,[{tournamentRecord:!0},{[Es]:f=>nf.test(f),[Dc]:fa,startDate:!1,endDate:!1},{[Es]:f=>f.filter(Boolean).every(h=>nf.test(h)),[Dc]:fa,activeDates:!1},{[Es]:wge,weekdays:!1}]);if(s.error)return s;if(r&&i&&new Date(r)<new Date(i))return{error:be};if(r&&i&&new Date(i)>new Date(r))return{error:be};if(a?.length){let f=i||e.startDate,h=r||e.endDate,m=!f||a.every(g=>new Date(g)>=new Date(f)),A=!h||a.every(g=>new Date(g)<=new Date(h));if(!m||!A)return{error:fa}}let o;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||r&&e.endDate&&new Date(r)<new Date(e.endDate))&&(o=!0);let l=AT(e.startDate,e.endDate);i&&(e.startDate=i),r&&(e.endDate=r);let c=AT(e.startDate,e.endDate),u=l.filter(f=>!c.includes(f)),d=c.filter(f=>!l.includes(f));for(let f of e.events??[])i&&f.startDate&&new Date(f.startDate)<new Date(i)&&(f.startDate=i),r&&f.startDate&&new Date(f.startDate)>new Date(r)&&(f.startDate=i??r),r&&f.endDate&&new Date(f.endDate)>new Date(r)&&(f.endDate=r),i&&f.endDate&&new Date(f.endDate)<new Date(i)&&(f.endDate=r??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),r&&e.startDate&&new Date(r)<new Date(e.startDate)&&(e.startDate=r),a&&(e.activeDates=a),n&&(e.weekdays=n);let p=o&&N3e({tournamentRecord:e})?.unscheduledMatchUpIds;return M3e({tournamentRecord:e}),bi({payload:Ft({parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,activeDates:a,startDate:i,weekdays:n,endDate:r}),topic:rb}),{...se,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:u}}function Vye({tournamentRecord:t,startDate:e}){return e?e2({tournamentRecord:t,startDate:e}):{error:fa}}function Gye({tournamentRecord:t,endDate:e}){return e?e2({tournamentRecord:t,endDate:e}):{error:fa}}function N3e({tournamentRecord:t}){let e=La({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let s of e){let{schedule:o,matchUpId:l}=s;if(o&&o.scheduledDate){let c=new Date(o.scheduledDate);(i&&c<i||r&&c>r)&&(a.push(l),n.includes(o.scheduledDate)||n.push(o.scheduledDate))}}return n.length&&!qL({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:oue}:{unscheduledMatchUpIds:a}}var R6={};Fi(R6,{addCourt:()=>XL,addCourts:()=>g6,addVenue:()=>lR,deleteCourt:()=>Zye,deleteVenue:()=>k6,deleteVenues:()=>qye,disableCourts:()=>Wye,disableVenues:()=>Kye,enableCourts:()=>Yye,enableVenues:()=>Xye,generate:()=>Qye,generateCourts:()=>jK,getCompetitionVenues:()=>BR,getCourts:()=>EK,getVenuesAndCourts:()=>fA,modifyCourt:()=>x6,modifyCourtAvailability:()=>N6,modifyVenue:()=>Jye,mutate:()=>jye,publicFindVenue:()=>LW,query:()=>rge});var Qye={};Fi(Qye,{generateCourts:()=>jK});var jye={};Fi(jye,{addCourt:()=>XL,addCourts:()=>g6,addVenue:()=>lR,deleteCourt:()=>Zye,deleteVenue:()=>k6,deleteVenues:()=>qye,disableCourts:()=>Wye,disableVenues:()=>Kye,enableCourts:()=>Yye,enableVenues:()=>Xye,modifyCourt:()=>x6,modifyCourtAvailability:()=>N6,modifyVenue:()=>Jye});function M6(t){if(!t?.tournamentRecord&&!Array.isArray(t?.venueMatchUps))return{error:rt};if(!t?.courtId)return{error:Uw};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:s}=hA({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:o}=La({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:o,courtId:a})};function l({matchUps:c,courtId:u}){let d=c.filter(p=>{let f=p.schedule?.allocatedCourts?.map(({courtId:h})=>h);return p.schedule?.courtId===u||f?.includes(u)});return Yx({matchUps:d,schedulingProfile:s})}}function B3e({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:rt};if(!r)return{error:$g};let{schedulingProfile:n}=hA({tournamentRecord:e}),{matchUps:a}=La({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:s({matchUps:a,venueId:r})};function s({matchUps:o,venueId:l}){let c=o.filter(u=>{let d=u.schedule?.allocatedCourts?.map(({venueId:p})=>p);return u.schedule?.venueId===l||d?.includes(l)});return Yx({matchUps:c,schedulingProfile:n})}}function N6({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){if(!t)return{error:rt};if(!n)return{error:Uw};let s=Pve({dateAvailability:e});if(s.error)return s;let{updatedDateAvailability:o,totalMergeCount:l}=k3e(e);e=o;let c=Kg({tournamentRecord:t,courtId:n});if(c.error)return c;let{court:u,venue:d}=c,{matchUps:p}=M6({tournamentRecord:t,venueMatchUps:r,courtId:n});if(p?.length){let f=er({tournamentRecord:t})?.appliedPolicies,h=a??f?.[Vg]?.allowDeletionWithScoresPresent?.courts,m=[];m.length&&(h||console.log("throw error: scheduled court matchUps",m.length))}return u&&(u.dateAvailability=e,!i&&d&&bi({payload:{venue:d,tournamentId:t.tournamentId},topic:cA,key:d.venueId})),{...se,totalMergeCount:l}}function k3e(t){let e=0,i=t.reduce((n,a)=>{let{date:s,startTime:o,endTime:l,bookings:c}=a;return n[s]||(n[s]=[]),n[s].push({startTime:o,endTime:l,bookings:c}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(V4e);let{mergedAvailability:a,mergeCount:s}=x3e(i[n]);r.push(...a.map(o=>({date:n,...o}))),e+=s}),{updatedDateAvailability:r,totalMergeCount:e}}function x3e(t){let e,i,r,n=t.length,a=0,s=[];for(;t.length&&n;){let l=t.shift(),{startTime:c,endTime:u,bookings:d}=l;if(n-=1,!e)e=c,r=d,i=u;else if(O1(Zn(i),Zn(c),!1)>0){let p={startTime:e,endTime:i};r?.length&&(p.bookings=r),s.push(p),e=c,r=d,i=u}else d&&(r?r.push(d):r=d),i=u,a+=1}let o={startTime:e,endTime:i};return r?.length&&(o.bookings=r),s.push(o),{mergedAvailability:s,mergeCount:a}}function B6({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:mde,info:e}}function zye({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:mo};if(!e&&!r)return{error:fp};let a;if(!e){if(!t)return{error:rt};({drawDefinition:e}=Xo({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=Wr({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:rt};let s=La({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=cme({matchUps:s,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(s=>[mg,wh].includes(s.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:s})=>![mg,wh].includes(s)),Yi({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...se}):{error:Ys}}function k6(t){if(typeof t?.venueId!="string")return{error:$g};let{tournamentRecord:e,venueId:i,force:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(n).length)return{error:rt};let a=sp({tournamentRecords:n,contextFilters:{venueIds:[i]}}).matchUps??[],s=er({tournamentRecord:e})?.appliedPolicies,o=r??s?.[Vg]?.allowDeletionWithScoresPresent?.venues;if(!a.length||o)for(let l of Object.values(n)){for(let u of a){let d=zye({matchUpId:u.matchUpId,drawId:u.drawId,tournamentRecord:l});if(d.error)return d}let c;l.venues=(l.venues??[]).filter(u=>u?.venueId!==i?!0:(c=!0,!1)),c&&bi({payload:{venueId:i,tournamentId:l.tournamentId},topic:gW,key:i})}else return B6({matchUpsCount:a.length});return xR({tournamentRecords:n}),{...se}}function qye({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:rt};if(!Array.isArray(e))return{error:be};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,s=k6({tournamentRecord:t,venueId:a,force:i});if(s.error)return s}}return{...se}}function Wye(t){let{courtIds:e,dates:i}=t,r=vu(t),n=[{[Xs]:!0,[UF]:!0}],a=Gt(t,n);if(a.error)return a;for(let s of Object.values(r))_3e({tournamentRecord:s,courtIds:e,dates:i});return{...se}}function _3e({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>lr({extension:{value:r,name:Yd},creationTime:!1,element:a});for(let a of t.venues||[])for(let s of a.courts||[])if(e?.includes(s.courtId)){let o=n(s);if(o.error)return o}return{...se}}function Kye(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[Xs]:!0,[TF]:!0}],a=Gt(t,n);if(a.error)return a;let s=Object.keys(e).filter(o=>!i||o===i);for(let o of s){let l=e[o];O3e({tournamentRecord:l,venueIds:r})}return{...se}}function O3e({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e?.includes(i.venueId)){let r=lr({creationTime:!1,element:i,extension:{name:Yd,value:!0}});if(r.error)return r}return{...se}}function Yye(t){let e=vu(t),i=[{[Xs]:!0}];!t.enableAll&&i.push({[UF]:!0});let r=Gt(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:s}=t;for(let o of Object.values(e))F3e({tournamentRecord:o,courtIds:a,enableAll:n,dates:s});return{...se}}function F3e({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e?.includes(a.courtId))if(Array.isArray(r)){let{extension:s}=Bi({element:a,name:Yd});if(s){let o=s.value;Array.isArray(o.dates)&&(o.dates=o.dates.filter(l=>!r.includes(l))),lr({extension:{name:Yd,value:o},creationTime:!1,element:a})}}else Eo({element:a,name:Yd});return{...se}}function Xye(t){let e=vu(t),i=[{[Xs]:!0}];!t.enableAll&&i.push({[TF]:!0});let r=Gt(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let s of Object.values(e))for(let o of s.venues||[])(a||n?.includes(o.venueId))&&Eo({element:o,name:Yd});return{...se}}function Zye(t){let{courtId:e,disableNotice:i,force:r}=t,n=vu(t),a=Gt(t,[{[Xs]:!0,[Bpe]:!0}]);if(a.error)return a;let s,o;for(let l of Object.values(n)){if(o=L3e({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),o.error&&o.error!==Mm)return o;o.success&&(s=!0)}return s?{...se}:o}function L3e({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){let n=Kg({tournamentRecord:t,courtId:i});if(n.error)return n;let a=n.venue,{matchUps:s}=M6({tournamentRecord:t,courtId:i}),o=er({tournamentRecord:t})?.appliedPolicies,l=r??o?.[Vg]?.allowDeletionWithScoresPresent?.courts;if(!s?.length||l){for(let c of s??[]){let u=zye({matchUpId:c.matchUpId,drawId:c.drawId,tournamentRecord:t});if(u.error)return u}a&&(a.courts=(a.courts??[]).filter(c=>c.courtId!==i),e||bi({payload:{venue:a,tournamentId:t.tournamentId},topic:cA,key:a.venueId}))}else return B6({matchUpsCount:s.length});return{...se}}function x6(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,s=vu(t);if(!Object.keys(s).length)return{error:yn};let o;for(let l of Object.values(s)){let c=$3e({tournamentRecord:l,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(c?.error)return c;o=!0}return o?{...se}:void 0}function $3e({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:rt};if(!n)return{error:Uw};if(!r||typeof r!="object")return{error:oA};let s=Kg({tournamentRecord:t,courtId:n});if(s.error)return s;let{venue:o,court:l}=s,c=Object.keys(H4e()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>c.includes(p)).length)return{error:oF};let u=new Set(c.filter(p=>!["dateAvailability"].includes(p))),d=Object.keys(r).filter(p=>u.has(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=N6({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||bi({payload:{venue:o,tournamentId:t.tournamentId},topic:cA,key:o?.venueId}),{...se,court:St(l)}}var H3e=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),V3e=H3e;function Jye(t){let{modifications:e,venueId:i,force:r}=t,n=vu(t);if(!Object.keys(n).length)return{error:yn};if(typeof i!="string")return{error:$g};let a,s;for(let o of Object.values(n)){let l=j3e({tournamentRecord:o,modifications:e,venueId:i,force:r});if(l.success&&(s=!0),l.error&&(a=l.error),l.error&&l.error!==tb)return l}return xR({tournamentRecords:n}),s?{...se}:{error:a}}function G3e({venue:t,modifications:e,tournamentRecord:i,venueMatchUps:r,allowModificationWhenMatchUpsScheduled:n}){let a=t?.courts?.map(c=>c.courtId)??[],s=e.courts?.map(c=>c.courtId)||[],o=s.length?a.filter(c=>!s.includes(c)):e?.courts&&a,l=[];if(o?.length){let c=t?.courts?.filter(u=>o.includes(u.courtId))?.map(u=>{let d=M6({courtId:u.courtId,tournamentRecord:i,venueMatchUps:r});for(let p of d.matchUps??[])l.push({matchUpId:p.matchUpId,drawId:p.drawId});return d.matchUps?.length??0}).reduce((u,d)=>u+d);return t&&(!c||n)?(t.courts=t.courts?.filter(u=>s.includes(u.courtId)),wP({schedule:{courtId:"",scheduledDate:""},matchUpDetails:l,removePriorValues:!0,tournamentRecord:i}),{success:!0}):B6({matchUpsCount:c})}return{success:!0}}function Q3e({modifications:t,tournamentRecord:e,venueMatchUps:i,venueId:r,force:n}){if(t.courts)for(let a of t.courts){let{courtId:s}=a||{},o=x6({modifications:a,disableNotice:!0,tournamentRecord:e,venueMatchUps:i,courtId:s,force:n});if(o?.error===Mm&&(o=XL({disableNotice:!0,tournamentRecord:e,venueId:r,court:a})),o?.error)return o}return{success:!0}}function j3e({tournamentRecord:t,modifications:e,venueId:i,force:r}){if(!t)return{error:rt};if(!e||typeof e!="object")return{error:oA};if(!i)return{error:$g};let n=er({tournamentRecord:t})?.appliedPolicies,a=r??n?.[Vg]?.allowDeletionWithScoresPresent?.venues,{matchUps:s}=B3e({tournamentRecord:t,venueId:i}),o=Hh({tournamentRecord:t,venueId:i});if(o.error)return o;let l=o.venue,c=Object.keys(V3e()).filter(h=>h!=="venueId");if(!Object.keys(e).filter(h=>c.includes(h)).length)return{error:oF};let u=new Set(c.filter(h=>!["courts","onlineResources"].includes(h))),d=Object.keys(e).filter(h=>u.has(h));if(!l)return{error:tb};d.forEach(h=>Object.assign(l,{[h]:e[h]}));let p=G3e({venue:l,modifications:e,tournamentRecord:t,venueMatchUps:s,allowModificationWhenMatchUpsScheduled:a});if("error"in p&&p.error)return p;let f=Q3e({modifications:e,tournamentRecord:t,venueMatchUps:s,venueId:i,force:r});return f?.error?f:(xR({tournamentRecord:t}),l&&bi({payload:{venue:l,tournamentId:t.tournamentId},topic:cA,key:l?.venueId}),{...se,venue:St(l)})}var Ri={};Fi(Ri,{JSON2CSV:()=>Z3e,UUID:()=>fr,UUIDS:()=>Ode,allNumeric:()=>eue,attributeFilter:()=>VI,chunkArray:()=>Oa,chunkByNth:()=>cj,chunkSizeProfile:()=>Jce,constantToString:()=>Bs,countValues:()=>K_e,createMap:()=>Wce,dateTime:()=>xde,definedAttributes:()=>Ft,dehydrateMatchUps:()=>W3e,extractAttributes:()=>Ffe,flattenJSON:()=>_6,generateDateRange:()=>AT,generateHashCode:()=>Q_e,generateRange:()=>gt,generateTimeCode:()=>_ve,groupValues:()=>Xce,hasAttributeValues:()=>G_e,instanceCount:()=>Vl,intersection:()=>Pn,isConvertableInteger:()=>yi,isNumeric:()=>Sn,isOdd:()=>Kce,isPowerOf2:()=>rp,makeDeepCopy:()=>St,matchUpScheduleSort:()=>q3e,matchUpSort:()=>Lw,nearestPowerOf2:()=>Zz,nextPowerOf2:()=>CC,noNulls:()=>W_e,noNumeric:()=>tue,numericSort:()=>la,occurrences:()=>X_e,overlap:()=>Bo,randomMember:()=>Bl,randomPop:()=>xl,shuffleArray:()=>To,structureSort:()=>Nw,subSort:()=>Z_e,undefinedToNull:()=>oj,unique:()=>Ci,visualizeScheduledMatchUps:()=>z3e});function z3e({scheduledMatchUps:t,showGlobalLog:e}){m2e();let i=t?.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:s}=t.find(o=>o.structureId===n);return{[n]:`${a} ${s}`}})};i?.forEach(n=>{vl({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let a=t.filter(o=>o.structureId===n),s=ko({matchUps:a})?.roundMatchUps||[];Object.keys(s).forEach(o=>{vl({roundNumber:o,keyColors:{roundNumber:"brightcyan"}},!0),s[o].forEach(({matchUpId:l,schedule:c})=>{let u=qr(c.scheduledTime);vl({matchUpId:l,time:u,date:c.scheduledDate,venue:c.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&h2e()}var{extractTime:zee,timeStringMinutes:qee}=xde;function q3e(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=qee(zee(i.scheduledTime)),a=qee(zee(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function W3e({tournamentRecord:t}){if(!t)return{error:rt};if(typeof t!="object"||!t.tournamentId)return{error:be};let{matchUps:e}=La({tournamentRecord:t,inContext:!1});if(e?.length){let i=K3e({tournamentRecord:t});X3e(e,i)}return{...se}}function K3e({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var Y3e=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function X3e(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,s=e[r]||e[n]||e[a],o=i.matchUpFormat===s?void 0:i.matchUpFormat;for(let l of Object.keys(i))Y3e.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}function Z3e(t,e){if(e&&typeof e!="object")return{error:be};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:s,onlyHeaderRow:o,columnAccessors:l=[],functionMap:c={},columnMap:u={},valuesMap:d={},context:p={},delimiter:f='"',columnJoiner:h=",",rowJoiner:m=`\r
`,keyJoiner:A="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof u!="object"||typeof i!="object"||typeof c!="object"||typeof d!="object"||typeof h!="string"||typeof m!="string"||typeof A!="string"||typeof f!="string")return{error:be};i=Object.assign({},...Object.keys(i).reverse().map(M=>({[M]:Array.isArray(i[M])?i[M]:[typeof i[M]=="string"&&i[M]].filter(Boolean)})));let g=t.filter(Boolean).map(M=>_6(M,A)),v=Object.values(i).flat();r&&l.push(...v);let b=g.reduce((M,N)=>Object.keys(N).every(k=>!M.includes(k)&&M.push(k)||!0)&&M,[]).filter(M=>!l?.length||l.includes(M)),y=Object.assign({},...Object.keys(i).reverse().map(M=>i[M].map(N=>({[N]:M})).flat()).flat()),I=(M,N)=>e?.sortOrder?e.sortOrder.includes(M)&&e.sortOrder.includes(N)&&e.sortOrder.indexOf(M)-e.sortOrder.indexOf(N)||!e.sortOrder.includes(N)&&-1:0,w=b.reduce((M,N)=>{let k=y[N];return k?M.includes(k)||M.push(k):M.push(N),M},[]).sort(I);Object.keys(u).forEach(M=>!w.includes(M)&&w.unshift(M)),Object.keys(i).forEach(M=>!w.includes(M)&&w.unshift(M)),typeof p=="object"&&Object.keys(p).forEach(M=>!w.includes(M)&&w.unshift(M));let S=w.map(M=>u[M]||M);if(o)return[S];let T=M=>`${f}${M}${f}`,D=[],C=M=>Object.values(w.reduce((N,k,O)=>{let x=i[k],F=(x?.length?M[x.find(G=>M[G])]:M[k])||p?.[k]||"",_=d[k]?.[F]||F,V=jo(c[k])?c[k](_):_;return N[k]=T(V),V&&(D[O]=(D[O]||0)+1),N},{})),E=g.map(C),P=s&&[...D].map((M,N)=>!M&&N).filter(Sn).reverse();if(P){let M=N=>N.filter((k,O)=>!P.includes(O));E=E.map(M),S=M(S)}let R=E.map(M=>M.join(h));return a?R.map(M=>{let N=M.split(h);return Object.assign({},...N.map((k,O)=>({[S[O]]:k})))}):n?[S.map(T).join(h),...R].join(m):R.join(m)}function _6(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,_6(t[n],e,i.concat(n))),{})}var J3e={},{FACTORY:Wee}=th;function eze({tournamentRecord:t,value:e}){let{extension:i}=Bi({element:t,name:Wee}),r={name:Wee,value:{...i?.value,...e}};lr({element:t,extension:r})}function t2({timeStamp:t}){let e=Hg(),i=Dq();return i&&Object.values(e).forEach(r=>{eze({tournamentRecord:r,value:{version:TC(),timeStamp:t}})}),i}function ebe({engineType:t,methodName:e,elapsed:i,params:r,result:n}){let a=Gl();if(typeof a!="object")return;let s={method:e},o=n?.error&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&a.params?.includes(e),c=a.params&&!Array.isArray(a.params)||l,u=Array.isArray(a.exclude)&&a.exclude.includes(e);!u&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(s.elapsed=i),!u&&(o||c)&&(s.params=r),!u&&(o||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&a.result?.includes(e))&&(s.result=n),Object.keys(s).length>1&&Cde(s,t)}function QR({methodName:t,params:e,start:i}){let r={error:x1,methodName:t},n=i?Date.now()-i:0;return ebe({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}function tze(t,e){if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:rt};let i=e.drawId||e.matchUp?.drawId;if(i){let{event:a,drawDefinition:s,tournamentId:o}=Xo({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),o&&(e.tournamentId=o),a&&(e.event=a)}if(e.eventId&&!e.event){let{event:a,tournamentId:s}=Xo({eventId:e.eventId,tournamentRecords:t});if(!a)return{error:cu};e.tournamentId=s,e.event=a}let r=e.tournamentId??Ew();if(!r&&e)return e;let n=t[r];return r&&!n?{error:rt}:(n&&(e.tournamentRecord=n),e)}function jR(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),s=Ew();i&&(i.activeTournamentId=s);let o=i?.tournamentRecord||Nq(s),l=typeof i?.tournamentRecord=="object"&&{[i?.tournamentRecord.tournamentId]:i.tournamentRecord}||Hg(),c=i?St(i,void 0,!0):void 0,u=i?tze(l,i):void 0;if(u?.error)return u;let d=ize({params:u,tournamentRecords:l,tournamentRecord:o,methodName:r,method:e}),p=Date.now()-a;return ebe({result:d,methodName:r,elapsed:p,params:c,engineType:n}),d}function ize({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(Gl())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return pF({engineName:"engine",methodName:r,params:i,err:a})}}function i2(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=kc();for(let s of[...a].sort(ibe)){let o=Rq({topic:s});o?.length&&X0({topic:s,notices:o})}e&&n&&a.includes(uP)&&X0({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:uP})}async function tbe(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=kc();for(let s of[...a].sort(ibe)){let o=Rq({topic:s});o&&await X0({topic:s,notices:o})}e&&n&&a.includes(uP)&&X0({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:uP})}var Kee={[TW]:5,[UW]:5,[CW]:5,[SW]:5,[wW]:5,[bW]:5,[Zpe]:5,[Jpe]:5,[IW]:1,[BF]:1,[Fs]:5,[cA]:5,[yW]:4,[AW]:4,[gW]:4,[vW]:4,[NF]:3,[fW]:2};function ibe(t,e){return(Kee[e]||0)-(Kee[t]||0)}function rze({convertExtensions:t,removeExtensions:e}){let i=Hg();return{tournamentId:Ew(),tournamentRecords:St(i,t,!1,e)}}function nze(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=t?.tournamentId??Ew();if(typeof r!="string")return{};let n=Nq(r);return{tournamentRecord:St(n,e,!1,i)}}function aze(){let t=Hg(),{extension:e}=Bi({name:Uy,tournamentRecords:t,discover:!0}),i=e?.value?.tournamentIds||[];return Object.keys(t).forEach(r=>{i.includes(r)||delete t[r]}),dF(t)}function Yee(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:oA}:t?.tournamentId?Ude(e?St(t):t):{error:be}}function YI(t,e=!0){if(typeof t!="object")return{error:oA};if(Z0(),Array.isArray(t)){if(t.filter(i=>i?.tournamentId).length!==t.length)return{error:dj};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t?.tournamentId)t={[t.tournamentId]:t},Z0(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:dj};return dF(e?St(t):t)}async function sze(t,e,i){if(!Array.isArray(e))return{error:be,message:"directives must be an array"};let r=Pq(),n=Date.now(),a=i&&St(Hg(),!1,!0),s=[];for(let c of e){if(typeof c!="object")return{error:be,message:"directive must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!r[u])return QR({methodName:u,start:n,params:p});if(d){let h=s.at(-1),m=Object.keys(d);for(let A of m)h[A]&&(p[A]=h[A])}let f=jR(t,r[u],p,u,"async");if(f?.error)return a&&YI(a),{...f,rolledBack:!!a};s.push({...f,methodName:u})}let o=Date.now(),l=t2({timeStamp:o});return await tbe({directives:e,mutationStatus:l,timeStamp:o}),Cw(),{success:s.every(c=>c.success),results:s}}async function Xee(t,e){if(!Ki(e))return{error:be,message:"args must be an object"};let i=Object.values(e).filter(jo).length;if(i>1)return{message:"there must be only one arg with typeof function",error:be};let r=i?Object.keys(e).find(f=>jo(e[f])):Lr(e.method)&&e.method;if(!r)return{error:x1};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=s.rollbackOnError&&St(Hg(),!1,!0),l=n||t[r]||lF()[r];if(!l)return QR({methodName:r,params:s});let c=await jR(t,l,s,r,"async")??{};c?.error&&o&&YI(o);let u=Date.now(),d=t2({timeStamp:u}),p=c?.success&&s?.delayNotify!==!0&&s?.doNotNotify!==!0;return p&&await tbe({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:u}),(p||!c?.success||s?.doNotNotify)&&Cw(),c}function oze(t,e,i,r,n,a){let s=Ede(i,r,n,a);if(s.error)return s;let o=s.methods??[];return Object.keys(o).filter(l=>jo(o[l])).forEach(l=>{t[l]=c=>{let u=()=>e(t,{[l]:o[l],...c});if(Gl())return u();try{return u()}catch(d){pF({engineName:"engine",methodName:l,params:c,err:d})}}}),{...se,...t}}function WS(t,e){return e?.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function O6(t,e){t.importMethods=(i,r,n,a)=>oze(t,e,i,r,n,a),t.getTournament=i=>nze(i),t.getState=i=>rze({convertExtensions:i?.convertExtensions,removeExtensions:i?.removeExtensions}),t.version=()=>TC(),t.reset=()=>(dF({}),WS(t)),t.devContext=i=>(K0(i),WS(t)),t.getDevContext=i=>Gl(i),t.newTournamentRecord=(i={})=>{let r=KL(i),n=r.tournamentId;return r.error?r:(Yee(r),Z0(n),{...se,tournamentId:n})},t.setState=(i,r,n)=>{Y0(r,n);let a=YI(i,r);return WS(t,a)},t.setTournamentId=i=>Z0(i),t.getTournamentId=()=>Ew(),t.setTournamentRecord=(i,r,n)=>{Y0(r,n);let a=Yee(i,r);return WS(t,a)},t.removeTournamentRecord=i=>{let r=Tde(i);return WS(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=aze();return WS(t,i)}}function lze(t){let e=yde();if(e.error&&!t)return e;let i={executionQueue:(r,n)=>sze(i,r,n),execute:r=>Xee(i,r)};return O6(i,Xee),i}function cze(t,e,i){if(!Array.isArray(e))return{error:be,message:"directives must be an array"};let r=Pq(),n=Date.now(),a=i&&St(Hg(),!1,!0),s=[];for(let c of e){if(typeof c!="object")return{error:be,message:"directive must be an object"};if(c.params&&typeof c.params!="object")return{error:be,message:"params must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!r[u])return QR({methodName:u,start:n,params:p});if(d){let h=s.at(-1),m=Object.keys(d);for(let A of m)h[A]&&(p[A]=h[A])}let f=jR(t,r[u],p,u,"sync");if(f?.error)return a&&YI(a),{...f,rolledBack:!!a};s.push({...f,methodName:u})}let o=Date.now(),l=t2({timeStamp:o});return i2({directives:e,mutationStatus:l,timeStamp:o}),Cw(),{success:s.every(c=>c.success),results:s}}function Zee(t,e){if(!Ki(e))return{error:be,message:"args must be an object"};let i=Object.values(e).filter(jo).length;if(i>1)return{message:"there must be only one arg with typeof function",error:be};let r=i?Object.keys(e).find(f=>jo(e[f])):Lr(e.method)&&e.method;if(!r)return{error:x1};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=s.rollbackOnError&&St(Hg(),!1,!0),l=n||t[r]||lF()[r];if(!l)return QR({methodName:r,params:s});let c=jR(t,l,s,r,"sync")??{};c?.error&&o&&YI(o);let u=Date.now(),d=t2({timeStamp:u}),p=c?.success&&s?.delayNotify!==!0&&s?.doNotNotify!==!0;return p&&i2({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:u}),(p||!c?.success||s?.doNotNotify)&&Cw(),c}var rbe=(()=>{let t={executionQueue:(e,i)=>cze(t,e,i),execute:e=>Zee(t,e)};return O6(t,Zee),t})(),zR=rbe;function Jee(t,e){if(!Ki(e))return{error:be,message:"args must be an object"};let i=Object.values(e).filter(jo).length;if(i>1)return{message:"there must be only one arg with typeof function",error:be};let r=i?Object.keys(e).find(l=>jo(e[l])):Lr(e.method)&&e.method;if(!r)return{error:x1};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=n||t[r]||lF()[r];return o?jR(t,o,s,r,"ask"):QR({methodName:r,params:s})}var uze=(()=>{let t={execute:e=>Jee(t,e)};return O6(t,Jee),t})(),wI={},JA;function nbe(t,e=!0){if(!t)return{error:Kt};if(typeof t!="object")return{error:oA};if(t.matchUpId)JA=t.matchUpId,wI[JA]=e?St(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(wI[i.matchUpId]=e?St(i):i,JA||(JA=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(wI[i.matchUpId]=e?St(i):i,JA||(JA=i.matchUpId));return e?St(t):t}function dze(){return wI[JA]}function pze(){return Object.values(wI)}function fze(){JA=void 0,wI={}}function hze(t){return St(wI[JA],t?.convertExtensions,!1,t?.removeExtensions)}var mze=(()=>{let t={getState:i=>hze(i),version:()=>TC(),reset:()=>(fze(),{...se}),drawId:void 0,error:void 0,success:!1,devContext:i=>(K0(i),t),setState:(i,r,n)=>{Y0(r,n);let a=nbe(i);return e(a)}};function e(i){return i?.error?(t.error=i.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=i.drawId),t}return Aze(t,[ry]),t})();function Aze(t,e){e.forEach(i=>{Object.keys(i).forEach(r=>{t[r]=n=>{if(Gl())return ete(t,{params:n,governor:i,methodName:r});try{return ete(t,{params:n,governor:i,methodName:r})}catch(a){pF({engineName:"matchUpEngine",methodName:r,params:n,err:a})}}})})}function ete(t,{params:e,governor:i,methodName:r}){t.error=void 0,t.success=!1;let n=e?.matchUp||dze(),a=e?.matchUps||pze(),s=e?.rollbackOnError&&St(n,!1,!0);e={...e,matchUpId:n?.matchUpId,matchUps:a,matchUp:n};let o=i[r](e);if(o?.error)return s&&nbe(s),{...o,rolledBack:!!s};let l=o?.success&&e?.delayNotify!==!0&&e?.doNotNotify!==!0;return l&&i2(),(l||!o?.success||e?.doNotNotify)&&Cw(),o}var MV=!1,r2=(()=>{let t={version:()=>TC(),setDeepCopy:(n,a)=>(Y0(n,a),t),devContext:n=>(K0(n),MV=!0,t)};return i([jL]),t;function e(n,a){let s=n({...a});return s?.error||i2(),Cw(),MV&&(K0(!1),MV=!1),s}function i(n){n.forEach(a=>{Object.keys(a).forEach(s=>{t[s]=r(a,s)})})}function r(n,a){return s=>{if(Gl()){let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&YI(o.tournamentRecord),o}else try{let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&YI(o.tournamentRecord),o}catch(o){let l;typeof o=="string"?l=o.toUpperCase():o instanceof Error&&(l=o.message),console.log("ERROR",{params:JSON.stringify(s),method:a,error:l})}}}})();zR.importMethods(Wz,!0,1);var Jd=zR,Ge=zR,gze={getTournamentPoints:IL},vze=gze,yze={calculateNewRatings:zme,generateDynamicRatings:qme},bze=yze,Ize={...vze,...bze};zR.importMethods(Ize);var wze=zR,Sze={[oP]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},Uze={[bh]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[yI,i0]}},Tze={[bh]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[yI,AP,WI],disabledActions:[]}]}},Cze={[bh]:{policyName:"positionActionsDisabled",enabledStructures:!1}},Eze={[OC]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},Dze={[du]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:td,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[Ut]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[ql]:[],[Df]:[],[Mr]:[],[Wl]:[],[Fa]:[],[Xr]:[]}}},NV="Personal circumstance",Pze={[du]:{requireAllPositionsAssigned:!1,stage:{[Ut]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:td,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:td,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[ql]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[Df]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[Wl]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[Mr]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[Xr]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:NV,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[Fa]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:NV,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[Ih]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:NV,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},Rze={[Wu]:{seedingProfile:{positioning:$1},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},Mze={POLICY_AVOIDANCE_COUNTRY:Sze,POLICY_POSITION_ACTIONS_DEFAULT:Dme,POLICY_POSITION_ACTIONS_DISABLED:Cze,POLICY_POSITION_ACTIONS_NO_MOVEMENT:Tze,POLICY_POSITION_ACTIONS_UNRESTRICTED:Uze,POLICY_PRIVACY_DEFAULT:Eze,POLICY_ROUND_NAMING_DEFAULT:xW,POLICY_SCHEDULING_DEFAULT:tge,POLICY_SCORING_DEFAULT:Dze,POLICY_SCORING_USTA:Pze,POLICY_SEEDING_ITF:Rze,POLICY_SEEDING_DEFAULT:HAe},vg={ratingsParameters:za,matchUpFormats:bFe,countryToFlag:ofe,tieFormats:mge,countries:ng,policies:Mze,flagIOC:uLe},Qn={};Fi(Qn,{activeMatchUpStatuses:()=>MF,auditConstants:()=>yge,completedMatchUpStatuses:()=>qn,directingMatchUpStatuses:()=>cW,displayConstants:()=>Eme,drawDefinitionConstants:()=>Wn,entryStatusConstants:()=>Iu,errorConditionConstants:()=>Ade,eventConstants:()=>Ul,extensionConstants:()=>th,flightConstants:()=>Nge,genderConstants:()=>Fh,keyValueConstants:()=>Q5,matchUpActionConstants:()=>B5,matchUpStatusConstants:()=>pW,matchUpTypes:()=>Yz,nonDirectingMatchUpStatuses:()=>uW,particicipantsRequiredMatchUpStatuses:()=>oW,participantConstants:()=>io,participantRoles:()=>Yg,participantTypes:()=>XU,penaltyConstants:()=>abe,policyConstants:()=>Gg,positionActionConstants:()=>Qw,ratingConstants:()=>eme,recoveryTimeRequiredMatchUpStatuses:()=>Wpe,requestConstants:()=>pve,resourceContants:()=>_de,resultConstants:()=>rue,scaleConstants:()=>xC,scheduleConstants:()=>kfe,sortingConstants:()=>xge,surfaceConstants:()=>sbe,tieFormatConstants:()=>ype,timeItemConstants:()=>HF,topicConstants:()=>rfe,tournamentConstants:()=>P6,upcomingMatchUpStatuses:()=>dW,validMatchUpStatuses:()=>lW,venueConstants:()=>obe,weekdayConstants:()=>_K});var Nze="Coaching",Bze="Ball Abuse",kze="Racket Abuse",xze="Verbal Abuse",_ze="INELIGIBILITY",Oze="Physical Abuse",Fze="Unsportmanlike Conduct",Lze="Dress Code Violation",$ze="Equipment Violation",Hze="Leaving the court",Vze="Failure to complete",Gze="No Show",Qze="Other",jze="REFUSAL_TO_PLAY",zze="PROHIBITED_SUBSTANCE",qze="Puncuality",Wze="Failure to sign in",abe={COACHING:Nze,BALL_ABUSE:Bze,RACKET_ABUSE:kze,VERBAL_ABUSE:xze,PHYSICAL_ABUSE:Oze,INELIGIBILITY:_ze,UNSPORTSMANLIKE_CONDUCT:Fze,PROHIBITED_SUBSTANCE:zze,DRESS_CODE_VIOLATION:Lze,EQUIMENT_VIOLATION:$ze,LEAVING_THE_COURT:Hze,REFUSAL_TO_PLAY:jze,FAILURE_TO_COMPLETE:Vze,NO_SHOW:Gze,OTHER:Qze,PUNCTUALITY:qze,FAILUIRE_TO_SIGN_IN:Wze},Kze="CLAY",Yze="HARD",Xze="GRASS",Zze="CARPET",Jze="ARTIFICIAL",sbe={CLAY:Kze,HARD:Yze,GRASS:Xze,CARPET:Zze,ARTIFICIAL:Jze},eqe="INDOOR",tqe="OUTDOOR",obe={INDOOR:eqe,OUTDOOR:tqe};const r4=Object.freeze(Object.defineProperty({__proto__:null,activeMatchUpStatuses:MF,askEngine:uze,asyncEngine:lze,auditConstants:yge,competitionEngine:Jd,competitionGovernor:Kz,completedMatchUpStatuses:qn,directingMatchUpStatuses:cW,displayConstants:Eme,drawDefinitionConstants:Wn,drawsGovernor:rW,entriesGovernor:MK,entryStatusConstants:Iu,errorConditionConstants:Ade,eventConstants:Ul,eventGovernor:kK,extensionConstants:th,factoryConstants:Qn,fixtures:vg,flightConstants:Nge,forge:J3e,genderConstants:Fh,generationGovernor:QK,globalState:KU,governors:Wz,keyValueConstants:Q5,matchUpActionConstants:B5,matchUpEngine:mze,matchUpFormatCode:Xx,matchUpFormatGovernor:Xx,matchUpGovernor:qK,matchUpStatusConstants:pW,matchUpTypes:Yz,mocksEngine:r2,mocksGovernor:jL,nonDirectingMatchUpStatuses:uW,particicipantsRequiredMatchUpStatuses:oW,participantConstants:io,participantGovernor:y6,participantRoles:Yg,participantTypes:XU,penaltyConstants:abe,policyConstants:Gg,policyGovernor:eK,positionActionConstants:Qw,publishingGovernor:ZL,queryGovernor:NR,ratingConstants:eme,recoveryTimeRequiredMatchUpStatuses:Wpe,reportGovernor:I6,requestConstants:pve,resourceContants:_de,resultConstants:rue,scaleConstants:xC,scaleEngine:wze,scheduleConstants:kfe,scheduleGovernor:w6,scoreGovernor:ry,sortingConstants:xge,surfaceConstants:sbe,syncEngine:rbe,tieFormatConstants:ype,tieFormatGovernor:U6,timeItemConstants:HF,tools:Ri,topicConstants:rfe,tournamentConstants:P6,tournamentEngine:Ge,tournamentGovernor:D6,upcomingMatchUpStatuses:dW,utilities:Ri,validMatchUpStatuses:lW,venueConstants:obe,venueGovernor:R6,version:TC,weekdayConstants:_K},Symbol.toStringTag,{value:"Module"})),{AFTER_REST:lbe,FOLLOWED_BY:cbe,NEXT_AVAILABLE:ube,NOT_BEFORE:dbe,TO_BE_ANNOUNCED:pbe}=Qn.timeItemConstants,{SCHEDULE_ERROR:iqe,SCHEDULE_CONFLICT:rqe,SCHEDULE_WARNING:nqe}=Qn.scheduleConstants,{ORGANISER_ACCEPTANCE:aqe,DIRECT_ACCEPTANCE:sqe,SPECIAL_EXEMPT:oqe,JUNIOR_EXEMPT:lqe,ALTERNATE:cqe,WILDCARD:uqe}=Iu,tte="All event types",fbe="All statuses",n4="All genders",SP="All flights",ite="All rounds",yg="All events",dqe="No events",hbe="All teams",mbe="All Types",pqe="Any team",Abe="registration",fqe="timepicker",hqe="timevalue",n0="tmxContent",gbe="tmxDrawer",UP="splash",n2="superadmin",vbe="admin",a2="competitionEngine",mqe="tournamentEngine",Uh="tournaments",ybe="drawEntries",js="tournament",a4="structure",bbe="invite",Xb="event",DD="draw",s4="view",TP="tournamentEvents",aE="overview",Vm="participants",Ny="schedule",F6="matchUps",jf="events",L6="venues",Aqe="unscheduled",qR={success:!0},gqe=10,vqe="courtDoubleBooking",yqe="ISSUE",Zc="Automated",$6="Manual",o4={[iqe]:"matchup-error",[rqe]:"matchup-conflict",[yqe]:"matchup-issue",[nqe]:"matchup-warning"},a_="tournamentParticipants",bqe="scheduledDateFilter",ny="unscheduledMatchUps",s2="tournamentsCalendar",s_="tournamentMatchUps",o_="tournamentSchedule",l4="tournamentsTable",l_="tournamentTeams",c_="venuesTable",Ibe="entriesCount",wbe="eventsTable",CP="tmxOverlay",H6="teamStats",V6="drawControl",Iqe="drawFrame",Sbe="drawRight",Ube="drawLeft",Tbe="entriesView",df="drawsView",WR="QUALIFYING",Qu="ACCEPTED",Cbe="eventInfo",G6="acceptedPanel",Q6="alternatesPanel",j6="qualifyingPanel",z6="ungroupedPanel",q6="withdrawaPanel",Ebe="unscheduledVisibility",Dbe="tournamentsControl",W6="participantControl",K6="unscheduledControl",Y6="scheduleControl",X6="matchUpsControl",Z6="venuesControl",J6="eventsControl",sE="eventControl",e8="teamsControl",wqe="controlBar",Pbe="buttonBar",tI="tmxPanel",Rbe="tmxTable",Mbe="tcContainer",sa="overlay",si="center",u_="header",Ht="right",ii="left",wd="bottom",rte="top",o2="subTable",NT="",nB="flex",jt="none",Nbe="isOpen",t8="Collection value",i8="Match value",r8="Score value",n8="Set value",tD={[lbe]:"After rest",[cbe]:"Followed by",[pbe]:"To be announced",[ube]:"Next available",[dbe]:"Not before"},Sqe={[lbe]:"After rest",[cbe]:"Followed by",[pbe]:"TBA",[ube]:"Next available",[dbe]:"NB"},Bbe={[aqe]:"OA",[sqe]:"DA",[oqe]:"SE",[lqe]:"JE",[WR]:"QUAL",[cqe]:"ALT",[uqe]:"WC"},d_="Playoff",_v="drawSize",p_="CUSTOM",bU="advancePerGroup",f_="qualifiersCount",h_="groupRemaining",a8="matchUpFormat",kbe="seedingPolicy",EP="structureName",a0="playoffType",mm="groupSize",xbe="positions",XI="drawName",Kf="drawType",s0="top",Uqe="winners",c4="roundsColumns",BT="roundsStats",kT="roundsTable",ZI="utr",DP="wtn",o0={},Tqe={position:"top-right",clickClose:!0,duration:2e3,offsetBottom:0,offsetRight:0,offsetLeft:0,offsetTop:0,opacity:1},Cqe=(t,e,i,r,n)=>{const a=t.split("-"),s=a.includes(ii)&&`left:${r}`,o=a.includes(Ht)&&`right:${n}`,l=a.includes("top")&&`top:${e}`,c=a.includes("bottom")&&`bottom:${i}`,u="align-items: "+(a.includes("left")&&"flex-start"||a.includes("right")&&"flex-end"||si),d="text-align: "+(a.includes("left")&&"left"||a.includes("right")&&"right"||si);return[s,o,l,c,u,d].filter(Boolean).join(";")};function Eqe(t){if(o0.position)return o0.position;const e=document.createElement("div");return e.style.cssText="position: fixed; display: flex; flex-direction: column; width:100%; z-index: 9999; pointer-events: none;padding:15px;"+Cqe(t.position,t.offsetTop,t.offsetBottom,t.offsetLeft,t.offsetRight),(t.appendTo||document.body).appendChild(e),o0.position=e,e}function Dqe(t){if(!t.message)return{error:"Missing message"};const e={...Tqe,...t},i=Eqe(e),r=Pqe(e);if(e.onlyOne){let n=i.lastElementChild;for(;n;)i.removeChild(n),n=i.lastElementChild}i.appendChild(r.element)}function Pqe(t){const e=document.createElement("div");t.clickClose&&e.addEventListener("click",()=>a(t.onClose));const i=t.duration&&$_e(()=>a(t.onClose),t.duration);i&&t.pauseOnHover&&(e.addEventListener("mouseover",i.pause),e.addEventListener("mouseout",i.resume)),e.style.cssText=`display:inline-flex;width:auto;pointer-events:auto;white-space:pre-wrap;opacity:${t.opacity};${t.dismissible?"":"padding: 1.25rem, 1.5rem;"}`;const r=["notification"];if(typeof t.classList=="string"&&r.push(t.classList),t.type&&r.push(t.type),t?.animate?.in){const l=t.animate.speed?`animate__${t.animate.speed}`:"animate__faster",c=`animate__${t.animate.in}`;r.push(`animate__animated ${c} ${l}`),o(()=>e.classList.remove(c))}if(e.className=r.join(" "),t.dismissible){const l=document.createElement("button");l.className="delete",l.addEventListener("click",()=>a(t.onClose)),e.insertAdjacentElement("afterbegin",l)}const n=document.createElement("div");if(n.style.cssText="display: flex; flex-direction: row; align-items: center; justify-content: center;",typeof t.message=="string"?n.insertAdjacentHTML("beforeend",t.message):t.message&&console.log(" MESSAGE ",t.message,typeof t.message),Mt(t.action?.onClick)){const l=document.createElement("button");l.style.cssText="margin-left: 1em;",l.className="button",l.innerHTML=t.action.text||"OK",l.addEventListener("click",t.action.onClick),n.appendChild(l)}return e.appendChild(n),{element:e};function a(l){Mt(l)&&l(),t?.animate?.out?(e.classList.add(`animate__${t.animate.out}`),o(()=>{s(e.parentNode),delete o0.position,e.remove()})):(s(e.parentNode),delete o0.position,e.remove())}function s(l){l&&l.children.length<=1&&l.remove()}function o(l=()=>{}){const c={WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",animation:"animationend"};for(const u in c)if(e.style[u]!==void 0){e.addEventListener(c[u],()=>l());break}}}function Pt(t){const{position:e="top-center",intent:i="is-success",pauseOnHover:r=!1,dismissible:n=!0,clickClose:a=!0,duration:s=2500,single:o=!0,onClose:l,offsetBottom:c=0,offsetRight:u=0,offsetLeft:d=0,offsetTop:p=0,opacity:f=1,message:h,action:m}=t??{};Dqe({animate:{in:"fadeIn",out:"fadeOut"},pauseOnHover:r,offsetBottom:c,type:i,offsetRight:u,dismissible:n,offsetLeft:d,clickClose:a,offsetTop:p,duration:s,position:e,message:h,onClose:l,opacity:f,action:m,single:o})}function Rqe(){Pt({intent:"is-success",message:"New Version Cached: Close Tab or Browser and Re-open to Update"})}function Mqe(){const t=`${Rm.tr("phrases.blocked")}. ${Rm.tr("phrases.enablepopups")}`;Pt({intent:"is-danger",message:t})}function Nqe(){const t=document.createElement("div");return t.className="is-marginless",t.style.width="inherit",t.id="o-tab",t.innerHTML=`
    <div class="tab_section events_tab">
        <div class="section">
            <div id=${aE} class="box tournament-information">
            </div>
        </div>
    </div>
  `,t}function Bqe(){const t=document.getElementById("dnav");if(!t)return;const e=window.pageXOffset!=null,i=(document.compatMode||"")==="CSS1Compat";let r=0;const n=()=>{let c;e?c=window.pageYOffset:c=i?document.documentElement.scrollTop:document.body.scrollTop;let u;return c>r?u=!0:u=!1,r=c,u},a=()=>{n()&&!t.contains(document.activeElement)?(t.classList.add("scroll-down"),t.classList.remove("scroll-up")):(t.classList.add("scroll-up"),t.classList.remove("scroll-down"))};let s;const o=(c,u)=>{s||(s=!0,setTimeout(()=>{c(),s=!1},u))},l=window.matchMedia("(prefers-reduced-motion: reduce)");window.addEventListener("scroll",()=>{l&&!l.matches&&o(a,250)},{passive:!0})}function kqe(){const t=document.createElement("div");return t.className="is-marginless",t.style.width="inherit",t.id="e-tab",t.innerHTML=`
  <div class="tab_section events_tab">
    <div class="section">
      <div class='tabHeader foreground'></div>
      <div id=${Cbe} class="block" style='display: none; width: 100%;'>
        <div id=${sE} class="controlBar" style='min-height: 3em; border-radius: 6px;'}></div>
      </div>
      <div id=${wbe}>
        <div id=${J6} class="controlBar"></div>
        <div id=${TP} class="tableClass flexcol flexcenter">
          {' '}
        </div>
      </div>
      <div id=${Tbe} style='display: none;'>
        <div id=${G6} class='tableClass block ${tI}'>
          {' '}
        </div>
        <div id=${j6} class='tableClass block ${tI}'>
          {' '}
        </div>
        <div id=${Q6} class='tableClass block ${tI}'>
          {' '}
        </div>
        <div id=${z6} class='tableClass block ${tI}'>
          {' '}
        </div>
        <div id=${q6} class='tableClass block ${tI}'>
          {' '}
        </div>
      </div>
      <div style="width: 100%; margin: 0">
        <div id=${V6}></div>
        <div id=${Iqe} class="flexrow flexjustifystart" style="width: 100%">
          <div id=${Ube} ></div>
          <div
            id=${df}
            style="overflow-x: scroll; width: 100%; display: none;"
          >
          </div>
          <div id=${Sbe} ></div>
        </div>
      </div>
    </div>
  </div>
  `,t}const xqe=""+new URL("orgLogo-DsK9KK2k.png",import.meta.url).href;function _qe(){const t=document.createElement("img");return t.style.maxWidth="800px",t.style.width="100%",t.alt="tmxLogo",t.src=xqe,t}function Oqe(){const t=document.getElementById("root");t.appendChild(Fqe());const e=document.createElement("div");e.className="flexrow flexcenter",e.id=UP,e.style.cssText="margin-top: 2em; padding-top: 5em; display: none;",e.appendChild(_qe()),t.appendChild(e);const i=document.createElement("div");i.style.display=jt,i.id=fqe;const r=document.createElement("input");r.className="timepicker-ui-input",r.id=hqe,r.type="text",i.appendChild(r),t.appendChild(i);const n=document.createElement("section");n.className="drawer drawer--left",n.dataset.drawerTarget="",n.id=gbe,n.innerHTML=`
      <div class="drawer__overlay" data-drawer-close tabIndex="-1"></div>
      <div class="drawer__wrapper">
        <div class="drawer__header">
          <div class="drawer__title"></div>
          <button
            class="drawer__close"
            style='display: none;'}
            data-drawer-close
            aria-label="Close Drawer"
          ></button>
        </div>
        <div class="drawer__content"></div>
        <div class="drawer__footer"></div>
      </div>
  `,t.appendChild(n);const a=document.getElementById("navMain"),s=document.createElement("div");s.id=n0,s.className="springboard flexrow flexcenter",s.style.display=jt;const o=document.createElement("div");o.id="navText",o.className="navText",o.style.display=jt,s.appendChild(o);const l=document.createElement("div");l.id=Mbe,l.className="flexcol flexcenter tournament_container",l.appendChild(Nqe()),l.appendChild(kqe()),s.appendChild(l),a.appendChild(s);const c=document.createElement("div");c.className="flexcol flexgrow",c.style.display=jt,c.id=Uh;const u=document.createElement("div");u.className="controlBar flexcol flexgrow flexcenter",u.id=Dbe,c.appendChild(u);const d=document.createElement("div");d.className="flexcol flexgrow flexcenter box",d.id=l4,c.appendChild(d),a.appendChild(c);const p=document.createElement("div");return p.className="flexcol flexgrow",p.style.paddingTop="3em",p.style.display=jt,p.style.height="90%",p.style.width="100%",p.id=s2,a.appendChild(p),Bqe(),t}function Fqe(){const t=document.createElement("div");return t.innerHTML=`<div id='dnav'>
    <div class="navbar-item" style="display: flex; flex-wrap: nowrap">
      <div id="provider" style="display: flex; flex-direction: column">
        <div style="font-size: .6em">TMX</div>
      </div>
      <div style="padding-left: 1em" id="pageTitle"> </div>
    </div>
    <div id='trnynav' class="navbar-item" style="display: flex; flex-direction: row;">
      <i id='o-route' class="nav-icon fa-solid fa-trophy"></i>
      <i id='p-route' class="nav-icon fa-solid fa-user-group" style="color: blue"></i>
      <i id='e-route' class="nav-icon fa-solid fa-diagram-project"></i>
      <i id='m-route' class="nav-icon fa-solid fa-table-tennis-paddle-ball"></i>
      <i id='s-route' class="nav-icon fa-solid fa-clock"></i>
      <i id='v-route' class="nav-icon fa-solid fa-location-dot"></i>
    </div>
    <div class="navbar-item" style="font-size: 1em">
      <i id="config" class="fa-solid fa-sliders"></i>
      <i id="login" style="padding-left: .5em" class="fa-solid fa-circle-user"></i>
    </div>
  </div>
  <main id="navMain"></main>`,t}function Lqe(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(t=>{t.unregister()})}function fo(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const _k={[aE]:"o-tab",[Vm]:"p-tab",[jf]:"e-tab",[F6]:"m-tab",[Ny]:"s-tab",[L6]:"v-tab"};function $qe(){const t=`
        <div id='individuals' class='tab_section participants_tab'>
          <div class='section'>
            <div class='tabHeader foreground'>Participants</div>
            <div id='${W6}' class='controlBar'></div>
            <div id='${a_}' class='tableClass flexcol flexcenter'> </div>
          </div>
        </div>
        <div id='participantGroupings' class='tab_section participants_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${e8}' class='controlBar'></div>
              <div id='${l_}' class='tableClass flexcol flexcenter'> </div>
            </div>
        </div>
        `,e=`
        <div class='tab_section sch_tab'>
            <div class='section block'>
              <div id='${Ebe}' style='width: 100%; display: none;'>
                  <div id='${K6}' class='controlBar flexcol flexcenter'></div>
                  <div id='${ny}' class='tableClass flexcol flexcenter'></div>
              </div>
              <div>
                  <div id='${Y6}' class='controlBar flexcol flexcenter'></div>
                  <div id='${o_}' class='tableClass flexcol flexcenter'></div>
              </div>
            </div>
        </div>
        `,i=`
        <div class='tab_section venues_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${Z6}' class='controlBar'></div>
              <div id='${c_}' class='tableClass flexcol flexcenter'></div>
            </div>
        </div>
        `,r=`
        <div class='tab_section matchUps_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${X6}' class='controlBar'></div>
              <div id='${H6}' class='controlBar'></div>
              <div id='${s_}' class='tableClass flexcol flexcenter'> </div>
            </div>
        </div>
        `,n={"p-tab":t,"s-tab":e,"v-tab":i,"m-tab":r},a=document.getElementById(Mbe);Object.keys(n).forEach(s=>{const o=document.createElement("div");o.className="is-marginless",o.style.cssText="width: inherit",o.id=s,o.innerHTML=n[s],a.appendChild(o)}),_be(Vm)}function _be(t){return Object.keys(_k).includes(t)?(Object.keys(_k).forEach(e=>{const i=_k[e],r=document.getElementById(i);r?r.style.display=t===e?"":jt:console.log({key:e,id:i,element:r})}),{...qR}):!1}function Hqe(){[df,J6,X6,W6,K6,sE,e8,Y6,Z6,H6,G6,Q6,j6,z6,q6,TP,s_,a_,o_,l_,ny,c_].forEach(e=>{const i=_k[e],r=document.getElementById(i);r&&fo(r)})}function Obe(){return"tmxToken"}function Fbe(t,e){return function(){return t.apply(e,arguments)}}const{toString:Vqe}=Object.prototype,{getPrototypeOf:s8}=Object,{iterator:l2,toStringTag:Lbe}=Symbol,c2=(t=>e=>{const i=Vqe.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Gh=t=>(t=t.toLowerCase(),e=>c2(e)===t),u2=t=>e=>typeof e===t,{isArray:oE}=Array,xT=u2("undefined");function KR(t){return t!==null&&!xT(t)&&t.constructor!==null&&!xT(t.constructor)&&ad(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const $be=Gh("ArrayBuffer");function Gqe(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&$be(t.buffer),e}const Qqe=u2("string"),ad=u2("function"),Hbe=u2("number"),YR=t=>t!==null&&typeof t=="object",jqe=t=>t===!0||t===!1,Ok=t=>{if(c2(t)!=="object")return!1;const e=s8(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Lbe in t)&&!(l2 in t)},zqe=t=>{if(!YR(t)||KR(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},qqe=Gh("Date"),Wqe=Gh("File"),Kqe=Gh("Blob"),Yqe=Gh("FileList"),Xqe=t=>YR(t)&&ad(t.pipe),Zqe=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||ad(t.append)&&((e=c2(t))==="formdata"||e==="object"&&ad(t.toString)&&t.toString()==="[object FormData]"))},Jqe=Gh("URLSearchParams"),[eWe,tWe,iWe,rWe]=["ReadableStream","Request","Response","Headers"].map(Gh),nWe=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function XR(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let r,n;if(typeof t!="object"&&(t=[t]),oE(t))for(r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else{if(KR(t))return;const a=i?Object.getOwnPropertyNames(t):Object.keys(t),s=a.length;let o;for(r=0;r<s;r++)o=a[r],e.call(null,t[o],o,t)}}function Vbe(t,e){if(KR(t))return null;e=e.toLowerCase();const i=Object.keys(t);let r=i.length,n;for(;r-- >0;)if(n=i[r],e===n.toLowerCase())return n;return null}const cI=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Gbe=t=>!xT(t)&&t!==cI;function u4(){const{caseless:t,skipUndefined:e}=Gbe(this)&&this||{},i={},r=(n,a)=>{if(a==="__proto__"||a==="constructor"||a==="prototype")return;const s=t&&Vbe(i,a)||a;Ok(i[s])&&Ok(n)?i[s]=u4(i[s],n):Ok(n)?i[s]=u4({},n):oE(n)?i[s]=n.slice():(!e||!xT(n))&&(i[s]=n)};for(let n=0,a=arguments.length;n<a;n++)arguments[n]&&XR(arguments[n],r);return i}const aWe=(t,e,i,{allOwnKeys:r}={})=>(XR(e,(n,a)=>{i&&ad(n)?Object.defineProperty(t,a,{value:Fbe(n,i),writable:!0,enumerable:!0,configurable:!0}):Object.defineProperty(t,a,{value:n,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:r}),t),sWe=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),oWe=(t,e,i,r)=>{t.prototype=Object.create(e.prototype,r),Object.defineProperty(t.prototype,"constructor",{value:t,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},lWe=(t,e,i,r)=>{let n,a,s;const o={};if(e=e||{},t==null)return e;do{for(n=Object.getOwnPropertyNames(t),a=n.length;a-- >0;)s=n[a],(!r||r(s,t,e))&&!o[s]&&(e[s]=t[s],o[s]=!0);t=i!==!1&&s8(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},cWe=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const r=t.indexOf(e,i);return r!==-1&&r===i},uWe=t=>{if(!t)return null;if(oE(t))return t;let e=t.length;if(!Hbe(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},dWe=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&s8(Uint8Array)),pWe=(t,e)=>{const r=(t&&t[l2]).call(t);let n;for(;(n=r.next())&&!n.done;){const a=n.value;e.call(t,a[0],a[1])}},fWe=(t,e)=>{let i;const r=[];for(;(i=t.exec(e))!==null;)r.push(i);return r},hWe=Gh("HTMLFormElement"),mWe=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,r,n){return r.toUpperCase()+n}),nte=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),AWe=Gh("RegExp"),Qbe=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),r={};XR(i,(n,a)=>{let s;(s=e(n,a,t))!==!1&&(r[a]=s||n)}),Object.defineProperties(t,r)},gWe=t=>{Qbe(t,(e,i)=>{if(ad(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const r=t[i];if(ad(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},vWe=(t,e)=>{const i={},r=n=>{n.forEach(a=>{i[a]=!0})};return oE(t)?r(t):r(String(t).split(e)),i},yWe=()=>{},bWe=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function IWe(t){return!!(t&&ad(t.append)&&t[Lbe]==="FormData"&&t[l2])}const wWe=t=>{const e=new Array(10),i=(r,n)=>{if(YR(r)){if(e.indexOf(r)>=0)return;if(KR(r))return r;if(!("toJSON"in r)){e[n]=r;const a=oE(r)?[]:{};return XR(r,(s,o)=>{const l=i(s,n+1);!xT(l)&&(a[o]=l)}),e[n]=void 0,a}}return r};return i(t,0)},SWe=Gh("AsyncFunction"),UWe=t=>t&&(YR(t)||ad(t))&&ad(t.then)&&ad(t.catch),jbe=((t,e)=>t?setImmediate:e?((i,r)=>(cI.addEventListener("message",({source:n,data:a})=>{n===cI&&a===i&&r.length&&r.shift()()},!1),n=>{r.push(n),cI.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",ad(cI.postMessage)),TWe=typeof queueMicrotask<"u"?queueMicrotask.bind(cI):typeof process<"u"&&process.nextTick||jbe,CWe=t=>t!=null&&ad(t[l2]),Ze={isArray:oE,isArrayBuffer:$be,isBuffer:KR,isFormData:Zqe,isArrayBufferView:Gqe,isString:Qqe,isNumber:Hbe,isBoolean:jqe,isObject:YR,isPlainObject:Ok,isEmptyObject:zqe,isReadableStream:eWe,isRequest:tWe,isResponse:iWe,isHeaders:rWe,isUndefined:xT,isDate:qqe,isFile:Wqe,isBlob:Kqe,isRegExp:AWe,isFunction:ad,isStream:Xqe,isURLSearchParams:Jqe,isTypedArray:dWe,isFileList:Yqe,forEach:XR,merge:u4,extend:aWe,trim:nWe,stripBOM:sWe,inherits:oWe,toFlatObject:lWe,kindOf:c2,kindOfTest:Gh,endsWith:cWe,toArray:uWe,forEachEntry:pWe,matchAll:fWe,isHTMLForm:hWe,hasOwnProperty:nte,hasOwnProp:nte,reduceDescriptors:Qbe,freezeMethods:gWe,toObjectSet:vWe,toCamelCase:mWe,noop:yWe,toFiniteNumber:bWe,findKey:Vbe,global:cI,isContextDefined:Gbe,isSpecCompliantForm:IWe,toJSONObject:wWe,isAsyncFn:SWe,isThenable:UWe,setImmediate:jbe,asap:TWe,isIterable:CWe};let or=class zbe extends Error{static from(e,i,r,n,a,s){const o=new zbe(e.message,i||e.code,r,n,a);return o.cause=e,o.name=e.name,s&&Object.assign(o,s),o}constructor(e,i,r,n,a){super(e),this.name="AxiosError",this.isAxiosError=!0,i&&(this.code=i),r&&(this.config=r),n&&(this.request=n),a&&(this.response=a,this.status=a.status)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ze.toJSONObject(this.config),code:this.code,status:this.status}}};or.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE";or.ERR_BAD_OPTION="ERR_BAD_OPTION";or.ECONNABORTED="ECONNABORTED";or.ETIMEDOUT="ETIMEDOUT";or.ERR_NETWORK="ERR_NETWORK";or.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS";or.ERR_DEPRECATED="ERR_DEPRECATED";or.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE";or.ERR_BAD_REQUEST="ERR_BAD_REQUEST";or.ERR_CANCELED="ERR_CANCELED";or.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT";or.ERR_INVALID_URL="ERR_INVALID_URL";const EWe=null;function d4(t){return Ze.isPlainObject(t)||Ze.isArray(t)}function qbe(t){return Ze.endsWith(t,"[]")?t.slice(0,-2):t}function ate(t,e,i){return t?t.concat(e).map(function(n,a){return n=qbe(n),!i&&a?"["+n+"]":n}).join(i?".":""):e}function DWe(t){return Ze.isArray(t)&&!t.some(d4)}const PWe=Ze.toFlatObject(Ze,{},null,function(e){return/^is[A-Z]/.test(e)});function d2(t,e,i){if(!Ze.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=Ze.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,A){return!Ze.isUndefined(A[m])});const r=i.metaTokens,n=i.visitor||u,a=i.dots,s=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&Ze.isSpecCompliantForm(e);if(!Ze.isFunction(n))throw new TypeError("visitor must be a function");function c(h){if(h===null)return"";if(Ze.isDate(h))return h.toISOString();if(Ze.isBoolean(h))return h.toString();if(!l&&Ze.isBlob(h))throw new or("Blob is not supported. Use a Buffer instead.");return Ze.isArrayBuffer(h)||Ze.isTypedArray(h)?l&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function u(h,m,A){let g=h;if(h&&!A&&typeof h=="object"){if(Ze.endsWith(m,"{}"))m=r?m:m.slice(0,-2),h=JSON.stringify(h);else if(Ze.isArray(h)&&DWe(h)||(Ze.isFileList(h)||Ze.endsWith(m,"[]"))&&(g=Ze.toArray(h)))return m=qbe(m),g.forEach(function(b,y){!(Ze.isUndefined(b)||b===null)&&e.append(s===!0?ate([m],y,a):s===null?m:m+"[]",c(b))}),!1}return d4(h)?!0:(e.append(ate(A,m,a),c(h)),!1)}const d=[],p=Object.assign(PWe,{defaultVisitor:u,convertValue:c,isVisitable:d4});function f(h,m){if(!Ze.isUndefined(h)){if(d.indexOf(h)!==-1)throw Error("Circular reference detected in "+m.join("."));d.push(h),Ze.forEach(h,function(g,v){(!(Ze.isUndefined(g)||g===null)&&n.call(e,g,Ze.isString(v)?v.trim():v,m,p))===!0&&f(g,m?m.concat(v):[v])}),d.pop()}}if(!Ze.isObject(t))throw new TypeError("data must be an object");return f(t),e}function ste(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function o8(t,e){this._pairs=[],t&&d2(t,this,e)}const Wbe=o8.prototype;Wbe.append=function(e,i){this._pairs.push([e,i])};Wbe.toString=function(e){const i=e?function(r){return e.call(this,r,ste)}:ste;return this._pairs.map(function(n){return i(n[0])+"="+i(n[1])},"").join("&")};function RWe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Kbe(t,e,i){if(!e)return t;const r=i&&i.encode||RWe,n=Ze.isFunction(i)?{serialize:i}:i,a=n&&n.serialize;let s;if(a?s=a(e,n):s=Ze.isURLSearchParams(e)?e.toString():new o8(e,n).toString(r),s){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}class ote{constructor(){this.handlers=[]}use(e,i,r){return this.handlers.push({fulfilled:e,rejected:i,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ze.forEach(this.handlers,function(r){r!==null&&e(r)})}}const l8={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1,legacyInterceptorReqResOrdering:!0},MWe=typeof URLSearchParams<"u"?URLSearchParams:o8,NWe=typeof FormData<"u"?FormData:null,BWe=typeof Blob<"u"?Blob:null,kWe={isBrowser:!0,classes:{URLSearchParams:MWe,FormData:NWe,Blob:BWe},protocols:["http","https","file","blob","url","data"]},c8=typeof window<"u"&&typeof document<"u",p4=typeof navigator=="object"&&navigator||void 0,xWe=c8&&(!p4||["ReactNative","NativeScript","NS"].indexOf(p4.product)<0),_We=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",OWe=c8&&window.location.href||"http://localhost",FWe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:c8,hasStandardBrowserEnv:xWe,hasStandardBrowserWebWorkerEnv:_We,navigator:p4,origin:OWe},Symbol.toStringTag,{value:"Module"})),bc={...FWe,...kWe};function LWe(t,e){return d2(t,new bc.classes.URLSearchParams,{visitor:function(i,r,n,a){return bc.isNode&&Ze.isBuffer(i)?(this.append(r,i.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)},...e})}function $We(t){return Ze.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function HWe(t){const e={},i=Object.keys(t);let r;const n=i.length;let a;for(r=0;r<n;r++)a=i[r],e[a]=t[a];return e}function Ybe(t){function e(i,r,n,a){let s=i[a++];if(s==="__proto__")return!0;const o=Number.isFinite(+s),l=a>=i.length;return s=!s&&Ze.isArray(n)?n.length:s,l?(Ze.hasOwnProp(n,s)?n[s]=[n[s],r]:n[s]=r,!o):((!n[s]||!Ze.isObject(n[s]))&&(n[s]=[]),e(i,r,n[s],a)&&Ze.isArray(n[s])&&(n[s]=HWe(n[s])),!o)}if(Ze.isFormData(t)&&Ze.isFunction(t.entries)){const i={};return Ze.forEachEntry(t,(r,n)=>{e($We(r),n,i,0)}),i}return null}function VWe(t,e,i){if(Ze.isString(t))try{return(e||JSON.parse)(t),Ze.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(i||JSON.stringify)(t)}const ZR={transitional:l8,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const r=i.getContentType()||"",n=r.indexOf("application/json")>-1,a=Ze.isObject(e);if(a&&Ze.isHTMLForm(e)&&(e=new FormData(e)),Ze.isFormData(e))return n?JSON.stringify(Ybe(e)):e;if(Ze.isArrayBuffer(e)||Ze.isBuffer(e)||Ze.isStream(e)||Ze.isFile(e)||Ze.isBlob(e)||Ze.isReadableStream(e))return e;if(Ze.isArrayBufferView(e))return e.buffer;if(Ze.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return LWe(e,this.formSerializer).toString();if((o=Ze.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return d2(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return a||n?(i.setContentType("application/json",!1),VWe(e)):e}],transformResponse:[function(e){const i=this.transitional||ZR.transitional,r=i&&i.forcedJSONParsing,n=this.responseType==="json";if(Ze.isResponse(e)||Ze.isReadableStream(e))return e;if(e&&Ze.isString(e)&&(r&&!this.responseType||n)){const s=!(i&&i.silentJSONParsing)&&n;try{return JSON.parse(e,this.parseReviver)}catch(o){if(s)throw o.name==="SyntaxError"?or.from(o,or.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:bc.classes.FormData,Blob:bc.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ze.forEach(["delete","get","head","post","put","patch"],t=>{ZR.headers[t]={}});const GWe=Ze.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),QWe=t=>{const e={};let i,r,n;return t&&t.split(`
`).forEach(function(s){n=s.indexOf(":"),i=s.substring(0,n).trim().toLowerCase(),r=s.substring(n+1).trim(),!(!i||e[i]&&GWe[i])&&(i==="set-cookie"?e[i]?e[i].push(r):e[i]=[r]:e[i]=e[i]?e[i]+", "+r:r)}),e},lte=Symbol("internals");function iD(t){return t&&String(t).trim().toLowerCase()}function Fk(t){return t===!1||t==null?t:Ze.isArray(t)?t.map(Fk):String(t)}function jWe(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=i.exec(t);)e[r[1]]=r[2];return e}const zWe=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function BV(t,e,i,r,n){if(Ze.isFunction(r))return r.call(this,e,i);if(n&&(e=i),!!Ze.isString(e)){if(Ze.isString(r))return e.indexOf(r)!==-1;if(Ze.isRegExp(r))return r.test(e)}}function qWe(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,r)=>i.toUpperCase()+r)}function WWe(t,e){const i=Ze.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+i,{value:function(n,a,s){return this[r].call(this,e,n,a,s)},configurable:!0})})}let sd=class{constructor(e){e&&this.set(e)}set(e,i,r){const n=this;function a(o,l,c){const u=iD(l);if(!u)throw new Error("header name must be a non-empty string");const d=Ze.findKey(n,u);(!d||n[d]===void 0||c===!0||c===void 0&&n[d]!==!1)&&(n[d||l]=Fk(o))}const s=(o,l)=>Ze.forEach(o,(c,u)=>a(c,u,l));if(Ze.isPlainObject(e)||e instanceof this.constructor)s(e,i);else if(Ze.isString(e)&&(e=e.trim())&&!zWe(e))s(QWe(e),i);else if(Ze.isObject(e)&&Ze.isIterable(e)){let o={},l,c;for(const u of e){if(!Ze.isArray(u))throw TypeError("Object iterator must return a key-value pair");o[c=u[0]]=(l=o[c])?Ze.isArray(l)?[...l,u[1]]:[l,u[1]]:u[1]}s(o,i)}else e!=null&&a(i,e,r);return this}get(e,i){if(e=iD(e),e){const r=Ze.findKey(this,e);if(r){const n=this[r];if(!i)return n;if(i===!0)return jWe(n);if(Ze.isFunction(i))return i.call(this,n,r);if(Ze.isRegExp(i))return i.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=iD(e),e){const r=Ze.findKey(this,e);return!!(r&&this[r]!==void 0&&(!i||BV(this,this[r],r,i)))}return!1}delete(e,i){const r=this;let n=!1;function a(s){if(s=iD(s),s){const o=Ze.findKey(r,s);o&&(!i||BV(r,r[o],o,i))&&(delete r[o],n=!0)}}return Ze.isArray(e)?e.forEach(a):a(e),n}clear(e){const i=Object.keys(this);let r=i.length,n=!1;for(;r--;){const a=i[r];(!e||BV(this,this[a],a,e,!0))&&(delete this[a],n=!0)}return n}normalize(e){const i=this,r={};return Ze.forEach(this,(n,a)=>{const s=Ze.findKey(r,a);if(s){i[s]=Fk(n),delete i[a];return}const o=e?qWe(a):String(a).trim();o!==a&&delete i[a],i[o]=Fk(n),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return Ze.forEach(this,(r,n)=>{r!=null&&r!==!1&&(i[n]=e&&Ze.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const r=new this(e);return i.forEach(n=>r.set(n)),r}static accessor(e){const r=(this[lte]=this[lte]={accessors:{}}).accessors,n=this.prototype;function a(s){const o=iD(s);r[o]||(WWe(n,s),r[o]=!0)}return Ze.isArray(e)?e.forEach(a):a(e),this}};sd.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ze.reduceDescriptors(sd.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[i]=r}}});Ze.freezeMethods(sd);function kV(t,e){const i=this||ZR,r=e||i,n=sd.from(r.headers);let a=r.data;return Ze.forEach(t,function(o){a=o.call(i,a,n.normalize(),e?e.status:void 0)}),n.normalize(),a}function Xbe(t){return!!(t&&t.__CANCEL__)}let JR=class extends or{constructor(e,i,r){super(e??"canceled",or.ERR_CANCELED,i,r),this.name="CanceledError",this.__CANCEL__=!0}};function Zbe(t,e,i){const r=i.config.validateStatus;!i.status||!r||r(i.status)?t(i):e(new or("Request failed with status code "+i.status,[or.ERR_BAD_REQUEST,or.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function KWe(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function YWe(t,e){t=t||10;const i=new Array(t),r=new Array(t);let n=0,a=0,s;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=r[a];s||(s=c),i[n]=l,r[n]=c;let d=a,p=0;for(;d!==n;)p+=i[d++],d=d%t;if(n=(n+1)%t,n===a&&(a=(a+1)%t),c-s<e)return;const f=u&&c-u;return f?Math.round(p*1e3/f):void 0}}function XWe(t,e){let i=0,r=1e3/e,n,a;const s=(c,u=Date.now())=>{i=u,n=null,a&&(clearTimeout(a),a=null),t(...c)};return[(...c)=>{const u=Date.now(),d=u-i;d>=r?s(c,u):(n=c,a||(a=setTimeout(()=>{a=null,s(n)},r-d)))},()=>n&&s(n)]}const m_=(t,e,i=3)=>{let r=0;const n=YWe(50,250);return XWe(a=>{const s=a.loaded,o=a.lengthComputable?a.total:void 0,l=s-r,c=n(l),u=s<=o;r=s;const d={loaded:s,total:o,progress:o?s/o:void 0,bytes:l,rate:c||void 0,estimated:c&&o&&u?(o-s)/c:void 0,event:a,lengthComputable:o!=null,[e?"download":"upload"]:!0};t(d)},i)},cte=(t,e)=>{const i=t!=null;return[r=>e[0]({lengthComputable:i,total:t,loaded:r}),e[1]]},ute=t=>(...e)=>Ze.asap(()=>t(...e)),ZWe=bc.hasStandardBrowserEnv?((t,e)=>i=>(i=new URL(i,bc.origin),t.protocol===i.protocol&&t.host===i.host&&(e||t.port===i.port)))(new URL(bc.origin),bc.navigator&&/(msie|trident)/i.test(bc.navigator.userAgent)):()=>!0,JWe=bc.hasStandardBrowserEnv?{write(t,e,i,r,n,a,s){if(typeof document>"u")return;const o=[`${t}=${encodeURIComponent(e)}`];Ze.isNumber(i)&&o.push(`expires=${new Date(i).toUTCString()}`),Ze.isString(r)&&o.push(`path=${r}`),Ze.isString(n)&&o.push(`domain=${n}`),a===!0&&o.push("secure"),Ze.isString(s)&&o.push(`SameSite=${s}`),document.cookie=o.join("; ")},read(t){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function e5e(t){return typeof t!="string"?!1:/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function t5e(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Jbe(t,e,i){let r=!e5e(e);return t&&(r||i==!1)?t5e(t,e):e}const dte=t=>t instanceof sd?{...t}:t;function JI(t,e){e=e||{};const i={};function r(c,u,d,p){return Ze.isPlainObject(c)&&Ze.isPlainObject(u)?Ze.merge.call({caseless:p},c,u):Ze.isPlainObject(u)?Ze.merge({},u):Ze.isArray(u)?u.slice():u}function n(c,u,d,p){if(Ze.isUndefined(u)){if(!Ze.isUndefined(c))return r(void 0,c,d,p)}else return r(c,u,d,p)}function a(c,u){if(!Ze.isUndefined(u))return r(void 0,u)}function s(c,u){if(Ze.isUndefined(u)){if(!Ze.isUndefined(c))return r(void 0,c)}else return r(void 0,u)}function o(c,u,d){if(d in e)return r(c,u);if(d in t)return r(void 0,c)}const l={url:a,method:a,data:a,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:o,headers:(c,u,d)=>n(dte(c),dte(u),d,!0)};return Ze.forEach(Object.keys({...t,...e}),function(u){if(u==="__proto__"||u==="constructor"||u==="prototype")return;const d=Ze.hasOwnProp(l,u)?l[u]:n,p=d(t[u],e[u],u);Ze.isUndefined(p)&&d!==o||(i[u]=p)}),i}const eIe=t=>{const e=JI({},t);let{data:i,withXSRFToken:r,xsrfHeaderName:n,xsrfCookieName:a,headers:s,auth:o}=e;if(e.headers=s=sd.from(s),e.url=Kbe(Jbe(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),o&&s.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),Ze.isFormData(i)){if(bc.hasStandardBrowserEnv||bc.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(Ze.isFunction(i.getHeaders)){const l=i.getHeaders(),c=["content-type","content-length"];Object.entries(l).forEach(([u,d])=>{c.includes(u.toLowerCase())&&s.set(u,d)})}}if(bc.hasStandardBrowserEnv&&(r&&Ze.isFunction(r)&&(r=r(e)),r||r!==!1&&ZWe(e.url))){const l=n&&a&&JWe.read(a);l&&s.set(n,l)}return e},i5e=typeof XMLHttpRequest<"u",r5e=i5e&&function(t){return new Promise(function(i,r){const n=eIe(t);let a=n.data;const s=sd.from(n.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:c}=n,u,d,p,f,h;function m(){f&&f(),h&&h(),n.cancelToken&&n.cancelToken.unsubscribe(u),n.signal&&n.signal.removeEventListener("abort",u)}let A=new XMLHttpRequest;A.open(n.method.toUpperCase(),n.url,!0),A.timeout=n.timeout;function g(){if(!A)return;const b=sd.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders()),I={data:!o||o==="text"||o==="json"?A.responseText:A.response,status:A.status,statusText:A.statusText,headers:b,config:t,request:A};Zbe(function(S){i(S),m()},function(S){r(S),m()},I),A=null}"onloadend"in A?A.onloadend=g:A.onreadystatechange=function(){!A||A.readyState!==4||A.status===0&&!(A.responseURL&&A.responseURL.indexOf("file:")===0)||setTimeout(g)},A.onabort=function(){A&&(r(new or("Request aborted",or.ECONNABORTED,t,A)),A=null)},A.onerror=function(y){const I=y&&y.message?y.message:"Network Error",w=new or(I,or.ERR_NETWORK,t,A);w.event=y||null,r(w),A=null},A.ontimeout=function(){let y=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const I=n.transitional||l8;n.timeoutErrorMessage&&(y=n.timeoutErrorMessage),r(new or(y,I.clarifyTimeoutError?or.ETIMEDOUT:or.ECONNABORTED,t,A)),A=null},a===void 0&&s.setContentType(null),"setRequestHeader"in A&&Ze.forEach(s.toJSON(),function(y,I){A.setRequestHeader(I,y)}),Ze.isUndefined(n.withCredentials)||(A.withCredentials=!!n.withCredentials),o&&o!=="json"&&(A.responseType=n.responseType),c&&([p,h]=m_(c,!0),A.addEventListener("progress",p)),l&&A.upload&&([d,f]=m_(l),A.upload.addEventListener("progress",d),A.upload.addEventListener("loadend",f)),(n.cancelToken||n.signal)&&(u=b=>{A&&(r(!b||b.type?new JR(null,t,A):b),A.abort(),A=null)},n.cancelToken&&n.cancelToken.subscribe(u),n.signal&&(n.signal.aborted?u():n.signal.addEventListener("abort",u)));const v=KWe(n.url);if(v&&bc.protocols.indexOf(v)===-1){r(new or("Unsupported protocol "+v+":",or.ERR_BAD_REQUEST,t));return}A.send(a||null)})},n5e=(t,e)=>{const{length:i}=t=t?t.filter(Boolean):[];if(e||i){let r=new AbortController,n;const a=function(c){if(!n){n=!0,o();const u=c instanceof Error?c:this.reason;r.abort(u instanceof or?u:new JR(u instanceof Error?u.message:u))}};let s=e&&setTimeout(()=>{s=null,a(new or(`timeout of ${e}ms exceeded`,or.ETIMEDOUT))},e);const o=()=>{t&&(s&&clearTimeout(s),s=null,t.forEach(c=>{c.unsubscribe?c.unsubscribe(a):c.removeEventListener("abort",a)}),t=null)};t.forEach(c=>c.addEventListener("abort",a));const{signal:l}=r;return l.unsubscribe=()=>Ze.asap(o),l}},a5e=function*(t,e){let i=t.byteLength;if(i<e){yield t;return}let r=0,n;for(;r<i;)n=r+e,yield t.slice(r,n),r=n},s5e=async function*(t,e){for await(const i of o5e(t))yield*a5e(i,e)},o5e=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:i,value:r}=await e.read();if(i)break;yield r}}finally{await e.cancel()}},pte=(t,e,i,r)=>{const n=s5e(t,e);let a=0,s,o=l=>{s||(s=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:c,value:u}=await n.next();if(c){o(),l.close();return}let d=u.byteLength;if(i){let p=a+=d;i(p)}l.enqueue(new Uint8Array(u))}catch(c){throw o(c),c}},cancel(l){return o(l),n.return()}},{highWaterMark:2})},fte=64*1024,{isFunction:aB}=Ze,l5e=(({Request:t,Response:e})=>({Request:t,Response:e}))(Ze.global),{ReadableStream:hte,TextEncoder:mte}=Ze.global,Ate=(t,...e)=>{try{return!!t(...e)}catch{return!1}},c5e=t=>{t=Ze.merge.call({skipUndefined:!0},l5e,t);const{fetch:e,Request:i,Response:r}=t,n=e?aB(e):typeof fetch=="function",a=aB(i),s=aB(r);if(!n)return!1;const o=n&&aB(hte),l=n&&(typeof mte=="function"?(h=>m=>h.encode(m))(new mte):async h=>new Uint8Array(await new i(h).arrayBuffer())),c=a&&o&&Ate(()=>{let h=!1;const m=new i(bc.origin,{body:new hte,method:"POST",get duplex(){return h=!0,"half"}}).headers.has("Content-Type");return h&&!m}),u=s&&o&&Ate(()=>Ze.isReadableStream(new r("").body)),d={stream:u&&(h=>h.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(h=>{!d[h]&&(d[h]=(m,A)=>{let g=m&&m[h];if(g)return g.call(m);throw new or(`Response type '${h}' is not supported`,or.ERR_NOT_SUPPORT,A)})});const p=async h=>{if(h==null)return 0;if(Ze.isBlob(h))return h.size;if(Ze.isSpecCompliantForm(h))return(await new i(bc.origin,{method:"POST",body:h}).arrayBuffer()).byteLength;if(Ze.isArrayBufferView(h)||Ze.isArrayBuffer(h))return h.byteLength;if(Ze.isURLSearchParams(h)&&(h=h+""),Ze.isString(h))return(await l(h)).byteLength},f=async(h,m)=>{const A=Ze.toFiniteNumber(h.getContentLength());return A??p(m)};return async h=>{let{url:m,method:A,data:g,signal:v,cancelToken:b,timeout:y,onDownloadProgress:I,onUploadProgress:w,responseType:S,headers:T,withCredentials:D="same-origin",fetchOptions:C}=eIe(h),E=e||fetch;S=S?(S+"").toLowerCase():"text";let P=n5e([v,b&&b.toAbortSignal()],y),R=null;const M=P&&P.unsubscribe&&(()=>{P.unsubscribe()});let N;try{if(w&&c&&A!=="get"&&A!=="head"&&(N=await f(T,g))!==0){let V=new i(m,{method:"POST",body:g,duplex:"half"}),G;if(Ze.isFormData(g)&&(G=V.headers.get("content-type"))&&T.setContentType(G),V.body){const[z,Q]=cte(N,m_(ute(w)));g=pte(V.body,fte,z,Q)}}Ze.isString(D)||(D=D?"include":"omit");const k=a&&"credentials"in i.prototype,O={...C,signal:P,method:A.toUpperCase(),headers:T.normalize().toJSON(),body:g,duplex:"half",credentials:k?D:void 0};R=a&&new i(m,O);let x=await(a?E(R,C):E(m,O));const F=u&&(S==="stream"||S==="response");if(u&&(I||F&&M)){const V={};["status","statusText","headers"].forEach(j=>{V[j]=x[j]});const G=Ze.toFiniteNumber(x.headers.get("content-length")),[z,Q]=I&&cte(G,m_(ute(I),!0))||[];x=new r(pte(x.body,fte,z,()=>{Q&&Q(),M&&M()}),V)}S=S||"text";let _=await d[Ze.findKey(d,S)||"text"](x,h);return!F&&M&&M(),await new Promise((V,G)=>{Zbe(V,G,{data:_,headers:sd.from(x.headers),status:x.status,statusText:x.statusText,config:h,request:R})})}catch(k){throw M&&M(),k&&k.name==="TypeError"&&/Load failed|fetch/i.test(k.message)?Object.assign(new or("Network Error",or.ERR_NETWORK,h,R,k&&k.response),{cause:k.cause||k}):or.from(k,k&&k.code,h,R,k&&k.response)}}},u5e=new Map,tIe=t=>{let e=t&&t.env||{};const{fetch:i,Request:r,Response:n}=e,a=[r,n,i];let s=a.length,o=s,l,c,u=u5e;for(;o--;)l=a[o],c=u.get(l),c===void 0&&u.set(l,c=o?new Map:c5e(e)),u=c;return c};tIe();const u8={http:EWe,xhr:r5e,fetch:{get:tIe}};Ze.forEach(u8,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const gte=t=>`- ${t}`,d5e=t=>Ze.isFunction(t)||t===null||t===!1;function p5e(t,e){t=Ze.isArray(t)?t:[t];const{length:i}=t;let r,n;const a={};for(let s=0;s<i;s++){r=t[s];let o;if(n=r,!d5e(r)&&(n=u8[(o=String(r)).toLowerCase()],n===void 0))throw new or(`Unknown adapter '${o}'`);if(n&&(Ze.isFunction(n)||(n=n.get(e))))break;a[o||"#"+s]=n}if(!n){const s=Object.entries(a).map(([l,c])=>`adapter ${l} `+(c===!1?"is not supported by the environment":"is not available in the build"));let o=i?s.length>1?`since :
`+s.map(gte).join(`
`):" "+gte(s[0]):"as no adapter specified";throw new or("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n}const iIe={getAdapter:p5e,adapters:u8};function xV(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new JR(null,t)}function vte(t){return xV(t),t.headers=sd.from(t.headers),t.data=kV.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),iIe.getAdapter(t.adapter||ZR.adapter,t)(t).then(function(r){return xV(t),r.data=kV.call(t,t.transformResponse,r),r.headers=sd.from(r.headers),r},function(r){return Xbe(r)||(xV(t),r&&r.response&&(r.response.data=kV.call(t,t.transformResponse,r.response),r.response.headers=sd.from(r.response.headers))),Promise.reject(r)})}const rIe="1.13.5",p2={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{p2[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const yte={};p2.transitional=function(e,i,r){function n(a,s){return"[Axios v"+rIe+"] Transitional option '"+a+"'"+s+(r?". "+r:"")}return(a,s,o)=>{if(e===!1)throw new or(n(s," has been removed"+(i?" in "+i:"")),or.ERR_DEPRECATED);return i&&!yte[s]&&(yte[s]=!0,console.warn(n(s," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(a,s,o):!0}};p2.spelling=function(e){return(i,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function f5e(t,e,i){if(typeof t!="object")throw new or("options must be an object",or.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let n=r.length;for(;n-- >0;){const a=r[n],s=e[a];if(s){const o=t[a],l=o===void 0||s(o,a,t);if(l!==!0)throw new or("option "+a+" must be "+l,or.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new or("Unknown option "+a,or.ERR_BAD_OPTION)}}const Lk={assertOptions:f5e,validators:p2},Cp=Lk.validators;let SI=class{constructor(e){this.defaults=e||{},this.interceptors={request:new ote,response:new ote}}async request(e,i){try{return await this._request(e,i)}catch(r){if(r instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const a=n.stack?n.stack.replace(/^.+\n/,""):"";try{r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}catch{}}throw r}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=JI(this.defaults,i);const{transitional:r,paramsSerializer:n,headers:a}=i;r!==void 0&&Lk.assertOptions(r,{silentJSONParsing:Cp.transitional(Cp.boolean),forcedJSONParsing:Cp.transitional(Cp.boolean),clarifyTimeoutError:Cp.transitional(Cp.boolean),legacyInterceptorReqResOrdering:Cp.transitional(Cp.boolean)},!1),n!=null&&(Ze.isFunction(n)?i.paramsSerializer={serialize:n}:Lk.assertOptions(n,{encode:Cp.function,serialize:Cp.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),Lk.assertOptions(i,{baseUrl:Cp.spelling("baseURL"),withXsrfToken:Cp.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let s=a&&Ze.merge(a.common,a[i.method]);a&&Ze.forEach(["delete","get","head","post","put","patch","common"],h=>{delete a[h]}),i.headers=sd.concat(s,a);const o=[];let l=!0;this.interceptors.request.forEach(function(m){if(typeof m.runWhen=="function"&&m.runWhen(i)===!1)return;l=l&&m.synchronous;const A=i.transitional||l8;A&&A.legacyInterceptorReqResOrdering?o.unshift(m.fulfilled,m.rejected):o.push(m.fulfilled,m.rejected)});const c=[];this.interceptors.response.forEach(function(m){c.push(m.fulfilled,m.rejected)});let u,d=0,p;if(!l){const h=[vte.bind(this),void 0];for(h.unshift(...o),h.push(...c),p=h.length,u=Promise.resolve(i);d<p;)u=u.then(h[d++],h[d++]);return u}p=o.length;let f=i;for(;d<p;){const h=o[d++],m=o[d++];try{f=h(f)}catch(A){m.call(this,A);break}}try{u=vte.call(this,f)}catch(h){return Promise.reject(h)}for(d=0,p=c.length;d<p;)u=u.then(c[d++],c[d++]);return u}getUri(e){e=JI(this.defaults,e);const i=Jbe(e.baseURL,e.url,e.allowAbsoluteUrls);return Kbe(i,e.params,e.paramsSerializer)}};Ze.forEach(["delete","get","head","options"],function(e){SI.prototype[e]=function(i,r){return this.request(JI(r||{},{method:e,url:i,data:(r||{}).data}))}});Ze.forEach(["post","put","patch"],function(e){function i(r){return function(a,s,o){return this.request(JI(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:s}))}}SI.prototype[e]=i(),SI.prototype[e+"Form"]=i(!0)});let h5e=class nIe{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(a){i=a});const r=this;this.promise.then(n=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](n);r._listeners=null}),this.promise.then=n=>{let a;const s=new Promise(o=>{r.subscribe(o),a=o}).then(n);return s.cancel=function(){r.unsubscribe(a)},s},e(function(a,s,o){r.reason||(r.reason=new JR(a,s,o),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=r=>{e.abort(r)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new nIe(function(n){e=n}),cancel:e}}};function m5e(t){return function(i){return t.apply(null,i)}}function A5e(t){return Ze.isObject(t)&&t.isAxiosError===!0}const f4={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(f4).forEach(([t,e])=>{f4[e]=t});function aIe(t){const e=new SI(t),i=Fbe(SI.prototype.request,e);return Ze.extend(i,SI.prototype,e,{allOwnKeys:!0}),Ze.extend(i,e,null,{allOwnKeys:!0}),i.create=function(n){return aIe(JI(t,n))},i}const ho=aIe(ZR);ho.Axios=SI;ho.CanceledError=JR;ho.CancelToken=h5e;ho.isCancel=Xbe;ho.VERSION=rIe;ho.toFormData=d2;ho.AxiosError=or;ho.Cancel=ho.CanceledError;ho.all=function(e){return Promise.all(e)};ho.spread=m5e;ho.isAxiosError=A5e;ho.mergeConfig=JI;ho.AxiosHeaders=sd;ho.formToJSON=t=>Ybe(Ze.isHTMLForm(t)?new FormData(t):t);ho.getAdapter=iIe.getAdapter;ho.HttpStatusCode=f4;ho.default=ho;const{Axios:s2t,AxiosError:o2t,CanceledError:l2t,isCancel:c2t,CancelToken:u2t,VERSION:d2t,all:p2t,Cancel:f2t,isAxiosError:h2t,spread:m2t,toFormData:A2t,AxiosHeaders:g2t,HttpStatusCode:v2t,formToJSON:y2t,getAdapter:b2t,mergeConfig:I2t}=ho,sIe=Obe(),g5e="https://courthive.net",eM=ho.create({baseURL:g5e});eM.interceptors.request.use(t=>{const e=localStorage.getItem(sIe);return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));eM.interceptors.response.use(t=>(t.data?.error&&Pt({message:t.data.error?.message,intent:"is-danger"}),t),t=>{if(t.message==="Network Error"&&Pt({message:t.message,intent:"is-danger"}),t.response){t.response?.status===401&&oIe();const e=t.response.data.message||t.response.data.error||t.response.data;Pt({message:e,intent:"is-danger"})}});const v5e=()=>{const t=localStorage.getItem(sIe);eM.defaults.headers.common.Authorization=`Bearer ${t}`},oIe=()=>{eM.defaults.headers.common.Authorization=void 0},Uu={...eM,addAuthorization:v5e,removeAuthorization:oIe};async function y5e({identifier:t}){return await Uu.post("/service/tournamentdetails",{identifier:t})}async function f2({tournamentId:t}){return await Uu.post("/factory/fetch",{tournamentId:t})}async function b5e({provider:t}){return await Uu.post("/provider/add",t)}async function I5e({provider:t}){return await Uu.post("/provider/modify",t)}async function w5e({providerId:t}){return await Uu.post("/provider/detail",{providerId:t})}async function S5e({providerAbbr:t}){return await Uu.post("/provider/calendar",{providerAbbr:t})}async function PP(){return await Uu.post("/provider/allProviders",{})}async function lIe(){return await Uu.post("/auth/allusers",{})}async function U5e({email:t}){return await Uu.post("/auth/remove",{email:t})}async function l0({tournamentRecord:t}){return await Uu.post("/factory/save",{tournamentRecord:t})}async function T5e({providerId:t,tournamentId:e}){return await Uu.post("/factory/remove",{providerId:t,tournamentId:e})}var bte,na="colors",Wc="sizes",gi="space",C5e={gap:gi,gridGap:gi,columnGap:gi,gridColumnGap:gi,rowGap:gi,gridRowGap:gi,inset:gi,insetBlock:gi,insetBlockEnd:gi,insetBlockStart:gi,insetInline:gi,insetInlineEnd:gi,insetInlineStart:gi,margin:gi,marginTop:gi,marginRight:gi,marginBottom:gi,marginLeft:gi,marginBlock:gi,marginBlockEnd:gi,marginBlockStart:gi,marginInline:gi,marginInlineEnd:gi,marginInlineStart:gi,padding:gi,paddingTop:gi,paddingRight:gi,paddingBottom:gi,paddingLeft:gi,paddingBlock:gi,paddingBlockEnd:gi,paddingBlockStart:gi,paddingInline:gi,paddingInlineEnd:gi,paddingInlineStart:gi,top:gi,right:gi,bottom:gi,left:gi,scrollMargin:gi,scrollMarginTop:gi,scrollMarginRight:gi,scrollMarginBottom:gi,scrollMarginLeft:gi,scrollMarginX:gi,scrollMarginY:gi,scrollMarginBlock:gi,scrollMarginBlockEnd:gi,scrollMarginBlockStart:gi,scrollMarginInline:gi,scrollMarginInlineEnd:gi,scrollMarginInlineStart:gi,scrollPadding:gi,scrollPaddingTop:gi,scrollPaddingRight:gi,scrollPaddingBottom:gi,scrollPaddingLeft:gi,scrollPaddingX:gi,scrollPaddingY:gi,scrollPaddingBlock:gi,scrollPaddingBlockEnd:gi,scrollPaddingBlockStart:gi,scrollPaddingInline:gi,scrollPaddingInlineEnd:gi,scrollPaddingInlineStart:gi,fontSize:"fontSizes",background:na,backgroundColor:na,backgroundImage:na,borderImage:na,border:na,borderBlock:na,borderBlockEnd:na,borderBlockStart:na,borderBottom:na,borderBottomColor:na,borderColor:na,borderInline:na,borderInlineEnd:na,borderInlineStart:na,borderLeft:na,borderLeftColor:na,borderRight:na,borderRightColor:na,borderTop:na,borderTopColor:na,caretColor:na,color:na,columnRuleColor:na,fill:na,outline:na,outlineColor:na,stroke:na,textDecorationColor:na,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:Wc,minBlockSize:Wc,maxBlockSize:Wc,inlineSize:Wc,minInlineSize:Wc,maxInlineSize:Wc,width:Wc,minWidth:Wc,maxWidth:Wc,height:Wc,minHeight:Wc,maxHeight:Wc,flexBasis:Wc,gridTemplateColumns:Wc,gridTemplateRows:Wc,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},E5e=(t,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,tM=()=>{const t=Object.create(null);return(e,i,...r)=>{const n=(a=>JSON.stringify(a,E5e))(e);return n in t?t[n]:t[n]=i(e,...r)}},$k=Symbol.for("sxs.internal"),d8=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),Ite=t=>{for(const e in t)return!0;return!1},{hasOwnProperty:D5e}=Object.prototype,h4=t=>t.includes("-")?t:t.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase())),P5e=/\s+(?![^()]*\))/,KS=t=>e=>t(...typeof e=="string"?String(e).split(P5e):[e]),wte={appearance:t=>({WebkitAppearance:t,appearance:t}),backfaceVisibility:t=>({WebkitBackfaceVisibility:t,backfaceVisibility:t}),backdropFilter:t=>({WebkitBackdropFilter:t,backdropFilter:t}),backgroundClip:t=>({WebkitBackgroundClip:t,backgroundClip:t}),boxDecorationBreak:t=>({WebkitBoxDecorationBreak:t,boxDecorationBreak:t}),clipPath:t=>({WebkitClipPath:t,clipPath:t}),content:t=>({content:t.includes('"')||t.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(t)?t:`"${t}"`}),hyphens:t=>({WebkitHyphens:t,hyphens:t}),maskImage:t=>({WebkitMaskImage:t,maskImage:t}),maskSize:t=>({WebkitMaskSize:t,maskSize:t}),tabSize:t=>({MozTabSize:t,tabSize:t}),textSizeAdjust:t=>({WebkitTextSizeAdjust:t,textSizeAdjust:t}),userSelect:t=>({WebkitUserSelect:t,userSelect:t}),marginBlock:KS(((t,e)=>({marginBlockStart:t,marginBlockEnd:e||t}))),marginInline:KS(((t,e)=>({marginInlineStart:t,marginInlineEnd:e||t}))),maxSize:KS(((t,e)=>({maxBlockSize:t,maxInlineSize:e||t}))),minSize:KS(((t,e)=>({minBlockSize:t,minInlineSize:e||t}))),paddingBlock:KS(((t,e)=>({paddingBlockStart:t,paddingBlockEnd:e||t}))),paddingInline:KS(((t,e)=>({paddingInlineStart:t,paddingInlineEnd:e||t})))},_V=/([\d.]+)([^]*)/,R5e=(t,e)=>t.length?t.reduce(((i,r)=>(i.push(...e.map((n=>n.includes("&")?n.replace(/&/g,/[ +>|~]/.test(r)&&/&.*&/.test(n)?`:is(${r})`:r):r+" "+n))),i)),[]):e,M5e=(t,e)=>t in N5e&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,((i,r,n,a)=>r+(n==="stretch"?`-moz-available${a};${h4(t)}:${r}-webkit-fill-available`:`-moz-fit-content${a};${h4(t)}:${r}fit-content`)+a)):String(e),N5e={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},bg=t=>t?t+"-":"",cIe=(t,e,i)=>t.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,((r,n,a,s,o)=>s=="$"==!!a?r:(n||s=="--"?"calc(":"")+"var(--"+(s==="$"?bg(e)+(o.includes("$")?"":bg(i))+o.replace(/\$/g,"-"):o)+")"+(n||s=="--"?"*"+(n||"")+(a||"1")+")":""))),B5e=/\s*,\s*(?![^()]*\))/,k5e=Object.prototype.toString,FU=(t,e,i,r,n)=>{let a,s,o;const l=(c,u,d)=>{let p,f;const h=m=>{for(p in m){const v=p.charCodeAt(0)===64,b=v&&Array.isArray(m[p])?m[p]:[m[p]];for(f of b){const y=/[A-Z]/.test(g=p)?g:g.replace(/-[^]/g,(w=>w[1].toUpperCase())),I=typeof f=="object"&&f&&f.toString===k5e&&(!r.utils[y]||!u.length);if(y in r.utils&&!I){const w=r.utils[y];if(w!==s){s=w,h(w(f)),s=null;continue}}else if(y in wte){const w=wte[y];if(w!==o){o=w,h(w(f)),o=null;continue}}if(v&&(A=p.slice(1)in r.media?"@media "+r.media[p.slice(1)]:p,p=A.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,((w,S,T,D,C,E)=>{const P=_V.test(S),R=.0625*(P?-1:1),[M,N]=P?[D,S]:[S,D];return"("+(T[0]==="="?"":T[0]===">"===P?"max-":"min-")+M+":"+(T[0]!=="="&&T.length===1?N.replace(_V,((k,O,x)=>Number(O)+R*(T===">"?1:-1)+x)):N)+(C?") and ("+(C[0]===">"?"min-":"max-")+M+":"+(C.length===1?E.replace(_V,((k,O,x)=>Number(O)+R*(C===">"?-1:1)+x)):E):"")+")"}))),I){const w=v?d.concat(p):[...d],S=v?[...u]:R5e(u,p.split(B5e));a!==void 0&&n(Ste(...a)),a=void 0,l(f,S,w)}else a===void 0&&(a=[[],u,d]),p=v||p.charCodeAt(0)!==36?p:`--${bg(r.prefix)}${p.slice(1).replace(/\$/g,"-")}`,f=I?f:typeof f=="number"?f&&y in x5e?String(f)+"px":String(f):cIe(M5e(y,f??""),r.prefix,r.themeMap[y]),a[0].push(`${v?`${p} `:`${h4(p)}:`}${f}`)}}var A,g};h(c),a!==void 0&&n(Ste(...a)),a=void 0};l(t,e,i)},Ste=(t,e,i)=>`${i.map((r=>`${r}{`)).join("")}${e.length?`${e.join(",")}{`:""}${t.join(";")}${e.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,x5e={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},Ute=t=>String.fromCharCode(t+(t>25?39:97)),UI=t=>(e=>{let i,r="";for(i=Math.abs(e);i>52;i=i/52|0)r=Ute(i%52)+r;return Ute(i%52)+r})(((e,i)=>{let r=i.length;for(;r;)e=33*e^i.charCodeAt(--r);return e})(5381,JSON.stringify(t))>>>0),PD=["themed","global","styled","onevar","resonevar","allvar","inline"],_5e=t=>{if(t.href&&!t.href.startsWith(location.origin))return!1;try{return!!t.cssRules}catch{return!1}},O5e=t=>{let e;const i=()=>{const{cssRules:n}=e.sheet;return[].map.call(n,((a,s)=>{const{cssText:o}=a;let l="";if(o.startsWith("--sxs"))return"";if(n[s-1]&&(l=n[s-1].cssText).startsWith("--sxs")){if(!a.cssRules.length)return"";for(const c in e.rules)if(e.rules[c].group===a)return`--sxs{--sxs:${[...e.rules[c].cache].join(" ")}}${o}`;return a.cssRules.length?`${l}${o}`:""}return o})).join("")},r=()=>{if(e){const{rules:o,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const c in o)delete o[c]}const n=Object(t).styleSheets||[];for(const o of n)if(_5e(o)){for(let l=0,c=o.cssRules;c[l];++l){const u=Object(c[l]);if(u.type!==1)continue;const d=Object(c[l+1]);if(d.type!==4)continue;++l;const{cssText:p}=u;if(!p.startsWith("--sxs"))continue;const f=p.slice(14,-3).trim().split(/\s+/),h=PD[f[0]];h&&(e||(e={sheet:o,reset:r,rules:{},toString:i}),e.rules[h]={group:d,index:l,cache:new Set(f)})}if(e)break}if(!e){const o=(l,c)=>({type:c,cssRules:[],insertRule(u,d){this.cssRules.splice(d,0,o(u,{import:3,undefined:1}[(u.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,(u=>u.cssText)).join("")}}`:l}});e={sheet:t?(t.head||t).appendChild(document.createElement("style")).sheet:o("","text/css"),rules:{},reset:r,toString:i}}const{sheet:a,rules:s}=e;for(let o=PD.length-1;o>=0;--o){const l=PD[o];if(!s[l]){const c=PD[o+1],u=s[c]?s[c].index:a.cssRules.length;a.insertRule("@media{}",u),a.insertRule(`--sxs{--sxs:${o}}`,u),s[l]={group:a.cssRules[u+1],index:u,cache:new Set([o])}}F5e(s[l])}};return r(),e},F5e=t=>{const e=t.group;let i=e.cssRules.length;t.apply=r=>{try{e.insertRule(r,i),++i}catch{}}},rD=Symbol(),L5e=tM(),$5e=(t,e)=>L5e(t,(()=>(...i)=>{let r={type:null,composers:new Set};for(const n of i)if(n!=null)if(n[$k]){r.type==null&&(r.type=n[$k].type);for(const a of n[$k].composers)r.composers.add(a)}else n.constructor!==Object||n.$$typeof?r.type==null&&(r.type=n):r.composers.add(H5e(n,t));return r.type==null&&(r.type="span"),r.composers.size||r.composers.add(["PJLV",{},[],[],{},[]]),V5e(t,r,e)})),H5e=({variants:t,compoundVariants:e,defaultVariants:i,...r},n)=>{const a=`${bg(n.prefix)}c-${UI(r)}`,s=[],o=[],l=Object.create(null),c=[];for(const p in i)l[p]=String(i[p]);if(typeof t=="object"&&t)for(const p in t){u=l,d=p,D5e.call(u,d)||(l[p]="undefined");const f=t[p];for(const h in f){const m={[p]:String(h)};String(h)==="undefined"&&c.push(p);const A=f[h],g=[m,A,!Ite(A)];s.push(g)}}var u,d;if(typeof e=="object"&&e)for(const p of e){let{css:f,...h}=p;f=typeof f=="object"&&f||{};for(const A in h)h[A]=String(h[A]);const m=[h,f,!Ite(f)];o.push(m)}return[a,r,s,o,l,c]},V5e=(t,e,i)=>{const[r,n,a,s]=G5e(e.composers),o=typeof e.type=="function"||e.type.$$typeof?(d=>{function p(){for(let f=0;f<p[rD].length;f++){const[h,m]=p[rD][f];d.rules[h].apply(m)}return p[rD]=[],null}return p[rD]=[],p.rules={},PD.forEach((f=>p.rules[f]={apply:h=>p[rD].push([f,h])})),p})(i):null,l=(o||i).rules,c=`.${r}${n.length>1?`:where(.${n.slice(1).join(".")})`:""}`,u=d=>{d=typeof d=="object"&&d||Q5e;const{css:p,...f}=d,h={};for(const g in a)if(delete f[g],g in d){let v=d[g];typeof v=="object"&&v?h[g]={"@initial":a[g],...v}:(v=String(v),h[g]=v!=="undefined"||s.has(g)?v:a[g])}else h[g]=a[g];const m=new Set([...n]);for(const[g,v,b,y]of e.composers){i.rules.styled.cache.has(g)||(i.rules.styled.cache.add(g),FU(v,[`.${g}`],[],t,(S=>{l.styled.apply(S)})));const I=Tte(b,h,t.media),w=Tte(y,h,t.media,!0);for(const S of I)if(S!==void 0)for(const[T,D,C]of S){const E=`${g}-${UI(D)}-${T}`;m.add(E);const P=(C?i.rules.resonevar:i.rules.onevar).cache,R=C?l.resonevar:l.onevar;P.has(E)||(P.add(E),FU(D,[`.${E}`],[],t,(M=>{R.apply(M)})))}for(const S of w)if(S!==void 0)for(const[T,D]of S){const C=`${g}-${UI(D)}-${T}`;m.add(C),i.rules.allvar.cache.has(C)||(i.rules.allvar.cache.add(C),FU(D,[`.${C}`],[],t,(E=>{l.allvar.apply(E)})))}}if(typeof p=="object"&&p){const g=`${r}-i${UI(p)}-css`;m.add(g),i.rules.inline.cache.has(g)||(i.rules.inline.cache.add(g),FU(p,[`.${g}`],[],t,(v=>{l.inline.apply(v)})))}for(const g of String(d.className||"").trim().split(/\s+/))g&&m.add(g);const A=f.className=[...m].join(" ");return{type:e.type,className:A,selector:c,props:f,toString:()=>A,deferredInjector:o}};return d8(u,{className:r,selector:c,[$k]:e,toString:()=>(i.rules.styled.cache.has(r)||u(),r)})},G5e=t=>{let e="";const i=[],r={},n=[];for(const[a,,,,s,o]of t){e===""&&(e=a),i.push(a),n.push(...o);for(const l in s){const c=s[l];(r[l]===void 0||c!=="undefined"||o.includes(c))&&(r[l]=c)}}return[e,i,r,new Set(n)]},Tte=(t,e,i,r)=>{const n=[];e:for(let[a,s,o]of t){if(o)continue;let l,c=0,u=!1;for(l in a){const d=a[l];let p=e[l];if(p!==d){if(typeof p!="object"||!p)continue e;{let f,h,m=0;for(const A in p){if(d===String(p[A])){if(A!=="@initial"){const g=A.slice(1);(h=h||[]).push(g in i?i[g]:A.replace(/^@media ?/,"")),u=!0}c+=m,f=!0}++m}if(h&&h.length&&(s={["@media "+h.join(", ")]:s}),!f)continue e}}}(n[c]=n[c]||[]).push([r?"cv":`${l}-${a[l]}`,s,u])}return n},Q5e={},j5e=tM(),z5e=(t,e)=>j5e(t,(()=>(...i)=>{const r=()=>{for(let n of i){n=typeof n=="object"&&n||{};let a=UI(n);if(!e.rules.global.cache.has(a)){if(e.rules.global.cache.add(a),"@import"in n){let s=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let o of[].concat(n["@import"]))o=o.includes('"')||o.includes("'")?o:`"${o}"`,e.sheet.insertRule(`@import ${o};`,s++);delete n["@import"]}FU(n,[],[],t,(s=>{e.rules.global.apply(s)}))}}return""};return d8(r,{toString:r})})),q5e=tM(),W5e=(t,e)=>q5e(t,(()=>i=>{const r=`${bg(t.prefix)}k-${UI(i)}`,n=()=>{if(!e.rules.global.cache.has(r)){e.rules.global.cache.add(r);const a=[];FU(i,[],[],t,(o=>a.push(o)));const s=`@keyframes ${r}{${a.join("")}}`;e.rules.global.apply(s)}return r};return d8(n,{get name(){return n()},toString:n})})),K5e=class{constructor(t,e,i,r){this.token=t==null?"":String(t),this.value=e==null?"":String(e),this.scale=i==null?"":String(i),this.prefix=r==null?"":String(r)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+bg(this.prefix)+bg(this.scale)+this.token}toString(){return this.computedValue}},Y5e=tM(),X5e=(t,e)=>Y5e(t,(()=>(i,r)=>{r=typeof i=="object"&&i||Object(r);const n=`.${i=(i=typeof i=="string"?i:"")||`${bg(t.prefix)}t-${UI(r)}`}`,a={},s=[];for(const l in r){a[l]={};for(const c in r[l]){const u=`--${bg(t.prefix)}${l}-${c}`,d=cIe(String(r[l][c]),t.prefix,l);a[l][c]=new K5e(c,d,l,t.prefix),s.push(`${u}:${d}`)}}const o=()=>{if(s.length&&!e.rules.themed.cache.has(i)){e.rules.themed.cache.add(i);const l=`${r===t.theme?":root,":""}.${i}{${s.join(";")}}`;e.rules.themed.apply(l)}return i};return{...a,get className(){return o()},selector:n,toString:o}})),Z5e=tM(),uIe=t=>{let e=!1;const i=Z5e(t,(r=>{e=!0;const n="prefix"in(r=typeof r=="object"&&r||{})?String(r.prefix):"",a=typeof r.media=="object"&&r.media||{},s=typeof r.root=="object"?r.root||null:globalThis.document||null,o=typeof r.theme=="object"&&r.theme||{},l={prefix:n,media:a,theme:o,themeMap:typeof r.themeMap=="object"&&r.themeMap||{...C5e},utils:typeof r.utils=="object"&&r.utils||{}},c=O5e(s),u={css:$5e(l,c),globalCss:z5e(l,c),keyframes:W5e(l,c),createTheme:X5e(l,c),reset(){c.reset(),u.theme.toString()},theme:{},sheet:c,config:l,prefix:n,getCssText:c.toString,toString:c.toString};return String(u.theme=u.createTheme(o)),u}));return e||i.reset(),i},J5e=()=>bte||(bte=uIe()),mr=(...t)=>J5e().css(...t);function eKe({variant:t}){return mr({margin:"2.5px 0",variants:{variant:{showAddress:{lineHeight:"2.3em"}}}})({variant:t})}const tKe=mr({justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap",fontWeight:500,display:"flex"}),iKe=mr({textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),rKe=mr({"&::WebkitScrollbar":{display:"none"},justifyContent:"space-between",flexDirection:"column",marginInlineEnd:"0rem",scrollbarWidth:"none",overflowX:"scroll",fontWeight:500,display:"flex",width:"100%",variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}});function nKe({drawPosition:t,sideNumber:e}){return mr({minHeight:"$participant$minHeight",justifyContent:"space-between",paddingInlineStart:"0.75rem",backgroundColor:"$matchUp",paddingInlineEnd:"0rem",boxSizing:"border-box",paddingBottom:".2rem",position:"relative",alignItems:"center",paddingTop:".2rem",minWidth:"15rem",cursor:"pointer",display:"flex",flexGrow:1,"& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}})({sideNumber:e,css:t&&{"&:before":{backgroundColor:"$backgroundColor",content:`${t}`,justifyContent:"center",alignContent:"center",insetInlineStart:-10,position:"absolute",color:"#55AFFE",display:"flex",width:20}}})}function aKe({winnerChevron:t,isDoubles:e}){const i=(e?.4:.3)*2;return mr({variants:{variant:{winner:{"&::before":{borderTop:`${i}rem solid transparent`,borderBottom:`${i}rem solid transparent`,borderInlineStart:"8px solid #008f70",position:"absolute",insetInlineStart:0,display:"block",content:""}}}}})({variant:t?"winner":void 0})}const p8=mr({fontSize:"smaller",color:"gray"});function f8(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Cte={exports:{}},Ete;function sKe(){return Ete||(Ete=1,(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var a="",s=0;s<arguments.length;s++){var o=arguments[s];o&&(a=n(a,r(o)))}return a}function r(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return i.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var s="";for(var o in a)e.call(a,o)&&a[o]&&(s=n(s,o));return s}function n(a,s){return s?a?a+" "+s:a+s:a}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})(Cte)),Cte.exports}var oKe=sKe();const hb=f8(oKe);function lKe({individualParticipant:t,className:e}){const{city:i,state:r,countryCode:n}=t?.person?.addresses?.[0]||{},a=[i,r,n].filter(Boolean).join(", ")||" ",s=document.createElement("div");return s.className=hb(p8(),e),s.innerHTML=a,s}const cKe=mr({willChange:"opacity",position:"fixed",zIndex:9998,bottom:0,right:0,left:0,top:0}),uKe=mr({display:"block"}),dKe=mr({position:"fixed",right:0,left:0}),pKe=mr({paddingRight:"15px",alignItems:"center",margin:"30px auto",paddingLeft:"15px",position:"fixed",height:"100vh",display:"flex",width:"100%",zIndex:9999,bottom:0,right:0,left:0,top:0}),fKe=mr({boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",backgroundColor:"white",position:"relative",borderRadius:"3px",minHeight:"auto",width:"100%"}),hKe=mr({borderBottom:"1px solid rgba(0, 0, 0, 0.1)",alignItems:"center",position:"relative",display:"flex"}),mKe=mr({fontWeight:"600",fontSize:"20px"}),Dte=mr({borderTop:"1px solid rgba(0, 0, 0, 0.1)",justifyContent:"right",alignItems:"center",position:"relative",display:"flex"}),Pte="Nothing to see here";function co(t){return typeof t=="function"}function RD(t){return typeof t=="string"}function Rte(t){return Array.isArray(t)}function AKe(t){if(t)for(;t.firstChild;)t.firstChild.remove()}const pf=(()=>{const t=dKe(),e={},i=".5",r=[];let n;const a=[];let s=[],o;const l=m=>{{const A=s.pop();A&&A.remove()}},c=()=>{o&&(o.style.opacity="0",o.style.display="none")},u=m=>{const A=s.length;if(m&&e[A]===!1)return;const g=a.pop(),v=r.pop();co(g)&&g({content:v}),document.querySelectorAll("[data-modal-popover]").forEach(b=>b.remove()),document.body.classList.remove(t),document.body.style.top=null,window.scrollTo({top:n,behavior:"instant"}),c(),l()},d=()=>{o=document.createElement("div"),o.className=cKe(),o.id="cmdl-backdrop",o.onclick=()=>u(!0),document.body.appendChild(o)},p=({config:m})=>{n=window.scrollY,document.body.classList.add(t),document.body.style.top=`-${n}px`,o||d(),o.style.display="",m?.backdrop!==!1&&(o.style.backgroundColor="rgba(0, 0, 0, 0.2)",o.style.transition="opacity 0.15s linear",o.style.opacity="1")},f=({config:m,attr:A,attrs:g,unit:v="em",value:b})=>{let y;return RD(A)?y=m4({element:m,attr:A}):Rte(g)&&(y=g.map(I=>m4({element:m,attr:I})).find(Boolean)),y!==void 0&&(b=y),Number.isNaN(b)?b:`${b}${v}`},h=({buttons:m,config:A,modalNumber:g})=>{const v=document.createElement("div");v.className=Dte(),v.style.padding=f({config:A,attrs:["footer.padding","padding"],value:i});const b={label:A?.dictionary?.close||"Close",onClick:()=>pf.close(),intent:"is-info"};for(const y of m){if(y.hide)continue;const I={...b,...y},w=document.createElement("button");I.disabled!==void 0&&(w.disabled=I.disabled),I.id&&(w.id=I.id),w.className=I?.footer?.className||"button font-medium",I.intent&&I.intent!=="none"&&w.classList.add(I.intent);const S="margin-right: .5em;",T=I?.footer?.style||"";w.style.cssText=S+(T?" "+T:""),w.innerHTML=I.label||I.text||"",w.onclick=D=>{D.stopPropagation(),co(I.onClick)&&I.onClick({e:D,content:r[g]}),I.close!==!1&&(co(I.close)&&I.close(),pf.close())},v.appendChild(w)}return v};return{close:u,open:({title:m="",content:A,buttons:g,footer:v,config:b,onClose:y}={})=>{p({config:b}),a.push(y);const I=s.length+1;e[I]=b?.clickAway;const w=document.createElement("section"),S=`cmdl-${I}`;w.className=uKe(),w.role="dialog",w.tabIndex=-1,w.id=S;const T=document.createElement("div");T.className=pKe(),T.style.maxWidth=`${b?.maxWidth||450}px`,T.onclick=()=>u(!0);const D=document.createElement("div");D.className=fKe(),b?.className&&D.classList.add(b.className),b?.style&&Object.assign(D.style,b.style),D.onclick=V=>V.stopPropagation();const C=document.createElement("div"),E=document.createElement("div");C.appendChild(E);let P,R;b?.info&&(P=document.createElement("span"),P.innerHTML="?",P.style.cssText=`
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background-color: #3273dc;
        color: white;
        font-size: 14px;
        font-weight: bold;
        flex-shrink: 0;
        user-select: none;
      `,P.onclick=V=>{if(V.stopPropagation(),R&&document.body.contains(R)){R.remove(),R=void 0;return}R=document.createElement("div"),R.setAttribute("data-modal-popover","true"),R.style.cssText=`
          position: absolute;
          z-index: 10000;
          background-color: white;
          border: 1px solid #ddd;
          border-radius: 4px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.15);
          padding: 1em;
          max-width: 300px;
          font-size: 14px;
          font-weight: normal;
          line-height: 1.5;
          color: #363636;
        `;const G=document.createElement("style");G.textContent=`
          [data-modal-popover] strong {
            color: #000 !important;
            font-weight: 600;
          }
        `,document.querySelector("[data-modal-popover-styles]")||(G.setAttribute("data-modal-popover-styles","true"),document.head.appendChild(G)),RD(b.info)?R.innerHTML=b.info:R.textContent=String(b.info),document.body.appendChild(R);const z=P.getBoundingClientRect();R.style.right=`${window.innerWidth-z.left+5}px`,R.style.top=`${z.bottom+5}px`,R.style.left="auto",setTimeout(()=>{const Q=j=>{R&&!R.contains(j.target)&&j.target!==P&&(R.remove(),R=void 0,document.removeEventListener("click",Q))};document.addEventListener("click",Q)},100)},C.appendChild(P)),D.appendChild(C);const M=({title:V,config:G})=>{C.className=V?hKe():"",C.style.padding=f({config:G,attrs:["title.padding","padding"],value:i}),C.style.display=V||G?.info?"flex":"",C.style.alignItems="center",C.style.justifyContent=V?"space-between":"flex-end",E.className=V?mKe():"",E.innerHTML=V,P&&(P.style.marginLeft=V?"auto":"0")};(m||b?.info)&&M({title:m,config:b});const N=document.createElement("div");D.appendChild(N);const k=({content:V,config:G})=>{N.style.fontSize=f({config:G,attr:"fontSize",value:"15px"}),N.style.position="relative",N.style.padding=f({config:G,attrs:["content.padding","padding"],value:i}),co(V)?r[I]=V(N):V instanceof HTMLElement?N.appendChild(V):RD(V)?N.innerHTML=V:N.innerHTML=Pte};k({content:A,config:b});let O;if(Rte(g))O=h({buttons:g,config:b,modalNumber:I}),D.appendChild(O);else if(v){const V=document.createElement("div");V.className=Dte(),V.style.padding=f({config:b,attrs:["footer.padding","padding"]}),v instanceof HTMLElement?V.appendChild(v):RD(v)?V.innerHTML=v:V.innerHTML=Pte,O=V,D.appendChild(V)}T.appendChild(D),w.appendChild(T),document.body.appendChild(w),s.push(w);const x=({content:V,config:G})=>{r[I]=void 0,AKe(N),k({content:V,config:G})},F=({buttons:V,config:G})=>{O&&O.remove(),O=h({buttons:V,config:G,modalNumber:I}),D.appendChild(O)},_=({onClose:V})=>{a.length=0,a.push(V)};return{setContent:x,setButtons:F,update:({content:V,buttons:G,title:z,config:Q,onClose:j})=>{b=Q||b,V&&x({content:V,config:b}),G&&F({buttons:G,config:b}),j&&_({onClose:j}),z&&M({title:z,config:b})}}}}})();function m4({element:t,attr:e}){if(!RD(e))return;const i=e.split(".");for(const r of i)if(t=t?.[r],!t)return;return t}function gKe({individualParticipant:t,attribute:e,className:i}){const r=t?.person,n=m4({element:r,attr:e});if(!n)return"";const a=document.createElement("div");return a.className=hb(p8(),i),a.innerHTML=n,a}function vKe({individualParticipant:t,className:e}){const i=t?.teams?.[0],r=i?.participantName||" ",n=document.createElement("div");return n.className=hb(p8(),e),n.classList.add("tmx-tm"),n.setAttribute("id",i?.participantId||""),n.innerHTML=r,n}function yKe(t){const e=t?.composition?.configuration?.participantDetail;if(e==="TEAM")return vKe(t);if(t?.composition?.configuration?.showAddress??e==="ADDRESS")return lKe(t);if(e){const i=gKe({...t,attribute:e});if(i&&typeof i!="string")return i}return document.createElement("div")}function yc(t){return typeof t=="function"}var Mte={exports:{}},Nte;function bKe(){return Nte||(Nte=1,(function(t){(function(){var e=function(l,c){var u=this;e.count=(e.count||0)+1,this.count=e.count,this.isOpened=!1,this.input=a(l),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-controls","awesomplete_list_"+this.count),this.input.setAttribute("aria-owns","awesomplete_list_"+this.count),this.input.setAttribute("role","combobox"),this.options=c=c||{},r(this,{minChars:2,maxItems:10,autoFirst:!1,data:e.DATA,filter:e.FILTER_CONTAINS,sort:c.sort===!1?!1:e.SORT_BYLENGTH,container:e.CONTAINER,item:e.ITEM,replace:e.REPLACE,tabSelect:!1,listLabel:"Results List",statusNoResults:"No results found",statusXResults:"{0} results found",statusTypeXChar:"Type {0} or more characters for results"},c),this.index=-1,this.container=this.container(l),this.ul=a.create("ul",{hidden:"hidden",role:"listbox",id:"awesomplete_list_"+this.count,inside:this.container,"aria-label":this.listLabel}),this.status=a.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-atomic":!0,inside:this.container,textContent:""}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(d){var p=d.keyCode;u.opened&&(p===13&&u.selected||p===9&&u.selected&&u.tabSelect?(d.preventDefault(),u.select(void 0,void 0,d)):p===27?u.close({reason:"esc"}):(p===38||p===40)&&(d.preventDefault(),u[p===38?"previous":"next"]()))}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(d){d.preventDefault()},click:function(d){var p=d.target;if(p!==this){for(;p&&!/li/i.test(p.nodeName);)p=p.parentNode;p&&d.button===0&&(d.preventDefault(),u.select(p,d.target,d))}}}},a.bind(this.input,this._events.input),a.bind(this.input.form,this._events.form),a.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||c.list||[],e.all.push(this)};e.prototype={set list(l){if(Array.isArray(l))this._list=l;else if(typeof l=="string"&&l.indexOf(",")>-1)this._list=l.split(/\s*,\s*/);else if(l=a(l),l&&l.children){var c=[];n.apply(l.children).forEach(function(u){if(!u.disabled){var d=u.textContent.trim(),p=u.value||d,f=u.label||d;p!==""&&c.push({label:f,value:p})}}),this._list=c}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(l){this.opened&&(this.input.setAttribute("aria-expanded","false"),this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,this.status.setAttribute("hidden",""),this.input.setAttribute("aria-activedescendant",""),a.fire(this.input,"awesomplete-close",l||{}))},open:function(){this.input.setAttribute("aria-expanded","true"),this.ul.removeAttribute("hidden"),this.isOpened=!0,this.status.removeAttribute("hidden"),this.autoFirst&&this.index===-1&&this.goto(0),a.fire(this.input,"awesomplete-open")},destroy:function(){if(a.unbind(this.input,this._events.input),a.unbind(this.input.form,this._events.form),!this.options.container){var l=this.container.parentNode;l.insertBefore(this.input,this.container),l.removeChild(this.container)}this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete"),this.input.removeAttribute("aria-expanded"),this.input.removeAttribute("aria-controls"),this.input.removeAttribute("aria-owns"),this.input.removeAttribute("role");var c=e.all.indexOf(this);c!==-1&&e.all.splice(c,1)},next:function(){var l=this.ul.children.length;this.goto(this.index<l-1?this.index+1:l?0:-1)},previous:function(){var l=this.ul.children.length,c=this.index-1;this.goto(this.selected&&c!==-1?c:l-1)},goto:function(l){var c=this.ul.children;this.selected&&c[this.index].setAttribute("aria-selected","false"),this.index=l,l>-1&&c.length>0&&(c[l].setAttribute("aria-selected","true"),this.input.setAttribute("aria-activedescendant",this.ul.id+"_item_"+this.index),this.ul.scrollTop=c[l].offsetTop-this.ul.clientHeight+c[l].clientHeight,a.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(l,c,u){if(l?this.index=a.siblingIndex(l):l=this.ul.children[this.index],l){var d=this.suggestions[this.index],p=a.fire(this.input,"awesomplete-select",{text:d,origin:c||l,originalEvent:u});p&&(this.replace(d),this.close({reason:"select"}),a.fire(this.input,"awesomplete-selectcomplete",{text:d,originalEvent:u}))}},evaluate:function(){var l=this,c=this.input.value;c.length>=this.minChars&&this._list&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map(function(u){return new i(l.data(u,c))}).filter(function(u){return l.filter(u,c)}),this.sort!==!1&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach(function(u,d){l.ul.appendChild(l.item(u,c,d))}),this.ul.children.length===0?(this.status.textContent=this.statusNoResults,this.close({reason:"nomatches"})):(this.input.setAttribute("aria-activedescendant",""),this.open(),this.status.textContent=this.statusXResults.replaceAll("{0}",this.ul.children.length))):(this.close({reason:"nomatches"}),this.minChar<=1||c.length>=this.minChars?this.status.textContent=this.statusNoResults:this.status.textContent=this.statusTypeXChar.replaceAll("{0}",this.minChars))}},e.all=[],e.FILTER_CONTAINS=function(l,c){return RegExp(a.regExpEscape(c.trim()),"i").test(l)},e.FILTER_STARTSWITH=function(l,c){return RegExp("^"+a.regExpEscape(c.trim()),"i").test(l)},e.SORT_BYLENGTH=function(l,c){return l.length!==c.length?l.length-c.length:l<c?-1:1},e.CONTAINER=function(l){return a.create("div",{className:"awesomplete",around:l})},e.ITEM=function(l,c,u){var d=c.trim()===""?l:l.replace(RegExp(a.regExpEscape(c.trim()),"gi"),"<mark>$&</mark>");return a.create("li",{innerHTML:d,role:"option","aria-selected":"false",tabindex:"-1",id:"awesomplete_list_"+this.count+"_item_"+u})},e.REPLACE=function(l){this.input.value=l.value},e.DATA=function(l){return l};function i(l){var c=Array.isArray(l)?{label:l[0],value:l[1]}:typeof l=="object"&&"label"in l&&"value"in l?l:{label:l,value:l};this.label=c.label||c.value,this.value=c.value}Object.defineProperty(i.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),i.prototype.toString=i.prototype.valueOf=function(){return""+this.label};function r(l,c,u){for(var d in c){var p=c[d],f=l.input.getAttribute("data-"+d.toLowerCase());typeof p=="number"?l[d]=parseInt(f):p===!1?l[d]=f!==null:p instanceof Function?l[d]=null:l[d]=f,!l[d]&&l[d]!==0&&(l[d]=d in u?u[d]:p)}}var n=Array.prototype.slice;function a(l,c){return typeof l=="string"?(c||document).querySelector(l):l||null}function s(l,c){return n.call((c||document).querySelectorAll(l))}a.create=function(l,c){var u=document.createElement(l);for(var d in c){var p=c[d];if(d==="inside")a(p).appendChild(u);else if(d==="around"){var f=a(p);f.parentNode.insertBefore(u,f),u.appendChild(f),f.getAttribute("autofocus")!=null&&f.focus()}else d in u?u[d]=p:u.setAttribute(d,p)}return u},a.bind=function(l,c){if(l)for(var u in c){var d=c[u];u.split(/\s+/).forEach(function(p){l.addEventListener(p,d)})}},a.unbind=function(l,c){if(l)for(var u in c){var d=c[u];u.split(/\s+/).forEach(function(p){l.removeEventListener(p,d)})}},a.fire=function(l,c,u){var d=document.createEvent("HTMLEvents");d.initEvent(c,!0,!0);for(var p in u)d[p]=u[p];return l.dispatchEvent(d)},a.regExpEscape=function(l){return l.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},a.siblingIndex=function(l){for(var c=0;l=l.previousElementSibling;c++);return c};function o(){s("input.awesomplete").forEach(function(l){new e(l)})}return typeof self<"u"&&(self.Awesomplete=e),typeof Document<"u"&&(document.readyState!=="loading"?o():document.addEventListener("DOMContentLoaded",o)),e.$=a,e.$$=s,t.exports&&(t.exports=e),e})()})(Mte)),Mte.exports}var IKe=bKe();const wKe=f8(IKe);function SKe({list:t,element:e,callback:i,currentValue:r,withCatchTab:n,onChange:a,onSelectComplete:s,listProvider:o}){const l=new wKe(e,{list:t});e.parentElement&&(e.parentElement.style.width="100%"),yc(o)&&e.addEventListener("focus",()=>{const d=o();l.list=d});let c=!1;const u=d=>{c=!0,yc(i)&&i(d.text.value),e.value=d.text.label,l.suggestions=[],yc(s)&&setTimeout(()=>s(),0)};if(n){const d=p=>p.key==="Tab"&&p.preventDefault();e.addEventListener("keydown",d,!1),e.addEventListener("keyup",d,!1)}if(typeof a=="function"&&e.addEventListener("change",a),e.setAttribute("autocomplete","off"),e.addEventListener("awesomplete-selectcomplete",d=>u(d),!1),e.addEventListener("keyup",function(d){const p=d.key==="Tab"&&d.shiftKey;if((d.key==="Enter"||d.key==="Tab"&&!p)&&!c){const f=e.value.trim()==="";if(d.key==="Enter"&&f){yc(i)&&i(""),e.value="",l.suggestions=[],yc(s)&&setTimeout(()=>s(),0);return}l.suggestions?.length&&!f&&(l.next(),l.select(0))}c=!1}),r){const d=t.find(p=>p.value===r)?.label;d&&(e.value=d)}return{typeAhead:l}}function h8(t){return t[t.length-1]}function iM(t,...e){return e.forEach(i=>{t.includes(i)||t.push(i)}),t}function Bte(t,e){return t?t.split(e):[]}function m8(t,e,i){const r=e===void 0||t>=e,n=i===void 0||t<=i;return r&&n}function dIe(t,e,i){return t<e?e:t>i?i:t}function _T(t,e,i={},r=0,n=""){const a=Object.keys(i).reduce((o,l)=>{let c=i[l];return typeof c=="function"&&(c=c(r)),`${o} ${l}="${c}"`},t);n+=`<${a}></${t}>`;const s=r+1;return s<e?_T(t,e,i,s,n):n}function A8(t){return t.replace(/>\s+/g,">").replace(/\s+</,"<")}function A4(t){return new Date(t).setHours(0,0,0,0)}function Xw(){return new Date().setHours(0,0,0,0)}function OT(...t){switch(t.length){case 0:return Xw();case 1:return A4(t[0])}const e=new Date(0);return e.setFullYear(...t),e.setHours(0,0,0,0)}function RP(t,e){const i=new Date(t);return i.setDate(i.getDate()+e)}function UKe(t,e){return RP(t,e*7)}function A_(t,e){const i=new Date(t),r=i.getMonth()+e;let n=r%12;n<0&&(n+=12);const a=i.setMonth(r);return i.getMonth()!==n?i.setDate(0):a}function MP(t,e){const i=new Date(t),r=i.getMonth(),n=i.setFullYear(i.getFullYear()+e);return r===1&&i.getMonth()===2?i.setDate(0):n}function kte(t,e){return(t-e+7)%7}function TI(t,e,i=0){const r=new Date(t).getDay();return RP(t,kte(e,i)-kte(r,i))}function pIe(t,e){return Math.round((t-e)/6048e5)+1}function TKe(t){const e=TI(t,4,1),i=TI(new Date(e).setMonth(0,4),4,1);return pIe(e,i)}function fIe(t,e){const i=TI(new Date(t).setMonth(0,1),e,e),r=TI(t,e,e),n=pIe(r,i);if(n<53)return n;const a=TI(new Date(t).setDate(32),e,e);return r===a?1:n}function CKe(t){return fIe(t,0)}function EKe(t){return fIe(t,6)}function YS(t,e){const i=new Date(t).getFullYear();return Math.floor(i/e)*e}function ay(t,e,i){if(e!==1&&e!==2)return t;const r=new Date(t);return e===1?i?r.setMonth(r.getMonth()+1,0):r.setDate(1):i?r.setFullYear(r.getFullYear()+1,0,0):r.setMonth(0,1),r.setHours(0,0,0,0)}const g4=/dd?|DD?|mm?|MM?|yy?(?:yy)?/,DKe=/[\s!-/:-@[-`{-~]+/;let OV={};const xte={y(t,e){return new Date(t).setFullYear(parseInt(e,10))},m(t,e,i){const r=new Date(t);let n=parseInt(e,10)-1;if(isNaN(n)){if(!e)return NaN;const a=e.toLowerCase(),s=o=>o.toLowerCase().startsWith(a);if(n=i.monthsShort.findIndex(s),n<0&&(n=i.months.findIndex(s)),n<0)return NaN}return r.setMonth(n),r.getMonth()!==hIe(n)?r.setDate(0):r.getTime()},d(t,e){return new Date(t).setDate(parseInt(e,10))}},PKe={d(t){return t.getDate()},dd(t){return sB(t.getDate(),2)},D(t,e){return e.daysShort[t.getDay()]},DD(t,e){return e.days[t.getDay()]},m(t){return t.getMonth()+1},mm(t){return sB(t.getMonth()+1,2)},M(t,e){return e.monthsShort[t.getMonth()]},MM(t,e){return e.months[t.getMonth()]},y(t){return t.getFullYear()},yy(t){return sB(t.getFullYear(),2).slice(-2)},yyyy(t){return sB(t.getFullYear(),4)}};function hIe(t){return t>-1?t%12:hIe(t+12)}function sB(t,e){return t.toString().padStart(e,"0")}function mIe(t){if(typeof t!="string")throw new Error("Invalid date format.");if(t in OV)return OV[t];const e=t.split(g4),i=t.match(new RegExp(g4,"g"));if(e.length===0||!i)throw new Error("Invalid date format.");const r=i.map(a=>PKe[a]),n=Object.keys(xte).reduce((a,s)=>(i.find(o=>o[0]!=="D"&&o[0].toLowerCase()===s)&&a.push(s),a),[]);return OV[t]={parser(a,s){const o=a.split(DKe).reduce((l,c,u)=>{if(c.length>0&&i[u]){const d=i[u][0];d==="M"?l.m=c:d!=="D"&&(l[d]=c)}return l},{});return n.reduce((l,c)=>{const u=xte[c](l,o[c],s);return isNaN(u)?l:u},Xw())},formatter(a,s){let o=r.reduce((l,c,u)=>l+=`${e[u]}${c(a,s)}`,"");return o+=h8(e)}}}function ew(t,e,i){if(t instanceof Date||typeof t=="number"){const r=A4(t);return isNaN(r)?void 0:r}if(t){if(t==="today")return Xw();if(e&&e.toValue){const r=e.toValue(t,e,i);return isNaN(r)?void 0:A4(r)}return mIe(e).parser(t,i)}}function rM(t,e,i){if(isNaN(t)||!t&&t!==0)return"";const r=typeof t=="number"?new Date(t):t;return e.toDisplay?e.toDisplay(r,e,i):mIe(e).formatter(r,i)}const RKe=document.createRange();function Ig(t){return RKe.createContextualFragment(t)}function AIe(t){return t.parentElement||(t.parentNode instanceof ShadowRoot?t.parentNode.host:void 0)}function h2(t){return t.getRootNode().activeElement===t}function c0(t){t.style.display!=="none"&&(t.style.display&&(t.dataset.styleDisplay=t.style.display),t.style.display="none")}function u0(t){t.style.display==="none"&&(t.dataset.styleDisplay?(t.style.display=t.dataset.styleDisplay,delete t.dataset.styleDisplay):t.style.display="")}function g_(t){t.firstChild&&(t.removeChild(t.firstChild),g_(t))}function MKe(t,e){g_(t),e instanceof DocumentFragment?t.appendChild(e):typeof e=="string"?t.appendChild(Ig(e)):typeof e.forEach=="function"&&e.forEach(i=>{t.appendChild(i)})}const v_=new WeakMap,{addEventListener:NKe,removeEventListener:BKe}=EventTarget.prototype;function y_(t,e){let i=v_.get(t);i||(i=[],v_.set(t,i)),e.forEach(r=>{NKe.call(...r),i.push(r)})}function gIe(t){let e=v_.get(t);e&&(e.forEach(i=>{BKe.call(...i)}),v_.delete(t))}if(!Event.prototype.composedPath){const t=(e,i=[])=>{i.push(e);let r;return e.parentNode?r=e.parentNode:e.host?r=e.host:e.defaultView&&(r=e.defaultView),r?t(r,i):i};Event.prototype.composedPath=function(){return t(this.target)}}function vIe(t,e,i){const[r,...n]=t;if(e(r))return r;if(!(r===i||r.tagName==="HTML"||n.length===0))return vIe(n,e,i)}function yIe(t,e){const i=typeof e=="function"?e:r=>r instanceof Element&&r.matches(e);return vIe(t.composedPath(),i,t.currentTarget)}const nD={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM y"}},g8={autohide:!1,beforeShowDay:null,beforeShowDecade:null,beforeShowMonth:null,beforeShowYear:null,clearButton:!1,dateDelimiter:",",datesDisabled:[],daysOfWeekDisabled:[],daysOfWeekHighlighted:[],defaultViewDate:void 0,disableTouchKeyboard:!1,enableOnReadonly:!0,format:"mm/dd/yyyy",language:"en",maxDate:null,maxNumberOfDates:1,maxView:3,minDate:null,nextArrow:"",orientation:"auto",pickLevel:0,prevArrow:"",showDaysOfWeek:!0,showOnClick:!0,showOnFocus:!0,startView:0,title:"",todayButton:!1,todayButtonMode:0,todayHighlight:!1,updateOnBlur:!0,weekNumbers:0,weekStart:0},{language:FV,format:kKe,weekStart:xKe}=g8;function _te(t,e){return t.length<6&&e>=0&&e<7?iM(t,e):t}function bIe(t,e){switch(t===4?e===6?3:!e+1:t){case 1:return TKe;case 2:return CKe;case 3:return EKe}}function Ote(t,e,i){return e.weekStart=t,e.weekEnd=(t+6)%7,i===4&&(e.getWeekNumber=bIe(4,t)),t}function Fte(t,e,i,r){const n=ew(t,e,i);return n!==void 0?n:r}function LV(t,e,i=3){const r=parseInt(t,10);return r>=0&&r<=i?r:e}function oB(t,e,i,r=void 0){e in t&&(i in t||(t[i]=r?r(t[e]):t[e]),delete t[e])}function $V(t,e){const i=Object.assign({},t),r={},n=e.constructor.locales,a=!!e.rangeSideIndex;let{datesDisabled:s,format:o,language:l,locale:c,maxDate:u,maxView:d,minDate:p,pickLevel:f,startView:h,weekNumbers:m,weekStart:A}=e.config||{};if(oB(i,"calendarWeeks","weekNumbers",w=>w?1:0),oB(i,"clearBtn","clearButton"),oB(i,"todayBtn","todayButton"),oB(i,"todayBtnMode","todayButtonMode"),i.language){let w;if(i.language!==l&&(n[i.language]?w=i.language:(w=i.language.split("-")[0],n[w]||(w=!1))),delete i.language,w){l=r.language=w;const S=c||n[FV];c=Object.assign({format:kKe,weekStart:xKe},n[FV]),l!==FV&&Object.assign(c,n[l]),r.locale=c,o===S.format&&(o=r.format=c.format),A===S.weekStart&&(A=Ote(c.weekStart,r,m))}}if(i.format){const w=typeof i.format.toDisplay=="function",S=typeof i.format.toValue=="function",T=g4.test(i.format);(w&&S||T)&&(o=r.format=i.format),delete i.format}let g=f;"pickLevel"in i&&(g=LV(i.pickLevel,f,2),delete i.pickLevel),g!==f&&(g>f&&("minDate"in i||(i.minDate=p),"maxDate"in i||(i.maxDate=u)),s&&!i.datesDisabled&&(i.datesDisabled=[]),f=r.pickLevel=g);let v=p,b=u;if("minDate"in i){const w=OT(0,0,1);v=i.minDate===null?w:Fte(i.minDate,o,c,v),v!==w&&(v=ay(v,f,!1)),delete i.minDate}if("maxDate"in i&&(b=i.maxDate===null?void 0:Fte(i.maxDate,o,c,b),b!==void 0&&(b=ay(b,f,!0)),delete i.maxDate),b<v?(p=r.minDate=b,u=r.maxDate=v):(p!==v&&(p=r.minDate=v),u!==b&&(u=r.maxDate=b)),i.datesDisabled){const w=i.datesDisabled;if(typeof w=="function")r.datesDisabled=null,r.checkDisabled=(S,T)=>w(new Date(S),T,a);else{const S=r.datesDisabled=w.reduce((T,D)=>{const C=ew(D,o,c);return C!==void 0?iM(T,ay(C,f,a)):T},[]);r.checkDisabled=T=>S.includes(T)}delete i.datesDisabled}if("defaultViewDate"in i){const w=ew(i.defaultViewDate,o,c);w!==void 0&&(r.defaultViewDate=w),delete i.defaultViewDate}if("weekStart"in i){const w=Number(i.weekStart)%7;isNaN(w)||(A=Ote(w,r,m)),delete i.weekStart}if(i.daysOfWeekDisabled&&(r.daysOfWeekDisabled=i.daysOfWeekDisabled.reduce(_te,[]),delete i.daysOfWeekDisabled),i.daysOfWeekHighlighted&&(r.daysOfWeekHighlighted=i.daysOfWeekHighlighted.reduce(_te,[]),delete i.daysOfWeekHighlighted),"weekNumbers"in i){let w=i.weekNumbers;if(w){const S=typeof w=="function"?(T,D)=>w(new Date(T),D):bIe(w=parseInt(w,10),A);S&&(m=r.weekNumbers=w,r.getWeekNumber=S)}else m=r.weekNumbers=0,r.getWeekNumber=null;delete i.weekNumbers}if("maxNumberOfDates"in i){const w=parseInt(i.maxNumberOfDates,10);w>=0&&(r.maxNumberOfDates=w,r.multidate=w!==1),delete i.maxNumberOfDates}i.dateDelimiter&&(r.dateDelimiter=String(i.dateDelimiter),delete i.dateDelimiter);let y=d;"maxView"in i&&(y=LV(i.maxView,d),delete i.maxView),y=f>y?f:y,y!==d&&(d=r.maxView=y);let I=h;if("startView"in i&&(I=LV(i.startView,I),delete i.startView),I<f?I=f:I>d&&(I=d),I!==h&&(r.startView=I),i.prevArrow){const w=Ig(i.prevArrow);w.childNodes.length>0&&(r.prevArrow=w.childNodes),delete i.prevArrow}if(i.nextArrow){const w=Ig(i.nextArrow);w.childNodes.length>0&&(r.nextArrow=w.childNodes),delete i.nextArrow}if("disableTouchKeyboard"in i&&(r.disableTouchKeyboard="ontouchstart"in document&&!!i.disableTouchKeyboard,delete i.disableTouchKeyboard),i.orientation){const w=i.orientation.toLowerCase().split(/\s+/g);r.orientation={x:w.find(S=>S==="left"||S==="right")||"auto",y:w.find(S=>S==="top"||S==="bottom")||"auto"},delete i.orientation}if("todayButtonMode"in i){switch(i.todayButtonMode){case 0:case 1:r.todayButtonMode=i.todayButtonMode}delete i.todayButtonMode}return Object.entries(i).forEach(([w,S])=>{S!==void 0&&w in g8&&(r[w]=S)}),r}const Lte={show:{key:"ArrowDown"},hide:null,toggle:{key:"Escape"},prevButton:{key:"ArrowLeft",ctrlOrMetaKey:!0},nextButton:{key:"ArrowRight",ctrlOrMetaKey:!0},viewSwitch:{key:"ArrowUp",ctrlOrMetaKey:!0},clearButton:{key:"Backspace",ctrlOrMetaKey:!0},todayButton:{key:".",ctrlOrMetaKey:!0},exitEditMode:{key:"ArrowDown",ctrlOrMetaKey:!0}};function _Ke(t){return Object.keys(Lte).reduce((e,i)=>{const r=t[i]===void 0?Lte[i]:t[i],n=r&&r.key;if(!n||typeof n!="string")return e;const a={key:n,ctrlOrMetaKey:!!(r.ctrlOrMetaKey||r.ctrlKey||r.metaKey)};return n.length>1&&(a.altKey=!!r.altKey,a.shiftKey=!!r.shiftKey),e[i]=a,e},{})}const $te=t=>t.map(e=>`<button type="button" class="%buttonClass% ${e}" tabindex="-1"></button>`).join(""),OKe=A8(`<div class="datepicker">
  <div class="datepicker-picker">
    <div class="datepicker-header">
      <div class="datepicker-title"></div>
      <div class="datepicker-controls">
        ${$te(["prev-button prev-btn","view-switch","next-button next-btn"])}
      </div>
    </div>
    <div class="datepicker-main"></div>
    <div class="datepicker-footer">
      <div class="datepicker-controls">
        ${$te(["today-button today-btn","clear-button clear-btn"])}
      </div>
    </div>
  </div>
</div>`),FKe=A8(`<div class="days">
  <div class="days-of-week">${_T("span",7,{class:"dow"})}</div>
  <div class="datepicker-grid">${_T("span",42)}</div>
</div>`),LKe=A8(`<div class="week-numbers calendar-weeks">
  <div class="days-of-week"><span class="dow"></span></div>
  <div class="weeks">${_T("span",6,{class:"week"})}</div>
</div>`);class v8{constructor(e,i){Object.assign(this,i,{picker:e,element:Ig('<div class="datepicker-view"></div>').firstChild,selected:[],isRangeEnd:!!e.datepicker.rangeSideIndex}),this.init(this.picker.datepicker.config)}init(e){"pickLevel"in e&&(this.isMinView=this.id===e.pickLevel),this.setOptions(e),this.updateFocus(),this.updateSelection()}prepareForRender(e,i,r){this.disabled=[];const n=this.picker;n.setViewSwitchLabel(e),n.setPrevButtonDisabled(i),n.setNextButtonDisabled(r)}setDisabled(e,i){i.add("disabled"),iM(this.disabled,e)}performBeforeHook(e,i){let r=this.beforeShow(new Date(i));switch(typeof r){case"boolean":r={enabled:r};break;case"string":r={classes:r}}if(r){const n=e.classList;if(r.enabled===!1&&this.setDisabled(i,n),r.classes){const a=r.classes.split(/\s+/);n.add(...a),a.includes("disabled")&&this.setDisabled(i,n)}r.content&&MKe(e,r.content)}}renderCell(e,i,r,n,{selected:a,range:s},o,l=[]){e.textContent=i,this.isMinView&&(e.dataset.date=n);const c=e.classList;if(e.className=`datepicker-cell ${this.cellClass}`,r<this.first?c.add("prev"):r>this.last&&c.add("next"),c.add(...l),(o||this.checkDisabled(n,this.id))&&this.setDisabled(n,c),s){const[u,d]=s;r>u&&r<d&&c.add("range"),r===u&&c.add("range-start"),r===d&&c.add("range-end")}a.includes(r)&&c.add("selected"),r===this.focused&&c.add("focused"),this.beforeShow&&this.performBeforeHook(e,n)}refreshCell(e,i,r,[n,a]){const s=e.classList;s.remove("range","range-start","range-end","selected","focused"),i>n&&i<a&&s.add("range"),i===n&&s.add("range-start"),i===a&&s.add("range-end"),r.includes(i)&&s.add("selected"),i===this.focused&&s.add("focused")}changeFocusedCell(e){this.grid.querySelectorAll(".focused").forEach(i=>{i.classList.remove("focused")}),this.grid.children[e].classList.add("focused")}}class $Ke extends v8{constructor(e){super(e,{id:0,name:"days",cellClass:"day"})}init(e,i=!0){if(i){const r=Ig(FKe).firstChild;this.dow=r.firstChild,this.grid=r.lastChild,this.element.appendChild(r)}super.init(e)}setOptions(e){let i;if("minDate"in e&&(this.minDate=e.minDate),"maxDate"in e&&(this.maxDate=e.maxDate),e.checkDisabled&&(this.checkDisabled=e.checkDisabled),e.daysOfWeekDisabled&&(this.daysOfWeekDisabled=e.daysOfWeekDisabled,i=!0),e.daysOfWeekHighlighted&&(this.daysOfWeekHighlighted=e.daysOfWeekHighlighted),"todayHighlight"in e&&(this.todayHighlight=e.todayHighlight),"weekStart"in e&&(this.weekStart=e.weekStart,this.weekEnd=e.weekEnd,i=!0),e.locale){const r=this.locale=e.locale;this.dayNames=r.daysMin,this.switchLabelFormat=r.titleFormat,i=!0}if("beforeShowDay"in e&&(this.beforeShow=typeof e.beforeShowDay=="function"?e.beforeShowDay:void 0),"weekNumbers"in e)if(e.weekNumbers&&!this.weekNumbers){const r=Ig(LKe).firstChild;this.weekNumbers={element:r,dow:r.firstChild,weeks:r.lastChild},this.element.insertBefore(r,this.element.firstChild)}else this.weekNumbers&&!e.weekNumbers&&(this.element.removeChild(this.weekNumbers.element),this.weekNumbers=null);"getWeekNumber"in e&&(this.getWeekNumber=e.getWeekNumber),"showDaysOfWeek"in e&&(e.showDaysOfWeek?(u0(this.dow),this.weekNumbers&&u0(this.weekNumbers.dow)):(c0(this.dow),this.weekNumbers&&c0(this.weekNumbers.dow))),i&&Array.from(this.dow.children).forEach((r,n)=>{const a=(this.weekStart+n)%7;r.textContent=this.dayNames[a],r.className=this.daysOfWeekDisabled.includes(a)?"dow disabled":"dow"})}updateFocus(){const e=new Date(this.picker.viewDate),i=e.getFullYear(),r=e.getMonth(),n=OT(i,r,1),a=TI(n,this.weekStart,this.weekStart);this.first=n,this.last=OT(i,r+1,0),this.start=a,this.focused=this.picker.viewDate}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e,i&&(this.range=i.dates)}render(){if(this.today=this.todayHighlight?Xw():void 0,this.prepareForRender(rM(this.focused,this.switchLabelFormat,this.locale),this.first<=this.minDate,this.last>=this.maxDate),this.weekNumbers){const e=this.weekStart,i=TI(this.first,e,e);Array.from(this.weekNumbers.weeks.children).forEach((r,n)=>{const a=UKe(i,n);r.textContent=this.getWeekNumber(a,e),n>3&&r.classList[a>this.last?"add":"remove"]("next")})}Array.from(this.grid.children).forEach((e,i)=>{const r=RP(this.start,i),n=new Date(r),a=n.getDay(),s=[];this.today===r&&s.push("today"),this.daysOfWeekHighlighted.includes(a)&&s.push("highlighted"),this.renderCell(e,n.getDate(),r,r,this,r<this.minDate||r>this.maxDate||this.daysOfWeekDisabled.includes(a),s)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.dataset.date),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/864e5))}}function Hte(t,e){if(!t||!t[0]||!t[1])return;const[[i,r],[n,a]]=t;if(!(i>e||n<e))return[i===e?r:-1,n===e?a:12]}class HKe extends v8{constructor(e){super(e,{id:1,name:"months",cellClass:"month"})}init(e,i=!0){i&&(this.grid=this.element,this.element.classList.add("months","datepicker-grid"),this.grid.appendChild(Ig(_T("span",12,{"data-month":r=>r}))),this.first=0,this.last=11),super.init(e)}setOptions(e){if(e.locale&&(this.monthNames=e.locale.monthsShort),"minDate"in e)if(e.minDate===void 0)this.minYear=this.minMonth=this.minDate=void 0;else{const i=new Date(e.minDate);this.minYear=i.getFullYear(),this.minMonth=i.getMonth(),this.minDate=i.setDate(1)}if("maxDate"in e)if(e.maxDate===void 0)this.maxYear=this.maxMonth=this.maxDate=void 0;else{const i=new Date(e.maxDate);this.maxYear=i.getFullYear(),this.maxMonth=i.getMonth(),this.maxDate=OT(this.maxYear,this.maxMonth+1,0)}e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),"beforeShowMonth"in e&&(this.beforeShow=typeof e.beforeShowMonth=="function"?e.beforeShowMonth:void 0)}updateFocus(){const e=new Date(this.picker.viewDate);this.year=e.getFullYear(),this.focused=e.getMonth()}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((r,n)=>{const a=new Date(n),s=a.getFullYear(),o=a.getMonth();return r[s]===void 0?r[s]=[o]:iM(r[s],o),r},{}),i&&i.dates&&(this.range=i.dates.map(r=>{const n=new Date(r);return isNaN(n)?void 0:[n.getFullYear(),n.getMonth()]}))}render(){this.prepareForRender(this.year,this.year<=this.minYear,this.year>=this.maxYear);const e=this.selected[this.year]||[],i=this.year<this.minYear||this.year>this.maxYear,r=this.year===this.minYear,n=this.year===this.maxYear,a=Hte(this.range,this.year);Array.from(this.grid.children).forEach((s,o)=>{const l=ay(new Date(this.year,o,1),1,this.isRangeEnd);this.renderCell(s,this.monthNames[o],o,l,{selected:e,range:a},i||r&&o<this.minMonth||n&&o>this.maxMonth)})}refresh(){const e=this.selected[this.year]||[],i=Hte(this.range,this.year)||[];Array.from(this.grid.children).forEach((r,n)=>{this.refreshCell(r,n,e,i)})}refreshFocus(){this.changeFocusedCell(this.focused)}}function VKe(t){return[...t].reduce((e,i,r)=>e+=r?i:i.toUpperCase(),"")}class Vte extends v8{constructor(e,i){super(e,i)}init(e,i=!0){i&&(this.navStep=this.step*10,this.beforeShowOption=`beforeShow${VKe(this.cellClass)}`,this.grid=this.element,this.element.classList.add(this.name,"datepicker-grid"),this.grid.appendChild(Ig(_T("span",12)))),super.init(e)}setOptions(e){if("minDate"in e&&(e.minDate===void 0?this.minYear=this.minDate=void 0:(this.minYear=YS(e.minDate,this.step),this.minDate=OT(this.minYear,0,1))),"maxDate"in e&&(e.maxDate===void 0?this.maxYear=this.maxDate=void 0:(this.maxYear=YS(e.maxDate,this.step),this.maxDate=OT(this.maxYear,11,31))),e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),this.beforeShowOption in e){const i=e[this.beforeShowOption];this.beforeShow=typeof i=="function"?i:void 0}}updateFocus(){const e=new Date(this.picker.viewDate),i=YS(e,this.navStep),r=i+9*this.step;this.first=i,this.last=r,this.start=i-this.step,this.focused=YS(e,this.step)}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((r,n)=>iM(r,YS(n,this.step)),[]),i&&i.dates&&(this.range=i.dates.map(r=>{if(r!==void 0)return YS(r,this.step)}))}render(){this.prepareForRender(`${this.first}-${this.last}`,this.first<=this.minYear,this.last>=this.maxYear),Array.from(this.grid.children).forEach((e,i)=>{const r=this.start+i*this.step,n=ay(new Date(r,0,1),2,this.isRangeEnd);e.dataset.year=r,this.renderCell(e,r,r,n,this,r<this.minYear||r>this.maxYear)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.textContent),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/this.step))}}function IU(t,e){const i={bubbles:!0,cancelable:!0,detail:{date:t.getDate(),viewDate:new Date(t.picker.viewDate),viewId:t.picker.currentView.id,datepicker:t}};t.element.dispatchEvent(new CustomEvent(e,i))}function b_(t,e){const{config:i,picker:r}=t,{currentView:n,viewDate:a}=r;let s;switch(n.id){case 0:s=A_(a,e);break;case 1:s=MP(a,e);break;default:s=MP(a,e*n.navStep)}s=dIe(s,i.minDate,i.maxDate),r.changeFocus(s).render()}function IIe(t){const e=t.picker.currentView.id;e!==t.config.maxView&&t.picker.changeView(e+1).render()}function wIe(t){t.setDate({clear:!0})}function SIe(t){const e=Xw();t.config.todayButtonMode===1?t.setDate(e,{forceRefresh:!0,viewDate:e}):t.setFocusedDate(e,!0)}function UIe(t){const e=()=>{t.config.updateOnBlur?t.update({revert:!0}):t.refresh("input"),t.hide()},i=t.element;h2(i)?i.addEventListener("blur",e,{once:!0}):e()}function Gte(t,e){const i=t.picker,r=new Date(i.viewDate),n=i.currentView.id,a=n===1?A_(r,e-r.getMonth()):MP(r,e-r.getFullYear());i.changeFocus(a).changeView(n-1).render()}function GKe(t){IIe(t)}function QKe(t){b_(t,-1)}function jKe(t){b_(t,1)}function zKe(t,e){const i=yIe(e,".datepicker-cell");if(!i||i.classList.contains("disabled"))return;const{id:r,isMinView:n}=t.picker.currentView,a=i.dataset;n?t.setDate(Number(a.date)):r===1?Gte(t,Number(a.month)):Gte(t,Number(a.year))}function qKe(t){t.preventDefault()}const HV=["left","top","right","bottom"].reduce((t,e)=>(t[e]=`datepicker-orient-${e}`,t),{}),Qte=t=>t&&`${t}px`;function jte(t,e){if("title"in e&&(e.title?(t.controls.title.textContent=e.title,u0(t.controls.title)):(t.controls.title.textContent="",c0(t.controls.title))),e.prevArrow){const i=t.controls.prevButton;g_(i),e.prevArrow.forEach(r=>{i.appendChild(r.cloneNode(!0))})}if(e.nextArrow){const i=t.controls.nextButton;g_(i),e.nextArrow.forEach(r=>{i.appendChild(r.cloneNode(!0))})}if(e.locale&&(t.controls.todayButton.textContent=e.locale.today,t.controls.clearButton.textContent=e.locale.clear),"todayButton"in e&&(e.todayButton?u0(t.controls.todayButton):c0(t.controls.todayButton)),"minDate"in e||"maxDate"in e){const{minDate:i,maxDate:r}=t.datepicker.config;t.controls.todayButton.disabled=!m8(Xw(),i,r)}"clearButton"in e&&(e.clearButton?u0(t.controls.clearButton):c0(t.controls.clearButton))}function zte(t){const{dates:e,config:i,rangeSideIndex:r}=t,n=e.length>0?h8(e):ay(i.defaultViewDate,i.pickLevel,r);return dIe(n,i.minDate,i.maxDate)}function qte(t,e){!("_oldViewDate"in t)&&e!==t.viewDate&&(t._oldViewDate=t.viewDate),t.viewDate=e;const{id:i,year:r,first:n,last:a}=t.currentView,s=new Date(e).getFullYear();switch(i){case 0:return e<n||e>a;case 1:return s!==r;default:return s<n||s>a}}function VV(t){return window.getComputedStyle(t).direction}function TIe(t){const e=AIe(t);if(!(e===document.body||!e))return window.getComputedStyle(e).overflow!=="visible"?e:TIe(e)}let WKe=class{constructor(e){const{config:i,inputField:r}=this.datepicker=e,n=OKe.replace(/%buttonClass%/g,i.buttonClass),a=this.element=Ig(n).firstChild,[s,o,l]=a.firstChild.children,c=s.firstElementChild,[u,d,p]=s.lastElementChild.children,[f,h]=l.firstChild.children,m={title:c,prevButton:u,viewSwitch:d,nextButton:p,todayButton:f,clearButton:h};this.main=o,this.controls=m;const A=r?"dropdown":"inline";a.classList.add(`datepicker-${A}`),jte(this,i),this.viewDate=zte(e),y_(e,[[a,"mousedown",qKe],[o,"click",zKe.bind(null,e)],[m.viewSwitch,"click",GKe.bind(null,e)],[m.prevButton,"click",QKe.bind(null,e)],[m.nextButton,"click",jKe.bind(null,e)],[m.todayButton,"click",SIe.bind(null,e)],[m.clearButton,"click",wIe.bind(null,e)]]),this.views=[new $Ke(this),new HKe(this),new Vte(this,{id:2,name:"years",cellClass:"year",step:1}),new Vte(this,{id:3,name:"decades",cellClass:"decade",step:10})],this.currentView=this.views[i.startView],this.currentView.render(),this.main.appendChild(this.currentView.element),i.container?i.container.appendChild(this.element):r.after(this.element)}setOptions(e){jte(this,e),this.views.forEach(i=>{i.init(e,!1)}),this.currentView.render()}detach(){this.element.remove()}show(){if(this.active)return;const{datepicker:e,element:i}=this,r=e.inputField;if(r){const n=VV(r);n!==VV(AIe(i))?i.dir=n:i.dir&&i.removeAttribute("dir"),this.place(),i.classList.add("active"),e.config.disableTouchKeyboard&&r.blur()}else i.classList.add("active");this.active=!0,IU(e,"show")}hide(){this.active&&(this.datepicker.exitEditMode(),this.element.classList.remove("active"),this.active=!1,IU(this.datepicker,"hide"))}place(){const{classList:e,style:i}=this.element;i.display="block";const{width:r,height:n}=this.element.getBoundingClientRect(),a=this.element.offsetParent;i.display="";const{config:s,inputField:o}=this.datepicker,{left:l,top:c,right:u,bottom:d,width:p,height:f}=o.getBoundingClientRect();let{x:h,y:m}=s.orientation,A=l,g=c;if(a===document.body||!a)A+=window.scrollX,g+=window.scrollY;else{const T=a.getBoundingClientRect();A-=T.left-a.scrollLeft,g-=T.top-a.scrollTop}const v=TIe(o);let b=0,y=0,{clientWidth:I,clientHeight:w}=document.documentElement;if(v){const T=v.getBoundingClientRect();T.top>0&&(y=T.top),T.left>0&&(b=T.left),T.right<I&&(I=T.right),T.bottom<w&&(w=T.bottom)}let S=0;h==="auto"&&(l<b?(h="left",S=b-l):l+r>I?(h="right",I<u&&(S=I-u)):VV(o)==="rtl"?h=u-r<b?"left":"right":h="left"),h==="right"&&(A+=p-r),A+=S,m==="auto"&&(c-n>y?m=d+n>w?"top":"bottom":m="bottom"),m==="top"?g-=n:g+=f,e.remove(...Object.values(HV)),e.add(HV[h],HV[m]),i.left=Qte(A),i.top=Qte(g)}setViewSwitchLabel(e){this.controls.viewSwitch.textContent=e}setPrevButtonDisabled(e){this.controls.prevButton.disabled=e}setNextButtonDisabled(e){this.controls.nextButton.disabled=e}changeView(e){const i=this.currentView;return e!==i.id&&(this._oldView||(this._oldView=i),this.currentView=this.views[e],this._renderMethod="render"),this}changeFocus(e){return this._renderMethod=qte(this,e)?"render":"refreshFocus",this.views.forEach(i=>{i.updateFocus()}),this}update(e=void 0){const i=e===void 0?zte(this.datepicker):e;return this._renderMethod=qte(this,i)?"render":"refresh",this.views.forEach(r=>{r.updateFocus(),r.updateSelection()}),this}render(e=!0){const{currentView:i,datepicker:r,_oldView:n}=this,a=new Date(this._oldViewDate),s=e&&this._renderMethod||"render";if(delete this._oldView,delete this._oldViewDate,delete this._renderMethod,i[s](),n&&(this.main.replaceChild(i.element,n.element),IU(r,"changeView")),!isNaN(a)){const o=new Date(this.viewDate);o.getFullYear()!==a.getFullYear()&&IU(r,"changeYear"),o.getMonth()!==a.getMonth()&&IU(r,"changeMonth")}}};function CIe(t,e,i,r,n,a){if(m8(t,n,a)){if(r(t)){const s=e(t,i);return CIe(s,e,i,r,n,a)}return t}}function KKe(t,e,i){const r=t.picker,n=r.currentView,a=n.step||1;let s=r.viewDate,o;switch(n.id){case 0:s=RP(s,i?e*7:e),o=RP;break;case 1:s=A_(s,i?e*4:e),o=A_;break;default:s=MP(s,e*(i?4:1)*a),o=MP}s=CIe(s,o,e<0?-a:a,l=>n.disabled.includes(l),n.minDate,n.maxDate),s!==void 0&&r.changeFocus(s).render()}function YKe(t,e){const{config:i,picker:r,editMode:n}=t,a=r.active,{key:s,altKey:o,shiftKey:l}=e,c=e.ctrlKey||e.metaKey,u=()=>{e.preventDefault(),e.stopPropagation()};if(s==="Tab"){UIe(t);return}if(s==="Enter"){if(!a)t.update();else if(n)t.exitEditMode({update:!0,autohide:i.autohide});else{const m=r.currentView;m.isMinView?t.setDate(r.viewDate):(r.changeView(m.id-1).render(),u())}return}const d=i.shortcutKeys,p={key:s,ctrlOrMetaKey:c,altKey:o,shiftKey:l},f=Object.keys(d).find(m=>{const A=d[m];return!Object.keys(A).find(g=>A[g]!==p[g])});if(f){let m;if(f==="toggle"?m=f:n?f==="exitEditMode"&&(m=f):a?f==="hide"?m=f:f==="prevButton"?m=[b_,[t,-1]]:f==="nextButton"?m=[b_,[t,1]]:f==="viewSwitch"?m=[IIe,[t]]:i.clearButton&&f==="clearButton"?m=[wIe,[t]]:i.todayButton&&f==="todayButton"&&(m=[SIe,[t]]):f==="show"&&(m=f),m){Array.isArray(m)?m[0].apply(null,m[1]):t[m](),u();return}}if(!a||n)return;const h=(m,A)=>{l||c||o?t.enterEditMode():(KKe(t,m,A),e.preventDefault())};s==="ArrowLeft"?h(-1,!1):s==="ArrowRight"?h(1,!1):s==="ArrowUp"?h(-1,!0):s==="ArrowDown"?h(1,!0):(s==="Backspace"||s==="Delete"||s&&s.length===1&&!c)&&t.enterEditMode()}function XKe(t){t.config.showOnFocus&&!t._showing&&t.show()}function ZKe(t,e){const i=e.target;(t.picker.active||t.config.showOnClick)&&(i._active=h2(i),i._clicking=setTimeout(()=>{delete i._active,delete i._clicking},2e3))}function JKe(t,e){const i=e.target;i._clicking&&(clearTimeout(i._clicking),delete i._clicking,i._active&&t.enterEditMode(),delete i._active,t.config.showOnClick&&t.show())}function e6e(t,e){e.clipboardData.types.includes("text/plain")&&t.enterEditMode()}function t6e(t,e){const{element:i,picker:r}=t;if(!r.active&&!h2(i))return;const n=r.element;yIe(e,a=>a===i||a===n)||UIe(t)}function EIe(t,e){return t.map(i=>rM(i,e.format,e.locale)).join(e.dateDelimiter)}function DIe(t,e,i=!1){if(e.length===0)return i?[]:void 0;const{config:r,dates:n,rangeSideIndex:a}=t,{pickLevel:s,maxNumberOfDates:o}=r;let l=e.reduce((c,u)=>{let d=ew(u,r.format,r.locale);return d===void 0||(d=ay(d,s,a),m8(d,r.minDate,r.maxDate)&&!c.includes(d)&&!r.checkDisabled(d,s)&&(s>0||!r.daysOfWeekDisabled.includes(new Date(d).getDay()))&&c.push(d)),c},[]);if(l.length!==0)return r.multidate&&!i&&(l=l.reduce((c,u)=>(n.includes(u)||c.push(u),c),n.filter(c=>!l.includes(c)))),o&&l.length>o?l.slice(o*-1):l}function I_(t,e=3,i=!0,r=void 0){const{config:n,picker:a,inputField:s}=t;if(e&2){const o=a.active?n.pickLevel:n.startView;a.update(r).changeView(o).render(i)}e&1&&s&&(s.value=EIe(t.dates,n))}function Wte(t,e,i){const r=t.config;let{clear:n,render:a,autohide:s,revert:o,forceRefresh:l,viewDate:c}=i;a===void 0&&(a=!0),a?s===void 0&&(s=r.autohide):s=l=!1,c=ew(c,r.format,r.locale);const u=DIe(t,e,n);!u&&!o||(u&&u.toString()!==t.dates.toString()?(t.dates=u,I_(t,a?3:1,!0,c),IU(t,"changeDate")):I_(t,l?3:1,!0,c),s&&t.hide())}function Kte(t,e){return e?i=>rM(i,e,t.config.locale):i=>new Date(i)}let PIe=class{constructor(e,i={},r=void 0){e.datepicker=this,this.element=e,this.dates=[];const n=this.config=Object.assign({buttonClass:i.buttonClass&&String(i.buttonClass)||"button",container:null,defaultViewDate:Xw(),maxDate:void 0,minDate:void 0},$V(g8,this));let a;if(e.tagName==="INPUT"?(a=this.inputField=e,a.classList.add("datepicker-input"),i.container&&(n.container=i.container instanceof HTMLElement?i.container:document.querySelector(i.container))):n.container=e,r){const u=r.inputs.indexOf(a),d=r.datepickers;if(u<0||u>1||!Array.isArray(d))throw Error("Invalid rangepicker object.");d[u]=this,this.rangepicker=r,this.rangeSideIndex=u}this._options=i,Object.assign(n,$V(i,this)),n.shortcutKeys=_Ke(i.shortcutKeys||{});const s=Bte(e.value||e.dataset.date,n.dateDelimiter);delete e.dataset.date;const o=DIe(this,s);o&&o.length>0&&(this.dates=o),a&&(a.value=EIe(this.dates,n));const l=this.picker=new WKe(this),c=[e,"keydown",YKe.bind(null,this)];a?y_(this,[c,[a,"focus",XKe.bind(null,this)],[a,"mousedown",ZKe.bind(null,this)],[a,"click",JKe.bind(null,this)],[a,"paste",e6e.bind(null,this)],[document,"mousedown",t6e.bind(null,this)],[window,"resize",l.place.bind(l)]]):(y_(this,[c]),this.show())}static formatDate(e,i,r){return rM(e,i,r&&nD[r]||nD.en)}static parseDate(e,i,r){return ew(e,i,r&&nD[r]||nD.en)}static get locales(){return nD}get active(){return!!(this.picker&&this.picker.active)}get pickerElement(){return this.picker?this.picker.element:void 0}setOptions(e){const i=$V(e,this);Object.assign(this._options,e),Object.assign(this.config,i),this.picker.setOptions(i),I_(this,3)}show(){if(this.inputField){const{config:e,inputField:i}=this;if(i.disabled||i.readOnly&&!e.enableOnReadonly)return;!h2(i)&&!e.disableTouchKeyboard&&(this._showing=!0,i.focus(),delete this._showing)}this.picker.show()}hide(){this.inputField&&(this.picker.hide(),this.picker.update().changeView(this.config.startView).render())}toggle(){this.picker.active?this.inputField&&this.picker.hide():this.show()}destroy(){this.hide(),gIe(this),this.picker.detach();const e=this.element;return e.classList.remove("datepicker-input"),delete e.datepicker,this}getDate(e=void 0){const i=Kte(this,e);if(this.config.multidate)return this.dates.map(i);if(this.dates.length>0)return i(this.dates[0])}setDate(...e){const i=[...e],r={},n=h8(e);n&&typeof n=="object"&&!Array.isArray(n)&&!(n instanceof Date)&&Object.assign(r,i.pop());const a=Array.isArray(i[0])?i[0]:i;Wte(this,a,r)}update(e=void 0){if(!this.inputField)return;const i=Object.assign(e||{},{clear:!0,render:!0,viewDate:void 0}),r=Bte(this.inputField.value,this.config.dateDelimiter);Wte(this,r,i)}getFocusedDate(e=void 0){return Kte(this,e)(this.picker.viewDate)}setFocusedDate(e,i=!1){const{config:r,picker:n,active:a,rangeSideIndex:s}=this,o=r.pickLevel,l=ew(e,r.format,r.locale);l!==void 0&&(n.changeFocus(ay(l,o,s)),a&&i&&n.changeView(o),n.render())}refresh(e=void 0,i=!1){e&&typeof e!="string"&&(i=e,e=void 0);let r;e==="picker"?r=2:e==="input"?r=1:r=3,I_(this,r,!i)}enterEditMode(){const e=this.inputField;!e||e.readOnly||!this.picker.active||this.editMode||(this.editMode=!0,e.classList.add("in-edit"))}exitEditMode(e=void 0){if(!this.inputField||!this.editMode)return;const i=Object.assign({update:!1},e);delete this.editMode,this.inputField.classList.remove("in-edit"),i.update&&this.update(i)}};function Yte(t){const e=Object.assign({},t);return delete e.inputs,delete e.allowOneSidedRange,delete e.maxNumberOfDates,e}function i6e(t,e,i,r){y_(t,[[i,"changeDate",e]]),new PIe(i,r,t)}function aD(t,e){if(t._updating)return;t._updating=!0;const i=e.target;if(i.datepicker===void 0)return;const r=t.datepickers,[n,a]=r,s={render:!1},o=t.inputs.indexOf(i),l=o===0?1:0,c=r[o].dates[0],u=r[l].dates[0];c!==void 0&&u!==void 0?o===0&&c>u?(n.setDate(u,s),a.setDate(c,s)):o===1&&c<u&&(n.setDate(c,s),a.setDate(u,s)):t.allowOneSidedRange||(c!==void 0||u!==void 0)&&(s.clear=!0,r[l].setDate(r[o].dates,s)),r.forEach(d=>{d.picker.update().render()}),delete t._updating}class r6e{constructor(e,i={}){let r=Array.isArray(i.inputs)?i.inputs:Array.from(e.querySelectorAll("input"));if(r.length<2)return;e.rangepicker=this,this.element=e,this.inputs=r=r.slice(0,2),Object.freeze(r),this.allowOneSidedRange=!!i.allowOneSidedRange;const n=aD.bind(null,this),a=Yte(i),s=this.datepickers=[];r.forEach(o=>{i6e(this,n,o,a)}),Object.freeze(s),Object.defineProperty(this,"dates",{get(){return s.map(o=>o.dates[0])}}),s[0].dates.length>0?aD(this,{target:r[0]}):s[1].dates.length>0&&aD(this,{target:r[1]})}setOptions(e){this.allowOneSidedRange=!!e.allowOneSidedRange;const i=Yte(e);this.datepickers.forEach(r=>{r.setOptions(i)})}destroy(){this.datepickers.forEach(e=>{e.destroy()}),gIe(this),delete this.element.rangepicker}getDates(e=void 0){const i=e?r=>rM(r,e,this.datepickers[0].config.locale):r=>new Date(r);return this.dates.map(r=>r===void 0?r:i(r))}setDates(e,i){const{datepickers:[r,n],inputs:[a,s],dates:[o,l]}=this;this._updating=!0,r.setDate(e),n.setDate(i),delete this._updating,n.dates[0]!==l?aD(this,{target:s}):r.dates[0]!==o&&aD(this,{target:a})}}function RIe(t,e,i,r,n){if(n){const a=e.target.value;n(a)?(r.innerHTML="",r.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(r.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),r.classList.add("is-danger"))}}const GV="none";function y8(t,e){for(const i of e.options){if(i.hide)continue;const r=document.createElement("option");r.className="font-medium",i.value&&r.setAttribute("value",i.value),(i.selected||e.value===i.value)&&r.setAttribute("selected","true"),i.disabled&&r.setAttribute("disabled","true"),r.innerHTML=i.label,t.appendChild(r)}}function d0(t){const e=document.createElement("div");if(e.className="field font-medium",t.class&&e.classList.add(t.class),t.width?e.style.cssText=`width: ${t.width}`:e.style.cssText="flex-grow: 1",t.label&&!t.checkbox){const s=document.createElement("label");s.style.cssText=t.labelStyle||"font-weight: bold; font-size: larger;",s.innerHTML=t.label,e.appendChild(s)}let i,r,n=[];const a=document.createElement("div");if(a.className="control font-medium",t.controlVisible===!1&&(a.style.display=GV),t.controlId&&(a.id=t.controlId),t.text){const s=document.createElement("div");t.id&&(s.id=t.id),s.className="content",s.innerHTML=t.text,a.appendChild(s)}else if(t.radio){const s=document.createElement("div");s.id=t.id,s.className="control";for(const o of t.options??[]){const l=document.createElement("label");l.className="radio";const c=document.createElement("input");o.field&&n.push({input:c,field:o.field}),o.id&&(c.id=o.id),c.name=t.id,c.type="radio",c.value=o.text,o.checked&&(c.checked=!0),l.appendChild(c),s.appendChild(l);const u=document.createElement("span");u.style.marginLeft=".25em",u.style.marginRight="1em",u.style.color="#000",u.innerHTML=o.text,s.appendChild(u)}a.appendChild(s),i=s}else if(t.options){const s=document.createElement("div");s.className="select font-medium",s.style.cssText="width: 100%",t.zIndex&&(s.style.zIndex=t.zIndex);const o=document.createElement("select");if(t.dataPlaceholder&&o.setAttribute("data-placeholder",t.dataPlaceholder),t.dataType&&o.setAttribute("data-type",t.dataType),t.multiple&&o.setAttribute("multiple","true"),t.disabled&&(o.disabled=!0),t.id&&(s.id=t.id),o.style.cssText="width: 100%",y8(o,t),s.appendChild(o),a.appendChild(s),t.help){const l=document.createElement("p");l.className="help font-medium is-info",l.innerHTML=t.help?.text,l.style.display=t.help?.visible?"":GV,a.appendChild(l)}i=o,yc(t.onChange)&&o.addEventListener("change",l=>t.onChange(l,t))}else if(t.checkbox){const s=document.createElement("div");s.className="flexrow nowrap",s.style.display="inline-block";const o=document.createElement("input");yc(t.onChange)&&o.addEventListener("change",u=>t.onChange(u,t)),i=o;const l=t.intent??"is-success";o.className=`is-checkradio ${l}`,o.type="checkbox",o.id=t.id,t.checked&&(o.checked=!0),s.appendChild(o);const c=document.createElement("label");c.setAttribute("for",t.id),t.color&&(c.style.color=t.color),c.innerHTML=t.label,s.appendChild(c),a.appendChild(s)}else{const s=document.createElement("input");if(s.className="input font-medium",t.class&&s.classList.add(t.class),s.setAttribute("type",t.type||"text"),s.setAttribute("autocomplete",t.autocomplete||"off"),s.setAttribute("placeholder",t.placeholder||""),t.disabled&&s.setAttribute("disabled","true"),t.id&&s.setAttribute("id",t.id),a.appendChild(s),t.iconLeft){a.classList.add("has-icons-left");const l=document.createElement("span");l.className="icon is-small is-left font-medium";const c=document.createElement("i");c.className=t.iconLeft,l.appendChild(c),a.appendChild(l)}if(t.type==="password"){a.classList.add("has-icons-right");const l=document.createElement("span");l.className="icon is-small is-right font-medium";const c=document.createElement("i");c.className=t.iconRight,l.appendChild(c),a.appendChild(l)}i=s;const o=document.createElement("p");if(o.className="help font-medium",a.appendChild(o),t.validator&&s.addEventListener("input",l=>RIe(t,l,s,o,t.validator)),t.date){const l=t.maxNumberOfDates||1,c=!t.maxNumberOfDates||l===1;r=new PIe(s,{maxDate:t.maxDate,minDate:t.minDate,format:"yyyy-mm-dd",maxNumberOfDates:l,autohide:c})}else t.typeAhead&&SKe({...t.typeAhead,element:s});yc(t.onKeyDown)&&s.addEventListener("keydown",l=>t.onKeyDown(l,t)),yc(t.onChange)&&s.addEventListener("change",l=>t.onChange(l,t)),yc(t.onInput)&&s.addEventListener("input",l=>t.onInput(l,t)),yc(t.onKeyUp)&&s.addEventListener("keyup",l=>t.onKeyUp(l,t)),t.value!==void 0&&(s.value=t.value),t.selectOnFocus&&s.addEventListener("focus",()=>s.select())}return e.appendChild(a),t.visible===!1&&(e.style.display=GV),{field:e,inputElement:i,datepicker:r,subFields:n}}const QV="__BYE__",jV="__QUALIFIER__";function n6e({matchUp:t,side:e,sideNumber:i,eventHandlers:r,composition:n,position:a,currentParticipant:s}){const o=n?.configuration,l=e?.drawPosition,c=()=>{const b=co(o?.participantProvider)?o.participantProvider():[],y=o?.persistInputFields;let I=b;y&&s&&(b.some(C=>C.participantId===s.participantId)||(I=[s,...b]));const w=I.map(C=>({label:C.participantName||C.participantId,value:C.participantId})),S=s?.participantId===QV,T=s?.participantId===jV,D=[];return S||D.push({label:" BYE ",value:QV}),o?.hasQualifying&&!T&&D.push({label:" QUALIFIER ",value:jV}),[...D,...w]},u=c(),d=b=>{if(!e)return;if(!b||b.trim()===""){co(r?.removeAssignment)&&r.removeAssignment({matchUp:t,side:e,sideNumber:i||1});return}if(b===QV){co(r?.assignBye)&&r.assignBye({matchUp:t,side:e,sideNumber:i||1});return}if(b===jV){co(r?.assignQualifier)&&r.assignQualifier({matchUp:t,side:e,sideNumber:i||1});return}const y=(co(o?.participantProvider)?o.participantProvider():[]).find(I=>I.participantId===b);y&&co(r?.assignParticipant)&&r.assignParticipant({matchUp:t,side:e,sideNumber:i||1,participant:y})};let p=!1;const f=()=>{if(p){p=!1;return}const b=Array.from(document.querySelectorAll(".participant-assignment-input input")),y=b.findIndex(I=>I.id===h);if(y!==-1&&y<b.length-1){const I=b[y+1];setTimeout(()=>{I.focus()},100)}},h=`assign-${t.matchUpId}-side${i}${a?`-p${a}`:""}`,m=s?.participantId,{field:A}=d0({typeAhead:{list:u,callback:d,onSelectComplete:f,listProvider:c,currentValue:m},placeholder:a?`Partner ${a}`:"Type participant name...",field:h,id:h,class:"participant-assignment-input"});l&&(A.dataset.drawPosition=l.toString());const g=A.querySelector("input");g&&g.addEventListener("keydown",b=>{b.key==="Tab"&&(p=!0,setTimeout(()=>{p=!1},500))}),A.style.width="100%",A.style.margin="0";const v=o?.assignmentInputFontSize;return v&&(A.style.fontSize=v),setTimeout(()=>{const b=A.querySelector("input");if(b){let y=b.parentElement,I=0;for(;y&&I<15;){const w=window.getComputedStyle(y);(w.overflow!=="visible"||w.overflowX!=="visible"||w.overflowY!=="visible")&&(y.style.setProperty("overflow","visible","important"),y.style.setProperty("overflow-x","visible","important"),y.style.setProperty("overflow-y","visible","important")),y=y.parentElement,I++}}},100),A}const a6e=mr({color:"$participant$seed",marginInlineStart:".5rem",textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem"});function s6e({className:t,composition:e,side:i}){const r=i?.seedValue==="~"?"":i?.seedValue!==void 0&&i.seedValue||i?.seedNumber;if(!r)return"";const n=e?.configuration||{},{bracketedSeeds:a}=n,s=typeof a=="boolean"&&["(",")"]||a==="square"&&["[","]"]||["",""],o=`${s[0]}${r}${s[1]}`,l=n.seedingElement==="sup"?"sup":"span",c=document.createElement(l);return c.className=t||"",c.innerHTML=o,c}const o6e=mr({WebkitBoxSizing:"border-box",marginInlineEnd:".5em",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"smaller",fontWeight:"bold",borderRadius:2,color:"blue",variants:{color:{green:{color:"green"},red:{color:"red"}}}});function l6e({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n}){const a=e?.configuration,s=a?.scaleAttributes?.eventType||r?.matchUpType||"SINGLES",o=t?.rankings,l=t?.ratings,c=a?.scaleAttributes,u=c?.scaleType,d=c?.scaleName,p=c?.accessor,f=u==="RATING"?l:o,h=f?.SINGLES?.find(T=>T?.scaleName===d)?.scaleValue,m=f?.DOUBLES?.find(T=>T?.scaleName===d)?.scaleValue,A=h&&p?h[p]:h||"",g=m&&p?m[p]:m||"",v=s==="SINGLES"?A:g,b=a?.scaleAttributes?.fallback,y=!n&&(v||b&&(A||g)),I=document.createElement("span"),w=a?.scaleAttributes?.scaleColor,S=w==="green"||w==="red"?w:void 0;return y&&(I.className=hb(i,o6e(S?{color:S}:{}))),I.innerHTML=y||"",I}var c6e=Object.defineProperty,Li=(t,e)=>{for(var i in e)c6e(t,i,{get:e[i],enumerable:!0})};function m2(){return"2.3.11"}var A2={};Li(A2,{competitionGovernor:()=>MIe,drawsGovernor:()=>RUe,entriesGovernor:()=>KDe,eventGovernor:()=>J$,generationGovernor:()=>v0e,matchUpFormatGovernor:()=>au,matchUpGovernor:()=>D0e,mocksGovernor:()=>vX,participantGovernor:()=>wPe,policyGovernor:()=>bDe,publishingGovernor:()=>jPe,queryGovernor:()=>TDe,reportGovernor:()=>e1e,scheduleGovernor:()=>t1e,scoreGovernor:()=>r9,tieFormatGovernor:()=>m1e,tournamentGovernor:()=>U1e,venueGovernor:()=>F1e});var MIe={};Li(MIe,{getLinkedTournamentIds:()=>SM,getTournamentIds:()=>IM,linkTournaments:()=>CUe,mutate:()=>NIe,query:()=>PUe,unlinkTournament:()=>DUe,unlinkTournaments:()=>EUe});var NIe={};Li(NIe,{linkTournaments:()=>CUe,unlinkTournament:()=>DUe,unlinkTournaments:()=>EUe});var CI="SINGLES",Dr="SINGLES",By="DOUBLES",br="DOUBLES",Pc="TEAM",Hr="TEAM",u6e={SINGLES_MATCHUP:CI,SINGLES:Dr,DOUBLES_MATCHUP:By,DOUBLES:br,TEAM_MATCHUP:Pc,TEAM:Hr},BIe={[Dr]:[Dr,"S"],[br]:[br,"D"],[Hr]:[Hr,"T"],S:[Dr,"S"],D:[br,"D"],T:[Hr,"T"]};function ua(t,e){return(t??0)-(e??0)}function ci(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function op(t){return isNaN(t)?!1:t&&(t&t-1)===0}function Xte(t){if(!t.length)return;let e=[...t].sort(ua),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function d6e(t){if(!op(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function b8(t){return isNaN(t)?0:t%2&&t+1||t}function I8(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Un(t){return!isNaN(parseFloat(t))}function kIe(t){let e=ci(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function lE(t){if(isNaN(t))return!1;for(;!op(t);)t++;return t}function Jc(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function wi(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function p6e(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function f6e(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function xIe(t,e,i,r,n=2){let a=1-Math.random(),s=1-Math.random(),o=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*s);return o=o/10+.5,o>1||o<0?o=xIe(t,e,i):(o=Math.pow(o,i),o*=e-t,o+=t),r&&(o=f6e(o,r)),parseFloat(o.toFixed(n))}function w_(t,e=2){return parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function Ei(t){return Array.isArray(t)?t?.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function h6e(t){return Array.isArray(t)?t?.map(e=>e===null?void 0:e):t}function Po(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function FT(t){return wi(t)?t:1/0}function Xl(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function m6e(t){return _Ie(Xl(t))}function _Ie(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function A6e(t,e,i){return i.indexOf(t)===e}function OIe(t){return t.filter(A6e)}function _l(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function Zu(t){let e=Math.floor(Math.random()*t.length);return t[e]}function vt(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function Wp(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function Mn(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function Zte(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function _o(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function g6e(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function v6e(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function $a(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function FIe(t,[e,...i]){return t.length?[t.slice(0,e),...FIe(t.slice(e),[...i,e])]:[]}function y6e(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function LIe(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function $Ie(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function v4(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let s=i?!!(Math.floor(a/e)%2):!1,o=a%e,l=s?e-1-o:o;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function b6e(t,e=1){if(!Array.isArray(t)||!t.every(wi))return[];let i=Math.min(...t,e),r=Math.max(...t);return vt(i,r+1).filter(n=>!t.includes(n))}function kl(t){return typeof t=="function"}function rn(t){return typeof t=="string"}function Xi(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function I6e(t,e){if(!Xi(t)||!Xi(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function HIe(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(Xi).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var w6e=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function y4(t,e){if(t===void 0)return null;if(!Xi(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>y4(a))}:{[n]:e?r(t[n]):y4(t[n])}))}function b4(t){return Array.isArray(t)?t.length+t.map(b4).reduce((e,i)=>e+i,0):Xi(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>b4(t[e])).reduce((e,i)=>e+i,0):0}function S6e(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=b4(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}function g2(t,e){return!Array.isArray(t)||!rn(e)?!1:Mn(t,BIe[e]).length}var oe={success:!0},VIe="error",U6e={SUCCESS:oe,ERROR:VIe};function GIe({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:s}=n;if(typeof a!="number"||typeof s!="number"||s>e||s<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==Ei(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...oe}}var T6e={};Li(T6e,{addNotice:()=>Ii,callListener:()=>R4,createInstanceState:()=>l8e,cycleMutationStatus:()=>Z8,deepCopyEnabled:()=>X8,deleteNotice:()=>J8,deleteNotices:()=>pM,disableNotifications:()=>rSe,enableNotifications:()=>P2,getDevContext:()=>Mc,getMethods:()=>sSe,getNotices:()=>oSe,getProvider:()=>M4,getTopics:()=>Tu,getTournamentId:()=>rS,getTournamentRecord:()=>eY,getTournamentRecords:()=>nS,globalLog:()=>uSe,handleCaughtError:()=>N2,hasTopic:()=>R2,removeTournamentRecord:()=>cSe,setDeepCopy:()=>xP,setDevContext:()=>kP,setGlobalLog:()=>iSe,setGlobalMethods:()=>nSe,setGlobalSubscriptions:()=>u8e,setMethods:()=>aSe,setStateMethods:()=>dSe,setStateProvider:()=>o8e,setSubscriptions:()=>d8e,setTournamentId:()=>_P,setTournamentRecord:()=>lSe,setTournamentRecords:()=>M2,timeKeeper:()=>c8e});var I4={message:"Chronological error; time violation.",code:"ANACHRONISM"},NP={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},QIe={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},w4={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},bn={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},nt={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},nM={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},LT={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},EI={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},kt={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},jIe={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},Rc={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},mb={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},w8={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},S8={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},$T={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},zIe={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},qIe={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},C6e={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},U8={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},aM={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},sM={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},E6e={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},Zw={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},cE={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},T8={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},v2={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},WIe={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},oM={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},hp={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},KIe={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},YIe={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},XIe={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},ZIe={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},JIe={message:"Invalid action",code:"ERR_INVALID_ACTION"},S4={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},ewe={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},twe={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},iwe={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},C8={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},rwe={message:"Existing round",code:"ERR_EXISTING_ROUND"},D6e={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},Fc={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},an={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},E8={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Ab={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},D8={message:"Missing MAIN structure",code:"ERR_MISSING_MAIN_STRUCTURE"},nwe={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Th={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Gr={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},fu={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},awe={message:"Event exists",code:"ERR_EXISTING_EVENT"},swe={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},owe={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},P8={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},lwe={message:"Missing stage",code:"ERR_MISSING_STAGE"},gb={message:"Invalid stage",code:"ERR_INVALID_STAGE"},cwe={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},uwe={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},dwe={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},U4={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},lM={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},Hk={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},P6e={message:"Propagated exits downstream",code:"ERR_PROPAGATED_EXITS_DOWNSTREAM"},uE={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},ah={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},R8={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},M8={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},pwe={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},dE={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},go={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},Jw={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},Zs={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},mA={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},Zo={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},wl={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},N8={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},y2={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},R6e={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},fwe={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},B8={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},hwe={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},k8={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},M6e={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},cM={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},N6e={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},x8={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},B6e={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},b2={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},k6e={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},x6e={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},eS={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Yt={message:"Missing value",code:"ERR_MISSING_VALUE"},mwe={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},Awe={message:"Missing date",code:"ERR_MISSING_DATE"},gwe={message:"No valid dates",code:"ERR_NO_VALID_DATES"},S_={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},Vk={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},vwe={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},ma={message:"Invalid Date",code:"ERR_INVALID_DATE"},zu={message:"Invalid time",code:"ERR_INVALID_TIME"},ywe={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},_6e={message:"Missing date range",info:"Event or tournament must have start and end dates",code:"ERR_MISSING_DATE_RANGE"},T4={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},bwe={message:"Invalid score",code:"ERR_INVALID_SCORE"},I2={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},O6e={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},_8={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},Iwe={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},w2={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},wwe={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},S2={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},tS={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},lp={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Ll={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},Swe={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},cp={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},Uwe={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},iS={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},uM={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},ba={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Twe={message:"Missing qualified participants",code:"ERR_MISSING_QUALIFIED_PARTICIPANTS"},Fn={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},Cwe={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},F6e={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},Ewe={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Jg={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},Dwe={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},Pwe={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},Rwe={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},pE={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},U2={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},O8={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},C4={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},Mwe={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},L6e={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},$6e={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},Nwe={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},Bwe={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},E4={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},F8={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},L8={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},kwe={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},$8={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},HT={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},xwe={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},Gm={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},_we={message:"Court exists",code:"ERR_EXISTING_COURT"},D4={message:"Booking not found",code:"ERR_NOT_FOUND_BOOKING"},Owe={message:"Existing matchUps conflict with booking",code:"ERR_EXISTING_MATCHUPS"},Fwe={message:"Venue exists",code:"ERR_EXISTING_VENUE"},vb={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},ev={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},Lwe={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},H8={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},$we={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},Hwe={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},H6e={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},V8={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},Vwe={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},G8={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},Q8={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},T2={message:"Missing context",code:"ERR_MISSING_CONTEXT"},Gwe={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},tw={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},Qwe={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},fE={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},jwe={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},C2={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},zwe={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},qwe={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},AA={message:"Invalid object",code:"ERR_INVALID_OBJECT"},p0={message:"Invalid gender",code:"ERR_INVALID_GENDER"},BP={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},we={message:"Invalid values",code:"ERR_INVALID_VALUES"},Wwe={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},j8={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},Kwe={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},E2={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},z8={message:"Value unchanged",code:"ABORT_UNCHANGED"},rs={message:"Not found",code:"ERR_NOT_FOUND"},q8={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},Ywe={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},W8={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},Xwe={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},Zwe={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},P4={message:"Existing stage",code:"ERR_EXISTING_STAGE"},K8={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},D2={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},Jwe={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},dM={message:"Scores present",code:"ERR_SCORES_PRESENT"},V6e={ANACHRONISM:I4,BOOKING_NOT_FOUND:D4,CANNOT_CHANGE_WINNING_SIDE:S2,CANNOT_MODIFY_TIEFORMAT:_8,CANNOT_MODIFY_PARTICIPANT_TYPE:Iwe,CANNOT_REMOVE_MAIN_STRUCTURE:QIe,CANNOT_REMOVE_PARTICIPANTS:w2,CATEGORY_MISMATCH:wwe,COURT_EXISTS:_we,COURT_NOT_FOUND:Gm,EXISTING_MATCHUPS:Owe,DRAW_DEFINITION_NOT_FOUND:Rc,DRAW_ID_EXISTS:KIe,DRAW_POSITION_ACTIVE:sM,DRAW_POSITION_ASSIGNED:$T,DRAW_POSITION_NOT_CLEARED:qIe,DRAW_POSITION_NOT_FOUND:C6e,DRAW_SIZE_MISMATCH:WIe,DUPLICATE_ENTRY:NP,DUPLICATE_VALUE:Wwe,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:Bwe,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:Nwe,EVENT_EXISTS:awe,EVENT_NOT_FOUND:fu,EXISTING_DRAW_DEFINITIONS:jIe,EXISTING_END_TIME:H8,EXISTING_FLIGHT:Ywe,EXISTING_MATCHUP_ID:Zwe,EXISTING_OUTCOME:Xwe,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:pE,EXISTING_PARTICIPANT:U2,EXISTING_POLICY_TYPE:k8,EXISTING_PROFILE:W8,EXISTING_ROUND:rwe,EXISTING_STAGE:P4,EXISTING_STRUCTURE:K8,INCOMPATIBLE_MATCHUP_STATUS:Hk,INCOMPLETE_SOURCE_STRUCTURE:w8,INSUFFICIENT_DRAW_POSITIONS:L8,INVALID_ACTION:JIe,INVALID_ASSIGNMENT:S4,INVALID_BOOKINGS:S_,INVALID_CATEGORY:BP,INVALID_COLLECTION_DEFINITION:qwe,INVALID_CONFIGURATION:zwe,INVALID_DATE_AVAILABILITY:Vk,INVALID_DATE:ma,INVALID_DRAW_DEFINITION:EI,INVALID_DRAW_POSITION_FOR_SEEDING:S8,INVALID_DRAW_POSITION:Zw,INVALID_DRAW_SIZE:v2,INVALID_END_TIME:Lwe,INVALID_ENTRIES:owe,INVALID_EVENT_TYPE:Th,INVALID_GAME_SCORES:T4,INVALID_GENDER:p0,INVALID_MATCHUP_FORMAT:R8,INVALID_MATCHUP_STATUS:uE,INVALID_MATCHUP_STATUS_BYE:dwe,INVALID_MATCHUP:wl,INVALID_OBJECT:AA,INVALID_PARTICIPANT_ID:lp,INVALID_PARTICIPANT_IDS:Ll,INVALID_PARTICIPANT_ROLE:Swe,INVALID_PARTICIPANT_SEEDING:YIe,INVALID_PARTICIPANT_TYPE:cp,INVALID_PARTICIPANT:tS,INVALID_POLICY_DEFINITION:hwe,INVALID_RECORDS:w4,INVALID_SCALE_ITEM:tw,INVALID_SEED_NUMBER:twe,INVALID_SEED_POSITION:iwe,INVALID_SET_NUMBER:B6e,INVALID_SIDE_NUMBER:x8,INVALID_SCORE:bwe,INVALID_STAGE:gb,INVALID_START_TIME:Hwe,INVALID_STRUCTURE:mb,INVALID_STOP_TIME:$we,INVALID_TIE_FORMAT:ah,INVALID_TIME:zu,INVALID_TIME_ITEM:V8,INVALID_TOURNAMENT_DATES:ywe,INVALID_TOURNAMENT_RECORD:nM,INVALID_VALUES:we,INVALID_WINNING_SIDE:I2,MATCHUP_NOT_FOUND:Zs,METHOD_NOT_FOUND:D2,MISSING_ASSIGNMENTS:P8,MISSING_ASYNC_STATE_PROVIDER:Vwe,MISSING_AVOIDANCE_POLICY:fwe,MISSING_BIRTH_DATE:mwe,MISSING_COLLECTION_DEFINITION:pwe,MISSING_COURT_ID:eS,MISSING_COURTS_INFO:xwe,MISSING_DATE_AVAILABILITY:vwe,MISSING_DATE:Awe,MISSING_DRAW_DEFINITION:kt,MISSING_DRAW_ID:hp,MISSING_DRAW_POSITION:cE,MISSING_DRAW_POSITIONS:aM,MISSING_DRAW_SIZE:oM,MISSING_ENTRIES:swe,MISSING_EVENT:Gr,MISSING_QUALIFIED_PARTICIPANTS:Twe,MISSING_MATCHUP_FORMAT:M8,MISSING_MATCHUP_ID:go,MISSING_MATCHUP_IDS:Jw,MISSING_MATCHUP:Zo,MISSING_MATCHUPS:mA,MISSING_PARTICIPANT_COUNT:Dwe,MISSING_PARTICIPANT_ID:ba,MISSING_PARTICIPANT_IDS:Jg,MISSING_PARTICIPANT_ROLE:Uwe,MISSING_PARTICIPANT:iS,MISSING_PARTICIPANTS:uM,MISSING_PENALTY_ID:$8,MISSING_PENALTY_TYPE:kwe,MISSING_PERSON_DETAILS:Rwe,MISSING_POLICY_ATTRIBUTES:B8,MISSING_POLICY_DEFINITION:y2,MISSING_POLICY_TYPE:N8,MISSING_POSITION_ASSIGNMENTS:uwe,MISSING_ROUND_NUMBER:D6e,MISSING_SCHEDULE:Gwe,MISSING_SCORING_POLICY:N6e,MISSING_SEED_ASSIGNMENTS:ewe,MISSING_SEEDCOUNT_THRESHOLDS:ZIe,MISSING_SEEDING_POLICY:R6e,MISSING_SET_NUMBER:k6e,MISSING_SET_OBJECT:b2,MISSING_SIDE_NUMBER:x6e,MISSING_STAGE:lwe,MISSING_STRUCTURE_ID:Fc,MISSING_STRUCTURE:Ab,MISSING_MAIN_STRUCTURE:D8,MISSING_STRUCTURES:E8,MISSING_TARGET_LINK:C8,MISSING_TIE_FORMAT:dE,MISSING_TIME_ITEM:G8,MISSING_TIME_ITEMS:Q8,MISSING_TOURNAMENT_ID:LT,MISSING_TOURNAMENT_RECORD:nt,MISSING_TOURNAMENT_RECORDS:bn,MISSING_VALUE:Yt,MISSING_VENUE_ID:ev,MODIFICATIONS_FAILED:Qwe,NO_CANDIDATES:C2,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:F8,NO_MODIFICATIONS_APPLIED:fE,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:E4,NO_PARTICIPANT_REMOVED:Ewe,NO_VALID_ACTIONS:Kwe,NO_VALID_ATTRIBUTES:E2,NO_VALID_DATES:gwe,NOT_FOUND:rs,NOT_IMPLEMENTED:q8,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:O8,PARTICIPANT_ID_EXISTS:Cwe,PARTICIPANT_NOT_CHECKED_IN:Pwe,PARTICIPANT_NOT_FOUND:Fn,PARTICIPANT_PAIR_EXISTS:F6e,PENALTY_NOT_FOUND:HT,POLICY_NOT_ATTACHED:M6e,POLICY_NOT_FOUND:cM,SCHEDULE_NOT_CLEARED:zIe,SCHEDULED_MATCHUPS:Jwe,SCORES_PRESENT:dM,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:XIe,STAGE_SEQUENCE_LIMIT:cwe,STRUCTURE_NOT_FOUND:an,TEAM_NOT_FOUND:j8,UNABLE_TO_ASSIGN_COURT:jwe,UNLINKED_STRUCTURES:nwe,UNRECOGNIZED_DRAW_TYPE:U8,UNRECOGNIZED_MATCHUP_FORMAT:lM,UNRECOGNIZED_MATCHUP_STATUS:U4,VALUE_UNCHANGED:z8,VENUE_EXISTS:Fwe},cn={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},eSe={addNotice:e8e,callListener:a8e,cycleMutationStatus:J6e,deleteNotice:r8e,deleteNotices:i8e,disableNotifications:G6e,enableNotifications:Q6e,getMethods:Y8,getNotices:t8e,getTopics:n8e,getTournamentId:tSe,getTournamentRecord:j6e,getTournamentRecords:z6e,removeTournamentRecord:Y6e,setMethods:Z6e,setSubscriptions:X6e,setTournamentId:W6e,setTournamentRecord:q6e,setTournamentRecords:K6e,handleCaughtError:s8e};function G6e(){cn.disableNotifications=!0}function Q6e(){cn.disableNotifications=!1}function tSe(){return cn.tournamentId}function j6e(t){return cn.tournamentRecords[t]}function z6e(){return cn.tournamentRecords}function q6e(t){let e=t?.tournamentId;return e?(cn.tournamentRecords[e]=t,{success:!0}):{error:nM}}function W6e(t){return t?cn.tournamentRecords[t]?(cn.tournamentId=t,{success:!0}):{error:nt}:(cn.tournamentId=void 0,{success:!0})}function K6e(t){cn.tournamentRecords=t;let e=Object.keys(t);e.length===1?cn.tournamentId=e[0]:e.length||(cn.tournamentId=void 0)}function Y6e(t){if(typeof t!="string")return{error:we};if(!cn.tournamentRecords[t])return{error:rs};delete cn.tournamentRecords[t];let e=Object.keys(cn.tournamentRecords);return e.length===1?cn.tournamentId=e[0]:e.length||(cn.tournamentId=void 0),{success:!0}}function X6e(t){return typeof t.subscriptions!="object"?{error:we}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?cn.subscriptions[e]=t.subscriptions[e]:delete cn.subscriptions[e]}),{...oe})}function Z6e(t){return typeof t!="object"?{error:we}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(cn.methods[e]=t[e])}),{...oe})}function J6e(){let t=cn.modified;return cn.modified=!1,t}function e8e({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(cn.disableNotifications||(cn.modified=!0),!(cn.disableNotifications||!cn.subscriptions[t]&&!r)))return i&&(cn.notices=cn.notices.filter(n=>!(n.topic===t&&n.key===i))),cn.notices.push({topic:t,payload:e,key:i}),{...oe}}function Y8(){return cn.methods??{}}function t8e({topic:t}){return cn.notices.filter(e=>e.topic===t).map(e=>e.payload)}function i8e(){cn.notices=[]}function r8e({topic:t,key:e}){cn.notices=cn.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function n8e(){return{topics:Object.keys(cn.subscriptions)}}function a8e({topic:t,notices:e},i){let r=cn.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i?.[t];n&&typeof n=="function"&&n(e)}function s8e({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:tSe(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}var Rr={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},ns=eSe,Jte=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function o8e(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Mn(Object.keys(t),Jte).length!==Jte.length)throw new Error("Global state provider is missing required methods");return ns=t,{success:!0}}function l8e(){if(ns.createInstanceState){try{ns.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:Vwe}}function Mc(t){return!t||typeof t!="object"?Rr.devContext??!1:typeof Rr.devContext!="object"?!1:Object.keys(t).every(e=>Rr.devContext?.[e]===t[e])&&Rr.devContext}function c8e(t="reset",e="default"){let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Rr.timers).filter(r=>r!=="default"||Rr.timers[r].startTime).map(r=>{let n=Rr.timers[r],a=n.state==="stopped"?0:(i-(n?.startTime??0))/1e3,s=n.elapsedTime+a;return{state:Rr.timers[r].state,elapsedTime:s.toFixed(2),timer:r}});{let r=Rr.timers[e].state==="stopped"?0:(i-(Rr.timers[e]?.startTime??0))/1e3,n=Rr.timers[e].elapsedTime+r;return{state:Rr.timers[e].state,elapsedTime:n.toFixed(2),timer:e}}}if(!Rr.timers[e]||t==="reset"){if(e==="allTimers")return Rr.timers={default:{elapsedTime:0}},!0;Rr.timers[e]={startTime:i,state:"active",elapsedTime:0}}return Rr.timers[e].elapsedTime||(Rr.timers[e].elapsedTime=0),t==="stop"&&Rr.timers[e].state!=="stopped"&&(Rr.timers[e].state="stopped")&&(Rr.timers[e].elapsedTime+=(i-(Rr.timers[e]?.startTime??0))/1e3),t==="start"&&(Rr.timers[e].startTime=i)&&(Rr.timers[e].state="active"),Rr.timers[e]}function iSe(t){kl(t)?Rr.globalLog=t:delete Rr.globalLog}function kP(t){Rr.devContext=t}function rSe(){ns.disableNotifications()}function P2(){ns.enableNotifications()}function xP(t,e){typeof t=="boolean"&&(Rr.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Rr.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Rr.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Rr.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Rr.deepCopyAttributes.threshold=e.threshold))}function X8(){return{enabled:Rr.deepCopy,...Rr.deepCopyAttributes}}function u8e(t){return t?.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Rr.globalSubscriptions[e]=t.subscriptions[e]}),{...oe}):{error:Yt,info:"missing subscriptions"}}function d8e(t){return t?.subscriptions?ns.setSubscriptions({subscriptions:t.subscriptions}):{error:Yt,info:"missing subscriptions"}}function nSe(t){return t?typeof t!="object"?{error:we}:(Object.keys(t).forEach(e=>{kl(t[e])&&(Rr.globalMethods[e]=t[e])}),{...oe}):{error:Yt,info:"missing method declarations"}}function aSe(t){return t?typeof t!="object"?{error:we}:ns.setMethods(t):{error:Yt,info:"missing method declarations"}}function Z8(){return ns.cycleMutationStatus()}function Ii(t){if(typeof t?.topic!="string")return;let e=Rr.globalSubscriptions[t.topic];return ns.addNotice(t,e)}function sSe(){return{...Rr.globalMethods,...ns.getMethods()}}function oSe(t){return ns.getNotices(t)}function J8({key:t,topic:e}){return ns.deleteNotice({key:t,topic:e})}function pM(){return ns.deleteNotices()}function Tu(){return ns.getTopics()}function R2(t){return Tu()?.topics?.includes(t)}async function R4(t){return ns.callListener(t,Rr.globalSubscriptions)}function rS(){return ns.getTournamentId()}function eY(t){return ns.getTournamentRecord(t)}function nS(){return ns.getTournamentRecords()}function lSe(t){return ns.setTournamentRecord(t)}function M2(t){return ns.setTournamentRecords(t)}function _P(t){return ns.setTournamentId(t)}function cSe(t){return ns.removeTournamentRecord(t)}function M4(){return ns}function N2({engineName:t,methodName:e,params:i,err:r}){let n=kl(ns.handleCaughtError)&&ns.handleCaughtError||eSe.handleCaughtError,{tournamentRecord:a,...s}=i;return n({params:s,engineName:t,methodName:e,err:r})}function uSe(t,e){if(Rr.globalLog)try{Rr.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),iSe()}else console.log(e,t)}function dSe(t,e,i,r){if(!Xi(t))return{error:we};Un||(i=1);let n=Array.isArray(e)?e:[],a={},s=(o,l=0)=>{Object.keys(o).forEach(c=>{kl(o[c])?a[c]=o[c]:Xi(o[c])&&(e===!0||n?.includes(c))&&(i===void 0||l<i)&&s(o[c],l+1)})};return s(t),r?nSe(a):aSe(a),{methods:a}}function p8e(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function Lt(t,e,i,r){if(typeof t!="object"||t===null)return t;X8()?.enabled||(r=!0);let n=["",void 0,null];e&&n.push(!1);let a=p8e(t,n,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(o=>Lt(o))}:{[s]:r?t[s]:Lt(t[s])}))}function ce({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e?.stack)&&(e.stack=[]),e&&Array.isArray(e?.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&(e.context||(e.context={}),Object.assign(e.context,Lt(t))),e&&!e?.error&&!e?.success&&Object.assign(e,{...oe}),e??{success:!0}}var Ds="FEMALE",Am="OTHER",aS="MIXED",oa="MALE",B2={FEMALE_ABBR:"F",OTHER_ABBR:"O",MIXED_ABBR:"X",MALE_ABBR:"M",ANY_ABBR:"A",FEMALE:Ds,MIXED:aS,OTHER:Am,MALE:oa,ANY:"ANY"};function Qv(t){return[Ds,"F"].includes(t)}function uI(t){return[oa,"M"].includes(t)}function Tc(t){return[aS,"X"].includes(t)}function Ch(t){return["ANY","A"].includes(t)}function Ks(t){if(t){if(Qv(t))return Ds;if(Tc(t))return aS;if(uI(t))return oa;if(Ch(t))return"ANY"}return Am}function ff(t){return Qv(t)||uI(t)}var f8e="MIXED events can not contain mixed singles or { gender: ANY } collections",h8e="events with { gender: ANY } can not contain MIXED singles collections";function k2(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&ff(i)&&Ks(i)!==Ks(n)?ce({result:{valid:!1,error:p0},context:{gender:n},stack:e}):Tc(i)&&(Ch(n)||Tc(n)&&r!==br)?ce({result:{error:p0,valid:!1},info:f8e,stack:e}):Ch(i)&&Tc(n)&&r!==br?ce({result:{error:p0,valid:!1},info:h8e,stack:e}):{valid:!0}}var m8e="normal",eie="timed",A8e="final",tY="NOAD",g8e={S:m8e,F:A8e};function x2(t,e){if(Xi(t)&&(t?.bestOf||t?.exactly)&&t?.setFormat)return v8e(t,e)}function OP(t){return!Number.isNaN(Number(t))&&Number(t)}function pSe(t){let e=`T${t.minutes}`;return t.based==="A"?e+="A":t.based==="P"&&(e+="P"),t.tiebreakFormat?.tiebreakTo&&(e+=`/TB${t.tiebreakFormat.tiebreakTo}`),t.modifier&&(e+=`@${t.modifier}`),e}function v8e(t,e){let i=OP(t.bestOf)||void 0,r=OP(t.exactly)||void 0,n=i||r;if(t.setFormat?.timed&&t.simplified&&n===1)return pSe(t.setFormat);let a=n&&`SET${n}${r&&r!==1?"X":""}`||"",s=tie(t.setFormat,e),o=s&&`S:${s}`||"",l=tie(t.finalSetFormat,e),c=n&&n>1&&l&&s!==l&&`F:${l}`||"";if(a&&s)return[a,o,c].filter(Boolean).join("-")}function tie(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return pSe(t);if(t.tiebreakSet)return iie(t.tiebreakSet);let i=OP(t.setTo);if(i){let r=t.NoAD&&tY||"",n=iie(t.tiebreakFormat),a=n&&`/${n}`||"",s=OP(t.tiebreakAt),o=s&&(s!==i||e)&&`@${s}`||"";if(n!==!1)return`${i}${r}${a}${o}`}}}function iie(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&OP(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?tY:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function ys(t){if(rn(t)){let e=t.startsWith("T")&&eie||t.startsWith("SET")&&"SET"||"";if(e===eie){let i=mSe(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e==="SET")return y8e(t)}}function y8e(t){let e=t.split("-"),i=e[0].slice(3),r=i.endsWith("X"),n=r?i.slice(0,-1):i,a=VT(n),s=r&&a!==1?void 0:a,o=r&&a!==1?a:void 0,l=e&&rie(e[1]),c=e&&rie(e[2]),u=l&&l.timed||c&&c.timed,d=s&&s<6||u&&o,p=!e[2]||c,f=l,h=Lt({setFormat:l,exactly:o,bestOf:s});if(c&&(h.finalSetFormat=c),d&&f&&p)return h}function rie(t){if(t?.[1]!==":")return;let e=t.split(":"),i=g8e[e[0]],r=e[1];if(!(!i||!r))return b8e(t,r)}function b8e(t,e){return e.startsWith("TB")?I8e(e):e.startsWith("T")?mSe(e):w8e(t,e)}function I8e(t){let e=hSe(t);return e===!1?!1:typeof e=="object"?{tiebreakSet:e}:void 0}function w8e(t,e){let i=/^[FS]:(\d+)([A-Za-z]*)/.exec(t),r=i&&ASe(i[2])||!1,n=!i?.[2]||r,a=i?VT(i[1]):void 0,s=fSe(e),o=s!==!1,l=o&&s||a,c=hSe(e.split("/")[1]);return!a||!n||c===!1||!o?!1:S8e(a,r,c,l)}function S8e(t,e,i,r){let n={setTo:t};return e&&(n.NoAD=!0),i?(n.tiebreakFormat=i,n.tiebreakAt=r):n.noTiebreak=!0,n}function fSe(t,e=!0){let i=t?.indexOf("@")>0&&t.split("@");if(i)return(e?VT(i[1]):i[1])||!1}function hSe(t){if(t)return t.startsWith("TB")?U8e(t):!1}function U8e(t){let e=fSe(t,!1),i=/^TB(\d+)([A-Za-z]*)/.exec(t),r=i?.[1],n=i&&ASe(i[2]),a=!i?.[2]||n,s=VT(r);if(!s||!a)return!1;let o={tiebreakTo:s};return e&&typeof e=="string"&&!wi(e)&&(o.modifier=e),n&&(o.NoAD=!0),o}function mSe(t){let e=t.slice(1),i=/^(\d+)([PGA])?(?:\/TB(\d+))?(@[A-Za-z]+)?$/.exec(e),r=VT(i?.[1]);if(!r)return;let n={timed:!0,minutes:r},a=i?.[2];a==="A"?n.based="A":a==="P"?n.based="P":a==="G"&&(n.based="G");let s=i?.[3];if(s){let c=VT(s);c&&(n.tiebreakFormat={tiebreakTo:c})}let o=i?.[4],l=[void 0,"P","G",""].includes(o);if(o&&!l){let c=/^(\d+)([PGA])?(?:\/TB\d+)?(@)([A-Za-z]+)$/.exec(e)?.[4];return c?(n.modifier=c,n):void 0}return o&&(n.based=o),n}function ASe(t){return t?.includes(tY)}function VT(t){let e=Number(t);return Number.isNaN(e)?0:e}function Zl({matchUpFormat:t}){if(!rn(t)||t==="")return!1;let e=ys(t),i=/-S:([1-9])+\/TB(\d{1,2})@?([1-9]?)/.exec(t),r=i?.[1],n=i?.[2],a=i?.[3],s=/-F:([1-9])+\/TB(\d{1,2})@?([1-9]?)/.exec(t),o=s?.[1],l=s?.[2],c=s?.[3];return x2(e,!!(i&&n&&r===a||s&&l&&o===c))===t.replace(/G/,"")}var U_=/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1])$/,gSe=/^((0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)([.,]\d{3})?$/,hf=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))([ T](0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/,jv=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))?([ T]?(0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/;function T_(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Ui(t.scheduledTime)),!e)return;let i=Kr(t.scheduledTime),r=Ui(e);return r&&i&&(r+=`T${i}`),r}function T8e(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function hE(t){let e=typeof t=="string"?t?.split(" "):[];if(t&&e?.length>1&&!["AM","PM"].includes(e[1].toUpperCase()))return!1;let i=sS(t,!0,!0);return!!(!t||i&&jv.test(i))}function Ro(t){return ky(t)||U_.test(t)}function C8e(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+3600*e.getHours();return E8e(i,{displaySeconds:!1})}function E8e(t,e){let i=Number.parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e?.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(ru).join(":")}var iY=t=>{let e=FP(t)||ky(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${ru(r)}-${ru(e.getUTCDate())}`};function D8e(t){let e=FP(t)||ky(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function od(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&!t.includes("T")&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),s=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,s].join(e):i==="MDY"?[n,a,s].join(e):i==="YDM"?[s,a,n].join(e):i==="DYM"?[a,s,n].join(e):i==="MYD"?[n,s,a].join(e):[s,n,a].join(e)}function C_(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function P8e(t){return C_(t).getTime()}function FP(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!Number.isNaN(Number(t))&&new Date(t)||!1;return e&&!Number.isNaN(Number(e.valueOf()))}function R8e(t,e){return t<=e}function GT(t,e){if(!Ro(t)||!Ro(e))return[];let i=Ui(t)+"T00:00",r=Ui(e)+"T00:00",n=new Date(i),a=new Date(r),s=FP(a)&&FP(n)&&R8e(n,a),o=[],l=0;if(s){let c=n,u=c.getTime();for(;u<=a.getTime()&&l<300;)l+=1,o.push(new Date(c)),u=c.setDate(c.getDate()+1)}return o.map(c=>od(c))}var M8e=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function ky(t){return typeof t!="string"?!1:M8e.test(t)}function rY(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!Number.isNaN(Number.parseInt(r)));return!(e.length<2||!i||Number.parseInt(e[0])>23||Number.parseInt(e[1])>60)}function sr(t){let e=Kr(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>Number.parseInt(n));return i*60+r}function N8e(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[ru(e),ru(i)].join(":")}function E_(t){return rY(t)?t.split(":").slice(0,2).map(ru).join(":"):void 0}function Kr(t){return ky(t)&&t.indexOf("T")>0?E_(t.split("T").reverse()[0]):E_(t)}function Ui(t){return ky(t)||hf.test(t)?t.split("T")[0]:""}function MD(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Ui(i.toISOString())}function D_(t){t=typeof t=="string"?t:"00:00";let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,Number.isNaN(Number.parseInt(i.hours))||Number.isNaN(Number.parseInt(i.minutes))||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function B8e(t){let e=D_(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&Number.parseInt(e.hours)<12&&(e.hours=(e.hours&&Number.parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(ru).join(":")}function k8e(t){let e=D_(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),e.hours?.[0]==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function sS(t,e,i){let r=Ui(t),n=Kr(t),a=r?n:t;return t?e&&(r&&i&&t||B8e(a))||k8e(a):void 0}function vSe(t,e){let i=D_(t),r=D_(e);if(Number.parseInt(i.hours)<Number.parseInt(r.hours))return-1;if(Number.parseInt(i.hours)>Number.parseInt(r.hours))return 1;if(i.hours===r.hours){if(Number.parseInt(i.minutes)<Number.parseInt(r.minutes))return-1;if(Number.parseInt(i.minutes)>Number.parseInt(r.minutes))return 1}return 0}function nY(t,e=7){let i=Ui(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return od(n)}function x8e(t){return nY(t)}function _8e(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),od(n,i)}function O8e(t,e,i){let r=new Date(t,0);return od(new Date(r.setDate(e)),i)}function Jn(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(ru),n=C_(e).setHours(i,r,0,0);return C_(n)}function fM(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function gl(t,e){let i=Kr(t);if(!i)return"00:00";let r=Number.isNaN(e)?0:e;return Kr(aY(Jn(i),r).toISOString())||"00:00"}function aY(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function ru(t){return t.toString()[1]?t:"0"+t}function Eh(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var ySe={addDays:nY,addWeek:x8e,addMinutesToTimeString:gl,convertTime:sS,getIsoDateString:T_,getUTCdateString:iY,DateHHMM:C8e,extractDate:Ui,extractTime:Kr,formatDate:od,getDateByWeek:_8e,isISODateString:ky,isDate:FP,isTimeString:rY,offsetDate:C_,offsetTime:P8e,sameDay:Eh,timeStringMinutes:sr,timeToDate:Jn,timeUTC:D8e,validTimeValue:hE,validDateString:U_,timeValidation:jv,dateValidation:hf},F8e=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),L8e=t=>t.filter(Boolean).every(Un);function XS(t,e){return`${t}-${e}`}function xy(t){let e=t.category;if(typeof e!="object"||!e)return{error:BP};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s}=e,o=e.categoryName,l;if(!(F8e([i,r,n,o],"string")&&L8e([a,s])&&[r,n].filter(Boolean).every(Ro)))return{error:BP};let c=t.consideredDate??Ui(new Date().toLocaleDateString("sv"));if(!c||!Ro(c))return{error:ma};let[u]=c.split("-").slice(0,3).map(V=>Number.parseInt(V)),d=MD(c,-1);if(!d)return{error:ma};let[p,f]=d.split("-").slice(1,3).map(V=>Number.parseInt(V)),h=`${ru(p)}-${ru(f)}`,m=MD(c,1);if(!m)return{error:ma};let[A,g]=m.split("-").slice(1,3).map(V=>Number.parseInt(V)),v=`${ru(A)}-${ru(g)}`,b=s&&MD(c,-1*365*s),y=a&&MD(c,-1*365*a),I=[],w=V=>!I.includes(V)&&I.push(V);i=i??o;let S=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,D=i?.includes("-"),C=D&&i?.match(T),E=i?.match(S);function P(V){let G=u-V,z=XS(G,v);e.ageMinDate&&e.ageMinDate!==z&&w(`Invalid submitted ageMinDate: ${n}`),n=z,i&&(e.ageMax&&e.ageMax!==V-1&&(w(`Invalid submitted ageMax: ${a}`),y=void 0),a=V-1)}function R(V){let G=u-V-1,z=XS(G,v);e.ageMin&&e.ageMin>V&&w(`Invalid submitted ageMin: ${s}`),e.ageMax&&e.ageMax>V&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==z&&w(`Invalid submitted ageMinDate: ${n}`),n=z,i&&(e.ageMax&&e.ageMax!==V&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=V)}function M(V){let G=u-V,z=XS(G,h);e.ageMaxDate&&e.ageMaxDate!==z&&w(`Invalid submitted ageMaxDate: ${r}`),r=z,i&&(e.ageMin&&e.ageMin!==V+1&&(w(`Invalid submitted ageMin: ${s}`),b=void 0),s=V+1)}function N(V){let G=u-V-1,z=XS(G,h);e.ageMaxDate&&e.ageMaxDate!==z&&w(`Invalid submitted ageMaxDate: ${r}`),r=z,i&&(e.ageMin&&e.ageMin!==V&&(w(`Invalid submitted ageMin: ${s}`),b=void 0),s=V)}function k(V){let G=S.exec(V)||[],[z,Q,j]=G.slice(1),W=Number.parseInt(Q);z==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),P(W)):z==="O"&&M(W),j==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),R(W)):j==="O"&&N(W),r=(r??b)||void 0,n=(n??y)||void 0}function O(){if(r=void 0,n=void 0,a=void 0,s=void 0,e.ageMin){let z=u-e.ageMin;r=XS(z,h)}if(e.ageMax){let z=u-e.ageMax-1;n=XS(z,v)}let[V,G]=(i?.match(T)??[]).slice(1).map(z=>Number.parseInt(z));V<=G?(s=V,a=G,l=!0):w(`Invalid combined age range ${i}`)}function x(){s&&M(s),a&&R(a)}function F(){C?O():D?i?.split("-").forEach(k):E&&i?k(i):x()}F(),a&&e?.ageMin&&e?.ageMin>a&&(w(`Invalid submitted ageMin: ${e?.ageMin}`),s=void 0);let _=Lt({consideredDate:c,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s});return I.length&&(_.errors=I),_}function LP({category:t}){if(!Xi(t))return{error:we};let e=xy({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!Un(i)?ce({result:{error:we},context:{ratingMax:i}}):r&&!Un(r)?ce({result:{error:we},context:{ratingMin:r}}):{...e}}function hM({childCategory:t,withDetails:e,category:i}){let r=LP({category:i}),n=LP({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),s=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),o=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),c=i?.ratingType&&t?.ratingType&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),u=i?.ballType&&t?.ballType&&i.ballType!==t.ballType,d=Lt({invalidRatingRange:c,invalidAgeMinDate:o,invalidAgeMaxDate:l,invalidBallType:u,invalidAgeMax:s,invalidAgeMin:a,valid:!c&&!o&&!l&&!u&&!s&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function mM({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:s}){a=a??s?.gender;let o="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),ce({result:{errors:l,error:AA},stack:o});let{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,collectionId:p,matchUpCount:f,matchUpFormat:h,matchUpValue:m,matchUpType:A,scoreValue:g,setValue:v,category:b,gender:y}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof f!="number"&&l.push(`matchUpCount is not type number: ${f}`),A&&!g2([Dr,br],A)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${A}`),[!!c?.length].concat([m,d,g,v].map(wi)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),c&&f){let I=GIe({collectionValueProfiles:c,matchUpCount:f});I.errors&&l.push(...I.errors)}if(u&&typeof u!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),h&&!Zl({matchUpFormat:h})&&l.push(`Invalid matchUpFormat: ${h}`),r){let I=k2({referenceGender:a,matchUpType:A,gender:y});if(I.error)return ce({context:{referenceGender:a,gender:y},result:I,stack:o})}if(t&&n&&b){let I=hM({category:n,childCategory:b});if(!I.valid)return ce({result:{error:BP},context:I,stack:o})}return l.length?ce({result:{errors:l,error:qwe},stack:o}):{valid:!0}}function Jo(t){let e=!!(t?.enforceCategory!==!1&&t?.category),i=!!(t?.enforceGender!==!1&&t?.gender),r=t?.checkCollectionIds,n=t?.tieFormat,a=t?.event,s="validateTieFormat",o=[],l=$8e({...t,stack:s});if(l?.error)return l;let c,u=n.collectionDefinitions.every(m=>{let{setValue:A,scoreValue:g,collectionValue:v}=m;(A||g)&&!v&&(c=!0);let{valid:b,errors:y}=mM({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:m,checkCollectionIds:r,checkCategory:e,checkGender:i,event:a});return b?!0:(Array.isArray(y)&&o.push(...y),!1)}),d=typeof n.winCriteria?.valueGoal=="number"&&n.winCriteria?.valueGoal>0&&!c||n.winCriteria?.aggregateValue;if(!(d||n.winCriteria?.aggregateValue))return c?o.push("aggregateValue is required"):o.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),ce({context:{tieFormat:n,errors:o,aggregateValueImperative:c},result:{error:ah},stack:s});let p=n.collectionDefinitions.map(({collectionId:m})=>m),f=!r||p.length===Ei(p).length,h=u&&d&&f;return h?{valid:h,errors:o}:ce({result:{error:ah},context:{tieFormat:n,errors:o},stack:s})}function $8e(t){let{tieFormat:e,stack:i}=t;return!t||!e||!Xi(e)?ce({result:{error:ah},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):Xi(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...oe}:ce({result:{error:ah},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):ce({result:{error:ah},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var QT="resourceSubType",jT="resourceType",zT="identifier",H8e={RESOURCE_SUB_TYPE:QT,RESOURCE_TYPE:jT,IDENTIFIER:zT};function Dt(t,e,i,r,n=0){if(M4().makeDeepCopy)return M4().makeDeepCopy(t,e,i,r);let a=X8(),{stringify:s,toJSON:o,ignore:l,modulate:c}=a||{};if(!a?.enabled&&!i||typeof t!="object"||kl(t)||t===null||typeof a?.threshold=="number"&&n>=a.threshold)return t;let u=Array.isArray(t)?[]:{},d=Object.keys(t).filter(f=>!i||!l||Array.isArray(l)&&!l.includes(f)||kl(l)&&!l(f)),p=(f,h)=>{u[f]=kl(h?.toString)?h.toString():JSON.stringify(h)};for(let f of d){let h=t[f],m=kl(c)?c(h):void 0;if(m!==void 0)u[f]=m;else if(e&&f==="extensions"&&Array.isArray(h)){let A=sY(h);Object.assign(u,...A)}else r&&f==="extensions"?u[f]=[]:Array.isArray(s)&&s.includes(f)?p(f,h):Array.isArray(o)&&o.includes(f)&&kl(h?.toJSON)?u[f]=h.toJSON():h===null?u[f]=void 0:T8e(h)?u[f]=new Date(h).toISOString():u[f]=Dt(h,e,i,r,n+1)}return u}function sY(t){return t?.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}function bSe(t=1,e){return vt(0,t).map(()=>hr(e))}function hr(t){let e=[];for(let o=0;o<256;o++)e[o]=(o<16?"0":"")+o.toString(16);let i=Math.trunc(Math.random()*4294967295),r=Math.trunc(Math.random()*4294967295),n=Math.trunc(Math.random()*4294967295),a=Math.trunc(Math.random()*4294967295),s=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[r&255]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[n&63|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${s.replaceAll("-","")}`:s}var ISe={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},wSe={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},SSe={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},USe={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},TSe={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},CSe={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},ESe={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},DSe={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},PSe={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},RSe={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},ld="SET3-S:6/TB7",V8e="SET3-S:6NOAD",MSe="SET3-S:6/TB7-F:TB10",G8e="SET3-S:4/TB7",Q8e="SET3-S:4/TB5@3",j8e="SET1-S:T20",z8e="SET1-S:8/TB7",q8e="SET1-S:8/TB7@7",W8e={FORMAT_STANDARD:ld,FORMAT_STANDARD_NOAD:V8e,FORMAT_ATP_DOUBLES:MSe,FORMAT_SHORT_SETS:G8e,FORMAT_FAST4:Q8e,FORMAT_PRO_SET:z8e,FORMAT_COLLEGE_PRO_SET:q8e,TIMED20:j8e},NSe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},BSe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},kSe={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},xSe={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},_Se={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},OSe={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},FSe={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},P_="COLLEGE_DEFAULT",N4="COLLEGE_JUCO",B4="COLLEGE_D3",LSe="DOMINANT_DUO",$Se="DOMINANT_DUO_MIXED",HSe="LAVER_CUP",VSe="TEAM_DOUBLES_3_AGGREGATION",GSe="TIME_TENNIS_DUAL",QSe="TIME_TENNIS_PRO_CIRCUIT",jSe="USTA_BREWER_CUP",zSe="USTA_OZAKI_CUP",qSe="USTA_COLLEGE",WSe="USTA_GOLD_TEAM_CHALLENGE",KSe="USTA_LEVEL_1",YSe="USTA_INTERSECTIONAL",XSe="USTA_SECTION_BATTLE",ZSe="USTA_SOUTHERN_LEVEL_5",JSe="USTA_TOC",eUe="USTA_WTT_ITT",tUe="USTA_ZONAL",K8e={COLLEGE_D3:B4,COLLEGE_DEFAULT:P_,COLLEGE_JUCO:N4,DOMINANT_DUO:LSe,DOMINANT_DUO_MIXED:$Se,LAVER_CUP:HSe,TEAM_DOUBLES_3_AGGREGATION:VSe,TIME_TENNIS_DUAL:GSe,TIME_TENNIS_PRO_CIRCUIT:QSe,USTA_BREWER_CUP:jSe,USTA_OZAKI_CUP:zSe,USTA_COLLEGE:qSe,USTA_GOLD_TEAM_CHALLENGE:WSe,USTA_INTERSECTIONAL:YSe,USTA_LEVEL_1:KSe,USTA_SECTION_BATTLE:XSe,USTA_SOUTHERN_LEVEL_5:ZSe,USTA_TOC:JSe,USTA_WTT_ITT:eUe,USTA_ZONAL:tUe},iUe="STANDARD",nie={[iUe]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[B4]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:ld,matchUpCount:6,matchUpValue:1},tieFormatName:B4,valueGoal:5},[P_]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:ld,matchUpCount:6,matchUpValue:1},tieFormatName:P_,valueGoal:4},[N4]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:ld,matchUpCount:6,matchUpValue:1},tieFormatName:N4,valueGoal:5},[HSe]:OSe,[LSe]:NSe,[$Se]:ESe,[VSe]:wSe,[GSe]:DSe,[QSe]:CSe,[jSe]:PSe,[zSe]:RSe,[qSe]:BSe,[WSe]:ISe,[YSe]:TSe,[KSe]:kSe,[XSe]:USe,[ZSe]:SSe,[eUe]:xSe,[JSe]:FSe,[tUe]:_Se},Y8e=t=>{let e=t?.namedFormat&&Object.keys(nie).includes(t.namedFormat)?t.namedFormat:iUe,i=Array.isArray(t?.uuids)?t?.uuids:[],r,{category:n,gender:a}=t?.event??{},s=Dt(nie[e],!1,!0),o=l=>{if(!t?.isMock&&!t?.event?.isMock||!t.event)return i?.pop()??hr();let c=t?.event?.eventId;return i.pop()??`${c}-COL-${l+1}`};return s.hydrate?(r={winCriteria:{valueGoal:s.valueGoal},collectionDefinitions:[{collectionId:o(0),matchUpFormat:MSe,collectionName:"Doubles",matchUpType:br,...s.doubles},{collectionId:o(1),matchUpFormat:ld,collectionName:"Singles",matchUpType:Dr,...s.singles}]},s.tieFormatName&&(r.tieFormatName=s.tieFormatName)):(s.collectionDefinitions.forEach((l,c)=>l.collectionId=o(c)),r=s),t?.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},Qm=Y8e,mf="SINGLES",iw="SINGLES",hu="DOUBLES",jm="DOUBLES",da="TEAM",Jl="TEAM",X8e="RATING",Z8e="BOTH",J8e={AGE:"AGE",BOTH:Z8e,DOUBLES:hu,DOUBLES_EVENT:jm,RATING:X8e,SINGLES:mf,SINGLES_EVENT:iw,TEAM_EVENT:Jl,TEAM:da},Et="MAIN",qt="QUALIFYING",Ls="CONSOLATION",Za="VOLUNTARY_CONSOLATION",Dn="PLAY_OFF",_2=[Et,qt,Ls,Dn,Za],rw={[qt]:1,[Et]:2,[Dn]:3,[Ls]:3,[Za]:4},rUe="finishingPositions",nUe="aggregateEventStructures",aUe={[Et]:1,[Dn]:2,[Ls]:3,[qt]:4,[Za]:5},eYe={[Dn]:1,[Et]:2,[Ls]:3,[qt]:4,[Za]:5},AM="CLUSTER",O2="ADJACENT",sUe="SEPARATE",_y="WATERFALL",F2="ITEM",$o="CONTAINER",jd="DRAW",L2="RANDOM",Ju="TOP_DOWN",Oy="BOTTOM_UP",Dh="POSITION",Ph="WINNER",Rh="LOSER",Af="FIRST_MATCHUP",ec="AD_HOC",tYe="AD_HOC",mE="FEED_IN",qT="COMPASS",WT="OLYMPIC",iYe="SINGLE_ELIMINATION",Kp="SINGLE_ELIMINATION",gM="DOUBLE_ELIMINATION",KT="FIRST_MATCH_LOSER_CONSOLATION",vM="FIRST_ROUND_LOSER_CONSOLATION",yb="LUCKY_DRAW",$2="CURTIS_CONSOLATION",rYe="CURTIS_CONSOLATION",oY="FEED_IN_CHAMPIONSHIP_TO_SF",$P="FEED_IN_CHAMPIONSHIP_TO_SF",lY="FEED_IN_CHAMPIONSHIP_TO_QF",HP="FEED_IN_CHAMPIONSHIP_TO_QF",cY="FEED_IN_CHAMPIONSHIP_TO_R16",VP="FEED_IN_CHAMPIONSHIP_TO_R16",oUe="MODIFIED_FEED_IN_CHAMPIONSHIP",GP="MODIFIED_FEED_IN_CHAMPIONSHIP",yM="FEED_IN_CHAMPIONSHIP",nYe="DOUBLE_ROUND_ROBIN",Sd="ROUND_ROBIN",Mh="ROUND_ROBIN_WITH_PLAYOFF",lUe="DECIDER",cUe="BACKDRAW",uY={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},dY={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},Fy="WIN_RATIO",oS="ROUND_OUTCOME",uUe=[qT,$2,HP,VP,$P,yM,lY,cY,oY,KT,vM,yb,GP,WT,Dn,Mh],aYe=[ec,qT,$2,gM,HP,VP,$P,yM,mE,KT,vM,yb,GP,WT,Dn,Sd,Mh,Kp],dUe={MAIN:Et,QUALIFYING:qt,CONSOLATION:Ls,ITEM:F2,CONTAINER:$o,FIRST_MATCHUP:Af,WINNER:Ph,LOSER:Rh,AD_HOC:ec,FEED_IN:mE,FLEX_ROUNDS:tYe,COMPASS:qT,PLAY_OFF:Dn,OLYMPIC:WT,KNOCKOUT:iYe,SINGLE_ELIMINATION:Kp,DOUBLE_ELIMINATION:gM,CURTIS:$2,FICSF:oY,FICQF:lY,FICR16:cY,MFIC:oUe,VOLUNTARY_CONSOLATION:Za,FIRST_MATCH_LOSER_CONSOLATION:KT,FIRST_ROUND_LOSER_CONSOLATION:vM,MODIFIED_FEED_IN_CHAMPIONSHIP:GP,FEED_IN_CHAMPIONSHIP_TO_R16:VP,FEED_IN_CHAMPIONSHIP_TO_QF:HP,FEED_IN_CHAMPIONSHIP_TO_SF:$P,FEED_IN_CHAMPIONSHIP:yM,LUCKY_DRAW:yb,ROUND_ROBIN_WITH_PLAYOFF:Mh,ROUND_ROBIN:Sd,DECIDER:lUe,BACKDRAW:cUe,COMPASS_ATTRIBUTES:uY,OLYMPIC_ATTRIBUTES:dY,DRAW:jd,RANDOM:L2,TOP_DOWN:Ju,BOTTOM_UP:Oy,CLUSTER:AM,ADJACENT:O2,SEPARATE:sUe,WATERFALL:_y,WIN_RATIO:Fy,ROUND_OUTCOME:oS,MULTI_STRUCTURE_DRAWS:uUe,generatedDrawTypes:aYe,stageOrder:rw,finishOrder:aUe,AGGREGATE_EVENT_STRUCTURES:nUe,FINISHING_POSITIONS:rUe},sYe=dUe,Js="tournamentRecords",pY="policyDefinitions",Ua="tournamentRecord",fY="onlineResource",ro="drawDefinition",pUe="tieFormatName",hY="matchUpFormat",Nh="participantId",fUe="scheduleDates",oYe="tournamentId",lYe="scheduleDate",cYe="roundNumber",H2="structureId",mY="participant",bM="matchUpIds",hUe="entryStage",uYe="policyType",mUe="structures",AY="eventType",Rf="matchUpId",V2="tieFormat",G2="inContext",Q2="structure",j2="courtIds",dYe="personId",z2="venueIds",gY="matchUps",AUe="courtId",gUe="eventId",Qh="matchUp",vUe="drawId",cd="error",gA="event",AE="param",vY="uuids",pYe="averageMatchUpMinutes",fYe="recoveryMinutes",hYe="periodLength",mYe="number",fl="object",qs="array",Ps="_validate",yUe="_message",Nc="_invalid",rl="_ofType",yY="_anyOf",YT="_oneOf",aie={[fY]:t=>Mn(Object.keys(t),[QT,jT,zT]).length===3,[pUe]:t=>t&&Qm({namedFormat:t}),[vY]:t=>!t||Array.isArray(t)&&t.every(rn),[V2]:t=>!Jo({tieFormat:t}).error,[AY]:t=>[mf,hu,da].includes(t),[hUe]:t=>_2.includes(t)},AYe={[Js]:bn,[Ua]:nt,[pY]:y2,[ro]:kt,[Nh]:ba,[hY]:M8,[oYe]:LT,[H2]:Fc,[bM]:Jw,[mY]:iS,[fY]:AA,[AY]:Th,[mUe]:E8,[Rf]:go,[V2]:ah,[Q2]:Ab,[AUe]:eS,[gY]:mA,[gUe]:fu,[Qh]:Zo,[j2]:Yt,[z2]:Yt,[vUe]:hp,[gA]:Gr},gYe={[Js]:fl,[pY]:fl,[Ua]:fl,[ro]:fl,[fY]:fl,[fUe]:qs,[mY]:fl,[bM]:qs,[mUe]:qs,[V2]:fl,[Q2]:fl,[j2]:qs,[z2]:qs,[gY]:qs,[Qh]:fl,[gA]:fl,[vY]:qs};function Qt(t,e,i){if(!t&&!Xi(t))return{error:we};if(!e?.length||t?._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:we};let{paramError:r,errorParam:n}=bYe(t,e);if(!r)return{valid:!0};let a=r[Ps]&&(r[cd]||r[Nc])||t?.[n]===void 0&&(r[cd]||r[Nc]||AYe[n]||we)||we,s=n??(r[YT]&&Object.keys(r[YT]).join(", "));return ce({info:{param:s,message:r[yUe]},result:{error:a},stack:i})}function bUe(t,e){let i=Object.keys(t),r=Object.keys(e);return Mn(i,r)}function vYe(t,e){if(!e)return;let i=bUe(t,e);return i.length!==1?{error:we}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function yYe(t,e){if(!e)return;let i=bUe(t,e).filter(r=>t[r]);return i.length<1?{error:we}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function bYe(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:s,_validate:o,_info:l,...c})=>{let u=a&&vYe(t,a);if(u?.error)return u.error;u&&Object.assign(c,u);let d=s&&yYe(t,s);if(d?.error)return d.error;d&&Object.assign(c,d);let p=Object.keys(c).filter(h=>typeof c[h]=="boolean"),f=p.find(h=>{let m=o&&!kl(o),A=t[h]!==void 0&&!o&&IYe(t,h,n),g=c[h]&&[void 0,null].includes(t[h]),v=m||A||g||o&&t[h]!==void 0&&!wYe(t[h],o)||aie[h]&&!aie[h](t[h]);return v&&(i=h,r=l),v});return!p.length||f}),errorParam:i,paramInfo:r}}function IYe(t,e,i){return i=i||gYe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function wYe(t,e){return kl(e)?e(t):!0}var bY="DYNAMIC",wg="RANKING",sg="RATING",Ly="SCALE",sh="SEEDING",SYe={RANKING:wg,RATING:sg,SCALE:Ly,SEEDING:sh};function gE(t){let e=Qt(t,[{[mY]:!0}]);if(e.error)return e;let i=t.participant.timeItems?.filter(({itemType:n})=>n?.startsWith(Ly)&&[wg,sg,sh].includes(n.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(i?.length){let n=s=>i.filter(o=>o?.itemType===s).sort((o,l)=>new Date(o.createdAt||void 0).getTime()-new Date(l.createdAt||void 0).getTime()).pop(),a=Ei(i.map(({itemType:s})=>s));for(let s of a){let o=n(s);if(o){let[,l,c,u,d]=o.itemType.split("."),p=d?`${u}.${d}`:u,f=l===sh&&"seedings"||l===wg&&"rankings"||"ratings";r[f][c]||(r[f][c]=[]),r[f][c].push({scaleValue:o.itemValue,scaleDate:o.itemDate,scaleName:p})}}}return{...oe,...r}}function nw(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,s,o){if(!a||!s)return;let l=Object.keys(a),c=Object.keys(s),u=Object.assign({},...c.filter(f=>f.indexOf("||")).map(f=>f.split("||").map(h=>({[h]:f}))).flat()),d=c.concat(...Object.keys(u)),p=d.includes("*");for(let f of l)if(d.indexOf(f)>=0||p){let h=u[f]||f,m=s[h]||p,A=a[f];if(typeof m=="object"&&typeof A!="function"&&!Array.isArray(m))if(Array.isArray(A)){let g=A.map(v=>{let b={};return n(v,m,b)!==!1?b:void 0}).filter(Boolean);o[f]=g}else A&&(o[f]={},n(A,m,o[f]));else{let g=a[f];if(Array.isArray(m)&&!m.includes(g))return!1;(s[f]||p&&s[f]!==!1)&&(o[f]=g)}}}}var k4="voluntaryConsolation",gm="competitiveBands",IY="roundRobinTally",Bh="positionActions",Ja="matchUpActions",Gk="rankingPoints",zm="roundNaming",vE="participant",QP="progression",tv="scheduling",jP="avoidance",UYe="participant",TYe="display",mu="scoring",Ku="seeding",XT="feedIn",CYe="audit",R_="draws",EYe={POLICY_TYPE_VOLUNTARY_CONSOLATION:k4,POLICY_TYPE_COMPETITIVE_BANDS:gm,POLICY_TYPE_ROUND_ROBIN_TALLY:IY,POLICY_TYPE_POSITION_ACTIONS:Bh,POLICY_TYPE_MATCHUP_ACTIONS:Ja,POLICY_TYPE_RANKING_POINTS:Gk,POLICY_TYPE_ROUND_NAMING:zm,POLICY_TYPE_PARTICIPANT:vE,POLICY_TYPE_PROGRESSION:QP,POLICY_TYPE_SCHEDULING:tv,POLICY_TYPE_AVOIDANCE:jP,POLICY_TYPE_DISPLAY:TYe,POLICY_TYPE_PRIVACY:UYe,POLICY_TYPE_FEED_IN:XT,POLICY_TYPE_SCORING:mu,POLICY_TYPE_SEEDING:Ku,POLICY_TYPE_AUDIT:CYe,POLICY_TYPE_DRAWS:R_};function Sg({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let s=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),o=Dt(s,!1,n);if(o){let l=e?.[vE];if(i?.withScaleValues){let{ratings:c,rankings:u}=gE({participant:o});o.rankings=u,o.ratings=c}if(l?.participant)return nw({template:l.participant,source:o})}return o}var DYe="element required",PYe="missing name";function Mo(t){if(!t||typeof t!="object")return{error:Yt};if(t.element&&typeof t?.element!="object")return{error:we};if(!t?.name)return{error:Yt,info:PYe};if(!t?.element){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=Mo({element:i,name:t.name});if(r.error)return ce({result:r,stack:"removeExtension"})}return{...oe}}return{error:Yt,info:DYe}}return t?.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>e?.name!==t.name),{...oe}):{...oe,info:rs}}function gf({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function ur(t){if(typeof t!="object")return{error:Yt};let e="addExtension";if(t?.element&&typeof t.element!="object")return ce({result:{error:we},stack:e});if(!gf({extension:t.extension}))return ce({result:{error:we,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=ur({extension:t.extension,element:r});if(n.error)return ce({result:n,stack:e})}return{...oe}}else return ce({result:{error:Yt},stack:e});if(t.element.extensions||(t.element.extensions=[]),t?.creationTime??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...oe}}function wY(t){return!t||typeof t!="object"?{error:Yt}:t.tournamentRecord?ur({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:nt}}function q2(t){return!t||typeof t!="object"?{error:Yt}:t.drawDefinition?ur({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:Rc}}function iv(t){return!t||typeof t!="object"?{error:Yt}:t.event?ur({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:fu}}function IUe(t){if(!t||typeof t!="object")return{error:Yt};if(!t.participantId)return{error:ba};let e=t.tournamentRecord?.participants||[],i=Sg({participantId:t.participantId,tournamentParticipants:e});return i?ur({creationTime:t.creationTime,extension:t.extension,element:i}):{error:Fn}}function SY(t){return!t||typeof t!="object"?{error:Yt}:t.tournamentRecord?Mo({element:t.tournamentRecord,name:t.name}):{error:nt}}function wUe(t){return!t||typeof t!="object"?{error:Yt}:t.drawDefinition?Mo({element:t.drawDefinition,name:t.name}):{error:Rc}}function W2(t){return!t||typeof t!="object"?{error:Yt}:t?.event?Mo({element:t.event,name:t.name}):{error:fu}}function SUe(t){if(!t||typeof t!="object")return{error:Yt};if(!t.participantId)return{error:ba};let e=t.tournamentRecord?.participants||[],i=Sg({participantId:t.participantId,tournamentParticipants:e});return i?Mo({element:i,name:t.name}):{error:Fn}}function IM({tournamentRecords:t}){return{tournamentIds:Xi(t)?Object.keys(t):[],...oe}}var RYe="extensionQueries";function ki({discover:t,element:e,name:i,...r}){if(!e||!i){if(t&&r){let a=Object.keys(r).filter(l=>typeof t=="boolean"||Array.isArray(t)&&t.includes(l)).find(l=>Array.isArray(r[l]?.extensions)?r[l].extensions.find(c=>c?.name===i):!1),s=a&&r[a];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(l=>l.extensions?.length));let o=s?.extensions?.find(l=>l?.name===i);return{extension:o,info:o?void 0:rs}}return ce({result:{error:Yt},stack:RYe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let n=e.extensions.find(a=>a?.name===i);return{extension:n,info:n?void 0:rs}}var MYe="activeSuspension",zP="appliedPolicies",UUe="context",K2="delegatedOutcome",ep="disabled",aw="disableAutoCalc",Y2="disableLinks",M_="display",sy="drawDeletions",NYe="drawProfile",N_="entryProfile",BYe="eventProfile",kYe="eventWithdrawalRequests",xYe="factory",Ud="flightProfile",x4="groupingAttribute",qm="lineUps",$y="linkedTournamentsIds",X2="matchUpHistory",UY="participantRepresentatives",yE="personRequests",eT="positionActions",_Ye="rankingPoints",OYe="registration",Mf="roundTarget",wM="scheduleLimits",Wm="scheduleTiming",sw="schedulingProfile",FYe="statusDetail",ZT="subOrder",Km="tally",f0="tieFormatModification",TUe={ACTIVE_SUSPENSION:MYe,APPLIED_POLICIES:zP,CONTEXT:UUe,DELEGATED_OUTCOME:K2,DISABLED:ep,DISABLE_LINKS:Y2,DISABLE_AUTO_CALC:aw,DISPLAY:M_,DRAW_DELETIONS:sy,DRAW_PROFILE:NYe,ENTRY_PROFILE:N_,EVENT_PROFILE:BYe,EVENT_WITHDRAWAL_REQUESTS:kYe,FLIGHT_PROFILE:Ud,GROUPING_ATTRIBUTE:x4,LINEUPS:qm,LINKED_TOURNAMENTS:$y,MATCHUP_HISTORY:X2,PARTICIPANT_REPRESENTATIVES:UY,PERSON_REQUESTS:yE,POSITION_ACTIONS:eT,RANKING_POINTS:_Ye,REGISTRATION:OYe,ROUND_TARGET:Mf,SCHEDULE_LIMITS:wM,SCHEDULE_TIMING:Wm,SCHEDULING_PROFILE:sw,STATUS_DETAIL:FYe,SUB_ORDER:ZT,TALLY:Km,TIE_FORMAT_MODIFICATIONS:f0,FACTORY:xYe},sie=[K2,ep,aw,Y2,Ud,qm,$y,X2,UY,yE,Mf,wM,Wm,sw,ZT,Km,f0];function CUe({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:bn};let e=IM({tournamentRecords:t}),{tournamentIds:i}=e;return i?.length>1?ur({tournamentRecords:t,discover:!0,extension:{name:$y,value:{tournamentIds:i}}}):{...oe}}function EUe({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:bn};let e=Mo({name:$y,tournamentRecords:t,discover:!0});return ce({result:e,stack:"unlinkTournaments"})}function DUe({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:we};if(!e)return{error:LT};let i=IM({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:LT};let n;return r.every(a=>{let s=t[a],{extension:o}=ki({element:s,name:$y});if(!o)return!0;let l=o?.value?.tournamentIds||[];if(!l?.length||l.length===1&&l.includes(e)||a===e){let d=SY({name:$y,tournamentRecord:s});return d.error&&(n=d.error),d.success}let c=l.filter(d=>d!==e);o.value={tournamentIds:c};let u=wY({tournamentRecord:s,extension:o});return u.error&&(n=u.error),u.success}),n?{error:n}:{...oe}}var PUe={};Li(PUe,{getLinkedTournamentIds:()=>SM,getTournamentIds:()=>IM});function SM({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:bn}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{let i=t[e],r=i?.tournamentId,{extension:n}=ki({element:i,name:$y}),a=(n?.value?.tournamentIds||[]).filter(s=>s!==r);return{[e]:a}}))}}var RUe={};Li(RUe,{adHocPositionSwap:()=>UCe,addAdHocMatchUps:()=>U$,addDrawDefinitionTimeItem:()=>E7,addFinishingRounds:()=>LM,addGoesTo:()=>Vy,addPlayoffStructures:()=>S$,addQualifyingStructure:()=>SCe,addVoluntaryConsolationStage:()=>ACe,addVoluntaryConsolationStructure:()=>h7,allPlayoffPositionsFilled:()=>U7,alternateDrawPositionAssignment:()=>iCe,assignDrawPosition:()=>rEe,assignDrawPositionBye:()=>Hc,attachConsolationStructures:()=>JCe,attachPlayoffStructures:()=>G7,attachQualifyingStructure:()=>C7,attachStructures:()=>w$,autoSeeding:()=>jtt,automatedPlayoffPositioning:()=>DE,automatedPositioning:()=>WM,checkValidEntries:()=>E$,deleteAdHocMatchUps:()=>aEe,drawMatic:()=>h9,findDrawDefinition:()=>W7,generateAdHocMatchUps:()=>D$,generateAdHocRounds:()=>f9,generateAndPopulatePlayoffStructures:()=>H7,generateDrawDefinition:()=>pN,generateDrawMaticRound:()=>i9,generateDrawStructuresAndLinks:()=>J7,generateDrawTypeAndModifyDrawDefinition:()=>e9,generateQualifyingStructure:()=>B7,generateVoluntaryConsolation:()=>REe,getAssignedParticipantIds:()=>Cb,getAvailableMatchUpsCount:()=>T$,getAvailablePlayoffProfiles:()=>XM,getDrawDefinitionTimeItem:()=>QY,getDrawParticipantRepresentativeIds:()=>z7,getDrawStructures:()=>Td,getDrawTypeCoercion:()=>rN,getEligibleVoluntaryConsolationParticipants:()=>j7,getMatchUpsMap:()=>os,getParticipantIdFinishingPositions:()=>q7,getPositionAssignments:()=>e1,getPositionsPlayedOff:()=>PE,getRandomQualifierList:()=>X7,getSeedingThresholds:()=>v7,getSeedsCount:()=>nN,getStructureSeedAssignments:()=>Au,getTeamLineUp:()=>Hy,getValidGroupSizes:()=>zM,isAdHoc:()=>el,isCompletedStructure:()=>_h,isValidForQualifying:()=>Z7,luckyLoserDrawPositionAssignment:()=>YTe,modifyDrawDefinition:()=>eEe,modifyDrawName:()=>Q7,modifySeedAssignment:()=>cCe,mutate:()=>MUe,positionActions:()=>Y7,pruneDrawDefinition:()=>iEe,qualifierDrawPositionAssignment:()=>T7,qualifierProgression:()=>uCe,query:()=>lEe,removeDrawPositionAssignment:()=>XP,removeRoundMatchUps:()=>sEe,removeSeededParticipant:()=>wCe,removeStructure:()=>hCe,renameStructures:()=>fCe,resetDrawDefinition:()=>tEe,resetQualifyingStructure:()=>gCe,resetVoluntaryConsolationStructure:()=>qUe,setDrawParticipantRepresentativeIds:()=>NUe,setPositionAssignments:()=>eCe,setStructureOrder:()=>dCe,setSubOrder:()=>oEe,shiftAdHocRounds:()=>JTe,swapAdHocRounds:()=>tCe,swapDrawPositionAssignments:()=>bCe,updateTeamLineUp:()=>bS,withdrawParticipantAtDrawPosition:()=>VTe});var MUe={};Li(MUe,{adHocPositionSwap:()=>UCe,addAdHocMatchUps:()=>U$,addDrawDefinitionTimeItem:()=>E7,addPlayoffStructures:()=>S$,addQualifyingStructure:()=>SCe,addVoluntaryConsolationStage:()=>ACe,addVoluntaryConsolationStructure:()=>h7,alternateDrawPositionAssignment:()=>iCe,assignDrawPosition:()=>rEe,assignDrawPositionBye:()=>Hc,attachConsolationStructures:()=>JCe,attachPlayoffStructures:()=>G7,attachQualifyingStructure:()=>C7,attachStructures:()=>w$,automatedPlayoffPositioning:()=>DE,automatedPositioning:()=>WM,deleteAdHocMatchUps:()=>aEe,luckyLoserDrawPositionAssignment:()=>YTe,modifyDrawDefinition:()=>eEe,modifyDrawName:()=>Q7,modifySeedAssignment:()=>cCe,pruneDrawDefinition:()=>iEe,qualifierDrawPositionAssignment:()=>T7,qualifierProgression:()=>uCe,removeDrawPositionAssignment:()=>XP,removeRoundMatchUps:()=>sEe,removeSeededParticipant:()=>wCe,removeStructure:()=>hCe,renameStructures:()=>fCe,resetDrawDefinition:()=>tEe,resetQualifyingStructure:()=>gCe,resetVoluntaryConsolationStructure:()=>qUe,setDrawParticipantRepresentativeIds:()=>NUe,setPositionAssignments:()=>eCe,setStructureOrder:()=>dCe,setSubOrder:()=>oEe,shiftAdHocRounds:()=>JTe,swapAdHocRounds:()=>tCe,swapDrawPositionAssignments:()=>bCe,updateTeamLineUp:()=>bS,withdrawParticipantAtDrawPosition:()=>VTe});var TY=t=>e=>t[e],CY=(t=[])=>t.map(_a).filter(Boolean),_4=(t=[])=>t.map(qi).filter(Boolean),qi=(t={})=>TY(t)("participantId"),_a=(t={})=>TY(t)("matchUpId"),qP=(t={})=>TY(t)("drawId");function NUe({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:Rc};if(!Array.isArray(t))return{error:we};let i=_4(e?.entries||[]);return t.length&&Mn(t,i).length<t.length?{error:we}:q2({drawDefinition:e,extension:{name:UY,value:t}})}var tc="ABANDONED",lS="AWAITING_RESULT",Nf="CANCELLED",Hn="COMPLETED",bE="DEAD_RUBBER",Nr="DEFAULTED",Aa="DOUBLE_DEFAULT",An="DOUBLE_WALKOVER",Md="IN_PROGRESS",ic="INCOMPLETE",EY="NOT_PLAYED",Ha="RETIRED",rv="SUSPENDED",Nn="TO_BE_PLAYED",Zr="WALKOVER",LYe=[lS,Hn,Nr,Md,ic,Ha,rv],BUe=[lS,Hn,Nr,An,Aa,Md,ic,Ha,rv,Zr],kUe=[tc,lS,"BYE",Nf,Hn,bE,Nr,An,Aa,Md,ic,EY,Ha,rv,Nn,Zr],xUe=["BYE",An,Aa,Hn,Nr,Ha,Zr],_Ue=[tc,lS,Nf,bE,Md,ic,EY,rv,Nn,void 0],ta=[Nf,tc,Hn,bE,Nr,An,Aa,Ha,Zr],DY=[tc,Hn,Nr,An,Aa,Md,Ha,Zr],OUe=[Md,ic,rv,Nn],jh={ABANDONED:tc,AWAITING_RESULT:lS,BYE:"BYE",CANCELLED:Nf,COMPLETED:Hn,DEAD_RUBBER:bE,DEFAULTED:Nr,DOUBLE_WALKOVER:An,DOUBLE_DEFAULT:Aa,IN_PROGRESS:Md,INCOMPLETE:ic,NOT_PLAYED:EY,RETIRED:Ha,SUSPENDED:rv,TO_BE_PLAYED:Nn,WALKOVER:Zr};function cS(t,e,i){let r=d=>ki({element:d,name:Mf})?.extension?.value,n=i?.deprioritizeCompleted,a=i?.mode===nUe&&eYe,s=i?.mode===rUe&&aUe,o=s||a||rw,l=d=>d?.stage===Et&&d?.stageSequence===1,c=d=>l(d)?-1:o[d?.stage],u=d=>d?.matchUps.every(({matchUpStatus:p})=>ta.includes(p)?1:-1);return n&&u(t)-u(e)||a&&c(t)-c(e)||(t?.stage&&o[t.stage]||0)-(e?.stage&&o[e.stage]||0)||(r(t)||0)-(r(e)||0)||!s&&!a&&(e?.positionAssignments?.length??1/0)-(t?.positionAssignments?.length??1/0)||(t?.stageSequence??0)-(e?.stageSequence??0)||(B_(t)||0)-(B_(e)||0)}function B_(t){return(t?.matchUps||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((n,a)=>n+a,0);return!e||r<e?r:e},void 0)}function di(t){let e=Qt(t,[{[ro]:!0,[H2]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=Td({drawDefinition:i}),a=n?.map(l=>l.structures?[...l.structures].concat(l):l).flat(),s=a?.find(l=>l.structureId===r);if(!s)return{error:an};let o=s.structureType===F2?a?.find(l=>l.structures?.some(c=>c.structureId===r)):void 0;return{structure:s,containingStructure:o}}function Td({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:s,stage:o}){let l=!e&&kt||!e?.structures&&E8||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let c=h=>{let m=ki({element:h,name:Mf})?.extension?.value;return!n||n===m},u=e?.structures?.filter(p).filter(f).filter(c).sort((h,m)=>cS(h,m,a))??[],d=t?Object.assign({},..._2.map(h=>{let m=u?.filter(A=>A.stage===h);return m?.length&&{[h]:m}}).filter(Boolean)):{};return{structures:u,stageStructures:d};function p(h){return!o&&!Array.isArray(s)||o&&h.stage===o||Array.isArray(s)&&s.includes(h.stage)}function f(h){return!r&&!Array.isArray(i)||r&&h.stageSequence===r||Array.isArray(i)&&i.includes(h.stageSequence)}}function FUe({drawDefinition:t}){if(!t)return{error:kt};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=wr({structure:i}),a=n?.map(qi).filter(Boolean)??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function wr({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:kt};if({structure:i,error:r}=di({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>wr({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=uwe,{positionAssignments:n,error:r}}function Ia({drawDefinition:t,structureId:e,structure:i}){let r=wr({drawDefinition:t,structureId:e,structure:i})?.positionAssignments||[],n=r?.filter(c=>c.participantId??c.bye??c.qualifier),a=r&&r?.length===n?.length,s=r?.filter(c=>!c.participantId&&!c.bye&&!c.qualifier),o=r?.filter(c=>!c.participantId&&c.bye),l=r?.filter(c=>!c.participantId&&c.qualifier);return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:s,assignedPositions:n,qualifierPositions:l,byePositions:o}}var PY="addDrawDefinition",Z2="addMatchUps",Ug="addParticipants",RY="addScaleItems",LUe="addEvent",$Ue="addVenue",Um="audit",MY="dataIssue",NY="deleteParticipants",BY="deleteVenue",kY="deletedDrawIds",xY="deletedMatchUpIds",_Y="modifyDrawDefinition",HUe="modifyDrawEntries",VUe="modifyEventEntries",OY="modifyMatchUp",$s="modifyParticipants",FY="modifyPositionAssignments",LY="modifySeedAssignments",bb="modifyTournamentDetail",vA="modifyVenue",O4="mutations",F4="publishEvent",GUe="publishEventSeeding",QUe="publishOrderOfPlay",jUe="publishParticipants",$Y="unPublishEvent",HY="unPublishEventSeeding",VY="unPublishOrderOfPlay",$Ye="unPublishParticipants",J2="updateInContextMatchUp",HYe={ADD_DRAW_DEFINITION:PY,ADD_MATCHUPS:Z2,ADD_PARTICIPANTS:Ug,ADD_SCALE_ITEMS:RY,ADD_EVENT:LUe,ADD_VENUE:$Ue,AUDIT:Um,DATA_ISSUE:MY,DELETE_PARTICIPANTS:NY,DELETE_VENUE:BY,DELETED_DRAW_IDS:kY,DELETED_MATCHUP_IDS:xY,MODIFY_DRAW_DEFINITION:_Y,MODIFY_DRAW_ENTRIES:HUe,MODIFY_EVENT_ENTRIES:VUe,MODIFY_MATCHUP:OY,MODIFY_PARTICIPANTS:$s,MODIFY_POSITION_ASSIGNMENTS:FY,MODIFY_SEED_ASSIGNMENTS:LY,MODIFY_TOURNAMENT_DETAIL:bb,MODIFY_VENUE:vA,MUTATIONS:O4,PUBLISH_EVENT_SEEDING:GUe,PUBLISH_EVENT:F4,PUBLISH_ORDER_OF_PLAY:QUe,PUBLISH_PARTICIPANTS:jUe,UNPUBLISH_EVENT_SEEDING:HY,UNPUBLISH_EVENT:$Y,UNPUBLISH_ORDER_OF_PLAY:VY,UPDATE_INCONTEXT_MATCHUP:J2};function e$(t,e){if(!t)return{error:kt};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let r=new Date(i).toISOString(),n=e?.filter(Boolean);return t.updatedAt=r,t.structures?.filter(Boolean).forEach(a=>{(!n?.length||n?.includes(a.structureId))&&(a.updatedAt=r)}),{...oe}}function Tg({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&e$(t),Ii({payload:{matchUps:i,tournamentId:e,eventId:r},topic:Z2}),{...oe}}function zh({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&e$(t),Ii({topic:xY,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)J8({key:a});return{...oe}}function Zi({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&kr({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),Ii({topic:OY,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...oe}):(console.log(Zo),{error:Zo})}function VYe({tournamentId:t,inContextMatchUp:e}){return e?(Ii({payload:{inContextMatchUp:e,tournamentId:t},topic:J2,key:e.matchUpId}),{...oe}):{error:Zo}}function UM({tournamentId:t,eventId:e,drawDefinition:i}){return i?(e$(i),Ii({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:PY,key:i.drawId}),{...oe}):(console.log(kt),{error:kt})}function GYe({tournamentId:t,eventId:e,drawId:i}){return Ii({payload:{drawId:i,tournamentId:t,eventId:e},topic:kY,key:i}),J8({key:i}),{...oe}}function kr({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(e$(t,i),Ii({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:_Y,key:t.drawId}),{...oe}):{error:kt}}function zUe({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:kt};if(!i)return{error:Ab};let n=i.seedAssignments,a=i.structureId,s=t.drawId;return Ii({payload:{tournamentId:e,eventId:r,drawId:s,structureId:a,seedAssignments:n},topic:LY,key:t.drawId}),kr({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...oe}}function Ym({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:kt};if(!i)return{error:Ab};let n=wr({structure:i}),a=i.structureId,s=t.drawId,o=r?.eventId;return Ii({topic:FY,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:o,drawId:s},key:a}),kr({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:o}),{...oe}}function qUe({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){if(!e)return{error:kt};let n=e.structures?.find(s=>s.stage===Za);if(!n)return{error:an};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],zh({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(s=>s.entryStage!==Za)),kr({tournamentId:t?.tournamentId,eventId:r?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...oe}}function GY({drawPositions:t,structure:e}){if([qt,Et].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=wr({structure:e});i?.filter(({drawPosition:r})=>t?.includes(r))?.forEach(r=>{ur({element:r,extension:{name:Y2,value:!0}})})}function TM(t){let{appliedPolicies:e,positionAction:i,drawDefinition:r}=t;if(e?.audit?.[eT]===!1)return;let{extension:n}=ki({name:eT,element:r}),a=Array.isArray(n?.value)?n?.value??[]:[];if(!a?.length){let o=r.structures.find(l=>l.stage===Et);if(o){let l=wr({structure:o}).positionAssignments?.map(({drawPosition:c,participantId:u,bye:d,qualifier:p})=>({drawPosition:c,participantId:u,qualifier:p,bye:d}));a.push({name:"initialMainAssignments",initialAssignments:l})}}let s={value:a.concat(i),name:eT};ur({element:r,extension:s})}function IE({tournamentRecord:t,drawDefinition:e,event:i}){let r=(t?.events||i&&[i])?.map(o=>o?.drawDefinitions).flat().filter(Boolean)||e&&[e]||[],n={},a={},s=r.map(o=>o?.structures?.filter(l=>l?.structures)).flat().filter(Boolean);for(let o of s){let{structures:l,structureId:c}=o??{};l&&c&&(n[c]=l?.map(u=>u.structureId))&&l.forEach(u=>a[u.structureId]=o?.structureId)}return{containedStructures:n,containerStructures:a}}function t$(t){let{sides:e,matchUpType:i}=t||{},r=t.potentialParticipants?.length?t.potentialParticipants.flat().map(a=>i===br?a?.individualParticipantIds||[]:a.participantId).flat():[],n=(e||[]).map(a=>i===br&&(a?.participant?.individualParticipantIds||[])||a?.participantId&&[a.participantId]||[]).flat();return{individualParticipantIds:n.concat(r).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:r}}function Cu(t){return t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var CM="SIGN_IN_STATUS",WUe="SIGNED_OUT",WP="SIGNED_IN",qo="TEAM",Wi="INDIVIDUAL",Lc="GROUP",Ni="PAIR",vr="TEAM",h0={TEAM_PARTICIPANT:qo,INDIVIDUAL:Wi,GROUP:Lc,TEAM:vr,PAIR:Ni},QYe={INDIVIDUAL:Wi,GROUP:Lc,PAIR:Ni,TEAM:vr,SIGN_IN_STATUS:CM,SIGNED_OUT:WUe,SIGNED_IN:WP};function i$({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?Dt(e,t?.convertExtensions,!0):e,a=n.filter(l=>l.participantType===vr),s=n.filter(l=>l.participantType===Lc),o=n.filter(l=>l.participantType===Ni);return n.forEach(l=>{if(l.participantType===Wi){let{participantId:c}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(u=>{(u?.individualParticipantIds||[]).forEach(d=>{d===c&&!l.teamParticipantIds?.includes(u.participantId)&&(l.teamParticipantIds.push(u.participantId),r.get(u.participantId)||r.set(u.participantId,{participantName:u.participantName,participantId:u.participantId}),l.teams.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId,teamId:u.teamId}))})}),o.forEach(u=>{(u?.individualParticipantIds||[]).forEach(d=>{d===c&&!l.pairParticipantIds.includes(u.participantId)&&l.pairParticipantIds.push(u.participantId)})}),s.forEach(u=>{(u?.individualParticipantIds||[]).forEach(d=>{d===c&&!l.groupParticipantIds.includes(u.participantId)&&(l.groupParticipantIds.push(u.participantId),l.groups.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}function KUe(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function jYe(t){let e=Object.assign({},...og.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return KUe(e[t])}var og=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function YUe({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n?.map(({person:o})=>o)].flat().filter(Boolean);function s(o){let{nationalityCode:l}=o||{};if(l){let c=og.find(({iso:u})=>u===l);i&&c?.ioc&&!o.iocNationalityCode&&(o.iocNationalityCode=c.ioc),e&&c?.iso2&&!o.iso2NationalityCode&&(o.iso2NationalityCode=c.iso2),c?.label&&!o.countryName&&(o.countryName=c.label)}}a.forEach(s)}function zYe({participantMap:t,template:e}){let i=Object.values(t);for(let r of i){let n=r.participant;if(n.individualParticipantIds?.length){n.individualParticipants=[];for(let a of n.individualParticipantIds){let s=t[a].participant;n.individualParticipants.push(e?nw({template:e,source:s}):s)}}}}function nv(t){let{tournamentRecord:e,participantId:i}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let n of Object.values(r)){let a=n.participants?.find(s=>s.participantId===i);if(a)return{participant:a,tournamentId:n.tournamentId}}return{error:Fn}}function XUe(t){let{tournamentRecord:e,participantId:i}=t;if(i){let r=nv({tournamentRecord:e,participantId:i});return r.participant??r}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Yt}}function Eu(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=XUe(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:we,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:Q8};let a=n.timeItems.filter(o=>o?.itemType===r).filter(o=>!i?.length||i.some(l=>o?.itemSubTypes?.includes(l))).sort((o,l)=>{let c=new Date(o.createdAt||void 0).getTime(),u=new Date(l.createdAt||void 0).getTime();return c-u}),s=Dt(a.pop(),!1,!0);if(s){let o={timeItem:s,...oe};return e&&Object.assign(o,{previousItems:a}),o}else return{info:rs}}function QY({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:hp};if(!e.timeItems)return{info:rs};let{timeItem:n,previousItems:a,info:s}=Eu({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function EM({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:Gr};if(!r.timeItems)return{info:rs};let{timeItem:n,previousItems:a,info:s}=Eu({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:s}}function r$({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:nt};if(!e.timeItems)return{info:rs};let{timeItem:n,previousItems:a,info:s}=Eu({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function jY({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:nt};if(!i)return{error:ba};let a=nv({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:s}=a;if(!s?.timeItems)return{info:rs};let{timeItem:o,previousItems:l,info:c}=Eu({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return o&&{timeItem:o,previousItems:l}||{info:c}}var qYe={[Lc]:"groupParticipantIds",[Ni]:"pairParticipantIds",[vr]:"teamParticipantIds"},WYe={[Lc]:"groups",[vr]:"teams"};function ZUe({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,withGroupings:a,internalUse:s,withISO2:o,withIOC:l}){let c=[],u={};for(let p of i.participants??[]){let f=p?.participantId;f&&XYe({participantMap:u,participantId:f})}for(let p of i.participants??[]){let f=Dt(p,e,s),{participantId:h,individualParticipantIds:m,participantType:A}=f;if(!u[h]){c.push(h);continue}if(Object.assign(u[h].participant,f),m){let g=YYe({individualParticipantIds:m,participantCopy:f,participantMap:u,participantType:A,participantId:h});g.missingParticipantIds.length&&c.push(...g.missingParticipantIds)}if(r&&(u[h].participant.signedIn=KYe(f)),n){let{ratings:g,rankings:v,seedings:b}=gE({participant:f});u[h].participant.seedings=b,u[h].participant.rankings=v,u[h].participant.ratings=g}(l||o)&&YUe({participant:u[h].participant,withISO2:o,withIOC:l})}if(t){let p=Xi(t)?t:void 0;zYe({participantMap:u,template:p})}let d;return a&&(d=i$({participants:Object.values(u).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:c,participantMap:u,groupInfo:d}}function KYe(t){let{timeItem:e}=Eu({itemType:CM,element:t});return e?.itemValue===WP}function YYe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){let a=[];for(let s of t){let o=i[s]?.participant;if(!o){a.push(s);continue}if(o[qYe[r]].push(n),[vr,Lc].includes(r)){let{participantRoleResponsibilities:l,participantOtherName:c,participantName:u,participantId:d,teamId:p}=e,f=WYe[r];o[f].push({participantRoleResponsibilities:l,participantOtherName:c,participantName:u,participantId:d,teamId:p})}if(r===Ni){let l=t.find(c=>c!==s);i[s].pairIdMap[n]=l,i[s].pairIdMap[l]=n}}return{missingParticipantIds:a}}function XYe({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[Dr]:{...i},[br]:{...i},[vr]:{...i},...i}}}function Ib({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){if(e)return ZUe({...t,...r,tournamentRecord:i});let a=Dt(i.participants,!1,!0)||[];(t?.withIOC||t?.withISO2)&&a.forEach(o=>YUe({participant:o,...t}));let s;if((n||t?.withGroupings)&&a?.length&&({participantsWithGroupings:a,groupInfo:s}=i$({participantsProfile:t,deepCopy:!1,participants:a})),t?.withScaleValues&&a?.length)for(let o of a){let{ratings:l,rankings:c}=gE({participant:o});o.rankings=c,o.ratings=l}return{participants:a,groupInfo:s}}function tr({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:N8};let s={};return i&&o(i),a&&o(a),r&&o(r),n&&o(n),{appliedPolicies:s,...oe};function o(l){let c=l?.extensions?.find(u=>u.name===zP)?.value;if(c)for(let u of Object.keys(c))(t?e.includes(u):!e.length||e.includes(u))&&(s[u]=Dt(c[u],!1,!0))}}function yA({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:N8};let{appliedPolicies:a}=tr({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),s={};for(let o of t){let l=a?.[o];l&&(s[o]=l)}return Object.keys(s).length?{policyDefinitions:s}:{info:cM.message}}var JUe="WALKOVER",oie="RETIRED",zY="COMPETITIVE",KP="ROUTINE",YP="DECISIVE",Qk="winRatio",ZYe={[gm]:{policyName:"Competitive Bands Default",profileBands:{[YP]:20,[KP]:50}}},qY=ZYe;function bA({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let s=yA({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let o=t?.[gm]??s?.[gm]??qY[gm];a.policies[gm]=o}return a}function wb({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:nt};let{appliedPolicies:a}=tr({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a?.[i]?{policy:a[i]}:{info:cM?.message}}function DM({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){e=e??r?.category?.categoryName??r?.category?.ageCategoryCode,i=i??r?.category?.categoryType??r?.category?.subType;let{policy:n}=wb({policyType:tv,tournamentRecord:t,event:r}),a=(t?ki({element:t,name:Wm}).extension:void 0)?.value,s=(r&&ki({name:Wm,element:r}).extension)?.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:s,categoryName:e,categoryType:i,policy:n}}}function WY({drawDefinition:t,attributes:e}){let{extension:i}=ki({element:t,name:N_}),r=i?.value||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:N_,value:r},q2({drawDefinition:t,extension:i}),{entryProfile:r}}function PM({drawDefinition:t}){let{extension:e}=ki({element:t,name:N_});return{entryProfile:e?.value||{}}}var ud="ALTERNATE",RM="CONFIRMED",Sl="DIRECT_ACCEPTANCE",MM="FEED_IN",NM="JUNIOR_EXEMPT",Xm="LUCKY_LOSER",BM="ORGANISER_ACCEPTANCE",kM="QUALIFIER",JYe="REGISTERED",xM="SPECIAL_EXEMPT",Du="UNGROUPED",Sb="UNPAIRED",JT="WILDCARD",kh="WITHDRAWN",jk=[RM,Sl,NM,BM,xM],eTe=[MM,Xm,kM],Ub=[RM,Sl,MM,NM,BM,xM,JT],Nd=[RM,Sl,NM,Xm,kM,BM,xM,JT],tTe=[ud,RM,Sl,MM,NM,Xm,BM,kM,JYe,xM,Du,Sb,JT,kh],e7e={ALTERNATE:ud,CONFIRMED:RM,DIRECT_ACCEPTANCE:Sl,DIRECT_ENTRY_STATUSES:Ub,DRAW_SPECIFIC_STATUSES:eTe,EQUIVALENT_ACCEPTANCE_STATUSES:jk,FEED_IN:MM,JUNIOR_EXEMPT:NM,LUCKY_LOSER:Xm,ORGANISER_ACCEPTANCE:BM,QUALIFIER:kM,SPECIAL_EXEMPT:xM,STRUCTURE_SELECTED_STATUSES:Nd,UNGROUPED:Du,UNPAIRED:Sb,VALID_ENTRY_STATUSES:tTe,WILDCARD:JT,WITHDRAWN:kh};function KY({stage:t,drawDefinition:e}){let{entryProfile:i}=PM({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&_2.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return WY({drawDefinition:e,attributes:n}),!0}return r}function t7e({stage:t,drawDefinition:e}){let{entryProfile:i}=PM({drawDefinition:e});return i[t]?.alternates||0}function i7e({stage:t,drawDefinition:e}){let{entryProfile:i}=PM({drawDefinition:e});return i[t]?.wildcardsCount||0}function L4({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function uS({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:s,stages:o,stage:l}){let c=i.entries?.reduce((u,d)=>{let p=ki({name:Mf,element:d})?.extension?.value,f=l&&d.entryStage===l||o?.length&&d.entryStage&&o.includes(d.entryStage),h=!n||d.entryStatus&&n.includes(d.entryStatus),m=d.entryStageSequence??1;return f&&(!r||m===r)&&h&&(!s||!p||s===p)?u.concat(d):u},[])??[];if(a&&l===Dn){let{playoffEntries:u,error:d}=r7e({provisionalPositioning:t,drawDefinition:i,structureId:a});return d&&console.log("playoff entries error"),(u?.length?u:c).filter(p=>!e||p.placementGroup===e)}return c}function r7e({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===Dh&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:s}=n.source,{structure:o}=di({drawDefinition:e,structureId:s});o?.structureType===$o&&(o.structures??[]).forEach(l=>{let c=l.positionAssignments??[],{structureId:u}=l,d=u,p=Object.assign({},...c.map(m=>{let{participantId:A}=m,g=ki({element:m,name:Km}).extension?.value;return g&&A?{[A]:g}:void 0}).filter(Boolean)),f=Object.keys(p).reduce((m,A)=>{let g=p[A],v=g.groupOrder||t&&g.provisionalOrder;return m.includes(v)||m.push(v),m},[]).length===Object.keys(p).length,h=Object.keys(p).filter(m=>{let A=p[m],g=A.groupOrder||t&&A.provisionalOrder;return a?.includes(g)});(!t||f)&&h.forEach(m=>{let A=p[m],{groupOrder:g,provisionalOrder:v,GEMscore:b}=A,y=g||t&&v,I=[...a??[]].sort(ua).indexOf(y)+1;r.push({entryStage:Dn,entryStatus:MM,placementGroup:I,groupingValue:d,participantId:m,GEMscore:b})})})}return{playoffEntries:r}}function n7e({stage:t,drawDefinition:e}){return Ub.reduce((i,r)=>(L4({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function Au({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){let a,s=[];n||({structure:n,error:a}=di({drawDefinition:i,structureId:r}));let o=wr({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:an};r||(r=n.structureId);let{stage:l,stageSequence:c}=n,u=l===Dn&&i&&uS({provisionalPositioning:t,drawDefinition:i,stageSequence:c,structureId:r,stage:l}),d=u?u.filter(h=>h.placementGroup===1).sort((h,m)=>h.GEMscore<m.GEMscore&&1||h.GEMscore>m.GEMscore&&-1||0).map((h,m)=>{let A=m+1;return{participantId:h.participantId,seedValue:A,seedProxy:!0,seedNumber:A}}):[],p=d?.slice(0,e?d.length:o.length/2);p.length?s=p:n.seedAssignments?s=n.seedAssignments:a=ewe;let f=n.seedLimit??n?.positionAssignments?.length;return{seedAssignments:s,stageSequence:c,seedLimit:f,stage:l,error:a}}function Mp(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function m0({item:t,drawDefinition:e,structure:i,event:r}){if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:e.tieFormats?.find(n=>t.tieFormatId===n.tieFormatId)||(r.tieFormat?r.tieFormat:r.tieFormats?.find(n=>t.tieFormatId===n.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let n=e.tieFormats?.find(a=>i.tieFormatId===a.tieFormatId);if(n)return n}}}function po({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:m0({item:i,drawDefinition:t,structure:e,event:r})||m0({item:e,drawDefinition:t,structure:e,event:r})||Mp(t)||Mp(r)}}function a7e({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function os({drawDefinition:t,structure:e}){let i={},r=[];return(t?.structures??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:s,structures:o}=n,l=Array.isArray(o);if(l)l&&o.forEach(c=>{let{structureName:u}=c,d=c.matchUps;i[c.structureId]={matchUps:d,itemStructureIds:[],structureName:u},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(c.structureId)});else{let c=s;i[a]={matchUps:c,itemStructureIds:[]},c?.forEach(u=>{r.push(u),u.tieMatchUps&&r.push(...u.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function Cg({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=e?.mappedMatchUps??t;let n=t[i],a=(n?.itemStructureIds||[]).map(s=>{let{matchUps:o,structureName:l}=t[s];return r?o.map(c=>Object.assign(Dt(c,!0,!0),{containerStructureId:i,structureId:s,structureName:l})):o}).flat();return(n?.matchUps||[]).concat(...a)}function iTe({groupedOrder:t,roundPositionsCount:e}){if(!t||t?.length<=e)return t;let i=$a(t,t.length/e).map(n=>n.reduce((a,s)=>a+s)),r=i.slice().sort(ua);return i.map(n=>r.indexOf(n)+1)}function n$(t){if(!Xi(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>wi(a)||a===void 0||a===null);return r&&n}function Pu(t){return Array.isArray(t)?t.every(n$):!1}function s7e(t,e){return e?.find(i=>t.includes(i))}function Oo({matchUps:t=[],interpolate:e}){if(!Pu(t))return{roundMatchUps:[],error:we};let i=t.reduce((d,p)=>{let f=typeof p.roundNumber=="string"?ci(p.roundNumber):p.roundNumber;return!p.roundNumber||d.includes(f)?d:d.concat(f)},[]).sort(ua).map(d=>{let p=t.filter(m=>m.roundNumber===d),f=p.find(({matchUpType:m})=>m===Hr)?p.filter(({matchUpType:m})=>m===Hr):p,h=m=>m.sort((A,g)=>ua(A.roundPosition,g.roundPosition));return{[d]:h(f)}}),r=t.reduce((d,p)=>{let f=typeof p.roundNumber=="string"?ci(p.roundNumber):p.roundNumber;return d[f]||(d[f]=Lt({abbreviatedRoundName:p.abbreviatedRoundName,finishingRound:p.finishingRound,roundName:p.roundName})),d},{}),n=Object.assign({},...i);if(e){let d=Math.max(...Object.keys(n).map(f=>ci(f)).filter(f=>!Number.isNaN(f))),p=n[d]?.length;if(p>1&&op(p)){let f=d+1,h=f+p/2;vt(f,h).forEach((m,A)=>{n[m]=vt(0,p/(2+A*2)).map(()=>({}))})}}let a=0,s=Object.assign({},...Object.keys(n).map(d=>{let p=n[d]?.length,f=n[d]?.filter(m=>!ta.includes(m.matchUpStatus)&&!m.score?.scoreStringSide1)?.length,h=p&&p===f;return a=Math.max(a,p),{[d]:{matchUpsCount:p,inactiveCount:f,inactiveRound:h}}})),o=0,l=0,c=Object.keys(n).map(d=>ci(d)).filter(d=>!Number.isNaN(d));c.forEach(d=>{let p=n[d].sort((h,m)=>h.roundPosition-m.roundPosition),f=p.flatMap(h=>h?.drawPositions||[]);if(s[d].roundNumber=d,s[d].roundFactor=s[d].matchUpsCount?a/s[d].matchUpsCount:1,s[d].finishingRound=r[d]?.finishingRound,s[d].roundName=r[d]?.roundName,s[d].abbreviatedRoundName=r[d]?.abbreviatedRoundName,s[d].finishingPositionRange=n[d]?.[0]?.finishingPositionRange,d===1||!s[d-1]){let h=f.sort(ua),m=$a(h,2);s[d].drawPositions=h,s[d].pairedDrawPositions=m}else{let h=s[d-1],m=h.drawPositions,A=h.matchUpsCount/s[d].matchUpsCount,g=$a(m,A),v=p.map(b=>{let{roundPosition:y}=b,I=[...b.drawPositions||[],void 0,void 0].slice(0,2);if(!y)return I;let w=I?.filter(Boolean)||[];if(!w?.length)return[void 0,void 0];if(d<3&&w?.length===2)return I?.slice().sort(ua);let S=Mn(m,w).length!==w?.length;if(w?.length&&S)return w?.length===1?[w[0],void 0]:I?.slice().sort(ua);let T=(y-1)*2;return g.slice(T,T+2).map(D=>s7e(D,w))});s[d].drawPositions=v?.flat(),s[d].pairedDrawPositions=v}s[d+1]?.matchUpsCount===s[d].matchUpsCount&&(s[d+1].feedRound=!0,s[d+1].feedRoundIndex=l,s[d].preFeedRound=!0,l+=1),s[d]&&!s[d].feedRound&&(s[d].roundIndex=o,o+=1)});let u=!!Object.values(s).some(({matchUpsCount:d})=>!op(d));return{hasNoRoundPositions:t.some(d=>!d.roundPosition),roundsNotPowerOf2:u,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:c,roundProfile:s,...oe}}function zk(t){if(!Array.isArray(t))return"";let e=t.filter(Un);return e.length?Ei([Math.min(...e),Math.max(...e)]).join("-"):""}function o7e({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:kt};if(!e)return{error:Fc};let{structure:r}=di({drawDefinition:t,structureId:e});if(r?.stage!==Ls)return{error:gb,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=n?.filter(d=>d.target.structureId===e)||[],s=a?.reduce((d,p)=>{let{structureId:f}=p.source;return d.includes(f)?d:d.concat(f)},[])||[],o=Object.assign({},...s.map(d=>{let p=Cg({structureId:d,matchUpsMap:i}),f=Oo({matchUps:p}).roundProfile;return{[d]:f}})),l=Cg({matchUpsMap:i,structureId:e}),{roundProfile:c}=Oo({matchUps:l}),u={};return a?.forEach(d=>{let{structureId:p,roundNumber:f}=d.source,{feedProfile:h,groupedOrder:m,positionInterleave:A,roundNumber:g}=d.target,v=o[p],b=v[1]?.drawPositions,y=v[f]?.matchUpsCount;if(!y)return;let I=y?b.length/y:0,w=b.length/I,S=b.slice(),T=iTe({roundPositionsCount:w,groupedOrder:m}),D=T?.length||1;if(D<=w){let P=b.length/D,R=$a(S,P);h===Oy&&R.forEach(M=>M.reverse()),S=T?.length&&T?.map(M=>R[M-1]).flat()||R.flat()}let C=$a(S,I);if(A){let P=vt(0,A.interleave).map(()=>{}),R=vt(0,A.offset).map(()=>{});C=C.map(N=>[N,...P]),C.unshift(R),C=C.flat(1);let M=C.length-A.offset;C=C.slice(0,M)}u[g]||(u[g]={});let E=c?.[g]?.feedRound?2:1;C.forEach((P,R)=>{let M=1+R*E;u[g][M]||(u[g][M]=zk(P))})}),{sourceDrawPositionRanges:u}}function rTe({drawDefinition:t}){if(typeof t!="object")return{error:EI};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((s,o)=>{let{stage:l}=o;return s[l]?s[l].push(o):s[l]=[o],s},{});for(let s of Object.keys(n)){let o=n[s].find(({stageSequence:c})=>c===1);if(!o)continue;let{structureId:l}=o;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:s})}return{exitProfiles:e};function a({exitProfiles:s,exitProfile:o,structureId:l,targetRound:c,aggregator:u,stage:d}){s[l]||(s[l]=[]),o==="0"&&[Ls,Dn].includes(d)||s[l].push(o);let p=r.filter(f=>f.source.structureId===l&&f.source.roundNumber>=c);for(let f of p){let h=f.source.roundNumber,m=f.target.roundNumber,A=f.target.structureId,g=i.find(b=>b.structureId===A).stage,v=[g,A,m,h].join("|");if(u[v])return;u[v]=!0,a({exitProfile:`${o}-${h}`,structureId:A,exitProfiles:s,targetRound:m,aggregator:u,stage:g})}}}function l7e({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){if(!t)return{error:kt};if(!i)return{error:Fc};if(!e){let s=Cg({matchUpsMap:r,structureId:i});if({roundProfile:e}=Oo({matchUps:s}),!e)return{error:Yt}}let n=(Math.min(...e?.[1]?.drawPositions??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{let o=e?.[s]?.matchUpsCount,l=e?.[1]?.drawPositions??[],c=$a(l,l.length/o),u=c.map(zk),d=c.map(A=>A.map(g=>g-n)).map(zk),p=a.map(A=>{if(A>s)return;let g=e?.[A]?.drawPositions??[];return $a(g,g.length/o)}).filter(Boolean),f=vt(0,o).map(A=>p.map(g=>g[A]).flat().filter(Boolean).sort(ua)).map(A=>Ei(A)),h=f.map(A=>y6e(A).map(zk).join(", ")),m=Object.assign({},...vt(0,o).map(A=>({[A+1]:{firstRoundDrawPositionsRange:u[A],firstRoundOffsetDrawPositionsRange:d[A],possibleDrawPositions:f[A],drawPositionsRange:h[A]}})));return{[s]:m}}))}}function YY({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){if(!i)return!1;r=r??i.matchUps??[],t=t??Oo({matchUps:r}).roundsNotPowerOf2;let n=!!i.positionAssignments?.find(({drawPosition:a})=>a)||!!r?.find(({drawPositions:a})=>a?.length);return(!e?.drawType||e.drawType!==yb)&&!i?.structures&&t&&n}function el({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!e?.find(n=>n?.roundPosition),r=!!e?.find(n=>n?.drawPositions?.length);return!t?.structures&&t?.stage!==Za&&(!e.length||!i&&!r)}var XY={[zm]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Et]:"",[Dn]:"P",[qt]:"Q",[Ls]:"C"}}},c7e=XY;function nTe({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){let{roundProfile:n,roundMatchUps:a}=Oo({matchUps:r}),{structureAbbreviation:s,stage:o}=i,l=el({structure:i}),c=YY({structure:i}),u=i.structures,d={},p=XY[zm],f=i.stage===qt,h=f?Math.max(...(e?.structures??[]).filter(P=>P.stage===qt).map(({stageSequence:P})=>P??1),0):0,m=(i.stageSequence??1)<h?i.stageSequence??1:"",A=m&&(t?.affixes?.preQualifying||p.affixes.preQualifying)||"",g=t?.roundNamingMap||p.roundNamingMap||{},v=t?.abbreviatedRoundNamingMap||p.abbreviatedRoundNamingMap||{},b=t?.affixes?.preFeedRound||p.affixes.preFeedRound,y=t?.affixes?.roundNumber||p.affixes.roundNumber,I=(t?.namingConventions||p.namingConventions).round,w=o&&o!==Et?o[0]:"",S=t?.stageConstants||p.stageConstants,T=o&&S?.[o]||w,D=`${A}${T}${m}`,C=n?Object.keys(n):[],E=f&&S?.[qt]?`${S?.[qt]}-`:"";if(u||l||c)Object.assign(d,...C.map(P=>{let R=`${E}${I} ${P}`,M=`${y}${P}`;return{[P]:{roundName:R,abbreviatedRoundName:M}}}));else{let P=f&&(t?.qualifyingFinishMap||p?.qualifyingFinishMap||{});Object.assign(d,...C.map(R=>{if(!n?.[R])return;let{matchUpsCount:M,preFeedRound:N}=n[R],k=M*2,O=P?.[n?.[R].finishingRound]||P&&`${y}${k}`||g[M]||`${y}${k}`,x=N?`-${b}`:"",F=`${O}${x}`,_=[D,s,F].filter(Boolean).join("-"),V=`${v[M]||`${y}${k}`}${x}`,G=[D,s,V].filter(Boolean).join("-");return{[R]:{abbreviatedRoundName:G,roundName:_}}}))}return{roundNamingProfile:d,roundProfile:n,roundMatchUps:a}}var u7e=(t,e)=>(t||0)+(e||0);function aTe(t,e){let i=Array.isArray(t)?t[0]:t;return Number.isNaN(i)&&JUe||i<=e[YP]&&YP||i<=e[KP]&&KP||zY}function sTe({score:t}){let e=t?.sets||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(u7e)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function d7e(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function oTe(t){return t.map(d7e).sort().map(e=>parseFloat(e.toFixed(2)))}function _M({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:Zo};let{score:r,winningSide:n}=i;if(!n)return{error:we};let a=!e&&t&&wb({policyType:gm,tournamentRecord:t}).policy,s=e||a?.profileBands||qY[gm].profileBands,o=sTe({score:r}),l=oTe([o]),c=aTe(l,s),u=Array.isArray(l)?l[0]:l;return{...oe,competitiveness:c,pctSpread:u}}function lTe({matchUp:t}){if(!t)return{error:Zo};if(t&&!t.sides)return{error:wl};if(t&&!t.hasContext)return{error:T2};let e=(t.sides??[])?.map(s=>s?.participantId).filter(Boolean),i=t.sides?.filter(s=>s.participant?.participantType===Wi).map(s=>s.participantId).filter(Boolean)??[],r=((t.sides??[])?.map(s=>s.participant?.individualParticipants).filter(Boolean)??[]).map(s=>(s??[]).map(o=>o?.participantId).filter(Boolean)),n=[...i,...r.flat()].filter(Boolean)??[],a=Ei(n.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:r,allRelevantParticipantIds:a,individualParticipantIds:n,sideParticipantIds:e,...oe}}var k_="CHECK_IN",x_="CHECK_OUT",p7e="SCHEDULE",dS="SCHEDULE.ASSIGNMENT.VENUE",xh="SCHEDULE.ALLOCATION.COURTS",Eg="SCHEDULE.ASSIGNMENT.COURT",a$="SCHEDULE.COURT.ORDER",pS="SCHEDULE.DATE",f7e="COMPLETED.DATE",ZY="HOME_PARTICIPANT_ID",JY="SCHEDULE.ASSIGN.OFFICIAL",fS="SCHEDULE.TIME.SCHEDULED",zd="SCHEDULE.TIME.START",Tm="SCHEDULE.TIME.STOP",oh="SCHEDULE.TIME.RESUME",Zm="SCHEDULE.TIME.END",s$="SCHEDULE.TIME.MODIFIERS",cTe="TO_BE_ANNOUNCED",uTe="NEXT_AVAILABLE",dTe="FOLLOWED_BY",pTe="AFTER_REST",fTe="RAIN_DELAY",h7e="NOT_BEFORE",$4=[cTe,uTe,dTe,pTe,fTe],m7e="ELIGIBILITY",A7e="REGISTRATION",g7e="SUSPENSION",v7e="MEDICAL",y7e="PENALTY",hTe="SCALE",mTe="RATING",ATe="RANKING",e7="SEEDING",av="PUBLISH",$c="PUBLIC",sv="STATUS",b7e="MODIFICATION",I7e="RETRIEVAL",w7e="other",S7e={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:$4,AFTER_REST:pTe,ALLOCATE_COURTS:xh,ASSIGN_COURT:Eg,ASSIGN_OFFICIAL:JY,ASSIGN_VENUE:dS,CHECK_IN:k_,CHECK_OUT:x_,COMPLETED_DATE:f7e,COURT_ORDER:a$,ELIGIBILITY:m7e,END_TIME:Zm,FOLLOWED_BY:dTe,MEDICAL:v7e,MODIFICATION:b7e,NEXT_AVAILABLE:uTe,NOT_BEFORE:h7e,OTHER:w7e,PENALTY:y7e,PUBLIC:$c,PUBLISH:av,RANKING:ATe,RATING:mTe,RAIN_DELAY:fTe,REGISTRATION:A7e,RESUME_TIME:oh,RETRIEVAL:I7e,SCALE:hTe,SCHEDULE:p7e,SCHEDULED_DATE:pS,SCHEDULED_TIME:fS,SEEDING:e7,START_TIME:zd,STATUS:sv,STOP_TIME:Tm,SUSPENSION:g7e,TIME_MODIFIERS:s$,TO_BE_ANNOUNCED:cTe};function hS({matchUp:t}){if(!t)return{error:Zo};if(!t.hasContext)return{error:T2};if(!t.sides||t?.sides.filter(Boolean).length!==2)return{error:wl};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=lTe({matchUp:t}),n=(t.timeItems??[]).filter(o=>o?.itemType&&[k_,x_].includes(o.itemType)).sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(o=>o.itemValue).filter(o=>n.filter(l=>l?.itemValue===o).reverse()[0].itemType===k_);e?.forEach((o,l)=>{let c=r?.[l],u=o?.length&&o.every(d=>a.includes(d));c&&u&&!a.includes(c)&&a.push(c)}),r?.forEach((o,l)=>{a.includes(o)&&(e?.[l]??[]).forEach(c=>{c&&!a.includes(c)&&a.push(c)})});let s=r?.reduce((o,l)=>a.includes(l)&&o,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:s,checkedInParticipantIds:a,...oe}}var Vn=t=>e=>{let i=Xi(e)&&e?.matchUpType||rn(e)&&e;return i&&BIe[t].includes(i)};function A0(t){let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},r=e?.map(({matchUpFormatCodes:a})=>a?.filter(s=>s===i)).flat().filter(Boolean).sort((a,s)=>(a?.length||0)-(s?.length||0))||[],n=r.includes(i)?i:r[0];return e?.find(({matchUpFormatCodes:a,averageTimes:s})=>a?.find(o=>n===o)&&s)?.averageTimes}function g0(t){let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:r}=t||{};return e?.find(({matchUpFormatCodes:n,averageTimes:a,recoveryTimes:s})=>{if(a&&i){let{greaterThan:o=0,lessThan:l=360}=a;if(i>o&&i<l)return!0}return n?.find(o=>o===r)&&s})?.recoveryTimes}function gTe({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>(a.categoryNames?.length||0)-(n.categoryNames?.length||0)).find(({categoryTypes:n,categoryNames:a})=>!a?.length&&!n?.length||a?.includes(e)||n?.includes(i))).find(Boolean)}function U7e({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:s,policy:o}){let l=e?.matchUpRecoveryTimes&&g0({...e,averageMinutes:i,matchUpFormat:n}),c=t?.matchUpRecoveryTimes&&g0({...t,averageMinutes:i,matchUpFormat:n}),u=o?.matchUpRecoveryTimes&&g0({...o,averageMinutes:i,matchUpFormat:n}),d=[l,c,u,o?.defaultTimes?.recoveryTimes,r?.recoveryTimes];return gTe({categoryName:a,categoryType:s,timesBlockArray:d})}function T7e({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:s}){let o=a?.matchUpAverageTimes&&A0({...a,matchUpFormat:t}),l=n?.matchUpAverageTimes&&A0({...n,matchUpFormat:t}),c=s?.matchUpAverageTimes&&A0({...s,matchUpFormat:t}),u=[o,l,c,s?.defaultTimes?.averageTimes,r?.averageTimes];return gTe({categoryName:e,categoryType:i,timesBlockArray:u})}var vTe="DOUBLES_SINGLES",yTe="SINGLES_DOUBLES",dd="total",H4="participantConflict",YA="matchUpConflict",bTe="ISSUE_IDS",Pv="CONFLICT",Rv="WARNING",V4="ERROR",G4="ISSUE",qk="STATE",C7e="BLOCKED",E7e="PRACTICE",D7e="MAINTENANCE",P7e={SINGLES_DOUBLES:yTe,DOUBLES_SINGLES:vTe,TOTAL:dd,CONFLICT_MATCHUP_ORDER:YA,CONFLICT_PARTICIPANTS:H4,SCHEDULE_ISSUE_IDS:bTe,SCHEDULE_CONFLICT:Pv,SCHEDULE_WARNING:Rv,SCHEDULE_ERROR:V4,SCHEDULE_ISSUE:G4,SCHEDULE_STATE:qk,BLOCKED:C7e,PRACTICE:E7e,MAINTENANCE:D7e};function OM({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:o}){if(!i)return{error:nt};s=s??o?.eventType??iw;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:c}=DM({tournamentRecord:i,categoryName:n,categoryType:a,event:o}),u={...c,matchUpFormat:r,categoryType:a,defaultTiming:l};return o$({eventType:s,timingDetails:u})}function o$({timingDetails:t,eventType:e}){let i=T7e(t),r=Object.keys(i?.minutes||{}),n=i?.minutes&&(r?.includes(e)&&i.minutes[e]||i.minutes.default),a=U7e({...t,averageMinutes:n}),s=Object.keys(a?.minutes||{}),o=a?.minutes&&(s?.includes(e)&&a.minutes[e]||a.minutes.default),l=Vn(iw)(e)?yTe:vTe,c=a?.minutes&&(s?.includes(l)&&a.minutes[l]||o);return{averageMinutes:n,recoveryMinutes:o,typeChangeRecoveryMinutes:c}}function zV(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Tb({timeItems:t,itemType:e}){let i=t.filter(n=>n&&n.itemType===e).sort((n,a)=>zV(n)-zV(a)).pop(),r=i&&zV(i);return{itemValue:i?.itemValue,timeStamp:r}}function ITe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Tb({timeItems:i?.timeItems||[],itemType:fS});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledTime:r}:e}function mS({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Tb({timeItems:i?.timeItems||[],itemType:pS});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledDate:r}:e}function jb(t){if(gSe.test(t)){let e=iY();return new Date(`${e}T${t}`)}else return new Date(t)}function R7e({matchUp:t}){if(!t)return{error:Zo};if(!t.timeItems)return{error:Q8};let e=t.timeItems.filter(r=>[zd,Tm,oh,Zm].includes(r?.itemType)).sort((r,n)=>jb(r.itemValue).getTime()-jb(n.itemValue).getTime()),i=e.reduce((r,n)=>{let a,s=n?.itemType?.split("."),o=`SCHEDULE.TIME.${n?.itemType?.startsWith("SCHEDULE.TIME")&&s[2]}`;switch(o){case zd:a=0;break;case Zm:if(r.lastValue&&[zd,oh].includes(r.lastType)){let l=jb(n.itemValue).getTime()-jb(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;case Tm:if([zd,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let l=jb(n.itemValue).getTime()-jb(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;default:a=r.milliseconds;break}return{milliseconds:a,lastType:o,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([zd,oh].includes(i.lastType)){let r=new Date().getTime()-jb(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:M7e(i.milliseconds),relevantTimeItems:e}}function M7e(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function N7e({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:e.reduce((r,n)=>{let a=n.itemType===zd&&n;return a&&(!r||i(a)<i(r))?a:r},void 0)?.itemValue}}function FM(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:we};let n=Cu(t);i.venueId||(i.venueId=hr());let a;for(let s of Object.values(n)){let o=B7e({disableNotice:!0,tournamentRecord:s,context:r,venue:i});if(o?.error)return o;a=o.venue}return e||Ii({topic:$Ue,payload:{venue:i}}),Lt({...oe,venue:a})}function B7e({tournamentRecord:t,disableNotice:e,context:i,venue:r}){return t?r?(t.venues||(t.venues=[]),r.venueId||(r.venueId=hr()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0)?{error:Fwe}:(i&&ur({element:r,extension:{value:i,name:UUe}}),t.venues.push(r),{...oe,venue:Dt(r)})):{error:Yt,info:"missing venue"}:{error:nt}}function qh({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:nt};if(!i)return{error:ev};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(SM({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let s=t[a],o=qh({tournamentRecord:s,venueId:i});if(o.success&&o.venue)return FM({tournamentRecord:e,venue:o.venue}),{...oe,venue:r}}}return r?{...oe,venue:r}:{error:vb}}function t7({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=qh({tournamentRecords:i,tournamentRecord:r,venueId:n});return Dt(a,t,!0)}function ov({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:nt};if(!i)return{error:eS};let r="findCourt",n,a;if((e.venues??[]).forEach(s=>{(s.courts??[]).forEach(o=>{o.courtId===i&&(n=o,a=s)})}),n)return{...oe,court:n,venue:a};if(t){let s=(SM({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let o of s){let l=t[o],c=ov({tournamentRecord:l,courtId:i});if(c.success)return c.venue&&FM({tournamentRecord:e,venue:c.venue}),{...oe,court:n,venue:a}}}return ce({result:{error:Gm},stack:r})}function i7(t){return Dt(ov(t),!1,!0)}function l$({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:nt};if(!i)return{error:eS};let r=ov({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:h,notes:m})=>({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:h,notes:m}))(r.court);return{...oe,courtInfo:Dt(n,!1,e)}}function eC(t){let e=Qt(t,[{[Ua]:!0},{venueId:!0,[cd]:ev}]);if(e.error)return e;let{tournamentRecord:i,venueId:r}=t,n=qh({tournamentRecord:i,venueId:r});if(n.error)return n;let a=(n.venue?.courts??[]).map(l=>(({courtInfo:c})=>({...c}))(l$({courtId:l.courtId,internalUse:!0,tournamentRecord:i}))),s=n.venue&&(({venueId:l,venueName:c,venueAbbreviation:u})=>({venueAbbreviation:u,venueName:c,venueId:l}))(n.venue),o=s&&{...s,courtsInfo:a};return{...oe,venueData:Dt(o,!1,!0)}}function k7e({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:e.reduce((r,n)=>{let a=n.itemType===Zm&&n;return a&&(!r||i(a)>i(r))?a:r},void 0)?.itemValue}}function kn({event:t,eventId:e}){if(!t)return{error:Gr};let i=ki({name:Ud,element:t})?.extension,r=e?Dt(i?.value,!1,!0):i?.value;return e&&t.drawDefinitions?.forEach(n=>{r?.flights?.forEach(a=>{a.drawId===n.drawId&&Object.assign(a,{drawDefinition:n})})}),{flightProfile:r}}function tl(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},s=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},o=Object.values(s).map(({events:c,tournamentId:u})=>(c&&c.forEach(d=>{a[d.eventId]={tournamentId:u}}),c??[])).flat(),l;if(r){let c,u=o.find(d=>{let p=(d?.drawDefinitions??[]).find(f=>f.drawId===r);if(p)c=p,l=a[d.eventId].tournamentId;else{let f=(d&&kn({event:d})?.flightProfile)?.flights?.find(h=>h.drawId===r);if(f)return l=a[d.eventId].tournamentId,{entries:f.drawEntries,drawName:f.drawName,tournamentId:l,drawId:r}}return p});if(u)return{event:u,drawDefinition:c,tournamentId:l}}if(i){let c=o.find(u=>u?.eventId===i);if(c)l=a[c.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...ce({result:{error:fu},stack:n})};return{event:c,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...ce({result:{error:Rc},context:{drawId:r,eventId:i},stack:n})}}function c$(t){let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:r,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:s,scheduleTiming:o,matchUpFormat:l,publishStatus:c,matchUp:u}=t;if(!u)return{error:Zo};if(n&&!u.matchUpType&&!t.matchUpType&&(e||a)&&u.drawId){let I=t.drawDefinition||e?.drawDefinitions?.find(S=>S.drawId===u.drawId);!I&&a&&({drawDefinition:I,event:e}=tl({drawId:u.drawId,tournamentRecord:a}));let w=u.structureId&&I?.structures?.find(({structureId:S})=>S===u.structureId);i=t.matchUpType||w?.matchUpType||I?.matchUpType||e?.eventType!==da&&e?.eventType}let{milliseconds:d,time:p}=R7e({matchUp:u}),{startTime:f}=N7e({matchUp:u}),{endTime:h}=k7e({matchUp:u}),m,{eventIds:A,drawIds:g}=r??{};if((!A||A.includes(u.eventId))&&(!g||g.includes(u.drawId))){let I=ie=>ie.createdAt?new Date(ie.createdAt).getTime():0,w=new Map,S=u.timeItems?.toSorted((ie,ue)=>I(ie)-I(ue))??[];for(let ie of S)w.set(ie.itemType,ie.itemValue);let T=w.get(ZY),D=w.get(xh),C=w.get(fS),E=w.get(s$),P=w.get(pS),R=w.get(JY),M=w.get(a$),N=w.get(dS),k=w.get(Eg),O,x,F,_,V,G=u.matchUpType??i;if(o&&C&&n&&G){let ie={matchUpFormat:u.matchUpFormat??l,...o};({averageMinutes:x=0,recoveryMinutes:F=0,typeChangeRecoveryMinutes:_=0}=o$({timingDetails:ie,eventType:G})),(x||F)&&(O=h?gl(Kr(h),F):gl(C,x+F)),_&&(V=h?gl(Kr(h),_):gl(C,x+_))}!P&&C&&(P=Ui(C));let z=T_({scheduledDate:P,scheduledTime:C}),Q={},j=(a&&N&&eC({tournamentRecord:a,venueId:N}))?.venueData||{};N&&(Q[N]=j);let{venueName:W,venueAbbreviation:Y,courtsInfo:X}=j,J=(k&&X?.find(ie=>ie.courtId===k))?.courtName;for(let ie of D||[]){if(!a)break;ie.venueId&&!Q[ie.venueid]&&(Q[ie.venueId]=eC({venueId:ie.venueId,tournamentRecord:a})?.venueData);let ue=Q[ie.venueId];ie.venueName=ue?.venueName;let ne=ue?.courtsInfo?.find(ge=>ge.courtId===ie.courtId);ie.courtName=ne?.courtName}m=Lt({typeChangeTimeAfterRecovery:V,timeAfterRecovery:O,scheduledDate:P,scheduledTime:C,isoDateString:z,homeParticipantId:T,venueAbbreviation:Y,allocatedCourts:D,timeModifiers:E,venueName:W,venueId:N,courtOrder:M,courtName:J,courtId:k,official:R,typeChangeRecoveryMinutes:_,recoveryMinutes:F,averageMinutes:x,milliseconds:d,startTime:f,endTime:h,time:p})}else m=Lt({milliseconds:d,startTime:f,endTime:h,time:p});let{scheduledDate:v}=mS({matchUp:u}),{scheduledTime:b}=ITe({matchUp:u});if(s&&c?.displaySettings?.draws){let I=c.displaySettings.draws,w=(I?.[u.drawId]??I?.default)?.scheduleDetails;if(w){let S=(w.find(T=>v&&T.dates?.includes(v))??w.find(T=>!T.dates?.length))?.attributes;if(S){let T=Object.assign({},...Object.keys(m).map(D=>({[D]:!0})),S);m=nw({source:m,template:T})}}}let y=u.matchUpStatus&&ta.includes(u.matchUpStatus)&&(Ui(h)||Ui(v)||Ui(b))||void 0;return{schedule:m,endDate:y}}function x7e({drawPositions:t,roundProfile:e,roundNumber:i}){let r=[void 0,void 0];if($Ie(t))return{orderedDrawPositions:r,displayOrder:r};let n=e?.[i],a=n?.pairedDrawPositions?.find(o=>_o(o||[],t.filter(Boolean)))??r,s=n?.feedRound;if(LIe(t)){let o=[...t].sort(ua);return{orderedDrawPositions:o.length===2?o:a,displayOrder:s?o:a}}if(s){let o=[t.find(l=>!isNaN(ci(l))),void 0];return{orderedDrawPositions:o,displayOrder:o}}return{orderedDrawPositions:a,displayOrder:a}}function __({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=o=>o===void 0?-1:o,s=i.map(o=>{let{collectionAssignments:l,participantId:c}=o,u=l?.find(d=>d.collectionPosition===t&&d.collectionId===e);return u&&{participantId:c,...u}}).filter(Boolean).sort((o,l)=>a(o.substitutionOrder)-a(l.substitutionOrder));for(let o of s){let{participantId:l,previousParticipantId:c,substitutionOrder:u}=o;r.includes(l)||(c&&n.push({previousParticipantId:c,substitutionOrder:u,participantId:l}),r=r.filter(d=>d!==c),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function Cd({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:nt};if(!Array.isArray(i)||i.length>2)return{error:Ll};if(!i.length)return ce({result:{error:Jg},stack:r});t=t??e?.participants??[];let n=t.filter(o=>o.participantType===Ni&&Mn(i,o.individualParticipantIds).length===i.length&&o.individualParticipantIds.length===i.length),a=n[0];if(!a)return ce({result:{error:Fn},stack:r});let s=Dt(n.slice(1),!1,!0);return{participant:Dt(a),duplicatedPairParticipants:s,...oe}}function Hy({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:kt};if(typeof e!="string")return{error:ba};let{extension:i}=ki({element:t,name:qm});return{lineUp:(i?.value||{})[e]}}function _7e({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:s,sideLineUps:o,matchUpType:l}){if(!s||!i)return{};let c=({attribute:d,lineUp:p,teamParticipant:f})=>{let{assignedParticipantIds:h,substitutions:m}=__({collectionPosition:i,collectionId:s,lineUp:p});if(l===br){if(h?.length<=2){let A=n?.[h[0]]?.pairIdMap?.[h[1]],g=(A&&n[A]?.participant||Cd({participantIds:h,tournamentParticipants:t}).participant)?.participantId;return{[d]:{participantId:g,teamParticipant:f,substitutions:m}}}else if(h?.length>2)return{[d]:{teamParticipant:f,substitutions:m}}}else{let A=h?.[0];return A&&{[d]:{participantId:A,teamParticipant:f,substitutions:m}}}};if(!r?.length){let d=o?.map(p=>{let{teamParticipant:f,sideNumber:h}=p,m=p.lineUp||Hy({participantId:f.teamParticipantId,drawDefinition:a})?.lineUp;return c({attribute:h,lineUp:m,teamParticipant:f})}).filter(Boolean)||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let u=r?.map(d=>{let p=e.find(A=>A.drawPosition===d)?.participantId,f=o?.find(A=>A?.drawPosition===d),h=f?.teamParticipant||p&&n?.[p]?.participant||t?.find(({participantId:A})=>A===p),m=f?.lineUp||Hy({participantId:p,drawDefinition:a})?.lineUp;return c({attribute:d,lineUp:m,teamParticipant:h})}).filter(Boolean)||{};return{drawPositionCollectionAssignment:Object.assign({},...u)}}function u$(t){let e=Qt(t,[{[Qh]:!0}]);if(e.error)return e;let i=t?.matchUp,r=i?.matchUpType;if(!r&&i?.sides?.length){let n=i.sides.find(({participant:a})=>a)?.participant?.participantType;r=n===Wi&&Dr||n===Ni&&br||n===vr&&vr||void 0}return{matchUpType:r}}function O7e({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:s,sideNumber:o}){let l=i.find(f=>f.drawPosition&&f.drawPosition===a),c=a&&t,u=o&&e,d=c?c[a]?.participantId:l?.participantId,p=l?F7e({displaySideNumber:r,seedAssignments:n,participantId:d,assignment:l,sideNumber:o}):{...u?.[o]};if(s&&(o===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&c){let f=c[a]?.teamParticipant,h=c[a]?.participant,m=c[a]?.substitutions;h&&(p.participant=h),m&&(p.substitutions=m),f&&(p.teamParticipant=f)}return p}function F7e({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let s=L7e({seedAssignments:e,participantId:i});Object.assign(a,s,{participantId:i}),s?.seedNumber&&s?.seedValue===""&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function L7e({seedAssignments:t,participantId:e}){return t?.find(i=>!i.seedProxy&&i.participantId===e)}function wTe({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:s,initialRoundOfPlay:o,additionalContext:l,roundNamingProfile:c,tournamentRecord:u,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:f,seedAssignments:h,usePublishState:m,participantMap:A,contextContent:g,scheduleTiming:v,contextProfile:b,drawDefinition:y,publishStatus:I,scoringActive:w,matchUpTieId:S,isRoundRobin:T,roundProfile:D,sideLineUps:C,structure:E,context:P,matchUp:R,event:M}){l=l??{};let N=po({drawDefinition:y,structure:E,matchUp:R,event:M})?.tieFormat,{roundOffset:k,structureId:O,structureName:x,stage:F,stageSequence:_}=E,{drawId:V,drawName:G,drawType:z}=y??{},Q=N?.collectionDefinitions,j=R.collectionId&&Q?.find(pe=>pe.collectionId===R.collectionId),W=R.collectionId?j?.matchUpFormat:R.matchUpFormat??E?.matchUpFormat??y?.matchUpFormat??M?.matchUpFormat,Y=R.matchUpType||j?.matchUpType||E?.matchUpType||y?.matchUpType||!Vn(da)(M?.eventType)&&M?.eventType,X=f?"BYE":R.matchUpStatus,{schedule:J,endDate:ie}=c$({scheduleVisibilityFilters:t,afterRecoveryTimes:s,tournamentRecord:u,usePublishState:m,scheduleTiming:v,drawDefinition:y,matchUpFormat:W,publishStatus:I,matchUpType:Y,matchUp:R,event:M}),ue=d??R.drawPositions??[],{collectionPosition:ne,collectionId:ge,roundPosition:he}=R,Ie=R.roundNumber??l.roundNumber,xe=ge?_7e({tournamentParticipants:i,positionAssignments:r,collectionPosition:ne,participantMap:A,drawDefinition:y,drawPositions:ue,collectionId:ge,sideLineUps:C,matchUpType:Y}):void 0,Je=c?.[Ie]?.roundName||l.roundName,qe=c?.[Ie]?.abbreviatedRoundName||l.abbreviatedRoundName,dt=D?.[Ie]?.feedRound,ft=D?.[Ie]?.preFeedRound,je=D?.[Ie]?.roundFactor,Tt=n?.[Ie],Oe=he?Tt?.[he]:void 0,mt=e?.[Ie],Le=j?.category?{...P?.category,...j.category}:P?.category??M?.category,lt=R.processCodes?.length&&R.processCodes||j?.processCodes?.length&&j?.processCodes||E?.processCodes?.length&&E?.processCodes||y?.processCodes?.length&&y?.processCodes||M?.processCodes?.length&&M?.processCodes||u?.processCodes,it=b?.withCompetitiveness&&_M({...g,matchUp:R}),Fe=R.finishingPositionRange??l.finishingPositionRange,Xe=F!==qt&&wi(o)&&o+(Ie||0),ct=pe=>Lt(pe,void 0,!0),We={...ct(P),...ct({matchUpFormat:Y===da?void 0:W,tieFormat:Y===da?N:void 0,gender:j?.gender??M?.gender,endDate:R.endDate??ie,discipline:M?.discipline,category:Le,finishingPositionRange:Fe,abbreviatedRoundName:qe,drawPositionsRange:Oe,competitiveProfile:it,structureName:x,stageSequence:_,drawPositions:ue,matchUpStatus:X,processCodes:lt,isRoundRobin:T,matchUpTieId:S,preFeedRound:ft,matchUpType:Y,roundFactor:je,roundOffset:k,structureId:O,roundNumber:Ie,roundOfPlay:Xe,feedRound:dt,roundName:Je,drawName:G,drawType:z,schedule:J,drawId:V,stage:F}),...Dt(ct(R),!0,!0)};if(W&&R.score?.scoreStringSide1){let pe=ys(W),{bestOf:Se,finalSetFormat:ye,setFormat:ke}=pe??{};(ye?.tiebreakSet||ke?.tiebreakSet||ke?.timed)&&(We.score.sets=We.score.sets.sort((Ce,Ke)=>Ce.setNumber-Ke.setNumber).map((Ce,Ke)=>{let _e=Ke+1===Se&&ye?ye:ke,wt=_e?.tiebreakSet&&!_e?.timed,ut=_e?.timed;return wt?(Ce.tiebreakSet=!0,[1,2].includes(Ce.winningSide)&&(Ce.side1Score=Ce.winningSide===1?1:0,Ce.side2Score=Ce.winningSide===2?1:0)):ut&&(Ce.timed=!0),Ce}))}if(Array.isArray(ue)){let{orderedDrawPositions:pe,displayOrder:Se}=x7e({drawPositions:ue,roundProfile:D,roundNumber:Ie}),ye=D?.[Ie]?.feedRound,ke=Se[0]!==pe[0],Ce=pe.concat(void 0,void 0).slice(0,2).map((Ke,_e)=>{let wt=_e+1,ut=ke?3-wt:wt,Ct=O7e({...xe,positionAssignments:r,displaySideNumber:ut,seedAssignments:h,drawPosition:Ke,isFeedRound:ye,sideNumber:wt}),Gi=R.sides?.find($i=>$i.sideNumber===wt),Wt=he?(he-1)*2+_e+1:void 0,Ji=Wt?mt?.[Wt]:void 0;return ct({sourceDrawPositionRange:Ji,...Gi,...Ct})});Object.assign(We,Dt({sides:Ce},!0,!0))}if(i&&We.sides){let pe=p?.[vE],Se=ye=>{let ke=A?.[ye]?.participant;return ke&&nw({template:pe?.participant,source:ke})};if(We.sides.filter(Boolean).forEach(ye=>{if(ye.participantId){let ke=Dt(Se(ye.participantId)||(i?Sg({policyDefinitions:p,participantId:ye.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:b}):void 0),void 0,!0);if(ke){let Ce,Ke;if(y?.entries){let _e=y.entries.find(ut=>ut.participantId===ye.participantId),wt=M?.entries?.find(ut=>ut.participantId===ye.participantId);Ce=_e?.entryStatus||wt?.entryStatus,ke.entryStatus=Ce,_e?.entryStage&&(Ke=_e.entryStage,ke.entryStage=Ke)}a===!1?Object.assign(ye,{participant:{entryStage:Ke,entryStatus:Ce}}):Object.assign(ye,{participant:ke})}}if(ye?.participant?.individualParticipantIds?.length&&!ye.participant.individualParticipants?.length){let ke=ye.participant.individualParticipantIds.map(Ce=>Se(Ce)||(i?Sg({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:b,participantId:Ce}):void 0));a!==!1&&Object.assign(ye.participant,{individualParticipants:ke})}}),!We.matchUpType){let{matchUpType:ye}=u$({matchUp:We});ye&&Object.assign(We,{matchUpType:ye})}if(b?.inferGender&&(!We.gender||We.gender===aS)&&We.sides?.length===2&&We.matchUpType!==da){let ye=We.sides.map(ke=>{if(Vn(Dr)(We.matchUpType))return ke.participant?.person?.sex;if(ke.participant?.individualParticipants?.length===2){let Ce=Ei(ke.participant.individualParticipants.map(Ke=>Ke.person?.sex)).filter(Boolean);if(Ce.length===1)return Ce[0]}});if(ye.filter(Boolean).length===2&&Ei(ye).length===1){let ke=ye[0];We.inferredGender=ke}}}if(We.tieMatchUps){let pe=We.matchUpStatus==="BYE",Se=We.sides?.map(({participant:ye,drawPosition:ke,sideNumber:Ce,lineUp:Ke})=>{let _e=ye?.participantType===da&&ye;return{teamParticipant:_e&&Lt({participantRoleResponsibilities:_e.participantRoleResponsibilities,participantOtherName:_e.participanOthertName,participantName:_e.participantName,participantId:_e.participantId,teamId:_e.teamId}),drawPosition:ke,sideNumber:Ce,lineUp:Ke}});We.tieMatchUps=We.tieMatchUps.map(ye=>{let ke=We.matchUpId,Ce={finishingPositionRange:We.finishingPositionRange,abbreviatedRoundName:qe,roundNumber:Ie,roundName:Je};return wTe({tieDrawPositions:ue,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:Se,drawPositionsRanges:n,initialRoundOfPlay:o,roundNamingProfile:c,additionalContext:Ce,appliedPolicies:p,isCollectionBye:pe,usePublishState:m,publishStatus:I,matchUpTieId:ke,isRoundRobin:T,roundProfile:D,matchUp:ye,event:M,tournamentParticipants:i,positionAssignments:r,tournamentRecord:u,seedAssignments:h,participantMap:A,contextContent:g,scheduleTiming:v,contextProfile:b,drawDefinition:y,scoringActive:w,structure:E,context:P})})}let ht=We.sides?.filter(pe=>pe?.participantId).length===2,xt=!We.winningSide;if(Object.assign(We,{readyToScore:w&&ht&&xt,hasContext:!0}),ht){let{allParticipantsCheckedIn:pe,checkedInParticipantIds:Se}=hS({matchUp:We});Object.assign(We,{allParticipantsCheckedIn:pe,checkedInParticipantIds:Se})}return Array.isArray(b?.exclude)&&b?.exclude.forEach(pe=>delete We[pe]),We}function $7e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Tb({timeItems:i?.timeItems||[],itemType:xh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{allocatedCourts:Dt(r,!1,!0)}:e}function H7e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Tb({timeItems:i?.timeItems||[],itemType:Eg});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{courtId:r}:e}function V7e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Tb({timeItems:i?.timeItems||[],itemType:dS});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{venueId:r}:e}function vm(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:s,matchUpFormats:o,roundPositions:l,matchUpFormat:c,collectionIds:u,isMatchUpTie:d,roundNumbers:p,matchUpIds:f,roundNames:h,filterMatchUpTypes:m=!0,filterMatchUpIds:A=!0,stageSequences:g,scheduledDates:v,scheduledDate:b,participantIds:y,processContext:I,tournamentIds:w,matchUpTypes:S,structureIds:T,readyToScore:D,courtIds:C,eventIds:E,venueIds:P,drawIds:R,stages:M}=t,N=Array.isArray(y)?y.filter(Boolean):[],k=Array.isArray(a)?a.filter(Boolean):[],O=Array.isArray(i)?i.filter(Boolean):[],x=Array.isArray(M)?M.filter(Boolean):[],F=Array.isArray(g)?g.filter(Boolean):[],_=Array.isArray(u)?u.filter(Boolean):[],V=Array.isArray(h)?h.filter(Boolean):[],G=Array.isArray(p)?p.filter(Boolean):[],z=Array.isArray(l)?l.filter(Boolean):[],Q=Array.isArray(f)&&A?f.filter(Boolean):[],j=Array.isArray(S)&&m?S.filter(Boolean):[],W=Array.isArray(C)?C.filter(Boolean):[],Y=Array.isArray(P)?P.filter(Boolean):[],X=Array.isArray(o)&&o.filter(Boolean)||typeof c=="string"&&[c]||[],J=Array.isArray(v)&&v.filter(Boolean)||typeof b=="string"&&b.length&&[b]||[],ie=Array.isArray(w)?w.filter(Boolean):[],ue=Array.isArray(E)?E.filter(Boolean):[],ne=Array.isArray(R)?R.filter(Boolean):[],ge=Array.isArray(T)?T.filter(Boolean):[];return e.filter(he=>{if(D&&!Vn(Pc)(he)&&!he.readyToScore||he.winningSide&&s&&![1,2].includes(he.winningSide)||d!==void 0&&(d&&!he.tieMatchUps||!d&&he.tieMatchUps)||n!==void 0&&(n&&!he.collectionId||!n&&he.collectionId)||x.length&&!x.includes(he.stage)||F.length&&!F.includes(he.stageSequence)||_.length&&(!he.collectionId||!_.includes(he.collectionId))||V.length&&(!he.roundName||!V.includes(he.roundName))||G.length&&(!he.roundNumber||!G.includes(he.roundNumber))||z.length&&(!he.roundPosition||!z.includes(he.roundPosition))||k.length&&(!he.matchUpStatus||!k.includes(he.matchUpStatus))||O.length&&he.matchUpStatus&&O.includes(he.matchUpStatus)||Q.length&&!Q.includes(he.matchUpId)||j.length&&(!he.matchUpType||!g2(j,he.matchUpType))||X.length&&(!he.matchUpFormat||!X.includes(he.matchUpFormat)))return!1;if(J?.length){let{scheduledTime:Ie}=ITe({matchUp:he}),{scheduledDate:xe}=mS({matchUp:he}),Je=Ui(Ie)||xe;if(!J.find(qe=>Eh(qe,Je)))return!1}if(W.length){let{courtId:Ie}=H7e({matchUp:he}),{allocatedCourts:xe}=$7e({matchUp:he}),Je=xe?.map(({courtId:qe})=>qe);if(!W.filter(Boolean).includes(Ie)||Je?.includes(Ie))return!1}if(Y.length){let{venueId:Ie}=V7e({matchUp:he});if(!Y.filter(Boolean).includes(Ie))return!1}if(I){if(ie.length&&!ie.includes(he.tournamentId)||ue.length&&!ue.includes(he.eventId)||ne.length&&!ne.includes(he.drawId)||ge.length&&!ge.includes(he.structureId))return!1;let Ie=he.sides?.map(({participantId:xe})=>xe).filter(Boolean)??[];if(r&&Ie.length<r||N.length&&!N.some(xe=>Ie.includes(xe)))return!1}return!0})}function dr(t){let{provisionalPositioning:e,tournamentRecord:i,contextFilters:r,matchUpFilters:n,contextProfile:a,drawDefinition:s,context:o={},structure:l,inContext:c,event:u}=t,{seedAssignments:d,contextContent:p,exitProfiles:f,matchUpsMap:h}=t,m={},A={};if(!l)return{collectionPositionMatchUps:m,error:Ab,roundMatchUps:A,matchUps:[]};let g=Array.isArray(n?.eventIds)?n?.eventIds.filter(Boolean):[],v=Array.isArray(n?.structureIds)?n?.structureIds.filter(Boolean):[],b=Array.isArray(n?.drawIds)?n?.drawIds.filter(Boolean):[],y=!o?.eventId||!g?.length&&!r?.eventIds?.filter(Boolean).length||g?.includes(o.eventId)||r?.eventIds?.includes(o.eventId),I=!v?.length||v.includes(l.structureId),w=!s||!b?.length||b.includes(s.drawId);if(!y||!I||!w)return{collectionPositionMatchUps:m,roundMatchUps:A,matchUps:[]};a&&!p&&(p=bA({tournamentRecord:i,contextProfile:a,drawDefinition:s}));let{appliedPolicies:S}=tr({drawDefinition:s}),T={...t.tournamentAppliedPolicies,...S,...t.policyDefinitions},D=T?.scoring?.structures,C=l.stage&&D?.stage?.[l.stage],E=l.stageSequence&&C?.stageSequence?.[l.stageSequence],P=T?.scoring?.requireAllPositionsAssigned||C?.requireAllPositionsAssigned||E?.requireAllPositionsAssigned;h||(h=os({drawDefinition:s,structure:l}));let{positionAssignments:R,allPositionsAssigned:M}=Ia({structure:l}),N=!P||M,{seedAssignments:k}=Au({provisionalPositioning:e,drawDefinition:s,structure:l});d=d??k;let{structureId:O}=l;f=f||s&&rTe({drawDefinition:s}).exitProfiles;let x=f?.[O],F=x?.length&&(x[0].split("-").map(W=>parseInt(W)).reduce((W,Y)=>W+Y)||0),_=!!l.structures,V=Cg({matchUpsMap:h,structureId:O,inContext:c}),G=T?.[zm],z=nTe({roundNamingPolicy:G,drawDefinition:s,structure:l,matchUps:V}),{roundNamingProfile:Q,roundProfile:j}=z;if(A=z?.roundMatchUps??[],n&&(V=vm({matchUps:V,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),c){let{sourceDrawPositionRanges:W}=o7e({drawDefinition:s,matchUpsMap:h,structureId:O}),Y=s?l7e({drawDefinition:s,roundProfile:j,matchUpsMap:h,structureId:O}).drawPositionsRanges:void 0,X=t.tournamentParticipants,J=t.participantMap;!X?.length&&!J&&i&&({participants:X=[],participantMap:J}=Ib({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:i,contextProfile:a,inContext:c})),V=V.map(ie=>wTe({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:W,tournamentParticipants:X,positionAssignments:R,drawPositionsRanges:Y,initialRoundOfPlay:F,roundNamingProfile:Q,tournamentRecord:i,appliedPolicies:T,seedAssignments:d,contextContent:p,participantMap:J,contextProfile:a,drawDefinition:s,scoringActive:N,isRoundRobin:_,roundProfile:j,structure:l,context:o,matchUp:ie,event:u})),(V?.filter(ie=>Array.isArray(ie.tieMatchUps))).forEach(ie=>{let ue=ie.tieMatchUps;V=V.concat(...ue)}),r&&(V=vm({processContext:!0,...r,matchUps:V}))}else(V?.filter(W=>Array.isArray(W.tieMatchUps))).forEach(W=>{let Y=W.tieMatchUps;V=V.concat(...Y)});return n&&(V=vm({matchUps:V,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(n?.matchUpTypes||n?.matchUpIds)&&(V=vm({matchUpTypes:n.matchUpTypes,matchUpIds:n.matchUpIds,matchUps:V})),(n?.matchUpTypes||n?.matchUpIds||c)&&(A=Oo({matchUps:V}).roundMatchUps??[]),po({drawDefinition:s,structure:l,event:u})?.tieFormat&&({collectionPositionMatchUps:m}=a7e({matchUps:V})),{collectionPositionMatchUps:m,roundMatchUps:A,isRoundRobin:_,roundProfile:j,matchUpsMap:h,matchUps:V}}function oy({matchUp:t}){return t?ta.includes(t?.matchUpStatus)||t?.winningSide:!1}function d$({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:c,contextFilters:u,contextContent:d,participantMap:p,scheduleTiming:f,publishStatus:h,contextProfile:m,drawDefinition:A,exitProfiles:g,matchUpsMap:v,structureId:b,inContext:y,structure:I,context:w,event:S}){!I&&b&&({structure:I}=di({drawDefinition:A,structureId:b}));let T=dr({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:c,contextFilters:u,contextContent:d,participantMap:p,scheduleTiming:f,publishStatus:h,contextProfile:m,drawDefinition:A,exitProfiles:g,matchUpsMap:v,structure:I,inContext:y,context:w,event:S}),D=[],C=[],E=[],P=[],R=[];if(T.error)return T;let{matchUps:M}=T,{assignedPositions:N}=Ia({structure:I}),k=N?.filter(x=>x.participantId).map(x=>x.drawPosition),O;return M.filter(x=>{let F=c?.matchUpTypes?.length===1&&c.matchUpTypes[0]===Hr;return!(x.matchUpType!==Hr&&F)}).forEach(x=>{if(x.matchUpStatus===tc){D.push(x);return}x.matchUpType===Hr&&(O=!0);let F=!!x.collectionId,_=F&&x.sides?.every(W=>W.participantId),V=!F&&x.drawPositions?.filter(Boolean).length===2,G=!F&&x.drawPositions?.every(W=>k?.includes(W)),z=N?.filter(W=>W.bye).map(W=>W.drawPosition),Q=!F&&x.drawPositions?.find(W=>z?.includes(W)),j=OUe.includes(x.matchUpStatus)&&(_||V&&(!t||G));return Q?R.push(x):oy({matchUp:x})?C.push(x):j?E.push(x):P.push(x)}),{includesTeamMatchUps:O,abandonedMatchUps:D,completedMatchUps:C,upcomingMatchUps:E,pendingMatchUps:P,byeMatchUps:R,structure:I}}function G7e({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:kt};if(!i)return{error:Fc};let{links:r}=wE({drawDefinition:t,structureId:i}),n=r.source.reduce((s,o)=>!o.source.roundNumber||o.source.roundNumber===e?s.concat(o):s,[]),a=r.target.reduce((s,o)=>!o.target.roundNumber||o.target.roundNumber===e?s.concat(o):s,[]);return{links:{source:n,target:a}}}function qV({finishingPositions:t,linkCondition:e,linkType:i,source:r}){let n=r.find(a=>{let s=!a.source?.finishingPositions||!t||_o(t,a.source?.finishingPositions);return e===a.linkCondition&&s&&a.linkType===i});return[Ph,Rh].includes(n?.linkType)&&!n?.source?.roundNumber?ce({result:{error:we},stack:"getTargetLink",context:n}):n}function wE({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>(n.source?.structureId===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),n.target?.structureId===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r),{source:[],target:[]})}:{error:Fc}:{error:kt}}function Q7e({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(s=>s.roundNumber===i&&!s.matchUpTieId),a=t.filter(s=>s.roundNumber===i+1&&!s.matchUpTieId);if(a.length){let s;return a.length===n.length?s=a.find(o=>o.roundPosition===r):a.length===n.length/2&&(s=a.find(o=>o.roundPosition===Math.ceil(r/2))),{matchUp:s}}return{message:"no progression found"}}function WV({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){if(!n)return{error:C8};let{target:{structureId:a,feedProfile:s,groupedOrder:o,roundNumber:l,positionInterleave:c}}=n,{structure:u}=di({drawDefinition:r,structureId:a}),{positionAssignments:d}=wr({structure:u}),p=(e?.filter(D=>D.structureId===u?.structureId)).filter(D=>D.roundNumber===l&&!D.matchUpTieId),f=p.length,h=vt(1,f+1),m=f/t,A=Math.ceil(m*i),g=1-i%2;if(c?.interleave&&m!==.5){let D=c.offset+(i-1)*c.interleave,C=i+D;A=Math.ceil(C/2),g=1-C%2}let v=h,b=h[A-1],y=iTe({roundPositionsCount:h.length,groupedOrder:o}),I=y?.length||1;if(I<=h.length){let D=f/I,C=$a(h,D);s===Oy&&C.forEach(E=>E.reverse()),v=y?.length&&y?.map(E=>C[E-1]).flat()||v}s===Ju?b=v[A-1]:s===Oy?((!y?.length||I>h.length)&&(A=p.length+1-A),b=v[A-1]):s===L2&&Mc()&&console.log(q8,{feedProfile:s});let w=b&&p.reduce((D,C)=>C.roundPosition===b?C:D,void 0),S;w?.feedRound?(g=0,S=Math.min(...(w.drawPositions||[]).filter(Boolean))):S=w?.drawPositions?.length===2&&w?.drawPositions[g];let T=d?.find(({drawPosition:D})=>D===S);if(T){let{extension:D}=ki({element:T,name:Y2});if(D?.value)return{disabledDrawPosition:S}}return{matchUp:w,targetDrawPosition:S,matchUpDrawPositionIndex:g}}function Fo({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(o=>o.matchUpId===n));let{structure:s}=di({structureId:a?.structureId,drawDefinition:r});return s?.finishingPosition===oS?j7e({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:s,matchUp:a}):z7e({matchUp:a})}function j7e({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){let{winnerMatchUpId:a,loserMatchUpId:s}=n,{links:o}=G7e({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),l=o?.source,c=qV({source:l,linkType:Ph}),u=qV({linkCondition:Af,linkType:Rh,source:l}),d=qV({source:l,linkType:Rh}),p=u&&d;d||(d=u);let f=c?.target?.feedProfile,h=d?.target?.feedProfile,m=u?.target?.feedProfile,A,g,v,b,y,I,w,S,T,D;if(e&&(a||s)&&(w=a&&f!==jd&&t.find(({matchUpId:P})=>P===a),b=s&&h!==jd&&t.find(({matchUpId:P})=>P===s),w||b))return{matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:c},targetMatchUps:{loserMatchUp:b,winnerMatchUp:w}};let{roundPosition:C}=n;D=D||t.filter(P=>P.structureId===r.structureId);let E=D.reduce((P,R)=>R.roundNumber===n.roundNumber&&!R.matchUpTieId?P+1:P,0);return d&&!b&&h!==jd&&({matchUpDrawPositionIndex:I,targetDrawPosition:y,matchUp:b}=WV({targetLink:d,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:C,drawDefinition:i})),p&&m!==jd&&({matchUpDrawPositionIndex:v,targetDrawPosition:g,matchUp:A}=WV({targetLink:u,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:C,drawDefinition:i})),c&&!w&&f!==jd&&({matchUpDrawPositionIndex:T,targetDrawPosition:S,matchUp:w}=WV({targetLink:c,sourceRoundMatchUpCount:E,inContextDrawMatchUps:t,sourceRoundPosition:C,drawDefinition:i})),w||(D=D||t.filter(P=>P.structureId===r.structureId),{matchUp:w}=Q7e({structureMatchUps:D,matchUp:n})),Lt({matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:c,byeTargetLink:u},targetMatchUps:{winnerMatchUpDrawPositionIndex:T,loserMatchUpDrawPositionIndex:I,byeMatchUpDrawPositionIndex:v,winnerTargetDrawPosition:S,loserTargetDrawPosition:y,byeTargetDrawPosition:g,winnerMatchUp:w,loserMatchUp:b,byeMatchUp:A},targetMatchUpIds:!!(a||s)})}function z7e({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function q7e({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{let{matchUpId:n,structureId:a,drawPositions:s=[]}=r,{structure:o}=di({drawDefinition:t,structureId:a});if(o?.finishingPosition===Fy){let{roundNumber:l}=r,c=l&&ci(l)+1,u=o.matchUps??[],{roundMatchUps:d}=Oo({matchUps:u});if(c&&d?.[c]){let p=[...s].sort(ua).map((f,h)=>{let m=d[c].find(A=>A.drawPositions?.includes(f));return{matchUpId:m?.matchUpId,roundNumber:c,schedule:m?.schedule,sideNumber:h+1,structureName:o.structureName}});Object.assign(r,{sidesTo:p})}}else{let l=Fo({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:n}),{winnerMatchUp:c}=l.targetMatchUps,{loserMatchUp:u}=l.targetMatchUps;!r.winnerMatchUpId&&c&&(r.winnerMatchUpId=c.matchUpId),!r.loserMatchUpId&&u&&(r.loserMatchUpId=u.matchUpId);let d=KV({upcomingMatchUp:c}),p=KV({upcomingMatchUp:u});if(r.matchUpStatus!=="BYE"&&u?.matchUpStatus==="BYE"){let{matchUp:h}=STe({matchUp:u,drawDefinition:t,inContextDrawMatchUps:e})||{};p=h&&KV({upcomingMatchUp:h})||p}let f=r.schedule?.timeAfterRecovery;if(f&&(d?.schedule?.scheduledTime&&sr(d.schedule.scheduledTime)<sr(f)&&(i[d.matchUpId]=r.matchUpId,d.schedule.scheduleConflict=r.matchUpId),p?.schedule?.scheduledTime&&sr(p.schedule.scheduledTime)<sr(f)&&(i[p.matchUpId]=r.matchUpId,p.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:d,loserTo:p}),r.drawPositions?.filter(Boolean).length){let h=l.targetLinks?.loserTargetLink?.linkCondition===Af,m=W7e(r);if(m.length){let A=_4(c?.sides),g=_4(u?.sides),v=m.find(({participantId:y})=>A.includes(y))?[]:m,b=m.find(({participantId:y})=>g.includes(y))?[]:m;u&&h&&b.length<2&&b.push({bye:!0,tbd:!0}),v?.length&&c&&(!l.targetMatchUpIds&&c&&(c=e.find(({matchUpId:y})=>y===c.matchUpId)),c.potentialParticipants||(c.potentialParticipants=[]),c.potentialParticipants.push(v)),b?.length&&u&&(l.targetMatchUpIds||(c=e.find(({matchUpId:y})=>y===u.matchUpId)),u.potentialParticipants||(u.potentialParticipants=[]),u.potentialParticipants.push(b))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function W7e(t){return t?.sides?.map(({participant:e,participantId:i,qualifier:r})=>e||i&&{participantId:i}||r&&{qualifier:r}).filter(Boolean)||[]}function STe({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){let{matchUpId:r,matchUpStatus:n,structureId:a}=t||{};if(!t||!a||t?.matchUpStatus===Nn)return{matchUp:t};if(n==="BYE"){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:o})=>o===t.winnerMatchUpId):{winnerMatchUp:s}=Fo({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r})?.targetMatchUps||{},STe({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function KV(t){if(t?.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s}))(t.upcomingMatchUp)}function ia(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=SE(t);if(i.error)return ce({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:s,byeMatchUps:o,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...s??[],...o??[]),matchUpsMap:l}}function SE(t){if(!t?.drawDefinition)return{error:kt};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:s,participantsProfile:o,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:f,scheduleTiming:h,participantMap:m,publishStatus:A,contextProfile:g,drawDefinition:v,nextMatchUps:b,inContext:y,context:I,event:w}=t,S=[],T=[],D=[],C=[],E=[];g&&!i&&(i=bA({policyDefinitions:c,tournamentRecord:u,contextProfile:g,event:w}));let P;!e?.length&&u&&(e=u?.participants,(y||o?.withGroupings)&&e?.length&&({participantsWithGroupings:e,groupInfo:P}=i$({participants:e,participantsProfile:o})));let{structures:R}=Td({drawDefinition:v});if(!R)return{error:an};r||(r=os({drawDefinition:v}));let M=v&&rTe({drawDefinition:v}).exitProfiles;R.forEach(O=>{let{byeMatchUps:x=[],pendingMatchUps:F=[],upcomingMatchUps:_=[],completedMatchUps:V=[],abandonedMatchUps:G=[]}=d$({matchUpFilters:b?void 0:f,contextFilters:b?void 0:p,inContext:y||b||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:s,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:h,publishStatus:A,contextProfile:g,drawDefinition:v,exitProfiles:M,matchUpsMap:r,structure:O,context:I,event:w});S=S.concat(...G),T=T.concat(...V),D=D.concat(..._),C=C.concat(...F),E=E.concat(...x)});let N=O=>(!f&&!b&&!p||(f&&(O=vm({matchUps:O,...f})),p&&(O=vm({matchUps:O,...p,processContext:!0}))),O),k={abandonedMatchUps:N(S),completedMatchUps:N(T),upcomingMatchUps:N(D),pendingMatchUps:N(C),byeMatchUps:N(E),matchUpsMap:r,...oe,groupInfo:P};if(b){let O=typeof b=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:x,completed:F,upcoming:_,pending:V,bye:G}=O,z=[].concat(...x&&S||[],...F&&T||[],..._&&D||[],...V&&C||[],...G&&E||[]);q7e({inContextDrawMatchUps:z,drawDefinition:v})}return k}function Wh(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:h,nextMatchUps:m,inContext:A,context:g,event:v}=t;if(!v)return{error:Gr};let{eventId:b,eventName:y,endDate:I,eventType:w,category:S,gender:T,matchUpFormat:D}=v??{},C={...g,...Lt({indoorOutDoor:v.indoorOutdoor??u?.indoorOutdoor,surfaceCategory:v.surfaceCategory??u?.surfaceCategory,endDate:v.endDate??u?.endDate,tournamentId:u?.tournamentId,matchUpFormat:D,eventName:y,eventType:w,category:S,eventId:b,gender:T})};I&&(C.endDate=I),h&&!i&&(i=bA({policyDefinitions:l,tournamentRecord:u,contextProfile:h,event:v}));let E;if(!e?.length&&!r&&u){let M=Ib({participantsProfile:s,useParticipantMap:c,tournamentRecord:u,contextProfile:h,inContext:A});r=M.participantMap,e=M.participants??[],E=M.groupInfo}let P=v.drawDefinitions??[],R=DM({tournamentRecord:u,event:v}).scheduleTiming;return{matchUps:P.flatMap(M=>{let{matchUps:N}=ia({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:C,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextFilters:p,contextProfile:h,drawDefinition:M,contextContent:i,matchUpFilters:f,participantMap:r,scheduleTiming:R,nextMatchUps:m,inContext:A,event:v});return N??[]}),groupInfo:E}}function as(t){let e=Qt(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!t?.tournamentRecord)return{error:nt};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:s,useParticipantMap:o,policyDefinitions:l,tournamentRecord:c,inContext:u=!0,usePublishState:d,contextProfile:p,matchUpFilters:f,contextFilters:h,nextMatchUps:m,context:A}=t,g=t.tournamentId??c.tournamentId,v=c?.events??[];r||({participants:r,participantMap:i}=Ib({participantsProfile:a,useParticipantMap:o,tournamentRecord:c,contextProfile:p,inContext:u}));let{appliedPolicies:b}=tr({tournamentRecord:c}),y={...A,tournamentId:g,indoorOutDoor:c.indoorOutdoor,surfaceCategory:c.surfaceCategory,endDate:c.endDate},I=bA({policyDefinitions:l,tournamentRecord:c,contextProfile:p});return{matchUps:v.flatMap(w=>(y.eventDrawsCount=w.drawDefinitions?.length??0,Wh({context:y,scheduleVisibilityFilters:n,tournamentAppliedPolicies:b,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:I,contextFilters:h,contextProfile:p,matchUpFilters:f,participantMap:i,nextMatchUps:m,participants:r,inContext:u,event:w}).matchUps??[])).concat(...c.matchUps??[])}}function up({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:c}){if(typeof r!="object"||!Object.keys(r).length)return{error:bn};let u=Object.keys(r).map(d=>{let p=r[d];return as({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:p,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:c}).matchUps??[]}).flat();return{...oe,matchUps:u}}function AS(t,e){return K7e(t,e)||(t?.stageSequence||0)-(e?.stageSequence||0)||t?.roundNumber&&e.roundNumber&&t?.roundNumber-e?.roundNumber||(t?.roundPosition??0)-(e?.roundPosition??0)}function K7e(t,e){return(rw[t?.stage]||0)-(rw[e?.stage]||0)}function No(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,matchUpFilters:d,contextFilters:p,contextProfile:f,drawDefinition:h,nextMatchUps:m,inContext:A,context:g,event:v}=t,{eventId:b,eventName:y,endDate:I,eventType:w,category:S,gender:T,matchUpFormat:D}=v??{},C={...g,surfaceCategory:v?.surfaceCategory??u?.surfaceCategory,indoorOutDoor:v?.indoorOutdoor??u?.indoorOutdoor,matchUpFormat:D,eventType:w,eventName:y,category:S,eventId:b,endDate:I,gender:T},E;return!e?.length&&!i&&u&&({participants:e=[],participantMap:i,groupInfo:E}=Ib({participantsProfile:s,useParticipantMap:c,tournamentRecord:u,contextProfile:f,inContext:A})),f&&!r&&(r=bA({policyDefinitions:l,tournamentRecord:u,contextProfile:f,drawDefinition:h,event:v})),{...ia({context:C,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,drawDefinition:h,contextContent:r,contextFilters:p,contextProfile:f,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:A,event:v}),groupInfo:E}}function ly({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=Dt(t),r=e.split("."),n=[],a;o({targetElement:i,attributes:r});let s={value:a};return n.length&&(s.values=n),s;function o({targetElement:l,attributes:c=[],significantCharacters:u}){for(let[p,f]of c.entries())if(l?.[f]){let h=c.slice(p+1);h.length?Array.isArray(l[f])?l[f].forEach(m=>o({targetElement:m,attributes:h})):(l=l[f],d({targetElement:l,index:p})):(a||(a=l[f]),n.includes(l[f])||n.push(l[f]))}function d({targetElement:p,index:f}){if(p&&f===c.length-1&&["string","number"].includes(typeof p)){let h=u?p.slice(0,u):p;a?n.includes(h)||n.push(h):(a=h,n.push(h))}}}}var UTe=t=>e=>!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(i=>({[i]:ly({element:e,accessor:i})?.value}))||typeof t=="object"&&Object.keys(t).map(i=>({[i]:ly({element:e,accessor:i})?.value}))||(typeof t=="string"&&ly({element:e,accessor:t}))?.value,rc=UTe;function LM({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:s,fmlc:o}){if(!Pu(a))return[];let{roundProfile:l,roundNumbers:c=[]}=Oo({interpolate:!0,matchUps:a});r=r??Math.max(...c,0);let u=n?r-n:0,d=u&&l?.[r-u]?.matchUpsCount,p=l&&Object.values(l).map(rc("matchUpsCount")),f=(A,g)=>{let v=Math.min(...A);d&&g&&v===1&&(v=d);let b=Math.max(...A);return e&&b>e&&(b=e),[v,b]},h=l&&Object.assign({},...c.map(A=>{let g=(r??0)+1-A-u,v=l[A].matchUpsCount,b={finishingPositionRange:{},finishingRound:g},y=p?.slice(A-1).reduce((P,R)=>P+(R||0),0),I=o&&A!==1,w=1+t+(I?i??0:0),S=1,T=vt(w,s?w+v*2:y+w+S),D=y+S-v,C=f(T.slice(D)),E=f(T.slice(0,D),!0);return b.finishingPositionRange={loser:C,winner:E},{[A]:b}})),m=Mc({finishingRound:!0});return a.filter(Boolean).forEach(A=>{let g=A.roundNumber&&h[A.roundNumber];m&&!g&&console.log({roundFinishingData:h,matchUp:A}),A.finishingRound=g?.finishingRound,A.finishingPositionRange=g?.finishingPositionRange}),a}function Vy({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){if(!e)return{error:kt};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=ia({inContext:!0,drawDefinition:e,matchUpsMap:i})),!i?.drawMatchUps.some(n=>n.finishingPositionRange)&&e?.structures?.length===1&&!e?.structures[0].structures){let n=i?.drawMatchUps??[];LM({matchUps:n})}return(t??[]).filter(({collectionId:n})=>!n).forEach(n=>{let{matchUpId:a,structureId:s}=n,o=Fo({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:a}),{winnerMatchUp:l,loserMatchUp:c}=o.targetMatchUps,u=l?.matchUpId,d=c?.matchUpId,p=Cg({matchUpsMap:i,structureId:s}).find(f=>f.matchUpId===a);if(p&&(u&&(r.winnerMatchUpIds[p.matchUpId]=u,Object.assign(p,{winnerMatchUpId:u}),Object.assign(n,{winnerMatchUpId:u})),d&&(r.loserMatchUpIds[p.matchUpId]=d,n.loserMatchUpId=d,p.loserMatchUpId=d,n.finishingPositionRange))){let f=c.finishingPositionRange&&[...n.finishingPositionRange.loser,...c.finishingPositionRange.loser],h=f&&[Math.min(...f),Math.max(...f)];n.finishingPositionRange.loser=h,p.finishingPositionRange.loser=h}}),{inContextDrawMatchUps:t,goesToMap:r}}function Bd(t){let e=Cu(t),i=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:s}=t;if(!Array.isArray(i))return{error:mA};if(!Array.isArray(r))return{error:hp};let o=t.matchUpIds?.length?t.matchUpIds:i.map(v=>v.matchUpId);if(!Array.isArray(o))return{error:Jw};let l={},c={},u={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),f=p.reduce((v,b)=>v.concat(b.events??[]).map(y=>(y.drawDefinitions||[]).map(I=>I.links||[])).flat(1/0),[]).filter(({linkType:v})=>v===Dh),h=i;if(f.length){h=up({nextMatchUps:!0,tournamentRecords:e}).matchUps;let v=f.reduce((b,y)=>{let I=y.source?.structureId,w=y.target?.structureId;return I&&w&&(u[w]=I),I&&!b.includes(I)&&b.push(I),b},[]);for(let b of v)l[b]=[];for(let b of h??[]){let y=b.containerStructureId||b.structureId;v.includes(y)&&l[y].push(b.matchUpId)}}let m=v=>{c[v]||(c[v]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[v]=[])},A=(v,b)=>{c[v].matchUpIds.forEach(y=>{c[b].matchUpIds.push(y)}),c[b].matchUpIds.push(v),c[v].dependentMatchUpIds.push(b),n&&c[v].participantIds.forEach(y=>c[b].participantIds.push(y))},g=v=>{let b=Object.keys(l).length;for(let y of v||[]){let{matchUpId:I,winnerMatchUpId:w,loserMatchUpId:S}=y;if(!o.length||o.includes(I)){if(m(I),n){let{individualParticipantIds:C}=t$(y);c[I].participantIds=C}w&&(m(w),A(I,w),d[w].push(I)),S&&(m(S),A(I,S),d[S].push(I)),c[I].sources.push(d[I]);let T=d[I].map(C=>c[C].sources[0]).flat(),D=d[I].map(C=>c[C].sources[1]).flat();if(c[I].sources.push(T,D),b){let C=y.containerStructureId||y.structureId,E=u[C];if(l[E])for(let P of l[E])m(P),A(P,I),d[P].push(I)}}}};if(s)Vy({drawDefinition:s}),h?.length||(h=No({drawDefinition:s}).matchUps),g(h);else{if(h?.length||(h=up({nextMatchUps:!0,tournamentRecords:e}).matchUps),!r.length){let v=p?.length?p.map(({events:b=[]})=>b.map(({drawDefinitions:y=[]})=>y.map(({drawId:I})=>I))).flat(1/0):[];v&&(r=v)}for(let v of r){let b=h?.filter(y=>y.drawId===v).sort(AS);if(!b?.find(({roundPosition:y})=>!y)){let y=b?.find(({tournamentId:w})=>w),{drawDefinition:I}=tl({tournamentRecord:e[y?.tournamentId],drawId:v});I&&Vy({drawDefinition:I})}g(b)}}return{positionDependencies:l,matchUpDependencies:c,sourceMatchUpIds:d,matchUps:h,...oe}}function wa(t){let e=t?.matchUp,i=t?.score||e?.score,r=i?.sets?.[0],{side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o,side1PointScore:l,side2PointScore:c}=r||{},u=n||a||s||o||l||c;return!!(i?.sets?.length>1||u)}function $M({matchUpStatus:t}){return xUe.includes(t)}function Y7e({matchUpStatus:t}){return DY.includes(t)}function Q4({matchUpStatus:t}){return _Ue.includes(t)}function r7({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){let a=r?.find(({participantId:o})=>o),s=i?.filter(r7)?.length;return wa({score:n})||s||e&&a||t&&Y7e({matchUpStatus:t})&&![Nr,Zr,Md].includes(t)}function UE(t){let{drawDefinition:e,findContainer:i,structureId:r,event:n}=t,a=t.structure,{containedStructures:s}=IE({drawDefinition:e}),o=r?s[r]||[]:[],l={isCollectionMatchUp:!1};if(!a){let S=di({drawDefinition:e,structureId:r});if(S.error)return S;a=i?S.containingStructure??S.structure:S.structure}if(el({structure:a}))return{structure:a,isAdHoc:!0,error:Zw};let{matchUps:c}=ia({inContext:!0,matchUpFilters:l,drawDefinition:e,event:n}),u=c?.filter(S=>S.structureId===r||o.includes(S.structureId)),{matchUpDependencies:d}=Bd({drawIds:[e.drawId],matchUps:c,drawDefinition:e}),p=[],f=[],h={},m=[];for(let S of c??[]){if(S.structureId===r||o.includes(S.structureId)){f.push(...S.drawPositions??[]);let T=S.roundNumber;for(let D of(S.drawPositions??[]).filter(Boolean))(!h[D]||T&&h[D]>T)&&(h[D]=T)}r7(S)&&(m.push(S),p.push(S.matchUpId,...d?.[S?.matchUpId]?.matchUpIds||[]))}let A=Ei(f.filter(Boolean)).sort(ua),g=Ei(p),v=Ei(u?.map(({matchUpId:S,drawPositions:T})=>g.includes(S)?T:[]).flat().filter(Boolean)).sort(ua),{positionAssignments:b}=wr({drawDefinition:e,structure:a}),y=b?.filter(S=>S.bye).map(S=>S.drawPosition),I=b?.filter(S=>S.qualifier).map(S=>S.drawPosition),w=A?.filter(S=>!v.includes(S))||[];return{allDrawPositions:A,inContextStructureMatchUps:u,drawPositionInitialRounds:h,activeDependentMatchUpIds:g,qualifyingDrawPositions:I,inactiveDrawPositions:w,positionAssignments:b,activeDrawPositions:v,byeDrawPositions:y,activeMatchUps:m,structure:a}}function ow({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&i?.includes(t)).map(({roundNumber:i})=>i).sort(ua)[0]}}var LA={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},n7=[];function yl(t,e){rn(t)&&(t={method:t}),(e||Mc())&&n7.push(t)}function X7e(t){return n7.slice()}function Z7e(t){let e=X7e().map(i=>{let{color:r,keyColors:n,method:a,newline:s}=i,o=Object.keys(LA).includes(r)?LA[r]:LA.cyan,l=Object.keys(i).filter(u=>!["color","keyColors","method","newline"].includes(u)).map(u=>{let d=n&&Object.keys(n).includes(u)&&LA[n[u]]?LA[n[u]]:LA.brightwhite;return`${LA.white}${u}: ${d}${i[u]}`}).join(", "),c=a?.length<15?"		":"	";return[s?`
`:"",o,a,c,LA.white,l,LA.reset,`
`].join("")});e?.length&&console.log(...e)}function J7e(){n7.length=0}function a7(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,containsParticipant:r,filled:e||i||r}}function ks(t){return[Nr,Zr,Ha].includes(t)}function Hc({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,loserMatchUp:a,matchUpsMap:s,structureId:o,structure:l,event:c}){if(!r)return{error:kt};if(l||({structure:l}=di({drawDefinition:r,structureId:o})),!l)return{error:an};o||({structureId:o}=l);let u="assignDrawPositionBye";yl({method:u,color:"cyan",drawPosition:n}),s??=os({drawDefinition:r});let{positionAssignments:d}=wr({structure:l}),{activeDrawPositions:p}=UE({drawDefinition:r,structureId:o});if(d?.find(E=>E.drawPosition===n)?.bye)return{...oe};let f=!!(a&&s.drawMatchUps.some(E=>E.loserMatchUpId===a?.matchUpId&&ks(E.matchUpStatus)));if(p?.includes(n)&&!f)return{error:sM};let h=d?.find(E=>E.drawPosition===n);if(!h)return{error:Zw};let{filled:m,containsBye:A,containsParticipant:g}=a7(h);if(A)return{...oe};if(m&&!A&&!f)return ce({result:{error:$T},stack:u});let v=tr({tournamentRecord:i,drawDefinition:r,event:c}).appliedPolicies??{},b=ia({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[],y={isCollectionMatchUp:!1},{matchUps:I}=dr({provisionalPositioning:t,drawDefinition:r,matchUpFilters:y,matchUpsMap:s,structure:l});if(d?.forEach(E=>{E.drawPosition===n&&(E.bye=!0,f&&(E.participantId=void 0))}),l.structureType===$o)return e9e({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:I}),Ym({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:c}),lie({assignedParticipantId:g,isPositionAction:e,appliedPolicies:v,drawDefinition:r,drawPosition:n,structureId:o,stack:u});let{roundProfile:w,roundMatchUps:S}=Oo({matchUps:I}),T=(w&&Object.keys(w).map(E=>Number.parseInt(E)).reverse())?.find(E=>w?.[E].drawPositions?.includes(n)),D=T?S?.[T].find(({drawPositions:E})=>E?.includes(n)):void 0;D&&TTe({tournamentRecord:i,drawDefinition:r,matchUp:D,event:c});let C=D?.drawPositions?.find(E=>E!==n);if(D&&C){let E=s7({sourceDrawPositions:D.drawPositions,matchUpId:D.matchUpId,inContextDrawMatchUps:b,drawPositionToAdvance:C,tournamentRecord:i,drawDefinition:r,matchUpsMap:s});if(E.error)return E}return Ym({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:c}),lie({assignedParticipantId:g,isPositionAction:e,appliedPolicies:v,drawDefinition:r,drawPosition:n,structureId:o,stack:u})}function lie({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&TM({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),ce({result:{...oe},stack:s})}function TTe({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:"BYE",score:void 0,winningSide:void 0}),Zi({tournamentId:t?.tournamentId,eventId:i??n?.eventId,context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function e9e({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{a.drawPositions?.includes(i)&&TTe({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function s7({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:s,event:o}){yl({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(b=>b.matchUpId===s),c=e.find(b=>b.matchUpId===s)?.structureId,{structure:u}=di({drawDefinition:n,structureId:c}),{positionAssignments:d}=wr({structure:u}),p=d?.filter(b=>b.bye).map(b=>b.drawPosition),f=l?.drawPositions?.find(b=>b!==t),h=f&&p?.includes(f),{targetLinks:{loserTargetLink:m},targetMatchUps:{loserMatchUp:A,winnerMatchUp:g,loserTargetDrawPosition:v}}=Fo({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:s});if(g&&g.structureId===u?.structureId&&t9e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:g,matchUpsMap:a,event:o}),A&&h&&A.structureId!==u?.structureId){let{roundNumber:b}=A;if(b===1){let y=Hc({structureId:m.target.structureId,drawPosition:v,tournamentRecord:r,drawDefinition:n,event:o});if(y.error)return y}else CTe({loserTargetDrawPosition:v,tournamentRecord:r,loserTargetLink:m,drawDefinition:n,loserMatchUp:A,matchUpsMap:a,event:o})}return{...oe}}function t9e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:s,event:o}){let l="advanceWinner",c=s.drawMatchUps.find(M=>M.matchUpId===a.matchUpId),u=e.find(M=>M.matchUpId===a.matchUpId)?.structureId,{structure:d}=di({drawDefinition:n,structureId:u}),{positionAssignments:p}=wr({structure:d}),f=p?.find(({drawPosition:M})=>M===t)?.bye,h=c.drawPositions?.filter(Boolean),m=p?.filter(M=>h?.includes(M.drawPosition)),A=p?.find(({drawPosition:M})=>M===t),g=i?.find(M=>M!==t),v=(g&&m?.find(({drawPosition:M})=>M===g))?.bye,b=f&&v;if(b&&console.log({isByeAdvancedBye:b}),h?.length>1&&f&&!v)return ce({result:{error:$T},stack:l});let y=h?.find(M=>M!==t),I=b,w=[...(c.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),S=w.map(M=>!M&&!I||M===t?(I=!0,t):M).sort(ua);if(!I)return console.log("@@@@@@@",{advancingAssignmentIsBye:A,drawPositionToAdvance:t,existingAssignments:m}),ce({result:{error:$T},stack:l});let T=p?.find(({drawPosition:M})=>M===y)?.bye,D=p?.find(({drawPosition:M})=>M===t)?.bye;Object.assign(c,{matchUpStatus:D||T?"BYE":Nn,score:void 0,winningSide:void 0,drawPositions:S});let C=c.drawPositions.find(M=>!w.includes(M));yl({method:l,color:"brightyellow",changedDrawPosition:C,pairedDrawPositionIsBye:T,drawPositionIsBye:D}),Zi({tournamentId:r?.tournamentId,matchUp:c,eventId:o?.eventId,context:l,drawDefinition:n});let{targetLinks:{loserTargetLink:E},targetMatchUps:{loserMatchUp:P,loserTargetDrawPosition:R}}=Fo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(T||D){let M=T?t:y;if(M)s7({drawPositionToAdvance:M,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:s});else if(D&&E&&P)if(P.feedRound)CTe({loserTargetDrawPosition:R,tournamentRecord:r,loserTargetLink:E,drawDefinition:n,loserMatchUp:P,matchUpsMap:s});else{let N=1-a.roundPosition%2,k=P.drawPositions[N],O=Hc({structureId:E.target.structureId,drawPosition:k,tournamentRecord:r,drawDefinition:n,event:o});if(O.error)return O}}}function CTe({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{roundNumber:o}=n;yl({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=(a?.mappedMatchUps||{})[n.structureId].matchUps,{initialRoundNumber:c}=ow({drawPosition:t,matchUps:l});if(c===o){let u=Hc({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:s});if(u.error)return u}}function ETe({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:s}=dr({drawDefinition:i,matchUpsMap:r,structure:n,event:a});s.forEach(o=>{let l=t.filter(({drawPosition:c})=>o.drawPositions?.includes(c)).filter(c=>c.bye).length;o.winningSide||(Object.assign(o,{matchUpStatus:l?"BYE":Nn}),Zi({tournamentId:e?.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a?.eventId,drawDefinition:i,matchUp:o}))})}function HM(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:s,matchUpsMap:o,event:l}=t,{structure:c}=di({drawDefinition:a,structureId:s}),u=(Ia({drawDefinition:a,structure:c}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(u&&i&&!r&&(r=u?.drawPosition),!r)return{error:cE};i||(i=u?.participantId);let{activeDrawPositions:d}=UE({drawDefinition:a,structureId:s});return d.includes(r)?{error:sM}:(e||({matchUps:e}=ia({inContext:!0,drawDefinition:a,matchUpsMap:o})),j4({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:s,drawPosition:r,matchUpsMap:o,event:l}).drawPositionCleared?(Ym({tournamentId:n?.tournamentId,drawDefinition:a,structure:c,event:l}),{...oe,participantId:i}):{error:qIe})}function j4({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:s}){let{structure:o}=di({drawDefinition:i,structureId:a});if(!o)return{error:an};let l=Ia({drawDefinition:i,structure:o}).positionAssignments||[],c=l.some(g=>{if(g.drawPosition===r)return delete g.participantId,delete g.qualifier,delete g.bye,!0});if(o.structureType===$o)return ETe({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:o}),{drawPositionCleared:c,...oe};let u={isCollectionMatchUp:!1},{matchUps:d}=dr({drawDefinition:i,matchUpFilters:u,matchUpsMap:n,structure:o,event:s}),{roundProfile:p,roundMatchUps:f}=Oo({matchUps:d}),h=(p&&Object.keys(p))?.map(g=>ci(g)),m=r,A=h?.map(g=>{let v=p?.[g]?.pairedDrawPositions?.find(C=>C.includes(m)),b=v?.find(C=>C!==m),y=l.find(C=>C.drawPosition===b),I=p?.[g+1],w=y?.bye,S=I?.pairedDrawPositions?.find(C=>C.includes(b)),T=w&&S&&I&&I.drawPositions?.includes(b),D=v&&{pairedDrawPositionByeAdvancedPair:!T&&S,pairedDrawPosition:b,targetDrawPosition:m,relevantPair:v,roundNumber:g};return T&&(m=b),D}).filter(g=>g?.targetDrawPosition)?.reduce((g,v)=>{let{roundNumber:b,relevantPair:y,targetDrawPosition:I,pairedDrawPosition:w,pairedDrawPositionByeAdvancedPair:S}=v,T={roundNumber:b,targetDrawPosition:I,relevantPair:y},D=S&&{roundNumber:b+1,targetDrawPosition:w,relevantPair:S,subsequentRoundRemoval:!0},C=[T,D].filter(Boolean);return g.concat(...C)},[]);return A?.forEach(({roundNumber:g,targetDrawPosition:v,relevantPair:b})=>{let y=f?.[g].find(I=>_o(I.drawPositions?.filter(Boolean),b.filter(Boolean)));y&&(i9e({inContextDrawMatchUps:t,targetDrawPosition:v,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:g,matchUpsMap:n}),DTe({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:y,drawPosition:r,matchUpsMap:n,structure:o,event:s}))}),{tasks:A,drawPositionCleared:c,positionAssignments:l}}function i9e({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:s}){let{structure:o}=di({drawDefinition:r,structureId:s});if(!o)return{error:an};if(o.structureType===$o)return;n=n||os({drawDefinition:r});let l=(n?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:c}=ow({drawPosition:e,matchUps:l}),u=l?.filter(p=>p.roundNumber>=a&&p.roundNumber!==c&&p.drawPositions?.includes(e)),d=wr({drawDefinition:r,structureId:s}).positionAssignments??[];return u?.forEach(p=>DTe({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:o})),{...oe}}function DTe({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let c="removeDrawPosition",u=n.drawPositions?.slice(),d=n.matchUpStatus,p=n.winningSide;s=s??os({drawDefinition:r});let f=s.mappedMatchUps[o.structureId].matchUps,{initialRoundNumber:h}=ow({drawPosition:a,matchUps:f});if(n.roundNumber&&h&&n.roundNumber>h){let S=(n.drawPositions??[]).map(T=>T===a?void 0:T);n.drawPositions=S}if(n.matchUpType===Hr){let S=(t?.find(T=>T.matchUpId===n.matchUpId)?.sides??[]).reduce((T,D,C)=>D.drawPosition===a?C:T,void 0);S!==void 0&&n.sides?.[S]?.lineUp&&(delete n.sides?.[S].lineUp,Zi({tournamentId:i?.tournamentId,context:`${c}-TEAM`,eventId:l?.eventId,matchUp:n,drawDefinition:r}))}let m=Fo({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:A},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v,loserMatchUpDrawPositionIndex:b}}=m,y=e.filter(({drawPosition:S})=>n.drawPositions?.includes(S)).filter(S=>S.bye).length,I=y&&"BYE"||n.matchUpStatus&&ks(n.matchUpStatus)&&n.matcHUpStatus||Nn;n.matchUpStatus=I,n.matchUpStatus&&ks(n.matchUpStatus)&&(n.winningSide=void 0);let w=u?.find(S=>!n.drawPositions?.includes(S));if(u?.includes(a)&&d===n.matchUpStatus&&p===n.winningSide||(w&&yl({method:c,color:"brightyellow",removedDrawPosition:w}),Zi({tournamentId:i?.tournamentId,context:`${c}-${a}`,eventId:l?.eventId,matchUp:n,drawDefinition:r})),g&&g.structureId!==m.matchUp.structureId&&!y){let{drawPositions:S,roundNumber:T}=g;if(T===1){let D=S[b];j4({structureId:g.structureId,drawPosition:D,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s})}else{let D=Math.min(...S.filter(Boolean)),C=r9e({loserMatchUpDrawPosition:D,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:g,matchUpsMap:s,event:l});if(C.error)return ce({result:C,stack:c});let E=(s?.mappedMatchUps||{})[g.structureId].matchUps,{initialRoundNumber:P}=ow({drawPosition:D,matchUps:E});P===1&&(yl({method:c,color:"brightyellow",loserMatchUpDrawPosition:D}),j4({structureId:g.structureId,drawPosition:D,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s}))}}return v&&v.structureId!==m.matchUp.structureId&&A.target.feedProfile,{...oe}}function r9e({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{structure:o}=di({structureId:n.structureId,drawDefinition:r}),{positionAssignments:l}=wr({structure:o});if(l?.find(c=>c.drawPosition===t)?.bye){let c=HM({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:s});if(c.error)return c}return{...oe}}function Cb({drawDefinition:t,stages:e}){if(!t)return{error:kt};let i=(t?.structures??[]).filter(n=>!e?.length||n.stage&&e.includes(n.stage)),r=Ei(i.map(n=>{let{positionAssignments:a}=wr({structure:n});return a?a.map(qi):[]}).flat().filter(Boolean));return{...oe,assignedParticipantIds:r}}function tp(t){let e=(t?.entries??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:s}=n,o=`_${a||Et}${s||""}`;return r[o]||(r[o]=[]),r[o].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let s=a+1;return{...n,entryPosition:s}})).flat()}function zv(t){return[Sb,Du].includes(t)}function O_({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:s,extension:o,eventSync:l,drawId:c,stage:u,event:d}){if(!n||!Array.isArray(n))return{error:lp,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:Gr};if(a&&!tTe.includes(a))return{error:C4};if(s&&!_2.includes(s))return{error:gb};let p="modifyEntriesStatus",f=[];if(!a&&!o)return ce({result:{error:Yt},info:"Missing entryStatus",stack:p});if(o&&!gf({extension:o,requiredAttributes:["name"]}))return ce({result:{error:we},info:"Invalid extension",context:{extension:o},stack:p});let h=[];d?.drawDefinitions?.forEach(D=>{let C=Cb({stages:u&&[u],drawDefinition:D}).assignedParticipantIds??[];h.push(...C)});let m=i?.participants??[];if(!n.every(D=>{let C=Sg({tournamentParticipants:m,participantId:D})?.participantType;return!(C&&[Ni,qo].includes(C)&&zv(a))&&!(a&&d?.eventType&&C===Wi&&[hu,Jl].includes(d.eventType)&&[ud,...jk].includes(a))}))return{error:C4};let A=d&&kn({event:d}).flightProfile,g=A?.flights?.find(D=>D.drawId===c),v=D=>{let C=(D||[]).filter(P=>!u||!P.entryStage||u===P.entryStage).filter(({participantId:P})=>n.includes(P)),E=P=>a&&h.includes(P.participantId)&&!(jk.includes(P.entryStatus)&&jk.includes(a));return C.every(P=>E(P)&&!e?!1:(a&&(P.entryStatus=a,delete P.entryPosition),s&&(P.entryStage=s,delete P.entryPosition),o&&(o.value?ur({element:P,extension:o}):Mo({element:P,name:o.name})),!0))?{...oe}:{error:pE}},b=({flight:D,drawDefinition:C})=>{d&&(d.entries=tp({entries:d.entries??[]})),D&&(D.drawEntries=tp({entries:D.drawEntries})),C&&(C.entries=tp({entries:C.entries}))},y=D=>{let{flight:C,drawDefinition:E}=D,P="updateDrawEntries";if(C){let R=v(C.drawEntries);if(R.error)return ce({result:R,stack:P})}if(E){let R=v(E.entries);if(R.error)return ce({result:R,stack:P});f.includes(E.drawId)||f.push(E.drawId)}return{...oe}},I=d?.entries?.find(({entryPosition:D})=>D)??(g?.drawEntries?.find(({entryPosition:D})=>D)||r?.entries?.find(({entryPosition:D})=>D));if(t&&!I&&b({flight:g,drawDefinition:r}),g||r){let D=y({flight:g,drawDefinition:r});if(D.error)return ce({result:D,stack:p})}let w=d?.drawDefinitions?.map(({drawId:D})=>D)??[],S=A?.flights?.filter(D=>!w.includes(D.drawId))||[];for(let D of S){let C=D&&y({flight:D});if(C?.error)return ce({result:C,stack:p})}let T=A?.flights?.length===1&&(d?.drawDefinitions?.length??0)<=A?.flights?.length;if(!g&&!r&&a&&eTe.includes(a))return{error:Bwe};if(!g&&!r||a===kh||l&&T){let D=v(d?.entries);if(D?.error)return ce({result:D,stack:p});let C;if(a===kh&&(A?.flights?.every(E=>{let P=v(E.drawEntries);return P.error?(C=P.error,!1):(E.drawEntries=E.drawEntries.filter(({participantId:R})=>!n.includes(R)),!0)}),d?.drawDefinitions?.every(E=>{let P=v(E.entries);return P.error?(C=P.error,!1):(E.entries=E.entries?.filter(({participantId:R})=>!n.includes(R)),!0)})),C)return ce({result:{error:C},stack:p})}t&&b({flight:g,drawDefinition:r});for(let D of d?.drawDefinitions??[])f.length&&!f.includes(D.drawId)||kr({tournamentId:i.tournamentId,eventId:d?.eventId,drawDefinition:D});return{...oe}}function lh({requireTimeStamp:t,scaleAttributes:e,participant:i}){if(!i)return{error:iS};if(!Xi(e))return{error:we};if(i.timeItems??=[],Array.isArray(i.timeItems)){let{accessor:r,scaleType:n,eventType:a,scaleName:s}=e,o=[Ly,n,a,s].join("."),l=i.timeItems.filter(c=>c?.itemType===o).filter(c=>!t||c?.itemDate).sort((c,u)=>(c.createdAt?new Date(c.createdAt).getTime():0)-(u.createdAt?new Date(u.createdAt).getTime():0)).pop();if(l){let[c,u,d,p]=l.itemType?.split(".")??[];if(c!==Ly)return{error:tw};let f=r&&ly({element:l.itemValue,accessor:r}),h=f?.value||l.itemValue,m={rawValue:f&&l.itemValue,eventType:d,scaleDate:l.itemDate,scaleValue:h,scaleName:p,scaleType:u};return{...oe,scaleItem:m}}}return{...oe,scaleItem:void 0}}function n9e({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){let a={},s=u=>[Ly,sh,n.eventType,u].join("."),o=Object.assign({},...(r.timeItems||[]).filter(({itemType:u})=>u.split(".")[1]===sh).map(({itemType:u,itemValue:d})=>({[u]:d}))),l=(t?.stageSeedingScaleNames&&Object.values(t?.stageSeedingScaleNames)||Array.isArray(t?.seedingScaleNames)&&t.seedingScaleNames||[]).map(s),c=Mn(Object.keys(o),l);if((!e||!Object.keys(o).length&&!t?.drawIds?.length||c.length)&&c.length){if(t?.stageSeedingScaleNames){let u=Object.keys(t.stageSeedingScaleNames).map(p=>{let f=s(t.stageSeedingScaleNames[p]),h=o[f];return[p,h]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...u);a.seedAssignments=d}else if(c){let u=c.map(d=>o[d]);a.seedValue=u.pop()}}else if(!e&&typeof i=="object"){let u=Object.keys(i).map(p=>{let f=s(i[p]),h=o[f];return[p,h]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...u);a.seedAssignments=d}else{let{categoryName:u,ageCategoryCode:d}=n.category||{},p=[d,n.eventId,u].filter(Boolean),f;for(let h of p){let m={eventType:n.eventType,scaleType:sh,scaleName:h},A=lh({scaleAttributes:m,participant:r});if(A.scaleItem){f=A.scaleItem;break}}if(f&&(!e||t?.published&&!t?.published?.drawIds?.length)){let h=f.scaleValue;a.seedValue=h}}return a}function a9e({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:s,entry:o}){let{entryStatus:l,entryStage:c,entryPosition:u,extensions:d}=o,p=d?.length&&t?Object.assign({},...sY(d??[])):{},f=Object.assign(p,{entryPosition:u,entryStatus:l,entryStage:c,ranking:s,eventId:a});i.events[a]=Lt(f,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function VM(t){let e=Qt(t,[{[Ua]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:r=$c}=t,n=`${av}.${sv}`;return Dt(r$({tournamentRecord:i,itemType:n})?.timeItem?.itemValue?.[r],!1,!0)}function s9e(t){let{tournamentId:e}=t??{};return!!e}function Ru({event:t,status:e=$c}){let i=`${av}.${sv}`;return EM({itemType:i,event:t})?.timeItem?.itemValue?.[e]}function o7({drawDetails:t,drawId:e}){return t?.[e]?.publishingDetail?.published}function gS(t){let{tournamentRecord:e,drawDefinition:i,eventIds:r,eventId:n,drawIds:a,drawId:s,event:o}=t??{};if(e&&!s9e(e))return{error:we};if(n&&!o)return{error:fu};if(Array.isArray(r)&&r?.length){let d={};for(let p of r){if(!rn(p))return{error:we};let f=tl({tournamentRecord:e,eventId:p})?.event;if(!f)return{error:fu};let h=YV({event:f});d[p]=h}return{...oe,publishState:d}}if(o){let d=YV({event:o}),p={};if(s)return i?{publishState:{status:{published:!!d.status.publishedDrawIds?.includes(s),drawDetail:d.status.drawDetails?.[s]},...oe}}:{error:Rc};if(Array.isArray(a)&&a?.length){let f=o.drawDefinitions?.map(qP)??[];for(let h of a){if(!rn(h))return{error:we};if(!f.includes(h))return{error:Rc};p[h]={status:{published:!!d.status.publishedDrawIds.includes(h),drawDetail:d.status.drawDetails?.[h]}}}}else p=d;return{...oe,publishState:p}}let l=[],c=!1,u={};for(let d of e?.events??[]){let p=YV({event:d});u[d.eventId]=p,p.status.published&&(l.push(d.eventId),c=!0);for(let{drawId:f}of d.drawDefinitions??[]){let h=p.status?.publishedDrawIds?.includes(f);h&&(u[f]={status:{published:h}})}}if(e){let d=VM({tournamentRecord:e});u.tournament=d??{},(d?.orderOfPlay?.published||d?.participants?.published)&&(c=!0),u.tournament.status={published:c,publishedEventIds:l}}return{...oe,publishState:u}}function YV({event:t}){let e=Ru({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let r=e.drawDetails??{};for(let o of t.drawDefinitions?.map(qP)||[])r[o]||(r[o]={publishingDetail:{published:!1}});let n=r&&Object.keys(r).length&&Object.keys(r).filter(o=>o7({drawDetails:r,drawId:o})),a=n?.length?n:e.drawIds??[];if(a?.length&&!n?.length)for(let o of a)r[o]={publishingDetail:{published:!0}};let s=a?.length>0;return{status:{publishedDrawIds:a,publishedSeeding:i,drawDetails:r,published:s}}}function PTe(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:c,schedule:u,drawId:d,score:p}=t;!u||!Object.keys(u).length||r==="BYE"||e[i].scheduleItems.push({...u,scheduledDate:Ui(u?.scheduledDate),scheduledTime:Kr(u?.scheduledTime),checkScoreHasValue:wa({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:c,drawId:d})}function o9e({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:r,matchUpStatus:n,participantId:a,stageSequence:s,roundNumber:o,structureId:l,matchUpId:c,drawId:u,stage:d}){let p=e[a],f=v=>Math.abs(v[0]-v[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:s,winCount:0,structureId:l,drawId:u});let h=p.structureParticipation[l],{winner:m,loser:A}=t,g=r?m:A;r&&(h.winCount+=1,n===Zr&&(h.walkoverWinCount+=1),n===Nr&&(h.defaultWinCount+=1)),g&&(!h.finishingPositionRange||f(g)<f(h.finishingPositionRange))&&(h.finishingPositionRange=g),i&&((!h.finishingRound||i<h.finishingRound)&&(h.finishingMatchUpId=c,h.finishingRound=i,h.roundNumber=o),i===1&&(h.participantWon=r))}function cie(t){let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:r,participantMap:n,withOpponents:a,withMatchUps:s,withEvents:o,withDraws:l,finishingPositionRange:c,finishingRound:u,matchUpStatus:d,stageSequence:p,roundNumber:f,structureId:h,score:m,stage:A,withRankingProfile:g,tieWinningSide:v,roundPosition:b,matchUpTieId:y,matchUpSides:I,collectionId:w,matchUpType:S,winningSide:T,matchUpId:D,schedule:C,eventId:E,drawId:P,sides:R}=t,M=a&&R?.length===2&&Object.assign({},...R.map(({sideNumber:N},k)=>{let O=R[1-k].participantId;return N&&{[N]:O}}).filter(Boolean));for(let N of R){let{participantId:k,sideNumber:O,bye:x}=N;if(x)continue;let F=T===O,_=z=>{let Q=n[z]?.participant,j=Q?.participantType,W=[{participantId:z,participantType:j}];if(j!==qo)for(let Y of Q?.individualParticipantIds||[]){let X=n[Y]?.participant;W.push({participantType:X?.participantType,participantId:Y})}return W},V=(z,Q)=>{if(s){if(n[z].matchUps[D]={participantWon:F,matchUpType:S,structureId:h,sideNumber:O,matchUpId:D,eventId:E,drawId:P,stage:A},a){let j=_(Q);n[z].matchUps[D].opponentParticipantInfo=j}w&&(n[z].matchUps[D].collectionId=w)}a&&Q&&(n[z].opponents[Q]={participantId:Q,matchUpId:D,eventId:E,drawId:P}),g&&o9e({finishingPositionRange:c,participantMap:n,participantWon:F,finishingRound:u,matchUpStatus:d,participantId:z,stageSequence:p,roundNumber:f,structureId:h,matchUpId:D,drawId:P,stage:A}),(i||e)&&PTe({participantMap:n,participantId:z,matchUpStatus:d,roundPosition:b,matchUpType:S,roundNumber:f,structureId:h,matchUpId:D,schedule:C,drawId:P,score:m})},G=({participant:z,partnerParticipantId:Q})=>{let j=(W,Y)=>{W&&(W.partnerParticipantIds||(W.partnerParticipantIds=[]),W.partnerParticipantIds.includes(Y)||W.partnerParticipantIds.push(Y))};l&&j(z?.draws?.[P],Q),o&&j(z?.events?.[E],Q),s&&j(z?.matchUps?.[D],Q)};if(k&&n[k]){let z=M?.[O];V(k,z);let Q=n[k]?.participant.participantType===Ni,j=n[k]?.participant.individualParticipantIds||[];if(y){if(r){let W=Y=>n[Y].matchUps[y]={participantWon:v===O,matchUpId:y,matchUpType:Hr,sideNumber:O};W(k),j.forEach(W)}if(l&&!n[k].draws[P]){let W=I.find(J=>J.sideNumber===O)?.participant?.participantId,Y=n[W]?.draws?.[P]?.entryStatus,X=J=>n[J].draws[P]={entryStatus:Y,eventId:E,drawId:P};X(k),j.forEach(X)}}if(Q&&(j.forEach(W=>n[W]&&V(W,z)),j.forEach((W,Y)=>{let X=j[1-Y],J=n[W];J&&G({participant:J,partnerParticipantId:X})}),o&&I)){let W=I.find(Y=>Y.sideNumber===O)?.participant?.participantId;if(W){let Y=n[W]?.events[E];Y?(n[k].events[E]={...Y},j.forEach(X=>n[X].events[E]={...Y})):console.log("Missing teamEntry",{eventId:E,teamParticipantId:W})}}if(T){let W=Y=>{F?(n[Y].counters[S].wins+=1,n[Y].counters.wins+=1,d===Zr&&(n[Y].counters[S].walkoverWins+=1,n[Y].counters.walkoverWins+=1),d===Nr&&(n[Y].counters[S].defaultWins+=1,n[Y].counters.defaultWins+=1)):(n[Y].counters[S].losses+=1,n[Y].counters.losses+=1,d===Zr&&(n[Y].counters[S].walkovers+=1,n[Y].counters.walkovers+=1),d===Nr&&(n[Y].counters[S].defaults+=1,n[Y].counters.defaults+=1))};W(k),j.forEach(W)}}}}function p$(t,e){return(t||"").localeCompare(e||"")}function l9e(t){let{participantFilters:e,convertExtensions:i,policyDefinitions:r,tournamentRecord:n,usePublishState:a,contextFilters:s,matchUpFilters:o,participantMap:l,contextProfile:c,withPotentialMatchUps:u,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:f,withTeamMatchUps:h,withStatistics:m,withOpponents:A,withMatchUps:g,withSeeding:v,withEvents:b,withDraws:y}=t,I=e?.participantIds,w=N=>{let k=[N];return l[N]?.participant.individualParticipantIds?.forEach(O=>k.push(O)),k.some(O=>!I?.length||I.includes(O))?k:[]},S={withMatchUps:g||d,withEvents:b||d,withDraws:y||d,withPotentialMatchUps:u,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:f,withTeamMatchUps:h,withStatistics:m,participantMap:l,withOpponents:A,withSeeding:v},T=[],D={},C=[],E={},P={},R={},M=({eventType:N,scaleNames:k,participantId:O})=>l[O]?.participant?.rankings?.[N]?.find(x=>k.includes(x.scaleName))?.scaleValue;for(let N of n?.events||[]){if(e?.eventIds&&!e.eventIds.includes(N.eventId))continue;let{drawDefinitions:k=[],extensions:O=[],eventType:x,eventName:F,category:_,entries:V,eventId:G,gender:z}=N,{flightProfile:Q}=kn({event:N}),j=Q?.flights??[],W=gS({event:N}).publishState;W&&(E[G]=W);let Y=W?.status?.publishedSeeding;if(b||v||d){let J=i?Object.assign({},...sY(O??[])):{};P[G]={...J,eventName:F,eventType:x,category:_,eventId:G,gender:z};let ie=[_?.categoryName,_?.ageCategoryCode].filter(Boolean);for(let ue of V){let{participantId:ne}=ue;if(!ne||!l[ne])continue;let ge=M({eventType:x,scaleNames:ie,participantId:ne}),he,Ie;if(v){let Je=l[ne].participant;({seedAssignments:he,seedValue:Ie}=n9e({publishedSeeding:Y,usePublishState:a,withSeeding:v,participant:Je,event:N}))}let xe=Je=>{if(l[Je]?.events?.[G])return;let qe=l[Je];a9e({convertExtensions:i,seedAssignments:he,participant:qe,withSeeding:v,seedValue:Ie,eventId:G,ranking:ge,entry:ue})};xe(ne),(l[ne].participant.individualParticipantIds||[]).forEach(xe)}}let X=E?.[G]?.publishedSeeding;if(y||d||v){let J=ue=>ue?Object.assign({},...ue.map(({participantId:ne,seedValue:ge,seedNumber:he})=>({[ne]:{seedValue:ge,seedNumber:he}}))):void 0,ie=Ei([...k.map(qP),...j.map(qP)]);for(let ue of ie){let ne=k.find(pe=>pe.drawId===ue),ge=[_?.categoryName,_?.ageCategoryCode].filter(Boolean),{structures:he=[],drawOrder:Ie,drawName:xe,drawType:Je}=ne??{},qe=j?.find(pe=>pe.drawId===ue),dt=ne?.entries||qe?.drawEntries,ft=qe?.flightNumber,je=(ne?.structures||[]).sort((pe,Se)=>cS(pe,Se)).map(({structureId:pe,structures:Se})=>[pe,...(Se||[]).map(({structureId:ye})=>ye)]).flat(1/0),Tt,Oe,mt,Le,lt=0,it=he.filter(({stage:pe,stageSequence:Se})=>pe===Et&&Se===1||pe===qt).flatMap(pe=>{let{positionAssignments:Se}=wr({structure:pe}),{seedAssignments:ye,stageSequence:ke,stage:Ce}=pe;return Ce===Et?(lt=Se?.length??0,mt=Se,Le=ye):ke===1&&(Tt=Se,Oe=ye),Se}).map(({participantId:pe})=>pe).filter(Boolean),Fe=J(Le),Xe=J(Oe),ct=ne?dt.filter(({participantId:pe})=>it.includes(pe)):dt,We=!a||X?.published&&(X?.drawIds?.length===0||X?.drawIds?.includes(ue));for(let pe of ct){if(!l[pe.participantId])continue;let{entryStatus:Se,entryStage:ye,entryPosition:ke,participantId:Ce}=pe,Ke=M({participantId:Ce,scaleNames:ge,eventType:x}),_e=wt=>{if(!l[wt]||l[wt].draws?.[ue])return;let ut=v&&We,Ct=ut?{}:void 0,Gi=ut?Fe?.[Ce]?.seedValue||Fe?.[Ce]?.seedNumber:void 0,Wt=Gi?Fe?.[Ce]:void 0,Ji=ut?Xe?.[Ce]?.seedValue||Xe?.[Ce]?.seedNumber:void 0,$i=Ji?Xe?.[Ce]:void 0;Ct&&Gi&&(Ct[Et]=Wt),Ct&&Ji&&(Ct[qt]=$i);let xi=Gi||Ji;xi&&(l[wt].participant.seedings[x]||(l[wt].participant.seedings[x]=[]),Wt&&l[wt].participant.seedings[x].push({...Wt,scaleName:ue}),$i&&l[wt].participant.seedings[x].push({...$i,scaleName:ue}),Ct&&(l[wt].events[G].seedAssignments||(l[wt].events[G].seedAssignments={}),Object.keys(Ct).forEach(en=>l[wt].events[G].seedAssignments[en]=Ct[en]))),(y||d)&&(l[wt].draws[ue]=Lt({seedAssignments:Ct,entryPosition:ke,entryStatus:Se,entryStage:ye,seedValue:xi,eventId:G,ranking:Ke,drawId:ue},!1,!1,!0))};[Du,Sb].includes(Se)||(_e(Ce),(l[Ce].participant.individualParticipantIds||[])?.forEach(_e))}let ht=(ne?.structures??[]).reduce((pe,Se)=>(pe.includes(Se.stage)||pe.push(Se.stage),pe),[]),xt=(ne?.links??[]).length;R[ue]={qualifyingPositionAssignments:Tt,qualifyingSeedAssignments:Oe,mainPositionAssignments:mt,qualifyingSeedingMap:Xe,mainSeedAssignments:Le,orderedStructureIds:je,mainSeedingMap:Fe,flightNumber:ft,linksCount:xt,drawOrder:Ie,drawName:xe,drawType:Je,drawSize:lt,drawId:ue,stages:ht}}}if(d||f||h||m||A||g||y){let J=!!f||u,ie=Wh({afterRecoveryTimes:!!f,policyDefinitions:r,tournamentRecord:n,inContext:!0,participantMap:l,contextFilters:s,matchUpFilters:o,contextProfile:c,nextMatchUps:J,event:N})?.matchUps??[];for(let ue of ie){let{finishingPositionRange:ne,potentialParticipants:ge,tieMatchUps:he=[],sides:Ie=[],winningSide:xe,matchUpType:Je,matchUpId:qe,eventId:dt,drawId:ft,collectionId:je,stageSequence:Tt,finishingRound:Oe,matchUpStatus:mt,roundPosition:Le,roundNumber:lt,structureId:it,schedule:Fe,score:Xe,stage:ct}=ue;D[qe]=ue;let We={finishingPositionRange:ne,finishingRound:Oe,stageSequence:Tt,roundPosition:Le,collectionId:je,roundNumber:lt,structureId:it,schedule:Fe,eventId:dt,drawId:ft,score:Xe,stage:ct};cie({...We,...S,matchUpStatus:mt,winningSide:xe,matchUpType:Je,matchUpId:qe,sides:Ie});for(let ht of he){let{winningSide:xt,sides:pe=[],matchUpId:Se,matchUpStatus:ye,matchUpType:ke}=ht;cie({...We,...S,winningSide:xt,tieWinningSide:xe,matchUpTieId:qe,matchUpId:Se,sides:pe,matchUpSides:Ie,matchUpStatus:ye,matchUpType:ke})}Array.isArray(ge)&&(J||f||p)&&ge.flat().map(qi).filter(Boolean)?.forEach(ht=>{w(ht)?.forEach(xt=>{l[xt]&&(l[xt].potentialMatchUps[qe]=Lt({tournamentId:n?.tournamentId,matchUpId:qe,eventId:dt,drawId:ft}))}),(f||p)&&PTe({potential:!0,participantMap:l,participantId:ht,matchUpStatus:mt,roundPosition:Le,structureId:it,matchUpType:Je,roundNumber:lt,matchUpId:qe,schedule:Fe,drawId:ft,score:Xe})})}C.push(...ie)}}if(m||d||f){let N=Object.values(l);for(let k of N){let{wins:O,losses:x,[Dr]:{wins:F,losses:_},[br]:{wins:V,losses:G}}=k.counters,z=(Q,j,W)=>{let Y=j+W,X=j,J=Y&&X/Y;k.statistics[Q]={denominator:Y,numerator:X,statValue:J,statCode:Q}};if(m&&(z(Qk,O,x),z(`${Qk}.${Dr}`,F,_),z(`${Qk}.${br}`,V,G)),d){let Q=(j=[])=>Math.abs(j[0]-j[1]);for(let j of Object.keys(k.draws)){let{orderedStructureIds:W=[],flightNumber:Y}=R[j]||{};if(k.structureParticipation&&W.length){let X,J=0,ie=W.map(ue=>{let ne=k.structureParticipation[ue];if(!ne)return;X||(X=ne?.finishingPositionRange),Q(X)>Q(ne?.finishingPositionRange)&&(X=ne?.finishingPositionRange);let ge=ne.stage!==qt;return ge&&(J+=1),Lt({...ne,participationOrder:ge?J:void 0,flightNumber:Y})}).filter(Boolean);k.draws[j]&&(k.draws[j].finishingPositionRange=X,k.draws[j].structureParticipation=ie)}}}if(f){let Q=Xi(f)?f.scheduledMinutesDifference:0,j=k.scheduleItems||[],W=k.potentialMatchUps||{},Y=j.reduce((J,ie)=>{let{scheduledDate:ue,scheduledTime:ne}=ie;return J[ue]||(J[ue]=[]),ne&&J[ue].push(ie),J},{});Object.values(Y).forEach(J=>J.sort(vSe));for(let J of j){let{typeChangeTimeAfterRecovery:ie,timeAfterRecovery:ue,scheduledDate:ne,scheduledTime:ge}=J,he=Y[ne],Ie=sr(ge);for(let xe of he){if(xe.matchUpId===J.matchUpId||ks(xe.matchUpStatus)&&!xe.checkScoreHasValue)continue;let Je=J.matchUpType!==xe.matchUpType&&ie||ue,qe=J.drawId===xe.drawId,dt=W[J.matchUpId]&&W[xe.matchUpId],ft=sr(xe.scheduledTime),je=Math.abs(ft-Ie),Tt=ft>=Ie;if((Q&&!isNaN(Q)?je<=Q:Tt&&sr(xe.scheduledTime)<sr(Je))&&!(dt&&qe)&&Tt){let Oe=[J.matchUpId,xe.matchUpId].sort(p$).join("|");k.scheduleConflicts[Oe]={priorScheduledMatchUpId:J.matchUpId,matchUpIdWithConflict:xe.matchUpId}}}}let X=k.participant.participantId;Object.keys(k.scheduleConflicts).length&&T.push(X),l[X].scheduleConflicts=k.scheduleConflicts}}}return{participantIdsWithConflicts:T,eventsPublishStatuses:E,derivedEventInfo:P,derivedDrawInfo:R,mappedMatchUps:D,participantMap:l,matchUps:C}}function GM({participantFilters:t={},tournamentRecord:e,participants:i=[]}){if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:s,participantRoles:o,participantRoleResponsibilities:l,participantTypes:c,participantIds:u,signInStatus:d,enableOrFiltering:p,eventIds:f,genders:h}=t,m=Lf(f)&&e?.events?.filter(y=>f?.includes(y.eventId))||e?.events||[],A=n&&c9e({drawEntryStatuses:n,tournamentEvents:m}),g=s&&u9e({eventEntryStatuses:s,tournamentEvents:m}),v=a!==void 0&&[!0,!1].includes(a)&&m.reduce((y,I)=>y.concat(...(I.drawDefinitions||[]).map(w=>FUe({drawDefinition:w}).allPositionedParticipantIds).filter(Boolean)),[]),b=y=>r?.reduce((I,w)=>{let{accessor:S,value:T}=w,{values:D}=ly({element:y,accessor:S});return I&&D?.includes(T)},!0);if(i=i?.filter(y=>{let I=Eu({element:y,itemType:CM})?.timeItem?.itemValue,{participantRoleResponsibilities:w,participantType:S,participantRole:T,participantId:D,person:C}=y,E=Array.isArray(h)&&h?.length&&C?.sex&&h.includes(C.sex);return p?h&&E||a&&v.includes(D)||a===!1&&!v.includes(D)||A?.includes(D)||g?.includes(D)||u?.includes(D)||d&&I===d||c&&S&&Lf(c)&&c.includes(S)||o&&T&&Lf(o)&&o.includes(T)||l&&Lf(w)&&Lf(l)&&l.find(P=>w?.includes(P))||r?.length&&Lf(r)&&b(y):(!h||E)&&(a===void 0||a&&v.includes(D)||a===!1&&!v.includes(D))&&(!A||A.includes(D))&&(!g||g.includes(D))&&(!u||u.includes(D))&&(!d||I===d)&&(!c||S&&Lf(c)&&c.includes(S))&&(!o||T&&Lf(o)&&o.includes(T))&&(!l||Lf(w)&&Lf(l)&&l.find(P=>w?.includes(P)))&&(!r?.length||Lf(r)&&b(y))}),m.length&&f){let y=m.filter(I=>f.includes(I.eventId)).map(I=>{let w=(I.entries||[]).map(T=>T.participantId);if(Vn(mf)(I.eventType))return w;let S=(e?.participants??[]).filter(T=>w.includes(T.participantId)).map(T=>T.individualParticipantIds).flat(1);return w.concat(...S)}).flat(1);i=i?.filter(I=>y.includes(I.participantId))}return i}function Lf(t){return t&&Array.isArray(t)&&t.length}function c9e({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return Ei(e.reduce((r,n)=>{let{flightProfile:a}=kn({event:n}),s=a?.flights?.map(({drawEntries:l})=>Array.isArray(l)?l.filter(i).map(qi):[]).flat()||[],o=n.drawDefinitions?.map(({entries:l})=>l?l.filter(i).map(qi):[])||[];return r.concat(...s,...o)},[]))}function u9e({eventEntryStatuses:t,tournamentEvents:e}){return Ei(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(qi);return i.concat(...n)},[]))}function vn(t){let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:r,withRankingProfile:n,convertExtensions:a,policyDefinitions:s,withScheduleItems:o,tournamentRecord:l,scheduleAnalysis:c,withSignInStatus:u,withTeamMatchUps:d,withScaleValues:p,usePublishState:f,withStatistics:h,contextFilters:m,matchUpFilters:A,contextProfile:g,withOpponents:v,withMatchUps:b,internalUse:y,withSeeding:I,withEvents:w,withDraws:S,withISO2:T,withIOC:D}=t;if(!l)return{error:nt};(b||n)&&Bd({tournamentRecord:l});let C=ZUe({convertExtensions:a,tournamentRecord:l,withSignInStatus:u,withScaleValues:p,internalUse:y,withISO2:T,withIOC:D}),{participantMap:E}=C,P=l9e({withMatchUps:b??n,withEvents:w??n,withDraws:S??n,withPotentialMatchUps:r,participantFilters:i,withRankingProfile:n,convertExtensions:a,withScheduleItems:o,policyDefinitions:s,tournamentRecord:l,scheduleAnalysis:c,withTeamMatchUps:d,usePublishState:f,withStatistics:h,contextFilters:m,matchUpFilters:A,participantMap:E,withOpponents:v,contextProfile:g,withSeeding:I}),{participantIdsWithConflicts:R,eventsPublishStatuses:M,derivedEventInfo:N,derivedDrawInfo:k,mappedMatchUps:O}=P,x=P.matchUps;E=P.participantMap;let F=c??r,_=({potentialMatchUps:W,scheduleConflicts:Y,scheduleItems:X,participant:J,statistics:ie,opponents:ue,matchUps:ne,events:ge,draws:he})=>{let Ie=Object.values(he),xe=Object.values(ue);return v&&Ie?.forEach(Je=>{Je.opponents=xe.filter(qe=>qe.drawId===Je.drawId)}),Lt({...J,scheduleConflicts:c?Object.values(Y):void 0,draws:S||n?Ie:void 0,events:w||n?Object.values(ge):void 0,matchUps:b||n?Object.values(ne):void 0,opponents:v?xe:void 0,potentialMatchUps:F?Object.values(W):void 0,statistics:h?Object.values(ie):void 0,scheduleItems:o?X:void 0},!1,!1,!0)},V=new Map;for(let W of Object.keys(E))V.set(W,_(E[W]));let G=[...V.values()],z=s?.[vE]?.participant,Q=GM({participants:G,participantFilters:i,tournamentRecord:l});if(e){let W=Xi(e)?e:void 0;for(let Y of Q)for(let X of Y.individualParticipantIds??[]){Y.individualParticipants||(Y.individualParticipants=[]);let J=V.get(X),ie=W?nw({template:W,source:J}):J;Y.individualParticipants.push(ie)}}let j=z?Q.map(W=>nw({source:W,template:z})):Q;return{participantMap:t.returnParticipantMap!==!1?E:void 0,mappedMatchUps:t.returnMatchUps!==!1?O:void 0,matchUps:t.returnMatchUps!==!1?x:void 0,missingParticipantIds:C.missingParticipantIds,participantIdsWithConflicts:R,eventsPublishStatuses:M,derivedEventInfo:N,derivedDrawInfo:k,participants:j,...oe}}function lw(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:ba};let{participant:a,tournamentId:s}=nv({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...lh({participant:a,scaleAttributes:i}),tournamentId:s}:{error:Fn}}function d9e(t,e){let i=t.startDate||e?.startDate,r=t.endDate||e?.endDate;return!i||!r?{error:_6e}:!Ro(i)||!Ro(r)?{error:ma}:{startDate:i,endDate:r}}function uie(t,e){let i=new Date(Ui(t)),r=new Date(Ui(e)),n=r.getFullYear()-i.getFullYear(),a=r.getMonth()-i.getMonth();return(a<0||a===0&&r.getDate()<i.getDate())&&n--,n}function die(t,e,i){return!(e!==void 0&&t<e||i!==void 0&&t>i)}function p9e(t){return/^C\d{1,2}-\d{1,2}$/.test(t.ageCategoryCode||"")}function f9e(t,e,i,r){if(p9e(e))return{valid:!0};let n=e.ageMin,a=e.ageMax;if(e.ageCategoryCode&&!n&&!a){let d=xy({consideredDate:i,category:e});d.error||(n=d.ageMin,a=d.ageMax)}if(!n&&!a)return{valid:!0};let s=t.person?.birthDate;if(!s)return{valid:!1,reason:"Missing birthDate",details:{requiredMin:n,requiredMax:a}};let o=uie(s,i),l=uie(s,r),c=die(o,n,a),u=die(l,n,a);if(!c){let d=[n===void 0?null:`min: ${n}`,a===void 0?null:`max: ${a}`].filter(Boolean).join(", ");return{valid:!1,reason:`Age ${o} at event start (${i}) outside range [${d}]`,details:{birthDate:s,ageAtStart:o,ageAtEnd:l,requiredMin:n,requiredMax:a}}}if(!u){let d=[n===void 0?null:`min: ${n}`,a===void 0?null:`max: ${a}`].filter(Boolean).join(", ");return{valid:!1,reason:`Age ${l} at event end (${r}) outside range [${d}]`,details:{birthDate:s,ageAtStart:o,ageAtEnd:l,requiredMin:n,requiredMax:a}}}return{valid:!0}}function h9e(t,e,i,r){if(!e.ratingMin&&!e.ratingMax)return{valid:!0};if(!e.ratingType)return{valid:!0};let n={scaleType:"RATING",scaleName:e.ratingType,eventType:i.eventType},{scaleItem:a}=lw({tournamentRecord:r,participantId:t.participantId,scaleAttributes:n});if(!a?.scaleValue)return{valid:!1,reason:`Missing ${e.ratingType} rating`,details:{ratingType:e.ratingType,requiredMin:e.ratingMin,requiredMax:e.ratingMax}};let s;if(typeof a.scaleValue=="object"){let o=ly({element:a.scaleValue,accessor:a.scaleValue?.accessor});if(o===void 0)return{valid:!1,reason:`Cannot extract rating value from ${e.ratingType} scale item`,details:{ratingType:e.ratingType,requiredMin:e.ratingMin,requiredMax:e.ratingMax}};s=o}else s=a.scaleValue;return e.ratingMin!==void 0&&s<e.ratingMin?{valid:!1,reason:`${e.ratingType} rating ${s} below minimum ${e.ratingMin}`,details:{ratingType:e.ratingType,ratingValue:s,requiredMin:e.ratingMin,requiredMax:e.ratingMax}}:e.ratingMax!==void 0&&s>e.ratingMax?{valid:!1,reason:`${e.ratingType} rating ${s} above maximum ${e.ratingMax}`,details:{ratingType:e.ratingType,ratingValue:s,requiredMin:e.ratingMin,requiredMax:e.ratingMax}}:{valid:!0}}function m9e(t){let e=t.person;if(!e)return"Unknown";let i=e.standardGivenName||e.passportGivenName,r=e.standardFamilyName||e.passportFamilyName;return[i,r].filter(Boolean).join(" ")||"Unknown"}function A9e(t,e,i,r,n,a){let s=f9e(t,e,r,n),o=h9e(t,e,i,a);if(!s.valid||!o.valid){let l={participantId:t.participantId,participantName:m9e(t),rejectionReasons:[]};return s.valid||l.rejectionReasons.push({type:"age",reason:s.reason,details:s.details||{}}),o.valid||l.rejectionReasons.push({type:"rating",reason:o.reason,details:o.details||{}}),l}return null}function DI({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){if(!e)return{error:kt};let n=e.entries?.find(a=>a.participantId===t&&(!i||i===a.entryStatus)&&(!r||r===a.entryStage));return t&&n}function g9e({relevantLinks:t,drawDefinition:e,provisionalPositioning:i,roundQualifiersCounts:r}){let n=0;for(let a of t){let s=di({structureId:a.source.structureId,drawDefinition:e})?.structure;if(s?.stage===qt){let o=a.source.roundNumber,l=a.target.roundNumber,c;if(s.structureType===$o){let u=s.structures?.length??0,d=a.source.finishingPositions?.length??0;c=u*d}else c=dr({matchUpFilters:{roundNumbers:[o]},structure:s,afterRecoveryTimes:!1,provisionalPositioning:i,inContext:!1}).matchUps?.length||0;r[l]||(r[l]=0),r[l]+=c,n+=c}}return n}function TE(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,structureId:n,stage:a}=t;if(!i)return{error:kt};let{entryProfile:s}=PM({drawDefinition:i}),o=a&&r&&s?.[a]?.stageSequence?.[r]?.qualifiersCount||a&&s?.[a]?.qualifiersCount||0,l={};if(!n)return{qualifiersCount:o,roundQualifiersCounts:l};let{structure:c}=di({drawDefinition:i,structureId:n}),u=i.links?.filter(f=>f?.target?.structureId===c?.structureId),d=0;u?.length&&(d=g9e({relevantLinks:u,drawDefinition:i,provisionalPositioning:e,roundQualifiersCounts:l}));let p=Object.keys(l);if(p.length<=1){let f=p[0]||1;l[f]=Math.max(l[f]||0,o)}return d=Math.max(d,o),{qualifiersCount:d,roundQualifiersCounts:l}}function F_({stage:t,drawDefinition:e}){let{entryProfile:i}=PM({drawDefinition:e});return i?.[t]?.drawSize||0}function v9e(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=F_({stage:n,drawDefinition:i}),{qualifiersCount:s}=TE({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-s}function RTe({stage:t,drawDefinition:e}){return!!(t===Za||KY({stage:t,drawDefinition:e})&&F_({stage:t,drawDefinition:e}))}function MTe({entryStatus:t=Sl,drawDefinition:e,stageSequence:i,stage:r}){if(t===ud)return t7e({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...oe}:{error:Nwe};let n=v9e({drawDefinition:e,stageSequence:i,stage:r}),a=i7e({drawDefinition:e,stage:r}),s=L4({entryStatus:JT,drawDefinition:e,stage:r}),o=L4({entryStatus:Sl,drawDefinition:e,stage:r}),l=s+o,c=l>=n,u=n-l;return r!==Za&&c?{error:E4}:t===JT?s<a?{...oe}:{error:E4}:{positionsAvailable:u,...oe}}function l7(t){let e=Qt(t,[{[ro]:!0,[hUe]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:r=Sl,entryStageSequence:n,entryStage:a=Et,ignoreStageSpace:s,drawDefinition:o,entryPosition:l,participant:c,roundTarget:u,extensions:d,extension:p,drawType:f,event:h}=t,m="addDrawEntry";if(f!==ec&&!RTe({stage:a,drawDefinition:o}))return ce({result:{error:gb},stack:m});let A=MTe({stageSequence:n,stage:a,drawDefinition:o,entryStatus:r});if(!s&&!A.success&&(!f||f!==ec))return{error:A.error};if(p&&!gf({extension:p}))return ce({result:{error:we},info:"Invalid extension",context:{extension:p},stack:m});let g=t.participantId||c?.participantId;if(!g)return ce({result:{error:ba},stack:m});let v=r===Xm&&DI({participantId:g,drawDefinition:o,entryStatus:r}),b=a===Za&&DI({participantId:g,drawDefinition:o,entryStage:a}),y=DI({participantId:g,drawDefinition:o}),I=r!==Xm&&a!==Za&&y;if(I)return i?(Ii({payload:{drawId:o.drawId,eventId:h?.eventId,error:NP,participantId:g},topic:MY}),{...oe}):ce({result:{error:NP},context:{participantId:g},stack:m});if(v||b)return ce({context:{invalidEntry:I,invalidLuckyLoser:v,invalidVoluntaryConsolation:b},result:{error:U2},stack:m});let w=Lt({entryStageSequence:n,participantId:g,entryPosition:l,entryStatus:r,entryStage:a,extensions:d});return p&&ur({element:w,extension:p}),u&&ur({extension:{name:"roundEntry",value:u},element:w}),o.entries||(o.entries=[]),o.entries.push(w),kr({drawDefinition:o}),{...oe}}function y9e(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=Sl,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:s,drawDefinition:o,stageSequence:l,stage:c=Et,roundTarget:u,extension:d,event:p}=t,f=o.drawType===ec;if(!c)return{error:lwe};if(!o)return{error:kt};if(!Array.isArray(s))return{error:Ll};if(!f&&!RTe({stage:c,drawDefinition:o}))return{error:gb};if(d&&!gf({extension:d}))return ce({result:{error:we},info:"Invalid extension",context:{extension:d},stack:e});let h=MTe({drawDefinition:o,stageSequence:l,entryStatus:r,stage:c});if(!a&&!h.success&&!f)return{error:h.error};let m=h.positionsAvailable??0;if(!a&&!f&&c!==Za&&m<s.length)return{error:O8};let A=[],g=o.drawId,v=p?.eventId,b=s.reduce((y,I)=>{let w=r===Xm&&DI({participantId:I,drawDefinition:o,entryStatus:r}),S=c===Za&&DI({entryStage:c,drawDefinition:o,participantId:I}),T=DI({participantId:I,drawDefinition:o});return r!==Xm&&c!==Za&&T&&(A.push(I),i&&Ii({payload:{error:NP,participantId:I,eventId:v,drawId:g},topic:MY})),w||S?y.concat(I):y},[]);return A.length&&!i?ce({context:{eventId:v,drawId:g,duplicateEntries:A},result:{error:NP},stack:e}):(s.filter(y=>y&&!b.includes(y)).forEach(y=>{let I={entryStageSequence:l,entryStage:c,participantId:y,entryStatus:r};d&&ur({element:I,extension:d}),u&&ur({extension:{name:Mf,value:u},element:I}),o.entries||(o.entries=[]),o.entries.push(I)}),n&&(o.entries=tp({entries:o.entries})),kr({drawDefinition:o}),b?.length||A?.length?{info:"some participantIds could not be added",participantIdsNotAdded:b,duplicateEntries:A,...oe}:{...oe})}function c7({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,entryStage:l,extension:c,drawId:u,event:d}){if(!n?.length)return{error:Jg};if(!d)return{error:fu};if(!u)return{error:hp};let p=(d.entries||[]).map(qi);if(n.filter(m=>!p.includes(m)).length)return{error:swe};if(a){let m=y9e({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,extension:c});if(m.error)return m}let{flightProfile:f}=kn({event:d}),h=f?.flights.find(m=>m.drawId===u);return h?.drawEntries&&(n.forEach(m=>{let A=s===Xm&&XV({participantId:m,entryStatus:s,flight:h}),g=l===Za&&XV({participantId:m,entryStage:l,flight:h});!(s!==Xm&&l!==Za&&XV({flight:h,participantId:m}))&&!A&&!g&&h.drawEntries.push({participantId:m,entryStatus:s,entryStage:l})}),e&&(h.drawEntries=tp({entries:h.drawEntries}))),{...oe}}function XV({participantId:t,entryStatus:e,entryStage:i,flight:r}){let n=r.drawEntries?.find(a=>a.participantId===t&&(!e||e===a.entryStatus)&&(!i||i===a.entryStage));return t&&n}function QM({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){let a="removeEventEntries";if(!n?.eventId)return{error:Gr};if(!Array.isArray(e)||e.some(d=>!rn(d)))return ce({result:{error:lp},stack:a});let s=(n.drawDefinitions??[]).flatMap(d=>Cb({drawDefinition:d}).assignedParticipantIds??[]),o=(i?.length&&n.entries?.filter(d=>d.entryStatus&&i.includes(d.entryStatus))||[]).map(qi).filter(d=>!s.includes(d)),l=(r&&n.entries?.filter(d=>d.entryStage&&d.entryStage===r)||[]).map(qi).filter(d=>!s.includes(d));if(e.length?e=e.filter(d=>(!i?.length||o.includes(d))&&(!r||l.includes(d))):o.length&&l.length?e=Mn(o,l):o.length?e=o:l.length&&(e=l),e?.length&&s.some(d=>e.includes(d)))return ce({result:{error:pE},stack:a});if(!e?.length)return{...oe,participantIdsRemoved:[]};let c=[];n.entries=(n.entries??[]).filter(d=>{let p=!e.includes(d?.participantId);return p||c.push(d.participantId),p}),t&&(n.entries=tp({entries:n.entries}));let{flightProfile:u}=kn({event:n});return u?.flights?.forEach(d=>{d.drawEntries=(d.drawEntries||[]).filter(p=>!e.includes(p.participantId))}),n.drawDefinitions?.forEach(d=>{d.entries=(d.entries??[]).filter(p=>!e.includes(p.participantId))}),{...oe,participantIdsRemoved:c}}var NTe={[Ja]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},CE=NTe;function b9e(t,e,i,r){return e.gender&&i&&!(Tc(e.gender)||Ch(e.gender))&&Ks(e.gender)!==Ks(t.person?.sex)?(r.push({participantId:t.participantId,sex:t.person?.sex}),!1):!0}function I9e({participantIds:t,typedParticipantIds:e,checkTypedParticipants:i}){return t.filter(r=>!i||e.includes(r))}function w9e({tournamentRecord:t,participantIds:e,event:i,entryStatus:r,genderEnforced:n,mismatchedGender:a}){function s(u,d,p){return Vn(Dr)(d.eventType)&&u.participantType===Wi&&!zv(p)}function o(u,d,p){return d.eventType===br&&u.participantType===Ni&&!zv(p)}function l(u,d,p,f,h){return d.eventType===br&&u.participantType===Wi&&zv(p)?d.gender&&f&&!(Tc(d.gender)||Ch(d.gender))&&Ks(d.gender)!==Ks(u.person?.sex)?(h.push({participantId:u.participantId,sex:u.person?.sex}),!1):!0:!1}function c(u,d,p){return d.eventType===vr&&(u.participantType===vr||zv(p)&&u.participantType===Wi)}return t?.participants?.filter(u=>e.includes(u.participantId)?s(u,i,r)&&(!i.gender||!n||Tc(i.gender)||Ch(i.gender)||Ks(i.gender)===Ks(u.person?.sex))||o(u,i,r)||l(u,i,r,n,a)?!0:s(u,i,r)&&!b9e(u,i,n,a)?!1:c(u,i,r):!1).map(u=>u.participantId)??[]}function S9e({typedParticipantIds:t,categoryRejections:e,tournamentRecord:i,startDate:r,endDate:n,event:a}){let s=[];for(let o of t){let l=i.participants?.find(c=>c.participantId===o);if(l)if(a.category){let c=A9e(l,a.category,a,r,n,i);c?e.push(c):s.push(o)}else s.push(o)}return s}function U9e({enforceCategory:t,event:e,tournamentRecord:i,typedParticipantIds:r,categoryRejections:n}){if(t&&e.category&&i){let a=d9e(e,i);if(!("error"in a)){let{startDate:s,endDate:o}=a;return S9e({typedParticipantIds:r,tournamentRecord:i,event:e,startDate:s,endDate:o,categoryRejections:n})}}return r}function T9e({validParticipantIds:t,existingIds:e,entryStatus:i,entryStage:r,extensions:n,extension:a,roundTarget:s,entryStageSequence:o,addedParticipantIdEntries:l,event:c}){t.forEach(u=>{if(!e.has(u)){let d=Lt({participantId:u,entryStatus:i,entryStage:r,extensions:n});a&&ur({element:d,extension:a}),s&&ur({extension:{name:Mf,value:s},element:d}),o&&(d.entryStageSequence=o),l.push(d.participantId),c.entries?.push(d)}})}function C9e({tournamentRecord:t,removedEntries:e,event:i}){if(i.eventType&&[jm,Jl].includes(i.eventType)){let r=new Set((i.entries||[]).map(l=>l.participantId)),n=(i.entries||[]).filter(l=>zv(l.entryStatus)).map(l=>l.participantId),a=t?.participants??[],s=new Set(a.filter(l=>r.has(l.participantId)&&l.participantType&&[Ni,vr].includes(l.participantType)).map(l=>l.individualParticipantIds).flat(1/0)),o=n.filter(l=>s.has(l));o.length&&(e.push(...o),QM({participantIds:o,autoEntryPositions:!1,event:i}))}}function E9e(t,e){if(!Array.isArray(t.participantIds))return ce({result:{error:Ll},stack:e});let i=Ei(t.participantIds??[]);return t.event?i?.length?t.event?.eventId?{participantIds:i}:{error:fu}:ce({result:{error:Jg},stack:e}):{error:Gr}}function D9e({policyDefinitions:t,tournamentRecord:e,event:i,enforceGender:r}){let n=tr({tournamentRecord:e,event:i}).appliedPolicies??{},a=t?.[Ja]??n?.[Ja]??CE[Ja],s=(r??a?.participants?.enforceGender)!==!1;return{matchUpActionsPolicy:a,genderEnforced:s}}function P9e(t,e,i){return t&&(!Array.isArray(t)||!t.every(r=>gf({extension:r})))||e&&!gf({extension:e})?ce({context:Lt({extension:e,extensions:t}),result:{error:we},info:"Invalid extension(s)",stack:i}):null}function Yp(t){let{suppressDuplicateEntries:e=!0,entryStatus:i=Sl,autoEntryPositions:r=!0,enforceCategory:n=!1,enforceGender:a=!0,entryStageSequence:s,policyDefinitions:o,entryStage:l=Et,tournamentRecord:c,ignoreStageSpace:u,drawDefinition:d,roundTarget:p,extensions:f,extension:h,drawId:m,event:A}=t,g="addEventEntries",v=E9e(t,g);if("error"in v)return v;let b="participantIds"in v?v.participantIds:[],y=P9e(f,h,g);if(y)return y;let{genderEnforced:I}=D9e({policyDefinitions:o,tournamentRecord:c,event:A,enforceGender:a}),w=[],S=[],T=!!c,D=[],C,E=w9e({tournamentRecord:c,participantIds:b,event:A,entryStatus:i,genderEnforced:I,mismatchedGender:D}),P=[];E=U9e({enforceCategory:n,event:A,tournamentRecord:c,typedParticipantIds:E,categoryRejections:P});let R=I9e({participantIds:b,typedParticipantIds:E,checkTypedParticipants:T});A.entries??=[];let M=new Set(A.entries.map(O=>O.participantId||O.participant?.participantId));if(T9e({validParticipantIds:R,existingIds:M,entryStatus:i,entryStage:l,extensions:f,extension:h,roundTarget:p,entryStageSequence:s,addedParticipantIdEntries:w,event:A}),m&&!zv(l)){let O=c7({participantIds:R,suppressDuplicateEntries:e,autoEntryPositions:r,entryStageSequence:s,ignoreStageSpace:u,drawDefinition:d,entryStatus:i,roundTarget:p,entryStage:l,extension:h,drawId:m,event:A});O.error&&(C=O.error)}if(C9e({event:A,tournamentRecord:c,removedEntries:S}),R.length!==b.length)return ce({context:Lt({categoryRejections:P.length?P:void 0,mismatchedGender:D.length?D:void 0,gender:A.gender}),result:{error:Ll},stack:g});r&&(A.entries=tp({entries:A.entries||[]}));let N=w.length,k=S.length;return ce({result:{...oe,addedEntriesCount:N,removedEntriesCount:k,...P.length&&{context:Lt({categoryRejections:P})}},stack:g,info:C})}var BTe="ADMINISTRATION",R9e="CAPTAIN",M9e="COACH",xs="COMPETITOR",kTe="MEDIA",xTe="MEDICAL",u7="OFFICIAL",_Te="OTHER",OTe="SECURITY",d7={ADMINISTRATION:BTe,CAPTAIN:R9e,COACH:M9e,COMPETITOR:xs,MEDIA:kTe,MEDICAL:xTe,OFFICIAL:u7,OTHER:_Te,SECURITY:OTe};function p7({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return ce({result:{error:nt},stack:a});if(!i||!e)return ce({result:{error:Yt},stack:a});let s=(r.participants??[]).find(u=>u.participantId===i);if(!s)return ce({result:{error:Fn},stack:a});if(![vr,Lc].includes(s.participantType))return ce({result:{participantType:s.participantType,error:cp},stack:a});let o=FTe({individualParticipantIds:e,groupingParticipant:s,tournamentRecord:r,suppressErrors:n}),{removed:l,error:c}=o;if(c)return ce({result:o,stack:a});if(t)for(let u of r.events??[]){let d=(u.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l?.filter(f=>!d.includes(f));Yp({participantIds:p,entryStatus:Du,tournamentRecord:r,event:u})}}return l&&Ii({topic:$s,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...oe,...o}}function FTe({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){let s=[];if(!e)return{removed:s};let o=[],l=[];a||({participants:a,mappedMatchUps:n}=vn({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let c=a?.find(({participantId:p})=>p===e.participantId)?.events?.map(({eventId:p})=>p),u=(e.individualParticipantIds??[]).filter(p=>{let f=t?.includes(p),h=f&&a?.find(A=>A.participantId===p)?.matchUps.filter(({eventId:A})=>c.includes(A)).map(({matchUpId:A})=>n?.[A]).filter(({winningSide:A,score:g})=>A||wa({score:g})),m=f&&!h?.length;if(f&&!m&&l.push(p),m){s.push(p);for(let A of i.events??[])for(let g of A.drawDefinitions??[]){let{extension:v}=ki({element:g,name:qm}),b=v?.value[e.participantId];v&&b&&(v.value[e.participantId]=b.filter(I=>I.participantId!==p),ur({element:g,extension:v}),UM({drawDefinition:g}));let y=No({drawDefinition:g,inContext:!1}).matchUps??[];for(let I of y){let w=I.sides??[];for(let S of w){let T=S.lineUp??[];T.find(D=>D.participantId===p)&&(S.lineUp=T.filter(D=>D.participantId!==p),Zi({tournamentId:i?.tournamentId,drawDefinition:g,matchUp:I}))}}}}else o.push(p);return!m});e.individualParticipantIds=u;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:o,removed:s};return l.length&&!r&&{...d,cannotRemove:l,error:w2}||d}function f$({participantRole:t=xs,individualParticipantIds:e=[],groupingTypes:i=[qo,Lc],tournamentRecord:r}){if(!r)return{error:nt};let n=r.participants??[],{participants:a,mappedMatchUps:s}=vn({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),o=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:c}=FTe({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:s,participants:a});c&&o++}),o?oe:{error:Ewe}}function vS(t){let e=Qt(t,[{[Ua]:!0},{participantIds:!0,[rl]:qs,[cd]:Jg}]);if(e.error)return e;let{addIndividualParticipantsToEvents:i,tournamentRecord:r,participantIds:n}=t,a=r.participants?.length||0;if(!a)return{...oe};let s=(r.events||[])?.filter(({eventType:h})=>h===da).map(h=>h?.drawDefinitions?.map(({drawId:m})=>m)).flat(1/0),o=vn({participantFilters:{participantIds:n},tournamentRecord:r,withDraws:!0}).participants??[],l=h=>{let m=(as({matchUpFilters:{drawIds:h,matchUpTypes:[br]},tournamentRecord:r}).matchUps??[]).flatMap(({sides:A})=>A?.map(({participantId:g})=>g||[])).filter(Boolean);return Mn(m,n)},c=s?.length?l(s):[],u=o.filter(h=>h.draws?.filter(m=>(!s?.length||!s?.includes(m.drawId))&&m.positionAssignments).length);if(c?.length||u.length)return{error:pE};let d={},p={};for(let h of r.events||[]){let m=QM({participantIds:n,event:h});if(m.error)return m;d[h.eventId]=m.participantIdsRemoved}r.participants=(r.participants??[]).filter(h=>{let m=n.includes(h.participantId)||h.participantType===Ni&&h.individualParticipantIds?.some(A=>n.includes(A));if(!m&&h.participantType===da&&h.individualParticipantIds?.some(A=>n.includes(A))&&(h.individualParticipantIds=h.individualParticipantIds.filter(A=>!n.includes(A))),m&&i&&h.participantType&&[Ni,vr].includes(h.participantType))for(let A of h.individualParticipantIds||[])n.includes(A)||(p[h.participantId]||(p[h.participantId]=[]),p[h.participantId].push(A));return!m});let f=a-r.participants.length;if(f$({individualParticipantIds:n,tournamentRecord:r}),i)for(let h of r.events||[]){let m=d[h.eventId].map(A=>p[A]||[]).flat();Yp({participantIds:m,entryStatus:Du,tournamentRecord:r,event:h})}return f&&Ii({payload:{participantIds:n,tournamentId:r.tournamentId},topic:NY}),f?{...oe,participantsRemovedCount:f}:{error:w2}}function LTe({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){let s=n.entries??[];if(r){let{flightProfile:l}=kn({event:n}),c=l?.flights?.find(u=>u.drawId===r);c?s=c.drawEntries:e.entries&&(s=e?.entries)}let o=s.filter(l=>(!i?.length||!l.entryStatus||i.includes(l.entryStatus))&&(!a||!l.entryStage||l.entryStage===a)&&(!t||l.entryStatus&&Nd.includes(l.entryStatus)));return{entries:s,stageEntries:o}}function $Te({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:s}){let o="destroyGroupEntry";if(!e)return{error:nt};if(!r)return ce({result:{error:ba},stack:o});if(!s)return{error:Gr};if(!s.eventType||![jm,Jl].includes(s.eventType))return ce({result:{error:Th},stack:o});let l=e.participants??[],c=l.find(g=>g.participantId===r);if(!c)return ce({result:{error:Fn},stack:o});if(!c.participantType||![Ni,qo].includes(c.participantType)||c.participantType===qo&&s.eventType!==Jl||c.participantType===Ni&&s.eventType!==jm)return{error:cp};let u=(s.entries??[]).find(g=>g.participantId===r);if(!u)return{error:Mwe};let{stageEntries:d}=LTe({selected:!1,drawDefinition:i,drawId:n,event:s,stage:a}),p=d.map(qi),f=l.filter(({participantId:g})=>p.includes(g)).map(({individualParticipantIds:g})=>g).flat().filter(Boolean),h=c.individualParticipantIds?.filter(g=>Wp(g,f).length===1),m=QM({participantIds:[r],event:s});if(m.error||h?.length&&(m=Yp({participantIds:h,entryStatus:Du,entryStage:u.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:s}),m.error))return m;let A;return t&&vS({participantIds:[r],tournamentRecord:e}).success&&(A=!0),{...oe,participantRemoved:A}}function f7({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return $Te({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function HTe(t){if(!t.tournamentRecord)return{error:nt};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let s=$Te({participantId:a,...i});s.success&&(r+=1),s.error&&n.push(s.error)}return r?{destroyedCount:r,...oe}:{error:n}}function XP(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:s,drawId:o}=t,l="removeDrawPositionAssignment",c=HM(t);if(c.error)return ce({result:c,stack:l});let{participantId:u}=c,{drawPosition:d,event:p,structureId:f}=t,h=tr({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([ud,kh].includes(a)&&u){let{tournamentRecord:A}=t,{participant:g}=nv({tournamentRecord:A,participantId:u}),{participantType:v,individualParticipantIds:b}=g??{};if(n&&v===Ni){let y=f7({tournamentRecord:A,drawDefinition:r,participantId:u,event:p});if(y.error)return ce({result:y,stack:l});b&&O_({participantIds:b,tournamentRecord:A,drawDefinition:r,entryStatus:a,drawId:o,event:p})}else O_({participantIds:[u],tournamentRecord:A,drawDefinition:r,entryStatus:a,drawId:o,event:p})}if(i){let A=Hc({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:f,matchUpsMap:s,event:p});if(A.error)return ce({result:A,stack:l})}let{structure:m}=di({drawDefinition:r,structureId:f});return GY({structure:m,drawPositions:[d]}),TM({appliedPolicies:h,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:f}}),c}function VTe(t){return Object.assign(t,{entryStatus:kh}),XP(t)}var lg=({finishingPosition:t=oS,hasExistingDrawDefinition:e,qualifyingRoundNumber:i,structureAbbreviation:r,seedAssignments:n=[],stageSequence:a=1,qualifyingOnly:s,structureOrder:o,seedingProfile:l,matchUpFormat:c,structureType:u,structureName:d,matchUps:p=[],matchUpType:f,structureId:h,roundOffset:m,roundLimit:A,stageOrder:g,structures:v,tieFormat:b,stage:y})=>{let I={structureId:h??hr(),structureAbbreviation:r,finishingPosition:t,seedAssignments:n,matchUpFormat:c,stageSequence:a,structureName:d};(s||e&&b)&&(I.tieFormat=b),o&&(I.structureOrder=o),u&&(I.structureType=u),l&&(typeof l=="string"?I.seedingProfile=l:typeof l=="object"&&typeof l.positioning=="string"&&(I.seedingProfile=l.positioning)),f&&(I.matchUpType=f),m&&(I.roundOffset=m),g&&(I.stageOrder=g),A&&(I.roundLimit=A),y&&(I.stage=y),i&&(I.qualifyingRoundNumber=i);let w=p.flatMap(({drawPositions:S})=>S).filter(Boolean);return v?I.structures=v:(I.matchUps=p,I.positionAssignments=Ei(w).sort((S,T)=>S-T).map(S=>({drawPosition:S}))),I},nu=lg;function z4(t){return rn(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function _s(t){return rn(t)?z4(t.replace(/_/g," ")):""}function h7({structureName:t=_s(Za),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:kt};let a=nu({stage:Za,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),kr({drawDefinition:i,structureIds:[a.structureId]}),{...oe}}function N9e({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(ua),e.reverse(),e}function B9e({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function k9e({positioning:t,size:e}){let i=N9e({size:e}),r=[],n=[],a=p=>p[0],s=p=>p[p.length-1],o=(p,f)=>(t&&[AM,O2,_y].includes(t)&&f%2?s(p):a(p))||a(p),l=(p,f)=>{if(p.every(h=>!n.includes(h))){let h=o(p,f);return n.push(h),h}},c=p=>{let f=p.filter(h=>!n.includes(h));if(f.length)return n.push(...f),f},u=(p,f)=>{let h=o(p,f);if(!n.includes(h))return n.push(h),h},d=vt(1,e+1);for(let p of i)if(p===1){let f=$a(d,2),h=f.map(l).filter(Boolean);h.length&&r.push(h);let m=f.flatMap(c).filter(Boolean);m.length&&r.push(m)}else{let f=$a(d,p).map(u).filter(Boolean);f.length&&r.push(f)}return{divisions:i,divisionGroupings:r}}function m7({drawPositions:t}){if(!t?.length)return{error:aM};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=Ei(i.map(h$)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function h$(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(ua).join("|")}function GTe({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,f)=>f),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),s=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((A,g)=>{n[p].push([a[g],s[g]])});let f=a.shift(),h=a.pop(),m=s.shift();a=[f,m,...a].filter(Boolean),s=[...s,h].filter(Boolean)});let o=a.shift(),l=a.pop(),c=s.shift();a=[o,c,...a].filter(Boolean),s=[...s,l].filter(Boolean);let u=d=>d[0].reduce((p,f)=>p+f);return[...n].reverse().sort((d,p)=>u(d)-u(p)).map(d=>d.filter(p=>p.every(f=>f<=t)).map(p=>{let f=p.map(h=>h+e);return h$(f)}))}function x9e({rounds:t,hash:e}){return t?.length?t?.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Yt}}var _9e={getRoundRobinGroupMatchUps:m7,determineRoundNumber:x9e,drawPositionsHash:h$,groupRounds:GTe};function jM(t){let{hasExistingDrawDefinition:e,groupNameBase:i="Group",playoffAttributes:r,stageSequence:n=1,structureOptions:a,appliedPolicies:s,qualifyingOnly:o,seedingProfile:l,stage:c=Et,matchUpType:u,roundTarget:d,structureId:p,groupNames:f,tieFormat:h,drawSize:m,idPrefix:A,isMock:g,uuids:v}=t,b=t.structureName??r?.["0"]?.name??_s(Et),{groupCount:y,groupSize:I}=O9e({structureOptions:a,appliedPolicies:s,drawSize:m}),w=Fy,S,T=vt(1,y+1).map(C=>{let E=F9e({groupSize:I,structureOrder:C,matchUpType:u,drawSize:m,idPrefix:A,isMock:g});S=Array.isArray(E)?Math.max(...E.map(({roundNumber:R})=>R??0)):0;let P=f?.[C-1]??`${i} ${C}`;return lg({structureId:v?.pop(),hasExistingDrawDefinition:e,structureType:F2,finishingPosition:w,qualifyingOnly:o,structureOrder:C,structureName:P,tieFormat:h,matchUps:E})}),D=lg({structureId:p??v?.pop(),hasExistingDrawDefinition:e,structureType:$o,finishingPosition:w,seedingProfile:l,structureName:b,stageSequence:n,structures:T,tieFormat:h,stage:c});return d&&ur({extension:{name:Mf,value:d},element:D}),{structures:[D],maxRoundNumber:S,groupCount:y,links:[],groupSize:I,...oe}}function O9e({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e?.groupSize,n=e?.groupSizeLimit||8,{validGroupSizes:a}=zM({groupSizeLimit:n,drawSize:i}),s=a&&Math.max(...a);r&&a?.includes(r)||(r&&r>4||!a?.includes(4)?r=s:r=4);let o=Math.ceil(i/r);return{groupSize:r,groupCount:o}}function zM(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=vt(3,e+1).filter(n=>{let a=Math.ceil(i/n),s=a*n-i,o=Math.ceil(i/a),l=Math.ceil(s/a);return(!s||s<n)&&o===n&&o>=3&&l<2});return{...oe,validGroupSizes:r}}function F9e({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:s}){let o=(t-1)*i,l=vt(1+o,i+1+o),c=m7({drawPositions:l}).uniqueMatchUpGroupings??[],u=GTe({groupSize:i,drawPositionOffset:o});return c.map(p).sort((f,h)=>(f.roundNumber??1/0)-(h.roundNumber??1/0));function d(f){return u.reduce((h,m,A)=>m.includes(f)?A+1:h,void 0)}function p(f){let h=h$(f),m=d(h),A=[1,r],g=L9e({structureOrder:t,drawPositions:f,roundNumber:m,idPrefix:n,uuids:s}),v={matchUpStatus:m?Nn:"BYE",matchUpType:e,finishingPositionRange:{winner:A,loser:A},drawPositions:f,roundNumber:m,matchUpId:g};return a&&(v.isMock=!0),v}}function L9e({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:n?.pop()||hr()}function A7(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!wi(i))return{seedBlocks:void 0,...ce({result:{error:we},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=lE(i);if(e){let f=Math.min(e,n),h=[],m=1;for(vt(0,f).forEach(()=>{h.push([m]),m++});m<n;){let A=vt(m,m+f);m+=f,h.push(A)}return{...oe,seedBlocks:h}}let a=vt(1,n+1),s=[],o=n/2;for(;o>1;){let f=$a(a,o),h=f.length;f.forEach((m,A)=>{let g,v=A<h/2,b=A%2===0,y=m[0],I=m[m.length-1];r&&h>4?h===8?g=v?I:y:g=b?y:I:g=v?y:I,_o(m,s)||s.push(g)}),o=o/2}let l=a.filter(f=>!s.includes(f));for(;l.length;)l.length%2===0?s.push(l.pop()):s.push(l.shift());let c=vt(0,20).map(f=>Math.pow(2,f));c.unshift(1);let u=c.indexOf(n),d=0,p=[];return vt(0,u).forEach(f=>{p.push(s.slice(d,d+c[f])),d+=c[f]}),{...oe,seedBlocks:p}}function g7({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!wi(e))return{seedGroups:void 0,...ce({result:{error:we},context:{drawSize:e},stack:i})};if(t){if(!wi(t))return{seedGroups:void 0,...ce({context:{roundRobinGroupsCount:t},result:{error:we},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:vt(0,n).map(()=>{let a=vt(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=A7({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function v7({roundRobinGroupsCount:t,participantsCount:e}){if(t){let{validGroupSizes:n}=zM({drawSize:e});if(!n?.map(a=>Math.ceil(e/a))?.includes(t))return ce({context:{roundRobinGroupsCount:t},result:{error:we}})}let{seedGroups:i}=g7({drawSize:e,roundRobinGroupsCount:t}),r=i?.map(n=>Math.min(...n))||[];return{...oe,seedingThresholds:r}}function tC(t){if(!t)return 1/0;if(wi(t))return ci(t);let e=t.split("-")[0];return wi(e)?ci(e):1/0}function yS({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:s}){let o=[];if(!s)return{error:Ab};let{matchUps:l,roundMatchUps:c}=dr({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:s}),{seedAssignments:u}=Au({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:s}),{positionAssignments:d}=Ia({structure:s}),p=d?.length,f=u?.length??0,h=[],m=Object.keys(c).map(k=>Number.parseInt(k)).sort((k,O)=>k-O).map(k=>{let O=c[k].map(F=>F.drawPositions).flat(1/0).filter(Boolean),x=O.filter(F=>!h.includes(F));return h=h.concat(...O),x}).filter(k=>k.length).reverse(),A=m.pop()??[],g=A&&Math.min(...A)-1||0;r=r??i?.seeding?.seedingProfile;let v=A?.length||0,b=m.filter(k=>k.filter(O=>O<=f).length),{stage:y,structureType:I,roundLimit:w}=s,S=I===$o,T=!S&&m?.length,D=!S&&y===qt&&w,C=b.flat(1/0),E=T?C?.length:0,P=a?p:f,R=YY({drawDefinition:n,structure:s,matchUps:l}),M=R?0:!T&&P||P&&C.length<P&&P-C.length||0;if(D){let k=s?.matchUps?s.matchUps.filter(({roundNumber:x})=>x===s.roundLimit).length:0,O=A.length/k;if(!T){let x=qM(r),F=$a(A,O),_=1,V=vt(0,F[0].length).map(()=>{let G=vt(_,_+F.length);return _+=F.length,G});({validSeedBlocks:o}=QTe({drawPositionBlocks:F,nonRandom:r?.nonRandom,positioning:x,seedGroups:V}))}}else S?{validSeedBlocks:o}=$9e({nonRandom:r?.nonRandom,seedingProfile:r,structure:s}):T?o=b.map(k=>({seedNumbers:k,drawPositions:k})):R&&$a(A,2).map((k,O)=>({drawPositions:[k[0]],seedNumbers:[O+1]})).forEach(k=>o.push(k));if(!S&&!R&&!D){let{blocks:k}=H9e({drawPositionOffset:g,seedNumberOffset:E,seedCountGoal:M,seedingProfile:r,baseDrawSize:v});k.forEach(O=>o.push(O))}let N=o.flatMap(k=>k.drawPositions).reduce((k,O)=>A?.includes(O)&&k,!0);return!R&&!T&&!S&&!N?{error:iwe,validSeedBlocks:[],isContainer:S,isFeedIn:T}:{isLuckyStructure:R,validSeedBlocks:o,isContainer:S,isFeedIn:T}}function $9e({seedingProfile:t,structure:e,nonRandom:i}){let r=e.structures||[],n=r.length,a=wr({structure:e})?.positionAssignments,s=qM(t),o=a?.length??0,{seedGroups:l}=g7({roundRobinGroupsCount:n,drawSize:o}),c=r.map(u=>wr({structure:u}).positionAssignments?.map(d=>d.drawPosition));return QTe({drawPositionBlocks:c,positioning:s,seedGroups:l,nonRandom:i})}function QTe({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=k9e({size:i.length,positioning:e}),s=[];return i.forEach((o,l)=>{let c=B9e({blockPattern:a,index:l});o.forEach((u,d)=>{let p=l%2?t.length-d-1:d,f=t[p].slice().filter((m,A)=>c.includes(A+1)&&m);e!==_y?f=r?f:Po(f):l%2&&f.reverse();let h=f.find(m=>!s.includes(m));h&&(s.push(h),n.push({drawPositions:[h],seedNumbers:[u]}))})}),{validSeedBlocks:n}}function H9e(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:s}=t,o,l=[],{seedBlocks:c}=A7({cluster:[AM,O2].includes(qM(n)),participantsCount:s,roundRobinGroupsCount:i});o=0;for(let u of c){if(o+1>a)break;let d=u.map(f=>f+e),p=V9e(o+1,u.length).map(f=>+f+r);o+=u.length,l.push({drawPositions:d,seedNumbers:p})}return{blocks:l}}function V9e(t,e){return Array.from(new Array(e),(i,r)=>r+t)}function L_({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){let{structure:s}=di({drawDefinition:e,structureId:n});t??=tr({drawDefinition:e}).appliedPolicies;let o=i?.validSeedBlocks;return!o&&s&&(o=yS({appliedPolicies:t,drawDefinition:e,structure:s})?.validSeedBlocks),t?.seeding?.validSeedPositions?.ignore?!0:t?.seeding?.validSeedPositions?.strict?(o.find(l=>l.seedNumbers.includes(a))?.drawPositions||[]).includes(r):o.flatMap(l=>l.drawPositions).includes(r)}function jTe(t){let{provisionalPositioning:e,drawDefinition:i,seedingProfile:r,seedBlockInfo:n,structureId:a,randomize:s}=t,{structure:o}=di({drawDefinition:i,structureId:a}),{seedAssignments:l}=Au({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:o}),{positionAssignments:c}=Ia({structure:o}),u=c?.filter(P=>P.participantId??P.bye??P.qualifier)?.map(P=>P.drawPosition).filter(Boolean),{appliedPolicies:d}=tr({drawDefinition:i}),p=(n?.validSeedBlocks||o&&yS({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:r,structure:o})?.validSeedBlocks||[]).find(P=>P.drawPositions.filter(R=>!u?.includes(R)).length),f=l?.map(P=>P.participantId).filter(Boolean),h=c?.map(P=>P.participantId).filter(Boolean),m=f?.filter(P=>h?.includes(P)),A=f?.filter(P=>!h?.includes(P)),g=l?.filter(P=>A?.includes(P.participantId)),v=l?.filter(P=>!P.participantId),b=(g?.length&&g.length>0?g.length:v?.length??0)&&p?.drawPositions.filter(P=>!u?.includes(P))||[],y=s?Po(b):b,I=[],w=y.map(()=>{let P=E(g,I)?.participantId;return P&&I.push(P),P}).filter(Boolean),S=l?.filter(P=>m?.includes(P.participantId)).map(P=>P.seedNumber),T=(p?.seedNumbers||[]).filter(P=>!S?.includes(P)),D=l?.filter(P=>T.includes(P.seedNumber)).map(P=>P.participantId),C=d?.seeding?.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:typeof C!="boolean"||C?w:D,unplacedSeedNumbers:T,unfilledPositions:y,unplacedSeedAssignments:g};function E(P,R){let M=P.filter(O=>!R.includes(O.participantId)),N=Math.min(...M.map(O=>tC(O.seedValue))),k=M.filter(O=>tC(O.seedValue)===N);return Po(k).pop()}}function qM(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function EE({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:s,seedNumber:o,seedValue:l,eventId:c,event:u}){let d="assignSeed",{structure:p}=di({drawDefinition:i,structureId:s}),{positionAssignments:f}=Ia({structure:p}),h=Au({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,m=h.map(I=>I.seedNumber),A=DI({drawDefinition:i,participantId:n});if(n&&!A)return ce({result:{error:lp},context:{participantId:n},stack:d});let g=u?kn({event:u}).flightProfile?.flights?.length:0,v=g&&g>1,b=f?.find(I=>I.participantId===n)?.drawPosition;if(b&&!L_({drawPosition:b,drawDefinition:i,seedBlockInfo:a,structureId:s,seedNumber:o}))return ce({result:{error:S8},context:{assignedDrawPosition:b},info:"invalid seed position",stack:d});m.includes(o)||h.push({seedNumber:o,seedValue:l});let y;return h.forEach(I=>{I.participantId===n&&I.seedNumber!==o&&(I.participantId=void 0),I.seedNumber===o&&(I.participantId=n,!r?.groupSeedingThreshold&&!v&&(I.seedValue=l??o),y=!0)}),y?(zUe({tournamentId:e?.tournamentId,drawDefinition:i,structure:p,eventId:c}),{...oe}):ce({result:{error:twe},stack:d})}function y7({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:s}){let o=t?.sides?.[e]?.sideNumber,l=o&&a.sides?.find(p=>p.sideNumber===o),{extension:c}=ki({element:n,name:qm}),u=c?.value||{},d=Dt(u[i],!1,!0);if(l)a?.sides?.forEach(p=>{p.sideNumber===o&&(p.lineUp=d)});else{a.sides=[1,2].map(f=>({...a.sides?.find(h=>h.sideNumber===f)??{},sideNumber:f}));let p=a.sides.find(f=>f.sideNumber===o);p&&(p.lineUp=d)}Zi({tournamentId:r?.tournamentId,context:"updateSidLineUp",eventId:s?.eventId,drawDefinition:n,matchUp:a})}function zTe(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,s=i.roundNumber>1&&i.roundNumber-1,o=Cg({structureId:r.structureId,matchUpsMap:n});!e&&a&&(e=o.find(({drawPositions:h,roundNumber:m})=>m===s&&h?.includes(a)));let l=e?.roundPosition,c=l%2?1:-1,u=l+c,d=s&&o.find(({roundNumber:h,roundPosition:m})=>h===s&&m===u),p=d?.matchUpStatus,f=[An,Aa].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:f}}function G9e({drawPosition:t,drawPositions:e}){let i=!1,r=!!e?.includes(t);return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(ua).filter(Boolean),positionAdded:i,positionAssigned:r}}function qTe({structureId:t,matchUpsMap:e,matchUp:i}){let r=i?.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:Cg({matchUpsMap:e,structureId:t}).find(({roundNumber:s,roundPosition:o})=>s===i?.roundNumber&&o===a)}}function WTe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(o=>o.matchUpId===i),{pairedPreviousMatchUp:s}=qTe({structureId:a?.structureId,matchUp:a,matchUpsMap:r});if(a&&s){let o=s?.matchUpId,l=t.find(u=>u.matchUpId===o),c=a?.structureId===l?.structureId?a?.roundPosition<l?.roundPosition&&1||2:a.structureId===l?.structureId&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(u=>{let d=rn(u)||!isNaN(u)?{code:u}:u;return d.sideNumber===c?{...d,previousMatchUpStatus:e}:d})}}function Wk({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,s)=>a.drawPositions?.includes(e)?s+1:n,void 0)}function PI({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:s,matchUpsMap:o,matchUpId:l,event:c}){let u="assignMatchUpDrawPosition";o||(o=os({drawDefinition:n})),t||(t=ia({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[]);let d=t.find(R=>R.matchUpId===l),p=d?.structureId,f=n?.structures?.find(R=>R.structureId===p);if(!f)return{error:an};let h=o?.drawMatchUps?.find(R=>R.matchUpId===l),m=h?.drawPositions??[],{positionAdded:A,positionAssigned:g,updatedDrawPositions:v}=G9e({drawPositions:m,drawPosition:s}),{positionAssignments:b}=wr({drawDefinition:n,structure:f}),y=b?.filter(R=>v.includes(R.drawPosition))?.find(({bye:R})=>R),I=h?.matchUpStatus&&ks(h.matchUpStatus)&&v.filter(Boolean).length<2;a=y&&"BYE"||a||I&&h.matchUpStatus||h?.matchUpStatus&&[An,Aa].includes(h.matchUpStatus)&&h.matchUpStatus||Nn;let w=!!(ks(h?.matchUpStatus)&&h?.winningSide);if(h&&A){t=ia({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[];let R=I&&Wk({inContextDrawMatchUps:t,drawPosition:s,matchUpId:l})||w&&h.winningSide||void 0;h?.matchUpStatusCodes&&WTe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:o,matchUp:h}),Object.assign(h,{drawPositions:v,winningSide:R,matchUpStatus:w?h?.matchUpStatus:a}),Zi({tournamentId:i?.tournamentId,eventId:d?.eventId,context:u,drawDefinition:n,matchUp:h})}let S=Fo({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:T,loserMatchUp:D,loserTargetDrawPosition:C},targetLinks:{loserTargetLink:E}}=S,P=Cg({structureId:f.structureId,matchUpsMap:o});if(g&&y){if(T)if(["BYE",An,Aa].includes(a)){let R=PI({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(R.error)return R}else{let{structureId:R}=T;R!==f.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(g&&w){if(T){let R=PI({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(R.error)return R}}else if(T&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:R}=zTe({targetMatchUp:h,drawPosition:s,matchUpsMap:o,structure:f});if(R){let M=PI({matchUpId:T.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(M.error)return M}}if(h?.matchUpType===Hr){let R=t?.find(({matchUpId:k})=>k===h.matchUpId),M=(R?.sides??[]).reduce((k,O,x)=>O.drawPosition===s?x:k,void 0),N=b?.find(k=>k.drawPosition===s)?.participantId;N&&M!==void 0&&y7({inContextTargetMatchUp:R,drawPositionSideIndex:M,teamParticipantId:N,tournamentRecord:i,drawDefinition:n,matchUp:h})}if(E?.linkCondition===Af&&v.filter(Boolean).length===2&&!y&&P.filter(({drawPositions:R,roundNumber:M})=>M===1&&_o(R,v)).every(({matchUpStatus:R})=>[Hn,Ha].includes(R))&&D){let{structureId:R}=D,M=Hc({drawPosition:C,tournamentRecord:i,drawDefinition:n,structureId:R,matchUpsMap:o,event:c});if(M.error)return M}return g?{...oe}:ce({result:{error:$T},context:{drawPosition:s},stack:u})}function KTe({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){let a=IE({drawDefinition:e})?.containedStructures?.[n.structureId]?.map(({structureId:u})=>u)||[];a.push(n?.structureId);let s=i?.map(({drawPosition:u})=>u)||[],o=t?.filter(u=>a.includes(u.structureId)&&Mn(u.drawPositions??[],s).length)??[],l=o.map(({matchUpId:u})=>u),c=r?.drawMatchUps?.filter(u=>l.includes(u.matchUpId))??[];return{drawPositions:s,matchUps:c,targetMatchUps:o}}function b7({lineUp:t}){if(!Array.isArray(t))return;let e={};return Ei(t.flatMap(({collectionAssignments:i})=>i?.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:s}=__({collectionPosition:a,collectionId:r,lineUp:t});s.forEach(o=>{e[o]||(e[o]=[]),e[o].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function Gy(t){return`${t} must be an array`}function m$({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(Gy("lineUp")),{valid:!1,errors:i,error:we};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:s,collectionAssignments:o}=a;return s?typeof s!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(o)?o.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:c}=l;return typeof c!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(Gy("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=Ei(t.map(qi)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?we:void 0}}function bS({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:kt};if(typeof e!="string")return{error:ba};let n=m$({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=ki({element:t,name:qm}),s=a?.value||{};return s[e]=b7({lineUp:r}),ur({element:t,extension:{name:qm,value:s}}),UM({drawDefinition:t}),{...oe}}function I7({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:s,event:o}){if(!r)return{error:kt};let{drawPositions:l,matchUps:c,targetMatchUps:u}=KTe({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:s});for(let d of u)d.matchUpType===Pc&&(d.sides??[]).forEach((p,f)=>{if(p?.drawPosition&&l?.includes(p.drawPosition)){let h=c.find(({matchUpId:m})=>m===d.matchUpId);if(h?.sides?.[f]){if(delete h.sides[f].lineUp,e===!1){let m=d.tieFormat,A=p.participantId;m&&A&&bS({drawDefinition:r,participantId:A,lineUp:[],tieFormat:m})}Zi({tournamentId:i?.tournamentId,context:"resetLineUps",eventId:o?.eventId,drawDefinition:r,matchUp:h})}}});return{...oe}}function vf({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:o,seedBlockInfo:l,drawPosition:c,matchUpsMap:u,structureId:d,event:p}){let f="assignDrawPosition";if(!o&&!i)return ce({result:{error:ba},stack:f});u=u??os({drawDefinition:a}),e||({matchUps:e}=ia({inContext:!0,drawDefinition:a,matchUpsMap:u}));let h=di({drawDefinition:a,structureId:d});if(h.error)return ce({result:h,stack:f});let{structure:m}=h;if(!m)return{error:an};if(el({structure:m}))return ce({result:{error:wl},stack:f});let{seedAssignments:A}=Au({provisionalPositioning:t,drawDefinition:a,structure:m}),g=A?.find(D=>D.participantId===o)?.seedNumber,{appliedPolicies:v}=tr({tournamentRecord:n,drawDefinition:a,structure:m,event:p});if(g&&!L_({seedNumber:g,appliedPolicies:v,drawDefinition:a,seedBlockInfo:l,drawPosition:c,structureId:d}))return ce({result:{error:S8},context:{drawPosition:c},stack:f});let b=Ia({structure:m}).positionAssignments||[],y=b?.find(D=>D.drawPosition===c);if(!y)return ce({result:{error:Zw},context:{drawPosition:c},stack:f});if(b?.map(qi).includes(o))return ce({result:{error:pE},context:{drawPosition:c},stack:f});let{containsParticipant:I,containsBye:w}=a7(y);if(w){let D=HM({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:c,structureId:d,matchUpsMap:u,event:p});if(D.error)return ce({result:D,stack:f})}if(I&&y.participantId!==o){let{activeDrawPositions:D}=UE({drawDefinition:a,structureId:d});if(D.includes(c))return ce({result:{error:sM},stack:f});I7({assignments:[y],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:u,structure:m})}if(y.participantId=o,i&&(y.qualifier=!0),m.stage===Et&&(!m.stageSequence||m.stageSequence>1)||m.stage&&[Ls,Dn].includes(m.stage)){let D=m.stage===qt?qt:Et,C=(a.structures?.find(E=>E?.stage===D&&E?.stageSequence===1)?.seedAssignments??[]).find(E=>E.participantId===o);if(C?.participantId){let{participantId:E,seedNumber:P,seedValue:R}=C;EE({eventId:p?.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:E,seedNumber:P,seedValue:R,structureId:d,event:p})}}if(m.structureType===$o){ETe({positionAssignments:b,tournamentRecord:n,drawDefinition:a,matchUpsMap:u,structure:m});let{drawPositions:D,matchUps:C,targetMatchUps:E}=KTe({assignments:[y],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:u,structure:m});if(D&&C?.length===1&&C[0].matchUpType===Hr){let P=(E?.[0].sides??[]).reduce((R,M,N)=>D?.includes(M.drawPosition)?N:R,void 0);y7({inContextTargetMatchUp:E[0],teamParticipantId:o,matchUp:C[0],drawPositionSideIndex:P,tournamentRecord:n,drawDefinition:a})}}else Q9e({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:c,matchUpsMap:u,structure:m,event:p});let S=a.entries?.find(D=>D.participantId===o),T=p?.entries?.find(D=>D.participantId===o);return!S&&T&&l7({entryStatus:T.entryStatus,entryStage:m.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:o,event:p}),Ym({tournamentId:n?.tournamentId,drawDefinition:a,structure:m,event:p}),{positionAssignments:b,...oe}}function Q9e({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let c={isCollectionMatchUp:!1},{matchUps:u}=dr({provisionalPositioning:t,matchUpFilters:c,drawDefinition:n,matchUpsMap:s,structure:o,event:l}),{roundMatchUps:d}=Oo({matchUps:u}),{initialRoundNumber:p}=ow({drawPosition:a,matchUps:u}),f=p&&d?.[p].find(h=>h.drawPositions?.includes(a));if(f){let h=PI({matchUpId:f.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s});if(h.error)return ce({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:h})}return{...oe}}function w7(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,event:c}=t,u="positionParticipantAction";if(!a)return{error:kt};let d=tr({tournamentRecord:n,drawDefinition:a,event:c}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:f}=t;f||(f=os({drawDefinition:a}),Object.assign(t,{matchUpsMap:f})),p||({matchUps:p}=ia({inContext:!0,drawDefinition:a,matchUpsMap:f}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:h}=wr({drawDefinition:a,structureId:l}),m=h?.find(y=>y.drawPosition===o);if(m?.participantId){let y=m.participantId,I=vf({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:f,event:c});return I.success?b({appliedPolicies:d,removedParticipantId:y}):ce({result:I,stack:u})}let A=HM({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:o,structureId:l,matchUpsMap:f,event:c});if(A.error)return ce({result:A,stack:u});let g=A.participantId,v=vf({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:f,event:c});if(!v.success)return ce({result:v,stack:u});return b({appliedPolicies:d,removedParticipantId:g});function b({appliedPolicies:y,removedParticipantId:I}){let{structure:w}=di({drawDefinition:a,structureId:l});GY({drawPositions:[o],structure:w});let S={[e]:s,name:r,drawPosition:o,structureId:l};return TM({appliedPolicies:y,drawDefinition:a,positionAction:S}),ce({context:{removedParticipantId:I},result:{...oe},stack:u})}}function j9e({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return w7({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function YTe(t){return j9e(t)}function XTe({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let s of i.matchUps)e[s.matchUpId]&&(s.roundNumber=e[s.matchUpId],Zi({tournamentId:r?.tournamentId,eventId:a?.eventId,drawDefinition:n,matchUp:s}))}function ZTe(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=Qt(t,i);if(r.error)return r;let n=di(t);if(n.error)return n;let a=n.structure;if(!el({structure:a}))return ce({result:{error:mb,message:"structure must be adHoc"}});let{roundMatchUps:s=[],roundNumbers:o}=Oo({matchUps:a?.matchUps});return o?.length?{valid:!0,structure:a,roundMatchUps:s,roundNumbers:o}:{error:mA}}function JTe(t){let e=ZTe(t,[{targetRoundNumber:!0,roundNumber:!0,[rl]:mYe}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e,{targetRoundNumber:a,roundNumber:s}=t;if(!n?.includes(s)||!n?.includes(a))return ce({result:{error:we},info:"roundNumbers must be valid rounds"});let o=a>s,l=o?vt(s+1,a+1):vt(a,s),c={};return l.forEach(u=>(r?.[u]??[]).forEach(({matchUpId:d})=>{c[d]=u-(o?1:-1)})),r?.[s]?.forEach(({matchUpId:u})=>c[u]=a),XTe({params:t,modMap:c,structure:i}),{...oe}}function eCe({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){if(!r)return{error:kt};if(!Array.isArray(t))return{error:we};let a="setPositionAssignments";for(let o of t){let{structureId:l,positionAssignments:c}=o;if(!c)continue;let u=di({drawDefinition:r,structureId:l});if(u.error)return u;let d=u.structure;if(!d)return{error:an};let p=wr({structure:d}).positionAssignments?.map(({drawPosition:A})=>A),f=c?.map(({drawPosition:A})=>A);if(Mn(p,f).length!==p?.length)return ce({result:{error:we},info:"drawPositions do not match",stack:a});let h=os({drawDefinition:r}),{matchUps:m}=ia({inContext:!0,drawDefinition:r,matchUpsMap:h});for(let A of c||[]){let{drawPosition:g,participantId:v,bye:b,qualifier:y}=A;if(b){let I=Hc({tournamentRecord:i,drawDefinition:r,drawPosition:g,matchUpsMap:h,structureId:l,structure:d,event:n});if(I?.error)return I}else if(y)c.forEach(I=>{I.drawPosition===g&&(I.qualifier=!0,delete I.participantId,delete I.bye)});else if(v){let I=vf({provisionalPositioning:e,inContextDrawMatchUps:m,tournamentRecord:i,drawDefinition:r,participantId:v,drawPosition:g,matchUpsMap:h,structureId:l,event:n});if(I?.error)return I}}Ym({tournamentId:i?.tournamentId,drawDefinition:r,structure:d,event:n})}let s=t.map(({structureId:o})=>o);return kr({tournamentId:i?.tournamentId,eventId:n?.eventId,drawDefinition:r,structureIds:s}),{...oe}}function tCe(t){let e=ZTe(t,[{roundNumbers:!0,[rl]:qs,[Ps]:s=>s.length===2&&s.every(Un)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(s=>n?.includes(s)))return ce({result:{error:we,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((s,o)=>(r?.[s]??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-o]})),XTe({params:t,modMap:a,structure:i}),{...oe}}function iCe({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return w7({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function rCe({drawDefinition:t,structureId:e}){if(!t)return{error:kt};let{structure:i}=di({drawDefinition:t,structureId:e}),r=(t?.links||[]).filter(n=>n.source?.structureId===e).map(n=>n.target?.structureId);return{playoffStructures:(t?.structures||[]).filter(n=>r.includes(n.structureId)),structure:i}}function A$({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:s}){if(!a)return{error:Gr};let o={},l=[];for(let c of a.drawDefinitions||[]){let{structures:u,stageStructures:d}=Td({withStageGrouping:t,stageSequences:e,drawDefinition:c,stageSequence:i,roundTarget:r,stages:n,stage:s});if(l.push(...u),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function S7({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:s}){if(!e)return{error:nt};let o={},l=[];for(let c of e.events||[]){let{structures:u,stageStructures:d}=A$({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:c,stage:s});if(u&&l.push(...u),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function _h(t){if(!t?.drawDefinition)return!1;let e=d$(t),i=e?.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r?.filter(({matchUpType:s})=>s===Hr),n=n?.filter(({matchUpType:s})=>s===Hr),a=a?.filter(({matchUpType:s})=>s===Hr)),!!(r?.length&&!n?.length&&!a?.length)}function U7(t){let{drawDefinition:e,structureId:i}=t;if(!e)return{error:kt};let{playoffStructures:r}=rCe({drawDefinition:e,structureId:i});if(!r?.length)return!1;let n=e?.entries?.filter(s=>s?.entryStatus&&Nd.includes(s.entryStatus))?.length??0,a=0;return(r||[]).reduce((s,o)=>!!((wr({structure:o}).positionAssignments??[])?.filter(l=>(l.participantId&&a++,l?.bye??l?.participantId)).length&&s),!!r.length)||a===n}function q4({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i?.[n]){let s=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(o=>{let l=q4({accessors:s,significantCharacters:t,value:o});r.push(...l)});else if(i=i[n],s.length){let o=q4({accessors:s,significantCharacters:t,value:i});r.push(...o)}else a({value:i})}function a({value:s}){if(s&&["string","number"].includes(typeof s)){let o=t?s.slice(0,t):s;r.push(o)}}return r}function z9e({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:B8};if(!Array.isArray(r))return{error:uM};let n={};return t.forEach(a=>{let s=r.find(l=>l.participantId===a),{values:o}=nCe({policyAttributes:e,idCollections:i,participants:r,participant:s});o&&o.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function nCe({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:B8};if(!r)return{error:iS};let n=[];return t.forEach(a=>{let{directive:s,groupings:o,key:l,significantCharacters:c}=a||{};if(l){let u=l.split(".");n.push(...q4({significantCharacters:c,value:r,accessors:u}))}else if(s){let u=a?.includeIds,d=(e?.[s]||[]).filter(p=>!u||u.includes(p));d?.length&&i?.length&&d.forEach(p=>{let f=i.find(h=>h.participantId===p);if(f?.individualParticipantIds?.includes(r.participantId)){let h=f?.participantId;n.push(h)}})}else o&&Object.keys(o).forEach(u=>{o[u].includes(r.participantId)&&n.push(u)})}),{values:Ei(n)}}function pie({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let s=n[a.participantId],{values:o}=nCe({participants:e,policyAttributes:i,idCollections:r,participant:s});return{...a,values:o}})}function aCe({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r?.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,s=t?t[a]||[]:[],o=!!i.some(l=>s.includes(l));return{[n]:{participantGroups:s,includesGroupsToAvoid:o}}}))}function q9e(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=aCe(t);return i.map(a=>{let s=e.filter(c=>a.includes(c)),o=n(s),l=s.filter(c=>!o.includes(c)).filter(c=>{let u=fie(c);return!r[u]?.includesGroupsToAvoid});return{unassigned:s,unpaired:o,pairedNoConflict:l}});function n(a){return a.filter(o=>!s(o));function s(o){let l=fie(o);return!a.includes(l)}}}function W9e(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=aCe(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),s=a.length===n.length?a:[],o=n.filter(l=>r[l]?.includesGroupsToAvoid).length;return{unassigned:a,unpaired:s,pairedNoConflict:o?[]:a,conflictsCount:o}})}function fie(t){return Number(t%2?t+1:t-1)}function K9e({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function Y9e({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let s=r.map(o=>a?W9e({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):q9e({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let o=s.map(u=>u.map(d=>d.unassigned).filter(d=>d?.length)).filter(u=>u?.length).sort((u,d)=>(d.length||0)-(u.length||0)),l=s.map(u=>u.map(d=>d.unpaired).filter(d=>d?.length)).filter(u=>u?.length),c=s.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(u=>u?.length).sort((u,d)=>(d.length||0)-(u.length||0));return{unassigned:o,unpaired:l,pairedNoConflict:c}}else{let o=s.map(u=>u.map(d=>d.unassigned).filter(d=>d?.length)).filter(u=>u?.length),l=s.map(u=>u.map(d=>d.unpaired).filter(d=>d?.length)).filter(u=>u?.length),c=s.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(u=>u?.length);return{unassigned:o,unpaired:l,pairedNoConflict:c}}}function sCe({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function X9e({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){let a=Object.assign({},...Object.keys(r).map(c=>[c,r[c].filter(u=>e.includes(u))]).filter(c=>c[1].length).map(([c,u])=>({[c]:u}))),s=Object.keys(a).reduce((c,u)=>a[u].length>c?a[u].length:c,0),o=Object.keys(a).filter(c=>a[c].length===s),l=Zu(i?o:Object.keys(a));return n=t&&a[n]?.length?n:l,{participantId:n&&a[n]?Zu(a[n]):Zu(e),groupKey:n}}function Z9e({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function J9e({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:s,groupKey:o}){let l=n.reduce((T,D)=>D.length>T?D.length:T,0)<=2,c=sCe({positionAssignments:t,participantIds:e}),u=Z9e({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=X9e({targetParticipantIds:c,useSpecifiedGroupKey:l,allGroups:s,groupKey:o}),f=K9e({participantId:d,allGroups:s}),h=Y9e({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:f,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:u}),{unassigned:m,unpaired:A,pairedNoConflict:g}=h,v=g?.length&&g[0],b=A?.length&&A[0],y=a&&v?v:b,I=a?b:v,w=y?.length&&y||I?.length&&I,S;if(w?.length){let T=_l(w);S=_l(T)}else{let T=_l(m[0]);S=_l(T)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:S}}function W4({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(o=>o.drawPosition),a=m7({drawPositions:n}).uniqueMatchUpGroupings??[],s=Object.assign({},...r.map(o=>({[o.drawPosition]:o})));a.forEach(o=>{_o(s[o[0]].values||[],s[o[1]].values||[])&&(i.push(o),r.conflict=!0)})}):e.forEach(r=>{_o(r[0]?.values||[],r[1]?.values||[])&&(i.push(r),r.conflict=!0)}),i}function eXe(t,e){let i=t.find(r=>r.includes(e));if(i)return i.find(r=>r!==e)}function hie(t,e){return t.find(i=>i.drawPosition===e)}function tXe({moveableParticipant:t,possibleDrawPosition:e,positionedParticipants:i,drawPositionGroups:r,isRoundRobin:n,getAvoidanceConflicts:a}){let s=eXe(r,e),o=hie(i,s),l=a({isRoundRobin:n,groupedParticipants:[[t,o]]}),c=[hie(i,e),o],u=a({isRoundRobin:n,groupedParticipants:[c]});return!l.length&&!u.length}function iXe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.flatMap(a=>{let s=a.map(o=>o.drawPosition);return a.filter(o=>e.includes(o.drawPosition)).map(o=>{let l=e.filter(c=>!s?.includes(c)).filter(c=>tXe({moveableParticipant:o,possibleDrawPosition:c,positionedParticipants:t,drawPositionGroups:i,isRoundRobin:n,getAvoidanceConflicts:W4}));if(l.length)return{drawPosition:o.drawPosition,possibleDrawPositions:l}}).filter(Boolean)})}function mie(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:s,idCollections:o,allGroups:l}=t,c=[],u,d=Math.min(...(a||[]).map(b=>b?.length).filter(Boolean)),p=d>2,f=Dt(e,!1,!0).filter(b=>!b.qualifier),h=e.filter(b=>!b.participantId&&(!b.bye||n?.includes(b.drawPosition))).map(b=>b.drawPosition);vt(0,r).forEach(()=>{let{newGroupKey:b,selectedParticipantId:y,targetDrawPosition:I}=J9e({...t,candidatePositionAssignments:f,allGroups:l,groupKey:u});u=b,f.forEach(w=>{w.drawPosition===I&&(w.participantId=y)})});let m=pie({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),A=$a(m,d),g=W4({groupedParticipants:A,isRoundRobin:p}),v=0;for(;v<20&&g.length;){let b=iXe({positionedParticipants:m,potentialDrawPositions:h,avoidanceConflicts:g,drawPositionGroups:a,isRoundRobin:p});if(b.length){let y=rXe({candidatePositionAssignments:f,swapOptions:b});y.error&&console.log({result:y}),m=pie({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),A=$a(m,d),g=W4({groupedParticipants:A,isRoundRobin:p}),v++}else v=20}return f.forEach(b=>{if(b.bye&&b.participantId){let y=S4;c.push(y)}if(b.qualifier&&b.participantId){let y=S4;c.push(y)}}),{positionAssignments:f,conflicts:g.length,groupedParticipants:A,errors:c}}function rXe({candidatePositionAssignments:t,swapOptions:e}){let i=_l(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=_l(i.possibleDrawPositions),a=t.find(c=>c.drawPosition===r),s=t.find(c=>c.drawPosition===n)??{},o={participantId:s?.participantId,qualifier:s?.qualifier,bye:s?.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,o),Object.assign(s,l),{...oe}}function nXe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,avoidance:u,drawSize:d,event:p}){if(!u)return{error:fwe};let{candidatesCount:f=1,policyAttributes:h,targetDivisions:m}=u,{roundsToSeparate:A}=u,g="randomUnseededSeparation",{structure:v}=di({drawDefinition:a,structureId:c}),{matchUps:b}=dr({provisionalPositioning:t,matchUpsMap:l,structure:v,event:p});if(m&&op(m)&&!A){let V=d6e(m)||0,G=b.reduce((z,Q)=>Q.roundNumber>z?Q.roundNumber:z,0);A=G<V?1:G-V+1}let{positionAssignments:y}=Ia({structure:v}),I=i$({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:o}).participantsWithGroupings,w=y?.filter(V=>!V.participantId),S=y?.map(V=>V.drawPosition),T=v?.structureType===$o,D=T?{structure:v,matchUps:b,allDrawPositions:S,roundsToSeparate:A}:{matchUps:b,allDrawPositions:S,roundsToSeparate:A},{drawPositionGroups:C,drawPositionChunks:E}=T?aXe(D):sXe(D),P={groupParticipants:o.filter(V=>V.participantType===Lc).map(V=>V.participantId),teamParticipants:o.filter(V=>V.participantType===vr).map(V=>V.participantId),pairParticipants:o.filter(V=>V.participantType===Ni).map(V=>V.participantId)},R=z9e({targetParticipantIds:e,policyAttributes:h,idCollections:P,participants:o});if(R.error)return ce({result:R,stack:g});let M=Object.assign({},...e.map(V=>{let G=Object.keys(R).filter(z=>(R[z]??[]).includes(V));return{[V]:G}})),N=sCe({participantIds:e,positionAssignments:y});if(N.length>(w?.length||0))return{error:L8};let k,O=N.length,x=vt(0,f).map(()=>mie({initialPositionAssignments:y,participantsWithGroupings:I,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:C,policyAttributes:h,idCollections:P,allGroups:R,drawSize:d}));if(k=x.reduce((V,G)=>!V||(G.conflicts||0)<(V.conflicts||0)?G:V,void 0),!k||k.conflicts){let V=vt(0,f).map(()=>mie({initialPositionAssignments:y,participantsWithGroupings:I,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:C,policyAttributes:h,idCollections:P,allGroups:R,drawSize:d}));k=x.concat(...V).filter(G=>!G.errors?.length).reduce((G,z)=>!G||(z.conflicts||0)<(G.conflicts||0)?z:G,void 0)}if(!k)return{error:C2};let F=(wr({structure:v})?.positionAssignments??[]).filter(V=>V.participantId).map(V=>V.participantId),_=k.positionAssignments.filter(V=>!F.includes(V.participantId));for(let V of _)if(V.bye){let G=Hc({tournamentRecord:n,drawDefinition:a,structureId:c,matchUpsMap:l,event:p,...V});if(G.error)return ce({result:G,stack:g})}else if(V.participantId){let G=vf({inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:c,matchUpsMap:l,event:p,...V});if(G.error)return ce({result:G,stack:g,context:{assignment:V}})}return{...oe}}function aXe(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function sXe({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(u=>u.roundNumber===1).map(u=>u.drawPositions),n=r.flat().sort(ua),a=Math.max(...n),s=t.filter(u=>u>a),o=n.length,l=vt(o===2?1:2,o).filter(u=>u===I8(u)),c=l.slice(0,e||l.length).reverse().map(u=>$a(n,u));return s.length&&console.log({fedDrawPositions:s}),{drawPositionGroups:r,drawPositionChunks:c}}function oXe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,structure:u,drawSize:d,event:p}){let f="positionUnseededParticipants";u||({structure:u}=di({drawDefinition:a,structureId:c})),c||({structureId:c}=u);let{positionAssignments:h}=Ia({structure:u}),{seedAssignments:m}=Au({provisionalPositioning:t,drawDefinition:a,structure:u}),A=m?.map(D=>D.participantId).filter(Boolean),{stage:g,stageSequence:v}=u,b=g===qt?ki({element:u,name:Mf})?.extension?.value:void 0,y=uS({provisionalPositioning:t,drawDefinition:a,stageSequence:v,entryStatuses:Ub,structureId:c,roundTarget:b,stage:g}),I=y.filter(D=>!A?.includes(D.participantId)).map(D=>D.participantId),w=h?.filter(D=>!D.participantId&&!D.bye&&!D.qualifier).map(D=>D.drawPosition);if(!r&&I.length>(w?.length||0))return ce({result:{error:L8},context:{unseededParticipantsCount:I.length,unfilledDrawPositionsCount:w?.length},stack:f});let{appliedPolicies:S}=tr({tournamentRecord:n,drawDefinition:a,event:p}),T=S?.[jP];if(u.stage===Dn){let D=y.reduce((C,E)=>(C[E.groupingValue]||(C[E.groupingValue]=[]),C[E.groupingValue].push(E.participantId),C),{});Object.keys(D).length&&(T||(T={policyName:"Playoff Avoidance"}),T.policyAttributes||(T.policyAttributes=[]),T.policyAttributes.push({groupings:D}))}return T&&o?nXe({provisionalPositioning:t,unseededParticipantIds:I,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,avoidance:T,drawSize:d}):lXe({provisionalPositioning:t,unseededParticipantIds:I,inContextDrawMatchUps:e,unfilledDrawPositions:w,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:c,matchUpsMap:l,drawSize:d,event:p})}function lXe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,matchUpsMap:l,structureId:c,drawSize:u,event:d}){let p=u>2?Po(r):r.reverse();for(let f of e){let h=p.pop();if(!n||h){let m=vf({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,participantId:f,drawPosition:h,matchUpsMap:l,structureId:c,event:d});if(m?.error&&console.log("!!!!!",{result:m}),m?.error)return ce({result:m,stack:"randomUnseededDistribution"})}}return{...oe}}function cXe(t){let e=t.structure??di(t).structure,i="positionQualifiers",r=[];if(e.stage===Ls)return ce({result:{error:gb},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:s}=uXe(t);for(let o of Object.keys(n)){let l=a?.filter(c=>s[o].includes(c.drawPosition)&&!c.participantId&&!c.qualifier&&!c.bye).map(c=>c.drawPosition);if(n[o]>(l||0))return ce({result:{error:F8},context:{unfilledDrawPositions:l},stack:i});vt(0,n[o]).forEach(()=>{let c=_l(l);r.push(c),a?.forEach(u=>{u.drawPosition===c&&(u.qualifier=!0,delete u.participantId,delete u.bye)})})}return{...oe,qualifierDrawPositions:r}}function uXe({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=di({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=Ia({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:s,roundQualifiersCounts:o}=TE({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(o?Object.keys(o):[]).map(m=>ci(m)),{matchUps:c}=dr({structure:e}),{roundProfile:u}=Oo({matchUps:c}),d=Object.assign({},...l.filter(m=>u?.[m]).map(m=>({[m]:u?.[m]?.drawPositions?.filter(Boolean)??[]}))),p=r?.filter(m=>m.qualifier).map(m=>m.drawPosition),f=s-(p?.length??0),h=p?.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let A=r?.filter(g=>g.qualifier&&d[m]?.drawPositions?.includes(g.drawPosition)).map(g=>g.drawPosition);return{[m]:(o?.[m]??0)-(A?.length??0)}})),unplacedQualifiersCount:f,placedQualifiersCount:h,roundQualifiersCounts:o,positionAssignments:r,roundDrawPositions:d,qualifiersCount:s}}function oCe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,groupsCount:c,structureId:u,matchUpsMap:d,structure:p,event:f}){let h=[],m=[],A=0;if(p||({structure:p}=di({drawDefinition:a,structureId:u})),u||(u=p?.structureId),r||(r=tr({drawDefinition:a}).appliedPolicies),!n){let g=p&&yS({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:s,structure:p});g?.error&&m.push(g.error),n=g?.validSeedBlocks}return c=c??n?.length??0,vt(0,c).forEach(()=>{if(A<(c||0)){let g=dXe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,structureId:u,matchUpsMap:d,event:f});g?.success&&(A++,h.push(...g.seedPositions??[])),g.error&&m.push({seedPositionError:g.error})}}),m.length?{error:m}:{...oe,seedPositions:h}}function dXe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:s,structureId:o,matchUpsMap:l,event:c}){let{unplacedSeedParticipantIds:u,unfilledPositions:d}=jTe({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:o}),{appliedPolicies:p}=tr({drawDefinition:r}),{avoidance:f}=p??{};f&&s&&u?.length>2;let h=[];for(let m of u){let A=d.pop();if(!A)return{error:cE};h.push(A);let g=vf({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:m,seedBlockInfo:a,drawPosition:A,matchUpsMap:l,structureId:o,event:c});if(!g.success)return g}return{...oe,seedPositions:h}}function pXe({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=Ia({structure:i}),{seedAssignments:n}=Au({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(s=>s.participantId).map(s=>({[s.participantId]:s})));return r?.map(s=>a[s.participantId]?{...s,seedNumber:a[s.participantId].seedNumber,seedValue:a[s.participantId].seedValue}:"").filter(Boolean)}function fXe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>hXe(a,i,r,t));let n=r.map(a=>Array.isArray(a)?Po(a):a).flat(1/0);return kIe(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function hXe(t,e,i,r){if(e-i.length>t.drawPositions.length)i.push(...t.drawPositions);else{let n=K4($a(t.drawPositions,2));mXe(n,i,r)}}function mXe(t,e,i){let r,n=i[e.length];for(;r=Kk(t,n);)e.push(r),n=i[e.length]}function Kk(t,e){return Array.isArray(t)&&t.length!==2?t.pop():Array.isArray(t[0])?gXe(t,e):AXe(t,e)}function AXe(t,e){return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift()}function gXe(t,e){let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return Kk(e?n:t[Math.round(Math.random())],e)}return i<r?Kk(t[1],e):Kk(t[0],e)}function K4(t){let e=Math.floor(t.length/2);return t.length>2?[K4(t.slice(0,e)),K4(t.slice(e))]:t}function vXe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:s,structure:o}){a||(a=yS({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:o}));let{isFeedIn:l,isLuckyStructure:c,isContainer:u}=a,{validSeedBlocks:d}=a;i?.seeding?.containerByesIgnoreSeeding&&(d=[]);let p=pXe({provisionalPositioning:t,drawDefinition:r,structure:o})??[],f=Ei([].concat(...e.map(y=>y.drawPositions))),h=p.filter(y=>f.includes(y.drawPosition)),m=(y,I)=>tC(y.seedValue)-tC(I.seedValue),A=d.reduce((y,I)=>{let w=h.filter(S=>I.drawPositions?.includes(S.drawPosition)).sort(m);return y.concat(...w)},[]).map(y=>y.drawPosition),g=fXe({orderedSortedFirstRoundSeededDrawPositions:A,validSeedBlocks:d,byesToPlace:s}),v=Aie({orderedSeedDrawPositions:A,relevantMatchUps:e}).slice(0,s),b=Aie({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,s);return{strictSeedOrderByePositions:v,blockSeedOrderByePositions:b,isLuckyStructure:c,positionedSeeds:p,isContainer:u,isFeedIn:l}}function Aie({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r?.sort((n,a)=>n-a)).filter(r=>r?.[0]+1===r?.[1]);return t.map(r=>i.find(n=>n?.includes(r))).filter(Boolean).map(r=>r?.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function yXe({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:s,isFeedIn:o}){let l=r?.seeding?.seedingProfile,c=s.stage===qt,{positionAssignments:u}=Ia({structure:s}),d=u?.filter(N=>N.participantId).map(N=>N.drawPosition),p={isCollectionMatchUp:!1},{matchUps:f,roundMatchUps:h}=dr({provisionalPositioning:t,matchUpFilters:p,structure:s}),m=h?.[1]||[],A=s.structureType===$o?f:m,g=Ei([].concat(...A.map(N=>N.drawPositions))),v=Math.min(...g)-1,b=d?.filter(N=>g.includes(N)),y=N=>{let k=Math.ceil(N.length/2),O=[N.slice(0,k),N.slice(k)],x=O.map(W=>[].concat(...W.flat(1/0)).length),F=Math.min(...x.flat(1/0)),_=Math.max(...x.flat(1/0)),V=x.indexOf(_),G=F!==_,z=Po(O),[Q,j]=!F||G?[O[V],O[1-V]]:[z[0],z[1]];return{greaterHalf:Q,lesserHalf:j}},I=N=>{let{greaterHalf:k,lesserHalf:O}=y(N),{greaterHalf:x,lesserHalf:F}=y(k),_=Po(x.flat(1/0)).pop(),V=x.flat().filter(G=>G!==_);return{newlyFilteredChunks:[...O,...F,V],drawPosition:_}},w=N=>!e.includes(N),S=N=>!b?.includes(N),T=N=>{let k=$a(N.sort(ua),Math.ceil(N.length/4)).map(F=>F.filter(S)),O=[].concat(...k.flat(1/0)).length,x=[];for(let F=0;F<O;F++){let{newlyFilteredChunks:_,drawPosition:V}=I(k);x.push(V),k=_}return x},{validSeedBlocks:D}=yS({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:s}),C=D?.map(N=>N.drawPositions?.map(k=>k+v)),E;if(o){let N=g.length,{seedBlocks:k}=A7({cluster:[AM,O2].includes(qM(l)),participantsCount:N});E=k.map(O=>O.map(x=>x+v)).map(T).filter(O=>O.length)}else c?E=C?.map(N=>N.filter(S)):E=C?.map(T).filter(N=>N.length);let P=A.map(N=>N.drawPositions).map(N=>N?.sort((k,O)=>k-O)).filter(N=>N?.[0]+1===N?.[1]),R=N=>P.reduce((k,O)=>O.includes(N)?O.reduce((x,F)=>F!==N?F:x,void 0):k,void 0),M=E.map(N=>N.map(R)).flat(1/0).filter(S).filter(w).filter(Boolean);if(c&&!s.structures){let N=a%4,k=M.slice(0,N),O=h[s.roundLimit]?.length,x=$a(M.slice(N),O).map(Po).flat();M=k.concat(x)}return{unseededByePositions:M}}function bXe({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){let a={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:o}=dr({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:r,event:n}),l=o?.[1]||[],c=r?.structureType===$o,u=c?s:l,d=c?r?.structures?.length||0:s.length,{structureId:p,stage:f,stageSequence:h}=r,m=uS({entryStatuses:Nd,provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:f}),{qualifiersCount:A}=TE({provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:f}),g=m.length+A,{positionAssignments:v,unassignedPositions:b}=Ia({structure:r}),y=b?.map(C=>C.drawPosition),I=v?.filter(C=>C.bye).length,w=v?.filter(C=>C.bye).map(C=>C.drawPosition),S=u.map(C=>C.drawPositions).filter(C=>C?.reduce((E,P)=>!w?.includes(P)&&E,!0)).flat(1/0).filter(C=>y?.includes(C)),T=v?.length,D=T?T-g:0;return D>d&&r.stageSequence===1&&r.stage!==Ls&&(D=d),{placedByes:I,byesCount:D,relevantMatchUps:u,placedByePositions:w,roundMatchUps:o,positionsToAvoidDoubleBye:S}}function lCe({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:s,structureId:o,structure:l,seedLimit:c,seedsOnly:u,event:d}){l||({structure:l}=di({drawDefinition:r,structureId:o})),o||(o=l?.structureId);let p=!(l?.structures??l?.stage===qt),{byesCount:f,placedByes:h,relevantMatchUps:m}=bXe({provisionalPositioning:t,drawDefinition:r,matchUpsMap:s,structure:l,event:d}),A=f-(h||0);if(A<=0)return{...oe};let{strictSeedOrderByePositions:g,blockSeedOrderByePositions:v,isLuckyStructure:b,isFeedIn:y}=vXe({provisionalPositioning:t,relevantMatchUps:m,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:A,structure:l}),I=l?.structureType&&[$o,F2].includes(l.structureType)&&i?.seeding?.containerByesIgnoreSeeding,w=p&&v?.length?v:g,{unseededByePositions:S}=yXe({provisionalPositioning:t,seedOrderByePositions:w,isLuckyStructure:b,appliedPolicies:i,drawDefinition:r,seedLimit:c,structure:l,isFeedIn:y}),T=P=>P%2,D=(P,R)=>(P||[]).every(M=>T(M)?R!==M+1:R!==M-1),C=[].concat(...w);if(!u)for(;S.length;){let P=S.find(R=>D(C,R));P?(C.push(P),S=S.filter(R=>R!==P)):(C.push(...S),S=[])}I&&(C=Po(C),Mc({ignoreSeededByes:I})&&console.log({byePositions:C}));let E=C.slice(0,A);for(let P of E){let R=Hc({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:P,matchUpsMap:s,structureId:o,structure:l,event:d});if(R?.error)return R}return{...oe,unseededByePositions:S,byeDrawPositions:E}}function sD(t,e){return e||P2(),ce({result:t,stack:"automatedPositioning"})}function IXe(t,e){return e||P2(),t}function wXe(t,e,i,r){let n=di({drawDefinition:e,structureId:i});if(n.error)return{error:n.error};let a=n.structure;if(!a)return{error:an};let s=t.appliedPolicies||tr({drawDefinition:e,structure:a,event:r})?.appliedPolicies,{qualifiersCount:o}=TE({stageSequence:a.stageSequence,provisionalPositioning:t.provisionalPositioning,stage:a.stage,drawDefinition:e,structureId:i}),l=Ub,c=uS({stageSequence:a.stageSequence,provisionalPositioning:t.provisionalPositioning,stage:a.stage,placementGroup:t.placementGroup,drawDefinition:e,entryStatuses:l,structureId:i});return{structure:a,appliedPolicies:s,qualifiersCount:o,entries:c}}function SXe({placeByes:t,provisionalPositioning:e,tournamentRecord:i,appliedPolicies:r,drawDefinition:n,seedBlockInfo:a,matchUpsMap:s,structure:o,seedLimit:l,seedsOnly:c,event:u,structureSeedingProfile:d,seedingProfile:p,inContextDrawMatchUps:f,participants:h,positioningReport:m}){let A=t?lCe({provisionalPositioning:e,tournamentRecord:i,appliedPolicies:r,drawDefinition:n,seedBlockInfo:a,matchUpsMap:s,structure:o,seedLimit:l,seedsOnly:c,event:u}):void 0;if(A?.error)return{error:A.error};let g=A?.unseededByePositions;return m.push({action:"positionByes",unseededByePositions:g}),A=oCe({seedingProfile:d?{positioning:d}:p,provisionalPositioning:e,inContextDrawMatchUps:f,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:a.validSeedBlocks,drawDefinition:n,seedBlockInfo:a,participants:h,matchUpsMap:s,structure:o,event:u}),A.error?{error:A.error}:(m.push({seedPositions:A.seedPositions,action:"positionSeedBlocks"}),{unseededByePositions:g})}function UXe({drawType:t,LUCKY_DRAW:e,structureSeedingProfile:i,seedingProfile:r,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:s,appliedPolicies:o,validSeedBlocks:l,drawDefinition:c,seedBlockInfo:u,participants:d,matchUpsMap:p,structure:f,event:h,placeByes:m,seedLimit:A,seedsOnly:g,positioningReport:v}){let b;if(t!==e){let I=oCe({seedingProfile:i?{positioning:i}:r,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:s,appliedPolicies:o,validSeedBlocks:l,drawDefinition:c,seedBlockInfo:u,participants:d,matchUpsMap:p,structure:f,event:h});if(I.error)return{error:I.error};v.push({action:"positionSeedBlocks",seedPositions:I.seedPositions})}let y=m?lCe({provisionalPositioning:n,tournamentRecord:s,appliedPolicies:o,drawDefinition:c,seedBlockInfo:u,matchUpsMap:p,structure:f,seedLimit:A,seedsOnly:g,event:h}):void 0;return y?.error?{error:y.error}:(b=y?.unseededByePositions,v.push({action:"positionByes",byeDrawPositions:y?.byeDrawPositions,unseededByePositions:b}),{unseededByePositions:b})}function TXe({seedsOnly:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structure:c,positionQualifiers:u,positionUnseededParticipants:d,provisionalPositioning:p,unseededByePositions:f,multipleStructures:h,structureId:m,drawSize:A,event:g,positioningReport:v,conflicts:b}){if(t)return{};let y=u({inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structure:c});return y.error?{error:y.error}:(y.conflicts&&(b.qualifierConflicts=y.conflicts),v.push({action:"positionQualifiers",qualifierDrawPositions:y.qualifierDrawPositions}),y=d({provisionalPositioning:p,inContextDrawMatchUps:e,unseededByePositions:f,multipleStructures:h,tournamentRecord:i,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:m,structure:c,drawSize:A,event:g}),y.error?{error:y.error}:(y.conflicts&&(b.unseededConflicts=y.conflicts),v.push({action:"positionUnseededParticipants"}),{}))}function WM(t){let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:r,multipleStructures:n,placeByes:a=!0,tournamentRecord:s,seedingProfile:o,structureId:l,seedLimit:c,seedsOnly:u,drawType:d,drawSize:p,event:f}=t,h=[];i||(rSe(),e=Dt(e,!1,!0));let{structure:m,appliedPolicies:A,qualifiersCount:g,entries:v,error:b}=wXe(t,e,l,f);if(b)return sD(b,i);if(!v?.length&&!g)return IXe({...oe},i);let y=t.matchUpsMap??os({drawDefinition:e}),I=t.inContextDrawMatchUps??ia({inContext:!0,drawDefinition:e,matchUpsMap:y})?.matchUps,w=yS({provisionalPositioning:r,appliedPolicies:A,drawDefinition:e,seedingProfile:o,structure:m});if(w.error)return sD(w,i);let{validSeedBlocks:S}=w;h.push({validSeedBlocks:S});let T=t.participants||(s?vn({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:s})?.participants:[]),D;if(qM(m.seedingProfile||o)===_y){let R=SXe({placeByes:a,provisionalPositioning:r,tournamentRecord:s,appliedPolicies:A,drawDefinition:e,seedBlockInfo:w,matchUpsMap:y,structure:m,seedLimit:c,seedsOnly:u,event:f,structureSeedingProfile:m.seedingProfile,seedingProfile:o,inContextDrawMatchUps:I,participants:T,positioningReport:h});if(R?.error)return sD(R.error,i);D=R.unseededByePositions}else{let R=UXe({drawType:d,LUCKY_DRAW:yb,structureSeedingProfile:m.seedingProfile,seedingProfile:o,provisionalPositioning:r,inContextDrawMatchUps:I,tournamentRecord:s,appliedPolicies:A,validSeedBlocks:S,drawDefinition:e,seedBlockInfo:w,participants:T,matchUpsMap:y,structure:m,event:f,placeByes:a,seedLimit:c,seedsOnly:u,positioningReport:h});if(R?.error)return sD(R.error,i);D=R.unseededByePositions}let C={},E=TXe({seedsOnly:u,inContextDrawMatchUps:I,tournamentRecord:s,appliedPolicies:A,validSeedBlocks:S,drawDefinition:e,seedBlockInfo:w,participants:T,matchUpsMap:y,structure:m,positionQualifiers:cXe,positionUnseededParticipants:oXe,provisionalPositioning:r,unseededByePositions:D,multipleStructures:n,structureId:l,drawSize:p,event:f,positioningReport:h,conflicts:C});if(E?.error)return sD(E.error,i);let{positionAssignments:P}=wr({drawDefinition:e,structure:m});return kr({drawDefinition:e,structureIds:[l]}),i||P2(),{positionAssignments:P,conflicts:C,...oe,positioningReport:h}}function DE(t){let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,placeByes:o,seedsOnly:l}=t;if(!n)return{error:Rc};if(!_h({drawDefinition:n,structureId:s})&&!i)return{error:w8};let c=rCe({drawDefinition:n,structureId:s}).playoffStructures?.sort((p,f)=>B_(p)-B_(f)),u=[],d=[];if(c)for(let p of c){let{structureId:f}=p,h=WM({structureId:f,provisionalPositioning:i,applyPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,placeByes:o,seedsOnly:l});if(h.error)return h;h.positionAssignments&&u.push({positionAssignments:h.positionAssignments,structureId:f}),h.positioningReport&&d.push(h.positioningReport)}return{...oe,structurePositionAssignments:u,positioningReports:d}}function cCe({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:s}){if(!i)return{error:kt};if(!n)return{error:Fc};let o=(e?.participants??[]).find(p=>p.participantId===r);if(e&&!o)return{error:lp};let{structure:l}=di({drawDefinition:i,structureId:n});if(!l)return{error:an};if(!(!t||Un(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Un(p)&&ci(p)>0)))return{error:we};let{seedAssignments:c}=Au({drawDefinition:i,structure:l}),u=c?.map(p=>p.seedNumber),d=c?.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(f=>parseInt(f)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...u||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return zUe({tournamentId:e?.tournamentId,eventId:s?.eventId,drawDefinition:i,structure:l}),{...oe}}function T7({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return w7({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function ZP({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=wE({drawDefinition:i,structureId:r})||{},s=(a?.target||[]).filter(({linkType:o})=>o===n).filter(({target:o})=>!t||t===o.roundNumber).map(o=>{let l=o.source.structureId,{structure:c}=di({structureId:l,drawDefinition:i});if(!(e&&c?.finishingPosition!==e))return o}).filter(Boolean);return{sourceStructureIds:s.map(({source:o})=>o.structureId),relevantLinks:s}}var CXe=(t,e)=>{let i=[...new Set(e.slice(0,t.length))],r=[...i].sort((o,l)=>o-l),n=new Set,a=[];i.forEach(o=>{let l=t.indexOf(o);if(l!==-1&&!n.has(l))a.push(l),n.add(l);else{let c=r.indexOf(o),u=t.findIndex((d,p)=>!n.has(p));for(;n.has(u)&&u===-1&&n.size<t.length;)u=t.findIndex((d,p)=>!n.has(p)&&p>u);a.push(c),n.add(c)}});let s=t.filter((o,l)=>!n.has(l));return[...a,...s]};function uCe({targetRoundNumber:t=1,tournamentRecord:e,drawDefinition:i,event:r,randomList:n}){let a=Qt({drawDefinition:i,event:r,tournamentRecord:e},[{[ro]:!0,[gA]:!0,[Ua]:!0}]);if(a.error)return a;let s=[],o=[],l=i.structures?.find(A=>A.stage===Et&&A.stageSequence===1);if(!l)return ce({result:{error:D8}});let c=(tr({tournamentRecord:e,drawDefinition:i,structure:l,event:r}).appliedPolicies??{})[Bh]?.requireCompletedStructures,{qualifierPositions:u,positionAssignments:d}=Ia({structure:l});if(!u.length)return ce({result:{error:F8}});let p=vt(0,u.length);n&&(p=CXe(p,n));let f=d.map(A=>A.participantId).filter(Boolean),{relevantLinks:h}=ZP({structureId:l.structureId,targetRoundNumber:t,linkType:Ph,drawDefinition:i})||{},{relevantLinks:m}=ZP({structureId:l.structureId,targetRoundNumber:t,linkType:Dh,drawDefinition:i})||{};for(let A of h){let g=i.structures?.find(b=>b.structureId===A.source.structureId);if(g?.stage!==qt)continue;let v=_h({structureId:A.source.structureId,drawDefinition:i});if(!c||v){let b=g.qualifyingRoundNumber,{matchUps:y}=dr({matchUpFilters:{...b&&{roundNumbers:[b]},isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,inContext:!0,structure:g});for(let I of y){let w=I.matchUpStatus==="BYE"&&I.sides?.find(({participantId:T})=>T),S=I.sides.find(T=>T?.sideNumber===I.winningSide);if(S||w){let{participantId:T}=S||w||{};T&&!f.includes(T)&&o.push(T)}}}}for(let A of m){let g=i?.structures?.find(v=>v.structureId===A.source.structureId);if(g?.stage===qt&&_h({structureId:A.source.structureId,drawDefinition:i})){let{positionAssignments:v}=wr({structure:g}),b=v?.map(y=>{let I=y.participantId,w=ki({element:y,name:Km}).extension?.value;return w?{participantId:I,groupOrder:w?.groupOrder}:{}}).filter(({groupOrder:y,participantId:I})=>y===1&&!f.includes(I)).map(({participantId:y})=>y)??[];b&&o.push(...b)}}return o.length?(p.forEach((A,g)=>{let v=o[g],b=u[A].drawPosition;v&&T7({qualifyingParticipantId:v,structureId:l.structureId,drawPosition:b,tournamentRecord:e,drawDefinition:i})?.success&&s.push({participantId:v,drawPosition:b})}),ce({result:Lt({...oe,assignedParticipants:s})})):ce({result:{error:Twe}})}function dCe({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>wi(i)))&&ce({result:{error:we},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>FT(i.structureOrder)-FT(r.structureOrder)),{...oe}):{error:kt}}function g$({drawDefinition:t}){let e=t.structures??[],i=t.links??[],r=new Map,n=A=>{let g=r.get(A)||r.set(A,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&r.get(A);if(g&&!g?.stage){let v=e.find(b=>b.structureId===A);g.stage=v?.stage}return g},a={},s={},o=i.map(A=>{let g=A.source.structureId,v=A.target.structureId,b=n(g),y=n(v);return[Oy,Ju,L2,_y].includes(A.target.feedProfile)?(b?.targets.push(v),y?.sources.push(g)):A.target.feedProfile===jd&&(y?.drawSources.push(g),b?.drawTargets.push(v)),s[v]=s[v]||A.target.feedProfile===jd,a[v]=Ei([...a[v]||[],g]).filter(Boolean),[A.source.structureId,A.target.structureId]});for(let A of r.keys()){let g=r.get(A);if(g){let v=g.targets??[];for(;v.length;){let b=v.pop(),y=b&&r[b];y?.targets?.length?v.push(...y.targets):y&&(g.rootStage=y.stage)}if(g.rootStage||(g.rootStage=g.stage),!g.targets?.length){let b=g.sources??[];for(;b.length;){let y=b.pop(),I=y&&r[y];if(I?.sources?.length){for(let w of I.sources)g.progeny?.includes(w)||g.progeny?.push(w);b.push(...I.sources)}}}}}let l=0;for(let A of r.keys()){let g=r.get(A);if(g&&g.rootStage===qt){let v=[g.drawTargets?.[0]],b=0;for(;v.length;){b+=1;let y=v.pop(),I=y?r.get(y):void 0;I?.drawTargets?.length&&v.push(I.drawTargets[0])}g.distanceFromMain=b,b>l&&(l=b)}}let c=o.length;vt(0,Math.ceil(c/2)).forEach(()=>{o=vt(0,c).map(A=>{let g=o[A],v=o.reduce((b,y)=>_o(g,y)?b.concat(...y):b,[])||[];return Ei(g.concat(...v))})});let u=o[0],d=(A,g)=>Mn(A,g).length===A.length,p=o.slice(1).reduce((A,g)=>A&&d(g,u),!0),f=[u].filter(Boolean),h=[u].filter(Boolean);e.forEach(A=>{let{structureId:g,stage:v}=A;f.find(b=>b.includes(g))||(f.push([g]),v!==Za&&h.push([g]))});let m=p&&h.length===1;return!i?.length&&e.length===1&&n(e[0].structureId),{structureProfiles:Object.fromEntries(r),allStructuresLinked:m,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:s,structureGroups:f}}function pCe({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=g$({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...oe}}function C7(t){let e=Qt(t,[{[Ua]:!0,[ro]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=t;return EXe({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function EXe(t){let e=Qt(t,[{[ro]:!0,[Q2]:!0},{link:!0,[rl]:fl,[VIe]:C8}]);if(e.error)return e;let{drawDefinition:i,tournamentId:r,structure:n,eventId:a,link:s}=t,o=s.target.structureId,l=di({drawDefinition:i,structureId:o});if(l.error)return ce({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:l});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(n),i.links.push(s),pCe({drawDefinition:i});let c=dr({structure:n})?.matchUps||[];return Tg({drawDefinition:i,tournamentId:r,matchUps:c,eventId:a}),kr({drawDefinition:i,structureIds:[n.structureId]}),{...oe}}function fCe({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:we};if(!t)return{error:kt};let i=Object.assign({},...e.map(r=>{if(!Xi(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Yt};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let s=i[a.structureId];s&&(a.structureName=s)}}return{...oe}}function E7({drawDefinition:t,timeItem:e}){if(!t)return{error:Rc};if(!e)return{error:G8};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:V8};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),UM({drawDefinition:t}),{...oe}}function hCe(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,event:n}=t,a=Qt(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let s=i.structures??[],o=s.find(g=>g.structureId===r);if(!o)return{error:an};let l=s.find(({stage:g,stageSequence:v})=>g===Et&&v===1),c=r===l?.structureId,u=s.filter(({stage:g})=>g===qt).map(rc("structureId"));if(c&&!u.length)return{error:QIe};let d=u.includes(r),p=DXe({isQualifyingStructure:d,structure:o,...t});if(p?.error)return p;let{structureIdsToRemove:f,relatedStructureIdsMap:h}=RXe({qualifyingStructureIds:u,isQualifyingStructure:d,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureId:r}),{removedMatchUpIds:m,removedStructureIds:A}=MXe({relatedStructureIdsMap:h,qualifyingStructureIds:u,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:f,structureId:r});if(PXe({removedMatchUpIds:m,drawDefinition:i}),c){let g=(l.matchUps??[])?.map(rc("matchUpId"));m.push(...g),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&pCe({drawDefinition:i}),zh({tournamentId:e?.tournamentId,matchUpIds:m,action:"removeStructure",eventId:n?.eventId,drawDefinition:i}),kr({drawDefinition:i,eventId:n?.eventId}),{...oe,removedMatchUpIds:m,removedStructureIds:A}}function DXe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:s}){let o=[r];if(t){let l=u=>i.links?.find(d=>d.target.structureId===u),c=l(r)?.source.structureId;for(;c;)o.push(c),c=l(c)?.source.structureId}if(ia({matchUpFilters:{structureIds:o},drawDefinition:i}).matchUps?.some(({score:l})=>wa({score:l}))){let l=tr({tournamentRecord:e,drawDefinition:i,structure:n,event:a})?.appliedPolicies;if(!(s??l?.[mu]?.allowDeletionWithScoresPresent?.structures))return{error:dM}}return{...oe}}function PXe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=ia({drawDefinition:e});i?.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function RXe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let s=(n.structures??[]).map(rc("structureId")),o=u=>n.links?.map(d=>d.source.structureId===u&&d.target.structureId!==r?.structureId&&d.target.structureId).filter(Boolean)??[],l=u=>n.links?.map(d=>t.includes(d.source.structureId)&&d.target.structureId===u&&d.source.structureId).filter(Boolean)??[],c=new Map;return s.forEach(u=>c.set(u,e?l(u):o(u))),{structureIdsToRemove:i?c.get(a):[a],relatedStructureIdsMap:c}}function MXe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:s}){let o=[],l=[];for(;a?.length;){let c=a.pop();l.push(...kXe({idBeingRemoved:c,drawDefinition:n}));let u=BXe({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:c,drawDefinition:n,structureId:s});o.push(...u.removedStructureIds);let d=NXe({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:c,structureId:s});d?.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:o}}function NXe({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){return t&&e.get(t)?.filter(n=>n!==i?.structureId||r===i.structureId)}function BXe({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){let a=[];return r.links=r.links?.filter(s=>s.source.structureId!==i&&s.target.structureId!==i)??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function kXe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=di({structureId:t,drawDefinition:e}),r=dr({structure:i}).matchUps;return CY(r)}function $_({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:kt};if(!KY({drawDefinition:e,stage:r}))return{error:gb};let n=n7e({drawDefinition:e,stage:r}),{qualifiersCount:a}=TE({drawDefinition:e,stageSequence:t,stage:r}),s=n+a;if(i<s)return{error:WIe};let{entryProfile:o}=WY({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return kr({drawDefinition:e}),{...oe,entryProfile:o}}function mCe({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?KY({drawDefinition:e,stage:i})?(WY({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),kr({drawDefinition:e}),{...oe}):{error:gb}:{error:kt}}function xXe({drawDefinition:t,drawSize:e}){if(!t)return{error:kt};let i=$_({stage:Za,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(kr({drawDefinition:t}),{...oe})}function ACe(t){return xXe(t)}function gCe({tournamentRecord:t,drawDefinition:e,event:i,structureId:r}){if(!e)return{error:kt};let n=e.structures?.find(s=>s.stage===qt&&s.structureId===r);if(!n)return{error:an};if(n.matchUps?.some(({matchUpStatus:s,score:o})=>wa({score:o})??ta.includes(s)))return{error:dM};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],zh({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),kr({tournamentId:t?.tournamentId,eventId:i?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...oe}}var _Xe="qualifierDrawPositionAssignment",OXe="withdrawParticipantAtDrawPosition",FXe="alternateDrawPositionAssignment",LXe="luckyLoserDrawPositionAssignment",gie="removeDrawPositionAssignment",vCe="swapDrawPositionAssignments",$Xe="modifyPairAssignment",HXe="adHocPositionSwap",VXe="modifyParticipantOtherName",vie="assignDrawPosition",GXe="removeSeededParticipant",QXe="assignDrawPositionBye",jXe="modifySeedAssignment",yCe="addPenalty",D7="MODIFY_PAIR",v$="QUALIFIER",P7="ALTERNATE",R7="WITHDRAW",cw="ASSIGN",Y4="REMOVE",M7="LUCKY",v0="REMOVE_SEED",y$="SWAP",JP="NICKNAME",RI="SEED_VALUE",uw="PENALTY",zXe={MODIFY_PAIR_ASSIGNMENT:D7,QUALIFYING_PARTICIPANT:v$,ALTERNATE_PARTICIPANT:P7,WITHDRAW_PARTICIPANT:R7,ASSIGN_PARTICIPANT:cw,LUCKY_PARTICIPANT:M7,REMOVE_ASSIGNMENT:Y4,SWAP_PARTICIPANTS:y$,ADD_NICKNAME:JP,REMOVE_SEED:v0,ADD_PENALTY:uw,ASSIGN_BYE:"BYE",SEED_VALUE:RI};function bCe({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:kt};if(!r)return{error:Fc};if(i?.length!==2)return{error:we,drawPositions:i};let a=os({drawDefinition:e}),{matchUps:s}=ia({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:o}=di({drawDefinition:e,structureId:r});if(!o)return{error:an};let l=tr({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},c;if(o.structureType===$o?c=KXe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}):c=qXe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}),c.error)return c;if(GY({structure:o,drawPositions:i}),TM({appliedPolicies:l,drawDefinition:e,positionAction:{name:vCe,drawPositions:i,structureId:r}}),Ym({tournamentId:t?.tournamentId,drawDefinition:e,structure:o,event:n}),n.eventType===Jl){let u=dr({matchUpFilters:{matchUpTypes:[Pc]},inContext:!0,structure:o}).matchUps.filter(p=>p.drawPositions?.some(f=>i.includes(f))),d=dr({matchUpFilters:{matchUpTypes:[Pc]},structure:o}).matchUps;u.forEach(p=>{(p.sides||[]).forEach(f=>{let h=f?.drawPosition;if(i.includes(h)){let m=f.participantId,A=d.find(({matchUpId:v})=>v===p.matchUpId),g=p?.sides?.reduce((v,b,y)=>b.drawPosition===h?y:v,void 0);y7({inContextTargetMatchUp:p,drawPositionSideIndex:g,teamParticipantId:m,tournamentRecord:t,drawDefinition:e,matchUp:A,event:n})}})})}return kr({drawDefinition:e,structureIds:[r]}),{...oe}}function qXe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a?.positionAssignments.filter(c=>r?.includes(c.drawPosition));if(!o)return{error:we,structure:a,info:"Missing positionAssignments"};if(o.filter(({bye:c})=>c).length===2)return{...oe};if(o.filter(({qualifier:c})=>c).length===2)return{...oe};let l=o.some(({qualifier:c})=>c);return o.some(({bye:c})=>c)&&!l?ICe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s}):WXe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s})}function ICe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=r.find(({bye:h})=>h),l=r.find(({participantId:h})=>h),c=o.drawPosition,{participantId:u,drawPosition:d}=l,{structureId:p}=a,f=XP({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return f.error||(f=XP({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),f.error)||(Hc({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:s}),f=vf({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:u,matchUpsMap:n,event:s}),f.error)?f:{...oe}}function WXe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=Object.assign({},...r.map((l,c)=>{let{drawPosition:u}=l,d={...r[1-c],drawPosition:u};return{[u]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>o[l.drawPosition]||l),I7({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:s}),{...oe}}function KXe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a.structures?.reduce((c,u)=>{let d=u?.positionAssignments.filter(p=>r?.includes(p.drawPosition));return d&&c.push(...d),c},[]);if(o.filter(({bye:c})=>c).length===2)return{...oe};if(o.filter(({qualifier:c})=>c).length===2)return{...oe};I7({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:o,structure:a,event:s});let l=o.some(({qualifier:c})=>c);if(o.some(({bye:c})=>c)&&!l)ICe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s});else{let c=Dt(o,!1,!0);o.forEach((u,d)=>{let p=c[1-d].participantId;u.qualifier=c[1-d].qualifier,u.participantId=p})}return{...oe}}function wCe({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){let n="removeSeededParticipant";if(!t)return{error:nt};if(!e)return{error:kt};let a=(e.structures??[]).find(s=>s.structureId===r);return a?!a.stage||![Et,qt].includes(a.stage)||a.stage===Et&&a.stageSequence!==1?ce({result:{error:mb},stack:n}):a.seedAssignments?.find(s=>s.participantId===i)?{...oe}:ce({info:"participant not seeded",result:{error:rs},context:{participantId:i}}):ce({result:{error:an},stack:n})}function KM({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=Ph}){return!r||!n?{error:Fc}:{link:Lt({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:jd,roundNumber:t,structureId:n}})}}function IS({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>YM({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function YM({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:s,matchUpType:o,collectionId:l,processCodes:c}=e||{},u=i??s??0,d=p=>{if(!n&&!r?.isMock)return a?.pop()??hr();let f=e?.collectionId;return a?.pop()??`${r?.matchUpId}-${f}-TMU-${p+1}`};return vt(0,u).map(p=>{let f=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Nn,collectionPosition:f,collectionId:l,processCodes:c,matchUpType:o,isMock:n}})}function N7({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:r?.pop()||hr()}function H_({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:s,nodes:o}){let l=0,c=[],u=1,d=i-1,p=o?.length;for(;l<(p||0);){let f=o?.[l],h=o?.[l+1];d&&(f.roundNumber=d),h&&d&&(h.roundNumber=d);let m=N7({roundPosition:u,roundNumber:i,idPrefix:n,uuids:s}),A={roundPosition:u,children:[f,h],matchUpId:m};c.push(A);let g={drawPositions:A.children.map(v=>v?.drawPosition).filter(Boolean),matchUpStatus:Nn,matchUpId:A.matchUpId,roundPosition:u,roundNumber:i};t&&e&&(g.matchUpType=e),a&&(g.isMock=!0),r.push(g),u++,l+=2}return{roundNodes:c,matchUps:r}}function yf({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:s,drawSize:o,isMock:l,uuids:c}){if(isNaN(o)||o<2||r&&o<=r)return{matchUps:[],roundsCount:0};if(r&&(!op(o)||o%r)){let A=r;for(;A<o;)A=2*A;o=A}let u=r&&!(o%2)&&(!isNaN(r)||i&&!isNaN(i))&&(o/r===Math.round(o/r)||i&&o/i===Math.round(o/i));if(!op(o)&&!u)return{matchUps:[],roundsCount:0};let d=vt(1,o+1).map(A=>({drawPosition:A})),p,f=[],h=1;for({roundNodes:p,matchUps:f}=H_({matchUpType:n,roundNumber:h,idPrefix:s,matchUps:f,isMock:l,nodes:d,uuids:c}),h++,a=a??i;p.length>1;)r&&p.length===r&&(a=h-1),{roundNodes:p,matchUps:f}=H_({nodes:p,matchUpType:n,roundNumber:h,idPrefix:s,matchUps:f,isMock:l,uuids:c}),h++;let m=h-1;return f=LM({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:a,matchUps:f}),a?f=f.filter(A=>a&&(A.roundNumber??0)<=a):a=h-1,{drawSize:o,matchUps:f,roundsCount:m,roundLimit:a}}function YXe(t,e){return t.drawDefinition?t.drawSize&&!wi(t.drawSize)||t.participantsCount&&!wi(t.participantsCount)||t.qualifyingPositions&&!wi(t.qualifyingPositions)?ce({result:{error:we},stack:e}):t.drawSize?t.qualifyingPositions&&t.qualifyingPositions>=t.drawSize?ce({result:{error:we},context:{drawSize:t.drawSize,qualifyingPositions:t.qualifyingPositions},stack:e}):null:ce({result:{error:oM},context:{drawSize:t.drawSize},stack:e}):ce({result:{error:kt},stack:e})}function XXe(t,e,i){let{structureProfiles:r}=g$({drawDefinition:t});return r[e]||ce({result:{error:an},context:{targetStructureId:e},stack:i})}function ZXe(t){let{maxRoundNumber:e,structures:i,groupCount:r}=jM(t);return{qualifiersCount:r,roundLimit:e,structure:i[0],finishingPositions:[1]}}function JXe(t){let{drawSize:e,matchUps:i,roundLimit:r,roundsCount:n}=yf(t);r||(r=n);let a=nu({structureName:t.structureName,structureId:t.structureId,qualifyingRoundNumber:r,stage:qt,matchUpFormat:t.matchUpFormat,stageSequence:t.stageSequence,matchUpType:t.matchUpType,roundLimit:r,matchUps:i});t.roundTarget&&ur({extension:{name:Mf,value:t.roundTarget},element:a});let s=i?.filter(o=>o.roundNumber===r)?.length??0;return{drawSize:e,structure:a,matchUps:i,roundLimit:r,qualifiersCount:s}}function B7(t){let e="generateQualifyingStructure",i=YXe(t,e);if(i)return i;let r=t.drawSize??b8(t.participantsCount),{hasExistingDrawDefinition:n,qualifyingRoundNumber:a,qualifyingPositions:s,targetStructureId:o,structureOptions:l,appliedPolicies:c,qualifyingOnly:u,drawDefinition:d,matchUpFormat:p,structureName:f,structureId:h,roundTarget:m,tieFormat:A,drawType:g,idPrefix:v,isMock:b,uuids:y}=t,I=XXe(d,o,e);if(I?.error)return I;let w=d.matchUpType,S=1,T=m?`${m}-`:"",D=typeof I=="object"&&"stage"in I&&I.stage===qt,C=c?.[zm]?.namingConventions?.pre??c7e[zm]?.namingConventions?.pre,E=D&&C?`${C}-`:"",P=f??(T?`${E}${_s(qt)} ${T}`:`${E}${_s(qt)}`),R,M,N,k,O;if(g===Sd){let _=ZXe({structureName:f??P,structureId:h??y?.pop(),hasExistingDrawDefinition:n,stage:qt,structureOptions:l,appliedPolicies:c,qualifyingOnly:u,stageSequence:S,matchUpType:w,roundTarget:m,tieFormat:A,idPrefix:v,drawSize:r,isMock:b,uuids:y});k=_.qualifiersCount,N=_.roundLimit,R=_.structure,O=_.finishingPositions}else{let _=JXe({qualifyingRoundNumber:a,qualifyingPositions:s,matchUpType:w,idPrefix:v,drawSize:r,isMock:b,uuids:y,structureName:f??P,structureId:h??y?.pop(),matchUpFormat:p,stageSequence:S,roundTarget:m});r=_.drawSize,R=_.structure,N=_.roundLimit,k=_.qualifiersCount}let x=g===Sd?Dh:Ph,F=R&&N&&KM({sourceStructureId:R.structureId,sourceRoundNumber:N,targetStructureId:o,finishingPositions:O,linkType:x})?.link;return A&&(M=dr({structure:R})?.matchUps||[],M?.forEach(_=>{let{tieMatchUps:V}=IS({tieFormat:A,matchUp:_,isMock:b});Object.assign(_,{tieMatchUps:V,matchUpType:w})})),{qualifyingDrawPositionsCount:r,qualifiersCount:k,...oe,structure:R,link:F}}function SCe(t){if(!t.tournamentRecord)return{error:nt};let e=eZe(t);return e.error,e}function eZe(t){if(!t.drawDefinition)return{error:kt};if(!t.targetStructureId)return{error:Fc};let e=B7(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:we}:C7({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function UCe(t){let e=Qt(t,[{[ro]:!0,[H2]:!0,[Rf]:!0},{[cYe]:!0,[Ps]:d=>Number.isInteger(d)&&d>0},{[Ps]:d=>Array.isArray(d)&&d.length===2&&d.every(rn),[Nc]:Ll,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r,tournamentRecord:n,event:a}=t,{structure:s}=di({drawDefinition:i,structureId:r});if(!s)return{error:an};if(!el({structure:s}))return{error:mb};let o=d=>d.sides?.map(p=>p.participantId).some(p=>t.participantIds.includes(p)),l=d=>d.roundNumber===t.roundNumber,c=d=>!wa(d),u=(s?.matchUps??[]).filter(l).filter(c).filter(o);if(u.length!==2)return{error:Ll};for(let d of u){let p=d?.sides?.find(f=>t.participantIds.includes(f?.participantId));if(p){let f=t.participantIds.find(h=>h!==p?.participantId);p.participantId=f,Zi({tournamentId:n?.tournamentId,eventId:a?.eventId,drawDefinition:i,matchUp:d})}}return kr({drawDefinition:i,structureIds:[r]}),{...oe}}function tZe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:s,uuids:o,nodes:l,fed:c}){let u=l.length,d=e?e-u:void 0,p=vt(0,u).map(m=>d?d+m:void 0),f=[];for(let m=0;m<u;m++){let A=p.shift(),g={drawPosition:A,fed:c+1,feed:!0},v=l[m];v.roundNumber=i-1;let b=N7({roundPosition:v.roundPosition,roundNumber:i,idPrefix:n,uuids:o}),y={roundPosition:v.roundPosition,drawPositions:[A],matchUpStatus:Nn,roundNumber:i,matchUpId:b};t&&(y.matchUpType=r),s&&(y.isMock=!0),a.push(y);let I={children:[v,g]};f.push(I)}let h=e?e-u:void 0;return{roundNodes:f,matchUps:a,drawPosition:h}}function Dg(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:s,finishingPositionOffset:o,linkFedRoundNumbers:l,feedsFromFinal:c,isConsolation:u,matchUpType:d,idPrefix:p,isMock:f,uuids:h,fmlc:m}=t;a=a??M(e);let A=iZe({drawSize:a}),g=A.length,v=0;if(i?.length)v=i.reduce((N,k)=>N+k,0);else if(e){let N=e-a;i=A.filter(k=>k<=N?(N-=k,!0):!1),v=i.reduce((k,O)=>k+O,0),r=i.length}else n>=g?r=0:c&&(r=g-c,n=0),i=A.filter((N,k)=>c&&!r||r&&k>=n+r||k<n?0:N),v=i.reduce((N,k)=>N+k,0),r=i.length;let b=[...A,...i].sort((N,k)=>k-N),y=b.length,I=[...(l??[]).map(N=>N-1),...(s??[]).map(N=>y-N)].map(N=>b[N]).reduce((N,k)=>N+k,0);v=v-I;let w=0,S=[],T,D=1,C=vt(0,a).map((N,k)=>({drawPosition:k+1+v})),E=v+1;for(let N of A){if({roundNodes:T,matchUps:S}=H_({matchUpType:d,roundNumber:D,idPrefix:p,matchUps:S,isMock:f,nodes:C,uuids:h}),D++,i.includes(N)){let k=Xl(i)[N],O=vt(0,k),x=y+1-D,F=s?.includes(x)??l?.includes(D);O.forEach(()=>{({roundNodes:T,matchUps:S,drawPosition:E}=tZe({drawPosition:!F&&E||void 0,nodes:T,matchUpType:d,roundNumber:D,idPrefix:p,matchUps:S,isMock:f,uuids:h,fed:w})),D++,w+=1})}C=T}y!==D-1&&console.log("ERROR");let P=a-v;S=LM({finishingPositionOffset:u?P:o,positionsFed:v,roundsCount:y,matchUps:S,fmlc:m});let R=T?.length?T[0]:T;return R&&(R.roundNumber=D-1,R.matchUps=S),{draw:R,matchUps:S,roundsCount:y};function M(N){let k=I8(N);return k>N?k/2:k}}function iZe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return vt(0,e).reverse().map(i=>Math.pow(2,i))}function tT(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,stageSequence:o=1,exitProfile:l="0",exitProfileLimit:c,roundOffsetLimit:u,roundOffset:d=0,drawDefinition:p,staggeredEntry:f,sequenceLimit:h,stage:m=Et,drawSize:A,idPrefix:g,isMock:v,uuids:b}=t;if(!(!s||!c||s?.[l])||A<2||h&&o>h)return{};let y=[],I=[],w=[],S=t.matchUpType??p?.matchUpType,T=e+1,D=e+A,C=`${T}-${D}`,E=s?.[l],P=r&&`${r} `||"",R=s?.[C]??n?.[C],M=t.structureName||R?.name||E?.name&&(i?`${P}${E?.name}`:E.name)||`${P}${C}`,N=R?.abbreviation??E?.abbreviation,k=t.structureId??E?.structureId??b?.pop(),O={idPrefix:g&&`${g}-${M}-RP`,finishingPositionOffset:e,matchUpType:S,drawSize:A,isMock:v,uuids:b},{matchUps:x}=f?Dg(O):yf(O),F=nu({structureAbbreviation:N,stageSequence:o,structureName:M,matchUpType:S,roundOffset:d,structureId:k,matchUps:x,stage:m});y.push(...x),I.push(F);let _=Math.ceil(Math.log(A)/Math.log(2)),V=u?Math.min(u-d,_):(!a||T<a)&&_||0;return A>2&&vt(1,V+1).forEach(z=>G(z)),{structureId:F.structureId,matchUps:y,structureName:M,structures:I,links:w,...oe};function G(z){let Q=A/Math.pow(2,z);if(Q<2)return;let j=A/Math.pow(2,z)+e;if(a&&j+1>a)return;let{structures:W,structureId:Y,matchUps:X,links:J}=tT({finishingPositionOffset:j,exitProfile:`${l}-${z}`,roundOffset:d+z,stageSequence:o+1,drawSize:Q,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,exitProfileLimit:c,roundOffsetLimit:u,drawDefinition:p,sequenceLimit:h,matchUpType:S,idPrefix:g,uuids:b,stage:m});if(F.structureId&&Y){let ie={linkType:Rh,source:{roundNumber:z,structureId:F.structureId},target:{roundNumber:1,feedProfile:Ju,structureId:Y}};J&&F&&J.push(ie),J?.length&&w.push(...J)}return W?.length&&I.push(...W),X?.length&&y.push(...X),{structureId:Y,childLinks:J,structures:I}}}function k7({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=di({drawDefinition:t,structureId:i});if(r.error)return ce({result:r});let{matchUps:n}=dr({structure:r.structure,matchUpsMap:e});return{...Oo({matchUps:n}),matchUps:n,matchUpsMap:e}}function yie({finishingPositions:t,drawDefinition:e,structureId:i}){let{roundProfile:r}=k7({drawDefinition:e,structureId:i});return(r&&Object.keys(r))?.reduce((n,a)=>(TCe(r?.[a]).forEach(s=>{t.forEach(o=>{rZe({position:o,rangeDefinition:s})&&(n[o]={roundNumber:a})})}),n),{})}function rZe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return vt(i,(r||i)+1).includes(t)}function TCe(t){return[Ei(t?.finishingPositionRange?.loser||[]),Ei(t?.finishingPositionRange?.winner||[])]}function nZe(t){return TCe(t).map(e=>vt(e[0],e[1]&&e[1]+1||e[0]+1))}function PE({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:we,context:{structureIds:e}};if(!t)return{error:kt};e=e??(t.structures??[]).filter(a=>a.stage!==qt).map(({structureId:a})=>a);let r=e.map(a=>{let{roundProfile:s}=k7({drawDefinition:t,matchUpsMap:i,structureId:a});return(s&&Object.values(s))?.map(nZe).flat()}).flat(),n=r.filter(a=>a?.length===1).sort(ua).flat();return{positionsNotPlayedOff:Ei(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function CCe({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:kt};if(!r)return{error:Fc};if(!e)return{error:Yt,info:"missing playoffPositions"};let n=PE({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,s=e.filter(g=>!a.includes(g)),o=yie({finishingPositions:s,drawDefinition:i,structureId:r}),l=Object.values(o).reduce((g,v)=>g.includes(v.roundNumber)?g:g.concat(v.roundNumber),[]).map(g=>ci(g)).filter(g=>!t.includes(g)),c=yie({finishingPositions:a,drawDefinition:i,structureId:r}),u=c?Object.values(c):[],d=c?u.reduce((g,v)=>g.includes(v.roundNumber)?g:g.concat(v.roundNumber),[]).map(g=>ci(g)):[],p=l.filter(g=>!d.includes(g)).sort(ua),{roundProfile:f}=k7({drawDefinition:i,structureId:r}),h=p.map(g=>{let v=f?.[g].finishingPositionRange.loser,[b,y]=v??[0,0];return vt(b,(y||b)+1)}).flat().sort(ua),{playoffRoundsRanges:m}=aZe({playoffSourceRounds:p,roundProfile:f}),A=[...p,...d];return{playoffPositionsReturned:h,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:A,roundProfile:f}}function aZe({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,s=vt(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:s,roundNumber:i}})}}function XM({drawDefinition:t,structureId:e}){if(!t)return{error:kt};let{matchUps:i,matchUpsMap:r}=No({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=PE({drawDefinition:t,matchUpsMap:r}),{structures:s}=Td({drawDefinition:t}),o=s.filter(c=>!e&&c.stage!==Za||c.structureId===e),l={};for(let c of o){let u=c?.structureId,d=sZe({playoffPositions:n,drawDefinition:t,structure:c,matchUps:i}),{error:p,...f}=d;if(p)return d;l[u]={structureId:u,...f}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function sZe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){let n=i?.structureId,{links:a}=wE({drawDefinition:e,structureId:n});if(i.structureType===$o||i.structures){let f=wr({structure:i})?.positionAssignments?.length,h=i.structures.length,m=(f??0)/h,A=a.source?.flatMap(({source:C})=>C?.finishingPositions||[])||[],g=vt(1,m+1).filter(C=>!A.includes(C)),v=r.find(C=>C.containerStructureId===n&&C.finishingPositionRange)?.finishingPositionRange?.winner||[0,1],b=a?.source.map(({target:C})=>C.structureId),{positionsPlayedOff:y=[],positionsNotPlayedOff:I=[]}=PE({structureIds:b,drawDefinition:e}),w=[...y,...I],S=vt(v[0],v[1]+1).filter(C=>!w.includes(C)),T=$a(S,S.length/g.length),D=g.map((C,E)=>{let P=T[E],R=[Math.min(...P||[]),Math.max(...P||[])].join("-");return{finishingPosition:C,finishingPositions:P,finishingPositionRange:R}});return{positionsNotPlayedOff:S,playoffFinishingPositionRanges:D,finishingPositionsAvailable:g,finishingPositionsPlayedOff:A,positionsPlayedOff:y,groupCount:h,groupSize:m}}let s=a?.source?.filter(f=>f.linkCondition!==Af).map(f=>f.source?.roundNumber)||[],o=a?.source?.filter(f=>f.linkCondition===Af).map(f=>f.source?.roundNumber)||[],l=CCe({excludeRoundNumbers:s,playoffPositions:t,drawDefinition:e,structureId:n}),c=l?.playoffSourceRounds?[...l?.playoffSourceRounds||[]]:void 0,u=[...l?.playoffRoundsRanges||[]],{roundProfile:d,error:p}=l;for(let f of o){let h=a?.source.find(b=>b.source.roundNumber===f),m=h?.target.roundNumber,A=h?.target.structureId,g=r.filter(({roundNumber:b,structureId:y})=>y===A&&b===m),v=g.filter(({sides:b})=>b.find(y=>y.participantFed&&!y.participantId)).length;if(c&&v===g.length){c.push(f);let b=d?.[f]?.finishingPositionRange?.loser;if(b){let y=Math.min(...b),I=y+v,w=vt(y,I),S={finishingPositionRange:[y,I-1].join("-"),finishingPositions:w,roundNumber:f};u.push(S)}}}return c&&c.sort(ua),u.sort((f,h)=>f.roundNumber-h.roundNumber),{playoffRounds:c,playoffRoundsRanges:u,error:p}}function oZe({playoffGroups:t,drawDefinition:e,structureId:i}){if(!e)return{error:kt};if(!rn(i)||!Array.isArray(t))return{error:we};let r=t.map(({finishingPositions:n})=>n).flat();return{positionRangeMap:XM({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges?.filter(n=>r.includes(n.finishingPosition))?.reduce((n,a)=>(n[a.finishingPosition]=a,n),{})}}function ECe(t){let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:r=1,staggeredEntry:n,structureName:a,stage:s=Et,matchUpType:o,structureId:l,idPrefix:c,drawSize:u,isMock:d,uuids:p}=t,f={finishingPositionOffset:e,matchUpType:o,drawSize:u,idPrefix:c,isMock:d,uuids:p},{matchUps:h}=n?Dg(f):yf(f),m=nu({structureName:a||i?.["0"]?.name||_s(Et),structureId:l||p?.pop(),stageSequence:r,matchUpType:o,matchUps:h,stage:s}),A=[m],g=[];if(u>2){let v=u/2,{matchUps:b}=yf({finishingPositionOffset:e+v,idPrefix:c&&`${c}-c`,drawSize:v,matchUpType:o,isMock:d}),y=_s(Ls),I=i?.["0-1"]?.name??t.consolationStructureName??(a?`${a} ${y}`:y),w=nu({structureName:I,matchUps:b,structureId:p?.pop(),stage:Ls,stageSequence:1,matchUpType:o});A.push(w);let S={linkType:Rh,source:{roundNumber:1,structureId:m.structureId},target:{roundNumber:1,feedProfile:Ju,structureId:w.structureId}};g.push(S)}return{...oe,structures:A,links:g}}function DCe({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let s=t.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),o=n?.roundGroupedOrder||[],l=n?.roundFeedProfiles;return vt(1+e,r+1+e).map(c=>{let u=l?.[c-1]?l[c-1]:c%2&&Ju||Oy,d=c-e<=2?c-e:(c-e-2)*2+2,p={linkType:Rh,source:{roundNumber:c,structureId:i.structureId},target:{feedProfile:u,roundNumber:d,structureId:t.structureId}},f=o[c-1];return f&&(p.target.groupedOrder=f),Mc()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),c===2&&a&&(p.linkCondition=Af,p.target.feedProfile=Ju),s.includes(d)?p:void 0}).filter(Boolean)}function PCe(t){let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:r=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:s,stage:o=Et,matchUpType:l,structureId:c,drawSize:u,idPrefix:d,isMock:p,uuids:f}=t,h={finishingPositionOffset:i,matchUpType:l,drawSize:u,idPrefix:d,isMock:p,uuids:f},{matchUps:m,roundsCount:A}=s?Dg(h):yf(h),g=t.structureName??n?.["0"]?.name??_s(Et),v=lg({structureId:c||f?.pop(),structureName:g,stageSequence:r,matchUpType:l,matchUps:m,stage:o}),b=[v],y=[];if(u>2){let I=[0,2].slice(0,u/16).map((w,S)=>{let T=S+1,{consolationStructure:D}=lZe({idPrefix:d&&`${d}-c${S}`,structureId:f?.pop(),playoffStructureNameBase:e,playoffAttributes:n,structureNameMap:a,stageSequence:T,roundOffset:w,matchUpType:l,drawSize:u,isMock:p,index:S,uuids:f});b.push(D);let C=DCe({consolationStructure:D,roundsCount:2,mainStructure:v,roundOffset:w});return{consolationStructure:D,links:C}}).map(w=>w.links).flat();if(y.push(...I),u>=4&&u<=16||u>32){let{matchUps:w}=yf({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),S=n?.["3-4"]?.name??_s(Dn),T=a?.[S]||S,D=e?`${e} ${T}`:T,C=lg({structureId:f?.pop(),matchUps:w,stageSequence:2,stage:Dn,structureName:D,matchUpType:l}),E={linkType:Rh,source:{roundNumber:A-1,structureId:v.structureId},target:{structureId:C.structureId,feedProfile:Ju,roundNumber:1}};b.push(C),y.push(E)}}return{structures:b,links:y,...oe}}function lZe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:s,idPrefix:o,drawSize:l,isMock:c,index:u,uuids:d}){let p=l/(2*Math.pow(2,n)),{matchUps:f,roundsCount:h}=Dg({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:o,isMock:c,uuids:d}),m=u===0&&i?.["0-1"]?.name||u===1&&i?.["0-3"]?.name||`${_s(Ls)} ${u+1}`,A=r?.[m]||m,g=t?`${t} ${A}`:A;return{consolationStructure:lg({matchUps:f,stage:Ls,structureName:g,stageSequence:e,matchUpType:a,structureId:s}),consolationRoundsCount:h}}function Zb(t){let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:r,feedsFromFinal:n,staggeredEntry:a,structureName:s,stage:o=Et,structureId:l,matchUpType:c,skipRounds:u,feedRounds:d,idPrefix:p,drawSize:f,isMock:h,uuids:m,fmlc:A}=t,g=t.feedPolicy||t.policyDefinitions?.[XT]||t.appliedPolicies?.[XT],v={finishingPositionOffset:e,matchUpType:c,skipRounds:u,drawSize:f,idPrefix:p,isMock:h,uuids:m},{matchUps:b}=a?Dg(v):yf(v),y=nu({structureName:s||r?.["0"]?.name||_s(Et),structureId:l||m?.pop(),stageSequence:i,matchUpType:c,matchUps:b,stage:o}),I=[y],w=[],S=f/2,{matchUps:T,roundsCount:D}=Dg({finishingPositionOffset:S,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:S,matchUpType:c,feedRounds:d,skipRounds:u,isMock:h,uuids:m,fmlc:A});if(f>2){let C=r?.["0-1"]?.name??_s(Ls),E=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${C}`:C,P=nu({matchUps:T,structureId:m?.pop(),stage:Ls,stageSequence:1,structureName:E,matchUpType:c});I.push(P);let R=DCe({consolationStructure:P,mainStructure:y,roundsCount:D,feedPolicy:g,fmlc:A});w.push(...R)}return{...oe,structures:I,links:w}}function RCe({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:s,playoffGroups:o,matchUpType:l,feedPolicy:c,groupCount:u,idPrefix:d,isMock:p,uuids:f}){c=c||n?.[XT];let h="processPlayoffGroups",m=0,A=[],g=[],v=[],{error:b,positionRangeMap:y}=oZe({structureId:r,drawDefinition:s,playoffGroups:o});if(b)return ce({result:{error:b},stack:h});if(!(!y||o?.every(I=>{let{finishingPositions:w=[]}=I;if(!w.length)return!1;let S=[...w].sort(ua).map((T,D)=>(w[D+1]||T)-T).every(T=>T<2);return(!t||S)&&w.every(T=>y[T])})))return ce({context:{validFinishingPositions:Object.values(y)},result:{error:we},stack:h});for(let I of o){let w=I.finishingPositions,S=y&&w.flatMap(N=>y[N]?.finishingPositions??[]),T=u*w.length,D=lE(T),C=D===2&&Kp||I.drawType||Kp;S&&(m=Math.min(...S)-1);let E=S&&`${Math.min(...S)}-${Math.max(...S)}`,P=I.structureName||E&&I.playoffAttributes?.[E]?.name||I.playoffAttributes?.["0"]?.name,R={addNameBaseToAttributeName:I.addNameBaseToAttributeName,playoffStructureNameBase:I.playoffStructureNameBase,finishingPositionNaming:I.finishingPositionNaming,finishingPositionLimit:I.finishingPositionLimit,structureId:I.structureId??f?.pop(),playoffAttributes:I.playoffAttributes,structureNameMap:I.structureNameMap,sequenceLimit:I.sequenceLimit,structureName:P,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:m,stage:Dn,stageSequence:a,matchUpType:l,drawSize:D,isMock:p,uuids:f},M=({playoffStructures:N,playoffLinks:k})=>{let[O]=N,x=lB({playoffStructureId:O.structureId,finishingPositions:w,sourceStructureId:r});v.push(x,...k),g.push(...N),A.push({structureId:O.structureId,finishingPositions:w}),m+=T};if(C===Kp){let{matchUps:N}=yf({finishingPositionLimit:m+T,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,matchUpType:l,drawSize:D,isMock:p,uuids:f}),k=nu({structureId:I.structureId??f?.pop(),matchUpFormat:e,stage:Dn,structureName:P,stageSequence:a,matchUps:N});g.push(k);let O=lB({playoffStructureId:k.structureId,finishingPositions:w,sourceStructureId:r});v.push(O),m+=T,A.push({structureId:k.structureId,finishingPositions:w})}else if([qT,WT,Dn].includes(C)){let N={playoffAttributes:I.playoffAttributes??i,playoffStructureNameBase:I.playoffStructureNameBase,structureId:I.structureId??f?.pop(),structureName:I.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:m,stage:Dn,roundOffset:0,stageSequence:a,drawSize:D,isMock:p,uuids:f};C===qT?Object.assign(N,{playoffAttributes:I?.playoffAttributes??i??uY,roundOffsetLimit:3}):C===WT&&Object.assign(N,{playoffAttributes:I?.playoffAttributes??i??dY,roundOffsetLimit:2});let k=tT(N);if(k.error)return k;if(k.links?.length&&v.push(...k.links),k.structures?.length&&g.push(...k.structures),g.sort(cS),k.structureId){let O=lB({playoffStructureId:k.structureId,finishingPositions:w,sourceStructureId:r});v.push(O),A.push({structureId:k.structureId,finishingPositions:w})}m+=T}else if([KT,yM,VP,HP,$P,GP].includes(C)){let N=[f?.pop(),f?.pop()],k={playoffStructureNameBase:I.playoffStructureNameBase,structureId:I.structureId??f?.pop(),playoffAttributes:I.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,uuids:N,stage:Dn,structureName:P,matchUpType:l,feedPolicy:c,drawSize:D,isMock:p},O={[KT]:{fmlc:!0,feedRounds:1},[GP]:{feedRounds:1},[VP]:{feedsFromFinal:3},[HP]:{feedsFromFinal:2},[$P]:{feedsFromFinal:1}};Object.assign(k,O[C]||{});let{structures:x,links:F}=Zb(k),[_]=x,V=lB({playoffStructureId:_.structureId,finishingPositions:w,sourceStructureId:r});v.push(V,...F),g.push(...x),A.push({structureId:_.structureId,finishingPositions:w}),m+=T}else if([Sd].includes(C)){let{structures:N,links:k}=jM({...R,structureOptions:I.structureOptions||{groupSize:4}});M({playoffStructures:N,playoffLinks:k})}else if([vM].includes(C)){let{structures:N,links:k}=ECe(R);M({playoffStructures:N,playoffLinks:k})}else if([rYe].includes(C)){let{structures:N,links:k}=PCe(R);M({playoffStructures:N,playoffLinks:k})}else if([ec].includes(C)){let N=nu({structureId:I.structureId??f?.pop(),structureName:I.structureName,finishingPosition:Qk,stage:Dn,stageSequence:a,matchUps:[]});M({playoffStructures:[N],playoffLinks:[]})}}return{finishingPositionTargets:A,positionRangeMap:y,structures:g,links:v}}function lB({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:Dh,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:jd,roundNumber:1}}}function cZe(t){let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return ce({result:{error:Yt},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:r,tournamentRecord:n,drawDefinition:a,playoffGroups:s,groupCount:o,groupSize:l,event:c}=t,u=RCe({requireSequential:r,sourceStructureId:i,playoffGroups:s,groupCount:o,...t});if(u.error)return ce({result:u,stack:e});let{structures:d=[],links:p=[],finishingPositionTargets:f,positionRangeMap:h}=u,m=f?.map(({finishingPositions:T})=>T).flat().map(T=>h[T].finishingPositions).flat();a.structures.push(...d),a.links.push(...p);let{matchUps:A,matchUpsMap:g}=ia({inContext:!0,drawDefinition:a}),v=d.map(({structureId:T})=>T),b=A?.filter(({structureId:T})=>v.includes(T)).map(_a),y=g?.drawMatchUps?.filter(({matchUpId:T})=>b?.includes(T));if(y?.length){let T=po({drawDefinition:a,event:c})?.tieFormat;T&&y.forEach(D=>{let{tieMatchUps:C}=IS({isMock:t.isMock,tieFormat:T,matchUp:D});Object.assign(D,{tieMatchUps:C,matchUpType:Pc})})}let{positionAssignments:I}=wr({structureId:i,drawDefinition:a}),w={};I?.forEach(T=>{let D=ki({element:T,name:Km})?.extension?.value?.groupOrder;D&&(w[D]||(w[D]=[]),w[D].push(T.participantId))});let S=DE({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:n,drawDefinition:a});return S.error&&S.error?.code!==w8.code?ce({result:S,stack:e}):{structures:d,links:p,positionsPlayedOff:m,drawDefinition:a,...oe}}function LU({value:t,sourceRange:e,targetRange:i}){let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),s=Math.max(...i);return(t-r)*(s-a)/(n-r)+a}var MCe="NTRP",NCe="DUPR",BCe="UTR_P",kCe="UTPR",xCe="SQUASH_LEVELS",_Ce="US_SQUASH",OCe="USATT",FCe="ITTF",LCe="USAR",uZe={ELO:"ELO",NTRP:MCe,TRN:"TRN",UTR:"UTR",WTN:"WTN",DUPR:NCe,UTR_P:BCe,UTPR:kCe,PSA:"PSA",SQUASH_LEVELS:xCe,US_SQUASH:_Ce,USATT:OCe,ITTF:FCe,USAR:LCe,BWF:"BWF"},dZe={ELO:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!1},[MCe]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!1,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!1,range:[1,16]},WTN:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!0,decimalsCount:2,range:[40,1]},[NCe]:{defaultInitialization:3.5,accessors:["duprRating","reliabilityScore"],accessor:"duprRating",attributes:{reliabilityScore:{generator:!0,range:[0,100]}},decimalsCount:3,ascending:!1,range:[2,8]},[BCe]:{defaultInitialization:5,accessors:["utrpRating","verified"],accessor:"utrpRating",attributes:{verified:{type:"boolean"},provisional:{type:"string"}},decimalsCount:1,ascending:!1,range:[1,10]},[kCe]:{defaultInitialization:3.5,accessor:"utprRating",decimalsCount:1,ascending:!1,range:[2,5],deprecated:!0},PSA:{defaultInitialization:500,accessor:"psaPoints",decimalsCount:0,ascending:!1,range:[0,3e3],attributes:{tournaments:{generator:!0,range:[1,20]},divisor:{generator:!0,range:[10,20]}}},[xCe]:{defaultInitialization:2e3,accessor:"squashLevel",decimalsCount:0,ascending:!1,range:[0,7e3]},[_Ce]:{defaultInitialization:3.5,accessor:"usSquashRating",decimalsCount:1,ascending:!1,range:[2,6]},[OCe]:{defaultInitialization:1e3,accessor:"usattRating",decimalsCount:0,ascending:!1,range:[200,3e3]},[FCe]:{defaultInitialization:500,accessor:"ittfPoints",decimalsCount:0,ascending:!1,range:[0,2e4]},[LCe]:{defaultInitialization:1e4,accessor:"usarRanking",decimalsCount:0,ascending:!0,range:[1,25e3]},BWF:{defaultInitialization:5e3,accessor:"bwfPoints",decimalsCount:0,ascending:!0,range:[0,15e4],attributes:{tournaments:{generator:!0,range:[1,10]}}}},qa=dZe;function pZe({sourceRatingType:t,sourceRating:e}){let i=qa[t].range,r=i[0]>i[1],n=qa.ELO.range;return LU({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function fZe({targetRatingType:t,sourceRating:e}){let i=qa[t].decimalsCount||0,r=qa[t].range,n=r[0]>r[1],a=Math.max(...r),s=qa.ELO.range,o=LU({targetRange:r,sourceRange:s,value:e}),l=Number.parseFloat(o.toFixed(i));return n?a-l:l}function bie(t){let e=Qt(t,[{ratings:!0,[rl]:fl}]);if(e.error)return e;let i=t.matchUpType&&[Dr,br].includes(t.matchUpType)?t.matchUpType:Dr,r=Object.keys(qa),n=t.targetRatingType&&r.includes(t.targetRatingType)?t.targetRatingType:"ELO",a=t.ratings[i]?t.ratings[i].reduce((d,p)=>d.includes(p.scaleName)?d:d.concat(p.scaleName),[]):[];if(!a)return{error:rs};let s=t.ratings[i]?.find(d=>d.scaleName===n)??t.ratings[i][0];if(a[0]===n)return s;let o=s.scaleName,l=qa[s.scaleName].accessor,c=l?s.scaleValue[l]:s.scaleValue,u=pZe({sourceRatingType:o,sourceRating:c});return{convertedRating:fZe({targetRatingType:n,sourceRating:u}),sourceRating:c}}function hZe({participantResults:t,sides:e,score:i}){let r=e.find(({sideNumber:o})=>o===1),n=e.find(({sideNumber:o})=>o===2),a=r?.participant?.ratings,s=n?.participant?.ratings;if(a?.[Dr]&&s?.[Dr]){let o="ELO",{convertedRating:l}=bie({ratings:a,targetRatingType:o}),{convertedRating:c}=bie({ratings:s,targetRatingType:o}),{side1pressure:u,side2pressure:d}=mZe({side1ConvertedRating:l,side2ConvertedRating:c,score:i});u&&t[r?.participantId].pressureScores.push(u),d&&t[n?.participantId].pressureScores.push(d);let p=Math.max(...qa.ELO.range),f=w_((c-l)/p),h=w_((l-c)/p);t[r?.participantId].ratingVariation.push(f),t[n?.participantId].ratingVariation.push(h)}}function mZe({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){let r=Math.max(t,e),n=Math.min(t,e),a=Math.abs(t-e),s=qa.ELO.range,o=Math.max(...s),l=(o-r)*0,c=(r+l)/o*a,u=i?.sets?.reduce((v,b)=>v+(b?.side1Score??0),0),d=i?.sets?.reduce((v,b)=>v+(b.side2Score??0),0),p=t>e?2:1,f=(u||0)*(n+(p===1?c:0)),h=(d||0)*(n+(p===2?c:0)),m=f+h,A=m?w_(f/m):0,g=m?w_(h/m):0;return{side1pressure:A,side2pressure:g}}function x7({winningSide:t,matchUpFormat:e=ld,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],s=n?.sets,o=typeof t=="number"&&t-1,l=ys(e),c=_7(l?.bestOf??1);if(typeof o=="number"&&(i===Nr&&r?.setsCreditForDefaults||i===Zr&&r?.setsCreditForWalkovers))a[o]=c;else for(let u of s||[]){let{winningSide:d}=u;d&&(a[d-1]+=1)}return typeof o=="number"&&i===Ha&&(+a[1-o]===c&&(a[1-o]-=1),r?.setsCreditForRetirements&&(a[o]=c)),a}function $Ce({matchUpFormat:t=ld,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){let{sets:a}=n||{};if(!a)return[0,0];let s=typeof e=="number"&&e-1,o=ys(t),l=o?.bestOf??1,c=_7(l),u=o?.setFormat?.tiebreakAt||0,d=[[],[]];if(typeof s=="number"&&(i===Nr&&r?.gamesCreditForDefaults||i===Zr&&r?.gamesCreditForWalkovers)){let p=o?.setFormat?.setTo||0,f=c*p;d[s].push(f)}else a.forEach((p,f)=>{let h=(p.setNumber||f+1)>c&&o?.finalSetFormat?"finalSetFormat":"setFormat",m=o?.[h]?.based,A=o?.[h].tiebreakSet,{side1Score:g,side2Score:v}=p;Iie(m)&&!A&&(d[0].push(ci(g||0)),d[1].push(ci(v||0))),A&&p.winningSide&&r?.gamesCreditForTiebreakSets!==!1&&d[p.winningSide-1].push(1)});if(i===Ha&&typeof s=="number"){let p=a.length>c&&o?.finalSetFormat?"finalSetFormat":"setFormat",f=o?.[p];if(Iie(f.based)){let h=f?.setTo||0,m=g=>{if(!(!o||g===""))return+g===u-1||+g===u?ci(u||0)+1:+g<u?h:u},A=x7({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(d.map(g=>g[s]<=g[1-s]).reduce((g,v)=>g+(v?1:0),0)>A[1-s]){let g=d[s].length,v=m(d[1-s][g-1]);v&&(d[s][g-1]=v)}c>d[s].length&&r?.gamesCreditForRetirements&&d[s].push(h)}}return[d[0].reduce((p,f)=>p+f,0),d[1].reduce((p,f)=>p+f,0)]}function HCe({matchUpFormat:t,score:e}){let i=t?ys(t):void 0,r=i?.bestOf??1,n=_7(r),a=[0,0],s=[0,0];return e?.sets?.forEach((o,l)=>{let c=(o.setNumber||l+1)>n&&i?.finalSetFormat?"finalSetFormat":"setFormat",u=i?.[c]?.based;if(VCe(u)){let{side1Score:d,side2Score:p}=o;d&&(s[0]+=ci(d||0)),p&&(s[1]+=ci(p||0))}else o.side1TiebreakScore&&(s[0]+=ci(o.side1TiebreakScore||0)),o.side2TiebreakScore&&(s[1]+=ci(o.side2TiebreakScore||0)),(o.side1TiebreakScore||o.side2TiebreakScore)&&o.winningSide&&(a[o.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:a}}function _7(t){return t&&Math.ceil(t/2)||1}function VCe(t){return t==="P"}function Iie(t){return!VCe(t)}function AZe({participantResults:t,groupingTotal:e,matchUpFormat:i,tallyPolicy:r,totalGames:n,perPlayer:a,totalSets:s}){let o=i&&ys(i)||{},l=o.bestOf,c=l&&Math.ceil(l/2)||1,u=o.setFormat?.setTo,d=Math.pow(10,r?.precision||3);Object.keys(t).forEach(p=>{let f=t[p].setsWon,h=t[p].setsLost,m=r?.groupTotalSetsPlayed||e==="setsPct"?s:a*c||f+h,A=Math.round(f/m*d)/d;(A===1/0||Number.isNaN(A))&&(A=m);let g=t[p].tieMatchUpsWon,v=t[p].tieMatchUpsLost,b=g+v,y=Math.round(g/b*d)/d;(y===1/0||Number.isNaN(y))&&(y=g);let I=t[p].matchUpsWon,w=t[p].matchUpsLost,S=I+w,T=Math.round(I/S*d)/d;(T===1/0||Number.isNaN(T))&&(T=I);let D=t[p].gamesWon||0,C=t[p].gamesLost||0,E=(a||0)*c*(u||0),P=r?.groupTotalGamesPlayed||e==="gamesPct"?n:Math.max(E,D+C),R=Math.round(D/P*d)/d;(R===1/0||Number.isNaN(R))&&(R=0);let M=t[p].pointsWon+t[p].pointsLost,N=Math.round(t[p].pointsWon/M*d)/d;(N===1/0||Number.isNaN(N))&&(N=0),t[p].setsWon=f,t[p].setsLost=h,t[p].setsPct=A,t[p].tieMatchUpsWon=g,t[p].tieMatchUpsPct=y,t[p].matchUpsPct=T,t[p].gamesWon=D,t[p].gamesLost=C,t[p].gamesPct=R,t[p].pointsPct=N,t[p].result=`${t[p].matchUpsWon}/${t[p].matchUpsLost}`})}function ZM({participantIds:t,pressureRating:e,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,perPlayer:a,matchUps:s}){let o={},l=n?.excludeMatchUpStatuses||[],c=s?.filter(f=>(f.tieMatchUps||!l.includes(f.matchUpStatus))&&(!t?.length||Mn(t,[$U(f,0),$U(f,1)]).length===2)),u=c?.flatMap(({score:f,tieMatchUps:h})=>h?h.filter(({matchUpStatus:m})=>!l.includes(m)).flatMap(({score:m})=>m?.sets?.length??0):f?.sets?.length??0)?.reduce((f,h)=>f+h,0),d=f=>f?.sets?.reduce((h,m)=>h+(m?.side1Score??0)+(m?.side2Score??0),0)??0,p=c?.flatMap(({score:f,tieMatchUps:h})=>h?h.filter(({matchUpStatus:m})=>!l.includes(m)).flatMap(({score:m})=>d(m)):d(f))?.reduce((f,h)=>f+h,0);for(let f of c??[]){let{matchUpStatus:h,tieMatchUps:m,tieFormat:A,score:g,winningSide:v,sides:b}=f,y=A&&f._disableAutoCalc&&A.collectionDefinitions.every(({scoreValue:S})=>S),I=v&&gZe(f),w=v&&vZe(f);if(!I&&!w)if(h&&ta.includes(h)){let S=$U(f,0),T=$U(f,1);S&&(XA(o,S),o[S].matchUpsCancelled+=1),T&&(XA(o,T),o[T].matchUpsCancelled+=1)}else if(m?.length){a=0;for(let S of m){if(S.winningSide){let T=b?.find(({sideNumber:C})=>C===S.winningSide)?.participantId,D=b?.find(({sideNumber:C})=>C===S.winningSide)?.participantId;T&&D&&(XA(o,T),XA(o,D),o[T].tieMatchUpsWon+=1,o[D].tieMatchUpsLost+=1,Vn(Dr)(S.matchUpType)?(o[T].tieSinglesWon+=1,o[D].tieSinglesLost+=1):Vn(br)(S.matchUpType)&&(o[T].tieDoublesWon+=1,o[D].tieDoublesLost+=1))}wie({score:S.score,manualGamesOverride:y,participantResults:o,sides:b})}}else wie({manualGamesOverride:y,participantResults:o,score:g,sides:b});else if(XA(o,I),XA(o,w),m?.length){a=0;for(let S of m){let{matchUpType:T}=S,D=Vn(br)(T),C=Vn(Dr)(T);S.winningSide&&(S.winningSide===v?(I&&(o[I].tieMatchUpsWon+=1,C&&(o[I].tieSinglesWon+=1),D&&(o[I].tieDoublesWon+=1)),w&&(o[w].tieMatchUpsLost+=1,C&&(o[w].tieSinglesLost+=1),D&&(o[w].tieDoublesLost+=1))):S.winningSide!==v&&(w&&(o[w].tieMatchUpsWon+=1,C&&(o[w].tieSinglesWon+=1),D&&(o[w].tieDoublesWon+=1)),I&&(o[I].tieMatchUpsLost+=1,C&&(o[I].tieSinglesLost+=1),D&&(o[I].tieDoublesLost+=1)))),Sie({matchUpFormat:S.matchUpFormat,matchUpStatus:S.matchUpStatus,matchUpType:S.matchUpType,score:S.score,sides:S.sides,winningParticipantId:I,losingParticipantId:w,manualGamesOverride:y,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:n,winningSide:v})}GCe({winningParticipantId:I,losingParticipantId:w,participantResults:o,matchUpStatus:h})}else Sie({matchUpFormat:f.matchUpFormat??r,matchUpType:f.matchUpType,isTieMatchUp:void 0,winningParticipantId:I,manualGamesOverride:y,losingParticipantId:w,participantResults:o,pressureRating:e,matchUpStatus:h,tallyPolicy:n,winningSide:v,score:g,sides:b});if(y){let S=g?.sets?.reduce((E,P)=>E+(P?.side1Score??0),0),T=g?.sets?.reduce((E,P)=>E+(P.side2Score??0),0),D=b?.find(({sideNumber:E})=>E===1)?.participantId,C=b?.find(({sideNumber:E})=>E===2)?.participantId;XA(o,D),XA(o,C),D&&(o[D].gamesWon+=S,o[D].gamesLost+=T),C&&(o[C].gamesWon+=T,o[C].gamesLost+=S)}}return AZe({participantResults:o,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,totalGames:p,perPlayer:a,totalSets:u}),{participantResults:o}}function gZe(t){let e=t.winningSide-1;return $U(t,e)}function vZe(t){let e=1-(t.winningSide-1);return $U(t,e)}function $U(t,e){if(!t?.sides)return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function XA(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function wie({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],s=[0,0];for(let l of n||[]){let{winningSide:c,side1Score:u,side2Score:d}=l;c&&(s[c-1]+=1),a[0].push(ci(u||0)),a[1].push(ci(d||0))}let o=[a[0].reduce((l,c)=>l+c,0),a[1].reduce((l,c)=>l+c,0)];r.forEach((l,c)=>{let{participantId:u}=l;u&&(XA(e,u),e[u].setsWon+=s[c],e[u].setsLost+=s[1-c],t||(e[u].gamesWon+=o[c],e[u].gamesLost+=o[1-c]))})}function Sie({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:s,isTieMatchUp:o,matchUpType:l,tallyPolicy:c,winningSide:u,score:d,sides:p}){let f=u&&u-1,h=1-f;n&&l===Dr&&hZe({participantResults:r,sides:p,score:d}),o||GCe({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:s});let m=x7({matchUpStatus:s,matchUpFormat:a,tallyPolicy:c,winningSide:u,score:d}),A=$Ce({matchUpStatus:s,matchUpFormat:a,tallyPolicy:c,winningSide:u,score:d}),{pointsTally:g}=HCe({score:d,matchUpFormat:a});t&&(r[t].setsWon+=m[f],r[t].setsLost+=m[h],e||(r[t].gamesWon+=A[f],r[t].gamesLost+=A[h]),r[t].pointsWon+=g[f],r[t].pointsLost+=g[h]),i&&(r[i].setsWon+=m[h],r[i].setsLost+=m[f],e||(r[i].gamesWon+=A[h],r[i].gamesLost+=A[f]),r[i].pointsWon+=g[h],r[i].pointsLost+=g[f])}function GCe({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===Zr&&(i[e].walkovers+=1),r===Nr&&(i[e].defaults+=1),r===Ha&&(i[e].retirements+=1),ks(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function yZe(t,e,i,r){t.groups&&Object.keys(t.groups).sort(r).forEach(n=>{let a=t.groups[n].map(o=>e[o]).join(", "),s=`${n} ${t.attribute}: ${a}`;i.push(s)})}function bZe(t,e,i,r){if(t.excludedDirectives?.length){let n=t.excludedDirectives.map(({attribute:o})=>o).join(", "),a=`${n.length} directives were excluded due to participants limit}`;r.push(a);let s=`Excluded: ${n}`;r.push(s)}else{let n=(c,u)=>Number.parseFloat(t.reversed?c:u)-Number.parseFloat(t.reversed?u:c),a=t.groups?Object.values(t.groups).flat(1/0).length:t.participantIds?.length??0,s=t.reversed?" in reverse order":"",o=t.groups?"grouped":"separated",l=`Step ${e+1}: ${a} particiants were ${o}${s} by ${t.attribute}`;if(r.push(l),t.idsFilter){let c=`${t.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(c)}yZe(t,i,r,n)}r.push("----------------------")}function IZe({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(s=>{s.participantId&&s.participant&&(r[s.participantId]=s.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,s)=>{bZe(a,s,r,n)}),n.push("Final Order:"),e.forEach(a=>{let{participantId:s,resolved:o}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[s]} => resolved: ${!!o}`)}),n.join(`\r
`)}function QCe({participantResults:t,participantIds:e,attribute:i}){return jCe({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:s}=n,o=s?.[i];return!isNaN(o)&&a&&(r[o]?r[o].push(a):r[o]=[a]),r},{})}function jCe(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var wZe=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],ZV={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function Uie(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!SZe(t))return{};let s=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n?.groupOrderKey)?n.groupOrderKey:"matchUpsWon",o=QCe({participantResults:i,attribute:s});a.push({attribute:s,groups:o});let l=Object.keys(o).map(A=>Number.parseFloat(A)).sort((A,g)=>g-A).map(A=>o[A]).map(A=>{let g=zCe({participantIds:A,...t});return a.push(...g.report??[]),g.order}).flatMap((A,g)=>A.map(v=>v.resolved?v:{...v,subGroup:[g].concat(...v.subGroup??[])})),c,u=0,d=1,p;l.forEach((A,g)=>{g&&(A.resolved||p&&!A.resolved)&&(d+=1),p=A.resolved;let v=Number.parseInt(A.subGroup?.join("")||0);A.resolved?(A.position=g+1,d=A.position):(c&&v>c&&(d+=u,u=0),A.position=d,u+=1),c=v});let f=l.map(({position:A})=>A),h=Xl(f);return l.forEach(A=>{let{participantId:g,position:v}=A||{},b=i[g];A.GEMscore=m(b);let y=h[v];A?.position!==void 0&&(y>1&&(A.ties=y,r&&(A.subOrder=r[g])),A.rankOrder=v,A.groupOrder=v+(A.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function m(A){return(Array.isArray(n?.GEMscore)?Object.keys(ZV).filter(g=>n.GEMscore.includes(g)):Object.keys(ZV)).map(g=>(A[g]||0)*Math.pow(10,ZV[g].toFixed(3))).reduce((g,v)=>g+v,0)}}function SZe({participantResults:t,participantsCount:e}){let i=jCe({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function UZe({disableHeadToHead:t,participantIds:e,matchUpFormat:i,groupTotals:r,tallyPolicy:n,attribute:a,idsFilter:s,matchUps:o,reversed:l}){let{participantResults:c}=ZM({participantIds:s&&e,groupingTotal:r&&a,matchUpFormat:i,tallyPolicy:n,matchUps:o}),u=QCe({participantResults:c,participantIds:e,attribute:a}),d=[{attribute:a,reversed:l,groups:u,idsFilter:s,groupTotals:r}],p;return Object.keys(u).length>1&&e.length&&(p=Object.keys(u).map(f=>Number.parseFloat(f)).sort((f,h)=>l?f-h:h-f).map(f=>u[f]).map(f=>{let h=zCe({participantResults:c,disableHeadToHead:t,participantIds:f,matchUpFormat:i,tallyPolicy:n,matchUps:o});return d.push(...h.report??[]),h.order}).flatMap((f,h)=>f.map(m=>m.resolved?m:{...m,subGroup:[h].concat(...m.subGroup??[])}))),{order:p,report:d}}function zCe({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let s=[],o=[],l;if(i?.length===1)return{order:[{resolved:!0,participantId:i[0]}]};if(i?.length===2&&(!n?.headToHead||!n.headToHead.disabled&&!e)){let u=TZe({participantIds:i,participantResults:t});if(u){let d=u[0].participantId;return o.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:u,headToHeadWinner:d,report:o}}}let c=(n?.tallyDirectives||wZe).filter(u=>{let d=!(Un(u.maxParticipants)&&i?.length>u.maxParticipants);return d||s.push(u),d});return s.length&&o.push({excludedDirectives:s,participantIds:i}),c.every(({attribute:u,reversed:d,idsFilter:p,groupTotals:f,disableHeadToHead:h})=>(l=UZe({disableHeadToHead:h,participantIds:i,matchUpFormat:r,groupTotals:f,tallyPolicy:n,attribute:u,idsFilter:p,matchUps:a,reversed:d}),o.push(l.report),!l.order)),l.order?{order:l.order,report:o}:{order:i?.map(u=>({participantId:u})),report:o}}function TZe({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function RE({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:s}){if(!n?.length||!Pu(n))return{error:mA};let o=Ei(n.map(({structureId:y})=>y));if(o.length!==1)return ce({result:{error:we,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let l=n.filter(y=>y&&y.matchUpStatus!=="BYE"),c=l.length&&Ei(l.map(({drawPositions:y})=>y).flat()).length,u=l.filter(y=>oy({matchUp:y})).length===l.length;u||(s=0);let d=n.every(({matchUpType:y,tieMatchUps:I})=>y===Hr&&I?.every(w=>oy({matchUp:w}))),p=t?.[IY],f=n.filter(y=>oy({matchUp:y})??y.matchUpType===Hr),{participantResults:h}=ZM({matchUps:f,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:s}),m,A,{groupOrder:g,report:v}=Uie({matchUps:f,participantResults:h,participantsCount:c,matchUpFormat:r,subOrderMap:a,tallyPolicy:p});if(i&&CZe({participantResults:h}),u&&g)m=v,A=g,g.forEach(y=>{let{participantId:I,groupOrder:w,rankOrder:S,subOrder:T,ties:D,GEMscore:C}=y,E=h[I];Object.assign(E,{groupOrder:w,rankOrder:S,GEMscore:C,subOrder:T,ties:D})});else{let{groupOrder:y,report:I}=Uie({requireCompletion:!1,participantResults:h,participantsCount:c,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});m=I,A=y,y&&y.forEach(w=>{let{participantId:S,groupOrder:T,GEMscore:D}=w,C=h[S];Object.assign(C,{provisionalOrder:T,GEMscore:D})})}let b={completedTieMatchUps:d,readableReport:"",participantResults:h,bracketComplete:u,order:[],report:m};if((u||d)&&(b.order=A),e||Mc({tally:!0})){let y=IZe({matchUps:n,report:m,order:A});Mc({tally:!0})&&console.log(y),b.readableReport=y}return b}function CZe({participantResults:t}){let e=n=>n.reduce((a,s)=>a+parseFloat(s),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:s}=a,o=s?.length?i(s):0;return{participantId:n,averagePressure:o}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function qCe({positionAssignments:t}){let e=(t||[]).filter(rc(Nh)).map(n=>{let{extension:a}=ki({element:n,name:ZT}),s=ci(a?.value),o=!isNaN(s)&&s;return o&&{participantId:n.participantId,subOrder:o}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=Xl(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function O7({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!Pu(n))return{error:we};if(!t)return{error:we};let{policyDefinitions:s}=yA({policyTypes:[IY],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:o}=qCe({positionAssignments:t}),l=n.length?RE({policyDefinitions:s,matchUpFormat:r,subOrderMap:o,matchUps:n}):void 0;if(l?.error)return l;let{participantResults:c={},bracketComplete:u,report:d}=l??{},p=Object.keys(c);return t.forEach(f=>{let{participantId:h}=f;if(p.includes(h)){let m={value:c[h],name:Km};ur({element:f,extension:m}),c[h].ties||Mo({element:f,name:ZT})}else Mo({element:f,name:Km}),Mo({element:f,name:ZT})}),kr({drawDefinition:i}),{...oe,participantResults:c,bracketComplete:u,report:d}}function WCe({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function Yr(t){let e=Qt(t,[{[ro]:!0,[Rf]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:s,matchUpId:o,inContext:l,context:c,event:u}=t,{structures:d=[]}=Td({drawDefinition:a}),p=t.contextContent||n&&bA({contextProfile:n,drawDefinition:a});for(let f of d){let{matchUps:h}=dr({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:s,inContext:l,structure:f,context:c,event:u}),{matchUp:m}=WCe({matchUps:h,matchUpId:o});if(m)return{matchUp:m,structure:f}}return{error:Zs}}function b$(t){return!Xi(t)||!t.notes?{error:Yt}:Xi(t.element)?!rn(t.notes)&&!t.notes?.testing?{error:we}:(Object.assign(t.element,{notes:t.notes}),{...oe}):{error:we}}function F7(t){return Xi(t)?Xi(t.element)?(t.element.notes&&delete t.element.notes,{...oe}):{error:we}:{error:Yt}}var I$={matchUpStatus:Nn,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function Xp(t){let e="modifyMatchUpScore",i=t.matchUpFormat,r=t.matchUp,n,{matchUpStatusCodes:a,tournamentRecord:s,drawDefinition:o,matchUpStatus:l,removeScore:c,winningSide:u,matchUpId:d,event:p,notes:f,score:h}=t,m=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:tr({policyTypes:[mu],tournamentRecord:s,drawDefinition:o,structure:n,event:p})?.appliedPolicies,A=r.matchUpType===Hr;if(A&&o){if(d&&r.matchUpId!==d){let S=Yr({drawDefinition:o,matchUpId:d,event:p});if(!S.matchUp)return{error:Zs};({matchUp:r,structure:n}=S)}}else r.matchUpId!==d&&console.log("!!!!!");l&&[Zr,An].includes(l)||c?Object.assign(r,{...I$}):h&&(r.score=h);let g=l&&r?.matchUpStatus===Nr&&l!==Nr;l&&(r.matchUpStatus=l),i&&(r.matchUpFormat=i),a&&(r.matchUpStatusCodes=a),u&&(r.winningSide=u),t.removeWinningSide&&(r.winningSide=void 0),!n&&o&&({structure:n}=Yr({drawDefinition:o,matchUpId:d,event:p})),l&&!r.winningSide&&wa(r)&&!ta.includes(l)&&![lS,rv,ic].includes(l)&&(r.matchUpStatus=Md);let v;if((g&&r?.processCodes?.length||l===Nr)&&(v=m?.[mu]?.processCodes?.incompleteAssignmentsOnDefault),!r.collectionId){let S=n?.structureType===$o,T=el({structure:n});if(YY({drawDefinition:o,structure:n})||T||S){let D=P=>{i=A?"SET1-S:T100":i??r.matchUpFormat??P?.matchUpFormat??o?.matchUpFormat??p?.matchUpFormat;let R=A?{matchUpTypes:[Hr]}:void 0,{matchUps:M}=dr({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:R,drawDefinition:o,structure:P,event:p});return T&&(P.positionAssignments=Ei(M.flatMap(N=>(N.sides??[]).map(k=>k.participantId)).filter(Boolean)).map(N=>({participantId:N}))),O7({positionAssignments:P.positionAssignments,tournamentRecord:s,drawDefinition:o,matchUpFormat:i,matchUps:M,event:p})},C=S&&n.structures.find(P=>P?.matchUps.find(R=>R.matchUpId===d)),E=D(C||n);if(E.error)return ce({result:E,stack:e})}}if(f){let S=b$({element:r,notes:f});if(S.error)return ce({result:S,stack:e})}let b=s?.tournamentId,y=Tu().topics.includes(J2),I=(y||v)&&os({drawDefinition:o}),w=I&&ia({matchUpFilters:{matchUpIds:[d]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:o,matchUpsMap:I}).matchUps?.[0];if(y&&w&&VYe({tournamentId:b,inContextMatchUp:w}),Array.isArray(v)&&w&&!w.sides?.every(({participantId:S})=>S))if(l===Nr)r.processCodes=Ei([...r.processCodes??[],...v]);else for(let S of v||[]){let T=S&&r?.processCodes?.lastIndexOf(S);r?.processCodes?.splice(T,1)}return Zi({eventId:p?.eventId,context:e,drawDefinition:o,tournamentId:b,matchUp:r}),{...oe}}function L7(t){let{propagateExitStatus:e,matchUpStatusCodes:i,autoCalcDisabled:r,inContextMatchUp:n,matchUpStatus:a,dualMatchUp:s,structure:o,matchUp:l}=t,c=$M({matchUpStatus:a})||[Nf,tc].includes(a)&&s||r,u=l?.sides?.map(m=>m.participantId).filter(Boolean).length||n?.sides?.map(m=>m.participantId).filter(Boolean).length,d="attemptToModifyScore";if(!(el({structure:o})&&u===1||a===Nr&&u||EZe({structure:o,matchUp:l,inContextMatchUp:n})||t.appliedPolicies?.[mu]?.requireParticipantsForScoring===!1||ks(a)&&u===1&&e))return ce({result:{error:P8},stack:d});let p=[Zr].includes(a),f=c?a:t.winningSide&&Hn||ic,h=Xp({...t,winningSide:t.winningSide,matchUpStatusCodes:c&&i||[],matchUpStatus:f,removeScore:p});return ce({result:h,stack:d})}function EZe({structure:t,matchUp:e,inContextMatchUp:i}){let{drawPositions:r}=e,{positionAssignments:n}=Ia({structure:t}),a=n?.filter(o=>r?.includes(o.drawPosition)&&o.participantId),s=i?.sides?.every(o=>o.participantId);return a?.length===2||s}function KCe({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>wi(r?.groupValue)&&r?.groupNumber).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>ci(r));return{groupValueGroups:e,groupValueNumbers:i}}function DZe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(v=>v.collectionId===t.collectionId),s=[0,0],o=[0,0],l=a.every(v=>ta.includes(v.matchUpStatus)),{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,matchUpValue:p,winCriteria:f,scoreValue:h,setValue:m}=t,A=u&&e.includes(u),g=[0,0];if(a.forEach(v=>{v.winningSide&&(g[v.winningSide-1]+=1)}),wi(p)?a.forEach(v=>{v.winningSide&&(s[v.winningSide-1]+=p)}):wi(m)?a.forEach(v=>{v.score?.sets?.forEach(b=>{b.winningSide&&(s[b.winningSide-1]+=m)})}):wi(h)?a.forEach(v=>{v.score?.sets?.forEach(b=>{let{side1TiebreakScore:y=0,side2TiebreakScore:I=0,side1Score:w=0,side2Score:S=0}=b;(v.matchUpStatus===Hn||v.winningSide||b.winningSide)&&(w||S?(s[0]+=w,s[1]+=S):(y||I)&&b.winningSide&&(s[b.winningSide-1]+=1))})}):Array.isArray(c)&&a.forEach(v=>{if(v.winningSide){let b=v.collectionPosition,y=PZe({collectionDefinition:t,collectionPosition:b});wi(y)&&(s[v.winningSide-1]+=y)}}),wi(d)){let v;if(f?.aggregateValue)l&&(wi(p||m||h)&&s[0]!==s[1]?v=s[0]>s[1]?1:2:g[0]!==g[1]&&(v=g[0]>g[1]?1:2));else if(f?.valueGoal)v=s.reduce((b,y,I)=>y>=f.valueGoal?I+1:b,0);else{let b=Math.floor(t.matchUpCount/2)+1;v=g.reduce((y,I,w)=>I>=b?w+1:y,0)}v&&(A?i[u].values[v-1]+=d:o[v-1]+=d)}else A?(i[u].values[0]+=s[0]||0,i[u].values[1]+=s[1]||0):o=s;A?(i[u].sideWins[0]+=g[0]||0,i[u].sideWins[1]+=g[1]||0,i[u].allGroupMatchUpsCompleted=i[u].allGroupMatchUpsCompleted&&l,i[u].matchUpsCount+=a.length):o.forEach((v,b)=>r[b]+=v||0)}function PZe({collectionDefinition:t,collectionPosition:e}){return(t.collectionValueProfiles||[])?.find(i=>i.collectionPosition===e)?.matchUpValue}function JM(t){let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:r,matchUpsMap:n,structure:a,matchUp:s,event:o}=t;if(!Array.isArray(e)||e.length!==2||Number.isNaN(e.reduce((y,I)=>y+I)))return{error:we};if(!s)return{error:Zo};let l=po({matchUp:s,drawDefinition:r,structure:a,event:o})?.tieFormat||t?.tieFormat;if(!l)return{error:dE};let c=Jo({tieFormat:l});if(c.error)return c;let u=l?.collectionDefinitions||[],d=s?.tieMatchUps??[],p=[0,0],{groupValueGroups:f,groupValueNumbers:h}=KCe(l);for(let y of u)DZe({collectionDefinition:y,groupValueNumbers:h,groupValueGroups:f,sideTieValues:p,tieMatchUps:d});for(let y of h){let I=f[y],{allGroupMatchUpsCompleted:w,matchUpCount:S,winCriteria:T,groupValue:D,sideWins:C,values:E}=I,P;if(T?.aggregateValue)w&&E[0]!==E[1]&&(P=E[0]>E[1]?1:2);else if(T?.valueGoal)P=E.reduce((R,M,N)=>M>=T.valueGoal?N+1:R,void 0);else{let R=Math.floor(S/2)+1;P=C.reduce((M,N,k)=>N>=R?k+1:M,void 0)}P&&(p[P-1]+=D||0)}let m=p.map((y,I)=>(y||0)+e[I]),A={side1Score:m[0],side2Score:m[1],winningSide:void 0},g=m.join(i),v=m.slice().reverse().join(i),b;if(l?.winCriteria){let{valueGoal:y,aggregateValue:I,tallyDirectives:w}=l.winCriteria;if(y?b=m.map((S,T)=>({sideNumber:T+1,points:S})).find(({points:S})=>S>=y)?.sideNumber:I&&d.every(S=>S.matchUpStatus&&ta.includes(S.matchUpStatus)||S.winningSide)&&m[0]!==m[1]&&(b=m[0]>m[1]?1:2),!b&&w){let S=s.matchUpId,T=s.hasContext?s:n?.drawMatchUps?.[S]||r&&Yr({inContext:!0,drawDefinition:r,matchUpId:S})?.matchUp;if(T){let{completedTieMatchUps:D,order:C}=RE({matchUps:[T]});if(D&&C?.length){let E=C[0].participantId;b=T.sides.find(({participantId:P})=>P===E)?.sideNumber}}}}return b&&(A.winningSide=b),{scoreStringSide1:g,scoreStringSide2:v,winningSide:b,set:A}}function eN({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){if(r){t||(t=Yr({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e})?.matchUp);let{extension:a}=ki({element:e,name:qm}),s=Dt(a?.value||{},!1,!0),o=({displaySideNumber:l,drawPosition:c,sideNumber:u})=>({drawPosition:c,sideNumber:u,displaySideNumber:l});r.sides=t?.sides?.map(l=>{let c=l.participantId,u=c&&s[c]||void 0,{lineUp:d,...p}=r.sides?.find(({sideNumber:h})=>h===l.sideNumber)??{},f=d?.length?d:u;return{...o(l),...p,lineUp:f}}),Zi({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function Us(t){if(t)return Dt(t,!1,!0)}function $7(t){let e=Qt(t,[{[Js]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:o})=>o),s=n.map(o=>(o.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...s),i.eventIds.push(...a),i.drawIds.push(...s),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function YCe({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=$7({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&r?.[n].includes(e)||i&&r?.[n].includes(i))}function IA(t){let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:r,removeScore:n,matchUpsMap:a,matchUpId:s,event:o}=t,l=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord?.tournamentId]:t.tournamentRecord}||{},c=t.tournamentId||t.tournamentRecord?.tournamentId;l&&YCe({tournamentRecords:l,...t});let u=c&&l[c];if(!u)return{error:nt};let d=Yr({drawDefinition:i,event:o,matchUpId:s});if(d.error)return d;if(!d.matchUp)return{error:Zs};let{matchUp:p,structure:f}=d;if(!p.tieMatchUps)return{error:wl};eN({tournamentId:u?.tournamentId,eventId:o?.eventId,dualMatchUp:p,drawDefinition:i});let{extension:h}=ki({name:aw,element:p});if(h?.value)if(n)Mo({element:p,name:aw});else return{...oe,score:p.score};let m=po({drawDefinition:i,structure:f,matchUp:p,event:o})?.tieFormat;p.tieFormat=Us(m);let A=JM({drawDefinition:i,matchUpsMap:a,structure:f,matchUp:p,event:o}),{winningSide:g,set:v,scoreStringSide1:b,scoreStringSide2:y}=A,I=v?.side1Score||v?.side2Score;if(e&&!p.score&&!I)return{...oe};let w={scoreStringSide1:b,scoreStringSide2:y,sets:v?[v]:[]},S=g&&[1,2].includes(g),T=S&&Hn||r7({matchUpStatus:r??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:w})&&Md||Nn,D=!!(p.winningSide&&!S),C=p.tieMatchUps.find(({score:P,winningSide:R,matchUpStatus:M})=>P?.sets?.length&&(P.sets[0].side1Score||P.sets[0].side2Score)||M&&ta.includes(M)||R),E;if(p.tieFormat&&!S&&!C){let P=po({drawDefinition:i,structure:f,event:o})?.tieFormat;P&&JSON.stringify(m)===JSON.stringify(P)&&(p.tieFormatId=void 0,p.tieFormat=void 0,E=!0)}return Xp({appliedPolicies:t.appliedPolicies,matchUpStatus:T,score:w,removeWinningSide:D,tournamentRecord:u,drawDefinition:i,removeScore:n,winningSide:g,matchUpId:s,matchUp:p,event:o}),{...oe,score:w,removeWinningSide:D,tieFormatRemoved:E,winningSide:g}}function RZe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:s,sourceMatchUpId:o,drawDefinition:l,winnerMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}){let f="directWinner";if(s){let h=c.drawPositions||[],m=h[t],A=s.source.structureId,g=di({structureId:A,drawDefinition:l});if(g.error)return g;let{structure:v}=g,{positionAssignments:b}=Ia({structureId:A,drawDefinition:l}),y=b?.find(C=>C.drawPosition===n)?.participantId,I=s.target.structureId,{positionAssignments:w}=Ia({structureId:I,drawDefinition:l}),S=w?.find(C=>C.participantId===y)?.drawPosition,T=w?.filter(C=>{let E=h.includes(C.drawPosition),P=!C.participantId&&!C.bye&&!C.qualifier;return E&&P}).map(C=>C.drawPosition),D=T?.includes(m);if(y&&s.target.roundNumber===1&&D)vf({drawPosition:m,participantId:y,structureId:I,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(y&&T?.length){let C=T.pop();C&&vf({participantId:y,structureId:I,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:C,matchUpsMap:d,event:p})}else if(S){let C=PI({drawPosition:S,matchUpId:c.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(C.error)return ce({result:C,stack:f})}else if(v?.stage!==qt){let C="winner target position unavaiallble";console.log(C),ce({stack:f,result:{error:C}})}if(v?.seedAssignments&&v.structureId!==I){let C=v.seedAssignments.find(({participantId:P})=>P===y),E=C?.participantId;C&&E&&EE({eventId:c?.eventId,structureId:I,...C,tournamentRecord:a,drawDefinition:l,participantId:E})}}else{let h=PI({matchUpId:c.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(h.error)return h}if(u&&i){let h=u.sides?.find(m=>m.sideNumber===i);if(h?.lineUp){let m=u.roundPosition,A=c.roundPosition,g=m===A&&m!==1||Math.floor(m/2)===A?2:1,v=d?.drawMatchUps?.find(({matchUpId:I})=>I===c.matchUpId),b=[1,2].map(I=>({...v.sides?.find(w=>w.sideNumber===I)||{},sideNumber:I}));v.sides=b;let y=v.sides.find(I=>I.sideNumber===g);if(y){let I=h.lineUp?.filter(w=>w?.participantId);y.lineUp=b7({lineUp:I}),Zi({tournamentId:a?.tournamentId,eventId:c?.eventId,matchUp:v,context:f,drawDefinition:l})}}}return{...oe}}function MZe(t){let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:r,propagateExitStatus:n,sourceMatchUpStatus:a,loserDrawPosition:s,tournamentRecord:o,loserTargetLink:l,drawDefinition:c,loserMatchUp:u,dualMatchUp:d,matchUpsMap:p,event:f}=t,h="directLoser",m=l.linkCondition,A=u.drawPositions||[],g=m===Af&&u.roundNumber===2&&Math.min(...A.filter(Boolean)),v=g||A[e],b=g||A[1-e],y=l.source.structureId,{structure:I}=di({structureId:y,drawDefinition:c}),{matchUps:w}=dr({afterRecoveryTimes:!1,inContext:!0,drawDefinition:c,structure:I,event:f}),S=w.filter(Q=>Q.drawPositions?.includes(s)).filter(Q=>{let j=Q.sides.find(Y=>Y.drawPosition===s),W=Q.matchUpStatus===Zr||Q.matchUpStatus===Nr&&!wa(Q);return j?.sideNumber===Q.winningSide&&!W}),T=m===Af&&S.length===0,{positionAssignments:D}=Ia({structureId:y,drawDefinition:c}),C=D?.find(Q=>Q.drawPosition===s)?.participantId,E={loserParticipantId:C},P=l.target.structureId,{positionAssignments:R}=Ia({structureId:P,drawDefinition:c}),M=R?.filter(({drawPosition:Q})=>A.includes(Q)),N=M?.some(Q=>Q.participantId&&C&&Q.participantId===C),k=n&&[Ha,Zr,Nr].includes(a||"");if(N)return{...oe,stack:h};let O=M?.filter(Q=>{let j=A.includes(Q.drawPosition),W=!Q.participantId&&!Q.bye&&!Q.qualifier;return j&&W}).map(Q=>Q.drawPosition),x=O?.includes(v),F=l.target.roundNumber>1&&O?.length,_=l.target.roundNumber===1&&x;if(g){let Q=V();if(Q.context&&Object.assign(E,Q.context),Q.error)return ce({result:Q,stack:h})}else if(_){let Q=z();if(Q.context&&Object.assign(E,Q.context),Q.error)return ce({result:Q,stack:h})}else if(C&&F){O.sort(ua);let Q=O[0],j=vf({participantId:C,structureId:P,drawPosition:Q,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:c,matchUpsMap:p,event:f});if(j.error)return ce({result:j,stack:h});if(!j.error&&k&&n)return{stack:h,context:{progressExitStatus:!0,loserParticipantId:C}}}else return ce({context:{loserDrawPosition:s,loserTargetLink:l,targetDrawPositionIsUnfilled:x},result:{error:x?Zw:E6e},stack:h});if(I?.seedAssignments&&I.structureId!==P){let Q=I.seedAssignments.find(({participantId:W})=>W===C),j=Q?.participantId;Q&&j&&EE({eventId:u?.eventId,structureId:P,...Q,tournamentRecord:o,drawDefinition:c,participantId:j})}if(d&&r){let Q=d.sides?.find(j=>j.sideNumber===3-r);if(Q?.lineUp){let{roundNumber:j,eventId:W}=u,{roundPosition:Y}=d,X=j===1?2-Y%2:1,J=p?.drawMatchUps?.find(({matchUpId:ne})=>ne===u.matchUpId),ie=[1,2].map(ne=>({...J.sides?.find(ge=>ge.sideNumber===ne)||{},sideNumber:ne}));J.sides=ie;let ue=J.sides.find(ne=>ne.sideNumber===X);ue&&(ue.lineUp=b7({lineUp:Q.lineUp}),Zi({tournamentId:o?.tournamentId,matchUp:J,context:h,drawDefinition:c,eventId:W}))}}return ce({result:{...oe},stack:h,context:E});function V(){let Q="loserLinkFedFMLC";return ce(T?{result:z(),stack:Q}:{result:G(),stack:Q})}function G(){let Q=Hc({drawPosition:b,structureId:P,tournamentRecord:o,drawDefinition:c,event:f});return ce({result:Q,stack:"assignLoserPositionBye"})}function z(){let Q=C?vf({drawPosition:v,participantId:C,structureId:P,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:c,matchUpsMap:p,event:f}):{error:ba};return!Q.error&&k&&n?{stack:h,context:{progressExitStatus:!0}}:ce({result:Q,stack:"assignLoserDrawPosition"})}}function XCe(t){let e="directParticipants",i=L7(t);if(i.error)return ce({result:i,stack:e});let r=$M({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,matchUpStatusCodes:l,tournamentRecord:c,drawDefinition:u,matchUpStatus:d,dualMatchUp:p,matchUpsMap:f,winningSide:h,targetData:m,matchUpId:A,structure:g,matchUp:v,event:b}=t,y=!!v.collectionId,I=el({structure:g}),w=v.drawPositions,S;if(y){let{matchUpTieId:T,matchUpsMap:D}=t,C=IA({appliedPolicies:t.appliedPolicies,matchUpId:T,tournamentRecord:c,drawDefinition:u,matchUpsMap:D,event:b});if(S=C&&{tieMatchUpResult:C},w=a.find(({matchUpId:E})=>E===T)?.drawPositions,!n)return ce({result:{...oe,...S},stack:e})}if(I)return ce({result:{...oe,...S},stack:e});if(w){let T=s?s-1:h-1,D=1-T,C=w[T],E=w[D],P={},{targetLinks:{loserTargetLink:R,winnerTargetLink:M,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:k,loserMatchUpDrawPositionIndex:O,winnerMatchUp:x,loserMatchUp:F,byeMatchUp:_}}=m;if(x){let V=RZe({sourceMatchUpStatus:r&&d||Hn,winnerMatchUpDrawPositionIndex:k,sourceMatchUpId:A,inContextDrawMatchUps:a,projectedWinningSide:s,winningDrawPosition:C,tournamentRecord:c,winnerTargetLink:M,drawDefinition:u,winnerMatchUp:x,dualMatchUp:p,matchUpsMap:f,event:b});if(V.error)return ce({result:V,stack:e})}if(F){let V=MZe({sourceMatchUpStatus:r&&d||Hn,loserMatchUpDrawPositionIndex:O,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,loserDrawPosition:E,tournamentRecord:c,loserTargetLink:R,drawDefinition:u,loserMatchUp:F,matchUpsMap:f,dualMatchUp:p,event:b});if(V.context?.progressExitStatus&&Object.assign(P,V.context,{sourceMatchUpStatus:r&&d||Hn,sourceMatchUpStatusCodes:l||[],loserMatchUp:F,matchUpsMap:f}),V.error)return ce({result:V,stack:e})}if(_){let V=_.drawPositions||[],G=Math.min(...V.filter(Boolean)),z=N.target.structureId,Q=Hc({drawPosition:G,structureId:z,tournamentRecord:c,drawDefinition:u,event:b});if(Q.error)return ce({result:Q,stack:e})}return ce({result:{...oe,...S},stack:e,context:P})}else return ce({result:{error:aM},stack:e})}function H7(t){let e="genPlayoffStructure";if(!t.drawDefinition)return ce({result:{error:kt},stack:e});let i=XM(t);if(i.error)return ce({result:i,stack:e});let{structureId:r,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:s,finishingPositionLimit:o,playoffAttributes:l,playoffPositions:c,roundOffsetLimit:u,tournamentRecord:d,exitProfileLimit:p,roundProfiles:f,roundNumbers:h,idPrefix:m,isMock:A,event:g,uuids:v}=t,b=Dt(t.drawDefinition,!1,!0),{structure:y}=di({structureId:r,drawDefinition:b});if(!y)return ce({result:{error:an},stack:e});if(y.structureType===$o||y.structures)return cZe({sourceStructureId:y.structureId,...t,...i,drawDefinition:b});let{playoffRoundsRanges:I,playoffRounds:w}=i,{playoffPositionsReturned:S,error:T,playoffSourceRounds:D,playoffRoundsRanges:C}=CCe(t);if(T)return ce({result:{error:T},stack:e});let E=f?.length&&Object.assign({},...f),P=h||typeof f=="object"&&f.map(Y=>Object.keys(Y)).flat(),R=Array.isArray(P)&&P.map(Y=>!isNaN(Y)&&ci(Y)).filter(Boolean);if(R){if(!Array.isArray(R))return ce({result:{error:we},context:{validRoundNumbers:R},stack:e});R.forEach(Y=>{if(!w?.includes(Y))return ce({result:{error:we},context:{roundNumber:Y},stack:e})})}c&&c.forEach(Y=>{if(!S?.includes(Y))return ce({result:{error:we},context:{playoffPosition:Y},stack:e})});let M=R||D,N=R?I:C,k=[],O=[];for(let Y of M??[]){let X=N?.find(xe=>xe.roundNumber===Y);if(!X)return ce({result:{error:we},context:{roundNumber:Y},stack:e});let J=X.finishingPositions.length,ie=Math.min(...X.finishingPositions)-1,ue=2,ne=Y&&E?.[Y]&&ue+E[Y]-1,ge=tT({exitProfile:`0-${Y}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:ie,playoffAttributes:l,exitProfileLimit:p,stage:Dn,roundOffset:0,drawDefinition:b,sequenceLimit:ne,stageSequence:ue,drawSize:J,idPrefix:m,isMock:A,uuids:v,finishingPositionNaming:s,finishingPositionLimit:o,roundOffsetLimit:u});if(ge.error)return ce({result:ge,stack:e});let{structures:he,links:Ie}=ge;if(he?.length&&k.push(...he),Ie?.length&&O.push(...Ie),ge.structureId&&Y){let xe={linkType:Rh,source:{structureId:r,roundNumber:Y},target:{structureId:ge.structureId,feedProfile:Ju,roundNumber:1}};O.push(xe)}}if(!k.length)return ce({result:{error:we},info:"No structures generated",stack:e});b.structures.push(...k),b.links.push(...O);let{matchUps:x,matchUpsMap:F}=ia({inContext:!0,drawDefinition:b}),_=k.map(({structureId:Y})=>Y),V=x?.filter(({structureId:Y})=>_.includes(Y)).map(_a),G=F?.drawMatchUps?.filter(({matchUpId:Y})=>V?.includes(Y));if(G?.length){let Y=po({drawDefinition:b,event:g})?.tieFormat;Y&&G.forEach(X=>{let{tieMatchUps:J}=IS({matchUp:X,tieFormat:Y,isMock:A});Object.assign(X,{tieMatchUps:J,matchUpType:Hr})})}x?.filter(Y=>oy({matchUp:Y})&&Y.structureId===r)?.forEach(Y=>{let{matchUpId:X,score:J,winningSide:ie}=Y,ue=Fo({inContextDrawMatchUps:x,drawDefinition:b,matchUpId:X}),ne=XCe({inContextDrawMatchUps:x,tournamentRecord:d,drawDefinition:b,matchUpsMap:F,winningSide:ie,targetData:ue,matchUpId:X,structure:y,matchUp:Y,score:J,event:g});ne.error&&console.log(ne.error)}),x?.filter(Y=>Y.matchUpStatus==="BYE"&&Y.structureId===r)?.forEach(Y=>{let{matchUpId:X}=Y,J=Fo({inContextDrawMatchUps:x,drawDefinition:b,matchUpId:X}),{targetLinks:{loserTargetLink:ie},targetMatchUps:{loserMatchUpDrawPositionIndex:ue,loserMatchUp:ne}}=J;if(ie&&ne){let ge=ie.target.structureId,he=ne.drawPositions[ue],Ie=Hc({drawPosition:he,structureId:ge,tournamentRecord:d,drawDefinition:b,event:g});Ie.error&&console.log(Ie.error)}});let z=[],Q=Vy({inContextDrawMatchUps:x,drawDefinition:b,matchUpsMap:F}).goesToMap,{structure:j}=di({drawDefinition:t.drawDefinition,structureId:r}),{matchUps:W}=dr({structure:j});return W.forEach(Y=>{let X=Q?.loserMatchUpIds[Y.matchUpId];if(X&&Y.loserMatchUpId!==X){Y.loserMatchUpId=X;let ie={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:Y};z.push(ie)}let J=Q?.winnerMatchUpIds[Y.matchUpId];if(J&&Y.winnerMatchUpId!==J){Y.winnerMatchUpId=J;let ie={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:Y};z.push(ie)}}),{structures:k,matchUpModifications:z,links:O,drawDefinition:b,...oe}}function ZCe({element:t}){if(!t)return{error:we};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:we};let e=(i,r)=>(n,a)=>(a[i]&&(n[a[i]]=a[r]),n);return t.timeItems.reduce(e("itemType","itemValue"),{})}function Bf(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:G8};let a=XUe(t);if(a.error)return a;if(!(Xi(n)&&rn(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:V8};if(!a.timeItems)a.timeItems=[];else if(NZe({element:a,duplicateValues:e,timeItem:n}))return{...oe};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let s=new Date().toISOString();Object.assign(n,{createdAt:s})}return r&&(a.timeItems=a.timeItems.filter(({itemType:s})=>n.itemType!==s)),r&&!n.itemValue||a.timeItems.push(n),{...oe}}function NZe({element:t,duplicateValues:e,timeItem:i}){let{itemType:r,itemSubTypes:n,itemValue:a}=i,s=r&&Eu({itemSubTypes:n,itemType:r,element:t})?.timeItem;return s&&JSON.stringify(s?.itemValue)===JSON.stringify(a)&&!e}function V7({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:nt};if(!n)return{error:ba};let s=nv({tournamentRecord:i,participantId:n});return s.error?s:Bf({element:s.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function tN(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;if(!i)return{error:nt};let s=Bf({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a});if(s.error)return s;let o=ZCe({element:i});return Ii({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:o},topic:bb}),s}function wS(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?Bf({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:fu}}function JCe(t){return w$({...t,itemType:"attachConsolationStructures"})}function G7(t){return w$({...t,itemType:"attachPlayoffStructures"})}function w$({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:s}){let o="attachStructures";if(!r)return{error:kt};if(!Array.isArray(n)||!Array.isArray(a))return ce({result:{error:we},stack:o});let l=A=>[A.source.structureId,A.source.roundNumber||A.source.finishingPositions?.join("|"),A.target.roundNumber].join("|"),c=r.links?.map(l);if(a.some(A=>{let g=l(A);return c?.includes(g)}))return ce({result:{error:K8},info:"playoff structure exists",stack:o});a.length&&r.links?.push(...a);let u=n.map(({structureId:A})=>A),d=r.structures?.map(({structureId:A})=>A);r.structures=(r.structures??[]).map(A=>u.includes(A.structureId)?n.find(({structureId:g})=>g===A.structureId):A);let p=n?.filter(({structureId:A})=>!d?.includes(A));p.length&&r.structures.push(...p),Vy({drawDefinition:r});let f=n.map(A=>dr({structure:A})?.matchUps||[]).flat();Tg({tournamentId:i?.tournamentId,eventId:s?.eventId,drawDefinition:r,matchUps:f});let h=n.map(({structureId:A})=>A);if(kr({drawDefinition:r,structureIds:h}),e?.length){let A={};e.forEach(v=>{let b=v.matchUp?.matchUpId;b&&(A[b]=v)});let g=v=>{v.matchUps.forEach(b=>{if(A[b.matchUpId]){let{tieMatchUps:y,...I}=A[b.matchUpId].matchUp;if(Object.assign(b,I),y?.length){let w={};y.forEach(S=>A[S.matchUpId]=S),b.tieMatchUps.forEach(S=>Object.assign(S,w[S.matchUpId]))}A[b.matchUpId].matchUp=b,Zi(A[b.matchUpId])}})};r.structures.forEach(v=>{if(d?.includes(v.structureId))if(v.structures)for(let b of v.structures)g(b);else g(v)})}let m=p.map(rc("structureId"));if(i){let A={itemValue:{structureIds:h,drawId:r.drawId},itemType:t};Bf({element:i,timeItem:A})}return{...oe,addedStructureIds:m}}function S$(t){let{structures:e,links:i,matchUpModifications:r,error:n}=H7(t);if(n)return{error:n};let a=t.drawDefinition;return G7({tournamentId:t.tournamentRecord?.tournamentId,eventId:t.event?.eventId||t.eventId,matchUpModifications:r,drawDefinition:a,structures:e,links:i})}function Qy(t){let e=Qt(t,[{_anyOf:{[Js]:!1,[Ua]:!1,[ro]:!1,[gA]:!1},[pY]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=Tie(t,r);if(n.error)return n;i.push(...n?.applied??[]),t.drawDefinition&&kr({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:nt};for(let a of n){let s=t.tournamentRecords[a],o=Tie(t,s);if(o.error)return o;i.push(...o?.applied??[])}}else return{error:nt};return i.length?{...oe,applied:i}:{error:k8}}function Tie(t,e){let i=tr(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:y2};for(let a of n)if(!i[a]||t.allowReplacement){let s=t.policyDefinitions[a];if(!s)continue;if(!Xi(s))return{error:we};let{policyName:o,...l}=s;if(!l||!Object.keys(l).length||o&&!rn(o))return{error:we};i[a]=t.policyDefinitions[a],r.push(a)}return r?.length?{...ur({element:e,extension:{name:zP,value:i}}),applied:r}:{applied:r,error:k8}}function Q7({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){if(!r||typeof r!="string")return ce({result:{error:we},context:{drawName:r}});i||(i=kn({event:a}).flightProfile);let s=i?.flights?.find(o=>o.drawId===n);if(s){s.drawName=r;let o={name:Ud,value:{...i,flights:i.flights}};iv({event:a,extension:o})}return e&&(e.drawName=r,kr({tournamentId:t?.tournamentId,drawDefinition:e})),!s&&!e?{error:kt}:{...oe,flight:s}}function eEe({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){if(!Xi(i))return{error:we};let a=kn({event:n}).flightProfile,s=i.drawName&&Q7({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:r,event:n});if(s?.error)return s?.error;let o=s?.flight||a?.flights?.find(l=>l.drawId===r);if(!o&&!e)return{error:kt};if(o){let l={name:Ud,value:{...a,flights:a.flights}};iv({event:n,extension:l})}return e&&(i.policyDefinitions&&Qy({policyDefinitions:i.policyDefinitions,drawDefinition:e}),kr({tournamentId:t?.tournamentId,drawDefinition:e})),{...oe}}function tEe({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){if(!i)return{error:kt};let r=os({drawDefinition:i}),n=s=>r?.drawMatchUps?.find(o=>o.matchUpId===s);for(let s of i.structures||[]){let{positionAssignments:o,stage:l,stageSequence:c}=s;o&&(c!==1||![qt,Et].includes(l))&&(s.positionAssignments=o.map(p=>(delete p.participantId,p)),s.seedAssignments=[]);let{matchUps:u,isRoundRobin:d}=dr({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:s});for(let p of u){let{matchUpId:f,roundNumber:h}=p,m=p.sides||[],A=n(f);if(A){if(delete A.extensions,delete A.notes,A.matchUpStatus!=="BYE"&&Object.assign(A,I$),h&&h>1&&A.drawPositions?.length&&!d){let g=m?.map(({drawPosition:b,participantFed:y})=>!y&&b).filter(Boolean),v=A.drawPositions.map(b=>g.includes(b)?void 0:b);A.drawPositions=v}e?delete A.timeItems:A.timeItems?.length&&(A.timeItems=A.timeItems.filter(g=>g.itemType&&![xh,Eg,dS,JY,pS,fS].includes(g.itemType))),Zi({tournamentId:t?.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:A})}}}i.extensions=i.extensions.filter(s=>s.name!==eT);let a=(i.structures||[]).map(({structureId:s})=>s);return kr({drawDefinition:i,structureIds:a}),{...oe}}function iN({tournamentRecord:t}){if(!t)return{error:nt};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return(t.events?.flatMap(r=>{let n=r.eventId;return i[n]=r,(r?.drawDefinitions||[]).map(a=>({drawDefinition:a,eventId:n}))}).filter(Boolean)).forEach(({drawDefinition:r,eventId:n})=>{let a=0,s=0,o=0,{allStructuresLinked:l}=g$({drawDefinition:r}),c=i[n],u=(r?.structures||[]).map(b=>{let{stage:y,stageSequence:I,structureId:w}=b,S=rw[y],{inContextStructureMatchUps:T}=UE({drawDefinition:r,structure:b,event:c}),D=T?.filter(({winningSide:G})=>G),C=D.filter(Boolean).length||0;s+=C,o+=T.length-s;let E=Math.max(D.filter(({roundNumber:G})=>G===1).map(({roundPosition:G})=>G)),{positionAssignments:P}=wr({structure:b}),R=P?.filter(({participantId:G})=>G);a+=R?.length??0;let M=(P?.length??0)-(R?.length??0),{roundMatchUps:N,roundProfile:k,roundNumbers:O,maxMatchUpsCount:x}=Oo({matchUps:T}),F=k&&Object.keys(k).filter(G=>!k[G].inactiveRound).map(G=>Number.parseInt(G)),_=k&&Object.keys(k).filter(G=>k[G].inactiveRound).map(G=>Number.parseInt(G)),V=k&&Object.values(k).every(G=>G.inactiveRound);return{positionsAssignedCount:R?.length??0,maxWinningSideFirstRoundPosition:E,unassignedPositionsCount:M,inactiveStructure:V,maxMatchUpsCount:x,inactiveRounds:_,roundMatchUps:N,activeRounds:F,roundNumbers:O,roundProfile:k,structureId:w,stageSequence:I,orderNumber:S,stage:y}}),d=u.find(b=>b.orderNumber===2&&b.stageSequence===1),p=u.filter(({inactiveStructure:b})=>!b).length,{links:f}=wE({structureId:d.structureId,drawDefinition:r}),h=ci(d.activeRounds[0])===1&&d.activeRounds.length===1&&p===1,m=u?.every(({inactiveStructure:b})=>b),A=!f.length&&d.activeRounds.length&&(d.roundProfile[1].inactiveCount||d.inactiveRounds.length),g=r.drawId;a&&!s&&e.positionsNoOutcomes.push(g),m&&e.inactive.push(g),h&&e.matchPlay.push(g),A&&e.canBePruned.push(g);let v={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:o,positionsAssignedCount:a,allStructuresLinked:l,structuresData:u,inactiveDraw:m,isMatchPlay:h,drawId:g};e.drawAnalysis[g]=v}),{...oe,drawsAnalysis:e}}function iEe({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){if(!e)return{error:nt};if(!i)return{error:kt};let n=[],{drawsAnalysis:a}=iN({tournamentRecord:e});if(a.canBePruned.includes(r)){let s=a.matchPlay.includes(r),o=a.drawAnalysis[r],{structures:[l]}=Td({stageSequence:1,drawDefinition:i,stage:Et}),c=o.structuresData.find(({structureId:f})=>l.structureId===f),u=(l.matchUps??[]).sort((f,h)=>f.roundPosition-h.roundPosition);n=u.filter(({roundNumber:f})=>!c.inactiveRounds.includes(f));let d=n.map(_a),p=u.map(_a).filter(f=>!d.includes(f));if(s){let f=n.filter(({roundNumber:v})=>!c.inactiveRounds.includes(v)).filter(({winningSide:v})=>v),h=f.map(_a),m=d.filter(v=>!h.includes(v));p.push(...m);let A=f.flatMap(v=>v.drawPositions??[]).filter(Boolean).flat(),g=Object.assign({},...A.map((v,b)=>({[v]:b+1})));if(f.forEach(v=>{t?v.drawPositions=v.drawPositions.map(b=>g[b]):delete v.drawPositions}),t){let v=l?.positionAssignments?.filter(b=>A.includes(b.drawPosition)).map(b=>(b.drawPosition=g[b.drawPosition],b));l.positionAssignments=v}else l.positionAssignments=[];l.matchUps=f,n=f}zh({tournamentId:e?.tournamentId,matchUpIds:p,drawDefinition:i}),kr({drawDefinition:i})}return{...oe,matchUps:n}}function BZe({isPositionAction:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,loserMatchUp:n,matchUpsMap:a,structureId:s,structure:o,event:l}){if(!i)return{error:kt};if(o||({structure:o}=di({drawDefinition:i,structureId:s})),!o)return{error:an};s||({structureId:s}=o);let c="assignDrawPositionQualifier";yl({method:c,color:"cyan",drawPosition:r}),a??=os({drawDefinition:i});let{positionAssignments:u}=wr({structure:o}),{activeDrawPositions:d}=UE({drawDefinition:i,structureId:s});if(u?.find(g=>g.drawPosition===r)?.qualifier)return{...oe};let p=!!(n&&a.drawMatchUps.some(g=>g.loserMatchUpId===n?.matchUpId&&ks(g.matchUpStatus)));if(d?.includes(r)&&!p)return{error:sM};let f=u?.find(g=>g.drawPosition===r);if(!f)return{error:Zw};let{containsQualifier:h,containsParticipant:m}=a7(f);if(h)return{...oe};let A=tr({tournamentRecord:e,drawDefinition:i,event:l}).appliedPolicies??{};return u?.forEach(g=>{g.drawPosition===r&&(g.qualifier=!0,p&&(g.participantId=void 0,console.log("oddity: invalid participantId on qualifier position cleared")))}),Ym({tournamentId:e?.tournamentId,drawDefinition:i,structure:o,event:l}),kZe({assignedParticipantId:m,isPositionAction:t,appliedPolicies:A,drawDefinition:i,drawPosition:r,structureId:s,stack:c})}function kZe({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&TM({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),ce({result:{...oe},stack:s})}function rEe({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:s,bye:o}){if(!e)return{error:kt};if(!r)return{error:cE};if(!n)return{error:Fc};if(o){let l=Hc({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else if(a){let l=BZe({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else{let l=vf({participantId:i,tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}return{...oe}}function nEe(t){let e=t.matchUpIds??[],{drawDefinition:i}=t,r=t.structureId??i?.structures?.find(l=>l.matchUps?.some(({matchUpId:c})=>e.includes(c)))?.structureId??i?.structures?.[0]?.structureId;if(!r)return{error:an};let n=i.structures?.find(l=>l.structureId===r);if(!n)return{error:an};let a=n?.matchUps,s=a?.find(l=>!!l.roundPosition);if(n.structures||s||n.finishingPosition===oS)return{error:mb};let o=a.filter(({roundNumber:l})=>t.roundNumbers?.includes(l)).map(_a);return e=e.filter(l=>!o.includes(l)),t.roundNumbers&&!e.length&&(e=o),{existingMatchUps:a,matchUpIds:e,structureId:r,structure:n}}function aEe(t){let e=Qt(t,[{[ro]:!0},{[YT]:{[bM]:!1,roundNumbers:!1},[Nc]:we,[rl]:qs}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:s,event:o}=t,l=nEe(t);if(l.error)return l;let{structure:c,structureId:u,existingMatchUps:d,matchUpIds:p}=l,f=[],h=d?.filter(({matchUpId:g,score:v,winningSide:b})=>{if(b&&!n)return!1;if(b||wa({score:v})){if(!b&&!i)return!1;f.push(g)}else if(!r)return!1;return p?.includes(g)})??[],m=h.map(_a),A=h.map(({tieMatchUps:g})=>g?.map(_a)).filter(Boolean).flat();if(m.length){c.matchUps=(c.matchUps??[]).filter(({matchUpId:b})=>!m.includes(b)),zh({tournamentId:a?.tournamentId,matchUpIds:[...A,...m],action:"deleteAdHocMatchUps",eventId:o?.eventId,drawDefinition:s});let g=Ei(c.matchUps.map(rc("roundNumber"))),v=b6e(g);if(v.length){v.reverse();for(let b of v)c.matchUps.forEach(y=>{y.roundNumber&&y.roundNumber>b&&(y.roundNumber-=1,Zi({tournamentId:a?.tournamentId,context:["adHoc round deletion"],eventId:o?.eventId,drawDefinition:s,matchUp:y}))})}if(f.length){c.positionAssignments=Ei(c.matchUps.flatMap(S=>(S.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(S=>({participantId:S}));let b=c?.matchUpFormat??s?.matchUpFormat??o?.matchUpFormat,y=l.existingMatchUps.some(S=>S.matchUpType===Pc)?{matchUpTypes:[Pc]}:void 0,{matchUps:I}=dr({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:y,structure:c,event:o});el({structure:c})&&(c.positionAssignments=Ei(I.flatMap(S=>(S.sides??[]).map(T=>T.participantId)).filter(Boolean)).map(S=>({participantId:S})));let w=O7({positionAssignments:c.positionAssignments,tournamentRecord:a,drawDefinition:s,matchUpFormat:b,matchUps:I,event:o});w.error&&console.log(w)}kr({structureIds:[u],eventId:o?.eventId,drawDefinition:s})}return!m.length&&p.length?{error:dM}:{...oe,deletedMatchUpsCount:[...m,...A].length}}function sEe({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:nt};if(!i)return{error:kt};if(!n)return ce({result:{error:Yt},info:"roundNumber required"});let s=di({drawDefinition:i,structureId:r});if(s.error)return s;let o=s.structure;return o?.structures?{error:mb}:el({structure:o})?xZe({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:o}):(console.log("not implemented"),{...oe})}function xZe({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let s=n?.matchUps??[],o=[],l=[],c=!1;if(s.reduce((u,d)=>{let p=d?.roundNumber;return p?u.includes(p)?u:u.concat(p):u},[]).sort(ua).includes(r)){let u=s.filter(d=>{let p=d.roundNumber===r&&(!ta.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&o.push(...d.tieMatchUps.map(_a))),!p});l.length&&(zh({matchUpIds:[...o,...l],drawDefinition:e,tournamentId:i,eventId:a}),u.some(d=>d.roundNumber===r)||(u.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,Zi({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),c=!0),n.matchUps=u)}return{deletedMatchUpsCount:l.length,roundRemoved:c,...oe}}function U$(t){let{suppressNotifications:e,tournamentRecord:i,drawDefinition:r,matchUps:n,event:a}=t;if(typeof r!="object")return{error:kt};let s=t?.structureId;if(!s&&r.structures?.length===1&&(s=r.structures?.[0]?.structureId),typeof s!="string")return{error:Fc};if(!Pu(n))return{error:we,info:Gy("matchUps")};let o=r.structures?.find(p=>p.structureId===s);if(!o)return{error:an};let l=(o?.matchUps).find(p=>!!p.roundPosition);if(o.structures||l||o.finishingPosition===oS)return{error:mb};let c=as({tournamentRecord:i,inContext:!1})?.matchUps?.map(_a)??[],u=n.map(_a);if(_o(c,u))return{error:Zwe,info:"One or more matchUpIds already present in tournamentRecord"};o.matchUps.push(...n);let d=n.map(({tieMatchUps:p})=>p).filter(Boolean).flat();return e||(Tg({tournamentId:i?.tournamentId,matchUps:[...d,...n],eventId:a?.eventId,drawDefinition:r}),kr({drawDefinition:r,structureIds:[s]})),{...oe}}function oEe({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){if(!e)return{error:kt};if(!r)return{error:Fc};if(!i)return{error:cE};let{structure:s}=di({drawDefinition:e,structureId:r});if(!s)return{error:an};let o=s;s.structures&&s.structureType===$o&&(o=s.structures?.find(f=>f.positionAssignments?.find(h=>h.drawPosition===i)));let l=o?.positionAssignments,c=l?.find(f=>f.drawPosition===i);c&&ur({element:c,extension:{name:ZT,value:n}});let u=(a?.eventType===Hr||e.matchUpType===Hr||(a?.tieFormat??e?.tieFormat??s?.tieFormat))&&{matchUpTypes:[Hr]},{matchUps:d}=dr({structure:o,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:u,event:a}),p=s?.matchUpFormat??e.matchUpFormat;return O7({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),kr({drawDefinition:e,structureIds:[r]}),{...oe}}var lEe={};Li(lEe,{addGoesTo:()=>Vy,allPlayoffPositionsFilled:()=>U7,checkValidEntries:()=>E$,findDrawDefinition:()=>W7,getAssignedParticipantIds:()=>Cb,getAvailableMatchUpsCount:()=>T$,getAvailablePlayoffProfiles:()=>XM,getDrawDefinitionTimeItem:()=>QY,getDrawParticipantRepresentativeIds:()=>z7,getDrawStructures:()=>Td,getDrawTypeCoercion:()=>rN,getEligibleVoluntaryConsolationParticipants:()=>j7,getMatchUpsMap:()=>os,getParticipantIdFinishingPositions:()=>q7,getPositionAssignments:()=>e1,getPositionsPlayedOff:()=>PE,getRandomQualifierList:()=>X7,getSeedingThresholds:()=>v7,getSeedsCount:()=>nN,getStructureSeedAssignments:()=>Au,getTeamLineUp:()=>Hy,getValidGroupSizes:()=>zM,isAdHoc:()=>el,isCompletedStructure:()=>_h,isValidForQualifying:()=>Z7,positionActions:()=>Y7});function j7({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:s,drawDefinition:o,matchUpsLimit:l,requirePlay:c,requireLoss:u,allEntries:d,winsLimit:p,event:f}){if(!o)return{error:kt};let h=[Et,Dn];i&&h.push(qt);let m=f?.eventType?{matchUpTypes:[f.eventType]}:void 0,A=o?.matchUpType?{matchUpTypes:[o.matchUpType]}:void 0,g=e&&f?Wh({contextFilters:{stages:h},matchUpFilters:m,tournamentRecord:s,inContext:!0,event:f})?.matchUps??[]:No({contextFilters:{stages:h},matchUpFilters:A,tournamentRecord:s,inContext:!0,drawDefinition:o})?.matchUps??[],v=uS({stage:Za,drawDefinition:o}),b=new Set(v.map(({participantId:F})=>F)),y={},I={},w={},S={};n??=yA({policyTypes:[k4],tournamentRecord:s,drawDefinition:o,event:f}).policyDefinitions;let T=n?.[k4];t=t.length&&t||T?.excludedMatchUpStatuses||[],e=e??T?.includeEventParticipants,d=d??T?.allEntries,r=r??T?.finishingRoundLimit,a=a??T?.roundNumberLimit,l=l??T?.matchUpsLimit,c??=T?.requirePlay??!0,u??=T?.requireLoss??!0,p=p??T?.winsLimit;for(let F of g){if(c&&F.winningSide&&![1,2].includes(F.winningSide)&&F.matchUpStatus!==An||F.finishingRound&&r&&F.finishingRound>=r||F.finishingRound&&a&&F.finishingRound<=a)continue;let _=F.sides?.find(({sideNumber:G})=>F.winningSide&&G===3-F.winningSide),V=F.sides?.find(({sideNumber:G})=>F.winningSide&&G===F.winningSide);if(F.sides?.forEach(G=>{let z=G?.participant?.participantId;z&&(w[z]=G.participant,F.matchUpStatus===An&&!c&&(I[z]=G.participant,y[z]||(y[z]=0),(!F.matchUpStatus||!t.includes(F.matchUpStatus))&&(y[z]+=1)))}),_?.participant){let G=_.participant.participantId;I[G]=_.participant,y[G]||(y[G]=0),F.matchUpStatus&&!t.includes(F.matchUpStatus)&&(y[G]+=1)}if(V?.participant){let G=V.participant.participantId;S[G]||(S[G]=0),S[G]+=1,y[G]||(y[G]=0),F.matchUpStatus&&!t.includes(F.matchUpStatus)&&(y[G]+=1)}}let D=s?.participants&&!c&&!u&&d,C;e&&f?C=f.entries:C=o.entries;let E=D?(C??[]).filter(F=>![kh,Du].includes(F.entryStatus)).map(({participantId:F})=>F):[],P=Object.keys(I),R=D?(s?.participants??[]).filter(({participantId:F})=>E.includes(F)):u&&Object.values(I)||Object.values(w),M=F=>!u||P.includes(F),N=F=>!c||(y[F]||0)>=0,k=F=>!p||(S[F]||0)<=p,O=F=>!l||y[F]<=l,x=F=>!b.has(F);return{eligibleParticipants:R.filter(F=>M(F.participantId)&&N(F.participantId)&&k(F.participantId)&&O(F.participantId)&&x(F.participantId)).map(F=>({...F,individualParticipants:F.individualParticipantIds?.map(_=>s?.participants?.find(V=>V.participantId===_))})),losingParticipantIds:P,...oe}}function T$(t){let e=Qt(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:r}=t,n=t.structureId??(i.structures?.length===1&&i.structures?.[0]?.structureId);if(typeof n!="string")return{error:Fc};let a=i.structures?.find(h=>h.structureId===n);if(!a)return{error:an};let s,o=(a.matchUps??[])?.reduce((h,m)=>(m.roundPosition&&(s=!0),(m?.roundNumber||0)>h?m.roundNumber:h),0);if(a.structures||s||a.finishingPosition===oS)return{error:mb};let l=i?.entries?.filter(h=>{let m=h.entryStatus;return Nd.includes(m)})??[],c=Math.floor(l?.length/2)||1,u=r??o??1,d=a.matchUps?.filter(h=>h.roundNumber===u)?.length??0,p=c-d,f=p>0?p:0;return{...oe,availableMatchUpsCount:f,lastRoundNumber:o,roundMatchUpsCount:c}}function z7({drawDefinition:t}){let e=ki({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:e.extension?.value||[]}}function _Ze({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:kt};let r=ia({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=Dt(r.matchUps,!1,!0),a=Ei(n.reduce((o,l)=>o.concat(...l.sides.map(c=>c.participantId).filter(Boolean)),[])),s=Object.assign({},...a.map(o=>{let l=n.filter(c=>c.sides.map(u=>u.participantId).filter(Boolean).includes(o));return{[o]:l}}));return{participantIds:a,participantIdMatchUps:s}}function q7({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:kt};let{participantIds:r,participantIdMatchUps:n}=_Ze({tournamentParticipants:e?.participants,drawDefinition:i}),a=r?.map(s=>{let o=n[s].filter(d=>[Hn,"BYE"].includes(d.matchUpStatus)||d.winningSide),l=o.map(d=>{let p=d.sides.find(h=>h.bye),f=d.sides.find(h=>h.participantId===s).sideNumber;return(d.winningSide||t&&p&&f)===f?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),c=d=>Math.abs(d[0]-d[1]),u=l.reduce((d,p)=>d&&c(d)<c(p)?d:p,void 0);return{[s]:{relevantMatchUps:o,finishingPositionRanges:l,finishingPositionRange:u}}})||[];return Object.assign({},...a)}function lv({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:nt};if(!r)return{error:hp};if(!e&&t){if(typeof i!="string"&&(i=YCe({tournamentRecords:t,drawId:r}),!i))return{error:LT};if(e=t[i],!e)return{error:nt}}let n=e&&tl({tournamentRecord:e,drawId:r});return n?.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...oe}:ce({result:{error:Rc},stack:"findDrawDefinition"})}function W7(t){let{drawDefinition:e,error:i}=lv(t);return i?{error:i}:{drawDefinition:Dt(e)}}function OZe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){let s=a?.entries?.filter(({entryStatus:o})=>[Du,Sb].includes(o)).map(({participantId:o})=>o)||[];if(s.length){let o=r.individualParticipantIds,l=e?t.filter(({participantId:u})=>s.includes(u)):void 0,c=e?t.filter(({participantId:u})=>o.includes(u)):void 0;return{validModifyAssignedPairAction:Lt({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:$Xe,availableIndividualParticipantIds:s,availableIndividualParticipants:l,existingIndividualParticipantIds:o,existingIndividualParticipants:c,type:D7},!1,!1,!0)}}return{}}function jy(t){let{inContextDrawMatchUps:e,targetData:i,drawDefinition:r,relevantLink:n}=t;if(n?.linkCondition===Af&&i?.matchUp?.matchUpStatus==="BYE")return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:s},targetLinks:o}=i,l=a&&Fo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),c=l?.targetMatchUps?.loserMatchUp,u=l?.targetMatchUps?.loserMatchUpDrawPositionIndex,d=c?.sides[u]?.participant,p=ks(a?.matchUpStatus),f=p&&!d,h=a?.sides?.filter(b=>b?.participant).length??0,m=a?.winningSide&&p&&h===1,A=s?.drawPositions?.filter(Boolean).length||0;if(!m&&(a?.winningSide&&!f||s?.winningSide&&A===2&&(!s.feedRound||!ks(s?.matchUpStatus))))return!0;let g=s&&Fo({matchUpId:s.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),v=l&&jy({relevantLink:o?.loserTargetLink,targetData:l,inContextDrawMatchUps:e,drawDefinition:r});return!!(g&&jy({targetData:g,inContextDrawMatchUps:e,drawDefinition:r})||v)}var cEe={[Bh]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[qt,Et],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[JP,uw,v$,RI],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},Yk="positionAction",X4="matchUpAction";function uEe({actionType:t=Yk,appliedPolicies:e,drawDefinition:i,structure:r}){let n=t===Yk&&Bh||t===X4&&Ja,a=t===Yk&&cEe||t===X4&&NTe,s=n&&(e?.[n]||a?.[n]),o=i.links?.filter(d=>d?.target?.structureId===r?.structureId)?.map(({target:d})=>d.feedProfile)??[],{enabledStructures:l,disabledStructures:c}=s||{},u=c?.find(d=>{let{stages:p,stageSequences:f,structureTypes:h,feedProfiles:m}=d;return(!m?.length||Array.isArray(m)&&m.some(A=>o.includes(A)))&&(!p?.length||Array.isArray(p)&&p?.includes(r?.stage))&&(!h?.length||Array.isArray(h)&&h?.includes(r?.structureType))&&(!f?.length||Array.isArray(f)&&f.includes(r?.stageSequence))});return{enabledStructures:l,actionsDisabled:u,actionsPolicy:s}}function Cie({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function dEe({enabledStructures:t,drawDefinition:e,structure:i}){if(t===!1)return{};if(!t?.length)return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:r,stageSequence:n,structureType:a}=i||{},s=e.links?.filter(o=>o?.target?.structureId===i?.structureId)?.map(({target:o})=>o.feedProfile)||[];return{policyActions:t.find(o=>{let{stages:l,stageSequences:c,structureTypes:u,feedProfiles:d}=o||{},p=!l?.length||Array.isArray(l)&&l.includes(r),f=!c?.length||Array.isArray(c)&&c.includes(n),h=!u?.length||Array.isArray(u)&&u.includes(a),m=!d?.length||Array.isArray(d)&&d.some(A=>s.includes(A));return f&&h&&m&&o&&p})}}function ul({action:t,policyActions:e}){let i=!e?.enabledActions||e?.disabledActions?.length&&e.disabledActions.includes(t);return i?!1:(e?.enabledActions.length===0||e?.enabledActions.includes(t))&&!i}var pEe="replaceTieMatchUpParticipantId",fEe="assignTieMatchUpParticipantId",Z4="removeTieMatchUpParticipantId",Eie="assignMatchUpSideParticipant",FZe="removeMatchUpSideParticipant",hEe="substituteParticipant",J4="REMOVE_SUBSTITUTION",mEe="REPLACE_PARTICIPANT",K7="REMOVE_PARTICIPANT",e3="setMatchUpStatus",t3="SUBSTITUTION",AEe="SCHEDULE",LZe="PENALTY",i3="REFEREE",gEe="STATUS",r3="START",vEe="SCORE",$Ze={REPLACE_TEAM_POSITION_METHOD:pEe,ASSIGN_TEAM_POSITION_METHOD:fEe,REMOVE_TEAM_POSITION_METHOD:Z4,REPLACE_PARTICIPANT:mEe,SUBSTITUTION_METHOD:hEe,REMOVE_SUBSTITUTION:J4,REMOVE_PARTICIPANT:K7,SCHEDULE_METHOD:e3,SUBSTITUTION:t3,SCHEDULE:AEe,PENALTY:LZe,REFEREE:i3,STATUS:gEe,SCORE:vEe,START:r3,END:"END"};function HZe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:s,participantId:o,sideNumber:l,matchUpId:c,matchUp:u,drawId:d,side:p}){let f=[],h=n.sides?.find(M=>M.participant),m=Tc(n.gender)&&n.sideNumber&&n.sides?.filter(M=>M.particiapntId).length===1&&h?.participant?.person?.sex,A=n.matchUpType,g=(s??r?.participants?.enforceGender)!==!1?n.gender:void 0,v=n.sides?.flatMap(M=>M.participant?.individualParticipants||M.participant).filter(Boolean)?.map(qi),b=n.sides?.filter(M=>!l||M.sideNumber===l).flatMap(M=>M.participant?.individualParticipants||M.participant).filter(Boolean),y=b?.map(qi),I=e?.find(M=>M.matchUpId===n.matchUpTieId)?.sides?.map(M=>M?.participant?.individualParticipants?.filter(({participantId:N,person:k})=>!y?.includes(N)&&(!g||Ch(g)||k.sex===g||Tc(g)&&!m||m&&k.sex!==m))),w=l?I?.[l-1]:I?.map((M,N)=>({participants:M,sideNumber:N+1})),S=l?I?.[l-1]?.map(qi):I?.map((M,N)=>({participants:M?.map(qi),sideNumber:N+1})),T=l&&(Vn(CI)(A)&&!y?.length||Vn(By)(A)&&(y?.length??0)<2)||!l&&(Vn(CI)(A)&&(y?.length??0)<2||Vn(By)(A)&&(y?.length??0)<4),D=S?.filter(M=>!v?.includes(M)),C=w?.filter(({participantId:M})=>D.includes(M));if(T&&D?.length&&f.push({availableParticipantIds:D,method:fEe,availableParticipants:C,type:cw,payload:{participantId:void 0,tieMatchUpId:c,sideNumber:l,drawId:d}}),y?.length&&(!wa(u)||p?.substitutions?.length)&&f.push({method:Z4,type:K7,existingParticipantIds:y,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}}),C?.length&&(!l&&y?.length||l&&p?.participant)&&f.push({availableParticipantIds:D,method:pEe,availableParticipants:C,type:mEe,existingParticipantIds:y,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:c,drawId:d}}),ul({policyActions:a,action:J4})&&p?.substitutions?.length){let M=p.participant?.participantType===Wi&&[p.participantId]||p.participant?.participantType===Ni&&p.participant.individualParticipantIds||[],N=p.substitutions.map(k=>k.participantId).filter(k=>M.includes(k));(!o||N.includes(o))&&f.push({method:Z4,type:J4,substitutedParticipantIds:N,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}})}let E=t?.[Ja],P=E?.substituteWithoutScore,R=E?.substituteAfterCompleted;if(ul({policyActions:a,action:t3})&&i.length===2&&(!l&&y?.length||l&&p?.participant)&&(P||wa(u))&&(R||u.matchUpStatus&&!ta.includes(u.matchUpStatus))&&b?.length&&w.length){let M=b.map(qi);f.push({info:"list of team players available for substitution",method:hEe,availableParticipantIds:S,existingParticipantIds:M,availableParticipants:w,existingParticipants:b,type:t3,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:c,drawId:d}})}return f}function VZe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:s,drawPosition:o,validActions:l,structureId:c,structure:u,drawId:d,event:p}){if(i.includes(o))return{};let f=l.find(S=>S.type===cw)?.availableParticipantIds,h=a?.[Bh]?.otherFlightEntries,m=a?.[Bh]?.restrictQualifyingAlternates,A=(s.entries??[]).filter(({entryStage:S})=>!m||(u.stage===qt?S===qt:S!==qt)).sort((S,T)=>(S.entryPosition??1/0)-(T.entryPosition??1/0)).map(({participantId:S})=>S).filter(Boolean),{allPositionedParticipantIds:g}=FUe({drawDefinition:s}),v=r.map(S=>S.participantId).filter(Boolean),b=A.filter(S=>u.stage&&[qt,Et,Dn].includes(u.stage)?!g?.includes(S):!v.includes(S)),y=(p?.entries??[]).filter(S=>S.entryStatus===ud&&yEe({restrictQualifyingAlternates:m,structure:u,entry:S})&&(u.stage&&[qt,Et,Dn].includes(u.stage)?!g?.includes(S.participantId):!v.includes(S.participantId))).sort((S,T)=>(S.entryPosition??1/0)-(T.entryPosition??1/0)).map(S=>S.participantId),I=Ei(b.concat(y));if(h){let S=(p?kn({event:p}).flightProfile:void 0)?.flights?.filter(T=>T.drawId!==d).map(T=>T.drawEntries.filter(D=>D.participantId&&![kh,Du,Sb].includes(D.entryStatus)&&!A.includes(D.participantId)).map(({participantId:D})=>D)).flat().filter(Boolean);S?.length&&I.push(...S)}f?.length&&(I=I.filter(S=>!f.includes(S)));let w=n?t?.filter(S=>I.includes(S.participantId)):void 0;return w?.forEach(S=>{let T=(s.entries??[]).find(D=>D.participantId===S.participantId);S.entryPosition=T?.entryPosition}),w?.sort((S,T)=>(S.entryPosition||1/0)-(T.entryPosition||1/0)),I.length?{validAlternatesAction:Lt({payload:{drawId:d,structureId:c,drawPosition:o},willDisableLinks:e,method:FXe,availableAlternatesParticipantIds:I,type:P7,availableAlternates:w})}:{}}function yEe({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===qt&&!t||i.entryStage===Et&&r===Ls)return!0}function GZe({eventEntries:t,structure:e}){let i=n=>n.entryStatus===ud&&yEe({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(qi)}function QZe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:s,matchUpId:o,structure:l,matchUp:c,drawId:u,event:d}){let p=[],f=l?.matchUps??[],h=c.sides?.find(T=>T.sideNumber===s)?.participantId,m=f.filter(({roundNumber:T})=>T===c.roundNumber),A=n?.entries?.filter(({entryStatus:T})=>T&&Ub.includes(T)).map(qi)??[],g=m.map(T=>(T.sides??[]).flatMap(qi)).flat().filter(Boolean),v=A.filter(T=>!i.includes(T)&&(!t||!g.includes(T))),b=e?.filter(T=>v?.includes(T.participantId)).map(T=>Dt(T,void 0,!0));b?.forEach(T=>{let D=(n.entries??[]).find(C=>C.participantId===T.participantId);T.entryPosition=D?.entryPosition}),v.length&&p.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},method:Eie,type:cw,availableParticipantIds:v,participantsAvailable:b});let y=d?.entries??[],I=GZe({eventEntries:y,structure:l}),w=Ei(A.concat(I));if(r){let T=(d?kn({event:d}):void 0)?.flights?.filter(D=>D.drawId!==u).flatMap(D=>D.drawEntries.filter(C=>C.participantId&&![kh,Du,Sb].includes(C.entryStatus)).map(({participantId:C})=>C)).filter(Boolean);T?.length&&w.push(...T)}w=w.filter(T=>!i.includes(T)&&!v.includes(T)&&(!t||!g.includes(T)));let S=e?.filter(T=>w.includes(T.participantId)).map(T=>Dt(T,void 0,!0));if(S?.forEach(T=>{let D=(n.entries??[]).find(C=>C.participantId===T.participantId);T.entryPosition=D?.entryPosition}),S?.sort((T,D)=>(T.entryPosition||1/0)-(D.entryPosition||1/0)),w.length&&p.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},availableParticipantIds:w,participantsAvailable:S,method:Eie,type:ud}),!wa(c)&&s&&h){p.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},method:FZe,type:K7});let T=k=>k.sides.map(qi),D=({matchUpId:k})=>k!==c.matchUpId,C=k=>!wa(k),E=c.sides?.find(k=>k.sideNumber!==s)?.participantId,P=f.filter(({roundNumber:k})=>k!==c.roundNumber).filter(D).map(T),R=[E,...P.filter(k=>k.includes(h)).flat()].filter(Boolean),M=k=>!R.flat().includes(k),N=m.filter(C).filter(D).map(T).flat().filter(M);if(N.length){let k=e?.filter(O=>N.includes(O.participantId)).map(O=>Dt(O,void 0,!0));p.push({payload:{participantIds:[h],roundNumber:c.roundNumber,structureId:a,sideNumber:s,matchUpId:o,drawId:u},swappableParticipantIds:N,method:HXe,type:y$,swappableParticipants:k})}}return p}function C$(t){if(!t)return{error:we};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:r=!0,policyDefinitions:n,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l}=t,c=t.tournamentRecord??(t.tournamentId&&rn(t.tournamentId)&&t.tournamentRecords?.[t.tournamentId]);if(!c)return{error:nt};if(!l||!rn(l))return{error:go};if(o&&![1,2].includes(o))return ce({result:{error:we},context:{sideNumber:o}});if(!e){let J=(as({tournamentRecord:c}).matchUps??[]).find(ue=>ue.matchUpId===l);i=(c?.events??[]).find(ue=>ue.eventId===J?.eventId);let ie=(i?.drawDefinitions??[]).find(ue=>ue.drawId===J?.drawId);ie&&(e=ie)}if(!e)return{error:kt};let u=vn({withIndividualParticipants:!0,tournamentRecord:c}).participants,{drawId:d}=e,{matchUp:p,structure:f}=Yr({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:Zs};let h=tr({tournamentRecord:c,drawDefinition:e,structure:f,event:i}).appliedPolicies??{};Object.assign(h,n??{});let m=h?.[Bh]?.otherFlightEntries,A=h?.[Ja]??CE[Ja],{enabledStructures:g}=uEe({actionType:X4,appliedPolicies:h,drawDefinition:e,structure:f}),{policyActions:v}=dEe({enabledStructures:g,drawDefinition:e,structure:f}),b=t.matchUpsMap??os({drawDefinition:e}),y=t.inContextDrawMatchUps??ia({tournamentParticipants:u,inContext:!0,drawDefinition:e,matchUpsMap:b,event:i}).matchUps,I=y?.find(J=>J.matchUpId===l),w=o&&I?.sides?.find(J=>J.sideNumber===o),S=I?.sides?.map(J=>J.participantId||J.participant?.participantid).filter(Boolean)??[],{assignedPositions:T,allPositionsAssigned:D}=Ia({structure:f}),{structureId:C}=f??{},E=[];if(!C)return{validActions:E};let P=el({structure:f}),R=!!p.collectionId;if(P&&!R){let J=QZe({restrictAdHocRoundParticipants:r,tournamentParticipants:u,matchUpParticipantIds:S,otherFlightEntries:m,drawDefinition:e,structureId:C,sideNumber:o,matchUpId:l,structure:f,matchUp:p,drawId:d,event:i});E.push(...J)}let M=_h({drawDefinition:e,structure:f}),N=T?.filter(J=>J.participantId).map(J=>J.drawPosition),k=T?.filter(J=>J.bye).map(J=>J.drawPosition),O=p.matchUpStatus==="BYE"||!R&&p.drawPositions?.reduce((J,ie)=>k?.includes(ie)||J,!1);if(O)return{validActions:E,isByeMatchUp:O};ul({policyActions:v,action:i3})&&E.push({type:i3,payload:{matchUpId:l}});let x=!$M({matchUpStatus:p.matchUpStatus}),F=h?.scoring?.structures,_=f?.stage&&F?.stage?.[f.stage],V=f?.stageSequence&&_?.stageSequence?.[f.stageSequence],G=!(h?.scoring?.requireAllPositionsAssigned||_?.requireAllPositionsAssigned||V?.requireAllPositionsAssigned)||D,z=p.sides?.filter(J=>J?.participantId).length===2,Q=p.matchUpStatus&&[An,Aa].includes(p.matchUpStatus),j=Fo({inContextDrawMatchUps:y,drawDefinition:e,matchUpId:l}),W=jy({inContextDrawMatchUps:y,drawDefinition:e,targetData:j}),Y=(I?.drawPositions?.length===2&&I.drawPositions.every(J=>N?.includes(J))&&I?.sides?.length===2&&I.sides.every(({participantId:J})=>J)||z)&&!(Q&&W),X={method:yCe,type:uw,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(x&&E.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:e3,type:AEe}),ul({policyActions:v,action:uw})&&(w?.participant||!o&&S?.length)&&E.push(X),x&&Y&&E.push({type:gEe}),G&&Y){let{matchUpId:J,matchUpFormat:ie}=p,ue={drawId:d,matchUpId:J,matchUpFormat:ie,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};E.push({info:"set outcome and winningSide",method:e3,type:vEe,payload:ue}),ul({policyActions:v,action:r3})&&E.push({type:r3}),ul({policyActions:v,action:"END"})&&E.push({type:"END"})}if(R&&I){let J=HZe({specifiedPolicyDefinitions:n,inContextDrawMatchUps:y,matchUpParticipantIds:S,matchUpActionsPolicy:A,inContextMatchUp:I,policyActions:v,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l,matchUp:p,drawId:d,side:w});E.push(...J)}return{structureIsComplete:M,validActions:E,isDoubleExit:Q,...oe}}function jZe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:s,drawPosition:o,structureId:l,structure:c,drawId:u,event:d}){if(n.includes(o)||r&&!e)return{};let{sourceStructureIds:p,targetStructureIds:f}=s.links?.reduce((g,v)=>{let b=v.source?.structureId,y=v.target?.structureId;return g.sourceStructureIds.includes(b)||g.sourceStructureIds.push(b),g.targetStructureIds.includes(y)||g.targetStructureIds.push(y),g},{sourceStructureIds:[],targetStructureIds:[]})||{},h=[],m=s.links?.filter(g=>g.target?.structureId===c.structureId)??[];for(let g of m){let v=g?.source?.structureId,{structure:b}=di({structureId:v,drawDefinition:s}),y=b?.finishingPosition===oS&&(p?.length!==1||f?.length!==1),I={};if(y){let{matchUps:T}=dr({drawDefinition:s,structure:c,event:d}),{initialRoundNumber:D}=ow({drawPosition:o,matchUps:T}),C=s.links?.find(E=>E.target?.structureId===c?.structureId&&E.target.roundNumber===D)?.source?.roundNumber;I.roundNumbers=[C]}let{completedMatchUps:w}=d$({structureId:v,inContext:!0,matchUpFilters:I,drawDefinition:s}),S=a.map(T=>T.participantId).filter(Boolean);w?.filter(({matchUpType:T,winningSide:D})=>D&&(d?.eventType!==da||T===da)).map(({winningSide:T,sides:D})=>T&&D?.[1-(T-1)]).map(qi).filter(T=>T&&!S.includes(T))?.forEach(T=>{h.includes(T)||h.push(T)})}let A=t?.filter(g=>h?.includes(g.participantId));return A?.forEach(g=>{let v=(s.entries??[]).find(b=>b.participantId===g.participantId);g.entryPosition=v?.entryPosition}),h?.length?{validLuckyLosersAction:{type:M7,method:LXe,availableLuckyLosers:A,availableLuckyLoserParticipantIds:h,willDisableLinks:i,payload:{drawId:u,structureId:l,drawPosition:o}}}:{}}function zZe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:c,seedingProfile:u,isByePosition:d,drawPosition:p,structureId:f,event:h}){let{drawId:m}=c,A=[],g,v,b=[],y=l?.[Ku]?.validSeedPositions?.ignore;if(y||({unplacedSeedParticipantIds:g,unplacedSeedAssignments:v,unfilledPositions:b}=jTe({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:c,seedingProfile:u,structureId:f})),b?.length||(b=s.filter(I=>!I.participantId&&!I.bye&&!I.qualifier).map(I=>I.drawPosition)),d||A.push({payload:{drawId:m,structureId:f,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:QXe,type:"BYE"}),a&&y){let I=s.map(C=>C.participantId).filter(Boolean),w={structureIds:t},{completedMatchUps:S}=SE({inContext:!0,matchUpFilters:w,drawDefinition:c}),T=Ei((S??[]).filter(({matchUpType:C})=>h?.eventType!==da||C===da)?.map(({sides:C})=>C?.map(qi)).flat().filter(C=>C&&!I.includes(C))),D=o?n?.filter(C=>T?.includes(C.participantId)).map(C=>Dt(C,void 0,!0)):void 0;return D?.forEach(C=>{let E=(c.entries??[]).find(P=>P.participantId===C.participantId);C.entryPosition=E?.entryPosition}),D?.length&&A.push(Lt({payload:{drawId:m,structureId:f,drawPosition:p},willDisableLinks:i,method:vie,type:cw,availableParticipantIds:T,participantsAvailable:D})),{validAssignmentActions:A}}if(b.includes(p)||d){let I;if(v?.length){let S=v.filter(T=>g?.includes(T.participantId));S.sort(qZe),I=S.map(T=>T.participantId)}else I=e;let w=o?n?.filter(S=>I.includes(S.participantId)).map(S=>Dt(S,void 0,!0)):void 0;w?.length&&A.push(Lt({payload:{drawId:m,structureId:f,drawPosition:p},willDisableLinks:i,method:vie,type:cw,availableParticipantIds:I,participantsAvailable:w}))}return{validAssignmentActions:A}}function qZe(t,e){return t.bye||tC(t.seedValue)<tC(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function WZe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:s,structureId:o,drawId:l}){let c=[],u=[],d=[],p=[],f=i.map(I=>I.participantId).filter(Boolean),h=n?.[Bh],m=!h?.disableRoundRestrictions&&t[s],A=h?.requireCompletedStructures,{sourceStructureIds:g,relevantLinks:v}=ZP({targetRoundNumber:m,linkType:Ph,drawDefinition:a,structureId:o})||{};g?.length&&p.push(...g);let{sourceStructureIds:b,relevantLinks:y}=ZP({targetRoundNumber:m,linkType:Dh,drawDefinition:a,structureId:o})||{};b?.length&&p.push(...b);for(let I of v){let w=a.structures?.find(T=>T.structureId===I.source.structureId);if(w?.stage!==qt)continue;let S=_h({structureId:I.source.structureId,drawDefinition:a});if(!A||S){let T=w.qualifyingRoundNumber,{matchUps:D}=dr({matchUpFilters:{roundNumbers:[T],isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:w});for(let C of D){let E=C.sides.find(R=>R?.sideNumber===C.winningSide),P=C.matchUpStatus==="BYE"&&C.sides?.find(({participantId:R})=>R);if(E||P){let{participantId:R,participant:M}=E||P||{};R&&!f.includes(R)&&(M&&r&&c.push(M),u.push(R))}}}}for(let I of y){let w=a.structures?.find(T=>T.structureId===I.source.structureId);if(w?.stage!==qt)continue;let S=_h({structureId:I.source.structureId,drawDefinition:a});if(!A||S){let{positionAssignments:T}=wr({structure:w}),D=T?.map(C=>{let E=C.participantId,P=ki({element:C,name:Km}).extension?.value;return P?{participantId:E,groupOrder:P?.groupOrder}:{}}).filter(({groupOrder:C,participantId:E})=>C===1&&!f.includes(E)).map(({participantId:C})=>C)??[];if(D&&u.push(...D),r){let C=e.filter(({participantId:E})=>D.includes(E));c.push(...C)}}}return u.length&&d.push(Lt({qualifyingParticipants:r?c:void 0,method:_Xe,type:v$,qualifyingParticipantIds:u,payload:{qualifyingParticipantId:void 0,drawPosition:s,structureId:o,drawId:l}})),{validAssignmentActions:d,sourceStructureIds:p}}function KZe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:s,byeDrawPositions:o,drawDefinition:l,isByePosition:c,drawPosition:u,structureId:d,structure:p,drawId:f,event:h}){if(n.includes(u))return{};let m=C=>!t||C.participantId||C.qualifier||C.bye,A=r?.filter(C=>C!==u&&!(c&&o.includes(C))),g=a?.filter(C=>m(C)&&A?.includes(C.drawPosition))??[],v=g.map(({drawPosition:C})=>C),{matchUps:b}=dr({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:h}),y=b.filter(({drawPositions:C})=>_o(C,v)),I=Object.assign({},...y.map(C=>C.sides?.filter(({sourceDrawPositionRange:E})=>E).map(({drawPosition:E,sourceDrawPositionRange:P})=>({[E]:P}))).flat()),w=g.map(C=>C.participantId).filter(Boolean),S=(i??[]).filter(C=>w.includes(C.participantId)),T=Object.assign({},...S.map(C=>({[C.participantId]:C}))),D=g.map(C=>{let E=T?.[C.participantId],P=I[C.drawPosition];return Lt({...C,participant:s?Dt(E,!1,!0):void 0,sourceDrawPositionRange:P})});return D.length?{validSwapAction:{payload:{drawId:f,structureId:d,drawPositions:[u]},willDisableLinks:e,method:vCe,type:y$,availableAssignments:D}}:{}}function Y7(t){let e=Qt(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:r=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:s,drawPosition:o,event:l}=t,c=t.tournamentParticipants??(a&&vn({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],u=di({structureId:t.structureId,drawDefinition:s});if(u.error)return u;let d=u.containingStructure||u.structure;if(!d)return{error:an};let p=d.structureId;if(u=UE({drawDefinition:s,structureId:p}),o===void 0&&!u.isAdHoc)return{error:cE};if(u.isAdHoc)return C$(t);if(u.error)return u;let{drawPositionInitialRounds:f,inactiveDrawPositions:h,activeDrawPositions:m,byeDrawPositions:A}=u,g=tr({tournamentRecord:a,drawDefinition:s,structure:d,event:l}).appliedPolicies??{};Object.assign(g,i??{});let{actionsPolicy:v,enabledStructures:b,actionsDisabled:y}=uEe({actionType:Yk,appliedPolicies:g,drawDefinition:s,structure:d}),I=v?.activePositionOverrides||[],{sourceStructureIds:w}=ZP({finishingPosition:Fy,targetRoundNumber:1,linkType:Dh,drawDefinition:s,structureId:p})||{},S;w?.length&&(S=w.every(X=>_h({structureId:X,drawDefinition:s})));let T=w.length,D=w.length&&!S,{policyActions:C}=dEe({enabledStructures:b,drawDefinition:s,structure:d}),E=![qt,Et].includes(d.stage)||d.stageSequence!==1,{drawId:P}=s,R=[],{assignedPositions:M,positionAssignments:N}=Ia({structure:d}),k=M?.find(X=>X.drawPosition===o),O=!!k;if(!N?.map(X=>X.drawPosition)?.includes(o))return{error:Zw};let{stage:x,stageSequence:F}=d,_=[x];x===Ls&&_.push(Et),x===Et&&_.push(Ls);let V=uS({entryStatuses:Ub,provisionalPositioning:n,drawDefinition:s,stageSequence:F,structureId:p,stages:_}),G=Cb({drawDefinition:s,stages:_}).assignedParticipantIds??[],z=V.filter(X=>!G.includes(X.participantId)).map(X=>X.participantId),Q=A.includes(o),j=m.includes(o);if(y)return{info:"Actions Disabled for structure",isActiveDrawPosition:j,isDrawPosition:!0,hasPositionAssigned:O,validActions:[],isByePosition:Q};if(ul({policyActions:C,action:cw})&&!j&&N&&!D&&(!k||Q)){let{validAssignmentActions:X}=zZe({positionSourceStructureIds:w,unassignedParticipantIds:z,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:c,positionAssignments:N,returnParticipants:r,appliedPolicies:g,drawDefinition:s,isByePosition:Q,drawPosition:o,structureId:p,event:l});X?.forEach(J=>R.push(J))}if(ul({policyActions:C,action:v$})&&!j){let{validAssignmentActions:X}=WZe({drawPositionInitialRounds:f,tournamentParticipants:c,positionAssignments:N,returnParticipants:r,appliedPolicies:g,drawDefinition:s,drawPosition:o,structureId:p,drawId:P});X?.forEach(J=>R.push(J))}let{participantId:W}=k||{},Y=W&&c.find(X=>X.participantId===W);if(k){ul({policyActions:C,action:Y4})&&!j&&(R.push({type:Y4,method:gie,payload:{drawId:P,structureId:p,drawPosition:o},willDisableLinks:E}),Q||R.push({type:R7,method:OXe,payload:{drawId:P,structureId:p,drawPosition:o},willDisableLinks:E}),ul({policyActions:C,action:"BYE"})&&!Q&&R.push({type:"BYE",method:gie,payload:{drawId:P,structureId:p,drawPosition:o,replaceWithBye:!0},willDisableLinks:E}));let X=d.stage===qt||d.stage===Et&&d.stageSequence===1;if(!Q&&Cie({activePositionOverrides:I,activeDrawPositions:m,action:RI})&&ul({policyActions:C,action:RI})&&L_({drawDefinition:s,structureId:p,drawPosition:o})&&X){let{seedAssignments:J}=Au({returnAllProxies:!0,drawDefinition:s,structure:d}),{seedNumber:ie,seedValue:ue}=J?.find(ne=>ne.participantId===W)??{};R.push({type:RI,method:jXe,participant:Y,seedNumber:ie,payload:{drawId:P,structureId:p,participantId:W,seedValue:ue}})}if(!Q&&Cie({activePositionOverrides:I,activeDrawPositions:m,action:v0})&&ul({policyActions:C,action:v0})&&L_({drawDefinition:s,structureId:p,drawPosition:o})&&X){let{seedAssignments:J}=Au({returnAllProxies:!0,drawDefinition:s,structure:d}),{seedNumber:ie}=J?.find(ue=>ue.participantId===W)??{};R.push({method:GXe,type:v0,participant:Y,seedNumber:ie,payload:{participantId:W,structureId:p,drawId:P}})}if(!Q&&W){if(ul({policyActions:C,action:uw})){let J={type:uw,method:yCe,participant:Y,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:P}};R.push(J)}if(ul({policyActions:C,action:JP})){let J={type:JP,method:VXe,participant:Y,payload:{participantId:W,otherName:void 0}};R.push(J)}}if(ul({policyActions:C,action:y$})){let{validSwapAction:J}=KZe({possiblyDisablingAction:E,tournamentParticipants:c,inactiveDrawPositions:h,activeDrawPositions:m,positionAssignments:N,returnParticipants:r,byeDrawPositions:A,drawDefinition:s,isByePosition:Q,drawPosition:o,structureId:p,structure:d,drawId:P});J&&R.push(J)}}if(ul({policyActions:C,action:P7})&&!D){let{validAlternatesAction:X}=VZe({possiblyDisablingAction:E,tournamentParticipants:c,positionAssignments:N,activeDrawPositions:m,returnParticipants:r,appliedPolicies:g,drawDefinition:s,drawPosition:o,validActions:R,structureId:p,structure:d,drawId:P,event:l});X&&R.push(X)}if(ul({policyActions:C,action:M7})&&!D&&!j&&N){let{validLuckyLosersAction:X}=jZe({sourceStructuresComplete:S,possiblyDisablingAction:E,isWinRatioFedStructure:T,tournamentParticipants:c,activeDrawPositions:m,positionAssignments:N,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:P});X&&R.push(X)}if(Y?.participantType===Ni&&ul({policyActions:C,action:D7})){let{validModifyAssignedPairAction:X}=OZe({tournamentParticipants:c,returnParticipants:r,drawPosition:o,participant:Y,drawId:P,event:l});X&&R.push(X)}return{isActiveDrawPosition:j,isDrawPosition:!0,hasPositionAssigned:O,isByePosition:Q,validActions:R,...oe}}function rN({policyDefinitions:t,appliedPolicies:e,drawType:i}){let r=t?.[R_]?.drawTypeCoercion,n=e?.[R_]?.drawTypeCoercion;return(typeof r=="boolean"?r:void 0)??(i&&r?.[i])??(typeof n=="boolean"?n:void 0)??(i&&n?.[i])??!0}var X7=({drawDefinition:t})=>{let e=Qt({drawDefinition:t},[{[ro]:!0}]);if(e.error)return e;let i=t.structures?.find(n=>n.stage===Et&&n.stageSequence===1);if(!i)return ce({result:{error:D8}});let{qualifierPositions:r}=Ia({structure:i});return vt(0,r.length).sort(()=>Math.random()-.5)};function Z7({structureId:t,drawDefinition:e}){if(!e)return{error:kt};if(!rn(t))return{error:we};let i=wE({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!Mn([Oy,Ju,L2,_y],r).length;return{...oe,valid:n}}function e1({tournamentRecord:t,drawDefinition:e,stage:i=Et,structureId:r,structure:n}){if(!t)return{error:nt};if(!n&&!e)return{error:kt};if(!n&&!r&&e?.structures?.filter(o=>o.stage===i).length===1&&(n=e.structures.find(o=>o.stage===i)),!n&&!r)return{error:Fc};let{error:a,positionAssignments:s}=wr({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:s??[],structureId:n?.structureId,error:a}}function bEe({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:we};let i=lE(t);return i?{drawSize:i}:ce({result:{error:we},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function nN(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:s,event:o}=t||{},l="getSeedsCount",c=t?.participantsCount??t?.participantCount;if(!i){let h=yA({tournamentRecord:a,drawDefinition:s,event:o});if(h.error)return ce({result:h,stack:l});i=h.policyDefinitions}let u=wi(c);if(c&&!u)return ce({result:{error:we},context:{participantsCount:c},stack:l});if(n&&!u)return ce({result:{error:Dwe},stack:l});if(Number.isNaN(Number(r)))if(c)({drawSize:r}=bEe({participantsCount:c}));else return ce({result:{error:oM},stack:l});let d=n&&c||r;if(d&&d>r)return{error:O8};let p=i?.[Ku];if(!p)return{error:hwe};let f=p.seedsCountThresholds;return f?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:f.filter(h=>e?h.drawSize<=r:r===h.drawSize).reduce((h,m)=>c&&c>=m.minimumParticipantCount?m.seedsCount:h,0)}):{error:ZIe}}function E$({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:s,event:o}){if((!s||!n)&&i&&({participants:s,participantMap:n}=vn({tournamentRecord:i})),!s)return{error:uM};if(!Array.isArray(s))return{error:we};if(!o)return{error:Gr};let l=e?.[Ja]??r?.[Ja]??CE[Ja],c=(a??l?.participants?.enforceGender)!==!1,{eventType:u,gender:d}=o,p=u===jm,f=u===Jl&&vr||p&&Ni||Wi,h=Object.assign({},...(t??o.entries??[]).map(g=>({[g.participantId]:g.entryStatus}))),m=Object.keys(h),A=s.filter(g=>m.includes(g.participantId)).filter(g=>{let v=YZe({participant:g,participantType:f,eventType:u,entryStatusMap:h}),b=XZe({genderEnforced:c,participantMap:n,eventGender:d,participant:g,isDoubles:p,mismatch:v});return v||!b});if(A.length){let g=A.map(v=>v.participantId);return{error:owe,invalidParticipantIds:g}}return{...oe,valid:!0}}function YZe({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[jm,Jl].includes(i)&&t.participantType===Wi&&(zv(n)||n===kh);return t.participantType!==e&&!a}function XZe(t){let{participant:e,participantMap:i,eventGender:r,mismatch:n,isDoubles:a,genderEnforced:s}=t,o=!n&&a&&Ei(e?.individualParticipantIds?.map(d=>i?.[d]?.participant?.person?.sex).filter(Boolean)??[])||[],l=!r||!o?.length||Ch(r)||ff(r)&&Ks(o[0])===Ks(r)||Tc(r)&&(o.length===1&&e.individualParticipantIds?.length===1||o.length===2),c=e?.person?.sex,u=!e?.person||!r||Tc(r)||Ch(r)||ff(r)&&Ks(c)===Ks(r);return!s||l&&u}function IEe({hasExistingDrawDefinition:t,qualifyingProfiles:e,appliedPolicies:i,qualifyingOnly:r,tieFormat:n,idPrefix:a,isMock:s,uuids:o}){let l="generateQualifyingSTructures",c=[],u=[],d=[],p=(v,b)=>v.stageSequence-b.stageSequence,f=(v,b)=>v.roundTarget-b.roundTarget,h=0,m=0,A,g=1;for(let v of e.sort(f)){let b=v.structureProfiles||[];g=v.roundTarget||g;let y=1,I=0,w,S,T;for(let D of(b||[]).sort(p)){let C=b8(D.drawSize||D.participantsCount),{qualifyingRoundNumber:E,structureOptions:P,matchUpFormat:R,structureName:M,structureId:N,drawType:k}=D,O=D.matchUpType,x=D.qualifyingPositions||ZZe({drawSize:C,qualifyingRoundNumber:E}),F,_,V;if(!wi(C))return ce({result:{error:oM},stack:l});let G=e.length>1?`${g}-`:"",z=b.length>1||G?y:"",Q=M||(G||z?`${_s(qt)} ${G}${z}`:_s(qt));if(k===Sd){let{structures:j,groupCount:W,maxRoundNumber:Y}=jM({structureName:D.structureName||Q,structureId:N||o?.pop(),hasExistingDrawDefinition:t,stage:qt,structureOptions:P,appliedPolicies:i,qualifyingOnly:r,stageSequence:y,matchUpType:O,roundTarget:g,tieFormat:n,drawSize:C,idPrefix:a,isMock:s,uuids:o});I=W,F=Y,_=j[0],A=[1]}else({drawSize:C,matchUps:V,roundLimit:F}=yf({qualifyingRoundNumber:E,qualifyingPositions:x,matchUpType:O,drawSize:C,idPrefix:a,isMock:s,uuids:o})),_=nu({structureName:D.structureName||Q,structureId:N||o?.pop(),qualifyingRoundNumber:F,hasExistingDrawDefinition:t,stage:qt,qualifyingOnly:r,matchUpFormat:R,stageSequence:y,matchUpType:O,roundLimit:F,tieFormat:n,matchUps:V}),g&&ur({extension:{name:Mf,value:g},element:_}),I=V?.filter(j=>j.roundNumber===F)?.length||0;if(y>1){let{link:j}=KM({sourceStructureId:S,sourceRoundNumber:w,targetStructureId:_.structureId,finishingPositions:T===Dh?[1]:void 0,linkType:T});d.push(j),h+=(C||0)-I}else h+=C||0;T=k===Sd?Dh:Ph,S=_.structureId,w=F,n&&(V=dr({structure:_})?.matchUps||[],V?.forEach(j=>{let{tieMatchUps:W}=IS({tieFormat:n,matchUp:j,isMock:s});Object.assign(j,{tieMatchUps:W,matchUpType:O})})),u.push(_),y+=1}m+=I,c.push({qualifiersCount:I,finalQualifyingRoundNumber:w,finalQualifyingStructureId:S,finishingPositions:A,roundTarget:g,linkType:T}),g+=1}return{qualifiersCount:m,qualifyingDrawPositionsCount:h,qualifyingDetails:c,structures:u,...oe,links:d}}function ZZe({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function wEe(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=ci(t.drawSize),n=e&&t.drawType!==ec&&(typeof e=="boolean"||e<=2)&&r===2&&Kp||t.drawType||Kp,a=uUe.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=Kp;else if(r<4&&i)return{...ce({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:v2},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function JZe(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:_s(Et),...t,stage:Et},{structures:a,groupCount:s}=jM(n);if(s<1)return{error:zwe};let o=i?.playoffGroups||[{finishingPositions:[1],structureName:_s(Dn)}],[l]=a,{structures:c,links:u}=RCe({sourceStructureId:l.structureId,requireSequential:r,drawDefinition:e,playoffGroups:o,groupCount:s,...t});return c&&a.push(...c),{...oe,structures:a,links:u}}function eJe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),n=t.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),a=e.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),s=r.map((c,u)=>{let d=r.indexOf(c)%2?Ju:Oy,p=1+u;return{linkType:Rh,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:c,structureId:e.structureId}}}),o={linkType:Ph,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Ju,roundNumber:n,structureId:t.structureId}},l=[{linkType:Ph,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Ju,roundNumber:1,structureId:i.structureId}},{linkType:Rh,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Ju,roundNumber:1,structureId:i.structureId}}];return[...s,o,...l]}function tJe({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let s=[],{matchUps:o}=Dg({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=lg({structureName:t||_s(Et),structureId:a?.pop(),stageSequence:1,stage:Et,matchUpType:e,matchUps:o});s.push(l);let c=r/2,{matchUps:u}=Dg({finishingPositionOffset:c,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=lg({structureName:_s(cUe),matchUps:u,structureId:a?.pop(),stage:Ls,stageSequence:2,matchUpType:e});s.push(d);let{matchUps:p}=yf({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),f=lg({structureName:_s(lUe),matchUps:p,structureId:a?.pop(),stageSequence:3,stage:Dn,matchUpType:e});s.push(f);let h=eJe({mainStructure:l,consolationStructure:d,deciderStructure:f});return{structures:s,links:h,...oe}}function iJe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:s,isMock:o,uuids:l}=t;if(!wi(s)||s<2)return{matchUps:[],roundsCount:0};if(op(s))return yf(t);let c=rJe(s),u=c.shift(),d=vt(1,(u?.participantsCount||0)+1).map(A=>({drawPosition:A})),p=[],f=1;({matchUps:p}=H_({roundNumber:f,matchUpType:n,idPrefix:a,matchUps:p,isMock:o,nodes:d,uuids:l})),f++;let h=t.roundLimit||e;for(let A of c){let g=A.participantsCount/2,v=vt(1,g+1);r&&g===r&&(h=f-1);let b=v.map(y=>{let I=N7({roundPosition:y,roundNumber:f,idPrefix:a,uuids:l});return{roundPosition:y,roundNumber:f,matchUpId:I}});p.push(...b),f++}let m=f-1;return p=LM({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:h,matchUps:p}),h&&(p=p.filter(A=>A.roundNumber<=h)),{matchUps:p,roundsCount:m,roundLimit:h}}function rJe(t){let e=ci(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),s=a===1,o=!!(!s&&a%2);i=!s&&o?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:o})}return n}function SEe(t){let{playoffAttributes:e,stageSequence:i=1,stage:r=Et,tieFormat:n,matchUpType:a,drawSize:s,uuids:o}=t,l=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,c=t.structureId||l()||o?.pop(),u=t.appliedPolicies??tr(t),d=t.policyDefinitions?.[XT]||u?.[XT];t.skipRounds=t.skipRounds||s<=4&&(d?.feedFromMainFinal?0:1)||0;let p=t.structureName??e?.["0"]?.name??_s(Et),f=()=>{let{matchUps:h}=yf(t);return{structures:[nu({stageSequence:i,structureName:p,matchUpType:a,structureId:c,tieFormat:n,matchUps:h,stage:r})],links:[],...oe}};return{generators:{[ec]:()=>({structures:[nu({finishingPosition:Fy,stageSequence:i,structureName:p,matchUps:[],matchUpType:a,structureId:c,stage:r})],links:[],...oe}),[yb]:()=>{let{matchUps:h}=iJe(t);return{structures:[nu({stageSequence:i,structureName:p,matchUpType:a,structureId:c,matchUps:h,stage:r})],links:[],...oe}},[Kp]:()=>f(),[gM]:()=>tJe(t),[qT]:()=>tT({...t,roundOffsetLimit:3,playoffAttributes:e??uY}),[WT]:()=>tT({...t,roundOffsetLimit:2,playoffAttributes:e??dY}),[Dn]:()=>tT(t),[mE]:()=>{let{matchUps:h}=Dg({drawSize:s,uuids:o,matchUpType:a});return{structures:[nu({stageSequence:i,structureName:p,matchUpType:a,structureId:c,stage:Et,tieFormat:n,matchUps:h})],links:[],...oe}},[vM]:()=>ECe(t),[KT]:()=>Zb({...t,feedRounds:1,fmlc:!0}),[oUe]:()=>Zb({...t,feedRounds:1}),[oY]:()=>Zb({...t,feedsFromFinal:1}),[lY]:()=>Zb({...t,feedsFromFinal:2}),[cY]:()=>Zb({...t,feedsFromFinal:3}),[yM]:()=>Zb(t),[$2]:()=>PCe(t),[Sd]:()=>jM(t),[Mh]:()=>JZe(t)}}}function J7(t){let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:r,qualifyingOnly:n,staggeredEntry:a,drawDefinition:s,tieFormat:o,isMock:l,uuids:c}=t||{},u=ci(t.drawSize),d=t.drawTypeCoercion??rN({appliedPolicies:r,drawType:t.drawType}),p="generateDrawStructuresAndLinks",f=wEe({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:d,drawSize:u});if(f.error)return f;let h=f.drawType,m=[],A=[],g=t?.matchUpType??Dr,v=s?.structures?.filter(({stage:z})=>z===qt);v&&m.push(...v);let b=v?.map(({structureId:z})=>z),y=s?.structures?.find(({stage:z,stageSequence:Q})=>z===Et&&Q===1),I=s?.links?.filter(z=>z.target.structureId===y?.structureId&&b?.includes(z.source.structureId)),w=(z,Q)=>{if(z.linkType===Dh&&Q?.structures){let j=z.source.finishingPositions||[];return Q.structures.length*j.length}else if(z.linkType===Ph&&Q?.matchUps?.length){let j=z.source.roundNumber;return Q.matchUps.filter(({roundNumber:W})=>W===j).length}},S=v?.map(z=>{let Q=I?.find(J=>J.target.structureId===z.structureId),j=wr({structure:z})?.positionAssignments?.length??0;if(!Q)return j;let W=Q?.source.structureId,Y=s.structures?.find(J=>J.structureId===W),X=w(Q,Y)||0;return j-X}).filter(Boolean).reduce((z,Q)=>z+Q,0),T=I?.map(z=>{let Q=z.source.structureId,j=v?.find(W=>W.structureId===Q);return w(z,j)}).filter(Boolean).reduce((z,Q)=>z+Q,0),D=!!(y&&!y?.matchUps?.length);if(v?.length&&!D)return{error:P4};let C=!v?.length&&t.qualifyingProfiles,E=C?.length&&IEe({idPrefix:t.idPrefix,qualifyingProfiles:C,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,isMock:l,uuids:c});if(E?.error)return E;let{qualifyingDrawPositionsCount:P,qualifyingDetails:R,qualifiersCount:M}=E||{qualifyingDrawPositionsCount:S,qualifiersCount:T};P&&(E?.structures&&m.push(...E.structures),E?.links&&A.push(...E.links)),Object.assign(t,Lt({drawSize:u,matchUpType:g,tieFormat:o}));let N=h!==ec&&(!u||u<2||!a&&![mE,yb].includes(h)&&([Mh,Sd].includes(h)&&u<3||![Sd,Mh].includes(h)&&!op(u)));if(N&&!P)return ce({context:{drawSize:u,invalidDrawSize:N},result:{error:v2},stack:p});let{generators:k,error:O}=SEe(t);if(O)return{error:O};let x=k[h];if(!x)return{error:U8};let F=x?.();if(F.error)return F;let{structures:_,links:V}=F;if(_?.length){let z=_.find(({stage:Q,stageSequence:j})=>Q===Et&&j===1);if(y&&z){if(D){let Q=z.structureId;if(z.structureId=y.structureId,V?.length)for(let j of V)j.source.structureId===Q&&(j.source.structureId=y.structureId),j.target.structureId===Q&&(j.target.structureId=y.structureId)}else if(!i)return{error:P4}}m.push(..._)}m.sort(cS),V?.length&&A.push(...V);let G=F.structures.find(({stage:z,stageSequence:Q})=>z===Et&&Q===1);for(let z of R||[]){let{finalQualifyingRoundNumber:Q,finalQualifyingStructureId:j,roundTarget:W,finishingPositions:Y,linkType:X}=z,J=G&&KM({targetStructureId:G.structureId,sourceStructureId:j,sourceRoundNumber:Q,finishingPositions:Y,targetEntryRound:W,linkType:X})?.link;if(J?.error)return J;J&&A.push(J)}return I&&A.push(...I),{...oe,qualifyingResult:{qualifyingDrawPositionsCount:P,qualifiersCount:M},structures:m,links:A}}function e9(t){let{modifyOriginal:e=!0,stageSequence:i=1,isMock:r}=t||{},n="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return ce({result:{error:kt},stack:n});let a=e?t.drawDefinition:Dt(t.drawDefinition,!1,!0),{tieFormat:s,matchUpType:o}=t;if(s){let b=Jo({tieFormat:s});if(b.error)return b}s=Us(s??po({drawDefinition:a})?.tieFormat),o=o??(a.matchUpType||Dr),t.tieFormat=s,t.matchUpType=o;let l=F_({drawDefinition:a,stage:Et});t.drawSize=t.drawSize??l,!l&&t.drawSize&&$_({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:Et});let c=os({drawDefinition:a}).drawMatchUps.map(_a),u=J7(t);if(u.error)return ce({result:u,stack:n});let{structures:d,links:p,qualifyingResult:f}=u;a.structures=d,a.links=p;let h=Math.max(t.qualifiersCount??0,f?.qualifiersCount||0);if(f?.qualifyingDrawPositionsCount&&!F_({stage:qt,drawDefinition:a})){let b=$_({drawSize:f.qualifyingDrawPositionsCount,stage:qt,drawDefinition:a});if(b.error)return b}if(h){let b=mCe({qualifiersCount:h,drawDefinition:a,stage:Et});if(b.error)return b}let m=t.drawSize??l;Object.assign(t,Lt({drawSize:m,matchUpType:o,tieFormat:s}));let{matchUps:A,matchUpsMap:g}=ia({drawDefinition:a});s&&A?.forEach(b=>{if(!c.includes(b.matchUpId)){let{tieMatchUps:y}=IS({tieFormat:s,matchUp:b,isMock:r});Object.assign(b,{tieMatchUps:y,matchUpType:o})}});let{inContextDrawMatchUps:v}=Vy({drawDefinition:a,matchUpsMap:g});return kr({tournamentId:t.tournamentRecord?.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:v,drawDefinition:a,matchUpsMap:g,...oe,structures:d,matchUps:A,links:p}}function aN(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,s;if(!TEe({scaleItem:n}))return{error:tw};if(r&&Array.isArray(i.participants)&&(s=i.participants.find(o=>o.participantId===r),s)){if(s.participantType===qo&&n?.eventType!==Jl)return{error:tw};let o=CEe({removePriorValues:e,participant:s,scaleItem:n});if(o.error)return o;a=!o.valueChanged;let{topics:l}=Tu();l.includes($s)&&Ii({topic:$s,payload:{tournamentId:i.tournamentId,participants:[s]}})}return a&&{...oe,info:z8,existingValue:n?.scaleValue}||s&&{...oe,newValue:n?.scaleValue}||{error:Fn}}function UEe(t){let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:r,auditData:n,context:a}=t;if(!r)return{error:nt};if(!r.participants)return{error:uM};let s=0,o={},l=[];for(let d of e){let p=d?.participantId;if(Array.isArray(d?.scaleItems))for(let f of d.scaleItems)if(TEe({scaleItem:f}))Array.isArray(o[p])||(o[p]=[]),o[p].push(f);else return{error:tw}}for(let d of r.participants){let{participantId:p}=d||{};if(Array.isArray(o[p]))for(let f of o[p]){if(d.participantType===qo&&f?.eventType!==Jl)return ce({context:{participantId:p,scaleItem:f,participantType:d.participantType},info:"Invalid participantType for eventType",result:{error:tw}});CEe({participant:d,scaleItem:f,removePriorValues:i}),l.push(d),s++}}let c=s?void 0:fE,{topics:u}=Tu();if(u.includes($s)&&s&&Ii({topic:$s,payload:{tournamentId:r.tournamentId,participants:l}}),a){let{eventId:d,drawId:p,...f}=a,h=f.scaleAttributes?.scaleType&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){let m={itemType:RY,itemValue:f};if(h&&(m.itemSubTypes=h),p||d){let{drawDefinition:A,event:g}=tl({tournamentRecord:r,eventId:d,drawId:p});p&&E7({drawDefinition:A,timeItem:m}),d&&wS({event:g,timeItem:m})}else tN({tournamentRecord:r,timeItem:m})}}return n&&u.includes(Um)&&Ii({topic:Um,payload:n}),Lt({...oe,modificationsApplied:s,info:c})}function TEe({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e?.includes(r)).length===i.length}function CEe({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:iS};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(c=>r.includes(c)&&i[c]).length!==n.length)return{error:tw};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:s}=lh({scaleAttributes:i,participant:e}),o=c=>[void 0,null,""].includes(c),l=!(o(s?.scaleValue)&&o(i.scaleValue))&&JSON.stringify(s?.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:c,eventType:u,scaleName:d}=i,p=[Ly,c,u,d].join("."),f=Lt({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(f.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(h=>h.itemType!==p)),e.timeItems.push(f)}return{...oe,valueChanged:l,newValue:i.scaleValue}}function t9(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=Qt(t,[{[Ua]:!0},{modifiedScaleValues:!0,[rl]:fl}]);if(n.error)return n;for(let a in i){let s=aN({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(s.error)return s}return{...oe}}var nJe=(t=0)=>250/Math.pow(t+5,.4),aJe=()=>1;function sJe(t=3,e=2){let i=t/e;return Number.isNaN(i)?wU.kDefault():i}var wU={nSpread:400,diffThreshold:.125,kCalc:nJe,kMultiplier:sJe,kDefault:aJe};function EEe(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=qa,winnerCountables:n=1,loserCountables:a=0,ratingType:s="ELO",maxCountables:o,countables:l}=t||{},c=r?.[s];if(!c)return{error:Yt};let u=c.range||t.ratingRange;e=e||c.defaultInitialization,i=i||c.defaultInitialization;let d=u[0]>u[1],p=c.decimalsCount||0,f=d?u.slice().reverse():u,h=(k,O)=>Number.parseFloat(O)>=Math.min(...k)&&Number.parseFloat(O)<=Math.max(...k);(!h(u,e)||!h(u,i))&&(h(u,e)||(e=c.defaultInitialization),h(u,i)||(i=c.defaultInitialization));let m=LU({targetRange:qa.ELO.range,sourceRange:f,value:d?u[0]-e:e}),A=LU({targetRange:qa.ELO.range,sourceRange:f,value:d?u[0]-i:i}),g=(k,O)=>1/(1+Math.pow(10,(O-k)/wU.nSpread)),v=g(m,A),b=g(A,m),y=wU.kCalc(n),I=wU.kCalc(a),w=wU.kMultiplier(o,l),S=m+w*y*(1-v),T=A+w*I*(0-b),D=LU({sourceRange:qa.ELO.range,value:S,targetRange:f}),C=LU({sourceRange:qa.ELO.range,value:T,targetRange:f}),E=d?u[0]-D:D,P=Number.parseFloat(E.toFixed(p)),R=d?u[0]-C:C,M=Number.parseFloat(R.toFixed(p)),N=Math.max(...u)?Math.abs(e-i)/Math.max(...u):0;return(D>C&&N>wU.diffThreshold||P<0||M<0)&&(P=e,M=i),{newWinnerRating:P,newLoserRating:M}}var oJe=t=>t?.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0])||[0,0];function DEe(t){let e=Qt(t,[{[Ua]:!0},{matchUpIds:!0,[rl]:qs,[cd]:Jw},{ratingType:!1,[Ps]:v=>qa[v]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:r=!0,tournamentRecord:n,ratingType:a="ELO",refreshDynamic:s,considerGames:o,drawDefinition:l,matchUpIds:c,asDynamic:u}=t,d=qa[a],{accessor:p}=d,f={},h=(t.matchUps||s&&No({drawDefinition:l,tournamentRecord:n,inContext:!0,matchUpFilters:{matchUpStatuses:ta}}).matchUps||as({matchUpFilters:{matchUpIds:c,matchUpStatuses:ta},tournamentRecord:n,inContext:!0}).matchUps)??[],m=`${a}.${bY}`,A=u?m:a;h.sort(AS);for(let v of h){let{endDate:b,matchUpFormat:y,score:I,sides:w,winningSide:S}=v,T=v.matchUpType,D={eventType:T,scaleName:a,scaleType:sg},C={scaleName:m,eventType:T,scaleType:sg},E=Object.assign({},...(w??[]).map(_=>{let{sideNumber:V,participant:G}=_;return V&&{[V]:[G?.participantId,...G?.individualParticipantIds??[]].filter(Boolean).flat()}})),P=Object.assign({},...Object.values(E).flat().map(_=>{let V=f[_],G=!s||V?lw({scaleAttributes:C,tournamentRecord:n,participantId:_}).scaleItem:void 0,z=lw({tournamentRecord:n,scaleAttributes:D,participantId:_}).scaleItem,Q=p?{[p]:void 0}:void 0;return _&&{[_]:G??z??{scaleName:A,eventType:T,scaleDate:b,scaleType:sg,scaleValue:Q}}})),R=y?ys(y):{},M=R?.bestOf||1,N=R?.setsTo||1,k=o?M&N:M,O=I?.sets&&oJe(I.sets)||S===1&&[1,0]||[0,1],x=S?E[S]:[],F=S?E[3-S]:[];for(let _ of x){let V=P[_]?.scaleValue,G=typeof V=="object"?V[p]:V;for(let z of F){let Q=P[z]?.scaleValue,j=typeof Q=="object"?Q[p]:Q,W=S?O[S]:[0,0],Y=S?O[3-S]:[0,0],{newWinnerRating:X,newLoserRating:J}=EEe({winnerCountables:W,loserCountables:Y,maxCountables:k,winnerRating:G,loserRating:j,ratingType:a}),ie=p?{...V,[p]:X}:X,ue=p?{...Q,[p]:J}:J;P[_].scaleValue=ie,P[z].scaleValue=ue,P[_].scaleName=A,P[z].scaleName=A}}Object.assign(f,P),i&&t9({tournamentRecord:n,modifiedScaleValues:f,removePriorValues:r})}let g=h.map(({matchUpId:v})=>v);return{...oe,modifiedScaleValues:f,outputScaleName:A,processedMatchUpIds:g}}function D$(t){let{matchUpIds:e=[],drawDefinition:i,roundNumber:r,newRound:n,isMock:a,event:s}=t;if(typeof i!="object")return{error:kt};let{participantIdPairings:o,matchUpsCount:l}=t,c=T$(t);if(c.error)return ce({result:c});let{lastRoundNumber:u,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=c;if(!l)n?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return ce({result:{error:we,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(o&&!Array.isArray(o)||l&&!wi(l)||e&&!Array.isArray(e)||!o&&!l)return{error:we,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:we,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(u||0))return{error:we,info:"roundNumber error"};let f=r??(n&&(u??0)+1||u||1);o=o??vt(0,l).map(()=>({participantIds:[void 0,void 0]}));let h=A=>{if(!t.idPrefix)return;let g=i.drawId,v=t.idPrefix??"ah";return`${g}-${v}-${f}-${A}`},m=o?.map((A,g)=>{let v=A?.participantIds??[void 0,void 0];v.push(void 0,void 0);let b=v.slice(0,2).map((I,w)=>Lt({sideNumber:w+1,participantId:I})),y=e[g]??h(g)??hr();return{roundNumber:f,matchUpStatus:Nn,matchUpId:y,sides:b}});if(m?.length){let A=po({drawDefinition:i,event:s})?.tieFormat;A&&m.forEach(g=>{let{tieMatchUps:v}=IS({tieFormat:A,matchUp:g,isMock:a});Object.assign(g,{tieMatchUps:v,matchUpType:Hr})})}return{roundNumber:f,matchUpsCount:m?.length??0,matchUps:m,...oe}}function lJe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(v=>({[v.pairing]:v.value}))),s=Object.keys(i),o=[],l=Die({actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),c=[JV(l)];o.push(l);let u=l.value,d=l,p=1,f=0,h=s.length,m;do h-=1,m=s.length*i[s[0]].length;while(m>t&&h>5);let A=[];s.forEach(v=>{i[v].slice(0,h).forEach(b=>{f+=1;let y=MI(v,b.opponent);if(!A.includes(y)){let I=Die({stipulated:[[v,b.opponent]],actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!c.includes(JV(I))){c.push(JV(I)),o.push(I);let{maxDelta:w,value:S}=I;w<d.maxDelta&&(d=I),(S<u||S===u&&Math.round(Math.random()))&&(u=S),A.push(y),p+=1}}}),o=o.filter(b=>Math.abs(b.value-u)<5)}),o.sort((v,b)=>v.maxDiff-b.maxDiff);let g=_l(o);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:f,candidate:g}}function JV(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function Die({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let s=e.flat(),o=[],l=0;e.filter(Boolean).forEach(d=>{let[p,f]=d,h=MI(p,f),m=i[h];o.push({participantIds:d,value:m}),l+=i[h]}),$a(t,a).flatMap(d=>Po(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((f,h)=>s.includes(h)||f,!1)){s.push(...p);let f=d.value;l+=f,o.push({participantIds:p,value:f})}}),o.sort((d,p)=>d.value-p.value);let c=o.reduce((d,p)=>{let[f,h]=p.participantIds,m=MI(f,h),A=r[m];return Math.max(A,d)},0),u=o.reduce((d,p)=>{let[f,h]=p.participantIds,m=MI(f,h),A=n[m];return Math.max(A,d)},0);return{value:l,participantIdPairings:o,maxDelta:c,maxDiff:u}}function MI(t,e){return[t,e].sort(p$).join("|")}function PEe({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let s=MI(a,n);i.includes(s)||i.push(s)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function cJe({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(qi);if(r.length===2){let[n,a]=r,s=MI(n,a);e.includes(s)||e.push(s)}}return{encounters:e}}function uJe({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(s=>r(n,s));i[n]=a.sort((s,o)=>s.value-o.value)}function r(n,a){let s=MI(n,a);return{opponent:a,value:e[s]}}return{pairingValues:i}}var dJe=0;function pJe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){let a=qa[r]?.defaultInitialization??dJe;return n.split("|").map(s=>{if(i===hu){let o=t?.find(l=>l.participantId===s)?.individualParticipantIds;return o?o?.map(l=>e[l]||a):a*2}else return e[s]||a})}function fJe(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:s,deltaObjects:o,valueObjects:l,eventType:c,scaleName:u,salted:d}=t;n.forEach(b=>{let y=pJe({tournamentParticipants:e,adHocRatings:i,scaleName:u,eventType:c,pairing:b}),I=typeof d=="number"&&d||.5,w=d&&(Math.round(Math.random())?I:I*-1)||0,S=Math.abs(y[0]-y[1])+w,T=Math.abs(y[0]-y[1]);o[b]=T,l[b]||(l[b]=0),l[b]+=S?Math.pow(S,2):0});let p=n.map(b=>({pairing:b,value:l[b]})).sort((b,y)=>b.value-y.value),{pairingValues:f}=uJe({possiblePairings:r,valueObjects:l}),{candidate:h,candidatesCount:m,deltaCandidate:A,iterations:g}=lJe({valueSortedPairings:p,maxIterations:a,pairingValues:f,deltaObjects:o,valueObjects:l}),{participantIdPairings:v}=s?A:h;return{participantIdPairings:v,candidatesCount:m,deltaCandidate:A,iterations:g,candidate:h}}var hJe=100,mJe=100,AJe=4e3;function i9(t){let{encounterValue:e=hJe,sameTeamValue:i=mJe,maxIterations:r=AJe,updateParticipantRatings:n,generateMatchUps:a=!0,ignoreLastRoundNumber:s,iterationMatchUps:o,tournamentRecord:l,dynamicRatings:c,refreshDynamic:u,participantIds:d,drawDefinition:p,roundNumber:f,structureId:h,matchUpIds:m,eventType:A,scaleName:g,idPrefix:v,isMock:b,salted:y,event:I}=t;if(!p)return{error:kt};if(!t.structure&&!h)return{error:an};let w=t.structure||di({drawDefinition:p,structureId:h}).structure;if(!Xi(w))return{error:Ab};if(!d?.length)return{error:Jg};let S=[...o??[],...w?.matchUps??[]],{encounters:T}=cJe({matchUps:S}),D=l?.participants??[],C={};if(c){let W=Ei(w?.matchUps?w.matchUps.map(({roundNumber:X})=>X):[]),Y=Math.max(...W,0);if(Y){let X=w?.matchUps?.filter(({roundNumber:ie})=>ie===Y).map(({matchUpId:ie})=>ie),J=DEe({ratingType:g??I?.category?.ratingType,updateParticipantRatings:n,tournamentRecord:l,asDynamic:!0,refreshDynamic:u,drawDefinition:p,matchUpIds:X});if(J.error)return J;J.modifiedScaleValues&&(C=J.modifiedScaleValues)}}let{valueObjects:E}=gJe({tournamentParticipants:D,encounterValue:e,sameTeamValue:i,encounters:T}),{uniquePairings:P,possiblePairings:R,deltaObjects:M}=PEe({participantIds:d}),N=Object.values(C).length?C:t.adHocRatings,k={tournamentParticipants:D,possiblePairings:R,uniquePairings:P,maxIterations:r,adHocRatings:N,deltaObjects:M,valueObjects:E,eventType:A,scaleName:g,salted:y},{candidatesCount:O,participantIdPairings:x,deltaCandidate:F,iterations:_,candidate:V}=fJe(k);if(!O)return{error:C2};let G,z;if(a){let W=D$({structureId:w?.structureId,ignoreLastRoundNumber:s,participantIdPairings:x,newRound:!0,drawDefinition:p,roundNumber:f,matchUpIds:m,idPrefix:v,isMock:b,event:I});if(W.error)return W;G=W.roundNumber,z=W.matchUps}let{maxDelta:Q,maxDiff:j}=V;return{roundNumber:G,participantIdPairings:x,modifiedScaleValues:C,candidatesCount:O,deltaCandidate:F,...oe,iterations:_,matchUps:z,maxDelta:Q,maxDiff:j}}function gJe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let s of t)n[s]||(n[s]=0),n[s]+=i;let a=e?.filter(({participantType:s})=>s===vr);if(a)for(let s of a){let o=s.individualParticipantIds??[],{uniquePairings:l}=PEe({participantIds:o});for(let c of l)n[c]||(n[c]=0),n[c]+=r}return{valueObjects:n}}function REe(t){let{drawType:e=Kp,attachConsolation:i=!0,applyPositioning:r=!0,tournamentRecord:n,staggeredEntry:a,automated:s,placeByes:o,isMock:l,event:c}=t,u=t?.drawDefinition;if(!u)return{error:kt};let d=Za,p=uS({stageSequence:1,drawDefinition:u,stage:d}),f=[Sd,gM,Mh].includes(e)?p.length:lE(p.length);if(!a&&e===mE&&p.length<2||e===Sd&&p.length<3)return{error:v2};let{tieFormat:h,matchUpType:m}=t;if(h){let E=Jo({tieFormat:h});if(E.error)return E}h=Us(h??po({drawDefinition:u})?.tieFormat),m=m??u.matchUpType;let{structures:A}=Td({stageSequence:1,drawDefinition:u,stage:d});if(A.length>1)return{error:cwe};if(A?.[0]?.matchUps?.length)return{error:K8};let g=A?.[0]?.structureId;Object.assign(t,Lt({structureName:t.structureName??_s(Za),structureId:g,matchUpType:m,tieFormat:h,drawSize:f,stage:d}));let v=SEe(t);if(v.error)return v;let b=v.generators[e];if(!b)return{error:U8};let y=b?.();if(y.error)return y;let{structures:I,links:w}=y,S=I.map(E=>dr({structure:E}).matchUps).flat();h&&S.forEach(E=>{let{tieMatchUps:P}=IS({matchUp:E,tieFormat:h,isMock:l});Object.assign(E,{tieMatchUps:P,matchUpType:m})}),(!r||!i)&&(u=Dt(u,!1,!0)),u.links||(u.links=[]),w.length&&u.links.push(...w);let T=I.map(({structureId:E})=>E);u.structures||(u.structures=[]);let D=u.structures.map(({structureId:E})=>E);u.structures=u.structures.map(E=>T.includes(E.structureId)?I.find(({structureId:P})=>P===E.structureId):E);let C=I.filter(({structureId:E})=>!D.includes(E));return C.length&&u.structures.push(...C),s&&WM({seedingProfile:t.seedingProfile,applyPositioning:r,tournamentRecord:n,drawDefinition:u,structureId:g,placeByes:o,drawSize:f,event:c}),i&&kr({drawDefinition:u}),{links:w,structures:I,...oe}}var r9={};Li(r9,{addGame:()=>FEe,addPoint:()=>OEe,addSet:()=>$Ee,addShot:()=>LEe,analyzeScore:()=>u9,analyzeSet:()=>i1,calculateHistoryScore:()=>kEe,checkScoreHasValue:()=>wa,checkSetIsComplete:()=>M$,clearHistory:()=>_Ee,generate:()=>MEe,generateScoreString:()=>ip,generateTieMatchUpScore:()=>JM,getSetComplement:()=>p9,getTiebreakComplement:()=>x$,helpers:()=>QEe,isValidMatchUpFormat:()=>Zl,keyValueScore:()=>dDe,mutate:()=>BEe,parseMatchUpFormat:()=>ys,parseScoreString:()=>sN,query:()=>ADe,redo:()=>HEe,reverseScore:()=>NEe,setServingSide:()=>xEe,stringifyMatchUpFormat:()=>x2,tidyScore:()=>mDe,umo:()=>GEe,undo:()=>VEe,validateMatchUpScore:()=>gDe,validateScore:()=>d9,validateSetScore:()=>c9,validateTieFormat:()=>Jo});var MEe={};Li(MEe,{generateScoreString:()=>ip,generateTieMatchUpScore:()=>JM,reverseScore:()=>NEe});function ip(t){let{winnerFirst:e=!0,setTBlast:i=!0,addOutcomeString:r,reversed:n=!1,matchUpStatus:a,matchUpFormat:s,autoComplete:o,winningSide:l,sets:c}=t;if(!c)return{error:Yt,info:"missing sets"};let u=s&&ys(s),{bestOf:d,finalSetFormat:p,setFormat:f}=u??{},h=n||!(!e||!l||l===1),m=r?vJe({matchUpStatus:a}):"",A=c?.sort(yJe).map(g).filter(Boolean).join(" ")||"";if(!m)return A;if(l===2)return`${m} ${A}`;return`${A} ${m}`;function g(v){let b=d&&v.setNumber===d&&p?p:f,y=z=>Un(z?.side1Score)||Un(z?.side2Score),I=(z=>Un(z?.side1TiebreakScore)||Un(z?.side2TiebreakScore))(v),w=b?.tiebreakSet||!y(v)&&I,{side1Score:S,side2Score:T,side1TiebreakScore:D,side2TiebreakScore:C}=v,E=D||(Un(D)||I&&o?0:""),P=C||(Un(C)||I&&o?0:"");if(w){let z=y(v)&&!I,Q=z?S:E,j=z?T:P;return`[${(h?[j,Q]:[Q,j]).join("-")}]`}let R=I?Math.min(E,P):"",M=R===E?1:2,N=Un(R)?`(${R})`:"",k=S||(Un(S)||o?0:""),O=T||(Un(T)||o?0:""),x=z=>!i&&M===z?N:"",F=`${k}${x(1)}`,_=`${O}${x(2)}`,V=i&&I?`(${R})`:"",G=h?`${[_,F].join("-")}${V}`:`${[F,_].join("-")}${V}`;return["-"," "].includes(G)&&(G=""),G}}function vJe({matchUpStatus:t}){let e={[Ha]:"RET",[Zr]:"WO",[Aa]:"DF/DF",[An]:"WO/WO",[rv]:"SUS",[tc]:"ABN",[Nr]:"DEF",[bE]:"DR"};return t&&e[t]||""}function yJe(t,e){return t.setNumber-e.setNumber}function NEe(t){if(!t?.score)return{error:Yt};let{sets:e}=t.score,i=e.map(s=>{let{side1TiebreakScore:o,side2TiebreakScore:l,winningSide:c,side1Score:u,side2Score:d,setNumber:p}=s;return Lt({winningSide:c?3-c:void 0,side1TiebreakScore:l,side2TiebreakScore:o,side1Score:d,side2Score:u,setNumber:p})}),r=t?.setTBlast,n=ip({setTBlast:r,sets:i}),a=ip({sets:i,reversed:!0,setTBlast:r});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:a},...oe}}var BEe={};Li(BEe,{addGame:()=>FEe,addPoint:()=>OEe,addSet:()=>$Ee,addShot:()=>LEe,calculateHistoryScore:()=>kEe,clearHistory:()=>_Ee,redo:()=>HEe,setServingSide:()=>xEe,umo:()=>GEe,undo:()=>VEe});function Eb({matchUp:t}){let{extension:e}=ki({name:X2,element:t});if(!e)return{error:rs};let{history:i=[],undoHistory:r=[]}=e.value;return{history:i,undoHistory:r,...oe}}function kEe(t){if(!t)return{error:Yt};let{matchUp:e,updateScore:i}=t;if(!e)return{error:Zo};let r=Eb({matchUp:e})?.history||[];if(!Array.isArray(r))return{error:we,info:"history is not an array"};let{matchUpFormat:n}=e;if(!n)return{error:M8};if(!Zl({matchUpFormat:n}))return{error:R8};let a=ys(n),{bestOf:s,finalSetFormat:o,setFormat:l}=a,c=["0","15","30","40","A","G"],u={sets:[]},d=[],p,f=[0,0],h=1,m=0,A,g=0,v=C=>[1,2].includes(C),b=()=>(m+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:m,games:[]}),y=()=>({winningSide:void 0,points:[]}),I=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),w=I(),S=y(),T=b(),D=0;for(let C of r){D+=1,A=u.sets.length+1===s;let E=A&&o?o:l,{tiebreakAt:P,setTo:R,NoAD:M,tiebbreakFormat:N}=E,k=T.side1Score===P&&T.side1Score===T.side2Score,O=!!E.tiebreakSet,x=O?E.tiebreakSet:N,{tiebreakTo:F,NoAD:_}=x||{},V=()=>{p=void 0,f=[0,0],h=3-h,T.side1TiebreakScore="",T.side2TiebreakScore="",T.side1PointScore="",T.side2PointScore="",g=0},G=j=>{T.winningSide=j;let{s:W,...Y}=T;u.sets.push(Y),w=I(),S=y(),T=b(),V()},z=j=>{S.winningSide=j;let{g:W,...Y}=S;T.games.push(Y),w=I(),S=y(),V();let X=`side${j}Score`;T[X]+=1},Q=j=>{w.winningSide=j;let{p:W,...Y}=w;S.points.push(Y),w=I(),g=0;let X=()=>f.reduce((ie,ue)=>ie+ue)%4/4>.5?h:3-h,J=j-1;if(k||O){f[J]+=1,p=X(),T[`side${j}TiebreakScore`]=f[J],T[`side${3-j}TiebreakScore`]=f[1-J];let ie=_?1:2;if(f[J]>=F&&f[J]>=f[1-J]+ie)return z(j),{gameCompleted:!0}}else if(f[1-J]===4&&f[J]===3?f[1-J]-=1:f[J]+=1,T.side1PointScore=c[f[0]],T.side2PointScore=c[f[1]],f[J]===5||f[J]===4&&f[1-J]<3||M&&f[J]===4)return z(j),{gameCompleted:!0}};if(v(C.srv)&&(h=C.srv),["p","s","g","o"].includes(C.u)&&d.push(C.u),C.shotOutcome&&(w.shots.push(C),C.shotType==="SERVE"&&["OUT","NET"].includes(C.shotOutcome)&&(g+=1),g===2)){let j=3-h;Q(j)}if(v(C.p)||wi(C.pointNumber)){let j=C.winningSide||C.p;if(Q(j)?.gameCompleted)continue}if(v(C.g)||wi(C.gameNumber)){let j=C.winningSide||C.g;S.winningSide=j;let W=`side${j}Score`,Y=`side${3-j}Score`;if(d.length&&(d.includes("p"),d=[]),z(j),T[W]===R&&T[W]-T[Y]>=(M?1:2)&&(G(j),A))break}if(v(C.s)||wi(C.setNumber)){let j=C.winningSide||C.s;if(G(j),d.length&&(d.includes("p"),d.includes("g"),d=[]),A)break}}return D!==r.length&&console.log({error:"Match completed with excess history"}),(T.side1Score||T.side2Score||T.games.length||T.side1TiebreakScore||T.side2TiebreakScore)&&u.sets.push(T),u.scoreStringSide1=ip({...u,matchUpFormat:n}),u.scoreStringSide2=ip({...u,matchUpFormat:n,reversed:!0}),h=p||h,i&&(e.score=u),{...oe,servingSide:h,score:u}}function Db({undoHistory:t,history:e,matchUp:i}){return ur({element:i,extension:{value:{history:e,undoHistory:t},name:X2}})}function xEe({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:x8};let{history:i=[]}=Eb({matchUp:t});return i.push({srv:e}),Db({matchUp:t,history:i})}function _Ee({matchUp:t}){return Db({matchUp:t})}function OEe({matchUp:t,point:e}){if(!e||!t)return{error:Yt};if(typeof e!="object")return{error:we,context:{point:e}};let{history:i=[]}=Eb({matchUp:t});return i.push(e),Db({matchUp:t,history:i})}function FEe({matchUp:t,game:e}){if(typeof e!="object")return{error:we,context:{game:e}};let{history:i=[]}=Eb({matchUp:t});return i.push(e),Db({matchUp:t,history:i})}function LEe({matchUp:t,shot:e}){if(typeof e!="object")return{error:Yt};let{history:i=[]}=Eb({matchUp:t});return i.push(e),Db({matchUp:t,history:i})}function $Ee({matchUp:t,set:e}){if(typeof e!="object")return{error:Yt};let{history:i=[]}=Eb({matchUp:t});return i.push(e),Db({matchUp:t,history:i})}function HEe({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Eb({matchUp:t});return i.length&&e.push(i.pop()),Db({matchUp:t,history:e,undoHistory:i})}function VEe({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Eb({matchUp:t});return i.push(e.pop()),Db({matchUp:t,history:e,undoHistory:i})}var GEe={},QEe={};Li(QEe,{keyValueScore:()=>dDe,parseMatchUpFormat:()=>ys,stringifyMatchUpFormat:()=>x2,tidyScore:()=>mDe});var bJe="COMPLETED",IJe="WO/WO",jEe=["RET","DEF","WO",IJe,"ABN","SUS","INT"],n3="DEFAULTED",zEe="WALKOVER",qEe="ABANDONED",WEe="SUSPENDED",KEe="RETIRED",YEe="INTERRUPTED",wJe=[KEe,n3,zEe],SJe="Enter Score",dw="()",zy="[]",n9=["up","left","shift+tab"],a9=["enter","down","tab","right"],V_="backspace",XEe="r",ZEe="s",JEe="a",eDe="d",tDe="w",iDe="i",P$=[XEe,eDe,tDe,JEe,ZEe,iDe],R$="space",eG=["[","("],G_=[...n9,...a9,R$,"]"],rDe="-",UJe="/",NI=rDe,ch=rDe,nDe=[UJe],TJe=0,CJe=["=","+","num_1","num_2","shift+=","shift+-"],s9=["0","1","2","3","4","5","6","7","8","9"].concat(P$),aDe=s9.map(t=>`shift+${t}`),sDe=[NI,V_].concat(G_,nDe),oDe=[s9,aDe,sDe].join(","),EJe=[oDe,n9,a9,CJe].join(","),DJe={OUTCOMEKEYS:P$,SIDE1KEYS:s9,SIDE2KEYS:aDe,MODIFIERS:sDe,PROMPT:SJe,MOVEUP:n9,MOVEDOWN:a9,HOTKEYS:EJe};function ZS({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=lDe({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==" "?" ":"";return t+r+i}else return i+" "+t}function lDe({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of jEe){let r=t?.indexOf(i);r===0?t=t.slice(i.length+1).trim()+" ":r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t?.trim()||(t=""),{scoreString:t,removed:e}}function a3({analysis:t,scoreString:e,sets:i,lowSide:r}){let n,a;if(!e)return{scoreString:e,sets:i};let{scoreString:s,removed:o}=lDe({scoreString:e});if(e=s,o)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},c=Object.values(l).filter(m=>m!==void 0).length;l.setNumber&&c===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:u}=t.setFormat,{tiebreakTo:d,NoAD:p}=u||{},{isTiebreakEntry:f}=iT({brackets:zy,scoreString:e}),h=RJe(e);if(h>=0){n=e.slice(0,h);let{isTiebreakEntry:m}=iT({brackets:dw,scoreString:n}),{lastOpenBracketIndex:A,isTiebreakEntry:g}=iT({brackets:zy,scoreString:n}),v=n&&n[n.length-1].trim(),b=n&&!isNaN(v),y=t.isIncompleteSetScore;if(f&&g){let I=n.slice(A+1).split(ch),w=I?.length>0&&I[0]!==void 0&&!isNaN(parseInt(I[0]))&&parseInt(I[0])||void 0,S=I?.length>1&&I[1]!==void 0&&parseInt(I[1])||void 0,T=[w,S];if(S){let D=r===1?1:0;T[D]=(T?.[1-D]||0)+(p?1:2),(T[D]||0)<d&&(T[D]=d),n=e.slice(0,A+1),n+=T.join(ch)}else w!==void 0?(n=e.slice(0,A+1),n+=w):(n=e.slice(0,A),y=!0);l.side1TiebreakScore=T[0]||0,l.side2TiebreakScore=T[1]||0}if(n.length||(n=void 0),y){let I=l.side1Score?.toString();if(I){let w=I?.slice(0,I.length-1);l.side1Score=!isNaN(w)&&parseInt(w)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:i?.slice(0,i.length-1)||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]}else if(b){let I=l.side2Score?.toString(),w=l.side1Score?.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let S=I?.slice(0,I.length-1);l.side2Score=!isNaN(S)&&parseInt(S)||void 0}else{let S=w?.slice(0,w.length-1);l.side1Score=!isNaN(S)&&parseInt(S)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else m?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(f&&!g?a=i?.slice(0,i.length-1)||[]:(a=i,a[i.length-1]=l),f||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:e,sets:i}}function iT({brackets:t=dw,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...Wp(i,n)),s=Math.max(...Wp(r,n));return{isTiebreakEntry:a>s,lastOpenBracketIndex:a}}function PJe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=zy.split(""),a=t.split(""),s=Math.max(...Wp(r,a)),o=Math.max(...Wp(n,a)),l=Math.max(...Wp(ch,a));return i&&s>o&&l>s}function RJe(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function cDe(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function Pie({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){let n=ys(t),{bestOf:a}=n,s=Math.ceil(a/2),o=r?.reduce((l,c)=>{let{winningSide:u}=c;return u&&l[u-1]++,l},[0,0])?.indexOf(s)+1||void 0;return wJe.includes(e)&&i&&(o=i),{matchUpWinningSide:o}}function M$({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:s}){if(!s)return{error:Yt,info:"missing set"};e=e||i&&ys(i);let o=n&&e.finalSetFormat||e?.setFormat||{},{side1Score:l,side2Score:c}=s,{setTo:u,tiebreakAt:d}=o,p=l||c,f=N$({set:s}),h=Math.abs(l-c),m=l>=u||c>=u,A=r||l>=u&&c>=u||d&&d<u&&(l===d||c===d),g=t||A&&(f===1&&s.side1TiebreakScore>s.side2TiebreakScore||f===2&&s.side2TiebreakScore>s.side1TiebreakScore),v=!A&&o.NoAD||A||r&&o.tiebreakFormat?.NoAD?1:2,b=h>=v;return!!((a&&p||m&&(b||A)||r)&&(!A||g))}function N$({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function o9({analysis:t,set:e}){let i=N$({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return M$({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function MJe({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!i?.length)return{sets:[]};let a=i[i.length-1];r=ci(r);let{validSide2Score:s,requiresTiebreak:o}=NJe({analysis:t,set:a,value:r});if(s){n=!0,e=(e||"")+r,a.side2Score=r;let l=o9({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,o){let c=dw.split("")[0];e+=c}else t.isDecidingSet||(e+=" ")}return{sets:i,scoreString:e,updated:n}}function NJe({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:s}=r,{side1Score:o}=e,l,c;return n&&n<a?o===n?l=i<=a:l=i<=n:o===a?s?l=i<a:l=i<=a+1:o===a-1?s?l=i<=a:l=i<=a+1:o===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?c=o===a&&i===n||o===n&&i===a:c=o>=a&&i>=a&&o!==i),{validSide2Score:l,requiresTiebreak:c}}function uDe({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let s;return e===XEe?r?(s=!0,r=ZS({scoreString:r,lowSide:t,outcome:"RET"}),n=t===2?1:2,a=KEe):(s=!0,r=ZS({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=n3):e===eDe?(s=!0,r=ZS({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=n3):e===tDe?(s=!0,i=[],r="WO",n=t===2?1:2,a=zEe):e===ZEe&&r?(s=!0,r=ZS({scoreString:r,lowSide:t,outcome:"SUS"}),a=WEe,n=void 0):e===JEe?(s=!0,r=ZS({scoreString:r,lowSide:t,outcome:"ABN"}),a=qEe,n=void 0):e===iDe&&r&&(s=!0,r=ZS({scoreString:r,lowSide:t,outcome:"INT"}),a=YEe,n=void 0),{updated:s,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function BJe(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:s,lowSide:o,value:l}=t,c,u;!e?.length&&l!==V_&&(e=[{setNumber:1}]);let d=e.length-1;if(P$.includes(l)){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p;f&&!h?i="missing side2Score":s.finalSetIsComplete||n?i="final set is already complete":s.isIncompleteSetScore?i="incomplete set scoreString":s.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:c}=uDe({lowSide:o,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===V_){if({scoreString:r,sets:e,outcomeRemoved:u}=a3({analysis:s,scoreString:r,sets:e}),r?.trim()===""&&(r=r.trim()),r||(e=[]),u){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p;if(f&&h){let m=f>h&&1||h>f&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,c=!0}else if(s.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===R$){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p,m=f>h&&1||h>f&&2||void 0;m&&!n&&!s.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),r+=" ",c=!0)}else if(l===NI&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&s.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,c=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let f=ci((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=ci(f),p=e[d].side1Score.toString(),c=!0}else{let f=ci((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=ci(f),p=[e[d].side1Score,e[d].side2Score].join("-"),c=!0}if(c){let f=(e.slice(0,d)||[]).filter(h=>h).map(h=>{let{side1Score:m,side2Score:A}=h;return[m,A].join("-")}).join(" ");f?r=f+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:c}}function kJe({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){let s,o,{tiebreakSet:{tiebreakTo:l,NoAD:c}}=t.setFormat,[u]=zy.split("");if(t.isMatchTiebreakEntry||(r+=u),n[t.setNumber-1]){let{lastOpenBracketIndex:d}=iT({brackets:zy,scoreString:r}),p=(r.slice((d??0)+1)+(e?"":a)).split(ch);if((p[i-1]?.length||0)>=2)o="tiebreak digit limit";else if(e){i===1&&(p[0]=(p[0]||"")+a),i===2&&(p[1]=(p[1]||"")+a);let f=[p[0]||0,p[1]||0].map(A=>ci(A)),h=i===1?1:0;f[h]=f[1-h]+(c?1:2),f[h]<l&&(f[h]=l);let m=n[n.length-1];m.side1TiebreakScore=f[0],m.side2TiebreakScore=f[1],r=r.slice(0,(d??0)+1),r+=f.join(ch),s=!0}else{let f=[p[0]||0,p[1]||0].map(m=>ci(m)),h=n[n.length-1];h.side1TiebreakScore=f[0],h.side2TiebreakScore=f[1],r+=a,s=!0}}else{let d=cDe({lowValue:ci(a||0),tiebreakTo:l,NoAD:c}),p=[ci(a),d];i===2&&p.reverse();let f={side1TiebreakScore:p[0],side2TiebreakScore:p[1],setNumber:n?.length+1||1};n.push(f),r+=p.join(ch),s=!0}return{info:o,scoreString:r,sets:n,updated:s}}function xJe({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:s}=t?.setFormat||{},o=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(s&&r===n||r>n)return{scoreString:i};let l=h(),c=[r,l];e===2&&c.reverse();let u=dw.split("")[0],d=c.join(NI)+(o?u:" ");i=(i||"")+d;let p={side1Score:c[0],side2Score:c[1]},f=o9({analysis:t,set:p});return p.winningSide=f||void 0,{scoreString:i,set:p};function h(){return o?r+1:r+1===n?r+(s?1:2):n}}function _Je({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){let a=(n?.filter(F=>F?.winningSide)?.length||0)+(i?0:1),s=ys(t),o=a===s?.bestOf,l=o&&s?.finalSetFormat||s?.setFormat||{},c=l?.timed,u=o&&n[s?.bestOf-1],d=u?.winningSide,{isTiebreakEntry:p}=iT({brackets:dw,scoreString:e}),{isTiebreakEntry:f}=iT({brackets:zy,scoreString:e}),h=p||f,m=!!l.tiebreakSet,A=e?.[e.length-1]?.trim(),g=e&&!isNaN(A),v=!h&&A===NI,b=p&&eG.includes(A),y=f&&eG.includes(A),I=f&&A===ch,w=e?.split(""),[S]=zy.split(""),T=w&&Math.max(...Wp(S,w)),D=w&&Math.max(...Wp(ch,w)),C=w&&D>T,E=n[n.length-1]?.winningSide,P=n?.length&&!E,R=jEe.find(F=>e?.indexOf(F)>=0),M=!isNaN(r),N=r===R$,k=G_.includes(r),O=e?.split("").find(F=>eG.includes(F)),x=k&&f&&!y&&(I||!PJe({scoreString:e}));return{isTiebreakSetValue:m&&M,matchUpScoringFormat:s,setNumber:a,setFormat:l,matchTiebreakHasJoiner:C,isGameScoreEntry:P,isSpace:N,isCloser:k,isTiebreakCloser:k&&O&&h&&g,isDecidingSet:o,isTiebreakSet:m,isTimedSet:c,isNumericEnding:g,isNumericValue:M,hasOpener:O,hasOutcome:R,finalSet:u,finalSetIsComplete:d,lastSetIsComplete:E,isInvalidSetTiebreakValue:N&&h&&b,isInvalidMatchTiebreakValue:x,isTiebreakEntry:h,isSetTiebreakEntry:p,isMatchTiebreakEntry:f,isIncompleteSetScore:v,isIncompleteSetTiebreak:b,isIncompleteMatchTiebreak:y,isPartialMatchTiebreakValue:I}}function dDe(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:s}=t,{matchUpFormat:o,shiftFirst:l,auto:c=!0}=t,u,d,p=l&&e===2||!l&&e===1;if(!oDe.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:f}=Pie({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});a=f;let h=_Je({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:o});if(nDe.includes(i)&&(i=NI),h.hasOpener&&h.isTiebreakEntry&&!h.isTiebreakSet&&p&&ci(i)===0&&(h.isTiebreakCloser=!0),G_.includes(i)&&h.hasOpener&&(i=""),G_.includes(i)&&(i=R$),h.lastSetIsComplete){let m=r?.length&&r[r.length-1];r&&m!==" "&&(r+=" ")}if(h.isTimedSet)({info:d,sets:n,scoreString:r,updated:u,matchUpStatus:s,winningSide:a}=BJe({analysis:h,lowSide:e,scoreString:r,sets:n,matchUpStatus:s,winningSide:a,value:i}));else if(P$.includes(i))h.finalSetIsComplete||a?d="final set is already complete":!h.isTiebreakEntry&&!h.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:s,winningSide:a,updated:u}=uDe({lowSide:e,sets:n,scoreString:r,matchUpStatus:s,winningSide:a,value:i}):h.isTiebreakEntry||h.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===V_)u=!0,{scoreString:r,sets:n}=a3({analysis:h,scoreString:r,sets:n,lowSide:e}),r||(n=[]),s=void 0,a=void 0;else if(h.hasOutcome)d="has outcome";else if(i===NI&&!h.isMatchTiebreakEntry)(!h.isSetTiebreakEntry||h.isSetTiebreakEntry&&!h.isNumericEnding)&&(u=!0,{scoreString:r,sets:n}=a3({analysis:h,scoreString:r,sets:n,lowSide:e}),s=void 0);else if(i===ch&&h.isMatchTiebreakEntry&&!h.isSetTiebreakEntry)h.matchTiebreakHasJoiner?d="existing joiner":h.isNumericEnding&&(u=!0,r+=ch);else if([NI,ch].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(h.isIncompleteSetScore)h.isNumericValue&&({sets:n,scoreString:r,updated:u}=MJe({analysis:h,scoreString:r,sets:n,value:i}));else if(h.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(h.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(h.isTiebreakCloser){let m=h.isSetTiebreakEntry?dw:zy,A=m.split("").reverse()[0],g=m.split("")[0],v=n[n.length-1],{tiebreakFormat:b}=h.setFormat,{tiebreakTo:y,NoAD:I}=b||{},w=N$({set:v});if(!h.isTiebreakSet){let T=Number.parseInt(r.split(g).reverse()[0]),D=cDe({lowValue:T,tiebreakTo:y,NoAD:I});w===1?(v.side1TiebreakScore=D,v.side2TiebreakScore=T):(v.side1TiebreakScore=T,v.side2TiebreakScore=D)}r=(r||"")+A,h.isDecidingSet||(r+=" ");let S=o9({analysis:h,set:v});v.winningSide=S||void 0,u=!0}else if(h.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:u}=kJe({analysis:h,auto:c,lowSide:e,scoreString:r,sets:n,value:i}));else if(h.isSetTiebreakEntry){let[m]=dw.split(""),A=Math.max(...Wp(m,r.split(""))),g=r.slice(A+1),v=g&&ci(g)===TJe,b=ci(g?g+i:i),{tiebreakFormat:y}=h.setFormat,{tiebreakTo:I,NoAD:w}=y||{};!v&&g.length<2?w&&b>I-1?d="invalid low value for NoAD tiebreak":(u=!0,r=(r||"")+i):d=v?"tiebreak begins with zero":"tiebreak digit limit"}else if(h.isCloser)d=`invalid key: ${i}`;else if(h.isGameScoreEntry)d="game scoreString entry";else if(h.lastSetIsComplete||!n.length){u=!0;let{scoreString:m,set:A}=xJe({analysis:h,lowSide:e,scoreString:r,value:ci(i)});A&&(A.setNumber=n?.length+1||1),n=n?.concat(A).filter(Boolean)||[A],r=m||void 0}else console.log("error: unknown outcome")}if(u){n=n?.filter(Boolean);let{matchUpWinningSide:m}=Pie({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});return a=m,m&&(!s||[Nn,ic].includes(s))?(s=bJe,n=n.filter(A=>{let{side1Score:g,side2Score:v,side1TiebreakScore:b,side2TiebreakScore:y}=A;return g||v||b||y})):r&&!a&&![WEe,qEe,YEe].includes(s)&&(s=void 0),{updated:u,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}return{updated:u,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}var B$="\\d+-\\d+",t1="\\d+-\\d+\\(\\d+\\)",l9="\\[\\d+-\\d+\\]",OJe="\\d+-\\d+\\(\\d+-\\d+\\)",FJe=new RegExp(`(${B$}),`,"g"),LJe=new RegExp(`(${t1}),`,"g"),$Je=[B$,t1,l9,OJe],HJe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],VJe=HJe.map(t=>{let e=t.split("").map(i=>$Je[i]).join(" ");return new RegExp(`^${e}$`)});function Rie(t){return!t||VJe.some(e=>e.test(t))}function GJe(t){let e="[];()",i=["[","("],r=Object.assign({},...e.split("").map(s=>({[s]:0}))),n="",a=t.split("").map(s=>{let o=e.includes(s)&&s,l=i.includes(o);if(l&&o)return r[o]+=1,n=o,s;if(!l&&o&&n&&o!==n){r[n]-=1;let c="[];".includes(n)&&"[];"||"()".includes(n)&&"()"||"",u=c.split("").find(d=>d!==n);if(c.includes(o))r[n]||(n="");else return r[o]||(n=""),u}return s}).join("");return t!==a?a:t}function Xk(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function QJe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function iC(t){let e=(i=>i?.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function Q_(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function Mie(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function jJe(t){return t.startsWith("(")&&t.endsWith(")")}function zJe({score:t,applied:e}){t=GJe(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let S=w.replace(")",") ");t=t.replace(w,S)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let w of a||[]){let[S]=w.match(n).slice(1),T=S.replace(/ /g,"");t=t.replace(w,`(${T})`)}let s=/\(\(\d-\d\)\)/g;if(s.test(t)){let w=t.match(s);w.length&&w.forEach(S=>{let T=S.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(S,T)})}if(s=/\(\((\d)\)\)/g,s.test(t)){let w=t.match(s);w.length&&w.forEach(S=>{let T=S.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(S,T)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);t=t.replace(o,"-"),["- "," -"].forEach(w=>{let S=new RegExp(`(\\d+)${w}(\\d+)`,"g"),T=t.match(S);T&&T.forEach(D=>t=t.replace(D,D.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[S]=w.match(/\((\d+), \)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"&&(t=t.replace(w,"(6-0)"))});let c=/\((\d+)\/\)/g;c.test(t)&&t.match(c).forEach(w=>{let[S]=w.match(/\((\d+)\/\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${S})`)});let u=/\d\/\d\/,/g;u.test(t)&&t.match(u).forEach(w=>{let[S]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${S},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[S]=w.match(/\(\/(\d+)\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&parseInt(S)<6?t=t.replace(w,`(6-${S})`):t=t.replace(w,`(${S})`)});let p,f,h,m,A,g=()=>{A=Xl(t.split("")),f=A["("]===(A[")"]||0)+1,p=(A["("]||0)+1===A[")"],h=A["["]===A["]"]+1,m=f&&!h};g();let v=/(\d+-\d+\(\d+)0,/;if(v.test(t)){let[w]=t.match(v).slice(1);t=t.replace(v,w+")")}if(A["("]===A[")"]&&A["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(jJe)?t=w.map(S=>{let T=S.slice(1,S.length-1);return T.length>2?T:S}).join(" "):t=w.join(" ")}g();let b=/[A-Za-z]+/.test(t),y=/\d+/.test(t);if(!b&&!y)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>A[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&A["("]===1&&A[")"]===1&&"[]/,".split("").some(w=>A[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),A["("]>(A[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",g()),A["("]===1&&!A[")"]&&t[0]==="("&&(t=t+")",g()),A["("]>(A[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],S=0;for(let T of t.split("").reverse())T===")"&&(S?w.push("("):S+=1),T==="("&&(S-=1),w.push(T);w.reverse(),t=w.join("")}g()}if(A[")"]>(A["("]||0)&&t[0]===")"&&(t="("+t.slice(1),g()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",g()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",g()),m){let w="",S=0;for(let T of t.split(""))T==="("&&(S?w+=")":S+=1),T===")"&&(S-=1),w+=T;t=w}g(),h&&!f&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),g()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),g(),A[")"]===1&&!A["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&A["("]===1&&A[")"]===1&&(t=t.slice(1,t.length-1),g());let I=w=>{let S=w.indexOf("("),T=w.indexOf(")");return S>=0&&T>=0&&S<T};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&A["("]===A[")"]){let w=t.slice(1,t.length-1);I(w)&&(t=w,g())}return{score:t,applied:e}}function k$(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=Wp("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,s)=>s%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function qJe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[FJe,LJe].forEach(i=>{let r=t.match(i);r?.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(k$).join(" "),{score:t,applied:e}}function WJe({score:t}){if(typeof t!="string")return{score:t};let e=p=>p?.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let f=/^-(\d+)$/;if(f.test(p)){let[h]=p.match(f).slice(1);if(h.length===2)return h.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(Xk),a=0,s="";for(let p of n){let f=Wp(p,r).find(g=>!a||g>a),h=r.slice(a,f-1),m=r[f-1],A=e(m);if(/^\d+$/.test(A)&&A.length===2){let g=A.split(""),v=Math.abs(g.reduce((b,y)=>+b-+y));if(v===1){let b=[h.join(" "),[m,p].join("")].join(" ");s+=b,a=f+1}else if(v===0){let b=Math.max(...g);if([4,5,6,7,8,9].includes(b)){let y=[6,4].includes(b)?b+1:b-1,I=[b,y].sort().reverse().join("-"),w=[h.join(" "),[I,p].join("")].join(" ");s+=w,a=f+1}}}}if(n.length&&s.length){let p=r.slice(a).join(" ");return s=[s,p].join(" "),{score:s.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((f,h)=>+f-+h,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let o=r.map(p=>QJe(p)&&"bracket"||iC(p)&&"set");if(o.includes("set")&&o.includes("bracket")){let p,f="";return r.forEach((h,m)=>{o[m]==="bracket"&&p==="set"?(h=i(h),f+=h):f+=` ${h}`,p=o[m]}),{score:f.trim()}}r=t.split(" ");let l,c=r.map(p=>{let f=new RegExp(/^(\d+)-(\d+)$/);if(f.test(p)){let[h,m]=p.match(f).slice(1),A=Math.abs([h,m].reduce((v,b)=>+v-+b,0)),g=Math.max(h,m);if(A===1)return l="tiebreakSet",l;if(A>=2&&g>=7&&l==="tiebreakSet")return l="tiebreak",l}}),u=Wp("tiebreak",c);if(u.length){let p="";r.forEach((f,h)=>{u.includes(h)?p+=`(${f}) `:u.includes(h+1)?p+=`${f}`:p+=`${f} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,f,h]=t.match(d).slice(1),m=Math.max(f,h)>=10;!iC(p)&&m&&(t=t.replace(d,`${p} [${f}-${h}]`))}return c=[],t=t.split(" ").map(p=>{let f=/^\((.*)\)$/,h=f.test(p),m=new RegExp(l9).test(p)&&"super"||new RegExp(t1).test(p)&&"tiebreak"||new RegExp(B$).test(p)&&"standard"||"unknown";return c.push(m),m==="standard"&&h?p.match(f)[1]:p}).join(" "),{score:t}}function KJe({score:t,applied:e}){for(let T of[".",","," ","/"]){let D=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(D.test(t)){let C=t.match(D).slice(1).map(P=>parseInt(P)),E=Math.abs(C[0]-C[1]);E<=10&&E>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[T,D,C,E,P,R]=t.match(i).slice(1);t=t.replace(i,`${T}${D}-${C} ${E}-${P}${R}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(T=>(n.test(T)&&(T=T.replace("("," (")),a.test(T)&&(T=T.replace(")",") ")),T)).join(" "),e.push("spaceConsiderationPatterns")});let s=k$(t);s!==t&&(t=s,e.push("deDashMash"));let o=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(o.test(t)){let[T,D,C]=t.match(o).slice(1),[E,P]=D.split("");t=`${T}-${E} ${P}-${C}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,c=/^([\d -]+)\/([\d -]+)$/;if(c.test(t)){let[T,D]=t.match(c).slice(1),C=T.trim(),E=D.trim();if(l.test(C)&&l.test(E)){let P=C.match(l).slice(1,3).join("-"),R=E.match(l).slice(1,3).join("-");t=`${P} ${R}`,e.push("slashSeparationPattern")}}let u=/^([\d -]+),([\d -]+)$/;if(u.test(t)){let[T,D]=t.match(u).slice(1),C=T.trim(),E=D.trim();if(l.test(C)&&l.test(E)){let P=C.match(l).slice(1,3).join("-"),R=E.match(l).slice(1,3).join("-");t=`${P} ${R}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let T=t.match(d)[0],D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("singleSetCommaSeparationPattern")}let p=0,f=/(\d+)-(\d{2})-(\d+)/;for(;f.test(t)&&p<3;){let[T,D,C]=t.match(f).slice(1),E=D.split(""),P=`${T}-${E[0]} ${E[1]}-${C}`;t=t.replace(f,P),e.push("noSetSeparationPattern"),p+=1}let h=/(^|\s)7-6\s(\d+)\s/g,m=t.match(h);if(m?.length){let T=/(^|\s)7-6\s(\d+)\s/;m.forEach(D=>{let C=D.match(T).slice(2)[0];t=t.replace(D,`7-6(${C}) `),e.push("floatingTiebreakPattern1")})}let A=t.match(/\d \d /);A?.forEach(T=>{let D=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern1")}),A=t.match(/ \d \d$/),A?.forEach(T=>{let D=" "+T.slice(1).split(" ").join("-");t=t.replace(T,D),e.push("spaceSeparatedSetPattern2")});let g=/^\d, *\d\/\d, *\d/;if(g.test(t)){let T=t.match(g)[0],D=T.split("/").map(C=>`(${C})`).join(" ")+" ";t=t.replace(T,D),e.push("slashCommaSetPattern")}let v=/\(6-\)/g;v.test(t)&&(t=t.replace(v,"(6-0)"),e.push("missingZeroPattern2"));let b=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(b.test(t)){let T=t.match(b),D=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),C=t;T.forEach(E=>{let[P,R]=E.match(D).slice(1),M=`${P}-${R}`;C=C.replace(E,M)}),t=C,e.push("slashSetPattern")}let y=/(.*)\s(1\d)\s(\d+)$/;if(y.test(t)){let[T,D,C]=t.match(y).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${D}${C}`,e.push("spaceSeparatedSuperPattern"))}let I=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of t.match(I)||[]){let[D,C,E,P]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[R,M]=C.split("-").map(N=>parseInt(N));Math.abs(R-M)===1&&(t=t.replace(T,`${D}${C}(${E})${P}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of t.match(w)||[]){let D=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[C,E,P]=T.match(D).slice(1),[R,M]=C.split("-").map(N=>parseInt(N));Math.abs(R-M)===1&&(t=t.replace(T,`${C}(${E})${P}`),e.push("floatingTiebreakPattern2"))}let S=/(^|\s)(\d \d)\(/g;for(let T of t.match(S)||[]){let D=/(^|\s)(\d \d)\(/,[C,E]=T.match(D).slice(1);t=t.replace(T,`${C}${E.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function YJe({score:t,matchUpStatus:e}){let i=t?.split(" ");t=i.map(o=>{if(o.endsWith("]")){let l=o.split("[");if(iC(l[0]))return l[0]+`(${l[1].slice(0,-1)})`}return o}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let o of t.match(r)){let l=o.replace(" ","-").match(/\((.*)\)/)?.[1];if(Un(l)&&l?.[0]>2){if([2,4].includes(l.length))l=l.split("").join("-");else if(l.length===3){let c=l.indexOf("1");l=Q_(l.split(""),c)}}t=t.replace(o,`(${l})`)}i=t?.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((o,l)=>{let c=[void 0,"","COMPLETED"].includes(e)||l!==a;if(n.test(o)&&c){let[u,d,p]=Array.from(o.match(n)).slice(1),f=Math.min(d,p);return`${u}(${f})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l,c]=Array.from(o.match(n)).slice(1),u=l.split("");return`${u[0]}-${u[1]}(${c})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(o=>{if(n.test(o)){let[l,c]=Array.from(o.match(n)).slice(1);return iC(l)?`${l}(${c})`:l}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l]=o.match(n).slice(1);return`[${l<9?10:Number.parseInt(l)+2}-${l}]`}return o}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let o=t.match(s)[1];t=t.replace(s,`(${o}) `)}return{score:t}}function XJe({score:t,attributes:e,identifier:i}){if(typeof t!="string")return{score:t,identifier:i};let r=new RegExp(/\([\d,/ ]+\)/g),n=t.match(r);for(let u of n||[]){let d=u.match(/^\((.*)\)$/)?.slice(1)?.[0],p=t.split(u)[0].split(")").reverse()[0].replace(/\D/g,"");if(d?.length===2&&p?.length>=2){let m=p.slice(p.length-2).split("").map(A=>parseInt(A));if(Math.abs(m[0]-m[1])===1)continue}let f=Mie(d),h=k$(f);t=t.replace(u,`(${h})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);t.match(a)?.forEach(u=>{let d=Mie(u.match(/^\[(.*)\]$/)[1]);t=t.replace(u,`(${d}) `).trim()});let s=[")","]"],o=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&s.some(u=>t.endsWith(u))&&o.some(u=>t.includes(u))){let u="",d=t.split(/[)\]]/).filter(Boolean).map(A=>(A.startsWith(",")&&(A=A.slice(1)),A.trim())),p=d.every(A=>A.includes(",")||Xk(A)),f=d.every(A=>A.includes("/")||Xk(A)),h=d.every(A=>A.includes("-")||Xk(A)),m=p&&","||h&&"-"||f&&"/";if(m){let A;d.forEach(g=>{if(g.startsWith("("))if(A==="set"&&(u+=" "),g.includes(m))u+=g.slice(1).split(m).map(v=>v.trim()).join("-"),A="set";else{let v=g.slice(1);u+=`(${v}) `,A="tiebreak"}else if(g.startsWith("[")){let v=g.slice(1).split(m).map(y=>parseInt(y.trim())),b=Math.min(...v);A==="set"?u+=`(${b}) `:u+=`[${v.join("-")}] `,A="tiebreak"}}),t=u.trim()}}let l=Xl(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&iC(t)&&Un(e?.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let c=/\(\)/g;return c.test(t)&&(t=t.replace(c,"").trim()),{score:t}}function pDe({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let o=`${r[0]}-${r[1]}`;return r[2]&&(o+=` (${r[2]})`),n(),r.push(r),o};n();let s=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let o=e.shift(),l=Un(o)&&parseInt(o),c=r[0]!==void 0&&r[1]!==void 0;if(Un(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,s())){i.push(a()),r=[void 0,void 0];continue}if(c&&e.length===1&&Un(e[0])){let u=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=u,i.push(a()),r=[void 0,void 0]}c&&s()}}return{sets:i}}function s3(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=Q_(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=Q_(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function fDe(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e?.toString().split(""),a=n?.every(o=>Un(o)),s=o=>Math.abs(o[0]-o[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let o=a?n.map(c=>parseInt(c)):e.split("").map(c=>parseInt(c)),{sets:l}=pDe({score:e});if(o.length,e.length===3&&s(o.slice(0,2))===1){let[c,u,d]=o;e=`${c}-${u}(${d})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&o[0]===1){let[c,u,d]=o;e=`[${c}${u}-${d}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&s(o.slice(0,2))===1&&"987654".split("").includes(o[0].toString())){let[c,u,d,p]=o,f=Math.min(d,p);e=`${c}-${u}(${f})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&o[0]===1&&o[2]===1){let[c,u,d,p]=o;e=`[${c}${u}-${d}${p}]`,i.push("bigSuper")}else if(e.length===4){let[c,u,d,p]=o;e=`${c}${u} ${d}${p}`,i.push("split4")}else if(e.length===5&&s(o.slice(0,2))===1){let[c,u,d,p,f]=o;e=`${c}-${u}(${d}) ${p}-${f}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&s(o.slice(3))===1){let[c,u,d,p,f]=o;e=`${c}-${u} ${d}-${p}(${f})`,i.push("numericTiebreakPattern5")}else if(o.length===7)if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&o[4]===1){let[c,u,d,p,f,h,m]=o;e=`${c}-${u} ${d}-${p} [${f}${h}-${m}]`,i.push("numericTiebreakPattern6")}else if(s(o.slice(0,2))===1&&s(o.slice(3,5))>1&&s(o.slice(5,7))>1){let[c,u,d,p,f,h,m]=o;e=`${c}-${u}(${d}) ${p}-${f} ${h}-${m}`,i.push("numericTiebreakPattern7")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))===1&&s(o.slice(5,7))>1){let[c,u,d,p,f,h,m]=o;e=`${c}-${u} ${d}-${p}(${f}) ${h}-${m}`,i.push("numericTiebreakPattern8")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&s(o.slice(4,6))===1){let[c,u,d,p,f,h,m]=o;e=`${c}-${u} ${d}-${p} ${f}-${h}(${m})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let c=s3(e);c&&e!==c&&i.push("parsedSuperPattern"),e=c??e}else{let c=$a(e.split(""),2).map(g=>g.join("")),u=c.map(g=>{let[v,b]=g.split("").map(w=>parseInt(w)),y=Math.abs(v-b),I=v>b?1:2;return y>1&&I||I*-1}),d=u.reduce((g,v)=>g>0&&v>0,1),p=Xl(u),f=u.map(g=>Math.abs(g)),h=Xl(f),m=u[0]<0,A=!m&&u[1]<0;if(u[0]>0&&u[1]>0&&u[0]!==u[1])e=[c.slice(0,2).join(" "),c.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(d)e=c.join(" "),i.push("chunkSplit");else if(o.length===6){if(p[1]===2||p[2]===2)if(!Object.values(h).includes(3))e=c.join(" "),i.push("chunkSplit");else{let[g,v,b,y,I,w]=o,S=u.reduce((T,D,C)=>D<0?C:T,void 0);if(S===0){let T=Math.min(b,y);e=`${g}-${v}(${T}) ${I}-${w}`,i.push("chunkSplitTiebreak1")}else if(S===1){let T=Math.min(I,w);e=`${g}-${v} ${b}-${y}(${T})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${b}-${y}`,i.push("chunkSplitTrimExtraneous")}}else if(o.length===8){let[g,v,b,y,I,w,S,T]=o;m||A?o[5]===1&&(m?e=`${g}-${v}(${b}) ${y}-${I} [${w}${S}-${T}]`:e=`${g}-${v} ${b}-${y}(${I}) [${w}${S}-${T}]`):(u[0],u[1])}}}return{score:e,applied:i,matchUpStatus:r}}function hDe(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let c=l.match(n).slice(1).map(d=>Number.parseInt(d)),u=c[0]>c[1]&&1||c[1]>c[0]&&2;u&&(e[u-1]+=1,i.push(u))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,s=e[0]>0&&e[0]===e[1],o=e.reduce((l,c)=>l+c,0);return{setsWon:e,setsTied:s,setWinners:i,totalSets:o,winningSide:a}}function ZJe({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),s=a.length;t=a.map((u,d)=>{if(new RegExp(t1).test(u)){let f=u.slice(3),h=u.slice(0,3),m=h.split("-");if(!iC(h)&&!e){let A=Math.max(...m),g=h.indexOf(A),v=[A,A-1];return g&&v.reverse(),v.join("-")+f}}else if(u.length===2&&Un(u))return u.split("").join("-");u=k$(u);let p=new RegExp(`^${l9}$`).test(u)&&"super"||new RegExp(`^${t1}$`).test(u)&&"tiebreak"||new RegExp(`^${B$}$`).test(u)&&"standard"||"unknown";if(r.push(p),s>1&&p==="standard"&&d<2){let[f,h]=u.split("-"),m=Math.abs(parseInt(f)-parseInt(h)),A=Math.max(f,h),g=Math.min(f,h),v=[parseInt(f),parseInt(h)].indexOf(g);if(A>9&&m>2){let b=A.toString().split(""),y=b.find(I=>parseInt(I)>g||d&&parseInt(I)<=n)??b[0];y&&(u=v?[y,g].join("-"):[g,y].join("-"))}A>(n||0)&&(n=A)}if(p==="standard"){let[f,h]=u.split("-");if(!Math.abs(parseInt(f)-parseInt(h))&&e!=="RETIRED")return""}return u}).filter(Boolean).join(" ");let{setsWon:o,setWinners:l,totalSets:c}=hDe(t);if(c===1&&i?.removed==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...o)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...o)>2){let u=[0,0];t=t.split(" ").map((d,p)=>(u[l[p]]+=1,Math.max(...u)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function JJe({score:t}){let{setsTied:e,winningSide:i}=hDe(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let o=t.match(r).slice(1)[0],l=o<=8?10:o+2;t=t.replace(r,` [${l}-${o}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let s=a.split("(").join("").split(")").join("").split("-");if(!s.every(o=>Un(o)))return{score:t};if(s[0]==="76"){let o=s[1].length===2?Math.min(...s[1].split("").map(l=>parseInt(l))):s[1];t=[...n.slice(0,n.length-1),`7-6(${o})`].join(" ")}else{s=s.map(c=>parseInt(c));let o=Math.max(...s),l=Math.abs(s[0]-s[1]);if(o>=10){if(l>2&&s.every(c=>+c>=10)){let c=s.map(u=>u===o?u-10:10).sort();l=Math.abs(c[0]-c[1]),l>2&&(s=c)}t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" ")}else n.length===3&&o>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" "))}return{score:t}}function eet({score:t}){return t=t?.toString().toLowerCase()||"",{score:t}}function tet({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function iet({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=Q_(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=fDe({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function ret({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&s3(t)?{score:s3(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function net({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t?.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function aet({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let n=e?.matchUpStatuses?.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function set({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(def|defaulted)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleDefaulted"),{score:s.trim(),matchUpStatus:"defaulted",applied:i}}let n=e?.matchUpStatuses?.defaulted,a=["dft",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleDefaulted"),{matchUpStatus:"defaulted",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function oet({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function cet({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function uet({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function det({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function pet({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[s,o]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${s}-${o}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Un(i))&&e.length===4&&(t=e)}return{score:t}}function fet({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var het={handleTiebreakSlashSeparation:det,handleSetSlashSeparation:cet,punctuationAdjustments:zJe,handleGameSeparation:uet,joinFloatingTiebreak:WJe,handleBracketSpacing:qJe,handleSpaceSeparator:pet,separateScoreBlocks:iet,matchKnownPatterns:KJe,removeDanglingBits:oet,removeErroneous:ret,handleDefaulted:set,handleWalkover:net,properTiebreak:YJe,handleNumeric:fDe,handleRetired:aet,containedSets:XJe,sensibleSets:ZJe,stringScore:eet,superSquare:JJe,setBuilder:pDe,excisions:fet,replaceOh:tet},tG={},met=["handleNumeric","handleWalkover","handleRetired","handleDefaulted","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],Aet=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function mDe(t){if(!t.score)return{error:we};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:s,profile:o}=t,l=[],c,u=[],d,p,f=e,h=A=>{A.forEach(g=>{p=het[g]({profile:o,identifier:r,matchUpStatus:c,attributes:d,applied:u,score:f});let v=p.score!==f;v&&l.push({method:g,score:p.score}),a&&(s||v||p.matchUpStatus!==c)&&console.log(c?{score:p.score,matchUpStatus:c}:{score:p.score},g),p.matchUpStatus&&(c=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(u=p.applied),f=p.score})};h(met);let m=Rie(f);return m||(f=e.toString().replaceAll(/\D/g,""),d?.removed&&(d.removed=void 0),h(Aet),m=Rie(f),m||(f="")),u.forEach(A=>{tG[A]||(tG[A]=0),tG[A]+=1}),{matchUpStatus:c?.toUpperCase(),modifications:l,attributes:d,isValid:m,score:f}}var ADe={};Li(ADe,{analyzeScore:()=>u9,analyzeSet:()=>i1,checkScoreHasValue:()=>wa,checkSetIsComplete:()=>M$,getSetComplement:()=>p9,getTiebreakComplement:()=>x$,isValidMatchUpFormat:()=>Zl,parseScoreString:()=>sN,validateMatchUpScore:()=>gDe,validateScore:()=>d9,validateSetScore:()=>c9,validateTieFormat:()=>Jo});function get(t,e,i,r,n,a=!1){return n?{isValid:!0}:t===0&&e===0?{isValid:!1,error:"Tiebreak-only set requires both scores"}:t<r?{isValid:!1,error:`Tiebreak-only set winner must reach at least ${r}, got ${t}`}:i<(a?1:2)?{isValid:!1,error:a?`Tiebreak-only set (NoAD) must be won by at least 1 point, got ${t}-${e}`:`Tiebreak-only set must be won by at least 2 points, got ${t}-${e}`}:a?{isValid:!0}:t===r&&e>r-2?{isValid:!1,error:`Tiebreak-only set at ${r}-${e} requires playing past ${r}`}:t>r&&i!==2?{isValid:!1,error:`Tiebreak-only set past ${r} must be won by exactly 2 points, got ${t}-${e}`}:{isValid:!0}}function vet(t,e,i,r){let n=r===i?i+1:i,a=r;return t!==n?{isValid:!1,error:`Tiebreak set winner must have ${n} games, got ${t}`}:e!==a?{isValid:!1,error:`Tiebreak set loser must have ${a} games, got ${e}`}:{isValid:!0}}function yet(t,e,i){let r=Math.max(t||0,e||0),n=Math.min(t||0,e||0),a=r-n,s=i.tiebreakTo||7;return r<s?{isValid:!1,error:`Tiebreak winner must reach ${s} points, got ${r}`}:a<2?{isValid:!1,error:`Tiebreak must be won by 2 points, got ${r}-${n}`}:n>=s-1&&a>2?{isValid:!1,error:`Tiebreak score ${r}-${n} is invalid`}:{isValid:!0}}function bet(t,e,i,r){return r?t===i+1&&e<i-1?{isValid:!1,error:`With tiebreak format, if side 1 has ${i+1} games, side 2 must be at least ${i-1}, got ${e}`}:e===i+1&&t<i-1?{isValid:!1,error:`With tiebreak format, if side 2 has ${i+1} games, side 1 must be at least ${i-1}, got ${t}`}:{isValid:!0}:{isValid:!0}}function Iet(t,e,i,r,n){if(t<r)return{isValid:!1,error:`Set winner must reach ${r} games, got ${t}`};let a=n&&t===r&&e===n&&i===1;if(i<2&&!a)return{isValid:!1,error:`Set must be won by at least 2 games, got ${t}-${e}`};if(n){if(e>=n&&!a)return{isValid:!1,error:`When tied at ${n}-${n}, must play tiebreak. Use format like ${n+1}-${n}(5)`};let s=n===r?r+1:r;if(t>s)return{isValid:!1,error:`With tiebreak format, set score cannot exceed ${s}-${n}. Got ${t}-${e}`}}else if(t>r+10)return{isValid:!1,error:`Set score ${t}-${e} exceeds reasonable limits`};return{isValid:!0}}function wet(t,e,i){let r=t.side1TiebreakScore,n=t.side2TiebreakScore,a=e&&i?r:t.side1Score||t.side1||0,s=e&&i?n:t.side2Score||t.side2||0;return{side1Score:a,side2Score:s,side1TiebreakScore:r,side2TiebreakScore:n}}function Uet(t,e,i,r,n,a,s){if(i&&r){let o=vet(t,e,i,r);if(!o.isValid)return o}return(n!==void 0||a!==void 0)&&s?yet(n,a,s):{isValid:!0}}function Tet(t,e,i){return i&&(t>i+10||e>i+10)?{isValid:!1,error:`Set score ${t}-${e} exceeds expected range for ${i}-game sets`}:{isValid:!0}}function Cet(t,e,i){let{side1:r,side2:n,winner:a,loser:s,diff:o}=t,{setTo:l,tiebreakAt:c}=e;if(l&&c){let u=bet(r,n,l,c);if(!u.isValid)return u}return i?Tet(a,s,l):l?Iet(a,s,o,l,c):{isValid:!0}}function c9(t,e,i,r){if(!e)return{isValid:!0};let n=ys(e);if(!n)return{isValid:!0};let a=i&&n.finalSetFormat?n.finalSetFormat:n.setFormat;if(!a)return{isValid:!0};if(a.timed){if(!r){let w=t.side1Score??0,S=t.side2Score??0;if(w===0&&S===0)return{isValid:!1,error:"Timed set requires at least one side to have scored"};if(a.based==="P"&&w===S&&w>0&&a.tiebreakFormat&&!(t.side1TiebreakScore!==void 0||t.side2TiebreakScore!==void 0))return{isValid:!1,error:"Tied timed set requires tiebreak"}}return{isValid:!0}}let{setTo:s,tiebreakAt:o,tiebreakFormat:l,tiebreakSet:c}=a,u=c?.tiebreakTo,d=!!u&&!s,p=t.side1TiebreakScore!==void 0&&t.side2TiebreakScore!==void 0,{side1Score:f,side2Score:h,side1TiebreakScore:m,side2TiebreakScore:A}=wet(t,d,p),g=Math.max(f,h),v=Math.min(f,h),b=g-v;if(d){let w=t.NoAD??a.tiebreakSet?.NoAD??!1;return get(g,v,b,u,r??!1,w)}let y=m!==void 0||A!==void 0,I=s&&g===s+1&&v===s;return y||I?Uet(g,v,s,o,m,A,l):Cet({side1:f,side2:h,winner:g,loser:v,diff:b},{setTo:s,tiebreakAt:o},r)}function gDe(t,e,i){if(!t||t.length===0)return{isValid:!0};let r=e?.match(/SET(\d+)/)?.[1],n=r?Number.parseInt(r):3,a=[Ha,Zr,Nr].includes(i||"");for(let s=0;s<t.length;s++){let o=t[s],l=s+1===n,c=o.winningSide!==void 0,u=c9(o,e,l,a||i===void 0&&!c);if(!u.isValid)return{isValid:!1,error:`Set ${s+1}: ${u.error}`}}return{isValid:!0}}function Eet(t,e,i,r,n,a){let{tiebreakTo:s,NoAD:o}=t||{},l=Math.max(e??0,i??0);return!(o&&l>s||l<s&&r&&(n&&!a||!n))}function Det(t,e,i,r,n,a){let s=e+1===r,{side1Score:o,side2Score:l,side1TiebreakScore:c,side2TiebreakScore:u,winningSide:d}=t,p=Math.max(o??0,l??0),f=c??u,{finalSetFormat:h,setFormat:m}=i,A=s&&h||m;return f&&!Eet(A?.tiebreakFormat,c,u,d,n,a)?!1:A.setTo?!(!A.noTiebreak&&p>A.setTo+1):!0}function Pet(t){let e=t.reduce((i,r)=>((r.side1Score!==void 0||r.side2Score!==void 0)&&(i[0]+=r.side1Score??0,i[1]+=r.side2Score??0),i),[0,0]);return e[0]>e[1]?1:e[1]>e[0]?2:t.find(i=>i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)?.winningSide}function Ret(t,e,i,r,n){return(!n||t===e)&&i===1&&r.indexOf(t)+1||void 0}function u9({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){let a=n?.sets??[],s=(a?.filter(w=>w?.winningSide)||[]).reduce((w,S)=>{let{winningSide:T}=S;if(!T)return w;let D=T-1;return w[D]++,w},[0,0]),o=r?r-1:void 0,l=o!==void 0&&[0,1].includes(o)?1-o:void 0,c=o!==void 0&&s[o],u=l!==void 0&&s[l],d=e?ys(e):void 0,p=Math.max(...s),f=Xl(s)[p],h=d?.setFormat?.timed||d?.finalSetFormat?.timed,m=d?.bestOf||d?.exactly,A=m&&Math.ceil(m/2)||1,g=i??t,v=!!(g&&[Nr,Ha,Zr].includes(g)),b=!d||!a.length||a.every((w,S)=>Det(w,S,d,m??0,S===a.length-1,v)),y=d?.setFormat?.based==="A"||d?.finalSetFormat?.based==="A",I=y&&a.length>0?Pet(a):Ret(p,A,f,s,e);return{valid:!!(b&&(r&&y&&r===I||r&&!y&&c>u&&r===I||r&&v||!r&&!I&&(![Hn,Nr,Ha,Zr].includes(g)||h&&g===Hn)))}}function d9({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:we};let{sets:a,scoreStringSide1:s,scoreStringSide2:o}=n,l="scoreString must be a string!";if(s!==void 0&&typeof s!="string")return{error:we,info:l};if(o!==void 0&&typeof o!="string")return{error:we,info:l};if(a!==void 0&&!Array.isArray(a))return{error:we,info:Gy("sets")};if(a?.length){let c=a.map(d=>d?.setNumber).filter(Boolean);if(c.length!==Ei(c).length)return{error:we,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:f,side1TiebreakScore:h,side2TiebreakScore:m,side1PointScore:A,side2PointScore:g,winningSide:v,setNumber:b}=d;if(![[p,f],[h,m],[A,g]].filter(y=>y.some(I=>![void 0,null].includes(I))).every(y=>y.every(I=>wi(I))))return{error:we,info:"non-numeric values"};if(![b,v].filter(y=>![void 0,null].includes(y)).every(y=>wi(y)))return{error:we,info:"non-numeric values"};if(v&&![1,2].includes(v))return{error:we,info:"winningSide must be 1 or 2"}}let{valid:u}=u9({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!u)return{error:bwe,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var p9=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let s=ci(i);s?.toString().length>2&&(s=Number.parseInt(s.toString().slice(0,2))),n&&n<r&&s>n&&(s=n);let o;return a&&!n?s>r?o=r:o=s<r?r:r-1:o=s+1<r&&r||n&&n<r&&s===n&&r||!n&&s+2||r+1,[e?s:o,e?o:s]},x$=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?Number.parseInt(i):i;a?.toString().length>2&&(a=Number.parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let s=Met({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:s,e?s:a]};function Met(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function o3(t,e){return t>e&&1||t<e&&2||void 0}function Net(t,e){return e?{side1Score:t[0],side2Score:t[1],winningSide:o3(t[0],t[1])}:{side1TiebreakScore:t[0],side2TiebreakScore:t[1],winningSide:o3(t[0],t[1])}}function sN({tiebreakTo:t=7,scoreString:e="",matchUpFormat:i}){let r,n=3;if(i)try{r=ys(i);let u=/SET(\d+)/.exec(i)?.[1];n=u?Number.parseInt(u):3}catch{}return e?.split(" ").filter(Boolean).map((u,d)=>c({set:u,setNumber:d+1}));function a(u,d){if(!r||!d)return!1;let p=u===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;if(!p)return!1;let f=p.tiebreakSet?.tiebreakTo,h=p.setTo;return!!f&&!h}function s(u){if(!r)return t;let d=u===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;return d?.tiebreakSet?.tiebreakTo??d?.tiebreakFormat?.tiebreakTo??t}function o(u,d,p){let f=u[1],h=s(p),m=x$({lowValue:f,isSide1:d===2,tiebreakTo:h});return Array.isArray(m)?[m[0],m[1]]:[void 0,void 0]}function l(u,d,p,f){let h=(d&&u.replace(d[0],"")||p&&u.replace(p[0],"")||u).split("-").map(y=>Number.parseInt(y)),m=h[0],A=h[1],g=o3(m,A),v,b;if(d&&([v,b]=o(d,g,f)),p){let y=p[1].split("-").map(I=>Number.parseInt(I));v=y[0],b=y[1]}return{side1Score:m,side2Score:A,side1TiebreakScore:v,side2TiebreakScore:b,winningSide:g}}function c({set:u,setNumber:d}){let p=/\(([^)]+)\)/,f=/\[([^\]]+)\]/,h=p.exec(u),m=f.exec(u),A=u?.startsWith("[")&&m,g=a(d,!!A),v=s(d),b=g&&v===1,y;if(A){let I=m[1].split("-").map(w=>Number.parseInt(w));y=Net(I,g)}else y=l(u,h,m,d);return{side1Score:y.side1Score,side2Score:y.side2Score,side1TiebreakScore:y.side1TiebreakScore,side2TiebreakScore:y.side2TiebreakScore,winningSide:y.winningSide,setNumber:d,...b&&{NoAD:!0},...g&&{tiebreakSet:!0}}}}function Bet({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=N$({set:n});return M$({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r})&&a||void 0}function i1(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:b2};let{setNumber:r}=e||{},{bestOf:n,exactly:a}=i||{},s=n||a,o=!!(r&&s&&r===s),l=o&&i?.finalSetFormat||i?.setFormat,c=!!l?.tiebreakSet,u=!!l?.timed,d=!c&&!u,p=!!(r&&s&&r<=s),f=[e?.side1Score,e?.side2Score],h=[e?.side1PointScore,e?.side2PointScore],m=[e?.side1TiebreakScore,e?.side2TiebreakScore],A=f.filter(x=>x!==void 0).length,g=h.filter(x=>x!==void 0).length,v=m.filter(x=>x!==void 0).length,b=f?.filter(x=>!isNaN(x)).length,y=m?.filter(x=>!isNaN(x)).length,{tiebreakAt:I}=l||{},w=I&&f.filter(x=>x>=I).length===2,S=w&&(f[0]>f[1]&&1||f[1]>f[0]&&2||void 0),T=!!(y&&!b),D=!!e?.winningSide,{error:C,result:E}=ket({sideTiebreakScores:m,sideGameScores:f,setFormat:l,setObject:e}),{error:P,result:R}=xet({sideTiebreakScores:m,setObject:e,setFormat:l}),M=d&&!T&&E||c&&T&&R||u,N=p&&!(c&&!T)&&!(d&&T)&&(!D||M),k=Bet({isTimedSet:u,matchUpScoringFormat:i,isDecidingSet:o,isTiebreakSet:T,setObject:e}),O={expectTiebreakSet:c,expectTimedSet:u,hasTiebreakCondition:w,isCompletedSet:D,isDecidingSet:o,isTiebreakSet:T,isValidSet:N,isValidSetNumber:p,isValidSetOutcome:M,leadingSide:S,setFormat:l,sideGameScores:f,sideGameScoresCount:A,sidePointScores:h,sidePointScoresCount:g,sideTiebreakScores:m,sideTiebreakScoresCount:v,winningSide:k};return e?.winningSide!==void 0&&(T?(O.isValidTiebreakSetOutcome=R,R||(O.tiebreakSetError=P)):(O.isValidStandardSetOutcome=E,E||(O.standardSetError=C))),O}function ket({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:b2};let n=!!e?.tiebreakSet,a=!!e?.timed;if(!e||n||a)return{result:!1,error:we};if(i?.filter(S=>!isNaN(S)).length!==2)return{result:!1,error:T4};let{setTo:s,tiebreakAt:o,tiebreakFormat:l,NoAD:c}=e||{};if(!(s&&i?.find(S=>S>=s)))return{result:!1,error:T4};let u=[1,2].includes(t?.winningSide);if(!t||!u)return{result:!1,error:I2};let d=t?.winningSide-1,p=1-d,f=i[d],h=i[p],m=f-h;if(!(f>h))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let A=o&&l,g=r?.filter(S=>!isNaN(S)).length===2,v=r?.[d],b=r?.[p],y=o&&i.filter(S=>S>=o).length===2;if(A){let{NoAD:S,tiebreakTo:T}=l;if(y){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!g)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(T))return{result:!1,error:{message:"tiebreakTo error"}};if(!(T&&r?.find(R=>R>=T)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let D=o<s?s:s+1;if(f>D)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!v||!b||v<b)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let C=S?1:2,E=v-b,P=b>=T-1;if(E&&P&&E<C)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(f>s&&!y)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let I=c?1:2,w=h>=s-1;return m&&w&&!y&&m<I?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>I&&f>s?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function xet({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:b2};let r=!!e?.tiebreakSet,n=!!e?.timed;if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t?.winningSide);if(!t||!a)return{result:!1,error:I2};let{tiebreakSet:s}=e||{},{NoAD:o,tiebreakTo:l}=s||{};if(i?.filter(A=>!isNaN(A)).length!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!i?.find(A=>A>=l))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let c=t?.winningSide-1,u=1-c,d=i[c],p=i[u];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let f=o?1:2,h=d-p,m=p>=l-1;return h&&m&&h<f?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}function _et(t){let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:r,tieFormatName:n,matchUpType:a,eventType:s,isMock:o,event:l}=t,{tieFormat:c,matchUpFormat:u}=t;if(a===da&&s===da){let d=e?.structures?.find(({stage:p})=>p===Et)?.tieFormat;c=c||d||n&&l?.tieFormat?.tieFormatName===n&&l.tieFormat||n&&Qm({namedFormat:n,hydrateCollections:i,isMock:o,event:l})||l?.tieFormat||Qm({event:l,isMock:o,hydrateCollections:i}),u=void 0}else u||(c=void 0,l?.matchUpFormat||(u=ld));if(c){let d=Jo({gender:l?.gender,enforceGender:r,tieFormat:c});if(d.error)return d}return{tieFormat:c,matchUpFormat:u}}function Oet(t){let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:r,qualifyingOnly:n,drawEntries:a,structureId:s,tieFormat:o,idPrefix:l,isMock:c,event:u}=t,d=t.qualifyingProfiles,p=d?.length?IEe({hasExistingDrawDefinition:!0,uuids:t.uuids,qualifyingProfiles:d,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,idPrefix:l,isMock:c}):void 0;if(p?.error)return p;e.structures=e.structures?.filter(({structureId:I})=>I!==i),e.links=e.links?.filter(({source:I})=>I.structureId!==i);let{qualifiersCount:f,qualifyingDrawPositionsCount:h,qualifyingDetails:m}=p??{};h&&(p?.structures&&e.structures?.push(...p.structures),p?.links&&e.links?.push(...p.links));let A=e.structures?.find(({stage:I,stageSequence:w})=>I===Et&&w===1),{qualifiersCount:g}=TE({stageSequence:1,drawDefinition:e,structureId:s,stage:Et}),v=Math.max(f??0,g??0),b=mCe({qualifiersCount:v,drawDefinition:e,stage:Et});if(b.error||(b=$_({drawSize:h,stage:qt,drawDefinition:e}),b.error))return b;Fet({drawDefinition:e,drawEntries:a,event:u});let y=Let({mainStructure:A,qualifyingDetails:m,drawDefinition:e});return y.error?y:{drawDefinition:e,structureId:s}}function Fet({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===qt)){let n={...r,entryStage:r.entryStage??Et,drawDefinition:t,event:i};l7(n)}}function Let({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){for(let r of e||[]){let{finalQualifyingRoundNumber:n,finalQualifyingStructureId:a,roundTarget:s,finishingPositions:o,linkType:l}=r,c=t&&KM({targetStructureId:t.structureId,sourceStructureId:a,sourceRoundNumber:n,finishingPositions:o,targetEntryRound:s,linkType:l})?.link;if(c?.error)return c;c&&(i.links||(i.links=[]),i.links.push(c))}return{error:void 0}}function vDe(t){let{participantIds:e}=t,i=t.drawDefinition?.entries?.filter(r=>{let n=r.entryStatus;return!t.restrictEntryStatus||Nd.includes(n)}).map(qi)??[];if(e){let r=e.filter(n=>!i?.includes(n));if(r?.length)return ce({result:{error:lp},info:{invalidParticipantIds:r}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:we,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:we,info:"roundsCount must be less than 32"}:{participantIds:e}}function f9(t){let e=[],{roundsCount:i=1,drawDefinition:r,matchUpsCount:n,structureId:a,idPrefix:s,isMock:o,event:l}=t,c,u=vDe(t);if(u.error)return u;for(let d of vt(1,i+1)){let p=D$({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!c,newRound:!c,drawDefinition:r,matchUpsCount:n,structureId:a,roundNumber:c,idPrefix:s,isMock:o,event:l});if(p.error)return ce({result:p,info:{iteration:d}});p.matchUps?.length&&e.push(...p.matchUps),c=(p?.roundNumber??1)+1}return{matchUps:e}}function $et(t){let{tournamentRecord:e,participantIds:i,scaleName:r,eventType:n,adHocRatings:a={}}=t,s=t.scaleAccessor??qa[r]?.accessor,o=e.participants??[];for(let l of i??[]){let c=o?.find(d=>d.participantId===l),u=Nie({scaleName:`${r}.${bY}`,participant:c,eventType:n});!u&&r&&(u=Nie({scaleAccessor:s,participant:c,scaleName:r,eventType:n})),u&&!a[l]&&(a[l]=u)}return a}function Nie({scaleType:t=sg,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){let a=(i&&lh({scaleAttributes:{eventType:n??iw,scaleType:t,scaleName:r},participant:i}))?.scaleItem?.scaleValue;return e&&Xi(a)?a[e]:a}function h9(t){let e=Vet(t);if(e?.error)return e;let i=vDe(t);if(i.error)return i;let r=Het(t);if(r.error)return r;let n=$et(t),a=t.tournamentRecord?.isMock??t.isMock,s=t.eventType??t.event?.eventType,o=[],l=[],c;for(let u of vt(1,(t.roundsCount??1)+1)){let d=i9({...t,participantIds:i.participantIds,structure:r.structure,ignoreLastRoundNumber:!0,iterationMatchUps:o,adHocRatings:n,roundNumber:c,eventType:s,isMock:a});if(d.error)return d;let{matchUps:p,...f}=d;f.modifiedScaleValues&&(n=f.modifiedScaleValues),l.push({...f,iteration:u,matchUpsCount:p?.length}),c=(f?.roundNumber??1)+1,p?.length&&o.push(...p)}return{...oe,matchUps:o,roundResults:l}}function Het(t){if(t.structureId)return t.structureId;let e=t.drawDefinition,i=e?.structures?.filter(n=>n.stageSequence===1)?.reduce((n,a)=>{let s=a.stage&&rw[a.stage];return el({structure:a})&&s>(rw[n?.stage]||1)?a:n},void 0),r=e?.structures?.find(n=>n.structureId===i?.structureId);return r?el({structure:r})?{structure:r}:{error:EI}:{error:an}}function Vet(t){return t.roundsCount&&typeof t.roundsCount!="number"?{error:we,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==ec?{error:EI}:!Array.isArray(t.drawDefinition?.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:we,info:"Missing Entries"}:{error:void 0}}function Get(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,idPrefix:n,isMock:a,event:s}=t,o=s?.entries?.filter(({entryStage:u,entryStatus:d})=>(!u||u===Et)&&d&&Nd.includes(d)),l=o?.map(qi),c=o?Math.floor(o.length/2):0;if(t.automated)return Qet({...t,participantIds:l});{let u=f9({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:c,idPrefix:n,isMock:a,event:s});if(u.error)return u;u.matchUps?.length&&U$({matchUps:u.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:r,event:s})}return{...oe}}function Qet(t){let{restrictEntryStatus:e,generateMatchUps:i,structureId:r,matchUpIds:n,scaleName:a,scaleAccessor:s}=t.drawMatic??{},o=h9({...t,eventType:t.drawMatic?.eventType??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:s??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:r,matchUpIds:n});return o.error?o:(o?.matchUps?.length&&U$({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:o.matchUps,event:t.event,structureId:r}),{...oe})}function jet({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,seedsCount:c}){r=r??n;let u=di({drawDefinition:s,structureId:l});if(u.error)return u;let d=u.structure;if(!d)return{error:an};let{positionAssignments:p}=Ia({structure:d}),f=p?.length||0;if(c>f)return{error:XIe};let h=d.structures?.length,m=wi(o?.groupSeedingThreshold)&&o?.groupSeedingThreshold,A=g7({roundRobinGroupsCount:h,drawSize:f})?.seedGroups,{seedsCount:g}=nN({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:f});return g&&a?.[Ku]&&c>g&&e&&(c=g),d.seedLimit=c,d.seedAssignments=vt(1,c+1).map(v=>{let b=A?.find(w=>w.includes(v)),y=b&&Math.min(...b),I=m&&v>=m?y:v;return{participantId:void 0,seedNumber:v,seedValue:I}}),kr({drawDefinition:s,structureIds:[l]}),{...oe,seedLimit:c}}function SS({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:s,stage:o}){if(!e)return{error:nt};a=a??s?.entries??[];let l=a.filter(f=>(!o||!f.entryStage||f.entryStage===o)&&(!n||!f.entryStageSequence||f.entryStageSequence===n)&&Nd.includes(f.entryStatus)),c={...i};return{scaledEntries:l.map(f=>{let{participantId:h}=f,{scaleItem:m}=lw({tournamentRecord:e,scaleAttributes:i,participantId:h});return{...f,...m}}).filter(f=>{let h=f.scaleValue;return!r&&(Number.isNaN(h)||!Number.parseFloat(h))?!1:h}).sort(r||(t||c?.ascending===!1?d:u))};function u(f,h){return p(f)-p(h)}function d(f,h){return p(h)-p(f)}function p(f){return Number.parseFloat(f.scaleValue||(t?-1:1e5))}}function yDe(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=Td({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r?.find(({structureId:f})=>!n.includes(f));if(!a)return ce({result:{error:an},stack:e});let s=a?.structureId,{seedsCount:o,stageEntries:l,seedLimit:c}=Jet({...t,structureId:s});(t.seededParticipants||t.event||t.seedingScaleName)&&Wet({...t,seedsCount:o,structure:a,structureId:s});let u=t.automated!==!1&&t.drawType!==ec&&!(t.qualifyingOnly&&t.stage!==qt),d=(r?.length||0)>1,p=u?qet({...t,multipleStructures:d,seedLimit:c,structureId:s}):{};return p?.error?ce({result:p,stack:e}):{...p,stageEntries:l,structureId:s,seedsCount:o}}function zet({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{let a=ki({name:Mf,element:n})?.extension?.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!a||a===r)&&Ub.includes(n.entryStatus)})}function qet(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=WM({...t,seedsOnly:e});if(i.error)return i;let r=i?.positionAssignments,n=i?.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function Wet(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(qi);e?Ket({...t,enteredParticipantIds:a}):(n||i)&&Yet({...t,enteredParticipantIds:a})}function Ket(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,structure:c,event:u}=t,d=c?yS({provisionalPositioning:e,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structure:c}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,f)=>p.seedNumber<f.seedNumber?-1:p.seedNumber<f.seedNumber?1:0).forEach(p=>{let{participantId:f,seedNumber:h,seedValue:m}=p;EE({provisionalPositioning:e,tournamentRecord:n,drawDefinition:s,seedingProfile:o,participantId:f,seedBlockInfo:d,structureId:l,seedNumber:h,seedValue:m,event:u})})}function Yet(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:s,drawDefinition:o,seedByRanking:l,seedingProfile:c,structureId:u,event:d}=t,{categoryName:p,ageCategoryCode:f}=d?.category||{};d?.eventType;let h=Xet({...t})||l&&Zet({...t}),m=h?.length??0;m<e&&(e=m),h?.filter(({participantId:A})=>r.includes(A)).slice(0,a||e).forEach((A,g)=>{let v=g+1,{participantId:b,scaleValue:y}=A,I=n?.[v]||y||v;EE({provisionalPositioning:i,tournamentRecord:s,drawDefinition:o,seedingProfile:c,participantId:b,structureId:u,seedNumber:v,seedValue:I,event:d})})}function Xet(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:s}=t,{categoryName:o,ageCategoryCode:l}=s?.category||{},c=s?.eventType,u={scaleName:i||o||l||s.eventId,scaleType:sh,eventType:c};return SS({scaleAttributes:u,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function Zet(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:s,ageCategoryCode:o}=r?.category||{},l=r?.eventType;return SS({scaleAttributes:{scaleName:s||o,scaleType:wg,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function Jet(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=zet(t);e>i.length&&(e=i.length);let{seedLimit:r}=jet({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function ett(t){let e=e9({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:s,seedingProfile:o,participants:l,drawEntries:c,placeByes:u,drawSize:d,drawType:p,entries:f}=t,h=[],m=[],A=ttt({ignoreStageSpace:n,drawDefinition:i,drawEntries:c,drawType:p,entries:f});if(A.error)return A;let g=p===yb?0:ci(t.seedsCount??0),v=yDe({...t,qualifyingOnly:!d||s,appliedPolicies:a,drawDefinition:i,seedingProfile:o,participants:l,stage:Et,seedsCount:g,placeByes:u,drawSize:d,entries:f});if(v.error&&!v.conflicts)return v;v.positioningReport?.length&&h.push({[Et]:v.positioningReport});let b=v.structureId;return v.conflicts&&(m=v.conflicts),p===ec&&t.roundsCount&&Get({...t,drawDefinition:i,structureId:b}),{drawDefinition:i,positioningReports:h,conflicts:m,structureId:b}}function ttt(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let s of a){if(r&&s.entryStage&&s.entryStage!==Et)continue;let o={...s,ignoreStageSpace:e??n===ec,entryStage:s.entryStage??Et,event:t.event,drawDefinition:i,drawType:n},l=l7(o);if(r&&l.error)return l}return{error:void 0}}var itt=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),rtt=itt;function ntt(t){let{drawId:e=hr(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=rtt();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function m9(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:s,event:o}=t,l=Qt(t,[{[ro]:!0,[hY]:!0}]);if(l.error)return l;if(!Zl({matchUpFormat:n}))return{error:lM};let c="setMatchUpFormat";if(s){let u=Yr({drawDefinition:r,matchUpId:s,event:o});if(u.error)return u;let d=u.matchUp;if(d?.matchUpType===da)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:wl};d&&(d.matchUpFormat=n,Zi({tournamentId:i?.tournamentId,eventId:o?.eventId,context:c,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if(o?.eventType===da)return{error:Th};for(let u of e){let d=di({drawDefinition:r,structureId:u});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if(o?.eventType===da)return{error:Th};let u=di({drawDefinition:r,structureId:a});if(u.error)return u;u.structure&&(u.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),kr({drawDefinition:r,structureIds:e}),{...oe}}function att({tieFormat:t}){let e=Jo({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=hr());return{tieFormat:t}}function stt({existingQualifyingStructures:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUpType:n,tieFormat:a,event:s}){if((r||a)&&!(r&&s?.matchUpFormat===r||s?.tieFormat&&a&&JSON.stringify(s.tieFormat)===JSON.stringify(a))){if(a){let o=att({tieFormat:a});if(o.error)return o;let l=t?.every(c=>c.tieFormat);(!t?.length||l)&&(i.tieFormat=o.tieFormat??a)}else if(r){let o=m9({tournamentRecord:e,drawDefinition:i,matchUpFormat:r,event:s});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}n&&(i.matchUpType=n)}return{error:void 0}}var bDe={};Li(bDe,{attachPolicies:()=>Qy,findPolicy:()=>wb,getAppliedPolicies:()=>tr,getPolicyDefinitions:()=>yA,mutate:()=>IDe,query:()=>SDe,removePolicy:()=>wDe});var IDe={};Li(IDe,{attachPolicies:()=>Qy,removePolicy:()=>wDe});function wDe(t){let e=Qt(t,[{[uYe]:!0,_anyOf:{[Js]:!1,[Ua]:!1,[ro]:!1,[gA]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return Bie(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:nt};for(let a of n){let s=t.tournamentRecords[a],o=Bie(t,s);if(o.error)return o;i=!0}}else return{error:nt};return i?{...oe}:{error:cM}}function Bie(t,e){let i=tr(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?ur({element:e,extension:{name:zP,value:i}}):Mo({element:e,name:zP}),{...oe}):{error:cM}}var SDe={};Li(SDe,{findPolicy:()=>wb,getAppliedPolicies:()=>tr,getPolicyDefinitions:()=>yA});var UDe={[Ku]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Mh]:{positioning:_y},[Sd]:{positioning:_y}},positioning:sUe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},l3=UDe;function ott({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return ce({info:"policyDefinitions must be an object",result:{error:we},stack:r});let n={[jP]:t?.[jP]};return e?ltt({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&Qy({drawDefinition:i,policyDefinitions:n}),!t?.[Ku]&&!e?.[Ku]&&(Qy({policyDefinitions:l3,drawDefinition:i}),t&&Object.assign(t,l3)),{error:void 0}}function ltt({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e?.[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(Qy({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function ctt(t){let{tournamentRecord:e,policyDefinitions:i,appliedPolicies:r,matchUpFormat:n,matchUpType:a,tieFormat:s,drawType:o,stack:l,event:c}=t,u=t.drawId?c?.drawDefinitions?.find(g=>g.drawId===t.drawId):void 0,d=u?.structures?.find(g=>g.stage===Et&&g.stageSequence===1)?.structureId,p=u?u.structures?.filter(g=>g.stage===qt):[],f=p?.length===1&&!p[0].matchUps?.length&&p[0].structureId;u&&o!==u.drawType&&(u.drawType=o);let h=u??ntt({processCodes:t.processCodes,drawId:t.drawId,drawType:o}),m=stt({existingQualifyingStructures:p,tournamentRecord:e,drawDefinition:h,matchUpFormat:n,matchUpType:a,tieFormat:s,event:c});if(m.error)return ce({result:m,stack:l});let A=ott({appliedPolicies:r,policyDefinitions:i,drawDefinition:h,stack:l});return A.error?A:{drawDefinition:h,structureId:d,existingDrawDefinition:u,existingQualifyingPlaceholderStructureId:f}}function utt(t){let e="generateOrGetExisting",i=[],r=[],n=ctt(t);if(n.error)return ce({result:n,stack:e});let a=n.existingDrawDefinition,s,o,l=t.drawEntries??t.eventEntries??[],c=n.existingQualifyingPlaceholderStructureId&&Oet({...t,...n})||ett({...t,...n,entries:l});return c.error?ce({result:c,stack:e}):(c.positioningReports?.length&&i.push(...c.positioningReports??[]),c.conflicts?.length&&r.push(...c.conflicts??[]),s=c.drawDefinition,o=c.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:s,structureId:o,conflicts:r,entries:l})}function dtt(t){let{qualifyingPlaceholder:e,existingDrawDefinition:i,positioningReports:r,qualifyingProfiles:n,appliedPolicies:a,qualifyingOnly:s,drawDefinition:o,seedingProfile:l,participants:c,structureId:u,tieFormat:d,entries:p,stack:f}=t,h=e&&!n?.length&&!i,m=[];if(n){let A=(y,I)=>y.stageSequence-I.stageSequence,g=(y,I)=>y.roundTarget-I.roundTarget,v=[],b=1;n.sort(g);for(let y of n){if(!Array.isArray(y.structureProfiles))return ce({info:Gy("structureProfiles"),result:{error:Yt},stack:f});b=y.roundTarget||b;let I=y.structureProfiles?.sort(A)||[],w=1;for(let S of I){let{qualifyingRoundNumber:T,qualifyingPositions:D,seededParticipants:C,seedingScaleName:E,seedsCount:P=0,seedByRanking:R,placeByes:M,drawSize:N}=S,k=yDe({...t,seedingProfile:S.seedingProfile??l,stageSequence:w,qualifyingRoundNumber:T,preparedStructureIds:v,qualifyingPositions:D,seededParticipants:C,stage:qt,seedingScaleName:E,appliedPolicies:a,drawDefinition:o,qualifyingOnly:s,seedByRanking:R,participants:c,roundTarget:b,seedsCount:P,placeByes:M,drawSize:N,entries:p});if(k.error)return k;k.structureId&&v.push(k.structureId),w+=1,k.conflicts?.length&&m.push(...k.conflicts),k.positioningReport?.length&&r.push({[qt]:k.positioningReport})}b+=1}}else if(u&&h){let A=nu({structureName:_s(qt),stage:qt,qualifyingOnly:s,tieFormat:d}),{link:g}=KM({sourceStructureId:A.structureId,targetStructureId:u,sourceRoundNumber:0,linkType:Dh});o.structures||(o.structures=[]),o.structures.push(A),o.links||(o.links=[]),o.links.push(g)}return{qualifyingConflicts:m,error:void 0}}var TDe={};Li(TDe,{addGoesTo:()=>Vy,allCompetitionMatchUps:()=>up,allDrawMatchUps:()=>No,allEventMatchUps:()=>Wh,allPlayoffPositionsFilled:()=>U7,allTournamentMatchUps:()=>as,analyzeDraws:()=>iN,analyzeMatchUp:()=>n1,analyzeTournament:()=>T9,bulkUpdatePublishedEventIds:()=>E9,calculateWinCriteria:()=>TS,categoryCanContain:()=>hM,checkMatchUpIsComplete:()=>oy,checkValidEntries:()=>E$,compareTieFormats:()=>Jm,competitionScheduleMatchUps:()=>dN,courtGridRows:()=>q$,credits:()=>ptt,drawMatchUps:()=>H9,eventMatchUps:()=>Y$,filterMatchUps:()=>vm,filterParticipants:()=>GM,findDrawDefinition:()=>W7,findExtension:()=>ki,findVenue:()=>qh,getAggregateTeamResults:()=>U9,getAllDrawMatchUps:()=>ia,getAllEventData:()=>D9,getAllStructureMatchUps:()=>dr,getAllowedDrawTypes:()=>_$,getAllowedMatchUpFormats:()=>I9,getAppliedPolicies:()=>tr,getAssignedParticipantIds:()=>Cb,getAvailableMatchUpsCount:()=>T$,getAvailablePlayoffProfiles:()=>XM,getCategoryAgeDetails:()=>xy,getCheckedInParticipantIds:()=>hS,getCompetitionDateRange:()=>F$,getCompetitionMatchUps:()=>r1,getCompetitionParticipants:()=>A9,getCompetitionPenalties:()=>w9,getCompetitionVenues:()=>oN,getCourtInfo:()=>l$,getCourts:()=>V9,getDrawData:()=>H$,getDrawDefinitionTimeItem:()=>QY,getDrawParticipantRepresentativeIds:()=>z7,getDrawStructures:()=>Td,getDrawTypeCoercion:()=>rN,getEligibleVoluntaryConsolationParticipants:()=>j7,getEntriesAndSeedsCount:()=>W$,getEvent:()=>j9,getEventData:()=>V$,getEventMatchUpFormatTiming:()=>N9,getEventProperties:()=>G9,getEventPublishStatus:()=>Ru,getEventStructures:()=>A$,getEventTimeItem:()=>EM,getEvents:()=>Q9,getFlightProfile:()=>kn,getHomeParticipantId:()=>_9,getLinkedTournamentIds:()=>SM,getMatchUpCompetitiveProfile:()=>_M,getMatchUpContextIds:()=>O9,getMatchUpDailyLimits:()=>Z$,getMatchUpDailyLimitsUpdate:()=>B9,getMatchUpDependencies:()=>Bd,getMatchUpFormat:()=>F9,getMatchUpFormatTiming:()=>OM,getMatchUpFormatTimingUpdate:()=>M9,getMatchUpScheduleDetails:()=>c$,getMatchUpType:()=>u$,getMatchUpsMap:()=>os,getMatchUpsStats:()=>L9,getMatchUpsToSchedule:()=>G$,getMaxEntryPosition:()=>R9,getModifiedMatchUpFormatTiming:()=>K$,getPairedParticipant:()=>Cd,getParticipantEventDetails:()=>g9,getParticipantIdFinishingPositions:()=>q7,getParticipantMembership:()=>v9,getParticipantResults:()=>ZM,getParticipantScaleItem:()=>lw,getParticipantSchedules:()=>y9,getParticipantSignInStatus:()=>b9,getParticipantTimeItem:()=>jY,getParticipants:()=>vn,getPersonRequests:()=>Pb,getPolicyDefinitions:()=>yA,getPositionAssignments:()=>e1,getPositionsPlayedOff:()=>PE,getPredictiveAccuracy:()=>x9,getProfileRounds:()=>z$,getPublishState:()=>gS,getRandomQualifierList:()=>X7,getRoundMatchUps:()=>Oo,getRounds:()=>$9,getScaleValues:()=>gE,getScaledEntries:()=>SS,getScheduledRoundsDetails:()=>lN,getSchedulingProfile:()=>SA,getSchedulingProfileIssues:()=>P9,getSeedingThresholds:()=>v7,getSeedsCount:()=>nN,getStructureSeedAssignments:()=>Au,getTeamLineUp:()=>Hy,getTieFormat:()=>$$,getTimeItem:()=>Eu,getTournamentIds:()=>IM,getTournamentInfo:()=>US,getTournamentPenalties:()=>O$,getTournamentPersons:()=>S9,getTournamentPoints:()=>L$,getTournamentPublishStatus:()=>VM,getTournamentStructures:()=>S7,getTournamentTimeItem:()=>r$,getValidGroupSizes:()=>zM,getVenueData:()=>eC,getVenuesAndCourts:()=>wA,isAdHoc:()=>el,isCompletedStructure:()=>_h,isValidForQualifying:()=>Z7,isValidMatchUpFormat:()=>Zl,matchUpActions:()=>C$,participantScaleItem:()=>lh,participantScheduledMatchUps:()=>k9,positionActions:()=>Y7,publicFindCourt:()=>i7,publicFindVenue:()=>t7,tallyParticipantResults:()=>RE,tieFormatGenderValidityCheck:()=>k2,tournamentMatchUps:()=>X$,validMatchUp:()=>n$,validMatchUps:()=>Pu,validateCollectionDefinition:()=>mM,validateLineUp:()=>m$});function ptt(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Miro, Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var CDe={};Li(CDe,{filterParticipants:()=>GM,getCompetitionParticipants:()=>A9,getPairedParticipant:()=>Cd,getParticipantEventDetails:()=>g9,getParticipantMembership:()=>v9,getParticipantScaleItem:()=>lw,getParticipantSchedules:()=>y9,getParticipantSignInStatus:()=>b9,getParticipantTimeItem:()=>jY,getParticipants:()=>vn,getScaleValues:()=>gE,participantScaleItem:()=>lh,validateLineUp:()=>m$});function A9(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:bn};let i=[],r={},n={},a={},s=[],o={},l=[];for(let c of Object.values(e)){let{participantIdsWithConflicts:u,mappedMatchUps:d,participantMap:p,participants:f,matchUps:h,derivedEventInfo:m,derivedDrawInfo:A}=vn({...t,tournamentRecord:c});Object.assign(o,d),Object.assign(r,p),Object.assign(n,m),Object.assign(a,A),i.push(...f??[]),s.push(...h??[]),u?.forEach(g=>{l.includes(g)||l.push(g)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:o,participants:i,...oe,matchUps:s}}function g9({tournamentRecord:t,participantId:e}){if(!t)return{error:nt};if(!e)return{error:ba};let i=[e].concat((t.participants??[]).filter(r=>r?.participantType&&[vr,Ni].includes(r.participantType)&&r.individualParticipantIds?.includes(e)).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=(r?.entries??[]).map(a=>a.participantId);return _o(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function v9({tournamentRecord:t,participantId:e}){if(!t)return{error:nt};if(!e)return{error:ba};let{participants:i}=vn({participantFilters:{participantTypes:[vr,Ni,Lc]},tournamentRecord:t});return(i??[]).filter(r=>r.individualParticipantIds?.includes(e)).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function y9({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:nt};if(typeof t!="object")return{error:AA,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=as({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),s=Bd({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],o={};for(let l of a){let{sides:c}=l,u,d=c?.map(f=>{if(f.participant)return[f.participant].concat(...f.participant.individualParticipants||[]);s[l.matchUpId]&&!u&&(u=(s[l.matchUpId]||[]).map(h=>n[h]).filter(({winningSide:h,bye:m})=>!h&&!m))}).filter(Boolean).flat()??[];for(let f of d){let{participantId:h}=f;o[h]||(o[h]={potentialMatchUps:[],participant:f,matchUps:[]}),o[h].matchUps.push(l)}let p=u?.map(({sides:f})=>f).flat().map(({participant:f})=>f&&[f].concat(...f.individualParticipants||[])).filter(Boolean).flat()||[];for(let f of p){let{participantId:h}=f;o[h]||(o[h]={potentialMatchUps:[],participant:f,matchUps:[]}),o[h].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(o).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...oe}}function b9({tournamentRecord:t,participantId:e}){if(!t)return{error:nt};if(!e)return{error:ba};let{participant:i}=nv({tournamentRecord:t,participantId:e});if(!i)return{error:Fn};let{timeItem:r}=Eu({itemType:CM,element:i});return r&&r.itemValue===WP&&WP}var EDe={};Li(EDe,{analyzeDraws:()=>iN,analyzeTournament:()=>T9,getAggregateTeamResults:()=>U9,getAllowedDrawTypes:()=>_$,getAllowedMatchUpFormats:()=>I9,getAppliedPolicies:()=>tr,getCompetitionDateRange:()=>F$,getCompetitionPenalties:()=>w9,getPolicyDefinitions:()=>yA,getTournamentInfo:()=>US,getTournamentPenalties:()=>O$,getTournamentPersons:()=>S9,getTournamentPoints:()=>L$,getTournamentStructures:()=>S7,getTournamentTimeItem:()=>r$});function I9({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:nt};let{appliedPolicies:r}=tr({tournamentRecord:t});return(r?.[mu]?.matchUpFormats||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function _$({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:nt};let{appliedPolicies:r}=tr({tournamentRecord:t});return(r?.[R_]?.allowedDrawTypes||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function O$({tournamentRecord:t}){if(!t)return{error:nt};let e=(t?.participants??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:s}=a||{};i[s]?i[s].participants.push(n):i[s]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function w9({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:bn};let e=[];for(let i of Object.values(t)){let{penalties:r}=O$({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function DDe({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:s,category:o,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:f,notes:h})=>({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:s,category:o,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:f,notes:h}))(t)}}var ftt={[vE]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},htt=ftt;function US(t){let{tournamentRecord:e}=t??{};if(!e)return{error:nt};let i=(({tournamentId:o,tournamentRank:l,tournamentStatus:c,formalName:u,tournamentName:d,promotionalName:p,onlineResources:f,localTimeZone:h,activeDates:m,startDate:A,endDate:g,hostCountryCode:v,venues:b,notes:y,updatedAt:I})=>({tournamentId:o,tournamentRank:l,tournamentStatus:c,formalName:u,tournamentName:d,promotionalName:p,onlineResources:f,localTimeZone:h,activeDates:m,startDate:A,endDate:g,hostCountryCode:v,venues:b,notes:y,updatedAt:I}))(e),r=vn({participantFilters:{participantRoles:[BTe,u7,kTe,xTe,OTe]},policyDefinitions:htt,tournamentRecord:e})?.participants??[];r&&(i.tournamentContacts=r);let n=gS({tournamentRecord:e})?.publishState,a=n?.tournament?.status?.publishedEventIds||[],s=[];for(let o of e.events??[])if(!t?.usePublishState||a.includes(o.eventId)){let l=DDe({event:o}).eventInfo;l&&s.push(l)}return i.timeItemValues=ZCe({element:e}),i.publishState=n?.tournament,i.eventInfo=s,{tournamentInfo:Dt(Lt(i),!1,!0),...oe}}function F$({tournamentRecords:t}){if(!Xi(t))return{error:bn};let e=Object.keys(t??{}).reduce((n,a)=>{let s=t[a],{tournamentInfo:{startDate:o,endDate:l}}=US({tournamentRecord:s}),c=o&&Ui(o),u=c&&new Date(c);(!n.startDate||u&&u<n.startDate)&&(n.startDate=u);let d=l&&Ui(l),p=d&&new Date(d);return(!n.endDate||p&&p>n.endDate)&&(n.endDate=p),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&Ui(e.startDate.toISOString()),r=e.endDate&&Ui(e.endDate.toISOString());return!i||!r?{error:Awe}:{startDate:i,endDate:r}}function S9({tournamentRecord:t,participantFilters:e}){if(!t)return{error:nt};let i=t.participants||[];e&&(i=GM({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:s}=a.person;r[s]?r[s].participantIds.push(a.participantId):r[s]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function U9(t){let e=Qt(t,[{[Ua]:!0}]);if(e.error)return e;let i=t.finishingPositionRangeBounsPoints||{},r={},n=d=>{let p=d?.individualParticipants?.map(f=>f.teams?.length===1&&f.teams[0]);return d?.teams?.length===1&&d?.teams?.[0]||p?.[0].participantId===p?.[1].participantId&&p?.[0]},{matchUps:a,participants:s}=vn({participantFilters:{participantTypes:[Wi]},withRankingProfile:!0,withStatistics:!0,...t});for(let d of s??[]){if(d.participantType===qo)continue;d.draws?.[0]?.drawId==="draw-0-3"&&console.log(d.participantType,d.draws[0].finishingPositionRange);let p=n(d);if(p)for(let f of d?.draws??[]){let h=f?.finishingPositionRange?.join("-");if(h&&i?.[h]){let m=p?.participantId,A=f?.drawId,g=`${m}|${A}|${h}`;r[g]=i[h]}}}let o=d=>({teamName:d,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),l=(d,p,f)=>{d[p]===void 0&&(d[p]=0),d[p]+=f},c={},u={};for(let d of a??[]){let{sides:p,matchUpFormat:f}=d,h=f&&ys(f);if(p?.length===2&&h.setFormat?.timed&&(!h.finalSetFormat||h.finalSetFormat?.timed))for(let m of p){let A=n(m.participant),g=A?.participantId,v=m.participant?.participantId,b=A?.participantName,y=m.sideNumber,I=m.participant?.individualParticipantIds||v&&[v]||[];if(I.forEach(w=>{w&&!c[w]&&(c[w]=o(b))}),g&&y){u[g]||(u[g]=o(b));let w=[...I.map(T=>c[T]),u[g]];d.winningSide&&(y===d.winningSide?w.forEach(T=>l(T,"win",1)):w.forEach(T=>l(T,"loss",1)));let S=d.score?.sets||[];for(let T of S){let D=T?.[`side${3-y}Score`]||0,C=T?.[`side${y}Score`]||0,E=C-D;w.forEach(P=>l(P,"pointsPlayed",C+D)),w.forEach(P=>l(P,"points",C)),w.forEach(P=>l(P,"diff",E))}}}}for(let d of Object.keys(r)){let[p]=d.split("|");u[p]&&(u[p].bonus+=r[d],u[p].pointsPct=parseFloat((u[p].points/u[p].pointsPlayed).toFixed(2)),u[p].standingPoints=u[p].win+u[p].bonus)}for(let d of Object.keys(c))c[d].pointsPct=parseFloat((c[d].points/c[d].pointsPlayed).toFixed(2));return{...oe,individualResults:c,teamResults:u}}function mtt(t){let e=t.participants?.filter(({participantType:a})=>a===vr)?.length===2,i=t.events?.length===1&&t.events[0],r=i?.drawDefinitions?.length===1&&i.drawDefinitions[0],n=(r?.structures?.length===1&&r.structures[0])?.positionAssignments?.length===2;return!!(i.tieFormat&&e&&n)}function T9({tournamentRecord:t}){if(!t)return{error:nt};let{drawsAnalysis:e}=iN({tournamentRecord:t}),i={isDual:mtt(t),drawsAnalysis:e},r=vn({tournamentRecord:t});return r.missingParticipantIds?.length&&(i.missingParticipantIds=r.missingParticipantIds),{...oe,analysis:i}}function PDe(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function Att(t){let{participation:e={},awardProfiles:i,startDate:r,eventType:n,drawSize:a,drawType:s,category:o,endDate:l,level:c}=t,{participationOrder:u,flightNumber:d,rankingStage:p}=e,f=h=>!r&&!l||!h.dateRanges?!0:h.dateRanges.some(m=>{let A=!r||!m.startDate||new Date(r)>new Date(m.startDate),g=!l||!m.endDate||new Date(l)<=new Date(m.endDate);return A&&g});return{awardProfile:i.find(h=>f(h)&&(!h.maxFlightNumber||d<=h.maxFlightNumber)&&(!h.drawTypes?.length||h.drawTypes?.includes(s))&&(!h.drawSizes?.length||h.drawSizes.includes(a))&&(!h.stages?.length||h.stages.includes(p))&&(!h.levels?.length||h.levels.includes(c))&&(!h.maxDrawSize||a<=h.maxDrawSize)&&(!h.drawSize||h.drawSize===a)&&(!h.maxLevel||c<=h.maxLevel)&&(!d||!h.flights?.flightNumbers?.length||h.flights.flightNumbers.includes(d))&&(!h.participationOrder||h.participationOrder===u)&&(!h.category?.ageCategoryCodes||h.category.ageCategoryCodes.includes(o?.ageCategoryCode))&&(!h.eventTypes?.length||h.eventTypes?.includes(n)))}}function kie({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){let s=(h,m)=>{if(h){if(Array.isArray(m)){let A=m.find(g=>g.flight===h||g.f===h);return A.value||A.v}if(typeof m=="object"){let A=m.flights||m.f;if(Array.isArray(A))return A[h-1]}}},o=(h,m)=>{let A=h?.value||h?.v||(wi(h)?h:0),g=PDe(a,h?.level);return{value:s(m,g)||wi(g)&&g||A}},l=0,c,u,d,p,f=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let h=i.find(g=>g.drawSize===r||g.drawSizes?.includes(r)),m=i.find(g=>g.drawSize&&g.threshold&&r>g.drawSize),A=i.find(g=>!g.drawSize&&!g.drawSizes?.length);f!==void 0&&(h=h?.[f],m=m?.[f],A=A?.[f]),u=o(h,e).value,d=o(m,e).value,p=o(A,e).value,l=u||d||p,c=u&&h.requireWin||d&&m.requireWin||A?.requireWin}else if(typeof i=="object"){let h=i?.drawSizes?.[r],m=i;f!==void 0&&(h=h?.[f],m=m?.[f]),u=o(h,e).value,p=o(m,e).value,l=u||p,c=u?h.requireWin:m?.requireWin}else wi(i)&&f===void 0&&(l=i);return e&&n?.pct?.[e]&&(l=Math.round(l*n.pct[e])),{awardPoints:l,requireWin:c}}function L$({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){if(!i)return{error:nt};let{policyDefinitions:n}=yA({policyTypes:[Gk],tournamentRecord:i}),a=e?.[Gk]??n?.[Gk];if(!a)return{error:y2};let s=a.awardProfiles,o=a.requireWinFirstRound,l=a.requireWinForPoints,{participants:c,derivedEventInfo:u,derivedDrawInfo:d,mappedMatchUps:p}=vn({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),f=c?.filter(g=>g.draws?.length),h={},m={},A={};for(let g of f??[]){let{participantType:v,participantId:b,person:y,draws:I}=g;for(let w of I){let{drawId:S,structureParticipation:T,eventId:D}=w,C=u[D],E=d[S],P=E?.drawType,{category:R,eventType:M}=C||{},N=w.startDate||C.startDate||i.startDate,k=w.endDate||C.endDate||i.endDate;if(M===Jl&&b!==qo)continue;let O;if(s){let x=l,F=0,_=0,V=0,G;for(let z of T){let{finishingPositionRange:Q,participationOrder:j,participantWon:W,flightNumber:Y,rankingStage:X,winCount:J}=z;F+=J||0;let ie=E?.drawSize,{awardProfile:ue}=Att({awardProfiles:s,participation:z,eventType:M,startDate:N,category:R,drawSize:ie,drawType:P,endDate:k,level:r});if(ue){if(!ie)continue;let ne=Array.isArray(Q)&&Math.max(...Q),ge=Ei(Q||[]).join("-"),he=ne&&X!==qt&&Q?.includes(ie);ue.requireWinForPoints!==void 0&&(x=ue.requireWinForPoints),ue.requireWinFirstRound!==void 0&&(o=ue.requireWinFirstRound);let{finishingPositionPoints:Ie={},finishingPositionRanges:xe,finishingRound:Je,pointsPerWin:qe,flights:dt}=ue,ft=Array.isArray(ue.perWinPoints)?ue.perWinPoints?.find(mt=>mt.participationOrders?.includes(j)):ue.perWinPoints,je=Ie.participationOrders,Tt=0,Oe;if((!je||je.includes(j))&&xe&&ne){let mt=xe[ne];mt&&({awardPoints:Tt,requireWin:Oe}=kie({flightNumber:Y,valueObj:mt,drawSize:ie,flights:dt,level:r}))}if(!Tt&&Je&&j===1&&ne){let mt=Je[ne];mt&&({awardPoints:Tt,requireWin:Oe}=kie({participantWon:W,flightNumber:Y,valueObj:mt,drawSize:ie,flights:dt,level:r}))}if(he&&o!==void 0&&(x=o),Oe!==void 0&&(x=Oe),Tt>_&&(!x||J)&&(_=Tt,G=ne),!Tt&&qe&&J&&(V+=J*qe,G=ge),!Tt&&J&&ft){let mt=PDe(r,ft?.level);mt?V+=J*mt:ft.value&&(V+=J*ft.value)}}if(O=_+V,v===qo){let ne=(g.matchUps||[]).filter(({structureId:ge})=>ge===z.structureId);for(let{matchUpId:ge}of ne){let he=p[ge],Ie=he.sides.find(xe=>xe.participantId===b).sideNumber;if(he.winningSice===Ie)for(let xe of he.tieMatchUps)xe.winningSide}}}if(V||_){let z={winCount:F,positionPoints:_,rangeAccessor:G,perWinPoints:V,eventType:M,drawId:S,points:O},Q=y?.personId;Q?(h[Q]||(h[Q]=[]),h[Q].push(z)):v===Ni?(A[b]||(A[b]=[]),A[b].push(z)):v===qo&&(m[b]||(m[b]=[]),m[b].push(z))}}}}return{participantsWithOutcomes:f,personPoints:h,pairPoints:A,teamPoints:m,...oe}}var RDe={};Li(RDe,{compareTieFormats:()=>Jm,getTieFormat:()=>$$,tieFormatGenderValidityCheck:()=>k2,validateCollectionDefinition:()=>mM});function j_(t){if(!t)return{};let e=[],i=t.tieFormatName,r=t.collectionDefinitions?.map(n=>{let{matchUpType:a,matchUpFormat:s,matchUpCount:o,category:l,gender:c}=n;e.includes(s)||e.push(s);let u=l?.ageCategoryCode;return[o,a===By?"D":"S",u,s,c].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:r}}function Jm({considerations:t={},descendant:e,ancestor:i}){let r={},n={},{matchUpFormats:a,tieFormatDesc:s}=j_(e),{matchUpFormats:o,tieFormatDesc:l}=j_(i),c=Ei((a??[]).filter(I=>!(o??[]).includes(I)).concat((o??[]).filter(I=>!(a??[]).includes(I)))),u=!!(t?.collectionName&&e.collectionDefinitions.map(({collectionName:I})=>I).join("|")!==i.collectionDefinitions.map(({collectionName:I})=>I).join("|")),d=!!(t?.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:I})=>I).join("|")!==i.collectionDefinitions.map(({collectionOrder:I})=>I).join("|")),p=Object.assign({},...(e?.collectionDefinitions||[]).map(I=>({[I.collectionId]:I}))),f=Object.assign({},...(i?.collectionDefinitions||[]).map(I=>({[I.collectionId]:I})));r.collectionIds=Zte(Object.keys(p),Object.keys(f)),n.collectionIds=Zte(Object.keys(f),Object.keys(p)),r.collectionsValue=xie(p),n.collectionsValue=xie(f),r.groupsCount=i?.collectionGroups?.length??(0-(e?.collectionGroups?.length??0)||0),n.groupsCount=r.groupsCount?-1*r.groupsCount:0;let h=r.collectionsValue.totalValue-n.collectionsValue.totalValue,m=r.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,A=n.collectionsValue.assignmentValues.length!==r.collectionsValue.assignmentValues.length,g=n.collectionsValue.assignmentValues.some((I,w)=>{let S=r.collectionsValue.assignmentValues[w];return!S||I.valueKey!==S.valueKey||I.value!==S.value?!0:Array.isArray(I.value)?I.value.every((T,D)=>S.value[D]===T):!1}),v=u||d||l!==s||A||g||h!==0,b=[...n.collectionsValue.invalidValues,...r.collectionsValue.invalidValues],y=b.length&&b;return{matchUpFormatDifferences:c,matchUpCountDifference:m,descendantDifferences:r,ancestorDifferences:n,orderDifference:d,valueDifference:h,nameDifference:u,descendantDesc:s,ancestorDesc:l,...oe,different:v,invalid:y}}function xie(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort(p$).reduce((n,a)=>{let s=t[a],{collectionValueProfiles:o,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=s,f={collectionValueProfiles:o,collectionValue:l,matchUpValue:u,scoreValue:d,setValue:p},h=Object.keys(f).filter(A=>![void 0,null].includes(f[A])&&(!Array.isArray(f[A])||f[A].length>0));h.length!==1&&e.push({collectionId:a});let m=h[0];if(m){let A=m==="collectionValueProfiles"?Object.values(o):f[m];i.push({valueKey:m,value:A})}return r+=c,o?.length?n+o.reduce((A,g)=>A+g.value,0):c?wi(u)?n+u*c:wi(d)?n+d*c:wi(p)?n+p*c:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function C9(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=MDe(t);return{matchUp:Dt(e,!0,!0),error:i}}function MDe({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,matchUpId:o,inContext:l,eventId:c,drawId:u,event:d}){if(!i)return{error:nt};if(typeof o!="string")return{error:go};if(!a||!d){let h=(as({tournamentRecord:i,nextMatchUps:s}).matchUps??[]).find(m=>m.matchUpId===o);if(!h)return{error:Zs};({eventId:c,drawId:u}=h),{event:d,drawDefinition:a}=tl({tournamentRecord:i,eventId:c,drawId:u})}if(!a)return{error:Rc};n&&!r&&(r=bA({tournamentRecord:i,contextProfile:n}));let p={surfaceCategory:d?.surfaceCategory??i.surfaceCategory,indoorOutDoor:d?.indoorOutdoor??i.indoorOutdoor,endDate:d?.endDate??i.endDate,tournamentId:i.tournamentId,eventId:c??d?.eventId,drawId:u},{participants:f=[]}=Ib({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(s){let h=(No({context:l?p:void 0,participants:f,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,inContext:l,event:d}).matchUps??[]).find(A=>A.matchUpId===o);if(!h)return{error:Zs};let m=a?.structures?.find(A=>A.structureId===h.structureId);return{drawDefinition:a,structure:m,matchUp:h}}else{let{matchUp:h,structure:m}=Yr({context:l?p:void 0,tournamentParticipants:f,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:o,inContext:l,event:d});return{matchUp:h,structure:m,drawDefinition:a}}}function $$({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:s,event:o}){if(!t)return{error:nt};if(!s&&!o&&!i&&!r)return ce({result:{error:Yt},stack:"getTieFormat"});a&&!o&&(o=t.events?.find(f=>f.eventId===a));let l=C9({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:s,event:o});if(r&&l?.error)return l;if(!e&&l?.drawDefinition&&(e=l?.drawDefinition),n=n??l?.structure,!n&&i&&!r){if(!e)return{error:hp};let f=di({drawDefinition:e,structureId:i});if(f.error)return f;n=f.structure}let c=(n?.tieFormat||n?.tieFormatId)&&po({structure:n,drawDefinition:e,event:o})?.tieFormat,u=(e?.tieFormat||e?.tieFormatId)&&po({drawDefinition:e,event:o})?.tieFormat,d=po({event:o})?.tieFormat,p=po({matchUp:l?.matchUp,drawDefinition:e,structure:n,event:o})?.tieFormat;return{...oe,matchUp:l?.matchUp,structureDefaultTieFormat:Us(c),eventDefaultTieFormat:Us(d),drawDefaultTieFormat:Us(u),tieFormat:Us(p),structure:n}}var NDe={};Li(NDe,{bulkUpdatePublishedEventIds:()=>E9,getAllEventData:()=>D9,getCourtInfo:()=>l$,getDrawData:()=>H$,getEventData:()=>V$,getEventPublishStatus:()=>Ru,getPublishState:()=>gS,getTournamentPublishStatus:()=>VM,getVenueData:()=>eC});function E9({tournamentRecord:t,outcomes:e}){if(!t)return{error:nt};if(!e?.length)return{error:Yt,info:"Missing outcomes"};let i=e.reduce((n,a)=>{let{drawId:s,eventId:o}=a;return o&&s&&(n[o]?n[o].includes(s)||n[o].push(s):n[o]=[s]),n},{}),r=Object.keys(i);return{publishedEventIds:(t.events?.filter(n=>r.includes(n.eventId))).filter(n=>{let a=Ru({event:n}),{drawDetails:s,drawIds:o}=a??{},{eventId:l}=n;return i[l].filter(c=>{let u=s?Object.keys(a.drawDetails).filter(d=>o7({drawId:d,drawDetails:s})):[];return o?.includes(c)||u.includes(c)}).length}).map(n=>n.eventId),eventIdPublishedDrawIdsMap:i}}function BDe({dates:t=[],extension:e}){if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=Xi(e.value)?e.value?.dates:void 0;if(Array.isArray(i))return i?.length?!!i.filter(r=>!t.length||t.includes(r)).length:!1}function kDe({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){let n={...Dt(r,t,!0),venueId:i.venueId},{extension:a}=ki({name:ep,element:r});if(e&&a){let s=Xi(a.value)?a.value?.dates:void 0,o=a?.value===!0?[]:n.dateAvailability.map(l=>{let c=l.date;if(!(!c||s.includes(c)))return l}).filter(Boolean);n.dateAvailability=o}return{inContextCourt:n}}function gtt(t,e,i){if(e.length&&!e.includes(t.venueId))return!1;if(i){let{extension:r}=ki({name:ep,element:t});if(r?.value)return!1}return!0}function vtt({venue:t,convertExtensions:e,ignoreDisabled:i,dates:r,uniqueVenueIds:n,venues:a,uniqueCourtIds:s,courts:o}){n.includes(t.venueId)||(a.push(Dt(t,e,!0)),n.push(t.venueId));for(let l of t.courts??[])if(!s.includes(l.courtId)){if(i){let{extension:u}=ki({name:ep,element:l});if(BDe({extension:u,dates:r}))continue}let{inContextCourt:c}=kDe({convertExtensions:e,ignoreDisabled:i,venue:t,court:l});o.push(c),s.push(l.courtId)}}function wA(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},s=[],o=[],l=[],c=[];return Object.keys(a).filter(u=>!t.tournamentId||u===t.tournamentId).forEach(u=>{let d=a[u];for(let p of d.venues??[])gtt(p,r,!!i)&&vtt({venue:p,convertExtensions:e,ignoreDisabled:i,dates:n,uniqueVenueIds:s,venues:c,uniqueCourtIds:o,courts:l})}),{courts:l,venues:c,...oe}}function ytt({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:bn};let n=Dt(e.venues??[],t).filter(s=>{if(!i)return s;let{extension:o}=ki({name:ep,element:s});return!o?.value&&s}).filter(Boolean),a=n.reduce((s,o)=>{let l=(o?.courts||[]).filter(c=>{if(!i&&!r?.length)return c;let{extension:u}=ki({name:ep,element:c});return BDe({extension:u,dates:r})}).filter(Boolean).map(c=>{let{inContextCourt:u}=kDe({convertExtensions:t,ignoreDisabled:i,venue:o,court:c});return u});return l.length?s.concat(l):s},[]);return{venues:n,courts:a}}function oN({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:bn}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:s}=ytt({tournamentRecord:a,dates:i});return s?.forEach(o=>{let{venueId:l,courts:c}=o;(!e||c?.length)&&!r.venueIds.includes(l)&&(r.venues.push(o),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function D9({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:nt};let i=t.events||[],r=t?.participants||[],{tournamentInfo:n}=US({tournamentRecord:t}),{venues:a}=wA({tournamentRecord:t}),s=i.map(o=>{let{eventId:l}=o,c=DDe({event:o}).eventInfo,u=DM({tournamentRecord:t,event:o}).scheduleTiming,d=(o.drawDefinitions||[]).map(f=>{let h=(({drawId:b,drawName:y,matchUpFormat:I,updatedAt:w})=>({matchUpFormat:I,updatedAt:w,drawName:y,drawId:b}))(f),{abandonedMatchUps:m,completedMatchUps:A,upcomingMatchUps:g,pendingMatchUps:v}=SE({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:u,drawDefinition:f,event:o});return{drawInfo:h,matchUps:{abandonedMatchUps:m,completedMatchUps:A,upcomingMatchUps:g,pendingMatchUps:v}}}),p=Ru({event:o});return Object.assign(c,{drawsData:d,publish:p}),c});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:s}}}function xDe({publishStatus:t,drawId:e}){return t?.drawDetails?t.drawDetails?.[e]?.publishingDetail?.published:t?.drawIds?t.drawIds.includes(e):!0}var _De="PUBLIC",btt="ADMIN",Itt={PUBLIC_DISPLAY:_De,ADMIN_DISPLAY:btt};function H$(t){let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:r,tournamentRecord:n,inContext:a=!0,usePublishState:s,status:o=$c,pressureRating:l,refreshResults:c,contextProfile:u,drawDefinition:d,noDeepCopy:p,sortConfig:f,context:h,event:m}=t;if(!d)return{error:kt};let{matchUpFormat:A,updatedAt:g,drawType:v,drawName:b,drawId:y}=d,I={matchUpFormat:A,updatedAt:g,drawName:b,drawType:v,drawId:y};I.display=ki({element:d,name:M_}).extension?.value;let w={},S,T,{allStructuresLinked:D,sourceStructureIds:C,hasDrawFeedProfile:E,structureGroups:P}=g$({drawDefinition:d});if(!D)return{error:nwe};let R=t?.eventPublishState??gS({event:m}).publishState,M=t?.publishStatus??Ru({event:m,status:o}),N=R?.status?.drawDetails?.[d.drawId],k=!!R?.status?.published,O=N?.structureDetails,x=!1,F=!1,_=P.map(V=>{let G={},z=V.map(Q=>{let{structure:j}=di({drawDefinition:d,structureId:Q}),{seedAssignments:W}=Au({drawDefinition:d,structure:j});return j?.stage===Et&&j.stageSequence===1&&(S=W),j?.stage===qt&&(w[j.stageSequence??0]=W),j}).sort((Q,j)=>cS(Q,j,f)).map(Q=>{if(!Q)return;let j=Q?.structureId,W=[];Q.stage&&[Et,Ls,Dn].includes(Q.stage)&&(W=S),Q?.stage===qt&&(W=w[Q.stageSequence??0]);let{matchUps:Y,roundMatchUps:X,roundProfile:J}=dr({seedAssignments:Q?.seedAssignments?.length?void 0:W,context:{drawId:I.drawId,...h},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:e,policyDefinitions:r,tournamentRecord:n,usePublishState:s,publishStatus:M,contextProfile:u,drawDefinition:d,inContext:a,structure:Q,event:m}),{positionAssignments:ie}=wr({structure:Q}),ue=ie?.filter(rc(Nh)).map(Ie=>{let xe=ki({element:Ie,name:Km})?.extension?.value,{drawPosition:Je,participantId:qe}=Ie;return F=!0,{participantResult:xe,participantId:qe,drawPosition:Je}});if(Y.length&&(!ue?.length&&t.allParticipantResults||c&&!Q.structures)){let{subOrderMap:Ie}=qCe({positionAssignments:ie}),xe=Y.some(qe=>qe.matchUpType===Pc)?Y.filter(qe=>qe.matchUpType===Pc):Y,Je=RE({matchUpFormat:Q.matchUpFormat,matchUps:xe,policyDefinitions:r,pressureRating:l,subOrderMap:Ie});T=Je?.report,ue=ie?.filter(rc(Nh)).map(qe=>{let{drawPosition:dt,participantId:ft}=qe;return F=!0,{participantResult:ft&&Je?.participantResults?.[ft],participantId:ft,drawPosition:dt}})}let ne=Q?{stageSequence:Q.stageSequence,structureName:Q.structureName,structureType:Q.structureType,matchUpFormat:Q.matchUpFormat,stage:Q.stage}:{},ge=ki({element:Q,name:M_}).extension?.value;ne.display=ge?.[_De]??ge,ne.sourceStructureIds=C[j],ne.hasDrawFeedProfile=E[j],ne.positionAssignments=ie,ne.structureActive=Y.reduce((Ie,xe)=>{let Je=[An,Aa,Md,Hn,Nf,Nr,Ha,Zr].includes(xe.matchUpStatus);return Ie||Je||!!xe.winningSide||!!xe.score?.scoreStringSide1},!1);let he=Y.reduce((Ie,xe)=>Ie&&ta.includes(xe.matchUpStatus),!!Y.length);return ne.structureCompleted=he,G[j]=he,ne.structureActive&&(x=!0),{...ne,participantResults:ue,seedAssignments:W,roundMatchUps:X,roundProfile:J,structureId:j,report:T}});return z.forEach(Q=>{i||delete Q.positionAssignments,Q.sourceStructuresComplete=Q.sourceStructureIds?.every(j=>G[j])}),z}).flat().filter(V=>!s||O?.[V?.structureId]?.published||!0);return I.drawActive=x,I.participantPlacements=F,I.drawGenerated=_?.reduce((V,G)=>V||!!G?.roundMatchUps,!1),I.drawCompleted=_?.reduce((V,G)=>V&&G.structureCompleted,!0),I.drawPublished=s?k&&xDe({publishStatus:M,drawId:I.drawId}):void 0,{structures:!s||I.drawPublished?p&&_||Dt(_,!1,!0):void 0,drawInfo:p?I:Dt(I,!1,!0),...oe}}function V$(t){let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:r,usePublishState:n,status:a=$c,contextProfile:s,sortConfig:o}=t,l=Qt(t,[{tournamentRecord:!0},{[yY]:{event:!1,eventId:!1}}]);if(l.error)return l;let c=Dt(t.tournamentRecord,!1,!0),u=t.event?void 0:tl({tournamentRecord:c,eventId:t.eventId}).event,d=t.event?Dt(t.event,!1,!0):u&&Dt(u,!1,!0)||void 0;if(!d)return{error:fu};let{eventId:p}=d,{tournamentId:f,endDate:h}=c,m=Ru({event:d,status:a}),A=gS({event:d}).publishState??{},g=!!A?.status?.published,{participants:v}=vn({withEvents:!1,withDraws:!1,policyDefinitions:r,...i,tournamentRecord:c}),b=({stage:R,drawId:M})=>{if(!n)return!0;let N=m?.drawDetails?.[M]?.stageDetails;return!N||!Object.keys(N).length?!0:N[R]?.published},y=({structureId:R,drawId:M})=>{if(!n)return!0;let N=m?.drawDetails?.[M]?.structureDetails;return!N||!Object.keys(N).length?!0:N[R]?.published},I=({drawId:R})=>n?xDe({publishStatus:m,drawId:R}):!0,w=({drawId:R,structure:M})=>{if(!n)return M;let N=m?.drawDetails?.[R]?.structureDetails?.[M.structureId]?.roundLimit;if(wi(N)){let k=vt(1,N+1),O={},x={};for(let F of k)M.roundMatchUps[F]&&(O[F]=M.roundMatchUps[F],x[F]=M.roundProfile[F]);M.roundMatchUps=O,M.roundProfile=x}return M},S=d.drawDefinitions||[],T=!n||g?S.filter(I).map(R=>(({drawInfo:M,structures:N})=>({...M,structures:N}))(H$({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:p,tournamentId:f,endDate:h},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:v,eventPublishState:A,noDeepCopy:!0,policyDefinitions:r,tournamentRecord:c,usePublishState:n,contextProfile:s,drawDefinition:R,publishStatus:m,sortConfig:o,event:d}))).map(({structures:R,...M})=>{let N=R?.filter(({stage:k,structureId:O})=>y({structureId:O,drawId:M.drawId})&&b({stage:k,drawId:M.drawId})).map(k=>w({drawId:M.drawId,structure:k}));return{...M,structures:N}}).filter(R=>R.structures?.length):void 0,D=(Array.isArray(c.venues)?c.venues:[]).map(R=>(({venueData:M})=>({...M}))(eC({venueId:R.venueId,tournamentRecord:c}))),C=(({eventId:R,eventName:M,eventType:N,eventLevel:k,surfaceCategory:O,matchUpFormat:x,category:F,gender:_,startDate:V,endDate:G,ballType:z,discipline:Q})=>({eventId:R,eventName:M,eventType:N,eventLevel:k,surfaceCategory:O,matchUpFormat:x,category:F,gender:_,startDate:V,endDate:G,ballType:z,discipline:Q}))(d);C.display=ki({element:d,name:M_}).extension?.value;let{tournamentInfo:E}=US({tournamentRecord:c}),P={tournamentInfo:E,venuesData:D,eventInfo:C,drawsData:T};return P.eventInfo.publishState=A,P.eventInfo.published=A?.status?.published,{...oe,eventData:P,participants:v}}var ODe={};Li(ODe,{courtGridRows:()=>q$,findVenue:()=>qh,getMatchUpsToSchedule:()=>G$,getPersonRequests:()=>Pb,getProfileRounds:()=>z$,getScheduledRoundsDetails:()=>lN,getSchedulingProfile:()=>SA,getSchedulingProfileIssues:()=>P9,publicFindCourt:()=>i7});function rC({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){let{individualParticipantIds:n}=t$(r);i=i??r.schedule?.timeAfterRecovery;let a=c=>{t[c]||(t[c]=[]),t[c]=Ei(t[c].concat(...n))},s=c=>{i&&(!e[c]||i>e[c])&&(e[c]=i)},o=r.winnerTo?.matchUpId||r.winnerMatchUpId;o&&(i&&s(o),a(o));let l=r.loserTo?.matchUpId||r.loserMatchUpId;l&&(i&&s(l),a(l)),r.sidesTo?.length&&r.sidesTo.forEach(({matchUpId:c})=>{c&&(i&&s(c),a(c))})}function G$(t){let e=Qt(t,[{[gY]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,orderedMatchUpIds:o,clearDate:l,matchUps:c}=t,u=s?Object.keys(s):[],d=(o??[]).map(f=>c.find(h=>h.matchUpId===f)).filter(Boolean).filter(f=>{let h=!l&&(r.includes(f.matchUpId)||u.includes(f.matchUpId)),m=["BYE",Nr,Hn,tc,Ha,Zr,An,Aa].includes(f?.matchUpStatus);return n||!h&&!f.winningSide&&!m}),p=i&&a?d.reduce((f,h)=>{let{drawId:m,tournamentId:A}=h;return f.matchUpMap[A]||(f.matchUpMap[A]={}),f.matchUpMap[A][m]?f.matchUpMap[A][m].push(h):f.matchUpMap[A][m]=[h],rC({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:h}),f},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function Q$({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:s,eventType:o,eventId:l}){if(!Zl({matchUpFormat:r}))return{error:lM};let c=Object.keys(i).filter(d=>!s||d===s),u;return c.forEach(d=>{if(u)return;let p=i[d],f=l?tl({tournamentRecord:p,eventId:l})?.event:void 0;return u=OM({tournamentRecord:p,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:f}),u?.averageMinutes||u?.recoveryMinutes}),{recoveryMinutes:u?.recoveryMinutes||t,averageMinutes:u?.averageMinutes||e,typeChangeRecoveryMinutes:u?.typeChangeRecoveryMinutes||u?.recoveryMinutes||t}}function lN(t){let e=Qt(t,[{[yY]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[rl]:qs}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:r=30}=t,n=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof n!="object")return{error:bn};let a={},s=[],o=t.rounds.toSorted((h,m)=>(h.sortOrder??0)-(m.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(n).map(h=>IE({tournamentRecord:h}).containedStructures)),c=t.matchUps??up({nextMatchUps:!0,tournamentRecords:n}).matchUps,u=0,d={},p={},f={};return{scheduledRoundsDetails:o.flatMap(h=>{let m=h.periodLength||r,A=[];l?.[h.structureId]?A.push(...l[h.structureId]):A.push(h.structureId);let g=c?vm({tournamentIds:[h.tournamentId],roundNumbers:[h.roundNumber],matchUpIds:h.matchUpIds,eventIds:[h.eventId],drawIds:[h.drawId],processContext:!0,structureIds:A,matchUps:c}).sort(AS):[],{segmentNumber:v,segmentsCount:b}=h.roundSegment||{};if(wi(v)&&op(g?.length)&&op(b)&&v>0&&v<=b&&b<g?.length&&!h.matchUpIds?.length){let S=g.length/b,T=S*(v-1);g=g.slice(T,T+S)}let y=n[h.tournamentId],I=tl({drawId:h.drawId,tournamentRecord:y}).event,w=[];for(let S of g){let T=S.matchUpFormat;T&&(a[T]||(a[T]=[],a[T].push(S)),w.push(T))}for(let S of w){let{eventType:T,category:D}=I??{},{categoryName:C,ageCategoryCode:E}=D??{},{typeChangeRecoveryMinutes:P,recoveryMinutes:R,averageMinutes:M,error:N}=Q$({categoryName:C??E,categoryType:D?.categoryType,tournamentId:h.tournamentId,eventId:h.eventId,tournamentRecords:n,matchUpFormat:S,eventType:T});if(N)return{error:N,round:h};let k=g.filter(x=>(i||!ta.includes(x.matchUpStatus))&&x.matchUpStatus!=="BYE").map(_a);k.forEach(x=>{f[x]={typeChangeRecoveryMinutes:P,recoveryMinutes:R,averageMinutes:M},d[x]=R,p[x]=M}),s.push(...k),u=Math.max(M||0,u);let O=`${M}|${m}`;return{roundPeriodLength:m,recoveryMinutes:R,averageMinutes:M,matchUpIds:k,hash:O}}}),greatestAverageMinutes:u,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:s,minutesMap:f,...oe}}function FDe({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t?.map(o=>{let l=Ui(o?.scheduleDate);if(!l){n.push(`Invalid date: ${o?.scheduledDate}`);return}let c=(o?.venues||[]).map(u=>{let{rounds:d,venueId:p}=u;if(!e?.includes(p)){n.push(`Missing venueId: ${p}`);return}let f=d.filter(h=>{let m=i.includes(h.eventId)&&r.includes(h.drawId);return m||n.push(`Invalid eventId: ${h.eventId} or drawId: ${h.drawId}`),m});if(f.length)return{venueId:p,rounds:f}}).filter(Boolean);return c.length&&l&&{...o,venues:c}}).filter(Boolean),s=n.length;return{updatedSchedulingProfile:a,modifications:s,issues:n}}function j$({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:we};let{venueIds:i,tournamentsMap:r}=Stt({tournamentRecords:t}),n,a,s=e.every(o=>{let{scheduleDate:l,venues:c}=o;return Ro(l)?c.every(u=>{let{venueId:d,rounds:p}=u;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(f=>{if(!f)return a="empty round",!1;let{roundSegment:h,tournamentId:m,structureId:A,roundNumber:g,eventId:v,drawId:b}=f,y=r?.[m]?.[v]?.[b]?.[A]?.includes(g);y||(a="Invalid rounds");let{segmentNumber:I,segmentsCount:w}=h||{},S=!h||wi(I)&&op(w)&&I<=w;return S||(a="Invalid segment"),y&&S}):(n=vb,!1):(a="rounds should be an array",!1)}):!1});return!s&&!n&&(n=we),{valid:!!s,error:n,info:a}}function wtt(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],s=[],o=[],l=(e?.venues||[]).map(({venueId:u,courts:d})=>(!r||d?.length)&&u),c=e?.tournamentId;if(c){n.push(c),i[c]={};let u=e?.events||[];for(let d of u){let p=d.eventId;s.push(p),i[c][p]={};let f=h=>parseInt(h);for(let h of d.drawDefinitions||[]){let m=h.drawId;o.push(m),i[c][p][m]={};let{structures:A}=Td({drawDefinition:h});for(let g of A||[]){let v=g.structureId,{matchUps:b}=dr({structure:g}),{roundMatchUps:y}=Oo({matchUps:b}),I=y&&Object.keys(y).map(f);if(i[c][p][m][v]=I,a.push(v),g.structures?.length)for(let w of g.structures)a.push(w.structureId),i[c][p][m][w.structureId]=I}}}}return{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:s,drawIds:o}}function Stt(t){let e=t?.tournamentRecords&&Object.values(t?.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:s,tournamentIds:o}=e.reduce((l,c)=>{let{tournamentIds:u,tournamentMap:d,structureIds:p,venueIds:f,eventIds:h,drawIds:m}=wtt({tournamentRecord:c});return f.forEach(A=>{l.venueIds.includes(A)||l.venueIds.push(A)}),l.tournamentIds.push(...u),l.structureIds.push(...p),l.eventIds.push(...h),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:o,structureIds:s,venueIds:r,eventIds:n,drawIds:a}}function SA({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:bn};let{extension:i}=ki({element:e,name:sw,tournamentRecords:t,discover:!0}),r=i?.value||[];if(r.length){let{venueIds:n}=oN({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:s}=$7({tournamentRecords:t}),{updatedSchedulingProfile:o,modifications:l,issues:c}=FDe({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:s});if(l){r=o;let u=ME({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return u.error?u:{schedulingProfile:r,modifications:l,issues:c}}}return{schedulingProfile:r,modifications:0}}function ME({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=j$({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?ur({tournamentRecords:t,discover:!0,extension:{name:sw,value:i}}):Mo({element:e,name:sw,tournamentRecords:t,discover:!0})}function cN(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:c,issues:u}=SA({tournamentRecords:i,tournamentRecord:e});return{success:!c,modifications:c,issues:u}}let{venueIds:r}=oN({tournamentRecords:i}),{eventIds:n,drawIds:a}=$7({tournamentRecords:i}),{updatedSchedulingProfile:s,modifications:o,issues:l}=FDe({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return o?{...ME({schedulingProfile:s,tournamentRecords:i}),modifications:o,issues:l}:{...oe,modifications:o,issues:l}}function P9(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:nM};if(!Array.isArray(e))return{error:we};if(!e.every(Ro))return{error:ma};let n=[],a=0,s={},{schedulingProfile:o}=SA({tournamentRecords:i});if(!o)return{issues:n,...oe};let{matchUps:l}=up({nextMatchUps:!0,tournamentRecords:i});for(let u of o){let{scheduleDate:d,venues:p=[]}=u;if(!e?.length||e.includes(d)){for(let f of p||[])if(f){let{rounds:h}=f,m=[],{orderedMatchUpIds:A,scheduledRoundsDetails:g}=lN({tournamentRecords:i,periodLength:r,matchUps:l,rounds:h}),{matchUpDependencies:v}=Bd({tournamentRecords:i,matchUps:l}),b=y=>{let I;return g?.find((w,S)=>{let T=w.matchUpIds.includes(y);return T&&(I=S),T}),I};if(A?.forEach((y,I)=>{let w=A.slice(I+1),S=Mn(w,v?.[y]?.matchUpIds||[]);S.length&&m.push({matchUpId:y,shouldBeAfter:S})}),m.length){a+=m.length;let y=m.map(({matchUpId:I,shouldBeAfter:w})=>{let S=b(I),T=Ei(w.map(b));return s[d]||(s[d]={}),s[d][S]||(s[d][S]=[]),T.forEach(D=>{s[d][S].includes(D)||s[d][S].push(D)}),{matchUpId:I,matchUpRoundIndex:S,earlierRoundIndices:T,shouldBeAfter:w}});n.push(...y)}}}}let c={matchUpIdShouldBeAfter:Object.assign({},...n.map(u=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:f}=u;return{[d]:{earlierRoundIndices:f,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:c,roundIndexShouldBeAfter:s,...oe}}function Pb(t){let{tournamentRecords:e,requestType:i}=t,r=Qt(t,[{[Js]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:s}=ki({element:a,name:yE}),o=s?.value||[];for(let l of o){let{personId:c,requests:u}=l||{};n[c]||(n[c]=[]);for(let d of u)i&&d.requestType!==i||n[c].push(d)}}return{personRequests:n,...oe}}function c3(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:s,eventId:o,drawId:l}=t,c=r?e:s,u=[n,o,l,c,a].join("|");return Lt({structureId:c,roundSegment:i,tournamentId:n,roundNumber:a,eventId:o,drawId:l,id:u})}function _ie({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:s,categoryType:o}=n||{},{categoryName:l,ageCategoryCode:c}=s||{},u=Xl(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(u).forEach(p=>{let f=u[p],h=Q$({categoryName:l||c,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:o,eventType:a});if(h.error)return h;let m=h.averageMinutes*f;isNaN(d)||(d+=m)}),{roundMinutes:d}}function Utt(t){return(t||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((a,s)=>a+s,0),n=(i.finishingPositionRange?.winner||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:n}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function Oie(t){let e=t.length,i=t.filter(({sides:c})=>c?.some(({bye:u})=>u)).length||0,r=t.filter(({winningSide:c,matchUpStatus:u})=>c||ta.includes(u)).length||0,n=t.filter(({schedule:c,matchUpStatus:u})=>c?.scheduledDate&&c?.scheduledTime&&u!=="BYE").length||0,a=e-i,s=a===r,o=a-n,l=a-n;return{unscheduledCount:o,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:s,byeCount:i}}function z$({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:nM};t={[i.tournamentId]:i}}if(e){let a=j$({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=SA({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:rs};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:s})=>a.map(({rounds:o})=>o.map(l=>{let c=c3(l);return c.roundSegment?.segmentsCount&&(n[c.id]=c.roundSegment.segmentsCount),Lt({id:r?c.id:void 0,scheduleDate:s,...c})}))).flat(1/0),segmentedRounds:n}}function Pg({court:t,date:e}){let i=e&&t.dateAvailability.find(n=>Eh(n.date,e)),r=t.dateAvailability.find(n=>!n.date);return i||r}function Ttt({court:t,date:e}){let i=Pg({court:t,date:e}),r=new Map,n=[];return(i?.bookings||[]).forEach(a=>{if(typeof a.courtOrder=="number"){let s=a.rowCount||1;for(let o=0;o<s;o++)r.set(a.courtOrder+o,a)}else n.push(a)}),{gridBookings:r,timeBookings:n}}function q$({courtPrefix:t="C|",minRowsCount:e,courtsData:i,scheduledDate:r}){if(!Array.isArray(i))return{error:we};let n=i?.reduce((o,l)=>{let c=l.matchUps||[],u=Math.max(0,...c.map(d=>d.schedule.courtOrder||0));return Math.max(u,o)},1),a=Math.max(e||0,n),s=vt(0,a).map(o=>({matchUps:vt(0,i.length).map(l=>{let c=i[l],{courtId:u,venueId:d}=c;if(r){let{gridBookings:p}=Ttt({court:c,date:r});if(p.has(o+1)){let f=p.get(o+1);return{schedule:{courtOrder:o+1,venueId:d,courtId:u},isBlocked:!0,booking:f}}}return{schedule:{courtOrder:o+1,venueId:d,courtId:u}}})}));return i.forEach((o,l)=>{for(let c of o.matchUps){let u=c.schedule?.courtOrder;u&&(s[u-1].matchUps[l]=c)}}),{courtPrefix:t,rows:s.map((o,l)=>Object.assign({rowId:`rowId-${l+1}`},...o.matchUps.map((c,u)=>({[`${t}${u}`]:c}))))}}var LDe={};Li(LDe,{getEntriesAndSeedsCount:()=>W$,getMaxEntryPosition:()=>R9});function W$({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:Gr};let{entries:s,stageEntries:o}=LTe({drawDefinition:e,drawId:r,stage:a,event:n}),l=o.length,{drawSize:c}=bEe({participantsCount:l}),u=nN({drawSize:i??c,participantsCount:l,policyDefinitions:t});if(u.error)return ce({result:u,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=u;return{entries:s,seedsCount:d,stageEntries:o}}function R9(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>ci(n||0)),0)}var $De={};Li($De,{allCompetitionMatchUps:()=>up,allDrawMatchUps:()=>No,allEventMatchUps:()=>Wh,allTournamentMatchUps:()=>as,analyzeMatchUp:()=>n1,calculateWinCriteria:()=>TS,checkMatchUpIsComplete:()=>oy,competitionScheduleMatchUps:()=>dN,drawMatchUps:()=>H9,eventMatchUps:()=>Y$,filterMatchUps:()=>vm,getAllDrawMatchUps:()=>ia,getAllStructureMatchUps:()=>dr,getCheckedInParticipantIds:()=>hS,getCompetitionMatchUps:()=>r1,getEventMatchUpFormatTiming:()=>N9,getHomeParticipantId:()=>_9,getMatchUpCompetitiveProfile:()=>_M,getMatchUpContextIds:()=>O9,getMatchUpDailyLimits:()=>Z$,getMatchUpDailyLimitsUpdate:()=>B9,getMatchUpDependencies:()=>Bd,getMatchUpFormat:()=>F9,getMatchUpFormatTiming:()=>OM,getMatchUpFormatTimingUpdate:()=>M9,getMatchUpScheduleDetails:()=>c$,getMatchUpType:()=>u$,getMatchUpsStats:()=>L9,getModifiedMatchUpFormatTiming:()=>K$,getParticipantResults:()=>ZM,getPredictiveAccuracy:()=>x9,getRoundMatchUps:()=>Oo,getRounds:()=>$9,isValidMatchUpFormat:()=>Zl,matchUpActions:()=>C$,participantScheduledMatchUps:()=>k9,tallyParticipantResults:()=>RE,tournamentMatchUps:()=>X$,validMatchUp:()=>n$,validMatchUps:()=>Pu});function HDe({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:bn};let i=[],r;for(let n of Object.values(t)){let{extension:a}=ki({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let s=n.events??[];for(let o of s){let{eventId:l}=o,{extension:c}=ki({name:e,element:o});c&&i.push({params:{eventId:l,extension:c},method:"addEventExtension"})}}return{methods:i}}function M9({tournamentRecords:t}){return HDe({extensionName:Wm,tournamentRecords:t})}var iG="ADULT",rG="JUNIOR",cB="WHEELCHAIR",VDe={[tv]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[br]:30,default:60}}]},defaultDailyLimits:{[Dr]:2,[br]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[ld],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[cB],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[iG,cB],minutes:{default:60,[br]:30}},{categoryTypes:[rG],minutes:{default:60,[br]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[iG,cB],minutes:{default:30}},{categoryTypes:[rG],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[iG,rG],minutes:{default:30}},{categoryTypes:[cB],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},Ctt=VDe;function N9({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:Gr};let n,a;if(e?.length){let d=[];n=e.map(p=>{let f=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(f?.matchUpFormat)&&Zl({matchUpFormat:f?.matchUpFormat}))return d.push(f.matchUpFormat),f}).filter(Boolean)}else{let{policy:d}=wb({policyType:mu,tournamentRecord:t,event:r});if(d?.matchUpFormats)n=d?.matchUpFormats;else{let{extension:p}=ki({name:Wm,element:r}),f,h;p?.value?{matchUpAverageTimes:f,matchUpRecoveryTimes:h}=p.value:{matchUpAverageTimes:f,matchUpRecoveryTimes:h}=Ctt[tv],n=Ei([...(f||[]).map(m=>m.matchUpFormatCodes),...(h||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),a="default scheduling policy in use"}}let{eventType:s,eventId:o,category:l}=r,c=l?.categoryName??l?.ageCategoryCode??o;if(!o)return{error:Gr};let u=n.map(({matchUpFormat:d,description:p})=>{let f=OM({tournamentRecord:t,matchUpFormat:d,categoryName:c,categoryType:i,eventType:s,event:r});return{matchUpFormat:d,description:p,...f}});return Lt({eventMatchUpFormatTiming:u,info:a})}function K$(t){let e=Qt(t,[{[Ua]:!0},{[Ps]:m=>Zl({matchUpFormat:m}),[Nc]:lM,[hY]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=ki({name:Wm,element:n}),s=a?.value,{extension:o}=ki({element:i,name:Wm}),l=o?.value,c=s?.matchUpAverageTimes&&A0({...s,matchUpFormat:r}),u=l?.matchUpAverageTimes&&A0({...l,matchUpFormat:r}),d=[c,u].find(m=>m),p=s?.matchUpRecoveryTimes&&g0({...s,matchUpFormat:r}),f=l?.matchUpRecoveryTimes&&g0({...l,matchUpFormat:r}),h=[p,f].find(m=>m);return{matchUpFormat:r,recoveryTimes:h,averageTimes:d}}function B9({tournamentRecords:t}){return HDe({extensionName:wM,tournamentRecords:t})}var uN=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function k9({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!Pu(e))return{error:mA};if(!Array.isArray(t))return{error:we};let i=e.filter(Boolean).filter(({schedule:r})=>uN({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,s=Ui(a?.scheduledDate),o=Kr(a?.scheduledTime);return s&&o&&(r[s]?r[s].push(n):r[s]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>vSe(Kr(n.schedule?.scheduledTime),Kr(a.schedule?.scheduledTime)))}),{...oe,scheduledMatchUps:i}}function Ett({tournamentRecords:t}){let e={},i=[];for(let r of Object.values(t))for(let n of r.events??[]){let a=Ru({event:n}),s=a?.drawDetails;Xi(s)?(Object.assign(e,s),i.push(...Object.keys(s).filter(o=>o7({drawId:o,drawDetails:s})))):a?.drawIds?.length&&i.push(...a.drawIds)}return{drawIds:i,detailsMap:e}}function z_({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:o,drawId:l,structureId:c,roundNumber:u})=>`${o}|${l}|${c}${u}`;t?.length&&t.map(({venues:o})=>o.map(({rounds:l})=>l)).flat().forEach(o=>{o.sort((l,c)=>(l.sortOrder||0)-(c.sortOrder||0)).forEach(({eventId:l,drawId:c,structureId:u,roundNumber:d},p)=>{let f=r({eventId:l,drawId:c,structureId:u,roundNumber:d});i[f]=p})});let n=[],a={noScheduledDate:[]};for(let o of e){let l=o.schedule||{},c=l.scheduledDate&&Ui(l.scheduledDate)||l.scheduledTime&&Ui(l.scheduledTime)||"noScheduledDate";a[c]||(a[c]=[]),a[c].push(o)}let s=Object.keys(a).sort();for(let o of s){let l=a[o],c={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},f=p.scheduledTime&&Kr(p.scheduledTime)||"noScheduledTime";c[f]||(c[f]=[]),c[f].push(d)}for(let d of Object.keys(c)){let p=c[d].sort((f,h)=>(f.roundNumber||0)-(h.roundNumber||0));c[d]=p}let u=Object.keys(c).sort();for(let d of u){let p=c[d];p.sort((f,h)=>{let m=i[r(f)]||0,A=i[r(h)]||0;return m-A}),n.push(...p)}}return n}function Y$(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:h,nextMatchUps:m,tournamentId:A,inContext:g,context:v,event:b}=t;if(!b)return{error:Gr};let{eventId:y,eventName:I,endDate:w,eventType:S,category:T,gender:D}=b??{},C={...v,...Lt({surfaceCategory:b.surfaceCategory??u?.surfaceCategory,indoorOutDoor:b.indoorOutdoor??u?.indoorOutdoor,tournamentId:A??u?.tournamentId,endDate:w??u?.endDate,eventName:I,eventType:S,category:T,eventId:y,gender:D})},E;!e&&u&&({participants:e,participantMap:r,groupInfo:E}=Ib({participantsProfile:s,useParticipantMap:c,tournamentRecord:u,contextProfile:h,inContext:g})),h&&!i&&(i=bA({policyDefinitions:l,tournamentRecord:u,contextProfile:h,event:b}));let P=Ru({event:b});return{...(b.drawDefinitions??[]).reduce((R,M)=>{let N=SE({hydrateParticipants:t.hydrateParticipants,context:C,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:f,participantMap:r,publishStatus:P,contextProfile:h,drawDefinition:M,nextMatchUps:m,inContext:g,event:b});return Object.keys(N)?.forEach(k=>{Array.isArray(N[k])&&(R[k]||(R[k]=[]),R[k]=R[k].concat(N[k]))}),R},{}),...oe,groupInfo:E}}function X$(t){if(!t?.tournamentRecord)return{error:nt};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,inContext:o=!0,usePublishState:l,contextFilters:c,matchUpFilters:u,contextProfile:d,nextMatchUps:p,context:f}=t,h=t.tournamentId??s.tournamentId,m=s?.events??[],{participants:A,participantMap:g,groupInfo:v}=Ib({participantsProfile:r,tournamentRecord:s,contextProfile:d,inContext:o});d&&!e&&(e=bA({policyDefinitions:a,tournamentRecord:s,contextProfile:d}));let{appliedPolicies:b}=tr({tournamentRecord:s}),y=c?.eventIds??[];return{...m.filter(I=>!y.includes(I.eventId)).map(I=>{let w={eventDrawsCount:kn({event:I}).flightProfile?.flights?.length||I.drawDefinitions?.length||0,...f};return Y$({hydrateParticipants:t.hydrateParticipants,context:w,tournamentAppliedPolicies:b,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,contextFilters:c,contextProfile:d,contextContent:e,matchUpFilters:u,participantMap:g,participants:A,tournamentId:h,nextMatchUps:p,inContext:o,event:I})}).reduce((I,w)=>((w&&Object.keys(w).filter(S=>!["success","matchUpsMap"].includes(S)))?.forEach(S=>{Array.isArray(w[S])&&(I[S]||(I[S]=[]),I[S]=I[S].concat(w[S]),I.matchUpsCount!==void 0?I.matchUpsCount+=w[S].length:I.matchUpsCount=w[S].length)}),I),{matchUpsCount:0}),groupInfo:v,participants:A}}function r1({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:r,useParticipantMap:n,policyDefinitions:a,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:c,inContext:u}){if(typeof r!="object"||!Object.keys(r).length)return{error:bn};let d=Object.keys(r).map(h=>{let m=r[h];return X$({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,policyDefinitions:a,tournamentRecord:m,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:c,inContext:u})}),p={},f={};return{...d.reduce((h,m)=>(Object.keys(m).forEach(A=>{if(A==="groupInfo")Object.assign(f,m[A]);else if(A==="participants")for(let g of m[A]??[])p[g.participantId]=g;else Array.isArray(m[A])&&(h[A]||(h[A]=[]),h[A]=h[A].concat(m[A]))}),h),{}),groupInfo:f,mappedParticipants:p}}function dN(t){if(typeof t?.tournamentRecords!="object"||!Object.keys(t?.tournamentRecords).length)return{error:bn};let{courts:e,venues:i}=wA(t),r=SA(t).schedulingProfile,{sortDateMatchUps:n=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:s,activeTournamentId:o,tournamentRecords:l,withCourtGridRows:c,minCourtGridRows:u,usePublishState:d,status:p=$c,sortCourtsData:f}=t,h=o??rS()??Object.keys(l)[0],m=d?VM({tournamentRecord:l[h],status:p}):void 0,A=s?r1({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[Hn]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!m?.orderOfPlay?.published)return{completedMatchUps:A,dateMatchUps:[],courtsData:[],venues:i};let g,v;d&&({drawIds:g,detailsMap:v}=Ett({tournamentRecords:l})),g?.length&&(t.contextFilters??={},t.contextFilters.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(R=>g.includes(R)):t.contextFilters.drawIds=g),m?.eventIds?.length&&(t.matchUpFilters??={},t.matchUpFilters?.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(R=>m.eventIds.includes(R)):t.matchUpFilters.eventIds=m.eventIds),m?.scheduledDates?.length&&(t.matchUpFilters??={},t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(R=>m.scheduledDates.includes(R)):t.matchUpFilters.scheduledDates=m.scheduledDates),s&&(t.matchUpFilters??={},t.matchUpFilters?.excludeMatchUpStatuses?.length?t.matchUpFilters.excludeMatchUpStatuses.includes(Hn)||t.matchUpFilters.excludeMatchUpStatuses.push(Hn):t.matchUpFilters.excludeMatchUpStatuses=[Hn]);let{completedMatchUps:b,upcomingMatchUps:y,pendingMatchUps:I,groupInfo:w,mappedParticipants:S}=r1({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),T=[...y??[],...I??[]];v&&(!g?.length||Object.keys(v).length)&&(T=T.filter(R=>{let{drawId:M,structureId:N,stage:k}=R;if(!v?.[M]?.publishingDetail?.published)return!1;let O=Object.keys(v[M].stageDetails??{});if(O.length){let F=O.filter(V=>!v[M].stageDetails[V].published),_=O.filter(V=>v[M].stageDetails[V].published);return F.length&&F.includes(k)?!1:_.length&&_.includes(k)?!0:F.length&&!F.includes(k)&&!_.length}let x=Object.keys(v[M].structureDetails??{});if(x.length){let F=x.filter(V=>!v[M].structureDetails[V].published),_=x.filter(V=>v[M].structureDetails[V].published);return F.length&&F.includes(N)?!1:_.length&&_.includes(N)?!0:F.length&&!F.includes(N)&&!_.length}return!0}));let D=n?z_({matchUps:T,schedulingProfile:r}):T,C=e?.map(R=>{let M=P(R);return{surfaceCategory:R?.surfaceCategory??"",matchUps:M,...R}}),E={completedMatchUps:s?A:b,mappedParticipants:t.hydrateParticipants?void 0:S,dateMatchUps:D,courtsData:C,groupInfo:w,venues:i};if(c){let R=t.matchUpFilters?.scheduledDate,{rows:M,courtPrefix:N}=q$({minRowsCount:Math.max(u||0,D.length||0),scheduledDate:R,courtsData:C});E.courtPrefix=N,E.rows=M}return{...E,...oe};function P({courtId:R}){let M=(a?D.concat(b??[]):D).filter(N=>N.schedule?.courtId===R||N.schedule?.allocatedCourts?.map(({courtId:k})=>k).includes(R));return f?z_({matchUps:M,schedulingProfile:r}):M}}function Z$({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:bn};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:s}=Dtt({tournamentRecord:a});r=s}),{matchUpDailyLimits:r}}function Dtt(t){let e=Qt(t,[{[Ua]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:r}=wb({policyType:tv,tournamentRecord:i}),{extension:n}=ki({element:i,name:wM}),a=n?.value?.dailyLimits,s=r?.defaultDailyLimits;return{matchUpDailyLimits:a||s}}function x9(t){let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:r,drawDefinition:n,excludeMargin:a,exclusionRule:s,zoneDoubling:o,matchUpType:l,scaleName:c,eventId:u,zonePct:d,drawId:p,event:f}=t;if(!r&&!e)return{error:nt};if(l&&![Dr,br].includes(l))return{error:we,info:{matchUpType:l}};if(e&&!Pu(e))return{error:we,context:{matchUps:e}};let h=qa[c],m=h?.ascending??t.ascending??!1,A=h?.accessor??t.valueAccessor,g=Array.isArray(h?.range)?Math.abs(h.range[0]-h.range[1]):0,v=wi(d)&&g?(d??0/100)*g:t.zoneMargin??g,b={withScaleValues:!0,withCompetitiveness:!0},y={matchUpTypes:l?[l]:[Dr,br]},I=r?.participants;e?.[0]?.hasContext?p?e=e.filter(M=>M.drawId===p):u&&(e=e.filter(M=>M.eventId===u)):e??=p&&!n&&[]||!p&&u&&!f&&[]||p&&No({inContext:!0,drawDefinition:n,contextFilters:y,contextProfile:b,participants:I})?.matchUps||!p&&u&&Wh({inContext:!0,contextFilters:y,contextProfile:b,participants:I,event:f})?.matchUps||as({tournamentRecord:r,contextFilters:y,contextProfile:b})?.matchUps||[],l&&(e=e.filter(M=>M.matchUpType===l));let w=e.filter(({winningSide:M,score:N,sides:k,matchUpStatus:O})=>![Ha,Nr,Zr,bE,tc].includes(O??"")&&wa({score:N})&&k?.length===2&&M),S=Rtt({matchUps:w,excludeMargin:a,exclusionRule:s,valueAccessor:A,ascending:m,scaleName:c}),T=!o||Vn(Dr)(l)?v:(v||0)*2,D=v?w.map(({competitiveProfile:M,matchUpType:N,score:k,sides:O})=>{let x=GDe({singlesForDoubles:i,valueAccessor:A,matchUpType:N,scaleName:c,sides:O}),F=Math.abs(x[0].value-x[1].value);return{competitiveness:M?.competitiveness,valuesGap:F,score:k}}).filter(({valuesGap:M})=>M<=T):[],C=Ptt({zoneData:D}),E=C&&Object.values(C).flat().length,P=E&&Object.assign({},...Object.keys(C).map(M=>({[M]:Math.round(1e4*C[M].length/E)/100}))),R=w.length-(D?.length||0);return{...oe,relevantMatchUps:w,zoneDistribution:P,zoneData:D,accuracy:S,nonZone:R}}function Ptt({zoneData:t}){let e={[zY]:[],[KP]:[],[YP]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function GDe({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let s=e?.range.sort(),o=l=>{let c=l?.[e?.valueAccessor];return{exclude:e&&c>=s[0]&&c<=s[1],exclusionValue:c}};return a.sort((l,c)=>l.sideNumber-c.sideNumber).map(({participant:l})=>{let c=[],u=l?.individualParticipants;if(u?.length){let d=[],p=0;for(let f of u){let{scaleValue:h,value:m}=Fie({singlesForDoubles:t,valueAccessor:i,participant:f,matchUpType:r,scaleName:n}),{exclude:A,exclusionValue:g}=o(h);A&&c.push(g),d.push(h),m&&!Number.isNaN(Number(p))?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:c,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=Fie({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:f,exclusionValue:h}=o(d);return f&&c.push(h),{participantName:l.participantName,exclusionValues:c,scaleValue:d,value:p}}else return{}})}function Fie({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){let a=t?Dr:i,s=r?.rankings?.[a]?.find(c=>c.scaleName===n),o=(r?.ratings?.[a]?.find(c=>c.scaleName===n)||s)?.scaleValue,l=e?o?.[e]:o;return{scaleValue:o,value:l}}function Rtt({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let s={affirmative:[],negative:[],excluded:[]};for(let c of a)Mtt({matchUp:c,accuracy:s,excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n});let o=s.affirmative.length+s.negative.length,l=o&&s.affirmative.length/o*100;return s.percent=l?Math.round(100*l)/100:0,s}function Mtt({matchUp:t,accuracy:e,excludeMargin:i,exclusionRule:r,valueAccessor:n,ascending:a,scaleName:s}){let{matchUpType:o,sides:l,score:c,winningSide:u}=t;if(!u)return;if(r&&(!r.valueAccessor||!r.range)){e.error={info:"exclusionRule requires valueAccessor and range",error:Yt};return}let d=u-1,p=GDe({exclusionRule:r,valueAccessor:n,matchUpType:o,scaleName:s,sides:l});if(Ntt({exclusionRule:r,sideValues:p,accuracy:e,score:c,winningSide:u}))return;if(Btt(p)){e.excluded.push({scoreString:c?.scoreStringSide1,missingValues:!0,winningSide:u,sideValues:p});return}let f=p[d].value-p[1-d].value;if(ktt({excludeMargin:i,valuesGap:f})){e.excluded.push({scoreString:c?.scoreStringSide1,excludeMargin:i,winningSide:u,excludeGap:!0,sideValues:p,valuesGap:f});return}let h=a?f:f*-1,m=u===1?c?.scoreStringSide1:c?.scoreStringSide2;h>0?e.affirmative.push({winningScoreString:m,winningSide:u,sideValues:p,valuesGap:f,score:c}):e.negative.push({winningScoreString:m,winningSide:u,sideValues:p,valuesGap:f,score:c})}function Ntt({exclusionRule:t,sideValues:e,accuracy:i,score:r,winningSide:n}){if(t){let a=e.flatMap(({exclusionValues:s})=>s);if(a.length)return i.excluded.push({scoreString:r?.scoreStringSide1,exclusionValues:a,winningSide:n,sideValues:e}),!0}return!1}function Btt(t){return t.filter(e=>![void 0,"",null].includes(e.value)).length<2}function ktt({excludeMargin:t,valuesGap:e}){let i=Number.parseFloat(t||0);return i&&Math.abs(e)<i}function TS({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=KCe({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:s,collectionGroupNumber:o,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=a,f=o&&r.includes(o);if(wi(p||d))n=!0;else{if(f)continue;if(typeof l=="number"&&wi(l))i+=l;else if(Array.isArray(s)&&s?.length)for(let h of s)i+=h.matchUpValue;else typeof u=="number"&&wi(u)&&(i+=(c??0)*u)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...oe}:{valueGoal:Math.floor(i/2)+1,...oe}}function _9(t){let{timeStamp:e,schedule:i,matchUp:r}=t,n=Qt(t,[{[Qh]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:s}=Tb({timeItems:r?.timeItems||[],itemType:ZY});return!i||s&&e&&new Date(s).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function O9({matchUps:t,matchUpId:e}){if(!Pu(t))return{error:we};let i=t.find(o=>o.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:s}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:s}}function NE(t,e){if(!Xi(t))return{error:we};if(!Array.isArray(e))return{error:we};let i={};for(let{param:r,error:n,attr:a}of e){let s=xtt({params:t,param:r,attr:a,error:n});if(s?.error)return s;i[r]=s}return i}function xtt({params:t,param:e,attr:i,error:r}){if(e===Q2&&Xi(t.drawDefinition)&&rn(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===Qh){let n=MDe({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:rs,info:{param:e}}}function F9(t){let{structureId:e,matchUpId:i,event:r}=t,n=t.drawDefinition,a=Qt(t,[{[Ua]:!0},{[yY]:{[H2]:!1,[Rf]:!1,[vUe]:!1,[gA]:!1}}]);if(a[cd])return a;let s=NE(t,[{[AE]:Qh,[cd]:Yt}])?.matchUp;if(i&&s?.error)return s;!n&&s?.drawDefinition&&(n=s?.drawDefinition);let o=s?.structure;if(!o&&e&&!i){if(!n)return{error:hp};let p=di({drawDefinition:n,structureId:e});if(p.error)return p;o=p.structure}let l=o?.matchUpFormat,c=n?.matchUpFormat,u=r?.matchUpFormat,d=s?.matchUp?.matchUpFormat||l||c||u;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:u,drawDefaultMatchUpFormat:c,matchUpFormat:d}}function L9({profileBands:t,tournamentRecord:e,matchUps:i}){if(!Pu(i))return{error:mA};let r=!t&&wb({policyType:gm,tournamentRecord:e}).policy,n=t||r?.profileBands||qY[gm].profileBands,a=i.filter(({winningSide:p})=>p),s=a.map(sTe),o=(p,f)=>{let h=aTe(f,n);return p[h]+=1,p},l=oTe(s).reduce((p,f)=>o(p,f),{[zY]:0,[KP]:0,[YP]:0,[JUe]:0}),c=Object.keys(l).reduce((p,f)=>(l[f]||0)+p,0),u=Object.keys(l).map(p=>{let f=Number.parseFloat((l[p]/c).toFixed(4));return{[p]:f*100}}),d=a.filter(({matchUpStatus:p})=>p===oie).length;return u.push({[oie]:Number.parseFloat((d/c).toFixed(4))*100}),{competitiveBands:Object.assign({},...u),...oe}}var{stageOrder:Lie}=sYe;function _tt(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(Lie[t?.stage]||0)-(Lie[e?.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function $9({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:s,withSplitRounds:o,matchUpFilters:l,scheduleDate:c,withRoundId:u,venueId:d,context:p}){if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:we,inContextMatchUps:r};if(s&&!n){if(typeof s!="object")return{error:nM};n={[s.tournamentId]:s}}let f=typeof n!="object"||!Object.keys(n).length;if((d||c||!r||!a&&(t||i||a||o))&&f)return{error:bn};let h=Object.assign({},...Object.values(n??{}).map(({venues:w=[],tournamentId:S})=>({[S]:w?.map(({venueId:T})=>T)}))),m=Object.values(n??{}).map(({events:w=[],tournamentId:S,startDate:T,endDate:D})=>w.map(C=>({...C,validVenueIds:h[S],startDate:C.startDate??T,endDate:C.endDate??D}))).flat(),{segmentedRounds:A,profileRounds:g}=n&&(t||i||a||o)&&z$({tournamentRecords:n,schedulingProfile:a})||{},v=t&&Object.assign({},...g.map(w=>({[w.id]:w}))),b=r||n&&up({tournamentRecords:n,matchUpFilters:l})?.matchUps||[],y=[],I=b&&Object.values(b.reduce((w,S)=>{let T=c3(S).id,D=A?.[T],C=[...w[T]?.matchUps??[],S],{containerStructureId:E,stageSequence:P,structureName:R,tournamentId:M,isRoundRobin:N,matchUpType:k,roundNumber:O,roundOffset:x,structureId:F,eventName:_,roundName:V,drawName:G,eventId:z,drawId:Q}=S,j=N?E:F;return{...w,[T]:{id:u?T:void 0,structureId:j,stageSequence:P,segmentsCount:D,structureName:R,tournamentId:M,matchUpType:k,roundNumber:O,roundOffset:x,eventName:_,roundName:V,drawName:G,matchUps:C,eventId:z,drawId:Q}}},{})).map(w=>{let{minFinishingSum:S,winnerFinishingPositionRange:T}=Utt(w.matchUps),D=w.segmentsCount;if(D){let O=w.matchUps.length/D;return $a(w.matchUps.sort((x,F)=>x.roundPosition-F.roundPosition),O).map((x,F)=>{let{unscheduledCount:_,incompleteCount:V,matchUpsCount:G,isScheduled:z,isComplete:Q,byeCount:j}=Oie(x),W=_ie({matchUps:w.matchUps,tournamentRecords:n,events:m,round:w});return Lt({...w,...p,roundSegment:{segmentsCount:D,segmentNumber:F+1},winnerFinishingPositionRange:T,unscheduledCount:_,incompleteCount:V,minFinishingSum:S,matchUpsCount:G,isScheduled:z,roundTiming:W,isComplete:Q,byeCount:j,matchUps:x})})}let{unscheduledCount:C,incompleteCount:E,matchUpsCount:P,isScheduled:R,isComplete:M,byeCount:N}=Oie(w.matchUps),k=_ie({matchUps:w.matchUps,tournamentRecords:n,events:m,round:w});return Lt({...w,...p,winnerFinishingPositionRange:T,unscheduledCount:C,incompleteCount:E,minFinishingSum:S,matchUpsCount:P,isScheduled:R,roundTiming:k,isComplete:M,byeCount:N})}).flat().filter(w=>{if(t){let F=Ui(t),_=u?w.id:c3(w).id;if(F&&v[_]&&Ui(v[_].scheduleDate)===F)return!1}let{isComplete:S,isScheduled:T}=w,D=!i||!S,C=!e||!T,E=d||c?m?.find(({eventId:F})=>F===w.eventId):void 0,P=E?.startDate??s?.startDate,R=E?.endDate??s?.endDate,M=!c||!P||new Date(c)>=new Date(P),N=!c||!R||new Date(c)<=new Date(R),k=M&&N,O=!d||E?.validVenueIds.includes(d),x=D&&C&&O&&k;return x||y.push(w),x}).sort(_tt)||[];return{...oe,rounds:I,excludedRounds:y}}function n1(t){let{matchUp:e,sideNumber:i,setNumber:r,isTiebreakValue:n,isPointValue:a}=t||{},{matchUpFormat:s}=t||{};if(!e)return{error:Zo};s=s||e?.matchUpFormat;let o=ys(s),l=!!e?.winningSide,c=e.score?.sets,u=c?.length,d=r&&r-1,p=!!c?.find((j,W)=>j.setNumber===r&&W===d),f=c?.filter(j=>j?.winningSide)||[],h=f?.length||0,m=r&&c?.slice(r)||[],A=!!(u&&r&&m?.reduce((j,W)=>(!W||!W.side1Score&&!W.side2Score&&!W.side1TiebreakScore&&!W.side2TiebreakScore&&!W.side1PointScore&&!W.side2PointScore)&&j,!0)),g=r<=u&&c.find(j=>j.setNumber===r),v=g&&i1({setObject:g,matchUpScoringFormat:o}),{isCompletedSet:b,sideGameScores:y,sideTiebreakScores:I}=v||{},w=!!(g&&!b&&A||r&&r===u+1&&!l),S=[1,2].includes(i),T=S?i-1:0,D=g&&S&&(!n&&!a&&y[T]!==void 0&&y[T]||n&&I[T]!==void 0&&I[T]),C=!!D,E=f?.map(j=>i1({setObject:j,matchUpScoringFormat:o}).isValidSetOutcome).reduce((j,W)=>j&&W,!0),P=f.reduce((j,W)=>{let{winningSide:Y}=W,X=Y-1;return j[X]++,j},[0,0]),R=e?.winningSide,M=R&&R-1,N=1-M,k=P[M],O=P[N],x=Math.max(...P),F=Xl(P)[x],{bestOf:_,exactly:V}=o??{},G=_&&Math.ceil(_/2)||V||1,z=x===G&&F===1&&P.indexOf(x)+1||void 0,Q=k>O&&R===z;return{completedSetsHaveValidOutcomes:E,validMatchUpWinningSide:Q,calculatedWinningSide:z,matchUpScoringFormat:o,validMatchUpOutcome:z&&E&&Q,isLastSetWithValues:A,completedSetsCount:h,isCompletedMatchUp:l,isValidSideNumber:S,hasExistingValue:C,existingValue:D,isExistingSet:p,isActiveSet:w,...v}}function H9({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:s,tournamentRecord:o,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,publishStatus:f,contextProfile:h,drawDefinition:m,nextMatchUps:A,tournamentId:g,inContext:v,context:b,event:y}){let{eventId:I,eventName:w,endDate:S,eventType:T,category:D,gender:C}=y??{},E={...b,...Lt({surfaceCategory:y?.surfaceCategory??o?.surfaceCategory,indoorOutDoor:y?.indoorOutdoor??o?.indoorOutdoor,endDate:S??y?.endDate??o?.endDate,tournamentId:g??o?.tournamentId,eventName:w,eventType:T,category:D,eventId:I,gender:C})},P;return!t?.length&&o&&({participants:t,participantMap:p,groupInfo:P}=Ib({participantsProfile:r,useParticipantMap:s,tournamentRecord:o,contextProfile:h,inContext:v})),y&&h&&!u&&(u=bA({policyDefinitions:a,tournamentRecord:o,contextProfile:h,drawDefinition:m,event:y})),{...SE({context:E,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,participantMap:p,contextContent:u,contextFilters:c,matchUpFilters:d,publishStatus:f,contextProfile:h,drawDefinition:m,nextMatchUps:A,inContext:v,event:y}),groupInfo:P}}var QDe={};Li(QDe,{getCompetitionVenues:()=>oN,getCourts:()=>V9,getVenuesAndCourts:()=>wA,publicFindVenue:()=>t7});function V9({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=Dt(r.courts||[]);return a.forEach(s=>Object.assign(s,{venueId:n})),a}).flat()}:{error:nt}}var jDe={};Li(jDe,{categoryCanContain:()=>hM,getCategoryAgeDetails:()=>xy,getEvent:()=>j9,getEventProperties:()=>G9,getEventStructures:()=>A$,getEventTimeItem:()=>EM,getEvents:()=>Q9,getFlightProfile:()=>kn,getScaledEntries:()=>SS});function G9({tournamentRecord:t,event:e}){if(!t)return{error:nt};if(!e)return{error:Gr};let i=e.entries||[],r=t.participants||[],n=e.category?.categoryName||e.category?.ageCategoryCode,{eventType:a}=e,s=new Set(i.map(d=>d.participantId)),o=r.filter(d=>s.has(d.participantId)),l,c,u;return{entryScaleAttributes:o.map(d=>{let{participantId:p,participantName:f,name:h}=d,m={scaleType:e7,eventType:a,scaleName:n},A=lh({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;m={scaleType:ATe,eventType:a,scaleName:n};let g=lh({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;m={scaleType:mTe,eventType:a,scaleName:n};let v=lh({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;return l=!!(l||A),c=!!(c||g),u=!!(u||v),{participantId:p,participantName:f||h,seed:A,ranking:g,rating:v}}),hasSeededParticipants:l,hasRankedParticipants:c,hasRatedParticipants:u}}function Q9({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:s}){if(!t)return{error:nt};let{tournamentId:o}=t,l=(t.events??[]).filter(({eventId:u})=>!n||Array.isArray(n)&&n.includes(u)).map(u=>{let d=u.drawDefinitions?.map(qP);if(a?.length&&!Mn(a,d).length)return;let p=Dt(u);return r&&Object.assign(p,{tournamentId:o}),s&&Object.assign(p,s),p}).filter(Boolean),c={};if(e){let u=vn({withScaleValues:!0,tournamentRecord:t}).participantMap,d=p=>p.reduce((f,h)=>f+Number.parseFloat(h),0);for(let p of l){let f=i??p.eventType,h=p.eventId;c[h]||(c[h]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let m=(p.entries??[]).filter(({entryStatus:w})=>Nd.includes(w)).map(qi),A=w=>{if(w?.ratings?.[f])for(let S of w?.ratings?.[f]??[]){let T=S.scaleName;c[h].ratings[T]||(c[h].ratings[T]=[]);let D=qa[T]?.accessor;if(D){let C=Number.parseFloat(S.scaleValue?.[D]);C&&c[h].ratings[T].push(C)}}if(w?.rankings?.[f])for(let S of w?.rankings?.[f]??[]){let T=S.scaleName;c[h].ranking[T]||(c[h].ranking[T]=[]),S.scaleValue&&c[h].ranking[T].push(S.scaleValue)}};for(let w of m){let S=u?.[w]?.participant;if(S?.participantType===Wi)A(S);else for(let T of S?.individualParticipantIds??[]){let D=u?.[T]?.participant;A(D)}}let g=c[h].ratings;for(let w of Object.keys(g)){let S=g[w];if(!S.length)continue;let T=Xte(S)?.toFixed(2);c[h].ratingsStats[w]={avg:Number.parseFloat((d(S)/S.length).toFixed(2)),median:T?Number.parseFloat(T):void 0,max:Math.max(...S),min:Math.min(...S)}}let v=(w,S)=>{let T=D=>{if(c[h].draws?.[w]&&D?.ratings?.[f])for(let C of D?.ratings?.[f]??[]){let E=C.scaleName;c[h].draws[w]?.ratings[E]||(c[h].draws[w].ratings[E]=[]);let P=qa[E]?.accessor;if(P){let R=Number.parseFloat(C.scaleValue?.[P]);R&&c[h].draws[w].ratings[E].push(R)}}if(c[h].draws?.[w]&&D?.rankings?.[f])for(let C of D?.rankings?.[f]??[]){let E=C.scaleName;c[h].draws[w]?.ranking[E]||(c[h].draws[w].ranking[E]=[]);let P=C.scaleValue;P&&c[h].draws[w].ranking[E].push(P)}};for(let D of S.filter(Boolean)){let C=u?.[D]?.participant;if(C?.participantType===Wi)T(C);else for(let E of C?.individualParticipantIds??[]){let P=u?.[E]?.participant;T(P)}}},b=[],y=w=>a?.length&&a.includes(w)||b.includes(w);for(let w of p.drawDefinitions??[]){let S=w.drawId;if(y(S))continue;let T=Cb({drawDefinition:w}).assignedParticipantIds??[];c[h].draws[S]||(c[h].draws[S]={ratingsStats:{},ratings:{},ranking:{}}),b.push(S),v(S,T)}let I=kn({event:p}).flightProfile;for(let w of I?.flights??[]){let S=w.drawId;if(y(S))continue;let T=w.drawEntries.map(qi);v(S,T)}for(let w of b){let S=c[h].draws[w].ratings;for(let T of Object.keys(S)){let D=S[T];if(!D.length)continue;let C=Xte(D)?.toFixed(2);c[h].draws[w].ratingsStats[T]={avg:Number.parseFloat((d(D)/D.length).toFixed(2)),median:C?Number.parseFloat(C):void 0,max:Math.max(...D),min:Math.min(...D)}}}}}return Lt({eventScaleValues:c,events:l,...oe})}function j9({tournamentRecord:t,drawDefinition:e,context:i,event:r}){if(!t)return{error:nt};if(!r)return{error:Gr};let n=Dt(r);i&&Object.assign(n,i);let a=e&&n.drawDefinitions?.find(({drawId:s})=>e.drawId===s);return Lt({drawDefinition:a,event:n})}function Ott(t){let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:r}=$tt(t),n=Htt({...t,policyDefinitions:r,appliedPolicies:i}),a=Ltt(t),s=Vtt({...t,consideredEntries:a,appliedPolicies:i});if(s?.error)return ce({result:s,stack:e});let o=Gtt({...t,consideredEntries:a}),l=Ftt({...t,appliedPolicies:i,policyDefinitions:r,drawSize:o});if(l.error)return ce({result:l,stack:e});let c=l.drawType;if(isNaN(o)&&c!==ec)return ce({result:{error:oM},stack:e});let u=r?.[Ku]??i?.[Ku],d=t.seedingProfile??u?.seedingProfile?.drawTypes?.[c??""]??u?.seedingProfile;t.seedingProfile&&(r[Ku]||(r[Ku]={...l3[Ku]}),r[Ku].seedingProfile=d);let p=Qtt({...t,drawType:c});return p?.error?ce({result:p,stack:e}):{drawSize:o,drawType:c,enforceGender:n,seedingProfile:d,appliedPolicies:i,policyDefinitions:r}}function Ftt(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??rN({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),s=wEe({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return s.error?s:{drawType:s.drawType}}function zDe(t){return t?.filter(e=>e.entryStatus&&[...Nd,kM].includes(e.entryStatus))}function Ltt({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||zDe(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===Et)}function $tt(t){let{tournamentRecord:e,event:i}=t,r={...t?.appliedPolicies,...tr({tournamentRecord:e,event:i}).appliedPolicies??{}},n=Dt(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function Htt({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){return t??e?.[Ja]?.participants?.enforceGender??i?.[Ja]?.participants?.enforceGender}function Vtt(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:s,event:o}=t;return o&&s&&E$({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:s,event:o})}function Gtt(t){return!t.drawSize&&t.consideredEntries.length&&![ec,gM,mE,Sd,Mh].includes(t.drawType??"")&&lE(t.consideredEntries.length)||t.drawSize&&ci(t.drawSize)||!1}function Qtt(t){let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:r,drawType:n}=t,a=!r&&e&&_$({tournamentRecord:e,categoryType:i?.category?.categoryType,categoryName:i?.category?.categoryName});return a?.length&&!a.includes(n)?{error:T8}:{...oe}}function qDe(t){let{drawDefinition:e,appliedPolicies:i}=t,r=i?.[zm],n=os({drawDefinition:e});return e.structures?.forEach(a=>{let s=Cg({structureId:a.structureId,matchUpsMap:n}),o=nTe({roundNamingPolicy:r,drawDefinition:e,structure:a,matchUps:s}),{roundNamingProfile:l,roundProfile:c}=o;(a.structures||[a]).forEach(u=>{(u.matchUps??[]).forEach(d=>{let p=d?.roundNumber?.toString();if(p){let f=l?.[p]?.roundName,h=l?.[p]?.abbreviatedRoundName,m=c?.[p]?.feedRound;Object.assign(d,{abbreviatedRoundName:h,feedRound:m,roundName:f})}})})}),{drawDefinition:e}}function pN(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:s}=vn({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),o=zDe(r?.entries)??[],l=Ott({...t,participantMap:s,participants:a,eventEntries:o});if(l.error)return ce({result:l,stack:n});let{appliedPolicies:c,policyDefinitions:u,drawSize:d,drawType:p,enforceGender:f,seedingProfile:h}=l,m=r?.eventType,A=t.matchUpType??m,g=_et({...t,enforceGender:f,eventType:m,matchUpType:A});if(g.error)return ce({result:g,stack:n});let{matchUpFormat:v,tieFormat:b}=g;if(t.drawId&&typeof t.drawId!="string")return ce({result:{error:we},stack:n});let y=utt({...t,policyDefinitions:u,tournamentRecord:i,appliedPolicies:c,matchUpFormat:v,seedingProfile:h,participants:a,eventEntries:o,matchUpType:A,tieFormat:b,drawSize:d,drawType:p,event:r});if(y.error)return ce({result:y,stack:n});let{existingDrawDefinition:I,positioningReports:w,drawDefinition:S,structureId:T,conflicts:D,entries:C}=y;if(!S)return ce({result:{error:we},stack:n});let E=dtt({...t,existingDrawDefinition:I,positioningReports:w,appliedPolicies:c,drawDefinition:S,seedingProfile:h,participants:a,structureId:T,entries:C,params:t,stack:n});if(E.error)return E;let{qualifyingConflicts:P}=E;return S.drawName=t.drawName??(p&&_s(p)),d&&typeof e=="object"&&d>=4&&h7({...e,drawDefinition:S,matchUpType:A}),t.hydrateRoundNames&&c?.[zm]&&qDe({drawDefinition:S,appliedPolicies:c}),{existingDrawDefinition:!!I,qualifyingConflicts:P,positioningReports:w,drawDefinition:S,structureId:T,...oe,conflicts:D}}function WDe({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Yt,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:o},l)=>({[o]:l+1})));n=n||t.scaleName;let s=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:o})=>({scaleItems:[{scaleValue:a[o],eventType:t.eventType,scaleType:sh,scaleName:n,scaleDate:s}],participantId:o}))}}function jtt({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:s,event:o,stage:l,sortDescending:c,scaleSortMethod:u}){let d=W$({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:s,event:o,stage:l});if(d.error)return d;let{entries:p,seedsCount:f,stageEntries:h}=d;if(!h||!f)return{error:we};let m=SS({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:u,sortDescending:c,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:A}=WDe({scaleAttributes:r,scaledEntries:m,stageEntries:h,seedsCount:f,scaleName:n});return{scaleItemsWithParticipantIds:A}}var KDe={};Li(KDe,{addDrawEntries:()=>c7,addEventEntries:()=>Yp,addEventEntryPairs:()=>e0e,destroyPairEntries:()=>HTe,destroyPairEntry:()=>f7,getEntriesAndSeedsCount:()=>W$,getMaxEntryPosition:()=>R9,modifyEntriesStatus:()=>O_,modifyEventEntries:()=>t0e,mutate:()=>YDe,promoteAlternate:()=>ZDe,promoteAlternates:()=>q9,query:()=>LDe,removeDrawEntries:()=>JDe,removeEventEntries:()=>QM,setEntryPosition:()=>z9,setEntryPositions:()=>XDe});var YDe={};Li(YDe,{addDrawEntries:()=>c7,addEventEntries:()=>Yp,addEventEntryPairs:()=>e0e,destroyPairEntries:()=>HTe,destroyPairEntry:()=>f7,modifyEntriesStatus:()=>O_,modifyEventEntries:()=>t0e,promoteAlternate:()=>ZDe,promoteAlternates:()=>q9,removeDrawEntries:()=>JDe,removeEventEntries:()=>QM,setEntryPosition:()=>z9,setEntryPositions:()=>XDe});function z9({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let s="setEntryPositions";if(!t)return{error:nt};if(!i)return ce({result:{error:ba},stack:s});if(r!==void 0&&!Number.isSafeInteger(r))return{error:we,entryPosition:r};(a?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),(e?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let o=l=>{l.entries.forEach(c=>{c.entryPosition===r&&c.participantId!==i&&(c.entryPosition+=.1)})};return n||(a?.entries&&(o(a),a.entries=tp({entries:a.entries})),e?.entries&&(o(e),e.entries=tp({entries:e.entries}))),{...oe}}function XDe({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:nt};if(!Array.isArray(e))return{error:we};for(let n of e){let{participantId:a,entryPosition:s}=n,o=z9({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:s,event:r});if(o.error)return o}return r?.entries&&(r.entries=tp({entries:r.entries})),i?.entries&&(i.entries=tp({entries:i.entries})),{...oe}}function ZDe(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:we,participantId:e}:q9({...t,participantIds:[e].filter(Boolean)})}function q9({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=Et,eventId:a,event:s}){if(!t)return{error:nt};if(!Array.isArray(i))return{error:we,participantIds:i};if(!s)return{error:Gr};let o="promoteAlternates";if(s){let l=$ie({element:s,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=$ie({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?ce({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...oe},stack:o}):l}return{...oe}}function $ie({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===ud),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),s=n.reduce((d,p)=>{let{entryPosition:f}=p;return isNaN(f)&&d||(!d||f<d.entryPosition)&&p||d},void 0),o=a.length?a:[s].filter(Boolean);if(!o?.length)return{error:Mwe};let l=o.filter(({entryStatus:d})=>d!==ud);if(l.length)return{error:C4,invalidEntryStatus:l};let c=o.filter(({entryStage:d})=>d&&d!==r);if(c.length)return{error:L6e,invalidStage:c};let u=e&&o.filter(d=>d.stageSequence!==e);if(u?.length)return{error:$6e,invalidStageSequence:u};for(let d of o){d.entryStatus=Sl;let p=d?.entryPosition;isNaN(p)||i.entries.forEach(h=>{h.entryStatus===ud&&h.entryPosition>p&&(h.entryPosition=h.entryPosition-1)});let f=Math.max(...i.entries.filter(h=>h.entryStatus===Sl&&!isNaN(h.entryPosition)).map(({entryPosition:h})=>ci(h||0)),0);d.entryPosition=f||0}return{...oe}}function JDe({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){if(!a)return{error:Gr};if(!r)return{error:hp};if(!e?.length)return{error:Jg};let s=Cb({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(_o(s,e))return{error:pE};let o=u=>{let d=u.participantId;return!e.includes(d)},{flightProfile:l}=kn({event:a}),c=l?.flights?.find(u=>u.drawId===r);return c?.drawEntries&&(c.drawEntries=c.drawEntries.filter(o),t&&(c.drawEntries=tp({entries:c.drawEntries}))),i?.entries&&(i.entries=i.entries.filter(o),t&&(i.entries=tp({entries:i.entries}))),{...oe}}function bf(t){let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:r,disableNotice:n,pairOverride:a,participant:s}=t,o=t.tournamentId?t.tournamentRecords?.[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&t.tournamentRecords?.[t.activeTournamentId]);if(!o)return{error:nt};if(!s)return ce({result:{error:iS},stack:e});s.participantId||(s.participantId=hr()),o.participants||(o.participants=[]);let{participantId:l,individualParticipantIds:c}=s;if(o.participants.reduce((m,A)=>A.participantId===l||m,!1))return{error:Cwe};let{participantType:u,participantRole:d}=s;if(!u||!Object.keys(h0).includes(u))return{error:cp,participantType:u};if(!d)return{error:Uwe};let p=o.participants||[],f=p.filter(m=>m.participantType===Wi).map(m=>m.participantId);if(u!==Wi&&s.person)return{error:we,person:s.person};if(c&&!Array.isArray(c))return{error:we,individualParticipantIds:c};if(u===Ni){if(s.person)return{error:we,person:s.person};if(s.individualParticipantIds){if(s.individualParticipantIds.length!==2&&!a)return ce({info:"PAIR must be 2 individualParticipantIds",result:{error:Ll},stack:e});{let g=p.filter(v=>v.participantType===Wi).map(v=>v.participantId);if(!Array.isArray(s.individualParticipantIds))return ce({result:{error:Ll},stack:e});if(!s.individualParticipantIds.reduce((v,b)=>g.includes(b)&&v,!0))return ce({result:{error:Ll},stack:e})}}else return ce({result:{error:Jg},stack:e});let m=p.filter(g=>g.participantType===Ni).map(g=>({individualParticipantIds:g.individualParticipantIds,participant:g})),A=s.participantType===Ni&&m.find(g=>Mn(g.individualParticipantIds,s.individualParticipantIds).length===2);if(A&&!i)return{...oe,existingParticipant:!0,participant:r&&Dt(A.participant)};if(!s.participantName){let g=p.filter(b=>s.individualParticipantIds?.includes(b.participantId)),v=g.map(b=>b.person?.standardFamilyName).filter(Boolean).join("/");g.length===1&&(v+="/Unknown"),s.participantName=v}}else if(u===Wi){if(!s.person?.standardFamilyName||!s.person?.standardGivenName)return{error:Rwe};if(!s.participantName){let m=`${s.person.standardFamilyName.toUpperCase()}, ${s.person.standardGivenName}`;s.participantName=m}}else if(u&&[vr,Lc].includes(u)){if(c||(s.individualParticipantIds=[]),s.individualParticipantIds?.length)for(let m of s.individualParticipantIds){if(typeof m!="string")return ce({result:{participantId:m,error:we},stack:e});if(!f.includes(m))return ce({result:{participantId:m,error:Fn},stack:e})}}else return{error:cp};o.participants.push(s),n||Ii({payload:{tournamentId:o.tournamentId,participants:[s]},topic:Ug});let h={participant:r&&Dt(s),...oe};return Lt(h)}function Ed({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:nt};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=hr())});let a=r.filter(d=>!n.includes(d.participantId)),s=r.filter(d=>n.includes(d.participantId)),o=a.filter(d=>d.participantType===Wi),l=a.filter(d=>d.participantType!==Wi),c=o.concat(...l),u=[];if(c.length){for(let p of c){let f=bf({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(f.error)return f;f.success&&!f.existingParticipant&&u.push(f.participant)}u.length&&Ii({topic:Ug,payload:{tournamentId:i.tournamentId,participants:u}});let d={participants:e&&Dt(u),addedCount:u.length,...oe};return s.length&&Object.assign(d,{notAdded:s,info:U2}),Lt(d)}else return{info:"No new participants to add",addedCount:0,...oe}}function e0e(t){let e=Qt(t,[{[Ua]:!0,[gA]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=ud,participantIdPairs:n=[],entryStage:a=Et,tournamentRecord:s,drawDefinition:o,event:l,uuids:c}=t;if(l.eventType!==br)return{error:Th};let u=[],d=new Map;for(let y of s.participants??[]){let{participantType:I,participantId:w,person:S,individualParticipantIds:T}=y;I===Wi&&S?.sex?d.set(w,S.sex):I===Ni&&T&&u.push(T)}let p=n.filter(y=>{if(y.length!==2)return!0;if(!l.gender||Ch(l.gender))return!1;if(!d.has(y[0])||!d.has(y[1]))return!0;let I=y.map(S=>d.get(S)),w=uI(l.gender)&&(!uI(I[0])||!uI(I[1]))||Qv(l.gender)&&(!Qv(I[0])||!Qv(I[1]));return Tc(l.gender)&&(I.sort(p$),(!Qv(I[0])||!uI(I[1]))&&(w=!0)),w});if(p.length)return{error:Ll,invalidParticipantIdPairs:p};let f=n.map(y=>({participantId:c?.pop()??hr(),participantRole:xs,individualParticipantIds:y,participantType:Ni})),h=i?f:f.filter(y=>!u.find(I=>Mn(I,y.individualParticipantIds).length===2)),m,A=[];if(h){let y=Ed({allowDuplicateParticipantIdPairs:i,participants:h,returnParticipants:!0,tournamentRecord:s});if(y.error)return y;A=y.participants||[],m=y.info}let g=n.map(y=>{let I=A.find(S=>Mn(S.individualParticipantIds,y).length===2);if(I)return I;let{participant:w}=Cd({tournamentRecord:s,participantIds:y});return w}).map(y=>y.participantId),v=Yp({participantIds:g,tournamentRecord:s,drawDefinition:o,entryStatus:r,entryStage:a,event:l});h.length&&Ii({payload:{participants:h},topic:Ug});let b=h.map(qi);return{...v,info:m,newParticipantIds:b}}function t0e({entryStatus:t=Sl,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=Et,tournamentRecord:n,event:a}){if(!n)return{error:nt};if(!a)return{error:Gr};let s=n.participants??[],o=s.filter(m=>m.participantType===Wi).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!o.includes(m));if(l.length)return{error:Ll,invalidParticipantIds:l};let c=i.filter(m=>m.length!==2);if(c.length)return{error:Ll,invalidParticipantIdPairs:c};let u=s.filter(m=>m.participantType===Ni).map(m=>m.individualParticipantIds),d=i.filter(m=>!u.find(A=>Mn(A,m).length===2)).map(m=>({participantType:Ni,participantRole:xs,individualParticipantIds:m})),p=Ed({participants:d,tournamentRecord:n});if(p.error)return p;let f=i.map(m=>{let{participant:A}=Cd({tournamentRecord:n,participantIds:m});return A}).map(m=>({participantId:m,entryStatus:t,entryStage:r})),h=e.map(m=>({entryStatus:Du,participantId:m,entryStage:r}));return a.entries=(a.entries??[]).filter(m=>m.entryStage===r),a.entries=a.entries.concat(...f,...h),{...oe}}var J$={};Li(J$,{addDrawDefinition:()=>fN,addEvent:()=>BE,addFlight:()=>rH,assignSeedPositions:()=>h0e,attachFlightProfile:()=>eX,categoryCanContain:()=>hM,deleteDrawDefinitions:()=>eH,deleteEvents:()=>A0e,deleteFlightAndFlightDraw:()=>p0e,deleteFlightProfileAndFlightDraws:()=>o0e,generate:()=>i0e,generateEventsFromTieFormat:()=>n0e,getCategoryAgeDetails:()=>xy,getEvent:()=>j9,getEventProperties:()=>G9,getEventStructures:()=>A$,getEventTimeItem:()=>EM,getEvents:()=>Q9,getFlightProfile:()=>kn,getScaledEntries:()=>SS,modifyEvent:()=>g0e,modifyEventMatchUpFormatTiming:()=>l0e,modifyPairAssignment:()=>f0e,mutate:()=>a0e,query:()=>jDe,refreshEventDrawOrder:()=>J9,removeEventMatchUpFormatTiming:()=>tH,removeScaleValues:()=>tX,removeSeeding:()=>m0e,setEventDates:()=>X9,setEventDisplay:()=>iH,setEventEndDate:()=>Y9,setEventStartDate:()=>K9,updateDrawIdsOrder:()=>Z9,validateCategory:()=>LP});var i0e={};Li(i0e,{generateEventsFromTieFormat:()=>n0e});function ztt({tournamentId:t,event:e}){return e?(Ii({payload:{tournamentId:t,event:e},key:e.eventId,topic:LUe}),{...oe}):{error:Gr}}var qtt={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},Wtt={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},Ktt={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},r0e={COLLEGE_D3:qtt,COLLEGE_DEFAULT:Wtt,COLLEGE_JUCO:Ktt,DOMINANT_DUO:NSe,DOMINANT_DUO_MIXED:ESe,LAVER_CUP:OSe,TEAM_DOUBLES_3_AGGREGATION:wSe,TIME_TENNIS_DUAL:DSe,TIME_TENNIS_PRO_CIRCUIT:CSe,USTA_BREWER_CUP:PSe,USTA_OZAKI_CUP:RSe,USTA_COLLEGE:BSe,USTA_GOLD_TEAM_CHALLENGE:ISe,USTA_INTERSECTIONAL:TSe,USTA_LEVEL_1:kSe,USTA_SECTION_BATTLE:USe,USTA_SOUTHERN_LEVEL_5:SSe,USTA_TOC:FSe,USTA_WTT_ITT:xSe,USTA_ZONAL:_Se};function BE({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){if(!e)return{error:nt};if(e.events||(e.events=[]),!r)return{error:Gr};let{startDate:n,endDate:a}=e;if(!i&&(r.entries?.length||r.drawDefinitions?.length)){let o=Lt({drawDefinitions:!!r.drawDefinitions?.length,entries:!!r.entries?.length});return{info:"entries/drawDefinitions cannot exist",error:we,context:o}}let s={eventType:iw,drawDefinitions:[],entries:[],startDate:n,endDate:a,...r};if(r.eventType===Jl){if(r.tieFormat){let o=Jo({tieFormat:r.tieFormat});if(o.error)return o}else if(r.tieFormatName){if(!r0e[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:we};let o=Qm({isMock:e?.isMock,namedFormat:r.tieFormatName,event:r});s.tieFormat=o}}if(s.eventId||(s.eventId=hr()),e.events.reduce((o,l)=>o||l.eventId===s.eventId,void 0))return{error:awe};{let o=s;if(e.events.push(o),!t){let{topics:l}=Tu();if(l.includes(Z2)){let d=Wh({event:r}).matchUps??[];Tg({tournamentId:e?.tournamentId,eventId:r.eventId,matchUps:d})}let{drawDefinitions:c,...u}=r;for(let d of c||[])UM({drawDefinition:d});ztt({tournamentId:e?.tournamentId,event:u})}return{...oe,event:s}}}function n0e(t){let e=Qt(t,[{[YT]:{[V2]:!0,[pUe]:!0}},{[Ua]:!0}]);if(e.error)return e;let i=t.tieFormat||Qm({namedFormat:t.tieFormatName}),r=t.uuids||[bSe(i.collectionDefinitions.length)],n={[oa]:[],[Ds]:[]};if(t.addEntriesFromTeams){let s=t.tournamentRecord.participants?.filter(o=>o.participantType===qo)?.flatMap(o=>o.individualParticipantIds??[]);for(let o of t.tournamentRecord.participants??[])if(s?.includes(o.participantId)){let l=o.person?.sex;if(l&&ff(l)){let c=Ks(l);c&&n[c].push(o.participantId)}}}let a=[];for(let s of i.collectionDefinitions??[]){let o=r?.pop()?.toString()||hr(),l=s.matchUpType,c=s.gender,u={matchUpFormat:s.matchUpFormat,eventName:s.collectionName,category:s.category,gender:c,eventType:l,eventId:o};if(t.addEntriesFromTeams){let d=l===jm?Du:t.entryStatus||Sl,p=Tc(c)?[...n[oa],...n[Ds]]:n[Ks(c)||Am]??[];if(p.length){let f=Yp({participantIds:p,entryStatus:d,event:u});if(f.error)return f}}if(a.push(u),t.addEvents!==!1){let d=BE({internalUse:!0,tournamentRecord:t.tournamentRecord,event:u});if(d.error)return d}}return{...oe,events:a}}var a0e={};Li(a0e,{addDrawDefinition:()=>fN,addEvent:()=>BE,addFlight:()=>rH,assignSeedPositions:()=>h0e,attachFlightProfile:()=>eX,deleteDrawDefinitions:()=>eH,deleteEvents:()=>A0e,deleteFlightAndFlightDraw:()=>p0e,deleteFlightProfileAndFlightDraws:()=>o0e,modifyEvent:()=>g0e,modifyEventMatchUpFormatTiming:()=>l0e,modifyPairAssignment:()=>f0e,refreshEventDrawOrder:()=>J9,removeEventMatchUpFormatTiming:()=>tH,removeScaleValues:()=>tX,removeSeeding:()=>m0e,setEventDates:()=>X9,setEventDisplay:()=>iH,setEventEndDate:()=>Y9,setEventStartDate:()=>K9,updateDrawIdsOrder:()=>Z9,validateCategory:()=>LP});function kE({removePriorValues:t=!0,status:e=$c,statusObject:i,event:r}){if(!Xi(i))return{error:we};let n=Ru({event:r,status:e}),a=`${av}.${sv}`,s={itemValue:{[e]:{...n,...i}},itemType:a};return wS({timeItem:s,removePriorValues:t,event:r})}function xE(t){let e=Qt(t,[{[Ua]:!0,[gA]:!0},{eventDataParams:!1,[rl]:fl}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:r,tournamentRecord:n,status:a=$c,event:s,drawIdsToRemove:o,drawIdsToAdd:l}=t,{appliedPolicies:c}=tr({tournamentRecord:n,event:s}),u={...c,...t.policyDefinitions},d=s?.drawDefinitions?.map(({drawId:I})=>I)??[],p=t.drawDetails?Object.keys(t.drawDetails):[],f=p.length?[]:t.drawIds,h=(l??[]).concat(...o??[],...f??[],...p),m=h.filter(I=>!d.includes(I));if(m.length)return ce({result:{error:Rc},context:{invalidDrawIds:m}});let A=Ru({event:s,status:a}),g=Object.keys(A?.drawDetails||{}).filter(I=>d.includes(I)).reduce((I,w)=>(I[w]=A.drawDetails[w],I),{});for(let I of d)if((!h.length||h.includes(I))&&(o?.includes(I)||f?.length&&!f.includes(I)?g[I]={...g[I],publishingDetail:{published:!1}}:(l?.includes(I)||f?.includes(I)||!f?.length)&&(g[I]={...g[I],publishingDetail:{published:!0}})),t.drawDetails?.[I]){let w=t.drawDetails[I],S=w.structureDetails??g[I].structureDetails,T=w.stageDetails??g[I].stageDetails??{},{structureIdsToRemove:D=[],structureIdsToAdd:C=[],publishingDetail:E={},stagesToRemove:P=[],stagesToAdd:R=[]}=w;if((C||R)&&(E.published=!0),g[I]={publishingDetail:E,structureDetails:S,stageDetails:T},C.length||D.length){let N=(s?.drawDefinitions?.find(O=>O.drawId===I)?.structures??[]).map(({structureId:O})=>O),k=(C??[]).concat(D??[]).filter(O=>!N.includes(O));if(k.length)return ce({result:{error:an},context:{invalidStructureIds:k}});S=S??{};for(let O of N)D.includes(O)?S[O]={published:!1}:S[O]={published:!0};g[I].structureDetails=S}let M=(s?.drawDefinitions?.find(N=>N.drawId===I)?.structures??[]).map(({stage:N})=>N);if(R.length){for(let N of R)T[N]={published:!0};for(let N of M)T[N]||(T[N]={published:!1})}if(R.length||P.length){for(let N of P)T[N]={published:!1};for(let N of M)T[N]||(T[N]={published:!0})}(R.length||P.length)&&(g[I].stageDetails=T)}kE({statusObject:{drawDetails:g},removePriorValues:r,status:a,event:s});let{topics:v}=Tu(),b=v.includes(F4),y=b||t.returnEventData?V$({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:n,policyDefinitions:u,event:s})?.eventData:void 0;return b&&Ii({payload:{eventData:y,tournamentId:n.tournamentId},topic:F4}),{...oe,eventData:y}}var s0e="deleteDrawDefinitions",u3="autoSchedulingAudit",Zk="deleteEvents",Ytt={AUTO_SCHEDULING_AUDIT:u3,DELETE_EVENTS:Zk,DELETE_DRAW_DEFINITIONS:s0e};function eH(t){if(!t.tournamentRecord)return{error:nt};let e="deleteDrawDefinitions",i=t.drawIds??[],r=t.event,{autoPublish:n=!0,tournamentRecord:a,auditData:s,eventId:o,force:l}=t,{appliedPolicies:c}=tr({tournamentRecord:a,event:r}),u={...c,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!r){let T=tl({tournamentRecord:a,eventId:o,drawId:d});if(T.error)return T;r=T.event}let p=[],f=[],h=[];if(!r?.drawDefinitions)return ce({info:"event has no drawDefinition",result:{...oe},stack:e});let m=r.drawDefinitions.map(({drawId:T})=>T);if(i.length||(i=m),i=i.filter(T=>m.includes(T)),!i.length)return ce({info:"nothing to do; no matching drawIds in event.",result:{...oe},stack:e});let A=Dt(kn({event:r}).flightProfile,!1,!0),g=({participantId:T,drawPosition:D,qualifier:C,bye:E})=>({bye:E,qualifier:C,drawPosition:D,participantId:T}),v=l??c?.[mu]?.allowDeletionWithScoresPresent?.drawDefinitions,b=Ru({event:r})??{},y=b.drawIds??(b.drawDetails&&Object.keys(b.drawDetails))??[],I,w=[],S=r.drawDefinitions.filter(T=>{if(i.includes(T.drawId)){let D=No({event:r,drawDefinition:T})?.matchUps??[];if(D.some(({score:F})=>wa({score:F}))&&!v)return w.push(T.drawId),!0;let{drawId:C,drawType:E,drawName:P}=T,R=A?.flights?.find(F=>F.drawId===T.drawId);R&&(R.drawEntries=R.drawEntries?.filter(F=>Nd.includes(F.entryStatus))),y.includes(C)&&(y=y.filter(F=>F!==C),I=!0);let M=Td({stageSequence:1,drawDefinition:T,stage:Et})?.structures?.[0],N=(M?e1({structureId:M.structureId,tournamentRecord:a,drawDefinition:T}):void 0)?.positionAssignments?.map(g),k=Td({stage:qt,drawDefinition:T})?.structures,O=k?.length?k.map(F=>{let _=F.stageSequence;return{positionAssignments:e1({structureId:F.structureId,tournamentRecord:a,drawDefinition:T})?.positionAssignments.map(g),stageSequence:_}}):void 0,x={action:s0e,payload:{drawDefinitions:[T],eventId:o??r?.eventId,auditData:s}};h.push(x),p.push(Lt({tournamentId:a.tournamentId,eventId:o??r?.eventId,qualifyingPositionAssignments:O,positionAssignments:N,auditData:s,drawType:E,drawName:P,drawId:C})),D?.forEach(({matchUpId:F})=>f.push(F))}return!i.includes(T.drawId)});if(w.length&&!l)return ce({context:{drawIdsWithScoresPresent:w},result:{error:dM},stack:e});if(r.drawDefinitions=S,A&&iv({event:r,extension:{name:Ud,value:A}}),cN({tournamentRecord:a}),I){let T={};for(let C of y)T[C]=b.drawDetails?.[C]??{published:!0};let D=kE({statusObject:{drawDetails:T},event:r});if(D.error)return{error:D.error}}if(h.length)if(R2(Um)){let T=a.tournamentId;Ii({topic:Um,payload:{tournamentId:T,detail:h}});let D=(Eu({element:r,itemType:sy})?.timeItem?.itemValue||0)+1;Bf({element:r,timeItem:{itemType:sy,itemValue:D},removePriorValues:!0})}else Xtt({appliedPolicies:c,event:r,deletedDrawsDetail:p,auditData:s});if(f.length&&zh({tournamentId:a?.tournamentId,matchUpIds:f}),i.forEach(T=>GYe({drawId:T})),n&&I){let T=xE({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:u,tournamentRecord:a,event:r});if(T.error)return{...oe,info:T.error}}return{...oe}}function Xtt({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){if(t?.audit?.[sy]===!1)return;let{extension:n}=ki({name:sy,element:e}),a={...r,deletedDrawsDetail:i},s={value:Array.isArray(n?.value)?n?.value.concat(a):[a],name:sy};ur({element:e,extension:s})}function o0e({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){if(!e)return{error:nt};if(!r)return{error:Gr};let{flightProfile:a}=kn({event:r});if(a){let s=a.flights?.map(({drawId:l})=>l).filter(Boolean),o=eH({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return o.error?o:W2({event:r,name:Ud})}return{...oe}}function W9(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,s=t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(s).length)return{error:bn};let o=Object.keys(s).filter(c=>!n||n===c);if(n&&!o.includes(n))return{error:we};let l;for(let c of o){let u=s[c],{event:d}=tl({tournamentRecord:u,eventId:a});a&&d&&(l=!0);let p=Ztt({tournamentRecord:u,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...oe}:{error:fu}}function Ztt({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:nt};if(r&&!Array.isArray(r))return{error:we};if(e&&!Array.isArray(e))return{error:we};let a=Wm;if(n){let{extension:s}=ki({element:n,name:a}),o=s?.value||{},l=Hie({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});ur({element:n,extension:{name:a,value:l}})}else{let{extension:s}=ki({element:t,name:a}),o=s?.value||{},l=Hie({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});ur({extension:{name:a,value:l},element:t})}return{...oe}}function Hie(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let s=n?.length&&i.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(c=>c!==r)}:l).filter(({matchUpFormatCodes:l})=>l?.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let o=a?.length&&e.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(c=>c!==r)}:l).filter(({matchUpFormatCodes:l,averageTimes:c})=>l?.length||c).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:s?.length&&s||i,matchUpRecoveryTimes:o?.length&&o||e}}function l0e(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:s,event:o}=t;if(!e)return{error:nt};if(!Zl({matchUpFormat:n}))return{error:we};if(!o)return{error:Gr};let{averageTimes:l=[],recoveryTimes:c=[]}=K$({tournamentRecord:e,matchUpFormat:n,event:o}),u=o.category,d=u?.categoryName||u?.ageCategoryCode||o?.eventId,p={categoryNames:[d],minutes:{}},f={categoryNames:[d],minutes:{}},h=b=>{if(b.categoryTypes?.includes(a)&&console.log("encountered:",{categoryType:a}),!(b.categoryNames?.includes(d)&&(b.categoryNames=b.categoryNames.filter(y=>y!==d),p={minutes:b.minutes,categoryNames:[d]},!b.categoryNames.length)))return b},m=r&&!isNaN(ci(r)),A=i&&!isNaN(ci(i)),g=l.map(h).filter(b=>b?.categoryNames?.length),v=c.map(h).filter(b=>b?.categoryNames?.length);return m&&(Object.assign(p.minutes,{[o?.eventType||Dr]:r}),g.push(p)),A&&(Object.assign(f.minutes,{[o?.eventType||Dr]:i}),v.push(f)),!m&&!A?{error:we}:W9({averageTimes:m&&g,recoveryTimes:A&&v,tournamentRecord:e,matchUpFormat:n,eventId:s})}function tH(t){if(t.event)return Vie({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=Qt(t,[{[Js]:!0,[gUe]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=tl({tournamentRecord:n,eventId:r});if(a)return Vie({event:a})}}return{error:fu}}function Vie({event:t}){return W2({event:t,name:Wm})}var c0e={MON:"MON",TUE:"TUE",WED:"WED",THU:"THU",FRI:"FRI",SAT:"SAT",SUN:"SUN"};function u0e(t){return!Array.isArray(t)||Ei(t).length!==t.length?!1:t.every(e=>Object.keys(c0e).includes(e))}function K9({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:nt};if(!e)return{error:Gr};if(!hf.test(i))return{error:ma};let r=d0e(t);if(r.error)return r;let{tournamentStartDate:n,tournamentEndDate:a}=r,s=new Date(Ui(i)).getTime();if(!n||!a||s<n||s>a)return{error:ma};let o=e.endDate&&new Date(Ui(e.endDate)).getTime();return o&&s>o&&(e.endDate=i),e.startDate=i,{...oe}}function Y9(t){let{tournamentRecord:e,event:i,endDate:r}=t;if(!e)return{error:nt};if(!i)return{error:Gr};if(!hf.test(r))return{error:ma};let n=d0e(e);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:s}=n,o=new Date(Ui(r)).getTime();if(!a||!s||o<a||o>s)return{error:ma};let l=i.startDate&&new Date(Ui(i.startDate)).getTime();return l&&o<l&&(i.startDate=r),i.endDate=r,{...oe}}function X9(t){let e=Qt(t,[{tournamentRecord:!0,event:!0},{[Ps]:l=>hf.test(l),[Nc]:ma,startDate:!1,endDate:!1},{[Ps]:l=>l.filter(Boolean).every(c=>hf.test(c)),[Nc]:ma,activeDates:!1},{[Ps]:u0e,weekdays:!1}]);if(e.error)return e;let{tournamentRecord:i,weekdays:r,event:n,startDate:a,endDate:s}=t,o=t.activeDates?.filter(Boolean);if(a&&s){let l=new Date(Ui(a)).getTime(),c=new Date(Ui(s)).getTime();if(l>c)return{error:we}}if(o){let l=a||i.startDate,c=s||i.endDate,u=!l||o.every(p=>new Date(p)>=new Date(l)),d=!c||o.every(p=>new Date(p)<=new Date(c));if(!u||!d)return{error:ma}}if(a){let l=K9({tournamentRecord:i,event:n,startDate:a});if(l.error)return l}if(s){let l=Y9({tournamentRecord:i,event:n,endDate:s});if(l.error)return l}return o&&(n.activeDates=o),r&&(n.weekdays=r),{...oe}}function d0e(t){let{startDate:e,endDate:i}=t;return!hf.test(e)||!hf.test(i)?ce({result:{error:ywe},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Ui(e)).getTime(),tournamentEndDate:new Date(Ui(i)).getTime()}}function Z9({event:t,orderedDrawIdsMap:e}){if(typeof t!="object")return{error:Gr};if(!e)return{error:Yt,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:we,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(n=>!Number.isNaN(Number(n))))return{error:we,info:"drawOrder must be numeric"};if(Ei(i).length!==i.length)return{info:"drawOrder values must be unique",error:we};if(t.drawDefinitions?.length){let n=(t.drawDefinitions||[]).map(({drawId:s})=>s),a=Object.keys(e);if(a?.length&&Mn(n,a).length!==n.length)return{error:we,info:"Missing drawIds"};t.drawDefinitions.forEach(s=>{s.drawOrder=e[s.drawId]})}let{flightProfile:r}=kn({event:t});return r?.flights?.forEach(n=>{n.flightNumber=e[n.drawId]}),{...oe}}function J9({tournamentRecord:t,event:e}){if(!t)return{error:nt};if(!e)return{error:Gr};let{flightProfile:i}=kn({event:e}),r=i?.flights?.sort((s,o)=>s.flightNumber-o.flightNumber).map(s=>s.drawId).filter(Boolean),n=e.drawDefinitions?.sort((s,o)=>s.drawOrder-o.drawOrder).map(s=>s.drawId).filter(Boolean).filter(s=>!r?.includes(s)),a=Object.assign({},...[...r||[],...n||[]].map((s,o)=>({[s]:o+1})));return a?Z9({event:e,orderedDrawIdsMap:a}):{...oe}}function p0e({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){if(!e)return{error:nt};if(!r)return{error:hp};if(!n)return{error:Gr};let{flightProfile:s}=kn({event:n});if(s&&s.flights?.find(o=>o.drawId===r)){let o=s.flights.filter(c=>c.drawId!==r),l={name:Ud,value:{...s,flights:o}};iv({event:n,extension:l})}if(n.drawDefinitions?.find(o=>o.drawId===r)){let o=eH({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(o.error)return o}return J9({tournamentRecord:e,event:n})}function f0e(t){let e=Qt(t,[{[gA]:!0,[Ua]:!0,[vY]:!1},{replacementIndividualParticipantId:!0,[Ps]:A=>rn(A),existingIndividualParticipantId:!0,[cd]:ba,participantId:!0}]),{replacementIndividualParticipantId:i,existingIndividualParticipantId:r,tournamentRecord:n,drawDefinition:a,participantId:s,event:o,uuids:l}=t;if(e.error)return e;if(o?.eventType!==hu)return{error:Th};if(!(o?.entries?.filter(({entryStatus:A})=>[Du,Sb].includes(A)).map(({participantId:A})=>A)||[]).includes(i))return{error:lp};let c=(n.participants||[]).find(A=>A.participantId===s);if(c?.participantType!==Ni)return{error:tS,participant:c};let u=c.individualParticipantIds,d=[i,...u.filter(A=>A!==r)],{participant:p}=Cd({participantIds:d,tournamentRecord:n}),f;if(p)f=p.participantId;else{let A={participantId:l?.pop(),participantRole:xs,individualParticipantIds:d,participantType:Ni},g=bf({participant:A,returnParticipant:!0,tournamentRecord:n});if(g.error)return g;f=g.participant.participantId}let{flightProfile:h}=kn({event:o});if(a){let A=h?.flights?.find(({drawId:g})=>g===a.drawId);A&&(A.drawEntries=A.drawEntries.map(g=>g.participantId===s?{...g,participantId:f}:g)),a.entries=a.entries.map(g=>g.participantId===s?{...g,participantId:f}:g);for(let g of a.structures||[])if(g.structures){g.positionAssignments=void 0;for(let v of g.structures)v.positionAssignments=v.positionAssignments.map(b=>b.participantId===s?{...b,participantId:f}:b)}else g.positionAssignments&&(g.positionAssignments=g.positionAssignments.map(v=>v.participantId===s?{...v,participantId:f}:v))}o.entries=o.entries.map(A=>A.participantId===s&&{...A,participantId:f}||A.participantId===i&&{...A,participantId:r}||A);let m=n.events.some(({entries:A,eventId:g,drawDefinitions:v})=>o.eventId===g?v.some(({drawId:b,entries:y})=>b===a?.drawId?!1:y?.find(I=>I.participantId===s)):A?.find(b=>b.participantId===s));if(!m){let A=vS({addIndividualParticipantsToEvents:!1,participantIds:[s],tournamentRecord:n});if(A.error)return A}return{...oe,participantOtherEntries:m,newPairParticipantId:f}}function fN(t){let{flight:e,suppressNotifications:i,modifyEventEntries:r,existingDrawCount:n,allowReplacement:a,checkEntryStatus:s,tournamentRecord:o,drawDefinition:l,event:c}=t;if(!l)return{error:kt};if(!c)return{error:Gr};c.drawDefinitions||(c.drawDefinitions=[]);let{drawId:u,drawName:d,entries:p}=l,{entries:f}=c,h=0;if(n!==void 0&&n!==c.drawDefinitions.length)return{error:we,info:"drawDefintions count mismatch"};let{flightProfile:m}=kn({event:c}),A=e&&m?.flights?.find(P=>P.flightNumber===e.flightNumber),g=m?.links?.find(P=>P?.target?.drawId===u)?.source?.drawId;if(g&&!c.drawDefinitions.find(P=>P.drawId===g))return ce({result:{error:kt},info:{sourceDrawId:g}});if(A&&A.drawId!==l.drawId)return ce({result:{error:EI},info:{relevantFlight:A}});let v=p?.every(({participantId:P,entryStatus:R})=>{let M=A?.drawEntries.find(N=>N.participantId===P);return!R||M?.entryStatus===R}),b=!s||f&&p?.every(({participantId:P,entryStatus:R,entryStage:M})=>f.find(N=>N.participantId===P&&(!N.entryStage||N.entryStage===M))?.entryStatus===R);if(A&&!v)return ce({result:{error:EI},context:{drawEntriesPresentInFlight:v,matchingEventEntries:b,relevantFlight:A},info:"Draw entries are not present in flight or do not match entryStatuses"});if(r&&p?.filter(Boolean).forEach(P=>{if(P?.entryStatus&&Nd.includes(P?.entryStatus)){let R=f?.filter(Boolean).find(M=>M.participantId===P.participantId);R&&P.entryStatus&&R?.entryStatus!==P.entryStatus&&(R.entryStatus=P.entryStatus,h+=1)}}),f&&!b)return ce({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:b,eventEntries:f},error:EI}});let y=m?.flights?.map(({flightNumber:P})=>!isNaN(P)&&ci(P))?.filter(Boolean)||[],I=c.drawDefinitions.map(({drawOrder:P})=>P&&ci(P))?.filter(Boolean)||[],w=Math.max(0,...I,...y)+1,S=m?.flights?.find(P=>P.drawId===u),T;if(S){S.drawName=l.drawName,T={name:Ud,value:{...m,flights:m.flights}};let P=S.flightNumber;P&&!I.includes(P)?w=P:S.flightNumber=w}else{let P=m?.flights||[];P.push({manuallyAdded:!0,flightNumber:w,drawEntries:p,drawName:d,drawId:u}),T={name:Ud,value:{...m||{},flights:P}}}iv({event:c,extension:T}),Object.assign(l,{drawOrder:w});let D=c.drawDefinitions.find(P=>P.drawId===u),C=o?.tournamentId,E=c.eventId;if(D){if(!a)return{error:KIe};let P=No({drawDefinition:D})?.matchUps?.map(_a)??[],R=No({drawDefinition:l})?.matchUps;if(!i){P?.length&&zh({matchUpIds:P,action:"modifyDrawDefinition",tournamentId:C,eventId:E}),R?.length&&Tg({matchUps:R,tournamentId:C,eventId:E}),c.drawDefinitions=c.drawDefinitions.map(N=>N.drawId===u?l:N);let M=l.structures?.map(({structureId:N})=>N);kr({drawDefinition:l,tournamentId:C,structureIds:M,eventId:E})}}else if(c.drawDefinitions.push(l),!i){let{matchUps:P}=No({drawDefinition:l,event:c});P&&Tg({tournamentId:o?.tournamentId,matchUps:P}),UM({drawDefinition:l,tournamentId:C,eventId:E})}return{...oe,modifiedEventEntryStatusCount:h}}function h0e(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,assignments:o,drawId:l,event:c}=t,u=0;if(!o?.length)return{error:P8};if(!r)return{error:nt};if(!l)return{error:hp};let d=Au({provisionalPositioning:e,drawDefinition:n,structureId:s});if(d.error)return d;let{seedAssignments:p,seedLimit:f}=d,h=Object.assign({},...(p??[]).filter(g=>g.seedNumber).map(g=>({[g.seedNumber]:g})));o.forEach(g=>{let{seedNumber:v}=g;f&&v<=f&&(!i||h[v])&&(h[v]=g)});let m=Object.values(h),A=m.map(g=>g?.participantId).filter(Boolean);if(A.length!==OIe(A).length)return{error:YIe};for(let g of m){let v=EE({...g,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,event:c});if(v?.error)return v;v?.success&&u++}return u?{...oe,modifications:u}:{error:fE}}function eX({deleteExisting:t,event:e,flightProfile:i}){let r="attachFlightProfile";if(!i)return ce({result:{error:Yt},stack:r});if(!e)return ce({result:{error:Gr},stack:r});let{flightProfile:n}=kn({event:e});return n&&!t?ce({result:{error:W8},stack:r}):e.drawDefinitions?.length?ce({result:{error:jIe},stack:r}):(iv({event:e,extension:{name:Ud,value:i}}),{flightProfile:Dt(i,!1,!0),...oe})}function Jtt({tournamentRecord:t,scaleAttributes:e,participantIds:i}){if(!t)return{error:nt};if(!i)return{error:Jg};if(!e)return{error:Yt,info:"scaleAttributes required"};let{scaleType:r,eventType:n,scaleName:a}=e,s=[hTe,r,n,a].join(".");return t.participants?.forEach(o=>{i.includes(o.participantId)&&o.timeItems&&(o.timeItems=o.timeItems.filter(l=>l&&l?.itemType!==s))}),{...oe}}function tX({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:s}){if(!a)return{error:Gr};if(r&&!Array.isArray(r))return ce({result:{error:we},info:Gy("entryStatus"),stack:"removeScaleValues"});let o=a.entries;if(n){let{flightProfile:c}=kn({event:a}),u=c?.flights?.find(d=>d.drawId===n);u?o=u.drawEntries:o=i?.entries}let l=(o||[]).filter(c=>(!s||!c.entryStage||c.entryStage===s)&&(!r||r.includes(c.entryStatus))).map(qi);return Jtt({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function iH({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=$c,event:n}){if(!e)return ce({result:{error:nt}});if(!n)return ce({result:{error:Gr}});if(!Xi(i))return ce({result:{error:Yt}});if(Xi(i.draws))for(let s of Object.keys(i.draws)){let o=i.draws[s].scheduleDetails??[];if(o.length){let l=[];for(let c of o){let u=l.find(d=>I6e(d.attributes,c.attributes));u?.dates&&c.dates?u.dates.push(...c.dates):l.push(c)}i.draws[s].scheduleDetails=l}}let a=kE({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...oe}}function m0e({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:s}){if(!t)return{error:nt};if(!a)return{error:Gr};r=r||a.category?.categoryName||a.category?.ageCategoryCode;let o={eventType:a.eventType,scaleType:sh,scaleName:r};return tX({tournamentRecord:t,scaleAttributes:o,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:s})}function A0e(t){let e=Qt(t,[{[Ua]:!0},{eventIds:!0,[rl]:qs}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=t,a=[],s=[],o=[],l=[];if(r.events=(r.events||[]).filter(c=>{if(n.includes(c.eventId)){let p={action:Zk,payload:{events:[c]}};a.push(p),s.push({tournamentId:r.tournamentId,eventName:c.eventName,eventType:c.eventType,category:c.category,eventId:c.eventId,gender:c.gender})}let u=c.eventType===hu?(c.entries||[]).map(({entryStatus:p,participantId:f})=>p!==Du&&f).filter(Boolean):[],d=n.includes(c.eventId);return d?l.push(...u):o.push(...u),!d}),i){let c=l.filter(u=>!o.includes(u));r.participants=r.participants.filter(({participantId:u})=>!c.includes(u))}if(cN({tournamentRecord:r}),a.length)if(R2(Um)){let c=r.tournamentId;Ii({topic:Um,payload:{type:Zk,tournamentId:c,detail:a}})}else tN({tournamentRecord:r,timeItem:{itemValue:s,itemType:Zk}});return{...oe}}function g0e(t){let e=Qt(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:fl}]);if(e.error)return e;let{eventUpdates:i,event:r}=t,n="modifyEvent",a=nit(t),s=ait({enteredParticipants:a}),{enteredParticipantGenders:o,enteredParticipantTypes:l}=s,c=kn({event:r})?.flightProfile?.flights,u=!r.drawDefinitions?.length&&!c?.length,d=sit({noFlightsNoDraws:u,enteredParticipantGenders:o,eventUpdates:i,stack:n});if(d.error)return d;let p=oit({enteredParticipantTypes:l,eventUpdates:i,stack:n});if(p.error)return p;let f=eit({...t,...s,enteredParticipants:a,stack:n});if(f.error)return f;let h=rit({...t,stack:n});return h.error?h:(i.eventType&&(r.eventType=i.eventType),i.eventName&&(r.eventName=i.eventName),i.gender&&(r.gender=i.gender),{...oe})}function eit(t){let e=t.eventUpdates?.category;if(!e)return{...oe};let i=LP({category:e});if(i.error)return i;if(t.event.eventType===da){let r=tit(t);if(r.error)return r}if(t.enteredParticipants?.length){let r=iit(t,e);if(r.error)return r}return{...oe}}function tit(t){let e=t.event?.drawDefinitions?.map(n=>Mp(n))??[],i=Mp(t.event),r=(Wh(t)?.matchUps??[]).map(n=>Mp(n))??[];return[i,...e,...r].filter(Boolean).every(n=>n.collectionDefinitions.every(a=>!a.category||hM({category:t.eventUpdates.category,childCategory:a.category})))?{...oe}:ce({result:{error:BP},stack:t.stack})}function iit(t,e){let i=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,r=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,n=t.enteredParticipants.flatMap(o=>o.participantType===Wi?[o]:o.individualParticpants??[]),a=xy({category:e,consideredDate:i}),s=xy({category:e,consideredDate:r});if(a?.ageMinDate||a?.ageMaxDate||s?.ageMinDate||s?.ageMaxDate)for(let o of n){let l=o.person?.birthDate;if(!l)return ce({result:{error:mwe},stack:t.stack});let c=new Date(l).getTime(),u=Gie(c,a,t.stack);if(u)return u;let d=Gie(c,s,t.stack);if(d)return d}return{...oe}}function Gie(t,e,i){if(!e)return null;if(e.ageMinDate||e.ageMaxDate){let r=new Date(e.ageMinDate).getTime(),n=new Date(e.ageMaxDate).getTime();if(t<r||t>n)return ce({result:{error:wwe},stack:i})}return null}function rit(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=X9({startDate:i.startDate,endDate:i.endDate,tournamentRecord:e,event:r});if(a.error)return ce({result:a,stack:n})}return{...oe}}function nit(t){let{tournamentRecord:e,event:i}=t,r=i?.entries?.filter(({entryStatus:n})=>{let a=n;return[...Nd,ud].includes(a)}).map(({participantId:n})=>n)??[];return r?vn({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function ait({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{let s=a.person?.sex?[a.person.sex]:a.individualParticpants?.map(o=>o.person?.sex)||[];return e.push(...s),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=Ei(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function sit({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:r}){let n=!e.length||!i.gender||Ch(i.gender)||e.length===1&&e[0]===i.gender||t&&Tc(i.gender);return i.gender&&!n?ce({context:{gender:i.gender,validGender:n},result:{error:p0},stack:r}):{...oe}}function oit({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(da)&&[da]||t.includes(Wi)&&[mf]||t.includes(Ni)&&[hu]||[hu,mf,da]).includes(e.eventType??"");return e.eventType&&!r?ce({context:{participantType:e.eventType,validEventType:r},result:{error:Th},stack:i}):{...oe}}function rH({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){let s="addFlight";if(!n)return ce({result:{error:Gr},stack:s});if(!i)return ce({result:{error:Yt},stack:s});if(e?.length){let f=(n.entries??[]).map(qi),h=e.map(qi);if(Mn(h,f).length!==h.length)return ce({result:{error:we},stack:s})}let o=kn({event:n})?.flightProfile,l=o?.flights?.map(({flightNumber:f})=>!isNaN(f)&&ci(f))?.filter(Boolean)||[],c=Math.max(0,...l)+1,u={drawId:r||hr(),flightNumber:c,drawEntries:e,drawName:i};if(a&&(u.stage=a),t&&(u.qualifyingPositions=t),(o?.flights||[]).find(({drawId:f})=>f===u.drawId))return ce({result:{error:Ywe},stack:s});let d=(o?.flights||[]).concat(u),p={name:Ud,value:{...o||{},flights:d}};return iv({event:n,extension:p})}var v0e={};Li(v0e,{drawMatic:()=>h9,garman:()=>U0e,generateAdHocMatchUps:()=>D$,generateAdHocRounds:()=>f9,generateAndPopulatePlayoffStructures:()=>H7,generateCourts:()=>iX,generateDrawDefinition:()=>pN,generateDrawMaticRound:()=>i9,generateDrawStructuresAndLinks:()=>J7,generateDrawTypeAndModifyDrawDefinition:()=>e9,generateFlightProfile:()=>uit,generateLineUps:()=>S0e,generateQualifyingStructure:()=>B7,generateSeedingScaleItems:()=>WDe,generateStatCrew:()=>dit,generateVoluntaryConsolation:()=>REe,roundRobinGroups:()=>_9e});var lit="splitLevelBased",y0e="splitWaterfall",b0e="splitShuttle",cit={SPLIT_LEVEL_BASED:lit,SPLIT_WATERFALL:y0e,SPLIT_SHUTTLE:b0e};function uit(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:s,sortDescending:o,drawNames:l=[],flightsCount:c,splitMethod:u,uuids:d=[],event:p,stage:f}=t;if(!p)return{error:Gr};let h=p.entries??[],{flightProfile:m}=kn({event:p});if(m&&i&&!s)return{error:W8};let A=t.scaledEntries??SS({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:o,event:p,stage:f}).scaledEntries,g=new Set(A.map(qi)),v=Po(h.filter(({participantId:C})=>!g.has(C)).filter(C=>(!f||!C.entryStage||C.entryStage===f)&&(!C.entryStatus||Ub.includes(C.entryStatus)))),b=A.concat(...v),y=b.length,I=Math.ceil(y/c),w=$a(b,I);u===y0e?w=v4(b,c):u===b0e&&(w=v4(b,c,!0));function S(C){return(C||[]).map(({participantId:E,scaleValue:P})=>{let R=h.find(M=>M.participantId===E);return R?.scaleValue&&P&&(R.scaleValue=P),R}).sort((E,P)=>E.scaleValue-P.scaleValue).map((E,P)=>(E.scaleValue&&(E.seedNumber=P+1),E))}let T=vt(0,c).map(C=>{let E=C+1;return{flightNumber:E,drawId:d?.pop()??hr(),drawEntries:S(w[C]),drawName:l?.length&&l[C]||`${e} ${E}`}}),D={scaleAttributes:n,splitMethod:u,flights:T};if(i){let C=eX({flightProfile:D,deleteExisting:s,event:p});return{splitEntries:Mc()&&w||void 0,...C}}else return{flightProfile:D,...oe}}function I0e({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(s=>typeof s=="object"&&Object.keys(s).length===1)})),r=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),n=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return w0e({tagName:e,attributes:n,childArrays:i,childObjects:r})}function w0e(t){let{tagName:e,attributes:i=[],childArrays:r=[],childObjects:n}=t,a=`\r
`,s=f=>{let h=Object.keys(f)[0],m=f[h];return{key:h,value:m}},o=r?.map(({key:f,value:h})=>w0e({tagName:f,childObjects:h.map(s)})).join(`\r
`),l=n?.map(({key:f,value:h})=>I0e({tagName:f,json:h??[]})).join(`\r
`),c=i?.map(({key:f,value:h})=>`${f}="${h}"`).join(" "),u=c?` ${c}`:"";if(e==="childArray")return l;let d=l?.length?`${a}${l}${a}`:"",p=o?.length?`${a}${o}${a}`:"";return`<${e}${u}>${d}${p}</${e}>`}function dit(t){let e=Qt(t,[{[Ua]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{startDate:r,tournamentId:n,tournamentName:a}=i,{participantMap:s,matchUps:o,mappedMatchUps:l}=vn({withMatchUps:!0,withEvents:!0,tournamentRecord:i}),c=i.participants.filter(b=>b.participantType===vr),u=o?.filter(b=>b.matchUpType===vr)??[],d=u?.reduce((b,y)=>{let I=y?.tieMatchUps??[];return I&&[...b,...I]},[])??[],p=o?.filter(b=>b.matchUpType===Dr)??[],f=o?.filter(b=>b.matchUpType===br)??[],h=d.length===p.length+f.length,m=u.length===1&&h,A={mappedMatchUps:l,participantMap:s,tournamentName:a,tournamentId:n,tournament:h?"N":"Y",startDate:r},g=[],v=[];if(m){let b=u[0],{json:y,xml:I}=Qie({teamParticipants:c,teamMatchUp:b,...A,doubles:f,singles:p});v.push(y),g.push(I)}else for(let b of u){let y=b?.sides?.map(({participant:T})=>T?.participantId).filter(Boolean);if(y?.length!==2)continue;let I=y.map(T=>T&&s?.[T]?.participant),{xml:w,json:S}=Qie({doubles:b.tieMatchUps?.filter(T=>T.matchUpType===br),singles:b.tieMatchUps?.filter(T=>T.matchUpType===Dr),teamParticipants:I,teamMatchUp:b,...A});v.push(S),g.push(w)}return{json:v,xml:g,...oe}}function Qie({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:s,startDate:o,doubles:l,singles:c}){let u=t?.find(y=>y.participantRoleResponsibilities?.includes("Home")),d=t?.filter(y=>y.participantId!==u?.participantId),p=od(o,"/","MDY"),f=u?.participantName||d?.[1]?.participantName,h=u?.participantId||d?.[1]?.participantId,m=d?.[0]?.participantName,A=d?.[0]?.participantId,g={},v=t.map(y=>({team:{...hit({teamParticipant:y,teamMatchUp:a,uniValues:g,participantMap:i,mappedMatchUps:e,homeid:h})}})),b=Lt({venue:{tournamentname:s?r:void 0,neutralgame:u?"N":"Y",gameid:n,officials:{},tournament:s,rules:{},homename:f,visname:m,homeid:h,visid:A,date:p},childArray:v,singles_matches:c?.map(y=>jie({matchUp:y,homeid:h,uniValues:g})),doubles_matches:l?.map(y=>jie({matchUp:y,homeid:h,uniValues:g}))});return{json:b,xml:I0e({json:b,tagName:"tngame"})}}function pit({homeid:t,uniValues:e,participant:i}){if(!i)return{};let r=i.individualParticipants?.length===2,n=r?Ei(i.individualParticipants?.map(m=>m.teams?.[0]?.participantId)):[],a=r?Ei(i.individualParticipants?.map(m=>m.teams?.[0]?.teamId)):[],s=!r&&i.teams?.[0]?.participantId||n?.length===1&&n[0]||void 0,o=!r&&i.teams?.[0]?.teamId||a?.length===1&&a[0]||s,l=r?void 0:i.participantName,c=i.individualParticipants?.[0]?.participantName,u=i.individualParticipants?.[1]?.participantName,d=t&&(s===t?"H":"V")||"",p=r?void 0:e[s][i.participantId],f=e[s][i.individualParticipants?.[0]?.participantId],h=e[s][i.individualParticipants?.[1]?.participantId];return Lt({vh:d,uni:p,uni_1:f,uni_2:h,team:o,name:l,name_1:c,name_2:u})}function fit({sets:t,sideNumber:e}){return Object.assign({},...t?.map(i=>{let{setNumber:r,side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o}=i,l=`set_${r}`,c=`tie_${r}`,u=e===1?n:a,d=e===1?s:o;return{[l]:u,[c]:d}})??[])}function hit({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){let{participantId:s,participantName:o}=t,l=n&&(s===n?"H":"V")||"",c=i?.[s]?.matchUps,u=c&&Object.keys(c),d=e?.sides?.find(({participant:y})=>y.participantId===s)?.sideNumber,p=e?.score?.sets?.[0]?.[`side${d}Score`]??0;a[s]={};let f={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},h=[],m=[],A=0;for(let y of u??[]){let I=r?.[y],w=I.sides.find(({participant:T})=>T.participantId===s)?.sideNumber,S=I.score?.sets?.[0]?.[`side${w}Score`]??0;A+=S;for(let T of I.tieMatchUps??[]){let{matchUpType:D,winningSide:C}=T,E=C&&(C===w?"w":"l")||"";E&&(f[D][E]+=1);let P=E==="w"?"1":"0",R=E==="l"?"1":"0";if(D===Dr){let M=m.length+1;m.push({singles_pair:{pair:M,won:P,lost:R,tied:"0"}})}else if(D===br){let M=h.length+1;h.push({doubles_pair:{pair:M,won:P,lost:R,tied:"0"}})}}}let g=[{singles:{childArray:m,won:f.SINGLES.w,lost:f.SINGLES.l}},{doubles:{childArray:h,won:f.DOUBLES.w,lost:f.DOUBLES.l}}],v=[],b=1;for(let y of t.individualParticipantIds){let I=i?.[y];if(I){let{participant:w,counters:S}=I,T={won:S?.DOUBLES?.wins||0,lost:S?.DOUBLES?.losses||0},D={won:S?.SINGLES?.wins||0,lost:S?.SINGLES?.losses||0},{participantName:C,participantId:E}=w;a[s][E]=b,v.push({player:{name:C,uni:b,singles:D,doubles:T}})}b+=1}return{vh:l,id:s,name:o,score:p||A,totals:g,childArray:v}}function jie({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:s}=t??{},o=s?.map(l=>{let{sideNumber:c,participant:u}=l,d=fit({sets:t.score?.sets,sideNumber:c});return{[a===Dr?"singles_score":"doubles_score"]:{...pit({homeid:e,uniValues:i,participant:u}),...d}}});return{[a===Dr?"singles_match":"doubles_match"]:{match:r,order:n,childArray:o}}}var mit="DESC",d3="DESC",Ait={ASC:"ASC",ASCENDING:"ASC",DESC:mit,DESCENDING:d3};function S0e(t){let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:r,drawDefinition:n,scaleAccessor:a,singlesOnly:s,attach:o,event:l}=t;if(l?.eventType!==Jl)return{error:Th};if(!r)return{error:nt};if(!e&&!n)return{error:Rc};if(e=e??po({drawDefinition:n,event:l})?.tieFormat,Jo({tieFormat:e}).error)return{error:ah};if(typeof a!="object"&&!i)return{error:we,context:{scaleAccessor:a}};let c={},u=(n?.entries??l?.entries??[]).filter(E=>E?.entryStatus===Sl).map(qi),{participants:d=[]}=vn({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:r}),p=d.filter(({participantId:E})=>u.includes(E)),f=E=>E===wg?"rankings":"ratings",h=l?.category?.categoryName??l?.category?.ageCategoryCode,{scaleName:m=h,scaleType:A=wg,sortOrder:g,accessor:v}=a||{},b=f(A),y=(E,P)=>{let R=E[b]?.[P];if(!R&&i&&(R=E[b]?.[CI]),Array.isArray(R)){let M=R.find(N=>N.scaleName===m)?.scaleValue;if(Un(M))return M;if(v&&typeof M=="object")return M[v]}return 0},I=(E,P,R)=>{let M=g===d3?P:E,N=g===d3?E:P;return y(M,R)-y(N,R)},w=(E,P)=>I(E,P,CI),S=(E,P)=>I(E,P,By),T=[],D=e?.collectionDefinitions??[];for(let E of p){let P=E.individualParticipants?.sort(w)??[],R=s?P:E.individualParticipants?.sort(S)??[],M={};for(let k of D){let O=[],{collectionId:x,matchUpCount:F,matchUpType:_,gender:V}=k,G=Vn(CI)(_);vt(0,F).forEach(z=>{let Q=G?P:R??[],j=z+1,W=[];vt(0,G?1:2).forEach(Y=>{let X=Q?.find(J=>{let ie=Ks(V),ue=ie&&(ff(V)&&ie||Tc(V)&&[oa,Ds][Y]);return(!ue||ue===J.person?.sex)&&!O.includes(J.participantId)})?.participantId;X&&(W.push(X),O.push(X),M[X]||(M[X]=[]),M[X].push({collectionPosition:j,collectionId:x}))}),G||T.push(W)})}let N=Object.keys(M).map(k=>({collectionAssignments:M[k],participantId:k}));c[E.participantId]=N}let C=[];for(let E of T){let{participant:P}=Cd({tournamentParticipants:d,participantIds:E});if(!P){let R={individualParticipantIds:E,participantRole:xs,participantType:Ni};C.push(R)}}if(o){for(;C.length;)bf({participant:C.pop(),tournamentRecord:r});ur({element:n,extension:{name:qm,value:c}})}return{...oe,lineUps:c,participantsToAdd:C}}function iX(t){if(!t)return{error:Yt};let e=Qt(t,[{dates:!1,[Ps]:s=>Array.isArray(s)&&s.every(Ro)},{uuids:!1,[Ps]:s=>Array.isArray(s)&&s.every(rn)},{startTime:!1,endTime:!1,[Ps]:rY},{idPrefix:!1,namePrefix:!1,[Ps]:rn},{count:!0,[Ps]:Un}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&GT(i,r)||[],a=vt(1,t.count+1).map(s=>Lt({courtId:t.uuids?.pop()??(t.idPrefix&&`${t.idPrefix}-${s}`)??hr(),courtName:t.courtNames?.pop()??(t.namePrefix&&`${t.namePrefix} ${s}`),dateAvailability:n.map(o=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:o}))}));return{...oe,courts:a}}var U0e={};Li(U0e,{default:()=>yit,garman:()=>E0e});function _E(t){let e=Qt(t,[{courtDate:!0,_ofType:fl}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=Jn(r.startTime);(r.bookings||[]).filter(o=>!o.bookingType||!i.includes(o.bookingType)).sort((o,l)=>(E_(o.startTime)||"").localeCompare(E_(l.startTime)||"")).forEach(o=>{let l={startTime:Kr(a.toISOString()),endTime:o.startTime};Jn(o.startTime)>a&&n.push(l),Jn(o.endTime)>a&&(a=Jn(o.endTime))});let s={startTime:Kr(a.toISOString()),endTime:r.endTime};return Jn(r.endTime)>a&&n.push(s),{timeSlots:n}}function git({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=s=>{let{timeSlots:o}=_E({includeBookingTypes:e,courtDate:s});return!!o?.filter(a)?.length};function a(s){let o=Jn(s.startTime),l=Jn(s.endTime);return o>i||l<r?!1:fM(i,l)>=t}return{enoughTime:n}}function T0e(t){let e=Qt(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:qs}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,s=t.courts,o=Jn(n),l=aY(o,i),{enoughTime:c}=git({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:o,periodEndTime:l});return{availableToScheduleCount:(s?.filter(u=>{if(!Array.isArray(u.dateAvailability))return!1;let d=Pg({date:a,court:u});return!!(d&&c(d))})||[]).length,...oe}}function nH(t){let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:r=30,scheduleDate:n,courts:a=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(a)||!a.length)return{error:we,courts:a};if(!Array.isArray(s))return{error:S_};if(!Ro(n))return{error:ma};i&&(Array.isArray(i)?i.includes(n)&&(s=[]):s=[]);let{courtBookings:o,unassignedBookings:l}=s.reduce((p,f)=>{let{courtId:h}=f;return h?p.courtBookings[h]?p.courtBookings[h].push(f):p.courtBookings[h]=[f]:p.unassignedBookings.push(f),p},{courtBookings:{},unassignedBookings:[]}),c=a.map((p,f)=>{let{courtId:h,courtName:m}=p,A=o[h]||[],g=Pg({date:n,court:p})||{},{bookings:v=[],startTime:b,endTime:y,date:I}=g,w=[e[f]&&{startTime:b,endTime:e[f]},...Dt(v,!1,!0),...A].filter(Boolean);return{courtId:h,courtName:m,dateAvailability:{bookings:w,startTime:b,endTime:y,date:I}}});l.sort((p,f)=>sr(p.startTime)-sr(f.startTime));let u=()=>c.flatMap(p=>{let f=p.dateAvailability,{timeSlots:h=[]}=_E({courtDate:f});return{courtName:p.courtName,courtId:p.courtId,timeSlots:h}}),d=[];for(let p of l){let{startTime:f,endTime:h,averageMinutes:m,recoveryMinutes:A,matchUpId:g}=p,v=sr(f),b=sr(h),y=u().reduce((I,{courtId:w,courtName:S,timeSlots:T})=>{let D;return T.find(({startTime:C,endTime:E})=>{D=sr(C)-v;let P=v>=sr(C);return b<=sr(E)&&I.startDifference!==0&&((D===0||D+r>=0)&&(I.startDifference===void 0||D<I.startDifference)||P)})?{courtName:S,courtId:w,startDifference:D}:I},{});if(y.courtId){let I={averageMinutes:m,recoveryMinutes:A,matchUpId:g,startTime:f,endTime:h};d.push(I),c.find(({courtId:w})=>w===y.courtId)?.dateAvailability.bookings.push(I)}else console.log({unassignedBooking:p})}return{virtualCourts:c.map(({courtId:p,courtName:f,dateAvailability:h})=>({dateAvailability:[h],courtName:f,courtId:p})),assignedBookings:d}}function aH({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function C0e(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return vt(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function nC({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,s)=>{let o=Pg({date:t,court:s}),l=n&&(o?.[n]||s[n]);return l&&(!a||e&&sr(l)<sr(a)||i&&sr(l)>sr(a))?l:a},void 0)}function vit({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||nC({courts:r,scheduleDate:n,startTime:!0}),i=i||nC({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let s=Jn(e),o=Jn(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let c=Pg({court:l,date:n}),{timeSlots:u}=_E({courtDate:c});u?.forEach(d=>{let p=Jn(d.startTime),f=Jn(d.endTime);if(p>o||p<s||f<s)return!1;if(fM(p,f)>=t){let h=Kr(p.toISOString());h&&(!a||h<a)&&(a=h)}})}}return{firstTimeSlotStartTime:a}}function rX(t){let e=Qt(t,[{courts:!0,_ofType:qs}]);if(e.error)return e;let{date:i=iY(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:s}=t,{calculateStartTimeFromCourts:o=!0,remainingScheduleTimes:l,averageMatchUpMinutes:c,clearScheduleDates:u,courtsCount:d,bookings:p}=t;a=a||aH({averageMatchUpMinutes:c}),i=Ui(i),r=Kr(r),n=Kr(n);let f=0,h=0,m=0,A=0,g=0;!s&&d&&(s=C0e({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:v}=nH({remainingScheduleTimes:l,clearScheduleDates:u,scheduleDate:i,periodLength:a,bookings:p,courts:s}),{firstTimeSlotStartTime:b}=vit({averageMinutes:c,courts:v,startTime:r,endTime:n,date:i});o&&b&&(r=b??r);let y=sr(r),I=sr(n)-y,w=Math.floor(I/a),S=vt(0,w+1).map(T=>{let D=y+T*a,C=N8e(D),E=T0e({courts:v??[],averageMatchUpMinutes:c,periodStart:C,date:i});if(E.error)return{error:E.error};let{availableToScheduleCount:P=0}=E,R=P>h?P-h:0;g+=T?P:0;let M=T?g/T:P,N=a*M/c,k=T?N*(T-1)+M:M,O=P?h&&k-f||R:0;f=k,h=P,m+=O;let x=ci(m)-A;return A+=x,{periodStart:C,add:x,availableToScheduleCount:P,newCourts:R,totalMatchUps:A}});return{scheduleTimes:S.reduce((T,D)=>{let C=vt(0,D.add).map(()=>({scheduleTime:D.periodStart}));return T.concat(...C)},[]).flat(),timingProfile:S,totalMatchUps:A}}var E0e={getCourtsAvailableAtPeriodStart:T0e,generateTimeSlots:_E,getScheduleTimes:rX,courtGenerator:C0e},yit=E0e,au={};Li(au,{isValid:()=>Zl,isValidMatchUpFormat:()=>Zl,parse:()=>ys,stringify:()=>x2});var D0e={};Li(D0e,{allCompetitionMatchUps:()=>up,allDrawMatchUps:()=>No,allEventMatchUps:()=>Wh,allTournamentMatchUps:()=>as,analyzeMatchUp:()=>n1,applyLineUps:()=>X0e,assignMatchUpSideParticipant:()=>R0e,assignTieMatchUpParticipantId:()=>q_,bulkMatchUpStatusUpdate:()=>q0e,calculateWinCriteria:()=>TS,checkInParticipant:()=>aX,checkMatchUpIsComplete:()=>oy,checkOutParticipant:()=>nX,competitionScheduleMatchUps:()=>dN,disableTieAutoCalc:()=>Q0e,drawMatchUps:()=>H9,enableTieAutoCalc:()=>H0e,eventMatchUps:()=>Y$,filterMatchUps:()=>vm,findMatchUp:()=>C9,getAllDrawMatchUps:()=>ia,getAllStructureMatchUps:()=>dr,getCheckedInParticipantIds:()=>hS,getCompetitionMatchUps:()=>r1,getEventMatchUpFormatTiming:()=>N9,getHomeParticipantId:()=>_9,getMatchUpCompetitiveProfile:()=>_M,getMatchUpContextIds:()=>O9,getMatchUpDailyLimits:()=>Z$,getMatchUpDailyLimitsUpdate:()=>B9,getMatchUpDependencies:()=>Bd,getMatchUpFormat:()=>F9,getMatchUpFormatTiming:()=>OM,getMatchUpFormatTimingUpdate:()=>M9,getMatchUpScheduleDetails:()=>c$,getMatchUpType:()=>u$,getMatchUpsStats:()=>L9,getModifiedMatchUpFormatTiming:()=>K$,getParticipantResults:()=>ZM,getPredictiveAccuracy:()=>x9,getRoundMatchUps:()=>Oo,getRounds:()=>$9,isValidMatchUpFormat:()=>Zl,matchUpActions:()=>C$,mutate:()=>P0e,participantScheduledMatchUps:()=>k9,query:()=>$De,removeDelegatedOutcome:()=>V0e,removeMatchUpSideParticipant:()=>lX,removeTieMatchUpParticipantId:()=>N0e,replaceTieMatchUpParticipantId:()=>oX,resetAdHocMatchUps:()=>K0e,resetMatchUpLineUps:()=>mX,resetScorecard:()=>gX,resetTieFormat:()=>AX,setDelegatedOutcome:()=>W0e,setMatchUpFormat:()=>j0e,setMatchUpState:()=>Rb,setMatchUpStatus:()=>hN,setOrderOfFinish:()=>Y0e,substituteParticipant:()=>G0e,tallyParticipantResults:()=>RE,toggleParticipantCheckInState:()=>sH,tournamentMatchUps:()=>X$,updateTieMatchUpScore:()=>IA,validMatchUp:()=>n$,validMatchUps:()=>Pu});var P0e={};Li(P0e,{applyLineUps:()=>X0e,assignMatchUpSideParticipant:()=>R0e,assignTieMatchUpParticipantId:()=>q_,bulkMatchUpStatusUpdate:()=>q0e,checkInParticipant:()=>aX,checkOutParticipant:()=>nX,disableTieAutoCalc:()=>Q0e,enableTieAutoCalc:()=>H0e,findMatchUp:()=>C9,removeDelegatedOutcome:()=>V0e,removeMatchUpSideParticipant:()=>lX,removeTieMatchUpParticipantId:()=>N0e,replaceTieMatchUpParticipantId:()=>oX,resetAdHocMatchUps:()=>K0e,resetMatchUpLineUps:()=>mX,resetScorecard:()=>gX,resetTieFormat:()=>AX,setDelegatedOutcome:()=>W0e,setMatchUpFormat:()=>j0e,setMatchUpState:()=>Rb,setMatchUpStatus:()=>hN,setOrderOfFinish:()=>Y0e,substituteParticipant:()=>G0e,toggleParticipantCheckInState:()=>sH,updateTieMatchUpScore:()=>IA});function R0e({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){if(i&&typeof i!="string")return{error:lp};if(!e)return{error:kt};if(!n)return{error:go};let s=r===void 0;if(s&&(r=1),![1,2].includes(r))return ce({result:{error:we,context:{sideNumber:r}}});let{matchUp:o,structure:l}=Yr({drawDefinition:e,matchUpId:n,event:a});if(!o)return{error:Zs};if(!(!l?.structures&&!(e.drawType&&e.drawType!==ec)&&!l?.matchUps?.find(({roundPosition:c})=>!!c)))return{error:T8};if(!i&&(o?.score?.scoreStringSide1||ta.includes(o?.matchUpstatus)||o?.matchUpStatus&&[An,Aa].includes(o.matchUpStatus)))return{error:w2,info:"matchUp has completed status or score"};if(o){if(o.sides=[1,2].map(c=>{let u=o.sides?.find(d=>d.sideNumber===c)??{sideNumber:c};return r===c?{...u,participantId:i}:u}),s)for(let c of o.sides)c.sideNumber&&(c.sideNumber=3-c.sideNumber);Zi({tournamentId:t?.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:o})}return{...oe,sidesSwapped:s}}function nc({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s,event:o}){let{matchUp:l}=Yr({drawDefinition:r,event:o,matchUpId:a});if(!l)return{error:Zs};let c=Bf({removePriorValues:t,element:l,duplicateValues:i,timeItem:s});return n||Zi({tournamentId:e?.tournamentId,eventId:o?.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),c}function nX(t){let e=[{[Ua]:!0},{[ro]:!0},{[Nh]:!0},{[Rf]:!0}],i=Qt(t,e);if(i.error)return i;let r=NE(t,[{[AE]:Qh,attr:{[G2]:!0}}]);if(r.error)return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=r?.matchUp?.matchUp,{matchUpStatus:c,score:u}=l??{};if(c&&DY.includes(c)||c&&ta.includes(c)||wa({score:u}))return{error:JIe};let d=hS({matchUp:l});if(d?.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:f}=d??{};if(!f?.includes(s))return{error:lp};if(!p?.includes(s))return{error:Pwe};let h=lTe({matchUp:l});if(h?.error)return h;let{sideParticipantIds:m,nestedIndividualParticipantIds:A}=h??{},g=m?.indexOf(s);return g!==void 0&&[0,1].includes(g)&&(A?.[g]??[]).forEach(v=>{nc({drawDefinition:a,matchUpId:o,timeItem:{itemType:x_,itemValue:v}})}),nc({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:x_}}),{...oe,checkedOut:!0}}function aX(t){let e=[{[Ua]:!0},{[ro]:!0},{[Nh]:!0},{[Rf]:!0}],i=Qt(t,e);if(i[cd])return i;let r=NE(t,[{[AE]:Qh,attr:{[G2]:!0}}]);if(r[cd])return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=hS({matchUp:r?.matchUp?.matchUp});if(l?.error)return l;let{checkedInParticipantIds:c,allRelevantParticipantIds:u}=l??{};if(!u?.includes(s))return{[cd]:lp};let d={...oe,checkedIn:!0};return c?.includes(s)||nc({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:k_}}),d}function sH(t){let e=Qt(t,[{[Nh]:!0,[ro]:!0,[Rf]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,r=t.tournamentRecord??(i&&t.tournamentRecords?.[i]);if(!r)return{error:nt};let n=NE(t,[{[AE]:Qh,attr:{[G2]:!0},[cd]:Zs}]).matchUp?.matchUp;if(!n)return{error:Zs};let{checkedInParticipantIds:a=[]}=hS({matchUp:n}),{participantId:s,matchUpId:o,drawDefinition:l}=t;return s&&a.includes(s)?nX({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n}):aX({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n})}function sX({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){if(!t)return{error:nt};if(!e)return{error:hp};if(!r)return{error:fu};let n=os({drawDefinition:e}),{matchUp:a}=Yr({matchUpId:i,drawDefinition:e,matchUpsMap:n});if(!a)return{error:Zs};let{matchUp:s,structure:o}=Yr({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:n,event:r});if(!s)return{error:Zs};let{collectionPosition:l,drawPositions:c,collectionId:u,matchUpTieId:d,matchUpType:p}=s;if(p&&!g2([Dr,br],p))return{error:wl};let{positionAssignments:f}=wr({structure:o}),h=f?.filter(w=>c?.includes(w.drawPosition)),{matchUp:m}=Yr({matchUpId:d,drawDefinition:e,matchUpsMap:n}),A=m?.sides?.map(qi)??[],g=h?.map(qi)??[],v=[...A,...g],{participants:b}=vn({tournamentRecord:t,participantFilters:{participantTypes:[vr],participantIds:v}}),{matchUp:y}=Yr({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:n}),I=po({matchUp:m,drawDefinition:e,structure:o,event:r})?.tieFormat;return{inContextDualMatchUp:y,inContextTieMatchUp:s,relevantAssignments:h,collectionPosition:l,teamParticipants:b,collectionId:u,matchUpType:p,dualMatchUp:m,tieMatchUp:a,tieFormat:I,structure:o,...oe}}function oX(t){let e=sX(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:r,tournamentRecord:n,newParticipantId:a,drawDefinition:s,substitution:o,event:l}=t;if(!r||!a)return ce({result:{error:ba},stack:i});if(r===a)return{...oe};let{inContextDualMatchUp:c,inContextTieMatchUp:u,collectionPosition:d,collectionId:p,dualMatchUp:f,tieMatchUp:h,tieFormat:m}=e,A=u?.matchUpType,g=u?.sides?.find(x=>x.participant?.participantId===r||x.participant?.individualParticipantIds?.includes(r));if(!g)return{error:Fn};let v=vn({tournamentRecord:n,participantFilters:{participantIds:[r,a]}})?.participants??[];if(v.length!==2)return ce({result:{error:ba},stack:i});if(v[0].participantType!==v[1].participantType)return ce({result:{error:cp},stack:i});let{appliedPolicies:b}=tr({tournamentRecord:n,drawDefinition:s,event:l}),y=t.policyDefinitions?.[Ja]??b?.[Ja]??CE[Ja],I=v.find(({participantId:x})=>x===a);if((t.enforceGender??y?.participants?.enforceGender)!==!1&&ff(u?.gender)&&Ks(u?.gender)!==Ks(I?.person?.sex))return{error:tS,info:"Gender mismatch"};let w=y?.processCodes?.substitution;eN({tournamentId:n.tournamentId,eventId:l.eventId,inContextDualMatchUp:c,drawDefinition:s,dualMatchUp:f});let S=f?.sides?.find(({sideNumber:x})=>x===g.sideNumber);if(!S)return ce({result:{sideNumber:g.sideNumber,existingParticipantId:r,error:rs},stack:i});if(u?.sides?.flatMap(x=>x.participant?.individualParticipantIds||x.participant?.participantId||[])?.includes(a))return ce({result:{error:U2},stack:i});let T=c?.sides?.find(({sideNumber:x})=>x===g.sideNumber)?.participantId,D=S.lineUp,C=D?.find(({participantId:x})=>a===x),E=D?.reduce((x,F)=>F.substitutionOrder>x?F.substitutionOrder:x,0),P=D?.map(x=>{let F=Dt(x,!1,!0);if(![r,a].includes(F.participantId))return F;if(!o&&[r,a].includes(F.participantId)&&(F.collectionAssignments=F.collectionAssignments?.filter(_=>!(_.collectionPosition===d&&_.collectionId===p))),o&&r===F.participantId&&(F.collectionAssignments=F.collectionAssignments.map(_=>_.collectionPosition===d&&_.collectionId===p&&_.substitutionOrder===void 0?{..._,substitutionOrder:E}:_)),F.participantId===a){F.collectionAssignments||(F.collectionAssignments=[]);let _={collectionId:p,collectionPosition:d};o&&(_.previousParticipantId=r,_.substitutionOrder=(E??0)+1),F.collectionAssignments.push(_)}return F})??[];if(!C){let x={collectionId:p,collectionPosition:d};o&&(x.substitutionOrder=(E??0)+1,x.previousParticipantId=r);let F={collectionAssignments:[x],participantId:a};P.push(F)}let R=A===br,{assignedParticipantIds:M}=__({lineUp:D,collectionPosition:d,collectionId:p}),{assignedParticipantIds:N}=__({lineUp:P,collectionPosition:d,collectionId:p});if(S.lineUp=P,T&&m){let x=bS({participantId:T,lineUp:P,drawDefinition:s,tieFormat:m});if(x.error)return ce({result:x,stack:i})}else console.log("team participantId not found");let k,O;if(R){let{tournamentRecord:x}=t,F=Cd({participantIds:N,tournamentRecord:x});if(!F.participant){let V=bf({returnParticipant:!0,pairOverride:!0,tournamentRecord:x,participant:{participantRole:xs,individualParticipantIds:N,participantType:Ni}});if(V.error)return ce({result:V,stack:i});k=V.participant?.participantId}F=Cd({participantIds:M,tournamentRecord:x});let _=F.participant?.participantId;_&&vS({participantIds:[_],tournamentRecord:x}).success&&(O=_)}if(o||g.substitutions?.length===1){if(o)w&&h&&(h.processCodes=Ei([...h?.processCodes??[],...w]));else for(let x of w||[]){let F=h?.processCodes?.lastIndexOf(x);F!==void 0&&h?.processCodes?.splice(F,1)}h&&Zi({tournamentId:n?.tournamentId,matchUp:h,context:i,drawDefinition:s})}return f&&Zi({tournamentId:n?.tournamentId,matchUp:f,context:i,drawDefinition:s}),{...oe,modifiedLineUp:P,participantRemoved:O,participantAdded:k}}function M0e({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){if(!a||!t||!Array.isArray(n))return{modifiedLineUp:i?.lineUp||[],error:we};let s=i?.lineUp||Hy({participantId:e,drawDefinition:r})?.lineUp,o=[],l=[];return{modifiedLineUp:s?.map(c=>{if(!n.includes(c.participantId))return c;let u=c.collectionAssignments?.filter(d=>{let p=d.collectionId===a&&d.collectionPosition===t;return p&&(d.previousParticipantId&&o.push(d.previousParticipantId),l.push({participantId:c.participantId,...d})),!p});return{participantId:c.participantId,collectionAssignments:u}}).filter(Boolean)||[],assignmentsRemoved:l,previousParticipantIds:o}}function bit({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r=(i.events||[]).filter(a=>a?.eventType===da&&a?.entries?.some(s=>s.participantId===e)),n=a=>!t.includes(a.participantId);for(let a of r){a.entries=(a.entries||[]).filter(n);let{flightProfile:s}=kn({event:a});s?.flights?.forEach(o=>{o.drawEntries=(o.drawEntries||[]).filter(n)}),a?.drawDefinitions?.forEach(o=>{o.entries=(o.entries||[]).filter(n)})}return{...oe}}function oH({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return ce({result:{error:nt},stack:n});if(!e||!t)return ce({result:{error:Yt},stack:n});let a=r.participants??[],s=a.find(d=>d.participantId===e);if(!s)return ce({result:{error:Fn},stack:n});if(s?.participantType&&![vr,Lc].includes(s.participantType))return ce({context:{participantType:s.participantType},result:{error:cp},stack:n});let o=t.filter(d=>a.find(p=>p.participantId===d)?.participantType!==Wi);if(o.length)return ce({result:{error:Ll,invalidParticipantIds:o},stack:n});s.individualParticipantIds||(s.individualParticipantIds=[]);let l=s.individualParticipantIds,c=t.filter(d=>!l.includes(d));c.length&&(i&&f$({individualParticipantIds:c,tournamentRecord:r}),s.individualParticipantIds=s.individualParticipantIds.concat(...c));let{topics:u}=Tu();if(u.includes($s)){let d=a.find(({participantId:p})=>p===e);Ii({topic:$s,payload:{participants:[d]}})}return bit({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:Dt(s,!1,!0),added:c.length,...oe}}function lH(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:s}=t;if(!n)return{error:nt};if(!s)return{error:iS};if(!s.participantId)return bf({tournamentRecord:n,participant:s});let{participant:o}=nv({participantId:s.participantId,tournamentRecord:n});if(!o)return bf({tournamentRecord:n,participant:s});let{participantRoleResponsibilties:l,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:p,participantType:f,onlineResources:h,contacts:m,person:A}=s;if(f&&o.participantType!==f)return{error:Iwe};let g={};if(m&&(g.contacts=m),h&&(g.onlineResources=h),u&&rn(u)&&(g.participantOtherName=u),d&&rn(d)&&(g.participantName=d),Array.isArray(c)){let{participants:v}=vn({participantFilters:{participantTypes:[Wi]},tournamentRecord:n}),b=v?.map(qi);if(b){let y=c.filter(I=>rn(I)&&b.includes(I));([Lc,Hr].includes(f||o.participantType)||f===Ni&&(y.length===2||a))&&(g.individualParticipantIds=y),o.participantType===h0.PAIR&&e&&(g.participantName=Iit({individualParticipants:v,newValues:g}))}}return Object.keys(d7).includes(p)&&(g.participantRole=p),Object.keys(h0).includes(f)&&(g.participantType=f),Array.isArray(l)&&(g.participantRoleResponsibilties=l),o.participantType===h0.INDIVIDUAL&&A&&wit({updateParticipantName:e,existingParticipant:o,newValues:g,person:A}),Object.assign(o,Lt(g)),i&&oH({individualParticipantIds:[o.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),Ii({topic:$s,payload:{tournamentId:n.tournamentId,participants:[o]}}),{participant:Dt(o),...oe}}function Iit({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n?.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function wit({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:s,nationalityCode:o,personId:l,birthdate:c,tennisId:u,sex:d}=r;d&&Object.keys(B2).includes(d)&&(n.sex=d);let p;if(rn(l)&&(n.personId=l),o&&rn(o)&&(Sit(o)||o==="")&&(n.nationalityCode=o),a&&typeof rn(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),s&&typeof rn(s)&&s.length>1&&(n.standardGivenName=s,p=!0),p&&t){let f=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=f}c&&Ro(c)&&(n.birthdate=c),u&&rn(u)&&(n.tennisId=u),Object.assign(e.person,n)}function Sit(t){return og.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function q_(t){let e=sX(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",r=t.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:s,event:o}=t;if(!s)return ce({result:{error:ba},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return ce({result:{error:x8},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:c,relevantAssignments:u,collectionPosition:d,teamParticipants:p,collectionId:f,matchUpType:h,dualMatchUp:m,tieFormat:A}=e;if(c?.sides?.flatMap(_=>_.participant?.individualParticipantIds||_.participant?.participantId||[])?.includes(s))return ce({result:{...oe},stack:i});r=r??(t.sideNumber?l?.sides?.find(_=>_.sideNumber===t.sideNumber)?.participantId:void 0);let g=vn({participantFilters:{participantIds:[s]},tournamentRecord:n})?.participants?.[0];if(!g)return ce({result:{error:Fn},stack:i});let{appliedPolicies:v}=tr({tournamentRecord:n,drawDefinition:a,event:o}),b=t.policyDefinitions?.[Ja]??v?.[Ja]??CE[Ja];if((t.enforceGender??b?.participants?.enforceGender)!==!1&&ff(c?.gender)&&Ks(c?.gender)!==Ks(g.person?.sex))return{error:tS,info:"Gender mismatch"};let{individualParticipantIds:y,participantType:I}=g;if(Vn(Dr)(h)&&I!==Wi)return{error:cp};let w=I===Wi?[s]:y,S=r&&p?.find(({participantId:_})=>_===r)||p?.find(({individualParticipantIds:_})=>_o(w,_));if(!S)return{error:j8};if(r||(r=S.participantId),!r)return{error:Fn};let T=u?.find(_=>_.participantId===S?.participantId)?.drawPosition,D=m?.sides?.find(_=>_.participantId===r)?.sideNumber,C=c?.sides?.find(_=>T&&_.drawPosition===T)?.sideNumber,E=D??C??t.sideNumber;if(!A)return{error:dE};if(!A.collectionDefinitions?.find(_=>_.collectionId===f))return{error:pwe};eN({tournamentId:n.tournamentId,eventId:o.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:m});let P=m?.sides?.find(_=>_.sideNumber===E),R=c?.sides?.find(_=>_.sideNumber===E),M=(P?.lineUp??Hy({participantId:r,drawDefinition:a})?.lineUp)?.filter(_=>_.collectionAssignments?.find(V=>V.collectionPosition===d&&V.collectionId===f&&!V.previousParticipantId))?.map(_=>_?.participantId),N=M?.length>1&&M||(I===Ni?g.individualParticipantIds:[s]),k=M0e({collectionPosition:d,teamParticipantId:r,dualMatchUpSide:P,drawDefinition:a,participantIds:N,collectionId:f});if(k.error)return ce({result:k,stack:i});let{modifiedLineUp:O}=k,x;if(h===br){if(I!==Ni){let _=nG({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:s,collectionId:f,tieFormat:A});if(_?.error)return ce({result:_,stack:i});if(_=F({side:R}),_.error)return _;x=_.deletedParticipantId,P&&(P.lineUp=O),m&&Zi({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:a})}else if(I===Ni)for(let _ of N)nG({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:_,collectionId:f,tieFormat:A})}else{let _=nG({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:s,collectionId:f,tieFormat:A});if(_?.error)return _}if(P&&(P.lineUp=O),m&&Zi({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:a}),x){let{error:_}=vS({participantIds:[x],tournamentRecord:n});_&&console.log("cleanup")}return{...oe,modifiedLineUp:O};function F({side:_}){let V;if(_.participant){let G=_.participant.individualParticipantIds||[];if(G.filter(Boolean).length===1){let{participant:z}=Cd({participantIds:G,tournamentRecord:n});G.push(s);let{participant:Q}=Cd({participantIds:G,tournamentRecord:n});if(!Q&&z){z.individualParticipantIds=G;let j=lH({pairOverride:!0,tournamentRecord:n,participant:z});if(j.error)return j}else V=z?.participantId}}else{let G=bf({participant:{individualParticipantIds:[s],participantRole:xs,participantType:Ni},pairOverride:!0,tournamentRecord:n});if(G.error)return G}return{...oe,deletedParticipantId:V}}}function nG({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:s}){let o=Hy({participantId:e,drawDefinition:i})?.lineUp,l=(r||o)?.find(u=>u?.participantId===n),c={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(c);else{let u={collectionAssignments:[c],participantId:n};r.push(u)}return bS({participantId:e,lineUp:r,drawDefinition:i,tieFormat:s})}function N0e(t){let{tournamentRecord:e,drawDefinition:i,participantId:r,event:n}=t,a="removeTieMatchUpParticiapantId";if(!r)return ce({result:{error:ba},stack:a});let s=sX(t);if(s.error)return s;let{appliedPolicies:o}=tr({tournamentRecord:e,drawDefinition:i,event:n}),l=(t.policyDefinitions?.[Ja]??o?.[Ja]??CE[Ja])?.processCodes?.substitution,{inContextDualMatchUp:c,inContextTieMatchUp:u,relevantAssignments:d,collectionPosition:p,teamParticipants:f,collectionId:h,matchUpType:m,dualMatchUp:A,tieMatchUp:g,tieFormat:v}=s;if(!A)return ce({result:{error:Zo},stack:a});let b=u?.sides?.find(E=>E.participant?.participantId===r||E.participant?.individualParticipantIds?.includes(r));if(!b)return ce({result:{error:Fn},stack:a});let y=t.policyDefinitions?.[mu]??o?.[mu];if(!b.substitutions?.length&&(wa({score:u?.score})||u?.winningSide)&&y?.requireParticipantsForScoring!==!1)return ce({result:{error:Xwe},stack:a});let I=c?.sides?.find(({sideNumber:E})=>E===b.sideNumber)?.participantId;if(!I)return ce({result:{error:Fn},stack:a});let w=vn({participantFilters:{participantIds:[r]},tournamentRecord:e})?.participants?.[0];if(!w)return ce({result:{error:Fn},stack:a});if(m===Dr&&w.participantType===Ni)return ce({result:{error:tS},stack:a});let S=w.participantType===Wi?[r]:w.individualParticipantIds;eN({tournamentId:e.tournamentId,eventId:n.eventId,inContextDualMatchUp:c,drawDefinition:i,dualMatchUp:A});let T=A.sides?.find(({sideNumber:E})=>E===b.sideNumber);if(!T&&(A.sides?.filter(({lineUp:E})=>!E).length||0)<2){let E=f?.map(({participantId:P})=>({drawPosition:d?.find(R=>R.participantId===P)?.drawPosition,teamParticipantId:P}));T=A.sides?.find(P=>E?.find(({drawPosition:R})=>R===P.drawPosition)?.teamParticipantId===I)}if(!T)return ce({result:{error:Fn,context:{participantId:r}}});let{modifiedLineUp:D,previousParticipantIds:C}=M0e({collectionPosition:p,teamParticipantId:I,dualMatchUpSide:T,participantIds:S,drawDefinition:i,collectionId:h});if(T.lineUp=D,I&&v&&bS({participantId:I,lineUp:D,drawDefinition:i,tieFormat:v}),m===br&&w.participantType===Wi){let E=u?.sides?.find(M=>M.sideNumber===T?.sideNumber),{participantId:P}=E??{},R=P&&vn({participantFilters:{participantIds:[P]},tournamentRecord:e,withDraws:!0})?.participants?.[0];if(R){let M=R?.individualParticipantIds?.filter(N=>N!==r)??[];if(C&&M.push(...C),M.length>2)return ce({result:{error:Ll},stack:a});if(R.draws?.length){if(M.length===1){let{participant:N}=Cd({participantIds:M,tournamentRecord:e});if(!N){let k=bf({participant:{participantRole:xs,individualParticipantIds:M,participantType:Ni},pairOverride:!0,tournamentRecord:e});if(k.error)return ce({result:k,stack:a})}}}else if(M.length){R.individualParticipantIds=M;let N=lH({participant:R,pairOverride:!0,tournamentRecord:e});if(N.error)return ce({result:N,stack:a})}else{let N=vS({participantIds:[P],tournamentRecord:e});N.error&&console.log("cleanup",{result:N})}}else return ce({result:{error:Fn},stack:a})}if(b.substitutions?.length===1&&!u?.sides?.find(E=>E.sideNumber!==b.sideNumber)?.substitutions?.length&&g?.processCodes?.length){for(let E of l||[]){let P=g.processCodes.lastIndexOf(E);g.processCodes.splice(P,1)}Zi({tournamentId:e?.tournamentId,matchUp:g,context:a,drawDefinition:i})}return Zi({tournamentId:e?.tournamentId,matchUp:A,context:a,drawDefinition:i}),{...oe,modifiedLineUp:D}}function lX(t){let e=Qt(t,[{[Ua]:!0,[ro]:!0,[Rf]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:r,matchUpId:n,event:a}=t;if(r&&![1,2].includes(r))return{error:we,sideNumber:r};let{matchUp:s,structure:o}=Yr({drawDefinition:i,matchUpId:n,event:a});return s?el({structure:o})?(s.sides?.forEach(l=>{(!r||l.sideNumber===r)&&delete l.participantId}),Zi({tournamentId:t.tournamentRecord?.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:s}),{...oe}):{error:T8}:{error:Zs}}function Uit({matchUpStatuses:t=["BYE",Zr,Nr],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){let n=e?.reduce((u,d)=>!u||d.roundNumber>u.roundNumber?d:u,void 0),a=n?.drawPositions?.find(u=>u!==i),s=r.filter(u=>u?.drawPositions?.includes(a)).map(u=>u.matchUpStatus),o=r.filter(u=>u?.drawPositions?.includes(i)).map(u=>u.matchUpStatus),l=_o(s||[],t),c=_o(o||[],t);return{sourceMatchUp:n,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:s,loserHadMatchUpStatus:c,loserMatchUpStatuses:o}}function Tit({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:s,dualMatchUp:o,roundNumber:l,matchUpsMap:c,event:u}){let{structure:d}=di({drawDefinition:a,structureId:s});if(d?.structureType===$o)return{...oe};c=c??os({drawDefinition:a});let p=(c?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:f}=ow({drawPosition:i,matchUps:p}),h=p?.filter(A=>A.roundNumber>=l&&A.roundNumber!==f&&A.drawPositions?.includes(i)),{positionAssignments:m}=wr({drawDefinition:a,structureId:s});for(let A of h??[])Cit({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:o,matchUpsMap:c,matchUp:A,event:u});return{...oe}}function Cit({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:s,dualMatchUp:o,matchUpsMap:l,matchUp:c,event:u}){let d="removeSubsequentDrawPosition";if(o){let f=t.find(({matchUpId:m})=>c.matchUpId===m).sides?.find(m=>m.drawPosition===r)?.sideNumber,h=c.sides?.find(m=>m.sideNumber===f);h&&delete h.lineUp}c.drawPositions=(c.drawPositions||[]).map(f=>f===r?void 0:f).filter(Boolean);let p=e.filter(({drawPosition:f})=>c.drawPositions?.includes(f)).filter(f=>f.bye).length;return c.matchUpStatus=p&&"BYE"||ks(c.matchUpStatus)&&c.matchUpStatus||Nn,ks(c.matchUpStatus)&&(c.winningSide=void 0),c.matchUpStatusCodes&&WTe({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:c}),Zi({tournamentId:n?.tournamentId,eventId:u?.eventId,context:`${d}-${r}`,drawDefinition:s,matchUp:c}),{...oe}}function OE(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:s,dualMatchUp:o,targetData:l,matchUpId:c,structure:u,event:d}=t,p=!!t.matchUp.collectionId,f=el({structure:u}),{drawPositions:h,winningSide:m}=l.matchUp||{};if(!f&&!h)return{error:aM};let{targetLinks:{loserTargetLink:A,winnerTargetLink:g,byeTargetLink:v},targetMatchUps:{loserMatchUp:b,winnerMatchUp:y,byeMatchUp:I}}=l,w=Xp({...t,matchUpStatus:a||Nn,removeWinningSide:!0});if(w.error)return w;let S;if(p){let{matchUpTieId:O,matchUpsMap:x}=t;if(S=IA({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:r,drawDefinition:n,matchUpsMap:x,event:d}),!e&&!S.removeWinningSide)return{...oe}}if(f)return{...oe};let{matchUps:T}=dr({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:s,structure:u}),{positionAssignments:D}=Ia({structure:u}),C=m-1,E=1-C,P=h[C],R=h[E],{winnerParticipantId:M,loserParticipantId:N}=D?.reduce((O,x)=>(x.drawPosition===R&&(O.loserParticipantId=x.participantId),x.drawPosition===P&&(O.winnerParticipantId=x.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0})||{},k=T.filter(O=>O.drawPositions?.includes(R));if(y&&B0e({sourceMatchUpStatus:a,sourceMatchUpId:c,inContextDrawMatchUps:i,winningDrawPosition:P,winnerParticipantId:M,tournamentRecord:r,winnerTargetLink:g,drawDefinition:n,winnerMatchUp:y,dualMatchUp:o,matchUpsMap:s}),b){let{winnerHadMatchUpStatus:O}=Uit({drawPositionMatchUps:k,loserDrawPosition:R,sourceMatchUps:T}),x=A.linkCondition===Af;if(O&&x){let _=Math.min(...b.drawPositions);p3({targetLink:A,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:_,matchUpsMap:s,event:d})}let F=Eit({sourceMatchUpStatus:a,sourceMatchUpId:c,loserParticipantId:N,tournamentRecord:r,loserTargetLink:A,drawDefinition:n,loserMatchUp:b,dualMatchUp:o,matchUpsMap:s,event:d});if(F.error)return F}if(I){let O=Math.min(...I.drawPositions);p3({targetLink:v,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:O,matchUpsMap:s,event:d})}return{...oe,...S&&{tieMatchUpResult:S}}}function B0e({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:s,drawDefinition:o,winnerMatchUp:l,matchUpsMap:c,dualMatchUp:u,event:d}){let{structureId:p,roundNumber:f}=l,h="removeDirectedWinner";if(a){let m=a.target.structureId,{structure:A}=di({drawDefinition:o,structureId:m});if(!A)return{error:an};let{positionAssignments:g}=Ia({structure:A});A.seedAssignments=(A.seedAssignments??[]).filter(S=>S.participantId!==r);let v=g?.find(S=>S.participantId===r)?.drawPosition,{matchUps:b}=dr({drawDefinition:o,structure:A,event:d}),y=b.map(S=>S.drawPositions).flat(1/0).filter(Boolean),I=Xl(y);if((v?I[v]:void 0)===1)g?.forEach(S=>{S.participantId===r&&delete S.participantId});else{let S=b.filter(({drawPositions:T})=>T.includes(v));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:S,winnerTargetLink:a})}let w=c?.drawMatchUps?.find(({matchUpId:S})=>S===l.matchUpId);w&&Zi({tournamentId:n?.tournamentId,eventId:d?.eventId,matchUp:w,context:h,drawDefinition:o})}return f&&Tit({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:s,drawDefinition:o,dualMatchUp:u,matchUpsMap:c,roundNumber:f,structureId:p}),{...oe}}function Eit({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,dualMatchUp:l,event:c}){let u="removeDirectedLoser",d=r.target.structureId,{structure:p}=di({drawDefinition:a,structureId:d});if(!p)return{error:an};let{positionAssignments:f}=Ia({structure:p}),h=f?.find(m=>m.participantId===e)?.drawPosition;if(f?.forEach(m=>{m.participantId===e&&delete m.participantId}),n&&t){let m=o?.drawMatchUps?.find(({matchUpId:A})=>A===s.matchUpId);m.matchUpStatusCodes=t===An?["WO","WO"]:[]}if(p.seedAssignments=(p.seedAssignments??[]).filter(m=>m.participantId!==e),l){let m=s?.sides.reduce((v,b,y)=>b.drawPosition===h?y:v,void 0),A=o?.drawMatchUps?.find(({matchUpId:v})=>v===s.matchUpId),g=A?.sides?.[m];g&&(delete g.lineUp,Zi({tournamentId:i?.tournamentId,eventId:c?.eventId,matchUp:A,context:u,drawDefinition:a}))}return{...oe}}function p3({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:s}){let o=a.target.structureId,l="removeDirectedBye";yl({color:"brightyellow",method:l,drawPosition:r});let c=HM({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:o,event:s});return ce({result:c,stack:l})}function Dit(t){let{matchUpFormat:e,score:i}=t,r=i?.sets?.length,n=e&&ys(e),{setFormat:a,finalSetFormat:s,bestOf:o}=n??{};return(o&&r===o&&s||a)?.timed||!1}function Pit({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){let n="attemptToSetMatchUpStatusBYE";if(r?.winningSide)return ce({result:{error:uE},context:{matchUpStatus:"BYE"},stack:n});let{positionAssignments:a}=Ia({structure:i}),s=a?.filter(o=>o.bye).map(o=>o.drawPosition);return r.drawPositions?.some(o=>s?.includes(o))?(r.matchUpStatus="BYE",r.matchUpStatusCodes=[],Zi({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:r}),{...oe}):ce({result:{error:dwe},info:"matchUp does not include BYE",stack:n})}function y0(t){let{tournamentRecord:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,structure:s,event:o}=t,l="doubleExitAdvancement";if(s.structureType===$o)return ce({result:{...oe},stack:l});let{matchUp:c,targetMatchUps:u,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:f,loserTargetDrawPosition:h}=u,m=ks(p?.matchUpStatus)&&!p.sides?.map(g=>g.participantId??g.participant).filter(Boolean).length,A=p?.matchUpStatus===An;if(p&&p.matchUpStatus!=="BYE"){let{loserTargetLink:g}=d;if(i?.progression?.doubleExitPropagateBye||p.feedRound&&p.sides?.[0]?.participantFed){let v=k0e({loserTargetDrawPosition:h,tournamentRecord:e,loserTargetLink:g,drawDefinition:r,loserMatchUp:p,matchUpsMap:n,event:o});if(v.error)return ce({result:v,stack:l})}else if(!A){let{feedRound:v,drawPositions:b,matchUpId:y}=p,I=v?2:2-b.indexOf(h);I=m?p.winningSide:I;let w=zie({...t,targetMatchUp:p,walkoverWinningSide:I,tournamentRecord:e,sourceMatchUp:c,matchUpId:y});if(w.error)return ce({result:w,stack:l})}}if(f){let g=zie({...t,matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:e,sourceMatchUp:c});if(g.error)return ce({result:g,stack:l})}return ce({result:{...oe},stack:l})}function zie(t){let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s}=t,o=r.structures.find(({structureId:j})=>j===a.structureId),l=t.matchUpStatus===Aa?Aa:An,c=t.matchUpStatus===Aa?Nr:Zr,u="conditionallyAdvanceDrawPosition",d=s.drawMatchUps.find(j=>j.matchUpId===a.matchUpId);if(!d)return{error:Zo};let p=n?.drawPositions||[],f=d.drawPositions?.filter(Boolean),h=n?.structureId===a.structureId;if(h&&_o(p,f)&&(f=f.filter(j=>!p.includes(j))),h&&f.length>1)return ce({result:{error:$T},stack:u});let{pairedPreviousMatchUpIsDoubleExit:m,pairedPreviousMatchUp:A}=zTe(t),g=Fo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:v,targetLinks:b}=g,{loserTargetDrawPosition:y,winnerMatchUp:I,loserMatchUp:w}=v;if(w){let{loserTargetLink:j}=b,W=k0e({loserTargetDrawPosition:y,loserMatchUp:w,tournamentRecord:i,loserTargetLink:j,drawDefinition:r,matchUpsMap:s});if(W.error)return ce({result:W,stack:u})}let S=d.drawPositions?.filter(Boolean)||[],T=S.length===1,D=t.walkoverWinningSide||T&&Wk({drawPosition:S[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,C=ks(d.matchUpStatus)&&!S.length,E=d.finishingRound===1,P=C&&!E?l:c,R=e.find(j=>j.matchUpId===A.matchUpId),M=[],N;n&&(n?.structureId===R?.structureId?n.roundPosition<A?.roundPosition?N=1:N=2:a.feedRound?n.structureId===a.structureId?N=2:N=1:D&&(N=3-D));let k=t.matchUpStatus,O=A?.matchUpStatus;N===1?M=[{matchUpStatus:uB(k),previousMatchUpStatus:k,sideNumber:1},{matchUpStatus:uB(O),previousMatchUpStatus:O,sideNumber:2}]:N===2&&(M=[{matchUpStatus:uB(O),previousMatchUpStatus:O,sideNumber:1},{matchUpStatus:uB(k),previousMatchUpStatus:k,sideNumber:2}]),M.length&&(M=M.map(j=>Lt(j)));let x=Xp({...t,winningSide:D,matchUp:d,matchUpStatusCodes:M,matchUpStatus:P});if(x.error)return ce({result:x,stack:u});if(C)return y0({...t,matchUpStatus:P,targetData:g});if(!I)return ce({result:{...oe},stack:u});let F=f.length===2?f[D-1]:f[0],{positionAssignments:_}=wr({structure:o}),V=_?.find(j=>j.drawPosition===F),G=s.drawMatchUps.find(j=>j.matchUpId===I.matchUpId),z=G?.drawPositions?.filter(Boolean),Q=z.length===1;if(F){if(V?.bye){let j=Fo({matchUpId:G.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(Q){let W=z.filter(Boolean)[0],Y=Wk({drawPosition:W,matchUpId:G.matchUpId,inContextDrawMatchUps:e}),X=Xp({appliedPolicies:t.appliedPolicies,matchUpId:G.matchUpId,matchUp:G,matchUpStatus:c,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,winningSide:Y});return X.error?ce({result:X,stack:u}):s7({drawPositionToAdvance:W,matchUpId:G.matchUpId,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}else if(ks(I.matchUpStatus)){let W=y0({...t,matchUpId:G.matchUpId,matchUpStatus:P,targetData:j});if(W.error)return ce({result:W,stack:u})}return ce({result:{...oe},stack:u})}return PI({matchUpId:I.matchUpId,drawPosition:F,inContextDrawMatchUps:e,drawDefinition:r})}else if(m){if(!G)return{error:Zo};if(Q){let Y=z[0],X=Wk({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:Y});console.log("existing drawPosition is winningSide",{walkoverWinningSide:X})}let j=ks(G.matchUpStatus)?c:l,W=Xp({matchUpId:G.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:G,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,matchUpStatus:j});if(W.error)return ce({result:W,stack:u});if(j===l){let Y=y0({...t,matchUpId:a.matchUpId,matchUpStatus:j,targetData:g});if(Y.error)return Y}}return ce({result:{...oe},stack:u})}function k0e(t){let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:r,drawDefinition:n,matchUpsMap:a,event:s,loserMatchUp:o}=t,l=r?.target?.structureId,{structure:c}=di({drawDefinition:n,structureId:l});return c?Hc({drawPosition:e,tournamentRecord:i,drawDefinition:n,structureId:l,matchUpsMap:a,loserMatchUp:o,event:s}):{error:Ab}}function uB(t){return t===An?Zr:t===Aa?Nr:t}function Rit(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,s=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(g=>g.matchUpId===a.matchUpId).containerStructureId),o="attemptToSetMatchUpStatus",l=r==="BYE",c=a.winningSide,u=[An,Aa].includes(r),d=$M({matchUpStatus:r}),p=Q4({matchUpStatus:r}),f=!d&&!p,h=t.matchUpTieId||c&&d&&!u,m=c&&u,A=()=>Xp({...t,removeScore:[Nf,Zr].includes(r),matchUpStatus:r||Nn});return f&&{error:U4}||h&&Jk(t)||m&&Mit(t)||c&&OE(t)||p&&A()||l&&Pit({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:U4}||u&&Nit(t)||s&&Jk(t)||t.propagateExitStatus&&Jk(t)||ce({result:{error:uE,info:"matchUpStatus: "+r},stack:o})}function Mit(t){let e=OE(t);return e.error?e:y0(t)}function Nit(t){let e=Jk({...t,removeScore:!0});return e.error?e:y0(t)}function Jk(t){let e="scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide){let n=OE(t);if(n.error)return ce({result:n,stack:e})}let i=!!t.matchUp.collectionId,r=Xp({...t});if(i){let{matchUpTieId:n,drawDefinition:a,matchUpsMap:s}=t,o=IA({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,event:t.event,drawDefinition:a,matchUpsMap:s});if(o.error)return ce({result:o,stack:e});Object.assign(r,{tieMatchUpResult:o})}return ce({result:r,stack:e})}function Bit({drawDefinition:t,structure:e,matchUp:i}){let{drawPositions:r}=i,{positionAssignments:n}=wr({drawDefinition:t,structure:e}),a=n?.filter(({drawPosition:l})=>r?.includes(l))?.map(l=>{let{extension:c}=ki({element:l,name:Km});return c?.value?.groupOrder}),{containerStructures:s}=IE({drawDefinition:t}),o=s[e.structureId];return{structureIds:wE({drawDefinition:t,structureId:o})?.links?.source?.filter(l=>_o(a,l.source?.finishingPositions||[])).map(l=>l.source.structureId)}}function x0e({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===Fy&&_h({drawDefinition:t,structure:e})){let{structureIds:n}=Bit({drawDefinition:t,structure:e,matchUp:i});n?.length&&r.push(...n)}return{connectedStructureIds:r}}function kit(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===jd){let o=r.sides.find(({sideNumber:c})=>c!==a).participantId,l=i.find(c=>c.structureId===s.target.structureId&&c.roundNumber===s.target.roundNumber&&c.sides.some(({participantId:u})=>u===o));if(l?.matchUpStatus===Nn){let c=Fo({matchUpId:l.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!jy({inContextDrawMatchUps:i,drawDefinition:n,targetData:c})){let{structure:u}=di({structureId:l.structureId,drawDefinition:n}),d=wr({structure:u}).positionAssignments;for(let p of d||[])if(p.participantId===o){let f=r.sides.find(({sideNumber:h})=>h===a).participantId;if(p.participantId=f,u?.positionAssignments)u.positionAssignments=d;else if(u?.structures){let h=Object.assign({},...(d||[]).map(m=>({[m.drawPosition]:m.participantId})));for(let m of u.structures)m.positionAssignments?.forEach(A=>A.participantId=h[A.drawPosition])}Ym({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:u}),e=!0}}}}return{...oe,qualifierReplaced:e}}function xit(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===jd){let o=r.sides.find(({sideNumber:u})=>u===a)?.participantId,l=i.filter(u=>u.structureId===s.target.structureId&&u.roundNumber===s.target.roundNumber&&u.sides.some(({participantId:d,qualifier:p})=>p&&!d)),c=Zu(l);if(c?.matchUpStatus===Nn){let u=Fo({matchUpId:c.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!jy({inContextDrawMatchUps:i,drawDefinition:n,targetData:u})){let d=c.sides.find(h=>h.qualifier&&!h.participantId)?.drawPosition,{structure:p}=di({structureId:c.structureId,drawDefinition:n});if(!p)return{error:an};let f=wr({structure:p}).positionAssignments;for(let h of f||[])if(h.drawPosition===d&&!h.participantId){if(h.participantId=o,p.positionAssignments)p.positionAssignments=f;else if(p.structures){let m=Object.assign({},...(f||[]).map(A=>({[A.drawPosition]:A.participantId})));for(let A of p.structures)A.positionAssignments?.forEach(g=>g.participantId=m[g.drawPosition])}Ym({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:p}),e=!0}}}}return{...oe,qualifierPlaced:e}}function _it(t){let e="attemptToSetWinningSide",i,r={},{appliedPolicies:n,disableAutoCalc:a,drawDefinition:s,dualMatchUp:o,winningSide:l,structure:c,matchUp:u}=t;if(o?._disableAutoCalc&&a!==!1)return L7(t);if(u.winningSide&&u.winningSide!==l){let{connectedStructureIds:h}=x0e({drawDefinition:s,structure:c,matchUp:u});h.length&&(console.log({connectedStructureIds:h}),i=!0);let m=OE(t);if(m.error)return m}let d=XCe(t);if(d.context?.progressExitStatus&&Object.assign(r,d.context),d.error)return ce({result:d,stack:e});let p,f;return t.qualifierChanging&&n?.[QP]?.autoReplaceQualifiers&&(p=kit(t).qualifierReplaced),t.qualifierAdvancing&&n?.[QP]?.autoPlaceQualifiers&&(f=xit(t).qualifierPlaced),ce({result:Lt({...oe,...d,connectedStructures:i,qualifierReplaced:p,qualifierPlaced:f,context:r}),stack:e})}var ex={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function _0e(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,matchUp:s}=t,{matchUpId:o}=s,{iteration:l=0}=t;l+=1;let c="removeDoubleExit";yl({color:"brightyellow",method:c,matchUpId:o,iteration:l,keyColors:ex});let{targetMatchUps:{loserMatchUp:u,winnerMatchUp:d,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:f}}=a;if(d&&d.matchUpStatus!=="BYE"){let{stage:A,roundNumber:g,roundPosition:v,structureName:b}=d;yl({winner:"winner",roundPosition:v,structureName:b,roundNumber:g,keyColors:ex,stage:A}),qie({...t,targetMatchUp:d,sourceMatchUp:s,iteration:l})}let h=u?.matchUpStatus==="BYE"&&(u?.feedRound||u?.roundNumber===1),m=a?.targetLinks?.loserTargetLink?.linkCondition===Af;if(h&&m){let A=e.filter(({roundNumber:b,structureId:y})=>y===s.structureId&&b===1),g=A.map(({roundPosition:b})=>b),v=$a(g.sort(),2).find(b=>b.includes(s.roundPosition));if((A.filter(({roundPosition:b})=>v.includes(b))?.map(({matchUpStatus:b})=>b)).every(b=>[Aa,An].includes(b)))return ce({result:{...oe},stack:c})}if(u&&(u.matchUpStatus!=="BYE"||h)){let A=e.find(({matchUpId:S})=>S===u.matchUpId),{structure:g}=di({drawDefinition:r,structureId:A.structureId}),{stage:v,roundNumber:b,roundPosition:y,feedRound:I,structureName:w}=u;if(yl({loser:"loser",roundPosition:y,structureName:w,roundNumber:b,keyColors:ex,feedRound:I,stage:v}),i?.progression?.doubleExitPropagateBye||h)p3({drawPosition:p,targetLink:f,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:n});else{let S=qie({...t,targetMatchUp:u,structure:g,iteration:l});if(S.error)return ce({result:S,stack:c})}}return ce({result:{...oe},stack:c})}function qie(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s,structure:o,iteration:l}=t,c="conditionallyRemoveDrawPosition";yl({method:c,structureName:o?.structureName,iteration:l});let u=Fo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:{winnerMatchUp:d}}=u,p=s?.drawMatchUps.find(b=>b.matchUpId===a.matchUpId),f,h,m;if(a.feedRound)m=d?.drawPositions?.filter(Boolean)?.find(b=>a.drawPositions.includes(b));else if(n==null)m=Mn(a?.drawPositions||[],d?.drawPositions||[])?.[0];else{h=qTe({structureId:o.structureId,matchUp:n,matchUpsMap:s})?.pairedPreviousMatchUp,f=[An,Aa].includes(h?.matchUpStatus);let b=h?.drawPositions?.filter(Boolean)||[];if([...ta,"BYE"].includes(h?.matchUpStatus)||h?.winningSide){let y=n.drawPositions||[],I=a.drawPositions?.filter(Boolean);_o(y,I)&&(I=I?.filter(w=>!y.includes(w))),m=y.concat(b).find(w=>I?.includes(w))}}if(d&&m){let{stage:b,roundNumber:y,roundPosition:I,structureName:w}=d;yl({method:"removeDirectedWinner",drawPositionToRemove:m,color:"brightgreen",roundPosition:I,structureName:w,roundNumber:y,keyColors:ex,stage:b}),B0e({winningDrawPosition:m,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}let A=_0e({targetData:u,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:s,structure:o,iteration:l});if(A.error)return ce({result:A,stack:c});let g=Oit({pairedPreviousDoubleExit:f,noContextTargetMatchUp:p}),v=!f;return A=Xp({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],matchUpStatus:g,removeScore:v,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),A.error?ce({result:A,stack:c}):{...oe}}function Oit({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus==="BYE"?"BYE":t?[Aa,Nr].includes(e?.matchUpStatus)?Nr:Zr:Nn}function Fit(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n}=t,a=t.targetData.targetLinks?.winnerTargetLink;if(a.target.feedProfile===jd){let s=r.sides?.find(({sideNumber:l})=>l===r.winningSide)?.participantId,o=i.find(l=>l.structureId===a.target.structureId&&l.roundNumber===a.target.roundNumber&&l.sides?.some(({participantId:c})=>c===s));if(o&&o.matchUpStatus===Nn){let l=Fo({matchUpId:o.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!jy({inContextDrawMatchUps:i,drawDefinition:n,targetData:l})){let{structure:c}=di({structureId:o.structureId,drawDefinition:n}),u=wr({structure:c}).positionAssignments;for(let d of u||[])if(d.participantId===s){if(d.participantId=void 0,c?.positionAssignments)c.positionAssignments=u;else if(c?.structures){let p=Object.assign({},...(u||[]).map(f=>({[f.drawPosition]:f.participantId})));for(let f of c?.structures||[])f.positionAssignments?.forEach(h=>h.participantId=p[h.drawPosition])}Ym({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:c}),e=!0}}}}return{qualifierRemoved:e}}function Lit(t){let{matchUp:e,matchUpStatus:i,score:r,winningSide:n}=t,a="noDownStreamDependencies";if([An,Aa].includes(e?.matchUpStatus)&&![An,Aa].includes(i)){let A=_0e(t);if(A.error)return ce({result:A,stack:a})}let s=i===An,o=wa({score:r})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!n),l=t?.inContextMatchUp?.collectionId&&Dit(t.inContextMatchUp),c=t.removeScore||!l&&![ic,tc].includes(i||ic),u=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!n&&!wa({score:r}),d=A=>{let g,{structure:v,drawDefinition:b,dualMatchUp:y,disableAutoCalc:I}=t;if(y?._disableAutoCalc&&I!==!1)return L7({...t,removeWinningSide:u});let{connectedStructureIds:w}=x0e({drawDefinition:b,structure:v,matchUp:e});w.length&&(console.log({connectedStructureIds:w}),g=!0),Object.assign(t,{removeScore:A});let S=OE(t);if(S.error)return S;if(t.removingQualifier&&t.appliedPolicies?.[QP]?.autoRemoveQualifiers){let T=Fit(t);return{...oe,connectedStructures:g,...T}}return{...oe,connectedStructures:g}};if(u&&n&&t.isCollectionMatchUp)return Wie(t);let p=[Nf,tc].includes(i)&&t.dualWinningSideChange,f=i&&i!==Nn,h=t.propagateExitStatus&&ks(i),m=(n||p||h)&&_it(t)||o&&d(c)||f&&Rit(t)||u&&d(c)||e&&Wie({...t,removeScore:!0})||{...oe};return ce({result:m,stack:a})}function Wie(t){let e="ndd:scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide&&!t.autoCalcDisabled){let r=OE(t);if(r.error)return r}let i=Xp({...t});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:n,event:a,matchUpsMap:s}=t,{removeWinningSide:o}=IA({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:n,matchUpsMap:s,event:a});o&&console.log("REMOVE WINNING SIDE")}return ce({result:i,stack:e})}function cX(t){let e=Qt(t,[{[Ua]:!0,[ro]:!0,[Rf]:!0},{homeParticipantId:!0,[cd]:ba}]);if(e.error)return e;let i=NE(t,[{[AE]:Qh,attr:{[G2]:!0}}]);if(i.error)return i;let r=i?.matchUp?.matchUp?.sides?.map(u=>u?.participantId);if(t.homeParticipantId&&!r?.includes(t.homeParticipantId))return{error:lp};let{disableNotice:n,homeParticipantId:a,removePriorValues:s,tournamentRecord:o,drawDefinition:l,matchUpId:c}=t;return nc({duplicateValues:!1,removePriorValues:s,tournamentRecord:o,drawDefinition:l,disableNotice:n,matchUpId:c,timeItem:{itemType:ZY,itemValue:a}})}function O0e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Tb({timeItems:i?.timeItems||[],itemType:s$});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{timeModifiers:r}:e}function cv(t){let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,scheduledTime:o,matchUpId:l}=t;if(!l)return ce({result:{error:go},stack:e});if(!hE(o))return ce({result:{error:zu},stack:e});if(!i){let f=Yr({drawDefinition:a,matchUpId:l});if(f.error)return ce({result:f,stack:e});i=f.matchUp}let c=Ui(o),u=mS({matchUp:i}).scheduledDate,d=c&&!u;if((O0e({matchUp:i}).timeModifiers||[])?.length){let f=F0e({disableNotice:!0,removePriorValues:r,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(f?.error)return ce({result:f,stack:e})}let p=sS(o,!0,d);return nc({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,matchUpId:l,timeItem:{itemType:fS,itemValue:p}})}function F0e({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:s}){let o="addMatchUpTimeModifiers";if(!a)return ce({result:{error:go},stack:o});if(n!==void 0&&!Array.isArray(n))return ce({info:Gy("timeModifiers"),result:{error:we},stack:o});if(!s){let d=Yr({drawDefinition:i,matchUpId:a});if(d.error)return ce({result:d,stack:o});s=d.matchUp}let l=O0e({matchUp:s}).timeModifiers||[],c=n.filter(d=>!l.includes(d));if(n.length&&!c.length)return{...oe};if(c.some(d=>$4.includes(d))){l=l.filter(p=>!$4.includes(p));let d=cv({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return ce({result:d,stack:o})}let u=n?.length?[...c,...l]:void 0;return nc({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:s$,itemValue:u}})}function cH({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:go};let s=t&&hf.test(t);if(t&&!s)return{error:ma};let o={itemValue:Ui(t),itemType:pS};return nc({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o})}function uH({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtIds:o}){if(!i&&!e)return{error:nt};if(!s)return{error:go};let l=Yr({drawDefinition:r,matchUpId:s});if(l.error)return l;if(l?.matchUp?.matchUpType!==Pc)return{error:wl};if(!(o===void 0||Array.isArray(o)&&o.length&&o.every(u=>typeof u=="string")))return{error:we,context:{courtIds:o}};let c;if(o){let u=e||i&&{[i.tournamentId]:i},d=wA({tournamentRecords:u});if(d.error)return d;let p=d.courts?.filter(f=>o.includes(f.courtId));if(p?.length!==o.length)return{error:we,context:{courtIds:o}};c=p?.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return nc({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:xh,itemDate:a,itemValue:c}})}function FE({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:s}){if(!i)return{error:nt};if(!a)return{error:go};if(s){let o=qh({tournamentRecords:e,tournamentRecord:i,venueId:s});if(o.error)return o}return nc({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:dS,itemValue:s}})}function CS({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtId:o}){if(!i&&!e)return{error:nt};if(!s)return{error:go};if(o){let l=ov({tournamentRecords:e,tournamentRecord:i,courtId:o});if(l.error)return l;let c=l.venue?.venueId;FE({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,venueId:c})}return nc({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:Eg,itemDate:a,itemValue:o}})}function $p(t,e){let i=gSe.test(t)?t:Kr(t),r=Ui(t)||Ui(e)||od(new Date);return new Date(`${r}T${i}`).getTime()}function dH(t){let e="addMatchUpScheduleItems",i=Qt(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[rl]:fl}],e);if(i.error)return i;let{matchUpDependencies:r,inContextMatchUps:n}=t,{errorOnAnachronism:a=!1,checkChronology:s=!0,removePriorValues:o,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,disableNotice:d,drawMatchUps:p,matchUpId:f,schedule:h,event:m}=t,A,g;if(p)A=p.find(N=>N.matchUpId===f);else{let N=Yr({drawDefinition:u,event:m,matchUpId:f});if(N.error)return N;A=N.matchUp}let{endTime:v,courtId:b,courtIds:y,courtOrder:I,resumeTime:w,homeParticipantId:S,scheduledDate:T,scheduledTime:D,startTime:C,stopTime:E,timeModifiers:P,venueId:R}=h;s&&(!r||!n)&&({matchUpDependencies:r,matchUps:n}=Bd({drawDefinition:u}));let M=r?.[f]?.matchUpIds;if(h.scheduledDate&&s&&M){let N=n?.filter(k=>(k.schedule?.scheduledDate||Ui(k.schedule?.scheduledTime))&&M.includes(k.matchUpId)).map(({schedule:k})=>{let O=T_(k);return new Date(O??"").getTime()});if(N?.length){let k=T_(h),O=new Date(k??"").getTime();if(Math.max(...N)>=O){if(a)return ce({result:{error:I4},stack:e});g=I4}}}if(T!==void 0){let N=cH({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,scheduledDate:T,matchUpId:f});if(N?.error)return ce({result:N,stack:e,context:{scheduledDate:T}})}if(D!==void 0){let N=cv({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,scheduledTime:D,matchUpId:f,matchUp:A});if(N?.error)return ce({result:N,stack:e,context:{scheduledTime:D}})}if(C!==void 0){let N=dX({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:f,startTime:C,event:m});if(N?.error)return ce({result:N,stack:e,context:{startTime:C}})}if(E!==void 0){let N=fX({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:f,stopTime:E,event:m});if(N?.error)return ce({result:N,stack:e,context:{stopTime:E}})}if(w!==void 0){let N=hX({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,resumeTime:w,matchUpId:f,event:m});if(N?.error)return ce({result:N,stack:e,context:{resumeTime:w}})}if(v!==void 0){let N=pX({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:f,endTime:v,event:m});if(N?.error)return ce({result:N,stack:e,context:{endTime:v}})}if(y!==void 0){let N=uH({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:f,courtIds:y});if(N?.error)return ce({result:N,stack:e,context:{courtIds:y}})}if(b!==void 0&&T!==void 0){let N=CS({courtDayDate:T,disableNotice:!0,removePriorValues:o,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,matchUpId:f,courtId:b});if(N?.error)return ce({result:N,stack:e,context:{courtId:b}})}if(R!==void 0){let N=FE({disableNotice:!0,removePriorValues:o,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,matchUpId:f,venueId:R});if(N?.error)return ce({result:N,stack:e,context:{venueId:R}})}if(I!==void 0&&wi(I)){let N=uX({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,courtOrder:I,matchUpId:f});if(N?.error)return ce({result:N,stack:e,context:{courtOrder:I}})}if(P!==void 0){let N=F0e({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,timeModifiers:P,matchUpId:f,matchUp:A});if(N?.error)return ce({result:N,stack:e,context:{timeModifiers:P}})}return rn(S)&&cX({disableNotice:!0,homeParticipantId:S,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:f}),d||Zi({tournamentId:c?.tournamentId,eventId:m?.eventId,context:e,drawDefinition:u,matchUp:A}),g?{...oe,warnings:[g]}:{...oe}}function uX({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:go};if(n&&!wi(n))return{error:we,info:"courtOrder must be numeric"};let s=n&&ci(n);return nc({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:a$,itemValue:s}})}function L0e({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:s}){if(!s)return{error:go};if(!n)return{error:ba};if(e){let l=vn({tournamentRecord:e,participantFilters:{participantTypes:[Wi],participantRoles:[u7]}}).participants??[];if(!Sg({tournamentParticipants:l,participantId:n}))return{error:Fn}}let o={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(o.itemSubTypes=[a]),nc({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:s,timeItem:o})}function dX({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:s}){if(!n)return{error:go};if(!hE(a))return{error:zu};let{matchUp:o}=Yr({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=mS({matchUp:o}),c=(o?.timeItems??[]).filter(u=>[Tm,oh,Zm].includes(u?.itemType)).map(u=>$p(u.itemValue,l)).reduce((u,d)=>!u||d<u?d:u,void 0);if(!c||$p(a,l)<c){o?.timeItems&&(o.timeItems=o.timeItems.filter(d=>d.itemType!==zd));let u=sS(a,!0,!0);return nc({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:zd,itemValue:u}})}else return{error:Hwe}}function pX({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:s,event:o}){if(!a)return{error:go};if(!hE(s))return{error:zu};let{matchUp:l}=Yr({drawDefinition:r,event:o,matchUpId:a}),{scheduledDate:c}=mS({matchUp:l}),u=(l?.timeItems??[]).filter(d=>[zd,oh,Tm].includes(d?.itemType)).map(d=>$p(d.itemValue,c)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!u||$p(s,c)>u){l?.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Zm));let d=sS(s,!0,!0);return nc({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Zm,itemValue:d}})}else return{error:Lwe}}function fX({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:s}){if(!n)return{error:go};if(!hE(a))return{error:zu};let{matchUp:o}=Yr({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=mS({matchUp:o}),c=o?.timeItems??[];if(c.reduce((h,m)=>m.itemType===Zm||h,void 0))return{error:H8};let u=c.filter(h=>[zd,oh,Tm].includes(h?.itemType)).sort((h,m)=>$p(h.itemValue,l)-$p(m.itemValue,l)),d=u.at(-1),p=d?.itemType===Tm,f=u.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>$p(h.itemValue,l)).reduce((h,m)=>!h||m>h?m:h,void 0);if($p(a,l)>f){if(o?.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(A=>A.createdAt!==m)}let h={itemValue:sS(a,!0,!0),itemType:Tm};return nc({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:h})}else return{error:$we}}function hX({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:s}){if(!a)return{error:go};if(!hE(n))return{error:zu};let{matchUp:o}=Yr({drawDefinition:i,event:s,matchUpId:a}),{scheduledDate:l}=mS({matchUp:o}),c=o?.timeItems??[];if(c.reduce((h,m)=>m.itemType===Zm||h,void 0))return{error:H8};let u=c.filter(h=>[zd,oh,Tm].includes(h?.itemType)).sort((h,m)=>$p(h.itemValue,l)-$p(m.itemValue,l)),d=u.at(-1),p=d?.itemType===oh,f=u.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>$p(h.itemValue,l)).reduce((h,m)=>!h||m>h?m:h,void 0);if($p(n,l)>f){if(o?.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(A=>A.createdAt!==m)}let h={itemValue:sS(n,!0,!0),itemType:oh};return nc({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:h})}else return{error:H6e}}function $it(t){let{targetData:e,matchUpsMap:i}=t,{targetMatchUps:{loserMatchUp:r}}=e,n=ks(r?.matchUpStatus),a=!!i?.drawMatchUps.find(s=>s.loserMatchUpId===r?.matchUpId&&ks(s.matchUpStatus));return a&&r?.matchUpStatus===An||a&&n}function Hit({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:s,matchUp:o,event:l,score:c}){let u=Dt(n,void 0,!0);for(let p of u?.tieMatchUps||[])p.matchUpId===o.matchUpId&&(p.winningSide=r,p.score=c,!wa({score:c})&&!e?Object.assign(p,{...I$}):e&&(p.matchUpStatus=e));a=a??po({matchUp:o,structure:s,drawDefinition:t,event:l})?.tieFormat;let{winningSide:d}=JM({matchUp:u,drawDefinition:t,matchUpsMap:i,structure:s,tieFormat:a,event:l});return{projectedWinningSide:d}}function Vit(t){let{tournamentRecord:e,inContextMatchUp:i,structure:r,drawDefinition:n}=t,a=i.roundNumber,s=i.sides.find(I=>I.sideNumber===i.winningSide),o=i.sides.find(I=>I.sideNumber!==i.winningSide),{drawPosition:l,participantId:c}=s,{drawPosition:u,participantId:d}=o,p="swapWinnerLoser",{matchUps:f}=dr(t),h=f.filter(({drawPositions:I,roundNumber:w})=>I?.includes(l)&&w>a);Mc({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:h}),h.forEach(I=>{I.drawPositions=I.drawPositions?.map(w=>w===l?u:w)||[],Zi({tournamentId:e?.tournamentId,eventId:t.event?.eventId,context:p,drawDefinition:n,matchUp:I})});let{stage:m,stageSequence:A}=r,g=n.structures.filter(({stage:I,stageSequence:w})=>I===m&&w>A).map(({structureId:I})=>I),{targetLinks:{loserTargetLink:v,winnerTargetLink:b}}=t.targetData,y=[v?.target.structureId,b?.target?.structureId].filter(Boolean);return n.structures.filter(({stage:I,structureId:w})=>I!==m&&y.includes(w)).forEach(({stage:I,stageSequence:w,structureId:S})=>{g.includes(S)||g.push(S),n.structures.filter(({stage:T,stageSequence:D})=>T===I&&D>w).forEach(({structureId:T})=>{g.includes(T)||g.push(T)})}),n.structures.filter(({structureId:I})=>g.includes(I)).forEach(I=>{let{positionAssignments:w}=wr({structure:I}),S=w?.find(({participantId:D})=>D===c),T=w?.find(({participantId:D})=>D===d);S&&(S.participantId=d),T&&(T.participantId=c)}),Xp({...t})}function Rb(t){let e="setMatchUpStatus";t.matchUpStatus&&[Zr,An].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:r,propagateExitStatus:n,tournamentRecords:a,tournamentRecord:s,disableAutoCalc:o,enableAutoCalc:l,drawDefinition:c,matchUpStatus:u,winningSide:d,matchUpId:p,event:f,score:h}=t;if(!c)return{error:kt};if(u&&[Nf,ic,tc,Nn].includes(u)&&d)return{error:we,winningSide:d,matchUpStatus:u};if(![void 0,...kUe].includes(u))return ce({result:{error:uE},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let m=os({drawDefinition:c}),{matchUps:A}=ia({nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:c,matchUpsMap:m,event:f}),g=m.drawMatchUps.find(z=>z.matchUpId===p),v=A?.find(z=>z.matchUpId===p);if(!g||!A)return{error:Zs};if((g.winningSide||d)&&u==="BYE")return{context:"Cannot have Bye with winningSide",error:Hk,matchUpStatus:u};let b=v?.structureId,{structure:y}=di({drawDefinition:c,structureId:b}),I=Vn(Hr)(g.matchUpType),w=v?.drawPositions?.filter(Boolean),S=v?.matchUpTieId,T=Fo({matchUpId:S||p,inContextDrawMatchUps:A,drawDefinition:c});Object.assign(t,{inContextDrawMatchUps:A,inContextMatchUp:v,matchUpTieId:S,matchUpsMap:m,targetData:T,structure:y,matchUp:g});let D=u===Nn&&h?.scoreStringSide1===""&&h?.scoreStringSide2===""&&!d;if($it(t)&&D)return{error:P6e};let C=jy(t),E;if(I){if(o)ur({extension:{name:aw,value:!0},element:g});else if(l){let z=g.winningSide,{winningSide:Q,scoreStringSide1:j,scoreStringSide2:W,set:Y}=JM({drawDefinition:c,matchUpsMap:m,structure:y,matchUp:g,event:f}),X={scoreStringSide1:j,scoreStringSide2:W,sets:Y?[Y]:[]};if(E=Q!==z,C&&E)return ce({stack:"winningSideWithDownstreamDependencies",result:{error:S2},context:{winningSide:d,matchUp:g}});Mo({name:aw,element:g}),Object.assign(t,{winningSide:Q,dualWinningSideChange:E,projectedWinningSide:Q,score:X})}eN({tournamentId:s?.tournamentId,inContextDualMatchUp:v,eventId:f?.eventId,dualMatchUp:g,drawDefinition:c})}if(I&&u&&[lS].includes(u))return{info:"Not supported for matchUpType: TEAM",error:we};if(h&&!I&&!r){let z=g.matchUpFormat??y?.matchUpFormat??c?.matchUpFormat??f?.matchUpFormat,Q=d9({existingMatchUpStatus:g.matchUpStatus,matchUpFormat:z,matchUpStatus:u,winningSide:d,score:h});if(Q.error)return Q}let P=tr({policyTypes:[QP,mu],tournamentRecord:s,drawDefinition:c,event:f})?.appliedPolicies??{};Xi(t.policyDefinitions)&&Object.assign(P,t.policyDefinitions);let R=Qit({assignedDrawPositions:w,propagateExitStatus:n,inContextMatchUp:v,appliedPolicies:P,drawDefinition:c,matchUpStatus:u,structure:y,matchUp:g});if(R?.error)return R;let M=v?.stage===qt&&v.finishingRound===1,N=M&&d,k=M&&g.winningSide&&!d&&(!t.matchUpStatus||t.matchUpStatus&&Q4({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!wa({outcome:t.outcome})),O=N&&d!==g.winningSide&&g.winningSide;if(Object.assign(t,{qualifierAdvancing:N,qualifierChanging:O,removingQualifier:k,appliedPolicies:P}),S){let{matchUp:z}=Yr({matchUpId:S,inContext:!0,drawDefinition:c,matchUpsMap:m,event:f});if(z){let Q=po({matchUp:z,drawDefinition:c,structure:y,event:f})?.tieFormat,{projectedWinningSide:j}=Hit({drawDefinition:c,matchUpStatus:u,dualMatchUp:z,matchUpsMap:m,winningSide:d,tieFormat:Q,structure:y,matchUp:g,event:f,score:h}),W=z.winningSide;E=j!==W;let Y=z._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:E,projectedWinningSide:j,autoCalcDisabled:Y,matchUpTieId:S,dualMatchUp:z,tieFormat:Q})}}let x=$M({matchUpStatus:u});if(!S){if(C&&!d&&(u&&Q4({matchUpStatus:u})||u&&[An,Aa].includes(u)))return{error:Hk,activeDownstream:C,winningSide:d};if(d&&d===g.winningSide&&u&&!x)return{context:"winningSide must include directing matchUpStatus",error:Hk,directingMatchUpStatus:x,matchUpStatus:u}}let{schedule:F}=t;if(F){let z=dH({disableNotice:!0,tournamentRecords:a,tournamentRecord:s,drawDefinition:c,matchUpId:p,schedule:F});if(z.error)return z}let _=!I&&!E&&d&&g.winningSide&&g.winningSide!==d;if(i&&_&&g.roundPosition)return Vit(t);let V=d&&!S||t.projectedWinningSide;yl({activeDownstream:C,matchUpWinner:V,method:e,winningSide:d});let G=!C&&Lit(t)||V&&Git(t)||(x||t.autoCalcDisabled)&&$0e(t)||{error:Kwe};return ce({result:G,stack:e})}function Git(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?$0e(t):ce({stack:"winningSideWithDownstreamDependencies",result:{error:S2},context:{winningSide:i,matchUp:e}})}function $0e(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!wa({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&Nn||t.winningSide&&Hn||ic:t.matchUpStatus||Hn,s=t.removeScore||[Nf,Zr].includes(a)&&![ic,tc].includes(a),o=Xp({...t,matchUpStatus:a,removeWinningSide:n,removeScore:s});if(o.error)return o;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:c,matchUpsMap:u}=t,d=IA({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:c,matchUpsMap:u,event:r});if(d.error)return d;Object.assign(o,{tieMatchUpResult:d})}return o}function Qit({assignedDrawPositions:t,propagateExitStatus:e,inContextMatchUp:i,appliedPolicies:r,drawDefinition:n,matchUpStatus:a,structure:s,matchUp:o}){if(r?.[mu]?.requireParticipantsForScoring===!1)return{...oe};let l=i?.sides?.map(d=>d.participantId).filter(Boolean).length,c=o?.sides?[]:wr({structureId:s?.structureId,drawDefinition:n}).positionAssignments,u=l&&l===2||o.collectionId&&el({structure:s})&&l&&l>=1||t?.length===2&&c?.filter(d=>t.includes(d.drawPosition)).every(d=>d.participantId);return a&&[Zr,Nr,An].includes(a)&&l===1&&e?{...oe}:a&&BUe.includes(a)&&!u?ce({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:a,requiredParticipants:u},result:{error:uE}}):{...oe}}function H0e({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:kt};let{matchUp:n}=Yr({drawDefinition:e,matchUpId:i,event:r});return n?.matchUpType!==Pc?{error:wl}:Rb({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function V0e({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:kt};if(!i)return{error:go};let{matchUp:r}=Yr({drawDefinition:t,event:e,matchUpId:i});return r?Mo({name:K2,element:r}):{error:Zs}}function jit({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:s}){let o="substituteParticipant";if(!r)return{error:kt};if(!a)return{error:go};if(!e||!t)return ce({result:{error:ba},stack:o});let{matchUp:l}=Yr({drawDefinition:r,matchUpId:a,event:s});if(!l)return{error:Zs};if(!l.collectionId)return ce({result:{error:wl},stack:o});let c=os({drawDefinition:r}),{matchUps:u}=ia({tournamentParticipants:i?.participants,inContext:!0,drawDefinition:r,matchUpsMap:c}),d=u?.find(f=>f.matchUpId===a),p=u?.find(f=>f.matchUpId===d?.matchUpTieId)?.sides?.find(f=>f.participant.individualParticipants.some(({participantId:h})=>h===e));return!p||n&&p.sideNumber!==n?{error:lp}:p.participant?.individualParticipants?.map(qi).filter(f=>f!==e)?.includes(t)?oX({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:s}):ce({result:{error:lp},stack:o})}function G0e(t){return jit(t)}function Q0e({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:kt};let{matchUp:r}=Yr({drawDefinition:t,matchUpId:e,event:i});return ur({extension:{name:aw,value:!0},element:r})}function j0e(t){let e="setMatchUpFormat",i=Qt(t,[{tournamentRecord:!0},{[Ps]:I=>Zl({matchUpFormat:I}),[Nc]:lM,matchUpFormat:!0}]);if(i.error)return ce({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:s,matchUpFormat:o,structureId:l,eventType:c,matchUpId:u,eventId:d,stages:p,drawId:f,event:h,force:m}=t;if(a&&!Array.isArray(a))return ce({result:{error:we,scheduledDates:a},stack:e});if(c&&!g2([mf,hu],c))return ce({result:{error:Th},stack:e});let A=0,g=t.structureIds||l&&[l].filter(Boolean)||[],v=t.eventIds||d&&[d].filter(Boolean)||[],b=t.drawIds||f&&[f].filter(Boolean)||[];if((l||g?.length)&&!n)return ce({result:{error:kt},stack:e});if(f&&u&&n){let I=m9({tournamentRecord:r,drawDefinition:n,matchUpFormat:o,structureIds:g,structureId:l,matchUpId:u});if(I.error)return I;A+=1}let y=I=>{let w=[];for(let S of I.structures||[]){if(Array.isArray(p)&&!p.includes(S.stage)||Array.isArray(s)&&!s.includes(S.stageSequence)||g?.length&&!g.includes(S.structureId))continue;g?.length&&S.matchUpFormat!==o&&(S.matchUpFormat=o,w.push(S.structureId),A+=1);let T=((m||a)&&dr({matchUpFilters:{matchUpStatuses:[Nn]},structure:S}).matchUps)??[],D=(a&&dr({matchUpFilters:{matchUpStatuses:[Nn]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:S}).matchUps)??[];if(T?.length){let C=D?D.map(_a):T.map(_a);for(let E of T)C.includes(E.matchUpId)&&(E.matchUpFormat=a?.length?o:void 0,Zi({tournamentId:r?.tournamentId,eventId:h?.eventId,context:e,drawDefinition:I,matchUp:E}))}}return!w.length&&I.matchUpFormat!==o&&(I.matchUpFormat=o,A+=1),w};for(let I of r?.events||[])if(!(v?.length&&!v.includes(I.eventId)||c&&c!==I.eventType||c===da))if(Array.isArray(s)||Array.isArray(p)||g?.length||b?.length)for(let w of I.drawDefinitions||[]){if(Array.isArray(b)&&!b.includes(w.drawId))continue;let S=y(w);kr({structureIds:S,drawDefinition:w})}else I.matchUpFormat!==o&&(I.matchUpFormat=o,A+=1);return A?{...oe,modificationsCount:A}:{...oe,info:fE}}function mX({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){if(!i)return{error:kt};let a=Yr({drawDefinition:i,matchUpId:r})?.matchUp;if(!a?.tieMatchUps)return{error:wl};let s=Yr({inContext:!0,drawDefinition:i,matchUpId:r,event:n})?.matchUp,o=0;return(a?.sides||[]).forEach(l=>{l.lineUp&&delete l.lineUp}),(s?.sides||[]).forEach(l=>{if(o+=1,t===!1){let c=s?.tieFormat,u=l.participantId;c&&u&&bS({drawDefinition:i,participantId:u,lineUp:[],tieFormat:c})}Zi({tournamentId:e?.tournamentId,context:"resetMatchUpLineUps",eventId:n?.eventId,drawDefinition:i,matchUp:a})}),{...oe,modificationsCount:o}}function z0e(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n,setTBlast:a}=t;if(!n)return{sets:[]};let s=n.sets||[],o=ip({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),l=ip({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),c=ip({matchUpFormat:e,matchUpStatus:i,winningSide:r,setTBlast:a,sets:s}),u=o===c?l:o;return r&&(o=r===1?c:u,l=r===2?c:u),{score:{sets:s,scoreStringSide1:o,scoreStringSide2:l}}}function zit({sourceMatchUpStatusCodes:t,propagateExitStatus:e,sourceMatchUpStatus:i,loserParticipantId:r,tournamentRecord:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,event:l}){let c="progressExitStatus";yl({matchUpId:s?.matchUpId,matchUpStatus:i,color:"magenta",method:c});let u=ks(i)&&i!==Ha&&i||Zr,d=ia({inContext:!0,drawDefinition:a,matchUpsMap:o})?.matchUps,p=u,f=d?.find(h=>h.matchUpId===s?.matchUpId);if(f?.matchUpId&&p){let h,m=f.matchUpStatusCodes?.map(v=>typeof v=="string"?v:"WO")??[],A=f.sides?.find(v=>v.participantId===r);if(A?.sideNumber)if(f?.sides?.reduce((v,b)=>b?.participantId?v+1:v,0)===1&&m.length===0)h=A.sideNumber===1?2:1,m[0]=t[0];else if(!ks(s.matchUpStatus))h=A.sideNumber===1?2:1,m[0]=t[0];else{let v=m[0];m[A.sideNumber-1]=t[0];let b=A.sideNumber===1?2:1;m[b-1]=v,p=An,h=void 0}let g=Rb({matchUpStatus:p,matchUpId:s.matchUpId,matchUpStatusCodes:m,allowChangePropagation:!0,propagateExitStatus:e,tournamentRecord:n,drawDefinition:a,winningSide:h,event:l});return ce({result:g,stack:c,context:{progressExitStatus:!0}})}return ce({result:{error:Zo},stack:c})}function hN(t){let e=Qt(t,[{[Rf]:!0,[ro]:!0}]);if(e.error)return e;let i="setMatchUpStatus",r=Cu(t);if(!t.drawDefinition){let I=t.tournamentRecord??(t.tournamentId&&r[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=I);let w=tl({eventId:t.eventId,drawId:t.drawId,tournamentRecord:I});if(w.error)return w;w.drawDefinition&&(t.drawDefinition=w.drawDefinition),t.event=w.event}let{disableScoreValidation:n,propagateExitStatus:a,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:c,drawDefinition:u,matchUpId:d,schedule:p,event:f,notes:h}=t,m=t.matchUpFormat||t.outcome?.matchUpFormat,{policy:A}=wb({policyType:mu,tournamentRecord:o,event:f}),g=t.allowChangePropagation!==void 0&&t.allowChangePropagation||A?.allowChangePropagation!==void 0&&A.allowChangePropagation||void 0,{outcome:v,setTBlast:b}=t;if(v?.winningSide&&![1,2].includes(v.winningSide))return{error:I2};if(m){let I=m9({tournamentRecord:o,drawDefinition:u,matchUpFormat:m,matchUpId:d,event:f});if(I.error)return I}if(v?.score?.sets&&!v.score.scoreStringSide1){let{score:I}=z0e({...v,setTBlast:b});v.score=I,v.score.sets=v.score.sets.filter(w=>w.side1Score||w.side2Score||w.side1TiebreakScore||w.side2TiebreakScore)}let y=Rb({matchUpStatusCodes:v?.matchUpStatusCodes,matchUpStatus:v?.matchUpStatus,winningSide:v?.winningSide,allowChangePropagation:g,disableScoreValidation:n,score:v?.score,propagateExitStatus:a,tournamentRecords:r,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:c,drawDefinition:u,matchUpFormat:m,matchUpId:d,schedule:p,event:f,notes:h});if(y.context?.progressExitStatus){let I=!0,w=0;for(;I&&w<10;){I=!1,w+=1;let S=zit({sourceMatchUpStatusCodes:y.context.sourceMatchUpStatusCodes,sourceMatchUpStatus:y.context.sourceMatchUpStatus,loserParticipantId:y.context.loserParticipantId,propagateExitStatus:t.propagateExitStatus,tournamentRecord:t.tournamentRecord,loserMatchUp:y.context.loserMatchUp,matchUpsMap:y.context.matchUpsMap,drawDefinition:t.drawDefinition,event:t.event});S.context?.loserMatchUp&&(Object.assign(y.context,S.context),I=!0)}}return ce({result:y,stack:i})}function q0e(t){if(!t?.outcomes)return{error:Yt};if(!Array.isArray(t.outcomes))return{error:Yt,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:nt};let s=i.filter(o=>o.tournamentId===n);if(s.length){let o=qit({outcomes:s,tournamentRecord:a});if(o.error)return o}}return{...oe}}function qit(t){let{tournamentRecords:e,tournamentRecord:i,outcomes:r,policyDefinitions:n}=t,a={};r.forEach(s=>{let{eventId:o}=s;a[o]||(a[o]=[]),a[o].push(s)});for(let s of Object.keys(a)){let{event:o}=tl({tournamentRecord:i,eventId:s});for(let l of a[s]){let{drawId:c}=l,u=o?.drawDefinitions?.find(d=>d.drawId===c);if(u&&c){let{matchUpFormat:d,matchUpId:p}=l,f=hN({schedule:l?.schedule,tournamentRecords:e,policyDefinitions:n,tournamentRecord:i,drawDefinition:u,matchUpFormat:d,matchUpId:p,outcome:l,drawId:c,event:o});if(f.error)return f}}}return{...oe}}function Wit({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){if(!r&&!t)return{error:kt};if(!i)return{error:Yt,info:"missing outcome"};if(!r&&!e)return{error:Zo};if(!r){let n=Yr({drawDefinition:t,matchUpId:e});if(n.error)return n;r=n.matchUp}return typeof i!="object"||!i.score?.scoreStringSide1||!i.score?.scoreStringSide2?{error:we}:ur({element:r,extension:{name:K2,value:i}})}function W0e(t){return Wit(t)}function AX(t){let e="resetTieFormat",{drawDefinition:i,event:r,uuids:n}=t,a=Qt(t,[{[Ua]:!0,[Rf]:!0}],e);if(a.error)return a;let s=NE(t,[{[AE]:Qh}]);if(s[cd])return s;let o=t.tournamentRecord?.tournamentId,{matchUp:l,structure:c}=s?.matchUp??{};if(!l?.tieMatchUps)return ce({result:{error:wl},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...oe};let u=po({structure:c,drawDefinition:i,event:r})?.tieFormat;if(!u)return ce({result:{error:rs},info:"No inherited tieFormat",stack:e});let d=[],p=[],f=[],h=[];for(let m of u.collectionDefinitions){let{matchUpCount:A,collectionId:g}=m;p.push(g);let v=(l.tieMatchUps||[]).filter(b=>b.collectionId===g);if(v.length>A)v.sort((b,y)=>(b.matchUpStatus===Nn?1:0)-(y.matchUpStatus===Nn?1:0)),f.push(...v.slice(0,A)),d.push(...v.slice(3).map(_a));else if(f.push(...v),v.length<A){let b=A-v.length,y=YM({collectionDefinition:m,matchUpsLimit:b,matchUp:l,uuids:n});h.push(...y)}}for(let m of l?.tieMatchUps||[])m.collectionId&&!p.includes(m.collectionId)&&d.push(m.matchUpId);return h.length&&(f.push(...h),Tg({eventId:r?.eventId,matchUps:h,drawDefinition:i,tournamentId:o})),d.length&&zh({matchUpIds:d,eventId:r?.eventId,drawDefinition:i,tournamentId:o}),l&&(l.tieMatchUps=f,l.tieFormatId=void 0,l.tieFormat=void 0,Zi({structureId:c?.structureId,eventId:r?.eventId,context:e,drawDefinition:i,tournamentId:o,matchUp:l})),{...oe,newMatchUps:h,deletedMatchUpIds:d}}function gX(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}=t,a="resetScorecard";if(!i)return ce({result:{error:kt},stack:a});if(!r)return ce({result:{error:go},stack:a});if(!rn(r))return ce({result:{error:we,matchUpId:r},stack:a});let s=os({drawDefinition:i}),{matchUps:o}=ia({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:s}),l=s.drawMatchUps.find(m=>m.matchUpId===r),c=o?.find(m=>m.matchUpId===r);if(!l||!o)return{error:Zs};if(l.matchUpType!==Jl)return{error:wl};let u=Fo({inContextDrawMatchUps:o,drawDefinition:i,matchUpId:r}),d=c?.structureId,{structure:p}=di({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:o,inContextMatchUp:c,matchUpsMap:s,targetData:u,structure:p,matchUp:l}),jy(t))return{error:S2};if(l.tieMatchUps?.length)for(let m of l.tieMatchUps){let A=Rb({matchUpId:m.matchUpId,matchUpTieId:r,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:n});if(A.error)return ce({result:A,stack:a})}let f=tr({tournamentRecord:e,drawDefinition:i,event:n})?.appliedPolicies,h=IA({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:f,drawDefinition:i,matchUpsMap:s,matchUpId:r});if(h.error)return ce({result:h,stack:a});if(t.tiebreakReset&&!h.tieFormatRemoved){let m=po({drawDefinition:i,structure:p,event:n})?.tieFormat;if(l.tieFormat&&m){let{matchUpCountDifference:A,descendantDifferences:g,ancestorDifferences:v,valueDifference:b}=Jm({descendant:l.tieFormat,ancestor:m});if(g.collectionIds.length===1&&!v.collectionIds.length&&!v.groupsCount&&A===1&&b===1){let y=AX({tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n});if(y.error)return y}}}return{...oe}}function K0e(t){let e=Qt(t,[{[ro]:!0,[gA]:!0},{[YT]:{[bM]:!1,roundNumbers:!1},[yUe]:"At least one must be provided",[rl]:qs}]);if(e.error)return e;let i=nEe(t);if(i.error)return i;let{matchUpIds:r}=i,n=Vn(Jl)(t.event.eventType),{tournamentRecord:a,drawDefinition:s,event:o}=t;for(let l of r){if(n){let u=gX({tiebreakReset:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(u.error||t.removeAssignments&&mX({inheritance:!1,drawDefinition:s,matchUpId:l}).error)return u}let c=Rb({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(c.error)return c;if(t.removeAssignments){let u=lX({...t,matchUpId:l});if(u.error)return u}}return{...oe}}function Kit({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){if(!e)return{error:kt};let r="setOrderOfFinish";if(!Array.isArray(i))return ce({info:Gy("finishingOrder"),result:{error:we},stack:r});let{completedMatchUps:n,matchUpsMap:a}=SE({inContext:!0,drawDefinition:e}),s=n?.map(_a)??[],o=i.map(_a),{matchUpTypes:l,roundNumbers:c,structureIds:u,matchUpTieIds:d}=(n??[]).filter(({matchUpId:v})=>o.includes(v)).reduce((v,b)=>{let{matchUpTieId:y,matchUpType:I,roundNumber:w,structureId:S}=b;return v.matchUpTypes.includes(I)||v.matchUpTypes.push(I),v.roundNumbers.includes(w)||v.roundNumbers.push(w),v.structureIds.includes(S)||v.structureIds.push(S),v.matchUpTieIds.includes(y)||v.matchUpTieIds.push(y),v},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||c.length>1||u.length>1)return ce({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:we},stack:r});let p,f,h={},m=[],A=[];if(!i.every(({orderOfFinish:v,matchUpId:b})=>(m.push(b),v&&A.push(v),h[b]=v,p=s.includes(b),f=v===void 0||wi(v)&&Math.floor(v)>0,p&&f)))return ce({result:{error:p?we:uE},info:!p&&"matchUps must be completed"||!f&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:r});let g=n?.filter(v=>v.structureId===u[0]&&v.roundNumber===c[0]&&v.matchUpType===l[0]&&v.matchUpTieId===d[0]&&!m.includes(v.matchUpId));for(let v of g??[]){let{orderOfFinish:b}=v||{};if(b){if(!wi(b))return ce({context:{orderOfFinish:b,matchUp:v},result:{error:we},stack:r});A.push(b)}}if(OIe(A).length!==A.length||Math.max(...A)>A.length)return ce({info:"Values not unique or greater than expected number of values",result:{error:we},stack:r});if(u.length){let v=d$({matchUpFilters:{matchUpIds:o},structureId:u[0],drawDefinition:e,matchUpsMap:a});if(v.error)return ce({result:v,stack:r});v.completedMatchUps?.forEach(b=>{b.orderOfFinish=h[b.matchUpId],Zi({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:b})})}return{...oe}}function Y0e(t){return Kit(t)}function X0e(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,lineUps:n,event:a}=t,s="applyLineUps",o=Qt(t,[{[Ua]:!0,[ro]:!0,[Rf]:!0},{lineUps:!0,[rl]:qs}],s);if(o.error)return o;let l=e.participants||[],c=Yr({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:r});if(c.error)return c;if(!c.matchUp)return{error:Zs};let{matchUp:u,structure:d}=c,{drawPositions:p,matchUpType:f}=u;if(f!==Hr)return{error:wl};if(!p?.length)return{error:aM};let h=po({matchUp:u,drawDefinition:i,structure:d,event:a})?.tieFormat,m={};for(let g of n){if(!Array.isArray(g))return{error:we,lineUp:g};let v={},b=[];for(let T of g){if(typeof T!="object")return{error:we,lineUpAssignment:T};let{participantId:D,collectionAssignments:C=[]}=T;if(!Array.isArray(C))return{error:we,collectionAssignments:C};let E=l.find(R=>R.participantId===D);if(!E)return{error:Fn};if(E.participantType!==Wi)return{error:cp};let P=u.sides?.find(R=>R.participant?.individualParticipantIds?.includes(D))?.sideNumber;P&&b.push(P);for(let R of C){if(typeof R!="object")return{error:we,collectionAssignment:R};let{collectionId:M,collectionPosition:N}=R,k=h?.collectionDefinitions?.find(F=>F.collectionId===M);if(!k)return{error:we,collectionId:M};let O=`${M}-${N}`;v[O]||(v[O]=[]);let x=v[O].length;if(Vn(Dr)(k.matchUpType)&&x||k.matchUpType===br&&x>1)return{info:"Excessive collectionPosition assignments",error:we};v[O].push(D)}}let y=Object.values(v);for(let T of y)if(T.length===2){let{participant:D}=Cd({tournamentParticipants:l,participantIds:T});if(!D){let C=bf({participant:{participantType:Ni,participantRole:xs,individualParticipantIds:T},pairOverride:!0,tournamentRecord:e});if(C.error)return C}}let I=Xl(b),w=(I[1]||0)>(I[2]||0)&&1||(I[2]||0)>(I[1]||0)&&2||void 0,S=Object.keys(m).map(T=>parseInt(T));w&&!S.includes(w)&&(m[w]=g)}if(!Object.keys(m).length)return{error:z8};if(c=Yr({drawDefinition:i,matchUpId:r}),c.error)return c;if(!c.matchUp)return{error:Zs};let{matchUp:A}=c;A.sides||(A.sides=[]);for(let g of[1,2]){let v=A.sides.find(y=>y.sideNumber===g),b=m[g];if(b)v?v.lineUp=b:A.sides.push({lineUp:b,sideNumber:g});else continue}return Zi({tournamentId:e?.tournamentId,context:s,drawDefinition:i,matchUp:A}),{...oe}}var vX={};Li(vX,{anonymizeTournamentRecord:()=>yPe,generate:()=>Z0e,generateEventWithDraw:()=>AH,generateOutcome:()=>CX,generateOutcomeFromScoreString:()=>yX,generateParticipants:()=>LE,generateTournamentRecord:()=>gPe,modifyTournamentRecord:()=>IPe,mutate:()=>vPe});var Z0e={};Li(Z0e,{generateEventWithDraw:()=>AH,generateOutcome:()=>CX,generateOutcomeFromScoreString:()=>yX,generateParticipants:()=>LE,generateTournamentRecord:()=>gPe});function Yit(t){let e=t.reduce((i,r)=>((r.side1Score!==void 0||r.side2Score!==void 0)&&(i.side1+=r.side1Score??0,i.side2+=r.side2Score??0),i),{side1:0,side2:0});return e.side1>e.side2?1:e.side2>e.side1?2:t.find(i=>i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)?.winningSide}function Xit(t){let e={side1:0,side2:0};if(t.forEach(i=>{i.winningSide===1?e.side1++:i.winningSide===2&&e.side2++}),e.side1>e.side2)return 1;if(e.side2>e.side1)return 2}function Zit(t,e,i){if(t||!e||!i)return t;let r=ys(e);return r?.setFormat?.based==="A"||r?.finalSetFormat?.based==="A"?Yit(i):Xit(i)}function Jit(t,e,i){let r=sN({scoreString:t,matchUpFormat:e});return{sets:r,scoreStringSide1:ip({sets:r,matchUpFormat:e,setTBlast:i}),scoreStringSide2:ip({sets:r,reversed:!0,matchUpFormat:e,setTBlast:i})}}function ert(t,e,i,r){let n=ip({sets:t,matchUpFormat:i,setTBlast:r}),a=ip({sets:t,reversed:!0,matchUpFormat:i,setTBlast:r});if(typeof n!="string")return n;if(typeof a!="string")return a;let s=e===2?a:n,o=e===2?n:a;return{sets:sN({scoreString:s,matchUpFormat:i}),scoreStringSide1:s,scoreStringSide2:o}}function yX(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n,setTBlast:a,preserveSideOrder:s=!1}=t;if(!n)return{outcome:{...I$,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:we,winningSide:r};let o=n&&sN({scoreString:n,matchUpFormat:e}),l=n?.trim().startsWith("["),c=Zit(r,e,o),u=ys(e),d=u?.setFormat?.based==="A"||u?.finalSetFormat?.based==="A",p=s||l||d?Jit(n,e,a):ert(o,c,e,a);return Lt({outcome:{matchUpStatus:i,winningSide:c,score:p}})}function bX({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){let n=(e?.[r.matchUpId]?.matchUpIds||[]).filter(a=>i.includes(a)).filter(a=>!t[a]);return{dependenciesScheduled:!n?.length,remainingDependencies:n}}function mN({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function trt({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function a1({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:s=0,scheduleTime:o,matchUp:l}){let c=Kr(l?.schedule?.endTime),u=c?gl(c,ci(s)):gl(o,ci(r)+ci(s)),d=i&&(c?gl(Kr(c),i):gl(o,ci(r)+ci(i))),p=a?.[l.matchUpId]?.participantIds||[],f=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(h=>{mN({individualParticipantProfiles:e,participantId:h});let m=e[h].priorMatchUpType!==l.matchUpType&&d||u;f.includes(h)?trt({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:m,participantId:h,scheduleTime:o}):(e[h].timeAfterRecovery=m,e[h].bookings.push({scheduleTime:o,timeAfterRecovery:m}))}),rC({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:u,matchUp:l})}function J0e({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){let a,s=n.minutesMap?.[r]?.recoveryMinutes,o=(n.minutesMap?.[r]?.averageMinutes||0)+(s||0),l=gl(i,o),c=e?.[r]?.dependentMatchUpIds||[];if(c.length){let u=c.reduce((d,p)=>{let f=t[p];if(!f)return d;let h={scheduleTime:f,matchUpId:p};return f&&!d.matchUpId||sr(f)<sr(d.scheduleTime)?h:d},{});u.scheduleTime&&sr(l)>sr(u.scheduleTime)&&(a=u)}return{scheduledDependent:a}}function irt(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>i===br&&(r?.participant?.individualParticipants||[])||r?.participant&&[r.participant]||[]).flat()}var AN="DO_NOT_SCHEDULE",rrt={DO_NOT_SCHEDULE:AN};function IX({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:s}){let o=irt(s).map(({person:f})=>f?.personId);if(i){let f=(s?.potentialParticipants||[]).flat().map(({person:h})=>h?.personId);o.push(...f)}let l=o.map(f=>r[f]?.map(h=>({...h,personId:f}))).filter(Boolean).flat().filter(f=>f.requestType===AN&&Eh(a,f.date)),c=[],u=s?.matchUpId,d=Jn(Kr(n),Ui(a)),p=Kr(aY(d,t).toISOString());for(let f of l){let{requestId:h,startTime:m,endTime:A}=f;(n>m&&n<A||p&&p>m&&p<A)&&(c.push({matchUpId:u,request:f,scheduleTime:n}),e[h]?(e[h].scheduleTimes.includes(n)||e[h].scheduleTimes.push(n),e[h].matchUpIds.includes(u)||e[h].matchUpIds.push(u)):e[h]={request:f,scheduleTimes:[n],matchUpIds:[u]})}return{conflicts:c}}function f3({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=t$(i),s=(t[i.matchUpId]||[]).filter(o=>!_o(o,a)).flat();[...a,...s].forEach(o=>{if(mN({individualParticipantProfiles:e,participantId:o}),!e[o].potentialCounted[i.drawId]){let l=e[o].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[dd]?l[dd]+=r:r>0&&(l[dd]=r),s.includes(o)&&(e[o].potentialCounted[i.drawId]=!0)}})}function nrt({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,matchUpDependencies:o,clearScheduleDates:l,scheduleDate:c,minutesMap:u,matchUps:d}){let p=[];i||(n=d?.filter(m=>{let A=m.schedule||{},g=m.matchUpStatus==="BYE";return g&&p.push({tournamentId:m.tournamentId,matchUpId:m.matchUpId}),!g&&uN({schedule:A})&&(!c||m.schedule.scheduledDate===c)}),i=n.map(_a));let f=Array.isArray(l)?l.includes(c):l,h=f?[]:d.filter(({matchUpId:m})=>i.includes(m));for(let m of h){f3({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:m});let A=m.schedule?.scheduledTime;if(A){s[m.matchUpId]=A;let g=u?.[m.matchUpId]?.recoveryMinutes;a1({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:o,averageMatchUpMinutes:r,recoveryMinutes:g,scheduleTime:A,matchUp:m})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:f}}function pH({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:s,matchUps:o}){if(typeof r!="object")return{error:bn};if(!Pu(o)&&!Array.isArray(i))return{error:mA};a=a??aH({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:f}=DM({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:f}}})).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=o?.filter(d=>{let p=d.schedule;return uN({schedule:p})&&(!s||d.schedule.scheduledDate===s)}));let u=i?.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!=="BYE");return{bookings:u?.map(({eventId:d,schedule:p,matchUpFormat:f})=>{let{event:h,scheduleTiming:m}=l[d],A=h?.eventType,g={...m,defaultTiming:c,matchUpFormat:f},{averageMinutes:v,recoveryMinutes:b}=o$({timingDetails:g,eventType:A}),{courtId:y,venueId:I}=p,w=Kr(p.scheduledTime),S=gl(w,v);return{recoveryMinutes:b,averageMinutes:v,periodLength:a,startTime:w,courtId:y,endTime:S,venueId:I}}).filter(Boolean),relevantMatchUps:u,dateScheduledMatchUps:i}}function art({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:s,periodLength:o,scheduleDate:l,startTime:c,venueIds:u,matchUps:d,endTime:p}){if(s&&!a&&(a={[s.tournamentId]:s}),typeof a!="object"||!Object.keys(a).length)return{error:bn};o=o??aH({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:f,venues:h}=wA({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),m=f?.filter(I=>!u||u.includes(I.venueId))??[];c=c??nC({courts:m,scheduleDate:l,startTime:!0}),p=p??nC({courts:m,scheduleDate:l,endTime:!0});let{bookings:A,dateScheduledMatchUps:g}=pH({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:o,venueIds:u,matchUps:d}),v={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:o,startTime:c,bookings:A,endTime:p,courts:m},{scheduleTimes:b}=rX(v),y=u?.length===1&&u[0]||h?.length===1&&h[0].venueId||void 0;return{dateScheduledMatchUpIds:g?.map(rc("matchUpId")),dateScheduledMatchUps:g,scheduleTimes:b,venueId:y}}function srt({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,s,o,l;for(let c of t.filter(Boolean))l||(l=c.hash),(c.hash===l||i)&&(n=n.concat(c.matchUpIds)),c.hash,o=e,s=c.recoveryMinutes,a=c.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:s,averageMinutes:o}),{groupedRounds:r}}function ePe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,tournamentRecords:l,periodLength:c,scheduleDate:u,useGarman:d,matchUps:p,courts:f,venues:h}){let m={},A=[],g=[],v=[];for(let b of h){let{rounds:y=[],venueId:I}=b,{scheduledRoundsDetails:w,greatestAverageMinutes:S,orderedMatchUpIds:T,minutesMap:D}=lN({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:c,matchUps:p,rounds:y});v.push(...T??[]);let{groupedRounds:C}=srt({scheduledRoundsDetails:w,greatestAverageMinutes:S,garmanSinglePass:!0}),E,P=[];d&&({scheduleTimes:P,dateScheduledMatchUpIds:E}=art({averageMatchUpMinutes:C[0]?.averageMinutes,scheduleDate:Ui(u),venueIds:[b.venueId],clearScheduleDates:o,tournamentRecords:l,periodLength:c,matchUps:p}));let R=nrt({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:E,greatestAverageMinutes:S,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,scheduleDate:u,minutesMap:D,matchUps:p});({dateScheduledMatchUpIds:E}=R);let M=R,{byeScheduledMatchUpDetails:N,clearDate:k}=R;N?.length&&g.push(...N);let{matchUpsToSchedule:O,matchUpMap:x}=G$({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:E,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:T,clearDate:k,matchUps:p}),F=f.filter(_=>_.venueId===I);m[I]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:S,scheduledRoundsDetails:w,dateScheduledMatchUps:M,matchUpsToSchedule:O,scheduleTimes:P,groupedRounds:C,venueCourts:F,minutesMap:D,matchUpMap:x},o||A.push(...E)}return{allDateScheduledByeMatchUpDetails:g,allDateScheduledMatchUpIds:A,venueScheduledRoundDetails:m,allDateMatchUpIds:v}}function ort(t,e){let i=sr(t.scheduleTime),r=sr(t.timeAfterRecovery),n=sr(e.scheduleTime),a=sr(e.timeAfterRecovery),s=i===n||r===a,o=i>n&&i<a,l=n>i&&n<r,c=r>n&&r<a,u=a>i&&a<r;return Lt({hasOverlap:s||o||c||l||u,startAisContained:o,endAisContained:c,startBisContained:l,endBisContained:u},!0)}function wX({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){let s=(i?.[n.matchUpId]?.participantIds||[]).flat(),o=a?.minutesMap?.[n.matchUpId]?.averageMinutes||0,l=a?.minutesMap?.[n.matchUpId]?.recoveryMinutes||0,c=s.every(p=>{mN({individualParticipantProfiles:t,participantId:p});let f=t[p];if(!f.timeAfterRecovery)return!0;let h=Kr(n?.schedule?.endTime),m=h?gl(h,ci(l)):gl(r,ci(o)+ci(l));return![...Object.keys(f.potentialBookings).filter(A=>A!==n.drawId).map(A=>f.potentialBookings[A]).flat(),...f.bookings].find(A=>ort({scheduleTime:r,timeAfterRecovery:m},A).hasOverlap)}),u=e[n.matchUpId],d=(u?fM(Jn(u),Jn(r),!1):0)>=0;return{enoughTime:c&&d}}function tPe({autoSchedulingAudit:t,tournamentRecords:e}){Ii({topic:Um,payload:t});let i=s=>s?Object.values(s).reduce((o,l)=>o+l.length||0,0):0,r=(t?.schedulingProfile||[]).reduce((s,o)=>s+o.venues.reduce((l,c)=>l+c.rounds.length,0),0),n={scheduledDatesCount:t.scheduledDates?.length,noTimeMatchUpIdsCount:i(t?.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t?.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t?.overLimitMatchUpIds),requestConflictsCount:i(t?.requestConflicts),profileRoundsCount:r},a={itemType:u3,itemValue:n};for(let s of Object.values(e)){let o=s.tournamentId;R2(Um)?Ii({payload:{type:u3,tournamentId:o,detail:n},topic:Um}):tN({tournamentRecord:s,timeItem:a})}}function SX({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=t$(r),{matchUpId:a,matchUpType:s}=r,o=(r.roundPosition&&t[a]||[]).flat(),l=Ei(n.concat(...o));return l.forEach(c=>{mN({individualParticipantProfiles:e,participantId:c})}),{participantIdsAtLimit:l.filter(c=>{let u=e[c];if(u)return[s,dd].find(d=>{let p=u.counters?.[d]||0,f=i[d]||0;return p&&f&&p>=f})}),relevantParticipantIds:l}}function s1({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:s,tournamentRecord:o,matchUpDetails:l,matchUpIds:c,schedule:u}){if(!o)return{error:nt};if(!l&&(!c||!Array.isArray(c)))return{error:Jw};if(!l&&(!u||typeof u!="object"))return{error:Gwe};let d,p=[],f=0;if(r&&!n){let A=Bd({tournamentRecords:s,tournamentRecord:o});n=A.matchUpDependencies,d=A.matchUps}d||(d=as({tournamentRecord:o})?.matchUps??[]);let h=d.reduce((A,g)=>{let{matchUpId:v,drawId:b,matchUpStatus:y}=g;return(e||y!=="BYE")&&(t||!ta.includes(y))&&(A[b]?A[b].push(v):A[b]=[v]),A},{}),m=l?.map(A=>A.matchUpId);for(let A of Object.keys(h)){let{drawDefinition:g}=lv({tournamentRecord:o,drawId:A});if(!g)continue;let v=h[A].filter(y=>c?.includes(y)??m?.includes(y)),b=No({inContext:!1,drawDefinition:g}).matchUps;for(let y of v){let I=l?.find(S=>S.matchUpId===y)?.schedule||u,w=dH({schedule:I,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:s,tournamentRecord:o,checkChronology:r,drawDefinition:g,drawMatchUps:b,matchUpId:y});if(w?.warnings?.length&&p.push(...w.warnings),w?.success&&(f+=1),w.error)return w}}return p.length?{...oe,scheduled:f,warnings:p}:{...oe,scheduled:f}}function gN(t){let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:r,matchUpContextIds:n,removePriorValues:a,tournamentRecords:s,checkChronology:o,matchUpDetails:l,schedule:c}=t;if(t.matchUpIds&&!n)return s1(t);let u=Qt(t,[{[Js]:!0},{[YT]:{matchUpContextIds:!1,matchUpDetails:!1},[Nc]:we,[rl]:qs}]);if(u.error)return u;if((!l||n)&&!c)return{error:Yt,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:f}=Bd({tournamentRecords:s});for(let h of Object.values(s)){let{tournamentId:m}=h,A=n?.filter(v=>v.tournamentId===m).map(_a),g=l?.filter(v=>v?.tournamentId===m);if(A?.length||g?.length){let v=s1({matchUpDetails:g,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:f,errorOnAnachronism:r,removePriorValues:a,tournamentRecords:s,tournamentRecord:h,checkChronology:o,matchUpIds:A,schedule:c});if(v.warnings?.length&&d.push(...v.warnings),v.scheduled&&(p+=v.scheduled),v.error)return v}}return d.length?{...oe,scheduled:p,warnings:d}:{...oe,scheduled:p}}function lrt({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:c,schedulingProfile:u,personRequests:d,periodLength:p,matchUps:f,courts:h,dryRun:m}){let A={},g={},v={},b={},y={},I={},w={},S={},T={},D={};for(let P of n){let R=Ui(P?.scheduleDate),M=P?.venues||[],N={},k={},O=(W,Y)=>{W.forEach(X=>{let J=k[X].counters;J[Y]?J[Y]+=1:J[Y]=1,J[dd]?J[dd]+=1:J[dd]=1})};v[R]={},b[R]={},A[R]={},g[R]={},w[R]=[],S[R]=[],T[R]=[],D[R]=[];let x={};f.forEach(W=>{W.schedule?.scheduledDate&&Eh(R,Ui(W.schedule.scheduledDate))&&rC({matchUpPotentialParticipantIds:N,matchUpNotBeforeTimes:x,matchUp:W})});let{allDateScheduledByeMatchUpDetails:F,venueScheduledRoundDetails:_,allDateMatchUpIds:V}=ePe({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:x,matchUpScheduleTimes:I,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:c,useGarman:!0,periodLength:p,scheduleDate:R,matchUps:f,courts:h,venues:M}),G=10,z=0,Q,j=10;for(;!Q;){for(let{venueId:W}of M){let Y=0,X=_[W];for(;X.courtsCount&&X.scheduleTimes?.length&&X.matchUpsToSchedule?.length&&Y<=X.courtsCount;){let{scheduleTime:J,attempts:ie=0}=X.scheduleTimes.shift(),ue=X.matchUpsToSchedule.find(ne=>{let{matchUpId:ge,matchUpType:he}=ne,{participantIdsAtLimit:Ie,relevantParticipantIds:xe}=SX({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,matchUpDailyLimits:o,matchUp:ne});if(Ie.length)return S[R].includes(ge)||S[R].push(ge),!1;let{scheduledDependent:Je}=J0e({matchUpScheduleTimes:I,matchUpDependencies:s,scheduleTime:J,matchUpId:ge,details:X});if(Je)return!1;let{dependenciesScheduled:qe,remainingDependencies:dt}=bX({matchUpScheduleTimes:I,matchUpDependencies:s,allDateMatchUpIds:V,matchUp:ne});if(!qe)return b[R][ge]||(b[R][ge]=[]),b[R][ge].push({scheduleTime:J,remainingDependencies:dt}),!1;let{enoughTime:ft}=wX({individualParticipantProfiles:k,matchUpNotBeforeTimes:x,matchUpDependencies:s,scheduleTime:J,details:X,matchUp:ne});if(!ft)return v[R][ge]||(v[R][ge]=[]),v[R][ge].push({scheduleTime:J}),!1;let je=X.greatestAverageMinutes,{conflicts:Tt}=IX({potentials:e,averageMatchUpMinutes:je,requestConflicts:D,personRequests:d,scheduleTime:J,scheduleDate:R,matchUp:ne});if(Tt?.length)return y[R]||(y[R]=[]),y[R].push(...Tt),!1;O(xe,he);let Oe=X.minutesMap?.[ge]?.recoveryMinutes;return a1({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,matchUpNotBeforeTimes:x,averageMatchUpMinutes:je,matchUpDependencies:s,recoveryMinutes:Oe,scheduleTime:J,matchUp:ne}),I[ge]=J,!0});X.matchUpsToSchedule=X.matchUpsToSchedule.filter(({matchUpId:ne})=>ne!==ue?.matchUpId),ue?Y+=1:(g[R][W]||(g[R][W]=[]),g[R][W].push({scheduleTime:J,attempts:ie+1}))}X.matchUpsToSchedule?.length&&(g[R][W]=g[R][W]?.filter(J=>{let ie=J.attempts<G;return ie&&X.scheduleTimes.push(J),!ie})),(!X.scheduleTimes?.length||!X.matchUpsToSchedule?.length)&&(X.complete=!0)}z+=1,Q=M.every(({venueId:W})=>_[W].complete)||z===j}for(let{venueId:W}of M){let Y=_[W].matchUpMap;Object.keys(Y).forEach(X=>{let J=c[X];J&&Object.keys(Y[X]).forEach(ie=>{let{drawDefinition:ue}=lv({tournamentRecord:J,drawId:ie});ue&&Y[X][ie].forEach(({matchUpId:ne})=>{let ge=I[ne];if(ge){let he=ge.split(":").map(ru).join(":"),Ie=`${Ui(R)}T${he}`;m?w[R].push(ne):(cv({drawDefinition:ue,scheduledTime:Ie,matchUpId:ne}).success&&w[R].push(ne),W&&FE({tournamentRecord:J,drawDefinition:ue,matchUpId:ne,venueId:W}))}})})}),T[R]=_[W].matchUpsToSchedule.map(_a),A[R][W]=_[W].scheduleTimes.sort((X,J)=>sr(X.scheduleTime)-sr(J.scheduleTime))}!m&&F?.length&&gN({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let W of P.venues)for(let Y of W.rounds){let X=(Y.matchUps?.map(({matchUpId:ie})=>ie)||[]).filter(ie=>w[R].includes(ie));Y.canScheduledMatchUpIds=X;let J=Math.round(X.length/Y.matchUpsCount*1e4)/100;(J===1/0||isNaN(J))&&(J=0),Y.possibleToSchedulePct=J,Y.matchUpsCount===X.length&&(Y.possibleToSchedule=!0)}}let C=n.map(({scheduleDate:P})=>P),E={timeStamp:Date.now(),overLimitMatchUpIds:S,scheduledMatchUpIds:w,schedulingProfile:u,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:C};return tPe({tournamentRecords:c,autoSchedulingAudit:E}),{...oe,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:A,dateSchedulingProfiles:n,skippedScheduleTimes:g,recoveryTimeDeferredMatchUpIds:v,dependencyDeferredMatchUpIds:b,matchUpScheduleTimes:I,overLimitMatchUpIds:S,scheduledMatchUpIds:w,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:C}}function Kie({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Yt,stack:"getEarliestCourtTime"};let a=nC({scheduleDate:n,courts:[r],startTime:!0}),s=nC({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||s;let o=Pg({court:r,date:n}),{timeSlots:l}=_E({courtDate:o}),c=Jn(e),u=Jn(i);return{earliestCourtTime:l?.reduce((d,p)=>{let f=Jn(p.startTime),h=Jn(p.endTime);if(f>u||h<c)return d;let m=c>f?c:f;if(fM(m,h)>=t){let A=Kr(m.toISOString());A&&(!d||A<d)&&(d=A)}return d},void 0),courtStartTime:a,courtEndTime:s}}function crt({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:c,periodLength:u=30,schedulingProfile:d,personRequests:p,matchUps:f=[],courts:h,dryRun:m}){let A={},g={},v={},b={},y={},I={},w={},S={},T={};for(let E of n??[]){let P=Ui(E?.scheduleDate),R=E?.venues||[],M={},N={},k=(ue,ne)=>{ue.forEach(ge=>{let he=N[ge].counters;he[ne]?he[ne]+=1:he[ne]=1,he[dd]?he[dd]+=1:he[dd]=1})};A[P]={},g[P]={},I[P]=[],w[P]=[],S[P]=[],T[P]=[];let O={};f?.forEach(ue=>{ue.schedule?.scheduledDate&&Eh(P,Ui(ue.schedule.scheduledDate))&&rC({matchUpPotentialParticipantIds:M,matchUpNotBeforeTimes:O,matchUp:ue})});let{allDateScheduledByeMatchUpDetails:x,allDateScheduledMatchUpIds:F,venueScheduledRoundDetails:_,allDateMatchUpIds:V}=ePe({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:O,matchUpScheduleTimes:y,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:c,periodLength:u,scheduleDate:P,matchUps:f,courts:h,venues:R}),G=f?.filter(({matchUpId:ue})=>F.includes(ue)),{bookings:z}=pH({dateScheduledMatchUps:G,tournamentRecords:c,scheduleDate:P,periodLength:u}),{virtualCourts:Q}=nH({scheduleDate:P,periodLength:u,bookings:z,courts:h}),j=Q?.reduce((ue,ne)=>{let{earliestCourtTime:ge,courtEndTime:he}=Kie({date:P,averageMinutes:0,court:ne});return(!ue.startTime||Jn(ge)<Jn(ue.startTime))&&(ue.startTime=ge),(!ue.endTime||Jn(he)>Jn(ue.endTime))&&(ue.endTime=he),ue},{}),W=j.startTime,Y=({courtId:ue,booking:ne})=>Q?.find(ge=>ge.courtId===ue)?.dateAvailability[0].bookings.push(ne),X=10,J=0,ie;for(;!ie;){for(let{venueId:ue}of R){let ne=_[ue],ge=ne.matchUpsToSchedule.length,he=[],Ie=[],xe,Je=0;for(;!xe;){for(let qe of ne.matchUpsToSchedule){if(Ie.length===ne.courtsCount||he.length===ne.courtsCount){xe=!0;break}let{matchUpId:dt,matchUpType:ft}=qe,{participantIdsAtLimit:je,relevantParticipantIds:Tt}=SX({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,matchUpDailyLimits:o,matchUp:qe});if(je.length){w[P].includes(dt)||w[P].push(dt);continue}let{dependenciesScheduled:Oe,remainingDependencies:mt}=bX({matchUpScheduleTimes:y,matchUpDependencies:s,allDateMatchUpIds:V,matchUp:qe});if(!Oe){g[P][dt]||(g[P][dt]=[]),g[P][dt].push({remainingDependencies:mt});continue}let Le=[],lt=Q?.reduce((it,Fe)=>{if(Ie.includes(Fe.courtId))return it;let{earliestCourtTime:Xe}=Kie({averageMinutes:ne.greatestAverageMinutes,startTime:W,date:P,court:Fe});if(it.scheduleTime&&sr(Xe)>=sr(it.scheduleTime))return it;let{scheduledDependent:ct}=J0e({matchUpScheduleTimes:y,matchUpDependencies:s,scheduleTime:Xe,matchUpId:dt,details:ne});if(ct)return it;let{enoughTime:We}=wX({individualParticipantProfiles:N,matchUpNotBeforeTimes:O,matchUpDependencies:s,scheduleTime:Xe,details:ne,matchUp:qe});if(!We)return A[P][dt]||(A[P][dt]=[]),A[P][dt].includes(Xe)||A[P][dt].push(Xe),it;let ht=ne.minutesMap?.[dt]?.averageMinutes||ne.greatestAverageMinutes,{conflicts:xt}=IX({potentials:e,averageMatchUpMinutes:ht,requestConflicts:T,personRequests:p,scheduleTime:Xe,scheduleDate:P,matchUp:qe});if(xt?.length)return Le.push(...xt),!1;k(Tt,ft);let pe=ne.minutesMap?.[dt]?.recoveryMinutes;return a1({matchUpPotentialParticipantIds:M,individualParticipantProfiles:N,matchUpNotBeforeTimes:O,averageMatchUpMinutes:ht,matchUpDependencies:s,recoveryMinutes:pe,scheduleTime:Xe,matchUp:qe}),(!it.scheduleTime||sr(Xe)<sr(it.scheduleTime))&&(it.averageMatchUpMinutes=ht,it.recoveryMinutes=pe,it.scheduleTime=Xe,it.courtName=Fe.courtName,it.courtId=Fe.courtId),it},{});if(lt.scheduleTime){let{averageMatchUpMinutes:it,recoveryMinutes:Fe,scheduleTime:Xe,courtId:ct}=lt;y[dt]=Xe,b[dt]=ct,he.push(dt),Ie.push(ct);let We=Xe,ht=gl(We,it);Y({courtId:ct,booking:{averageMatchUpMinutes:it,recoveryMinutes:Fe,periodLength:u,matchUpId:dt,startTime:We,courtId:ct,endTime:ht,venueId:ue}}),ne.matchUpsToSchedule=ne.matchUpsToSchedule.filter(xt=>xt.matchUpId!==dt)}else Le?.length&&(v[P]||(v[P]=[]),v[P].push(...Le))}(Ie.length===ne.courtsCount||he.length===ne.courtsCount||!ne.matchUpsToSchedule.length)&&(xe=!0),ne.matchUpsToSchedule.length&&he<ne.courtsCount&&(Jn(W)<Jn(j.endTime)?W=gl(W,u):(xe=!0,ne.complete=!0)),Je+=1,!xe&&Je>=ge&&(xe=!0)}ne.matchUpsToSchedule?.length||(ne.complete=!0)}J+=1,ie=R.every(({venueId:ue})=>_[ue].complete)||J===X}for(let{venueId:ue}of R){let ne=_[ue].matchUpMap;Object.keys(ne).forEach(ge=>{let he=c[ge];he&&Object.keys(ne[ge]).forEach(Ie=>{let{drawDefinition:xe}=lv({tournamentRecord:he,drawId:Ie});xe&&ne[ge][Ie].forEach(({matchUpId:Je})=>{let qe=y[Je],dt=b[Je];if(qe){let ft=qe.split(":").map(ru).join(":"),je=`${Ui(P)}T${ft}`;m||(cv({drawDefinition:xe,scheduledTime:je,matchUpId:Je}),CS({courtDayDate:P,tournamentRecords:c,tournamentRecord:he,drawDefinition:xe,matchUpId:Je,courtId:dt})),I[P].push(Je)}})})}),S[P]=_[ue].matchUpsToSchedule.map(_a)}!m&&x?.length&&gN({matchUpDetails:x,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let ue of E.venues)for(let ne of ue.rounds){let ge=(ne.matchUps??[]).map(({matchUpId:Ie})=>Ie)?.filter(Ie=>I[P].includes(Ie));ne.canScheduledMatchUpIds=ge;let he=Math.round((ge?.length||0)/ne.matchUpsCount*1e4)/100;(he===1/0||isNaN(he))&&(he=void 0),ne.possibleToSchedulePct=he,ne.matchUpsCount===ge?.length&&(ne.possibleToSchedule=!0)}}let D=(n??[]).map(({scheduleDate:E})=>E),C={timeStamp:Date.now(),overLimitMatchUpIds:w,scheduledMatchUpIds:I,schedulingProfile:d,noTimeMatchUpIds:S,requestConflicts:T,scheduledDates:D};return tPe({tournamentRecords:c,autoSchedulingAudit:C}),{...oe,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:A,dependencyDeferredMatchUpIds:g,matchUpScheduleTimes:y,overLimitMatchUpIds:w,scheduledMatchUpIds:I,noTimeMatchUpIds:S,requestConflicts:T,scheduledDates:D}}function fH(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=ta,scheduledDates:r,venueIds:n}=t,a=Cu(t),s=Xi(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!s?.length)return{error:bn};let o=0;for(let l of s){let c=a[l],u=urt({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:c,scheduledDates:r,venueIds:n});if(u.error)return u;o+=u.clearedScheduleCount??0}return{...oe,clearedScheduleCount:o}}function urt({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=ta,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:nt};if(!Array.isArray(e)||!Array.isArray(n))return{error:we};n.length&&t.push("venueId");let a=as({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],s={};a.forEach(({matchUpStatus:c,schedule:u,drawId:d,matchUpId:p})=>{(!c||!e.includes(c))&&uN({schedule:u,scheduleAttributes:t})&&(!n?.length||n.includes(u.venueId))&&(s[d]||(s[d]=[]),s[d].push(p))});let o=i.tournamentId,l=0;for(let c in s){let{event:u,drawDefinition:d}=tl({tournamentRecord:i,drawId:c}),p=No({drawDefinition:d,matchUpFilters:{matchUpIds:s[c]}}).matchUps??[];for(let f of p){let h=!1;f.timeItems=(f.timeItems??[]).filter(m=>{let A=m?.itemType&&![xh,Eg,dS,a$,pS,fS].includes(m?.itemType);return A||(h=!0),A}),h&&(Zi({context:"clear schedules",eventId:u?.eventId,drawDefinition:d,tournamentId:o,matchUp:f}),l+=1)}}return{...oe,clearedScheduleCount:l}}function hH(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:s,useGarman:o,dryRun:l,pro:c}=t,u=Qt(t,[{[Js]:!0},{[Ps]:D=>!D||Array.isArray(D)&&D.every(Ro),[fUe]:!1,[rl]:qs}]);if(u.error)return u;let d=SA({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...oe};let{modifications:p,issues:f=[],schedulingProfile:h=[]}=d,m=Object.assign({},...Object.values(a).map(D=>IE({tournamentRecord:D}).containedStructures)),A=n.map(D=>{if(Ro(D))return Ui(D)}).filter(Boolean),g=h.map(D=>D.scheduleDate).map(D=>Ro(D)&&Ui(D)).filter(D=>D&&(!n.length||A.includes(D)));if(!g.length)return{error:gwe};if(r&&!l){let D=Array.isArray(r)?r:[];fH({tournamentRecords:a,scheduledDates:D})}let v=wA({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:b}=up({matchUpFilters:{matchUpTypes:[Dr,br]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:y}=Bd({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:b}),{matchUpDailyLimits:I}=Z$({tournamentRecords:a}),{personRequests:w}=Pb({requestType:AN,tournamentRecords:a}),S=h.filter(D=>{let C=Ui(D?.scheduleDate);return g.includes(C)}).sort((D,C)=>new Date(D.scheduleDate).getTime()-new Date(C.scheduleDate).getTime()),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:f,dateSchedulingProfiles:S,containedStructureIds:m,matchUpDependencies:y,matchUpDailyLimits:I,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:h,personRequests:w,periodLength:s,matchUps:b,dryRun:l,courts:v};return c?crt(T):lrt(T)}function mH(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:r,...n}=t||{};return n.tournamentId||(n.tournamentId=hr()),n.startDate&&!ky(n.startDate)&&!U_.test(n.startDate)?{error:ma}:n.endDate&&!ky(n.endDate)&&!U_.test(n.endDate)?{error:ma}:(n.extensions&&(n.extensions=n.extensions.filter(gf)),{...n})}function UX({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:s}){if(!i)return{error:nt};let o={},l=(i.participants??[]).filter(({participantType:h,participantRole:m})=>h===Wi&&m===xs),c=0;for(let h of l){let m=a&&ly({element:h,accessor:a})?.value||r&&h.person?.[r]||e&&h[e];if(m){if(!Object.keys(o).includes(m)){o[m]={participantName:n?.[c]??m,participantId:s?.pop()??hr(),individualParticipantIds:[],participantRole:xs,participantType:vr};let A={value:r??e,name:x4};ur({element:o[m],extension:A}),c+=1}o[m].individualParticipantIds.push(h.participantId)}}let u=Object.keys(o),d=(i.participants??[]).map(h=>{if(h.participantType!==vr||h.participantRole!==xs)return;let{extension:m}=ki({name:x4,element:h}),A=m?.value;if(u.includes(A))return h.participantId}).filter(Boolean),p=0,f=[];return Object.keys(o).forEach(h=>{let m=o[h],{participantId:A}=m;d.includes(A)||(i.participants||(i.participants=[]),t&&i.participants.push(m),f.push(m),p++)}),t&&p?(Ii({payload:{tournamentId:i.tournamentId,participants:f},topic:Ug}),{...oe,participantsAdded:p}):f.length?{...oe,newParticipants:f}:{error:O6e}}var drt=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],prt=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function iPe({count:t=1,participantsCount:e=32}={}){let i=Po(prt),r=i.slice(0,t);return{cities:vt(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Zu(r))}}function rPe({count:t=1,participantsCount:e=32}={}){let i=Po(drt),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:vt(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Zu(r))}}function nPe({count:t=1,participantsCount:e=32}={}){let i=vt(0,t).map(()=>vt(0,5).map(()=>Jc(0,9)).join(""));return{postalCodes:vt(0,e).map(r=>r<t?i[r]:Zu(i))}}function W_({idPrefix:t,participantType:e,index:i,uuids:r}){let n=rn(e)?e[0]:"X";return t?`${t}-${n}-${i}`:r?.pop()||hr()}function aPe(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r?.[a],state:i?.[a],city:e?.[a],countryCode:n}}var frt={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood","Zecic"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Miro","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function aG(t){let{count:e=100,sex:i}=t||{};if(!e||i&&!ff(i))return{personData:[],error:we};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:s}=frt,o=og.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(r/n.length),c=Math.ceil(r/a.length),u=Math.ceil(r/s.length),d=vt(0,l).flatMap(()=>{let m=Dt(n,!1,!0);return vt(0,n.length).map(()=>_l(m))}),p=vt(0,c).flatMap(()=>{let m=Dt(a,!1,!0);return vt(0,a.length).map(()=>_l(m))}),f=vt(0,u).flatMap(()=>{let m=Dt(s,!1,!0);return vt(0,s.length).map(()=>_l(m))}),h={};for(let m=0;m<r;m++){let A=d.pop(),g=i||Zu([oa,Ds]),v=g===oa?f.pop():p.pop(),b=Zu(o);h[`${v}${A}`]={nationalityCode:b,sex:g,firstName:v,lastName:A}}return{personData:Object.values(h).slice(0,e)}}function sPe(t){let e=t?.count||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:s,category:o,sex:l}=t||{};if(Number.isNaN(Number(e)))return{error:we};let c=a?.[oa]||uI(l)&&e||0,u=a?.[Ds]||Qv(l)&&e||0;e=Math.max(e,c+u);let d=e-(c+u),p=c&&aG({count:c,sex:oa}).personData||[],f=u&&aG({count:u,sex:Ds}).personData||[],h=[...p,...f,...d&&aG({count:d}).personData||[]],m=h.filter(T=>!l||c&&u||T.sex===l),A=[];if(Array.isArray(s)){let T=s.filter(D=>typeof D.firstName!="string"||typeof D.lastName!="string"||D.sex&&![oa,Ds].includes(D.sex)||D.nationalityCode&&(typeof D.nationalityCode!="string"||D.nationalityCode.length>3||!og.some(({iso:C,ioc:E})=>[C,E].includes(D.nationalityCode)))?!1:(D.nationalityCode&&A.push(D.nationalityCode),!0));if(T.length)m=T;else return{error:we}}let g=s?m:Po(m);if(g.length<e){let{maleFirstNames:T,maleLastNames:D,femaleFirstNames:C,femaleLastNames:E,nationalityCodes:P}=h.reduce((R,M)=>{let{firstName:N,lastName:k,nationalityCode:O}=M;return M.sex===oa?(R.maleFirstNames.includes(N)||R.maleFirstNames.push(N),R.maleLastNames.includes(k)||R.maleLastNames.push(k)):(R.femaleFirstNames.includes(N)||R.femaleFirstNames.push(N),R.femaleLastNames.includes(k)||R.femaleLastNames.push(k)),R.nationalityCodes.includes(O)||R.nationalityCodes.push(O),R},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});vt(0,e-g.length).forEach(()=>{let R=l||Zu([oa,Ds]),M=Zu(P),N=Zu(R===oa?T:C),k=Zu(R===oa?D:E),O={firstName:N,lastName:k,sex:R,nationalityCode:M};g.push(O)})}let{ageMinDate:v,ageMaxDate:b}=xy({consideredDate:r,category:o}),y=ci(v?.slice(0,4)||0)||ci(b?.slice(0,4)||0)-3,I=ci(b?.slice(0,4)||0)||ci(v?.slice(0,4)||0)+3,w=(v||b)&&[y,I],S=g.slice(0,e).map((T,D)=>{let[C,E]=w||[],P=w&&_l(vt(C,E)),R=_l(vt(0,365)),M=P&&O8e(P,R);return Object.assign(Lt({extensions:i||[{name:"regionCode",value:D+1}],birthDate:M,isMock:n}),T)});return{persons:S.length&&S||g[0],nationalityCodes:A}}var hrt=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function K_({nameRoot:t="TEAM",count:e=1}={}){let i=Po(hrt).slice(0,e);return i.length<e&&vt(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function LE(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=qa,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:s,categories:o,category:l,nationalityCodesCount:c,nationalityCodeType:u,nationalityCodes:d,participantsCount:p=32,participantType:f,teamSize:h=8,personIds:m,idPrefix:A,uuids:g,personExtensions:v,addressProps:b,gendersCount:y,matchUpType:I,personData:w,sex:S,inContext:T,withISO2:D,withIOC:C,scaleAllParticipants:E}=t,P=f===Ni||I===By,R=f===vr||I===vr;i&&(!Array.isArray(i)||!i.every(Oe=>Un(Oe))||i.length!==2)&&(i=void 0),e=E?p:e;let M=1e3,N=e&&e>M?e:M;i=i||[1,N],i[1]+=1;let k=p*(P&&2||R&&(h??8)||1),O=sPe({count:k,personExtensions:v,consideredDate:s,gendersCount:y,personData:w,category:l,sex:S});if(O.error)return O;let{nationalityCodes:x,persons:F}=O,_={},V={},G={},z={},Q=Oe=>{Object.assign(_,Oe.doublesRankings),Object.assign(V,Oe.singlesRankings),Object.assign(z,Oe.doublesRatings),Object.assign(G,Oe.singlesRatings)};if(Xi(l)){let Oe=Yie({scaledParticipantsCount:e,ratingsParameters:r,participantType:f,ratingsValues:a,rankingRange:i,category:l});Q(Oe)}Array.isArray(o)&&o.forEach(Oe=>{let mt=Yie({scaledParticipantsCount:e,ratingsParameters:r,participantType:f,ratingsValues:a,rankingRange:i,category:Oe});Q(mt)});let j=og.filter(Oe=>u==="IOC"&&Oe.ioc||Oe.iso);function W(Oe){let mt=Math.ceil(k/Oe);return n&&mt>n?Math.ceil(k/n):Oe}let{postalCodesProfile:Y,postalCodesCount:X,statesProfile:J,citiesProfile:ie,citiesCount:ue,statesCount:ne}=b||{},ge=Oe=>Object.keys(Oe).map(mt=>vt(0,J[mt]).map(()=>mt)).flat(),he=ie&&ge(ie)||b?.cities||iPe({count:ue||k,participantsCount:k}).cities,Ie=J&&ge(J)||b?.states||rPe({count:ne||k,participantsCount:k}).states,xe=Y&&ge(Y)||b?.postalCodes||nPe({count:X||k,participantsCount:k}).postalCodes,Je={cities:he,states:Ie,postalCodes:xe},qe=W(c),dt=qe?Po(j).slice(0,c):d&&j.filter(Oe=>d.includes(Oe.iso))||j,ft=Po(vt(0,Math.ceil(k/(qe||1))).map(()=>dt).flat(1/0)),je=K_({count:p}).names;return{participants:vt(0,p).map(Oe=>{let mt=P&&2||R&&(h??8)||1,Le=vt(0,mt).map(ct=>{let We=Oe*mt+ct;return Tt(We)}),lt=Le.map(ct=>ct.participantId),it=Le.map(ct=>ct.person.standardFamilyName).join("/"),Fe=P?Ni:vr,Xe={participantId:W_({participantType:Fe,index:Oe,idPrefix:A,uuids:g}),participantName:P?it:je[Oe],participantRole:xs,individualParticipantIds:lt,participantType:Fe};return T&&(Xe.individualParticipants=Le),P||R?[Xe,...Le]:Le}).flat(),...oe};function Tt(Oe){let mt=F[Oe],{nationalityCode:Le,participantExtensions:lt,participantTimeItems:it,extensions:Fe,firstName:Xe,birthDate:ct,lastName:We,personId:ht,sex:xt}=mt||{},pe=Xe||"GivenName",Se=We||"FamilyName",ye=`${pe} ${Se}`,ke=ft[Oe],Ce=x?.length&&Le||ke&&(u==="IOC"?ke.ioc||ke.iso:ke.iso||ke.ioc)||Le;ft?.length&&!Ce&&!Le&&console.log("%c Invalid Nationality Code",{participantIndex:Oe,country:ke});let Ke=aPe({...Je,participantIndex:Oe,nationalityCode:Ce}),_e=Lt({participantId:W_({participantType:Wi,index:Oe,idPrefix:A,uuids:g}),extensions:lt,timeItems:it,participantRole:xs,participantType:Wi,participantName:ye,person:{personId:ht||m?.length&&m[Oe]||hr(),birthDate:Ro(ct)?ct:void 0,addresses:[Ke],standardFamilyName:Se,standardGivenName:pe,nationalityCode:Ce,extensions:Fe,sex:xt}});if(C&&Ce){let ut=og.find(({iso:Ct})=>Ct===Ce);ut?.ioc&&(_e.person.iocNationalityCode=ut.ioc),ut?.label&&(_e.person.countryName=ut.label)}if(D&&Ce){let ut=og.find(({iso:Ct})=>Ct===Ce);ut?.iso2&&(_e.person.iso2NationalityCode=ut.iso2),ut?.label&&(_e.person.countryName=ut.label)}let wt=ut=>{let Ct=ut.categoryName||ut.ratingType||ut.ageCategoryCode,Gi=V[Ct]?.[Oe],Wt=_[Ct]?.[Oe];dB({scaleValue:Gi,eventType:iw,scaleType:wg,participant:_e,category:ut}),dB({scaleValue:Wt,eventType:jm,scaleType:wg,participant:_e,category:ut});let Ji=G[Ct]?.[Oe],$i=z[Ct]?.[Oe];dB({scaleValue:Ji,eventType:iw,scaleType:sg,participant:_e,category:ut}),dB({scaleValue:$i,eventType:jm,scaleType:sg,participant:_e,category:ut})};return Array.isArray(o)?o.forEach(ut=>wt(ut)):l&&wt(l),_e}}function dB({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,s=[Ly,r,i,a].join("."),o={itemValue:t,itemType:s};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(o))}function Yie(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,s=e.rankingRange||t.rankingRange||[1,1e3],o={},l={},c={},u={},{categoryName:d,ageCategoryCode:p,ratingType:f}=e,h=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!f){let[m,A]=s||[];if(l[h]=Po(vt(m,A)).slice(0,i||Jc(20,30)),[Ni,vr].includes(n)){let[g,v]=s||[];o[h]=Po(vt(g,v)).slice(0,i||Jc(20,30))}}if(f&&r[f]){let{ratingMax:m,ratingMin:A,ratingAttributes:g}=e,v={...r[f],...g||{}},{attributes:b={},decimalsCount:y,accessors:I,range:w,step:S}=v,T=R=>{let M={},N=Object.keys(R||{});for(let k of N){let O=R[k];if(typeof O=="object"&&O.generator){let{range:x}=O,[F,_]=x.slice().sort();M[k]=Jc(F,_)}else M[k]=O}return M},D=w[0]>w[1]?2:.7,[C,E]=w.slice().sort(),P=vt(0,2e3).map(()=>xIe(C,E,D,S,y)).filter(R=>(!m||R<=m)&&(!A||R>=A)).slice(0,i||Jc(20,30)).map(R=>I?Object.assign({},...I.map(M=>({[M]:R})),T(b)):R);c[h]=[...a,...P],[Ni,vr].includes(n)&&(u[h]=[...a,...P])}return{singlesRankings:l,doublesRankings:o,singlesRatings:c,doublesRatings:u}}function TX(t){let{alternatesCount:e=0,tieFormatName:i,drawSize:r}=t,n=0,a=0,s=0,o=0,l={},c={[oa]:0,[Ds]:0,[aS]:0,[Am]:0,ANY:0};(Xi(t.tieFormat)?t.tieFormat:Qm({namedFormat:i}))?.collectionDefinitions?.filter(Boolean).forEach(f=>{let{category:h,collectionId:m,matchUpType:A,matchUpCount:g,gender:v}=f;if(ff(v)){let b=Ks(v),y=g*(A===br?2:1);b&&c[b]<y&&(c[b]=y)}else Tc(v)&&(c[oa]<g&&(c[oa]=g),c[Ds]<g&&(c[Ds]=g));if(h){let b=JSON.stringify(h);l[b]=h}if(m||(f.collectionId=hr()),Vn(br)(A)){let b=g;o+=g,n=Math.max(n,b)}if(Vn(Dr)(A)){let b=g;s+=g,a=Math.max(a,b)}});let u=Object.keys(l).length?Math.max(s,o*2):Math.max(a,n*2),d=n*(r+e),p=a*(r+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:u,genders:c}}function mrt({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=Wi}=t||{},a=r||0,s={[Ds]:0,[aS]:0,[Am]:0,[oa]:0,ANY:0},o=0,l=0,c=0,u=0,d=0,p=({alternatesCount:h=0,uniqueParticipants:m,tieFormatName:A,drawSize:g=0,eventType:v,tieFormat:b,category:y,gender:I,stage:w})=>{let S=v===hu,T=v===da,D=!!(m||w===qt||y||I);if(T){u=Math.max(u,g+h),b=typeof b=="object"?b:Qm({namedFormat:A});let{teamSize:C,maxDoublesDraw:E,maxSinglesDraw:P,genders:R}=TX({alternatesCount:h,tieFormatName:A,tieFormat:b,drawSize:g});c=Math.max(c,C),l=Math.max(l,P),D||(o=Math.max(o,E)),Object.keys(R).forEach(M=>s[M]+=R[M])}else if(S)if(D){let C=(g+h)*2;d+=C,I&&(s[I]+=C)}else g+h&&g+h>o&&(o=g+h);else if(D){let C=g+h;I&&(s[I]+=C),d+=C}else g&&g>l&&(l=g+h)};if(e?.forEach(h=>{let{tieFormatName:m,tieFormat:A,drawProfiles:g,eventType:v,category:b,gender:y}=h;if(g)for(let I of g){let{tieFormatName:w,tieFormat:S}=I;p({...I,tieFormatName:w||m,tieFormat:S||A,eventType:v,category:b,gender:y})}}),Array.isArray(i))for(let h of i)p(h);let f=Math.max(u*c,o*2,l);return o&&(n=Ni),(r||a)<f&&(r=f),r&&o&&[Ni,da].includes(n)&&(l&&Math.floor(l/2)>o?r=Math.floor(l/2):(!l||o*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!e?.length&&!i?.length?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:u,largestTeamSize:c,participantType:n,gendersCount:s}}function oPe({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if(t?.participantsCount===0)return{addedCount:0,...oe};let{participantsCount:s,participantType:o,largestTeamDraw:l,largestTeamSize:c,gendersCount:u}=mrt({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t?.teamKey,p=LE({consideredDate:n,...t,participantsCount:s,participantType:o,gendersCount:u,uuids:a}).participants,f=0,h=Ed({tournamentRecord:e,participants:p});if(h.error)return h;if(f+=h.addedCount,d){let v=UX({tournamentRecord:e,...d});if(v.error)return v}let m=p.filter(({participantType:v})=>v===Wi).map(qi),A=t?.idPrefix?`${vr}-${t.idPrefix}`:void 0,g=vt(0,l).map(v=>{let b=m.slice(v*c,(v+1)*c),y=W_({index:v,participantType:o,idPrefix:A,uuids:a});return{participantName:`Team ${v+1}`,participantRole:xs,individualParticipantIds:b,participantType:vr,participantId:y}});return h=Ed({participants:g,tournamentRecord:e}),h.error?h:(f+=h.addedCount,{addedCount:f,...oe})}function lPe({drawProfiles:t,category:e,gender:i}){let r={},n=t?.reduce((s,o)=>{let{qualifyingPositions:l=0,participantsCount:c=0,uniqueParticipants:u,stage:d=Et,drawSize:p=0}=o||{};Object.keys(s).includes(d)||(s[d]=0);let f=(c||p)-l;return u||i||e||d===qt?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=f):s[d]=Math.max(s[d],f),s},{}),a=Object.keys(r);return a.forEach(s=>n[s]+=r[s]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function cPe({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[Et]||0,a=e[qt]||0;return{stageParticipants:{QUALIFYING:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(0,a),MAIN:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(a,a+n)}}}var Art={[Zr]:2,[An]:1,[Aa]:1,[Ha]:1,[Nr]:4};function CX(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=Art,matchUpFormat:n=ld,pointsPerMinute:a=1,sideWeight:s=4}=t;if(!Zl({matchUpFormat:n}))return{error:R8};if(typeof r!="object")return{error:we};if(e>100&&(e=100),Number.isNaN(Number(e))||Number.isNaN(Number(a))||Number.isNaN(Number(s)))return{error:we};let o=Object.keys(r).filter(C=>Object.keys(jh).includes(C)&&C!==Hn);if(Object.keys(o).reduce((C,E)=>C+r[E],0)>100)return{error:we,matchUpStatusProfile:r};let l=o.reduce((C,E)=>(C.pointer=C.pointer+r[E],C.valueMap.push([C.pointer,E]),C),{pointer:0,valueMap:[]}),c=Jc(1,100),u=(l.valueMap.find(C=>c<=C[0])??[100,Hn])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if(ks(u)){i=i||Jc(1,2);let C={score:d,matchUpStatus:u,winningSide:i};if(!(u===Nr&&Jc(1,100)>100-e))return{outcome:C}}else if([An,Aa].includes(u))return{outcome:{score:d,matchUpStatus:u}};let p=ys(n),{bestOf:f=1,exactly:h,setFormat:m,finalSetFormat:A}=p??{},g=[],v=Jc(0,1),b=i?[i-1]:[...vt(0,s).map(()=>v),1-v],y=[Ha,Nr,ic,rv].includes(u)&&(_l(vt(1,h||f))||1),I,w=vt(1,(h??f)+1);for(let C of w){let E=C===(h??f),{set:P,incomplete:R,winningSideNumber:M}=grt({setFormat:E&&A||m,incomplete:y===C,pointsPerMinute:a,matchUpStatus:u,weightedRange:b,setNumber:C});if(g.push(P),R){I=M;break}if(n1({matchUp:{score:{sets:g},matchUpFormat:n}}).calculatedWinningSide)break}let S=n1({matchUp:{score:{sets:g},matchUpFormat:n,winningSide:i}}),T=I?i||I:S.calculatedWinningSide,{score:D}=z0e({winningSide:T,score:{sets:g},matchUpStatus:u});return{outcome:{winningSide:T,matchUpStatus:u,score:D}}}function grt({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let s={setNumber:a},{setTo:o,tiebreakFormat:l,tiebreakAt:c,tiebreakSet:u,timed:d,minutes:p}=n,f=Jc(0,t.length-1),h=t[f],m;if(d){let A=p*e,g=Math.round(A*.2),v=A+_l([1,-1])*g,b=p6e(v,2),y=[b,v-b];h&&y.reverse(),m=t[f]+1;let I=y[0]>y[1]&&1||y[1]>y[0]&&2||0;if(r){let[T,D]=y;return Object.assign(s,{side1Score:T,side2Score:D}),ta.includes(i)?{set:s,incomplete:r,winningSideNumber:m}:{set:s,incomplete:r}}I||(y[Jc(0,1)]+=1),I=y[0]>y[1]?1:2,I!==m&&y.reverse();let[w,S]=y;return Object.assign(s,{side1Score:w,side2Score:S,winningSide:m}),{set:s}}else{if(r)return s.side1Score=Jc(0,c),s.side2Score=Jc(0,c),ta.includes(i)&&(m=t[f]+1),{set:s,incomplete:r,winningSideNumber:m};{let A=vt(1,o+1).flatMap(S=>vt(0,o+2-S).map(()=>S)),g=A[Jc(0,A.length-1)],v=o&&p9({isSide1:!0,tiebreakAt:c,lowValue:g,setTo:o}),b=!v,y=t.length===1&&t[f]+1;if(!b){y?(v[0]>v[1]?1:2)!==y&&v.reverse():h&&v.reverse();let[S,T]=v;Object.assign(s,{side1Score:S,side2Score:T})}let I=i1({matchUpScoringFormat:{setFormat:n},setObject:s}),w;if(I.hasTiebreakCondition||b){let{NoAD:S,tiebreakTo:T}=l||u||{},D=vt(1,T+1).flatMap(P=>vt(0,T+2-P).map(()=>P)),C=D[Jc(0,D.length-1)],E=x$({isSide1:!0,tiebreakNoAd:S,tiebreakTo:T,lowValue:C});if(E)if(b){let P=E[0]>E[1]?1:2;y?P!==y&&E.reverse():h&&E.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=E,w=E[0]>E[1]&&1||E[1]>E[0]&&2||void 0}else I.leadingSide===2?[s.side1TiebreakScore,s.side2TiebreakScore]=E:[s.side2TiebreakScore,s.side1TiebreakScore]=E}s.winningSide=I.winningSide||I.leadingSide||y||w}}return{set:s}}function vrt({firstRoundDualMatchUps:t,event:e,tournamentRecord:i,drawDefinition:r}){let n=e?.category?.ageCategoryCode||e?.category?.categoryName;if(n){let d=S0e({singlesOnly:!0,tournamentRecord:i,drawDefinition:r,scaleAccessor:{scaleName:n,sortOrder:"ASC",scaleType:wg},event:e});if(d.error)return d;let{lineUps:p,participantsToAdd:f}=d;Ed({tournamentRecord:i,participants:f}),ur({element:r,extension:{name:qm,value:p}});return}let a=t[0]?.structureId,{positionAssignments:s}=wr({drawDefinition:r,structureId:a});if(!s?.length)return;let{participants:o}=vn({participantFilters:{participantTypes:[Hr]},tournamentRecord:i});function l(d){return o?.find(p=>{let{participantId:f}=p;return s.find(h=>h.participantId===f)?.drawPosition===d})}function c(d,p,f){d.sides.forEach(h=>{let{drawPosition:m}=h,A=l(m);if(A){let g=A.individualParticipantIds?.[p];g&&q_({teamParticipantId:A.participantId,participantId:g,tournamentRecord:i,drawDefinition:r,tieMatchUpId:f,event:e});return}})}function u(d,p,f){d.sides.forEach(h=>{let{drawPosition:m}=h,A=l(m);A&&A.individualParticipantIds?.slice(p*2,p*2+2)?.forEach(g=>{q_({teamParticipantId:A.participantId,participantId:g,tournamentRecord:i,drawDefinition:r,tieMatchUpId:f,event:e})})})}t.forEach(d=>{let p=d.tieMatchUps.filter(Vn(Dr)),f=d.tieMatchUps.filter(Vn(br));p.forEach((h,m)=>{let A=h.matchUpId;c(h,m,A)}),f.forEach((h,m)=>{let A=h.matchUpId;u(h,m,A)})})}function yrt({structure:t,matchUpsMap:e,drawDefinition:i,tournamentRecord:r,event:n,matchUpStatusProfile:a,matchUpFormat:s,matchUpStatus:o,scoreString:l,randomWinningSide:c,completionGoal:u,completedCount:d}){let p=dr({contextFilters:{matchUpTypes:[br,Dr]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:i,matchUpsMap:e,structure:t,event:n}).matchUps.filter(({winningSide:f})=>!f).sort(AS).map(_a);for(let f of p){if(!Number.isNaN(Number(u))&&d.value>=u)break;let{matchUps:h}=dr({matchUpFilters:{matchUpTypes:[br,Dr]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:i,matchUpsMap:e,structure:t,event:n}),m=h.find(g=>g.matchUpId===f),A=[An,Aa].includes(m.matchUpStatus);if(m?.readyToScore&&!A){let g=brt({matchUpStatusProfile:a,tournamentRecord:r,drawDefinition:i,targetMatchUp:m,matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:!c&&1,event:n});if(g?.error)return g;d.value+=1}}}function Y_(t){let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:r,tournamentRecord:n,completionGoal:a,drawDefinition:s,event:o}=t;if(!s)return{error:kt};let l=t.matchUpFormat||s.matchUpFormat||o?.matchUpFormat,c=s.structures.slice().sort(cS),u={value:0},{matchUps:d,matchUpsMap:p}=ia({matchUpFilters:{matchUpTypes:[Hr],roundNumbers:[1]},contextFilters:{stages:[Et,qt]},inContext:!0,drawDefinition:s});if(d?.length){let g=vrt({firstRoundDualMatchUps:d,event:o,tournamentRecord:n,drawDefinition:s});if(g?.error)return g}let f=typeof i=="string"&&i,h=f&&Hn,m=c.length===2&&c[0].finishingPosition===Fy&&Mn(c.map(({stage:g})=>g),[Et,Dn]).length===2,A=c.map(({structureId:g})=>g);for(let g of A){if(u.value>=a)break;let v=s.structures.find(y=>y.structureId===g),b=yrt({structure:v,matchUpsMap:p,drawDefinition:s,tournamentRecord:n,event:o,matchUpStatusProfile:e,matchUpFormat:l,matchUpStatus:h,scoreString:f,randomWinningSide:r,completionGoal:a,completedCount:u});if(b?.error)return b;m&&v.finishingPosition===Fy&&t.completeRoundRobinPlayoffs&&DE({structureId:v.structureId,applyPositioning:!0,drawDefinition:s})}return{...oe,completedCount:u.value}}function uPe(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:s,matchUpFormat:o,scoreString:l,winningSide:c,event:u}=t;if(!a||a.matchUpStatus==="BYE")return;let{matchUpId:d}=a||{},{outcome:p}=yX({matchUpFormat:o,matchUpStatus:s,scoreString:l,winningSide:c});return e&&(p.matchUpStatusCodes=e),hN({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:u})}function brt(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:s,targetMatchUp:o,scoreString:l,winningSide:c,event:u}=t;if(l||a)return uPe(t);let{matchUpId:d}=o||{},{outcome:p}=CX({matchUpStatusProfile:e,matchUpFormat:s,winningSide:c});return hN({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:u})}function dPe({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:s}){let o=kn({event:s}).flightProfile,{eventName:l,eventType:c,category:u}=s,{startDate:d}=r,p=[],f=u?.categoryName||u?.ageCategoryCode||u?.ratingType,h=s.drawDefinitions?.map(({drawId:m})=>m);if(Array.isArray(o?.flights))for(let[m,A]of o.flights.entries()){let{drawId:g,stage:v,drawName:b,drawEntries:y}=A;p.push(A.drawId);let I=n[m],{seedsCount:w,generate:S=!0}=I||{};if(S){let T=y.filter(rc(Nh)).map(rc(Nh)),D=f||l;if(r&&w&&w<=T.length&&vt(1,w+1).forEach((M,N)=>{let k={scaleValue:M,scaleName:D,scaleType:sh,eventType:c,scaleDate:d},O=T[N];aN({tournamentRecord:r,participantId:O,scaleItem:k})}),h?.includes(g))break;let C=pN({...I,matchUpType:c,seedingScaleName:D,tournamentRecord:r,drawEntries:y,drawName:b,drawId:g,isMock:a,event:s,stage:v});if(C.error)return{error:C.error,drawIds:[]};let{drawDefinition:E}=C;if(!E)return{error:Rc};let P=n[m]?.drawExtensions;if(Array.isArray(P)&&P.filter(gf).forEach(M=>ur({element:E,extension:M})),C=fN({suppressNotifications:!0,tournamentRecord:r,drawDefinition:E,event:s}),C.error)return{error:C.error,drawIds:[]};if(I?.withPlayoffs){let M=E.structures?.[0].structureId,N=S$({idPrefix:I.idPrefix,...I.withPlayoffs,tournamentRecord:r,drawDefinition:E,structureId:M,isMock:a,event:s});if(N?.error)return N}let R=I?.completionGoal;if(I?.automated!==!1&&(e||R)){let M=I?.matchUpFormat,N=Y_({completeAllMatchUps:!R&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:R,drawDefinition:E,matchUpFormat:M,event:s});if(N.error)return{error:N.error,drawIds:[]};let k=N.completedCount;if(I?.drawType===Mh){let O=E.structures?.find(_=>_.stage===Et);if(!O)return{error:an};let x=DE({structureId:O.structureId,tournamentRecord:r,drawDefinition:E});if(x.error)return{error:x.error,drawIds:[]};let F=R?R-(k??0):void 0;if(x=Y_({completeAllMatchUps:!R&&e,completionGoal:R?F:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:E,matchUpFormat:M,event:s}),x.error)return{error:x.error,drawIds:[]}}}}}return{...oe,drawIds:p}}function pPe(t){let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:r,tournamentRecord:n,eventProfile:a,eventIndex:s,event:o,uuids:l}=t,{category:c,gender:u,eventType:d}=o,p=Vn(mf)(d)&&Wi||Vn(hu)(d)&&Ni||d,f=i[Et]||0,h=i[qt]||0,m=a.drawProfiles?.length?f+h:a.participantsProfile?.participantsCount??0,A=ff(u)?u:void 0,g=e?.idPrefix?`E-${s}-${e?.idPrefix}`:void 0,{participants:v}=LE({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n?.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:m,ratingsParameters:r,category:c,idPrefix:g,sex:A}),b=Ed({tournamentRecord:n,participants:v});if(b.error)return b;let y=v?.filter(({participantType:w})=>w===p),I=v?.map(qi);return{uniqueDrawParticipants:y,uniqueParticipantIds:I}}function Irt({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=Kp,qualifyingPositions:s=0,stage:o=Et,drawSize:l=0,drawName:c,drawId:u}=r,d=l-s,p=i.slice(0,d).map(qi);if(p.length){let m=Yp({participantIds:p,autoEntryPositions:t,entryStage:o,tournamentRecord:e,event:n});if(m.error)return m}let f=p.map(m=>({entryStatus:Sl,entryStage:o,participantId:m})),h=rH({drawName:c||a,qualifyingPositions:s,drawEntries:f,drawId:u,event:n,stage:o});return h.error?h:{...oe}}function fPe({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:s,event:o}){let l=0;for(let c of n){let{qualifyingPositions:u=0,uniqueParticipants:d,stage:p=Et,drawSize:f=0}=c,h=f-u,m=d||s||a||p===qt,A=m?t.slice(l,l+h):i[p||Et]||[];m&&(l+=h);let g=Irt({autoEntryPositions:e,drawParticipants:A,tournamentRecord:r,drawProfile:c,event:o});if(g.error)return g}return{...oe}}function hPe(t){let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,publish:p,isMock:f,uuids:h}=t,m=u.gender,A=u.eventName,{eventType:g=mf,policyDefinitions:v,drawProfiles:b=[],eventExtensions:y,surfaceCategory:I,tieFormatName:w,processCodes:S,discipline:T,eventLevel:D,timeItems:C,ballType:E,category:P}=u,R=u.eventId||hr(),M=u.tieFormat||(g===da?Qm({namedFormat:w,event:{eventId:R,category:P,gender:m},hydrateCollections:s,isMock:f}):void 0),N=c.participants;for(let J of b)!m&&J.gender&&(m=J?.gender);let{stageParticipantsCount:k,uniqueParticipantsCount:O,uniqueParticipantStages:x}=lPe({drawProfiles:b,category:P,gender:m}),F=Vn(mf)(g)&&Wi||Vn(hu)(g)&&Ni||g,{uniqueDrawParticipants:_=[],uniqueParticipantIds:V=[]}=x?pPe({event:{eventType:g,category:P,gender:m},uniqueParticipantsCount:O,participantsProfile:r,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,uuids:h}):{},{eventAttributes:G}=u;typeof G!="object"&&(G={});let z=P?.categoryName||P?.ageCategoryCode||P?.ratingType;A=A||z||"Generated Event";let Q={...G,surfaceCategory:I,processCodes:S,discipline:T,eventLevel:D,eventName:A,eventType:g,tieFormat:M,ballType:E,category:P,eventId:R,gender:m};if(y?.length&&Array.isArray(y)){let J=y.filter(gf);J?.length&&Object.assign(Q,{extensions:J})}if(Array.isArray(C)&&C.forEach(J=>wS({event:Y,timeItem:J})),typeof v=="object")for(let J of Object.keys(v))Qy({policyDefinitions:{[J]:v[J]},event:Q});Q.category&&(Q.category.categoryName=z);let j,W=BE({suppressNotifications:!1,internalUse:!0,tournamentRecord:c,event:Q});if(W.error)return W;let Y=W?.event,{stageParticipants:X}=cPe({allUniqueParticipantIds:e,stageParticipantsCount:k,eventParticipantType:F,targetParticipants:N});if(b?.length){let J=fPe({uniqueDrawParticipants:_,autoEntryPositions:a,stageParticipants:X,tournamentRecord:c,drawProfiles:b,category:P,gender:m,event:Y});if(J.error)return J;let ie=dPe({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:o,tournamentRecord:c,drawProfiles:b,isMock:f,event:Y});if(ie.error)return ie;j=ie.drawIds}else if(u?.participantsProfile?.participantsCount){let J=_.map(qi);if(J.length){let ie=Yp({participantIds:J,autoEntryPositions:a,tournamentRecord:c,entryStage:Et,event:Y});if(ie.error)return ie}}return p&&xE({tournamentRecord:c,event:Y}),{drawIds:j,eventId:R,uniqueParticipantIds:V}}function EX({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!Ro(e))return{error:ma};let n="addSchedulingProfileRound",{extension:a}=ki({name:sw,tournamentRecords:t,discover:!0}),s=a?.value||[],o=s.find(p=>Eh(e,p.scheduleDate));if(!o){let{startDate:p,endDate:f}=F$({tournamentRecords:t}),h=new Date(e);if(p&&h<new Date(p)||f&&h>new Date(f))return{error:ma};o={scheduleDate:e,venues:[]},s.push(o)}let l=o.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},o.venues.push(l));let c=["notBeforeTime"],u=p=>Object.keys(p).filter(f=>!c.includes(f)).sort().map(f=>Xi(p[f])?u(p[f]):p[f]).flat().join("|");if(l.rounds.find(p=>u(p)===u(r)))return ce({result:{error:rwe},stack:n});l.rounds.push(r);let d=ME({tournamentRecords:t,schedulingProfile:s});return d.error?d:{...oe}}function wrt({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:we};let i=IE({tournamentRecord:e}).containedStructures,r=as({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let s of t){let{scheduleDate:o,venues:l=[]}=s;for(let c of l){let{rounds:u,venueId:d}=c;for(let p of u){let{drawId:f,winnerFinishingPositionRange:h,roundSegment:m}=p,A=r.filter(g=>{let v=h?.indexOf("-")>0&&h.split("-").map(y=>+y),b=g.finishingPositionRange?.winner;return g.drawId===f&&(!p.roundNumber||g.roundNumber===p.roundNumber)&&(!b||!v||Mn(b,v).length===2||Ei(b).length===Ei(v).length&&Mn(b,v).length===Ei(b).length)})[0];if(A){let{eventId:g,roundNumber:v,drawName:b,structureName:y,roundName:I}=A,w=A.structureId;v&&!h&&(w=Object.keys(i).find(D=>i[D].includes(w))??w);let S={tournamentId:n,structureId:w,roundNumber:v,roundSegment:m,eventId:g,drawId:f},T=EX({tournamentRecords:{[n]:e},round:S,scheduleDate:o,venueId:d});if(T.error)return T;a.push({structureName:y,roundName:I,drawName:b,...S})}}}}return{scheduledRounds:a}}function AH(t){let e=Qt(t,[{drawProfile:!0,_ofType:fl}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:r={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:s,hydrateCollections:o,randomWinningSide:l,ratingsParameters:c,tournamentRecord:u,isMock:d=!0,drawProfile:p,startDate:f,drawIndex:h,uuids:m}=t,A=Dt(p,!1,!0),{excessParticipantAlternates:g=!0,matchUpFormat:v=ld,drawType:b=Kp,tournamentAlternates:y=0,alternatesCount:I=0,qualifyingPositions:w,qualifyingProfiles:S,generate:T=!0,eventExtensions:D,drawExtensions:C,completionGoal:E,tieFormatName:P,buildTeams:R,seedsCount:M,timeItems:N,drawName:k,category:O,idPrefix:x,publish:F,gender:_,stage:V}=A,G=A.drawSize||(A.ignoreDefaults?void 0:32),z=A.eventId||hr(),Q=p.eventType||p.matchUpType||mf,j=Q===hu?Ni:Wi,W=Xi(p.tieFormat)&&p.tieFormat||Q===vr&&Qm({event:{eventId:z,category:O,gender:_},namedFormat:P,hydrateCollections:o,isMock:d})||void 0,Y=O?.categoryName||O?.ageCategoryCode||O?.ratingType,X=p.eventName||Y||`Generated ${Q}`,J=u?.participants||[],ie=(S?.map(Le=>Le.structureProfiles||[]).flat().reduce((Le,lt)=>{let it=!lt.participantsCount||lt.participantsCount>lt.drawSize?lt.drawSize:lt.participantsCount||0;return Le+it},0)||0)*(j===Ni?2:1),ue=(!p.participantsCount||p.participantsCount>G?G:p.participantsCount)||0,ne={eventName:X,eventType:Q,tieFormat:W,category:O,eventId:z,gender:_};Array.isArray(N)&&N.forEach(Le=>wS({event:ne,timeItem:Le}));let{eventAttributes:ge}=p;if(typeof ge!="object"&&(ge={}),Object.assign(ne,ge),D?.length&&Array.isArray(D)){let Le=D.filter(gf);Le?.length&&Object.assign(ne,{extensions:Le})}let he=[];if(r?.participantsCount===0||p.uniqueParticipants||ie||!u||_||O){let Le=(ue||0)+I+ie,lt=Le,it={[oa]:0,[Ds]:0},Fe,Xe;Q===vr&&({teamSize:Fe,genders:Xe}=TX({alternatesCount:I,tieFormatName:P,tieFormat:W,drawSize:G}),Object.keys(Xe).forEach(ht=>{let xt=Ks(ht);xt&&ff(ht)&&Xe[xt]&&(it[xt]=G*Xe[xt])}),lt=Fe*((G||0)+ie));let ct=r?.idPrefix?`D-${h}-${r?.idPrefix}`:void 0,We=LE({...r,scaledParticipantsCount:p.scaledParticipantsCount||r.scaledParticipantsCount,participantsCount:lt,consideredDate:u?.startDate,sex:_||r?.sex,rankingRange:p.rankingRange,uuids:p.uuids||m,ratingsParameters:c,participantType:j,gendersCount:it,idPrefix:ct,category:O}).participants;if(ne.category&&(ne.category.categoryName=Y),u){let ht=Ed({participants:We,tournamentRecord:u});if(ht.error)return ht}if(We.forEach(({participantId:ht})=>he.push(ht)),J=We,Q===vr){let ht=Xe[oa]?We.filter(({participantType:ut,person:Ct})=>ut===Wi&&Ct?.sex===oa).map(qi):[],xt=Xe[Ds]?We.filter(({participantType:ut,person:Ct})=>ut===Wi&&Qv(Ct?.sex)).map(qi):[],pe=We.filter(({participantType:ut})=>ut===Wi).map(qi).filter(ut=>!ht.includes(ut)&&!xt.includes(ut)),Se=[...A.teamNames??[],...K_({count:Le}).names],ye=Fe-(Xe[oa]+Xe[Ds]),ke=0,Ce=0,Ke=0,_e=vt(0,Le).map(ut=>{let Ct=xt.slice(ke,ke+Xe[Ds]),Gi=ht.slice(Ce,Ce+Xe[oa]),Wt=pe.slice(Ke,Ke+ye);ke+=Xe[Ds],Ce+=Xe[oa],Ke+=ye;let Ji=R!==!1?[...Ct,...Gi,...Wt]:[];return{participantName:Se[ut]||`Team ${ut+1}`,participantOtherName:`TM${ut+1}`,participantRole:xs,individualParticipantIds:Ji,participantType:vr,participantId:hr()}}),wt=Ed({participants:_e,tournamentRecord:u});if(!wt.success)return wt;J=_e}}let Ie=Le=>{let{participantType:lt}=Le;return Vn(mf)(Q)&&lt===Wi||Vn(hu)(Q)&&lt===Ni?!0:Q===vr&&lt===vr},xe=Le=>!p.gender||Le.person?.sex===p.gender?!0:Le.individualParticipantIds?.some(lt=>{let it=J.find(Fe=>Fe.participantId===lt);return it&&xe(it)}),Je=J.filter(Ie).filter(xe).filter(({participantId:Le})=>!i.includes(Le)),qe=Je.slice(0,ue).map(Le=>Le.participantId);if(d&&qe?.length){let Le=Yp({autoEntryPositions:s,entryStage:V,tournamentRecord:u,participantIds:qe,event:ne});if(Le.error)return Le}let dt=ie?Je.slice(ue,ue+ie).map(Le=>Le.participantId):0;if(d&&dt?.length){let Le=0,lt=1,it=(Xe,ct)=>Xe.stageSequence-ct.stageSequence,Fe=(Xe,ct)=>Xe.roundTarget-ct.roundTarget;for(let Xe of S.sort(Fe)){lt=Xe.roundTarget||lt;let ct=1,We;for(let ht of Xe.structureProfiles.sort(it)){let xt=(ht.drawSize||b8(ht.participantsCount))-(We||0),pe=dt.slice(Le,Le+xt),Se=Yp({entryStage:qt,entryStageSequence:ct,autoEntryPositions:s,tournamentRecord:u,participantIds:pe,roundTarget:lt,event:ne});if(Se.error)return Se;We=ht.qualifyingPositions,Le+=xt,ct+=1}lt+=1}}let ft=g&&u?.participants?.filter(({participantId:Le})=>!qe.includes(Le)).filter(Ie).filter(xe).slice(0,I||G-ue||y).map(Le=>Le.participantId);if(d&&ft?.length){let Le=Yp({participantIds:ft,autoEntryPositions:!1,entryStatus:ud,tournamentRecord:u,event:ne});if(Le.error)return Le.error}let je=Y||X;u&&M&&M<=qe.length&&vt(1,M+1).forEach((Le,lt)=>{let it={scaleName:je,scaleDate:f,scaleType:e7,scaleValue:Le,eventType:Q},Fe=qe[lt];aN({tournamentRecord:u,participantId:Fe,scaleItem:it})});let Tt=pN({...Dt(p,!1,!0),tournamentRecord:u,seedingScaleName:je,matchUpFormat:v,eventId:z,isMock:d,event:ne});if(Tt.error)return Tt;if(!Tt.drawDefinition)return{error:Rc};let{drawDefinition:Oe}=Tt,mt=Oe.drawId;if(Array.isArray(C)&&C.filter(gf).forEach(Le=>ur({element:Oe,extension:Le})),T){if(fN({drawDefinition:Oe,event:ne,suppressNotifications:!0}),p.withPlayoffs){let lt=Oe.structures?.[0].structureId,it=S$({...p.withPlayoffs,tournamentRecord:u,drawDefinition:Oe,structureId:lt,idPrefix:x,isMock:d,event:ne});if(it?.error)return it}let Le=p.automated===!1;if(d&&!Le){let lt=it=>{let Fe=Y_({completeAllMatchUps:it.completeAllMatchUps,completionGoal:it.completionGoal,matchUpStatusProfile:n,randomWinningSide:l,tournamentRecord:u,drawDefinition:Oe,matchUpFormat:v,event:ne});if(Fe.error)return Fe;let Xe=Fe.completedCount;if(b===Mh){let ct=Oe.structures?.find(xt=>xt.stage===Et);if(!ct)return{error:an};DE({structureId:ct.structureId,tournamentRecord:u,drawDefinition:Oe});let We=E?E-(Xe??0):void 0,ht=Y_({completionGoal:E?We:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:u,drawDefinition:Oe,matchUpFormat:v,event:ne});if(ht.error)return ht}};if(E&&lt({completionGoal:E}),p.outcomes){let{matchUps:it}=No({inContext:!0,drawDefinition:Oe,event:ne});for(let Fe of p.outcomes){let{matchUpStatus:Xe=Hn,matchUpStatusCodes:ct,stageSequence:We=1,matchUpIndex:ht=0,structureOrder:xt,matchUpFormat:pe,drawPositions:Se,roundPosition:ye,stage:ke=Et,roundNumber:Ce,winningSide:Ke,scoreString:_e}=Fe,wt=it?.reduce((Wt,Ji)=>{let{structureId:$i,matchUpId:xi}=Ji;return Wt[$i]?Wt[$i].push(xi):Wt[$i]=[xi],Wt},{})??[],ut=Object.assign({},...Object.keys(wt).map((Wt,Ji)=>({[Wt]:Ji+1}))),Ct=it?.filter(Wt=>(!ke||Wt.stage===ke)&&(!We||Wt.stageSequence===We)&&(!Ce||Wt.roundNumber===Ce)&&(!ye||Wt.roundPosition===ye)&&(!xt||ut[Wt.structureId]===xt)&&(!Se||Mn(Se,Wt.drawPositions).length===2))?.[ht],Gi=uPe({matchUpStatusCodes:ct,tournamentRecord:u,drawDefinition:Oe,targetMatchUp:Ct,matchUpFormat:pe,matchUpStatus:Xe,scoreString:_e,winningSide:Ke});if(Gi?.error)return Gi}}a&&lt({completeAllMatchUps:a})}F&&xE({tournamentRecord:u,event:ne})}else{let Le=rH({drawEntries:Oe.entries,drawName:k||b,qualifyingPositions:w,drawId:mt,event:ne,stage:V});if(Le.error)return Le}return{...oe,event:Lt(ne),uniqueParticipantIds:he,targetParticipants:J,drawDefinition:Oe,eventId:z,drawId:mt}}var mPe=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,indoorOutdoor:void 0,floodlit:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),Srt=mPe;function X_(t){return parseInt(t)}function Xie({startTime:t="",endTime:e=""}={}){if(!t||!e||!jv.test(t)||!jv.test(e))return!1;let[i,r]=t.split(":").map(X_),[n,a]=e.split(":").map(X_);return n<i?!1:!(i===n&&a<r)}function Urt(t,e){let[i,r]=t.startTime.split(":").map(X_),[n,a]=e.startTime.split(":").map(X_);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function APe({dateAvailability:t}){if(!t)return{error:vwe};if(!Array.isArray(t))return{error:Vk};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:Vk};let{date:n,startTime:a,endTime:s,bookings:o=[]}=r;if(!a||!s)return{error:Vk};if(n&&!hf.test(n))return{error:ma,dateAvailability:{date:n},info:e};if(!jv.test(a))return{error:zu,dateAvailability:{startTime:a},info:i};if(!jv.test(s))return{error:zu,dateAvailability:{endTime:s},info:i};if(a===s)return{error:zu,dateAvailability:{startTime:a,endTime:s},info:"startTime and endTime are equivalent"};if(!Xie({startTime:a,endTime:s}))return{error:zu,dateAvailability:{startTime:a,endTime:s},info:"endTime must be after startTime"};if(o){if(!Array.isArray(o))return{error:S_};for(let l of o){if(typeof l!="object")return{error:S_};let{startTime:c,endTime:u}=l;if(!jv.test(c))return{error:zu,booking:{startTime:c},info:i};if(!jv.test(u))return{error:zu,booking:{endTime:u},info:i};if(c===u)return{error:zu,dateAvailability:{startTime:c,endTime:u},info:"startTime and endTime are equivalent"};if(!Xie({startTime:c,endTime:u}))return{error:zu,dateAvailability:{startTime:c,endTime:u},info:"endTime must be after startTime"}}}}return{valid:!0}}function gH({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=qh({tournamentRecord:t,venueId:i});if(!a)return{error:vb};a.courts||(a.courts=[]);let s={...mPe(),venueId:i,courtId:r};if(s.courtId||(s.courtId=hr()),a.courts.some(o=>o.courtId===s.courtId))return{error:_we};{let o=(n?.dateAvailability||[]).map(u=>({...u,date:Ui(u.date),startTime:Kr(u.startTime),endTime:Kr(u.endTime),bookings:u.bookings?.map(({startTime:d,endTime:p,bookingType:f})=>({startTime:Kr(d),endTime:Kr(p),bookingType:f}))})),l=Object.keys(s);for(let u of l)if(n?.[u])if(u==="dateAvailability"){let d=APe({dateAvailability:o});if(!d.valid&&d.error)return d;s.dateAvailability=o}else s[u]=n[u];let c=s;return a.courts.push(c),e||Ii({payload:{venue:a,tournamentId:t.tournamentId},topic:vA,key:a.venueId}),{...oe,court:Dt(s),venueId:i}}}function DX(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:ev};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let s of Object.values(r)){let{venue:o}=qh({tournamentRecord:s,venueId:i});if(o){let l=Trt({...t,tournamentRecord:s});for(let c of l?.courts??[])n.push(c?.courtId);if(l.error)return l;a=!0}}return a?{...oe,courtIds:n}:{error:vb}}function Trt({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:s,startTime:o,courtIds:l,endTime:c,idPrefix:u,venueId:d,dates:p}){if(!d)return{error:ev};let f=qh({tournamentRecord:r,venueId:d});if(f.error)return f;let{venue:h}=f;if(!Un(s)||!n)return{error:xwe};s=s??n.length;let m=vt(0,s).map(A=>{let g=a?.[A],v=g?p.map(b=>({date:od(b),startTime:o,endTime:c,...g})):e;return g&&o&&c&&v.push({startTime:o,endTime:c}),{courtName:n[A]||i&&h?.venueAbbreviation&&`${h?.venueAbbreviation} ${A+1}`||`${t} ${A+1}`,dateAvailability:v}}).map((A,g)=>{let v=l?.pop()||u&&`${u}-${g+1}`;return gH({disableNotice:!0,tournamentRecord:r,courtId:v,venueId:d,court:A})}).map(A=>A.court).filter(Boolean);return m.length!==s?ce({info:"not all courts could be generated",result:{error:we}}):(h&&Ii({payload:{venue:h,tournamentId:r.tournamentId},topic:vA,key:h.venueId}),{...oe,courts:Dt(m)})}function PX({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,s=[];for(let[o,l]of i.entries()){let{venueAbbreviation:c,venueId:u=r?.pop()??hr(),dateAvailability:d,startTime:p="07:00",endTime:f="19:00",courtTimings:h,courtsCount:m,courtNames:A,venueName:g,idPrefix:v,courtIds:b}=l,y={venueName:g||`Venue ${o+1}`,venueAbbreviation:c,venueId:u},I=FM({tournamentRecord:t,venue:y});if(I.error){if(e)continue;return I}s.push(u);let w=GT(n,a),S=!Array.isArray(d)&&[{startTime:p,endTime:f}].concat(w.map(T=>({date:od(T),startTime:p,endTime:f})));if(m||A){let T=DX({dateAvailability:d||S,tournamentRecord:t,courtTimings:h,courtsCount:m,courtNames:A,startTime:p,idPrefix:v,courtIds:b,endTime:f,venueId:u,dates:w});if(T.error)return T}}return s}function Crt(t){let{tournamentRecord:e,leagueProfiles:i,eventIds:r,venueIds:n,drawIds:a,allUniqueParticipantIds:s,uuids:o}=t,l=0;for(let u of i){let d=[],{tieFormatName:p=P_,teamProfiles:f=[],teamsCount:h=0,category:m,idPrefix:A,gender:g}=u,v=u.leagueName??u.eventName??`League ${l+1}`,b=u.leagueId??u.eventId??o?.pop()??hr();r.push(b);let y=Xi(u.tieFormat)&&u.tieFormat||Qm({event:{eventId:b,category:m,gender:g},namedFormat:p,isMock:t.isMock})||void 0;if(!y)return{error:dE};let I=Math.max(h,f.length),w=vt(0,I),{genders:S,teamSize:T}=TX({tieFormat:y,drawSize:I}),D={[Ds]:0,[aS]:0,[Am]:0,[oa]:0,ANY:0};Object.keys(S).forEach(E=>D[E]+=S[E]);for(let E of w){let P=f?.[E]?.teamName??`Team ${E+1}`,R=f?.[E]?.teamId||o?.pop()||hr(),M=u.startDate??t.startDate,N=LE({...u?.participantsProfile,participantsCount:T,consideredDate:M,gendersCount:D,category:m,uuids:o}).participants,k=N.map(G=>G.participantId),O=vr,x=R??W_({participantType:O,idPrefix:A,index:E,uuids:o});d.push({participantId:x,entryStatus:Sl,entryStage:Et});let F=f?.[E]?.venueIds??[],_={participantId:x,participantRole:xs,participantName:P,individualParticipantIds:k,participantType:O,homeVenueIds:F};F.forEach(G=>!n.includes(G)&&n.push(G)),s.push(...k,x);let V=Ed({participants:[_,...N],tournamentRecord:e});if(V.error)return V}let C={eventName:v,entries:d,eventType:vr,tieFormat:y,category:m,eventId:b,gender:g};if(e.events||(e.events=[]),e.events.push(C),d.length){let E=(Un(u.roundsCount)&&u.roundsCount)??u.roundsCount===nYe?(I-1)*2:I-1,P=pN({automated:u.automated,tournamentRecord:e,drawType:ec,roundsCount:E,drawSize:I,event:C});if(P.error)return P;let{drawDefinition:R}=P;if(R){let M=R?.drawId;fN({drawDefinition:R,event:C,suppressNotifications:!0}),a.push(M)}}l++}let c=n.map(u=>({venueId:u}));PX({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:c,uuids:o})}var Ert=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function gPe(t){let{startDate:e,endDate:i}=t??{},{tournamentName:r=_l(Ert),ratingsParameters:n=qa,tournamentExtensions:a,policyDefinitions:s,schedulingProfile:o,venueProfiles:l,uuids:c}=t??{},u=t?.isMock===!1?void 0:!0;if(e&&!Ro(e)||i&&!Ro(i))return{error:ma};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:we};if(!e){let v=new Date;e=od(i??v),i=od(v.setDate(v.getDate()+7))}if(!i){let v=new Date(e);i=od(v.setDate(v.getDate()+7))}let d=mH({...t.tournamentAttributes??{},tournamentName:r,startDate:e,endDate:i,isMock:u}),p=l?.length?PX({tournamentRecord:d,venueProfiles:l,uuids:c}):[];if(a?.length&&Array.isArray(a)){let v=a.filter(b=>gf({extension:b}));v?.length&&Object.assign(d,{extensions:v,isMock:u})}if(typeof s=="object")for(let v of Object.keys(s))Qy({policyDefinitions:{[v]:s[v]},tournamentRecord:d});if(!t?.leagueProfiles?.length||t.eventProfiles?.length||t.drawProfiles?.length||t.participantsProfile){let v=oPe({tournamentRecord:d,...t});if(!v.success)return v}let f=[],h=[],m=[];if(t.leagueProfiles){let v=Crt({allUniqueParticipantIds:f,tournamentRecord:d,...t,eventIds:h,venueIds:p,drawIds:m});if(v?.error)return v}if(t.drawProfiles){let v=Drt({allUniqueParticipantIds:f,ratingsParameters:n,tournamentRecord:d,...t,eventIds:h,drawIds:m});if(v?.error)return v}if(t.eventProfiles){let v=Prt({allUniqueParticipantIds:f,ratingsParameters:n,tournamentRecord:d,...t,eventIds:h,drawIds:m});if(v?.error)return v}let{scheduledRounds:A=void 0,schedulerResult:g={}}=o?Rrt({...t,tournamentRecord:d}):{};return Z8(),Lt({...oe,tournamentRecord:d,scheduledRounds:A,schedulerResult:g,eventIds:h,venueIds:p,drawIds:m})}function Drt(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,s=0;for(let o of i){let l=AH({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:o,drawIndex:s,...t});if(l.error)return l;let{drawId:c,eventId:u,event:d,uniqueParticipantIds:p}=l;if(o?.addEvent!==!1){if(l=BE({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;c&&a.push(c),n.push(u)}p?.length&&r.push(...p),s+=1}}function Prt(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let s of e){let o=hPe({...t,eventIndex:a,eventProfile:s});if(o.error)return o;let{eventId:l,drawIds:c,uniqueParticipantIds:u}=o;c&&n.push(...c),r.push(l),u?.length&&i.push(...u),a+=1}}function Rrt(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,s=wrt({schedulingProfile:e,tournamentRecord:i});if(s.error)return s;let o=s.scheduledRounds;if(r){let{tournamentId:l}=i,c={[l]:i};return{schedulerResult:hH({scheduleCompletedMatchUps:a,tournamentRecords:c,periodLength:n}),scheduledRounds:o}}return{scheduledRounds:o}}var vPe={};Li(vPe,{anonymizeTournamentRecord:()=>yPe,modifyTournamentRecord:()=>IPe});function yPe({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){if(!i)return{error:nt};let s=Array.isArray(t)?sie.concat(...t):sie,o=x=>Array.isArray(t)?x?.extensions?.filter(F=>s.includes(F.name)):x?.extensions,l={};i.extensions=o(i);let c=a||hr();l[i.tournamentId]=c,i.tournamentId=c,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${od(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let x of i.participants||[]){x.extensions=o(x),x.onlineResources=[];let F=hr();l[x.participantId]=F,x.participantId=F}for(let x of i.participants||[])Array.isArray(x.individualParticipantIds)&&(x.individualParticipantIds=x.individualParticipantIds.map(F=>l[F]));let u=0;for(let x of i.venues||[]){x.venueAbbreviation=`V${u}`,x.extensions=o(x),x.venueName=`Venue #${u}`,x.onlineResources=[],x.addresses=[];let F=hr();l[x.venueId]=F,x.isMock=!0,u+=1;let _=0;for(let V of x.courts||[])V.courtName=`V${u}C${_}`,V.extensions=o(V),V.onlineResources=[],V.isMock=!0,_+=1}let d=1;for(let x of i.events||[]){x.extensions=o(x),x.onlineResources=[],x.isMock=!0;let F=hr();l[x.eventId]=F,x.eventId=F;let _=x.category?.categoryName||x.category?.ageCategoryCode||x.category?.ratingType||x.gender;if(x.eventName=`Event ${d} ${_}`,Array.isArray(x.entries))for(let G of x.entries)G.participantId=l[G.participantId];for(let G of x.drawDefinitions||[]){G.extensions=o(G);let z=hr();if(l[G.drawId]=z,G.drawId=z,G.isMock=!0,Array.isArray(G.entries))for(let j of G.entries)j.participantId=l[j.participantId];let Q=j=>{j.extensions=o(j);let W=hr();l[j.structureId]=W,j.structureId=W;for(let Y of j.positionAssignments||[])Y.participantId&&(Y.participantId=l[Y.participantId]);for(let Y of j.seedAssignments||[])Y.participantId&&(Y.participantId=l[Y.participantId]);for(let Y of j.matchUps||[]){Y.isMock=!0;for(let X of Y.sides||[])X.lineUp&&(X.lineUp=X.lineUp.map(({participantId:J,collectionAssignments:ie})=>({participantId:l[J],collectionAssignments:ie})))}};for(let j of G.structures||[])if(Q(j),Array.isArray(j.structures))for(let W of j.structures)Q(W);for(let j of G.links||[])j.source.structureId=l[j.source.structureId],j.target.structureId=l[j.target.structureId]}let{extension:V}=ki({name:Ud,element:x});Array.isArray(V?.value?.flights)&&V?.value.flights?.forEach(G=>{if(G.drawId=l[G.drawId],Array.isArray(G.drawEntries))for(let z of G.drawEntries)z.participantId=l[z.participantId]}),d+=1}let p=i.startDate||od(new Date),f=(i.participants||[]).filter(({participantType:x})=>x===Wi),h=f.reduce((x,F)=>{let _=F.person?.sex,V=Ks(_);return V&&ff(_)?x[V]+=1:x[Am]+=1,x},{[oa]:0,[Ds]:0,[Am]:0}),m=Object.assign({},...Object.keys(h).map(x=>({[x]:sPe({category:{ageCategoryCode:"O18"},count:h[x],personExtensions:[],consideredDate:p,sex:x})?.persons||[]}))),A={[oa]:0,[Ds]:0,[Am]:0},g=f.length,v=f.reduce((x,F)=>{let _=F.person?.addresses?.[0]||{},{city:V,state:G,postalCode:z}=_;return x.cities.includes(V)||x.cities.push(V),x.states.includes(G)||x.states.push(G),x.postalCodes.includes(z)||x.postalCodes.push(z),x},{cities:[],postalCodes:[],states:[]}),b=v.postalCodes.length,y=v.cities.length,I=v.states.length,{cities:w}=iPe({count:y||g,participantsCount:g}),{states:S}=rPe({count:I||g,participantsCount:g}),{postalCodes:T}=nPe({count:b||g,participantsCount:g}),D={cities:w,states:S,postalCodes:T};f.forEach((x,F)=>{let _=x?.person,V=_?.sex||Am,G=Ui(_?.birthDate)?.split("-")[0],z=A[V],Q=m[V][z];if(A[V]+=1,G){let[,j,W]=Q?.birthDate?.split("-")||[],Y=[G,j,W].join("-");Q.birthDate=Y}if(_?.addresses){let j=aPe({...D,participantIndex:F,nationalityCode:Q.nationalityCode});Q.addresses=[j]}Q.personId=n?.[F]||hr(),e?(Q.standardFamilyName=Q.lastName,Q.standardGivenName=Q.firstName,x.participantName=`${Q.standardGivenName} ${Q.standardFamilyName}`):(Q.standardFamilyName=_?.standardFamilyName,Q.standardGivenName=_?.standardGivenName),delete Q.firstName,delete Q.lastName,Q.extensions=o(_),x.person=Q,l[_?.personId]=Q.personId}),(i.participants||[]).filter(({participantType:x})=>x===Ni).forEach(x=>{let{individualParticipantIds:F}=x;x.participantName=Mrt({individualParticipantIds:F,individualParticipants:f})});let C=(i.participants||[]).filter(({participantType:x})=>x===vr),E=C.length,P=K_({count:E}).names;C.forEach((x,F)=>{x.participantName=P[F]});let R=(i.participants||[]).filter(({participantType:x})=>x===Lc),M=R.length,N=K_({count:M,nameRoot:"Group"}).names;R.forEach((x,F)=>{x.participantName=N[F]});let{extension:k}=ki({element:i,name:sw});Array.isArray(k?.value)&&k?.value.forEach(x=>{x.tournamentId=l[x.tournamentId],x.structureId=l[x.structureId],x.eventId=l[x.eventId],x.drawId=l[x.drawId]});let{extension:O}=ki({element:i,name:yE});return Array.isArray(O?.value)&&O?.value.forEach(x=>{x.personId=l[x.personId]}),{...oe}}function Mrt({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r?.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function Nrt({event:t,eventProfile:e,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n}){let{gender:a,category:s,eventType:o}=t,{drawProfiles:l,publish:c}=e,u=Vn(mf)(o)&&Wi||Vn(hu)(o)&&Ni||o;if(l){let{stageParticipantsCount:d,uniqueParticipantsCount:p,uniqueParticipantStages:f}=lPe({drawProfiles:l,category:s,gender:a}),{uniqueDrawParticipants:h=[],uniqueParticipantIds:m=[]}=f?pPe({event:{eventType:o,category:s,gender:a},uniqueParticipantsCount:p,participantsProfile:e.participantsProfile,ratingsParameters:e.ratingsParameters,tournamentRecord:i,eventProfile:e,uuids:e.uuids}):{};r.push(...m);let{stageParticipants:A}=cPe({targetParticipants:i.participants||[],allUniqueParticipantIds:r,stageParticipantsCount:d,eventParticipantType:u}),g=fPe({uniqueDrawParticipants:h,autoEntryPositions:e.autoEntryPositions,stageParticipants:A,tournamentRecord:i,drawProfiles:l,category:s,gender:a,event:t});if(g.error||(g=dPe({matchUpStatusProfile:e.matchUpStatusProfile,completeAllMatchUps:e.completeAllMatchUps,randomWinningSide:e.randomWinningSide,tournamentRecord:i,drawProfiles:l,isMock:e.isMock,event:t}),g.error))return g;n.push(...g.drawIds)}return c&&xE({tournamentRecord:i,event:t}),oe}function bPe(t,e){return t?.find((i,r)=>e.eventIndex!==void 0&&r===e.eventIndex||e.eventName&&i.eventName===e.eventName||e.eventId&&i.eventId===e.eventId)}function Brt({event:t,eventProfile:e,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n,params:a}){return Nrt({event:t,eventProfile:{...e,...a},tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n})}function krt({eventProfile:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a,eventIndex:s}){let o=hPe({startDate:e.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,randomWinningSide:a.randomWinningSide,ratingsParameters:t.ratingsParameters,tournamentRecord:e,eventProfile:t,eventIndex:s,uuids:a.uuids});if(o.error)return o;let{eventId:l,drawIds:c,uniqueParticipantIds:u}=o;return c&&n.push(...c),r.push(l),u?.length&&i.push(...u),{eventIndexIncrement:1}}function xrt({eventProfiles:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let s=e.events?.length||0;for(let o of t){let l=bPe(e.events,o);if(l){let c=Brt({event:l,eventProfile:o,tournamentRecord:e,allUniqueParticipantIds:i,drawIds:n,params:a});if(c?.error)return c}else{let c=krt({eventProfile:o,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a,eventIndex:s});if(c?.error)return c;s+=c?.eventIndexIncrement||1}}return oe}function _rt({drawProfiles:t,tournamentRecord:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let s=(e.events||[]).flatMap(o=>o.drawDefinitions?.map(()=>1)||[]).reduce((o,l)=>o+l,0);for(let o of t){let l=AH({startDate:e.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,hydrateCollections:a.hydrateCollections,randomWinningSide:a.randomWinningSide,ratingsParameters:a.ratingsParameters,tournamentRecord:e,drawProfile:o,drawIndex:s,uuids:a.uuids});if(l.error)return l;let{drawId:c,eventId:u,event:d,uniqueParticipantIds:p}=l;if(l=BE({tournamentRecord:e,event:d,internalUse:!0}),l.error)return l;c&&n.push(c),r.push(u),p?.length&&i.push(...p),s+=1}return oe}function Ort({schedulingProfile:t,autoSchedule:e,periodLength:i,tournamentRecord:r}){let n=[],a={};if(t?.length){let s={[r.tournamentId]:r},o=ME({tournamentRecords:s,schedulingProfile:t});if(o.error)return o;if(e){let{tournamentId:l}=r,c={[l]:r};a=hH({tournamentRecords:c,periodLength:i})}}return{scheduledRounds:n,schedulerResult:a}}function IPe(t){let{participantsProfile:e={},schedulingProfile:i,tournamentRecord:r,autoSchedule:n,eventProfiles:a,periodLength:s,venueProfiles:o,drawProfiles:l,uuids:c}=t;if(!r)return{error:nt};let u=[],d=[],p=[];a?.forEach(b=>{let y=bPe(r.events,b);y?.gender&&(b.gender=y.gender)});let f=r.participants?.length||void 0;f&&e?.idPrefix&&(e.idPrefix=`${e.idPrefix}-${f}`);let h=oPe({startDate:r.startDate,participantsProfile:e,tournamentRecord:r,eventProfiles:a,drawProfiles:l,uuids:c});if(!h.success)return h;if(a){let b=xrt({eventProfiles:a,tournamentRecord:r,allUniqueParticipantIds:u,eventIds:d,drawIds:p,params:t});if(b.error)return b}if(l){let b=_rt({drawProfiles:l,tournamentRecord:r,allUniqueParticipantIds:u,eventIds:d,drawIds:p,params:t});if(b.error)return b}let m=o?.length?PX({tournamentRecord:r,venueProfiles:o}):[],A=Ort({tournamentRecord:r,schedulingProfile:i,autoSchedule:n,periodLength:s});if(A.error)return A;let{scheduledRounds:g,schedulerResult:v}=A;return{totalParticipantsCount:r.participants.length,scheduledRounds:g,schedulerResult:v,...oe,eventIds:d,venueIds:m,drawIds:p}}var wPe={};Li(wPe,{addDynamicRatings:()=>t9,addIndividualParticipantIds:()=>oH,addParticipant:()=>bf,addParticipants:()=>Ed,addPenalty:()=>GPe,addPersonRequests:()=>DPe,addPersons:()=>QPe,createGroupParticipant:()=>kPe,createTeamsFromParticipantAttributes:()=>UX,deleteParticipants:()=>vS,filterParticipants:()=>GM,findParticipant:()=>BPe,getCompetitionParticipants:()=>A9,getPairedParticipant:()=>Cd,getParticipantEventDetails:()=>g9,getParticipantMembership:()=>v9,getParticipantScaleItem:()=>lw,getParticipantSchedules:()=>y9,getParticipantSignInStatus:()=>b9,getParticipantTimeItem:()=>jY,getParticipants:()=>vn,getScaleValues:()=>gE,mergeParticipants:()=>VPe,modifyIndividualParticipantIds:()=>PPe,modifyParticipant:()=>lH,modifyParticipantName:()=>xPe,modifyParticipantOtherName:()=>MPe,modifyParticipantsSignInStatus:()=>RPe,modifyPenalty:()=>$Pe,modifyPersonRequests:()=>CPe,mutate:()=>SPe,participantScaleItem:()=>lh,query:()=>CDe,regenerateParticipantNames:()=>NPe,removeIndividualParticipantIds:()=>p7,removeParticipantIdsFromAllTeams:()=>f$,removePenalty:()=>FPe,removePersonRequests:()=>EPe,removeRatings:()=>OPe,scaledTeamAssignment:()=>_Pe,setParticipantScaleItem:()=>aN,setParticipantScaleItems:()=>UEe,validateLineUp:()=>m$});var SPe={};Li(SPe,{addDynamicRatings:()=>t9,addIndividualParticipantIds:()=>oH,addParticipant:()=>bf,addParticipants:()=>Ed,addPenalty:()=>GPe,addPersonRequests:()=>DPe,addPersons:()=>QPe,createGroupParticipant:()=>kPe,createTeamsFromParticipantAttributes:()=>UX,deleteParticipants:()=>vS,findParticipant:()=>BPe,mergeParticipants:()=>VPe,modifyIndividualParticipantIds:()=>PPe,modifyParticipant:()=>lH,modifyParticipantName:()=>xPe,modifyParticipantOtherName:()=>MPe,modifyParticipantsSignInStatus:()=>RPe,modifyPenalty:()=>$Pe,modifyPersonRequests:()=>CPe,regenerateParticipantNames:()=>NPe,removeIndividualParticipantIds:()=>p7,removeParticipantIdsFromAllTeams:()=>f$,removePenalty:()=>FPe,removePersonRequests:()=>EPe,removeRatings:()=>OPe,scaledTeamAssignment:()=>_Pe,setParticipantScaleItem:()=>aN,setParticipantScaleItems:()=>UEe});function UPe(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function TPe({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:s,endTime:o}=n;return n.requestType===AN&&(a=Ui(a),s=Kr(s),o=Kr(o),a&&s&&o)?{date:a,startTime:s,endTime:o,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=UPe(),t[e].push(n);return{mergeCount:r.length}}function RX(t){let{tournamentRecords:e,personRequests:i}=t,r=Qt(t,[{[Js]:!0}]);if(r.error)return r;if(!i)return{...oe};let n=Object.values(e);for(let a of n){let s=a.participants??[],o=[];for(let l of Object.keys(i))if(Sg({tournamentParticipants:s,personId:l})){let c=i[l];c.length&&o.push({personId:l,requests:c})}Object.keys(o).length&&ur({element:a,extension:{value:o,name:yE}})}return{...oe}}function CPe(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=Qt(t,[{[Js]:!0},{requests:!0,[rl]:qs,[Nc]:we}]);if(n.error)return n;let a=i.map(({requestId:c})=>c).filter(Boolean),{personRequests:s}=Pb({tournamentRecords:e}),o=c=>{s&&(s[c]=s[c].map(u=>{if(!a.includes(u.requestId))return u;let d=i.find(p=>p.requestId===u.requestId);if(d.requestType)return Object.assign(u,d)}).filter(Boolean))};if(r&&s?.[r])o(r);else if(s)for(let c of Object.keys(s))o(c);let l=i.filter(c=>!c.requestId);return l.length&&TPe({personRequests:s,personId:r,requests:l}),RX({tournamentRecords:e,personRequests:s})}function EPe(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,s=Qt(t,[{[Js]:!0}]);if(s.error)return s;let{personRequests:o}=Pb({tournamentRecords:e}),l=u=>{o&&(o[u]=o[u].filter(d=>(!i||d.requestType!==i)&&(!r||d.requestId!==r)&&(!a||d.date!==a)),o?.[u]?.length||delete o[u])},c=!i&&!r&&!n&&!a;if(!c){if(n&&o?.[n])l(n);else if(o)for(let u of Object.keys(o))l(u)}return c||!o||!Object.keys(o).length?Mo({name:yE,tournamentRecords:e,discover:!0}):RX({tournamentRecords:e,personRequests:o})}function DPe(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=Qt(t,[{[Js]:!0,[dYe]:!0},{requests:!0,[rl]:qs,[Nc]:we}]);if(n.error)return n;let{personRequests:a}=Pb({tournamentRecords:e}),{mergeCount:s}=TPe({personRequests:a,personId:i,requests:r});return s&&a?RX({tournamentRecords:e,personRequests:a}):{error:we}}function PPe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return ce({result:{error:nt},stack:r});if(!e||!t)return ce({result:{error:Yt},stack:r});let n=i.participants||[],a=n.find(f=>f.participantId===e);if(!a)return ce({result:{error:Fn},stack:r});if(![vr,Lc].includes(a.participantType))return ce({result:{error:cp},context:{participantType:a.participantType},stack:r});let s=t.filter(f=>n.find(h=>h.participantId===f)?.participantType!==Wi);if(s.length)return ce({result:{error:Ll,invalidParticipantIds:s},stack:r});let o=a.individualParticipantIds||[],l=t.filter(f=>!o.includes(f)),c=o.filter(f=>!t.includes(f)),u=oH({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(u.error)return ce({result:u,stack:r});let d=p7({individualParticipantIds:c,groupingParticipantId:e,tournamentRecord:i});if(d.error)return ce({result:d,stack:r});let{topics:p}=Tu();if(p.includes($s)){let f=n.find(({participantId:h})=>h===e);Ii({topic:$s,payload:{tournamentId:i.tournamentId,participants:[f]}})}return{...u,...d}}function RPe({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:nt};if(!Array.isArray(e))return{error:Yt};if(![WP,WUe].includes(i))return{error:we,signInState:i};let r=t.participants||[];if(!r.length)return{error:uM};let n=r.map(qi),a=e.filter(c=>!n.includes(c));if(a.length)return{error:we,context:{invalidParticipantIds:a}};let s=[],o=new Date().toISOString();for(let c of r){let{participantId:u}=c;if(e.includes(u)){let d=V7({duplicateValues:!1,tournamentRecord:t,participantId:u,timeItem:{itemType:CM,itemValue:i,createdAt:o}});if(d.error)return d;s.push(c)}}let{topics:l}=Tu();return s.length&&l.includes($s)&&Ii({topic:$s,payload:{tournamentId:t.tournamentId,participants:s}}),{...oe}}function MPe({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:nt};if(!e)return{error:ba};let{participant:r}=nv({tournamentRecord:t,participantId:e});if(!r)return{error:Fn};r.participantOtherName=i;let{topics:n}=Tu();return n.includes($s)&&Ii({topic:$s,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...oe}}function Zie({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),r=m=>/^[a-z]*$/.test(i(m)),n=m=>/^[A-Z]*$/.test(i(m)),a=m=>/^[LAST]{4}/.test(i(m)),s=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),o=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,c=m=>m.toLowerCase().indexOf("f")<0,u=m=>m.indexOf(" ")>0;if(!e)return;let d=u(t)?" ":"",p=z4(e?.standardGivenName??""),f=z4(e?.standardFamilyName??"");if(!t)return`${p}${d}${f}`;l(t)&&!o(t)&&!s(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),f=f.toLowerCase()):n(t)?(p=p.toUpperCase(),f=f.toUpperCase()):a(t)&&(f=f.toUpperCase());let h=`${p}${d}${f}`;return c(t)?h=f:s(t)&&(o(t)?h=`${f},${d}${p}`:h=`${f}${d}${p}`),h}function Frt({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,s=r&&i[r];if(r!==qo&&s){let{personFormat:o,doublesJoiner:l}=s;r===Wi&&(e.participantName=Zie({person:a,personFormat:o})),r===Ni&&(e.participantName=n?.map(c=>{let u=t[c]?.person;return Zie({person:u,personFormat:o})}).filter(Boolean).join(l??"/"))}}function NPe({tournamentRecord:t,formats:e}){if(!t)return{error:nt};if(!Xi(e))return{error:Yt};let i=t.participants??[],r=HIe(i,"participantId");for(let n of i)Frt({participant:n,participantMap:r,formats:e});return{...oe}}function BPe(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,s=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Yt,stack:"publicFindParticipant"};let o,l;for(let c of Object.values(s)){l=c.tournamentId;let u=c.participants||[];if(o=Sg({tournamentParticipants:u,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),o)break}return{participant:o,tournamentId:l,...oe}}function kPe({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=_Te,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:nt};if(!a)return{error:Yt,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:we};let s=(vn({participantFilters:{participantTypes:[Wi]},tournamentRecord:r}).participants??[]).map(u=>u.participantId);for(let u of t)if(!s.includes(u))return{error:cp,participantId:u};let o=Lt({participantId:n||hr(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:Lc,participantRole:i}),l=bf({participant:o,tournamentRecord:r});if(l.error)return l;let{topics:c}=Tu();return c.includes(Ug)&&Ii({topic:Ug,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...oe,participant:Dt(o)}}function xPe({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:nt};if(!i)return{error:ba};if(!e)return{error:Yt,info:"Missing participantName"};let{participant:r}=nv({tournamentRecord:t,participantId:i});if(!r)return{error:Fn};r.participantName=e;let{topics:n}=Tu();return n.includes($s)&&Ii({topic:$s,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...oe}}function _Pe({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:s,scaleAttributes:o,teamNameBase:l,teamsCount:c,eventId:u,event:d}){if(!s)return{error:nt};if(!Array.isArray(a)&&!wi(c)&&!u||!wi(r)||n&&!Array.isArray(n)||o&&(typeof o!="object"||!Object.keys(o).length))return{error:we};if(!o&&!n.length||!n&&!(e&&o))return{error:Yt,info:"Missing scaling details"};if(u&&!a){if(d?.eventType!==Jl)return{error:Th};a=d?.entries?.filter(({entryStatus:g})=>g===Sl).map(qi)}if(!a?.length&&!c)return{info:"Missing teamParticipantIds or teamsCount",error:Yt};let p=e??n.map(({participantId:g})=>g);i&&(a?.reverse(),r+=1),r>(a?.length||0)-1&&(r=0);let f=a?.slice(r).concat(...a.slice(0,r))??[],h=[];for(let g of s.participants??[]){let{participantId:v,participantType:b}=g;if(f.includes(v)){if(b!==qo)return{error:cp,participant:g};h.push(g)}}if(c&&h.length<c){let g=c-(h?.length||0),v=l??"Team",b=vt(0,g).map(S=>({participantName:`${v} ${S+1}`,participantType:qo,participantRole:xs})),{participants:y=[]}=Ed({participants:b,returnParticipants:!0,tournamentRecord:s}),I=y.map(qi),w=s.participants?.filter(({participantId:S})=>I.includes(S))??[];h.push(...w)}if(!h.length)return{error:j8};if(t)for(let g of h)g.individualParticipantIds=[];else{let g=h.map(v=>v).flat();e?.length?p=p.filter(v=>!g.includes(v)):n=n?.filter(({participantId:v})=>!g.includes(v))}if(!e?.length&&!n?.length)return{error:C2,info:"Nothing to be done"};if(!n.length){for(let g of s.participants??[]){let{participantId:v,participantType:b}=g;if(!p.includes(v))continue;if(b!==Wi)return{error:cp,participant:g};let y=lh({scaleAttributes:o,participant:g})?.scaleItem,I=o?.accessor?y?.scaleValue?.[o?.accessor]:y?.scaleValue,w={participantId:v,scaleValue:I};n.push(w)}if(!n.length)return{error:Fn}}n.sort((g,v)=>o?.sortOrder?(v?.scaleValue||0)-(g?.scaleValue||0):(g?.scaleValue||1/0)-(v?.scaleValue||1/0));for(let g of n)if(!g.participantId)return{error:we,scaledParticipant:g};let m=0;for(;m<n.length;){for(let g of h){if(m+1>n.length)break;let v=n[m];g.individualParticipantIds.push(v.participantId),m++}h.reverse()}let A=h.map(qi);for(let g of s.events??[]){if(g.eventType!==Jl)continue;let v=(g.entries??[]).filter(b=>A.includes(b.participantId));for(let b of v){let y=b.participantId,I=h.find(S=>S.participantId===y)?.individualParticipantIds;g.entries=(g.entries??[]).filter(S=>!I.includes(S.participantId)),(g.drawDefinitions??[]).forEach(S=>{S.entries=(S.entries??[]).filter(T=>!I.includes(T.participantId))});let{flightProfile:w}=kn({event:g});(w?.flights||[]).forEach(S=>{S.drawEntries=(S.drawEntries||[]).filter(T=>!I.includes(T.participantId))})}}return{...oe,scaledParticipants:n}}function OPe(t){let e=Qt(t,[{[Ua]:!0,[AY]:!0},{ratingType:!1,[Ps]:s=>qa[s]}]);if(e.error)return e;let i=`${t.ratingType}.${bY}`,r=t.asDynamic?i:t.ratingType,n=[Ly,sg,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let s of a)s.timeItems&&(s.timeItems=s.timeItems.filter(o=>o.itemType!==n));return{...oe}}function FPe(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:bn};for(let i of Object.values(e)){let r=Lrt({...t,tournamentRecord:i});if(r.error&&r.error!==HT)return r}return{...oe}}function Lrt({tournamentRecord:t,penaltyId:e}){if(!t)return{error:nt};if(!e)return{error:$8};let i=t?.participants??[],r=[],n=!1,a;return i.forEach(s=>{let o=!1;s.penalties=(s.penalties??[]).filter(l=>(l.penaltyId===e&&(o=!0,n||(a=l,n=!0)),o&&r.push(s),l.penaltyId!==e))}),a&&Ii({topic:$s,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...oe,penalty:a}:{error:HT}}var $rt=({penaltyId:t=hr()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),LPe=$rt;function $Pe(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:bn};for(let i of Object.values(e)){let r=Hrt({...t,tournamentRecord:i});if(r.error&&r.error!==HT||r.success)return r}return{error:HT}}function Hrt({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:nt};if(!e)return{error:we,modifications:e};if(!i)return{error:$8};let r=t?.participants??[],n=Object.keys(LPe()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:E2};let s,o=[];return r.forEach(l=>{let c=!1;l.penalties=(l.penalties??[]).map(u=>(u.penaltyId===i&&(c=!0,a.forEach(d=>Object.assign(u,{[d]:e[d]})),s||(s=u)),u)),c&&o.push(l)}),s&&Ii({topic:$s,payload:{tournamentId:t.tournamentId,participants:o}}),s?{...oe,penalty:s}:{error:HT}}function HPe(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:Ei(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=Ei(t[n].map(s=>JSON.stringify(s)).concat(e[n].map(s=>JSON.stringify(s)))).map(s=>JSON.parse(s));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=HPe(t[n],e[n],i):r[n]=e[n];return r},{})}function VPe({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:nt};e.participants||(e.participants=[]);let r=t.filter(rc(Nh)).map(c=>({[c.participantId]:c})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(c=>{if(n[c.participantId]){let u=HPe(c,n[c.participantId],i);return a.push(u),u}return c});let s=e.participants.map(rc(Nh))||[],o=t.filter(({participantId:c})=>!s.includes(c)),{topics:l}=Tu();return o.length&&(e.participants=e.participants.concat(...o),l.includes(Ug)&&Ii({topic:Ug,payload:{participants:o}})),a.length&&l.includes($s)&&Ii({topic:$s,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:o.length,...oe}}function GPe(t){let{tournamentRecord:e,participantIds:i}=t,r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n;for(let a of Object.values(r)){let s=(vn({tournamentRecord:a}).participants??[])?.map(qi).filter(o=>i.includes(o));s.length&&(n=Vrt({...t,penaltyId:t.penaltyId??n,tournamentRecord:a,participantIds:s}).penaltyId)}return n?{...oe,penaltyId:n}:{error:Fn}}function Vrt({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:s,matchUpId:o,issuedAt:l,notes:c}){if(!e)return{error:nt};if(!i)return{error:ba};if(!n)return{error:kwe};let u=(e?.participants??[]).filter(f=>i.includes(f.participantId));if(!u.length)return{error:Fn};let d=new Date().toISOString(),p=Object.assign(LPe({penaltyId:s}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:o,createdAt:d,issuedAt:l,notes:c});return Array.isArray(a)&&a.forEach(f=>ur({element:p,extension:f})),u.forEach(f=>{f.penalties||(f.penalties=[]),f.penalties.push(p)}),Ii({topic:$s,payload:{tournamentId:e.tournamentId,participants:u}}),{...oe,penaltyId:p.penaltyId}}function QPe({participantRole:t=xs,tournamentRecord:e,persons:i}){if(!e)return{error:nt};if(!Array.isArray(i))return{error:we};if(!Object.keys(d7).includes(t))return{error:Swe};let r=new Set((e.participants||[]).map(({person:h})=>h?.personId).filter(Boolean)),n=[],a=i.filter(h=>h&&(!h.personId||!r.has(h.personId))).map(h=>(h.personId||(h.personId=hr()),n.push(h.personId),h)),s=(h,m)=>Object.assign({},...Object.keys(h).filter(A=>!m.includes(A)).map(A=>({[A]:h[A]}))),o=a.map(h=>Lt({extensions:h.participantExtensions,timeItems:h.participantTimeItems,participantType:Wi,participantRole:t,person:s(h,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,c,u=Ed({participants:o,tournamentRecord:e});if(u.error)return u;c=u.addedCount||0;let d=[],p=vn({participantFilters:{participantTypes:[Wi]},tournamentRecord:e})?.participants??[];if(t===xs&&i.filter(({pairedPersons:h})=>h).forEach(({personId:h,pairedPersons:m})=>{Array.isArray(m)&&m.forEach(A=>{let g=[h,A.personId].map(v=>Sg({tournamentParticipants:p,personId:v})).filter(Boolean);if(g.length===2){let v=g.map(qi);d.push(Lt({extensions:A.participantExtensions,timeItems:A.timeItems,participantRole:xs,individualParticipantIds:v,participantType:Ni}))}})}),d.length){if(u=Ed({participants:d,tournamentRecord:e}),u.error)return u;l=u.addedCount||0}let f=c+l;return{...oe,addedCount:f,newPersonIds:n}}var jPe={};Li(jPe,{bulkUpdatePublishedEventIds:()=>E9,getAllEventData:()=>D9,getCourtInfo:()=>l$,getDrawData:()=>H$,getEventData:()=>V$,getEventPublishStatus:()=>Ru,getPublishState:()=>gS,getTournamentPublishStatus:()=>VM,getVenueData:()=>eC,mutate:()=>zPe,publishEvent:()=>xE,publishEventSeeding:()=>qPe,publishOrderOfPlay:()=>ZPe,publishParticipants:()=>XPe,query:()=>NDe,setEventDisplay:()=>iH,unPublishEvent:()=>JPe,unPublishEventSeeding:()=>WPe,unPublishOrderOfPlay:()=>YPe,unPublishParticipants:()=>KPe});var zPe={};Li(zPe,{publishEvent:()=>xE,publishEventSeeding:()=>qPe,publishOrderOfPlay:()=>ZPe,publishParticipants:()=>XPe,setEventDisplay:()=>iH,unPublishEvent:()=>JPe,unPublishEventSeeding:()=>WPe,unPublishOrderOfPlay:()=>YPe,unPublishParticipants:()=>KPe});function qPe({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=$c,drawIds:a=[],event:s}){if(!r)return{error:nt};if(!s)return{error:Gr};let o=Ru({event:s,status:n}),l=(o?.seeding?.seedingScaleNames||i)&&{...o?.seeding?.seedingScaleNames,...i},c=(o?.seeding?.stageSeedingScaleNames||e)&&{...o?.seeding?.stageSeedingScaleNames,...e},u=Lt({stageSeedingScaleNames:c,seedingScaleNames:l,published:!0,drawIds:a});return kE({statusObject:{seeding:u},removePriorValues:t,status:n,event:s}),Ii({topic:GUe,payload:{tournamentId:r.tournamentId,eventId:s.eventId,drawIds:a}}),{...oe}}function WPe({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=$c,drawIds:n,stages:a,event:s}){if(!i)return{error:nt};if(!s)return{error:Gr};let o=Ru({event:s});if(o){let l=o.seeding;if(Array.isArray(a)&&l.stageSeedingScaleNames)for(let c of a)l.stageSeedingScaleNames[c]&&delete l.stageSeedingScaleNames[c];Array.isArray(e)&&l?.seedingScaleNames&&(l.seedingScaleNames=l.seedingScaleNames.filter(c=>!e.includes(c))),Array.isArray(n)&&l?.drawIds&&(l.drawIds=l.drawIds.filter(c=>!n.includes(c))),(!Object.values(l.stageSeedingScaleNames??{}).length&&!l.seedingScaleNames?.length&&!l.drawIds?.length||!a&&!e&&!n?.length)&&(delete l.stageSeedingScaleNames,delete l.seedingScaleNames,delete l.drawIds,l.published=!1),kE({statusObject:{seeding:l},removePriorValues:t,status:r,event:s})}return Ii({topic:HY,payload:{tournamentId:i.tournamentId,eventId:s.eventId}}),{...oe}}function KPe(t){let e=Cu(t);if(!Object.keys(e).length)return{error:bn};for(let i of Object.values(e)){let r=Grt({tournamentRecord:i,...t});if(r.error)return r}return{...oe}}function Grt({removePriorValues:t=!0,tournamentRecord:e,status:i=$c}){if(!e)return{error:nt};let r=`${av}.${sv}`,{timeItem:n}=Eu({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].participants,Bf({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),Ii({payload:{tournamentId:e.tournamentId},topic:$Ye}),{...oe}}function YPe(t){let e=Cu(t);if(!Object.keys(e).length)return{error:bn};for(let i of Object.values(e)){let r=Qrt({tournamentRecord:i,...t});if(r.error)return r}return{...oe}}function Qrt({removePriorValues:t=!0,tournamentRecord:e,status:i=$c}){if(!e)return{error:nt};let r=`${av}.${sv}`,{timeItem:n}=Eu({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Bf({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),Ii({topic:VY,payload:{tournamentId:e.tournamentId}}),{...oe}}function XPe(t){let e=Cu(t);if(!Object.keys(e).length)return{error:bn};for(let i of Object.values(e)){let r=jrt({tournamentRecord:i,...t});if(r.error)return r}return{...oe}}function jrt({removePriorValues:t,tournamentRecord:e,status:i=$c}){if(!e)return{error:nt};let r=`${av}.${sv}`,{timeItem:n}=Eu({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i].participants={published:!0},Bf({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),Ii({payload:{tournamentId:e.tournamentId},topic:jUe}),{...oe}}function ZPe(t){let e=Cu(t);if(!Object.keys(e).length)return{error:bn};for(let i of Object.values(e)){let r=zrt({tournamentRecord:i,...t});if(r.error)return r}return{...oe}}function zrt({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=$c,eventIds:n=[]}){if(!i)return{error:nt};let a=`${av}.${sv}`,{timeItem:s}=Eu({element:i,itemType:a}),o=s?.itemValue||{[r]:{}};return o[r].orderOfPlay={published:!0,scheduledDates:t,eventIds:n},Bf({timeItem:{itemValue:o,itemType:a},element:i,removePriorValues:e}),Ii({topic:QUe,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...oe}}function JPe({removePriorValues:t=!0,tournamentRecord:e,status:i=$c,event:r}){if(!e)return{error:nt};if(!r)return{error:Gr};let n=`${av}.${sv}`,{timeItem:a}=EM({itemType:n,event:r}),s=a?.itemValue||{[i]:{}};return delete s[i].structureIds,delete s[i].drawDetails,delete s[i].drawIds,wS({event:r,timeItem:{itemValue:s,itemType:n},removePriorValues:t}),kE({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),Ii({topic:$Y,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...oe}}var e1e={};Li(e1e,{getEntryStatusReports:()=>Wrt,getParticipantStats:()=>qrt,getStructureReports:()=>Yrt,getVenuesReport:()=>int});function qrt({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:s,matchUps:o}){if(!n)return{error:nt};if(o&&!Array.isArray(o))return{error:wl};if(o=o??as({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!o?.length)return{error:mA};let l=[];e&&l.push(e),r&&l.push(r);let c=l.length?{participantIds:l}:{participantTypes:[qo]},u=vn({participantFilters:c,tournamentRecord:n}).participants??[];if(!u.every(({participantType:S})=>S===qo))return{error:Ll};l.length||l.push(...u.map(qi));let d=new Map,p=new Map,f=new Map,h=new Map,m=(S,T="")=>p.get(S)||p.set(S,{participantName:T,participantId:S,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(S);for(let S of u){let{participantId:T,individualParticipantIds:D}=S;h.set(T,D??[]),m(T,S.participantName)}if(r&&!h.get(r))return ce({result:{error:Fn},context:{teamParticipantId:r}});if(e&&!h.get(e))return ce({result:{error:Fn},context:{opponentParticipantId:e}});let A=[],g=S=>{let T=[[],[]];for(let C of S){let E=C.participant;if(E?.participantName){d.set(E.participantId,{participantName:E.participantName,ratings:E.ratings});let P=p.get(E.participantId);P&&(P.participantName=E.participantName)}}let D=({side:C,individualParticipantIds:E})=>C.participantId&&(!E?.length||E.includes(C.participantId))&&[C.participantId]||C.participant?.individualParticipantIds?.length&&(!E?.length||Mn(E,C.participant?.individualParticipantIds).length===C.participant?.individualParticipantIds?.length)&&C.participant.individualParticipantIds;if(h.size){let C=(E,P)=>{for(let R of S){if(!R.participant)continue;let M=D({individualParticipantIds:P,side:R});if(M?.length){let N=R.sideNumber;if(!N)continue;let k=[E];i&&k.push(...M),T[N-1]=k;let O=p.get(E);for(let x of M.filter(Boolean))O&&!O.competitorIds.includes(x)&&O.competitorIds.push(x)}}};if(r)(!e||S.every(E=>E.participant&&(D({individualParticipantIds:h.get(r),side:E})||D({individualParticipantIds:h.get(e),side:E}))))&&C(r,h.get(r));else for(let[E,P]of h)C(E,P)}else if(i)for(let C of S){if(!C.participant)continue;let E=D({individualParticipantIds:[],side:C}),P=C.sideNumber;P&&(T[P-1]=E)}return T};for(let S of o){if(!Xi(S))return{error:wl};let{matchUpStatus:T,matchUpFormat:D,matchUpType:C,winningSide:E,score:P,sides:R}=S;if(!R||!P||C===Pc||T==="BYE")continue;let M=g(R);if(!M.filter(Boolean).length)continue;let N=t&&E&&_M({matchUp:S})?.competitiveness;A.push(S);let k=x7({matchUpStatus:T,matchUpFormat:D,tallyPolicy:s,winningSide:E,score:P}),O=$Ce({matchUpStatus:T,matchUpFormat:D,tallyPolicy:s,winningSide:E,score:P}),{pointsTally:x,tiebreaksTally:F}=HCe({matchUpFormat:D,score:P});M.forEach((_,V)=>{for(let G of _){let z=d.get(G)?.participantName,Q=m(G,z);if(Q){let j=(ie,ue)=>ue.forEach((ne,ge)=>Q[ie][ge]+=ne),W=V?[...F].reverse():F,Y=V?[...x].reverse():x,X=V?[...O].reverse():O,J=V?[...k].reverse():k;if(j("tiebreaks",W),j("points",Y),j("games",X),j("sets",J),E){let ie=E-1===V?0:1;Q.matchUps[ie]+=1}if(N){let ie=N.toLowerCase();Q.competitiveness[ie]||(Q.competitiveness[ie]=[0,0]),Q.competitiveness[ie][V]+=1}if(T){let ie=T.toLowerCase();Q.matchUpStatuses[ie]||(Q.matchUpStatuses[ie]=0),Q.matchUpStatuses[ie]+=1}}}})}let v=["tiebreaks","matchUps","points","games","sets"],b=["competitive","routine","decisive"],y=new Map,I=(S,T)=>(S??0)+(T??0);for(let[S,T]of p.entries()){for(let D of v){let C=T[D].reduce(I);if(C){let E=T[D][0]/C,P=`${D}Ratio`,R=parseFloat(E.toFixed(2));T[P]=R,f.set(S,!0),y.has(P)||y.set(P,[]),y.get(P)?.push(R)}}for(let D of b){let C=T.competitiveness?.[D]?.reduce(I);if(C){let E=T.competitiveness[D][0]/C,P=`${D}Ratio`,R=parseFloat(E.toFixed(2));T[P]=R}}}if(!r){let S=(T,D)=>D-T;for(let T of p.values())for(let D of v){let C=`${D}Ratio`;if(typeof T[C]=="number"){let E=y.get(C)?.sort(S).indexOf(T[C]);if(typeof E=="number"&&E>=0){let P=`${D}Rank`;T[P]=E+1}}}}let w={relevantMatchUps:A,...oe};return r?(w.teamStats=p.get(r),e&&(w.opponentStats=p.get(e))):w.participatingTeamsCount=f.size,w.allParticipantStats=[...p.values()],w}function Z_({participant:t,eventType:e}){let i=t?.person?.personId,r=t?.person?.personOtherIds?.[0],n=t?.person?.tennisId,a=t?.ratings?.[e]?.find(({scaleName:c})=>c==="WTN"),s=a?.scaleValue,{wtnRating:o,confidence:l}=s||{};return{timeStamp:a?.scaleDate,personOtherId:r,confidence:l,wtnRating:o,personId:i,tennisId:n}}function Wrt({tournamentRecord:t}){if(!t)return{error:nt};let e=t.tournamentId,{participantMap:i}=vn({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(as({matchUpFilters:{matchUpTypes:[CI,By]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:f,matchUpType:h})=>f?.flatMap(m=>h===By?m?.participant?.individualParticipantIds:m?.participant?.participantId||m.participantId).filter(Boolean)).filter(Boolean),n=[],a={},s={},o={},l=0,c=({id:f,entry:h,eventId:m,eventType:A})=>{let{qualifyingSeeding:g,mainSeeding:v,entryStatus:b,entryStage:y,drawId:I}=h;a[f]||(a[f]=[]);let{participant:w,events:S}=i?.[f]??{},T=Z_({participant:w,eventType:A}),D=S?.[m]?.ranking;b===R7&&n.push(f),a[f].push({participantType:w?.participantType,participantId:f,tournamentId:e,eventType:A,eventId:m,drawId:I,entryStatus:b,entryStage:y,...T,ranking:D,mainSeeding:v,qualifyingSeeding:g})};for(let f of t.events??[]){let h={},m=S=>{h[S]||(h[S]={count:0}),h[S].count+=1},{drawDefinitions:A=[],eventType:g,eventId:v}=f,b=A.flatMap(S=>{let{drawId:T,entries:D}=S;l+=1;let C=({stage:M,stageSequence:N})=>M===Et&&N===1||M===qt,E=(S.structures??[]).filter(C).flatMap(({positionAssignments:M})=>M).filter(Boolean).map(({participantId:M})=>M),P=({participantId:M})=>E.includes(M),R=M=>{let{participantId:N,entryStatus:k,entryStage:O}=M;m(k);let x=i?.[N]?.draws?.[T]?.seedAssignments?.[Et];return{qualifyingSeeding:i?.[N]?.draws?.[T]?.seedAssignments?.[qt],participantId:N,mainSeeding:x,entryStatus:k,entryStage:O,drawId:T}};return D?.filter(P).map(R)}),y=S=>{let T=S.participantId,D=i?.[T].participant.individualParticipantIds?.filter(C=>r.includes(C));return T&&{[T]:{individualParticipantIds:D}}};g===jm?(()=>{let S=Object.assign({},...b.map(y).filter(Boolean)),T=D=>{S[D.participantId].individualParticipantIds.forEach(C=>{c({id:C,eventType:g,eventId:v,entry:D})})};b.forEach(T)})():b.forEach(S=>{c({id:S?.participantId,eventType:g,eventId:v,entry:S})});let I=Object.values(h).reduce((S,T)=>S+T.count,0);Object.keys(h).forEach(S=>{h[S].pct=h[S].count/I*100}),o[v]={tournamentId:e,eventId:v,entries:b,entryStatuses:h};let w=Object.assign({},...Nd.flatMap(S=>[{[S+"_count"]:h[S]?.count},{[S+"_pct"]:h[S]?.pct}]));s[v]={tournamentId:e,eventId:v,...w}}let u=Object.values(i??{}).filter(({participant:{participantType:f,participantRole:h}})=>f===Wi&&h===xs),d=u.filter(({participant:f})=>!r.includes(f.participantId)).map(({participant:f})=>f.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:u.length,eventsCount:Object.values(o).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(s).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(o).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function Krt({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=h=>{let m=h?.matchUpFormat;m&&(n[m]||(n[m]=0),n[m]+=1)},s=e.filter(h=>i?h.eventId===i:h.drawId===r).reduce((h,m)=>(a(m),(m.sides??[]).flatMap(A=>(A?.participant?.individualParticipants||[A?.participant]).filter(Boolean)).forEach(A=>h[A.participantId]=A),h),{}),o=Object.values(s),l=o.map(h=>Z_({participant:h,eventType:t})).filter(({wtnRating:h})=>h),c=(o.length-l.length)/o.length*100,u=l.reduce((h,m)=>{let{wtnRating:A,confidence:g}=m;return h.totalWTN+=A,h.totalConfidence+=g,h},{totalWTN:0,totalConfidence:0}),d=l?.length?u.totalWTN/l.length:0,p=l?.length?u.totalConfidence/l.length:0,f=Object.values(n).reduce((h,m)=>h+(m||0),0);return{matchUpFormatCounts:n,matchUpsCount:f,avgConfidence:p,pctNoRating:c,avgWTN:d}}function Yrt(t){let{tournamentRecord:e,extensionProfiles:i,firstFlightOnly:r,firstStageSequenceOnly:n=!0}=t;if(!e)return{error:LT};let a=[],s={},o={},l=[],c=A=>g=>g.structureId===A,u=Object.assign({},...(i??[]).map(({name:A,label:g,accessor:v})=>{let b=ki({element:e,name:A})?.extension?.value,y=v?ly({element:b,accessor:v})?.value:b;return{[g??A]:y}})),d=e?.tournamentId,p=as({participantsProfile:{withScaleValues:!0},tournamentRecord:e}).matchUps??[],f=A=>Eu({itemType:RY,itemSubTypes:[sh],element:{timeItems:A}})?.timeItem?.itemValue?.scaleBasis,h=({positionManipulations:A})=>{A?.forEach(g=>{let{structureId:v,name:b}=g,y=g.drawPositions??[g.drawPosition];s[v]??=[],s[v].push(`${b}: ${y.join("/")}`)})},m=e?.events?.flatMap(({timeItems:A,drawDefinitions:g=[],extensions:v,eventType:b,eventName:y,eventId:I,category:w})=>{let S=v?.find(N=>N.name===Ud)?.value?.flights?.map(N=>({[N.drawId]:N.flightNumber})),T=S&&Object.assign({},...S),D=v?.find(N=>N.name===sy),C=A?.find(N=>N.itemType===sy),E=D?.value?.length??C?.itemValue??0,P=Object.values(T??{}),R=T&&Math.min(...P),M=f(A);return o[I]={seedingBasis:M?JSON.stringify(M):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:E,tournamentId:d,eventId:I},g.filter(N=>!r||!S||T[N.drawId]===R).flatMap(N=>{let{matchUpFormat:k,tieFormat:O,timeItems:x,extensions:F,structures:_,drawName:V,drawType:G,drawId:z}=N,{matchUpFormatCounts:Q,matchUpsCount:j,avgConfidence:W,pctNoRating:Y,avgWTN:X}=Krt({eventType:b,matchUps:p,drawId:z}),J=f(x)??M,ie=Xrt({extensions:F}),ue=ie?.length??0;return h({positionManipulations:ie}),o[I].totalPositionManipulations+=ue,o[I].generatedDrawsCount+=1,ue>o[I].maxPositionManipulations&&(o[I].maxPositionManipulations=ue),_?.filter(ne=>(ne.stageSequence===1||!n)&&[qt,Et,Ls,Dn].includes(ne.stage)).map(ne=>{let ge=[Et,Dn].includes(ne.stage)?Zrt(p,ne.structureId):void 0;ne.stage===Et&&a.push({eventName:y,drawName:V,structureId:ne.structureId});let he=Jrt(ge)?.participant,Ie=ent(he),xe=tnt(he),Je=Z_({participant:xe?.[0]??he,eventType:b}),{personId:qe,personOtherId:dt,tennisId:ft,confidence:je,wtnRating:Tt}=Je||{},Oe=Z_({participant:xe?.[1],eventType:b}),{personId:mt,personOtherId:Le,tennisId:lt,confidence:it,wtnRating:Fe}=Oe||{},{ageCategoryCode:Xe,categoryName:ct,subType:We}=w??{},ht=ne.matchUpFormat??k,xt=(Q[ht]??0)/j*100,{tieFormatName:pe,tieFormatDesc:Se}=j_(O),{tieFormatName:ye,tieFormatDesc:ke}=j_(ne.tieFormat),Ce=Se===ke,Ke=!Ce&&ye,_e=ne.tieFormat&&!Ce&&ke,wt=ie?.filter(c(ne.structureId))?.length??0;return{...u,tournamentId:d,eventId:I,structureId:ne.structureId,drawId:z,eventType:b,category:We,categoryName:ct,ageCategoryCode:Xe,flightNumber:T?.[z],drawType:G,stage:ne.stage,seedingBasis:J?JSON.stringify(J):void 0,winningPersonId:qe,winningPersonOtherId:dt,winningPersonTennisId:ft,winningPersonWTNrating:Tt,winningPersonWTNconfidence:je,winningPerson2Id:mt,winningPerson2OtherId:Le,winningPerson2TennisId:lt,winningPerson2WTNrating:Fe,winningPerson2WTNconfidence:it,winningTeamId:Ie,positionManipulations:wt,pctNoRating:Y,matchUpFormat:ht,pctInitialMatchUpFormat:xt,matchUpsCount:j,drawTieFormatName:pe,drawTieFormatDesc:Se,tieFormatName:Ke,tieFormatDesc:_e,avgConfidence:W,avgWTN:X}})})});return a.forEach(({eventName:A,drawName:g,structureId:v})=>{s[v]?.length&&l.push({eventName:A,drawName:g,actions:s[v]})}),{eventStructureReports:Object.values(o),structureReports:m,flightReports:l}}function Xrt({extensions:t}){return t?.find(({name:e})=>e===eT)?.value?.slice(1)}function Zrt(t,e){return t.find(i=>i.structureId===e&&i.finishingRound===1&&i.winningSide)}function Jrt(t){if(t?.sides)return t.sides.find(e=>e.sideNumber===t.winningSide)}function ent(t){return t?.participantType===qo?t.participantId:void 0}function tnt(t){return t?.participantType===Ni?t.individualParticipants??[]:[]}function int({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){if(!Array.isArray(n))return{error:we,dates:n};if(!Array.isArray(r))return{error:we,venueIds:r};if(!(e&&Object.keys(e).filter(u=>!i||u===i)||[]).length)return{error:bn};if(!n.every(Ro))return{error:ma};let a=wA({tournamentRecords:e,ignoreDisabled:t,dates:n});if(a.error)return a;let s=a?.venues?.filter(({venueId:u})=>!r?.length||r.includes(u)),o=a.courts?.reduce((u,d)=>(d.dateAvailability?.forEach(p=>{let f=p.date;u.includes(f)||u.push(f)}),u),[]).filter(u=>!n.length||n.includes(u)),l={venueIds:s?.map(({venueId:u})=>u)},{matchUps:c}=up({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:s?.map(u=>rnt(o,u,c))}}function rnt(t,e,i){let{venueId:r,courts:n,venueName:a}=e,s={};return t.forEach(o=>{let l=0,c=0,u=0;for(let f of n){let h=f.dateAvailability.find(A=>A.date===o),m=(h&&_E({courtDate:h}).timeSlots)?.reduce((A,g)=>{let{startTime:v,endTime:b}=g,y=sr(b)-sr(v);return A+y},0);m&&(u+=1),l+=m}let d=i.filter(({schedule:f})=>f.venueId===r&&Eh(o,f.scheduledDate));d.forEach(({schedule:f})=>{let h=Kr(f.scheduledTime),m=gl(h,f.averageMinutes),A=sr(m)-sr(h);c+=A});let p=l?(c/l*100).toFixed(2):"100";s[o]={scheduledMatchUpsCount:d.length,availableCourts:u,availableMinutes:l,scheduledMinutes:c,percentUtilization:p}}),{venueId:r,venueName:a,venueReport:s}}var t1e={};Li(t1e,{addCourtGridBooking:()=>f1e,addMatchUpCourtOrder:()=>uX,addMatchUpEndTime:()=>pX,addMatchUpOfficial:()=>L0e,addMatchUpResumeTime:()=>hX,addMatchUpScheduleItems:()=>dH,addMatchUpScheduledDate:()=>cH,addMatchUpScheduledTime:()=>cv,addMatchUpStartTime:()=>dX,addMatchUpStopTime:()=>fX,addSchedulingProfileRound:()=>EX,allocateTeamMatchUpCourts:()=>uH,assignMatchUpCourt:()=>CS,assignMatchUpVenue:()=>FE,bulkRescheduleMatchUps:()=>c1e,bulkScheduleMatchUps:()=>gN,bulkScheduleTournamentMatchUps:()=>s1,bulkUpdateCourtAssignments:()=>a1e,calculateScheduleTimes:()=>MX,clearMatchUpSchedule:()=>d1e,clearScheduledMatchUps:()=>fH,courtGridRows:()=>q$,findMatchUpFormatTiming:()=>Q$,findVenue:()=>qh,generateBookings:()=>pH,generateVirtualCourts:()=>nH,getMatchUpsToSchedule:()=>G$,getPersonRequests:()=>Pb,getProfileRounds:()=>z$,getScheduledRoundsDetails:()=>lN,getSchedulingProfile:()=>SA,getSchedulingProfileIssues:()=>P9,matchUpScheduleChange:()=>u1e,modifyMatchUpFormatTiming:()=>W9,mutate:()=>i1e,proAutoSchedule:()=>n1e,proConflicts:()=>o1e,publicFindCourt:()=>i7,query:()=>ODe,removeCourtGridBooking:()=>h1e,removeEventMatchUpFormatTiming:()=>tH,removeMatchUpCourtAssignment:()=>r1e,reorderUpcomingMatchUps:()=>l1e,scheduleMatchUps:()=>s1e,scheduleProfileRounds:()=>hH,setMatchUpDailyLimits:()=>p1e,setMatchUpHomeParticipantId:()=>cX,setSchedulingProfile:()=>ME,toggleParticipantCheckInState:()=>sH,validateSchedulingProfile:()=>j$});var i1e={};Li(i1e,{addCourtGridBooking:()=>f1e,addMatchUpCourtOrder:()=>uX,addMatchUpEndTime:()=>pX,addMatchUpOfficial:()=>L0e,addMatchUpResumeTime:()=>hX,addMatchUpScheduleItems:()=>dH,addMatchUpScheduledDate:()=>cH,addMatchUpScheduledTime:()=>cv,addMatchUpStartTime:()=>dX,addMatchUpStopTime:()=>fX,addSchedulingProfileRound:()=>EX,allocateTeamMatchUpCourts:()=>uH,assignMatchUpCourt:()=>CS,assignMatchUpVenue:()=>FE,bulkRescheduleMatchUps:()=>c1e,bulkScheduleMatchUps:()=>gN,bulkScheduleTournamentMatchUps:()=>s1,bulkUpdateCourtAssignments:()=>a1e,calculateScheduleTimes:()=>MX,clearMatchUpSchedule:()=>d1e,clearScheduledMatchUps:()=>fH,findMatchUpFormatTiming:()=>Q$,generateBookings:()=>pH,generateVirtualCourts:()=>nH,matchUpScheduleChange:()=>u1e,modifyMatchUpFormatTiming:()=>W9,proAutoSchedule:()=>n1e,proConflicts:()=>o1e,removeCourtGridBooking:()=>h1e,removeEventMatchUpFormatTiming:()=>tH,removeMatchUpCourtAssignment:()=>r1e,reorderUpcomingMatchUps:()=>l1e,scheduleMatchUps:()=>s1e,scheduleProfileRounds:()=>hH,setMatchUpDailyLimits:()=>p1e,setMatchUpHomeParticipantId:()=>cX,setSchedulingProfile:()=>ME,toggleParticipantCheckInState:()=>sH,validateSchedulingProfile:()=>j$});function MX({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:s,scheduleDate:o,startTime:l,venueIds:c,endTime:u}){if(typeof a!="object"||!Object.keys(a).length)return{error:bn};s=s??aH({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=wA({dates:[o],ignoreDisabled:!0,tournamentRecords:a}),f=d?.filter(C=>!c||c.includes(C.venueId));l||(l=f?.reduce((C,E)=>{let P=E.dateAvailability?.find(R=>!R.date||Eh(o,R.date))?.startTime??E.startTime;return P&&(!C||sr(P)<sr(C))?P:C},void 0)),u||(u=f?.reduce((C,E)=>{let P=E.dateAvailability?.find(R=>!R.date||Eh(o,R.date))?.endTime??E.endTime;return P&&(!C||sr(P)>sr(C))?P:C},void 0));let h=Object.values(a),m=Object.assign({},...h.map(C=>(C.events??[]).map(E=>{let{scheduleTiming:P}=DM({tournamentRecord:C,event:E});return{[E.eventId]:{event:E,scheduleTiming:P}}})).flat()),A=dN({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:o,venueIds:c}}),g=A?.dateMatchUps??[],v=A?.completedMatchUps??[],b=[];b.push(...g),b.push(...v);let y={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},I=b?.map(({eventId:C,schedule:E,matchUpFormat:P})=>{let{event:R,scheduleTiming:M}=m[C],N=R?.eventType,k={...M,defaultTiming:y,matchUpFormat:P},{averageMinutes:O,recoveryMinutes:x}=o$({eventType:N,timingDetails:k}),{courtId:F,venueId:_}=E,V=Kr(E.scheduledTime),G=gl(V,O);return{recoveryMinutes:x,averageMinutes:O,periodLength:s,startTime:V,endTime:G,courtId:F,venueId:_}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:o,clearScheduleDates:n,periodLength:s,startTime:l,endTime:u,bookings:I,courts:f},{scheduleTimes:S}=rX(w),T=c?.length===1&&c[0]||p?.length===1&&p[0].venueId||void 0,D=b.map(_a);return{venueId:T,scheduleTimes:S,dateScheduledMatchUpIds:D}}function r1e(t){let e=Qt(t,[{[Js]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:r,tournamentId:n,courtDayDate:a,matchUpId:s,courtId:o,drawId:l}=t,c=r[n];if(!c)return{error:nt};let{drawDefinition:u,event:d}=lv({tournamentRecord:c,drawId:l});if(!u)return{error:kt};let p=Yr({drawDefinition:u,event:d,matchUpId:s});if(p.error)return p;if(p?.matchUp?.matchUpType===Pc){let{itemValue:f}=Tb({timeItems:p.matchUp.timeItems??[],itemType:xh}),h=o&&f.filter(m=>m.courtId!==o);return nc({duplicateValues:!1,removePriorValues:i,tournamentRecord:c,drawDefinition:u,matchUpId:s,timeItem:{itemType:xh,itemValue:h}})}else return CS({tournamentRecord:c,drawDefinition:u,courtDayDate:a,courtId:"",matchUpId:s})}function n1e({scheduleCompletedMatchUps:t,minCourtGridRows:e=10,tournamentRecords:i,scheduledDate:r,matchUps:n}){if(!Pu(n))return{error:we};if(n.some(({hasContext:h})=>!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:T2};let a=dN({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:e,tournamentRecords:i,matchUpFilters:{localPerspective:!0,scheduledDate:r}});if(a.error)return a;let{rows:s}=a,o=[],l=h=>[(h.sides||[]).map(m=>[m.participantId,m.participant?.individualParticipantIds]),(h.potentialParticipants||[]).flat().map(m=>[m.participantId,m.individualParticipantIds])].flat(1/0).filter(Boolean),c=s?.reduce((h,m)=>{let A=[],g=[];Object.values(m).forEach(b=>{if(Xi(b)&&(b.matchUpId&&(A.push(b.matchUpId),o.push(b)),b.sides)){let y=l(b);g.push(...y)}});let v=Object.values(m).filter(b=>Xi(b)&&!b.matchUpId&&!b.isBlocked);return h.concat({matchUpIds:A,availableCourts:v,rowId:m.rowId,participantIds:g})},[]);n.filter(({matchUpStatus:h})=>h&&h!=="BYE"&&(t||!ta.includes(h))).sort(AS);let u=Bd({matchUps:n.concat(o),includeParticipantDependencies:!0,tournamentRecords:i}).matchUpDependencies,d=[],p=[];for(;n.length&&c.length;){let h=c.shift(),m=[];for(;n.length&&h.availableCourts.length;){let A=n.concat(m).map(D=>D.matchUpId),g=n.shift(),v=g?.matchUpId,b=v&&u[v].matchUpIds.concat(u[v].dependentMatchUpIds),y=v&&A.some(D=>u[v].matchUpIds.includes(D)),I=v&&p.some(D=>u[v].dependentMatchUpIds.includes(D)),w=h.matchUpIds.some(D=>b.includes(D)),S=l(g),T=h.participantIds.some(D=>S.includes(D));if(g&&!w&&!y&&!T&&!I){let D=h.availableCourts.shift();Object.assign(g.schedule,D.schedule),Object.assign(D,g),d.push(g),h.participantIds.push(...S),h.matchUpIds.push(v)}else g&&m.push(g)}n.push(...m),p.push(...h.matchUpIds)}let f=d.map(({matchUpId:h,tournamentId:m,schedule:A,drawId:g})=>({tournamentId:m,matchUpId:h,drawId:g,schedule:{...A,scheduledDate:r}}));return a=gN({tournamentRecords:i,matchUpDetails:f}),{...a,scheduled:d,notScheduled:n}}function a1e(t){let{courtDayDate:e}=t,i=Qt(t,[{courtAssignments:!0,[rl]:qs,[Nc]:Yt},{[Js]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,s)=>{let{tournamentId:o}=s;return a[o]||(a[o]=[]),a[o].push(s),a},{}),n;return Object.keys(r).every(a=>{let s=t[Js][a];if(!s)return n={error:nt},!1;let o=r[a].reduce((l,c)=>{let{drawId:u}=c;return l[u]||(l[u]=[]),l[u].push(c),l},{});Object.keys(o).every(l=>{let{drawDefinition:c}=tl({tournamentRecord:s,drawId:l});return c?(o[l].every(u=>{let{matchUpId:d,courtId:p}=u,f=CS({tournamentRecord:s,drawDefinition:c,courtDayDate:e,matchUpId:d,courtId:p});if(f.success)return f?.success;n={error:jwe}}),!0):(n={error:kt},!1)})}),n||oe}function s1e(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:o={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:c={},checkPotentialRequestConflicts:u=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:f=30,scheduleDate:h,matchUpIds:m,venueIds:A,startTime:g,endTime:v,dryRun:b}=t,y=Qt(t,[{[Js]:!0,[bM]:!0},{[Ps]:Ro,[Nc]:ma,[lYe]:!0},{[Ps]:j=>!j||!isNaN(j),[pYe]:!1,[Nc]:we,[fYe]:!1,[hYe]:!1}]);if(y.error)return y;let I=t.competitionMatchUps??up({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??Bd({includeParticipantDependencies:!0,matchUps:I,tournamentRecords:e}).matchUpDependencies;I.forEach(j=>{j.schedule?.scheduledDate&&Eh(h,Ui(j.schedule.scheduledDate))&&rC({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:j})});let S=m.map(j=>I.find(W=>W.matchUpId===j)).filter(Boolean),{venueId:T,scheduleTimes:D,dateScheduledMatchUpIds:C}=MX({tournamentRecords:e,remainingScheduleTimes:d,startTime:Kr(g),endTime:Kr(v),scheduleDate:Ui(h),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:f,venueIds:A}),E={},P=[],R={},M={},N={};I.filter(({matchUpId:j})=>C?.includes(j)).forEach(j=>{f3({matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUp:j,value:1});let W=j.schedule?.scheduledTime;if(W){R[j.matchUpId]=W;let Y=a?.[j.matchUpId];a1({recoveryMinutes:Y||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:W,matchUp:j})}});let k=S.filter(j=>{let W=C?.includes(j.matchUpId),Y=["BYE",Nr,Hn,tc,Ha,Zr].includes(j?.matchUpStatus);return!W&&!j.winningSide&&!Y}),{matchUpMap:O,overLimitMatchUpIds:x,participantIdsAtLimit:F}=k.reduce((j,W)=>{let{drawId:Y,tournamentId:X,matchUpType:J}=W,{participantIdsAtLimit:ie,relevantParticipantIds:ue}=SX({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,matchUpDailyLimits:c,matchUp:W});return ie?.length?(j.overLimitMatchUpIds.push(W.matchUpId),j.participantIdsAtLimit.push(...ie),j):(ue.forEach(ne=>{mN({individualParticipantProfiles:o,participantId:ne});let ge=o[ne].counters;ge[J]?ge[J]+=1:ge[J]=1,ge[dd]?ge[dd]+=1:ge[dd]=1}),j.matchUpMap[X]||(j.matchUpMap[X]={}),j.matchUpMap[X][Y]?j.matchUpMap[X][Y].push(W):j.matchUpMap[X][Y]=[W],rC({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:W}),j)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});k=k.filter(({matchUpId:j})=>!x.includes(j));let _=0,V=D?.length??0,{personRequests:G}=Pb({tournamentRecords:e,requestType:AN});for(;D?.length&&k.length&&_<=V;){_++;let{scheduleTime:j}=D.shift(),W=k.find(Y=>{let{matchUpId:X}=Y,{dependenciesScheduled:J,remainingDependencies:ie}=bX({matchUpScheduleTimes:R,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:Y});if(!J)return N[X]||(N[X]=[]),N[X].push({scheduleTime:j,remainingDependencies:ie}),!1;let{enoughTime:ue}=wX({individualParticipantProfiles:o,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:j,matchUp:Y});if(!ue)return M[X]||(M[X]=[]),M[X].push({scheduleTime:j}),!1;let{conflicts:ne}=IX({potentials:u,averageMatchUpMinutes:r,requestConflicts:E,personRequests:G,scheduleTime:j,scheduleDate:h,matchUp:Y});if(ne?.length)return!1;let ge=a?.[Y.matchUpId];return a1({recoveryMinutes:ge||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:j,matchUp:Y}),R[Y.matchUpId]=j,!0});k=k.filter(({matchUpId:Y})=>Y!==W?.matchUpId),W||P.push(j)}k.forEach(j=>{f3({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,value:-1,matchUp:j})});let z=[];Object.keys(O).forEach(j=>{let W=e[j];W&&Object.keys(O[j]).forEach(Y=>{let{drawDefinition:X}=lv({tournamentRecord:W,drawId:Y});X&&O[j][Y].forEach(({matchUpId:J})=>{let ie=R[J];if(ie){let ue=ie.split(":").map(ru).join(":"),ne=`${Ui(h)}T${ue}`;b?z.push(J):(cv({drawDefinition:X,matchUpId:J,scheduledTime:ne}).success&&z.push(J),T&&FE({tournamentRecords:e,tournamentRecord:W,drawDefinition:X,matchUpId:J,venueId:T}))}})})});let Q=CY(k);return{...oe,requestConflicts:Object.values(E),remainingScheduleTimes:D?.map(({scheduleTime:j})=>j),individualParticipantProfiles:o,matchUpNotBeforeTimes:l,participantIdsAtLimit:F,skippedScheduleTimes:P,overLimitMatchUpIds:x,scheduledMatchUpIds:z,noTimeMatchUpIds:Q,recoveryTimeDeferred:M,dependencyDeferred:N}}function o1e({tournamentRecords:t,matchUps:e}){if(!Pu(e))return{error:mA};if(e.some(({matchUpId:g,hasContext:v})=>g&&!v))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:T2};let i=Math.max(...e.map(({schedule:g})=>g?.courtOrder||1).map(g=>ci(g))),r=vt(1,i+1).map(g=>e.filter(v=>ci(v.schedule?.courtOrder)===g)),n={},a={},s={};r.flat().filter(Boolean).sort(AS).forEach(({schedule:g})=>delete g[qk]);let o=Ei(e.map(({drawId:g})=>g)),l=Bd({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:o}).matchUpDependencies,c=r.map((g,v)=>g.reduce((b,y)=>{if(!y.matchUpId)return b;let{matchUpId:I,winnerMatchUpId:w,loserMatchUpId:S,schedule:T,sides:D,potentialParticipants:C}=y,E=T?.courtId;n[I]=v,a[E]=[],b.matchUpIds.push(I),s[I]=y;let P=l[I].matchUpIds;P.length&&b.sourceMatchUpIds.push(...P);let R=D?.flatMap(N=>[N.participant?.individualParticipantIds,N.participantId]).flat().filter(Boolean)??[],M=C?.flat().flatMap(({individualParticipantIds:N,participantId:k})=>[N,k]).flat().filter(Boolean)||[];return b.participantIds.push(...M,...R),w&&b.targetMatchUpIds.push(w),S&&b.targetMatchUpIds.push(S),b},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),u=(g,v)=>l[g].sources.reduce((b,y,I)=>y.includes(v)&&I+1||b,0),d=c.map(()=>[]),p=(g,v,b)=>{b[g]||(b[g]={}),b[g][Rv]||(b[g][Rv]=v.filter(y=>y!==g))},f=(g,v,b)=>{v.participantIds.filter(y=>g.participantIds.includes(y)).forEach(y=>{let I=v.matchUpIds.concat(g.matchUpIds).filter(w=>l[w].participantIds.includes(y));I.forEach(w=>{p(w,I,b)})})},h=(g,v,b)=>{b[g]||(b[g]={}),b[g][Pv]||(b[g][Pv]=v.filter(y=>y!==g))},m=g=>{let v={},b=Xl(g.participantIds),y=new Set(Object.keys(b).filter(w=>b[w]>1)),I=g.matchUpIds.filter(w=>l[w].participantIds.some(S=>y.has(S)));return I.forEach(w=>{h(w,I,v)}),v},A=(g,v,b,y)=>{if(!s[g].schedule[qk]){s[g].schedule[qk]=v,s[g].schedule[bTe]=y,d[n[g]].push({matchUpId:g,issueType:b,issueIds:y,issue:v});let I=s[g].schedule.courtId;a[I]||(a[I]=[]),a[I].push({matchUpId:g,issue:v,issueType:b,issueIds:y})}};return c.forEach((g,v)=>{let b=v?c[v-1]:void 0,y=c.slice(v+1),I=m(g);b&&f(b,g,I),g.matchUpIds.forEach(w=>{let S=l[w].matchUpIds;for(let D of y){let C=D.matchUpIds.filter(E=>S.includes(E));C?.length&&(C.forEach(E=>A(E,V4,YA,[w])),A(w,V4,YA,C))}if(I[w]?.[Pv]&&A(w,Pv,H4,I[w][Pv]),g.sourceMatchUpIds.includes(w)){let D=g.matchUpIds.filter(C=>l[C].matchUpIds.includes(w));A(w,Pv,YA,D),g.matchUpIds.filter(C=>l[C].matchUpIds.includes(w)).forEach(C=>A(C,Pv,YA,[w]))}let T=b?.matchUpIds?.filter(D=>u(w,D)>1);if(T?.length&&(A(w,G4,YA,T),T.forEach(D=>A(D,G4,YA,[w]))),I[w]?.[Rv]&&A(w,Rv,H4,I[w][Rv]),b?.targetMatchUpIds?.includes(w)){let D=s[w].schedule.courtId,C=S.filter(E=>b.matchUpIds.includes(E));C.some(E=>s[E].schedule.courtId===D)||(C.forEach(E=>A(E,Rv,YA,[w])),A(w,Rv,YA,C))}})}),{courtIssues:a,rowIssues:d}}function l1e(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return ce({result:{error:bn},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return ce({result:{error:Yt},stack:e});let a=r?.length;if(!a)return{...oe};let s=0;return r.forEach((l,c)=>{let{tournamentId:u,drawId:d,matchUpId:p}=l,f=c+(n?-1:1);f<0&&(f=a-1),f===a&&(f=0);let h=r[f].schedule.scheduledTime,m=o({tournamentId:u,scheduledTime:h,matchUpId:p,drawId:d});if(m.success)s++;else return m}),s===a?oe:ce({result:{error:Qwe},stack:e});function o({tournamentId:l,scheduledTime:c,matchUpId:u,drawId:d}){let p=i[l],{drawDefinition:f}=lv({tournamentRecord:p,drawId:d});return f?cv({drawDefinition:f,scheduledTime:c,matchUpId:u}):{error:Rc}}}function c1e(t){let{scheduleChange:e,matchUpIds:i,dryRun:r}=t;if(!i||!Array.isArray(i))return{error:Jw};if(typeof e!="object")return{error:we};let n=Cu(t),a=[],s=[];for(let l of Object.values(n)){let c=nnt({tournamentRecord:l,scheduleChange:e,matchUpIds:i,dryRun:r});if(c.error)return c;Array.isArray(c.notRescheduled)&&s.push(...c.notRescheduled);let u=CY(c.notRescheduled),d=[];c.rescheduled?.forEach(p=>{let{matchUpId:f}=p;u.includes(f)&&d.push(f),a.push(p)}),d.length&&(s=c?.notRescheduled?.filter(({matchUpId:p})=>!d.includes(p))||[])}let o=!!(a.length&&!s.length);return{...oe,rescheduled:a,notRescheduled:s,allRescheduled:o}}function nnt({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){if(!t)return{error:nt};if(!i||!Array.isArray(i))return{error:Jw};if(typeof e!="object")return{error:we};let n=[],a=[],{minutesChange:s,daysChange:o}=e;if(!s&&!o)return{...oe};if(s&&isNaN(s))return{error:we};if(o&&isNaN(o))return{error:we};let{matchUps:l}=as({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),c=({matchUpStatus:y})=>!ta.includes(y),u=l?.filter(y=>uN({schedule:y.schedule})).filter(y=>c({matchUpStatus:y.matchUpStatus}));if(!u?.length)return{...oe};let{tournamentInfo:d}=US({tournamentRecord:t}),{startDate:p,endDate:f}=d,h=u?.reduce((y,I)=>{let{matchUpId:w,drawId:S}=I;return y[S]?y[S].push(w):y[S]=[w],y},{}),m=1440;for(let y of Object.keys(h)){let I=lv({tournamentRecord:t,drawId:y});if(I.error)return I;let w=I.drawDefinition,S=h[y].filter(T=>i.includes(T));for(let T of S)if(T&&w){let D=u.find(N=>N.matchUpId===T)?.schedule,{scheduledTime:C,scheduledDate:E}=D,P,R,M;if(!P&&o&&E){let N=Ui(E);M=MD(N,o),P=new Date(M)<new Date(p)||new Date(M)>new Date(f)}if(s&&C){let N=Ui(C),k=sr(Kr(C))+s;if(P=k<0||k>m,!P){let O=gl(C,s),x=N&&M||E===N&&N;R=x?`${x}T${O}`:O}}if(P)a.push(T);else{if(!r){if(R){let N=cv({scheduledTime:R,drawDefinition:w,matchUpId:T});if(N.error)return N}if(M){let N=cH({scheduledDate:M,drawDefinition:w,matchUpId:T});if(N.error)return N}}(R||M)&&n.push(T)}}}let A=as({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],g=A.filter(({matchUpId:y})=>n.includes(y)),v=A.filter(({matchUpId:y})=>a.includes(y)),b=g.length&&!v.length;return{...oe,rescheduled:g,notRescheduled:v,allRescheduled:b}}function u1e(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:bn};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:s,courtDayDate:o}=t||{},{drawId:l,matchUpId:c,tournamentId:u}=r||{},{drawId:d,matchUpId:p,tournamentId:f}=n||{};if(!c&&!p)return ce({result:{error:Yt},stack:e});let{matchUps:h}=up({matchUpFilters:{matchUpIds:[c,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=h?.find(({matchUpId:y})=>y===c),A=h?.find(({matchUpId:y})=>y===p),g=0;if(s&&c&&!p){let y=v({tournamentId:u,matchUpId:c,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(y?.success&&g++,y.error)return ce({result:y,stack:e})}else if(a&&s&&c&&p){let y=v({tournamentId:u,matchUpId:c,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(y.success&&g++,y.error)return ce({result:y,stack:e,info:"source"});let I=v({tournamentId:f,sourceCourtId:s,matchUpId:p,matchUp:A,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:o});if(I.success&&g++,I.error)return ce({result:I,stack:e,info:"target"})}else return{error:Yt};return g?oe:ce({result:{error:fE},stack:e});function v(y){let{tournamentRecords:I,tournamentId:w,matchUp:S,drawId:T}=y,D=I[w],{drawDefinition:C}=lv({tournamentRecord:D,drawId:T});return S.matchUpType===Hr?b({...y,tournamentRecord:D,drawDefinition:C}):CS({...y,tournamentRecord:D,drawDefinition:C})}function b({removePriorValues:y,tournamentRecords:I,tournamentRecord:w,drawDefinition:S,sourceCourtId:T,courtDayDate:D,matchUpId:C,matchUp:E,courtId:P}){let R=[P].concat(E.schedule.allocatedCourts.map(({courtId:M})=>M).filter(M=>M!==T));return uH({removePriorValues:y,tournamentRecords:I,tournamentRecord:w,drawDefinition:S,courtDayDate:D,matchUpId:C,courtIds:R})}}function d1e({scheduleAttributes:t=[xh,Eg,dS,pS,fS,zd,Zm,oh,Tm],tournamentRecord:e,drawDefinition:i,matchUpId:r}){let n="clearMatchUpSchedule",a=i?No({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps?.[0]:as({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps?.[0];if(!a)return{error:Zs};let s=(a.timeItems??[]).filter(o=>o?.itemType&&!t.includes(o?.itemType));return a.timeItems=s,Zi({tournamentId:e.tournamentId,context:n,drawDefinition:i,matchUp:a}),{...oe}}function p1e(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:bn};if(typeof r!="object")return{error:AA};let a=Object.keys(n).filter(s=>!i||i===s);if(i&&!a.includes(i))return{error:we};for(let s of a){let o=n[s],l=ur({extension:{name:wM,value:{dailyLimits:r}},element:o});if(l.error)return l}return{...oe}}function f1e(t){let{tournamentRecord:e,disableNotice:i,scheduledDate:r,bookingType:n,courtOrder:a,rowCount:s=1,courtId:o,notes:l}=t;if(!e)return ce({result:{error:we},info:"tournamentRecord is required"});if(!o)return{error:Gm};if(!r)return ce({result:{error:we},info:"scheduledDate is required"});if(!n)return ce({result:{error:we},info:"bookingType is required"});if(a==null)return ce({result:{error:we},info:"courtOrder is required"});if(!Number.isInteger(a)||a<1)return ce({result:{error:we},info:"courtOrder must be a positive integer"});if(!Number.isInteger(s)||s<1)return ce({result:{error:we},info:"rowCount must be a positive integer"});let{court:c,venue:u}=ov({tournamentRecord:e,courtId:o});if(!c)return{error:Gm};if(!Pg({court:c,date:r})){c.dateAvailability||(c.dateAvailability=[]);let f={date:r,bookings:[]};c.dateAvailability.push(f)}let d=Pg({court:c,date:r});if(d.bookings){for(let f of d.bookings)if(typeof f.courtOrder=="number"){let h=f.courtOrder,m=h+(f.rowCount||1)-1,A=a,g=a+s-1;if(A<=m&&g>=h)return ce({result:{error:Owe},info:`Booking conflicts with existing booking at rows ${h}-${m}`})}}let p={courtOrder:a,rowCount:s,bookingType:n,notes:l,createdAt:new Date().toISOString()};return d.bookings||(d.bookings=[]),d.bookings.push(p),!i&&u&&Ii({payload:{venue:u,tournamentId:e.tournamentId},topic:vA,key:u.venueId}),{...oe,booking:p}}function h1e(t){let{tournamentRecord:e,disableNotice:i,scheduledDate:r,courtOrder:n,courtId:a}=t;if(!e)return ce({result:{error:we},info:"tournamentRecord is required"});if(!a)return{error:Gm};if(!r)return ce({result:{error:we},info:"scheduledDate is required"});if(n==null)return ce({result:{error:we},info:"courtOrder is required"});let{court:s,venue:o}=ov({tournamentRecord:e,courtId:a});if(!s)return{error:Gm};let l=Pg({court:s,date:r});if(!l?.bookings)return ce({result:{error:D4},info:"No bookings found for this date"});let c=l.bookings.findIndex(d=>d.courtOrder===n);if(c===-1)return ce({result:{error:D4},info:`No booking found at row ${n}`});let u=l.bookings.splice(c,1)[0];return!i&&o&&Ii({payload:{venue:o,tournamentId:e.tournamentId},topic:vA,key:o.venueId}),{...oe,booking:u}}var m1e={};Li(m1e,{addCollectionDefinition:()=>kX,addCollectionGroup:()=>I1e,aggregateTieFormats:()=>S1e,compareTieFormats:()=>Jm,getTieFormat:()=>$$,modifyCollectionDefinition:()=>NX,modifyTieFormat:()=>w1e,mutate:()=>A1e,orderCollectionDefinitions:()=>y1e,query:()=>RDe,removeCollectionDefinition:()=>BX,removeCollectionGroup:()=>v1e,tieFormatGenderValidityCheck:()=>k2,validateCollectionDefinition:()=>mM});var A1e={};Li(A1e,{addCollectionDefinition:()=>kX,addCollectionGroup:()=>I1e,aggregateTieFormats:()=>S1e,modifyCollectionDefinition:()=>NX,modifyTieFormat:()=>w1e,orderCollectionDefinitions:()=>y1e,removeCollectionDefinition:()=>BX,removeCollectionGroup:()=>v1e});function qy({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:s}){let o="getTieFormat",l;if(e=r?.structureId??e,i=n?.matchUpId??i,(i||e)&&!t)return{error:kt};if(a&&s)l=Mp(s);else if(i){if(t&&(!n||!r)){let c=Yr({drawDefinition:t,matchUpId:i});if(c.error)return c;if(c.matchUp?.matchUpType!==Pc)return ce({result:{error:wl},stack:o});r||(r=c.structure),n||(n=c.matchUp)}l=m0({item:n,drawDefinition:t,structure:r,event:s})||m0({item:r,drawDefinition:t,structure:r,event:s})||Mp(t)||Mp(s)}else if(t&&e){if(!r){let c=di({drawDefinition:t,structureId:e});if(c.error)return c;r=c?.structure}l=m0({item:r,drawDefinition:t,structure:r,event:s})||Mp(t)||Mp(s)}else l=Mp(t)||Mp(s);return l?{...oe,structure:r,tieFormat:l,matchUp:n}:ce({result:{error:dE},stack:o})}function J_({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![ta].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==Md&&!wa(t))}function sG({from:t,to:e}){let i=Object.keys(t),r=Mn(i,Object.keys(e)).length===i.length,n=i.filter(s=>t[s]!==e[s]).map(s=>({countChange:e[s]-t[s],collectionId:s})),a=i.every(s=>t[s]===e[s]);return{equivalent:r&&a,matchUpsCountChanges:n}}function ant({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:s,event:o,uuids:l}){let c="updateTieFormat",u=e?.tournamentId,d=0,p=0,f=0,h=0,m=n?.collectionDefinitions.reduce((w,S)=>(w[S.collectionId]=(w[S.collectionId]||0)+S.matchUpCount,w),{}),A=({tieFormat:w})=>{let S=w?.collectionDefinitions.reduce((T,D)=>(T[D.collectionId]=(T[D.collectionId]||0)+D.matchUpCount,T),{});return sG({from:S,to:m}).equivalent},g=qy({drawDefinition:i})?.tieFormat,v=qy({event:o})?.tieFormat;if(o&&a){for(let w of o.drawDefinitions??[])b({drawDefinition:w});o.tieFormat=Us(n),h+=1}else if(s){if(!s.tieMatchUps)return ce({result:{error:wl},stack:c});let w=Xl(s.tieMatchUps?.map(({collectionId:E})=>E)),S=sG({to:m,from:w}),{changes:T,changesArePossible:D,cannotChangeReaon:C}=Jie({matchUp:s,check:S});if(S.equivalent)if(J_({matchUp:s,updateInProgressMatchUps:t}))s.tieFormat=Us(n),h+=1;else return ce({result:{error:_8},info:"matchUp is IN_PROGRESS or COMPLETE",stack:c});else if(D)I({tieFormat:n,matchUp:s,changes:T,uuids:l});else return ce({context:{collectionMap:m,matchUpMap:w},result:{error:ah},info:C||"specified changes not possible",stack:c});p+=1,Zi({eventId:o?.eventId,context:c,drawDefinition:i,tournamentId:u,matchUp:s})}else if(r){let w=y({inheritedTieFormat:g??v,structure:r})?.modifiedMatchUpsCount;w&&(p+=w,d+=1,h+=1);let S=!r.tieFormat||Jm({ancestor:r.tieFormat,descendant:n}).different;S&&(r.tieFormat=Us(n),d+=1,h+=1),(w||S)&&i&&kr({structureIds:[r.structureId],eventId:o?.eventId,drawDefinition:i})}else if(i)b({drawDefinition:i}),i.tieFormat=Us(n),h+=1;else return{error:kt};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:f,modifiedCount:h,...oe,tieFormat:n};function b({drawDefinition:w}){let S=w.structures||[],T=[];for(let D of S){if(D.tieFormat)continue;let C=y({inheritedTieFormat:v,structure:D})?.modifiedMatchUpsCount;if(C){d+=1,p+=C;let E=D.structureId;T.push(E)}}return kr({structureIds:T,eventId:o?.eventId,drawDefinition:w}),T.length}function y({inheritedTieFormat:w,structure:S}){let T=0,D=dr({matchUpFilters:{matchUpTypes:[Hr]},structure:S})?.matchUps||[];for(let C of D){let E=J_({matchUp:C,updateInProgressMatchUps:t}),P=!1,R=Xl(C.tieMatchUps?.map(({collectionId:N})=>N)),M=sG({from:R,to:m});if(M.equivalent)C.tieFormat&&A(C)&&E&&(C.tieFormat=Us(n),P=!0);else{let{changes:N,changesArePossible:k}=Jie({matchUp:C,check:M});if(k&&!C.tieFormat)I({changes:N,matchUp:C,tieFormat:n,uuids:l});else if(w)(!C.tieFormat||Jm({ancestor:w,descendant:C.tieFormat}).different)&&(C.tieFormat=w,P=!0);else return ce({result:{error:dE},stack:c})}P&&(T+=1,Zi({tournamentId:e?.tournamentId,drawDefinition:i,context:c,eventId:a,matchUp:C}))}return{modifiedMatchUpsCount:T}}function I({uuids:w,matchUp:S,tieFormat:T,changes:D}){S.tieFormat=Us(T);let C=[],E=[];return D.forEach(P=>{if(P.countChange>0){let R=Math.max(0,...S.tieMatchUps.filter(k=>k.collectionId===P.collectionId).map(rc("collectionPosition"))),M=T.collectionDefinitions.find(k=>k.collectionId===P.collectionId),N=YM({matchUpsLimit:P.countChange,collectionPositionOffset:R,collectionDefinition:M,matchUp:S,uuids:w});E.push(...Dt(N,!1,!0)),f+=E.length,S.tieMatchUps.push(...N)}else{let R=P.toBePlayedTieMatchUpIds.slice(0,Math.abs(P.countChange));console.log("remove",R.length),C.push(...R),S.tieMatchUps=S.tieMatchUps.filter(({matchUpId:M})=>!R.includes(M))}}),E.length&&Tg({matchUps:E,drawDefinition:i,tournamentId:u,eventId:a}),C.length&&zh({matchUpIds:C,action:"updateTieFormat",drawDefinition:i,tournamentId:u,eventId:a}),{matchUpIdsRemoved:C,matchUpsAdded:E}}}function Jie({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let s=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===Nn).map(rc("matchUpId")),o=s.length+a>=0||a>0;return!o&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:s,collectionId:n,countChange:a}),o}),changes:r,cannotChangeReaon:i}}function vH({appliedPolicies:t,drawDefinition:e,auditData:i}){if(!t?.audit?.[f0])return;let{extension:r}=ki({name:f0,element:e}),n={value:Array.isArray(r?.value)?r?.value.concat(i):[i],name:f0};ur({element:e,extension:n})}function NX({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:s,matchUpCount:o,collectionId:l,matchUpType:c,structureId:u,matchUpId:d,category:p,eventId:f,gender:h,event:m,collectionValueProfiles:A,collectionValue:g,matchUpValue:v,scoreValue:b,setValue:y}){let I="modifyCollectionDefinition";if(s&&!Zl({matchUpFormat:s}))return ce({result:{error:we},context:{matchUpFormat:s},stack:I});if(r&&typeof r!="string")return ce({result:{error:we},context:{collectionName:r},stack:I});if(h&&!Object.values(B2).includes(h))return ce({result:{error:we},context:{gender:h},stack:I});if(p&&typeof p!="object")return ce({result:{error:we},context:{category:p},stack:I});let w={collectionValueProfiles:A,collectionValue:g,matchUpValue:v,scoreValue:b,setValue:y};if(!Object.values(w).filter(Boolean).length&&!i&&!r&&!s&&!o&&!c)return ce({result:{error:Yt},stack:I});if(Object.values(w).filter(Boolean).length>1)return ce({info:"Only one value assignment allowed per collectionDefinition",result:{error:we},stack:I});let S=qy({drawDefinition:a,structureId:u,matchUpId:d,eventId:f,event:m});if(S.error)return ce({result:S,stack:I});let{matchUp:T,structure:D,tieFormat:C}=S,E=Us(C),P=C?.collectionDefinitions.find(z=>z.collectionId===l),R=E?.collectionDefinitions.find(z=>z.collectionId===l);if(!P)return ce({info:"source collectionDefinition",result:{error:rs},context:{collectionId:l},stack:I});let M=g??v??b??y;if(A?.length){let z=GIe({matchUpCount:o??P?.matchUpCount??0,collectionValueProfiles:A});if(z.errors)return ce({result:{error:we},info:z.errors,stack:I})}else if(M&&!wi(M))return ce({result:{error:we},info:"value is not an integer",context:{value:M},stack:I});let N=(z,Q)=>Mn(Object.keys(z),Object.keys(Q)).length===Object.keys(z).length&&Mn(Object.values(z),Object.values(Q)).length===Object.values(z).length,k=A&&(!P.collectionValueProfiles||!N(P.collectionValueProfiles,A)),O=wi(g)&&P.collectionValue!==g||wi(v)&&P.matchUpValue!==v||wi(b)&&P.scoreValue!==b||wi(y)&&P.setValue!==y||k,x=[];if(O&&(R.collectionValueProfiles=void 0,R.collectionValue=void 0,R.matchUpValue=void 0,R.scoreValue=void 0,R.setValue=void 0,Object.assign(R,w),x.push({collectionId:l,...Lt(w)})),(wi(b)||wi(y))&&R.collectionGroupNumber){let z=R.collectionGroupNumber;E.collectionDefinitions=E.collectionDefinitions.map(Q=>{let{collectionGroupNumber:j,...W}=Q;return j===z?W:Q}),E.collectionGroups=E.collectionGroups.filter(({groupNumber:Q})=>Q!==z),x.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:F,valueGoal:_}=TS(E),V=Lt({aggregateValue:F,valueGoal:_});if((V.aggregateValue!==C?.winCriteria.aggregateValue||V.valueGoal!==C?.winCriteria.valueGoal)&&(E.winCriteria=V,x.push({collectionId:l,winCriteria:V})),wi(i)&&P.collectionOrder!==i&&(R.collectionOrder=i,x.push({collectionId:l,collectionOrder:i})),r&&P.collectionName!==r&&(R.collectionName=r,x.push({collectionId:l,collectionName:r})),s&&P.matchUpFormat!==s&&(R.matchUpFormat=s,x.push({collectionId:l,matchUpFormat:s})),wi(o)&&P.matchUpCount!==o&&(R.matchUpCount=o,x.push({collectionId:l,matchUpCount:o})),c&&P.matchUpType!==c)return ce({result:{error:q8},context:{matchUpType:c},stack:I});p&&P.category!==p&&(R.category=p,x.push({collectionId:l,category:p})),h&&P.gender!==h&&(R.gender=h,x.push({collectionId:l,gender:h}));let G=Lt(E);if(S=Jo({tieFormat:G}),S.error)return ce({result:S,stack:I});if(!x.length)return ce({result:{...oe,modifications:x}});if(C?.tieFormatName!==n?(G.tieFormatName=n,x.push({tieFormatName:n})):x.length&&(delete G.tieFormatName,x.push("tieFormatName removed: modifications without new tieFormatName")),S=ant({tieFormat:G,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:D,eventId:f,matchUp:T,event:m}),!S.error){let{appliedPolicies:z}=tr({tournamentRecord:e}),Q=Lt({collectionDefinition:R,drawId:a?.drawId,action:I,structureId:u,matchUpId:d,eventId:f});vH({appliedPolicies:z,drawDefinition:a,auditData:Q})}return ce({result:{...S,modifications:x},stack:I})}function snt({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){let s=[];return n&&a?s=[a]:i&&r?s=dr({matchUpFilters:{matchUpTypes:[Hr]},structure:r})?.matchUps??[]:e&&(s=No({matchUpFilters:{matchUpTypes:[Hr]},drawDefinition:e})?.matchUps??[]),{targetMatchUps:s.filter(o=>!o.winningSide&&o.matchUpStatus!==Hn&&(t||o.matchUpStatus!==Md&&!wa(o)))}}function ont({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let s of r){let o=!!s.tieFormat;o&&(s.tieFormat=Us(n));let l;if(t){let c=tr({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,u=IA({matchUpId:s.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:c,drawDefinition:i,event:a});if(u.error)return u;l=u.score}o&&!l&&Zi({tournamentId:e?.tournamentId,context:"updateTargetTeamMatchUps",eventId:a?.eventId,matchUp:s,drawDefinition:i})}return{...oe}}function g1e({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:s,structure:o,tieFormat:l,matchUpId:c,matchUp:u,eventId:d,event:p}){let{aggregateValue:f,valueGoal:h}=TS(l);l.winCriteria=Lt({aggregateValue:f,valueGoal:h}),(e&&e!==h||f&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:m}=snt({updateInProgressMatchUps:t,drawDefinition:a,structureId:s,structure:o,matchUpId:c,matchUp:u});ont({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:a,tieFormat:l,event:p});let A=Lt(l),g=Jo({tieFormat:A});if(g.error)return g;if(d&&p)p.tieFormat=A;else if(c&&u)u.tieFormat=l;else if(o)o.tieFormat=A;else if(a)a.tieFormat=A;else if(!u||!a)return{error:kt};return kr({drawDefinition:a,eventId:p?.eventId}),{...oe}}function v1e({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:s,matchUp:o,eventId:l,event:c}){if(!e)return{error:Yt};if(isNaN(e))return{error:we};let u="removeCollectionGroup",d=o?void 0:qy({drawDefinition:r,structureId:a,matchUpId:s,eventId:l,event:c});if(d?.error)return ce({result:d,stack:u});let p=d?.structure;o=o??d?.matchUp;let f=d?.tieFormat,h=f?.winCriteria.valueGoal,m=f?.winCriteria.aggregateValue,A=Us(f);if(d=Jo({tieFormat:A}),d.error)return ce({result:d,stack:u});let g=[];if(A.collectionDefinitions=A.collectionDefinitions.map(v=>{let{collectionGroupNumber:b,...y}=v;return b!==e?v:(g.push(v.collectionId),y)}),A.collectionGroups=A.collectionGroups.filter(({groupNumber:v})=>v!==e),d=g1e({updateInProgressMatchUps:t,originalValueGoal:h,wasAggregateValue:m,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:A,matchUpId:s,matchUp:o,eventId:l,event:c}),!d.error){let{appliedPolicies:v}=tr({tournamentRecord:i}),b=Lt({drawId:r?.drawId,collectionGroupNumber:e,action:u,structureId:a,matchUpId:s,eventId:l});vH({appliedPolicies:v,drawDefinition:r,auditData:b})}return ce({result:{...d,modifiedCollectionIds:g},stack:u})}function aC({tieFormat:t,orderMap:e}){let i=Us(t);return i.collectionDefinitions?.forEach(r=>{let n=e[r.collectionId];n&&(r.collectionOrder=n)}),i.collectionDefinitions?.sort((r,n)=>FT(r.collectionOrder)-FT(n.collectionOrder)),i}function y1e({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:s,event:o}){if(typeof n!="object"||!Object.values(n).every(u=>wi(u)))return ce({result:{error:we},context:{orderMap:n}});let l=i?di({drawDefinition:e,structureId:i}):void 0;if(l?.error)return l;let c=l?.structure;if(a&&o?.tieFormat)ere({tournamentRecord:t,event:o,orderMap:n});else if(r){let u=e&&Yr({drawDefinition:e,matchUpId:r});if(u?.error)return u;if(s=u.matchUp,!s)return{error:Zo};let d=$$({tournamentRecord:t,matchUpId:r,structure:c,drawDefinition:e,event:o})?.tieFormat;s.tieFormat=aC({tieFormat:d,orderMap:n}),Zi({tournamentId:t?.tournamentId,eventId:o?.eventId,drawDefinition:e,matchUp:s})}else if(i)if(c?.tieFormat)c.tieFormat=aC({tieFormat:c.tieFormat,orderMap:n}),b1e({eventId:o?.eventId,tournamentRecord:t,drawDefinition:e,structure:c,orderMap:n}),kr({drawDefinition:e,structureIds:[c.structureId]});else if(e.tieFormat)h3({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else if(o?.tieFormat)ere({structureIds:[i],tournamentRecord:t,orderMap:n,event:o});else return{error:rs};else if(e?.tieFormat)h3({tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else return{error:rs};return{...oe}}function ere({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=aC({tieFormat:r.tieFormat,orderMap:i});e?.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])h3({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function h3({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??n?.tieFormat,s=aC({tieFormat:a,orderMap:r});i?.length||(e.tieFormat=s);let o=[];for(let l of e.structures??[])i?.length&&!i.includes(l.structureId)||((l.tieFormat||i?.includes(l.structureId))&&(l.tieFormat=aC({tieFormat:l.tieFormat??e.tieFormat??n?.tieFormat,orderMap:r})),b1e({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),o.push(l.structureId));kr({drawDefinition:e,structureIds:o})}function b1e({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){let a=dr({matchUpFilters:{matchUpTypes:[Hr]},structure:i})?.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=aC({tieFormat:s.tieFormat,orderMap:r}),Zi({tournamentId:t?.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function BX({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:s,matchUpId:o,eventId:l,matchUp:c,event:u}){let d="removeCollectionDefinition",p=c?void 0:qy({drawDefinition:r,structureId:s,matchUpId:o,eventId:l,event:u});if(p?.error)return ce({result:p,stack:d});let f=p?.structure;c=c??p?.matchUp;let h=p?.tieFormat,m=Us(h);if(p=Jo({tieFormat:m}),p.error)return ce({result:p,stack:d});let A=m?.collectionDefinitions?.find(E=>E.collectionId===a);if(!A)return ce({result:{error:rs,collectionId:a}});m.collectionDefinitions=m.collectionDefinitions.filter(E=>E.collectionId!==a),A.collectionGroupNumber&&(m.collectionDefinitions=m.collectionDefinitions.map(E=>{let{collectionGroupNumber:P,...R}=E;return R}),m.collectionGroups=m.collectionGroups.filter(({groupNumber:E})=>E!==A.collectionGroupNumber));let{aggregateValue:g,valueGoal:v}=TS(m);m.winCriteria=Lt({aggregateValue:g,valueGoal:v});let b=h?.winCriteria.valueGoal,y=h?.winCriteria.aggregateValue;(b&&b!==v||g&&!y)&&(n?m.tieFormatName=n:delete m.tieFormatName);let I=[];o&&c?I=[c]:s&&f?I=dr({matchUpFilters:{matchUpTypes:[Hr]},structure:f})?.matchUps??[]:r?I=No({matchUpFilters:{matchUpTypes:[Hr]},drawDefinition:r})?.matchUps??[]:u&&(I=Wh({matchUpFilters:{matchUpTypes:[Hr]}})?.matchUps??[]);let w=(I||[]).filter(E=>{let P=E.tieMatchUps?.filter(M=>M.collectionId===a)?.some(wa),R=e&&E.tieFormat?Jm({descendant:E.tieFormat,ancestor:m})?.different:!1;return t&&!P||!E.winningSide&&E.matchUpStatus!==Hn&&(t||E.matchUpStatus!==Md&&!wa(E)&&!R)});if(!w.length)return{error:fE};let{appliedPolicies:S}=tr({tournamentRecord:i});if(o&&c&&t){let E=c.tieMatchUps?.filter(P=>P.collectionId===a);for(let P of E??[]){let R=Rb({matchUpId:P.matchUpId,tieMatchUpId:c?.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:S,drawDefinition:r,event:u});if(R.error||(R=Yr({drawDefinition:r,matchUpId:o}),R.error))return R;c=R?.matchUp}}let T=[];for(let E of w){for(let P of E?.sides??[])P.lineUp=(P.lineUp??[]).map(R=>({participantId:R.participantId,collectionAssignments:(R?.collectionAssignments??[]).filter(M=>M.collectionId!==a)}));if(E.tieMatchUps=(E.tieMatchUps??[]).filter(P=>{let R=P.collectionId===a;return R&&T.push(P.matchUpId),!R}),E.tieFormat&&(E.tieFormat=Us(m)),t){let P=IA({matchUpId:E.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:S,drawDefinition:r,event:u});if(P.error)return P}Zi({tournamentId:i?.tournamentId,eventId:u?.eventId,drawDefinition:r,context:d,matchUp:E})}T.length&&zh({tournamentId:i?.tournamentId,matchUpIds:T,eventId:u?.eventId,drawDefinition:r});let D=Lt(m);if(p=Jo({tieFormat:D}),p.error)return ce({result:p,stack:d});if(l&&u)u.tieFormat=D;else if(o&&c)c.tieFormat=D;else if(f)f.tieFormat=D;else if(r)r.tieFormat=D;else if(!c||!r)return{error:kt};kr({drawDefinition:r,eventId:u?.eventId});let C=Lt({drawId:r?.drawId,action:d,collectionId:a,structureId:s,matchUpId:o,eventId:l});return vH({appliedPolicies:S,drawDefinition:r,auditData:C}),{tieFormat:D,deletedMatchUpIds:T,targetMatchUps:w,...oe}}function I1e({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:s,matchUpId:o,matchUp:l,eventId:c,event:u}){let d="addCollectionGroup";if(!Array.isArray(n))return ce({result:{error:Yt},stack:d});let p=l?void 0:qy({drawDefinition:r,structureId:s,matchUpId:o,eventId:c,event:u});if(p?.error)return ce({result:p,stack:d});let f=p?.structure;l=l||p?.matchUp;let h=p?.tieFormat,m=h?.winCriteria.valueGoal,A=Us(h);if(p=Jo({tieFormat:A}),p.error)return ce({result:p,stack:d});for(let v of A.collectionDefinitions){let{collectionId:b,collectionGroupNumber:y}=v;if(y&&n.includes(b))return ce({info:"collectionIds cannot be part of other collectionGroups",result:{error:we},stack:d})}let g=(A.collectionGroups||[]).reduce((v,b)=>b.groupNumber>v?b.groupNumber:v,0)+1;return i.groupNumber=g,A.collectionDefinitions=A.collectionDefinitions.map(v=>n.includes(v.collectionId)?{...v,collectionGroupNumber:g}:v),A.collectionGroups=[...A.collecitonGroups||[],i],g1e({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:s,structure:f,tieFormat:A,matchUpId:o,matchUp:l,eventId:c,event:u})}function kX({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:s,drawDefinition:o,tieFormatName:l,enforceGender:c,structureId:u,matchUpId:d,matchUp:p,eventId:f,uuids:h,event:m}){let A="addCollectionDefinition",g=tr({tournamentRecord:r,drawDefinition:o,event:m}).appliedPolicies??{},v=n?.[Ja]??g?.[Ja];a=a??v?.participants?.enforceCategory;let b=(c??v?.participants?.enforceGender)!==!1,y=!!((i??m?.category)&&a!==!1),I=!!((s??m?.gender)&&b),w=mM({referenceCategory:i??m?.category,collectionDefinition:e,referenceGender:s,checkCategory:y,checkGender:I,event:m});if(w.error)return ce({result:w,stack:A});let S=p?.tieFormat?void 0:qy({drawDefinition:o,structureId:u,matchUpId:d,eventId:f,event:m});if(S?.error)return ce({result:{error:S.error},stack:A});let T=S?.structure;p=p??S?.matchUp;let D=p?.tieFormat??S?.tieFormat,C=Us(D);if(S=Jo({tieFormat:C}),S?.error)return ce({result:{error:S.error},stack:A});if(!e.collectionId)e.collectionId=hr();else if(C.collectionDefinitions.map(({collectionId:_})=>_).includes(e.collectionId))return ce({context:{collectionId:e.collectionId},result:{error:Wwe}});C.collectionDefinitions.push(e),C.collectionDefinitions.sort((_,V)=>(_.collectionOrder||0)-(V.collectionOrder||0)).forEach((_,V)=>_.collectionOrder=V+1);let{aggregateValue:E,valueGoal:P}=TS(C);C.winCriteria=Lt({aggregateValue:E,valueGoal:P});let R=D?.winCriteria.valueGoal,M=D?.winCriteria.aggregateValue;(R&&R!==P||E&&!M)&&(l?C.tieFormatName=l:delete C.tieFormatName);let N=[],k=[],O=[],x=Lt(C);if(S=Jo({tieFormat:x}),S?.error)return ce({result:{error:S.error},stack:A});if(f&&m){m.tieFormat=x;for(let _ of m.drawDefinitions??[])if(!_.tieFormat)for(let V of _.structures??[]){if(V.tieFormat)continue;let G=oG({updateInProgressMatchUps:t,collectionDefinition:e,structure:V,uuids:h});k.push(...G.newMatchUps),O.push(...G.targetMatchUps),N.push(V.structureId)}pB({modifiedMatchUps:O,eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:k,stack:A})}else if(u&&T){T.tieFormat=x;let _=oG({updateInProgressMatchUps:t,collectionDefinition:e,structure:T,uuids:h});k.push(..._.newMatchUps),O=_.targetMatchUps,pB({modifiedMatchUps:O,eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:k,stack:A})}else if(d&&p){if(!J_({matchUp:p,updateInProgressMatchUps:t}))return ce({result:{error:_8},stack:A});p.tieFormat=x;let _=YM({collectionDefinition:e,matchUp:p,uuids:h});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(..._),k.push(..._),pB({modifiedMatchUps:[p],eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:k,stack:A})}else if(o){o.tieFormat=x;for(let _ of o.structures??[]){let V=oG({updateInProgressMatchUps:t,collectionDefinition:e,structure:_,uuids:h});N.push(_.structureId),k.push(...V.newMatchUps),O.push(...V.targetMatchUps)}pB({modifiedMatchUps:O,eventId:m?.eventId,tournamentRecord:r,drawDefinition:o,addedMatchUps:k,stack:A})}else return{error:kt};let F=Lt({drawId:o?.drawId,collectionDefinition:e,action:A,structureId:u,matchUpId:d,eventId:f});return vH({appliedPolicies:g,drawDefinition:o,auditData:F}),{tieFormat:x,targetMatchUps:O,addedMatchUps:k,...oe}}function oG({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){let n=[],a=(dr({matchUpFilters:{matchUpTypes:[Hr]},structure:i})?.matchUps).filter(s=>J_({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let o=YM({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...o),n.push(...o)}return{newMatchUps:n,targetMatchUps:a}}function pB({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:s}){Tg({tournamentId:e?.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i?.forEach(o=>{Zi({tournamentId:e?.tournamentId,drawDefinition:r,context:s,matchUp:o,eventId:a})}),kr({structureIds:t,drawDefinition:r,eventId:a})}function w1e({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,uuids:c,event:u}){let d="modifyTieFormat";if(!Jo({tieFormat:i}).valid)return ce({result:{error:ah},info:"falied validation",stack:d});let p=qy({drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:u});if(p.error)return ce({result:p,stack:d});let{matchUp:f,tieFormat:h}=p,m=Us(h),A=Jm({descendant:i,ancestor:m,considerations:n});if(A.invalid)return ce({context:{invalid:A.invalid},result:{error:ah},stack:d});if(!A?.different)return ce({result:{...oe},info:"Nothing to do",stack:d});let g=m.collectionDefinitions.map(({collectionId:D})=>D),v=i.collectionDefinitions.map(({collectionId:D})=>D),b=g.filter(D=>!v.includes(D)),y=i.collectionDefinitions.filter(({collectionId:D})=>!g.includes(D)),I=y.map(rc("collectionId")),w=[],S,T=i.tieFormatName;for(let D of i.collectionDefinitions){if(I.includes(D.collectionId))continue;let C=NX({updateInProgressMatchUps:t,...D,tournamentRecord:r,tieFormatName:T,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:u});if(C.modifications&&w.push(...C.modifications),C.error)return ce({result:C,stack:d});C.tieFormat&&(S=C.tieFormat)}for(let D of y){let C=kX({updateInProgressMatchUps:t,collectionDefinition:D,tournamentRecord:r,drawDefinition:a,tieFormatName:T,structureId:s,matchUpId:o,matchUp:f,eventId:l,uuids:c,event:u});if(C.error)return ce({result:C,stack:d});C.tieFormat&&(S=C.tieFormat)}for(let D of b){let C=BX({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:T,collectionId:D,structureId:s,matchUpId:o,eventId:l,matchUp:f,event:u});if(C.error)return ce({result:C,stack:d});C.tieFormat&&(S=C.tieFormat)}return h?.tieFormatName!==T?(S.tieFormatName=T,w.push({tieFormatName:T})):(w.length||I.length||b.length)&&(delete S.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),S.collectionDefinitions=S.collectionDefinitions.sort((D,C)=>FT(D.collectionOrder)-FT(C.collectionOrder)).map((D,C)=>({...D,collectionOrder:C+1})),{processedTieFormat:Us(S),modifications:w,...oe}}function S1e({tournamentRecord:t}){if(!t)return{error:nt};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=c=>{if(!c.tieFormat)return;let u;for(let d of r)Jm({descendant:c.tieFormat,ancestor:d}).different||(u=d.tieFormatId);if(u)c.tieFormatId=u,delete c.tieFormat;else{let d=Dt(c.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=hr()),c.tieFormatId=d.tieFormatId,delete c.tieFormat,r.push(d),e+=1}};i.eventType,n({tieFormat:i.tieFormat});for(let c of i.drawDefinitions??[]){n({tieFormat:c.tieFormat});for(let u of c.structures??[])n({tieFormat:u.tieFormat})}let a=(c,u)=>{let d=o.matchUps?.find(p=>p.matchUpId===c);d&&(d.tieFormatId=u,delete d.tieFormat,Zi({tournamentId:t?.tournamentId,eventId:i.eventId,matchUp:d}))},s=c=>{let u=Dt(c.tieFormat,void 0,!0);u.tieFormatId||(u.tieFormatId=hr()),r.push(u),e+=1,a(c.matchUpId,u.tieFormatId)},o=Wh({matchUpFilters:{matchUpTypes:[Pc]},event:i}),l=o.matchUps??[];for(let c of l){let u;for(let d of r)c.tieFormat&&Jm({descendant:c.tieFormat,ancestor:d}).different||(u=d.tieFormatId);u?a(c.matchUpId,u):s(c)}r.length&&(i.tieFormats=r)}return{...oe,addedCount:e}}var U1e={};Li(U1e,{addDrawDefinitionExtension:()=>q2,addEventExtension:()=>iv,addEventTimeItem:()=>wS,addExtension:()=>ur,addNotes:()=>b$,addOnlineResource:()=>N1e,addParticipantExtension:()=>IUe,addParticipantTimeItem:()=>V7,addTimeItem:()=>Bf,addTournamentExtension:()=>wY,addTournamentTimeItem:()=>tN,analyzeDraws:()=>iN,analyzeTournament:()=>T9,copyTournamentRecord:()=>C1e,createTournamentRecord:()=>mH,generate:()=>T1e,getAggregateTeamResults:()=>U9,getAllowedDrawTypes:()=>_$,getAllowedMatchUpFormats:()=>I9,getAppliedPolicies:()=>tr,getCompetitionDateRange:()=>F$,getCompetitionPenalties:()=>w9,getPolicyDefinitions:()=>yA,getTournamentInfo:()=>US,getTournamentPenalties:()=>O$,getTournamentPersons:()=>S9,getTournamentPoints:()=>L$,getTournamentStructures:()=>S7,getTournamentTimeItem:()=>r$,hydrateTournamentRecord:()=>D1e,mutate:()=>E1e,query:()=>EDe,removeDrawDefinitionExtension:()=>wUe,removeEventExtension:()=>W2,removeExtension:()=>Mo,removeNotes:()=>F7,removeOnlineResource:()=>M1e,removeParticipantExtension:()=>SUe,removeTournamentExtension:()=>SY,setTournamentCategories:()=>x1e,setTournamentDates:()=>yH,setTournamentEndDate:()=>O1e,setTournamentName:()=>B1e,setTournamentNotes:()=>k1e,setTournamentStartDate:()=>_1e,setTournamentStatus:()=>R1e});var T1e={};Li(T1e,{copyTournamentRecord:()=>C1e,createTournamentRecord:()=>mH});function C1e(t){let e=Qt(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord,n=1440*60*1e3,a=(i&&r?new Date(Ui(r)).getTime()-new Date(Ui(i)).getTime():0)/n,s=t.endDate||nY(t.startDate,a),o=p=>p?.filter(({itemType:f})=>t.itemTypeList?.includes(f)),l=p=>p?.filter(({name:f})=>t.extensionList?.includes(f)),c=p=>{let{timeItems:f,extensions:h,...m}=p;return Dt({...m,timeItems:o(f),extensions:l(h)},!1,!0)},u=p=>{let{drawDefinitions:f,timeItems:h,extensions:m,startDate:A,endDate:g,...v}=p;return Dt({extensions:l(m),timeItems:o(h),startDate:t.startDate,endDate:s,...v},!1,!0)},d={participants:t.copyParticipants?t.tournamentRecord.participants?.map(c)??[]:[],parentOrganisation:Dt({...t.tournamentRecord.parentOrganisation},!1,!0),venues:Dt(t.tournamentRecord.venues??[],!1,!0),extensions:l(t.tournamentRecord.extensions),timeItems:o(t.tournamentRecord.timeItems),events:t.tournamentRecord.events?.map(u)??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:hr(),endDate:s};return{...oe,tournamentRecord:d}}var E1e={};Li(E1e,{addDrawDefinitionExtension:()=>q2,addEventExtension:()=>iv,addEventTimeItem:()=>wS,addExtension:()=>ur,addNotes:()=>b$,addOnlineResource:()=>N1e,addParticipantExtension:()=>IUe,addParticipantTimeItem:()=>V7,addTimeItem:()=>Bf,addTournamentExtension:()=>wY,addTournamentTimeItem:()=>tN,hydrateTournamentRecord:()=>D1e,removeDrawDefinitionExtension:()=>wUe,removeEventExtension:()=>W2,removeExtension:()=>Mo,removeNotes:()=>F7,removeOnlineResource:()=>M1e,removeParticipantExtension:()=>SUe,removeTournamentExtension:()=>SY,setTournamentCategories:()=>x1e,setTournamentDates:()=>yH,setTournamentEndDate:()=>O1e,setTournamentName:()=>B1e,setTournamentNotes:()=>k1e,setTournamentStartDate:()=>_1e,setTournamentStatus:()=>R1e});function D1e(t){let{tournamentRecord:e,eventProfiles:i=[],directives:r,policyDefinitions:n}=t;return e?((e.events||[]).forEach(a=>{let s=i.find(o=>o.eventId&&o.eventId===a.eventId);(s?.directives?.hydrateRoundNames||r?.hydrateRoundNames)&&a.drawDefinitions?.forEach(o=>{(s?.policyDefinitions?.[zm]||n?.[zm])&&qDe({drawDefinition:o,appliedPolicies:n})})}),{tournamentRecord:e}):{error:nt}}var lnt="ABANDONED",cnt="ACTIVE",unt="CANCELLED",dnt="COMPLETED",pnt="IN_PROGRESS",P1e={ABANDONED:lnt,ACTIVE:cnt,CANCELLED:unt,COMPLETED:dnt,IN_PROGRESS:pnt};function R1e({tournamentRecord:t,status:e}){return t?e&&!Object.keys(P1e).includes(e)?{error:we,info:"Unknown status"}:(t.tournamentStatus=e,{...oe}):{error:nt}}function M1e(t){let e=Qt(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return ce({result:{error:rs}});JS({element:i.parentOrganisation,onlineResource:r})}else if(a||s){let c=(i.participants??[]).find(u=>s&&u.person?.personId===s||u.participantId===a);if(!c)return ce(s?{result:{error:rs}}:{result:{error:Fn}});if(s){if(c.person?.personId!==s)return ce({result:{error:tS}});JS({element:c.person,onlineResource:r})}else JS({element:c,onlineResource:r})}else if(o){let c=(i.venues??[]).filter(u=>!l||u.venueId===l).flatMap(u=>(u.courts??[]).filter(d=>d.courtId===o))?.[0];if(!c)return ce({result:{error:Gm}});JS({element:c,onlineResource:r})}else if(l){let c=(i.venues??[]).find(u=>u.venueId===l);if(!c)return ce({result:{error:vb}});JS({element:c,onlineResource:r})}else JS({element:i,onlineResource:r}),Ii({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:bb});return{...oe}}function JS({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!(r?.[QT]===e[QT]&&r?.[jT]===e[jT]&&r?.[zT]===e[zT]));t.onlineResources=i}function N1e(t){let e=Qt(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return ce({result:{error:rs}});eU({element:i.parentOrganisation,onlineResource:r})}else if(a||s){let c=(i.participants??[]).find(u=>s&&u.person?.personId===s||u.participantId===a);if(!c)return ce(s?{result:{error:rs}}:{result:{error:Fn}});if(s){if(c.person?.personId!==s)return ce({result:{error:tS}});eU({element:c.person,onlineResource:r})}else eU({element:c,onlineResource:r})}else if(o){let c=(i.venues??[]).filter(u=>!l||u.venueId===l).flatMap(u=>(u.courts??[]).filter(d=>d.courtId===o))?.[0];if(!c)return ce({result:{error:Gm}});eU({element:c,onlineResource:r})}else if(l){let c=(i.venues??[]).find(u=>u.venueId===l);if(!c)return ce({result:{error:vb}});eU({element:c,onlineResource:r})}else eU({element:i,onlineResource:r}),Ii({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:bb});return{...oe}}function eU({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>r?.[QT]!==e[QT]&&r?.[jT]!==e[jT]&&r?.[zT]!==e[zT]);return i.push(e),t.onlineResources=i,{...oe}}function B1e({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:nt};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&Ii({topic:bb,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...oe}}function k1e({tournamentRecord:t,notes:e}){if(!t)return{error:nt};let i=e?b$({element:t,notes:e}):F7({element:t});return i.error?i:(Ii({topic:bb,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...oe})}function x1e({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,Ii({topic:bb,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...oe}):{error:nt}}function fnt({tournamentRecord:t}){if(!t)return{error:nt};let{startDate:e,endDate:i}=t,r=GT(e,i),n=[];for(let a of t.venues||[])a?.courts?.length&&n.push(...a.courts);for(let a of n){let{startTime:s,endTime:o}=(a.dateAvailability??[]).reduce((u,d)=>{let p=sr(u.startTime),f=sr(u.endTime);return d.startTime&&sr(d.startTime)<p&&(u.startTime=d.startTime),d.endTime&&sr(d.endTime)>f&&(u.endTime=d.endTime),u},{startTime:"08:00",endTime:"18:00"}),l=r.map(u=>a.dateAvailability?.find(d=>d.date===u)??{date:u,startTime:s,endTime:o}),c=a.dateAvailability?.find(u=>!u.date);c&&l.unshift(c),a.dateAvailability=l}return{...oe}}function yH(t){let{tournamentRecord:e,startDate:i,endDate:r,weekdays:n}=t,a=t.activeDates?.filter(Boolean),s=Qt(t,[{tournamentRecord:!0},{[Ps]:f=>hf.test(f),[Nc]:ma,startDate:!1,endDate:!1},{[Ps]:f=>f.filter(Boolean).every(h=>hf.test(h)),[Nc]:ma,activeDates:!1},{[Ps]:u0e,weekdays:!1}]);if(s.error)return s;if(r&&i&&new Date(r)<new Date(i))return{error:we};if(r&&i&&new Date(i)>new Date(r))return{error:we};if(a?.length){let f=i||e.startDate,h=r||e.endDate,m=!f||a.every(g=>new Date(g)>=new Date(f)),A=!h||a.every(g=>new Date(g)<=new Date(h));if(!m||!A)return{error:ma}}let o;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||r&&e.endDate&&new Date(r)<new Date(e.endDate))&&(o=!0);let l=GT(e.startDate,e.endDate);i&&(e.startDate=i),r&&(e.endDate=r);let c=GT(e.startDate,e.endDate),u=l.filter(f=>!c.includes(f)),d=c.filter(f=>!l.includes(f));for(let f of e.events??[])i&&f.startDate&&new Date(f.startDate)<new Date(i)&&(f.startDate=i),r&&f.startDate&&new Date(f.startDate)>new Date(r)&&(f.startDate=i??r),r&&f.endDate&&new Date(f.endDate)>new Date(r)&&(f.endDate=r),i&&f.endDate&&new Date(f.endDate)<new Date(i)&&(f.endDate=r??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),r&&e.startDate&&new Date(r)<new Date(e.startDate)&&(e.startDate=r),a&&(e.activeDates=a),n&&(e.weekdays=n);let p=o&&hnt({tournamentRecord:e})?.unscheduledMatchUpIds;return fnt({tournamentRecord:e}),Ii({payload:Lt({parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,activeDates:a,startDate:i,weekdays:n,endDate:r}),topic:bb}),{...oe,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:u}}function _1e({tournamentRecord:t,startDate:e}){return e?yH({tournamentRecord:t,startDate:e}):{error:ma}}function O1e({tournamentRecord:t,endDate:e}){return e?yH({tournamentRecord:t,endDate:e}):{error:ma}}function hnt({tournamentRecord:t}){let e=as({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let s of e){let{schedule:o,matchUpId:l}=s;if(o&&o.scheduledDate){let c=new Date(o.scheduledDate);(i&&c<i||r&&c>r)&&(a.push(l),n.includes(o.scheduledDate)||n.push(o.scheduledDate))}}return n.length&&!fH({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:zIe}:{unscheduledMatchUpIds:a}}var F1e={};Li(F1e,{addCourt:()=>gH,addCourts:()=>DX,addVenue:()=>FM,deleteCourt:()=>q1e,deleteVenue:()=>FX,deleteVenues:()=>V1e,disableCourts:()=>G1e,disableVenues:()=>Q1e,enableCourts:()=>j1e,enableVenues:()=>z1e,generate:()=>L1e,generateCourts:()=>iX,getCompetitionVenues:()=>oN,getCourts:()=>V9,getVenuesAndCourts:()=>wA,modifyCourt:()=>LX,modifyCourtAvailability:()=>_X,modifyVenue:()=>W1e,mutate:()=>$1e,publicFindVenue:()=>t7,query:()=>QDe});var L1e={};Li(L1e,{generateCourts:()=>iX});var $1e={};Li($1e,{addCourt:()=>gH,addCourts:()=>DX,addVenue:()=>FM,deleteCourt:()=>q1e,deleteVenue:()=>FX,deleteVenues:()=>V1e,disableCourts:()=>G1e,disableVenues:()=>Q1e,enableCourts:()=>j1e,enableVenues:()=>z1e,modifyCourt:()=>LX,modifyCourtAvailability:()=>_X,modifyVenue:()=>W1e});function xX(t){if(!t?.tournamentRecord&&!Array.isArray(t?.venueMatchUps))return{error:nt};if(!t?.courtId)return{error:eS};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:s}=SA({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:o}=as({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:o,courtId:a})};function l({matchUps:c,courtId:u}){let d=c.filter(p=>{let f=p.schedule?.allocatedCourts?.map(({courtId:h})=>h);return p.schedule?.courtId===u||f?.includes(u)});return z_({matchUps:d,schedulingProfile:s})}}function mnt({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:nt};if(!r)return{error:ev};let{schedulingProfile:n}=SA({tournamentRecord:e}),{matchUps:a}=as({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:s({matchUps:a,venueId:r})};function s({matchUps:o,venueId:l}){let c=o.filter(u=>{let d=u.schedule?.allocatedCourts?.map(({venueId:p})=>p);return u.schedule?.venueId===l||d?.includes(l)});return z_({matchUps:c,schedulingProfile:n})}}function _X({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){if(!t)return{error:nt};if(!n)return{error:eS};let s=APe({dateAvailability:e});if(s.error)return s;let{updatedDateAvailability:o,totalMergeCount:l}=Ant(e);e=o;let c=ov({tournamentRecord:t,courtId:n});if(c.error)return c;let{court:u,venue:d}=c,{matchUps:p}=xX({tournamentRecord:t,venueMatchUps:r,courtId:n});if(p?.length){let f=tr({tournamentRecord:t})?.appliedPolicies,h=a??f?.[tv]?.allowDeletionWithScoresPresent?.courts,m=[];m.length&&(h||console.log("throw error: scheduled court matchUps",m.length))}return u&&(u.dateAvailability=e,!i&&d&&Ii({payload:{venue:d,tournamentId:t.tournamentId},topic:vA,key:d.venueId})),{...oe,totalMergeCount:l}}function Ant(t){let e=0,i=t.reduce((n,a)=>{let{date:s,startTime:o,endTime:l,bookings:c}=a;return n[s]||(n[s]=[]),n[s].push({startTime:o,endTime:l,bookings:c}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(Urt);let{mergedAvailability:a,mergeCount:s}=gnt(i[n]);r.push(...a.map(o=>({date:n,...o}))),e+=s}),{updatedDateAvailability:r,totalMergeCount:e}}function gnt(t){let e,i,r,n=t.length,a=0,s=[];for(;t.length&&n;){let l=t.shift(),{startTime:c,endTime:u,bookings:d}=l;if(n-=1,!e)e=c,r=d,i=u;else if(fM(Jn(i),Jn(c),!1)>0){let p={startTime:e,endTime:i};r?.length&&(p.bookings=r),s.push(p),e=c,r=d,i=u}else d&&(r?r.push(d):r=d),i=u,a+=1}let o={startTime:e,endTime:i};return r?.length&&(o.bookings=r),s.push(o),{mergedAvailability:s,mergeCount:a}}function OX({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:Jwe,info:e}}function H1e({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:go};if(!e&&!r)return{error:hp};let a;if(!e){if(!t)return{error:nt};({drawDefinition:e}=tl({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=Yr({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:nt};let s=as({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=WCe({matchUps:s,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(s=>[Eg,xh].includes(s.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:s})=>![Eg,xh].includes(s)),Zi({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...oe}):{error:Zs}}function FX(t){if(typeof t?.venueId!="string")return{error:ev};let{tournamentRecord:e,venueId:i,force:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(n).length)return{error:nt};let a=up({tournamentRecords:n,contextFilters:{venueIds:[i]}}).matchUps??[],s=tr({tournamentRecord:e})?.appliedPolicies,o=r??s?.[tv]?.allowDeletionWithScoresPresent?.venues;if(!a.length||o)for(let l of Object.values(n)){for(let u of a){let d=H1e({matchUpId:u.matchUpId,drawId:u.drawId,tournamentRecord:l});if(d.error)return d}let c;l.venues=(l.venues??[]).filter(u=>u?.venueId!==i?!0:(c=!0,!1)),c&&Ii({payload:{venueId:i,tournamentId:l.tournamentId},topic:BY,key:i})}else return OX({matchUpsCount:a.length});return cN({tournamentRecords:n}),{...oe}}function V1e({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:nt};if(!Array.isArray(e))return{error:we};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,s=FX({tournamentRecord:t,venueId:a,force:i});if(s.error)return s}}return{...oe}}function G1e(t){let{courtIds:e,dates:i}=t,r=Cu(t),n=[{[Js]:!0,[j2]:!0}],a=Qt(t,n);if(a.error)return a;for(let s of Object.values(r))vnt({tournamentRecord:s,courtIds:e,dates:i});return{...oe}}function vnt({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>ur({extension:{value:r,name:ep},creationTime:!1,element:a});for(let a of t.venues||[])for(let s of a.courts||[])if(e?.includes(s.courtId)){let o=n(s);if(o.error)return o}return{...oe}}function Q1e(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[Js]:!0,[z2]:!0}],a=Qt(t,n);if(a.error)return a;let s=Object.keys(e).filter(o=>!i||o===i);for(let o of s){let l=e[o];ynt({tournamentRecord:l,venueIds:r})}return{...oe}}function ynt({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e?.includes(i.venueId)){let r=ur({creationTime:!1,element:i,extension:{name:ep,value:!0}});if(r.error)return r}return{...oe}}function j1e(t){let e=Cu(t),i=[{[Js]:!0}];!t.enableAll&&i.push({[j2]:!0});let r=Qt(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:s}=t;for(let o of Object.values(e))bnt({tournamentRecord:o,courtIds:a,enableAll:n,dates:s});return{...oe}}function bnt({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e?.includes(a.courtId))if(Array.isArray(r)){let{extension:s}=ki({element:a,name:ep});if(s){let o=s.value;Array.isArray(o.dates)&&(o.dates=o.dates.filter(l=>!r.includes(l))),ur({extension:{name:ep,value:o},creationTime:!1,element:a})}}else Mo({element:a,name:ep});return{...oe}}function z1e(t){let e=Cu(t),i=[{[Js]:!0}];!t.enableAll&&i.push({[z2]:!0});let r=Qt(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let s of Object.values(e))for(let o of s.venues||[])(a||n?.includes(o.venueId))&&Mo({element:o,name:ep});return{...oe}}function q1e(t){let{courtId:e,disableNotice:i,force:r}=t,n=Cu(t),a=Qt(t,[{[Js]:!0,[AUe]:!0}]);if(a.error)return a;let s,o;for(let l of Object.values(n)){if(o=Int({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),o.error&&o.error!==Gm)return o;o.success&&(s=!0)}return s?{...oe}:o}function Int({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){let n=ov({tournamentRecord:t,courtId:i});if(n.error)return n;let a=n.venue,{matchUps:s}=xX({tournamentRecord:t,courtId:i}),o=tr({tournamentRecord:t})?.appliedPolicies,l=r??o?.[tv]?.allowDeletionWithScoresPresent?.courts;if(!s?.length||l){for(let c of s??[]){let u=H1e({matchUpId:c.matchUpId,drawId:c.drawId,tournamentRecord:t});if(u.error)return u}a&&(a.courts=(a.courts??[]).filter(c=>c.courtId!==i),e||Ii({payload:{venue:a,tournamentId:t.tournamentId},topic:vA,key:a.venueId}))}else return OX({matchUpsCount:s.length});return{...oe}}function LX(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,s=Cu(t);if(!Object.keys(s).length)return{error:bn};let o;for(let l of Object.values(s)){let c=wnt({tournamentRecord:l,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(c?.error)return c;o=!0}return o?{...oe}:void 0}function wnt({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:nt};if(!n)return{error:eS};if(!r||typeof r!="object")return{error:AA};let s=ov({tournamentRecord:t,courtId:n});if(s.error)return s;let{venue:o,court:l}=s,c=Object.keys(Srt()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>c.includes(p)).length)return{error:E2};let u=new Set(c.filter(p=>!["dateAvailability"].includes(p))),d=Object.keys(r).filter(p=>u.has(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=_X({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||Ii({payload:{venue:o,tournamentId:t.tournamentId},topic:vA,key:o?.venueId}),{...oe,court:Dt(l)}}var Snt=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),Unt=Snt;function W1e(t){let{modifications:e,venueId:i,force:r}=t,n=Cu(t);if(!Object.keys(n).length)return{error:bn};if(typeof i!="string")return{error:ev};let a,s;for(let o of Object.values(n)){let l=Ent({tournamentRecord:o,modifications:e,venueId:i,force:r});if(l.success&&(s=!0),l.error&&(a=l.error),l.error&&l.error!==vb)return l}return cN({tournamentRecords:n}),s?{...oe}:{error:a}}function Tnt({venue:t,modifications:e,tournamentRecord:i,venueMatchUps:r,allowModificationWhenMatchUpsScheduled:n}){let a=t?.courts?.map(c=>c.courtId)??[],s=e.courts?.map(c=>c.courtId)||[],o=s.length?a.filter(c=>!s.includes(c)):e?.courts&&a,l=[];if(o?.length){let c=t?.courts?.filter(u=>o.includes(u.courtId))?.map(u=>{let d=xX({courtId:u.courtId,tournamentRecord:i,venueMatchUps:r});for(let p of d.matchUps??[])l.push({matchUpId:p.matchUpId,drawId:p.drawId});return d.matchUps?.length??0}).reduce((u,d)=>u+d);return t&&(!c||n)?(t.courts=t.courts?.filter(u=>s.includes(u.courtId)),s1({schedule:{courtId:"",scheduledDate:""},matchUpDetails:l,removePriorValues:!0,tournamentRecord:i}),{success:!0}):OX({matchUpsCount:c})}return{success:!0}}function Cnt({modifications:t,tournamentRecord:e,venueMatchUps:i,venueId:r,force:n}){if(t.courts)for(let a of t.courts){let{courtId:s}=a||{},o=LX({modifications:a,disableNotice:!0,tournamentRecord:e,venueMatchUps:i,courtId:s,force:n});if(o?.error===Gm&&(o=gH({disableNotice:!0,tournamentRecord:e,venueId:r,court:a})),o?.error)return o}return{success:!0}}function Ent({tournamentRecord:t,modifications:e,venueId:i,force:r}){if(!t)return{error:nt};if(!e||typeof e!="object")return{error:AA};if(!i)return{error:ev};let n=tr({tournamentRecord:t})?.appliedPolicies,a=r??n?.[tv]?.allowDeletionWithScoresPresent?.venues,{matchUps:s}=mnt({tournamentRecord:t,venueId:i}),o=qh({tournamentRecord:t,venueId:i});if(o.error)return o;let l=o.venue,c=Object.keys(Unt()).filter(h=>h!=="venueId");if(!Object.keys(e).filter(h=>c.includes(h)).length)return{error:E2};let u=new Set(c.filter(h=>!["courts","onlineResources"].includes(h))),d=Object.keys(e).filter(h=>u.has(h));if(!l)return{error:vb};d.forEach(h=>Object.assign(l,{[h]:e[h]}));let p=Tnt({venue:l,modifications:e,tournamentRecord:t,venueMatchUps:s,allowModificationWhenMatchUpsScheduled:a});if("error"in p&&p.error)return p;let f=Cnt({modifications:e,tournamentRecord:t,venueMatchUps:s,venueId:i,force:r});return f?.error?f:(cN({tournamentRecord:t}),l&&Ii({payload:{venue:l,tournamentId:t.tournamentId},topic:vA,key:l?.venueId}),{...oe,venue:Dt(l)})}var vN={};Li(vN,{JSON2CSV:()=>knt,UUID:()=>hr,UUIDS:()=>bSe,allNumeric:()=>LIe,attributeFilter:()=>nw,chunkArray:()=>$a,chunkByNth:()=>v4,chunkSizeProfile:()=>FIe,constantToString:()=>_s,countValues:()=>m6e,createMap:()=>HIe,dateTime:()=>ySe,definedAttributes:()=>Lt,dehydrateMatchUps:()=>Rnt,extractAttributes:()=>UTe,flattenJSON:()=>$X,generateDateRange:()=>GT,generateHashCode:()=>S6e,generateRange:()=>vt,generateTimeCode:()=>UPe,groupValues:()=>_Ie,hasAttributeValues:()=>w6e,instanceCount:()=>Xl,intersection:()=>Mn,isConvertableInteger:()=>wi,isNumeric:()=>Un,isOdd:()=>kIe,isPowerOf2:()=>op,makeDeepCopy:()=>Dt,matchUpScheduleSort:()=>Pnt,matchUpSort:()=>AS,nearestPowerOf2:()=>I8,nextPowerOf2:()=>lE,noNulls:()=>h6e,noNumeric:()=>$Ie,numericSort:()=>ua,occurrences:()=>g6e,overlap:()=>_o,randomMember:()=>Zu,randomPop:()=>_l,shuffleArray:()=>Po,structureSort:()=>cS,subSort:()=>v6e,undefinedToNull:()=>y4,unique:()=>Ei,visualizeScheduledMatchUps:()=>Dnt});function Dnt({scheduledMatchUps:t,showGlobalLog:e}){J7e();let i=t?.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:s}=t.find(o=>o.structureId===n);return{[n]:`${a} ${s}`}})};i?.forEach(n=>{yl({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let a=t.filter(o=>o.structureId===n),s=Oo({matchUps:a})?.roundMatchUps||[];Object.keys(s).forEach(o=>{yl({roundNumber:o,keyColors:{roundNumber:"brightcyan"}},!0),s[o].forEach(({matchUpId:l,schedule:c})=>{let u=Kr(c.scheduledTime);yl({matchUpId:l,time:u,date:c.scheduledDate,venue:c.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&Z7e()}var{extractTime:tre,timeStringMinutes:ire}=ySe;function Pnt(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=ire(tre(i.scheduledTime)),a=ire(tre(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function Rnt({tournamentRecord:t}){if(!t)return{error:nt};if(typeof t!="object"||!t.tournamentId)return{error:we};let{matchUps:e}=as({tournamentRecord:t,inContext:!1});if(e?.length){let i=Mnt({tournamentRecord:t});Bnt(e,i)}return{...oe}}function Mnt({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var Nnt=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function Bnt(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,s=e[r]||e[n]||e[a],o=i.matchUpFormat===s?void 0:i.matchUpFormat;for(let l of Object.keys(i))Nnt.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}function knt(t,e){if(e&&typeof e!="object")return{error:we};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:s,onlyHeaderRow:o,columnAccessors:l=[],functionMap:c={},columnMap:u={},valuesMap:d={},context:p={},delimiter:f='"',columnJoiner:h=",",rowJoiner:m=`\r
`,keyJoiner:A="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof u!="object"||typeof i!="object"||typeof c!="object"||typeof d!="object"||typeof h!="string"||typeof m!="string"||typeof A!="string"||typeof f!="string")return{error:we};i=Object.assign({},...Object.keys(i).reverse().map(M=>({[M]:Array.isArray(i[M])?i[M]:[typeof i[M]=="string"&&i[M]].filter(Boolean)})));let g=t.filter(Boolean).map(M=>$X(M,A)),v=Object.values(i).flat();r&&l.push(...v);let b=g.reduce((M,N)=>Object.keys(N).every(k=>!M.includes(k)&&M.push(k)||!0)&&M,[]).filter(M=>!l?.length||l.includes(M)),y=Object.assign({},...Object.keys(i).reverse().map(M=>i[M].map(N=>({[N]:M})).flat()).flat()),I=(M,N)=>e?.sortOrder?e.sortOrder.includes(M)&&e.sortOrder.includes(N)&&e.sortOrder.indexOf(M)-e.sortOrder.indexOf(N)||!e.sortOrder.includes(N)&&-1:0,w=b.reduce((M,N)=>{let k=y[N];return k?M.includes(k)||M.push(k):M.push(N),M},[]).sort(I);Object.keys(u).forEach(M=>!w.includes(M)&&w.unshift(M)),Object.keys(i).forEach(M=>!w.includes(M)&&w.unshift(M)),typeof p=="object"&&Object.keys(p).forEach(M=>!w.includes(M)&&w.unshift(M));let S=w.map(M=>u[M]||M);if(o)return[S];let T=M=>`${f}${M}${f}`,D=[],C=M=>Object.values(w.reduce((N,k,O)=>{let x=i[k],F=(x?.length?M[x.find(G=>M[G])]:M[k])||p?.[k]||"",_=d[k]?.[F]||F,V=kl(c[k])?c[k](_):_;return N[k]=T(V),V&&(D[O]=(D[O]||0)+1),N},{})),E=g.map(C),P=s&&[...D].map((M,N)=>!M&&N).filter(Un).reverse();if(P){let M=N=>N.filter((k,O)=>!P.includes(O));E=E.map(M),S=M(S)}let R=E.map(M=>M.join(h));return a?R.map(M=>{let N=M.split(h);return Object.assign({},...N.map((k,O)=>({[S[O]]:k})))}):n?[S.map(T).join(h),...R].join(m):R.join(m)}function $X(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,$X(t[n],e,i.concat(n))),{})}var{FACTORY:rre}=TUe;function xnt({tournamentRecord:t,value:e}){let{extension:i}=ki({element:t,name:rre}),r={name:rre,value:{...i?.value,...e}};ur({element:t,extension:r})}function K1e({timeStamp:t}){let e=nS(),i=Z8();return i&&Object.values(e).forEach(r=>{xnt({tournamentRecord:r,value:{version:m2(),timeStamp:t}})}),i}function Y1e({engineType:t,methodName:e,elapsed:i,params:r,result:n}){let a=Mc();if(typeof a!="object")return;let s={method:e},o=n?.error&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&a.params?.includes(e),c=a.params&&!Array.isArray(a.params)||l,u=Array.isArray(a.exclude)&&a.exclude.includes(e);!u&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(s.elapsed=i),!u&&(o||c)&&(s.params=r),!u&&(o||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&a.result?.includes(e))&&(s.result=n),Object.keys(s).length>1&&uSe(s,t)}function HX({methodName:t,params:e,start:i}){let r={error:D2,methodName:t},n=i?Date.now()-i:0;return Y1e({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}function _nt(t,e){if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:nt};let i=e.drawId||e.matchUp?.drawId;if(i){let{event:a,drawDefinition:s,tournamentId:o}=tl({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),o&&(e.tournamentId=o),a&&(e.event=a)}if(e.eventId&&!e.event){let{event:a,tournamentId:s}=tl({eventId:e.eventId,tournamentRecords:t});if(!a)return{error:fu};e.tournamentId=s,e.event=a}let r=e.tournamentId??rS();if(!r&&e)return e;let n=t[r];return r&&!n?{error:nt}:(n&&(e.tournamentRecord=n),e)}function VX(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),s=rS();i&&(i.activeTournamentId=s);let o=i?.tournamentRecord||eY(s),l=typeof i?.tournamentRecord=="object"&&{[i?.tournamentRecord.tournamentId]:i.tournamentRecord}||nS(),c=i?Dt(i,void 0,!0):void 0,u=i?_nt(l,i):void 0;if(u?.error)return u;let d=Ont({params:u,tournamentRecords:l,tournamentRecord:o,methodName:r,method:e}),p=Date.now()-a;return Y1e({result:d,methodName:r,elapsed:p,params:c,engineType:n}),d}function Ont({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(Mc())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return N2({engineName:"engine",methodName:r,params:i,err:a})}}function bH(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=Tu();for(let s of[...a].sort(Fnt)){let o=oSe({topic:s});o?.length&&R4({topic:s,notices:o})}e&&n&&a.includes(O4)&&R4({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:O4})}var nre={[HY]:5,[$Y]:5,[VY]:5,[LY]:5,[FY]:5,[_Y]:5,[HUe]:5,[VUe]:5,[OY]:1,[J2]:1,[$s]:5,[vA]:5,[xY]:4,[NY]:4,[BY]:4,[kY]:4,[Z2]:3,[PY]:2};function Fnt(t,e){return(nre[e]||0)-(nre[t]||0)}function Lnt({convertExtensions:t,removeExtensions:e}){let i=nS();return{tournamentId:rS(),tournamentRecords:Dt(i,t,!1,e)}}function $nt(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=t?.tournamentId??rS();if(typeof r!="string")return{};let n=eY(r);return{tournamentRecord:Dt(n,e,!1,i)}}function Hnt(){let t=nS(),{extension:e}=ki({name:$y,tournamentRecords:t,discover:!0}),i=e?.value?.tournamentIds||[];return Object.keys(t).forEach(r=>{i.includes(r)||delete t[r]}),M2(t)}function are(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:AA}:t?.tournamentId?lSe(e?Dt(t):t):{error:we}}function o1(t,e=!0){if(typeof t!="object")return{error:AA};if(_P(),Array.isArray(t)){if(t.filter(i=>i?.tournamentId).length!==t.length)return{error:w4};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t?.tournamentId)t={[t.tournamentId]:t},_P(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:w4};return M2(e?Dt(t):t)}function Vnt(t,e,i,r,n,a){let s=dSe(i,r,n,a);if(s.error)return s;let o=s.methods??[];return Object.keys(o).filter(l=>kl(o[l])).forEach(l=>{t[l]=c=>{let u=()=>e(t,{[l]:o[l],...c});if(Mc())return u();try{return u()}catch(d){N2({engineName:"engine",methodName:l,params:c,err:d})}}}),{...oe,...t}}function tU(t,e){return e?.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function X1e(t,e){t.importMethods=(i,r,n,a)=>Vnt(t,e,i,r,n,a),t.getTournament=i=>$nt(i),t.getState=i=>Lnt({convertExtensions:i?.convertExtensions,removeExtensions:i?.removeExtensions}),t.version=()=>m2(),t.reset=()=>(M2({}),tU(t)),t.devContext=i=>(kP(i),tU(t)),t.getDevContext=i=>Mc(i),t.newTournamentRecord=(i={})=>{let r=mH(i),n=r.tournamentId;return r.error?r:(are(r),_P(n),{...oe,tournamentId:n})},t.setState=(i,r,n)=>{xP(r,n);let a=o1(i,r);return tU(t,a)},t.setTournamentId=i=>_P(i),t.getTournamentId=()=>rS(),t.setTournamentRecord=(i,r,n)=>{xP(r,n);let a=are(i,r);return tU(t,a)},t.removeTournamentRecord=i=>{let r=cSe(i);return tU(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=Hnt();return tU(t,i)}}function Gnt(t,e,i){if(!Array.isArray(e))return{error:we,message:"directives must be an array"};let r=sSe(),n=Date.now(),a=i&&Dt(nS(),!1,!0),s=[];for(let c of e){if(typeof c!="object")return{error:we,message:"directive must be an object"};if(c.params&&typeof c.params!="object")return{error:we,message:"params must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!r[u])return HX({methodName:u,start:n,params:p});if(d){let h=s.at(-1),m=Object.keys(d);for(let A of m)h[A]&&(p[A]=h[A])}let f=VX(t,r[u],p,u,"sync");if(f?.error)return a&&o1(a),{...f,rolledBack:!!a};s.push({...f,methodName:u})}let o=Date.now(),l=K1e({timeStamp:o});return bH({directives:e,mutationStatus:l,timeStamp:o}),pM(),{success:s.every(c=>c.success),results:s}}function sre(t,e){if(!Xi(e))return{error:we,message:"args must be an object"};let i=Object.values(e).filter(kl).length;if(i>1)return{message:"there must be only one arg with typeof function",error:we};let r=i?Object.keys(e).find(f=>kl(e[f])):rn(e.method)&&e.method;if(!r)return{error:D2};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=s.rollbackOnError&&Dt(nS(),!1,!0),l=n||t[r]||Y8()[r];if(!l)return HX({methodName:r,params:s});let c=VX(t,l,s,r,"sync")??{};c?.error&&o&&o1(o);let u=Date.now(),d=K1e({timeStamp:u}),p=c?.success&&s?.delayNotify!==!0&&s?.doNotNotify!==!0;return p&&bH({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:u}),(p||!c?.success||s?.doNotNotify)&&pM(),c}var Qnt=(()=>{let t={executionQueue:(e,i)=>Gnt(t,e,i),execute:e=>sre(t,e)};return X1e(t,sre),t})(),GX=Qnt;function ore(t,e){if(!Xi(e))return{error:we,message:"args must be an object"};let i=Object.values(e).filter(kl).length;if(i>1)return{message:"there must be only one arg with typeof function",error:we};let r=i?Object.keys(e).find(l=>kl(e[l])):rn(e.method)&&e.method;if(!r)return{error:D2};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=n||t[r]||Y8()[r];return o?VX(t,o,s,r,"ask"):HX({methodName:r,params:s})}(()=>{let t={execute:e=>ore(t,e)};return X1e(t,ore),t})();var BI={},eg;function Z1e(t,e=!0){if(!t)return{error:Yt};if(typeof t!="object")return{error:AA};if(t.matchUpId)eg=t.matchUpId,BI[eg]=e?Dt(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(BI[i.matchUpId]=e?Dt(i):i,eg||(eg=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(BI[i.matchUpId]=e?Dt(i):i,eg||(eg=i.matchUpId));return e?Dt(t):t}function jnt(){return BI[eg]}function znt(){return Object.values(BI)}function qnt(){eg=void 0,BI={}}function Wnt(t){return Dt(BI[eg],t?.convertExtensions,!1,t?.removeExtensions)}(()=>{let t={getState:i=>Wnt(i),version:()=>m2(),reset:()=>(qnt(),{...oe}),drawId:void 0,error:void 0,success:!1,devContext:i=>(kP(i),t),setState:(i,r,n)=>{xP(r,n);let a=Z1e(i);return e(a)}};function e(i){return i?.error?(t.error=i.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=i.drawId),t}return Knt(t,[r9]),t})();function Knt(t,e){e.forEach(i=>{Object.keys(i).forEach(r=>{t[r]=n=>{if(Mc())return lre(t,{params:n,governor:i,methodName:r});try{return lre(t,{params:n,governor:i,methodName:r})}catch(a){N2({engineName:"matchUpEngine",methodName:r,params:n,err:a})}}})})}function lre(t,{params:e,governor:i,methodName:r}){t.error=void 0,t.success=!1;let n=e?.matchUp||jnt(),a=e?.matchUps||znt(),s=e?.rollbackOnError&&Dt(n,!1,!0);e={...e,matchUpId:n?.matchUpId,matchUps:a,matchUp:n};let o=i[r](e);if(o?.error)return s&&Z1e(s),{...o,rolledBack:!!s};let l=o?.success&&e?.delayNotify!==!0&&e?.doNotNotify!==!0;return l&&bH(),(l||!o?.success||e?.doNotNotify)&&pM(),o}var lG=!1,Ynt=(()=>{let t={version:()=>m2(),setDeepCopy:(n,a)=>(xP(n,a),t),devContext:n=>(kP(n),lG=!0,t)};return i([vX]),t;function e(n,a){let s=n({...a});return s?.error||bH(),pM(),lG&&(kP(!1),lG=!1),s}function i(n){n.forEach(a=>{Object.keys(a).forEach(s=>{t[s]=r(a,s)})})}function r(n,a){return s=>{if(Mc()){let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&o1(o.tournamentRecord),o}else try{let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&o1(o.tournamentRecord),o}catch(o){let l;typeof o=="string"?l=o.toUpperCase():o instanceof Error&&(l=o.message),console.log("ERROR",{params:JSON.stringify(s),method:a,error:l})}}}})();GX.importMethods(A2,!0,1);var Qs=GX,Xnt={getTournamentPoints:L$},Znt=Xnt,Jnt={calculateNewRatings:EEe,generateDynamicRatings:DEe},eat=Jnt,tat={...Znt,...eat};GX.importMethods(tat);var iat={[jP]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},rat={[Bh]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[RI,v0]}},nat={[Bh]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[RI,JP,uw],disabledActions:[]}]}},aat={[Bh]:{policyName:"positionActionsDisabled",enabledStructures:!1}},sat={[vE]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},oat={[mu]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:ld,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[Et]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[tc]:[],[Nf]:[],[Nr]:[],[ic]:[],[Ha]:[],[Zr]:[]}}},cG="Personal circumstance",lat={[mu]:{requireAllPositionsAssigned:!1,stage:{[Et]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:ld,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:ld,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[tc]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[Nf]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[ic]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[Nr]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[Zr]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:cG,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[Ha]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:cG,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[kh]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:cG,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},cat={[Ku]:{seedingProfile:{positioning:AM},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},uat={POLICY_AVOIDANCE_COUNTRY:iat,POLICY_POSITION_ACTIONS_DEFAULT:cEe,POLICY_POSITION_ACTIONS_DISABLED:aat,POLICY_POSITION_ACTIONS_NO_MOVEMENT:nat,POLICY_POSITION_ACTIONS_UNRESTRICTED:rat,POLICY_PRIVACY_DEFAULT:sat,POLICY_ROUND_NAMING_DEFAULT:XY,POLICY_SCHEDULING_DEFAULT:VDe,POLICY_SCORING_DEFAULT:oat,POLICY_SCORING_USTA:lat,POLICY_SEEDING_ITF:cat,POLICY_SEEDING_DEFAULT:UDe},tx={ratingsParameters:qa,matchUpFormats:W8e,countryToFlag:KUe,tieFormats:r0e,countries:og,policies:uat,flagIOC:jYe},yN={};Li(yN,{activeMatchUpStatuses:()=>DY,auditConstants:()=>Ytt,completedMatchUpStatuses:()=>ta,directingMatchUpStatuses:()=>xUe,displayConstants:()=>Itt,drawDefinitionConstants:()=>dUe,entryStatusConstants:()=>e7e,errorConditionConstants:()=>V6e,eventConstants:()=>J8e,extensionConstants:()=>TUe,flightConstants:()=>cit,genderConstants:()=>B2,keyValueConstants:()=>DJe,matchUpActionConstants:()=>$Ze,matchUpStatusConstants:()=>jh,matchUpTypes:()=>u6e,nonDirectingMatchUpStatuses:()=>_Ue,particicipantsRequiredMatchUpStatuses:()=>BUe,participantConstants:()=>QYe,participantRoles:()=>d7,participantTypes:()=>h0,penaltyConstants:()=>Dat,policyConstants:()=>EYe,positionActionConstants:()=>zXe,ratingConstants:()=>uZe,recoveryTimeRequiredMatchUpStatuses:()=>LYe,requestConstants:()=>rrt,resourceContants:()=>H8e,resultConstants:()=>U6e,scaleConstants:()=>SYe,scheduleConstants:()=>P7e,sortingConstants:()=>Ait,surfaceConstants:()=>kat,tieFormatConstants:()=>K8e,timeItemConstants:()=>S7e,topicConstants:()=>HYe,tournamentConstants:()=>P1e,upcomingMatchUpStatuses:()=>OUe,validMatchUpStatuses:()=>kUe,venueConstants:()=>Oat,weekdayConstants:()=>c0e});var dat="Coaching",pat="Ball Abuse",fat="Racket Abuse",hat="Verbal Abuse",mat="INELIGIBILITY",Aat="Physical Abuse",gat="Unsportmanlike Conduct",vat="Dress Code Violation",yat="Equipment Violation",bat="Leaving the court",Iat="Failure to complete",wat="No Show",Sat="Other",Uat="REFUSAL_TO_PLAY",Tat="PROHIBITED_SUBSTANCE",Cat="Puncuality",Eat="Failure to sign in",Dat={COACHING:dat,BALL_ABUSE:pat,RACKET_ABUSE:fat,VERBAL_ABUSE:hat,PHYSICAL_ABUSE:Aat,INELIGIBILITY:mat,UNSPORTSMANLIKE_CONDUCT:gat,PROHIBITED_SUBSTANCE:Tat,DRESS_CODE_VIOLATION:vat,EQUIMENT_VIOLATION:yat,LEAVING_THE_COURT:bat,REFUSAL_TO_PLAY:Uat,FAILURE_TO_COMPLETE:Iat,NO_SHOW:wat,OTHER:Sat,PUNCTUALITY:Cat,FAILUIRE_TO_SIGN_IN:Eat},Pat="CLAY",Rat="HARD",Mat="GRASS",Nat="CARPET",Bat="ARTIFICIAL",kat={CLAY:Pat,HARD:Rat,GRASS:Mat,CARPET:Nat,ARTIFICIAL:Bat},xat="INDOOR",_at="OUTDOOR",Oat={INDOOR:xat,OUTDOOR:_at};const Fat=mr({WebkitBoxSizing:"border-box",marginInlineEnd:".3em",display:"inline-block",boxSizing:"border-box",position:"relative",borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function Lat({matchUp:t,individualParticipant:e,spacer:i}){const r=e?.person?.iso2NationalityCode||"",n=r?tx.countryToFlag(r)?.slice(0,4):"",a=document.createElement("span"),s=t?.matchUpType?.toLowerCase();return i||(a.className=Fat({variant:s})),a.innerHTML=i?"":n,a}function uG({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n,side:a,type:s}){if(s==="scale")return l6e({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n});const o=e?.configuration||{},l=document.createElement("div");if(s==="flag"&&o.flags)return Lat({matchUp:r,individualParticipant:t,spacer:n});if(s==="seeding"){const c=s6e({className:i,composition:e,side:a});return typeof c=="string"?l:c}return l}const $at="Qualifier",Hat="BYE",Vat="TBD";function cre(t){const{isWinningSide:e,side:i,sideNumber:r,individualParticipant:n,matchUp:a,composition:s}=t||{},o=e?"winner":void 0,l=t.eventHandlers||{},c=s?.configuration,u={QUALIFIER:c?.placeHolders?.qualifier||$at,BYE:c?.placeHolders?.bye||Hat,TBD:c?.placeHolders?.tbd||Vat},d=n?.participantName,p=S=>{co(l?.participantClick)&&(S.stopPropagation(),l.participantClick({individualParticipant:n,pointerEvent:S,matchUp:a,side:i}))},f=document.createElement("div");f.classList.add("tmx-i"),f.setAttribute("sideNumber",String(r)),f.setAttribute("id",n?.participantId),f.onclick=p;const h=document.createElement("div");h.className=tKe({variant:o});const m=c?.flags&&uG({...t,type:"flag"});if(m)h.appendChild(m);else{const S=uG({type:"scale",...t});S&&h.appendChild(S)}const A=document.createElement("div");A.className=iKe({variant:o});const g=a?.roundNumber===1,v=a?.drawType==="FEED_IN"&&a?.roundNumber>1&&i?.drawPosition&&!i?.sourceMatchUp,b=g||v,y=c?.persistInputFields;if(c?.inlineAssignment&&co(l?.assignParticipant)&&co(c?.participantProvider)&&b&&(!i?.bye||y)&&(!i?.qualifier||y)&&a&&(!d||i?.bye||i?.qualifier||y)){let S;i?.bye?S={participantId:"__BYE__",participantName:" BYE "}:i?.qualifier?S={participantId:"__QUALIFIER__",participantName:" QUALIFIER "}:S=n;const T=n6e({matchUp:a,side:i,sideNumber:r,eventHandlers:l,composition:s,currentParticipant:S});A.appendChild(T)}else if(d){const S=document.createElement("span");if(e&&c?.winnerColor)S.style.color=typeof c.winnerColor=="string"?c.winnerColor:"green";else if(c?.genderColor){const T=n?.person?.sex,D=T==="MALE"&&"#2E86C1"||T==="FEMALE"&&"#AA336A"||"";S.style.color=typeof c.genderColor=="string"?c.genderColor:D}S.innerHTML=d,A.appendChild(S)}else{const S=document.createElement("abbr");S.className=eKe({variant:c?.showAddress?"showAddress":""}),S.innerHTML=i?.bye&&u.BYE||i?.qualifier&&u.QUALIFIER||u.TBD,A.appendChild(S)}const I=uG({...t,className:a6e(),type:"seeding"});I&&A.appendChild(I),h.appendChild(A),f.appendChild(h);const w=yKe(t);return f.appendChild(w),{element:f}}const Gat=mr({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{in_progress:{backgroundColor:"#199f01ff"},awaiting_result:{backgroundColor:"#199f01ff"},defaulted:{backgroundColor:"#df164c"},dead_rubber:{backgroundColor:"#df164c"},cancelled:{backgroundColor:"#df164c"},incomplete:{backgroundColor:"#f7ae04ff"},suspended:{backgroundColor:"#f7ae04ff"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"},double_default:{backgroundColor:"#df164c"},abandoned:{backgroundColor:"black"}}}}),{WALKOVER:Qat,DEFAULTED:jat,DOUBLE_WALKOVER:zat,DOUBLE_DEFAULT:qat,ABANDONED:Wat}=jh;function Kat({matchUpStatus:t}){const e=t?.toLowerCase(),i=["defaulted","retired","walkover","defaulted","double_walkover","double_default","cancelled","in_progress","awaiting_result","dead_rubber","incomplete","suspended","abandoned"].includes(e)?e:void 0,r=[Qat,zat].includes(t||"")?"WO":[jat,qat].includes(t||"")?"DEF":t===Wat?"ABD":t?.split("_").join("").slice(0,3)||"",n=document.createElement("div");n.className=Gat(i?{variant:i}:{});const a=document.createElement("abbr");return a.setAttribute("title",t||""),a.style.textDecoration="none",a.style.borderBottom="none",a.innerHTML=r,n.appendChild(a),n}function Yat(t){return t instanceof Element||t}const Xat=mr({marginInlineEnd:".5rem",backgroundColor:"pink",marginInlineStart:2,height:40,width:40});function Zat({teamLogo:t}){console.log({teamLogo:t});const e=document.createElement("div");return e.className=Xat(),e}const Jat=mr({flexDirection:"column",position:"relative",display:"flex"}),est=mr({alignItems:"stretch",display:"flex"}),tst=mr({marginInlineEnd:".25rem",color:"green"});function ist({dim:t="20px"}={}){const e=tst();return`
    <div style="line-height: 0;">
      <svg height="${t}" viewBox="0 0 18 24" width="${t}" xmlns="http://www.w3.org/2000/svg" class="${e}" style="fill: currentcolor;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
      </svg>
    </div>
  `}const{WALKOVER:rst,DEFAULTED:nst,DOUBLE_WALKOVER:ast,DOUBLE_DEFAULT:sst,RETIRED:ost,SUSPENDED:lst,CANCELLED:cst,IN_PROGRESS:ust,ABANDONED:dst}=jh;function J1e({initialRoundNumber:t=1,eventHandlers:e,sideContainer:i,composition:r,participant:n,placeholder:a,sideNumber:s,matchUp:o}){const{winningSide:l,matchUpType:c,isRoundRobin:u,matchUpStatus:d}=o||{},p=r?.configuration;let f;const h=s?o?.sides?.find(E=>E.sideNumber===s):void 0;n||(n=h?.participant,f=p?.allDrawPositions||p?.drawPositions&&h?.drawPosition&&(o?.roundNumber===t||h?.participantFed||u)?h?.drawPosition:"");const m=c==="DOUBLES",A=m?n?.individualParticipants?.[0]:n,g=m&&n?.individualParticipants?.[1],v=!!(s===l||d==="BYE"&&n),b=p?.winnerChevron&&v,y=p?.teamLogo,I=[ost,rst,nst,ast,sst,lst,cst,ust,dst].includes(d)&&!v,w=p?.gameScoreOnly,S=document.createElement("div");if(i&&(S.className=nKe({drawPosition:f,sideNumber:s})),S.classList.add("tmx-p"),S.setAttribute("id",n?.participantId||""),y){const E=Zat({teamLogo:y});S.appendChild(E)}const T=document.createElement("div");T.className=rKe(m?{variant:"doubles"}:{});const D=document.createElement("div");D.className=aKe({winnerChevron:b,isDoubles:m});const C=cre({individualParticipant:A,eventHandlers:e,isWinningSide:v,composition:r,sideNumber:s,matchUp:o,side:h}).element;if(D.appendChild(C),g){const E=cre({individualParticipant:g,eventHandlers:e,isWinningSide:v,composition:r,sideNumber:s,matchUp:o,side:h}).element;D.appendChild(E)}else m&&a&&Yat(a)&&D.appendChild(a);if(T.appendChild(D),S.appendChild(T),i){const E=document.createElement("div");if(v&&!w){const P=ist();typeof P=="string"?E.innerHTML=P:E.appendChild(P)}else if(I){const P=Kat({matchUpStatus:d});E.appendChild(P)}S.appendChild(E)}return S}const pst=mr({borderBottom:"solid 1px black",marginInlineStart:"16px",marginInlineEnd:"16px",fontWeight:"bold",height:"1.5em"});function fst({eventHandlers:t,roundMatchUps:e,roundProfile:i,roundNumber:r,context:n}){const a=document.createElement("div");a.className=pst(),a.classList.add("tmx-rh"),a.setAttribute("roundNumber",String(r));const s=co(t?.roundHeaderClick);s&&(a.onclick=u=>t.roundHeaderClick({roundNumber:r,roundProfile:i,roundMatchUps:e,context:n,pointerEvent:u}));const o=s?"":"",l=i?.[r]?.roundName,c=l&&` <div style="display: flex; flex-direction: row; justify-content: space-between">
        <div>${l}</div>
        <div style="font-weight: bold">${o}</div>
      </div>
  `;return a.innerHTML=c||"",a}const eRe=mr({flexDirection:"column",display:"flex"}),hst=mr({flexDirection:"row",display:"flex"}),tRe=mr({justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",flexDirection:"column",height:"100%",display:"flex",variants:{variant:{adHoc:{justifyContent:"flex-start"}}}}),mst=mr({borderTop:"solid 1px black",marginRight:"-1em",marginLeft:"-1em",paddingTop:".5em",marginTop:".2em",variants:{variant:{0:{marginTop:"1em",borderTop:"none",paddingTop:"0px"}},roundOrder:{first:{marginLeft:"0em"},last:{marginRight:"0em"}}}}),Ast=mr({fontWeight:"bold",color:"blue",height:"1em"}),ure=mr({width:"$score$setWidth",display:"inline-block",fontSize:9,variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),gst=mr({transform:"translateY(-50%)",textTransform:"uppercase",backgroundColor:"#fff",position:"absolute",textAlign:"center",top:"calc(50%)",color:"#bbb",fontSize:0,right:4});function vst(){return mr({backgroundColor:"magenta",position:"absolute",opacity:"0.2",height:"100%",width:"100%",top:0})()}const yst=mr({});function bst({configuration:t}){const e={backgroundColor:"$matchUpBackgroundColor",WebkitTransition:"all 0.30s linear",boxShadow:"$matchUp$boxShadow",transition:"all 0.30s linear",border:"solid $border",marginBottom:"$space$1",marginTop:"$space$1",position:"relative",display:"grid",width:"100%",borderInlineStartWidth:"$borderWidths$borderInlineStart"};if(t?.matchUpHover){const i=typeof t.matchUpHover=="string"?t.matchUpHover:"cyan";e["&:hover"]={backgroundColor:i}}else e["&:hover"]={borderColor:"$borderHover"};return mr(e)()}function Ist({variant:t}){return mr({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",position:"relative",width:"100%",height:"$lineHeights$centerInfo",variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}})({variant:t})}const wst=mr({justifyContent:"center",alignContent:"center",flexDirection:"column",height:"100%",display:"flex"}),Sst=mr({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",marginInlineStart:"calc(20%)",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",WebkitBoxPack:"center",boxSizing:"inherit",flexDirection:"row",display:"flex"}),dre=mr({alignContent:"center",boxSizing:"inherit",fontFamily:"Lato",fontWeight:900,fontSize:9});function Ust({eventHandlers:t,entryStatus:e,sideNumber:i,className:r,matchUp:n}){const a=document.createElement("div");co(t?.centerInfoClick)&&(a.onclick=u=>t.centerInfoClick({matchUp:n,sideNumber:i,pointerEvent:u})),a.className=hb(Ist({variant:i}),r),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",String(i));const s=document.createElement("div");s.className=wst();const o=document.createElement("div");o.className=Sst();const l=document.createElement("div");l.className=dre(),l.innerHTML=e?"Entry status:&nbsp;":"",o.appendChild(l);const c=document.createElement("div");return c.className=dre(),c.innerHTML=e||"",o.appendChild(c),s.appendChild(o),a.appendChild(s),{element:a}}const b0={scheduleInfo:1.8,centerInfo:1.5,gameScore:2};function Tst({composition:t,isDoubles:e,roundFactor:i=1}){const r=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),n=t?.configuration||{},a=n?.connectorWidth||16,s=n.centerInfo?b0.centerInfo*r:0,o=n.scheduleInfo?b0.scheduleInfo*r:0,l=(60+(n.showAddress?r:0))*(e?1.3:1)+s,c=l*i,u=(l+o)*i;return mr({"&::before":{borderBlockStart:"$borderWidths$matchUp solid #999",left:-a,width:a,position:"absolute",borderRadius:2,top:-1},"&::after":{width:a,position:"absolute",borderRadius:2,left:"100%"},"&::after, &::before":{borderWidth:"$borderWidths$matchUp",borderColor:"$connector",display:"block",content:""},variants:{isFirstRound:{true:{"&::before":{height:0,width:0,borderWidth:0}}},link:{m1:{"&::after":{borderInlineEnd:"$borderWidths$matchUp solid $connector",borderTopStyle:"solid",height:c,top:-1}},m2:{"&::after":{bottom:"calc(100%)",borderInlineEnd:"$borderWidths$matchUp solid $connector",borderBottomStyle:"solid",height:u}},m0:{"&::after":{borderTopStyle:"solid",borderColor:"$connector",top:-1}},mr:{"&::before":{height:0,width:0,borderWidth:0},"&::after":{height:0,width:0,borderWidth:0}},noProgression:{true:{"&::after":{height:0,width:0,borderWidth:0}}}}}})}const iRe=t=>mr({display:"flex",alignItems:"center",height:t,justifyContent:"flex-end",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}},fontSize:{small:{fontSize:"smaller",paddingRight:"1em",color:"blue"}}}}),Cst=mr({lineHeight:"0.75rem",fontSize:"0.625rem",left:"1.1rem",top:".4rem"}),rRe=mr({lineHeight:"$lineHeights$gameScore",justifyContent:"center",width:"$score$setWidth",position:"relative",textAlign:"center",cursor:"pointer",fontWeight:500,fontSize:"$1",display:"flex",margin:0,variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),Est=mr({marginInlineEnd:"$space$gameMarginInlineEnd",justifyContent:"flex-end",alignItems:"center",display:"flex"});function Dst({value:t}={}){const e=document.createElement("input");return e.onclick=i=>i.target.select(),e.className=rRe(),e.value=String(t||""),e}function Pst({gameScoreOnly:t,scoreStripes:e,set:i,sideNumber:r}){const n=r===i?.winningSide||i?.winningSide?"loser":void 0,a=r===2?i.side2Score:i.side1Score,s=i.side2TiebreakScore||i.side1TiebreakScore,o=r===2?i.side2TiebreakScore:i.side1TiebreakScore,l=a===void 0&&o,c=l||a,u=e&&i.setNumber%2?"lightgray":"transparent",d=i.editing?i.editing===r:void 0;let p;if(d)p=Dst({value:c});else if(p=document.createElement("p"),p.className=rRe({variant:n}),p.classList.add("tmx-st"),p.setAttribute("setNumber",i.setNumber),p.style.backgroundColor=u,p.innerHTML=isNaN(c)?"":c,!t){const f=document.createElement("span");f.className=Cst(),f.innerHTML=s&&!l?String(o):"",p.appendChild(f)}return p}function Rst({participantHeight:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:n}){const a=i?.configuration?.winnerChevron,s=i?.configuration?.gameScoreOnly,o=n?.score?.sets||[],l=i?.configuration?.scoreBox,c=t?r===2?t:t-1:void 0,u=f=>{co(e?.scoreClick)&&(f.stopPropagation(),e.scoreClick({pointerEvent:f,matchUp:n}))},d=document.createElement("div");d.className=iRe(c)({...!l&&r===1&&{sideNumber:1},fontSize:"small"}),d.classList.add("sideScore"),d.classList.add("tmx-scr"),d.onclick=u;const p=document.createElement("div");p.className=Est();for(const f of o||[]){const h=Pst({gameScoreOnly:s,scoreStripes:a,sideNumber:r,set:f});p.appendChild(h)}return d.appendChild(p),d}const Mst=mr({height:"$lineHeights$scheduleInfo",borderBottom:"1px solid darkgray",justifyContent:"space-between",backgroundColor:"#F8F9F9",boxSizing:"border-box",paddingRight:"0.2rem",paddingLeft:"0.5rem",alignItems:"center",cursor:"pointer",color:"#7F8080",display:"flex",width:"100%"});var m3={exports:{}},Nst=m3.exports,pre;function Bst(){return pre||(pre=1,(function(t,e){(function(i,r){t.exports=r()})(Nst,(function(){var i=1e3,r=6e4,n=36e5,a="millisecond",s="second",o="minute",l="hour",c="day",u="week",d="month",p="quarter",f="year",h="date",m="Invalid Date",A=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(M){var N=["th","st","nd","rd"],k=M%100;return"["+M+(N[(k-20)%10]||N[k]||N[0])+"]"}},b=function(M,N,k){var O=String(M);return!O||O.length>=N?M:""+Array(N+1-O.length).join(k)+M},y={s:b,z:function(M){var N=-M.utcOffset(),k=Math.abs(N),O=Math.floor(k/60),x=k%60;return(N<=0?"+":"-")+b(O,2,"0")+":"+b(x,2,"0")},m:function M(N,k){if(N.date()<k.date())return-M(k,N);var O=12*(k.year()-N.year())+(k.month()-N.month()),x=N.clone().add(O,d),F=k-x<0,_=N.clone().add(O+(F?-1:1),d);return+(-(O+(k-x)/(F?x-_:_-x))||0)},a:function(M){return M<0?Math.ceil(M)||0:Math.floor(M)},p:function(M){return{M:d,y:f,w:u,d:c,D:h,h:l,m:o,s,ms:a,Q:p}[M]||String(M||"").toLowerCase().replace(/s$/,"")},u:function(M){return M===void 0}},I="en",w={};w[I]=v;var S="$isDayjsObject",T=function(M){return M instanceof P||!(!M||!M[S])},D=function M(N,k,O){var x;if(!N)return I;if(typeof N=="string"){var F=N.toLowerCase();w[F]&&(x=F),k&&(w[F]=k,x=F);var _=N.split("-");if(!x&&_.length>1)return M(_[0])}else{var V=N.name;w[V]=N,x=V}return!O&&x&&(I=x),x||!O&&I},C=function(M,N){if(T(M))return M.clone();var k=typeof N=="object"?N:{};return k.date=M,k.args=arguments,new P(k)},E=y;E.l=D,E.i=T,E.w=function(M,N){return C(M,{locale:N.$L,utc:N.$u,x:N.$x,$offset:N.$offset})};var P=(function(){function M(k){this.$L=D(k.locale,null,!0),this.parse(k),this.$x=this.$x||k.x||{},this[S]=!0}var N=M.prototype;return N.parse=function(k){this.$d=(function(O){var x=O.date,F=O.utc;if(x===null)return new Date(NaN);if(E.u(x))return new Date;if(x instanceof Date)return new Date(x);if(typeof x=="string"&&!/Z$/i.test(x)){var _=x.match(A);if(_){var V=_[2]-1||0,G=(_[7]||"0").substring(0,3);return F?new Date(Date.UTC(_[1],V,_[3]||1,_[4]||0,_[5]||0,_[6]||0,G)):new Date(_[1],V,_[3]||1,_[4]||0,_[5]||0,_[6]||0,G)}}return new Date(x)})(k),this.init()},N.init=function(){var k=this.$d;this.$y=k.getFullYear(),this.$M=k.getMonth(),this.$D=k.getDate(),this.$W=k.getDay(),this.$H=k.getHours(),this.$m=k.getMinutes(),this.$s=k.getSeconds(),this.$ms=k.getMilliseconds()},N.$utils=function(){return E},N.isValid=function(){return this.$d.toString()!==m},N.isSame=function(k,O){var x=C(k);return this.startOf(O)<=x&&x<=this.endOf(O)},N.isAfter=function(k,O){return C(k)<this.startOf(O)},N.isBefore=function(k,O){return this.endOf(O)<C(k)},N.$g=function(k,O,x){return E.u(k)?this[O]:this.set(x,k)},N.unix=function(){return Math.floor(this.valueOf()/1e3)},N.valueOf=function(){return this.$d.getTime()},N.startOf=function(k,O){var x=this,F=!!E.u(O)||O,_=E.p(k),V=function(J,ie){var ue=E.w(x.$u?Date.UTC(x.$y,ie,J):new Date(x.$y,ie,J),x);return F?ue:ue.endOf(c)},G=function(J,ie){return E.w(x.toDate()[J].apply(x.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(ie)),x)},z=this.$W,Q=this.$M,j=this.$D,W="set"+(this.$u?"UTC":"");switch(_){case f:return F?V(1,0):V(31,11);case d:return F?V(1,Q):V(0,Q+1);case u:var Y=this.$locale().weekStart||0,X=(z<Y?z+7:z)-Y;return V(F?j-X:j+(6-X),Q);case c:case h:return G(W+"Hours",0);case l:return G(W+"Minutes",1);case o:return G(W+"Seconds",2);case s:return G(W+"Milliseconds",3);default:return this.clone()}},N.endOf=function(k){return this.startOf(k,!1)},N.$set=function(k,O){var x,F=E.p(k),_="set"+(this.$u?"UTC":""),V=(x={},x[c]=_+"Date",x[h]=_+"Date",x[d]=_+"Month",x[f]=_+"FullYear",x[l]=_+"Hours",x[o]=_+"Minutes",x[s]=_+"Seconds",x[a]=_+"Milliseconds",x)[F],G=F===c?this.$D+(O-this.$W):O;if(F===d||F===f){var z=this.clone().set(h,1);z.$d[V](G),z.init(),this.$d=z.set(h,Math.min(this.$D,z.daysInMonth())).$d}else V&&this.$d[V](G);return this.init(),this},N.set=function(k,O){return this.clone().$set(k,O)},N.get=function(k){return this[E.p(k)]()},N.add=function(k,O){var x,F=this;k=Number(k);var _=E.p(O),V=function(Q){var j=C(F);return E.w(j.date(j.date()+Math.round(Q*k)),F)};if(_===d)return this.set(d,this.$M+k);if(_===f)return this.set(f,this.$y+k);if(_===c)return V(1);if(_===u)return V(7);var G=(x={},x[o]=r,x[l]=n,x[s]=i,x)[_]||1,z=this.$d.getTime()+k*G;return E.w(z,this)},N.subtract=function(k,O){return this.add(-1*k,O)},N.format=function(k){var O=this,x=this.$locale();if(!this.isValid())return x.invalidDate||m;var F=k||"YYYY-MM-DDTHH:mm:ssZ",_=E.z(this),V=this.$H,G=this.$m,z=this.$M,Q=x.weekdays,j=x.months,W=x.meridiem,Y=function(ie,ue,ne,ge){return ie&&(ie[ue]||ie(O,F))||ne[ue].slice(0,ge)},X=function(ie){return E.s(V%12||12,ie,"0")},J=W||function(ie,ue,ne){var ge=ie<12?"AM":"PM";return ne?ge.toLowerCase():ge};return F.replace(g,(function(ie,ue){return ue||(function(ne){switch(ne){case"YY":return String(O.$y).slice(-2);case"YYYY":return E.s(O.$y,4,"0");case"M":return z+1;case"MM":return E.s(z+1,2,"0");case"MMM":return Y(x.monthsShort,z,j,3);case"MMMM":return Y(j,z);case"D":return O.$D;case"DD":return E.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return Y(x.weekdaysMin,O.$W,Q,2);case"ddd":return Y(x.weekdaysShort,O.$W,Q,3);case"dddd":return Q[O.$W];case"H":return String(V);case"HH":return E.s(V,2,"0");case"h":return X(1);case"hh":return X(2);case"a":return J(V,G,!0);case"A":return J(V,G,!1);case"m":return String(G);case"mm":return E.s(G,2,"0");case"s":return String(O.$s);case"ss":return E.s(O.$s,2,"0");case"SSS":return E.s(O.$ms,3,"0");case"Z":return _}return null})(ie)||_.replace(":","")}))},N.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},N.diff=function(k,O,x){var F,_=this,V=E.p(O),G=C(k),z=(G.utcOffset()-this.utcOffset())*r,Q=this-G,j=function(){return E.m(_,G)};switch(V){case f:F=j()/12;break;case d:F=j();break;case p:F=j()/3;break;case u:F=(Q-z)/6048e5;break;case c:F=(Q-z)/864e5;break;case l:F=Q/n;break;case o:F=Q/r;break;case s:F=Q/i;break;default:F=Q}return x?F:E.a(F)},N.daysInMonth=function(){return this.endOf(d).$D},N.$locale=function(){return w[this.$L]},N.locale=function(k,O){if(!k)return this.$L;var x=this.clone(),F=D(k,O,!0);return F&&(x.$L=F),x},N.clone=function(){return E.w(this.$d,this)},N.toDate=function(){return new Date(this.valueOf())},N.toJSON=function(){return this.isValid()?this.toISOString():null},N.toISOString=function(){return this.$d.toISOString()},N.toString=function(){return this.$d.toUTCString()},M})(),R=P.prototype;return C.prototype=R,[["$ms",a],["$s",s],["$m",o],["$H",l],["$W",c],["$M",d],["$y",f],["$D",h]].forEach((function(M){R[M[1]]=function(N){return this.$g(N,M[0],M[1])}})),C.extend=function(M,N){return M.$i||(M(N,P,C),M.$i=!0),C},C.locale=D,C.isDayjs=T,C.unix=function(M){return C(1e3*M)},C.en=w[I],C.Ls=w,C.p={},C}))})(m3)),m3.exports}var kst=Bst();const xst=f8(kst);function _st({matchUp:t,eventHandlers:e}){const{scheduledTime:i,scheduledDate:r,venueAbbreviation:n,courtName:a}=t?.schedule||{},{dateTime:{extractDate:s,extractTime:o}}=vN,l=o(i);let c=s(r),u="ddd D MMMM";l&&(u+=", hh:mm A",c+=`T${l}`);const d=r?xst(c).format(u):"Not scheduled",p=n&&a?.toString().startsWith(n)&&a||n&&a&&`${n} ${a}`||a||n||"",f=document.createElement("div");f.className=Mst(),f.classList.add("tmx-sch"),co(e?.scheduleClick)&&(f.onclick=v=>e.scheduleClick({matchUp:t,pointerEvent:v}));const h=document.createElement("div");h.innerHTML=d,f.append(h);const m=v=>{co(e?.venueClick)&&(v.stopPropagation(),e.venueClick({pointerEvent:v,matchUp:t}))},A=document.createElement("div");A.style="display: flex; flex-direction: row";const g=document.createElement("div");if(g.style.paddingRight=".2rem",g.onclick=m,g.innerHTML=p,A.append(g),f.append(A),f.onclick){const v=document.createElement("div");v.innerHTML="",A.append(v)}return f}const{completedMatchUpStatuses:Ost}=yN;function fre({initialRoundNumber:t=1,eventHandlers:e,composition:i,sideNumber:r,className:n,matchUp:a}){const s=(i?.configuration||{})?.scheduleInfo,o=a?.score?.scoreStringSide1,l=i?.configuration?.scoreBox&&o,c=a?.matchUpStatus&&Ost.includes(a.matchUpStatus),u=a?.readyToScore&&e?.scoreClick&&!Qs.checkScoreHasValue({matchUp:a})&&!c,d=document.createElement("div");if(d.className=hb(Jat(),n),d.classList.add("tmx-sd"),d.setAttribute("sideNumber",String(r)),s&&r===1){const h=_st({matchUp:a,eventHandlers:e});d.appendChild(h)}const p=document.createElement("div");p.className=est();const f=J1e({sideContainer:!0,initialRoundNumber:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:a});if(p.appendChild(f),l){const h=document.createElement("div");h.style.border="1px solid lightgray",p.appendChild(h)}if(o){const h=Rst({eventHandlers:e,composition:i,sideNumber:r,matchUp:a});p.appendChild(h)}if(u){const h=A=>{co(e?.scoreClick)&&(A.stopPropagation(),e.scoreClick({pointerEvent:A,matchUp:a}))},m=document.createElement("div");m.className=iRe(void 0)({...!l&&r===1&&{sideNumber:1},fontSize:"small"}),m.onclick=h,m.innerHTML="[Score]",p.appendChild(m)}return d.appendChild(p),d}function bN(t){const{composition:e,initialRoundNumber:i=1,matchUp:r,moiety:n,selectedMatchUpId:a,searchActive:s}=t,{roundFactor:o,roundNumber:l,finishingRound:c,matchUpType:u,preFeedRound:d,stage:p}=r,f=t.isFinalRound||(c?Number.parseInt(String(c))===1:!1),h=p==="QUALIFYING"&&f,m=f,A=l?Number.parseInt(String(l))===i:!1,g=u==="DOUBLES",v=(s||r.isRoundRobin||r.collectionId||t.isLucky||t.isAdHoc)&&"mr"||m&&"noProgression"||(h||d)&&"m0"||n&&"m1"||"m2",b=Tst({composition:e,isDoubles:g,roundFactor:o})({isFirstRound:A,link:v}),y=e?.configuration||{},{resultsInfo:I,centerInfo:w}=y||{},S=t.eventHandlers||{},T=M=>{co(S?.matchUpClick)&&S.matchUpClick({pointerEvent:M,matchUp:r})},D=document.createElement("div");D.className=hb(e?.theme,t?.className,"matchup",yst()),D.classList.add("tmx-m"),D.setAttribute("id",r?.matchUpId),D.onclick=T;const C=document.createElement("div");C.className=bst({configuration:y});const E=({sideNumber:M})=>{const N=r?.sides?.find(k=>k.sideNumber===M)?.participant?.entryStatus?.replace("_"," ");return Ust({eventHandlers:S,entryStatus:N,sideNumber:M,className:M===2?b:void 0,matchUp:r})},P=fre({initialRoundNumber:i,eventHandlers:S,sideNumber:1,composition:e,matchUp:r}),R=fre({className:!w&&b,initialRoundNumber:i,eventHandlers:S,sideNumber:2,composition:e,matchUp:r});if(C.appendChild(P),w){const M=E({sideNumber:1}),N=E({sideNumber:2});C.appendChild(M.element),C.appendChild(N.element)}if(C.appendChild(R),I){const M=Fst({score:r.score});C.appendChild(M)}if(D.appendChild(C),a===r.matchUpId){const M=document.createElement("div");M.className=vst(),D.appendChild(M)}return D}function Fst({score:t}){const e=t?.sets?.filter(Boolean).sort((a,s)=>(a.setNumber||0)-(s.setNumber||0)),i=e?.at(-1),r=i?.side1PointsScore||i?.side2PointsScore,n=document.createElement("div");if(n.className=gst(),r){const a=document.createElement("div");a.className=ure({variant:"points"}),a.innerHTML="PTS",n.appendChild(a)}for(const a of e||[]){const s=document.createElement("div");s.setAttribute("key",String(a.setNumber)),s.className=ure({variant:"set"}),s.innerHTML=String(a.setNumber),n.appendChild(s)}return n}function Lst({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,isRoundRobin:n,searchActive:a,composition:s,roundFactor:o,roundNumber:l,roundProfile:c,minWidth:u,matchUps:d,context:p,isLucky:f}){const h=d.filter(C=>C.roundNumber===l).sort((C,E)=>(C.roundPosition||0)-(E.roundPosition||0)),m=h.every(({roundPosition:C,drawPositions:E})=>!C&&!E),A=s?.configuration||{},g=document.createElement("div");if(g.className=eRe(),g.classList.add("tmx-rd"),g.setAttribute("roundNumber",String(l)),A.roundHeader){const C=fst({roundProfile:c,roundMatchUps:h,roundNumber:l,eventHandlers:i,context:p});g.appendChild(C)}const v=document.createElement("div");v.className=tRe({variant:m?"adHoc":void 0}),u&&(v.style.minWidth=u);let b,y,I;if(n){const C=P=>(P||[]).reduce((R,M)=>M+R,0);h.sort((P,R)=>{const M=C(P.drawPositions)-C(R.drawPositions),N=P.drawPositions||[],k=R.drawPositions||[],O=(N.length?Math.min.apply(null,N):0)-(k.length?Math.min.apply(null,k):0);return M||O});const E=h.reduce((P,R)=>(P[R.structureId]=R.structureName,P),{});b=Object.values(E),y=Object.keys(E),I=Object.keys(vN.instanceCount(h.map(({structureId:P})=>P))).length}else m&&h.sort((C,E)=>(C.roundOrder??0)-(E.roundOrder??0));const w=I&&h.length/I,S=Object.keys(c).map(C=>parseInt(C)),T=S.indexOf(l),D=T===0&&"first"||T===S.length-1&&"last";return h.forEach((C,E)=>{const P=w&&!(E%w),R=w&&Math.floor(E/w),M=w&&b[R];if(P){const O=document.createElement("div");O.className=mst({...R===0&&{variant:0},...D&&{roundOrder:D}}),v.appendChild(O);const x=document.createElement("div");if(x.className=Ast(),co(i?.groupHeaderClick)){const{drawId:F,containerStructureId:_}=h[0];v.onclick=V=>i.groupHeaderClick({structureId:y[R],containerStructureId:_,pointerEvent:V,drawId:F})}l===t&&(x.innerHTML=M),v.appendChild(x)}const N=E%2===0;o?C.roundFactor=o:t>1&&(C.roundFactor=Math.pow(2,l-t));const k=bN({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,searchActive:a,composition:s,isAdHoc:m,isLucky:f,matchUp:C,moiety:N});v.appendChild(k)}),g.appendChild(v),g}function QX({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,searchActive:r,composition:n,structureId:a,finalColumn:s,matchUps:o,minWidth:l,context:c}){const{roundNumbers:u,roundProfile:d,hasOddMatchUpsCount:p,isNotEliminationStructure:f}=Qs.getRoundMatchUps({matchUps:o});a=a||c?.structureId||o?.[0]?.structureId;const h=o.some(({isRoundRobin:v})=>v),m=p||f,A=document.createElement("div");A.className=hst(),A.classList.add("tmx-str"),A.setAttribute("id",a||"");const g=u.length?Math.max.apply(null,u):0;for(const v of u){if(v<t)continue;const b=Lst({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:v===g,isRoundRobin:h,searchActive:r,composition:n,roundNumber:v,roundProfile:d,matchUps:o,minWidth:l,context:c,isLucky:m});A.appendChild(b)}if(s&&typeof s!="boolean"){const v=document.createElement("div");v.className=eRe();const b=document.createElement("div");b.className=tRe(),b.appendChild(s),v.appendChild(b),A.appendChild(v)}return A}const hre=mr({backgroundColor:"$colors$backgroundColor",color:"$colors$color",overflowX:"auto",height:1e3});function jX({content:t,theme:e}){const i=document.createElement("div");return i.className=e?hb(hre(),e):hre(),e&&i.classList.add(e),typeof t=="string"?i.innerHTML=t:i.appendChild(t),i}const{createTheme:ES}=uIe({theme:{lineHeights:{scheduleInfo:`${b0.scheduleInfo}rem`,centerInfo:`${b0.centerInfo}rem`,gameScore:`${b0.gameScore}rem`},borderWidths:{matchUpInline:"1px 1px",matchUp:"1px"},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},colors:{internalDividers:"lightgray",backgroundColor:"white",connector:"lightgray",border:"darkgray",color:"black"},participant:{textTransform:"capitalize",minHeight:"2rem",seed:"gray"},score:{setWidth:"1.3rem"}}}),mre=ES("australian-theme",{colors:{borderHover:"#0091d2",connector:"#999"}}),$st=ES("wimbledon-theme",{borderWidths:{},colors:{connector:"transparent",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),Hst=ES("french-theme",{colors:{winnerName:"#01503d!important",winner:"#01503d!important",borderHover:"#0091d2",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),Vst=ES("usopen-theme",{colors:{matchUpBackgroundColor:"#F8F9F9",internalDividers:"darkgray",borderHover:"#0091d2",connector:"#999"}}),Are=ES("basic-theme",{colors:{internalDividers:"transparent",winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),Gst=ES("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),Qst=ES("itf-theme",{colors:{borderHover:"#0091d2",connector:"#999",matchUp:"#fff"},participant:{textTransform:"uppercase",seed:"gray"}}),wc={Australian:{configuration:{flags:!0},theme:mre},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:Are},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:Are},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:Hst},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:$st},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:Vst},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:Qst},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:mre},Night:{configuration:{flags:!0},theme:Gst}};function Sr(t,e,i){const r=document.createElement("div");r.style.cssText="display: flex; flex-direction: column; width: 100%;",r.classList.add("flexcol");const n={},a={};let s;for(const o of e){if((o.text||o.html)&&!o.field){const l=o.fieldPair&&document.createElement("div");l&&(l.className="flexrow");const c=document.createElement("div");c.className="flexaligncenter",c.style.cssText=o.style||o.header&&"font-weight: bold; font-size: larger;"||"height: 2.5em; padding-right: 1em;";const u=document.createElement("div");if(o.id&&(u.id=o.id),u.className="content",u.innerHTML=o.text,c.appendChild(u),l){l.appendChild(c);const{field:d,inputElement:p,datepicker:f}=d0(o.fieldPair);f&&(n[`${o.field}.date`]=f),p&&(n[o.fieldPair.field]=p,o.fieldPair.focus&&(s=p)),a[o.fieldPair.field]=d,l.appendChild(d),r.appendChild(l)}else r.appendChild(c);continue}if(o.divider){const l=document.createElement("hr");l.classList.add("dropdown-divider"),r.appendChild(l);continue}if(o.spacer){const l=document.createElement("div"),c=typeof o.spacer=="number"&&`${o.spacer}em`||typeof o.spacer=="string"&&o.spacer||"1em";l.style.marginBlockEnd=c,r.appendChild(l);continue}if(!(!o.label&&!o.field||o.hide)&&o.field){const l=o.fieldPair&&document.createElement("div");l&&(l.className="flexrow");const{field:c,inputElement:u,datepicker:d,subFields:p}=d0(o);if(p&&p.forEach(f=>n[f.field]=f.input),d&&(n[`${o.field}.date`]=d),o.focus&&(s=u),n[o.field]=u,a[o.field]=c,l){l.appendChild(c);const{field:f,inputElement:h,datepicker:m}=d0(o.fieldPair);m&&(n[`${o.field}.date`]=m),h&&(n[o.fieldPair.field]=h,o.fieldPair.focus&&(s=h)),a[o.fieldPair.field]=f,l.appendChild(f),r.appendChild(l)}else r.appendChild(c)}}if(s&&setTimeout(()=>s.focus(),200),t.appendChild(r),i?.length)for(const o of i){if(o.dateRange&&Array.isArray(o.fields)){const[l,c]=o.fields;if(n[l]&&n[c]){const u=new r6e(n[l],{inputs:[n[l],n[c]],minDate:o.minDate,maxDate:o.maxDate,format:"yyyy-mm-dd",autohide:!0});n[`${l}.date`]=u}}o.control&&(yc(o.onChange)&&n[o.control].addEventListener("change",l=>o.onChange({e:l,inputs:n,fields:a})),yc(o.onInput)&&n[o.control]&&n[o.control].addEventListener("input",l=>o.onInput({e:l,inputs:n,fields:a})),yc(o.onFocusOut)&&n[o.control]&&n[o.control].addEventListener("focusout",l=>o.onFocusOut({e:l,inputs:n,fields:a})))}return n}const{WTN:jst,UTR:zst}=yN.ratingConstants,{FEMALE:gre,MALE:vre,ANY:fB}=B2;function qst(t={}){const{callback:e,consideredDate:i,title:r="Generate mock players",labels:n={},defaults:a={}}=t;let s;const o={gender:n.gender||"Participant gender",count:n.count||"Participant count",ageRange:n.ageRange||"Participant Age Range",minAge:n.minAge||"Minimum Age",maxAge:n.maxAge||"Maximum Age",ratings:n.ratings||"Generate Ratings",wtn:n.wtn||"WTN",utr:n.utr||"UTR"},l={gender:a.gender||fB,participantsCount:a.participantsCount||32,ageMin:a.ageMin,ageMax:a.ageMax,wtnRating:a.wtnRating||!1,utrRating:a.utrRating||!1},c=[{label:"Cancel",intent:"none",close:!0},{label:"Generate",intent:"is-info",close:!0,onClick:()=>{const p=s.participantsCount.value,f=s.wtnRating.checked,h=s.utrRating.checked,m=s.gender.value,A=m===fB?void 0:m,g=s.ageMin?.value?Number.parseInt(s.ageMin.value):void 0,v=s.ageMax?.value?Number.parseInt(s.ageMax.value):void 0,b=[f&&{ratingType:jst,ratingMin:14,ratingMax:19.99},h&&{ratingType:zst,ratingMin:8,ratingMax:10}].filter(Boolean),y=g||v?{ageMin:g,ageMax:v}:void 0,{participants:I}=Ynt.generateParticipants({participantsCount:Number.parseInt(p),scaleAllParticipants:!0,consideredDate:i,categories:b,category:y,sex:A});e&&e(I)}}],u=[{control:"ageMin",onChange:({inputs:p})=>{const f=Number.parseInt(p.ageMin.value)||0,h=Number.parseInt(p.ageMax.value)||0;f>h&&h>0&&(p.ageMax.value=f)}},{control:"ageMax",onChange:({inputs:p})=>{const f=Number.parseInt(p.ageMin.value)||0,h=Number.parseInt(p.ageMax.value)||0;h<f&&f>0&&h>0&&(p.ageMin.value=h)}}],d=p=>s=Sr(p,[{options:[{label:"Any",value:fB,selected:l.gender===fB},{label:"Female",value:gre,selected:l.gender===gre},{label:"Male",value:vre,selected:l.gender===vre}],label:o.gender,field:"gender",value:l.gender},{options:[{label:"8",value:8,selected:l.participantsCount===8},{label:"16",value:16,selected:l.participantsCount===16},{label:"32",value:32,selected:l.participantsCount===32},{label:"64",value:64,selected:l.participantsCount===64},{label:"128",value:128,selected:l.participantsCount===128},{label:"256",value:256,selected:l.participantsCount===256}],label:o.count,field:"participantsCount",value:l.participantsCount},{text:o.ageRange,header:!0},{label:o.minAge,field:"ageMin",placeholder:"e.g., 10",type:"number",value:l.ageMin},{label:o.maxAge,field:"ageMax",placeholder:"e.g., 18",type:"number",value:l.ageMax},{text:o.ratings,header:!0},{label:o.wtn,field:"wtnRating",id:"wtnRating",checkbox:!0,value:l.wtnRating},{label:o.utr,field:"utrRating",id:"utrRating",checkbox:!0,value:l.utrRating}],u);pf.open({title:r,content:d,buttons:c})}const nRe="Timed set",aRe="Tiebreak",Wst="No-Ad",A3="Set",Kst="Ad";function yre(t=!1){return{descriptor:t?"Final set":"Best of",bestOf:t?void 0:3,advantage:Kst,what:A3,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10}}function Yst(t){return!!(t?.tiebreakSet?.tiebreakTo&&!t?.setTo)}function Xst(t,e){const{what:i,setTo:r,tiebreakAt:n,tiebreakTo:a,winBy:s,minutes:o,advantage:l,based:c}=t,u={setTo:r};return i===A3&&l===Wst&&(u.NoAD=!0),e&&i===A3&&(u.tiebreakAt=n,u.tiebreakFormat={tiebreakTo:a},s===1&&(u.tiebreakFormat.NoAD=!0)),i===nRe&&(u.minutes=o,u.timed=!0,c&&(u.based=c)),i===aRe&&(u.tiebreakSet={tiebreakTo:a},s===1&&(u.tiebreakSet.NoAD=!0)),u}function sRe(t){return t<=1?[]:[t-1,t]}function Zst(t,e){return sRe(t).includes(e)?e:t}function Jst(t,e){const i=e(t),r=yre(!1),n=yre(!0),a={setFormat:{...r,...i.setFormat},finalSetFormat:{...n,...i.finalSetFormat}};return i.setFormat?.based&&(a.setFormat.based=i.setFormat.based),i.finalSetFormat?.based&&(a.finalSetFormat.based=i.finalSetFormat.based),i.exactly?(a.setFormat.exactly=i.exactly,a.setFormat.descriptor="Exactly",delete a.setFormat.bestOf,a.setFormat.timed&&(a.setFormat.what=nRe)):(a.setFormat.bestOf=i.bestOf||3,a.setFormat.descriptor="Best of",delete a.setFormat.exactly),Yst(i.finalSetFormat)&&(a.finalSetFormat.what=aRe,a.finalSetFormat.tiebreakTo=i.finalSetFormat.tiebreakSet.tiebreakTo,a.finalSetFormat.winBy=i.finalSetFormat.tiebreakSet.NoAD?1:2),a}const oRe=[{key:"custom",name:"Custom",desc:""},{key:"standard",name:"Standard Advantage",format:"SET3-S:6/TB7",desc:"Best of 3 Sets to 6 with Advantage"},{key:"atpd",name:"Standard Doubles",format:"SET3-S:6/TB7-F:TB10",desc:"Best of 3 Sets to 6, no Ad",desc2:"Final Set Tiebreak to 10"},{key:"standard1",name:"One Standard Set",format:"SET1-S:6/TB7",desc:"1 Set to 6 Games, Tiebreak to 7"},{key:"wimbledon2018",name:"Wimbledon 2018",format:"SET5-S:6/TB7-F:6",desc:"Best of 5 tiebreak sets, final set no tiebreak"},{key:"wimbledon2019",name:"Wimbledon 2019",format:"SET5-S:6/TB7-F:6/TB7@12",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"Aus2019",name:"Australian Open 2019",format:"SET5-S:6/TB7-F:6/TB10",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"short",name:"Short Sets TB7@4",format:"SET3-S:4/TB7",desc:"Best of 3 Sets to 4, tiebreak to 7 at 4-4"},{key:"short1",name:"Fast 4",format:"SET3-S:4/TB5@3",desc:"Best of 3 Sets to 4, tiebreak to 5 at 3-3"},{key:"short2",name:"One Short Set TB7",format:"SET1-S:4/TB7",desc:"One Set to 4, tiebreak to 7 at 4-4"},{key:"short3",name:"One Short Set TB5",format:"SET1-S:4/TB5@3",desc:"One Set to 4, tiebreak to 5 at 3-3"},{key:"short4",name:"Short Sets w/ 3rd TB10",format:"SET3-S:4/TB7-F:TB10",desc:"Best of 3 Sets to 4 Games, tiebreak to 10",desc2:"3rd Set Tiebreak to 7"},{key:"short5",name:"Short Sets w/ 3rd TB7",format:"SET3-S:4/TB7-F:TB7",desc:"Best of 3 Sets to 4 Games, tiebreak to 7",desc2:"3rd Set Tiebreak to 7"},{key:"pro",name:"Pro Set",format:"SET1-S:8/TB7",desc:"One Set to 8 with Advantage, tiebreak at 8-8"},{key:"cps",name:"College Pro Set",format:"SET1-S:8/TB7@7"},{key:"tbsets1",name:"Best of 3 TB7",format:"SET3-S:TB7",desc:"Two tiebreak sets",desc2:"7-point match tiebreak at one set all"},{key:"tbsets2",name:"Best of 3 TB10",format:"SET3-S:TB10",desc:"Best of 3 tiebreaks to 10"},{key:"tbsets3",name:"One Tiebreak to 10",format:"SET1-S:TB10",desc:"One Match Tiebreak to 10 with Advantage"},{key:"tbsets4",name:"Two TB7 w/ 3rd TB10",format:"SET3-S:TB7-F:TB10",desc:"Two 7 point tiebreak sets",desc2:"10 point tiebreak at one set all"},{key:"timed10",name:"Timed 10 minute game - game based",format:"SET1-S:T10"},{key:"1pointslam",name:"1 Point Slam",format:"SET1-S:TB1NOAD"}],fs="none",bo="";function I0(t){return typeof t=="function"}const um={labels:{title:"Match format",setFormatLabel:"Set format",finalSetLabel:"Final set",tiebreakLabel:"Tiebreak",finalSetToggleLabel:"Final set",standardFormatsLabel:"Standard formats",descriptors:{bestOf:"Best of",exactly:"Exactly"},what:{sets:"Set",tiebreaks:"Tiebreak",timedSets:"Timed set"},advantage:{ad:"Ad",noAd:"No-Ad"}},options:{bestOf:[1,3,5],exactly:[1,2,3,4,5],setTo:[1,2,3,4,5,6,7,8,9],tiebreakTo:[5,7,9,10,12],tiebreakToExactly:[1,3],tiebreakAt:[3,4,5,6,7,8],minutes:[5,10,15,20,30],winBy:[1,2]}};let Pl=um,Gu,nr;const dm="Timed set",HU="Tiebreak",bre="No-Ad",Vd="Set",w0="Ad",Jt={setFormat:{descriptor:"Best of",bestOf:3,advantage:w0,what:Vd,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10},finalSetFormat:{descriptor:"Final set",advantage:w0,what:Vd,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10}};function Ire(t){const e=Jt[t?"finalSetFormat":"setFormat"],i=document.getElementById(t?"finalSetTiebreak":"setTiebreak")?.checked||!1;return Xst(e,i)}function lRe(){nr={setFormat:Ire()};const t=Jt.setFormat.descriptor,e=Jt.setFormat.exactly??Jt.setFormat.bestOf??3;t==="Exactly"?(nr.exactly=e,delete nr.bestOf):(nr.bestOf=e,delete nr.exactly),document.getElementById("finalSetOption")?.checked&&(nr.finalSetFormat=Ire(1));const i=A2.scoreGovernor.stringifyMatchUpFormat(nr),r=(Pl.preDefinedFormats?Pl.preDefinedFormats.map(a=>({value:a.code,label:a.text,format:a.code})):oRe).some(a=>a.format===i),n=document.getElementById("matchUpFormatSelector");if(n){const a=n.value,s=r?i:"Custom";if(a!==s){const o=n.onchange;n.onchange=null,n.value=s,n.onchange=o}}return i}function Yc(t){const e=t||lRe();Gu=e;const i=document.getElementById("matchUpFormatString");i&&(i.innerHTML=e)}const Iv=(t,e)=>e&&t.finalSetFormat||t.setFormat,Ov=[{getValue:t=>t.exactly?Pl.labels?.descriptors?.exactly||"Exactly":Pl.labels?.descriptors?.bestOf||"Best of",options:()=>[Pl.labels?.descriptors?.bestOf||"Best of",Pl.labels?.descriptors?.exactly||"Exactly"],id:"descriptor",value:Pl.labels?.descriptors?.bestOf||"Best of",finalSet:!1,onChange:"changeDescriptor"},{getValue:t=>t.bestOf||t.exactly,finalSet:!1,id:"bestOf",options:()=>{const t=Jt.setFormat.descriptor,e=Pl.labels?.descriptors?.exactly||"Exactly";return t===e?Pl.options?.exactly||um.options.exactly:Pl.options?.bestOf||um.options.bestOf},onChange:"pluralize",onChangeCallback:"updateFinalSetVisibility",value:3},{getValue:(t,e)=>{const i=Iv(t,e),r=i?.NoAD?bre:w0;return i?.timed||i?.tiebreakSet?void 0:r},options:[w0,bre],onChange:"changeAdvantage",defaultValue:w0,id:"advantage",whats:[Vd]},{getValue:(t,e)=>{const i=Iv(t,e);return i||console.log({pmf:t}),i?.timed?dm:i?.tiebreakSet?HU:Vd},options:[Vd,HU,dm],finalSetLabel:`${Vd}${bo}`,onChange:"changeWhat",onChangeCallback:"updateWhatValue",pluralize:!0,id:"what"},{getValue:(t,e)=>Iv(t,e).setTo,options:()=>Pl.options?.setTo||um.options.setTo,onChange:"changeCount",defaultValue:6,whats:[Vd],prefix:"to ",id:"setTo"},{getValue:(t,e)=>{const i=Iv(t,e);return i.tiebreakFormat?.tiebreakTo||i.tiebreakSet?.tiebreakTo},options:t=>{const e=Jt.setFormat.descriptor,i=Pl.options?.tiebreakTo||um.options.tiebreakTo,r=Pl.options?.tiebreakToExactly||um.options.tiebreakToExactly;return t&&e==="Exactly"?[...r,...i]:i},onChange:"changeTiebreakTo",whats:[Vd,HU],id:"tiebreakTo",defaultValue:7,prefix:"TB to ",tbSet:!0,value:7,tb:!0},{getValue:(t,e)=>Iv(t,e).tiebreakAt,options:t=>{const e=Jt[t?"finalSetFormat":"setFormat"].setTo;return sRe(e)},onChange:"changeTiebreakAt",id:"tiebreakAt",defaultValue:6,whats:[Vd],prefix:"@",value:6,tb:!0},{getValue:(t,e)=>{const i=Iv(t,e);return!i.tiebreakFormat&&!i.tiebreakSet?void 0:i.tiebreakFormat?.NoAD||i.tiebreakSet?.NoAD?1:2},whats:[Vd,HU],onChange:"changeWinBy",prefix:"Win by ",options:[1,2],defaultValue:2,tbSet:!0,id:"winBy",tb:!0},{getValue:(t,e)=>{const i=Iv(t,e);return i.timed&&i.minutes||void 0},options:[10,15,20,25,30,45,60,90],onChange:"changeMinutes",whats:[dm],suffix:" Minutes",defaultValue:10,id:"minutes",timed:!0},{getValue:(t,e)=>{const i=Iv(t,e);if(i?.timed)return i.based||"G"},options:["G","P","A"],onChange:"changeBased",whats:[dm],defaultValue:"G",id:"based",timed:!0}],qv={changeDescriptor:(t,e,i)=>{Jt.setFormat.descriptor=i;const r=Jt.setFormat.bestOf||Jt.setFormat.exactly||3;if(i==="Exactly"){if(Jt.setFormat.what!==dm){delete Jt.setFormat.setTo,delete Jt.setFormat.tiebreakAt,delete Jt.setFormat.tiebreakTo,delete Jt.setFormat.winBy,delete Jt.setFormat.tiebreakFormat,delete Jt.setFormat.NoAD,Jt.setFormat.what=dm,Jt.setFormat.minutes||(Jt.setFormat.minutes=10),qv.changeWhat(new Event("click"),void 0,dm);const a=document.getElementById("what");if(a){const l=r>1?"s":"";a.innerHTML=`${dm}${l}${bo}`}const s=document.getElementById("minutes");s&&(s.innerHTML=`${Jt.setFormat.minutes} Minutes${bo}`,s.style.display="");const o=document.getElementById("based");if(o){const l=Jt.setFormat.based||"G";o.innerHTML=`${l}${bo}`,o.style.display=""}}Jt.setFormat.exactly=r,delete Jt.setFormat.bestOf}else{const a=r%2===0?r+1:r;Jt.setFormat.bestOf=a,delete Jt.setFormat.exactly;const s=document.getElementById("bestOf");s&&(s.innerHTML=`${a}${bo}`),a!==r&&qv.pluralize(new Event("click"),void 0,a)}const n=document.getElementById("tiebreakTo-1");if(n&&n.style.display!==fs){const a=Jt.finalSetFormat.tiebreakTo||7,s=Ov.find(o=>o.id==="tiebreakTo");if(s){const{prefix:o="",suffix:l=""}=s,c=(I0(s.options)?s.options(1):s.options).includes(a)?a:7;c!==a&&(Jt.finalSetFormat.tiebreakTo=c),n.innerHTML=`${o}${c}${l}${bo}`}}Yc()},changeWhat:(t,e,i)=>{const r=i===Vd,n=e?"finalSetTiebreakToggle":"setTiebreakToggle",a=document.getElementById(n);if(a.style.display=r?"":fs,!e&&i!==dm&&Jt.setFormat.descriptor==="Exactly"){Jt.setFormat.descriptor="Best of";const s=Jt.setFormat.exactly||3,o=s%2===0?s+1:s;Jt.setFormat.bestOf=o,delete Jt.setFormat.exactly;const l=document.getElementById("descriptor");l&&(l.innerHTML=`Best of${bo}`);const c=document.getElementById("bestOf");c&&(c.innerHTML=`${o}${bo}`)}Ov.forEach(s=>{if(s.whats){const{prefix:o="",suffix:l="",pluralize:c}=s,u=s.whats.includes(i),d=e?`${s.id}-${e}`:s.id,p=document.getElementById(d);if(p.style.display===fs&&u){const f=nr.bestOf||nr.exactly,h=!e&&c&&f>1?"s":"",m=s.defaultValue;p.innerHTML=`${o}${m}${h}${l}${bo}`,Jt[e?"finalSetFormat":"setFormat"][s.id]=m}p.style.display=u?"":fs}}),Yc()},changeCount:(t,e,i)=>{const r=e?"finalSetFormat":"setFormat";Jt[r].setTo=i;const n=Jt[r].tiebreakAt,a=Zst(i,n);if(a!==n){Jt[r].tiebreakAt=a;const s=document.getElementById(e?`tiebreakAt-${e}`:"tiebreakAt");s&&(s.innerHTML=`@${a}${bo}`)}Yc()},changeTiebreakAt:(t,e,i)=>{Jt[e?"finalSetFormat":"setFormat"].tiebreakAt=i,Yc()},updateWhatValue:(t,e,i)=>{Jt[e?"finalSetFormat":"setFormat"].what=i},changeAdvantage:(t,e,i)=>{Jt[e?"finalSetFormat":"setFormat"].advantage=i,Yc()},changeTiebreakTo:(t,e,i)=>{Jt[e?"finalSetFormat":"setFormat"].tiebreakTo=i,Yc()},changeWinBy:(t,e,i)=>{Jt[e?"finalSetFormat":"setFormat"].winBy=i,Yc()},changeMinutes:(t,e,i)=>{Jt[e?"finalSetFormat":"setFormat"].minutes=i,Yc()},changeBased:(t,e,i)=>{const r=e?"finalSetFormat":"setFormat";Jt[r].based=i==="G"?void 0:i,Yc()},pluralize:(t,e,i)=>{const r=Jt[e?"finalSetFormat":"setFormat"].what,n=e?`what-${e}`:"what",a=document.getElementById(n),s=i>1?"s":"";a.innerHTML=`${r}${s}${bo}`,e||(Jt.setFormat.descriptor==="Exactly"?(Jt.setFormat.exactly=i,delete Jt.setFormat.bestOf):(Jt.setFormat.bestOf=i,delete Jt.setFormat.exactly)),Yc()},updateFinalSetVisibility:(t,e,i)=>{const r=i>1,n=document.getElementById("finalSetOption"),a=document.querySelector('label[for="finalSetOption"]');n&&a&&(r?(n.style.display="",a.style.display=""):(n.checked&&(n.checked=!1,n.dispatchEvent(new Event("change"))),n.style.display="none",a.style.display="none"))}};function IH({existingMatchUpFormat:t="SET3-S:6/TB7",callback:e,config:i,modalConfig:r}={}){i?Pl={labels:{...um.labels,...i.labels},options:{...um.options,...i.options},preDefinedFormats:i.preDefinedFormats||um.preDefinedFormats}:Pl=um,Gu=t,nr=au.parse(Gu),nr||(console.warn("Invalid matchUpFormat:",Gu),Gu="SET3-S:6/TB7",nr=au.parse(Gu));const n=Jst(Gu,au.parse);Jt.setFormat={...n.setFormat},Jt.finalSetFormat={...n.finalSetFormat};const a=()=>{const M=document.getElementById("matchUpFormatSelector"),N=M?.value&&M.value!=="Custom"?Gu:lRe();I0(e)&&e(N)},s=[{onClick:()=>{VU(),e?.("")},label:"Cancel",intent:"none",footer:{className:"button",style:"background-color: white; color: #363636; border: 1px solid #dbdbdb;"},close:!0},{label:"Select",intent:"is-info",close:!0,onClick:()=>{VU(),a()}}],o="switch is-rounded is-danger",l=document.createElement("div");l.addEventListener("click",M=>{const N=M.target;!N.closest(".dropdown")&&!N.classList.contains("mfcButton")&&VU()});const c=document.createElement("div");c.id="matchUpFormatString",c.innerHTML=Gu,c.style.fontSize="1.5em",c.style.color="blue",c.style.marginBottom="1em",l.appendChild(c);const u=document.createElement("div");u.style.marginBlockEnd="1em";const d=Pl.preDefinedFormats?Pl.preDefinedFormats.map(M=>({value:M.code,label:M.text,format:M.code})):oRe,p={options:[{value:"Custom",label:"Custom",selected:!1},...d.filter(M=>M.format).map(M=>({selected:M.format===Gu,value:M.format,label:("label"in M?M.label:M.name)||""}))]},f=document.createElement("select");f.id="matchUpFormatSelector",f.className="input",f.style.width="100%",f.style.backgroundColor="#ffffff",f.style.color="#363636",f.style.border="1px solid #b5b5b5";for(const M of p.options){const N=document.createElement("option");N.value=M.value||"",N.text=M.label||"",N.style.backgroundColor="#ffffff",N.style.color="#363636",M.selected&&(N.selected=!0),f.appendChild(N)}f.onchange=M=>{if(Gu=M.target.value,Yc(Gu),nr=au.parse(Gu),!nr){console.warn("Invalid matchUpFormat selected:",Gu);return}Jt.setFormat={...nr.setFormat},nr.exactly?(Jt.setFormat.exactly=nr.exactly,Jt.setFormat.descriptor="Exactly",delete Jt.setFormat.bestOf,Jt.setFormat.timed&&(Jt.setFormat.what=dm)):(Jt.setFormat.bestOf=nr.bestOf,Jt.setFormat.descriptor="Best of",delete Jt.setFormat.exactly),nr.finalSetFormat&&(Jt.finalSetFormat=nr.finalSetFormat);const N=nr.bestOf||nr.exactly;qv.updateFinalSetVisibility(null,0,N);const k=nr.finalSetFormat;I.style.display=k?"":fs,w.style.display=k?"":fs,b.checked=k;const O=k?.tiebreakSet?.tiebreakTo&&!k?.setTo;T.checked=!!k?.tiebreakFormat,T.style.display=O?fs:"";const x=document.getElementById("finalSetTiebreakToggle");x&&(x.style.display=O?fs:""),A.checked=nr.setFormat.tiebreakFormat,Ov.forEach(F=>{if(F.getValue){const _=F.getValue(nr),V=document.getElementById(F.id);if(V&&_){const{prefix:G="",suffix:z="",pluralize:Q}=F,j=nr.bestOf||nr.exactly,W=Q&&j>1?"s":"";V.innerHTML=`${G}${_}${W}${z}${bo}`,V.style.display=""}else V&&(V.style.display=fs);if(k){const G=F.getValue(nr,!0),z=document.getElementById(`${F.id}-1`);if(z&&G){const{prefix:Q="",suffix:j="",pluralize:W}=F,Y=nr.bestOf||nr.exactly,X=W&&Y>1?"s":"";z.innerHTML=`${Q}${G}${X}${j}${bo}`,z.style.display=""}else z&&(z.style.display=fs)}}})},u.appendChild(f),l.appendChild(u);const h=document.createElement("div");h.style.display="flex",h.style.flexWrap="wrap",h.style.gap="0.5em",h.style.marginBottom="1em",Ov.map(M=>{const N=M.getValue?M.getValue(nr):void 0;return wre({...M,value:N})}).forEach(M=>h.appendChild(M)),h.id="setFormat",l.appendChild(h);const m=document.createElement("div");m.className="field",m.style.fontSize="1em";const A=document.createElement("input");A.className=o,A.name="setTiebreak",A.id="setTiebreak",A.type="checkbox",A.checked=!!nr.setFormat.tiebreakFormat,A.onchange=M=>{const N=M.target.checked;Ov.filter(({tb:k})=>k).forEach(k=>{const O=document.getElementById(k.id);if(O){if(O.style.display===fs&&N){const{prefix:x="",suffix:F="",pluralize:_,defaultValue:V}=k,G=nr.bestOf||nr.exactly,z=_&&G>1?"s":"";O.innerHTML=`${x}${V}${z}${F}${bo}`}O.style.display=N?"":fs}}),Yc()},m.appendChild(A);const g=document.createElement("label");g.setAttribute("for","setTiebreak"),g.id="setTiebreakToggle",g.innerHTML="Tiebreak",g.style.marginRight="1em",m.appendChild(g);const v=(nr.bestOf||nr.exactly)>1,b=document.createElement("input");b.className="switch is-rounded is-info",b.type="checkbox",b.name="finalSetOption",b.checked=!!nr.finalSetFormat,b.id="finalSetOption",b.style.display=v?"":"none",b.onchange=M=>{const N=M.target.checked;if(N){Jt.finalSetFormat={...Jt.setFormat,descriptor:"Final set"};const k=Jt.setFormat.what,O=Jt.setFormat.bestOf||Jt.setFormat.exactly||3,x=document.getElementById("what-1");if(x){const _=O>1?"s":"";x.innerHTML=`${k}${_}${bo}`}Ov.forEach(_=>{const V=document.getElementById(`${_.id}-1`);if(V)if(!_.whats||_.whats.includes(k)){const G=Jt.finalSetFormat[_.id];if(G!==void 0){const{prefix:z="",suffix:Q=""}=_;V.innerHTML=`${z}${G}${Q}${bo}`}V.style.display=""}else V.style.display=fs});const F=document.getElementById("finalSetTiebreakToggle");if(F&&(F.style.display=k===Vd?"":fs),k===Vd){const _=document.getElementById("setTiebreak"),V=document.getElementById("finalSetTiebreak");_&&V&&(V.checked=_.checked)}}I.style.display=N?"":fs,w.style.display=N?"":fs,Yc()},m.appendChild(b);const y=document.createElement("label");y.setAttribute("for","finalSetOption"),y.innerHTML="Final set",y.style.display=v?"":"none",m.appendChild(y),l.appendChild(m);const I=document.createElement("div");I.style.display=nr.finalSetFormat?"flex":fs,I.style.flexWrap="wrap",I.style.gap="0.5em",I.style.marginBottom="1em",I.id="finalSetFormat",[{label:"<div style='font-weight: bold'>Final set</div>",options:[],finalSet:!0}].concat(Ov.map(M=>{const N=M.getValue?M.getValue(nr,!0):void 0;return{...M,value:N}})).filter(M=>M.finalSet!==!1).map(M=>wre({...M,index:1})).forEach(M=>I.appendChild(M)),l.appendChild(I);const w=document.createElement("div");w.id="finalSetConfig",w.style.display=nr.finalSetFormat?"":fs,w.className="field",w.style.fontSize="1em";const S=nr.finalSetFormat?.tiebreakSet?.tiebreakTo&&!nr.finalSetFormat?.setTo,T=document.createElement("input");T.className=o,T.name="finalSetTiebreak",T.id="finalSetTiebreak",T.type="checkbox",T.checked=nr.finalSetFormat?!!nr.finalSetFormat.tiebreakFormat:!!nr.setFormat.tiebreakFormat,T.style.display=S?fs:"",w.onchange=M=>{const N=M.target.checked;Ov.filter(({tb:k})=>k).forEach(k=>{const O=document.getElementById(`${k.id}-1`);if(O.style.display===fs&&N){const{prefix:x="",suffix:F="",pluralize:_,defaultValue:V}=k,G=nr.bestOf||nr.exactly,z=_&&G>1?"s":"";O.innerHTML=`${x}${V}${z}${F}${bo}`}O.style.display=N?"":fs}),Yc()},w.appendChild(T);const D=document.createElement("label");D.setAttribute("for","finalSetTiebreak"),D.id="finalSetTiebreakToggle",D.innerHTML="Tiebreak",D.style.marginRight="1em",D.style.display=S?fs:"",w.appendChild(D),l.appendChild(w);const C={content:{padding:"1.5"},maxWidth:480,fontSize:"14px",style:{backgroundColor:"#f8f9fa",borderRadius:"8px",boxShadow:"0 8px 16px rgba(0, 102, 204, 0.2)"}},E=r?.fontSize||r?.style?.fontSize||C.fontSize,P={...C,...r,fontSize:E,style:{...C.style,...i?.style||{},...r?.style||{}}},R=pf.open({title:"Score format",content:l,buttons:s,config:P});return setTimeout(()=>{if(nr.finalSetFormat?.tiebreakSet?.tiebreakTo&&!nr.finalSetFormat?.setTo){const N=document.getElementById("what-1");N&&(N.innerHTML=`${HU}${bo}`),qv.changeWhat(new Event("click"),1,HU)}const M=document.querySelector(".modal.is-active");if(M){const N=new MutationObserver(k=>{k.forEach(O=>{O.removedNodes.forEach(x=>{x===M&&(VU(),N.disconnect())})})});N.observe(document.body,{childList:!0})}},0),R}function eot({index:t,finalSetLabel:e,label:i,prefix:r="",suffix:n="",value:a,pluralize:s}){const o=Jt.setFormat.bestOf||Jt.setFormat.exactly||1,l=!t&&s&&o>1?"s":"";return i||t&&e||`${r}${a}${l}${n}${bo}`}function wre(t){const{id:e,initiallyHidden:i,index:r,value:n}=t,a=document.createElement("button");return a.className="mfcButton",a.id=r?`${e}-${r}`:e,a.innerHTML=eot(t),a.onclick=s=>tot({e:s,button:a,...t}),a.style.display=n||t.label?"":fs,i&&(a.style.display=fs),a.style.transition="all .2s ease-in-out",a.style.backgroundColor="inherit",a.style.border="none",a.style.color="inherit",a.style.padding=".3em",a.style.textAlign="center",a.style.textDecoration="none",a.style.fontSize="1em",a.style.cursor="pointer",a}function tot(t){const{e,id:i,button:r,pluralize:n,options:a,onChange:s,onChangeCallback:o,index:l,prefix:c="",suffix:u=""}=t,d=Jt.setFormat.bestOf||Jt.setFormat.exactly||1,p=!l&&n&&d>1?"s":"",f=(I0(a)?a(l):a).map(h=>({text:`${h}${p}`,onClick:()=>{r.innerHTML=`${c}${h}${p}${u}${bo}`,s&&I0(qv[s])&&qv[s](e,l,h),o&&I0(qv[o])&&qv[o](e,l,h),Jt[l?"finalSetFormat":"setFormat"][i]=h,Yc()}}));iot(e,f)}let ND=null,S0=null;function VU(){ND&&document.body.contains(ND)&&ND.remove(),S0&&(document.removeEventListener("click",S0),S0=null),ND=null}function iot(t,e){VU();const i=document.createElement("div");i.className="dropdown is-active",i.style.position="absolute",i.style.zIndex="10000";const r=document.createElement("div");r.className="dropdown-menu",r.style.backgroundColor="white",r.style.border="1px solid #ddd",r.style.borderRadius="4px",r.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)";const n=()=>{VU()};e.forEach(s=>{const o=document.createElement("div");o.style.padding="0.5em 1em",o.style.cursor="pointer",o.style.backgroundColor="white",o.style.color="#363636",o.style.fontSize="1rem",o.style.lineHeight="1.5",o.textContent=s.text,o.onclick=l=>{l.preventDefault(),l.stopPropagation(),n(),setTimeout(()=>{s.onClick()},0)},o.onmouseenter=()=>{o.style.backgroundColor="#f5f5f5",o.style.color="#363636"},o.onmouseleave=()=>{o.style.backgroundColor="white",o.style.color="#363636"},r.appendChild(o)}),i.appendChild(r);const a=t.target.getBoundingClientRect();i.style.left=`${a.left}px`,i.style.top=`${a.bottom}px`,document.body.appendChild(i),ND=i,setTimeout(()=>{S0=s=>{i.contains(s.target)||n()},document.addEventListener("click",S0)},100)}const zX=Object.freeze(Object.defineProperty({__proto__:null,getMatchUpFormatModal:IH},Symbol.toStringTag,{value:"Module"}));function Sre(t){if(!t)return null;const e=t.trim().toUpperCase();if(e==="OPEN")return{type:"open"};const i=e.match(/^C(\d{1,2})-(\d{1,2})$/);if(i){const[,a,s]=i;return{type:"combined",ageMin:parseInt(a,10),ageMax:parseInt(s,10),isCombined:!0}}if(e.includes("-")){const a=e.split("-");if(a.length===2){const s=a[0],o=a[1];let l,c,u,d,p;const f=s.match(/^U?(\d{1,2})U?$/),h=s.match(/^O?(\d{1,2})O?$/),m=o.match(/^U?(\d{1,2})U?$/),A=o.match(/^O?(\d{1,2})O?$/);if(s.startsWith("U")||s.endsWith("U")?p="max-min":(s.startsWith("O")||s.endsWith("O"))&&(p="min-max"),s.startsWith("U")||s.endsWith("U")){if(f){const g=parseInt(f[1],10);c=s.startsWith("U")?g-1:g,u=s.startsWith("U")?"pre":"post"}}else if((s.startsWith("O")||s.endsWith("O"))&&h){const g=parseInt(h[1],10);l=s.startsWith("O")?g+1:g,d=s.startsWith("O")?"pre":"post"}if(o.startsWith("U")||o.endsWith("U")){if(m){const g=parseInt(m[1],10);c=o.startsWith("U")?g-1:g,u=o.startsWith("U")?"pre":"post"}}else if((o.startsWith("O")||o.endsWith("O"))&&A){const g=parseInt(A[1],10);l=o.startsWith("O")?g+1:g,d=o.startsWith("O")?"pre":"post"}if(l!==void 0||c!==void 0)return{type:"range",ageMin:l,ageMax:c,uPosition:u,oPosition:d,rangeOrder:p}}}const r=e.match(/^U(\d{1,2})$|^(\d{1,2})U$/);if(r){const a=parseInt(r[1]||r[2],10),s=r[1]?"pre":"post";return{type:"under",ageValue:a,uPosition:s}}const n=e.match(/^O(\d{1,2})$|^(\d{1,2})O$/);if(n){const a=parseInt(n[1]||n[2],10),s=n[1]?"pre":"post";return{type:"over",ageValue:a,oPosition:s}}return null}function qX(t){const{type:e,ageValue:i,ageMin:r,ageMax:n,uPosition:a="post",oPosition:s="post",rangeOrder:o="min-max"}=t;if(e==="open")return"OPEN";if(e==="combined"&&r!==void 0&&n!==void 0)return`C${r}-${n}`;if(e==="under"&&i!==void 0)return a==="pre"?`U${i}`:`${i}U`;if(e==="over"&&i!==void 0)return s==="pre"?`O${i}`:`${i}O`;if(e==="range"&&(r!==void 0||n!==void 0)){const l=n!==void 0&&a?(()=>{const u=a==="pre"?n+1:n;return a==="pre"?`U${u}`:`${u}U`})():null,c=r!==void 0&&s?(()=>{const u=s==="pre"?r-1:r;return s==="pre"?`O${u}`:`${u}O`})():null;return o==="max-min"?[l,c].filter(Boolean).join("-"):[c,l].filter(Boolean).join("-")}return""}function rot(){return[8,10,12,14,16,18,21,30,35,40,45,50,55,60,65,70,75,80,85,90]}function cRe(){return["Simple Under","Simple Over","Range","Combined","Open"]}function not(t){switch(t){case"Simple Under":return"under";case"Simple Over":return"over";case"Range":return"range";case"Combined":return"combined";case"Open":return"open";default:return"open"}}function Ure(t){switch(t){case"under":return"Simple Under";case"over":return"Simple Over";case"range":return"Range";case"combined":return"Combined";case"open":return"Open";default:return"Open"}}function Tre(){return[{code:"OPEN",text:"Open (No age limit)"},{code:"8U",text:"8 and Under"},{code:"10U",text:"10 and Under"},{code:"12U",text:"12 and Under"},{code:"14U",text:"14 and Under"},{code:"16U",text:"16 and Under"},{code:"18U",text:"18 and Under"},{code:"21U",text:"21 and Under"},{code:"30O",text:"30 and Over"},{code:"35O",text:"35 and Over"},{code:"40O",text:"40 and Over"},{code:"45O",text:"45 and Over"},{code:"50O",text:"50 and Over"},{code:"55O",text:"55 and Over"},{code:"60O",text:"60 and Over"},{code:"65O",text:"65 and Over"},{code:"70O",text:"70 and Over"},{code:"75O",text:"75 and Over"},{code:"80O",text:"80 and Over"}]}const dG="";function aot(t){return typeof t=="function"}const BD={labels:{title:"Age Category",consideredDateLabel:"Considered Date",typeLabel:"Category Type",ageLabel:"Age",standardCodesLabel:"Standard Categories"},options:{ages:rot(),categoryTypes:cRe()},defaultConsideredDate:new Date().toISOString().split("T")[0]};let $A=BD,iI,ix;const hi={type:"open"};let kD={};function sot(){const t=qX(hi);if(!t||t==="OPEN"){kD={};return}try{const e=J$.getCategoryAgeDetails({category:{ageCategoryCode:t},consideredDate:ix});if(e.error){kD={errors:[typeof e.error=="string"?e.error:e.error.message||"Invalid category or date"]};return}kD={ageMin:e.ageMin,ageMax:e.ageMax,ageMinDate:e.ageMinDate,ageMaxDate:e.ageMaxDate,errors:e.errors}}catch(e){kD={errors:[`Failed to calculate age details: ${e instanceof Error?e.message:"Unknown error"}`]}}}function wv(){const t=qX(hi);iI=t;const e=document.getElementById("ageCategoryCodeString");e&&(e.innerHTML=t||"Invalid"),sot(),oot()}function oot(){const t=document.getElementById("calculatedDetailsPanel");if(!t)return;if(hi.type==="open"||!iI){t.style.display="none";return}t.style.display="";const{ageMin:e,ageMax:i,ageMinDate:r,ageMaxDate:n,errors:a}=kD;let s='<div style="margin-top: 1em; padding: 0.75em; background: #f5f5f5; border-radius: 4px; color: #000;">';a&&a.length>0&&(s+='<div style="color: red; margin-bottom: 0.5em;"><strong style="color: #000;">Errors:</strong><ul style="margin: 0; padding-left: 1.5em; color: #000;">',a.forEach(o=>{s+=`<li style="color: red;">${o}</li>`}),s+="</ul></div>"),(e!==void 0||i!==void 0)&&(s+='<div style="margin-bottom: 0.5em; color: #000;"><strong style="color: #000;">Age Range:</strong> ',e!==void 0&&i!==void 0?s+=`${e} - ${i}`:e!==void 0?s+=`${e} and over`:i!==void 0&&(s+=`${i} and under`),s+="</div>"),r&&(s+=`<div style="margin-bottom: 0.5em; color: #000;"><strong style="color: #000;">Min Birth Date:</strong> ${r}</div>`),n&&(s+=`<div style="margin-bottom: 0.5em; color: #000;"><strong style="color: #000;">Max Birth Date:</strong> ${n}</div>`),s+="</div>",t.innerHTML=s}function pG(){const{type:t}=hi,e=document.getElementById("ageValue"),i=t==="under"||t==="over";e&&(e.style.display=i?"":"none");const r=document.getElementById("positionToggle"),n=t==="under"||t==="over";r&&(r.style.display=n?"":"none");const a=document.getElementById("ageMin"),s=t==="range"||t==="combined";a&&(a.style.display=s?"":"none");const o=document.getElementById("ageMax"),l=t==="range"||t==="combined";o&&(o.style.display=l?"":"none");const c=document.getElementById("combinedLabel");c&&(c.style.display=t==="combined"?"":"none")}function Cre(t){const{id:e,label:i,onClick:r,initiallyHidden:n}=t,a=document.createElement("button");return a.className="accButton",a.id=e,a.innerHTML=i,r&&(a.onclick=r),n&&(a.style.display="none"),a.style.transition="all .2s ease-in-out",a.style.backgroundColor="inherit",a.style.border="none",a.style.color="#000",a.style.padding=".3em",a.style.textAlign="center",a.style.textDecoration="none",a.style.fontSize="1em",a.style.cursor="pointer",a}let xD=null,U0=null;function GU(){xD&&document.body.contains(xD)&&xD.remove(),U0&&(document.removeEventListener("click",U0),U0=null),xD=null}function lot(t,e){GU();const i=document.createElement("div");i.className="dropdown is-active",i.style.position="absolute",i.style.zIndex="10000";const r=document.createElement("div");r.className="dropdown-menu",r.style.backgroundColor="white",r.style.border="1px solid #ddd",r.style.borderRadius="4px",r.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)";const n=()=>{GU()};e.forEach(s=>{const o=document.createElement("div");o.style.padding="0.5em 1em",o.style.cursor="pointer",o.style.backgroundColor="white",o.style.color="#363636",o.style.fontSize="1rem",o.style.lineHeight="1.5",o.textContent=s.text,o.onclick=l=>{l.preventDefault(),l.stopPropagation(),n(),setTimeout(()=>{s.onClick()},0)},o.onmouseenter=()=>{o.style.backgroundColor="#f5f5f5"},o.onmouseleave=()=>{o.style.backgroundColor="white"},r.appendChild(o)}),i.appendChild(r);const a=t.target.getBoundingClientRect();i.style.left=`${a.left}px`,i.style.top=`${a.bottom}px`,document.body.appendChild(i),xD=i,setTimeout(()=>{U0=s=>{i.contains(s.target)||n()},document.addEventListener("click",U0)},100)}function cot({existingAgeCategoryCode:t,existingCategory:e={},editorConfig:i,consideredDate:r,callback:n,config:a,modalConfig:s}={}){const o=i||a;o?$A={labels:{...BD.labels,...o.labels},options:{...BD.options,...o.options},preDefinedCodes:o.preDefinedCodes||Tre(),defaultConsideredDate:o.defaultConsideredDate||BD.defaultConsideredDate}:$A={...BD,preDefinedCodes:Tre()},ix=r||$A.defaultConsideredDate||new Date().toISOString().split("T")[0];const l=t||e.ageCategoryCode||"OPEN";iI=l;const c=Sre(l);c?Object.assign(hi,c):Object.assign(hi,{type:"open"});const u=()=>{const x=qX(hi);aot(n)&&n({...e,ageCategoryCode:x})},d=[{onClick:()=>{GU(),n?.({...e,ageCategoryCode:""})},label:"Cancel",intent:"none",footer:{className:"button",style:"background-color: white; color: #363636; border: 1px solid #dbdbdb;"},close:!0},{label:"Select",intent:"is-info",close:!0,onClick:()=>{GU(),u()}}],p=document.createElement("div");p.addEventListener("click",x=>{const F=x.target;!F.closest(".dropdown")&&!F.classList.contains("accButton")&&GU()});const f=document.createElement("div");f.id="ageCategoryCodeString",f.innerHTML=iI,f.style.fontSize="1.5em",f.style.color="blue",f.style.marginBottom="1em",f.style.fontWeight="bold",p.appendChild(f);const h=document.createElement("div");h.style.marginBottom="1em",Sr(h,[{label:$A.labels?.standardCodesLabel||"Standard Categories",field:"standardCategory",id:"ageCategorySelector",options:[{label:"Custom",value:"Custom",selected:!$A.preDefinedCodes?.some(x=>x.code===iI)},...($A.preDefinedCodes||[]).map(x=>({selected:x.code===iI,value:x.code,label:x.text}))],onChange:x=>{const F=x.target.value;if(F==="Custom")return;iI=F;const _=Sre(F);_&&(Object.assign(hi,_),pG(),R(),wv())}},{label:$A.labels?.consideredDateLabel||"Considered Date",field:"consideredDate",id:"consideredDateInput",value:ix,date:!0,onChange:x=>{ix=x.target.value,wv()}}]),p.appendChild(h);const m=Cre({id:"categoryType",label:`${Ure(hi.type)}${dG}`,onClick:x=>{const F=($A.options?.categoryTypes||cRe()).map(_=>({text:_,onClick:()=>{const V=not(_);hi.type=V,hi.ageValue=void 0,hi.ageMin=void 0,hi.ageMax=void 0,V==="under"||V==="over"?(hi.ageValue=18,hi.uPosition="post",hi.oPosition="post"):(V==="range"||V==="combined")&&(hi.ageMin=10,hi.ageMax=18,hi.uPosition="post",hi.oPosition="post",hi.rangeOrder="min-max"),V==="combined"?hi.isCombined=!0:hi.isCombined=!1,m.innerHTML=`${_}${dG}`,pG(),R(),wv()}}));lot(x,F)}}),A=document.createElement("div");A.style.display="flex",A.style.flexWrap="wrap",A.style.gap="0.5em",A.style.marginBottom="1em",A.appendChild(m);const g=document.createElement("div");g.id="ageValue",g.style.display=hi.type!=="under"&&hi.type!=="over"?"none":"";const v=document.createElement("input");v.type="number",v.min="1",v.max="120",v.value=String(hi.ageValue||18),v.style.width="80px",v.style.padding="0.3em",v.style.border="1px solid #ddd",v.style.borderRadius="4px",v.oninput=()=>{const x=Number.parseInt(v.value,10);!Number.isNaN(x)&&x>=1&&x<=120&&(hi.ageValue=x,wv())},g.appendChild(v),A.appendChild(g);const b=Cre({id:"positionToggle",label:P(),onClick:()=>{hi.type==="under"?hi.uPosition=hi.uPosition==="pre"?"post":"pre":hi.type==="over"&&(hi.oPosition=hi.oPosition==="pre"?"post":"pre"),b.innerHTML=P(),wv()},initiallyHidden:hi.type!=="under"&&hi.type!=="over"});A.appendChild(b);const y=document.createElement("div");y.id="ageMin",y.style.display=hi.type!=="range"&&hi.type!=="combined"?"none":"",y.style.display="flex",y.style.alignItems="center",y.style.gap="0.5em";const I=document.createElement("span");I.textContent="Min:",I.style.color="#000";const w=document.createElement("input");w.type="number",w.min="1",w.max="120",w.value=String(hi.ageMin||10),w.style.width="80px",w.style.padding="0.3em",w.style.border="1px solid #ddd",w.style.borderRadius="4px",w.oninput=()=>{const x=Number.parseInt(w.value,10);!Number.isNaN(x)&&x>=1&&x<=120&&(hi.ageMin=x,hi.ageMax!==void 0&&hi.ageMax<x&&(hi.ageMax=x,D.value=String(x)),wv())},y.appendChild(I),y.appendChild(w),A.appendChild(y),hi.type!=="range"&&hi.type!=="combined"&&(y.style.display="none");const S=document.createElement("div");S.id="ageMax",S.style.display=hi.type!=="range"&&hi.type!=="combined"?"none":"",S.style.display="flex",S.style.alignItems="center",S.style.gap="0.5em";const T=document.createElement("span");T.textContent="Max:",T.style.color="#000";const D=document.createElement("input");D.type="number",D.min="1",D.max="120",D.value=String(hi.ageMax||18),D.style.width="80px",D.style.padding="0.3em",D.style.border="1px solid #ddd",D.style.borderRadius="4px",D.oninput=()=>{const x=Number.parseInt(D.value,10);!Number.isNaN(x)&&x>=1&&x<=120&&(hi.ageMax=x,hi.ageMin!==void 0&&hi.ageMin>x&&(hi.ageMin=x,w.value=String(x)),wv())},S.appendChild(T),S.appendChild(D),A.appendChild(S),hi.type!=="range"&&hi.type!=="combined"&&(S.style.display="none");const C=document.createElement("div");C.id="combinedLabel",C.innerHTML='<em style="color: #888;">Combined age range</em>',C.style.display=hi.type==="combined"?"":"none",C.style.padding="0.3em",A.appendChild(C),p.appendChild(A);const E=document.createElement("div");E.id="calculatedDetailsPanel",p.appendChild(E);function P(){if(hi.type==="under"){const x=hi.ageValue||18;return hi.uPosition==="pre"?`U${x}`:`${x}U`}else if(hi.type==="over"){const x=hi.ageValue||10;return hi.oPosition==="pre"?`O${x}`:`${x}O`}return""}function R(){const x=document.getElementById("categoryType");x&&(x.innerHTML=`${Ure(hi.type)}${dG}`),hi.ageValue!==void 0&&(v.value=String(hi.ageValue));const F=document.getElementById("positionToggle");F&&(F.innerHTML=P()),hi.ageMin!==void 0&&(w.value=String(hi.ageMin)),hi.ageMax!==void 0&&(D.value=String(hi.ageMax))}const M={content:{padding:"1.5"},maxWidth:480,fontSize:"14px",style:{backgroundColor:"#f8f9fa",borderRadius:"8px",boxShadow:"0 8px 16px rgba(0, 102, 204, 0.2)"}},N=s?.fontSize||s?.style?.fontSize||M.fontSize,k={...M,...s,fontSize:N,style:{...M.style,...a?.style||{},...s?.style}},O=pf.open({title:$A.labels?.title||"Age Category",content:p,buttons:d,config:k});return setTimeout(()=>{pG(),R(),wv()},0),setTimeout(()=>{const x=document.querySelector(".modal.is-active");if(x){const F=new MutationObserver(_=>{_.forEach(V=>{V.removedNodes.forEach(G=>{G===x&&(GU(),F.disconnect())})})});F.observe(document.body,{childList:!0})}},0),O}const fG={labels:{title:"Category",categoryNameLabel:"Category Name",typeLabel:"Category Type",ageCategoryCodeLabel:"Age Category Code",ratingTypeLabel:"Rating Type",ratingMinLabel:"Minimum Rating",ratingMaxLabel:"Maximum Rating",ballTypeLabel:"Ball Type",notesLabel:"Notes"},options:{types:["AGE","RATING","BOTH"],ratingTypes:["WTN","UTR","TRN","NTRP","DUPR"],ballTypes:["HIGH_ALTITUDE","STAGE1GREEN","STAGE2ORANGE","STAGE3RED","T2STANDARD_PRESSURELESS","T2STANDARD_PRESSURISED","TYPE1FAST","TYPE3SLOW"]},defaultConsideredDate:new Date().toISOString().split("T")[0]};function uot(t){return typeof t=="function"}function dot(t){const{existingCategory:e,editorConfig:i,callback:r}=t,n={labels:{...fG.labels,...i?.labels},options:{...fG.options,...i?.options},defaultConsideredDate:i?.defaultConsideredDate||fG.defaultConsideredDate,modalConfig:i?.modalConfig||{}},a={categoryName:e?.categoryName||"",type:e?.type,ageCategoryCode:e?.ageCategoryCode,ratingType:e?.ratingType,ratingMin:e?.ratingMin,ratingMax:e?.ratingMax,ballType:e?.ballType,notes:e?.notes||"",ageMin:e?.ageMin,ageMax:e?.ageMax,ageMinDate:e?.ageMinDate,ageMaxDate:e?.ageMaxDate},s=n.defaultConsideredDate,o=document.createElement("div");o.style.display="flex",o.style.flexDirection="column",o.style.gap="1em",o.style.minWidth="400px";const l=()=>{const C=o.querySelector("#ageDetailsPanel");if(C){if(!a.ageCategoryCode||a.ageCategoryCode==="OPEN"){C.style.display="none";return}try{const E=J$.getCategoryAgeDetails({category:{ageCategoryCode:a.ageCategoryCode},consideredDate:s});if(E.error){C.style.display="block",C.innerHTML=`
          <div style="padding: 0.75em; background-color: #ffe8e8; border-left: 4px solid #ff4444; border-radius: 4px; color: #000;">
            <strong style="color: #000;">Error:</strong> ${typeof E.error=="string"?E.error:E.error.message||"Invalid category"}
          </div>
        `;return}a.ageMin=E.ageMin,a.ageMax=E.ageMax,a.ageMinDate=E.ageMinDate,a.ageMaxDate=E.ageMaxDate,C.style.display="block",C.innerHTML=`
        <div style="padding: 0.75em; background-color: #e8f5e9; border-left: 4px solid #4caf50; border-radius: 4px; color: #000;">
          <strong style="color: #000;">Age Range:</strong> ${E.ageMin||"N/A"} - ${E.ageMax||"N/A"}<br>
          <strong style="color: #000;">Min Birth Date:</strong> ${E.ageMinDate||"N/A"}<br>
          <strong style="color: #000;">Max Birth Date:</strong> ${E.ageMaxDate||"N/A"}
        </div>
      `}catch(E){C.style.display="block",C.innerHTML=`
        <div style="padding: 0.75em; background-color: #ffe8e8; border-left: 4px solid #ff4444; border-radius: 4px; color: #000;">
          <strong style="color: #000;">Error:</strong> ${E?.message||"Failed to calculate age details"}
        </div>
      `}}},c=document.createElement("div"),u=C=>{if((C.categoryName?.value||"").trim().length<5)return!1;const E=C.type?.value;if(!E)return!1;const P=E==="AGE"||E==="BOTH",R=E==="RATING"||E==="BOTH";return P&&!R?!!a.ageCategoryCode:!P&&R?!!a.ratingType:P&&R?!!(a.ageCategoryCode||a.ratingType):!1},d=C=>{const E=document.getElementById("categoryOkButton");E&&(E.disabled=!u(C))},p=(C,E)=>P=>P?.trim().length>=C&&(!E||P?.trim().length<=E),f=Sr(c,[{label:n.labels?.categoryNameLabel||"Category Name",validator:p(5),error:"Minimum 5 characters",field:"categoryName",placeholder:"e.g., Boys U18, Open Singles, 3.5-4.0",value:a.categoryName,focus:!0,onChange:C=>{a.categoryName=C.target.value}},{label:n.labels?.typeLabel||"Category Type",field:"type",options:[{label:"Select type...",value:"",selected:!a.type},...(n.options?.types||[]).map(C=>({label:C,value:C,selected:C===a.type}))],onChange:C=>{const E=C.target.value;a.type=E,w()}},{label:n.labels?.ballTypeLabel||"Ball Type",field:"ballType",options:[{label:"None",value:"",selected:!a.ballType},...(n.options?.ballTypes||[]).map(C=>({label:C,value:C,selected:C===a.ballType}))],onChange:C=>{const E=C.target.value;a.ballType=E||void 0}},{label:n.labels?.notesLabel||"Notes",field:"notes",placeholder:"Additional information...",value:a.notes,onChange:C=>{a.notes=C.target.value}}],[{control:"categoryName",onInput:({inputs:C})=>{d(C)}},{control:"type",onInput:({inputs:C})=>{d(C)}},{control:"ballType",onInput:({inputs:C})=>{d(C)}},{control:"notes",onInput:({inputs:C})=>{d(C)}}]);o.appendChild(c);const h=document.createElement("div");h.id="ageCategorySection",h.style.display=a.type==="AGE"||a.type==="BOTH"?"block":"none";const m=document.createElement("label");m.textContent=n.labels?.ageCategoryCodeLabel||"Age Category Code",m.style.display="block",m.style.marginBottom="0.5em",m.style.fontWeight="bold",m.style.fontSize="0.9em",m.style.color="#000",h.appendChild(m);const A=document.createElement("div");A.style.display="flex",A.style.alignItems="center",A.style.gap="0.5em";const g=document.createElement("div");g.id="ageCategoryValue",g.style.padding="0.5em",g.style.border="1px solid #b5b5b5",g.style.borderRadius="4px",g.style.backgroundColor="#f5f5f5",g.style.flex="1",g.style.minHeight="2.5em",g.style.display="flex",g.style.alignItems="center",g.style.color="#000",g.textContent=a.ageCategoryCode||"Not set",A.appendChild(g);const v=document.createElement("button");v.className="button is-info is-small",v.textContent=a.ageCategoryCode?"Edit":"Set",v.onclick=()=>{cot({existingAgeCategoryCode:a.ageCategoryCode,editorConfig:{defaultConsideredDate:s},callback:C=>{a.ageCategoryCode=C.ageCategoryCode,g.textContent=C.ageCategoryCode||"Not set",v.textContent=C.ageCategoryCode?"Edit":"Set",l(),d(f)}})},A.appendChild(v),h.appendChild(A);const b=document.createElement("div");b.id="ageDetailsPanel",b.style.marginTop="0.5em",b.style.display="none",h.appendChild(b),o.appendChild(h);const y=document.createElement("div");y.id="ratingSection",y.style.display=a.type==="RATING"||a.type==="BOTH"?"block":"none";const I=document.createElement("div");Sr(I,[{label:n.labels?.ratingTypeLabel||"Rating Type",field:"ratingType",options:[{label:"Select rating type...",value:"",selected:!a.ratingType},...(n.options?.ratingTypes||[]).map(C=>({label:C,value:C,selected:C===a.ratingType}))],onChange:C=>{const E=C.target.value;a.ratingType=E||void 0}},{label:n.labels?.ratingMinLabel||"Minimum Rating",field:"ratingMin",type:"number",placeholder:"Min",value:a.ratingMin?.toString()||"",onChange:C=>{const E=C.target.value;a.ratingMin=E?Number.parseFloat(E):void 0},fieldPair:{label:n.labels?.ratingMaxLabel||"Maximum Rating",field:"ratingMax",type:"number",placeholder:"Max",value:a.ratingMax?.toString()||"",onChange:C=>{const E=C.target.value;a.ratingMax=E?Number.parseFloat(E):void 0}}}],[{control:"ratingType",onInput:()=>{d(f)}},{control:"ratingMin",onInput:()=>{d(f)}},{control:"ratingMax",onInput:()=>{d(f)}}]),y.appendChild(I),o.appendChild(y);const w=()=>{const C=a.type==="AGE"||a.type==="BOTH",E=a.type==="RATING"||a.type==="BOTH";h.style.display=C?"block":"none",y.style.display=E?"block":"none",C&&l()};setTimeout(()=>{w(),l()},0);const S=[{label:"Cancel",close:!0},{label:"OK",id:"categoryOkButton",intent:"is-success",close:!0,disabled:!0,onClick:()=>{uot(r)&&r(a)}}],T={...n.modalConfig},D=pf.open({title:n.labels?.title||"Category",content:o,buttons:S,config:T});return setTimeout(()=>{d(f)},0),D}function pot(t){if(t===""||t===null||t===void 0)return!1;const e=Number(t);return!isNaN(e)&&Number.isInteger(e)&&e>=0}const uRe=(t,e)=>i=>pot(i)&&Number(i)>=t&&Number(i)<=e,{WTN:fot,UTR:hot,TRN:mot,NTRP:Aot,DUPR:got}=yN.ratingConstants,{RATING:dRe}=yN.scaleConstants,pRe=["Blue","Red","Green","Orange","Purple","Yellow","Pink","Gold","Silver","Bronze"],vot=[fot,hot,mot,Aot,got],yot=[{value:"WATERFALL",label:"Waterfall",description:"Distributes evenly: 123123 (like dealing cards)"},{value:"LEVEL_BASED",label:"Level Based",description:"Groups by skill tiers: [1-5], [6-10], [11-15]"},{value:"SHUTTLE",label:"Shuttle",description:"Alternating direction: 123321123 (like a loom shuttle)"}];function bot(t){const{flightsCount:e,namingType:i,customName:r,suffixType:n}=t,a=[];for(let s=0;s<e;s++)if(i==="colors")a.push(pRe[s]||`Flight ${s+1}`);else{const o=n==="letters"?String.fromCodePoint(65+s):(s+1).toString();a.push(`${r||"Flight"} ${o}`)}return a}function Iot(t){const e={scaleType:t.scaleType};return t.eventType&&(e.eventType=t.eventType),t.scaleType===dRe&&t.scaleName&&(e.scaleName=t.scaleName,tx.ratingsParameters[t.scaleName]?(e.ascending=tx.ratingsParameters[t.scaleName].ascending,e.accessor=tx.ratingsParameters[t.scaleName].accessor):(delete e.ascending,delete e.accessor)),e}function wot(t){return{WATERFALL:"splitWaterfall",LEVEL_BASED:"splitLevelBased",SHUTTLE:"splitShuttle"}[t]||"splitLevelBased"}function Sot(t){const e=[];return!t.flightsCount||Number.isNaN(t.flightsCount)||t.flightsCount<=0?e.push("Number of flights must be a valid number greater than 0"):t.flightsCount<2?e.push("Must have at least 2 flights"):t.flightsCount>10&&e.push("Maximum 10 flights allowed"),t.scaleType===dRe&&!t.scaleName&&e.push("Rating system must be selected"),e}const g3="flightsCount",fRe="namingType",hRe="customName",mRe="suffixType",ARe="scaleType",gRe="scaleName",Uot="splitMethod";function Tot({existingProfile:t,editorConfig:e={}}={}){const i=!!t,r={flightsCount:2,namingType:"colors",customName:"Flight",suffixType:"numbers",scaleType:"RATING",scaleName:"WTN",splitMethod:"LEVEL_BASED"};if(i&&t){const{flights:n,scaleAttributes:a,splitMethod:s}=t;if(n&&n.length>0){r.flightsCount=n.length;const o=n[0].drawName;if(pRe.includes(o))r.namingType="colors";else{const l=o.match(/^(.+?)\s+([A-Z]|\d+)$/);l&&(r.namingType="custom",r.customName=l[1],r.suffixType=/[A-Z]/.test(l[2])?"letters":"numbers")}}if(a&&(r.scaleType=a.scaleType||"RATING",r.scaleName=a.scaleName),s){const o={splitWaterfall:"WATERFALL",splitLevelBased:"LEVEL_BASED",splitShuttle:"SHUTTLE"};r.splitMethod=o[s]||"LEVEL_BASED"}}return[{error:"Must be in range 2-10",placeholder:"2",validator:uRe(2,10),value:r.flightsCount,label:e.labels?.flightsCountLabel||"Number of Flights (2-10)",field:g3,selectOnFocus:!0,hide:i,type:"number",focus:!0},{options:[{label:"Color Names",value:"colors",selected:r.namingType==="colors"},{label:"Root Word",value:"custom",selected:r.namingType==="custom"}],label:e.labels?.namingTypeLabel||"Naming Strategy",value:r.namingType,field:fRe,hide:i},{placeholder:"Flight",label:e.labels?.customNameLabel||"Root Word",visible:r.namingType==="custom",value:r.customName,selectOnFocus:!0,field:hRe,hide:i,fieldPair:{options:[{label:"Letters (A, B, C)",value:"letters",selected:r.suffixType==="letters"},{label:"Numbers (1, 2, 3)",value:"numbers",selected:r.suffixType==="numbers"}],label:e.labels?.suffixTypeLabel||"Suffix Style",visible:r.namingType==="custom",value:r.suffixType,field:mRe}},{options:[{label:"Rating",value:"RATING",selected:r.scaleType==="RATING"},{label:"Ranking",value:"RANKING",selected:r.scaleType==="RANKING"}],label:e.labels?.scaleTypeLabel||"Flighting Strategy",field:ARe,value:r.scaleType,hide:i},{options:vot.map(n=>({label:n,value:n,selected:n===r.scaleName})),label:e.labels?.scaleNameLabel||"Rating System",field:gRe,value:r.scaleName,visible:r.scaleType==="RATING",hide:i},{label:e.labels?.splitMethodLabel||"Split Method",field:Uot,value:r.splitMethod,radio:!0,options:yot.map(n=>({text:n.label,value:n.value,checked:n.value===r.splitMethod})),hide:i}]}const hG="none";function Cot(){const t=({inputs:e})=>{const i=document.getElementById("flightProfileOk");if(!i)return;const r=e[g3]?.value,n=uRe(2,10)(r);i.disabled=!n,i.style.opacity=n?"1":"0.5",i.style.cursor=n?"pointer":"not-allowed"};return[{onInput:({inputs:e})=>{t({inputs:e})},control:g3},{onChange:({e,fields:i})=>{const r=e.target.value;if(i){const n=r==="custom";i[hRe].style.display=n?"":hG,i[mRe].style.display=n?"":hG}},control:fRe},{onChange:({e,fields:i})=>{const r=e.target.value;if(i){const n=r==="RATING";i[gRe].style.display=n?"":hG}},control:ARe}]}function Ere(t){return typeof t=="function"}function Eot(t){const{existingFlightProfile:e,editorConfig:i={},callback:r}=t,n=!!e;let a;const s=c=>{if(n){const f=document.createElement("div");f.className="notification is-info is-light",f.innerHTML='<strong style="color: #000;">Note:</strong> Flight split has already been performed. You can only rename the flights.',c.appendChild(f)}const u=Tot({existingProfile:e,editorConfig:i}),d=Cot(),p=document.createElement("div");if(c.appendChild(p),a=Sr(p,u,d),n&&e?.flights){const f=document.createElement("div");f.className="field",f.innerHTML=`
        <label class="label">${i.labels?.flightNamesLabel||"Flight Names"}</label>
      `,e.flights.forEach((h,m)=>{const A=document.createElement("div");A.className="field",A.innerHTML=`
          <div class="control">
            <input 
              type="text" 
              class="input" 
              id="flightName_${m}"
              value="${h.drawName}"
              placeholder="Flight ${m+1}"
            />
          </div>
        `,A.querySelector("input").addEventListener("input",g=>{e.flights[m].drawName=g.target.value}),f.appendChild(A)}),c.appendChild(f)}},o=[{label:"Cancel",close:!0},{label:"OK",id:"flightProfileOk",intent:"is-success",close:!0,onClick:()=>{if(n)return Ere(r)&&r({flights:e.flights}),!0;{const c={flightsCount:Number.parseInt(a.flightsCount?.value||"0"),namingType:a.namingType?.value||"colors",customName:a.customName?.value||"Flight",suffixType:a.suffixType?.value||"numbers",scaleType:a.scaleType?.value||"RATING",scaleName:a.scaleName?.value,splitMethod:a.splitMethod?.value||"LEVEL_BASED"},u=Sot(c);if(u.length>0)return alert(u.join(`
`)),!1;const d=bot(c),p=Iot(c),f=wot(c.splitMethod);return Ere(r)&&r({flightsCount:c.flightsCount,drawNames:d,scaleAttributes:p,splitMethod:f}),!0}}}],l={modalSize:"is-medium"};return n||(l.info=`
      <div style="color: #000;">
        <div style="margin-bottom: 1em;">
          <strong style="color: #000;">Waterfall:</strong><br>
          <span style="color: #666;">Distributes evenly like dealing cards: 123123</span>
        </div>
        <div style="margin-bottom: 1em;">
          <strong style="color: #000;">Level Based:</strong><br>
          <span style="color: #666;">Groups by skill tiers: [1-5], [6-10], [11-15]</span>
        </div>
        <div>
          <strong style="color: #000;">Shuttle:</strong><br>
          <span style="color: #666;">Alternating direction like a loom shuttle: 123321123</span>
        </div>
      </div>
    `),pf.open({title:i.labels?.title||"Flight Profile",content:s,buttons:o,config:l})}const{RETIRED:Dot,WALKOVER:vRe,DEFAULTED:Pot,SUSPENDED:Rot,CANCELLED:yRe,INCOMPLETE:Mot,DEAD_RUBBER:bRe,IN_PROGRESS:Not,AWAITING_RESULT:Bot}=jh;function kot(t,e){const i=t.substring(e).trim().toLowerCase();return/^in(\s+p(rog(ress)?)?)?$/i.exec(i)?{ending:Not,endPos:t.length}:/^inc(omp(lete?)?)?/i.exec(i)?{ending:Mot,endPos:t.length}:/^(dr|dead(\s*r(ubber)?)?)/i.exec(i)?{ending:bRe,endPos:t.length}:/^r(et(ired?)?)?/i.exec(i)?{ending:Dot,endPos:t.length}:/^(w(\/o|o|alk(over?)?)?)/i.exec(i)?{ending:vRe,endPos:t.length}:/^d(ef(aulted?)?)?/i.exec(i)?{ending:Pot,endPos:t.length}:/^s(usp(ended?)?)?/i.exec(i)?{ending:Rot,endPos:t.length}:/^c(anc(ell?ed?)?)?/i.exec(i)?{ending:yRe,endPos:t.length}:/^a(wait(ing(\s*r(esult)?)?)?)?/i.exec(i)?{ending:Bot,endPos:t.length}:{endPos:e}}function $E(t,e){const i=t.bestOf||3;return e===i-1&&t.finalSetFormat?t.finalSetFormat:t.setFormat}function IN(t){return!!t?.tiebreakSet?.tiebreakTo&&!t?.setTo}function xot(t){return IN(t)?0:(t?.setTo||6)+1}function IRe(t){const e=t?.tiebreakSet,i=t?.tiebreakFormat;return e?e.tiebreakTo||10:i&&i.tiebreakTo||7}function pw(t){return t>="0"&&t<="9"}function eO(t){for(const e of t)if(!pw(e))return!1;return!0}function _ot(t){return!pw(t)&&!v3(t)&&!y3(t)}function v3(t){return t==="("||t==="["}function y3(t){return t===")"||t==="]"}function wRe(t,e,i){const r=i?.tiebreakAt||i?.setTo||6;return t===r&&e===r}function Oot(t,e,i){const r=i?.setTo||6,n=Math.max(t,e),a=Math.min(t,e);return n<r?!1:n-a>=2}function Fot(t,e,i){const r=IRe(i),n=Math.max(t,e),a=Math.min(t,e);return i?.tiebreakSet?.NoAD||i?.tiebreakFormat?.NoAD?n>=r:n<r?!1:n-a>=2}function Lot(t,e){const i=t==="1-0"?1:0,r=t==="0-1"?1:0;return{side1TiebreakScore:i,side2TiebreakScore:r,setNumber:e,winningSide:i>r?1:2}}function $ot(t,e,i){const r=t.indexOf("-");if(r===-1)return i.push({position:0,message:`Set ${e}: Invalid format "${t}". Expected "#-#" (e.g., "5-3")`,expected:"#-#",got:t}),null;const n=t.slice(0,r),a=t.slice(r+1);if(!n||!a||!eO(n)||!eO(a))return i.push({position:0,message:`Set ${e}: Invalid format "${t}". Expected "#-#" (e.g., "5-3")`,expected:"#-#",got:t}),null;const s=Number.parseInt(n,10),o=Number.parseInt(a,10);return{side1Score:s,side2Score:o,setNumber:e}}function Hot(t,e,i){const r=t.indexOf("-");if(r===-1)return i.push({position:0,message:`Final set: Invalid format "${t}". Expected TB format "1-0" or "0-1", or regular "#-#"`,expected:"1-0, 0-1, or #-#",got:t}),null;const n=t.slice(0,r),a=t.slice(r+1);if(!n||!a||!eO(n)||!eO(a))return i.push({position:0,message:`Final set: Invalid format "${t}". Expected TB format "1-0" or "0-1", or regular "#-#"`,expected:"1-0, 0-1, or #-#",got:t}),null;const s=Number.parseInt(n,10),o=Number.parseInt(a,10);return{side1Score:s,side2Score:o,setNumber:e}}function Vot(t,e){return t.slice(0,e).reduce((i,r)=>(i.side1+=r.side1Score||0,i.side2+=r.side2Score||0,i),{side1:0,side2:0})}function Got(t,e,i){const r=t.filter(l=>l.side1Score!==void 0),n=t.some(l=>l.side1TiebreakScore!==void 0);if(r.length<e)return;const a=Vot(r,e),s=a.side1===a.side2,o=r.length>e;if(s&&!n)if(o){const l=r[e];i.push({position:0,message:`Aggregate tied (${a.side1}-${a.side2}). Final set score "${l.side1Score}-${l.side2Score}" invalid. TB1 only accepts "1-0" or "0-1"`})}else i.push({position:0,message:`Aggregate tied (${a.side1}-${a.side2}), final TB required`});else!s&&n?i.push({position:0,message:`Aggregate not tied (${a.side1}-${a.side2}), final TB not allowed`}):!s&&o&&i.push({position:0,message:`Aggregate not tied (${a.side1}-${a.side2}), extra sets not allowed`})}function Qot(t,e,i,r){const n=[];for(let a=0;a<t.length;a++){const s=t[a],o=a+1,l=o===i,c=s==="1-0"||s==="0-1";if(e&&l&&c)n.push(Lot(s,o));else if(e&&l&&!c){const u=Hot(s,o,r);u&&n.push(u)}else{const u=$ot(s,o,r);u&&n.push(u)}}return n}function jot(t,e){return{valid:!1,formattedScore:"",sets:[],confidence:1,errors:[],warnings:[],ambiguities:[],suggestions:t?[`Enter ${e-1} timed sets (final TB only if tied)`]:[`Enter ${e} sets in format: #-# #-# ...`],incomplete:!0,matchComplete:!1}}function zot(t,e,i,r,n){if(t>i){const a=r?`${e}-${i}`:`${i}`;n.push({position:0,message:`Too many sets: got ${t}, expected ${a}`})}}function qot(t,e,i,r,n){if(!t)return[];if(e){const s=i-r;return[`Enter ${s} more timed set${s===1?"":"s"} (or final TB if aggregate tied)`]}const a=n-r;return[`Need ${a} more set${a===1?"":"s"}`]}function Wot(t){return t.map(e=>e.side1TiebreakScore!==void 0?`${e.side1TiebreakScore}-${e.side2TiebreakScore}`:`${e.side1Score}-${e.side2Score}`).join(" ")}function Kot(t,e){const i=e.exactly||e.bestOf||1,r=t.trim(),n=e.setFormat?.based==="A"||e.finalSetFormat?.based==="A",a=e.finalSetFormat?.tiebreakSet?.tiebreakTo!==void 0,s=n&&a;if(!r)return jot(s,i);const o=r.split(/\s+/),l=[],c=s?i-1:i,u=Qot(o,s,i,l);s&&l.length===0&&Got(u,c,l);const d=s?c:i,p=i;zot(u.length,d,p,s,l);const f=u.length<d&&l.length===0,h=(u.length===i||s&&u.length===c)&&l.length===0,m=Wot(u);return{valid:l.length===0&&(u.length===d||u.length===p),formattedScore:m,sets:u,confidence:l.length===0?1:0,errors:l,warnings:[],ambiguities:[],suggestions:qot(f,s,d,u.length,i),incomplete:f,matchComplete:h}}function Dre(t,e){const i=typeof e=="string"?au.parse(e):e;if(!i)return{valid:!1,formattedScore:"",sets:[],confidence:0,errors:[{position:0,message:"Invalid matchUpFormat"}],warnings:[],ambiguities:[],suggestions:[],incomplete:!1,matchComplete:!1};const r=!!(i.setFormat?.timed||i.finalSetFormat?.timed),n=!!i.exactly||i.bestOf===1;if(r&&n)return Kot(t,i);const a={input:t,position:0,setIndex:0,currentSide1Buffer:"",currentSide2Buffer:"",currentTiebreakSide1Buffer:"",currentTiebreakSide2Buffer:"",sets:[],parsedFormat:i,state:"START",inTiebreak:!1,expectingTiebreakOnly:!1,isValid:!0,errors:[],warnings:[],confidence:1,ambiguities:[],suggestions:[]},s=$E(i,0);for(IN(s)?(a.expectingTiebreakOnly=!0,a.inTiebreak=!0,a.state="PARSING_TIEBREAK_SIDE1"):a.state="PARSING_SIDE1";a.position<t.length&&a.isValid;)Yot(a);flt(a);let o=a.sets,l;a.irregularEnding&&(l=a.irregularEnding,(a.irregularEnding===vRe||a.irregularEnding===yRe||a.irregularEnding===bRe)&&(o=[]));const c=a.irregularEnding?!1:hlt(a),u=mlt(a);return{valid:a.isValid&&a.errors.length===0,formattedScore:u,sets:o,confidence:a.confidence,errors:a.errors,warnings:a.warnings,ambiguities:a.ambiguities,suggestions:a.suggestions,incomplete:!c&&o.length>0,matchComplete:c,matchUpStatus:l}}function Yot(t){const e=t.input[t.position];if(!pw(e)&&!v3(e)&&!y3(e)){const i=kot(t.input,t.position);if(i.ending){t.irregularEnding=i.ending,t.irregularEndingPosition=t.position,t.position=i.endPos;return}}if(_ot(e)){Xot(t);return}if(v3(e)){Zot(t);return}if(y3(e)){Jot(t);return}if(pw(e)){elt(t,e);return}t.errors.push({position:t.position,message:`Unexpected character '${e}'`,got:e,context:Alt(t)}),t.isValid=!1}function Xot(t){if(t.state==="PARSING_SIDE1"&&t.currentSide1Buffer){t.state="PARSING_SIDE2",t.position++;return}if(t.state==="PARSING_SIDE2"&&t.currentSide2Buffer){const e=Number.parseInt(t.currentSide1Buffer),i=Number.parseInt(t.currentSide2Buffer),r=$E(t.parsedFormat,t.setIndex);if(WX(e,i,r)){t.inTiebreak=!0,t.state="PARSING_TIEBREAK_SIDE1",t.position++;return}sC(t),t.position++;return}if(t.state==="PARSING_TIEBREAK_SIDE1"&&t.currentTiebreakSide1Buffer)if(t.currentSide1Buffer&&t.currentSide2Buffer){sC(t),t.position++;return}else{t.state="PARSING_TIEBREAK_SIDE2",t.position++;return}t.position++}function Zot(t){const e=$E(t.parsedFormat,t.setIndex);if(IN(e)){t.inTiebreak=!0,t.state="PARSING_TIEBREAK_SIDE1",t.position++;return}if(t.currentSide1Buffer&&t.currentSide2Buffer){const i=Number.parseInt(t.currentSide1Buffer),r=Number.parseInt(t.currentSide2Buffer);if(wRe(i,r,e)){t.inTiebreak=!0,t.state="PARSING_TIEBREAK_SIDE1",t.position++;return}}t.warnings.push(`Tiebreak indicator at position ${t.position} may be ambiguous`),t.inTiebreak=!0,t.state="PARSING_TIEBREAK_SIDE1",t.position++}function Jot(t){if(t.inTiebreak){plt(t),t.inTiebreak=!1,t.position++;return}t.warnings.push(`Unexpected tiebreak closer at position ${t.position}`),t.position++}function elt(t,e){const i=$E(t.parsedFormat,t.setIndex);t.inTiebreak?slt(t,e,i):rlt(t,e,i)}function SRe(t,e,i){return Number.parseInt(t+e)>i}function tlt(t,e,i){t.state="PARSING_SIDE1",t.currentSide1Buffer+=e;const r=Number.parseInt(t.currentSide1Buffer),n=t.position+1;if(n<t.input.length&&pw(t.input[n])){const a=t.input[n];SRe(t.currentSide1Buffer,a,i)&&(t.warnings.push(`Potential score issue: "${t.currentSide1Buffer}${a}" would exceed max game score ${i}`),t.state="PARSING_SIDE2")}else t.state="PARSING_SIDE2";r>i&&t.warnings.push(`Score ${r} exceeds max ${i} at position ${t.position}`),t.position++}function ilt(t,e,i,r){t.currentSide2Buffer+=e;const n=Number.parseInt(t.currentSide1Buffer),a=Number.parseInt(t.currentSide2Buffer);if(WX(n,a,i)){t.inTiebreak=!0,t.state="PARSING_TIEBREAK_SIDE1",t.position++;return}const s=t.position+1;if(s<t.input.length&&pw(t.input[s])){const o=t.input[s];SRe(t.currentSide2Buffer,o,r)&&(Oot(n,a,i)||wRe(n,a,i)||t.warnings.push(`Set ${t.setIndex+1} may be incomplete: ${n}-${a}`),sC(t))}t.position++}function rlt(t,e,i){const r=xot(i);if(t.state==="PARSING_SIDE1"||t.state==="START"){tlt(t,e,r);return}if(t.state==="PARSING_SIDE2"){ilt(t,e,i,r);return}t.position++}function nlt(t,e){t.currentTiebreakSide1Buffer+=e,t.position++}function alt(t,e,i){t.currentTiebreakSide2Buffer+=e;const r=Number.parseInt(t.currentTiebreakSide2Buffer),n=t.position+1;if(n<t.input.length&&pw(t.input[n])){const a=t.input[n],s=Number.parseInt(t.currentTiebreakSide2Buffer+a),o=Number.parseInt(t.currentTiebreakSide1Buffer);if(s>999){const l=r;Fot(o,l,i)||t.warnings.push(`Tiebreak may be incomplete: ${o}-${l}`),sC(t)}}t.position++}function slt(t,e,i){if(t.state==="PARSING_TIEBREAK_SIDE1"){nlt(t,e);return}if(t.state==="PARSING_TIEBREAK_SIDE2"){alt(t,e,i);return}t.position++}function olt(t){if(!t.currentTiebreakSide1Buffer||!t.currentTiebreakSide2Buffer)return null;const e=Number.parseInt(t.currentTiebreakSide1Buffer),i=Number.parseInt(t.currentTiebreakSide2Buffer);return{side1Score:0,side2Score:0,side1TiebreakScore:e,side2TiebreakScore:i,setNumber:t.setIndex+1,winningSide:e>i?1:2}}function llt(t,e,i){const r=e.currentTiebreakSide1Buffer,n=e.currentTiebreakSide2Buffer;r&&n?(t.side1TiebreakScore=Number.parseInt(r),t.side2TiebreakScore=Number.parseInt(n)):(r||n)&&clt(t,r,n,i)}function clt(t,e,i,r){const n=Number.parseInt(e||i),a=IRe(r),s=r?.tiebreakFormat?.NoAD?a:Math.max(a,n+2);t.side1Score>t.side2Score?(t.side1TiebreakScore=s,t.side2TiebreakScore=n):(t.side1TiebreakScore=n,t.side2TiebreakScore=s)}function WX(t,e,i){const r=i.tiebreakAt||i.setTo||6;return t===r&&e===r+1||e===r&&t===r+1}function ult(t,e){if(!t.currentSide1Buffer||!t.currentSide2Buffer)return null;const i=Number.parseInt(t.currentSide1Buffer),r=Number.parseInt(t.currentSide2Buffer);if(WX(i,r,e)&&!t.currentTiebreakSide1Buffer&&!t.currentTiebreakSide2Buffer)return null;const n={side1Score:i,side2Score:r,setNumber:t.setIndex+1};return(t.currentTiebreakSide1Buffer||t.currentTiebreakSide2Buffer)&&llt(n,t,e),i>r?n.winningSide=1:r>i&&(n.winningSide=2),n}function dlt(t){t.currentSide1Buffer="",t.currentSide2Buffer="",t.currentTiebreakSide1Buffer="",t.currentTiebreakSide2Buffer="",t.setIndex++,t.inTiebreak=!1,t.state="PARSING_SIDE1";const e=$E(t.parsedFormat,t.setIndex);IN(e)&&(t.expectingTiebreakOnly=!0,t.inTiebreak=!0,t.state="PARSING_TIEBREAK_SIDE1")}function sC(t){const e=$E(t.parsedFormat,t.setIndex),i=IN(e);let r=null;i?r=olt(t):r=ult(t,e),r&&t.sets.push(r),dlt(t)}function plt(t){sC(t)}function flt(t){(t.currentSide1Buffer||t.currentSide2Buffer||t.currentTiebreakSide1Buffer||t.currentTiebreakSide2Buffer)&&sC(t)}function hlt(t){const e=t.parsedFormat.bestOf||3,i=Math.ceil(e/2),r=t.sets.filter(a=>a.winningSide===1).length,n=t.sets.filter(a=>a.winningSide===2).length;return r>=i||n>=i}function mlt(t){const e=[];for(const i of t.sets)if((!i.side1Score||i.side1Score===0)&&(!i.side2Score||i.side2Score===0)&&(i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)){const r=i.side1TiebreakScore??0,n=i.side2TiebreakScore??0;e.push(`[${r}-${n}]`)}else{let r=`${i.side1Score||0}-${i.side2Score||0}`;if(i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0){const n=i.side1TiebreakScore??0,a=i.side2TiebreakScore??0,s=i.winningSide===1?a:n;r+=`(${s})`}e.push(r)}return e.join(" ")}function Alt(t){const e=Math.max(0,t.position-5),i=Math.min(t.input.length,t.position+5),r=t.input.substring(e,t.position),n=t.input.substring(t.position+1,i);return`...${r}[${t.input[t.position]}]${n}...`}const{COMPLETED:URe}=jh,{validateMatchUpScore:glt,validateSetScore:vlt}=A2.scoreGovernor;function ylt(t,e,i,r,n){const a=i?.finalSetFormat?.tiebreakSet?.tiebreakTo&&!i?.finalSetFormat?.setTo,s=i?.setFormat?.tiebreakSet?.tiebreakTo&&!i?.setFormat?.setTo,o=i?.finalSetFormat?.tiebreakSet?.tiebreakTo===1,l=i?.setFormat?.tiebreakSet?.tiebreakTo===1;for(let c=0;c<t.length;c++){const u=t[c],d=c+1,p=d===e,f=u.startsWith("[")&&u.endsWith("]"),h=(u==="1-0"||u==="0-1")&&(p&&o||l),m=s||p&&a;if(!m&&f)return{isValid:!1,sets:r,scoreObject:n,error:`Set ${d}: Format expects regular set (e.g., 6-4), but got tiebreak-only set ${u}`};if(m&&!f&&!h)return{isValid:!1,sets:r,scoreObject:n,error:`Set ${d}: Format expects tiebreak-only set (e.g., [10-8]), but got regular set ${u}`}}return null}function blt(t,e,i,r,n){if(t||e===void 0)return!1;if(n?.setFormat?.based==="A"||n?.finalSetFormat?.based==="A")return i.filter(a=>a.side1Score!==void 0&&a.side2Score!==void 0).length>=r;{const a=Math.ceil(r/2),s={side1:0,side2:0};return i.forEach(o=>{o.winningSide===1?s.side1++:o.winningSide===2&&s.side2++}),s.side1>=a||s.side2>=a}}function dI(t,e,i){const{WALKOVER:r,CANCELLED:n,DEAD_RUBBER:a}=jh,s=[r,n,a];if(!t?.trim())return i&&s.includes(i)?{isValid:!0,sets:[],matchUpStatus:i,scoreObject:void 0}:{isValid:!1,sets:[],error:"Score is required"};try{const{outcome:o,error:l}=Qs.generateOutcomeFromScoreString({scoreString:t.trim(),matchUpFormat:e,preserveSideOrder:!0});if(l||!o?.score?.sets)return{isValid:!1,sets:[],error:l||"Invalid score format"};const c=o.score.sets,u=o.score,d=t.trim().split(/\s+/).filter(I=>I.length>0),p=au.parse(e),f=p?.exactly||p?.bestOf||3,h=ylt(d,f,p,c,u);if(h)return h;let m=!1;const A=c.map((I,w)=>{const S=w+1===f;if(!vlt(I,e,S,!1).isValid){m=!0;const{...T}=I;return T}return I}),g={...u,sets:A},v=glt(A,e,i);if(!v.isValid)return{isValid:!1,sets:A,scoreObject:g,error:v.error};const b=Math.ceil(f/2),y=m?void 0:o.winningSide;return blt(m,y,A,f,p)?{isValid:!0,sets:A,scoreObject:g,winningSide:y,matchUpStatus:URe,matchUpFormat:e,score:t.trim()}:{isValid:!1,sets:A,scoreObject:g,error:`Incomplete match - need ${b} sets to win`}}catch(o){return{isValid:!1,sets:[],error:o instanceof Error?o.message:"Invalid score format"}}}function Ilt(t,e,i){if(!t||t.length===0)return{isValid:!1,sets:[],error:"At least one set is required"};const r=t.map(n=>{const a=n.side1??"",s=n.side2??"";if((!a||a===0)&&(!s||s===0)&&n.side1TiebreakScore!==void 0&&n.side2TiebreakScore!==void 0)return`[${n.side1TiebreakScore}-${n.side2TiebreakScore}]`;if(a===""||s==="")return"";if(n.side1TiebreakScore!==void 0||n.side2TiebreakScore!==void 0){const o=n.side1TiebreakScore??0,l=n.side2TiebreakScore??0,c=Number(a)>Number(s)?l:o;return`${a}-${s}(${c})`}return`${a}-${s}`}).filter(n=>n!=="").join(" ");return r?dI(r,e,i?void 0:URe):{isValid:!1,sets:[],error:"At least one complete set is required"}}function wlt(t,e){let i="";if(t&&(i=(t.sets||[]).map(r=>{let n=`${r.side1Score||0}-${r.side2Score||0}`;if(r.side1TiebreakScore!==void 0||r.side2TiebreakScore!==void 0){const a=r.winningSide===1?r.side2TiebreakScore:r.side1TiebreakScore;n+=`(${a})`}return n}).join(" ")),e&&e!=="COMPLETED"&&e!=="TO_BE_PLAYED"){const r=Slt(e);if(r)return i?`${i} ${r}`:r}return i}function Slt(t){return{RETIRED:"ret",WALKOVER:"wo",DEFAULTED:"def",DOUBLE_WALKOVER:"wo",DOUBLE_DEFAULT:"def",SUSPENDED:"susp",CANCELLED:"canc",INCOMPLETE:"inc",DEAD_RUBBER:"dr",IN_PROGRESS:"in",AWAITING_RESULT:"await"}[t]||""}const Ult={scoringApproach:"dynamicSets",smartComplements:!0,composition:"Australian",idiom:"en",dateFormat:"YYYY-MM-DD",timeFormat:"HH:mm"};let rT={...Ult};function wH(){return{...rT}}function Tlt(t){rT={...rT,...t}}function Clt(){return{scoringApproach:rT.scoringApproach,smartComplements:rT.smartComplements,composition:rT.composition}}const{RETIRED:mG,WALKOVER:hB,DEFAULTED:mB,SUSPENDED:AG,CANCELLED:gG,INCOMPLETE:vG,DEAD_RUBBER:yG,IN_PROGRESS:bG,AWAITING_RESULT:IG,DOUBLE_WALKOVER:Pre,DOUBLE_DEFAULT:Rre}=jh;function Elt(t){const{matchUp:e,container:i,onScoreChange:r}=t;i.innerHTML="",i.style.display="flex",i.style.flexDirection="column",i.style.gap="1em";const n=e?.sides?.find(E=>E.sideNumber===1),a=e?.sides?.find(E=>E.sideNumber===2);let s=e.score?{...e.score}:void 0,o=e.winningSide,l=e.matchUpStatus;const c=document.createElement("div");c.style.marginBottom="0.25em",i.appendChild(c);const u=document.createElement("div");u.style.display="none",u.style.marginTop="0.25em",u.style.padding="0.35em 0.5em",u.style.backgroundColor="#f5f5f5",u.style.borderRadius="4px",u.style.flexDirection="column",u.style.gap="0.35em";const d=document.createElement("label");d.style.display="flex",d.style.alignItems="center",d.style.gap="0.4em",d.style.cursor="pointer";const p=document.createElement("input");p.type="radio",p.name="winnerSelection",p.value="1";const f=document.createElement("span");f.textContent=n?.participant?.participantName||"Side 1",f.style.fontSize="0.75em",d.appendChild(p),d.appendChild(f);const h=document.createElement("label");h.style.display="flex",h.style.alignItems="center",h.style.gap="0.4em",h.style.cursor="pointer";const m=document.createElement("input");m.type="radio",m.name="winnerSelection",m.value="2";const A=document.createElement("span");A.textContent=a?.participant?.participantName||"Side 2",A.style.fontSize="0.75em",h.appendChild(m),h.appendChild(A),u.appendChild(d),u.appendChild(h),i.appendChild(u);const g=E=>{const{WALKOVER:P,CANCELLED:R,DEAD_RUBBER:M}=jh,N=[P,R,M],k=E?.matchUpStatus&&N.includes(E.matchUpStatus);let O;E?.clearAll||k?(O=void 0,s=void 0):E?.scoreObject?(O=E.scoreObject,s=E.scoreObject):O=s,E?.clearAll?(o=void 0,l=void 0):E!=null&&("winningSide"in E&&(o=E.winningSide),"matchUpStatus"in E&&(l=E.matchUpStatus));const x={...e,score:O,winningSide:o,matchUpStatus:l};c.innerHTML="";const F=wH().composition||"Australian",_=bN({matchUp:x,isLucky:!0,composition:wc[F]||wc.Australian});c.appendChild(_)};if(g(),e.matchUpFormat){const E=document.createElement("div");E.style.fontSize="0.9em",E.style.marginBottom="0.5em",E.style.display="flex",E.style.alignItems="center",E.style.gap="0.5em";const P=document.createElement("span");P.textContent="Format:",P.style.color="#666",E.appendChild(P);const R=document.createElement("button");R.textContent=e.matchUpFormat,R.className="button is-small is-white",R.style.fontSize="0.75em",R.style.padding="0.2em 0.5em",R.style.cursor="pointer",R.title="Click to edit format",R.addEventListener("click",async()=>{try{const{getMatchUpFormatModal:M}=await Promise.resolve().then(()=>zX);M({existingMatchUpFormat:e.matchUpFormat,callback:N=>{if(N&&N!==e.matchUpFormat){e.matchUpFormat=N,R.textContent=N;const k=document.getElementById("scoreInputV2");k&&(k.value="",k.dispatchEvent(new Event("input",{bubbles:!0}))),w.textContent="Score cleared - format changed",w.style.color="#999"}},modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})}catch(M){console.error("[FreeScore] Error opening format selector:",M)}}),E.appendChild(R),i.appendChild(E)}const v=document.createElement("div");v.style.display="flex",v.style.alignItems="center",v.style.gap="0.5em";const b=document.createElement("input");if(b.type="text",b.className="input",b.placeholder="",b.style.flex="1",b.id="scoreInputV2",s){const E=wlt(s,l);b.value=E}const y=document.createElement("span");y.style.fontSize="1.2em",y.style.minWidth="1.5em",v.appendChild(b),v.appendChild(y),i.appendChild(v);const I=document.createElement("div");I.style.fontSize="0.9em",I.style.color="#0066cc",I.style.fontFamily="monospace",I.style.minHeight="1.5em",I.style.padding="0.25em",i.appendChild(I);const w=document.createElement("div");w.style.fontSize="0.9em",w.style.minHeight="1.5em",i.appendChild(w);let S=o;const T=()=>{p.checked?(S=1,d.style.fontWeight="bold",d.style.color="#22c55e",h.style.fontWeight="",h.style.color=""):m.checked&&(S=2,h.style.fontWeight="bold",h.style.color="#22c55e",d.style.fontWeight="",d.style.color=""),D()};p.addEventListener("change",T),m.addEventListener("change",T);const D=()=>{const E=b.value.trim();if(!E){y.textContent="",I.textContent="",w.textContent="",w.style.color="",u.style.display="none",p.checked=!1,m.checked=!1,d.style.fontWeight="",d.style.color="",h.style.fontWeight="",h.style.color="",S=void 0,g({clearAll:!0}),r({isValid:!1,sets:[],matchUpStatus:"TO_BE_PLAYED"});return}const P=Dre(E,e.matchUpFormat);P.formattedScore?I.textContent=P.formattedScore:I.textContent="";const R=P.matchUpStatus&&[mG,hB,mB,AG,gG,vG,yG,bG,IG].includes(P.matchUpStatus),M=P.formattedScore?dI(P.formattedScore,e.matchUpFormat,P.matchUpStatus):{isValid:!1,sets:[],error:"No score to validate"},N=M.sets&&M.sets.length>0,k=S||M.winningSide;if((N&&M.scoreObject||R)&&g({scoreObject:M.scoreObject,winningSide:k,matchUpStatus:M.matchUpStatus||P.matchUpStatus}),M.isValid||R){y.textContent="",y.style.color="green";let O="Valid score";M.matchUpStatus===mG?O="Valid score - RETIRED":M.matchUpStatus===hB?O="Valid score - WALKOVER":M.matchUpStatus===mB?O="Valid score - DEFAULTED":M.matchUpStatus===AG?O="Valid score - SUSPENDED":M.matchUpStatus===gG?O="Valid score - CANCELLED":M.matchUpStatus===vG?O="Valid score - INCOMPLETE":M.matchUpStatus===yG?O="Valid score - DEAD RUBBER":M.matchUpStatus===bG?O="Valid score - IN PROGRESS":M.matchUpStatus===IG&&(O="Valid score - AWAITING RESULT"),w.textContent=O,w.style.color="green";let x;const F=R&&[mG,hB,mB].includes(M.matchUpStatus||P.matchUpStatus),_=R&&[gG,yG,IG,vG,bG,AG].includes(M.matchUpStatus||P.matchUpStatus);if(F){if(u.style.display="flex",x=S,!x){const V=M.matchUpStatus||P.matchUpStatus;if(V===hB){r({...M,isValid:!0,matchUpStatus:Pre,score:P.formattedScore||E});return}else if(V===mB){r({...M,isValid:!0,matchUpStatus:Rre,score:P.formattedScore||E});return}else{r({...M,isValid:!1,error:"Winner must be selected for irregular ending",matchUpStatus:V,score:P.formattedScore||E});return}}}else _?(u.style.display="none",p.checked=!1,m.checked=!1,d.style.fontWeight="",d.style.color="",h.style.fontWeight="",h.style.color="",S=void 0,x=void 0):(u.style.display="none",p.checked=!1,m.checked=!1,d.style.fontWeight="",d.style.color="",h.style.fontWeight="",h.style.color="",S=void 0,x=M.winningSide);r({...M,isValid:!0,winningSide:x,matchUpStatus:M.matchUpStatus||P.matchUpStatus,score:P.formattedScore||E})}else!M.isValid&&N?(y.textContent="",y.style.color="orange",w.textContent=M.error||"Score incomplete - continue typing",w.style.color="orange",u.style.display="none",p.checked=!1,m.checked=!1,d.style.fontWeight="",d.style.color="",h.style.fontWeight="",h.style.color="",S=void 0,r(M)):(y.textContent="",y.style.color="red",w.textContent=M.error||"Invalid score",w.style.color="red",u.style.display="none",p.checked=!1,m.checked=!1,d.style.fontWeight="",d.style.color="",h.style.fontWeight="",h.style.color="",S=void 0,g({scoreObject:void 0,winningSide:void 0,matchUpStatus:void 0}),r(M))};let C=!1;b.addEventListener("input",()=>{D();const E=b.value,P=E.trim();if(!C&&P){const R=Dre(P,e.matchUpFormat),M=R.formattedScore?dI(R.formattedScore,e.matchUpFormat,R.matchUpStatus):{isValid:!1,winningSide:void 0},N=M.isValid&&M.winningSide!==void 0,k=E.length>0&&/[\s-]$/.test(E),O=au.parse(e.matchUpFormat),x=!!O?.exactly||O?.bestOf===1,F=O?.exactly||O?.bestOf||3,_=R.sets?.length>=F;N&&k&&(!x||_)&&(C=!0)}else if(C){const R=E.length>0&&/[\s-]$/.test(E);(P.length===0||!R)&&(C=!1)}}),b.addEventListener("keydown",E=>{C&&!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(E.key)&&E.preventDefault()}),b.addEventListener("keyup",E=>{if(E.key==="Enter"){const P=document.getElementById("submitScoreV2");P&&!P.disabled&&P.click()}}),o===1?(p.checked=!0,d.style.fontWeight="bold",d.style.color="#22c55e"):o===2&&(m.checked=!0,h.style.fontWeight="bold",h.style.color="#22c55e"),setTimeout(()=>{b.focus(),l===Pre||l===Rre?(g({scoreObject:s,winningSide:o,matchUpStatus:l}),r({isValid:!0,sets:s?.sets||[],scoreObject:s,winningSide:o,matchUpStatus:l})):(b.value||l&&l!=="TO_BE_PLAYED"&&l!=="COMPLETED")&&D()},100),globalThis.resetFreeScore=()=>{b.value="",s=void 0,o=void 0,l=void 0,y.textContent="",I.textContent="",w.textContent="",w.style.color="",u.style.display="none",p.checked=!1,m.checked=!1,d.style.fontWeight="",d.style.color="",h.style.fontWeight="",h.style.color="",S=void 0,C=!1,g({clearAll:!0}),r({isValid:!1,sets:[],matchUpStatus:"TO_BE_PLAYED"}),b.focus()}}function TRe(t){if(!t)return{bestOf:3,setsToWin:2,isTimed:!1,isExactlyFormat:!1};const e=au.parse(t);if(!e)return{bestOf:3,setsToWin:2,isTimed:!1,isExactlyFormat:!1};const i=!!(e.setFormat?.timed||e.finalSetFormat?.timed),r=!!e.exactly||e.bestOf===1,n=e.exactly||e.bestOf||3,a=r?n:Math.ceil(n/2);return{bestOf:e.bestOf||n,exactly:e.exactly,setsToWin:a,isTimed:i,isExactlyFormat:r}}function Dlt(t,e){if(!t||t.length===0)return!0;const i=TRe(e),{bestOf:r,isExactlyFormat:n,setsToWin:a}=i,s=i.exactly||r;if(n){if(t.length>=s)return!1;const l=au.parse(e),c=l?.setFormat?.based==="A"||l?.finalSetFormat?.based==="A",u=l?.finalSetFormat?.tiebreakSet?.tiebreakTo!==void 0;if(c&&u&&i.isTimed){const d=s-1;if(t.length<d)return!0;if(t.length===d){const p=t.reduce((f,h)=>(h.side1Score!==void 0&&h.side1Score!==null&&(f.side1+=h.side1Score),h.side2Score!==void 0&&h.side2Score!==null&&(f.side2+=h.side2Score),f),{side1:0,side2:0});return p.side1===p.side2}else return!1}return!0}const o={side1:0,side2:0};return t.forEach(l=>{const c=l.side1Score??0,u=l.side2Score??0;c>u?o.side1++:u>c&&o.side2++}),o.side1>=a||o.side2>=a||t.length>=r?!1:t.every(l=>l.side1Score!==void 0&&l.side2Score!==void 0&&l.side1Score!==null&&l.side2Score!==null)}function HE(t,e){return(e.bestOf===1||t+1===e.bestOf)&&e.finalSetFormat?e.finalSetFormat:e.setFormat}function SH(t){return t?.tiebreakSet?.tiebreakTo!==void 0}function KX(t){return t?.timed===!0&&t?.minutes!==void 0}function Plt(t,e,i,r){const n=HE(t,r);if(KX(n))return 1/0;const a=n?.setTo||6,s=n?.tiebreakAt||a,o=e===1?i.side2:i.side1,l=s===a?a+1:a;return o===0?l:o<s-1?a:o===s-1?s===a?a+1:a:o===s?l:o>s&&o<a?a:o===a?s===a?a+2:s:o>a?o+2:l}function CRe(t,e,i){const r=HE(t,i);if(KX(r))return e.side1!==void 0&&e.side1!==null&&e.side2!==void 0&&e.side2!==null;if(SH(r))return e.side1>0&&e.side2>0&&e.side1!==e.side2;const n=r?.setTo||6,a=r?.tiebreakAt||n,s=Math.max(e.side1,e.side2),o=Math.min(e.side1,e.side2),l=Math.abs(e.side1-e.side2);return s>=n&&l>=2||(a===n?s===a+1&&o===a:s===n&&o===a)&&e.tiebreak!==void 0}function Rlt(t,e,i){if(CRe(t,e,i)){if(e.side1>e.side2)return 1;if(e.side2>e.side1)return 2}}function SU(t,e){const i=Math.ceil(e/2),r=t.filter(a=>a.winningSide===1).length,n=t.filter(a=>a.winningSide===2).length;return r>=i||n>=i}function Mlt(t,e){const i=e?.setTo||6;if(t>=i)return null;const r=e?.tiebreakAt||i;return t<i-1?i:r===i?i+1:i}function Nlt(t,e,i,r,n,a,s){if(!s)return{field1Value:t,field2Value:0,shouldApply:!1,reason:"Feature disabled in settings"};if(a.has(i))return{field1Value:t,field2Value:0,shouldApply:!1,reason:"Already used for this set"};if(SU(r,n.bestOf))return{field1Value:t,field2Value:0,shouldApply:!1,reason:"Match already complete"};const o=HE(i,n);if(SH(o))return{field1Value:t,field2Value:0,shouldApply:!1,reason:"Tiebreak-only set"};const l=Mlt(t,o);return l===null?{field1Value:t,field2Value:0,shouldApply:!1,reason:"No predictable complement for this digit"}:e?{field1Value:l,field2Value:t,shouldApply:!0}:{field1Value:t,field2Value:l,shouldApply:!0}}function Blt(t,e,i){const r=HE(t,i);if(KX(r)||SH(r))return!1;const n=r?.setTo||6,a=r?.tiebreakAt||n,s=Math.max(e.side1,e.side2),o=Math.min(e.side1,e.side2);return a===n?s===a+1&&o===a:s===n&&o===a}function klt(t,e,i,r,n){const a=Number.parseInt(e)||0,s=Number.parseInt(i)||0,o=r?Number.parseInt(r):void 0,l=HE(t,n);if(SH(l)){const d=a>0&&s>0&&a!==s?a>s?1:2:void 0;return{setNumber:t+1,side1Score:0,side2Score:0,side1TiebreakScore:a,side2TiebreakScore:s,winningSide:d}}const c=Rlt(t,{side1:a,side2:s,tiebreak:o},n),u={setNumber:t+1,side1Score:a,side2Score:s,winningSide:c};if(o!==void 0){const d=l?.tiebreakFormat?.tiebreakTo||7,p=l?.tiebreakFormat?.noAd;let f;o<d-1?f=d:f=p?o+1:o+2,a>s?(u.side1TiebreakScore=f,u.side2TiebreakScore=o):(u.side1TiebreakScore=o,u.side2TiebreakScore=f)}return u}const{COMPLETED:Ld,RETIRED:AB,WALKOVER:iU,DEFAULTED:rU,DOUBLE_WALKOVER:gB,DOUBLE_DEFAULT:vB}=jh;function xlt(t){const{matchUp:e,container:i,onScoreChange:r}=t;i.innerHTML="",i.style.display="flex",i.style.flexDirection="column",i.style.gap="1em";let n=e.matchUpFormat||"SET3-S:6/TB7";const a=()=>{const G=TRe(n),z=au.parse(n);return{bestOf:G.bestOf,setFormat:z?.setFormat,finalSetFormat:z?.finalSetFormat}};let s=a();const o=()=>s.bestOf,l=G=>HE(G,s),c=document.createElement("div");if(c.style.marginBottom="0.5em",i.appendChild(c),e.matchUpFormat){const G=document.createElement("div");G.style.fontSize="0.9em",G.style.marginBottom="0.5em",G.style.display="flex",G.style.alignItems="center",G.style.gap="0.5em";const z=document.createElement("span");z.textContent="Format:",z.style.color="#666",G.appendChild(z);const Q=document.createElement("button");Q.textContent=e.matchUpFormat,Q.className="button is-small is-white",Q.style.fontSize="0.75em",Q.style.padding="0.2em 0.5em",Q.style.cursor="pointer",Q.title="Click to edit format",Q.addEventListener("click",async()=>{try{const{getMatchUpFormatModal:j}=await Promise.resolve().then(()=>zX);j({existingMatchUpFormat:e.matchUpFormat,callback:W=>{W&&W!==e.matchUpFormat&&(e.matchUpFormat=W,n=W,Q.textContent=W,s=a(),globalThis.resetDynamicSets&&globalThis.resetDynamicSets())},modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})}catch(j){console.error("[DynamicSets] Error opening format selector:",j)}}),G.appendChild(Q),i.appendChild(G)}let u=Ld,d;const p=new Set;let f=e.score?{...e.score}:void 0,h=e.winningSide,m=e.matchUpStatus;const A=document.createElement("div");A.style.marginBottom="0.8em";const g=document.createElement("div");g.textContent="Irregular Ending:",g.style.fontSize="0.75em",g.style.fontWeight="500",g.style.marginBottom="0.3em",g.style.color="#444",A.appendChild(g);const v=document.createElement("div");v.style.display="flex",v.style.gap="0.5em",v.style.flexWrap="wrap",[{value:AB,label:"Retired"},{value:iU,label:"Walkover"},{value:rU,label:"Defaulted"}].forEach(G=>{const z=document.createElement("label");z.style.display="flex",z.style.alignItems="center",z.style.gap="0.3em",z.style.cursor="pointer";const Q=document.createElement("input");Q.type="radio",Q.name="matchOutcome",Q.value=G.value,Q.checked=!1,Q.addEventListener("change",W=>{if(u=W.target.value,u===iU||u===AB||u===rU){D.querySelectorAll("input").forEach(X=>{X.value=""});const Y=D.querySelectorAll(".set-row");for(let X=Y.length-1;X>0;X--)Y[X].remove();C=[],f=void 0}y.style.display="block",setTimeout(()=>{typeof N=="function"&&N()},0)});const j=document.createElement("span");j.textContent=G.label,j.style.fontSize="0.75em",z.appendChild(Q),z.appendChild(j),v.appendChild(z)});const b=document.createElement("button");b.textContent="Clear",b.className="button",b.style.fontSize="0.7em",b.style.padding="0.2em 0.5em",b.addEventListener("click",()=>{A.querySelectorAll('input[name="matchOutcome"]').forEach(G=>G.checked=!1),u=Ld,d=void 0,y.style.display="none",A.querySelectorAll('input[name="irregularWinner"]').forEach(G=>G.checked=!1),setTimeout(()=>{typeof N=="function"&&N()},0)}),v.appendChild(b),A.appendChild(v);const y=document.createElement("div");y.style.display="none",y.style.marginTop="0.3em",y.style.paddingLeft="1em",y.style.borderLeft="3px solid #ffeb3b";const I=document.createElement("div");I.textContent="Winner:",I.style.fontSize="0.75em",I.style.fontWeight="500",I.style.marginBottom="0.2em",I.style.color="#444",y.appendChild(I);const w=document.createElement("div");w.style.display="flex",w.style.gap="0.5em";const S=e.sides?.[0],T=e.sides?.[1];[1,2].forEach(G=>{const z=document.createElement("label");z.style.display="flex",z.style.alignItems="center",z.style.gap="0.3em",z.style.cursor="pointer";const Q=document.createElement("input");Q.type="radio",Q.name="irregularWinner",Q.value=G.toString(),Q.addEventListener("change",()=>{d=G,setTimeout(()=>{typeof N=="function"&&N()},0)});const j=document.createElement("span"),W=G===1?S:T;j.textContent=W?.participant?.participantName||`Side ${G}`,j.style.fontSize="0.75em",z.appendChild(Q),z.appendChild(j),w.appendChild(z)}),y.appendChild(w),A.appendChild(y),i.appendChild(A);const D=document.createElement("div");D.style.display="flex",D.style.flexDirection="column",D.style.gap="0.5em",i.appendChild(D);let C=[];const E=()=>{D.innerHTML="",C=[],p.clear(),u=Ld,d=void 0,f=void 0,h=void 0,m=void 0,A.querySelectorAll('input[name="matchOutcome"]').forEach(Q=>Q.checked=!1),A.querySelectorAll('input[name="irregularWinner"]').forEach(Q=>Q.checked=!1),A.style.display="none",y.style.display="none";const G=R(0);D.appendChild(G),G.querySelectorAll("input").forEach(Q=>{Q.addEventListener("input",F),Q.addEventListener("keydown",_)}),P({clearAll:!0}),r({isValid:!1,sets:[],matchUpStatus:"TO_BE_PLAYED"});const z=D.querySelector("input");z&&z.focus()};globalThis.resetDynamicSets=E;const P=G=>{c.innerHTML="";let z;G?.clearAll?(z=void 0,f=void 0):G?.scoreObject?(z=G.scoreObject,f=G.scoreObject):C.length>0?(z={sets:C},f={sets:C}):z=f,G?.clearAll?(h=void 0,m=void 0):(G?.winningSide!==void 0&&(h=G.winningSide),G?.matchUpStatus&&(m=G.matchUpStatus,[iU,AB,rU,gB,vB].includes(m)&&C.length===0&&(z=void 0,f=void 0)));const Q={...e,score:z,winningSide:h,matchUpStatus:m},j=wH().composition||"Australian",W=bN({matchUp:Q,isLucky:!0,composition:wc[j]||wc.Australian});c.appendChild(W)},R=G=>{const z=document.createElement("div");z.className="set-row",z.style.display="flex",z.style.alignItems="center",z.style.gap="0.5em",z.style.marginBottom="0.25em";const Q=document.createElement("div");Q.textContent=`Set ${G+1}:`,Q.style.width="3.5em",Q.style.fontSize="0.9em",Q.style.fontWeight="500",Q.style.color="#444",z.appendChild(Q);const j=document.createElement("input");j.type="text",j.className="input",j.style.width="3em",j.style.textAlign="center",j.placeholder="0",j.dataset.setIndex=G.toString(),j.dataset.side="1";const W=document.createElement("input");W.type="text",W.className="input",W.style.width="3em",W.style.textAlign="center",W.placeholder="0",W.dataset.setIndex=G.toString(),W.dataset.side="2";const Y=document.createElement("span");Y.textContent="-",Y.style.fontWeight="bold",Y.style.color="#666",z.appendChild(j),z.appendChild(Y),z.appendChild(W);const X=document.createElement("span");X.className="tiebreak-container",X.style.display="none",X.style.marginLeft="0.5em";const J=document.createElement("span");J.textContent="(",J.style.color="#666";const ie=document.createElement("input");ie.type="text",ie.className="input tiebreak-input",ie.style.width="2.5em",ie.style.textAlign="center",ie.dataset.setIndex=G.toString(),ie.dataset.type="tiebreak";const ue=document.createElement("span");ue.textContent=")",ue.style.color="#666",X.appendChild(J),X.appendChild(ie),X.appendChild(ue),z.appendChild(X);const ne=document.createElement("span");return ne.className="set-indicator",ne.style.fontSize="1.2em",ne.style.minWidth="1.5em",z.appendChild(ne),z},M=G=>{const z=D.querySelector(`input[data-set-index="${G}"][data-side="1"]`),Q=D.querySelector(`input[data-set-index="${G}"][data-side="2"]`),j=D.querySelector(`input[data-set-index="${G}"][data-type="tiebreak"]`);if(!z||!Q)return!1;const W=z.value.trim(),Y=Q.value.trim();if(W===""||Y==="")return!1;const X=Number.parseInt(W)||0,J=Number.parseInt(Y)||0,ie=j?.value.trim()?Number.parseInt(j.value):void 0;return CRe(G,{side1:X,side2:J,tiebreak:ie},s)},N=()=>{u===Ld&&(y.style.display="none");const G=[];for(let W=0;W<o();W++){const Y=D.querySelector(`input[data-set-index="${W}"][data-side="1"]`),X=D.querySelector(`input[data-set-index="${W}"][data-side="2"]`),J=D.querySelector(`input[data-set-index="${W}"][data-type="tiebreak"]`);if(!Y||!X)break;const ie=Y.value.trim(),ue=X.value.trim();if(ie===""&&ue==="")break;const ne=J?.value.trim(),ge=klt(W,ie,ue,ne,s);G.push(ge)}C=G;const z=D.querySelectorAll(".set-row"),Q=SU(C,o());let j;if(Q){const W=C.filter(Y=>Y.winningSide!==void 0).length;j=Math.max(1,W)}else{const W=C.length-1;W>=0&&C[W].winningSide!==void 0&&C.length<o()?j=C.length+1:j=Math.max(1,C.length)}for(let W=z.length-1;W>=j;W--)z[W].remove();if(C.length>0||u!==Ld){const W=C.some(ie=>ie.winningSide===void 0),Y=(u!==Ld||W?C:C.filter(ie=>ie.winningSide!==void 0)).map(ie=>{if(ie.side1Score===0&&ie.side2Score===0&&(ie.side1TiebreakScore!==void 0||ie.side2TiebreakScore!==void 0)){const ue={side1TiebreakScore:ie.side1TiebreakScore,side2TiebreakScore:ie.side2TiebreakScore};return ie.winningSide!==void 0&&(ue.winningSide=ie.winningSide),ue}else{const ue={side1:ie.side1Score,side2:ie.side2Score};return ie.side1TiebreakScore!==void 0&&(ue.side1TiebreakScore=ie.side1TiebreakScore),ie.side2TiebreakScore!==void 0&&(ue.side2TiebreakScore=ie.side2TiebreakScore),ie.winningSide!==void 0&&(ue.winningSide=ie.winningSide),ue}}),X=Ilt(Y,e.matchUpFormat,u!==Ld),J=X.isValid&&X.winningSide!==void 0;u!==Ld?(A.style.display="block",y.style.display="block"):(y.style.display="none",J?A.style.display="none":A.style.display="block"),u!==Ld&&(d?(X.matchUpStatus=u,X.winningSide=d,X.isValid=!0):u===iU?(X.matchUpStatus=gB,X.isValid=!0):u===rU?(X.matchUpStatus=vB,X.isValid=!0):(X.matchUpStatus=u,X.isValid=!1)),P(X),r(X)}else A.style.display="block",P(),r({isValid:!1,sets:[],matchUpStatus:"TO_BE_PLAYED"})},k=()=>{const G=document.getElementById("clearScoreV2");if(G){const z=D.querySelectorAll(".set-row"),Q=D.querySelector('input[data-set-index="0"][data-side="1"]'),j=D.querySelector('input[data-set-index="0"][data-side="2"]'),W=z.length>1||Q?.value.trim()!==""||j?.value.trim()!=="";G.disabled=!W}},O=G=>{const z=D.querySelector(`input[data-set-index="${G}"][data-side="1"]`),Q=D.querySelector(`input[data-set-index="${G}"][data-side="2"]`),j=D.querySelector(`.set-row:nth-child(${G+1}) .tiebreak-container`),W=D.querySelector(`input[data-set-index="${G}"][data-type="tiebreak"]`);if(!z||!Q||!j)return;const Y=Number.parseInt(z.value)||0,X=Number.parseInt(Q.value)||0;Blt(G,{side1:Y,side2:X},s)?j.style.display="inline":(j.style.display="none",W&&(W.value=""))},x=(G,z)=>{const Q=z==="1"?"2":"1",j=D.querySelector(`input[data-set-index="${G}"][data-side="${Q}"]`),W=D.querySelector(`input[data-set-index="${G}"][data-side="${z}"]`),Y=Number.parseInt(W?.value)||0,X=Number.parseInt(j?.value)||0;return Plt(G,z==="1"?1:2,{side1:z==="1"?Y:X,side2:z==="2"?Y:X},s)},F=G=>{const z=G.target,Q=z.dataset.type==="tiebreak";u!==Ld&&z.value&&(u=Ld,d=void 0,A.querySelectorAll('input[name="matchOutcome"]').forEach(J=>J.checked=!1),y.style.display="none");const j=z.value.replace(/\D/g,"");j!==z.value&&(z.value=j);const W=Number.parseInt(z.dataset.setIndex||"0"),Y=z.dataset.side||"1",X=l(W)?.tiebreakSet?.tiebreakTo!==void 0;if(Q)z.value.length>2&&(z.value=z.value.slice(0,2));else if(X)z.value.length>3&&(z.value=z.value.slice(0,3));else{const J=x(W,Y);(Number.parseInt(z.value)||0)>J&&(z.value=J.toString())}if(!Q&&(O(W),!X)){const J=Y==="1"?"2":"1",ie=D.querySelector(`input[data-set-index="${W}"][data-side="${J}"]`);if(ie?.value.trim()){const ue=Number.parseInt(ie.value)||0,ne=x(W,J);ue>ne&&(ie.value=ne.toString())}}if(N(),k(),M(W)&&!SU(C,o())&&Dlt(C,e.matchUpFormat)){const J=C.length,ie=D.querySelector(`input[data-set-index="${J}"]`);if(J<o()&&!ie){const ue=R(J);D.appendChild(ue),ue.querySelectorAll("input").forEach(ne=>{ne.addEventListener("input",F),ne.addEventListener("keydown",_)}),k()}}},_=G=>{const z=G.target,Q=Number.parseInt(z.dataset.setIndex||"0"),j=z.dataset.side||"1",W=z.dataset.type==="tiebreak",Y=Clt()?.smartComplements===!0;if(j==="1"&&!W){const X=G.code.match(/^Digit(\d)$/);if(X){const J=Number.parseInt(X[1]);if(z.value===""){const ie=G.shiftKey,ue=Nlt(J,ie,Q,C,s,p,Y);if(ue.shouldApply){G.preventDefault(),z.value=ue.field1Value.toString();const ne=D.querySelector(`input[data-set-index="${Q}"][data-side="2"]`);ne&&(ne.value=ue.field2Value.toString()),p.add(Q),z.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>{if(N(),SU(C,o()))return;const ge=D.querySelector(`input[data-set-index="${Q+1}"][data-side="1"]`);if(ge)ge.focus();else if(Q+1<o()){const he=R(Q+1);D.appendChild(he);const Ie=he.querySelectorAll("input");Ie.forEach(Je=>{Je.addEventListener("input",F),Je.addEventListener("keydown",_)});const xe=Ie[0];xe instanceof HTMLInputElement&&xe.focus(),k()}},10);return}}}}if(G.key==="Tab"){if(G.preventDefault(),G.shiftKey){if(W){const X=D.querySelector(`input[data-set-index="${Q}"][data-side="2"]`);X&&X.focus()}else if(j==="2"){const X=D.querySelector(`input[data-set-index="${Q}"][data-side="1"]`);X&&X.focus()}else if(Q>0){const X=D.querySelector(`input[data-set-index="${Q-1}"][data-type="tiebreak"]`),J=D.querySelector(`input[data-set-index="${Q-1}"][data-side="2"]`),ie=X?.closest(".tiebreak-container");X&&ie&&ie.style.display!=="none"?X.focus():J&&J.focus()}}else if(W){const X=D.querySelector(`input[data-set-index="${Q+1}"][data-side="1"]`);if(X)X.focus();else if(Q+1<o()){if(!M(Q)||(N(),SU(C,o())))return;const J=R(Q+1);D.appendChild(J);const ie=J.querySelectorAll("input");ie.forEach(ne=>{ne.addEventListener("input",F),ne.addEventListener("keydown",_)});const ue=ie[0];ue instanceof HTMLInputElement&&ue.focus(),k()}}else if(j==="1"){const X=D.querySelector(`input[data-set-index="${Q}"][data-side="2"]`);X&&X.focus()}else if(j==="2"){N();const X=D.querySelector(`input[data-set-index="${Q}"][data-type="tiebreak"]`),J=X?.closest(".tiebreak-container");if(X&&J&&J.style.display!=="none")X.focus();else{const ie=D.querySelector(`input[data-set-index="${Q+1}"][data-side="1"]`);if(ie)ie.focus();else if(Q+1<o()){if(!M(Q)||SU(C,o()))return;const ue=R(Q+1);D.appendChild(ue);const ne=ue.querySelectorAll("input");ne.forEach(ge=>{ge.addEventListener("input",F),ge.addEventListener("keydown",_)}),ne[0].focus(),k()}}}}if(G.key==="Enter"){const X=document.getElementById("submitScoreV2");X&&!X.disabled&&X.click()}if(G.key==="Backspace"&&z.value===""){if(G.preventDefault(),W){const X=D.querySelector(`input[data-set-index="${Q}"][data-side="2"]`);X&&X.focus()}else if(j==="2"){const X=D.querySelector(`input[data-set-index="${Q}"][data-side="1"]`);X&&X.focus()}else if(Q>0){const X=D.querySelector(`input[data-set-index="${Q-1}"][data-type="tiebreak"]`),J=D.querySelector(`input[data-set-index="${Q-1}"][data-side="2"]`),ie=X?.closest(".tiebreak-container");X&&ie&&ie.style.display!=="none"?X.focus():J&&J.focus()}}},V=R(0);if(D.appendChild(V),V.querySelectorAll("input").forEach(G=>{G.addEventListener("input",F),G.addEventListener("keydown",_)}),f?.sets&&f.sets.length>0){const G=Math.ceil(o()/2);let z=0,Q=0,j=!1;f.sets.forEach((W,Y)=>{if(j)return;if(Y>0){const ue=R(Y);D.appendChild(ue),ue.querySelectorAll("input").forEach(ne=>{ne.addEventListener("input",F),ne.addEventListener("keydown",_)})}const X=D.querySelector(`input[data-set-index="${Y}"][data-side="1"]`),J=D.querySelector(`input[data-set-index="${Y}"][data-side="2"]`),ie=D.querySelector(`input[data-set-index="${Y}"][data-type="tiebreak"]`);X&&J&&(X.value=W.side1Score?.toString()||"",J.value=W.side2Score?.toString()||"",O(Y),ie&&(W.side1TiebreakScore!==void 0||W.side2TiebreakScore!==void 0)&&(W.winningSide===1&&W.side2TiebreakScore!==void 0?ie.value=W.side2TiebreakScore.toString():W.winningSide===2&&W.side1TiebreakScore!==void 0||W.side1TiebreakScore!==void 0?ie.value=W.side1TiebreakScore.toString():W.side2TiebreakScore!==void 0&&(ie.value=W.side2TiebreakScore.toString()))),W.winningSide===1&&z++,W.winningSide===2&&Q++,j=z>=G||Q>=G})}else P();e.matchUpStatus&&e.matchUpStatus!==Ld&&[AB,iU,rU,gB,vB].includes(e.matchUpStatus)&&(e.matchUpStatus===gB?(u=iU,d=void 0):e.matchUpStatus===vB?(u=rU,d=void 0):(u=e.matchUpStatus,d=e.winningSide),A.querySelectorAll('input[name="matchOutcome"]').forEach(G=>{G.value===u&&(G.checked=!0)}),d&&(A.querySelectorAll('input[name="irregularWinner"]').forEach(G=>{Number.parseInt(G.value)===d&&(G.checked=!0)}),y.style.display="block")),f?.sets&&f.sets.length>0?N():u!==Ld?P():(A.style.display="none",y.style.display="none"),setTimeout(()=>{const G=D.querySelector("input");G&&G.focus()},100)}function Mre(t,e){const{matchUpFormat:i}=e;if(!t)return"";const r=au.parse(i),n=r?.setFormat?.bestOf||3,a=u=>u===n&&r?.finalSetFormat?r.finalSetFormat:r?.setFormat;let s="",o=0,l=0;const c=t.split(/[\s/]+|--+/).filter(u=>u.length>0);for(const u of c){o=0;const d=u;for(;o<d.length&&l<n&&!(l>=n);){const p=a(l+1),f=p?.tiebreakSet?.tiebreakTo,h=p?.setTo,m=!!f&&!h,A=p?.timed===!0,g=A?999:f||h||6,v=p?.tiebreakAt||g;let b="",y="",I="";for(;o<d.length;){const N=d[o];if(N==="-"){o++;break}if(m||A){b+=N,o++;continue}const k=b+N,O=Number.parseInt(k),x=A?999:g+1;if(O>x||b.length>0&&b.length>=2)break;b+=N,o++;const F=Number.parseInt(b);if(b.length===1&&F!==1&&x<10){if(o<d.length&&d[o]==="-")continue;break}}for(;o<d.length;){const N=d[o];if(N==="-"){if(A&&y.length>0){o++;break}break}if(m||A){y+=N,o++;continue}const k=y+N,O=Number.parseInt(k),x=A?999:g+1;if(O>g+3||y.length>0&&y.length>=2)break;y+=N,o++;const F=Number.parseInt(y);if(y.length===1&&F!==1&&x<10)break}if(!y){s&&(s+=" "),s+=b;break}let w=Number.parseInt(b),S=Number.parseInt(y),T=!1;!m&&!A&&(w>g+1&&(w=g,b=g.toString(),T=!0),S>g+1&&(S=g,y=g.toString(),T=!0),w===g+1&&S<g-1?(w=g,b=g.toString(),T=!0):S===g+1&&w<g-1&&(S=g,y=g.toString(),T=!0));const D=Math.abs(w-S),C=Math.max(w,S),E=A||C>=g&&D>=2,P=o<d.length,R=w===v&&S===v,M=w===v+1&&S===v||S===v+1&&w===v;if(!T&&(R||M&&P)){for(;o<d.length;){const N=d[o];if(N==="-"){o++;break}I+=N,o++}s&&(s+=" "),I?(s+=`${b}-${y}(${I})`,l++):s+=`${b}-${y}(`}else if(s&&(s+=" "),m?s+=`[${b}-${y}]`:s+=`${b}-${y}`,E)l++;else if(o<d.length)break}}return s}const{COMPLETED:HA,RETIRED:wG,WALKOVER:oD,DEFAULTED:lD,DOUBLE_WALKOVER:SG,DOUBLE_DEFAULT:UG}=jh;function _lt(t){if(!t?.sets||t.sets.length===0)return"";const e=[];return t.sets.forEach((i,r)=>{if(r>0&&e.push(" "),e.push(i.side1Score?.toString()||"0"),e.push(i.side2Score?.toString()||"0"),i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0){const n=i.winningSide===1?i.side2TiebreakScore:i.side1TiebreakScore;n!==void 0&&(e.push("-"),e.push(n.toString()))}}),e.join("")}function ERe(t){const{matchUp:e,container:i,onScoreChange:r}=t;try{i.innerHTML="",i.style.display="flex",i.style.flexDirection="column",i.style.gap="1em";const n=au.parse(e.matchUpFormat||"SET3-S:6/TB7"),a=n?.setFormat?.setTo||6,s=n?.setFormat?.tiebreakAt||a;let o=e.score?{...e.score}:void 0,l=e.winningSide,c=e.matchUpStatus;const u={digits:"",setTo:a,tiebreakAt:s,isMatchComplete:!1};if(o){u.digits=_lt(o);const x=Mre(u.digits,{matchUpFormat:e.matchUpFormat||"SET3-S:6/TB7"});if(x&&x.includes("-")){const F=dI(x,e.matchUpFormat);u.isMatchComplete=F.isValid&&F.winningSide!==void 0&&(F.matchUpStatus===HA||F.matchUpStatus===void 0)}}const d=document.createElement("div");if(d.style.marginBottom="0.5em",i.appendChild(d),n?.setFormat?.based==="A"||n?.finalSetFormat?.based==="A"){const x=document.createElement("div");x.style.fontSize="0.75em",x.style.color="#666",x.style.marginTop="0.25em",x.style.marginBottom="0.5em",x.style.padding="0.25em 0.5em",x.style.backgroundColor="#fff3cd",x.style.border="1px solid #ffc107",x.style.borderRadius="3px",x.textContent=" Aggregate Scoring: Winner determined by total points across all sets",i.appendChild(x)}if(e.matchUpFormat){const x=document.createElement("div");x.style.fontSize="0.9em",x.style.marginBottom="0.5em",x.style.display="flex",x.style.alignItems="center",x.style.gap="0.5em";const F=document.createElement("span");F.textContent="Format:",F.style.color="#666",x.appendChild(F);const _=document.createElement("button");_.textContent=e.matchUpFormat,_.className="button is-small is-white",_.style.fontSize="0.75em",_.style.padding="0.2em 0.5em",_.style.cursor="pointer",_.title="Click to edit format",_.addEventListener("click",async()=>{try{const{getMatchUpFormatModal:V}=await Promise.resolve().then(()=>zX);V({existingMatchUpFormat:e.matchUpFormat,callback:G=>{G&&G!==e.matchUpFormat&&(e.matchUpFormat=G,_.textContent=G,u.digits="",i.innerHTML="",ERe({matchUp:e,container:i,onScoreChange:r}))},modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})}catch(V){console.error("Error opening format selector:",V)}}),x.appendChild(_),i.appendChild(x)}const p=document.createElement("div");p.style.fontSize="1.2em",p.style.color="#64B5F6",p.style.textAlign="center",p.style.padding="0.25em 0.5em",p.style.fontWeight="bold",p.style.minHeight="1.5em",p.style.maxWidth="300px",p.style.margin="0 auto",p.textContent="-",i.appendChild(p);let f=HA,h;const m=document.createElement("div");m.style.display="none",m.style.marginBottom="0.8em",m.style.padding="0.6em",m.style.backgroundColor="#fff3cd",m.style.border="2px solid #ffc107",m.style.borderRadius="4px";const A=document.createElement("div");A.textContent="Irregular Ending:",A.style.fontSize="0.8em",A.style.fontWeight="600",A.style.marginBottom="0.3em",A.style.color="#856404",m.appendChild(A);const g=document.createElement("div");g.style.display="none",g.style.marginTop="0.3em";const v=document.createElement("div");v.textContent="Winner:",v.style.fontSize="0.75em",v.style.fontWeight="500",v.style.marginBottom="0.2em",v.style.color="#856404",g.appendChild(v);const b=document.createElement("div");b.style.display="flex",b.style.gap="0.5em",b.style.flexWrap="wrap";const y=e.sides?.[0],I=e.sides?.[1];[1,2].forEach(x=>{const F=document.createElement("label");F.style.display="flex",F.style.alignItems="center",F.style.gap="0.3em",F.style.cursor="pointer";const _=document.createElement("input");_.type="radio",_.name="irregularWinner",_.value=x.toString(),_.addEventListener("change",()=>{_.checked&&(h=x,D())});const V=document.createElement("span"),G=x===1?y:I;V.textContent=G?.participant?.participantName||`Side ${x}`,V.style.fontSize="0.75em",V.style.color="#856404",F.appendChild(_),F.appendChild(V),b.appendChild(F)}),g.appendChild(b),m.appendChild(g),i.appendChild(m);const w=document.createElement("div");w.style.display="grid",w.style.gridTemplateColumns="repeat(4, 1fr)",w.style.gap="8px",w.style.width="100%",w.style.maxWidth="320px",w.style.margin="0 auto",i.appendChild(w);const S=x=>Mre(x,{matchUpFormat:e.matchUpFormat||"SET3-S:6/TB7"}),T=x=>{d.innerHTML="";const F=x?.scoreObject?.sets?.length>0;x?.clearAll?(o=void 0,l=void 0,c=void 0):x!=null&&(F&&(o=x?.scoreObject),"winningSide"in x&&(l=x?.winningSide),"matchUpStatus"in x&&(c=x?.matchUpStatus));const _={...e,score:x?.clearAll?void 0:F?o:void 0,winningSide:l,matchUpStatus:c},V=wH().composition||"Australian",G=bN({matchUp:_,isLucky:!0,composition:wc[V]||wc.Australian});G&&d.appendChild(G)},D=(x=!1)=>{const F=S(u.digits);if(F?(p.style.display="block",p.textContent=F):(p.style.display="block",p.textContent="-"),f===wG||f===oD||f===lD?(m.style.display="block",g.style.display="block"):(m.style.display="none",g.style.display="none"),x){T({clearAll:!0});return}let _=dI(F,e.matchUpFormat);u.isMatchComplete=_.isValid&&_.winningSide!==void 0&&(_.matchUpStatus===HA||_.matchUpStatus===void 0),f!==HA&&(h?(_.matchUpStatus=f,_.winningSide=h,_.isValid=!0):f===oD?(_.matchUpStatus=SG,_.isValid=!0):f===lD?(_.matchUpStatus=UG,_.isValid=!0):(_.matchUpStatus=f,_.isValid=!1),u.isMatchComplete=!1),T(_),r(_);const V=document.getElementById("clearScoreV2");V&&(V.disabled=u.digits.length===0&&f===HA),R(),M()},C=x=>{f!==HA&&typeof x=="number"&&(f=HA,h=void 0,m.querySelectorAll('input[name="matchOutcome"]').forEach(ge=>ge.checked=!1),g.style.display="none"),typeof x=="number"&&u.digits===""&&x>a&&(x=a);const F=S(u.digits),_=F.includes("(")&&!F.includes(")"),V=u.digits.includes("-"),G=(u.digits.match(/-/g)||[]).length,z=F.includes("[")&&V&&G===1,Q=(F?dI(F,e.matchUpFormat):null)?.sets?.length||0,j=au.parse(e.matchUpFormat),W=j?.setFormat?.bestOf||3,Y=ge=>{const he=ge===W&&j?.finalSetFormat?j.finalSetFormat:j?.setFormat,Ie=he?.tiebreakSet?.tiebreakTo,xe=he?.setTo;return!!Ie&&!xe},X=Q<W&&Y(Q+1),J=Q>0&&Y(Q),ie=_||z||X||J,ue=x==="-"?u.digits+"-":u.digits+x.toString(),ne=S(ue);if(F){const ge=dI(F,e.matchUpFormat),he=ge.sets?.[ge.sets.length-1],Ie=F.includes("("),xe=ne.includes("("),Je=Ie&&xe&&ne!==F&&ne.startsWith(F.substring(0,F.lastIndexOf(")"))),qe=he&&(he.side1TiebreakScore===void 0&&he.side2TiebreakScore===void 0||he.side1TiebreakScore==null&&he.side2TiebreakScore==null||Je)&&he.side1Score!==void 0&&he.side2Score!==void 0&&(he.side1Score===he.side2Score||Math.abs(he.side1Score-he.side2Score)===1);if(ge.isValid&&ge.winningSide&&!ie&&!qe||!ie&&x!=="-"&&ne===F)return}x==="-"?u.digits.endsWith("-")||(u.digits+="-"):u.digits+=x.toString(),D()},E=()=>{u.digits.length>0&&(u.digits=u.digits.slice(0,-1),D())},P=()=>{u.digits="",u.isMatchComplete=!1,f=HA,h=void 0,o=void 0,l=void 0,c=void 0,m.querySelectorAll('input[name="irregularWinner"]').forEach(x=>x.checked=!1),m.querySelectorAll('input[name="matchOutcome"]').forEach(x=>x.checked=!1),m.style.display="none",g.style.display="none",p.style.display="block",p.textContent="-",T({clearAll:!0}),M(),r({isValid:!1,sets:[],matchUpStatus:"TO_BE_PLAYED"})};globalThis.resetDialPad=P;const R=()=>{const x=w.querySelector('[data-button="retired"]'),F=w.querySelector('[data-button="defaulted"]'),_=S(u.digits),V=!(_.includes("-")&&_.length>2)||u.isMatchComplete;x&&(x.disabled=V),F&&(F.disabled=V)},M=()=>{const x=f!==HA&&h!==void 0||u.isMatchComplete;w.querySelectorAll("button").forEach(F=>{const _=F.textContent||"";(_.match(/^[0-9]$/)||_==="-")&&(F.disabled=x)})};[{label:"1",value:1},{label:"2",value:2},{label:"3",value:3},{label:"RET",value:"retired",isSpecial:!0,requiresScore:!0},{label:"4",value:4},{label:"5",value:5},{label:"6",value:6},{label:"WO",value:"walkover",isSpecial:!0},{label:"7",value:7},{label:"8",value:8},{label:"9",value:9},{label:"DEF",value:"defaulted",isSpecial:!0,requiresScore:!0},{label:"",value:"delete",isSpecial:!0},{label:"0",value:0},{label:"-",value:"minus",isSpecial:!0},{label:"",value:"empty",isSpecial:!0,disabled:!0}].forEach(x=>{const F=document.createElement("button");F.className="button is-white",F.textContent=x.label,F.style.cssText=`
        height: 55px !important;
        width: 100% !important;
        padding: 0.5em !important;
        color: #000 !important;
        border: 1px solid #dbdbdb !important;
      `,x.label.length>1&&!x.isSpecial?F.style.fontSize="1.3em":x.isSpecial&&["RET","WO","DEF"].includes(x.label)?(F.style.fontSize="0.95em",F.style.backgroundColor="#ffe0b2"):x.isSpecial?(F.style.fontSize="1.3em",F.style.backgroundColor="#f0f0f0"):F.style.fontSize="1.3em",(x.value==="retired"||x.value==="defaulted")&&(F.dataset.button=x.value),x.disabled&&(F.disabled=!0,F.style.visibility="hidden"),x.requiresScore&&(F.disabled=!0),F.onclick=()=>{x.value==="delete"?E():x.value==="minus"?C("-"):x.value==="retired"?(f=wG,h=void 0,m.querySelectorAll('input[name="irregularWinner"]').forEach(_=>_.checked=!1),D()):x.value==="walkover"?(f=oD,h=void 0,u.digits="",m.querySelectorAll('input[name="irregularWinner"]').forEach(_=>_.checked=!1),D(),M()):x.value==="defaulted"?(f=lD,h=void 0,m.querySelectorAll('input[name="irregularWinner"]').forEach(_=>_.checked=!1),D()):x.value==="empty"||C(x.value)},w.appendChild(F)});const N=x=>{if(x.key>="0"&&x.key<="9")x.preventDefault(),C(Number.parseInt(x.key));else if(x.key==="Backspace"||x.key==="Delete")x.preventDefault(),E();else if(x.key==="-"||x.key===" "||x.key==="/")x.preventDefault(),C("-");else if(x.key===")"){x.preventDefault();const F=S(u.digits);F.includes("(")&&!F.includes(")")&&(u.digits+="-",D())}};i.setAttribute("tabindex","-1"),i.style.outline="none",i.addEventListener("keydown",N),setTimeout(()=>i.focus(),100);const k=()=>{i.removeEventListener("keydown",N)};globalThis.cleanupDialPad=k;const O=c===wG||c===oD||c===lD||c===SG||c===UG;O?(c===SG?(f=oD,h=void 0):c===UG?(f=lD,h=void 0):(f=c,h=l),m.querySelectorAll('input[name="matchOutcome"]').forEach(x=>{x.value===f&&(x.checked=!0)}),h&&(m.querySelectorAll('input[name="irregularWinner"]').forEach(x=>{Number.parseInt(x.value)===h&&(x.checked=!0)}),g.style.display="block")):!o&&(!c||c==="TO_BE_PLAYED")&&P(),u.digits||O?(D(),setTimeout(()=>{const x=document.getElementById("clearScoreV2");x&&(x.disabled=!1),M()},0)):(T(null),M())}catch(n){console.error("Error rendering dial pad:",n),i.innerHTML=`<p style="color: red;">Error: ${n instanceof Error?n.message:"Unknown error"}</p>`}}function Olt(t){const{matchUp:e,callback:i}=t,r=wH().scoringApproach||"dynamicSets",n=document.createElement("div");n.style.padding="1em";const a=!!(e.score?.sets?.length||e.matchUpStatus);let s=null,o=!1;const l=u=>{s=u,o&&(u.sets?.length>0||u.score)&&(o=!1);const d=document.getElementById("submitScoreV2");if(d){const f=u.isValid||o&&a;d.disabled=!f}const p=document.getElementById("clearScoreV2");if(p){const f=document.getElementById("scoreInputV2");if(f)p.disabled=!f.value.trim();else{const h=u.sets&&u.sets.length>0,m=u.matchUpStatus&&u.matchUpStatus!=="COMPLETED"&&u.matchUpStatus!=="TO_BE_PLAYED",A=h||m;p.disabled=!A}}},c=()=>{window.cleanupDialPad&&(window.cleanupDialPad(),window.cleanupDialPad=void 0),window.resetDialPad&&(window.resetDialPad=void 0),window.resetDynamicSets&&(window.resetDynamicSets=void 0)};r==="freeScore"?Elt({matchUp:e,container:n,onScoreChange:l}):r==="dynamicSets"?xlt({matchUp:e,container:n,onScoreChange:l}):r==="dialPad"?ERe({matchUp:e,container:n,onScoreChange:l}):n.innerHTML="<p>Unknown scoring approach...</p>",pf.open({title:"Score Entry",content:n,config:r==="freeScore"?{info:`
    <strong>Score Entry Tips:</strong><br><br>
    <strong>Set Scores:</strong> Enter space or dash-separated (e.g., "6-4 6-3")<br><br>
    <strong>Tiebreaks:</strong> Auto-detected from digits (e.g., "67 3" becomes "6-7(3)")<br><br>
    <strong>Match Tiebreaks:</strong> Use dash separator (e.g., "10-7")<br><br>
    <strong>Irregular Endings:</strong><br>
    <strong>r</strong> = Retired<br>
    <strong>w</strong> = Walkover<br>
    <strong>d</strong> = Defaulted<br>
    <strong>s</strong> = Suspended<br>
    <strong>c</strong> = Cancelled<br>
    <strong>a</strong> = Awaiting Result<br>
    <strong>in</strong> = In Progress<br>
    <strong>inc</strong> = Incomplete<br>
    <strong>dr</strong> = Dead Rubber
  `}:void 0,buttons:[{onClick:()=>{c()},label:"Cancel",intent:"none",footer:{className:"button",style:"background-color: white; color: #363636; border: 1px solid #dbdbdb;"},close:!0},{id:"clearScoreV2",label:"Clear",intent:"none",disabled:!0,close:!1,onClick:()=>{if(o=!0,r==="freeScore"){const u=document.getElementById("scoreInputV2");u&&(u.value="",u.dispatchEvent(new Event("input",{bubbles:!0})),u.focus())}else r==="dynamicSets"&&window.resetDynamicSets?window.resetDynamicSets():r==="dialPad"&&window.resetDialPad&&window.resetDialPad()}},{id:"submitScoreV2",label:"Submit Score",intent:"is-primary",disabled:!0,onClick:()=>{s&&(s.isValid||o&&a)&&(c(),i(s))},close:!0}]}),setTimeout(()=>{const u=document.getElementById("clearScoreV2");u&&(u.style.backgroundColor="#ffeb3b",u.style.color="#333",a&&(u.disabled=!1),s&&l(s))},0)}function Flt(t,e,i){if(!t)return{};const r=document.createElement("aside");r.classList.add("menu");const n={},a=d=>p=>{p.stopPropagation(),d.onClick()};let s=0;const o=()=>(s+=1,s),l=d=>d?.heading||d?.text||d?.label||`Item ${o()}`,c=d=>{const p=document.createElement("li");if(p.className="font-medium",d.style&&(p.style.cssText=d.style),d.onClick){const f=d.fontSize||"1em";if(d.divider){const h=document.createElement("hr");h.classList.add("dropdown-divider"),p.appendChild(h)}else{const h=document.createElement("a"),m=d.disabled?"0.4":"1";h.style.cssText=`text-decoration: none; opacity: ${m}; font-size: ${f}`,d.class&&h.classList.add(d.class),d.color&&(h.style.color=d.color),d.heading&&(h.style.fontWeight="bold"),d.disabled||(h.onclick=a(d)),h.innerHTML=l(d),p.appendChild(h)}}else p.innerHTML=l(d),d.disabled||(p.onclick=d.onClick);return p};let u;for(const d of e||[])if(!d.hide){if(d.items){if(d.text){const f=document.createElement("p");f.className="menu-label font-medium",f.innerHTML=d.text,r.appendChild(f)}const p=document.createElement("ul");p.className="menu-list";for(const f of d.items)f.hide||p.appendChild(c(f));r.appendChild(p)}else if(d.type==="input"){const{field:p,inputElement:f}=d0(d);d.focus&&(u=f),n[d.field]=f,r.appendChild(p)}else if(d.type==="divider"){const p=document.createElement("hr");p.classList.add("dropdown-divider"),r.appendChild(p)}}return t.appendChild(r),{focusElement:u}}var pd="top",If="bottom",wf="right",fd="left",YX="auto",wN=[pd,If,wf,fd],oC="start",l1="end",Llt="clippingParents",DRe="viewport",cD="popper",$lt="reference",Nre=wN.reduce(function(t,e){return t.concat([e+"-"+oC,e+"-"+l1])},[]),PRe=[].concat(wN,[YX]).reduce(function(t,e){return t.concat([e,e+"-"+oC,e+"-"+l1])},[]),Hlt="beforeRead",Vlt="read",Glt="afterRead",Qlt="beforeMain",jlt="main",zlt="afterMain",qlt="beforeWrite",Wlt="write",Klt="afterWrite",Ylt=[Hlt,Vlt,Glt,Qlt,jlt,zlt,qlt,Wlt,Klt];function eA(t){return t?(t.nodeName||"").toLowerCase():null}function dp(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function fw(t){var e=dp(t).Element;return t instanceof e||t instanceof Element}function Zp(t){var e=dp(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function XX(t){if(typeof ShadowRoot>"u")return!1;var e=dp(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function Xlt(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var r=e.styles[i]||{},n=e.attributes[i]||{},a=e.elements[i];!Zp(a)||!eA(a)||(Object.assign(a.style,r),Object.keys(n).forEach(function(s){var o=n[s];o===!1?a.removeAttribute(s):a.setAttribute(s,o===!0?"":o)}))})}function Zlt(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(r){var n=e.elements[r],a=e.attributes[r]||{},s=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:i[r]),o=s.reduce(function(l,c){return l[c]="",l},{});!Zp(n)||!eA(n)||(Object.assign(n.style,o),Object.keys(a).forEach(function(l){n.removeAttribute(l)}))})}}const RRe={name:"applyStyles",enabled:!0,phase:"write",fn:Xlt,effect:Zlt,requires:["computeStyles"]};function Cm(t){return t.split("-")[0]}var kI=Math.max,tO=Math.min,lC=Math.round;function b3(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function MRe(){return!/^((?!chrome|android).)*safari/i.test(b3())}function cC(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var r=t.getBoundingClientRect(),n=1,a=1;e&&Zp(t)&&(n=t.offsetWidth>0&&lC(r.width)/t.offsetWidth||1,a=t.offsetHeight>0&&lC(r.height)/t.offsetHeight||1);var s=fw(t)?dp(t):window,o=s.visualViewport,l=!MRe()&&i,c=(r.left+(l&&o?o.offsetLeft:0))/n,u=(r.top+(l&&o?o.offsetTop:0))/a,d=r.width/n,p=r.height/a;return{width:d,height:p,top:u,right:c+d,bottom:u+p,left:c,x:c,y:u}}function ZX(t){var e=cC(t),i=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:r}}function NRe(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&XX(i)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Rg(t){return dp(t).getComputedStyle(t)}function Jlt(t){return["table","td","th"].indexOf(eA(t))>=0}function Mb(t){return((fw(t)?t.ownerDocument:t.document)||window.document).documentElement}function UH(t){return eA(t)==="html"?t:t.assignedSlot||t.parentNode||(XX(t)?t.host:null)||Mb(t)}function Bre(t){return!Zp(t)||Rg(t).position==="fixed"?null:t.offsetParent}function ect(t){var e=/firefox/i.test(b3()),i=/Trident/i.test(b3());if(i&&Zp(t)){var r=Rg(t);if(r.position==="fixed")return null}var n=UH(t);for(XX(n)&&(n=n.host);Zp(n)&&["html","body"].indexOf(eA(n))<0;){var a=Rg(n);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return n;n=n.parentNode}return null}function SN(t){for(var e=dp(t),i=Bre(t);i&&Jlt(i)&&Rg(i).position==="static";)i=Bre(i);return i&&(eA(i)==="html"||eA(i)==="body"&&Rg(i).position==="static")?e:i||ect(t)||e}function JX(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function T0(t,e,i){return kI(t,tO(e,i))}function tct(t,e,i){var r=T0(t,e,i);return r>i?i:r}function BRe(){return{top:0,right:0,bottom:0,left:0}}function kRe(t){return Object.assign({},BRe(),t)}function xRe(t,e){return e.reduce(function(i,r){return i[r]=t,i},{})}var ict=function(t,e){return t=typeof t=="function"?t(Object.assign({},e.rects,{placement:e.placement})):t,kRe(typeof t!="number"?t:xRe(t,wN))};function rct(t){var e,i=t.state,r=t.name,n=t.options,a=i.elements.arrow,s=i.modifiersData.popperOffsets,o=Cm(i.placement),l=JX(o),c=[fd,wf].indexOf(o)>=0,u=c?"height":"width";if(!(!a||!s)){var d=ict(n.padding,i),p=ZX(a),f=l==="y"?pd:fd,h=l==="y"?If:wf,m=i.rects.reference[u]+i.rects.reference[l]-s[l]-i.rects.popper[u],A=s[l]-i.rects.reference[l],g=SN(a),v=g?l==="y"?g.clientHeight||0:g.clientWidth||0:0,b=m/2-A/2,y=d[f],I=v-p[u]-d[h],w=v/2-p[u]/2+b,S=T0(y,w,I),T=l;i.modifiersData[r]=(e={},e[T]=S,e.centerOffset=S-w,e)}}function nct(t){var e=t.state,i=t.options,r=i.element,n=r===void 0?"[data-popper-arrow]":r;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||NRe(e.elements.popper,n)&&(e.elements.arrow=n))}const act={name:"arrow",enabled:!0,phase:"main",fn:rct,effect:nct,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function uC(t){return t.split("-")[1]}var sct={top:"auto",right:"auto",bottom:"auto",left:"auto"};function oct(t,e){var i=t.x,r=t.y,n=e.devicePixelRatio||1;return{x:lC(i*n)/n||0,y:lC(r*n)/n||0}}function kre(t){var e,i=t.popper,r=t.popperRect,n=t.placement,a=t.variation,s=t.offsets,o=t.position,l=t.gpuAcceleration,c=t.adaptive,u=t.roundOffsets,d=t.isFixed,p=s.x,f=p===void 0?0:p,h=s.y,m=h===void 0?0:h,A=typeof u=="function"?u({x:f,y:m}):{x:f,y:m};f=A.x,m=A.y;var g=s.hasOwnProperty("x"),v=s.hasOwnProperty("y"),b=fd,y=pd,I=window;if(c){var w=SN(i),S="clientHeight",T="clientWidth";if(w===dp(i)&&(w=Mb(i),Rg(w).position!=="static"&&o==="absolute"&&(S="scrollHeight",T="scrollWidth")),w=w,n===pd||(n===fd||n===wf)&&a===l1){y=If;var D=d&&w===I&&I.visualViewport?I.visualViewport.height:w[S];m-=D-r.height,m*=l?1:-1}if(n===fd||(n===pd||n===If)&&a===l1){b=wf;var C=d&&w===I&&I.visualViewport?I.visualViewport.width:w[T];f-=C-r.width,f*=l?1:-1}}var E=Object.assign({position:o},c&&sct),P=u===!0?oct({x:f,y:m},dp(i)):{x:f,y:m};if(f=P.x,m=P.y,l){var R;return Object.assign({},E,(R={},R[y]=v?"0":"",R[b]=g?"0":"",R.transform=(I.devicePixelRatio||1)<=1?"translate("+f+"px, "+m+"px)":"translate3d("+f+"px, "+m+"px, 0)",R))}return Object.assign({},E,(e={},e[y]=v?m+"px":"",e[b]=g?f+"px":"",e.transform="",e))}function lct(t){var e=t.state,i=t.options,r=i.gpuAcceleration,n=r===void 0?!0:r,a=i.adaptive,s=a===void 0?!0:a,o=i.roundOffsets,l=o===void 0?!0:o,c={placement:Cm(e.placement),variation:uC(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,kre(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,kre(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const cct={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:lct,data:{}};var yB={passive:!0};function uct(t){var e=t.state,i=t.instance,r=t.options,n=r.scroll,a=n===void 0?!0:n,s=r.resize,o=s===void 0?!0:s,l=dp(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&c.forEach(function(u){u.addEventListener("scroll",i.update,yB)}),o&&l.addEventListener("resize",i.update,yB),function(){a&&c.forEach(function(u){u.removeEventListener("scroll",i.update,yB)}),o&&l.removeEventListener("resize",i.update,yB)}}const dct={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:uct,data:{}};var pct={left:"right",right:"left",bottom:"top",top:"bottom"};function rx(t){return t.replace(/left|right|bottom|top/g,function(e){return pct[e]})}var fct={start:"end",end:"start"};function xre(t){return t.replace(/start|end/g,function(e){return fct[e]})}function eZ(t){var e=dp(t),i=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:i,scrollTop:r}}function tZ(t){return cC(Mb(t)).left+eZ(t).scrollLeft}function hct(t,e){var i=dp(t),r=Mb(t),n=i.visualViewport,a=r.clientWidth,s=r.clientHeight,o=0,l=0;if(n){a=n.width,s=n.height;var c=MRe();(c||!c&&e==="fixed")&&(o=n.offsetLeft,l=n.offsetTop)}return{width:a,height:s,x:o+tZ(t),y:l}}function mct(t){var e,i=Mb(t),r=eZ(t),n=(e=t.ownerDocument)==null?void 0:e.body,a=kI(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),s=kI(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),o=-r.scrollLeft+tZ(t),l=-r.scrollTop;return Rg(n||i).direction==="rtl"&&(o+=kI(i.clientWidth,n?n.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}function iZ(t){var e=Rg(t),i=e.overflow,r=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+r)}function _Re(t){return["html","body","#document"].indexOf(eA(t))>=0?t.ownerDocument.body:Zp(t)&&iZ(t)?t:_Re(UH(t))}function C0(t,e){var i;e===void 0&&(e=[]);var r=_Re(t),n=r===((i=t.ownerDocument)==null?void 0:i.body),a=dp(r),s=n?[a].concat(a.visualViewport||[],iZ(r)?r:[]):r,o=e.concat(s);return n?o:o.concat(C0(UH(s)))}function I3(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function Act(t,e){var i=cC(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function _re(t,e,i){return e===DRe?I3(hct(t,i)):fw(e)?Act(e,i):I3(mct(Mb(t)))}function gct(t){var e=C0(UH(t)),i=["absolute","fixed"].indexOf(Rg(t).position)>=0,r=i&&Zp(t)?SN(t):t;return fw(r)?e.filter(function(n){return fw(n)&&NRe(n,r)&&eA(n)!=="body"}):[]}function vct(t,e,i,r){var n=e==="clippingParents"?gct(t):[].concat(e),a=[].concat(n,[i]),s=a[0],o=a.reduce(function(l,c){var u=_re(t,c,r);return l.top=kI(u.top,l.top),l.right=tO(u.right,l.right),l.bottom=tO(u.bottom,l.bottom),l.left=kI(u.left,l.left),l},_re(t,s,r));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function ORe(t){var e=t.reference,i=t.element,r=t.placement,n=r?Cm(r):null,a=r?uC(r):null,s=e.x+e.width/2-i.width/2,o=e.y+e.height/2-i.height/2,l;switch(n){case pd:l={x:s,y:e.y-i.height};break;case If:l={x:s,y:e.y+e.height};break;case wf:l={x:e.x+e.width,y:o};break;case fd:l={x:e.x-i.width,y:o};break;default:l={x:e.x,y:e.y}}var c=n?JX(n):null;if(c!=null){var u=c==="y"?"height":"width";switch(a){case oC:l[c]=l[c]-(e[u]/2-i[u]/2);break;case l1:l[c]=l[c]+(e[u]/2-i[u]/2);break}}return l}function c1(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=r===void 0?t.placement:r,a=i.strategy,s=a===void 0?t.strategy:a,o=i.boundary,l=o===void 0?Llt:o,c=i.rootBoundary,u=c===void 0?DRe:c,d=i.elementContext,p=d===void 0?cD:d,f=i.altBoundary,h=f===void 0?!1:f,m=i.padding,A=m===void 0?0:m,g=kRe(typeof A!="number"?A:xRe(A,wN)),v=p===cD?$lt:cD,b=t.rects.popper,y=t.elements[h?v:p],I=vct(fw(y)?y:y.contextElement||Mb(t.elements.popper),l,u,s),w=cC(t.elements.reference),S=ORe({reference:w,element:b,placement:n}),T=I3(Object.assign({},b,S)),D=p===cD?T:w,C={top:I.top-D.top+g.top,bottom:D.bottom-I.bottom+g.bottom,left:I.left-D.left+g.left,right:D.right-I.right+g.right},E=t.modifiersData.offset;if(p===cD&&E){var P=E[n];Object.keys(C).forEach(function(R){var M=[wf,If].indexOf(R)>=0?1:-1,N=[pd,If].indexOf(R)>=0?"y":"x";C[R]+=P[N]*M})}return C}function yct(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=i.boundary,a=i.rootBoundary,s=i.padding,o=i.flipVariations,l=i.allowedAutoPlacements,c=l===void 0?PRe:l,u=uC(r),d=u?o?Nre:Nre.filter(function(h){return uC(h)===u}):wN,p=d.filter(function(h){return c.indexOf(h)>=0});p.length===0&&(p=d);var f=p.reduce(function(h,m){return h[m]=c1(t,{placement:m,boundary:n,rootBoundary:a,padding:s})[Cm(m)],h},{});return Object.keys(f).sort(function(h,m){return f[h]-f[m]})}function bct(t){if(Cm(t)===YX)return[];var e=rx(t);return[xre(t),e,xre(e)]}function Ict(t){var e=t.state,i=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!0:s,l=i.fallbackPlacements,c=i.padding,u=i.boundary,d=i.rootBoundary,p=i.altBoundary,f=i.flipVariations,h=f===void 0?!0:f,m=i.allowedAutoPlacements,A=e.options.placement,g=Cm(A),v=g===A,b=l||(v||!h?[rx(A)]:bct(A)),y=[A].concat(b).reduce(function(Q,j){return Q.concat(Cm(j)===YX?yct(e,{placement:j,boundary:u,rootBoundary:d,padding:c,flipVariations:h,allowedAutoPlacements:m}):j)},[]),I=e.rects.reference,w=e.rects.popper,S=new Map,T=!0,D=y[0],C=0;C<y.length;C++){var E=y[C],P=Cm(E),R=uC(E)===oC,M=[pd,If].indexOf(P)>=0,N=M?"width":"height",k=c1(e,{placement:E,boundary:u,rootBoundary:d,altBoundary:p,padding:c}),O=M?R?wf:fd:R?If:pd;I[N]>w[N]&&(O=rx(O));var x=rx(O),F=[];if(a&&F.push(k[P]<=0),o&&F.push(k[O]<=0,k[x]<=0),F.every(function(Q){return Q})){D=E,T=!1;break}S.set(E,F)}if(T)for(var _=h?3:1,V=function(Q){var j=y.find(function(W){var Y=S.get(W);if(Y)return Y.slice(0,Q).every(function(X){return X})});if(j)return D=j,"break"},G=_;G>0;G--){var z=V(G);if(z==="break")break}e.placement!==D&&(e.modifiersData[r]._skip=!0,e.placement=D,e.reset=!0)}}const wct={name:"flip",enabled:!0,phase:"main",fn:Ict,requiresIfExists:["offset"],data:{_skip:!1}};function Ore(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function Fre(t){return[pd,wf,If,fd].some(function(e){return t[e]>=0})}function Sct(t){var e=t.state,i=t.name,r=e.rects.reference,n=e.rects.popper,a=e.modifiersData.preventOverflow,s=c1(e,{elementContext:"reference"}),o=c1(e,{altBoundary:!0}),l=Ore(s,r),c=Ore(o,n,a),u=Fre(l),d=Fre(c);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}const Uct={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Sct};function Tct(t,e,i){var r=Cm(t),n=[fd,pd].indexOf(r)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,s=a[0],o=a[1];return s=s||0,o=(o||0)*n,[fd,wf].indexOf(r)>=0?{x:o,y:s}:{x:s,y:o}}function Cct(t){var e=t.state,i=t.options,r=t.name,n=i.offset,a=n===void 0?[0,0]:n,s=PRe.reduce(function(u,d){return u[d]=Tct(d,e.rects,a),u},{}),o=s[e.placement],l=o.x,c=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[r]=s}const Ect={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Cct};function Dct(t){var e=t.state,i=t.name;e.modifiersData[i]=ORe({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const Pct={name:"popperOffsets",enabled:!0,phase:"read",fn:Dct,data:{}};function Rct(t){return t==="x"?"y":"x"}function Mct(t){var e=t.state,i=t.options,r=t.name,n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!1:s,l=i.boundary,c=i.rootBoundary,u=i.altBoundary,d=i.padding,p=i.tether,f=p===void 0?!0:p,h=i.tetherOffset,m=h===void 0?0:h,A=c1(e,{boundary:l,rootBoundary:c,padding:d,altBoundary:u}),g=Cm(e.placement),v=uC(e.placement),b=!v,y=JX(g),I=Rct(y),w=e.modifiersData.popperOffsets,S=e.rects.reference,T=e.rects.popper,D=typeof m=="function"?m(Object.assign({},e.rects,{placement:e.placement})):m,C=typeof D=="number"?{mainAxis:D,altAxis:D}:Object.assign({mainAxis:0,altAxis:0},D),E=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,P={x:0,y:0};if(w){if(a){var R,M=y==="y"?pd:fd,N=y==="y"?If:wf,k=y==="y"?"height":"width",O=w[y],x=O+A[M],F=O-A[N],_=f?-T[k]/2:0,V=v===oC?S[k]:T[k],G=v===oC?-T[k]:-S[k],z=e.elements.arrow,Q=f&&z?ZX(z):{width:0,height:0},j=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:BRe(),W=j[M],Y=j[N],X=T0(0,S[k],Q[k]),J=b?S[k]/2-_-X-W-C.mainAxis:V-X-W-C.mainAxis,ie=b?-S[k]/2+_+X+Y+C.mainAxis:G+X+Y+C.mainAxis,ue=e.elements.arrow&&SN(e.elements.arrow),ne=ue?y==="y"?ue.clientTop||0:ue.clientLeft||0:0,ge=(R=E?.[y])!=null?R:0,he=O+J-ge-ne,Ie=O+ie-ge,xe=T0(f?tO(x,he):x,O,f?kI(F,Ie):F);w[y]=xe,P[y]=xe-O}if(o){var Je,qe=y==="x"?pd:fd,dt=y==="x"?If:wf,ft=w[I],je=I==="y"?"height":"width",Tt=ft+A[qe],Oe=ft-A[dt],mt=[pd,fd].indexOf(g)!==-1,Le=(Je=E?.[I])!=null?Je:0,lt=mt?Tt:ft-S[je]-T[je]-Le+C.altAxis,it=mt?ft+S[je]+T[je]-Le-C.altAxis:Oe,Fe=f&&mt?tct(lt,ft,it):T0(f?lt:Tt,ft,f?it:Oe);w[I]=Fe,P[I]=Fe-ft}e.modifiersData[r]=P}}const Nct={name:"preventOverflow",enabled:!0,phase:"main",fn:Mct,requiresIfExists:["offset"]};function Bct(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function kct(t){return t===dp(t)||!Zp(t)?eZ(t):Bct(t)}function xct(t){var e=t.getBoundingClientRect(),i=lC(e.width)/t.offsetWidth||1,r=lC(e.height)/t.offsetHeight||1;return i!==1||r!==1}function _ct(t,e,i){i===void 0&&(i=!1);var r=Zp(e),n=Zp(e)&&xct(e),a=Mb(e),s=cC(t,n,i),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!i)&&((eA(e)!=="body"||iZ(a))&&(o=kct(e)),Zp(e)?(l=cC(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=tZ(a))),{x:s.left+o.scrollLeft-l.x,y:s.top+o.scrollTop-l.y,width:s.width,height:s.height}}function Oct(t){var e=new Map,i=new Set,r=[];t.forEach(function(a){e.set(a.name,a)});function n(a){i.add(a.name);var s=[].concat(a.requires||[],a.requiresIfExists||[]);s.forEach(function(o){if(!i.has(o)){var l=e.get(o);l&&n(l)}}),r.push(a)}return t.forEach(function(a){i.has(a.name)||n(a)}),r}function Fct(t){var e=Oct(t);return Ylt.reduce(function(i,r){return i.concat(e.filter(function(n){return n.phase===r}))},[])}function Lct(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function $ct(t){var e=t.reduce(function(i,r){var n=i[r.name];return i[r.name]=n?Object.assign({},n,r,{options:Object.assign({},n.options,r.options),data:Object.assign({},n.data,r.data)}):r,i},{});return Object.keys(e).map(function(i){return e[i]})}var Lre={placement:"bottom",modifiers:[],strategy:"absolute"};function $re(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function Hct(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,r=i===void 0?[]:i,n=e.defaultOptions,a=n===void 0?Lre:n;return function(s,o,l){l===void 0&&(l=a);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},Lre,a),modifiersData:{},elements:{reference:s,popper:o},attributes:{},styles:{}},u=[],d=!1,p={state:c,setOptions:function(m){var A=typeof m=="function"?m(c.options):m;h(),c.options=Object.assign({},a,c.options,A),c.scrollParents={reference:fw(s)?C0(s):s.contextElement?C0(s.contextElement):[],popper:C0(o)};var g=Fct($ct([].concat(r,c.options.modifiers)));return c.orderedModifiers=g.filter(function(v){return v.enabled}),f(),p.update()},forceUpdate:function(){if(!d){var m=c.elements,A=m.reference,g=m.popper;if($re(A,g)){c.rects={reference:_ct(A,SN(g),c.options.strategy==="fixed"),popper:ZX(g)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(T){return c.modifiersData[T.name]=Object.assign({},T.data)});for(var v=0;v<c.orderedModifiers.length;v++){if(c.reset===!0){c.reset=!1,v=-1;continue}var b=c.orderedModifiers[v],y=b.fn,I=b.options,w=I===void 0?{}:I,S=b.name;typeof y=="function"&&(c=y({state:c,options:w,name:S,instance:p})||c)}}}},update:Lct(function(){return new Promise(function(m){p.forceUpdate(),m(c)})}),destroy:function(){h(),d=!0}};if(!$re(s,o))return p;p.setOptions(l).then(function(m){!d&&l.onFirstUpdate&&l.onFirstUpdate(m)});function f(){c.orderedModifiers.forEach(function(m){var A=m.name,g=m.options,v=g===void 0?{}:g,b=m.effect;if(typeof b=="function"){var y=b({state:c,name:A,instance:p,options:v}),I=function(){};u.push(y||I)}})}function h(){u.forEach(function(m){return m()}),u=[]}return p}}var Vct=[dct,Pct,cct,RRe,Ect,wct,Nct,act,Uct],Gct=Hct({defaultModifiers:Vct}),Qct="tippy-box",FRe="tippy-content",jct="tippy-backdrop",LRe="tippy-arrow",$Re="tippy-svg-arrow",Jb={passive:!0,capture:!0},HRe=function(){return document.body};function TG(t,e,i){if(Array.isArray(t)){var r=t[e];return r??(Array.isArray(i)?i[e]:i)}return t}function rZ(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function VRe(t,e){return typeof t=="function"?t.apply(void 0,e):t}function Hre(t,e){if(e===0)return t;var i;return function(r){clearTimeout(i),i=setTimeout(function(){t(r)},e)}}function zct(t){return t.split(/\s+/).filter(Boolean)}function UU(t){return[].concat(t)}function Vre(t,e){t.indexOf(e)===-1&&t.push(e)}function qct(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function Wct(t){return t.split("-")[0]}function iO(t){return[].slice.call(t)}function Gre(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function E0(){return document.createElement("div")}function TH(t){return["Element","Fragment"].some(function(e){return rZ(t,e)})}function Kct(t){return rZ(t,"NodeList")}function Yct(t){return rZ(t,"MouseEvent")}function Xct(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function Zct(t){return TH(t)?[t]:Kct(t)?iO(t):Array.isArray(t)?t:iO(document.querySelectorAll(t))}function CG(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function Qre(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function Jct(t){var e,i=UU(t),r=i[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function eut(t,e){var i=e.clientX,r=e.clientY;return t.every(function(n){var a=n.popperRect,s=n.popperState,o=n.props,l=o.interactiveBorder,c=Wct(s.placement),u=s.modifiersData.offset;if(!u)return!0;var d=c==="bottom"?u.top.y:0,p=c==="top"?u.bottom.y:0,f=c==="right"?u.left.x:0,h=c==="left"?u.right.x:0,m=a.top-r+d>l,A=r-a.bottom-p>l,g=a.left-i+f>l,v=i-a.right-h>l;return m||A||g||v})}function EG(t,e,i){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(n){t[r](n,i)})}function jre(t,e){for(var i=e;i;){var r;if(t.contains(i))return!0;i=i.getRootNode==null||(r=i.getRootNode())==null?void 0:r.host}return!1}var om={isTouch:!1},zre=0;function tut(){om.isTouch||(om.isTouch=!0,window.performance&&document.addEventListener("mousemove",GRe))}function GRe(){var t=performance.now();t-zre<20&&(om.isTouch=!1,document.removeEventListener("mousemove",GRe)),zre=t}function iut(){var t=document.activeElement;if(Xct(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function rut(){document.addEventListener("touchstart",tut,Jb),window.addEventListener("blur",iut)}var nut=typeof window<"u"&&typeof document<"u",aut=nut?!!window.msCrypto:!1,sut={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},out={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Yf=Object.assign({appendTo:HRe,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},sut,out),lut=Object.keys(Yf),cut=function(t){var e=Object.keys(t);e.forEach(function(i){Yf[i]=t[i]})};function QRe(t){var e=t.plugins||[],i=e.reduce(function(r,n){var a=n.name,s=n.defaultValue;if(a){var o;r[a]=t[a]!==void 0?t[a]:(o=Yf[a])!=null?o:s}return r},{});return Object.assign({},t,i)}function uut(t,e){var i=e?Object.keys(QRe(Object.assign({},Yf,{plugins:e}))):lut,r=i.reduce(function(n,a){var s=(t.getAttribute("data-tippy-"+a)||"").trim();if(!s)return n;if(a==="content")n[a]=s;else try{n[a]=JSON.parse(s)}catch{n[a]=s}return n},{});return r}function qre(t,e){var i=Object.assign({},e,{content:VRe(e.content,[t])},e.ignoreAttributes?{}:uut(t,e.plugins));return i.aria=Object.assign({},Yf.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var dut=function(){return"innerHTML"};function w3(t,e){t[dut()]=e}function Wre(t){var e=E0();return t===!0?e.className=LRe:(e.className=$Re,TH(t)?e.appendChild(t):w3(e,t)),e}function Kre(t,e){TH(e.content)?(w3(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?w3(t,e.content):t.textContent=e.content)}function S3(t){var e=t.firstElementChild,i=iO(e.children);return{box:e,content:i.find(function(r){return r.classList.contains(FRe)}),arrow:i.find(function(r){return r.classList.contains(LRe)||r.classList.contains($Re)}),backdrop:i.find(function(r){return r.classList.contains(jct)})}}function jRe(t){var e=E0(),i=E0();i.className=Qct,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var r=E0();r.className=FRe,r.setAttribute("data-state","hidden"),Kre(r,t.props),e.appendChild(i),i.appendChild(r),n(t.props,t.props);function n(a,s){var o=S3(e),l=o.box,c=o.content,u=o.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(a.content!==s.content||a.allowHTML!==s.allowHTML)&&Kre(c,t.props),s.arrow?u?a.arrow!==s.arrow&&(l.removeChild(u),l.appendChild(Wre(s.arrow))):l.appendChild(Wre(s.arrow)):u&&l.removeChild(u)}return{popper:e,onUpdate:n}}jRe.$$tippy=!0;var put=1,bB=[],DG=[];function fut(t,e){var i=qre(t,Object.assign({},Yf,QRe(Gre(e)))),r,n,a,s=!1,o=!1,l=!1,c=!1,u,d,p,f=[],h=Hre(he,i.interactiveDebounce),m,A=put++,g=null,v=qct(i.plugins),b={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},y={id:A,reference:t,popper:E0(),popperInstance:g,props:i,state:b,plugins:v,clearDelayTimeouts:lt,setProps:it,setContent:Fe,show:Xe,hide:ct,hideWithInteractivity:We,enable:mt,disable:Le,unmount:ht,destroy:xt};if(!i.render)return y;var I=i.render(y),w=I.popper,S=I.onUpdate;w.setAttribute("data-tippy-root",""),w.id="tippy-"+y.id,y.popper=w,t._tippy=y,w._tippy=y;var T=v.map(function(pe){return pe.fn(y)}),D=t.hasAttribute("aria-expanded");return ue(),_(),O(),x("onCreate",[y]),i.showOnCreate&&Tt(),w.addEventListener("mouseenter",function(){y.props.interactive&&y.state.isVisible&&y.clearDelayTimeouts()}),w.addEventListener("mouseleave",function(){y.props.interactive&&y.props.trigger.indexOf("mouseenter")>=0&&M().addEventListener("mousemove",h)}),y;function C(){var pe=y.props.touch;return Array.isArray(pe)?pe:[pe,0]}function E(){return C()[0]==="hold"}function P(){var pe;return!!((pe=y.props.render)!=null&&pe.$$tippy)}function R(){return m||t}function M(){var pe=R().parentNode;return pe?Jct(pe):document}function N(){return S3(w)}function k(pe){return y.state.isMounted&&!y.state.isVisible||om.isTouch||u&&u.type==="focus"?0:TG(y.props.delay,pe?0:1,Yf.delay)}function O(pe){pe===void 0&&(pe=!1),w.style.pointerEvents=y.props.interactive&&!pe?"":"none",w.style.zIndex=""+y.props.zIndex}function x(pe,Se,ye){if(ye===void 0&&(ye=!0),T.forEach(function(Ce){Ce[pe]&&Ce[pe].apply(Ce,Se)}),ye){var ke;(ke=y.props)[pe].apply(ke,Se)}}function F(){var pe=y.props.aria;if(pe.content){var Se="aria-"+pe.content,ye=w.id,ke=UU(y.props.triggerTarget||t);ke.forEach(function(Ce){var Ke=Ce.getAttribute(Se);if(y.state.isVisible)Ce.setAttribute(Se,Ke?Ke+" "+ye:ye);else{var _e=Ke&&Ke.replace(ye,"").trim();_e?Ce.setAttribute(Se,_e):Ce.removeAttribute(Se)}})}}function _(){if(!(D||!y.props.aria.expanded)){var pe=UU(y.props.triggerTarget||t);pe.forEach(function(Se){y.props.interactive?Se.setAttribute("aria-expanded",y.state.isVisible&&Se===R()?"true":"false"):Se.removeAttribute("aria-expanded")})}}function V(){M().removeEventListener("mousemove",h),bB=bB.filter(function(pe){return pe!==h})}function G(pe){if(!(om.isTouch&&(l||pe.type==="mousedown"))){var Se=pe.composedPath&&pe.composedPath()[0]||pe.target;if(!(y.props.interactive&&jre(w,Se))){if(UU(y.props.triggerTarget||t).some(function(ye){return jre(ye,Se)})){if(om.isTouch||y.state.isVisible&&y.props.trigger.indexOf("click")>=0)return}else x("onClickOutside",[y,pe]);y.props.hideOnClick===!0&&(y.clearDelayTimeouts(),y.hide(),o=!0,setTimeout(function(){o=!1}),y.state.isMounted||W())}}}function z(){l=!0}function Q(){l=!1}function j(){var pe=M();pe.addEventListener("mousedown",G,!0),pe.addEventListener("touchend",G,Jb),pe.addEventListener("touchstart",Q,Jb),pe.addEventListener("touchmove",z,Jb)}function W(){var pe=M();pe.removeEventListener("mousedown",G,!0),pe.removeEventListener("touchend",G,Jb),pe.removeEventListener("touchstart",Q,Jb),pe.removeEventListener("touchmove",z,Jb)}function Y(pe,Se){J(pe,function(){!y.state.isVisible&&w.parentNode&&w.parentNode.contains(w)&&Se()})}function X(pe,Se){J(pe,Se)}function J(pe,Se){var ye=N().box;function ke(Ce){Ce.target===ye&&(EG(ye,"remove",ke),Se())}if(pe===0)return Se();EG(ye,"remove",d),EG(ye,"add",ke),d=ke}function ie(pe,Se,ye){ye===void 0&&(ye=!1);var ke=UU(y.props.triggerTarget||t);ke.forEach(function(Ce){Ce.addEventListener(pe,Se,ye),f.push({node:Ce,eventType:pe,handler:Se,options:ye})})}function ue(){E()&&(ie("touchstart",ge,{passive:!0}),ie("touchend",Ie,{passive:!0})),zct(y.props.trigger).forEach(function(pe){if(pe!=="manual")switch(ie(pe,ge),pe){case"mouseenter":ie("mouseleave",Ie);break;case"focus":ie(aut?"focusout":"blur",xe);break;case"focusin":ie("focusout",xe);break}})}function ne(){f.forEach(function(pe){var Se=pe.node,ye=pe.eventType,ke=pe.handler,Ce=pe.options;Se.removeEventListener(ye,ke,Ce)}),f=[]}function ge(pe){var Se,ye=!1;if(!(!y.state.isEnabled||Je(pe)||o)){var ke=((Se=u)==null?void 0:Se.type)==="focus";u=pe,m=pe.currentTarget,_(),!y.state.isVisible&&Yct(pe)&&bB.forEach(function(Ce){return Ce(pe)}),pe.type==="click"&&(y.props.trigger.indexOf("mouseenter")<0||s)&&y.props.hideOnClick!==!1&&y.state.isVisible?ye=!0:Tt(pe),pe.type==="click"&&(s=!ye),ye&&!ke&&Oe(pe)}}function he(pe){var Se=pe.target,ye=R().contains(Se)||w.contains(Se);if(!(pe.type==="mousemove"&&ye)){var ke=je().concat(w).map(function(Ce){var Ke,_e=Ce._tippy,wt=(Ke=_e.popperInstance)==null?void 0:Ke.state;return wt?{popperRect:Ce.getBoundingClientRect(),popperState:wt,props:i}:null}).filter(Boolean);eut(ke,pe)&&(V(),Oe(pe))}}function Ie(pe){var Se=Je(pe)||y.props.trigger.indexOf("click")>=0&&s;if(!Se){if(y.props.interactive){y.hideWithInteractivity(pe);return}Oe(pe)}}function xe(pe){y.props.trigger.indexOf("focusin")<0&&pe.target!==R()||y.props.interactive&&pe.relatedTarget&&w.contains(pe.relatedTarget)||Oe(pe)}function Je(pe){return om.isTouch?E()!==pe.type.indexOf("touch")>=0:!1}function qe(){dt();var pe=y.props,Se=pe.popperOptions,ye=pe.placement,ke=pe.offset,Ce=pe.getReferenceClientRect,Ke=pe.moveTransition,_e=P()?S3(w).arrow:null,wt=Ce?{getBoundingClientRect:Ce,contextElement:Ce.contextElement||R()}:t,ut={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Gi){var Wt=Gi.state;if(P()){var Ji=N(),$i=Ji.box;["placement","reference-hidden","escaped"].forEach(function(xi){xi==="placement"?$i.setAttribute("data-placement",Wt.placement):Wt.attributes.popper["data-popper-"+xi]?$i.setAttribute("data-"+xi,""):$i.removeAttribute("data-"+xi)}),Wt.attributes.popper={}}}},Ct=[{name:"offset",options:{offset:ke}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Ke}},ut];P()&&_e&&Ct.push({name:"arrow",options:{element:_e,padding:3}}),Ct.push.apply(Ct,Se?.modifiers||[]),y.popperInstance=Gct(wt,w,Object.assign({},Se,{placement:ye,onFirstUpdate:p,modifiers:Ct}))}function dt(){y.popperInstance&&(y.popperInstance.destroy(),y.popperInstance=null)}function ft(){var pe=y.props.appendTo,Se,ye=R();y.props.interactive&&pe===HRe||pe==="parent"?Se=ye.parentNode:Se=VRe(pe,[ye]),Se.contains(w)||Se.appendChild(w),y.state.isMounted=!0,qe()}function je(){return iO(w.querySelectorAll("[data-tippy-root]"))}function Tt(pe){y.clearDelayTimeouts(),pe&&x("onTrigger",[y,pe]),j();var Se=k(!0),ye=C(),ke=ye[0],Ce=ye[1];om.isTouch&&ke==="hold"&&Ce&&(Se=Ce),Se?r=setTimeout(function(){y.show()},Se):y.show()}function Oe(pe){if(y.clearDelayTimeouts(),x("onUntrigger",[y,pe]),!y.state.isVisible){W();return}if(!(y.props.trigger.indexOf("mouseenter")>=0&&y.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(pe.type)>=0&&s)){var Se=k(!1);Se?n=setTimeout(function(){y.state.isVisible&&y.hide()},Se):a=requestAnimationFrame(function(){y.hide()})}}function mt(){y.state.isEnabled=!0}function Le(){y.hide(),y.state.isEnabled=!1}function lt(){clearTimeout(r),clearTimeout(n),cancelAnimationFrame(a)}function it(pe){if(!y.state.isDestroyed){x("onBeforeUpdate",[y,pe]),ne();var Se=y.props,ye=qre(t,Object.assign({},Se,Gre(pe),{ignoreAttributes:!0}));y.props=ye,ue(),Se.interactiveDebounce!==ye.interactiveDebounce&&(V(),h=Hre(he,ye.interactiveDebounce)),Se.triggerTarget&&!ye.triggerTarget?UU(Se.triggerTarget).forEach(function(ke){ke.removeAttribute("aria-expanded")}):ye.triggerTarget&&t.removeAttribute("aria-expanded"),_(),O(),S&&S(Se,ye),y.popperInstance&&(qe(),je().forEach(function(ke){requestAnimationFrame(ke._tippy.popperInstance.forceUpdate)})),x("onAfterUpdate",[y,pe])}}function Fe(pe){y.setProps({content:pe})}function Xe(){var pe=y.state.isVisible,Se=y.state.isDestroyed,ye=!y.state.isEnabled,ke=om.isTouch&&!y.props.touch,Ce=TG(y.props.duration,0,Yf.duration);if(!(pe||Se||ye||ke)&&!R().hasAttribute("disabled")&&(x("onShow",[y],!1),y.props.onShow(y)!==!1)){if(y.state.isVisible=!0,P()&&(w.style.visibility="visible"),O(),j(),y.state.isMounted||(w.style.transition="none"),P()){var Ke=N(),_e=Ke.box,wt=Ke.content;CG([_e,wt],0)}p=function(){var ut;if(!(!y.state.isVisible||c)){if(c=!0,w.offsetHeight,w.style.transition=y.props.moveTransition,P()&&y.props.animation){var Ct=N(),Gi=Ct.box,Wt=Ct.content;CG([Gi,Wt],Ce),Qre([Gi,Wt],"visible")}F(),_(),Vre(DG,y),(ut=y.popperInstance)==null||ut.forceUpdate(),x("onMount",[y]),y.props.animation&&P()&&X(Ce,function(){y.state.isShown=!0,x("onShown",[y])})}},ft()}}function ct(){var pe=!y.state.isVisible,Se=y.state.isDestroyed,ye=!y.state.isEnabled,ke=TG(y.props.duration,1,Yf.duration);if(!(pe||Se||ye)&&(x("onHide",[y],!1),y.props.onHide(y)!==!1)){if(y.state.isVisible=!1,y.state.isShown=!1,c=!1,s=!1,P()&&(w.style.visibility="hidden"),V(),W(),O(!0),P()){var Ce=N(),Ke=Ce.box,_e=Ce.content;y.props.animation&&(CG([Ke,_e],ke),Qre([Ke,_e],"hidden"))}F(),_(),y.props.animation?P()&&Y(ke,y.unmount):y.unmount()}}function We(pe){M().addEventListener("mousemove",h),Vre(bB,h),h(pe)}function ht(){y.state.isVisible&&y.hide(),y.state.isMounted&&(dt(),je().forEach(function(pe){pe._tippy.unmount()}),w.parentNode&&w.parentNode.removeChild(w),DG=DG.filter(function(pe){return pe!==y}),y.state.isMounted=!1,x("onHidden",[y]))}function xt(){!y.state.isDestroyed&&(y.clearDelayTimeouts(),y.unmount(),ne(),delete t._tippy,y.state.isDestroyed=!0,x("onDestroy",[y]))}}function CH(t,e){e===void 0&&(e={});var i=Yf.plugins.concat(e.plugins||[]);rut();var r=Object.assign({},e,{plugins:i}),n=Zct(t),a=n.reduce(function(s,o){var l=o&&fut(o,r);return l&&s.push(l),s},[]);return TH(t)?a[0]:a}CH.defaultProps=Yf;CH.setDefaultProps=cut;CH.currentInput=om;Object.assign({},RRe,{effect:function(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow)}});CH.setDefaultProps({render:jRe});function hut(){return"0.9.23"}function uv(t,e,i){if(!t)return{elements:{}};const r={};for(const n of e||[]){if(!n?.label||n.hide)continue;const a=document.createElement("button");n.id&&(r[n.id]=a,a.id=n.id),a.style.marginRight=".5em",a.className="button font-medium",n.intent&&a.classList.add(n.intent),a.innerHTML=n.label,n.disabled&&(a.disabled=!0),a.onclick=s=>{s.stopPropagation(),!s.target.disabled&&yc(n.onClick)&&n.onClick(),i&&yc(i)&&i()},t.appendChild(a)}return{elements:r}}const mut=(t,e)=>i=>i?.trim().length>=t&&(!e||i?.trim().length<=e);function zRe(t){return vN.isConvertableInteger(t)&&parseInt(t.toString())>=0}const Aut=(t,e)=>i=>zRe(i)&&Number(i)>=t&&Number(i)<=e,gut=t=>/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?\d)(?=.*?[#?!@$%^&*-]).{8,12}$/.test(t);function vut(t){return vN.dateTime.dateValidation.test(t)}const yut=(t,e)=>i=>{const r=(i||"").trim().split(" ").length;return r>=t&&(!e||r<=e)},but=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,Iut=t=>but.exec(t),fi=Object.freeze(Object.defineProperty({__proto__:null,dateValidator:vut,emailValidator:Iut,nameValidator:mut,numericRange:Aut,numericValidator:zRe,passwordValidator:gut,wordValidator:yut},Symbol.toStringTag,{value:"Module"}));class wut{constructor({tournamentRecord:e,drawId:i,structureId:r,eventId:n}){this.tournamentRecord=e,this.drawId=i,this.structureId=r,this.eventId=n||e.events?.[0]?.eventId,Qs.setState(e)}setRenderCallback(e){this.renderCallback=e}getAllParticipants(){Qs.setState(this.tournamentRecord);const{participants:e=[]}=Qs.getParticipants()||{};return e.map(i=>({participantId:i.participantId,participantName:i.participantName,participantType:i.participantType,person:i.person,individualParticipants:i.individualParticipants}))}getAvailableParticipants(){Qs.setState(this.tournamentRecord);const e=this.getAllParticipants(),{assignedParticipantIds:i=[]}=Qs.getAssignedParticipantIds({drawId:this.drawId})||{};return e.filter(r=>!i.includes(r.participantId))}removeAssignment({drawPosition:e}){Qs.setState(this.tournamentRecord);const i=this.getMatchUps().find(a=>a.sides?.some(s=>s.drawPosition===e))?.sides?.find(a=>a.drawPosition===e)?.bye===!0,r=Qs.removeDrawPositionAssignment({drawId:this.drawId,structureId:this.structureId,drawPosition:e});if(r.error)return{success:!1,error:r.error};const{tournamentRecord:n}=Qs.getState()||{};return this.tournamentRecord=n,i&&this.renderCallback&&this.renderCallback(),{success:!0}}assignParticipant({drawPosition:e,participantId:i}){Qs.setState(this.tournamentRecord);const r=Qs.assignDrawPosition({drawId:this.drawId,structureId:this.structureId,drawPosition:e,participantId:i});if(r.error)return{success:!1,error:r.error};const{tournamentRecord:n}=Qs.getState()||{};return this.tournamentRecord=n,this.focusDrawPosition=e+1,this.renderCallback&&this.renderCallback(),{success:!0}}getAndClearFocusDrawPosition(){const e=this.focusDrawPosition;return this.focusDrawPosition=void 0,e}assignBye({drawPosition:e}){Qs.setState(this.tournamentRecord);const i=Qs.assignDrawPositionBye({drawId:this.drawId,structureId:this.structureId,drawPosition:e});if(i.error)return{success:!1,error:i.error};const{tournamentRecord:r}=Qs.getState()||{};return this.tournamentRecord=r,this.focusDrawPosition=e+1,this.renderCallback&&this.renderCallback(),{success:!0}}assignQualifier({drawPosition:e}){Qs.setState(this.tournamentRecord);const i=Qs.assignDrawPosition({drawId:this.drawId,structureId:this.structureId,drawPosition:e,qualifier:!0});if(i.error)return{success:!1,error:i.error};const{tournamentRecord:r}=Qs.getState()||{};return this.tournamentRecord=r,this.focusDrawPosition=e+1,this.renderCallback&&this.renderCallback(),{success:!0}}getMatchUps(){Qs.setState(this.tournamentRecord);const{eventData:e}=Qs.getEventData({eventId:this.eventId})||{},i=e?.drawsData?.find(r=>r.drawId===this.drawId)?.structures?.find(r=>r.structureId===this.structureId)?.roundMatchUps;return i?Object.values(i).flat():[]}getState(){return this.tournamentRecord}getContext(){return{drawId:this.drawId,structureId:this.structureId}}}function Wy(){pf.close()}function Jr(t){const{title:e,content:i,buttons:r,footer:n,onClose:a,config:s}=t,l=s||{padding:!e&&!r?"":".5",maxWidth:500};return pf.open({title:e,content:i,footer:n,buttons:r,config:l,onClose:a})}async function Sut({callback:t}){const e={providerId:""},r=(await PP()).data?.providers,n=r.map(({value:u})=>({label:u.organisationName,value:u.organisationId})),a=new Set(r.map(({value:u})=>u.organisationName)),s=()=>{const u=r.find(({value:d})=>d.organisationId===e.providerId)?.value;u&&Mt(t)&&t(u)},o=u=>{const d=u.target.value,p=d===""||a.has(d),f=document.getElementById("selectButton");f.disabled=!p,e.providerId=p?d:""},l=u=>{const d=document.getElementById("selectButton");e.providerId=u,d.disabled=!u};Jr({title:"Select provider",content:u=>{Sr(u,[{typeAhead:{list:n,callback:l},placeholder:"Type provider name",label:"Provider",field:"provider",width:"100%",onInput:o}])},buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:s,intent:"is-primary",id:"selectButton",label:"Select",disabled:!0,close:!0}]})}var ig=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function EH(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var nx={exports:{}},Uut=nx.exports,Yre;function Tut(){return Yre||(Yre=1,(function(t,e){((i,r)=>{t.exports=r()})(Uut,function(){var i=function($,q){return(i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(Z,te){Z.__proto__=te}:function(Z,te){for(var ae in te)Object.prototype.hasOwnProperty.call(te,ae)&&(Z[ae]=te[ae])}))($,q)},r=function(){return(r=Object.assign||function($){for(var q,Z=1,te=arguments.length;Z<te;Z++)for(var ae in q=arguments[Z])Object.prototype.hasOwnProperty.call(q,ae)&&($[ae]=q[ae]);return $}).apply(this,arguments)};function n($,q,Z){for(var te,ae=0,de=q.length;ae<de;ae++)!te&&ae in q||((te=te||Array.prototype.slice.call(q,0,ae))[ae]=q[ae]);return $.concat(te||Array.prototype.slice.call(q))}var a=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:ig,s=Object.keys,o=Array.isArray;function l($,q){return typeof q=="object"&&s(q).forEach(function(Z){$[Z]=q[Z]}),$}typeof Promise>"u"||a.Promise||(a.Promise=Promise);var c=Object.getPrototypeOf,u={}.hasOwnProperty;function d($,q){return u.call($,q)}function p($,q){typeof q=="function"&&(q=q(c($))),(typeof Reflect>"u"?s:Reflect.ownKeys)(q).forEach(function(Z){h($,Z,q[Z])})}var f=Object.defineProperty;function h($,q,Z,te){f($,q,l(Z&&d(Z,"get")&&typeof Z.get=="function"?{get:Z.get,set:Z.set,configurable:!0}:{value:Z,configurable:!0,writable:!0},te))}function m($){return{from:function(q){return $.prototype=Object.create(q.prototype),h($.prototype,"constructor",$),{extend:p.bind(null,$.prototype)}}}}var A=Object.getOwnPropertyDescriptor,g=[].slice;function v($,q,Z){return g.call($,q,Z)}function b($,q){return q($)}function y($){if(!$)throw new Error("Assertion Failed")}function I($){a.setImmediate?setImmediate($):setTimeout($,0)}function w($,q){if(typeof q=="string"&&d($,q))return $[q];if(!q)return $;if(typeof q!="string"){for(var Z=[],te=0,ae=q.length;te<ae;++te){var de=w($,q[te]);Z.push(de)}return Z}var Ae,ve=q.indexOf(".");return ve===-1||(Ae=$[q.substr(0,ve)])==null?void 0:w(Ae,q.substr(ve+1))}function S($,q,Z){if($&&q!==void 0&&!("isFrozen"in Object&&Object.isFrozen($)))if(typeof q!="string"&&"length"in q){y(typeof Z!="string"&&"length"in Z);for(var te=0,ae=q.length;te<ae;++te)S($,q[te],Z[te])}else{var de,Ae,ve=q.indexOf(".");ve!==-1?(de=q.substr(0,ve),(ve=q.substr(ve+1))===""?Z===void 0?o($)&&!isNaN(parseInt(de))?$.splice(de,1):delete $[de]:$[de]=Z:S(Ae=(Ae=$[de])&&d($,de)?Ae:$[de]={},ve,Z)):Z===void 0?o($)&&!isNaN(parseInt(q))?$.splice(q,1):delete $[q]:$[q]=Z}}function T($){var q,Z={};for(q in $)d($,q)&&(Z[q]=$[q]);return Z}var D=[].concat;function C($){return D.apply([],$)}var G="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(C([8,16,32,64].map(function($){return["Int","Uint","Float"].map(function(q){return q+$+"Array"})}))).filter(function($){return a[$]}),E=new Set(G.map(function($){return a[$]})),P=null;function R($){return P=new WeakMap,$=(function q(Z){if(!Z||typeof Z!="object")return Z;var te=P.get(Z);if(te)return te;if(o(Z)){te=[],P.set(Z,te);for(var ae=0,de=Z.length;ae<de;++ae)te.push(q(Z[ae]))}else if(E.has(Z.constructor))te=Z;else{var Ae,ve=c(Z);for(Ae in te=ve===Object.prototype?{}:Object.create(ve),P.set(Z,te),Z)d(Z,Ae)&&(te[Ae]=q(Z[Ae]))}return te})($),P=null,$}var M={}.toString;function N($){return M.call($).slice(8,-1)}var k=typeof Symbol<"u"?Symbol.iterator:"@@iterator",O=typeof k=="symbol"?function($){var q;return $!=null&&(q=$[k])&&q.apply($)}:function(){return null};function x($,q){q=$.indexOf(q),0<=q&&$.splice(q,1)}var F={};function _($){var q,Z,te,ae;if(arguments.length===1){if(o($))return $.slice();if(this===F&&typeof $=="string")return[$];if(ae=O($))for(Z=[];!(te=ae.next()).done;)Z.push(te.value);else{if($==null)return[$];if(typeof(q=$.length)!="number")return[$];for(Z=new Array(q);q--;)Z[q]=$[q]}}else for(q=arguments.length,Z=new Array(q);q--;)Z[q]=arguments[q];return Z}var V=typeof Symbol<"u"?function($){return $[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},G=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],lt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(G),z={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Q($,q){this.name=$,this.message=q}function j($,q){return $+". Errors: "+Object.keys(q).map(function(Z){return q[Z].toString()}).filter(function(Z,te,ae){return ae.indexOf(Z)===te}).join(`
`)}function W($,q,Z,te){this.failures=q,this.failedKeys=te,this.successCount=Z,this.message=j($,q)}function Y($,q){this.name="BulkError",this.failures=Object.keys(q).map(function(Z){return q[Z]}),this.failuresByPos=q,this.message=j($,this.failures)}m(Q).from(Error).extend({toString:function(){return this.name+": "+this.message}}),m(W).from(Q),m(Y).from(Q);var X=lt.reduce(function($,q){return $[q]=q+"Error",$},{}),J=Q,ie=lt.reduce(function($,q){var Z=q+"Error";function te(ae,de){this.name=Z,ae?typeof ae=="string"?(this.message="".concat(ae).concat(de?`
 `+de:""),this.inner=de||null):typeof ae=="object"&&(this.message="".concat(ae.name," ").concat(ae.message),this.inner=ae):(this.message=z[q]||Z,this.inner=null)}return m(te).from(J),$[q]=te,$},{}),ue=(ie.Syntax=SyntaxError,ie.Type=TypeError,ie.Range=RangeError,G.reduce(function($,q){return $[q+"Error"]=ie[q],$},{}));G=lt.reduce(function($,q){return["Syntax","Type","Range"].indexOf(q)===-1&&($[q+"Error"]=ie[q]),$},{});function ne(){}function ge($){return $}function he($,q){return $==null||$===ge?q:function(Z){return q($(Z))}}function Ie($,q){return function(){$.apply(this,arguments),q.apply(this,arguments)}}function xe($,q){return $===ne?q:function(){var Z=$.apply(this,arguments),te=(Z!==void 0&&(arguments[0]=Z),this.onsuccess),ae=this.onerror,de=(this.onsuccess=null,this.onerror=null,q.apply(this,arguments));return te&&(this.onsuccess=this.onsuccess?Ie(te,this.onsuccess):te),ae&&(this.onerror=this.onerror?Ie(ae,this.onerror):ae),de!==void 0?de:Z}}function Je($,q){return $===ne?q:function(){$.apply(this,arguments);var Z=this.onsuccess,te=this.onerror;this.onsuccess=this.onerror=null,q.apply(this,arguments),Z&&(this.onsuccess=this.onsuccess?Ie(Z,this.onsuccess):Z),te&&(this.onerror=this.onerror?Ie(te,this.onerror):te)}}function qe($,q){return $===ne?q:function(ae){var te=$.apply(this,arguments),ae=(l(ae,te),this.onsuccess),de=this.onerror,Ae=(this.onsuccess=null,this.onerror=null,q.apply(this,arguments));return ae&&(this.onsuccess=this.onsuccess?Ie(ae,this.onsuccess):ae),de&&(this.onerror=this.onerror?Ie(de,this.onerror):de),te===void 0?Ae===void 0?void 0:Ae:l(te,Ae)}}function dt($,q){return $===ne?q:function(){return q.apply(this,arguments)!==!1&&$.apply(this,arguments)}}function ft($,q){return $===ne?q:function(){var Z=$.apply(this,arguments);if(Z&&typeof Z.then=="function"){for(var te=this,ae=arguments.length,de=new Array(ae);ae--;)de[ae]=arguments[ae];return Z.then(function(){return q.apply(te,de)})}return q.apply(this,arguments)}}G.ModifyError=W,G.DexieError=Q,G.BulkError=Y;var je=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Tt($){je=$}var Oe={},mt=100,Le=typeof Promise>"u"?[]:(lt=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[Le=crypto.subtle.digest("SHA-512",new Uint8Array([0])),c(Le),lt]:[lt,c(lt),lt]),lt=Le[0],yv=Le[1],yv=yv&&yv.then,it=lt&&lt.constructor,Fe=!!Le[2],Xe=function($,q){ke.push([$,q]),We&&(queueMicrotask($i),We=!1)},ct=!0,We=!0,ht=[],xt=[],pe=ge,Se={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ne,pgp:!1,env:{},finalize:ne},ye=Se,ke=[],Ce=0,Ke=[];function _e($){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var q=this._PSD=ye;if(typeof $!="function"){if($!==Oe)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Ct(this,this._value)}else this._state=null,this._value=null,++q.ref,(function Z(te,ae){try{ae(function(de){if(te._state===null){if(de===te)throw new TypeError("A promise cannot be resolved with itself.");var Ae=te._lib&&xi();de&&typeof de.then=="function"?Z(te,function(ve,Pe){de instanceof _e?de._then(ve,Pe):de.then(ve,Pe)}):(te._state=!0,te._value=de,Gi(te)),Ae&&en()}},Ct.bind(null,te))}catch(de){Ct(te,de)}})(this,$)}var wt={get:function(){var $=ye,q=lc;function Z(te,ae){var de=this,Ae=!$.global&&($!==ye||q!==lc),ve=Ae&&!ao(),Pe=new _e(function(Ve,De){Wt(de,new ut(xf(te,$,Ae,ve),xf(ae,$,Ae,ve),Ve,De,$))});return this._consoleTask&&(Pe._consoleTask=this._consoleTask),Pe}return Z.prototype=Oe,Z},set:function($){h(this,"then",$&&$.prototype===Oe?wt:{get:function(){return $},set:wt.set})}};function ut($,q,Z,te,ae){this.onFulfilled=typeof $=="function"?$:null,this.onRejected=typeof q=="function"?q:null,this.resolve=Z,this.reject=te,this.psd=ae}function Ct($,q){var Z,te;xt.push(q),$._state===null&&(Z=$._lib&&xi(),q=pe(q),$._state=!1,$._value=q,te=$,ht.some(function(ae){return ae._value===te._value})||ht.push(te),Gi($),Z)&&en()}function Gi($){var q=$._listeners;$._listeners=[];for(var Z=0,te=q.length;Z<te;++Z)Wt($,q[Z]);var ae=$._PSD;--ae.ref||ae.finalize(),Ce===0&&(++Ce,Xe(function(){--Ce==0&&ra()},[]))}function Wt($,q){if($._state===null)$._listeners.push(q);else{var Z=$._state?q.onFulfilled:q.onRejected;if(Z===null)return($._state?q.resolve:q.reject)($._value);++q.psd.ref,++Ce,Xe(Ji,[Z,$,q])}}function Ji($,q,Z){try{var te,ae=q._value;!q._state&&xt.length&&(xt=[]),te=je&&q._consoleTask?q._consoleTask.run(function(){return $(ae)}):$(ae),q._state||xt.indexOf(ae)!==-1||(de=>{for(var Ae=ht.length;Ae;)if(ht[--Ae]._value===de._value)return ht.splice(Ae,1)})(q),Z.resolve(te)}catch(de){Z.reject(de)}finally{--Ce==0&&ra(),--Z.psd.ref||Z.psd.finalize()}}function $i(){Qc(Se,function(){xi()&&en()})}function xi(){var $=ct;return We=ct=!1,$}function en(){var $,q,Z;do for(;0<ke.length;)for($=ke,ke=[],Z=$.length,q=0;q<Z;++q){var te=$[q];te[0].apply(null,te[1])}while(0<ke.length);We=ct=!0}function ra(){for(var $=ht,q=(ht=[],$.forEach(function(te){te._PSD.onunhandled.call(null,te._value,te)}),Ke.slice(0)),Z=q.length;Z;)q[--Z]()}function oc($){return new _e(Oe,!1,$)}function un($,q){var Z=ye;return function(){var te=xi(),ae=ye;try{return cc(Z,!0),$.apply(this,arguments)}catch(de){q&&q(de)}finally{cc(ae,!1),te&&en()}}}p(_e.prototype,{then:wt,_then:function($,q){Wt(this,new ut(null,null,$,q,ye))},catch:function($){var q,Z;return arguments.length===1?this.then(null,$):(q=$,Z=arguments[1],typeof q=="function"?this.then(null,function(te){return(te instanceof q?Z:oc)(te)}):this.then(null,function(te){return(te&&te.name===q?Z:oc)(te)}))},finally:function($){return this.then(function(q){return _e.resolve($()).then(function(){return q})},function(q){return _e.resolve($()).then(function(){return oc(q)})})},timeout:function($,q){var Z=this;return $<1/0?new _e(function(te,ae){var de=setTimeout(function(){return ae(new ie.Timeout(q))},$);Z.then(te,ae).finally(clearTimeout.bind(null,de))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&h(_e.prototype,Symbol.toStringTag,"Dexie.Promise"),Se.env=Jh(),p(_e,{all:function(){var $=_.apply(null,arguments).map(Cn);return new _e(function(q,Z){$.length===0&&q([]);var te=$.length;$.forEach(function(ae,de){return _e.resolve(ae).then(function(Ae){$[de]=Ae,--te||q($)},Z)})})},resolve:function($){return $ instanceof _e?$:$&&typeof $.then=="function"?new _e(function(q,Z){$.then(q,Z)}):new _e(Oe,!0,$)},reject:oc,race:function(){var $=_.apply(null,arguments).map(Cn);return new _e(function(q,Z){$.map(function(te){return _e.resolve(te).then(q,Z)})})},PSD:{get:function(){return ye},set:function($){return ye=$}},totalEchoes:{get:function(){return lc}},newPSD:Ho,usePSD:Qc,scheduler:{get:function(){return Xe},set:function($){Xe=$}},rejectionMapper:{get:function(){return pe},set:function($){pe=$}},follow:function($,q){return new _e(function(Z,te){return Ho(function(ae,de){var Ae=ye;Ae.unhandleds=[],Ae.onunhandled=de,Ae.finalize=Ie(function(){var ve,Pe=this;ve=function(){Pe.unhandleds.length===0?ae():de(Pe.unhandleds[0])},Ke.push(function Ve(){ve(),Ke.splice(Ke.indexOf(Ve),1)}),++Ce,Xe(function(){--Ce==0&&ra()},[])},Ae.finalize),$()},q,Z,te)})}}),it&&(it.allSettled&&h(_e,"allSettled",function(){var $=_.apply(null,arguments).map(Cn);return new _e(function(q){$.length===0&&q([]);var Z=$.length,te=new Array(Z);$.forEach(function(ae,de){return _e.resolve(ae).then(function(Ae){return te[de]={status:"fulfilled",value:Ae}},function(Ae){return te[de]={status:"rejected",reason:Ae}}).then(function(){return--Z||q(te)})})})}),it.any&&typeof AggregateError<"u"&&h(_e,"any",function(){var $=_.apply(null,arguments).map(Cn);return new _e(function(q,Z){$.length===0&&Z(new AggregateError([]));var te=$.length,ae=new Array(te);$.forEach(function(de,Ae){return _e.resolve(de).then(function(ve){return q(ve)},function(ve){ae[Ae]=ve,--te||Z(new AggregateError(ae))})})})}),it.withResolvers)&&(_e.withResolvers=it.withResolvers);var dn={awaits:0,echoes:0,id:0},Ta=0,ti=[],pr=0,lc=0,xd=0;function Ho($,Ae,Z,te){var ae=ye,de=Object.create(ae),Ae=(de.parent=ae,de.ref=0,de.global=!1,de.id=++xd,Se.env,de.env=Fe?{Promise:_e,PromiseProp:{value:_e,configurable:!0,writable:!0},all:_e.all,race:_e.race,allSettled:_e.allSettled,any:_e.any,resolve:_e.resolve,reject:_e.reject}:{},Ae&&l(de,Ae),++ae.ref,de.finalize=function(){--this.parent.ref||this.parent.finalize()},Qc(de,$,Z,te));return de.ref===0&&de.finalize(),Ae}function no(){return dn.id||(dn.id=++Ta),++dn.awaits,dn.echoes+=mt,dn.id}function ao(){return!!dn.awaits&&(--dn.awaits==0&&(dn.id=0),dn.echoes=dn.awaits*mt,!0)}function Cn($){return dn.echoes&&$&&$.constructor===it?(no(),$.then(function(q){return ao(),q},function(q){return ao(),Kn(q)})):$}function Gc(){var $=ti[ti.length-1];ti.pop(),cc($,!1)}function cc($,q){var Z,te,ae=ye;(q?!dn.echoes||pr++&&$===ye:!pr||--pr&&$===ye)||queueMicrotask(q?(function(de){++lc,dn.echoes&&--dn.echoes!=0||(dn.echoes=dn.awaits=dn.id=0),ti.push(ye),cc(de,!0)}).bind(null,$):Gc),$!==ye&&(ye=$,ae===Se&&(Se.env=Jh()),Fe)&&(Z=Se.env.Promise,te=$.env,ae.global||$.global)&&(Object.defineProperty(a,"Promise",te.PromiseProp),Z.all=te.all,Z.race=te.race,Z.resolve=te.resolve,Z.reject=te.reject,te.allSettled&&(Z.allSettled=te.allSettled),te.any)&&(Z.any=te.any)}function Jh(){var $=a.Promise;return Fe?{Promise:$,PromiseProp:Object.getOwnPropertyDescriptor(a,"Promise"),all:$.all,race:$.race,allSettled:$.allSettled,any:$.any,resolve:$.resolve,reject:$.reject}:{}}function Qc($,q,Z,te,ae){var de=ye;try{return cc($,!0),q(Z,te,ae)}finally{cc(de,!1)}}function xf($,q,Z,te){return typeof $!="function"?$:function(){var ae=ye;Z&&no(),cc(q,!0);try{return $.apply(this,arguments)}finally{cc(ae,!1),te&&queueMicrotask(ao)}}}function Ca($){Promise===it&&dn.echoes===0?pr===0?$():enqueueNativeMicroTask($):setTimeout($,0)}(""+yv).indexOf("[native code]")===-1&&(no=ao=ne);var Kn=_e.reject,al="",Tl="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",em="String expected.",uc=[],dc="__dbnames",vp="readonly",pc="readwrite";function Ea($,q){return $?q?function(){return $.apply(this,arguments)&&q.apply(this,arguments)}:$:q}var Bu={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function ku($){return typeof $!="string"||/\./.test($)?function(q){return q}:function(q){return q[$]===void 0&&$ in q&&delete(q=R(q))[$],q}}function jc(){throw ie.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Xt($,q){try{var Z=xn($),te=xn(q);if(Z!==te)return Z==="Array"?1:te==="Array"?-1:Z==="binary"?1:te==="binary"?-1:Z==="string"?1:te==="string"?-1:Z==="Date"?1:te!=="Date"?NaN:-1;switch(Z){case"number":case"Date":case"string":return q<$?1:$<q?-1:0;case"binary":for(var ae=Cl($),de=Cl(q),Ae=ae.length,ve=de.length,Pe=Ae<ve?Ae:ve,Ve=0;Ve<Pe;++Ve)if(ae[Ve]!==de[Ve])return ae[Ve]<de[Ve]?-1:1;return Ae===ve?0:Ae<ve?-1:1;case"Array":for(var De=$,Ee=q,Ne=De.length,Be=Ee.length,Re=Ne<Be?Ne:Be,Me=0;Me<Re;++Me){var He=Xt(De[Me],Ee[Me]);if(He!==0)return He}return Ne===Be?0:Ne<Be?-1:1}}catch{}return NaN}function xn($){var q=typeof $;return q=="object"&&(ArrayBuffer.isView($)||(q=N($))==="ArrayBuffer")?"binary":q}function Cl($){return $ instanceof Uint8Array?$:ArrayBuffer.isView($)?new Uint8Array($.buffer,$.byteOffset,$.byteLength):new Uint8Array($)}function bs($,q,Z){var te=$.schema.yProps;return te?(q&&0<Z.numFailures&&(q=q.filter(function(ae,de){return!Z.failures[de]})),Promise.all(te.map(function(ae){return ae=ae.updatesTable,q?$.db.table(ae).where("k").anyOf(q).delete():$.db.table(ae).clear()})).then(function(){return Z})):Z}Hs.prototype.execute=function($){var q=this["@@propmod"];if(q.add!==void 0){var Z=q.add;if(o(Z))return n(n([],o($)?$:[],!0),Z).sort();if(typeof Z=="number")return(Number($)||0)+Z;if(typeof Z=="bigint")try{return BigInt($)+Z}catch{return BigInt(0)+Z}throw new TypeError("Invalid term ".concat(Z))}if(q.remove!==void 0){var te=q.remove;if(o(te))return o($)?$.filter(function(ae){return!te.includes(ae)}).sort():[];if(typeof te=="number")return Number($)-te;if(typeof te=="bigint")try{return BigInt($)-te}catch{return BigInt(0)-te}throw new TypeError("Invalid subtrahend ".concat(te))}return Z=(Z=q.replacePrefix)==null?void 0:Z[0],Z&&typeof $=="string"&&$.startsWith(Z)?q.replacePrefix[1]+$.substring(Z.length):$};var vo=Hs;function Hs($){this["@@propmod"]=$}function Hi($,q){for(var Z=s(q),te=Z.length,ae=!1,de=0;de<te;++de){var Ae=Z[de],ve=q[Ae],Pe=w($,Ae);ve instanceof vo?(S($,Ae,ve.execute(Pe)),ae=!0):Pe!==ve&&(S($,Ae,ve),ae=!0)}return ae}sn.prototype._trans=function($,q,Z){var te=this._tx||ye.trans,ae=this.name,de=je&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat($==="readonly"?"read":"write"," ").concat(this.name));function Ae(Ve,De,Ee){if(Ee.schema[ae])return q(Ee.idbtrans,Ee);throw new ie.NotFound("Table "+ae+" not part of transaction")}var ve=xi();try{var Pe=te&&te.db._novip===this.db._novip?te===ye.trans?te._promise($,Ae,Z):Ho(function(){return te._promise($,Ae,Z)},{trans:te,transless:ye.transless||ye}):(function Ve(De,Ee,Ne,Be){if(De.idbdb&&(De._state.openComplete||ye.letThrough||De._vip)){var Re=De._createTransaction(Ee,Ne,De._dbSchema);try{Re.create(),De._state.PR1398_maxLoop=3}catch(Me){return Me.name===X.InvalidState&&De.isOpen()&&0<--De._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),De.close({disableAutoOpen:!1}),De.open().then(function(){return Ve(De,Ee,Ne,Be)})):Kn(Me)}return Re._promise(Ee,function(Me,He){return Ho(function(){return ye.trans=Re,Be(Me,He,Re)})}).then(function(Me){if(Ee==="readwrite")try{Re.idbtrans.commit()}catch{}return Ee==="readonly"?Me:Re._completion.then(function(){return Me})})}if(De._state.openComplete)return Kn(new ie.DatabaseClosed(De._state.dbOpenError));if(!De._state.isBeingOpened){if(!De._state.autoOpen)return Kn(new ie.DatabaseClosed);De.open().catch(ne)}return De._state.dbReadyPromise.then(function(){return Ve(De,Ee,Ne,Be)})})(this.db,$,[this.name],Ae);return de&&(Pe._consoleTask=de,Pe=Pe.catch(function(Ve){return console.trace(Ve),Kn(Ve)})),Pe}finally{ve&&en()}},sn.prototype.get=function($,q){var Z=this;return $&&$.constructor===Object?this.where($).first(q):$==null?Kn(new ie.Type("Invalid argument to Table.get()")):this._trans("readonly",function(te){return Z.core.get({trans:te,key:$}).then(function(ae){return Z.hook.reading.fire(ae)})}).then(q)},sn.prototype.where=function($){if(typeof $=="string")return new this.db.WhereClause(this,$);if(o($))return new this.db.WhereClause(this,"[".concat($.join("+"),"]"));var q=s($);if(q.length===1)return this.where(q[0]).equals($[q[0]]);var Z=this.schema.indexes.concat(this.schema.primKey).filter(function(ve){if(ve.compound&&q.every(function(Ve){return 0<=ve.keyPath.indexOf(Ve)})){for(var Pe=0;Pe<q.length;++Pe)if(q.indexOf(ve.keyPath[Pe])===-1)return!1;return!0}return!1}).sort(function(ve,Pe){return ve.keyPath.length-Pe.keyPath.length})[0];if(Z&&this.db._maxKey!==al)return Ae=Z.keyPath.slice(0,q.length),this.where(Ae).equals(Ae.map(function(ve){return $[ve]}));!Z&&je&&console.warn("The query ".concat(JSON.stringify($)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(q.join("+"),"]"));var te=this.schema.idxByName;function ae(ve,Pe){return Xt(ve,Pe)===0}var Ae=q.reduce(function(De,Pe){var Ve=De[0],De=De[1],Ee=te[Pe],Ne=$[Pe];return[Ve||Ee,Ve||!Ee?Ea(De,Ee&&Ee.multi?function(Be){return Be=w(Be,Pe),o(Be)&&Be.some(function(Re){return ae(Ne,Re)})}:function(Be){return ae(Ne,w(Be,Pe))}):De]},[null,null]),de=Ae[0],Ae=Ae[1];return de?this.where(de.name).equals($[de.keyPath]).filter(Ae):Z?this.filter(Ae):this.where(q).equals("")},sn.prototype.filter=function($){return this.toCollection().and($)},sn.prototype.count=function($){return this.toCollection().count($)},sn.prototype.offset=function($){return this.toCollection().offset($)},sn.prototype.limit=function($){return this.toCollection().limit($)},sn.prototype.each=function($){return this.toCollection().each($)},sn.prototype.toArray=function($){return this.toCollection().toArray($)},sn.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},sn.prototype.orderBy=function($){return new this.db.Collection(new this.db.WhereClause(this,o($)?"[".concat($.join("+"),"]"):$))},sn.prototype.reverse=function(){return this.toCollection().reverse()},sn.prototype.mapToClass=function($){for(var q=this.db,Z=this.name,te=((this.schema.mappedClass=$).prototype instanceof jc&&($=(Ae=>{var ve=De,Pe=Ae;if(typeof Pe!="function"&&Pe!==null)throw new TypeError("Class extends value "+String(Pe)+" is not a constructor or null");function Ve(){this.constructor=ve}function De(){return Ae!==null&&Ae.apply(this,arguments)||this}return i(ve,Pe),ve.prototype=Pe===null?Object.create(Pe):(Ve.prototype=Pe.prototype,new Ve),Object.defineProperty(De.prototype,"db",{get:function(){return q},enumerable:!1,configurable:!0}),De.prototype.table=function(){return Z},De})($)),new Set),ae=$.prototype;ae;ae=c(ae))Object.getOwnPropertyNames(ae).forEach(function(Ae){return te.add(Ae)});function de(Ae){if(!Ae)return Ae;var ve,Pe=Object.create($.prototype);for(ve in Ae)if(!te.has(ve))try{Pe[ve]=Ae[ve]}catch{}return Pe}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=de,this.hook("reading",de),$},sn.prototype.defineClass=function(){return this.mapToClass(function($){l(this,$)})},sn.prototype.add=function($,q){var Z=this,te=this.schema.primKey,ae=te.auto,de=te.keyPath,Ae=$;return de&&ae&&(Ae=ku(de)($)),this._trans("readwrite",function(ve){return Z.core.mutate({trans:ve,type:"add",keys:q!=null?[q]:null,values:[Ae]})}).then(function(ve){return ve.numFailures?_e.reject(ve.failures[0]):ve.lastResult}).then(function(ve){if(de)try{S($,de,ve)}catch{}return ve})},sn.prototype.upsert=function($,q){var Z=this,te=this.schema.primKey.keyPath;return this._trans("readwrite",function(ae){return Z.core.get({trans:ae,key:$}).then(function(de){var Ae=de??{};return Hi(Ae,q),te&&S(Ae,te,$),Z.core.mutate({trans:ae,type:"put",values:[Ae],keys:[$],upsert:!0,updates:{keys:[$],changeSpecs:[q]}}).then(function(ve){return ve.numFailures?_e.reject(ve.failures[0]):!!de})})})},sn.prototype.update=function($,q){return typeof $!="object"||o($)?this.where(":id").equals($).modify(q):($=w($,this.schema.primKey.keyPath))===void 0?Kn(new ie.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals($).modify(q)},sn.prototype.put=function($,q){var Z=this,te=this.schema.primKey,ae=te.auto,de=te.keyPath,Ae=$;return de&&ae&&(Ae=ku(de)($)),this._trans("readwrite",function(ve){return Z.core.mutate({trans:ve,type:"put",values:[Ae],keys:q!=null?[q]:null})}).then(function(ve){return ve.numFailures?_e.reject(ve.failures[0]):ve.lastResult}).then(function(ve){if(de)try{S($,de,ve)}catch{}return ve})},sn.prototype.delete=function($){var q=this;return this._trans("readwrite",function(Z){return q.core.mutate({trans:Z,type:"delete",keys:[$]}).then(function(te){return bs(q,[$],te)}).then(function(te){return te.numFailures?_e.reject(te.failures[0]):void 0})})},sn.prototype.clear=function(){var $=this;return this._trans("readwrite",function(q){return $.core.mutate({trans:q,type:"deleteRange",range:Bu}).then(function(Z){return bs($,null,Z)})}).then(function(q){return q.numFailures?_e.reject(q.failures[0]):void 0})},sn.prototype.bulkGet=function($){var q=this;return this._trans("readonly",function(Z){return q.core.getMany({keys:$,trans:Z}).then(function(te){return te.map(function(ae){return q.hook.reading.fire(ae)})})})},sn.prototype.bulkAdd=function($,q,Z){var te=this,ae=Array.isArray(q)?q:void 0,de=(Z=Z||(ae?void 0:q))?Z.allKeys:void 0;return this._trans("readwrite",function(Ae){var ve=te.schema.primKey,Ve=ve.auto,ve=ve.keyPath;if(ve&&ae)throw new ie.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(ae&&ae.length!==$.length)throw new ie.InvalidArgument("Arguments objects and keys must have the same length");var Pe=$.length,Ve=ve&&Ve?$.map(ku(ve)):$;return te.core.mutate({trans:Ae,type:"add",keys:ae,values:Ve,wantResults:de}).then(function(De){var Ee=De.numFailures,Ne=De.failures;if(Ee===0)return de?De.results:De.lastResult;throw new Y("".concat(te.name,".bulkAdd(): ").concat(Ee," of ").concat(Pe," operations failed"),Ne)})})},sn.prototype.bulkPut=function($,q,Z){var te=this,ae=Array.isArray(q)?q:void 0,de=(Z=Z||(ae?void 0:q))?Z.allKeys:void 0;return this._trans("readwrite",function(Ae){var ve=te.schema.primKey,Ve=ve.auto,ve=ve.keyPath;if(ve&&ae)throw new ie.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(ae&&ae.length!==$.length)throw new ie.InvalidArgument("Arguments objects and keys must have the same length");var Pe=$.length,Ve=ve&&Ve?$.map(ku(ve)):$;return te.core.mutate({trans:Ae,type:"put",keys:ae,values:Ve,wantResults:de}).then(function(De){var Ee=De.numFailures,Ne=De.failures;if(Ee===0)return de?De.results:De.lastResult;throw new Y("".concat(te.name,".bulkPut(): ").concat(Ee," of ").concat(Pe," operations failed"),Ne)})})},sn.prototype.bulkUpdate=function($){var q=this,Z=this.core,te=$.map(function(Ae){return Ae.key}),ae=$.map(function(Ae){return Ae.changes}),de=[];return this._trans("readwrite",function(Ae){return Z.getMany({trans:Ae,keys:te,cache:"clone"}).then(function(ve){var Pe=[],Ve=[],De=($.forEach(function(Ee,Ne){var Be=Ee.key,Re=Ee.changes,Me=ve[Ne];if(Me){for(var He=0,ze=Object.keys(Re);He<ze.length;He++){var $e=ze[He],st=Re[$e];if($e===q.schema.primKey.keyPath){if(Xt(st,Be)!==0)throw new ie.Constraint("Cannot update primary key in bulkUpdate()")}else S(Me,$e,st)}de.push(Ne),Pe.push(Be),Ve.push(Me)}}),Pe.length);return Z.mutate({trans:Ae,type:"put",keys:Pe,values:Ve,updates:{keys:te,changeSpecs:ae}}).then(function(Ee){var Ne=Ee.numFailures,Be=Ee.failures;if(Ne===0)return De;for(var Re=0,Me=Object.keys(Be);Re<Me.length;Re++){var He,ze=Me[Re],$e=de[Number(ze)];$e!=null&&(He=Be[ze],delete Be[ze],Be[$e]=He)}throw new Y("".concat(q.name,".bulkUpdate(): ").concat(Ne," of ").concat(De," operations failed"),Be)})})})},sn.prototype.bulkDelete=function($){var q=this,Z=$.length;return this._trans("readwrite",function(te){return q.core.mutate({trans:te,type:"delete",keys:$}).then(function(ae){return bs(q,$,ae)})}).then(function(te){var ae=te.numFailures,de=te.failures;if(ae===0)return te.lastResult;throw new Y("".concat(q.name,".bulkDelete(): ").concat(ae," of ").concat(Z," operations failed"),de)})};var In=sn;function sn(){}function fc($){function q(Ae,ve){if(ve){for(var Pe=arguments.length,Ve=new Array(Pe-1);--Pe;)Ve[Pe-1]=arguments[Pe];return Z[Ae].subscribe.apply(null,Ve),$}if(typeof Ae=="string")return Z[Ae]}var Z={};q.addEventType=de;for(var te=1,ae=arguments.length;te<ae;++te)de(arguments[te]);return q;function de(Ae,ve,Pe){var Ve,De;if(typeof Ae!="object")return ve=ve||dt,De={subscribers:[],fire:Pe=Pe||ne,subscribe:function(Ee){De.subscribers.indexOf(Ee)===-1&&(De.subscribers.push(Ee),De.fire=ve(De.fire,Ee))},unsubscribe:function(Ee){De.subscribers=De.subscribers.filter(function(Ne){return Ne!==Ee}),De.fire=De.subscribers.reduce(ve,Pe)}},Z[Ae]=q[Ae]=De;s(Ve=Ae).forEach(function(Ee){var Ne=Ve[Ee];if(o(Ne))de(Ee,Ve[Ee][0],Ve[Ee][1]);else{if(Ne!=="asap")throw new ie.InvalidArgument("Invalid event config");var Be=de(Ee,ge,function(){for(var Re=arguments.length,Me=new Array(Re);Re--;)Me[Re]=arguments[Re];Be.subscribers.forEach(function(He){I(function(){He.apply(null,Me)})})})}})}}function ls($,q){return m(q).from({prototype:$}),q}function _d($,q){return!($.filter||$.algorithm||$.or)&&(q?$.justLimit:!$.replayFilter)}function et($,q){$.filter=Ea($.filter,q)}function Ai($,q,Z){var te=$.replayFilter;$.replayFilter=te?function(){return Ea(te(),q())}:q,$.justLimit=Z&&!te}function _i($,q){if($.isPrimKey)return q.primaryKey;var Z=q.getIndexByKeyPath($.index);if(Z)return Z;throw new ie.Schema("KeyPath "+$.index+" on object store "+q.name+" is not indexed")}function Oi($,q,Z){var te=_i($,q.schema);return q.openCursor({trans:Z,values:!$.keysOnly,reverse:$.dir==="prev",unique:!!$.unique,query:{index:te,range:$.range}})}function wn($,q,Z,te){var ae,de,Ae=$.replayFilter?Ea($.filter,$.replayFilter()):$.filter;return $.or?(ae={},de=function(ve,Pe,Ve){var De,Ee;Ae&&!Ae(Pe,Ve,function(Ne){return Pe.stop(Ne)},function(Ne){return Pe.fail(Ne)})||((Ee=""+(De=Pe.primaryKey))=="[object ArrayBuffer]"&&(Ee=""+new Uint8Array(De)),d(ae,Ee))||(ae[Ee]=!0,q(ve,Pe,Ve))},Promise.all([$.or._iterate(de,Z),Va(Oi($,te,Z),$.algorithm,de,!$.keysOnly&&$.valueMapper)])):Va(Oi($,te,Z),Ea($.algorithm,Ae),q,!$.keysOnly&&$.valueMapper)}function Va($,q,Z,te){var ae=un(te?function(de,Ae,ve){return Z(te(de),Ae,ve)}:Z);return $.then(function(de){if(de)return de.start(function(){var Ae=function(){return de.continue()};q&&!q(de,function(ve){return Ae=ve},function(ve){de.stop(ve),Ae=ne},function(ve){de.fail(ve),Ae=ne})||ae(de.value,de,function(ve){return Ae=ve}),Ae()})})}Ur.prototype._read=function($,q){var Z=this._ctx;return Z.error?Z.table._trans(null,Kn.bind(null,Z.error)):Z.table._trans("readonly",$).then(q)},Ur.prototype._write=function($){var q=this._ctx;return q.error?q.table._trans(null,Kn.bind(null,q.error)):q.table._trans("readwrite",$,"locked")},Ur.prototype._addAlgorithm=function($){var q=this._ctx;q.algorithm=Ea(q.algorithm,$)},Ur.prototype._iterate=function($,q){return wn(this._ctx,$,q,this._ctx.table.core)},Ur.prototype.clone=function($){var q=Object.create(this.constructor.prototype),Z=Object.create(this._ctx);return $&&l(Z,$),q._ctx=Z,q},Ur.prototype.raw=function(){return this._ctx.valueMapper=null,this},Ur.prototype.each=function($){var q=this._ctx;return this._read(function(Z){return wn(q,$,Z,q.table.core)})},Ur.prototype.count=function($){var q=this;return this._read(function(Z){var te,ae=q._ctx,de=ae.table.core;return _d(ae,!0)?de.count({trans:Z,query:{index:_i(ae,de.schema),range:ae.range}}).then(function(Ae){return Math.min(Ae,ae.limit)}):(te=0,wn(ae,function(){return++te,!1},Z,de).then(function(){return te}))}).then($)},Ur.prototype.sortBy=function($,q){var Z=$.split(".").reverse(),te=Z[0],ae=Z.length-1;function de(Pe,Ve){return Ve?de(Pe[Z[Ve]],Ve-1):Pe[te]}var Ae=this._ctx.dir==="next"?1:-1;function ve(Pe,Ve){return Xt(de(Pe,ae),de(Ve,ae))*Ae}return this.toArray(function(Pe){return Pe.sort(ve)}).then(q)},Ur.prototype.toArray=function($){var q=this;return this._read(function(Z){var te,ae,de,Ae=q._ctx;return Ae.dir==="next"&&_d(Ae,!0)&&0<Ae.limit?(te=Ae.valueMapper,ae=_i(Ae,Ae.table.core.schema),Ae.table.core.query({trans:Z,limit:Ae.limit,values:!0,query:{index:ae,range:Ae.range}}).then(function(ve){return ve=ve.result,te?ve.map(te):ve})):(de=[],wn(Ae,function(ve){return de.push(ve)},Z,Ae.table.core).then(function(){return de}))},$)},Ur.prototype.offset=function($){var q=this._ctx;return $<=0||(q.offset+=$,_d(q)?Ai(q,function(){var Z=$;return function(te,ae){return Z===0||(Z===1?--Z:ae(function(){te.advance(Z),Z=0}),!1)}}):Ai(q,function(){var Z=$;return function(){return--Z<0}})),this},Ur.prototype.limit=function($){return this._ctx.limit=Math.min(this._ctx.limit,$),Ai(this._ctx,function(){var q=$;return function(Z,te,ae){return--q<=0&&te(ae),0<=q}},!0),this},Ur.prototype.until=function($,q){return et(this._ctx,function(Z,te,ae){return!$(Z.value)||(te(ae),q)}),this},Ur.prototype.first=function($){return this.limit(1).toArray(function(q){return q[0]}).then($)},Ur.prototype.last=function($){return this.reverse().first($)},Ur.prototype.filter=function($){var q;return et(this._ctx,function(Z){return $(Z.value)}),(q=this._ctx).isMatch=Ea(q.isMatch,$),this},Ur.prototype.and=function($){return this.filter($)},Ur.prototype.or=function($){return new this.db.WhereClause(this._ctx.table,$,this)},Ur.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Ur.prototype.desc=function(){return this.reverse()},Ur.prototype.eachKey=function($){var q=this._ctx;return q.keysOnly=!q.isMatch,this.each(function(Z,te){$(te.key,te)})},Ur.prototype.eachUniqueKey=function($){return this._ctx.unique="unique",this.eachKey($)},Ur.prototype.eachPrimaryKey=function($){var q=this._ctx;return q.keysOnly=!q.isMatch,this.each(function(Z,te){$(te.primaryKey,te)})},Ur.prototype.keys=function($){var q=this._ctx,Z=(q.keysOnly=!q.isMatch,[]);return this.each(function(te,ae){Z.push(ae.key)}).then(function(){return Z}).then($)},Ur.prototype.primaryKeys=function($){var q=this._ctx;if(q.dir==="next"&&_d(q,!0)&&0<q.limit)return this._read(function(te){var ae=_i(q,q.table.core.schema);return q.table.core.query({trans:te,values:!1,limit:q.limit,query:{index:ae,range:q.range}})}).then(function(te){return te.result}).then($);q.keysOnly=!q.isMatch;var Z=[];return this.each(function(te,ae){Z.push(ae.primaryKey)}).then(function(){return Z}).then($)},Ur.prototype.uniqueKeys=function($){return this._ctx.unique="unique",this.keys($)},Ur.prototype.firstKey=function($){return this.limit(1).keys(function(q){return q[0]}).then($)},Ur.prototype.lastKey=function($){return this.reverse().firstKey($)},Ur.prototype.distinct=function(){var $,q=this._ctx,q=q.index&&q.table.schema.idxByName[q.index];return q&&q.multi&&($={},et(this._ctx,function(te){var te=te.primaryKey.toString(),ae=d($,te);return $[te]=!0,!ae})),this},Ur.prototype.modify=function($){var q=this,Z=this._ctx;return this._write(function(te){function ae(Me,He){var ze=He.failures;Ne+=Me-He.numFailures;for(var $e=0,st=s(ze);$e<st.length;$e++){var bt=st[$e];Ee.push(ze[bt])}}var de=typeof $=="function"?$:function(Me){return Hi(Me,$)},Ae=Z.table.core,De=Ae.schema.primaryKey,ve=De.outbound,Pe=De.extractKey,Ve=200,De=q.db._options.modifyChunkSize,Ee=(De&&(Ve=typeof De=="object"?De[Ae.name]||De["*"]||200:De),[]),Ne=0,Be=[],Re=$===El;return q.clone().primaryKeys().then(function(Me){function He($e){var st=Math.min(Ve,Me.length-$e),bt=Me.slice($e,$e+st);return(Re?Promise.resolve([]):Ae.getMany({trans:te,keys:bt,cache:"immutable"})).then(function(_t){var Ot=[],yt=[],ni=ve?[]:null,Vt=Re?bt:[];if(!Re)for(var Rt=0;Rt<st;++Rt){var oi=_t[Rt],on={value:R(oi),primKey:Me[$e+Rt]};de.call(on,on.value,on)!==!1&&(on.value==null?Vt.push(Me[$e+Rt]):ve||Xt(Pe(oi),Pe(on.value))===0?(yt.push(on.value),ve&&ni.push(Me[$e+Rt])):(Vt.push(Me[$e+Rt]),Ot.push(on.value)))}return Promise.resolve(0<Ot.length&&Ae.mutate({trans:te,type:"add",values:Ot}).then(function(Tr){for(var Vi in Tr.failures)Vt.splice(parseInt(Vi),1);ae(Ot.length,Tr)})).then(function(){return(0<yt.length||ze&&typeof $=="object")&&Ae.mutate({trans:te,type:"put",keys:ni,values:yt,criteria:ze,changeSpec:typeof $!="function"&&$,isAdditionalChunk:0<$e}).then(function(Tr){return ae(yt.length,Tr)})}).then(function(){return(0<Vt.length||ze&&Re)&&Ae.mutate({trans:te,type:"delete",keys:Vt,criteria:ze,isAdditionalChunk:0<$e}).then(function(Tr){return bs(Z.table,Vt,Tr)}).then(function(Tr){return ae(Vt.length,Tr)})}).then(function(){return Me.length>$e+st&&He($e+Ve)})})}var ze=_d(Z)&&Z.limit===1/0&&(typeof $!="function"||Re)&&{index:Z.index,range:Z.range};return He(0).then(function(){if(0<Ee.length)throw new W("Error modifying one or more objects",Ee,Ne,Be);return Me.length})})})},Ur.prototype.delete=function(){var $=this._ctx,q=$.range;return!_d($)||$.table.schema.yProps||!$.isPrimKey&&q.type!==3?this.modify(El):this._write(function(Z){var te=$.table.core.schema.primaryKey,ae=q;return $.table.core.count({trans:Z,query:{index:te,range:ae}}).then(function(de){return $.table.core.mutate({trans:Z,type:"deleteRange",range:ae}).then(function(Pe){var ve=Pe.failures,Pe=Pe.numFailures;if(Pe)throw new W("Could not delete some values",Object.keys(ve).map(function(Ve){return ve[Ve]}),de-Pe);return de-Pe})})})};var zc=Ur;function Ur(){}var El=function($,q){return q.value=null};function RA($,q){return $<q?-1:$===q?0:1}function tm($,q){return q<$?-1:$===q?0:1}function so($,q,Z){return $=$ instanceof MA?new $.Collection($):$,$._ctx.error=new(Z||TypeError)(q),$}function xu($){return new $.Collection($,function(){return _f("")}).limit(0)}function _u(Be,q,Z,te){var ae,de,Ae,ve,Pe,Ve,De,Ee=Z.length;if(!Z.every(function(Me){return typeof Me=="string"}))return so(Be,em);function Ne(Me){ae=Me==="next"?function(ze){return ze.toUpperCase()}:function(ze){return ze.toLowerCase()},de=Me==="next"?function(ze){return ze.toLowerCase()}:function(ze){return ze.toUpperCase()},Ae=Me==="next"?RA:tm;var He=Z.map(function(ze){return{lower:de(ze),upper:ae(ze)}}).sort(function(ze,$e){return Ae(ze.lower,$e.lower)});ve=He.map(function(ze){return ze.upper}),Pe=He.map(function(ze){return ze.lower}),De=(Ve=Me)==="next"?"":te}Ne("next");var Be=new Be.Collection(Be,function(){return Da(ve[0],Pe[Ee-1]+te)}),Re=(Be._ondirectionchange=function(Me){Ne(Me)},0);return Be._addAlgorithm(function(Me,He,ze){var $e=Me.key;if(typeof $e=="string"){var st=de($e);if(q(st,Pe,Re))return!0;for(var bt=null,_t=Re;_t<Ee;++_t){var Ot=((yt,ni,Vt,Rt,oi,on)=>{for(var Tr=Math.min(yt.length,Rt.length),Vi=-1,Cr=0;Cr<Tr;++Cr){var Xn=ni[Cr];if(Xn!==Rt[Cr])return oi(yt[Cr],Vt[Cr])<0?yt.substr(0,Cr)+Vt[Cr]+Vt.substr(Cr+1):oi(yt[Cr],Rt[Cr])<0?yt.substr(0,Cr)+Rt[Cr]+Vt.substr(Cr+1):0<=Vi?yt.substr(0,Vi)+ni[Vi]+Vt.substr(Vi+1):null;oi(yt[Cr],Xn)<0&&(Vi=Cr)}return Tr<Rt.length&&on==="next"?yt+Vt.substr(yt.length):Tr<yt.length&&on==="prev"?yt.substr(0,Vt.length):Vi<0?null:yt.substr(0,Vi)+Rt[Vi]+Vt.substr(Vi+1)})($e,st,ve[_t],Pe[_t],Ae,Ve);Ot===null&&bt===null?Re=_t+1:(bt===null||0<Ae(bt,Ot))&&(bt=Ot)}He(bt!==null?function(){Me.continue(bt+De)}:ze)}return!1}),Be}function Da($,q,Z,te){return{type:2,lower:$,upper:q,lowerOpen:Z,upperOpen:te}}function _f($){return{type:1,lower:$,upper:$}}Object.defineProperty(pi.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),pi.prototype.between=function($,q,Z,te){Z=Z!==!1,te=te===!0;try{return 0<this._cmp($,q)||this._cmp($,q)===0&&(Z||te)&&(!Z||!te)?xu(this):new this.Collection(this,function(){return Da($,q,!Z,!te)})}catch{return so(this,Tl)}},pi.prototype.equals=function($){return $==null?so(this,Tl):new this.Collection(this,function(){return _f($)})},pi.prototype.above=function($){return $==null?so(this,Tl):new this.Collection(this,function(){return Da($,void 0,!0)})},pi.prototype.aboveOrEqual=function($){return $==null?so(this,Tl):new this.Collection(this,function(){return Da($,void 0,!1)})},pi.prototype.below=function($){return $==null?so(this,Tl):new this.Collection(this,function(){return Da(void 0,$,!1,!0)})},pi.prototype.belowOrEqual=function($){return $==null?so(this,Tl):new this.Collection(this,function(){return Da(void 0,$)})},pi.prototype.startsWith=function($){return typeof $!="string"?so(this,em):this.between($,$+al,!0,!0)},pi.prototype.startsWithIgnoreCase=function($){return $===""?this.startsWith($):_u(this,function(q,Z){return q.indexOf(Z[0])===0},[$],al)},pi.prototype.equalsIgnoreCase=function($){return _u(this,function(q,Z){return q===Z[0]},[$],"")},pi.prototype.anyOfIgnoreCase=function(){var $=_.apply(F,arguments);return $.length===0?xu(this):_u(this,function(q,Z){return Z.indexOf(q)!==-1},$,"")},pi.prototype.startsWithAnyOfIgnoreCase=function(){var $=_.apply(F,arguments);return $.length===0?xu(this):_u(this,function(q,Z){return Z.some(function(te){return q.indexOf(te)===0})},$,al)},pi.prototype.anyOf=function(){var $,q,Z=this,te=_.apply(F,arguments),ae=this._cmp;try{te.sort(ae)}catch{return so(this,Tl)}return te.length===0?xu(this):(($=new this.Collection(this,function(){return Da(te[0],te[te.length-1])}))._ondirectionchange=function(de){ae=de==="next"?Z._ascending:Z._descending,te.sort(ae)},q=0,$._addAlgorithm(function(de,Ae,ve){for(var Pe=de.key;0<ae(Pe,te[q]);)if(++q===te.length)return Ae(ve),!1;return ae(Pe,te[q])===0||(Ae(function(){de.continue(te[q])}),!1)}),$)},pi.prototype.notEqual=function($){return this.inAnyRange([[-1/0,$],[$,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},pi.prototype.noneOf=function(){var $=_.apply(F,arguments);if($.length===0)return new this.Collection(this);try{$.sort(this._ascending)}catch{return so(this,Tl)}var q=$.reduce(function(Z,te){return Z?Z.concat([[Z[Z.length-1][1],te]]):[[-1/0,te]]},null);return q.push([$[$.length-1],this.db._maxKey]),this.inAnyRange(q,{includeLowers:!1,includeUppers:!1})},pi.prototype.inAnyRange=function($,ze){var Z=this,te=this._cmp,ae=this._ascending,de=this._descending,Ae=this._min,ve=this._max;if($.length===0)return xu(this);if(!$.every(function($e){return $e[0]!==void 0&&$e[1]!==void 0&&ae($e[0],$e[1])<=0}))return so(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ie.InvalidArgument);var Pe=!ze||ze.includeLowers!==!1,Ve=ze&&ze.includeUppers===!0,De,Ee=ae;function Ne($e,st){return Ee($e[0],st[0])}try{(De=$.reduce(function($e,st){for(var bt=0,_t=$e.length;bt<_t;++bt){var Ot=$e[bt];if(te(st[0],Ot[1])<0&&0<te(st[1],Ot[0])){Ot[0]=Ae(Ot[0],st[0]),Ot[1]=ve(Ot[1],st[1]);break}}return bt===_t&&$e.push(st),$e},[])).sort(Ne)}catch{return so(this,Tl)}var Be=0,Re=Ve?function($e){return 0<ae($e,De[Be][1])}:function($e){return 0<=ae($e,De[Be][1])},Me=Pe?function($e){return 0<de($e,De[Be][0])}:function($e){return 0<=de($e,De[Be][0])},He=Re,ze=new this.Collection(this,function(){return Da(De[0][0],De[De.length-1][1],!Pe,!Ve)});return ze._ondirectionchange=function($e){Ee=$e==="next"?(He=Re,ae):(He=Me,de),De.sort(Ne)},ze._addAlgorithm(function($e,st,bt){for(var _t,Ot=$e.key;He(Ot);)if(++Be===De.length)return st(bt),!1;return!Re(_t=Ot)&&!Me(_t)||(Z._cmp(Ot,De[Be][1])===0||Z._cmp(Ot,De[Be][0])===0||st(function(){Ee===ae?$e.continue(De[Be][0]):$e.continue(De[Be][1])}),!1)}),ze},pi.prototype.startsWithAnyOf=function(){var $=_.apply(F,arguments);return $.every(function(q){return typeof q=="string"})?$.length===0?xu(this):this.inAnyRange($.map(function(q){return[q,q+al]})):so(this,"startsWithAnyOf() only works with strings")};var MA=pi;function pi(){}function Pa($){return un(function(q){return Fr(q),$(q.target.error),!1})}function Fr($){$.stopPropagation&&$.stopPropagation(),$.preventDefault&&$.preventDefault()}var yp="storagemutated",bp="x-storagemutated-1",sl=fc(null,yp),im=(Yn.prototype._lock=function(){return y(!ye.global),++this._reculock,this._reculock!==1||ye.global||(ye.lockOwnerFor=this),this},Yn.prototype._unlock=function(){if(y(!ye.global),--this._reculock==0)for(ye.global||(ye.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var $=this._blockedFuncs.shift();try{Qc($[1],$[0])}catch{}}return this},Yn.prototype._locked=function(){return this._reculock&&ye.lockOwnerFor!==this},Yn.prototype.create=function($){var q=this;if(this.mode){var Z=this.db.idbdb,te=this.db._state.dbOpenError;if(y(!this.idbtrans),!$&&!Z)switch(te&&te.name){case"DatabaseClosedError":throw new ie.DatabaseClosed(te);case"MissingAPIError":throw new ie.MissingAPI(te.message,te);default:throw new ie.OpenFailed(te)}if(!this.active)throw new ie.TransactionInactive;y(this._completion._state===null),($=this.idbtrans=$||(this.db.core||Z).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=un(function(ae){Fr(ae),q._reject($.error)}),$.onabort=un(function(ae){Fr(ae),q.active&&q._reject(new ie.Abort($.error)),q.active=!1,q.on("abort").fire(ae)}),$.oncomplete=un(function(){q.active=!1,q._resolve(),"mutatedParts"in $&&sl.storagemutated.fire($.mutatedParts)})}return this},Yn.prototype._promise=function($,q,Z){var te,ae=this;return $==="readwrite"&&this.mode!=="readwrite"?Kn(new ie.ReadOnly("Transaction is readonly")):this.active?this._locked()?new _e(function(de,Ae){ae._blockedFuncs.push([function(){ae._promise($,q,Z).then(de,Ae)},ye])}):Z?Ho(function(){var de=new _e(function(Ae,ve){ae._lock();var Pe=q(Ae,ve,ae);Pe&&Pe.then&&Pe.then(Ae,ve)});return de.finally(function(){return ae._unlock()}),de._lib=!0,de}):((te=new _e(function(de,Ae){var ve=q(de,Ae,ae);ve&&ve.then&&ve.then(de,Ae)}))._lib=!0,te):Kn(new ie.TransactionInactive)},Yn.prototype._root=function(){return this.parent?this.parent._root():this},Yn.prototype.waitFor=function($){var q,Z=this._root(),te=_e.resolve($),ae=(Z._waitingFor?Z._waitingFor=Z._waitingFor.then(function(){return te}):(Z._waitingFor=te,Z._waitingQueue=[],q=Z.idbtrans.objectStore(Z.storeNames[0]),(function de(){for(++Z._spinCount;Z._waitingQueue.length;)Z._waitingQueue.shift()();Z._waitingFor&&(q.get(-1/0).onsuccess=de)})()),Z._waitingFor);return new _e(function(de,Ae){te.then(function(ve){return Z._waitingQueue.push(un(de.bind(null,ve)))},function(ve){return Z._waitingQueue.push(un(Ae.bind(null,ve)))}).finally(function(){Z._waitingFor===ae&&(Z._waitingFor=null)})})},Yn.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ie.Abort))},Yn.prototype.table=function($){var q=this._memoizedTables||(this._memoizedTables={});if(d(q,$))return q[$];var Z=this.schema[$];if(Z)return(Z=new this.db.Table($,Z,this)).core=this.db.core.table($),q[$]=Z;throw new ie.NotFound("Table "+$+" not part of transaction")},Yn);function Yn(){}function Ip($,q,Z,te,ae,de,Ae,ve){return{name:$,keyPath:q,unique:Z,multi:te,auto:ae,compound:de,src:(Z&&!Ae?"&":"")+(te?"*":"")+(ae?"++":"")+Ou(q),type:ve}}function Ou($){return typeof $=="string"?$:$?"["+[].join.call($,"+")+"]":""}function Ga($,q,Z){return{name:$,primKey:q,indexes:Z,mappedClass:null,idxByName:(te=function(ae){return[ae.name,ae]},Z.reduce(function(ae,de,Ae){return de=te(de,Ae),de&&(ae[de[0]]=de[1]),ae},{}))};var te}var Dl=function($){try{return $.only([[]]),Dl=function(){return[[]]},[[]]}catch{return Dl=function(){return al},al}};function ee($){return $==null?function(){}:typeof $=="string"?(q=$).split(".").length===1?function(Z){return Z[q]}:function(Z){return w(Z,q)}:function(Z){return w(Z,$)};var q}function me($){return[].slice.call($)}var Te=0;function at($){return $==null?":id":typeof $=="string"?$:"[".concat($.join("+"),"]")}function ir($,q,Pe){function te(Re){if(Re.type===3)return null;if(Re.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var Ee=Re.lower,Ne=Re.upper,Be=Re.lowerOpen,Re=Re.upperOpen;return Ee===void 0?Ne===void 0?null:q.upperBound(Ne,!!Re):Ne===void 0?q.lowerBound(Ee,!!Be):q.bound(Ee,Ne,!!Be,!!Re)}function ae(De){var Ee,Ne=De.name;return{name:Ne,schema:De,mutate:function(Be){var Re=Be.trans,Me=Be.type,He=Be.keys,ze=Be.values,$e=Be.range;return new Promise(function(st,bt){st=un(st);var _t=Re.objectStore(Ne),Ot=_t.keyPath==null,yt=Me==="put"||Me==="add";if(!yt&&Me!=="delete"&&Me!=="deleteRange")throw new Error("Invalid operation type: "+Me);var ni,Vt=(He||ze||{length:1}).length;if(He&&ze&&He.length!==ze.length)throw new Error("Given keys array must have same length as given values array.");if(Vt===0)return st({numFailures:0,failures:{},results:[],lastResult:void 0});function Rt(Ra){++Tr,Fr(Ra)}var oi=[],on=[],Tr=0;if(Me==="deleteRange"){if($e.type===4)return st({numFailures:Tr,failures:on,results:[],lastResult:void 0});$e.type===3?oi.push(ni=_t.clear()):oi.push(ni=_t.delete(te($e)))}else{var Ot=yt?Ot?[ze,He]:[ze,null]:[He,null],Vi=Ot[0],Cr=Ot[1];if(yt)for(var Xn=0;Xn<Vt;++Xn)oi.push(ni=Cr&&Cr[Xn]!==void 0?_t[Me](Vi[Xn],Cr[Xn]):_t[Me](Vi[Xn])),ni.onerror=Rt;else for(Xn=0;Xn<Vt;++Xn)oi.push(ni=_t[Me](Vi[Xn])),ni.onerror=Rt}function Hu(Ra){Ra=Ra.target.result,oi.forEach(function(Fd,VS){return Fd.error!=null&&(on[VS]=Fd.error)}),st({numFailures:Tr,failures:on,results:Me==="delete"?He:oi.map(function(Fd){return Fd.result}),lastResult:Ra})}ni.onerror=function(Ra){Rt(Ra),Hu(Ra)},ni.onsuccess=Hu})},getMany:function(Be){var Re=Be.trans,Me=Be.keys;return new Promise(function(He,ze){He=un(He);for(var $e,st=Re.objectStore(Ne),bt=Me.length,_t=new Array(bt),Ot=0,yt=0,ni=function(oi){oi=oi.target,_t[oi._pos]=oi.result,++yt===Ot&&He(_t)},Vt=Pa(ze),Rt=0;Rt<bt;++Rt)Me[Rt]!=null&&(($e=st.get(Me[Rt]))._pos=Rt,$e.onsuccess=ni,$e.onerror=Vt,++Ot);Ot===0&&He(_t)})},get:function(Be){var Re=Be.trans,Me=Be.key;return new Promise(function(He,ze){He=un(He);var $e=Re.objectStore(Ne).get(Me);$e.onsuccess=function(st){return He(st.target.result)},$e.onerror=Pa(ze)})},query:(Ee=ve,function(Be){return new Promise(function(Re,Me){Re=un(Re);var He,ze,$e,yt=Be.trans,st=Be.values,bt=Be.limit,Ot=Be.query,_t=bt===1/0?void 0:bt,ni=Ot.index,Ot=Ot.range,yt=yt.objectStore(Ne),yt=ni.isPrimaryKey?yt:yt.index(ni.name),ni=te(Ot);if(bt===0)return Re({result:[]});Ee?((Ot=st?yt.getAll(ni,_t):yt.getAllKeys(ni,_t)).onsuccess=function(Vt){return Re({result:Vt.target.result})},Ot.onerror=Pa(Me)):(He=0,ze=!st&&"openKeyCursor"in yt?yt.openKeyCursor(ni):yt.openCursor(ni),$e=[],ze.onsuccess=function(Vt){var Rt=ze.result;return!Rt||($e.push(st?Rt.value:Rt.primaryKey),++He===bt)?Re({result:$e}):void Rt.continue()},ze.onerror=Pa(Me))})}),openCursor:function(Be){var Re=Be.trans,Me=Be.values,He=Be.query,ze=Be.reverse,$e=Be.unique;return new Promise(function(st,bt){st=un(st);var yt=He.index,_t=He.range,Ot=Re.objectStore(Ne),Ot=yt.isPrimaryKey?Ot:Ot.index(yt.name),yt=ze?$e?"prevunique":"prev":$e?"nextunique":"next",ni=!Me&&"openKeyCursor"in Ot?Ot.openKeyCursor(te(_t),yt):Ot.openCursor(te(_t),yt);ni.onerror=Pa(bt),ni.onsuccess=un(function(Vt){var Rt,oi,on,Tr,Vi=ni.result;Vi?(Vi.___id=++Te,Vi.done=!1,Rt=Vi.continue.bind(Vi),oi=(oi=Vi.continuePrimaryKey)&&oi.bind(Vi),on=Vi.advance.bind(Vi),Tr=function(){throw new Error("Cursor not stopped")},Vi.trans=Re,Vi.stop=Vi.continue=Vi.continuePrimaryKey=Vi.advance=function(){throw new Error("Cursor not started")},Vi.fail=un(bt),Vi.next=function(){var Cr=this,Xn=1;return this.start(function(){return Xn--?Cr.continue():Cr.stop()}).then(function(){return Cr})},Vi.start=function(Cr){function Xn(){if(ni.result)try{Cr()}catch(Ra){Vi.fail(Ra)}else Vi.done=!0,Vi.start=function(){throw new Error("Cursor behind last entry")},Vi.stop()}var Hu=new Promise(function(Ra,Fd){Ra=un(Ra),ni.onerror=Pa(Fd),Vi.fail=Fd,Vi.stop=function(VS){Vi.stop=Vi.continue=Vi.continuePrimaryKey=Vi.advance=Tr,Ra(VS)}});return ni.onsuccess=un(function(Ra){ni.onsuccess=Xn,Xn()}),Vi.continue=Rt,Vi.continuePrimaryKey=oi,Vi.advance=on,Xn(),Hu},st(Vi)):st(null)},bt)})},count:function(Be){var Re=Be.query,Me=Be.trans,He=Re.index,ze=Re.range;return new Promise(function($e,st){var bt=Me.objectStore(Ne),bt=He.isPrimaryKey?bt:bt.index(He.name),_t=te(ze),_t=_t?bt.count(_t):bt.count();_t.onsuccess=un(function(Ot){return $e(Ot.target.result)}),_t.onerror=Pa(st)})}}}de=Pe,Ae=me((Pe=$).objectStoreNames);var de,Pe={schema:{name:Pe.name,tables:Ae.map(function(De){return de.objectStore(De)}).map(function(De){var Ee=De.keyPath,Ne=De.autoIncrement,Re=o(Ee),Be={},Re={name:De.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:Ee==null,compound:Re,keyPath:Ee,autoIncrement:Ne,unique:!0,extractKey:ee(Ee)},indexes:me(De.indexNames).map(function(Me){return De.index(Me)}).map(function($e){var st=$e.name,He=$e.unique,ze=$e.multiEntry,$e=$e.keyPath,st={name:st,compound:o($e),keyPath:$e,unique:He,multiEntry:ze,extractKey:ee($e)};return Be[at($e)]=st}),getIndexByKeyPath:function(Me){return Be[at(Me)]}};return Be[":id"]=Re.primaryKey,Ee!=null&&(Be[at(Ee)]=Re.primaryKey),Re})},hasGetAll:0<Ae.length&&"getAll"in de.objectStore(Ae[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},Ae=Pe.schema,ve=Pe.hasGetAll,Pe=Ae.tables.map(ae),Ve={};return Pe.forEach(function(De){return Ve[De.name]=De}),{stack:"dbcore",transaction:$.transaction.bind($),table:function(De){if(Ve[De])return Ve[De];throw new Error("Table '".concat(De,"' not found"))},MIN_KEY:-1/0,MAX_KEY:Dl(q),schema:Ae}}function Di($,q,Z,te){return Z=Z.IDBKeyRange,q=ir(q,Z,te),{dbcore:$.dbcore.reduce(function(ae,de){return de=de.create,r(r({},ae),de(ae))},q)}}function xr($,q){var Z=q.db,Z=Di($._middlewares,Z,$._deps,q);$.core=Z.dbcore,$.tables.forEach(function(te){var ae=te.name;$.core.schema.tables.some(function(de){return de.name===ae})&&(te.core=$.core.table(ae),$[ae]instanceof $.Table)&&($[ae].core=te.core)})}function Zt($,q,Z,te){Z.forEach(function(ae){var de=te[ae];q.forEach(function(Ae){var ve=(function Pe(Ve,De){return A(Ve,De)||(Ve=c(Ve))&&Pe(Ve,De)})(Ae,ae);(!ve||"value"in ve&&ve.value===void 0)&&(Ae===$.Transaction.prototype||Ae instanceof $.Transaction?h(Ae,ae,{get:function(){return this.table(ae)},set:function(Pe){f(this,ae,{value:Pe,writable:!0,configurable:!0,enumerable:!0})}}):Ae[ae]=new $.Table(ae,de))})})}function Na($,q){q.forEach(function(Z){for(var te in Z)Z[te]instanceof $.Table&&delete Z[te]})}function Ar($,q){return $._cfg.version-q._cfg.version}function cs($,q,Z,te){var ae=$._dbSchema,de=(Z.objectStoreNames.contains("$meta")&&!ae.$meta&&(ae.$meta=Ga("$meta",NA("")[0],[]),$._storeNames.push("$meta")),$._createTransaction("readwrite",$._storeNames,ae)),Ae=(de.create(Z),de._completion.catch(te),de._reject.bind(de)),ve=ye.transless||ye;Ho(function(){if(ye.trans=de,ye.transless=ve,q!==0)return xr($,Z),Ve=q,((Pe=de).storeNames.includes("$meta")?Pe.table("$meta").get("version").then(function(De){return De??Ve}):_e.resolve(Ve)).then(function(He){var Ee=$,Ne=He,Be=de,Re=Z,Me=[],He=Ee._versions,ze=Ee._dbSchema=mc(0,Ee.idbdb,Re);return(He=He.filter(function($e){return $e._cfg.version>=Ne})).length===0?_e.resolve():(He.forEach(function($e){Me.push(function(){var st,bt,_t,Ot=ze,yt=$e._cfg.dbschema,ni=(Fu(Ee,Ot,Re),Fu(Ee,yt,Re),ze=Ee._dbSchema=yt,Qa(Ot,yt)),Vt=(ni.add.forEach(function(Rt){us(Re,Rt[0],Rt[1].primKey,Rt[1].indexes)}),ni.change.forEach(function(Rt){if(Rt.recreate)throw new ie.Upgrade("Not yet support for changing primary key");var oi=Re.objectStore(Rt.name);Rt.add.forEach(function(on){return hc(oi,on)}),Rt.change.forEach(function(on){oi.deleteIndex(on.name),hc(oi,on)}),Rt.del.forEach(function(on){return oi.deleteIndex(on)})}),$e._cfg.contentUpgrade);if(Vt&&$e._cfg.version>Ne)return xr(Ee,Re),Be._memoizedTables={},st=T(yt),ni.del.forEach(function(Rt){st[Rt]=Ot[Rt]}),Na(Ee,[Ee.Transaction.prototype]),Zt(Ee,[Ee.Transaction.prototype],s(st),st),Be.schema=st,(bt=V(Vt))&&no(),yt=_e.follow(function(){var Rt;(_t=Vt(Be))&&bt&&(Rt=ao.bind(null,null),_t.then(Rt,Rt))}),_t&&typeof _t.then=="function"?_e.resolve(_t):yt.then(function(){return _t})}),Me.push(function(st){var bt,_t,Ot=$e._cfg.dbschema;bt=Ot,_t=st,[].slice.call(_t.db.objectStoreNames).forEach(function(yt){return bt[yt]==null&&_t.db.deleteObjectStore(yt)}),Na(Ee,[Ee.Transaction.prototype]),Zt(Ee,[Ee.Transaction.prototype],Ee._storeNames,Ee._dbSchema),Be.schema=Ee._dbSchema}),Me.push(function(st){Ee.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(Ee.idbdb.version/10)===$e._cfg.version?(Ee.idbdb.deleteObjectStore("$meta"),delete Ee._dbSchema.$meta,Ee._storeNames=Ee._storeNames.filter(function(bt){return bt!=="$meta"})):st.objectStore("$meta").put($e._cfg.version,"version"))})}),(function $e(){return Me.length?_e.resolve(Me.shift()(Be.idbtrans)).then($e):_e.resolve()})().then(function(){Vs(ze,Re)}))}).catch(Ae);var Pe,Ve;s(ae).forEach(function(De){us(Z,De,ae[De].primKey,ae[De].indexes)}),xr($,Z),_e.follow(function(){return $.on.populate.fire(de)}).catch(Ae)})}function Vo($,q){Vs($._dbSchema,q),q.db.version%10!=0||q.objectStoreNames.contains("$meta")||q.db.createObjectStore("$meta").add(Math.ceil(q.db.version/10-1),"version");var Z=mc(0,$.idbdb,q);Fu($,$._dbSchema,q);for(var te=0,ae=Qa(Z,$._dbSchema).change;te<ae.length;te++){var de=(Ae=>{if(Ae.change.length||Ae.recreate)return console.warn("Unable to patch indexes of table ".concat(Ae.name," because it has changes on the type of index or primary key.")),{value:void 0};var ve=q.objectStore(Ae.name);Ae.add.forEach(function(Pe){je&&console.debug("Dexie upgrade patch: Creating missing index ".concat(Ae.name,".").concat(Pe.src)),hc(ve,Pe)})})(ae[te]);if(typeof de=="object")return de.value}}function Qa($,q){var Z,te={del:[],add:[],change:[]};for(Z in $)q[Z]||te.del.push(Z);for(Z in q){var ae=$[Z],de=q[Z];if(ae){var Ae={name:Z,def:de,recreate:!1,del:[],add:[],change:[]};if(""+(ae.primKey.keyPath||"")!=""+(de.primKey.keyPath||"")||ae.primKey.auto!==de.primKey.auto)Ae.recreate=!0,te.change.push(Ae);else{var ve=ae.idxByName,Pe=de.idxByName,Ve=void 0;for(Ve in ve)Pe[Ve]||Ae.del.push(Ve);for(Ve in Pe){var De=ve[Ve],Ee=Pe[Ve];De?De.src!==Ee.src&&Ae.change.push(Ee):Ae.add.push(Ee)}(0<Ae.del.length||0<Ae.add.length||0<Ae.change.length)&&te.change.push(Ae)}}else te.add.push([Z,de])}return te}function us($,q,Z,te){var ae=$.db.createObjectStore(q,Z.keyPath?{keyPath:Z.keyPath,autoIncrement:Z.auto}:{autoIncrement:Z.auto});te.forEach(function(de){return hc(ae,de)})}function Vs($,q){s($).forEach(function(Z){q.db.objectStoreNames.contains(Z)||(je&&console.debug("Dexie: Creating missing table",Z),us(q,Z,$[Z].primKey,$[Z].indexes))})}function hc($,q){$.createIndex(q.name,q.keyPath,{unique:q.unique,multiEntry:q.multi})}function mc($,q,Z){var te={};return v(q.objectStoreNames,0).forEach(function(ae){for(var de=Z.objectStore(ae),Ae=Ip(Ou(Ve=de.keyPath),Ve||"",!0,!1,!!de.autoIncrement,Ve&&typeof Ve!="string",!0),ve=[],Pe=0;Pe<de.indexNames.length;++Pe){var De=de.index(de.indexNames[Pe]),Ve=De.keyPath,De=Ip(De.name,Ve,!!De.unique,!!De.multiEntry,!1,Ve&&typeof Ve!="string",!1);ve.push(De)}te[ae]=Ga(ae,Ae,ve)}),te}function Fu($,q,Z){for(var te=Z.db.objectStoreNames,ae=0;ae<te.length;++ae){var de=te[ae],Ae=Z.objectStore(de);$._hasGetAll="getAll"in Ae;for(var ve=0;ve<Ae.indexNames.length;++ve){var Pe,Ve=Ae.indexNames[ve],De=Ae.index(Ve).keyPath,De=typeof De=="string"?De:"["+v(De).join("+")+"]";q[de]&&(Pe=q[de].idxByName[De])&&(Pe.name=Ve,delete q[de].idxByName[De],q[de].idxByName[Ve]=Pe)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&a.WorkerGlobalScope&&a instanceof a.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&($._hasGetAll=!1)}function NA($){return $.split(",").map(function(q,Z){var ae=q.split(":"),te=(te=ae[1])==null?void 0:te.trim(),ae=(q=ae[0].trim()).replace(/([&*]|\+\+)/g,""),de=/^\[/.test(ae)?ae.match(/^\[(.*)\]$/)[1].split("+"):ae;return Ip(ae,de||null,/\&/.test(q),/\*/.test(q),/\+\+/.test(q),o(de),Z===0,te)})}Gs.prototype._createTableSchema=Ga,Gs.prototype._parseIndexSyntax=NA,Gs.prototype._parseStoresSpec=function($,q){var Z=this;s($).forEach(function(te){if($[te]!==null){var ae=Z._parseIndexSyntax($[te]),de=ae.shift();if(!de)throw new ie.Schema("Invalid schema for table "+te+": "+$[te]);if(de.unique=!0,de.multi)throw new ie.Schema("Primary key cannot be multiEntry*");ae.forEach(function(Ae){if(Ae.auto)throw new ie.Schema("Only primary key can be marked as autoIncrement (++)");if(!Ae.keyPath)throw new ie.Schema("Index must have a name and cannot be an empty string")}),de=Z._createTableSchema(te,de,ae),q[te]=de}})},Gs.prototype.stores=function(Z){var q=this.db,Z=(this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,Z):Z,q._versions),te={},ae={};return Z.forEach(function(de){l(te,de._cfg.storesSource),ae=de._cfg.dbschema={},de._parseStoresSpec(te,ae)}),q._dbSchema=ae,Na(q,[q._allTables,q,q.Transaction.prototype]),Zt(q,[q._allTables,q,q.Transaction.prototype,this._cfg.tables],s(ae),ae),q._storeNames=s(ae),this},Gs.prototype.upgrade=function($){return this._cfg.contentUpgrade=ft(this._cfg.contentUpgrade||ne,$),this};var hv=Gs;function Gs(){}function WE($,q){var Z=$._dbNamesDB;return Z||(Z=$._dbNamesDB=new Of(dc,{addons:[],indexedDB:$,IDBKeyRange:q})).version(1).stores({dbnames:"name"}),Z.table("dbnames")}function FS($){return $&&typeof $.databases=="function"}function wp($){return Ho(function(){return ye.letThrough=!0,$()})}function LS($){return!("from"in $)}var Go=function($,q){var Z;if(!this)return Z=new Go,$&&"d"in $&&l(Z,$),Z;l(this,arguments.length?{d:1,from:$,to:1<arguments.length?q:$}:{d:0})};function BA($,q,Z){var te=Xt(q,Z);if(!isNaN(te)){if(0<te)throw RangeError();if(LS($))return l($,{from:q,to:Z,d:1});var te=$.l,ae=$.r;if(Xt(Z,$.from)<0)return te?BA(te,q,Z):$.l={from:q,to:Z,d:1,l:null,r:null},QN($);if(0<Xt(q,$.to))return ae?BA(ae,q,Z):$.r={from:q,to:Z,d:1,l:null,r:null},QN($);Xt(q,$.from)<0&&($.from=q,$.l=null,$.d=ae?ae.d+1:1),0<Xt(Z,$.to)&&($.to=Z,$.r=null,$.d=$.l?$.l.d+1:1),q=!$.r,te&&!$.l&&Ob($,te),ae&&q&&Ob($,ae)}}function Ob($,q){LS(q)||(function Z(te,ae){var de=ae.from,Ae=ae.l,ve=ae.r;BA(te,de,ae.to),Ae&&Z(te,Ae),ve&&Z(te,ve)})($,q)}function KE($,q){var Z=Fb(q),te=Z.next();if(!te.done)for(var ae=te.value,de=Fb($),Ae=de.next(ae.from),ve=Ae.value;!te.done&&!Ae.done;){if(Xt(ve.from,ae.to)<=0&&0<=Xt(ve.to,ae.from))return!0;Xt(ae.from,ve.from)<0?ae=(te=Z.next(ve.from)).value:ve=(Ae=de.next(ae.from)).value}return!1}function Fb($){var q=LS($)?null:{s:0,n:$};return{next:function(Z){for(var te=0<arguments.length;q;)switch(q.s){case 0:if(q.s=1,te)for(;q.n.l&&Xt(Z,q.n.from)<0;)q={up:q,n:q.n.l,s:1};else for(;q.n.l;)q={up:q,n:q.n.l,s:1};case 1:if(q.s=2,!te||Xt(Z,q.n.to)<=0)return{value:q.n,done:!1};case 2:if(q.n.r){q.s=3,q={up:q,n:q.n.r,s:0};continue}case 3:q=q.up}return{done:!0}}}}function QN($){var q,Z,te,ae=(((ae=$.r)==null?void 0:ae.d)||0)-(((ae=$.l)==null?void 0:ae.d)||0),ae=1<ae?"r":ae<-1?"l":"";ae&&(q=ae=="r"?"l":"r",Z=r({},$),te=$[ae],$.from=te.from,$.to=te.to,$[ae]=te[ae],Z[ae]=te[q],($[q]=Z).d=jN(Z)),$.d=jN($)}function jN(Z){var q=Z.r,Z=Z.l;return(q?Z?Math.max(q.d,Z.d):q.d:Z?Z.d:0)+1}function mv($,q){return s(q).forEach(function(Z){$[Z]?Ob($[Z],q[Z]):$[Z]=(function te(ae){var de,Ae,ve={};for(de in ae)d(ae,de)&&(Ae=ae[de],ve[de]=!Ae||typeof Ae!="object"||E.has(Ae.constructor)?Ae:te(Ae));return ve})(q[Z])}),$}function YE($,q){return $.all||q.all||Object.keys($).some(function(Z){return q[Z]&&KE(q[Z],$[Z])})}p(Go.prototype,((lt={add:function($){return Ob(this,$),this},addKey:function($){return BA(this,$,$),this},addKeys:function($){var q=this;return $.forEach(function(Z){return BA(q,Z,Z)}),this},hasKey:function($){var q=Fb(this).next($).value;return q&&Xt(q.from,$)<=0&&0<=Xt(q.to,$)}})[k]=function(){return Fb(this)},lt));var rm={},$S={},Av=!1;function Sp($){mv($S,$),Av||(Av=!0,setTimeout(function(){Av=!1,XE($S,!($S={}))},0))}function XE($,q){q===void 0&&(q=!1);var Z=new Set;if($.all)for(var te=0,ae=Object.values(rm);te<ae.length;te++)gv(ve=ae[te],$,Z,q);else for(var de in $){var Ae,ve,de=/^idb\:\/\/(.*)\/(.*)\//.exec(de);de&&(Ae=de[1],de=de[2],ve=rm["idb://".concat(Ae,"/").concat(de)])&&gv(ve,$,Z,q)}Z.forEach(function(Pe){return Pe()})}function gv($,q,Z,te){for(var ae=[],de=0,Ae=Object.entries($.queries.query);de<Ae.length;de++){for(var ve=Ae[de],Pe=ve[0],Ve=[],De=0,Ee=ve[1];De<Ee.length;De++){var Ne=Ee[De];YE(q,Ne.obsSet)?Ne.subscribers.forEach(function(He){return Z.add(He)}):te&&Ve.push(Ne)}te&&ae.push([Pe,Ve])}if(te)for(var Be=0,Re=ae;Be<Re.length;Be++){var Me=Re[Be],Pe=Me[0],Ve=Me[1];$.queries.query[Pe]=Ve}}function Lu($){var q=$._state,Z=$._deps.indexedDB;if(q.isBeingOpened||$.idbdb)return q.dbReadyPromise.then(function(){return q.dbOpenError?Kn(q.dbOpenError):$});q.isBeingOpened=!0,q.dbOpenError=null,q.openComplete=!1;var te=q.openCanceller,ae=Math.round(10*$.verno),de=!1;function Ae(){if(q.openCanceller!==te)throw new ie.DatabaseClosed("db.open() was cancelled")}function ve(){return new _e(function(Ne,Be){if(Ae(),!Z)throw new ie.MissingAPI;var Re=$.name,Me=q.autoSchema||!ae?Z.open(Re):Z.open(Re,ae);if(!Me)throw new ie.MissingAPI;Me.onerror=Pa(Be),Me.onblocked=un($._fireOnBlocked),Me.onupgradeneeded=un(function(He){var ze;De=Me.transaction,q.autoSchema&&!$._options.allowEmptyDB?(Me.onerror=Fr,De.abort(),Me.result.close(),(ze=Z.deleteDatabase(Re)).onsuccess=ze.onerror=un(function(){Be(new ie.NoSuchDatabase("Database ".concat(Re," doesnt exist")))})):(De.onerror=Pa(Be),ze=He.oldVersion>Math.pow(2,62)?0:He.oldVersion,Ee=ze<1,$.idbdb=Me.result,de&&Vo($,De),cs($,ze/10,De,Be))},Be),Me.onsuccess=un(function(){De=null;var He,ze,$e,st,bt,_t,Ot=$.idbdb=Me.result,yt=v(Ot.objectStoreNames);if(0<yt.length)try{var ni=Ot.transaction((bt=yt).length===1?bt[0]:bt,"readonly");if(q.autoSchema)_t=Ot,st=ni,($e=$).verno=_t.version/10,st=$e._dbSchema=mc(0,_t,st),$e._storeNames=v(_t.objectStoreNames,0),Zt($e,[$e._allTables],s(st),st);else if(Fu($,$._dbSchema,ni),ze=ni,((ze=Qa(mc(0,(He=$).idbdb,ze),He._dbSchema)).add.length||ze.change.some(function(Vt){return Vt.add.length||Vt.change.length}))&&!de)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Ot.close(),ae=Ot.version+1,de=!0,Ne(ve());xr($,ni)}catch{}uc.push($),Ot.onversionchange=un(function(Vt){q.vcFired=!0,$.on("versionchange").fire(Vt)}),Ot.onclose=un(function(){$.close({disableAutoOpen:!1})}),Ee&&(yt=$._deps,bt=Re,FS(_t=yt.indexedDB)||bt===dc||WE(_t,yt.IDBKeyRange).put({name:bt}).catch(ne)),Ne()},Be)}).catch(function(Ne){switch(Ne?.name){case"UnknownError":if(0<q.PR1398_maxLoop)return q.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),ve();break;case"VersionError":if(0<ae)return ae=0,ve()}return _e.reject(Ne)})}var Pe,Ve=q.dbReadyResolve,De=null,Ee=!1;return _e.race([te,(typeof navigator>"u"?_e.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(Ne){function Be(){return indexedDB.databases().finally(Ne)}Pe=setInterval(Be,100),Be()}).finally(function(){return clearInterval(Pe)}):Promise.resolve()).then(ve)]).then(function(){return Ae(),q.onReadyBeingFired=[],_e.resolve(wp(function(){return $.on.ready.fire($.vip)})).then(function Ne(){var Be;if(0<q.onReadyBeingFired.length)return Be=q.onReadyBeingFired.reduce(ft,ne),q.onReadyBeingFired=[],_e.resolve(wp(function(){return Be($.vip)})).then(Ne)})}).finally(function(){q.openCanceller===te&&(q.onReadyBeingFired=null,q.isBeingOpened=!1)}).catch(function(Ne){q.dbOpenError=Ne;try{De&&De.abort()}catch{}return te===q.openCanceller&&$._close(),Kn(Ne)}).finally(function(){q.openComplete=!0,Ve()}).then(function(){var Ne;return Ee&&(Ne={},$.tables.forEach(function(Be){Be.schema.indexes.forEach(function(Re){Re.name&&(Ne["idb://".concat($.name,"/").concat(Be.name,"/").concat(Re.name)]=new Go(-1/0,[[[]]]))}),Ne["idb://".concat($.name,"/").concat(Be.name,"/")]=Ne["idb://".concat($.name,"/").concat(Be.name,"/:dels")]=new Go(-1/0,[[[]]])}),sl(yp).fire(Ne),XE(Ne,!0)),$})}function HS($){function q(de){return $.next(de)}var Z=ae(q),te=ae(function(de){return $.throw(de)});function ae(de){return function(ve){var ve=de(ve),Pe=ve.value;return ve.done?Pe:Pe&&typeof Pe.then=="function"?Pe.then(Z,te):o(Pe)?Promise.all(Pe).then(Z,te):Z(Pe)}}return ae(q)()}function Lb($,q,Z){for(var te=o($)?$.slice():[$],ae=0;ae<Z;++ae)te.push(q);return te}var dV={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function($){return r(r({},$),{table:function(te){var Z=$.table(te),te=Z.schema,ae={},de=[];function Ae(Ne,Be,Re){var $e=at(Ne),Me=ae[$e]=ae[$e]||[],He=Ne==null?0:typeof Ne=="string"?1:Ne.length,ze=0<Be,$e=r(r({},Re),{name:ze?"".concat($e,"(virtual-from:").concat(Re.name,")"):Re.name,lowLevelIndex:Re,isVirtual:ze,keyTail:Be,keyLength:He,extractKey:ee(Ne),unique:!ze&&Re.unique});return Me.push($e),$e.isPrimaryKey||de.push($e),1<He&&Ae(He===2?Ne[0]:Ne.slice(0,He-1),Be+1,Re),Me.sort(function(st,bt){return st.keyTail-bt.keyTail}),$e}var ve=Ae(te.primaryKey.keyPath,0,te.primaryKey);ae[":id"]=[ve];for(var Pe=0,Ve=te.indexes;Pe<Ve.length;Pe++){var De=Ve[Pe];Ae(De.keyPath,0,De)}function Ee(Ne){var Be,Re=Ne.query.index;return Re.isVirtual?r(r({},Ne),{query:{index:Re.lowLevelIndex,range:(Be=Ne.query.range,Re=Re.keyTail,{type:Be.type===1?2:Be.type,lower:Lb(Be.lower,Be.lowerOpen?$.MAX_KEY:$.MIN_KEY,Re),lowerOpen:!0,upper:Lb(Be.upper,Be.upperOpen?$.MIN_KEY:$.MAX_KEY,Re),upperOpen:!0})}}):Ne}return r(r({},Z),{schema:r(r({},te),{primaryKey:ve,indexes:de,getIndexByKeyPath:function(Ne){return(Ne=ae[at(Ne)])&&Ne[0]}}),count:function(Ne){return Z.count(Ee(Ne))},query:function(Ne){return Z.query(Ee(Ne))},openCursor:function(Ne){var Be=Ne.query.index,Re=Be.keyTail,Me=Be.keyLength;return Be.isVirtual?Z.openCursor(Ee(Ne)).then(function(ze){return ze&&He(ze)}):Z.openCursor(Ne);function He(ze){return Object.create(ze,{continue:{value:function($e){$e!=null?ze.continue(Lb($e,Ne.reverse?$.MAX_KEY:$.MIN_KEY,Re)):Ne.unique?ze.continue(ze.key.slice(0,Me).concat(Ne.reverse?$.MIN_KEY:$.MAX_KEY,Re)):ze.continue()}},continuePrimaryKey:{value:function($e,st){ze.continuePrimaryKey(Lb($e,$.MAX_KEY,Re),st)}},primaryKey:{get:function(){return ze.primaryKey}},key:{get:function(){var $e=ze.key;return Me===1?$e[0]:$e.slice(0,Me)}},value:{get:function(){return ze.value}}})}}})}})}};function $b($,q,Z,te){return Z=Z||{},te=te||"",s($).forEach(function(ae){var de,Ae,ve;d(q,ae)?(de=$[ae],Ae=q[ae],typeof de=="object"&&typeof Ae=="object"&&de&&Ae?(ve=N(de))!==N(Ae)?Z[te+ae]=q[ae]:ve==="Object"?$b(de,Ae,Z,te+ae+"."):de!==Ae&&(Z[te+ae]=q[ae]):de!==Ae&&(Z[te+ae]=q[ae])):Z[te+ae]=void 0}),s(q).forEach(function(ae){d($,ae)||(Z[te+ae]=q[ae])}),Z}function Hb($,q){return q.type==="delete"?q.keys:q.keys||q.values.map($.extractKey)}var pV={stack:"dbcore",name:"HooksMiddleware",level:2,create:function($){return r(r({},$),{table:function(q){var Z=$.table(q),te=Z.schema.primaryKey;return r(r({},Z),{mutate:function(ae){var de=ye.trans,Ae=de.table(q).hook,ve=Ae.deleting,Pe=Ae.creating,Ve=Ae.updating;switch(ae.type){case"add":if(Pe.fire===ne)break;return de._promise("readwrite",function(){return De(ae)},!0);case"put":if(Pe.fire===ne&&Ve.fire===ne)break;return de._promise("readwrite",function(){return De(ae)},!0);case"delete":if(ve.fire===ne)break;return de._promise("readwrite",function(){return De(ae)},!0);case"deleteRange":if(ve.fire===ne)break;return de._promise("readwrite",function(){return(function Ee(Ne,Be,Re){return Z.query({trans:Ne,values:!1,query:{index:te,range:Be},limit:Re}).then(function(Me){var He=Me.result;return De({type:"delete",keys:He,trans:Ne}).then(function(ze){return 0<ze.numFailures?Promise.reject(ze.failures[0]):He.length<Re?{failures:[],numFailures:0,lastResult:void 0}:Ee(Ne,r(r({},Be),{lower:He[He.length-1],lowerOpen:!0}),Re)})})})(ae.trans,ae.range,1e4)},!0)}return Z.mutate(ae);function De(Ee){var Ne,Be,Re,Me=ye.trans,He=Ee.keys||Hb(te,Ee);if(He)return(Ee=Ee.type==="add"||Ee.type==="put"?r(r({},Ee),{keys:He}):r({},Ee)).type!=="delete"&&(Ee.values=n([],Ee.values)),Ee.keys&&(Ee.keys=n([],Ee.keys)),Ne=Z,Re=He,((Be=Ee).type==="add"?Promise.resolve([]):Ne.getMany({trans:Be.trans,keys:Re,cache:"immutable"})).then(function(ze){var $e=He.map(function(st,bt){var _t,Ot,yt,ni=ze[bt],Vt={onerror:null,onsuccess:null};return Ee.type==="delete"?ve.fire.call(Vt,st,ni,Me):Ee.type==="add"||ni===void 0?(_t=Pe.fire.call(Vt,st,Ee.values[bt],Me),st==null&&_t!=null&&(Ee.keys[bt]=st=_t,te.outbound||S(Ee.values[bt],te.keyPath,st))):(_t=$b(ni,Ee.values[bt]),(Ot=Ve.fire.call(Vt,_t,st,ni,Me))&&(yt=Ee.values[bt],Object.keys(Ot).forEach(function(Rt){d(yt,Rt)?yt[Rt]=Ot[Rt]:S(yt,Rt,Ot[Rt])}))),Vt});return Z.mutate(Ee).then(function(st){for(var bt=st.failures,_t=st.results,Ot=st.numFailures,st=st.lastResult,yt=0;yt<He.length;++yt){var ni=(_t||He)[yt],Vt=$e[yt];ni==null?Vt.onerror&&Vt.onerror(bt[yt]):Vt.onsuccess&&Vt.onsuccess(Ee.type==="put"&&ze[yt]?Ee.values[yt]:ni)}return{failures:bt,results:_t,numFailures:Ot,lastResult:st}}).catch(function(st){return $e.forEach(function(bt){return bt.onerror&&bt.onerror(st)}),Promise.reject(st)})});throw new Error("Keys missing")}}})}})}};function zN($,q,Z){try{if(!q||q.keys.length<$.length)return null;for(var te=[],ae=0,de=0;ae<q.keys.length&&de<$.length;++ae)Xt(q.keys[ae],$[de])===0&&(te.push(Z?R(q.values[ae]):q.values[ae]),++de);return te.length===$.length?te:null}catch{return null}}var qN={stack:"dbcore",level:-1,create:function($){return{table:function(q){var Z=$.table(q);return r(r({},Z),{getMany:function(te){var ae;return te.cache?(ae=zN(te.keys,te.trans._cache,te.cache==="clone"))?_e.resolve(ae):Z.getMany(te).then(function(de){return te.trans._cache={keys:te.keys,values:te.cache==="clone"?R(de):de},de}):Z.getMany(te)},mutate:function(te){return te.type!=="add"&&(te.trans._cache=null),Z.mutate(te)}})}}}};function WN($,q){return $.trans.mode==="readonly"&&!!$.subscr&&!$.trans.explicit&&$.trans.db._options.cache!=="disabled"&&!q.schema.primaryKey.outbound}function $u($,q){switch($){case"query":return q.values&&!q.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var vv={stack:"dbcore",level:0,name:"Observability",create:function($){var q=$.schema.name,Z=new Go($.MIN_KEY,$.MAX_KEY);return r(r({},$),{transaction:function(te,ae,de){if(ye.subscr&&ae!=="readonly")throw new ie.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(ye.querier));return $.transaction(te,ae,de)},table:function(te){function ae(He){var Me,He=He.query;return[Me=He.index,new Go((Me=(He=He.range).lower)!=null?Me:$.MIN_KEY,(Me=He.upper)!=null?Me:$.MAX_KEY)]}var de=$.table(te),Ae=de.schema,ve=Ae.primaryKey,Pe=Ae.indexes,Ve=ve.extractKey,De=ve.outbound,Ee=ve.autoIncrement&&Pe.filter(function(Re){return Re.compound&&Re.keyPath.includes(ve.keyPath)}),Ne=r(r({},de),{mutate:function(Re){function Me(oi){return oi="idb://".concat(q,"/").concat(te,"/").concat(oi),bt[oi]||(bt[oi]=new Go)}var He,ze,$e,st=Re.trans,bt=Re.mutatedParts||(Re.mutatedParts={}),_t=Me(""),Ot=Me(":dels"),yt=Re.type,Vt=Re.type==="deleteRange"?[Re.range]:Re.type==="delete"?[Re.keys]:Re.values.length<50?[Hb(ve,Re).filter(function(oi){return oi}),Re.values]:[],ni=Vt[0],Vt=Vt[1],Rt=Re.trans._cache;return o(ni)?(_t.addKeys(ni),(yt=yt==="delete"||ni.length===Vt.length?zN(ni,Rt):null)||Ot.addKeys(ni),(yt||Vt)&&(He=Me,ze=yt,$e=Vt,Ae.indexes.forEach(function(oi){var on=He(oi.name||"");function Tr(Cr){return Cr!=null?oi.extractKey(Cr):null}function Vi(Cr){oi.multiEntry&&o(Cr)?Cr.forEach(function(Xn){return on.addKey(Xn)}):on.addKey(Cr)}(ze||$e).forEach(function(Cr,Ra){var Hu=ze&&Tr(ze[Ra]),Ra=$e&&Tr($e[Ra]);Xt(Hu,Ra)!==0&&(Hu!=null&&Vi(Hu),Ra!=null)&&Vi(Ra)})}))):ni?(Vt={from:(Rt=ni.lower)!=null?Rt:$.MIN_KEY,to:(yt=ni.upper)!=null?yt:$.MAX_KEY},Ot.add(Vt),_t.add(Vt)):(_t.add(Z),Ot.add(Z),Ae.indexes.forEach(function(oi){return Me(oi.name).add(Z)})),de.mutate(Re).then(function(oi){return!ni||Re.type!=="add"&&Re.type!=="put"||(_t.addKeys(oi.results),Ee&&Ee.forEach(function(on){for(var Tr=Re.values.map(function(Hu){return on.extractKey(Hu)}),Vi=on.keyPath.findIndex(function(Hu){return Hu===ve.keyPath}),Cr=0,Xn=oi.results.length;Cr<Xn;++Cr)Tr[Cr][Vi]=oi.results[Cr];Me(on.name).addKeys(Tr)})),st.mutatedParts=mv(st.mutatedParts||{},bt),oi})}}),Be={get:function(Re){return[ve,new Go(Re.key)]},getMany:function(Re){return[ve,new Go().addKeys(Re.keys)]},count:ae,query:ae,openCursor:ae};return s(Be).forEach(function(Re){Ne[Re]=function(Me){var He=ye.subscr,ze=!!He,$e=WN(ye,de)&&$u(Re,Me)?Me.obsSet={}:He;if(ze){var st,He=function(Vt){return Vt="idb://".concat(q,"/").concat(te,"/").concat(Vt),$e[Vt]||($e[Vt]=new Go)},bt=He(""),_t=He(":dels"),ze=Be[Re](Me),Ot=ze[0],ze=ze[1];if((Re==="query"&&Ot.isPrimaryKey&&!Me.values?_t:He(Ot.name||"")).add(ze),!Ot.isPrimaryKey){if(Re!=="count")return st=Re==="query"&&De&&Me.values&&de.query(r(r({},Me),{values:!1})),de[Re].apply(this,arguments).then(function(Vt){if(Re==="query"){if(De&&Me.values)return st.then(function(Tr){return Tr=Tr.result,bt.addKeys(Tr),Vt});var Rt=Me.values?Vt.result.map(Ve):Vt.result;(Me.values?bt:_t).addKeys(Rt)}else{var oi,on;if(Re==="openCursor")return on=Me.values,(oi=Vt)&&Object.create(oi,{key:{get:function(){return _t.addKey(oi.primaryKey),oi.key}},primaryKey:{get:function(){var Tr=oi.primaryKey;return _t.addKey(Tr),Tr}},value:{get:function(){return on&&bt.addKey(oi.primaryKey),oi.value}}})}return Vt});_t.add(Z)}}return de[Re].apply(this,arguments)}}),Ne}})}};function KN($,q,Z){var te;return Z.numFailures===0?q:q.type==="deleteRange"||(te=q.keys?q.keys.length:"values"in q&&q.values?q.values.length:1,Z.numFailures===te)?null:(te=r({},q),o(te.keys)&&(te.keys=te.keys.filter(function(ae,de){return!(de in Z.failures)})),"values"in te&&o(te.values)&&(te.values=te.values.filter(function(ae,de){return!(de in Z.failures)})),te)}function Od($,q){return Z=$,((te=q).lower===void 0||(te.lowerOpen?0<Xt(Z,te.lower):0<=Xt(Z,te.lower)))&&(Z=$,(te=q).upper===void 0||(te.upperOpen?Xt(Z,te.upper)<0:Xt(Z,te.upper)<=0));var Z,te}function YN($,q,Z,te,ae,de){var Ae,ve,Pe,Ve,De,Ee;return!Z||Z.length===0||(Ae=q.query.index,ve=Ae.multiEntry,Pe=q.query.range,Ve=te.schema.primaryKey.extractKey,De=Ae.extractKey,Ee=(Ae.lowLevelIndex||Ae).extractKey,(te=Z.reduce(function(Ne,Be){var Re=Ne,Me=[];if(Be.type==="add"||Be.type==="put")for(var He=new Go,ze=Be.values.length-1;0<=ze;--ze){var $e,st=Be.values[ze],bt=Ve(st);!He.hasKey(bt)&&($e=De(st),ve&&o($e)?$e.some(function(Vt){return Od(Vt,Pe)}):Od($e,Pe))&&(He.addKey(bt),Me.push(st))}switch(Be.type){case"add":var _t=new Go().addKeys(q.values?Ne.map(function(Rt){return Ve(Rt)}):Ne),Re=Ne.concat(q.values?Me.filter(function(Rt){return Rt=Ve(Rt),!_t.hasKey(Rt)&&(_t.addKey(Rt),!0)}):Me.map(function(Rt){return Ve(Rt)}).filter(function(Rt){return!_t.hasKey(Rt)&&(_t.addKey(Rt),!0)}));break;case"put":var Ot=new Go().addKeys(Be.values.map(function(Rt){return Ve(Rt)}));Re=Ne.filter(function(Rt){return!Ot.hasKey(q.values?Ve(Rt):Rt)}).concat(q.values?Me:Me.map(function(Rt){return Ve(Rt)}));break;case"delete":var yt=new Go().addKeys(Be.keys);Re=Ne.filter(function(Rt){return!yt.hasKey(q.values?Ve(Rt):Rt)});break;case"deleteRange":var ni=Be.range;Re=Ne.filter(function(Rt){return!Od(Ve(Rt),ni)})}return Re},$))===$)?$:(te.sort(function(Ne,Be){return Xt(Ee(Ne),Ee(Be))||Xt(Ve(Ne),Ve(Be))}),q.limit&&q.limit<1/0&&(te.length>q.limit?te.length=q.limit:$.length===q.limit&&te.length<q.limit&&(ae.dirty=!0)),de?Object.freeze(te):te)}function kA($,q){return Xt($.lower,q.lower)===0&&Xt($.upper,q.upper)===0&&!!$.lowerOpen==!!q.lowerOpen&&!!$.upperOpen==!!q.upperOpen}function fV($,q){return((Z,te,ae,de)=>{if(Z===void 0)return te!==void 0?-1:0;if(te===void 0)return 1;if((Z=Xt(Z,te))===0){if(ae&&de)return 0;if(ae)return 1;if(de)return-1}return Z})($.lower,q.lower,$.lowerOpen,q.lowerOpen)<=0&&0<=((Z,te,ae,de)=>{if(Z===void 0)return te!==void 0?1:0;if(te===void 0)return-1;if((Z=Xt(Z,te))===0){if(ae&&de)return 0;if(ae)return-1;if(de)return 1}return Z})($.upper,q.upper,$.upperOpen,q.upperOpen)}function Vb($,q,Z,te){$.subscribers.add(Z),te.addEventListener("abort",function(){var ae,de;$.subscribers.delete(Z),$.subscribers.size===0&&(ae=$,de=q,setTimeout(function(){ae.subscribers.size===0&&x(de,ae)},3e3))})}var XN={stack:"dbcore",level:0,name:"Cache",create:function($){var q=$.schema.name;return r(r({},$),{transaction:function(Z,te,ae){var de,Ae,ve=$.transaction(Z,te,ae);return te==="readwrite"&&(ae=(de=new AbortController).signal,ve.addEventListener("abort",(Ae=function(Pe){return function(){if(de.abort(),te==="readwrite"){for(var Ve=new Set,De=0,Ee=Z;De<Ee.length;De++){var Ne=Ee[De],Be=rm["idb://".concat(q,"/").concat(Ne)];if(Be){var Re=$.table(Ne),Me=Be.optimisticOps.filter(function(oi){return oi.trans===ve});if(ve._explicit&&Pe&&ve.mutatedParts)for(var He=0,ze=Object.values(Be.queries.query);He<ze.length;He++)for(var $e=0,st=(Ot=ze[He]).slice();$e<st.length;$e++)YE((yt=st[$e]).obsSet,ve.mutatedParts)&&(x(Ot,yt),yt.subscribers.forEach(function(oi){return Ve.add(oi)}));else if(0<Me.length){Be.optimisticOps=Be.optimisticOps.filter(function(oi){return oi.trans!==ve});for(var bt=0,_t=Object.values(Be.queries.query);bt<_t.length;bt++)for(var Ot,yt,ni,Vt=0,Rt=(Ot=_t[bt]).slice();Vt<Rt.length;Vt++)(yt=Rt[Vt]).res!=null&&ve.mutatedParts&&(Pe&&!yt.dirty?(ni=Object.isFrozen(yt.res),ni=YN(yt.res,yt.req,Me,Re,yt,ni),yt.dirty?(x(Ot,yt),yt.subscribers.forEach(function(oi){return Ve.add(oi)})):ni!==yt.res&&(yt.res=ni,yt.promise=_e.resolve({result:ni}))):(yt.dirty&&x(Ot,yt),yt.subscribers.forEach(function(oi){return Ve.add(oi)})))}}}Ve.forEach(function(oi){return oi()})}}})(!1),{signal:ae}),ve.addEventListener("error",Ae(!1),{signal:ae}),ve.addEventListener("complete",Ae(!0),{signal:ae})),ve},table:function(Z){var te=$.table(Z),ae=te.schema.primaryKey;return r(r({},te),{mutate:function(de){var Ae,ve=ye.trans;return!ae.outbound&&ve.db._options.cache!=="disabled"&&!ve.explicit&&ve.idbtrans.mode==="readwrite"&&(Ae=rm["idb://".concat(q,"/").concat(Z)])?(ve=te.mutate(de),de.type!=="add"&&de.type!=="put"||!(50<=de.values.length||Hb(ae,de).some(function(Pe){return Pe==null}))?(Ae.optimisticOps.push(de),de.mutatedParts&&Sp(de.mutatedParts),ve.then(function(Pe){0<Pe.numFailures&&(x(Ae.optimisticOps,de),(Pe=KN(0,de,Pe))&&Ae.optimisticOps.push(Pe),de.mutatedParts)&&Sp(de.mutatedParts)}),ve.catch(function(){x(Ae.optimisticOps,de),de.mutatedParts&&Sp(de.mutatedParts)})):ve.then(function(Pe){var Ve=KN(0,r(r({},de),{values:de.values.map(function(De,Ee){var Ne;return Pe.failures[Ee]?De:(S(Ne=(Ne=ae.keyPath)!=null&&Ne.includes(".")?R(De):r({},De),ae.keyPath,Pe.results[Ee]),Ne)})}),Pe);Ae.optimisticOps.push(Ve),queueMicrotask(function(){return de.mutatedParts&&Sp(de.mutatedParts)})}),ve):te.mutate(de)},query:function(de){var Ae,ve,Pe,Ve,De,Ee,Ne;return WN(ye,te)&&$u("query",de)?(Ae=((Pe=ye.trans)==null?void 0:Pe.db._options.cache)==="immutable",ve=(Pe=ye).requery,Pe=Pe.signal,Ee=((Be,Re,Me,He)=>{var ze=rm["idb://".concat(Be,"/").concat(Re)];if(!ze)return[];if(!(Be=ze.queries[Me]))return[null,!1,ze,null];var $e=Be[(He.query?He.query.index.name:null)||""];if(!$e)return[null,!1,ze,null];switch(Me){case"query":var st=$e.find(function(bt){return bt.req.limit===He.limit&&bt.req.values===He.values&&kA(bt.req.query.range,He.query.range)});return st?[st,!0,ze,$e]:[$e.find(function(bt){return("limit"in bt.req?bt.req.limit:1/0)>=He.limit&&(!He.values||bt.req.values)&&fV(bt.req.query.range,He.query.range)}),!1,ze,$e];case"count":return st=$e.find(function(bt){return kA(bt.req.query.range,He.query.range)}),[st,!!st,ze,$e]}})(q,Z,"query",de),Ne=Ee[0],Ve=Ee[2],De=Ee[3],Ne&&Ee[1]?Ne.obsSet=de.obsSet:(Ee=te.query(de).then(function(Be){var Re=Be.result;if(Ne&&(Ne.res=Re),Ae){for(var Me=0,He=Re.length;Me<He;++Me)Object.freeze(Re[Me]);Object.freeze(Re)}else Be.result=R(Re);return Be}).catch(function(Be){return De&&Ne&&x(De,Ne),Promise.reject(Be)}),Ne={obsSet:de.obsSet,promise:Ee,subscribers:new Set,type:"query",req:de,dirty:!1},De?De.push(Ne):(De=[Ne],(Ve=Ve||(rm["idb://".concat(q,"/").concat(Z)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[de.query.index.name||""]=De)),Vb(Ne,De,ve,Pe),Ne.promise.then(function(Be){return{result:YN(Be.result,de,Ve?.optimisticOps,te,Ne,Ae)}})):te.query(de)}})}})}};function xA($,q){return new Proxy($,{get:function(Z,te,ae){return te==="db"?q:Reflect.get(Z,te,ae)}})}jn.prototype.version=function($){if(isNaN($)||$<.1)throw new ie.Type("Given version is not a positive number");if($=Math.round(10*$)/10,this.idbdb||this._state.isBeingOpened)throw new ie.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,$);var q=this._versions,Z=q.filter(function(te){return te._cfg.version===$})[0];return Z||(Z=new this.Version($),q.push(Z),q.sort(Ar),Z.stores({}),this._state.autoSchema=!1),Z},jn.prototype._whenReady=function($){var q=this;return this.idbdb&&(this._state.openComplete||ye.letThrough||this._vip)?$():new _e(function(Z,te){if(q._state.openComplete)return te(new ie.DatabaseClosed(q._state.dbOpenError));if(!q._state.isBeingOpened){if(!q._state.autoOpen)return void te(new ie.DatabaseClosed);q.open().catch(ne)}q._state.dbReadyPromise.then(Z,te)}).then($)},jn.prototype.use=function(ae){var q=ae.stack,Z=ae.create,te=ae.level,ae=ae.name,de=(ae&&this.unuse({stack:q,name:ae}),this._middlewares[q]||(this._middlewares[q]=[]));return de.push({stack:q,create:Z,level:te??10,name:ae}),de.sort(function(Ae,ve){return Ae.level-ve.level}),this},jn.prototype.unuse=function($){var q=$.stack,Z=$.name,te=$.create;return q&&this._middlewares[q]&&(this._middlewares[q]=this._middlewares[q].filter(function(ae){return te?ae.create!==te:!!Z&&ae.name!==Z})),this},jn.prototype.open=function(){var $=this;return Qc(Se,function(){return Lu($)})},jn.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var $=this._state,q=uc.indexOf(this);if(0<=q&&uc.splice(q,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}$.isBeingOpened||($.dbReadyPromise=new _e(function(Z){$.dbReadyResolve=Z}),$.openCanceller=new _e(function(Z,te){$.cancelOpen=te}))},jn.prototype.close=function(q){var q=(q===void 0?{disableAutoOpen:!0}:q).disableAutoOpen,Z=this._state;q?(Z.isBeingOpened&&Z.cancelOpen(new ie.DatabaseClosed),this._close(),Z.autoOpen=!1,Z.dbOpenError=new ie.DatabaseClosed):(this._close(),Z.autoOpen=this._options.autoOpen||Z.isBeingOpened,Z.openComplete=!1,Z.dbOpenError=null)},jn.prototype.delete=function($){var q=this,Z=($===void 0&&($={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),te=this._state;return new _e(function(ae,de){function Ae(){q.close($);var ve=q._deps.indexedDB.deleteDatabase(q.name);ve.onsuccess=un(function(){var Pe,Ve,De;Pe=q._deps,Ve=q.name,FS(De=Pe.indexedDB)||Ve===dc||WE(De,Pe.IDBKeyRange).delete(Ve).catch(ne),ae()}),ve.onerror=Pa(de),ve.onblocked=q._fireOnBlocked}if(Z)throw new ie.InvalidArgument("Invalid closeOptions argument to db.delete()");te.isBeingOpened?te.dbReadyPromise.then(Ae):Ae()})},jn.prototype.backendDB=function(){return this.idbdb},jn.prototype.isOpen=function(){return this.idbdb!==null},jn.prototype.hasBeenClosed=function(){var $=this._state.dbOpenError;return $&&$.name==="DatabaseClosed"},jn.prototype.hasFailed=function(){return this._state.dbOpenError!==null},jn.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(jn.prototype,"tables",{get:function(){var $=this;return s(this._allTables).map(function(q){return $._allTables[q]})},enumerable:!1,configurable:!0}),jn.prototype.transaction=function(){var $=(function(q,Z,te){var ae=arguments.length;if(ae<2)throw new ie.InvalidArgument("Too few arguments");for(var de=new Array(ae-1);--ae;)de[ae-1]=arguments[ae];return te=de.pop(),[q,C(de),te]}).apply(this,arguments);return this._transaction.apply(this,$)},jn.prototype._transaction=function($,q,Z){var te,ae,de=this,Ae=ye.trans,ve=(Ae&&Ae.db===this&&$.indexOf("!")===-1||(Ae=null),$.indexOf("?")!==-1);$=$.replace("!","").replace("?","");try{if(ae=q.map(function(Ve){if(Ve=Ve instanceof de.Table?Ve.name:Ve,typeof Ve!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return Ve}),$=="r"||$===vp)te=vp;else{if($!="rw"&&$!=pc)throw new ie.InvalidArgument("Invalid transaction mode: "+$);te=pc}if(Ae){if(Ae.mode===vp&&te===pc){if(!ve)throw new ie.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");Ae=null}Ae&&ae.forEach(function(Ve){if(Ae&&Ae.storeNames.indexOf(Ve)===-1){if(!ve)throw new ie.SubTransaction("Table "+Ve+" not included in parent transaction.");Ae=null}}),ve&&Ae&&!Ae.active&&(Ae=null)}}catch(Ve){return Ae?Ae._promise(null,function(De,Ee){Ee(Ve)}):Kn(Ve)}var Pe=(function Ve(De,Ee,Ne,Be,Re){return _e.resolve().then(function(){var $e=ye.transless||ye,Me=De._createTransaction(Ee,Ne,De._dbSchema,Be),$e=(Me.explicit=!0,{trans:Me,transless:$e});if(Be)Me.idbtrans=Be.idbtrans;else try{Me.create(),Me.idbtrans._explicit=!0,De._state.PR1398_maxLoop=3}catch(st){return st.name===X.InvalidState&&De.isOpen()&&0<--De._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),De.close({disableAutoOpen:!1}),De.open().then(function(){return Ve(De,Ee,Ne,null,Re)})):Kn(st)}var He,ze=V(Re),$e=(ze&&no(),_e.follow(function(){var st;(He=Re.call(Me,Me))&&(ze?(st=ao.bind(null,null),He.then(st,st)):typeof He.next=="function"&&typeof He.throw=="function"&&(He=HS(He)))},$e));return(He&&typeof He.then=="function"?_e.resolve(He).then(function(st){return Me.active?st:Kn(new ie.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):$e.then(function(){return He})).then(function(st){return Be&&Me._resolve(),Me._completion.then(function(){return st})}).catch(function(st){return Me._reject(st),Kn(st)})})}).bind(null,this,te,ae,Ae,Z);return Ae?Ae._promise(te,Pe,"lock"):ye.trans?Qc(ye.transless,function(){return de._whenReady(Pe)}):this._whenReady(Pe)},jn.prototype.table=function($){if(d(this._allTables,$))return this._allTables[$];throw new ie.InvalidTable("Table ".concat($," does not exist"))};var Of=jn;function jn($,q){var Z,te,ae,de,Ae,ve=this,Pe=(this._middlewares={},this.verno=0,jn.dependencies),Pe=(this._options=q=r({addons:jn.addons,autoOpen:!0,indexedDB:Pe.indexedDB,IDBKeyRange:Pe.IDBKeyRange,cache:"cloned"},q),this._deps={indexedDB:q.indexedDB,IDBKeyRange:q.IDBKeyRange},q.addons),Ve=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ne,dbReadyPromise:null,cancelOpen:ne,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:q.autoOpen}),De=(Ve.dbReadyPromise=new _e(function(Ee){Ve.dbReadyResolve=Ee}),Ve.openCanceller=new _e(function(Ee,Ne){Ve.cancelOpen=Ne}),this._state=Ve,this.name=$,this.on=fc(this,"populate","blocked","versionchange","close",{ready:[ft,ne]}),this.once=function(Ee,Ne){var Be=function(){for(var Re=[],Me=0;Me<arguments.length;Me++)Re[Me]=arguments[Me];ve.on(Ee).unsubscribe(Be),Ne.apply(ve,Re)};return ve.on(Ee,Be)},this.on.ready.subscribe=b(this.on.ready.subscribe,function(Ee){return function(Ne,Be){jn.vip(function(){var Re,Me=ve._state;Me.openComplete?(Me.dbOpenError||_e.resolve().then(Ne),Be&&Ee(Ne)):Me.onReadyBeingFired?(Me.onReadyBeingFired.push(Ne),Be&&Ee(Ne)):(Ee(Ne),Re=ve,Be||Ee(function He(){Re.on.ready.unsubscribe(Ne),Re.on.ready.unsubscribe(He)}))})}}),this.Collection=(Z=this,ls(zc.prototype,function(He,Me){this.db=Z;var Be=Bu,Re=null;if(Me)try{Be=Me()}catch($e){Re=$e}var Me=He._ctx,He=Me.table,ze=He.hook.reading.fire;this._ctx={table:He,index:Me.index,isPrimKey:!Me.index||He.schema.primKey.keyPath&&Me.index===He.schema.primKey.name,range:Be,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:Re,or:Me.or,valueMapper:ze!==ge?ze:null}})),this.Table=(te=this,ls(In.prototype,function(Ee,Ne,Be){this.db=te,this._tx=Be,this.name=Ee,this.schema=Ne,this.hook=te._allTables[Ee]?te._allTables[Ee].hook:fc(null,{creating:[xe,ne],reading:[he,ge],updating:[qe,ne],deleting:[Je,ne]})})),this.Transaction=(ae=this,ls(im.prototype,function(Ee,Ne,Be,Re,Me){var He=this;Ee!=="readonly"&&Ne.forEach(function(ze){ze=(ze=Be[ze])==null?void 0:ze.yProps,ze&&(Ne=Ne.concat(ze.map(function($e){return $e.updatesTable})))}),this.db=ae,this.mode=Ee,this.storeNames=Ne,this.schema=Be,this.chromeTransactionDurability=Re,this.idbtrans=null,this.on=fc(this,"complete","error","abort"),this.parent=Me||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new _e(function(ze,$e){He._resolve=ze,He._reject=$e}),this._completion.then(function(){He.active=!1,He.on.complete.fire()},function(ze){var $e=He.active;return He.active=!1,He.on.error.fire(ze),He.parent?He.parent._reject(ze):$e&&He.idbtrans&&He.idbtrans.abort(),Kn(ze)})})),this.Version=(de=this,ls(hv.prototype,function(Ee){this.db=de,this._cfg={version:Ee,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(Ae=this,ls(MA.prototype,function(Ee,Ne,Be){if(this.db=Ae,this._ctx={table:Ee,index:Ne===":id"?null:Ne,or:Be},this._cmp=this._ascending=Xt,this._descending=function(Re,Me){return Xt(Me,Re)},this._max=function(Re,Me){return 0<Xt(Re,Me)?Re:Me},this._min=function(Re,Me){return Xt(Re,Me)<0?Re:Me},this._IDBKeyRange=Ae._deps.IDBKeyRange,!this._IDBKeyRange)throw new ie.MissingAPI})),this.on("versionchange",function(Ee){0<Ee.newVersion?console.warn("Another connection wants to upgrade database '".concat(ve.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(ve.name,"'. Closing db now to resume the delete request.")),ve.close({disableAutoOpen:!1})}),this.on("blocked",function(Ee){!Ee.newVersion||Ee.newVersion<Ee.oldVersion?console.warn("Dexie.delete('".concat(ve.name,"') was blocked")):console.warn("Upgrade '".concat(ve.name,"' blocked by other connection holding version ").concat(Ee.oldVersion/10))}),this._maxKey=Dl(q.IDBKeyRange),this._createTransaction=function(Ee,Ne,Be,Re){return new ve.Transaction(Ee,Ne,Be,ve._options.chromeTransactionDurability,Re)},this._fireOnBlocked=function(Ee){ve.on("blocked").fire(Ee),uc.filter(function(Ne){return Ne.name===ve.name&&Ne!==ve&&!Ne._state.vcFired}).map(function(Ne){return Ne.on("versionchange").fire(Ee)})},this.use(qN),this.use(XN),this.use(vv),this.use(dV),this.use(pV),new Proxy(this,{get:function(Ee,Ne,Be){var Re;return Ne==="_vip"||(Ne==="table"?function(Me){return xA(ve.table(Me),De)}:(Re=Reflect.get(Ee,Ne,Be))instanceof In?xA(Re,De):Ne==="tables"?Re.map(function(Me){return xA(Me,De)}):Ne==="_createTransaction"?function(){return xA(Re.apply(this,arguments),De)}:Re)}}));this.vip=De,Pe.forEach(function(Ee){return Ee(ve)})}var _A,yv=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",ZE=(JE.prototype.subscribe=function($,q,Z){return this._subscribe($&&typeof $!="function"?$:{next:$,error:q,complete:Z})},JE.prototype[yv]=function(){return this},JE);function JE($){this._subscribe=$}try{_A={indexedDB:a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB,IDBKeyRange:a.IDBKeyRange||a.webkitIDBKeyRange}}catch{_A={indexedDB:null,IDBKeyRange:null}}function Up($){var q,Z=!1,te=new ZE(function(ae){var de=V($),Ae,ve=!1,Pe={},Ve={},De={get closed(){return ve},unsubscribe:function(){ve||(ve=!0,Ae&&Ae.abort(),Ee&&sl.storagemutated.unsubscribe(Be))}},Ee=(ae.start&&ae.start(De),!1),Ne=function(){return Ca(Re)},Be=function(Me){mv(Pe,Me),YE(Ve,Pe)&&Ne()},Re=function(){var Me,He,ze;!ve&&_A.indexedDB&&(Pe={},Me={},Ae&&Ae.abort(),Ae=new AbortController,ze=($e=>{var st=xi();try{de&&no();var bt=Ho($,$e);return bt=de?bt.finally(ao):bt}finally{st&&en()}})(He={subscr:Me,signal:Ae.signal,requery:Ne,querier:$,trans:null}),Promise.resolve(ze).then(function($e){Z=!0,q=$e,ve||He.signal.aborted||(Pe={},(st=>{for(var bt in st)if(d(st,bt))return;return 1})(Ve=Me)||Ee||(sl(yp,Be),Ee=!0),Ca(function(){return!ve&&ae.next&&ae.next($e)}))},function($e){Z=!1,["DatabaseClosedError","AbortError"].includes($e?.name)||ve||Ca(function(){ve||ae.error&&ae.error($e)})}))};return setTimeout(Ne,0),De});return te.hasValue=function(){return Z},te.getValue=function(){return q},te}var OA=Of;function nm($){var q=ol;try{ol=!0,sl.storagemutated.fire($),XE($,!0)}finally{ol=q}}p(OA,r(r({},G),{delete:function($){return new OA($,{addons:[]}).delete()},exists:function($){return new OA($,{addons:[]}).open().then(function(q){return q.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function($){try{return q=OA.dependencies,Z=q.indexedDB,q=q.IDBKeyRange,(FS(Z)?Promise.resolve(Z.databases()).then(function(te){return te.map(function(ae){return ae.name}).filter(function(ae){return ae!==dc})}):WE(Z,q).toCollection().primaryKeys()).then($)}catch{return Kn(new ie.MissingAPI)}var q,Z},defineClass:function(){return function($){l(this,$)}},ignoreTransaction:function($){return ye.trans?Qc(ye.transless,$):$()},vip:wp,async:function($){return function(){try{var q=HS($.apply(this,arguments));return q&&typeof q.then=="function"?q:_e.resolve(q)}catch(Z){return Kn(Z)}}},spawn:function($,q,Z){try{var te=HS($.apply(Z,q||[]));return te&&typeof te.then=="function"?te:_e.resolve(te)}catch(ae){return Kn(ae)}},currentTransaction:{get:function(){return ye.trans||null}},waitFor:function($,q){return $=_e.resolve(typeof $=="function"?OA.ignoreTransaction($):$).timeout(q||6e4),ye.trans?ye.trans.waitFor($):$},Promise:_e,debug:{get:function(){return je},set:function($){Tt($)}},derive:m,extend:l,props:p,override:b,Events:fc,on:sl,liveQuery:Up,extendObservabilitySet:mv,getByKeyPath:w,setByKeyPath:S,delByKeyPath:function($,q){typeof q=="string"?S($,q,void 0):"length"in q&&[].map.call(q,function(Z){S($,Z,void 0)})},shallowClone:T,deepClone:R,getObjectDiff:$b,cmp:Xt,asap:I,minKey:-1/0,addons:[],connections:uc,errnames:X,dependencies:_A,cache:rm,semVer:"4.3.0",version:"4.3.0".split(".").map(function($){return parseInt($)}).reduce(function($,q,Z){return $+q/Math.pow(10,2*Z)})})),OA.maxKey=Dl(OA.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(sl(yp,function($){ol||($=new CustomEvent(bp,{detail:$}),ol=!0,dispatchEvent($),ol=!1)}),addEventListener(bp,function($){$=$.detail,ol||nm($)}));var bv,ol=!1,Gb=function(){};return typeof BroadcastChannel<"u"&&((Gb=function(){(bv=new BroadcastChannel(bp)).onmessage=function($){return $.data&&nm($.data)}})(),typeof bv.unref=="function"&&bv.unref(),sl(yp,function($){ol||bv.postMessage($)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function($){if(!Of.disableBfCache&&$.persisted){je&&console.debug("Dexie: handling persisted pagehide"),bv?.close();for(var q=0,Z=uc;q<Z.length;q++)Z[q].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function($){!Of.disableBfCache&&$.persisted&&(je&&console.debug("Dexie: handling persisted pageshow"),Gb(),nm({all:new Go(-1/0,[[]])}))})),_e.rejectionMapper=function($,q){return!$||$ instanceof Q||$ instanceof TypeError||$ instanceof SyntaxError||!$.name||!ue[$.name]?$:(q=new ue[$.name](q||$.message,$),"stack"in $&&h(q,"stack",{get:function(){return this.inner.stack}}),q)},Tt(je),r(Of,Object.freeze({__proto__:null,Dexie:Of,Entity:jc,PropModification:vo,RangeSet:Go,add:function($){return new vo({add:$})},cmp:Xt,default:Of,liveQuery:Up,mergeRanges:Ob,rangesOverlap:KE,remove:function($){return new vo({remove:$})},replacePrefix:function($,q){return new vo({replacePrefix:[$,q]})}}),{default:Of}),Of})})(nx)),nx.exports}var Cut=Tut();const U3=EH(Cut),Xre=Symbol.for("Dexie"),u1=globalThis[Xre]||(globalThis[Xre]=U3);if(U3.semVer!==u1.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${U3.semVer} and ${u1.semVer}`);const{liveQuery:U2t,mergeRanges:T2t,rangesOverlap:C2t,RangeSet:E2t,cmp:D2t,Entity:P2t,PropModification:R2t,replacePrefix:M2t,add:N2t,remove:B2t,DexieYProvider:k2t}=u1,ou=(function(){const t={};return t.initDB=()=>new Promise((e,i)=>{try{t.dex=new u1("TMX",{autoOpen:!0}),t.dex.version(2).stores({tournaments:"&tournamentId, tournamentName, startDate, endDate",providers:"&providerId, settings, calendar",idioms:"ioc"}),e()}catch(r){return i(r)}}),t.resetDB=e=>{t.dex.close(),u1.delete("TMX").then(e,()=>alert("Failed to Reset Database"))},t.findAll=e=>new Promise((i,r)=>{const n=t.dex[e];return n?n.toArray(i,r).catch(r):i([])}),t.findAllTournaments=()=>t.findAll("tournaments"),t.findAllProviders=()=>t.findAll("providers"),t.findAllIdioms=()=>t.findAll("idioms"),t.findWhere=(e,i,r)=>new Promise((n,a)=>t.dex[e].where(i).equals(r).toArray(n,a).catch(a)),t.deleteTournament=e=>new Promise((i,r)=>{t.dex.tournaments.where("tournamentId").equals(e).delete().then(i,r)}),t.deleteProvider=e=>t.dex.providers.where("providerId").equals(e).delete(),t.deleteAllTournamentAttr=e=>t.dex.tournaments.toCollection().modify(i=>delete i[e]).then(()=>console.log("done")),t.findUnique=(e,i,r)=>new Promise((n,a)=>{t.findWhere(e,i,r).then(s=>n(s?.length?s[0]:void 0),a)}),t.findProvider=e=>t.findUnique("providers","providerId",e),t.findIdiom=e=>t.findUnique("idioms","ioc",e),t.findTournament=e=>t.findUnique("tournaments","tournamentId",e),t.findProviderTournaments=e=>t.findWhere("tournaments","providerId",e),t.addItem=(e,i)=>new Promise((r,n)=>t.dex[e].put(i).then(r,n).catch(a=>{alert("try again:"+a),n(a)})),t.modifyOrAddUnique=(e,i,r,n)=>new Promise((a,s)=>{t.dex[e].where(i).equals(r).modify(o=>Object.assign(o,n)).then(o=>{if(o)return a("exists");t.addItem(e,n).then(a,s)},o=>{console.log({err:o}),s(o)})}),t.addIdiom=e=>t.modifyOrAddUnique("idioms","ioc",e.ioc,e),t.addTournament=e=>t.modifyOrAddUnique("tournaments","tournamentId",e.tournamentId,e),t.addProvider=e=>t.modifyOrAddUnique("providers","providerId",e.providerId,e),t.modify=(e,i,r,n,a)=>new Promise((s,o)=>{t.dex[e].where(i).equals(r).modify(l=>{Object.assign(a,{item:l}),n(a)}).then(s,l=>{console.log("error:",l),o()})}),t})(),nZ="@VERSION@",$t={socketIo:{tmx:"/tmx"},activeScale:"wtn",hotkeys:!1,scoring:!1,scoringApproach:"dynamicSets",smartComplements:!1,composition:void 0,scales:{utr:{accessor:"utrRating",scaleType:"RATING",scaleColor:"blue",scaleName:"UTR",fallback:!0},wtn:{accessor:"wtnRating",scaleType:"RATING",scaleColor:"red",scaleName:"WTN",fallback:!0}},serverFirst:!0,version:nZ,pdfPrinting:!1,persistInputFields:!0,ioc:"gbr",locations:{geolocate:!0,geoposition:void 0,map:void 0,map_view:"satellite",map_provider:"leaflet"},leaflet:{map:{tileLayer:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://openstreetmap.org">OpenStreetMap</a> Contributors',maxZoom:18},satellite:{tileLayer:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri"}},scoreboard:{matchFormats:{categories:{},singles:"SET3-S:6/TB7",doubles:"SET3-S:6/TB7-F:TB10"},options:{bestof:[1,3,5],setsto:[4,6,8,9],tiebreaksto:[5,7,12],supertiebreakto:[7,10,21]},settings:{singles:{max_sets:3,sets_to_win:2,games_for_set:6,tiebreak_to:7,tiebreaks_at:6,supertiebreak_to:10,final_set_tiebreak:!0,final_set_supertiebreak:!1},doubles:{max_sets:3,sets_to_win:2,games_for_set:6,tiebreak_to:7,tiebreaks_at:6,supertiebreak_to:10,final_set_tiebreak:!1,final_set_supertiebreak:!0}}},printing:{pageSize:"A4"},schedule:{teams:!0,clubs:!0,time24:!0,ioc_codes:!1,default_time:"9:00",scores_in_draw_order:!0,completed_matches_in_search:!1,max_matches_per_court:14,court_identifiers:!0,minCourtGridRows:10},messages:[],device:{}};async function aZ(t){$t.log?.verbose&&console.log("%c localSave","color: yellow");const e=t?.tournamentRecord??Ge.getTournament()?.tournamentRecord;await ou.addTournament(e),Mt(t?.callback)&&t?.callback&&t.callback()}const sZ=Obe();function qRe(){localStorage.removeItem(sZ)}function WRe(){return localStorage.getItem(sZ)}function Eut(t){localStorage.setItem(sZ,t)}function DH(t){const e=t.tournamentName?.toLowerCase()||"Error",i=t.onlineResources?.find(({name:n,resourceType:a})=>n==="tournamentImage"&&a==="URL")?.identifier,r=t.timeItems?.find(({itemType:n})=>n==="TMX")?.itemValue?.offline;return{tournamentId:t.tournamentId,id:t.tournamentId,searchText:e,tournament:{startDate:new Date(t.startDate).toISOString()?.split("T")[0],endDate:new Date(t.endDate).toISOString()?.split("T")[0],tournamentName:t.tournamentName,tournamentImageURL:i,offline:r}}}const DS=t=>{let e;const i=Array.isArray(t)?t:[t];return r=>{if(e&&i.forEach(n=>n.removeFilter(e)),r){const n=r?.toLowerCase();e=a=>a.searchText?.includes(n),i.forEach(a=>a.addFilter(e))}else e=void 0}};function KRe({tournamentRecord:t,callback:e}){const i=gu()?.provider;i&&!t.parentOrganisation&&(t.parentOrganisation=i),aZ({tournamentRecord:t,callback:e})}function Dut({callback:t,autoClose:e=!0}={}){const i=o=>{const l=o.name.split(".").reverse()[0],c=new FileReader;c.onload=function(u){if(u.target?.error){console.log("file error",u.target.error);return}const d=u.target?.result;d.length&&(Mt(t)&&t?t(d):console.log(d))},["csv","json"].includes(l)?c.readAsText(o):console.log("not loaded")},r=document.createElement("div");r.className="dzx-dropzone",r.id="tmxDropzone";const n=document.createElement("label");n.className="dzx-inputLabel",n.innerHTML="Drag and Drop files into this zone";const a=document.createElement("input");a.className="dzx-input",a.setAttribute("type","file"),a.setAttribute("accept","application/json"),n.appendChild(a),r.appendChild(n),Jr({buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Done"}],title:"Import tournament records",content:r}),["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(o=>{r.addEventListener(o,function(l){l.preventDefault(),l.stopPropagation()})});const s="dropone-dragging";r.addEventListener("dragover",function(){this.classList.add(s)},!1),r.addEventListener("dragleave",function(){this.classList.remove(s)},!1),r.addEventListener("drop",function(o){this.classList.remove(s);const l=o.dataTransfer.files,c=new DataTransfer;Array.prototype.forEach.call(l,d=>{c.items.add(d)});const u=c.files;Array.from(u).forEach(i),e&&Wy()},!1)}function YRe({note:t,data:e}){try{return JSON.parse(e)}catch{console.log({message:"failed normal parse",note:t})}}function Put(t){if(t){if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return""}}}function Rut({table:t}){const e=t.getData().map(i=>i.tournamentId);Dut({callback:i=>{const r=YRe({data:i});if(r){let n,a;r.tournamentId&&r.startDate?a=r:r.tuid&&r.start&&Pt({message:"TMX Classic file not converted"}),n=Ge.setState(a),n.success?UN({tournamentRecord:a,tournamentIds:e,table:t}):console.log(n)}}})}function UN({tournamentRecord:t,tournamentIds:e,table:i,callback:r}){const n=DH(t);e?.includes(t.tournamentId)?i?.updateOrAddData([n],!0):i?.addData([n],!0),KRe({tournamentRecord:t}),Mt(r)&&r&&r()}const ot={matchUpsToBroadcast:[],tables:[],ee:null,drawer:null,modal:null,state:{authorized:!1,admin:!1},displayed:{selectedScheduleDate:null,draw_event:null},columns:{}};function Mut({table:t}){const e=t.getData().map(c=>c.tournamentId);let i;const n=[{control:"identifier",onInput:({inputs:c})=>{const d=c.identifier.value.length>10,p=document.getElementById("fetchButton");p&&(p.disabled=!d)}}],a=c=>i=Sr(c,[{iconLeft:"fa-solid fa-fingerprint",placeholder:"Identifier",label:"identifier",field:"identifier"}],n),s=()=>{Pt({onClose:()=>ot.router.navigate("/tournaments"),message:"Tournament not found",intent:"is-warning",pauseOnHover:!0,action:"show"})},o=c=>{const u=c?.data?.tournamentRecord,d=c?.data?.tournamentId,p=e.includes(d);p?console.log({exists:p}):UN({tournamentRecord:u,tournamentIds:e,table:t,callback:()=>{}})};Jr({title:"Fetch tournament details",content:a,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Fetch",id:"fetchButton",disabled:!0,intent:"is-primary",onClick:()=>{const c=i.identifier.value;y5e({identifier:c}).then(o,s)},close:!0}]})}function Nut({table:t}){const e=t.getData().map(o=>o.tournamentId);let i;const r=o=>i=Sr(o,[{iconLeft:"fa-solid fa-fingerprint",placeholder:"tournamentId",label:"Tournament Id",field:"tournamentId"}]),n=()=>{Pt({onClose:()=>ot.router.navigate("/tournaments"),message:"Tournament not found",intent:"is-warning",pauseOnHover:!0,action:"show"})},a=o=>{const l=i.tournamentId.value,c=o.data.tournamentRecords?.[l];UN({tournamentRecord:c,tournamentIds:e,table:t,callback:()=>{}})};Jr({title:"Load tournament",content:r,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Load",intent:"is-primary",onClick:()=>{const o=i.tournamentId.value;f2({tournamentId:o}).then(a,n)},close:!0}]})}function dC(t,e){const i=Array.from(t.classList).indexOf(e);return{parent:i>=0?t:ac(t,e),index:i>=0?i:-1}}function ac(t,e){if(!t)return null;if(t.classList&&Array.from(t.classList).includes(e))return t;for(;t.parentNode;)if(t=t.parentNode,t.classList&&Array.from(t.classList).includes(e))return t;return null}function uD(t,e,i){return ac(t,e)?.getAttribute(i)||""}function Mg(t,e){const i=[];function r(n){n?.childNodes?.forEach(a=>{a?.childNodes?.length>0&&r(a),a?.classList&&Array.from(a.classList).includes(e)&&i.push(a)})}return r(t),i}const But="addCourts",kut="addFlight",xut="addDrawDefinition",XRe="addAdHocMatchUps",_ut="addDrawEntries",Out="addDrawDefinitionExtension",Fut="addDynamicRatings",Lut="addEvent",oZ="addEventEntries",$ut="addEventEntryPairs",ZRe="addEventExtension",JRe="addIndividualParticipantIds",rO="addMatchUpScheduleItems",Hut="addOnlineResource",TN="addParticipants",Zre="addParticipantTimeItem",eMe="addPlayoffStructures",Vut="addTournamentExtension",Gut="addTournamentTimeItem",Qut="addVenue",jut="attachQualifyingStructure",zut="attachPolicies",lZ="bulkScheduleMatchUps",tMe="deleteAdHocMatchUps",Jre="deleteFlightAndFlightDraw",ene="deleteEvents",qut="deleteParticipants",Wut="deleteVenues",Kut="destroyPairEntries",cZ="modifyCourt",Yut="modifyEvent",iMe="modifyEntriesStatus",nO="modifyParticipant",uZ="modifyParticipantsSignInStatus",Xut="modifyTieFormmat",rMe="modifyVenue",Zut="proAutoSchedule",nMe="publishEvent",Jut="removeIndividualParticipantIds",edt="removeStructure",aMe="renameStructures",tdt="resetDrawDefinition",sMe="resetMatchUpLinesUps",oMe="resetScorecard",idt="setMatchUpFormat",dZ="setMatchUpStatus",rdt="setPositionAssignments",ndt="setParticipantScaleItems",adt="setSubOrder",sdt="setTournamentDates",odt="setTournamentName",ldt="setTournamentNotes",cdt="unPublishEvent";function lMe({table:t,tournamentRecord:e}){const i={activeDates:(e?.activeDates||[]).join(","),tournamentName:e?.tournamentName||"",startDate:e?.startDate||"",endDate:e?.endDate||""};let r;const n=[{error:"minimum of 5 characters",placeholder:"Tournament name",value:i.tournamentName,validator:fi.nameValidator(5),label:"Tournament name",field:"tournamentName",focus:!0},{placeholder:"YYYY-MM-DD",value:i.startDate,label:"Start date",field:"startDate"},{placeholder:"YYYY-MM-DD",value:i.endDate,label:"End date",field:"endDate"},{visible:!i.activeDates.length,label:"Select active dates",field:"activeDateSelector",id:"activeDateSelector",checkbox:!0},{visible:!!i.activeDates.length,value:i.activeDates||[],placeholder:"[datesArray]",minDate:i.startDate,maxDate:i.endDate,label:"Active Dates",maxNumberOfDates:10,field:"activeDates",id:"activeDates",date:!0}],a=({tournamentName:A,startDate:g,endDate:v})=>fi.nameValidator(5)(A)&&fi.dateValidator(g)&&fi.dateValidator(v),s=({inputs:A})=>{const g=A.activeDates.value,v=A.startDate.value,b=A.endDate.value,y=a({tournamentName:A.tournamentName.value,startDate:v,endDate:b});g&&(A.activeDates.value=g.split(",").filter(w=>!(v&&new Date(w)<new Date(v)||b&&new Date(w)>new Date(b))).filter(Boolean).join(",")),v&&A.activeDates.datepicker.setOptions({minDate:v}),b&&A.activeDates.datepicker.setOptions({maxDate:b});const I=document.getElementById("saveTournamentEdits");I&&(I.disabled=!y)},l=[{fields:["startDate","endDate"],dateRange:!0},{control:"tournamentName",onInput:s},{onFocusOut:s,control:"startDate"},{onFocusOut:s,control:"endDate"},{onChange:({inputs:A})=>{const g=A.activeDateSelector.checked,v=document.getElementById("activeDates"),b=dC(v,"field");b?.parent&&(b.parent.style.display=g?"block":"none")},control:"activeDateSelector"}],c=A=>{r=Sr(A,n,l),r.activeDates?.datepicker?.update()},u=()=>fi.nameValidator(5)(r.drawName.value),d=()=>{const A=r.activeDates.value?.split(",").filter(Boolean),g=r.tournamentName.value?.trim(),v=r.startDate.value,b=r.endDate.value;if(e){const y={...e,tournamentName:g,activeDates:A,startDate:v,endDate:b};Nt({tournamentRecord:y,methods:[{method:sdt,params:{activeDates:A,startDate:v,endDate:b}},{method:odt,params:{tournamentName:g}}],callback:S=>{S.success?t?.updateData([DH(y)],!0):console.log({result:S})}})}else if(Ge.newTournamentRecord({tournamentName:g,startDate:v,endDate:b}).success){const I=gu(),w=Ge.getTournament()?.tournamentRecord;if(I?.providerId){const S=T=>{const D=T.data?.provider;if(w.parentOrganisation=D,D){const C=E=>console.log("sendTournament",E);l0({tournamentRecord:w}).then(()=>{},C)}tne({tournamentRecord:w,table:t})};w5e({providerId:I.providerId}).then(S)}else tne({tournamentRecord:w,table:t})}},p=e?"Save":"Add",f=[{label:"Cancel",intent:"none",close:!0},{disabled:!a(i),id:"saveTournamentEdits",label:p,intent:"is-primary",onClick:d,close:u}],h=(A,g)=>uv(A,f,g),m=e?"Edit tournament":"New tournament";ot.drawer.open({title:m,content:c,footer:h,side:Ht,width:"300px"})}function tne({tournamentRecord:t,table:e}){UN({tournamentRecord:t,callback:()=>e?.addData([DH(t)],!0)})}const PG="font-medium";function T3({target:t,button:e,stateChange:i}){let r=0;const n=()=>(r+=1,`Item${r}`),a=document.createElement("div");e.class&&a.classList.add(e.class),a.classList.add("dropdown"),e.id&&(a.id=e.id),e.align===Ht?(a.classList.add("is-right"),a.style.cssText="margin-left: 1em"):a.style.cssText="margin-right: 1em";const s=g=>g.classList.contains("is-active"),o=()=>{s(a)&&a.classList.remove("is-active")},l=g=>s(g)?(g.classList.remove("is-active"),!1):(g.classList.add("is-active"),!0);a.onmouseleave=o,a.onclick=()=>l(a);const c=document.createElement("div");c.classList.add("dropdown-trigger");const u=document.createElement("button");u.className="button font-medium",e.intent&&u.classList.add(e.intent),u.setAttribute("aria-haspopup","true");const d=document.createElement("span");Mt(e.onClick)&&(d.onclick=e.onClick),d.style.cssText="margin-right: 1em",d.innerHTML=e.label,u.appendChild(d);const p=document.createElement("span");Mt(e.onClick)&&(p.onclick=e.onClick),p.innerHTML=`
      <span class="icon is-small font-medium">
        <i class="fas fa-angle-down font-medium" aria-hidden="true"></i>
      </span>
  `,u.appendChild(p),c.appendChild(u),a.appendChild(c);const f=document.createElement("div");f.classList.add("dropdown-menu"),f.setAttribute("z-index","99998");const h=document.createElement("div");h.classList.add("dropdown-content");const m=()=>{const g=f.querySelectorAll(".dropdown-item");for(const v of Array.from(g))v.classList.remove("is-active")},A=g=>{const v=document.createElement("a");v.className=PG;const b=g.disabled?"0.4":"1";return v.style.cssText=`text-decoration: none; opacity: ${b};`,g.color&&(v.style.color=g.color),v.classList.add("dropdown-item"),g.isActive&&v.classList.add("is-active"),g.value&&(v.value=g.value),g.class&&v.classList.add(g.class),v.onclick=y=>{if(g.disabled)return;g.value&&(u.value=g.value,a.value=g.value),y.stopPropagation(),Mt(g.onClick)&&(Mt(i)&&i(),g.onClick(y)),g.close&&o();const I=s(v);m(),I?d.innerHTML=e.label:(e.selection&&l(v),e.modifyLabel&&g.modifyLabel!==!1&&(d.innerHTML=`${e.append?e.label+": ":""}${g?.label||n()}`))},v.innerHTML=g?.label||n(),v};for(const g of e.options||[])if(g.heading){const v=document.createElement("div");v.style.cssText="font-weight: bold",v.classList.add("dropdown-item",PG),v.innerHTML=g.heading,h.appendChild(v)}else if(g.divider){const v=document.createElement("hr");v.classList.add("dropdown-divider",PG),h.appendChild(v)}else g.hide||h.appendChild(A(g));return e.options?.length&&(e.options[0].value&&(a.value=e.options[0].value),f.appendChild(h)),a.appendChild(f),t&&t.appendChild(a),a}class sc{constructor(e){this.table=e}reloadData(e,i,r){return this.table.dataLoader.load(e,void 0,void 0,void 0,i,r)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,i){return typeof i<"u"&&(this.table.options[e]=i),this.table.options[e]}deprecationCheck(e,i,r){return this.table.deprecationAdvisor.check(e,i,r)}deprecationCheckMsg(e,i){return this.table.deprecationAdvisor.checkMsg(e,i)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class Ma{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var i=e.getBoundingClientRect();return{top:i.top+window.pageYOffset-document.documentElement.clientTop,left:i.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,i,r){var n=e?i.split(e):[i],a=n.length,s;for(let o=0;o<a&&(r=r[n[o]],s=r,!!r);o++);return s}static deepClone(e,i,r=[]){var n={}.__proto__,a=[].__proto__;i||(i=Object.assign(Array.isArray(e)?[]:{},e));for(var s in e){let o=e[s],l,c;o!=null&&typeof o=="object"&&(o.__proto__===n||o.__proto__===a)&&(l=r.findIndex(u=>u.subject===o),l>-1?i[s]=r[l].copy:(c=Object.assign(Array.isArray(o)?[]:{},o),r.unshift({subject:o,copy:c}),i[s]=this.deepClone(o,c,r)))}return i}}let udt=class cMe extends sc{constructor(e,i,r){super(e),this.element=i,this.container=this._lookupContainer(),this.parent=r,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,i=this.table.element){return e===i?!0:i.parentNode?this._checkContainerIsParent(e,i.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var i=!(e instanceof MouseEvent),r=i?e.touches[0].pageX:e.pageX,n=i?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let a=Ma.elOffset(this.container);r-=a.left,n-=a.top}return{x:r,y:n}}elementPositionCoords(e,i="right"){var r=Ma.elOffset(e),n,a,s;switch(this.container!==document.body&&(n=Ma.elOffset(this.container),r.left-=n.left,r.top-=n.top),i){case"right":a=r.left+e.offsetWidth,s=r.top-1;break;case"bottom":a=r.left,s=r.top+e.offsetHeight;break;case"left":a=r.left,s=r.top-1;break;case"top":a=r.left,s=r.top;break;case"center":a=r.left+e.offsetWidth/2,s=r.top+e.offsetHeight/2;break}return{x:a,y:s,offset:r}}show(e,i){var r,n,a,s,o;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(a=e,o=this.elementPositionCoords(e,i),s=o.offset,r=o.x,n=o.y):typeof e=="number"?(s={top:0,left:0},r=e,n=i):(o=this.containerEventCoords(e),r=o.x,n=o.y,this.reversedX=!1),this.element.style.top=n+"px",this.element.style.left=r+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(r,n,a,s,i),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,i,r,n,a){var s=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;(e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",r?this.element.style.right=this.container.offsetWidth-n.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0);let o=Math.max(this.container.offsetHeight,s?this.container.scrollHeight:0);i+this.element.offsetHeight>o&&(r?a==="bottom"?this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-r.offsetHeight-1+"px":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+r.offsetHeight+1+"px":this.element.style.height=o+"px")}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new cMe(this.table,e,this),this.childPopup}},Or=class extends sc{constructor(e,i){super(e),this._handler=null}initialize(){}registerTableOption(e,i){this.table.optionsList.register(e,i)}registerColumnOption(e,i){this.table.columnManager.optionsList.register(e,i)}registerTableFunction(e,i){typeof this.table[e]>"u"?this.table[e]=(...r)=>(this.table.initGuard(e),i(...r)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,i,r){return this.table.componentFunctionBinder.bind(e,i,r)}registerDataHandler(e,i){this.table.rowManager.registerDataPipelineHandler(e,i),this._handler=e}registerDisplayHandler(e,i){this.table.rowManager.registerDisplayPipelineHandler(e,i),this._handler=e}displayRows(e){var i=this.table.rowManager.displayRows.length-1,r;if(this._handler&&(r=this.table.rowManager.displayPipeline.findIndex(n=>n.handler===this._handler),r>-1&&(i=r)),e&&(i=i+e),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,i){i||(i=this._handler),i&&this.table.rowManager.refreshActiveData(i,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,i){return new udt(this.table,e,i)}alert(e,i){return this.table.alertManager.alert(e,i)}clearAlert(){return this.table.alertManager.clear()}};var ddt={rownum:function(t,e,i,r,n,a){return a.getPosition()}};class aO extends Or{static moduleName="accessor";static accessors=ddt;constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="accessor"+(n.charAt(0).toUpperCase()+n.slice(1)),s;e.definition[a]&&(s=this.lookupAccessor(e.definition[a]),s&&(i=!0,r[a]={accessor:s,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.accessor=r)}lookupAccessor(e){var i=!1;switch(typeof e){case"string":aO.accessors[e]?i=aO.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i){var r="accessor"+(i.charAt(0).toUpperCase()+i.slice(1)),n=e.getComponent(),a=Ma.deepClone(e.data||{});return this.table.columnManager.traverse(function(s){var o,l,c,u;s.modules.accessor&&(l=s.modules.accessor[r]||s.modules.accessor.accessor||!1,l&&(o=s.getFieldValue(a),o!="undefined"&&(u=s.getComponent(),c=typeof l.params=="function"?l.params(o,a,i,u,n):l.params,s.setFieldValue(a,l.accessor(o,a,i,c,u,n)))))}),a}}var pdt={method:"GET"};function C3(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(C3(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(C3(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}function fdt(t){var e=C3(t),i=[];return e.forEach(function(r){i.push(encodeURIComponent(r.key)+"="+encodeURIComponent(r.value))}),i.join("&")}function uMe(t,e,i){return t&&i&&Object.keys(i).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",t+=(t.includes("?")?"&":"?")+fdt(i)),t}function hdt(t,e,i){var r;return new Promise((n,a)=>{if(t=this.urlGenerator.call(this.table,t,e,i),e.method.toUpperCase()!="GET")if(r=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],r){for(var s in r.headers)e.headers||(e.headers={}),typeof e.headers[s]>"u"&&(e.headers[s]=r.headers[s]);e.body=r.body.call(this,t,e,i)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);t?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(t,e).then(o=>{o.ok?o.json().then(l=>{n(l)}).catch(l=>{a(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+o.status,o.statusText),a(o))}).catch(o=>{console.error("Ajax Load Error - Connection Error: ",o),a(o)})):(console.warn("Ajax Load Error - No URL Set"),n([]))})}function E3(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(E3(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(E3(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}var mdt={json:{headers:{"Content-Type":"application/json"},body:function(t,e,i){return JSON.stringify(i)}},form:{headers:{},body:function(t,e,i){var r=E3(i),n=new FormData;return r.forEach(function(a){n.append(a.key,a.value)}),n}}};class QU extends Or{static moduleName="ajax";static defaultConfig=pdt;static defaultURLGenerator=uMe;static defaultLoaderPromise=hdt;static contentTypeFormatters=mdt;constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=QU.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||QU.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||QU.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,i,r,n){var a=this.table.options.ajaxParams;return a&&(typeof a=="function"&&(a=a.call(this.table)),n=Object.assign(Object.assign({},a),n)),n}requestDataCheck(e,i,r,n){return!!(!e&&this.url||typeof e=="string")}requestData(e,i,r,n,a){var s;return!a&&this.requestDataCheck(e)?(e&&this.setUrl(e),s=this.generateConfig(r),this.sendRequest(this.url,i,s)):a}setDefaultConfig(e={}){this.config=Object.assign({},QU.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var i=Object.assign({},this.config);return typeof e=="string"?i.method=e:Object.assign(i,e),i}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,i,r){return this.table.options.ajaxRequesting.call(this.table,e,i)!==!1?this.loaderPromise(e,r,i).then(n=>(this.table.options.ajaxResponse&&(n=this.table.options.ajaxResponse.call(this.table,e,i,n)),n)):Promise.reject()}}var Adt={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)}},gdt={table:function(t){var e=[],i=!0,r=this.table.columnManager.columns,n=[],a=[];return t=t.split(`
`),t.forEach(function(s){e.push(s.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(s){var o=r.find(function(l){return s&&l.definition.title&&s.trim()&&l.definition.title.trim()===s.trim()});o?n.push(o):i=!1}),i||(i=!0,n=[],e[0].forEach(function(s){var o=r.find(function(l){return s&&l.field&&s.trim()&&l.field.trim()===s.trim()});o?n.push(o):i=!1}),i||(n=this.table.columnManager.columnsByIndex)),i&&e.shift(),e.forEach(function(s){var o={};s.forEach(function(l,c){n[c]&&(o[n[c].field]=l)}),a.push(o)}),a):!1}},vdt={copyToClipboard:["ctrl + 67","meta + 67"]},ydt={copyToClipboard:function(t){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}},bdt={keybindings:{bindings:vdt,actions:ydt}};let Idt=class D3 extends Or{static moduleName="clipboard";static moduleExtensions=bdt;static pasteActions=Adt;static pasteParsers=gdt;constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var i,r,n;this.blocked||(e.preventDefault(),this.customSelection?(i=this.customSelection,this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i))):(n=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),r=this.table.modules.export.generateHTMLTable(n),i=r?this.generatePlainContent(n):"",this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i),r=this.table.options.clipboardCopyFormatter("html",r))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",i):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",i),r&&e.clipboardData.setData("text/html",r)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",i),r&&e.originalEvent.clipboardData.setData("text/html",r)),this.dispatchExternal("clipboardCopied",i,r),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var i=[];return e.forEach(r=>{var n=[];r.columns.forEach(a=>{var s="";if(a)if(r.type==="group"&&(a.value=a.component.getKey()),a.value===null)s="";else switch(typeof a.value){case"object":s=JSON.stringify(a.value);break;case"undefined":s="";break;default:s=a.value}n.push(s)}),i.push(n.join("	"))}),i.join(`
`)}copy(e,i){var r,n;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),r=window.getSelection(),r.toString()&&i&&(this.customSelection=r.toString()),r.removeAllRanges(),r.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(n=document.body.createTextRange(),n.moveToElementText(this.table.element),n.select()),document.execCommand("copy"),r&&r.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=D3.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=D3.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var i,r,n;this.checkPasteOrigin(e)&&(i=this.getPasteData(e),r=this.pasteParser.call(this,i),r?(e.preventDefault(),this.table.modExists("mutator")&&(r=this.mutateData(r)),n=this.pasteAction.call(this,r),this.dispatchExternal("clipboardPasted",i,r,n)):this.dispatchExternal("clipboardPasteError",i))}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(r=>{i.push(this.table.modules.mutator.transformRow(r,"clipboard"))}):i=e,i}checkPasteOrigin(e){var i=!0,r=this.confirm("clipboard-paste",[e]);return(r||!["DIV","SPAN"].includes(e.target.tagName))&&(i=!1),i}getPasteData(e){var i;return window.clipboardData&&window.clipboardData.getData?i=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?i=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(i=e.originalEvent.clipboardData.getData("text/plain")),i}};class wdt{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}_getSelf(){return this._row}}class dMe{constructor(e){return this._cell=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._cell.table.componentFunctionBinder.handle("cell",i._cell,r)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,i){typeof i>"u"&&(i=!0),this._cell.setValue(e,i)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class CN extends sc{constructor(e,i){super(e.table),this.table=e.table,this.column=e,this.row=i,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell"),this.column.isRowHeader&&this.element.classList.add("tabulator-row-header")}_configureCell(){var e=this.element,i=this.column.getField(),r={top:"flex-start",bottom:"flex-end",middle:"center"},n={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=r[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=n[this.column.hozAlign]||"")),i&&e.setAttribute("tabulator-field",i),this.column.definition.cssClass){var a=this.column.definition.cssClass.split(" ");a.forEach(s=>{e.classList.add(s)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,i,r){var n=this.setValueProcessData(e,i,r);n&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,i,r){var n=!1;return(this.value!==e||r)&&(n=!0,i&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),n&&this.dispatch("cell-value-changed",this),n}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new dMe(this)),this.component}}class pMe{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._column.table.componentFunctionBinder.handle("column",i._column,r)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(i){e.push(i.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(i){e.push(i.getComponent())}),e}getParentColumn(){return this._column.getParentComponent()}_getSelf(){return this._column}scrollTo(e,i){return this._column.table.columnManager.scrollToColumn(this._column,e,i)}getTable(){return this._column.table}move(e,i){var r=this._column.table.columnManager.findColumn(e);r?this._column.table.columnManager.moveColumn(this._column,r,i):console.warn("Move Error - No matching column found:",r)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var i;return e===!0?i=this._column.reinitializeWidth(!0):i=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),i}}var fMe={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};class ym extends sc{static defaultOptionList=fMe;constructor(e,i,r){super(i.table),this.definition=e,this.parent=i,this.type="column",this.columns=[],this.cells=[],this.isGroup=!1,this.isRowHeader=r,this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((n,a)=>{var s=new ym(n,this);this.attachColumn(s)}),this.checkColumnVisibility()):i.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.isRowHeader&&e.classList.add("tabulator-row-header"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let i in e)typeof this.definition[i]>"u"&&(this.definition[i]=e[i]);this.definition=this.table.columnManager.optionsList.generate(ym.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{ym.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var i=e.cssClass.split(" ");i.forEach(r=>{this.element.classList.add(r)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,i=document.createElement("div");if(i.classList.add("tabulator-col-title"),e.headerWordWrap&&i.classList.add("tabulator-col-title-wrap"),e.editableTitle){var r=document.createElement("input");r.classList.add("tabulator-title-editor"),r.addEventListener("click",n=>{n.stopPropagation(),r.focus()}),r.addEventListener("mousedown",n=>{n.stopPropagation()}),r.addEventListener("change",()=>{e.title=r.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),i.appendChild(r),e.field?this.langBind("columns|"+e.field,n=>{r.value=n||e.title||"&nbsp;"}):r.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,n=>{this._formatColumnHeaderTitle(i,n||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(i,e.title||"&nbsp;");return i}_formatColumnHeaderTitle(e,i){var r=this.chain("column-format",[this,i,e],null,()=>i);switch(typeof r){case"object":r instanceof Node?e.appendChild(r):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",r));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=r}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(i=>{this.element.classList.add(i)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var i=e,r=this.fieldStructure,n=r.length,a;for(let s=0;s<n&&(i=i[r[s]],a=i,!!i);s++);return a}_setFlatData(e,i){this.field&&(e[this.field]=i)}_setNestedData(e,i){var r=e,n=this.fieldStructure,a=n.length;for(let s=0;s<a;s++)if(s==a-1)r[n[s]]=i;else{if(!r[n[s]])if(typeof i<"u")r[n[s]]={};else break;r=r[n[s]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,i){var r=this.parent.isGroup?this.parent.getGroupElement().clientHeight:i||this.parent.getHeadersElement().clientHeight;this.element.style.height=r+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=r-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(n){n.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var i=[];return e?this.columns.forEach(r=>{i.push(r),i=i.concat(r.getColumns(!0))}):i=this.columns,i}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var i=[];return this.isGroup&&e&&(this.columns.forEach(function(r){i.push(r.getDefinition(!0))}),this.definition.columns=i),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(i){i.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,i){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,i){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.hide()}),this.dispatch("column-hide",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.table.initialized&&(this.element.style.width=e+"px"),this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var i=this.columns.indexOf(e);i>-1&&this.columns.splice(i,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(i){i.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this),this.subscribedExternal("columnWidth")&&this.dispatchExternal("columnWidth",this.getComponent())}checkCellHeights(){var e=[];this.cells.forEach(function(i){i.row.heightInitialized&&(i.row.getElement().offsetParent!==null?(e.push(i.row),i.row.clearCellHeight()):i.row.heightInitialized=!1)}),e.forEach(function(i){i.calcHeight()}),e.forEach(function(i){i.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(i){i.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(i){i.setMaxWidth()})}delete(){return new Promise((e,i)=>{this.isGroup&&this.columns.forEach(function(n){n.delete()}),this.dispatch("column-delete",this);var r=this.cells.length;for(let n=0;n<r;n++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var i=new CN(this,e);return this.cells.push(i),i}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(n=>{n.clearWidth()}));var i=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(n=>{var a=n.getWidth();a>i&&(i=a)}),i)){var r=i+1;e?this.setWidth(r):(this.maxInitialWidth&&!e&&(r=Math.min(r,this.maxInitialWidth)),this.setWidthActual(r))}}}updateDefinition(e){var i;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(i=Object.assign({},this.getDefinition()),i=Object.assign(i,e),this.table.columnManager.addColumn(i,!1,this).then(r=>(i.field==this.field&&(this.field=!1),this.delete().then(()=>r.getComponent()))))}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}getComponent(){return this.component||(this.component=new pMe(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}getParentComponent(){return this.parent instanceof ym?this.parent.getComponent():!1}}class PH{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,i){return this._row.table.rowManager.scrollToRow(this._row,e,i)}move(e,i){this._row.moveToRow(e,i)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class gc extends sc{constructor(e,i,r="row"){super(i.table),this.parent=i,this.data={},this.type=r,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,i){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,i),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,i)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var i=0,r=0;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(r=this.calcMinHeight(),i=this.calcMaxHeight(),e?this.height=Math.max(i,r):this.height=this.manualHeight?this.height:Math.max(i,r)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}calcMinHeight(){return this.table.options.resizableRows?this.element.clientHeight:0}calcMaxHeight(){var e=0;return this.cells.forEach(function(i){var r=i.getHeight();r>e&&(e=r)}),e}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,i){(this.height!=e||i)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight,this.subscribedExternal("rowHeight")&&this.dispatchExternal("rowHeight",this.getComponent()))}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var i=this.element&&Ma.elVisible(this.element),r={},n;return new Promise((a,s)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(r=Object.assign(r,this.data),r=Object.assign(r,e)),n=this.chain("row-data-changing",[this,r,e],null,e);for(let o in n)this.data[o]=n[o];this.dispatch("row-data-save-after",this);for(let o in e)this.table.columnManager.getColumnsByFieldRoot(o).forEach(c=>{let u=this.getCell(c.getField());if(u){let d=c.getFieldValue(n);u.getValue()!==d&&(u.setValueProcessData(d),i&&u.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),a()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var i=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),i=this.cells.find(function(r){return r.column===e}),i}getCellIndex(e){return this.cells.findIndex(function(i){return i===e})}findCell(e){return this.cells.find(i=>i.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,i){var r=this.table.rowManager.findRow(e);r?(this.table.rowManager.moveRowActual(this,r,!i),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let i=0;i<e;i++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(i=>{i(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new PH(this)),this.component}}var Sdt={avg:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:2;return t.length&&(r=t.reduce(function(a,s){return Number(a)+Number(s)}),r=r/t.length,r=n!==!1?r.toFixed(n):r),parseFloat(r).toString()},max:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a>r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},min:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a<r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},sum:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:!1;return t.length&&t.forEach(function(a){a=Number(a),r+=isNaN(a)?0:Number(a)}),n!==!1?r.toFixed(n):r},concat:function(t,e,i){var r=0;return t.length&&(r=t.reduce(function(n,a){return String(n)+String(a)})),r},count:function(t,e,i){var r=0;return t.length&&t.forEach(function(n){n&&r++}),r},unique:function(t,e,i){var r=t.filter((n,a)=>(t||n===0)&&t.indexOf(n)===a);return r.length}};class jU extends Or{static moduleName="columnCalcs";static calculations=Sdt;constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new ym({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,i){return this.topRow&&i.unshift(this.topRow),this.botRow&&i.push(this.botRow),i}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var i=e.definition,r={topCalcParams:i.topCalcParams||{},botCalcParams:i.bottomCalcParams||{}};if(i.topCalc){switch(typeof i.topCalc){case"string":jU.calculations[i.topCalc]?r.topCalc=jU.calculations[i.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.topCalc);break;case"function":r.topCalc=i.topCalc;break}r.topCalc&&(e.modules.columnCalcs=r,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(i.bottomCalc){switch(typeof i.bottomCalc){case"string":jU.calculations[i.bottomCalc]?r.botCalc=jU.calculations[i.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.bottomCalc);break;case"function":r.botCalc=i.bottomCalc;break}r.botCalc&&(e.modules.columnCalcs=r,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var i,r;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(i=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),r=this.generateRow("top",i),this.topRow=r;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(r.getElement()),r.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),r=this.generateRow("bottom",i),this.botRow=r;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(r.getElement()),r.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(i=>{this.recalcGroup(i)})}}recalcGroup(e){var i,r;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(i=this.rowsToData(e.rows),r=this.generateRowData("bottom",i),e.calcs.bottom.updateData(r),e.calcs.bottom.reinitialize()),e.calcs.top&&(i=this.rowsToData(e.rows),r=this.generateRowData("top",i),e.calcs.top.updateData(r),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var i=[],r=this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs,n=this.table.modules.dataTree;return e.forEach(a=>{i.push(a.getData()),r&&a.modules.dataTree?.open&&this.rowsToData(n.getFilteredTreeChildren(a)).forEach(s=>{i.push(a)})}),i}generateRow(e,i){var r=this.generateRowData(e,i),n;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),n=new gc(r,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),n.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),n.component=!1,n.getComponent=()=>(n.component||(n.component=new wdt(n)),n.component),n.generateCells=()=>{var a=[];this.table.columnManager.columnsByIndex.forEach(s=>{this.genColumn.setField(s.getField()),this.genColumn.hozAlign=s.hozAlign,s.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.lookupFormatter(s.definition[e+"CalcFormatter"]),params:s.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.lookupFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=s.definition.cssClass;var o=new CN(this.genColumn,n);o.getElement(),o.column=s,o.setWidth(),s.cells.push(o),a.push(o),s.visible||o.hide()}),n.cells=a},n}generateRowData(e,i){var r={},n=e=="top"?this.topCalcs:this.botCalcs,a=e=="top"?"topCalc":"botCalc",s,o;return n.forEach(function(l){var c=[];l.modules.columnCalcs&&l.modules.columnCalcs[a]&&(i.forEach(function(u){c.push(l.getFieldValue(u))}),o=a+"Params",s=typeof l.modules.columnCalcs[o]=="function"?l.modules.columnCalcs[o](c,i):l.modules.columnCalcs[o],l.setFieldValue(r,l.modules.columnCalcs[a](c,i,s)))}),r}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},i;return this.table.options.groupBy&&this.table.modExists("groupRows")?(i=this.table.modules.groupRows.getGroups(!0),i.forEach(r=>{e[r.getKey()]=this.getGroupResults(r)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var i=e._getSelf(),r=e.getSubGroups(),n={},a={};return r.forEach(s=>{n[s.getKey()]=this.getGroupResults(s)}),a={top:i.calcs.top?i.calcs.top.getData():{},bottom:i.calcs.bottom?i.calcs.bottom.getData():{},groups:n},a}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}}class Udt extends Or{static moduleName="dataTree";constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,i=this.table.options;switch(this.field=i.dataTreeChildField,this.indent=i.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),i.dataTreeBranchElement?i.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof i.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=i.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),i.dataTreeCollapseElement?typeof i.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=i.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),i.dataTreeExpandElement?typeof i.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=i.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof i.dataTreeStartExpanded){case"boolean":this.startOpen=function(r,n){return i.dataTreeStartExpanded};break;case"function":this.startOpen=i.dataTreeStartExpanded;break;default:this.startOpen=function(r,n){return i.dataTreeStartExpanded[n]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var i;e&&(i=this.table.rowManager.getRows(),i.forEach(r=>{this.reinitializeRowChildren(r)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(i=>{e=e.concat(this.getTreeChildren(i,!1,!0))}),e}rowDataChanged(e,i,r){this.redrawNeeded(r)&&(this.initializeRow(e),i&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var i=e.column.getField();i===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var i=e.getData()[this.field],r=Array.isArray(i),n=r||!r&&typeof i=="object"&&i!==null;!n&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!n&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:n?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&n?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&n?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:n}}reinitializeRowChildren(e){var i=this.getTreeChildren(e,!1,!0);i.forEach(function(r){r.reinitialize(!0)})}layoutRow(e){var i=this.elementField?e.getCell(this.elementField):e.getCells()[0],r=i.getElement(),n=e.modules.dataTree;n.branchEl&&(n.branchEl.parentNode&&n.branchEl.parentNode.removeChild(n.branchEl),n.branchEl=!1),n.controlEl&&(n.controlEl.parentNode&&n.controlEl.parentNode.removeChild(n.controlEl),n.controlEl=!1),this.generateControlElement(e,r),e.getElement().classList.add("tabulator-tree-level-"+n.index),n.index&&(this.branchEl?(n.branchEl=this.branchEl.cloneNode(!0),r.insertBefore(n.branchEl,r.firstChild),this.table.rtl?n.branchEl.style.marginRight=(n.branchEl.offsetWidth+n.branchEl.style.marginLeft)*(n.index-1)+n.index*this.indent+"px":n.branchEl.style.marginLeft=(n.branchEl.offsetWidth+n.branchEl.style.marginRight)*(n.index-1)+n.index*this.indent+"px"):this.table.rtl?r.style.paddingRight=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-right"))+n.index*this.indent+"px":r.style.paddingLeft=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-left"))+n.index*this.indent+"px")}generateControlElement(e,i){var r=e.modules.dataTree,n=r.controlEl;i=i||e.getCells()[0].getElement(),r.children!==!1&&(r.open?(r.controlEl=this.collapseEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.collapseRow(e)})):(r.controlEl=this.expandEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.expandRow(e)})),r.controlEl.addEventListener("mousedown",a=>{a.stopPropagation()}),n&&n.parentNode===i?n.parentNode.replaceChild(r.controlEl,n):i.insertBefore(r.controlEl,i.firstChild))}getRows(e){var i=[];return e.forEach((r,n)=>{var a,s;i.push(r),r instanceof gc&&(r.create(),a=r.modules.dataTree,!a.index&&a.children!==!1&&(s=this.getChildren(r,!1,!0),s.forEach(o=>{o.create(),i.push(o)})))}),i}getChildren(e,i,r){var n=e.modules.dataTree,a=[],s=[];return n.children!==!1&&(n.open||i)&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?a=this.table.modules.filter.filter(n.children):a=n.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(a,r),a.forEach(o=>{s.push(o);var l=this.getChildren(o,!1,!0);l.forEach(c=>{s.push(c)})})),s}generateChildren(e){var i=[],r=e.getData()[this.field];return Array.isArray(r)||(r=[r]),r.forEach(n=>{var a=new gc(n||{},this.table.rowManager);a.create(),a.modules.dataTree.index=e.modules.dataTree.index+1,a.modules.dataTree.parent=e,a.modules.dataTree.children&&(a.modules.dataTree.open=this.startOpen(a.getComponent(),a.modules.dataTree.index)),i.push(a)}),i}expandRow(e,i){var r=e.modules.dataTree;r.children!==!1&&(r.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var i=e.modules.dataTree,r=[],n;return i.children&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?n=this.table.modules.filter.filter(i.children):n=i.children,n.forEach(a=>{a instanceof gc&&r.push(a)})),r}rowDeleting(e){var i=e.modules.dataTree;i&&i.children&&Array.isArray(i.children)&&i.children.forEach(r=>{r instanceof gc&&r.wipe()})}rowDelete(e){var i=e.modules.dataTree.parent,r;i&&(r=this.findChildIndex(e,i),r!==!1&&i.data[this.field].splice(r,1),i.data[this.field].length||delete i.data[this.field],this.initializeRow(i),this.layoutRow(i)),this.refreshData(!0)}addTreeChildRow(e,i,r,n){var a=!1;typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof n<"u"&&(a=this.findChildIndex(n,e),a!==!1&&e.data[this.field].splice(r?a:a+1,0,i)),a===!1&&(r?e.data[this.field].unshift(i):e.data[this.field].push(i)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,i){var r=!1;return typeof e=="object"?e instanceof gc?r=e.data:e instanceof PH?r=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?i.modules.dataTree&&(r=i.modules.dataTree.children.find(n=>n instanceof gc?n.element===e:!1),r&&(r=r.data)):e===null&&(r=!1):typeof e>"u"?r=!1:r=i.data[this.field].find(n=>n.data[this.table.options.index]==e),r&&(Array.isArray(i.data[this.field])&&(r=i.data[this.field].indexOf(r)),r==-1&&(r=!1)),r}getTreeChildren(e,i,r){var n=e.modules.dataTree,a=[];return n&&n.children&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),n.children.forEach(s=>{s instanceof gc&&(a.push(i?s.getComponent():s),r&&this.getTreeChildren(s,i,r).forEach(o=>{a.push(o)}))})),a}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}function Tdt(t,e={},i){var r=e.delimiter?e.delimiter:",",n=[],a=[];t.forEach(s=>{var o=[];switch(s.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":s.columns.forEach((l,c)=>{l&&l.depth===1&&(a[c]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":s.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}o.push('"'+String(l.value).split('"').join('""')+'"')}}),n.push(o.join(r));break}}),a.length&&n.unshift(a.join(r)),n=n.join(`
`),e.bom&&(n="\uFEFF"+n),i(n,"text/csv")}function Cdt(t,e,i){var r=[];t.forEach(n=>{var a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(s=>{s&&(a[s.component.getTitleDownload()||s.component.getField()]=s.value)}),r.push(a);break}}),r=JSON.stringify(r,null,"	"),i(r,"application/json")}function Edt(t,e={},i){var r=[],n=[],a={},s=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},o=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},c=e.title?e.title:"",u,d;l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),t.forEach(f=>{switch(f.type){case"header":r.push(p(f));break;case"group":n.push(p(f,s));break;case"calc":n.push(p(f,o));break;case"row":n.push(p(f));break}});function p(f,h){var m=[];return f.columns.forEach(A=>{var g;if(A){switch(typeof A.value){case"object":A.value=A.value!==null?JSON.stringify(A.value):"";break;case"undefined":A.value="";break}g={content:A.value,colSpan:A.width,rowSpan:A.height},h&&(g.styles=h),m.push(g)}}),m}u=this.dependencyRegistry.lookup("jspdf","jsPDF"),d=new u(l),e.autoTable&&(typeof e.autoTable=="function"?a=e.autoTable(d)||{}:a=e.autoTable),c&&(a.didDrawPage=function(f){d.text(c,40,30)}),a.head=r,a.body=n,d.autoTable(a),e.documentProcessing&&e.documentProcessing(d),i(d.output("arraybuffer"),"application/pdf")}function Ddt(t,e,i){var r=this,n=e.sheetName||"Sheet1",a=this.dependencyRegistry.lookup("XLSX"),s=a.utils.book_new(),o=new sc(this),l="compress"in e?e.compress:!0,c=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:l},u;c.type="binary",s.SheetNames=[],s.Sheets={};function d(){var h=[],m=[],A={},g={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce((v,b)=>v+(b&&b.width?b.width:1),0):0,r:t.length}};return t.forEach((v,b)=>{var y=[];v.columns.forEach(function(I,w){I?(y.push(!(I.value instanceof Date)&&typeof I.value=="object"?JSON.stringify(I.value):I.value),(I.width>1||I.height>-1)&&(I.height>1||I.width>1)&&m.push({s:{r:b,c:w},e:{r:b+I.height-1,c:w+I.width-1}})):y.push("")}),h.push(y)}),a.utils.sheet_add_aoa(A,h),A["!ref"]=a.utils.encode_range(g),m.length&&(A["!merges"]=m),A}if(e.sheetOnly){i(d());return}if(e.sheets)for(var p in e.sheets)e.sheets[p]===!0?(s.SheetNames.push(p),s.Sheets[p]=d()):(s.SheetNames.push(p),o.commsSend(e.sheets[p],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:r.active,intercept:function(h){s.Sheets[p]=h}}));else s.SheetNames.push(n),s.Sheets[n]=d();e.documentProcessing&&(s=e.documentProcessing(s));function f(h){for(var m=new ArrayBuffer(h.length),A=new Uint8Array(m),g=0;g!=h.length;++g)A[g]=h.charCodeAt(g)&255;return m}u=a.write(s,c),i(f(u),"application/octet-stream")}function Pdt(t,e,i){this.modExists("export",!0)&&i(this.modules.export.generateHTMLTable(t),"text/html")}function Rdt(t,e,i){const r=[];t.forEach(n=>{const a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(s=>{s&&(a[s.component.getTitleDownload()||s.component.getField()]=s.value)}),r.push(JSON.stringify(a));break}}),i(r.join(`
`),"application/x-ndjson")}var Mdt={csv:Tdt,json:Cdt,jsonLines:Rdt,pdf:Edt,xlsx:Ddt,html:Pdt};class sO extends Or{static moduleName="download";static downloaders=Mdt;constructor(e){super(e),this.registerTableOption("downloadEncoder",function(i,r){return new Blob([i],{type:r})}),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){}downloadToTab(e,i,r,n){this.download(e,i,r,n,!0)}download(e,i,r,n,a){var s=!1;function o(c,u){a?a===!0?this.triggerDownload(c,u,e,i,!0):a(c):this.triggerDownload(c,u,e,i)}if(typeof e=="function"?s=e:sO.downloaders[e]?s=sO.downloaders[e]:console.warn("Download Error - No such download type found: ",e),s){var l=this.generateExportList(n);s.call(this.table,l,r||{},o.bind(this))}}generateExportList(e){var i=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),r=this.table.options.groupHeaderDownload;return r&&!Array.isArray(r)&&(r=[r]),i.forEach(n=>{var a;n.type==="group"&&(a=n.columns[0],r&&r[n.indent]&&(a.value=r[n.indent](a.value,n.component._group.getRowCount(),n.component._group.getData(),n.component)))}),i}triggerDownload(e,i,r,n,a){var s=document.createElement("a"),o=this.table.options.downloadEncoder(e,i);o&&(a?window.open(window.URL.createObjectURL(o)):(n=n||"Tabulator."+(typeof r=="function"?"txt":r),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(o,n):(s.setAttribute("href",window.URL.createObjectURL(o)),s.setAttribute("download",n),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s))),this.dispatchExternal("downloadComplete"))}commsReceived(e,i,r){i==="intercept"&&this.download(r.type,"",r.options,r.active,r.intercept)}}function RH(t,e){var i=e.mask,r=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",n=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",a=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function s(o){var l=i[o];typeof l<"u"&&l!==a&&l!==r&&l!==n&&(t.value=t.value+""+l,s(o+1))}t.addEventListener("keydown",o=>{var l=t.value.length,c=o.key;if(o.keyCode>46&&!o.ctrlKey&&!o.metaKey){if(l>=i.length)return o.preventDefault(),o.stopPropagation(),!1;switch(i[l]){case r:if(c.toUpperCase()==c.toLowerCase())return o.preventDefault(),o.stopPropagation(),!1;break;case n:if(isNaN(c))return o.preventDefault(),o.stopPropagation(),!1;break;case a:break;default:if(c!==i[l])return o.preventDefault(),o.stopPropagation(),!1}}}),t.addEventListener("keyup",o=>{o.keyCode>46&&e.maskAutoFill&&s(t.value.length)}),t.placeholder||(t.placeholder=i),e.maskAutoFill&&s(t.value.length)}function Ndt(t,e,i,r,n){var a=t.getValue(),s=document.createElement("input");if(s.setAttribute("type",n.search?"search":"text"),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),s.setAttribute(l,s.getAttribute(l)+n.elementAttributes["+"+l])):s.setAttribute(l,n.elementAttributes[l]);s.value=typeof a<"u"?a:"",e(function(){t.getType()==="cell"&&(s.focus({preventScroll:!0}),s.style.height="100%",n.selectContents&&s.select())});function o(l){(a===null||typeof a>"u")&&s.value!==""||s.value!==a?i(s.value)&&(a=s.value):r()}return s.addEventListener("change",o),s.addEventListener("blur",o),s.addEventListener("keydown",function(l){switch(l.keyCode){case 13:o();break;case 27:r();break;case 35:case 36:l.stopPropagation();break}}),n.mask&&RH(s,n),s}function Bdt(t,e,i,r,n){var a=t.getValue(),s=n.verticalNavigation||"hybrid",o=String(a!==null&&typeof a<"u"?a:""),l=document.createElement("textarea"),c=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",n.elementAttributes&&typeof n.elementAttributes=="object")for(let d in n.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),l.setAttribute(d,l.getAttribute(d)+n.elementAttributes["+"+d])):l.setAttribute(d,n.elementAttributes[d]);l.value=o,e(function(){t.getType()==="cell"&&(l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",t.getRow().normalizeHeight(),n.selectContents&&l.select())});function u(d){(a===null||typeof a>"u")&&l.value!==""||l.value!==a?(i(l.value)&&(a=l.value),setTimeout(function(){t.getRow().normalizeHeight()},300)):r()}return l.addEventListener("change",u),l.addEventListener("blur",u),l.addEventListener("keyup",function(){l.style.height="";var d=l.scrollHeight;l.style.height=d+"px",d!=c&&(c=d,t.getRow().normalizeHeight())}),l.addEventListener("keydown",function(d){switch(d.keyCode){case 13:d.shiftKey&&n.shiftEnterSubmit&&u();break;case 27:r();break;case 38:(s=="editor"||s=="hybrid"&&l.selectionStart)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 40:(s=="editor"||s=="hybrid"&&l.selectionStart!==l.value.length)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 35:case 36:d.stopPropagation();break}}),n.mask&&RH(l,n),l}function kdt(t,e,i,r,n){var a=t.getValue(),s=n.verticalNavigation||"editor",o=document.createElement("input");if(o.setAttribute("type","number"),typeof n.max<"u"&&o.setAttribute("max",n.max),typeof n.min<"u"&&o.setAttribute("min",n.min),typeof n.step<"u"&&o.setAttribute("step",n.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let u in n.elementAttributes)u.charAt(0)=="+"?(u=u.slice(1),o.setAttribute(u,o.getAttribute(u)+n.elementAttributes["+"+u])):o.setAttribute(u,n.elementAttributes[u]);o.value=a;var l=function(u){c()};e(function(){t.getType()==="cell"&&(o.removeEventListener("blur",l),o.focus({preventScroll:!0}),o.style.height="100%",o.addEventListener("blur",l),n.selectContents&&o.select())});function c(){var u=o.value;!isNaN(u)&&u!==""&&(u=Number(u)),u!==a?i(u)&&(a=u):r()}return o.addEventListener("keydown",function(u){switch(u.keyCode){case 13:c();break;case 27:r();break;case 38:case 40:s=="editor"&&(u.stopImmediatePropagation(),u.stopPropagation());break;case 35:case 36:u.stopPropagation();break}}),n.mask&&RH(o,n),o}function xdt(t,e,i,r,n){var a=t.getValue(),s=document.createElement("input");if(s.setAttribute("type","range"),typeof n.max<"u"&&s.setAttribute("max",n.max),typeof n.min<"u"&&s.setAttribute("min",n.min),typeof n.step<"u"&&s.setAttribute("step",n.step),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),s.setAttribute(l,s.getAttribute(l)+n.elementAttributes["+"+l])):s.setAttribute(l,n.elementAttributes[l]);s.value=a,e(function(){t.getType()==="cell"&&(s.focus({preventScroll:!0}),s.style.height="100%")});function o(){var l=s.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=a?i(l)&&(a=l):r()}return s.addEventListener("blur",function(l){o()}),s.addEventListener("keydown",function(l){switch(l.keyCode){case 13:o();break;case 27:r();break}}),s}function _dt(t,e,i,r,n){var a=n.format,s=n.verticalNavigation||"editor",o=a?window.DateTime||luxon.DateTime:null,l=t.getValue(),c=document.createElement("input");function u(p){var f;return o.isDateTime(p)?f=p:a==="iso"?f=o.fromISO(String(p)):f=o.fromFormat(String(p),a),f.toFormat("yyyy-MM-dd")}if(c.type="date",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.max&&c.setAttribute("max",a?u(n.max):n.max),n.min&&c.setAttribute("min",a?u(n.min):n.min),n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+n.elementAttributes["+"+p])):c.setAttribute(p,n.elementAttributes[p]);l=typeof l<"u"?l:"",a&&(o?l=u(l):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=l,e(function(){t.getType()==="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function d(){var p=c.value,f;if((l===null||typeof l>"u")&&p!==""||p!==l){if(p&&a)switch(f=o.fromFormat(String(p),"yyyy-MM-dd"),a){case!0:p=f;break;case"iso":p=f.toISO();break;default:p=f.toFormat(a)}i(p)&&(l=c.value)}else r()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}function Odt(t,e,i,r,n){var a=n.format,s=n.verticalNavigation||"editor",o=a?window.DateTime||luxon.DateTime:null,l,c=t.getValue(),u=document.createElement("input");if(u.type="time",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+n.elementAttributes["+"+p])):u.setAttribute(p,n.elementAttributes[p]);c=typeof c<"u"?c:"",a&&(o?(o.isDateTime(c)?l=c:a==="iso"?l=o.fromISO(String(c)):l=o.fromFormat(String(c),a),c=l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=c,e(function(){t.getType()=="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",n.selectContents&&u.select())});function d(){var p=u.value,f;if((c===null||typeof c>"u")&&p!==""||p!==c){if(p&&a)switch(f=o.fromFormat(String(p),"hh:mm"),a){case!0:p=f;break;case"iso":p=f.toISO();break;default:p=f.toFormat(a)}i(p)&&(c=u.value)}else r()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}function Fdt(t,e,i,r,n){var a=n.format,s=n.verticalNavigation||"editor",o=a?this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"):null,l,c=t.getValue(),u=document.createElement("input");if(u.type="datetime-local",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+n.elementAttributes["+"+p])):u.setAttribute(p,n.elementAttributes[p]);c=typeof c<"u"?c:"",a&&(o?(o.isDateTime(c)?l=c:a==="iso"?l=o.fromISO(String(c)):l=o.fromFormat(String(c),a),c=l.toFormat("yyyy-MM-dd")+"T"+l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=c,e(function(){t.getType()==="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",n.selectContents&&u.select())});function d(){var p=u.value,f;if((c===null||typeof c>"u")&&p!==""||p!==c){if(p&&a)switch(f=o.fromISO(String(p)),a){case!0:p=f;break;case"iso":p=f.toISO();break;default:p=f.toFormat(a)}i(p)&&(c=u.value)}else r()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}let Ldt=class{constructor(e,i,r,n,a,s){this.edit=e,this.table=e.table,this.cell=i,this.params=this._initializeParams(s),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=i.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:n,cancel:a},this._deprecatedOptionsCheck(),this._initializeValue(),r(this._onRendered.bind(this))}_deprecatedOptionsCheck(){}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function i(r){r.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",i),setTimeout(()=>{e.removeEventListener("click",i)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,i=document.createElement("input");if(i.setAttribute("type",this.params.clearable?"search":"text"),i.style.padding="4px",i.style.width="100%",i.style.boxSizing="border-box",this.params.autocomplete||(i.style.cursor="default",i.style.caretColor="transparent"),e&&typeof e=="object")for(let r in e)r.charAt(0)=="+"?(r=r.slice(1),i.setAttribute(r,i.getAttribute(r)+e["+"+r])):i.setAttribute(r,e[r]);return this.params.mask&&RH(i,this.params),this._bindInputEvents(i),i}_initializeParams(e){var i=["values","valuesURL","valuesLookup"],r;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",r=Object.keys(e).filter(n=>i.includes(n)).length,r?r>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i>0&&this._focusItem(this.displayItems[i-1]))}_keyDown(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i<this.displayItems.length-1&&(i==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[i+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var i=String.fromCharCode(e).toLowerCase();this.filterTerm+=i.toLowerCase();var r=this.displayItems.find(n=>typeof n.label<"u"&&n.label.toLowerCase().startsWith(this.filterTerm));r&&this._focusItem(r),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var i=[],r=++this.listIteration;return this.filtered=!1,this.params.values?i=this.params.values:this.params.valuesURL?i=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?i=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(i=this._uniqueColumnValues(this.params.valuesLookupField)),i instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),i.then().then(n=>this.listIteration===r?this._parseList(n):Promise.reject(r))):Promise.resolve(this._parseList(i))}_addPlaceholder(e){var i=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?i=e:(i.classList.add("tabulator-edit-list-placeholder"),i.innerHTML=e),this.listEl.appendChild(i),this._showList())}_ajaxRequest(e,i){var r=this.params.filterRemote?{term:i}:{};return e=uMe(e,{},r),fetch(e).then(n=>n.ok?n.json().catch(a=>(console.warn("List Ajax Load Error - Invalid JSON returned",a),Promise.reject(a))):(console.error("List Ajax Load Error - Connection Error: "+n.status,n.statusText),Promise.reject(n))).catch(n=>(console.error("List Ajax Load Error - Connection Error: ",n),Promise.reject(n)))}_uniqueColumnValues(e){var i={},r=this.table.getData(this.params.valuesLookup),n;return e?n=this.table.columnManager.getColumnByField(e):n=this.cell.getColumn()._getSelf(),n?r.forEach(a=>{var s=n.getFieldValue(a);this._emptyValueCheck(s)||(this.params.multiselect&&Array.isArray(s)?s.forEach(o=>{this._emptyValueCheck(o)||(i[o]=!0)}):i[s]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),i=[]),Object.keys(i)}_emptyValueCheck(e){return e===null||typeof e>"u"||e===""}_parseList(e){var i=[];return Array.isArray(e)||(e=Object.entries(e).map(([r,n])=>({label:n,value:r}))),e.forEach(r=>{typeof r!="object"&&(r={label:r,value:r}),this._parseListItem(r,i,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=i,i}_parseListItem(e,i,r){var n={};e.options?n=this._parseListGroup(e,r+1):(n={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:r,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(n,!0)),i.push(n)}_parseListGroup(e,i){var r={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:i,options:[],original:e};return e.options.forEach(n=>{this._parseListItem(n,r.options,i)}),r}_sortOptions(e){var i;return this.params.sort&&(i=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(i,e)),e}_sortGroup(e,i){i.sort((r,n)=>e(r.label,n.label,r.value,n.value,r.original,n.original)),i.forEach(r=>{r.group&&this._sortGroup(e,r.options)})}_defaultSortFunction(e,i){var r,n,a,s,o=0,l,c=/(\d+)|(\D+)/g,u=/\d/,d=0;if(this.params.sort==="desc"&&([e,i]=[i,e]),!e&&e!==0)d=!i&&i!==0?0:-1;else if(!i&&i!==0)d=1;else{if(isFinite(e)&&isFinite(i))return e-i;if(r=String(e).toLowerCase(),n=String(i).toLowerCase(),r===n)return 0;if(!(u.test(r)&&u.test(n)))return r>n?1:-1;for(r=r.match(c),n=n.match(c),l=r.length>n.length?n.length:r.length;o<l;)if(a=r[o],s=n[o++],a!==s)return isFinite(a)&&isFinite(s)?(a.charAt(0)==="0"&&(a="."+a),s.charAt(0)==="0"&&(s="."+s),a-s):a>s?1:-1;return r.length>n.length}return d}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,i=this.input.value;return i?(this.filtered=!0,this.data.forEach(r=>{this._filterItem(e,i,r)})):this.filtered=!1,this.data}_filterItem(e,i,r){var n=!1;return r.group?(r.options.forEach(a=>{this._filterItem(e,i,a)&&(n=!0)}),r.visible=n):r.visible=e(i,r.label,r.value,r.original),r.visible}_defaultFilterFunc(e,i,r,n){return e=String(e).toLowerCase(),i!==null&&typeof i<"u"&&(String(i).toLowerCase().indexOf(e)>-1||String(r).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(i=>{this._buildItem(i)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var i=e.element,r;if(!this.filtered||e.visible){if(!i){if(i=document.createElement("div"),i.tabIndex=0,r=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,i):e.label,r instanceof HTMLElement?i.appendChild(r):i.innerHTML=r,e.group?i.classList.add("tabulator-edit-list-group"):i.classList.add("tabulator-edit-list-item"),i.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let n in e.elementAttributes)n.charAt(0)=="+"?(n=n.slice(1),i.setAttribute(n,this.input.getAttribute(n)+e.elementAttributes["+"+n])):i.setAttribute(n,e.elementAttributes[n]);e.group?i.addEventListener("click",this._groupClick.bind(this,e)):i.addEventListener("click",this._itemClick.bind(this,e)),i.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=i}this._styleItem(e),this.listEl.appendChild(i),e.group?e.options.forEach(n=>{this._buildItem(n)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,i){i.stopPropagation(),this._chooseItem(e)}_groupClick(e,i){i.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,i){var r;this.typing=!1,this.params.multiselect?(r=this.currentItems.indexOf(e),r>-1?(this.currentItems.splice(r,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(n=>n.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),i||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var i,r;if(this.popup&&this.popup.hide(!0),this.params.multiselect)i=this.currentItems.map(n=>n.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")i=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?i=this.currentItems[0].value:(r=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,r===null||typeof r>"u"||r===""?i=r:i=this.params.emptyValue);i===""&&(i=this.params.emptyValue),this.actions.success(i),this.isFilter&&(this.initialValues=i&&!Array.isArray(i)?[i]:i,this.currentItems=[])}};function $dt(t,e,i,r,n){var a=new Ldt(this,t,e,i,r,n);return a.input}function Hdt(t,e,i,r,n){var a=this,s=t.getElement(),o=t.getValue(),l=s.getElementsByTagName("svg").length||5,c=s.getElementsByTagName("svg")[0]?s.getElementsByTagName("svg")[0].getAttribute("width"):14,u=[],d=document.createElement("div"),p=document.createElementNS("http://www.w3.org/2000/svg","svg");function f(g){u.forEach(function(v,b){b<g?(a.table.browser=="ie"?v.setAttribute("class","tabulator-star-active"):v.classList.replace("tabulator-star-inactive","tabulator-star-active"),v.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(a.table.browser=="ie"?v.setAttribute("class","tabulator-star-inactive"):v.classList.replace("tabulator-star-active","tabulator-star-inactive"),v.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function h(g){var v=document.createElement("span"),b=p.cloneNode(!0);u.push(b),v.addEventListener("mouseenter",function(y){y.stopPropagation(),y.stopImmediatePropagation(),f(g)}),v.addEventListener("mousemove",function(y){y.stopPropagation(),y.stopImmediatePropagation()}),v.addEventListener("click",function(y){y.stopPropagation(),y.stopImmediatePropagation(),i(g),s.blur()}),v.appendChild(b),d.appendChild(v)}function m(g){o=g,f(g)}if(s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis",d.style.verticalAlign="middle",d.style.display="inline-block",d.style.padding="4px",p.setAttribute("width",c),p.setAttribute("height",c),p.setAttribute("viewBox","0 0 512 512"),p.setAttribute("xml:space","preserve"),p.style.padding="0 1px",n.elementAttributes&&typeof n.elementAttributes=="object")for(let g in n.elementAttributes)g.charAt(0)=="+"?(g=g.slice(1),d.setAttribute(g,d.getAttribute(g)+n.elementAttributes["+"+g])):d.setAttribute(g,n.elementAttributes[g]);for(var A=1;A<=l;A++)h(A);return o=Math.min(parseInt(o),l),f(o),d.addEventListener("mousemove",function(g){f(0)}),d.addEventListener("click",function(g){i(0)}),s.addEventListener("blur",function(g){r()}),s.addEventListener("keydown",function(g){switch(g.keyCode){case 39:m(o+1);break;case 37:m(o-1);break;case 13:i(o);break;case 27:r();break}}),d}function Vdt(t,e,i,r,n){var a=t.getElement(),s=typeof n.max>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("max")||100:n.max,o=typeof n.min>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("min")||0:n.min,l=(s-o)/100,c=t.getValue()||0,u=document.createElement("div"),d=document.createElement("div"),p,f;function h(){var m=window.getComputedStyle(a,null),A=l*Math.round(d.offsetWidth/((a.clientWidth-parseInt(m.getPropertyValue("padding-left"))-parseInt(m.getPropertyValue("padding-right")))/100))+o;i(A),a.setAttribute("aria-valuenow",A),a.setAttribute("aria-label",c)}if(u.style.position="absolute",u.style.right="0",u.style.top="0",u.style.bottom="0",u.style.width="5px",u.classList.add("tabulator-progress-handle"),d.style.display="inline-block",d.style.position="relative",d.style.height="100%",d.style.backgroundColor="#488CE9",d.style.maxWidth="100%",d.style.minWidth="0%",n.elementAttributes&&typeof n.elementAttributes=="object")for(let m in n.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),d.setAttribute(m,d.getAttribute(m)+n.elementAttributes["+"+m])):d.setAttribute(m,n.elementAttributes[m]);return a.style.padding="4px 4px",c=Math.min(parseFloat(c),s),c=Math.max(parseFloat(c),o),c=Math.round((c-o)/l),d.style.width=c+"%",a.setAttribute("aria-valuemin",o),a.setAttribute("aria-valuemax",s),d.appendChild(u),u.addEventListener("mousedown",function(m){p=m.screenX,f=d.offsetWidth}),u.addEventListener("mouseover",function(){u.style.cursor="ew-resize"}),a.addEventListener("mousemove",function(m){p&&(d.style.width=f+m.screenX-p+"px")}),a.addEventListener("mouseup",function(m){p&&(m.stopPropagation(),m.stopImmediatePropagation(),p=!1,f=!1,h())}),a.addEventListener("keydown",function(m){switch(m.keyCode){case 39:m.preventDefault(),d.style.width=d.clientWidth+a.clientWidth/100+"px";break;case 37:m.preventDefault(),d.style.width=d.clientWidth-a.clientWidth/100+"px";break;case 9:case 13:h();break;case 27:r();break}}),a.addEventListener("blur",function(){r()}),d}function Gdt(t,e,i,r,n){var a=t.getValue(),s=document.createElement("input"),o=n.tristate,l=typeof n.indeterminateValue>"u"?null:n.indeterminateValue,c=!1,u=Object.keys(n).includes("trueValue"),d=Object.keys(n).includes("falseValue");if(s.setAttribute("type","checkbox"),s.style.marginTop="5px",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let f in n.elementAttributes)f.charAt(0)=="+"?(f=f.slice(1),s.setAttribute(f,s.getAttribute(f)+n.elementAttributes["+"+f])):s.setAttribute(f,n.elementAttributes[f]);s.value=a,o&&(typeof a>"u"||a===l||a==="")&&(c=!0,s.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){t.getType()==="cell"&&s.focus({preventScroll:!0})}),s.checked=u?a===n.trueValue:a===!0||a==="true"||a==="True"||a===1;function p(f){var h=s.checked;return u&&h?h=n.trueValue:d&&!h&&(h=n.falseValue),o?f?c?l:h:s.checked&&!c?(s.checked=!1,s.indeterminate=!0,c=!0,l):(c=!1,h):h}return s.addEventListener("change",function(f){i(p())}),s.addEventListener("blur",function(f){i(p(!0))}),s.addEventListener("keydown",function(f){f.keyCode==13&&i(p()),f.keyCode==27&&r()}),s}function Qdt(t,e,i,r,n){var a=t._getSelf().column,s,o,l;function c(u){var d=u.getValue(),p="input";switch(typeof d){case"number":p="number";break;case"boolean":p="tickCross";break;case"string":d.includes(`
`)&&(p="textarea");break}return p}return s=n.editorLookup?n.editorLookup(t):c(t),n.paramsLookup&&(l=typeof n.paramsLookup=="function"?n.paramsLookup(s,t):n.paramsLookup[s]),o=this.table.modules.edit.lookupEditor(s,a),o.call(this,t,e,i,r,l||{})}var jdt={input:Ndt,textarea:Bdt,number:kdt,range:xdt,date:_dt,time:Odt,datetime:Fdt,list:$dt,star:Hdt,progress:Vdt,tickCross:Gdt,adaptable:Qdt};class pZ extends Or{static moduleName="edit";static editors=jdt;constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.convertEmptyValues=!1,this.editors=pZ.editors,this.registerTableOption("editTriggerEvent","focus"),this.registerTableOption("editorEmptyValue"),this.registerTableOption("editorEmptyValueFunc",this.emptyValueCheck.bind(this)),this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("editorEmptyValue"),this.registerColumnOption("editorEmptyValueFunc"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0)),Object.keys(this.table.options).includes("editorEmptyValue")&&(this.convertEmptyValues=!0)}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var i=this.currentCell,r=this.options("tabEndNewRow");i&&(this.navigateNext(i,e)||r&&(i.getElement().firstChild.blur(),this.invalidEdit||(r===!0?r=this.table.addRow({}):typeof r=="function"?r=this.table.addRow(r(i.row.getComponent())):r=this.table.addRow(Object.assign({},r)),r.then(()=>{setTimeout(()=>{i.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.table.modules.edit.clearEdited(i._getSelf())})}navigatePrev(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateLeft(),r)return!0;if(n=this.table.rowManager.prevDisplayRow(e.row,!0),n&&(r=this.findPrevEditableCell(n,n.cells.length),r))return r.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateRight(),r)return!0;if(n=this.table.rowManager.nextDisplayRow(e.row,!0),n&&(r=this.findNextEditableCell(n,-1),r))return r.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findPrevEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findNextEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.prevDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.nextDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}findNextEditableCell(e,i){var r=!1;if(i<e.cells.length-1)for(var n=i+1;n<e.cells.length;n++){let a=e.cells[n];if(a.column.modules.edit&&Ma.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}findPrevEditableCell(e,i){var r=!1;if(i>0)for(var n=i-1;n>=0;n--){let a=e.cells[n];if(a.column.modules.edit&&Ma.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(i=>{i.column.modules.edit&&typeof i.column.modules.edit.check=="function"&&this.updateCellClass(i)})}initializeColumn(e){var i=Object.keys(e.definition).includes("editorEmptyValue"),r={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{},convertEmptyValues:i,editorEmptyValue:e.definition.editorEmptyValue,editorEmptyValueFunc:e.definition.editorEmptyValueFunc};r.editor=this.lookupEditor(e.definition.editor,e),r.editor&&(e.modules.edit=r)}lookupEditor(e,i){var r;switch(typeof e){case"string":this.editors[e]?r=this.editors[e]:console.warn("Editor Error - No such editor found: ",e);break;case"function":r=e;break;case"boolean":e===!0&&(typeof i.definition.formatter!="function"?this.editors[i.definition.formatter]?r=this.editors[i.definition.formatter]:r=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",i.definition.formatter));break}return r}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var i=this.currentCell,r;if(this.invalidEdit=!1,i){for(this.currentCell=!1,r=i.getElement(),this.dispatch("edit-editor-clear",i,e),r.classList.remove("tabulator-editing");r.firstChild;)r.removeChild(r.firstChild);i.row.getElement().classList.remove("tabulator-editing"),i.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,i=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,i),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",i)}}bindEditor(e){if(e.column.modules.edit){var i=this,r=e.getElement(!0);this.updateCellClass(e),r.setAttribute("tabindex",0),r.addEventListener("mousedown",function(n){n.button===2?n.preventDefault():i.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&r.addEventListener("dblclick",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&r.addEventListener("click",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),this.options("editTriggerEvent")==="focus"&&r.addEventListener("focus",function(n){i.recursionBlock||i.edit(e,n,!1)})}}focusCellNoEvent(e,i){this.recursionBlock=!0,i&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,i){this.focusCellNoEvent(e),this.edit(e,!1,i)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var i=this.table.rowManager.element.scrollTop,r=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,n=e.row.getElement();n.offsetTop<i?this.table.rowManager.element.scrollTop-=i-n.offsetTop:n.offsetTop+n.offsetHeight>r&&(this.table.rowManager.element.scrollTop+=n.offsetTop+n.offsetHeight-r);var a=this.table.rowManager.element.scrollLeft,s=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,o=e.getElement();this.table.modExists("frozenColumns")&&(a+=parseInt(this.table.modules.frozenColumns.leftMargin||0),s-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(a-=parseInt(this.table.columnManager.renderer.vDomPadLeft),s-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),o.offsetLeft<a?this.table.rowManager.element.scrollLeft-=a-o.offsetLeft:o.offsetLeft+o.offsetWidth>s&&(this.table.rowManager.element.scrollLeft+=o.offsetLeft+o.offsetWidth-s)}}allowEdit(e){var i=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(i=e.column.modules.edit.check(e.getComponent()));break;case"string":i=!!e.row.data[e.column.modules.edit.check];break;case"boolean":i=e.column.modules.edit.check;break}return i}edit(e,i,r){var n=this,a=!0,s=function(){},o=e.getElement(),l=!1,c,u,d;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function p(g){if(n.currentCell===e&&!l){var v=n.chain("edit-success",[e,g],!0,!0);return v===!0||n.table.options.validationMode==="highlight"?(l=!0,n.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,n.editedCells.indexOf(e)==-1&&n.editedCells.push(e),g=n.transformEmptyValues(g,e),e.setValue(g,!0),v===!0):(l=!0,n.invalidEdit=!0,n.focusCellNoEvent(e,!0),s(),setTimeout(()=>{l=!1},10),!1)}}function f(){n.currentCell===e&&!l&&n.cancelEdit()}function h(g){s=g}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(o),!1;if(i&&i.stopPropagation(),a=this.allowEdit(e),a||r){if(n.cancelEdit(),n.currentCell=e,this.focusScrollAdjust(e),u=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,i,u)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,u),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",u),d=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(u):e.column.modules.edit.params,c=e.column.modules.edit.editor.call(n,u,h,p,f,d),this.currentCell&&c!==!1)if(c instanceof Node){for(o.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");o.firstChild;)o.removeChild(o.firstChild);o.appendChild(c),s();for(var m=o.children,A=0;A<m.length;A++)m[A].addEventListener("click",function(g){g.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",c),this.blur(o),!1;else return this.blur(o),!1;return!0}else return this.mouseClick=!1,this.blur(o),!1}emptyValueCheck(e){return e===""||e===null||typeof e>"u"}transformEmptyValues(e,i){var r=i.column.modules.edit,n=r.convertEmptyValues||this.convertEmptyValues,a;return n&&(a=r.editorEmptyValueFunc||this.options("editorEmptyValueFunc"),a&&a(e)&&(e=r.convertEmptyValues?r.editorEmptyValue:this.options("editorEmptyValue"))),e}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(i=>{e.push(i.getComponent())}),e}clearEdited(e){var i;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),i=this.editedCells.indexOf(e),i>-1&&this.editedCells.splice(i,1)}}class ine{constructor(e,i,r,n){this.type=e,this.columns=i,this.component=r||!1,this.indent=n||0}}class RG{constructor(e,i,r,n,a){this.value=e,this.component=i||!1,this.width=r,this.height=n,this.depth=a}}var zdt={},qdt={visible:function(){return this.rowManager.getVisibleRows(!1,!0)},all:function(){return this.rowManager.rows},selected:function(){return this.modules.selectRow.selectedRows},active:function(){return this.options.pagination?this.rowManager.getDisplayRows(this.rowManager.displayRows.length-2):this.rowManager.getDisplayRows()}};class D0 extends Or{static moduleName="export";static columnLookups=zdt;static rowLookups=qdt;constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.colVisPropAttach="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,i,r,n){var a,s,o,l;return this.cloneTableStyle=i,this.config=e||{},this.colVisProp=n,this.colVisPropAttach=this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1),l=D0.columnLookups[r],l&&(o=l.call(this.table),o=o.filter(c=>this.columnVisCheck(c))),a=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(o)):[],o&&(o=o.map(c=>c.getComponent())),s=this.bodyToExportRows(this.rowLookup(r),o),a.concat(s)}generateTable(e,i,r,n){var a=this.generateExportList(e,i,r,n);return this.generateTableElement(a)}rowLookup(e){var i=[],r;return typeof e=="function"?e.call(this.table).forEach(n=>{n=this.table.rowManager.findRow(n),n&&i.push(n)}):(r=D0.rowLookups[e]||D0.rowLookups.active,i=r.call(this.table)),Object.assign([],i)}generateColumnGroupHeaders(e){var i=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(r=>{var n=this.processColumnGroup(r);n&&i.push(n)}),i}processColumnGroup(e){var i=e.columns,r=0,n=e.definition["title"+this.colVisPropAttach]||e.definition.title,a={title:n,column:e,depth:1};if(i.length){if(a.subGroups=[],a.width=0,i.forEach(s=>{var o=this.processColumnGroup(s);o&&(a.width+=o.width,a.subGroups.push(o),o.depth>r&&(r=o.depth))}),a.depth+=r,!a.width)return!1}else if(this.columnVisCheck(e))a.width=1;else return!1;return a}columnVisCheck(e){var i=e.definition[this.colVisProp];return this.config.rowHeaders===!1&&e.isRowHeader?!1:(typeof i=="function"&&(i=i.call(this.table,e.getComponent())),i===!1||i===!0?i:e.visible&&e.field)}headersToExportRows(e){var i=[],r=0,n=[];function a(s,o){var l=r-o;if(typeof i[o]>"u"&&(i[o]=[]),s.height=s.subGroups?1:l-s.depth+1,i[o].push(s),s.height>1)for(let c=1;c<s.height;c++)typeof i[o+c]>"u"&&(i[o+c]=[]),i[o+c].push(!1);if(s.width>1)for(let c=1;c<s.width;c++)i[o].push(!1);s.subGroups&&s.subGroups.forEach(function(c){a(c,o+1)})}return e.forEach(function(s){s.depth>r&&(r=s.depth)}),e.forEach(function(s){a(s,0)}),i.forEach(s=>{var o=[];s.forEach(l=>{if(l){let c=typeof l.title>"u"?"":l.title;o.push(new RG(c,l.column.getComponent(),l.width,l.height,l.depth))}else o.push(null)}),n.push(new ine("header",o))}),n}bodyToExportRows(e,i=[]){var r=[];return i.length===0&&this.table.columnManager.columnsByIndex.forEach(n=>{this.columnVisCheck(n)&&i.push(n.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(n=>{switch(n.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&n.modules.dataTree.parent)}return!0}),e.forEach((n,a)=>{var s=n.getData(this.colVisProp),o=[],l=0;switch(n.type){case"group":l=n.level,o.push(new RG(n.key,n.getComponent(),i.length,1));break;case"calc":case"row":i.forEach(c=>{o.push(new RG(c._column.getFieldValue(s),c,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=n.modules.dataTree.index);break}r.push(new ine(n.type,o,n.getComponent(),l))}),r}generateTableElement(e){var i=document.createElement("table"),r=document.createElement("thead"),n=document.createElement("tbody"),a=this.lookupTableStyles(),s=this.table.options["rowFormatter"+this.colVisPropAttach],o={};return o.rowFormatter=s!==null?s:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(o.treeElementField=this.table.modules.dataTree.elementField),o.groupHeader=this.table.options["groupHeader"+this.colVisPropAttach],o.groupHeader&&!Array.isArray(o.groupHeader)&&(o.groupHeader=[o.groupHeader]),i.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),r,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,c)=>{let u;switch(l.type){case"header":r.appendChild(this.generateHeaderElement(l,o,a));break;case"group":n.appendChild(this.generateGroupElement(l,o,a));break;case"calc":n.appendChild(this.generateCalcElement(l,o,a));break;case"row":u=this.generateRowElement(l,o,a),this.mapElementStyles(c%2&&a.evenRow?a.evenRow:a.oddRow,u,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n.appendChild(u);break}}),r.innerHTML&&i.appendChild(r),i.appendChild(n),this.mapElementStyles(this.table.element,i,["border-top","border-left","border-right","border-bottom"]),i}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.styleRowHeader=e.firstRow.getElementsByClassName("tabulator-row-header")[0],e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,i,r){var n=document.createElement("tr");return e.columns.forEach(a=>{if(a){var s=document.createElement("th"),o=a.component._column.definition.cssClass?a.component._column.definition.cssClass.split(" "):[];s.colSpan=a.width,s.rowSpan=a.height,s.innerHTML=a.value,this.cloneTableStyle&&(s.style.boxSizing="border-box"),o.forEach(function(l){s.classList.add(l)}),this.mapElementStyles(a.component.getElement(),s,["text-align","border-left","border-right","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(a.component._column.contentElement,s,["padding-top","padding-left","padding-right","padding-bottom"]),a.component._column.visible?this.mapElementStyles(a.component.getElement(),s,["width"]):a.component._column.definition.width&&(s.style.width=a.component._column.definition.width+"px"),a.component._column.parent&&a.component._column.parent.isGroup?this.mapElementStyles(a.component._column.parent.groupElement,s,["border-top"]):this.mapElementStyles(a.component.getElement(),s,["border-top"]),a.component._column.isGroup?this.mapElementStyles(a.component.getElement(),s,["border-bottom"]):this.mapElementStyles(this.table.columnManager.getElement(),s,["border-bottom"]),n.appendChild(s)}}),n}generateGroupElement(e,i,r){var n=document.createElement("tr"),a=document.createElement("td"),s=e.columns[0];return n.classList.add("tabulator-print-table-row"),i.groupHeader&&i.groupHeader[e.indent]?s.value=i.groupHeader[e.indent](s.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):i.groupHeader!==!1&&(s.value=e.component._group.generator(s.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),a.colSpan=s.width,a.innerHTML=s.value,n.classList.add("tabulator-print-table-group"),n.classList.add("tabulator-group-level-"+e.indent),s.component.isVisible()&&n.classList.add("tabulator-group-visible"),this.mapElementStyles(r.firstGroup,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(r.firstGroup,a,["padding-top","padding-left","padding-right","padding-bottom"]),n.appendChild(a),n}generateCalcElement(e,i,r){var n=this.generateRowElement(e,i,r);return n.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(r.calcRow,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n}generateRowElement(e,i,r){var n=document.createElement("tr");if(n.classList.add("tabulator-print-table-row"),e.columns.forEach((a,s)=>{if(a){var o=document.createElement("td"),l=a.component._column,c=this.table,u=c.columnManager.findColumnIndex(l),d=a.value,p,f,h={modules:{},getValue:function(){return d},getField:function(){return l.definition.field},getElement:function(){return o},getType:function(){return"cell"},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return c},getComponent:function(){return h},column:l},m=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(m.forEach(function(A){o.classList.add(A)}),this.table.modExists("format")&&this.config.formatCells!==!1)d=this.table.modules.format.formatExportValue(h,this.colVisProp);else switch(typeof d){case"object":d=d!==null?JSON.stringify(d):"";break;case"undefined":d="";break}d instanceof Node?o.appendChild(d):o.innerHTML=d,f=["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"],l.isRowHeader?(p=r.styleRowHeader,f.push("background-color")):p=r.styleCells&&r.styleCells[u]?r.styleCells[u]:r.firstCell,p&&(this.mapElementStyles(p,o,f),l.definition.align&&(o.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(i.treeElementField&&i.treeElementField==l.field||!i.treeElementField&&s==0)&&(e.component._row.modules.dataTree.controlEl&&o.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),o.firstChild),e.component._row.modules.dataTree.branchEl&&o.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),o.firstChild)),n.appendChild(o),h.modules.format&&h.modules.format.renderedCallback&&h.modules.format.renderedCallback()}}),i.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let a=Object.assign(e.component);a.getElement=function(){return n},i.rowFormatter(e.component)}return n}generateHTMLTable(e){var i=document.createElement("div");return i.appendChild(this.generateTableElement(e)),i.innerHTML}getHtml(e,i,r,n){var a=this.generateExportList(r||this.table.options.htmlOutputConfig,i,e,n||"htmlOutput");return this.generateHTMLTable(a)}mapElementStyles(e,i,r){if(this.cloneTableStyle&&e&&i){var n={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var a=window.getComputedStyle(e);r.forEach(function(s){i.style[n[s]]||(i.style[n[s]]=a.getPropertyValue(s))})}}}}var Wdt={"=":function(t,e,i,r){return e==t},"<":function(t,e,i,r){return e<t},"<=":function(t,e,i,r){return e<=t},">":function(t,e,i,r){return e>t},">=":function(t,e,i,r){return e>=t},"!=":function(t,e,i,r){return e!=t},regex:function(t,e,i,r){return typeof t=="string"&&(t=new RegExp(t)),t.test(e)},like:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(t.toLowerCase())>-1:!1},keywords:function(t,e,i,r){var n=t.toLowerCase().split(typeof r.separator>"u"?" ":r.separator),a=String(e===null||typeof e>"u"?"":e).toLowerCase(),s=[];return n.forEach(o=>{a.includes(o)&&s.push(!0)}),r.matchAll?s.length===n.length:!!s.length},starts:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(t.toLowerCase()):!1},ends:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(t.toLowerCase()):!1},in:function(t,e,i,r){return Array.isArray(t)?t.length?t.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",t),!1)}};class rI extends Or{static moduleName="filter";static filters=Wdt;constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var i=this.table.columnManager.findColumn(e.field);if(i)this.setHeaderFilterValue(i,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,i,r,n){return n.filter=this.getFilters(!0,!0),n}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,i,r,n){this.setFilter(e,i,r,n),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,i,r,n){this.addFilter(e,i,r,n),this.refreshFilter()}userSetHeaderFilterFocus(e){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterFocus(i);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var i=this.table.columnManager.findColumn(e);if(i)return this.getHeaderFilterValue(i);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,i){var r=this.table.columnManager.findColumn(e);if(r)this.setHeaderFilterValue(r,i);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,i,r){this.removeFilter(e,i,r),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,i,r){return this.search("rows",e,i,r)}searchData(e,i,r){return this.search("data",e,i,r)}initializeColumnHeaderFilter(e){var i=e.definition;i.headerFilter&&this.initializeColumn(e)}initializeColumn(e,i){var r=this,n=e.getField();function a(s){var o=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",c="",u;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==s){if(e.modules.filter.prevSuccess=s,e.modules.filter.emptyFunc(s))delete r.headerFilters[n];else{switch(e.modules.filter.value=s,typeof e.definition.headerFilterFunc){case"string":rI.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,u=function(d){var p=e.definition.headerFilterFuncParams||{},f=e.getFieldValue(d);return p=typeof p=="function"?p(s,f,d):p,rI.filters[e.definition.headerFilterFunc](s,f,d,p)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":u=function(d){var p=e.definition.headerFilterFuncParams||{},f=e.getFieldValue(d);return p=typeof p=="function"?p(s,f,d):p,e.definition.headerFilterFunc(s,f,d,p)},l=u;break}u||(o==="partial"?(u=function(d){var p=e.getFieldValue(d);return typeof p<"u"&&p!==null?String(p).toLowerCase().indexOf(String(s).toLowerCase())>-1:!1},l="like"):(u=function(d){return e.getFieldValue(d)==s},l="=")),r.headerFilters[n]={value:s,func:u,type:l}}e.modules.filter.value=s,c=JSON.stringify(r.headerFilters),r.prevHeaderFilterChangeCheck!==c&&(r.prevHeaderFilterChangeCheck=c,r.trackChanges(),r.refreshFilter())}return!0}e.modules.filter={success:a,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,i,r){var n=this,a=e.modules.filter.success,s=e.getField(),o,l,c,u,d,p,f,h;e.modules.filter.value=i;function m(){}function A(g){h=g}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),s){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(g){return!g&&g!==0},o=document.createElement("div"),o.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":n.table.modules.edit.editors[e.definition.headerFilter]?(l=n.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(g){return g!==!0&&g!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&n.table.modules.edit.editors[e.definition.formatter]?(l=n.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(g){return g!==!0&&g!==!1})):l=n.table.modules.edit.editors.input;break}if(l){if(u={getValue:function(){return typeof i<"u"?i:""},getField:function(){return e.definition.field},getElement:function(){return o},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},f=e.definition.headerFilterParams||{},f=typeof f=="function"?f.call(n.table,u):f,c=l.call(this.table.modules.edit,u,A,a,m,f),!c){console.warn("Filter Error - Cannot add filter to "+s+" column, editor returned a value of false");return}if(!(c instanceof Node)){console.warn("Filter Error - Cannot add filter to "+s+" column, editor should return an instance of Node, the editor returned:",c);return}n.langBind("headerFilters|columns|"+e.definition.field,function(g){c.setAttribute("placeholder",typeof g<"u"&&g?g:e.definition.headerFilterPlaceholder||n.langText("headerFilters|default"))}),c.addEventListener("click",function(g){g.stopPropagation(),c.focus()}),c.addEventListener("focus",g=>{var v=this.table.columnManager.contentsElement.scrollLeft,b=this.table.rowManager.element.scrollLeft;v!==b&&(this.table.rowManager.scrollHorizontal(v),this.table.columnManager.scrollHorizontal(v))}),d=!1,p=function(g){d&&clearTimeout(d),d=setTimeout(function(){a(c.value)},n.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=c,e.modules.filter.attrType=c.hasAttribute("type")?c.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=c.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(c.addEventListener("keyup",p),c.addEventListener("search",p),e.modules.filter.attrType=="number"&&c.addEventListener("change",function(g){a(c.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&c.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&c.addEventListener("mousedown",function(g){g.stopPropagation()})),o.appendChild(c),e.contentElement.appendChild(o),r||n.headerFilterColumns.push(e),h&&h()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,i){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,i,!0),e.modules.filter.success(i)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,i,r,n){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),this.addFilter(e)}addFilter(e,i,r,n){var a=!1;Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),e.forEach(s=>{s=this.findFilter(s),s&&(this.filterList.push(s),a=!0)}),a&&this.trackChanges()}findFilter(e){var i;if(Array.isArray(e))return this.findSubFilters(e);var r=!1;return typeof e.field=="function"?r=function(n){return e.field(n,e.type||{})}:rI.filters[e.type]?(i=this.table.columnManager.getColumnByField(e.field),i?r=function(n){return rI.filters[e.type](e.value,i.getFieldValue(n),n,e.params||{})}:r=function(n){return rI.filters[e.type](e.value,n[e.field],n,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=r,e.func?e:!1}findSubFilters(e){var i=[];return e.forEach(r=>{r=this.findFilter(r),r&&i.push(r)}),i.length?i:!1}getFilters(e,i){var r=[];return e&&(r=this.getHeaderFilters()),i&&r.forEach(function(n){typeof n.type=="function"&&(n.type="function")}),r=r.concat(this.filtersToArray(this.filterList,i)),r}filtersToArray(e,i){var r=[];return e.forEach(n=>{var a;Array.isArray(n)?r.push(this.filtersToArray(n,i)):(a={field:n.field,type:n.type,value:n.value},i&&typeof a.type=="function"&&(a.type="function"),r.push(a))}),r}getHeaderFilters(){var e=[];for(var i in this.headerFilters)e.push({field:i,type:this.headerFilters[i].type,value:this.headerFilters[i].value});return e}removeFilter(e,i,r){Array.isArray(e)||(e=[{field:e,type:i,value:r}]),e.forEach(n=>{var a=-1;typeof n.field=="object"?a=this.filterList.findIndex(s=>n===s):a=this.filterList.findIndex(s=>n.field===s.field&&n.type===s.type&&n.value===s.value),a>-1?this.filterList.splice(a,1):console.warn("Filter Error - No matching filter type found, ignoring: ",n.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,i,r,n){var a=[],s=[];return Array.isArray(i)||(i=[{field:i,type:r,value:n}]),i.forEach(o=>{o=this.findFilter(o),o&&s.push(o)}),this.table.rowManager.rows.forEach(o=>{var l=!0;s.forEach(c=>{this.filterRecurse(c,o.getData())||(l=!1)}),l&&a.push(e==="data"?o.getData("data"):o.getComponent())}),a}filter(e,i){var r=[],n=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(a=>{this.filterRow(a)&&r.push(a)}):r=e.slice(0),this.subscribedExternal("dataFiltered")&&(r.forEach(a=>{n.push(a.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),n)),r}filterRow(e,i){var r=!0,n=e.getData();this.filterList.forEach(s=>{this.filterRecurse(s,n)||(r=!1)});for(var a in this.headerFilters)this.headerFilters[a].func(n)||(r=!1);return r}filterRecurse(e,i){var r=!1;return Array.isArray(e)?e.forEach(n=>{this.filterRecurse(n,i)&&(r=!0)}):r=e.func(i),r}}function Kdt(t,e,i){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function Ydt(t,e,i){return t.getValue()}function Xdt(t,e,i){return t.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function Zdt(t,e,i){var r=parseFloat(t.getValue()),n="",a,s,o,l,c,u=e.decimal||".",d=e.thousand||",",p=e.negativeSign||"-",f=e.symbol||"",h=!!e.symbolAfter,m=typeof e.precision<"u"?e.precision:2;if(isNaN(r))return this.emptyToSpace(this.sanitizeHTML(t.getValue()));if(r<0&&(r=Math.abs(r),n=p),a=m!==!1?r.toFixed(m):r,a=String(a).split("."),s=a[0],o=a.length>1?u+a[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(s);)s=s.replace(l,"$1"+d+"$2");return c=s+o,n===!0?(c="("+c+")",h?c+f:f+c):h?n+c+f:n+f+c}function Jdt(t,e,i){var r=t.getValue(),n=e.urlPrefix||"",a=e.download,s=r,o=document.createElement("a"),l;function c(u,d){var p=u.shift(),f=d[p];return u.length&&typeof f=="object"?c(u,f):f}if(e.labelField&&(l=t.getData(),s=c(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":s=e.label;break;case"function":s=e.label(t);break}if(s){if(e.urlField&&(l=t.getData(),r=Ma.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,l)),e.url)switch(typeof e.url){case"string":r=e.url;break;case"function":r=e.url(t);break}return o.setAttribute("href",n+r),e.target&&o.setAttribute("target",e.target),e.download&&(typeof a=="function"?a=a(t):a=a===!0?"":a,o.setAttribute("download",a)),o.innerHTML=this.emptyToSpace(this.sanitizeHTML(s)),o}else return"&nbsp;"}function ept(t,e,i){var r=document.createElement("img"),n=t.getValue();switch(e.urlPrefix&&(n=e.urlPrefix+t.getValue()),e.urlSuffix&&(n=n+e.urlSuffix),r.setAttribute("src",n),typeof e.height){case"number":r.style.height=e.height+"px";break;case"string":r.style.height=e.height;break}switch(typeof e.width){case"number":r.style.width=e.width+"px";break;case"string":r.style.width=e.width;break}return r.addEventListener("load",function(){t.getRow().normalizeHeight()}),r}function tpt(t,e,i){var r=t.getValue(),n=t.getElement(),a=e.allowEmpty,s=e.allowTruthy,o=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',c=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return o&&r===e.trueValue||!o&&(s&&r||r===!0||r==="true"||r==="True"||r===1||r==="1")?(n.setAttribute("aria-checked",!0),l||""):a&&(r==="null"||r===""||r===null||typeof r>"u")?(n.setAttribute("aria-checked","mixed"),""):(n.setAttribute("aria-checked",!1),c||"")}function ipt(t,e,i){var r=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=e.outputFormat||"dd/MM/yyyy HH:mm:ss",s=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=t.getValue();if(typeof r<"u"){var l;return r.isDateTime(o)?l=o:n==="iso"?l=r.fromISO(String(o)):l=r.fromFormat(String(o),n),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(a)):s===!0||!o?o:typeof s=="function"?s(o):s}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function rpt(t,e,i){var r=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",s=typeof e.suffix<"u"?e.suffix:!1,o=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,c=typeof e.date<"u"?e.date:r.now(),u=t.getValue();if(typeof r<"u"){var d;return r.isDateTime(u)?d=u:n==="iso"?d=r.fromISO(String(u)):d=r.fromFormat(String(u),n),d.isValid?l?d.diff(c,o).toHuman()+(s?" "+s:""):parseInt(d.diff(c,o)[o])+(s?" "+s:""):a===!0?u:typeof a=="function"?a(u):a}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function npt(t,e,i){var r=t.getValue();return typeof e[r]>"u"?(console.warn("Missing display value for "+r),r):e[r]}function apt(t,e,i){var r=t.getValue(),n=t.getElement(),a=e&&e.stars?e.stars:5,s=document.createElement("span"),o=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',c='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';s.style.verticalAlign="middle",o.setAttribute("width","14"),o.setAttribute("height","14"),o.setAttribute("viewBox","0 0 512 512"),o.setAttribute("xml:space","preserve"),o.style.padding="0 1px",r=r&&!isNaN(r)?parseInt(r):0,r=Math.max(0,Math.min(r,a));for(var u=1;u<=a;u++){var d=o.cloneNode(!0);d.innerHTML=u<=r?l:c,s.appendChild(d)}return n.style.whiteSpace="nowrap",n.style.overflow="hidden",n.style.textOverflow="ellipsis",n.setAttribute("aria-label",r),s}function spt(t,e,i){var r=this.sanitizeHTML(t.getValue())||0,n=document.createElement("span"),a=e&&e.max?e.max:100,s=e&&e.min?e.min:0,o=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",c,u;if(!(isNaN(r)||typeof t.getValue()>"u")){switch(n.classList.add("tabulator-traffic-light"),u=parseFloat(r)<=a?parseFloat(r):a,u=parseFloat(u)>=s?parseFloat(u):s,c=(a-s)/100,u=Math.round((u-s)/c),typeof o){case"string":l=o;break;case"function":l=o(r);break;case"object":if(Array.isArray(o)){var d=100/o.length,p=Math.floor(u/d);p=Math.min(p,o.length-1),p=Math.max(p,0),l=o[p];break}}return n.style.backgroundColor=l,n}}function opt(t,e={},i){var r=this.sanitizeHTML(t.getValue())||0,n=t.getElement(),a=e.max?e.max:100,s=e.min?e.min:0,o=e.legendAlign?e.legendAlign:"center",l,c,u,d,p;switch(c=parseFloat(r)<=a?parseFloat(r):a,c=parseFloat(c)>=s?parseFloat(c):s,l=(a-s)/100,c=Math.round((c-s)/l),typeof e.color){case"string":u=e.color;break;case"function":u=e.color(r);break;case"object":if(Array.isArray(e.color)){let A=100/e.color.length,g=Math.floor(c/A);g=Math.min(g,e.color.length-1),g=Math.max(g,0),u=e.color[g];break}default:u="#2DC214"}switch(typeof e.legend){case"string":d=e.legend;break;case"function":d=e.legend(r);break;case"boolean":d=r;break;default:d=!1}switch(typeof e.legendColor){case"string":p=e.legendColor;break;case"function":p=e.legendColor(r);break;case"object":if(Array.isArray(e.legendColor)){let A=100/e.legendColor.length,g=Math.floor(c/A);g=Math.min(g,e.legendColor.length-1),g=Math.max(g,0),p=e.legendColor[g]}break;default:p="#000"}n.style.minWidth="30px",n.style.position="relative",n.setAttribute("aria-label",c);var f=document.createElement("div");f.style.display="inline-block",f.style.width=c+"%",f.style.backgroundColor=u,f.style.height="100%",f.setAttribute("data-max",a),f.setAttribute("data-min",s);var h=document.createElement("div");if(h.style.position="relative",h.style.width="100%",h.style.height="100%",d){var m=document.createElement("div");m.style.position="absolute",m.style.top=0,m.style.left=0,m.style.textAlign=o,m.style.width="100%",m.style.color=p,m.innerHTML=d}return i(function(){if(!(t instanceof dMe)){var A=document.createElement("div");A.style.position="absolute",A.style.top="4px",A.style.bottom="4px",A.style.left="4px",A.style.right="4px",n.appendChild(A),n=A}n.appendChild(h),h.appendChild(f),d&&h.appendChild(m)}),""}function lpt(t,e,i){return t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue()),""}function cpt(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function upt(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function dpt(t,e,i){var r=t.getValue(),n=e.size||15,a=n+"px",s,o,l=e.hasOwnProperty("onValue")?e.onValue:!0,c=e.hasOwnProperty("offValue")?e.offValue:!1,u=e.onTruthy?r:r===l;return s=document.createElement("div"),s.classList.add("tabulator-toggle"),u?(s.classList.add("tabulator-toggle-on"),s.style.flexDirection="row-reverse",e.onColor&&(s.style.background=e.onColor)):e.offColor&&(s.style.background=e.offColor),s.style.width=2.5*n+"px",s.style.borderRadius=a,e.clickable&&s.addEventListener("click",d=>{t.setValue(u?c:l)}),o=document.createElement("div"),o.classList.add("tabulator-toggle-switch"),o.style.height=a,o.style.width=a,o.style.borderRadius=a,s.appendChild(o),s}function ppt(t,e,i){var r=document.createElement("span"),n=t.getRow(),a=t.getTable();return n.watchPosition(s=>{e.relativeToPage&&(s+=a.modules.page.getPageSize()*(a.modules.page.getPage()-1)),r.innerText=s}),r}function fpt(t,e,i){return t.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}function hpt(t,e,i){var r,n,a;function s(o){var l=o.getValue(),c="plaintext";switch(typeof l){case"boolean":c="tickCross";break;case"string":l.includes(`
`)&&(c="textarea");break}return c}return r=e.formatterLookup?e.formatterLookup(t):s(t),e.paramsLookup&&(a=typeof e.paramsLookup=="function"?e.paramsLookup(r,t):e.paramsLookup[r]),n=this.table.modules.format.lookupFormatter(r),n.call(this,t,a||{},i)}function mpt(t,e,i){var r=e.delimiter||",",n=t.getValue(),a=this.table,s;return e.valueMap&&(typeof e.valueMap=="string"?s=function(o){return o.map(l=>Ma.retrieveNestedData(a.options.nestedFieldSeparator,e.valueMap,l))}:s=e.valueMap),Array.isArray(n)?(s&&(n=s(n)),n.join(r)):n}function Apt(t,e,i){var r=e.indent||"	",n=typeof e.multiline>"u"?!0:e.multiline,a=e.replacer||null,s=t.getValue();return n&&(t.getElement().style.whiteSpace="pre-wrap"),JSON.stringify(s,a,r)}var gpt={plaintext:Kdt,html:Ydt,textarea:Xdt,money:Zdt,link:Jdt,image:ept,tickCross:tpt,datetime:ipt,datetimediff:rpt,lookup:npt,star:apt,traffic:spt,progress:opt,color:lpt,buttonTick:cpt,buttonCross:upt,toggle:dpt,rownum:ppt,handle:fpt,adaptable:hpt,array:mpt,json:Apt};class zU extends Or{static moduleName="format";static formatters=gpt;constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupTypeFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupTypeFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupTypeFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupTypeFormatter(e,"HtmlOutput"))}lookupTypeFormatter(e,i){var r={params:e.definition["formatter"+i+"Params"]||{}},n=e.definition["formatter"+i];return r.formatter=this.lookupFormatter(n),r}lookupFormatter(e){var i;switch(typeof e){case"string":zU.formatters[e]?i=zU.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),i=zU.formatters.plaintext);break;case"function":i=e;break;default:i=zU.formatters.plaintext;break}return i}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,i,r){var n,a,s,o;return e.definition.titleFormatter?(n=this.lookupFormatter(e.definition.titleFormatter),s=l=>{e.titleFormatterRendered=l},o={getValue:function(){return i},getElement:function(){return r},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},a=e.definition.titleFormatterParams||{},a=typeof a=="function"?a():a,n.call(this,o,a,s)):i}formatValue(e){var i=e.getComponent(),r=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(i):e.column.modules.format.params;function n(a){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=a,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,i,r,n)}formatExportValue(e,i){var r=e.column.modules.format[i],n;if(r){let a=function(s){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=s,e.modules.format.rendered=!1};return n=typeof r.params=="function"?r.params(e.getComponent()):r.params,r.formatter.call(this,e.getComponent(),n,a)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(r){return i[r]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}}class vpt extends Or{static moduleName="frozenColumns";constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("columns-loaded",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var i={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(i.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=i):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(i=>{i.calcs.top&&this.layoutRow(i.calcs.top),i.calcs.bottom&&this.layoutRow(i.calcs.bottom),i.groupList&&i.groupList.length&&this.layoutGroupCalcs(i.groupList)})}layoutColumnPosition(e){var i=[],r=0,n=0;this.leftColumns.forEach((a,s)=>{if(a.modules.frozen.marginValue=r,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(r+=a.getWidth()),s==this.leftColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup){var o=this.getColGroupParentElement(a);i.includes(o)||(this.layoutElement(o,a),i.push(o)),o.classList.toggle("tabulator-frozen-left",a.modules.frozen.edge&&a.modules.frozen.position==="left"),o.classList.toggle("tabulator-frozen-right",a.modules.frozen.edge&&a.modules.frozen.position==="right")}else this.layoutElement(a.getElement(),a);e&&a.cells.forEach(l=>{this.layoutElement(l.getElement(!0),a)})}),this.rightColumns.forEach((a,s)=>{a.modules.frozen.marginValue=n,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(n+=a.getWidth()),s==this.rightColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup?this.layoutElement(this.getColGroupParentElement(a),a):this.layoutElement(a.getElement(),a),e&&a.cells.forEach(o=>{this.layoutElement(o.getElement(!0),a)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));i.forEach(r=>{r.deinitialize()}),e.forEach(r=>{r.type==="row"&&this.layoutRow(r)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)}),this.rightColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)})}layoutElement(e,i){var r;i.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?r=i.modules.frozen.position==="left"?"right":"left":r=i.modules.frozen.position,e.style[r]=i.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",i.modules.frozen.edge&&i.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",i.modules.frozen.edge&&i.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}getFrozenColumns(){return this.leftColumns.concat(this.rightColumns)}_calcSpace(e,i){var r=0;for(let n=0;n<i;n++)e[n].visible&&(r+=e[n].getWidth());return r}}class ypt extends Or{static moduleName="frozenRows";constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var i=this.table.options.frozenRows,r=typeof i;r==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=i&&this.freezeRow(e):r==="function"?i.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(i)&&i.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var i=this.rows.indexOf(e);return i>-1}isFrozen(){return!!this.rows.length}visibleRows(e,i){return this.rows.forEach(r=>{i.push(r)}),i}getRows(e){var i=e.slice(0);return this.rows.forEach(function(r){var n=i.indexOf(r);n>-1&&i.splice(n,1)}),i}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var i=this.rows.indexOf(e);if(i>-1){var r=e.getElement();r.parentNode&&r.parentNode.removeChild(r),this.rows.splice(i,1)}}styleRows(e){this.rows.forEach((i,r)=>{this.table.rowManager.styleRow(i,r)})}}class bpt{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._group.groupManager.table.componentFunctionBinder.handle("group",i._group,r)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,i){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,i)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class qU{constructor(e,i,r,n,a,s,o){this.groupManager=e,this.parent=i,this.key=n,this.level=r,this.field=a,this.hasSubGroups=r<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=o,this.rows=[],this.groups=[],this.groupList=[],this.generator=s,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=o?o.visible:typeof e.startOpen[r]<"u"?e.startOpen[r]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(i){i.wipe()}):this.rows.forEach(i=>{i.modules&&delete i.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(i=>{this._createGroup(i,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",i=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(i.stopPropagation(),i.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,i){var r=i+"_"+e,n=new qU(this.groupManager,this,i,e,this.groupManager.groupIDLookups[i].field,this.groupManager.headerGenerator[i]||this.groupManager.headerGenerator[0],this.old?this.old.groups[r]:!1);this.groups[r]=n,this.groupList.push(n)}_addRowToGroup(e){var i=this.level+1;if(this.hasSubGroups){var r=this.groupManager.groupIDLookups[i].func(e.getData()),n=i+"_"+r;this.groupManager.allowedValues&&this.groupManager.allowedValues[i]?this.groups[n]&&this.groups[n].addRow(e):(this.groups[n]||this._createGroup(r,i),this.groups[n].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,i,r){var n=this.conformRowData({});e.updateData(n);var a=this.rows.indexOf(i);a>-1?r?this.rows.splice(a+1,0,e):this.rows.splice(a,0,e):r?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(i){i.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var i=this.rows.indexOf(e),r=e.getElement();i>-1&&this.rows.splice(i,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(r.parentNode&&r.parentNode.removeChild(r),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(i){e=e.concat(i.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,i){var r=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(n=>{r.push(n.getData(i||"data"))}),r}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(i=>{e+=i.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var i=e.getHeadersAndRows();i.forEach(r=>{r.detachElement()})}):this.rows.forEach(e=>{var i=e.getElement();i.parentNode.removeChild(i)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(i=>{var r=i.getHeadersAndRows();r.forEach(n=>{var a=n.getElement();e.parentNode.insertBefore(a,e.nextSibling),n.initialize(),e=a})}):this.rows.forEach(i=>{var r=i.getElement();e.parentNode.insertBefore(r,e.nextSibling),i.initialize(),e=r}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(i){e.push(i.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var i=!1;return this.groupList.length?this.groupList.forEach(function(r){var n=r.getRowGroup(e);n&&(i=n)}):this.rows.find(function(r){return r===e})&&(i=this),i}getSubGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getRows(e,i){var r=[];return i&&this.groupList.length?this.groupList.forEach(n=>{r=r.concat(n.getRows(e,i))}):this.rows.forEach(function(n){r.push(e?n.getComponent():n)}),r}generateGroupHeaderContents(){var e=[],i=this.getRows(!1,!0);for(i.forEach(function(r){e.push(r.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,Ma.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new bpt(this)),this.component}}class Ipt extends Or{static moduleName="groupRows";constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,i=this.table.options.groupStartOpen,r=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(r)&&e.length>r.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(a,s)=>{this.headerGenerator[0]=(o,l,c)=>(typeof o>"u"?"":o)+"<span>("+l+" "+(l===1?a:s.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var n=this.table.columnManager.getRealColumns();n.forEach(a=>{a.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),a.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((a,s)=>{var o,l;typeof a=="function"?o=a:(l=this.table.columnManager.getColumnByField(a),l?o=function(c){return l.getFieldValue(c)}:o=function(c){return c[a]}),this.groupIDLookups.push({field:typeof a=="function"?!1:a,func:o,values:this.allowedValues?this.allowedValues[s]:!1})}),i&&(Array.isArray(i)||(i=[i]),i.forEach(a=>{}),this.startOpen=i),r&&(this.headerGenerator=Array.isArray(r)?r:[r])}else this.groupList=[],this.groups={}}rowSample(e,i){if(this.table.options.groupBy){var r=this.getGroups(!1)[0];i.push(r.getRows(!1)[0])}return i}virtualRenderFill(){var e=this.table.rowManager.tableElement,i=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)i=i.filter(r=>r.type!=="group"),e.style.minWidth=i.length?"":this.table.columnManager.getWidth()+"px";else return i}rowAddingIndex(e,i,r){if(this.table.options.groupBy){this.assignRowToGroup(e);var n=e.modules.group.rows;return n.length>1&&(!i||i&&n.indexOf(i)==-1?r?n[0]!==e&&(i=n[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):n[n.length-1]!==e&&(i=n[n.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)),i}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,i,r){if(this.table.options.groupBy){!r&&i instanceof qU&&(i=this.table.rowManager.prevDisplayRow(e)||i);var n=i instanceof qU?i:i.modules.group,a=e instanceof qU?e:e.modules.group;n===a?this.table.rowManager.moveRowInArray(n.rows,e,i,r):(a&&a.removeRow(e),n.insertRow(e,i,r))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getChildGroups(e){var i=[];return e||(e=this),e.groupList.forEach(r=>{r.groupList.length?i=i.concat(this.getChildGroups(r)):i.push(r)}),i}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var i=[];return e.forEach(r=>{var n={};n.level=0,n.rowCount=0,n.headerContent="";var a=[];r.hasSubGroups?(a=this.pullGroupListData(r.groupList),n.level=r.level,n.rowCount=a.length-r.groupList.length,n.headerContent=r.generator(r.key,n.rowCount,r.rows,r),i.push(n),i=i.concat(a)):(n.level=r.level,n.headerContent=r.generator(r.key,r.rows.length,r.rows,r),n.rowCount=r.getRows().length,i.push(n),r.getRows().forEach(s=>{i.push(s.getData("data"))}))}),i}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var i=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(r=>{var n=r.getRowGroup(e);n&&(i=n)}),i}countGroups(){return this.groupList.length}generateGroups(e){var i=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(r=>{this.createGroup(r,0,i)}),e.forEach(r=>{this.assignRowToExistingGroup(r,i)})):e.forEach(r=>{this.assignRowToGroup(r,i)}),Object.values(i).forEach(r=>{r.wipe(!0)})}createGroup(e,i,r){var n=i+"_"+e,a;r=r||[],a=new qU(this,!1,i,e,this.groupIDLookups[0].field,this.headerGenerator[0],r[n]),this.groups[n]=a,this.groupList.push(a)}assignRowToExistingGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n="0_"+r;this.groups[n]&&this.groups[n].addRow(e)}assignRowToGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n=!this.groups["0_"+r];return n&&this.createGroup(r,0,i),this.groups["0_"+r].addRow(e),!n}reassignRowToGroup(e){if(e.type==="row"){var i=e.modules.group,r=i.getPath(),n=this.getExpectedPath(e),a;a=r.length==n.length&&r.every((s,o)=>s===n[o]),a||(i.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var i=[],r=e.getData();return this.groupIDLookups.forEach(n=>{i.push(n.func(r))}),i}updateGroupRows(e){var i=[];return this.blockRedraw||(this.groupList.forEach(r=>{i=i.concat(r.getHeadersAndRows())}),e&&this.refreshData(!0)),i}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(i=>{i.scrollHeader(e)}))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,i=!0;this.table.rowManager.getDisplayRows().forEach((r,n)=>{this.table.rowManager.styleRow(r,n),e.appendChild(r.getElement()),r.initialize(!0),r.type!=="group"&&(i=!1)}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}var wpt={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue),t.component.cellRendered()},rowAdd:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(t){var e=t.data.posFrom-t.data.posTo>0;this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},Spt={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue),t.component.cellRendered()},rowAdd:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posTo),t.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},Upt={undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"]},Tpt={undo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.undo()))},redo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.redo()))}},Cpt={keybindings:{bindings:Upt,actions:Tpt}};let Ept=class P3 extends Or{static moduleName="history";static moduleExtensions=Cpt;static undoers=wpt;static redoers=Spt;constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,i,r){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:i.getPosition(),to:i,after:r})}rowAdded(e,i,r,n){this.action("rowAdd",e,{data:i,pos:r,index:n})}rowDeleted(e){var i,r;this.table.options.groupBy?(r=e.getComponent().getGroup()._getSelf().rows,i=r.indexOf(e),i&&(i=r[i-1])):(i=e.table.rowManager.getRowIndex(e),i&&(i=e.table.rowManager.rows[i-1])),this.action("rowDelete",e,{data:e.getData(),pos:!i,index:i})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,i,r){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:i,data:r}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var i=this.history.findIndex(function(r){return r.component===e});i>-1&&(this.history.splice(i,1),i<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return P3.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return P3.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,i){this.history.forEach(function(r){if(r.component instanceof gc)r.component===e&&(r.component=i);else if(r.component instanceof CN&&r.component.row===e){var n=r.component.column.getField();n&&(r.component=i.getCell(n))}})}};class Dpt extends Or{static moduleName="htmlTableImport";constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,i=this.table.options,r=e.getElementsByTagName("th"),n=e.getElementsByTagName("tbody")[0],a=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),n=n?n.getElementsByTagName("tr"):[],this._extractOptions(e,i),r.length?this._extractHeaders(r,n):this._generateBlankHeaders(r,n);for(var s=0;s<n.length;s++){var o=n[s],l=o.getElementsByTagName("td"),c={};this.hasIndex||(c[i.index]=s);for(var u=0;u<l.length;u++){var d=l[u];typeof this.fieldIndex[u]<"u"&&(c[this.fieldIndex[u]]=d.innerHTML)}a.push(c)}i.data=a,this.dispatchExternal("htmlImported")}_extractOptions(e,i,r){var n=e.attributes,a=Object.keys(r||i),s={};a.forEach(u=>{s[u.toLowerCase()]=u});for(var o in n){var l=n[o],c;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(c=l.name.replace("tabulator-",""),typeof s[c]<"u"&&(i[s[c]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var i=this.table.options.columns.find(r=>r.title===e);return i||!1}_extractHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a=!1,s=this._findCol(n.textContent),o;s?a=!0:s={title:n.textContent.trim()},s.field||(s.field=n.textContent.trim().toLowerCase().replaceAll(" ","_")),o=n.getAttribute("width"),o&&!s.width&&(s.width=o),this._extractOptions(n,s,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[r]=s.field,s.field==this.table.options.index&&(this.hasIndex=!0),a||this.table.options.columns.push(s)}}_generateBlankHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a={title:"",field:"col"+r};this.fieldIndex[r]=a.field;var s=n.getAttribute("width");s&&(a.width=s),this.table.options.columns.push(a)}}}function Ppt(t){var e=[],i=0,r=0,n=!1;for(let a=0;a<t.length;a++){let s=t[a],o=t[a+1];if(e[i]||(e[i]=[]),e[i][r]||(e[i][r]=""),s=='"'&&n&&o=='"'){e[i][r]+=s,a++;continue}if(s=='"'){n=!n;continue}if(s==","&&!n){r++;continue}if(s=="\r"&&o==`
`&&!n){r=0,i++,a++;continue}if((s=="\r"||s==`
`)&&!n){r=0,i++;continue}e[i][r]+=s}return e}function Rpt(t){try{return JSON.parse(t)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function Mpt(t){return t}function Npt(t){var e=this.dependencyRegistry.lookup("XLSX"),i=e.read(t),r=i.Sheets[i.SheetNames[0]];return e.utils.sheet_to_json(r,{header:1})}var Bpt={csv:Ppt,json:Rpt,array:Mpt,xlsx:Npt};class fZ extends Or{static moduleName="import";static importers=Bpt;constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text"),this.registerTableOption("importHeaderTransform"),this.registerTableOption("importValueTransform"),this.registerTableOption("importDataValidator"),this.registerTableOption("importFileValidator")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,i,r,n,a){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(s=>(console.error("Import Error:",s||"Unable to import data"),Promise.reject(s)))}lookupImporter(e){var i;return e||(e=this.table.options.importFormat),typeof e=="string"?i=fZ.importers[e]:i=e,i||console.error("Import Error - Importer not found:",e),i}importFromFile(e,i,r){var n=this.lookupImporter(e);if(n)return this.pickFile(i,r).then(this.importData.bind(this,n)).then(this.structureData.bind(this)).then(this.mutateData.bind(this)).then(this.validateData.bind(this)).then(this.setData.bind(this)).catch(a=>(this.dispatch("import-error",a),this.dispatchExternal("importError",a),console.error("Import Error:",a||"Unable to import file"),this.table.dataLoader.alertError(),setTimeout(()=>{this.table.dataLoader.clearAlert()},3e3),Promise.reject(a)))}pickFile(e,i){return new Promise((r,n)=>{var a=document.createElement("input");a.type="file",a.accept=e,a.addEventListener("change",s=>{var o=a.files[0],l=new FileReader,c=this.validateFile(o);if(c===!0){switch(this.dispatch("import-importing",a.files),this.dispatchExternal("importImporting",a.files),i||this.table.options.importReader){case"buffer":l.readAsArrayBuffer(o);break;case"binary":l.readAsBinaryString(o);break;case"url":l.readAsDataURL(o);break;default:l.readAsText(o)}l.onload=u=>{r(l.result)},l.onerror=u=>{console.warn("File Load Error - Unable to read file"),n(u)}}else n(c)}),this.dispatch("import-choose"),this.dispatchExternal("importChoose"),a.click()})}importData(e,i){var r;return this.table.dataLoader.alertLoader(),new Promise((n,a)=>{setTimeout(()=>{r=e.call(this.table,i),r instanceof Promise||r?n(r):a()},10)})}structureData(e){var i=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?i=this.structureArrayToObject(e):i=this.structureArrayToColumns(e),i):e}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(r=>{i.push(this.table.modules.mutator.transformRow(r,"import"))}):i=e,i}transformHeader(e){var i=[];if(this.table.options.importHeaderTransform)e.forEach(r=>{i.push(this.table.options.importHeaderTransform.call(this.table,r,e))});else return e;return i}transformData(e){var i=[];if(this.table.options.importValueTransform)e.forEach(r=>{i.push(this.table.options.importValueTransform.call(this.table,r,e))});else return e;return i}structureArrayToObject(e){var i=this.transformHeader(e.shift()),r=e.map(n=>{var a={};return n=this.transformData(n),i.forEach((s,o)=>{a[s]=n[o]}),a});return r}structureArrayToColumns(e){var i=[],r=this.transformHeader(e[0]),n=this.table.getColumns();return n[0]&&r[0]&&n[0].getDefinition().title===r[0]&&e.shift(),e.forEach(a=>{var s={};a=this.transformData(a),a.forEach((o,l)=>{var c=n[l];c&&(s[c.getField()]=o)}),i.push(s)}),i}validateFile(e){return this.table.options.importFileValidator?this.table.options.importFileValidator.call(this.table,e):!0}validateData(e){var i;return this.table.options.importDataValidator?(i=this.table.options.importDataValidator.call(this.table,e),i===!0?e:Promise.reject(i)):e}setData(e){return this.dispatch("import-imported",e),this.dispatchExternal("importImported",e),this.table.dataLoader.clearAlert(),this.table.setData(e)}}class kpt extends Or{static moduleName="interaction";constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(i=>{for(let r in i)i[r]=null})}cellContentsSelectionFixer(e,i){var r;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===i)){e.preventDefault();try{document.selection?(r=document.body.createTextRange(),r.moveToElementText(i.getElement()),r.select()):window.getSelection&&(r=document.createRange(),r.selectNode(i.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(r))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,i){i?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var i=this.eventMap[e];this.touchSubscribers[i+"-touchstart"]||(this.touchSubscribers[i+"-touchstart"]=this.handleTouch.bind(this,i,"start"),this.touchSubscribers[i+"-touchend"]=this.handleTouch.bind(this,i,"end"),this.subscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.subscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var i=!0,r=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let n in this.eventMap)this.eventMap[n]===r&&this.subscribers[n]&&(i=!1);i&&(this.unsubscribe(r+"-touchstart",this.touchSubscribers[r+"-touchstart"]),this.unsubscribe(r+"-touchend",this.touchSubscribers[r+"-touchend"]),delete this.touchSubscribers[r+"-touchstart"],delete this.touchSubscribers[r+"-touchend"])}}initializeColumn(e){var i=e.definition;for(let r in this.eventMap)i[r]&&(this.subscriptionChanged(r,!0),this.columnSubscribers[r]||(this.columnSubscribers[r]=[]),this.columnSubscribers[r].push(e))}handle(e,i,r){this.dispatchEvent(e,i,r)}handleTouch(e,i,r,n){var a=this.touchWatchers[e];switch(e==="column"&&(e="header"),i){case"start":a.tap=!0,clearTimeout(a.tapHold),a.tapHold=setTimeout(()=>{clearTimeout(a.tapHold),a.tapHold=null,a.tap=null,clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"TapHold",r,n)},1e3);break;case"end":a.tap&&(a.tap=null,this.dispatchEvent(e+"Tap",r,n)),a.tapDbl?(clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"DblTap",r,n)):a.tapDbl=setTimeout(()=>{clearTimeout(a.tapDbl),a.tapDbl=null},300),clearTimeout(a.tapHold),a.tapHold=null;break}}dispatchEvent(e,i,r){var n=r.getComponent(),a;this.columnSubscribers[e]&&(r instanceof CN?a=r.column.definition[e]:r instanceof ym&&(a=r.definition[e]),a&&a(i,n)),this.dispatchExternal(e,i,n)}}var xpt={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35},_pt={keyBlock:function(t){t.stopPropagation(),t.preventDefault()},scrollPageUp:function(t){var e=this.table.rowManager,i=e.scrollTop-e.element.clientHeight;t.preventDefault(),e.displayRowsCount&&(i>=0?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(t){var e=this.table.rowManager,i=e.scrollTop+e.element.clientHeight,r=e.element.scrollHeight;t.preventDefault(),e.displayRowsCount&&(i<=r?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(t){this.dispatch("keybinding-nav-prev",t)},navNext:function(t){this.dispatch("keybinding-nav-next",t)},navLeft:function(t){this.dispatch("keybinding-nav-left",t)},navRight:function(t){this.dispatch("keybinding-nav-right",t)},navUp:function(t){this.dispatch("keybinding-nav-up",t)},navDown:function(t){this.dispatch("keybinding-nav-down",t)}};class P0 extends Or{static moduleName="keybindings";static bindings=xpt;static actions=_pt;constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,i={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(i,P0.bindings),Object.assign(i,e),this.mapBindings(i),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let i in e)P0.actions[i]?e[i]&&(typeof e[i]!="object"&&(e[i]=[e[i]]),e[i].forEach(r=>{var n=Array.isArray(r)?r:[r];n.forEach(a=>{this.mapBinding(i,a)})})):console.warn("Key Binding Error - no such action:",i)}mapBinding(e,i){var r={action:P0.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},n=i.toString().toLowerCase().split(" ").join("").split("+");n.forEach(a=>{switch(a){case"ctrl":r.ctrl=!0;break;case"shift":r.shift=!0;break;case"meta":r.meta=!0;break;default:a=isNaN(a)?a.toUpperCase().charCodeAt(0):parseInt(a),r.keys.push(a),this.watchKeys[a]||(this.watchKeys[a]=[]),this.watchKeys[a].push(r)}})}bindEvents(){var e=this;this.keyupBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];n&&(e.pressedKeys.push(r),n.forEach(function(a){e.checkBinding(i,a)}))},this.keydownBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];if(n){var a=e.pressedKeys.indexOf(r);a>-1&&e.pressedKeys.splice(a,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,i){var r=!0;return e.ctrlKey==i.ctrl&&e.shiftKey==i.shift&&e.metaKey==i.meta?(i.keys.forEach(n=>{var a=this.pressedKeys.indexOf(n);a==-1&&(r=!1)}),r&&i.action.call(this,e),!0):!1}}class Opt extends Or{static moduleName="menu";constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var i=e.definition;i.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),i.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),i.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),i.headerMenu&&this.initializeColumnHeaderMenu(e),i.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),i.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),i.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var i=e.definition.headerMenuIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadMenuTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadMenuEvent(r.column.definition[e],i,r)}loadMenuTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadMenuEvent(r.definition[e],i,r)}loadMenuEvent(e,i,r){r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent()):e,this.loadMenu(i,r,e)}loadMenu(e,i,r,n,a){var s=!(e instanceof MouseEvent),o=document.createElement("div"),l;if(o.classList.add("tabulator-menu"),s||e.preventDefault(),!(!r||!r.length)){if(n)l=a.child(o);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(o)}r.forEach(c=>{var u=document.createElement("div"),d=c.label,p=c.disabled;c.separator?u.classList.add("tabulator-menu-separator"):(u.classList.add("tabulator-menu-item"),typeof d=="function"&&(d=d.call(this.table,i.getComponent())),d instanceof Node?u.appendChild(d):u.innerHTML=d,typeof p=="function"&&(p=p.call(this.table,i.getComponent())),p?(u.classList.add("tabulator-menu-item-disabled"),u.addEventListener("click",f=>{f.stopPropagation()})):c.menu&&c.menu.length?u.addEventListener("click",f=>{f.stopPropagation(),this.loadMenu(f,i,c.menu,u,l)}):c.action&&u.addEventListener("click",f=>{c.action(f,i.getComponent())}),c.menu&&c.menu.length&&u.classList.add("tabulator-menu-item-submenu")),o.appendChild(u)}),o.addEventListener("click",c=>{this.rootPopup&&this.rootPopup.hide()}),l.show(n||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",r,l),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=i,this.dispatch("menu-opened",r,l),this.dispatchExternal("menuOpened",i.getComponent()))}}}class Fpt extends Or{static moduleName="moveColumn";constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var i=this,r={},n;!e.modules.frozen&&!e.isGroup&&!e.isRowHeader&&(n=e.getElement(),r.mousemove=(function(a){e.parent===i.moving.parent&&((i.touchMove?a.touches[0].pageX:a.pageX)-Ma.elOffset(n).left+i.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(i.toCol!==e||!i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n.nextSibling),i.moveColumn(e,!0)):(i.toCol!==e||i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n),i.moveColumn(e,!1)))}).bind(i),n.addEventListener("mousedown",function(a){i.touchMove=!1,a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),i.bindTouchEvents(e)),e.modules.moveColumn=r}bindTouchEvents(e){var i=e.getElement(),r=!1,n,a,s,o,l,c;i.addEventListener("touchstart",u=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextColumn(),s=n?n.getWidth()/2:0,a=e.prevColumn(),o=a?a.getWidth()/2:0,l=0,c=0,r=!1,this.startMove(u,e)},this.checkPeriod)},{passive:!0}),i.addEventListener("touchmove",u=>{var d,p;this.moving&&(this.moveHover(u),r||(r=u.touches[0].pageX),d=u.touches[0].pageX-r,d>0?n&&d-l>s&&(p=n,p!==e&&(r=u.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveColumn(p,!0))):a&&-d-c>o&&(p=a,p!==e&&(r=u.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveColumn(p,!1))),p&&(n=p.nextColumn(),l=s,s=n?n.getWidth()/2:0,a=p.prevColumn(),c=o,o=a?a.getWidth()/2:0))},{passive:!0}),i.addEventListener("touchend",u=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(u)})}startMove(e,i){var r=i.getElement(),n=this.table.columnManager.getContentsElement(),a=this.table.columnManager.getHeadersElement();this.table.modules.selectRange&&this.table.modules.selectRange.columnSelection&&this.table.modules.selectRange.mousedown&&this.table.modules.selectRange.selecting==="column"||(this.moving=i,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-Ma.elOffset(r).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),n.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=n.clientHeight-a.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e),this.dispatch("column-moving",e,this.moving))}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,i){var r=this.moving.getCells();this.toCol=e,this.toColAfter=i,i?e.getCells().forEach(function(n,a){var s=n.getElement(!0);s.parentNode&&r[a]&&s.parentNode.insertBefore(r[a].getElement(),s.nextSibling)}):e.getCells().forEach(function(n,a){var s=n.getElement(!0);s.parentNode&&r[a]&&s.parentNode.insertBefore(r[a].getElement(),s)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var i=this.table.columnManager.getContentsElement(),r=i.scrollLeft,n=(this.touchMove?e.touches[0].pageX:e.pageX)-Ma.elOffset(i).left+r,a;this.hoverElement.style.left=n-this.startX+"px",n-r<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.max(0,r-5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1))),r+i.clientWidth-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.min(i.clientWidth,r+5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1)))}}var Lpt={delete:function(t,e,i){t.delete()}},$pt={insert:function(t,e,i){return this.table.addRow(t.getData(),void 0,e),!0},add:function(t,e,i){return this.table.addRow(t.getData()),!0},update:function(t,e,i){return e?(e.update(t.getData()),!0):!1},replace:function(t,e,i){return e?(this.table.addRow(t.getData(),void 0,e),e.delete(),!0):!1}};class oO extends Or{static moduleName="moveRow";static senders=Lpt;static receivers=$pt;constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var i=this,r={};r.mouseup=(function(n){i.tableRowDrop(n,e)}).bind(i),r.mousemove=(function(n){var a;n.pageY-Ma.elOffset(e.element).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(a=e.getElement(),a.parentNode.insertBefore(i.placeholderElement,a.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(a=e.getElement(),a.previousSibling&&(a.parentNode.insertBefore(i.placeholderElement,a),i.moveRow(e,!1)))}).bind(i),e.modules.moveRow=r}initializeRow(e){var i=this,r={},n;r.mouseup=(function(a){i.tableRowDrop(a,e)}).bind(i),r.mousemove=(function(a){var s=e.getElement();a.pageY-Ma.elOffset(s).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(s.parentNode.insertBefore(i.placeholderElement,s.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(s.parentNode.insertBefore(i.placeholderElement,s),i.moveRow(e,!1))}).bind(i),this.hasHandle||(n=e.getElement(),n.addEventListener("mousedown",function(a){a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=r}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var i=this,r=e.getElement(!0);r.addEventListener("mousedown",function(n){n.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(n,e.row)},i.checkPeriod))}),r.addEventListener("mouseup",function(n){n.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e.row,r)}}bindTouchEvents(e,i){var r=!1,n,a,s,o,l,c;i.addEventListener("touchstart",u=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextRow(),s=n?n.getHeight()/2:0,a=e.prevRow(),o=a?a.getHeight()/2:0,l=0,c=0,r=!1,this.startMove(u,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,i.addEventListener("touchmove",u=>{var d,p;this.moving&&(u.preventDefault(),this.moveHover(u),r||(r=u.touches[0].pageY),d=u.touches[0].pageY-r,d>0?n&&d-l>s&&(p=n,p!==e&&(r=u.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveRow(p,!0))):a&&-d-c>o&&(p=a,p!==e&&(r=u.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveRow(p,!1))),p&&(n=p.nextRow(),l=s,s=n?n.getHeight()/2:0,a=p.prevRow(),c=o,o=a?a.getHeight()/2:0))}),i.addEventListener("touchend",u=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(u),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,i){var r=i.getElement();this.setStartPosition(e,i),this.moving=i,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(i)):(r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r)),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",i.getComponent()),this.moveHover(e)}setStartPosition(e,i){var r=this.touchMove?e.touches[0].pageX:e.pageX,n=this.touchMove?e.touches[0].pageY:e.pageY,a,s;a=i.getElement(),this.connection?(s=a.getBoundingClientRect(),this.startX=s.left-r+window.pageXOffset,this.startY=s.top-n+window.pageYOffset):this.startY=n-a.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,i){this.toRow=e,this.toRowAfter=i}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var i=this.table.rowManager.getElement(),r=i.scrollTop,n=(this.touchMove?e.touches[0].pageY:e.pageY)-i.getBoundingClientRect().top+r;this.hoverElement.style.top=Math.min(n-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,i,r){this.dispatchExternal("movableRowsElementDrop",e,i,r?r.getComponent():!1)}connectToTables(e){var i;this.connectionSelectorsTables&&(i=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",i),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(r=>{typeof r=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(r))):this.connectionElements.push(r)}),this.connectionElements.forEach(r=>{var n=a=>{this.elementRowDrop(a,r,this.moving)};r.addEventListener("mouseup",n),r.tabulatorElementDropEvent=n,r.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(i=>{i.classList.remove("tabulator-movingrow-receiving"),i.removeEventListener("mouseup",i.tabulatorElementDropEvent),delete i.tabulatorElementDropEvent})}connect(e,i){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=i,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(r=>{r.type==="row"&&r.modules.moveRow&&r.modules.moveRow.mouseup&&r.getElement().addEventListener("mouseup",r.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",i,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().removeEventListener("mouseup",i.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,i,r){var n=!1;if(r){switch(typeof this.table.options.movableRowsSender){case"string":n=oO.senders[this.table.options.movableRowsSender];break;case"function":n=this.table.options.movableRowsSender;break}n?n.call(this,this.moving?this.moving.getComponent():void 0,i?i.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),i?i.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),i?i.getComponent():void 0,e);this.endMove()}tableRowDrop(e,i){var r=!1,n=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":r=oO.receivers[this.table.options.movableRowsReceiver];break;case"function":r=this.table.options.movableRowsReceiver;break}r?n=r.call(this,this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),n?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:i,success:n})}commsReceived(e,i,r){switch(i){case"connect":return this.connect(e,r.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,r.row,r.success)}}}var Hpt={};class lO extends Or{static moduleName="mutator";static mutators=Hpt;constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard","import"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutatorImport"),this.registerColumnOption("mutatorImportParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,i,r){return this.transformRow(i,"data",r)}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="mutator"+(n.charAt(0).toUpperCase()+n.slice(1)),s;e.definition[a]&&(s=this.lookupMutator(e.definition[a]),s&&(i=!0,r[a]={mutator:s,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.mutate=r)}lookupMutator(e){var i=!1;switch(typeof e){case"string":lO.mutators[e]?i=lO.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i,r){var n="mutator"+(i.charAt(0).toUpperCase()+i.slice(1)),a;return this.enabled&&this.table.columnManager.traverse(s=>{var o,l,c;s.modules.mutate&&(o=s.modules.mutate[n]||s.modules.mutate.mutator||!1,o&&(a=s.getFieldValue(typeof r<"u"?r:e),(i=="data"&&!r||typeof a<"u")&&(c=s.getComponent(),l=typeof o.params=="function"?o.params(a,e,i,c):o.params,s.setFieldValue(e,o.mutator(a,e,i,l,c)))))}),e}transformCell(e,i){if(e.column.modules.mutate){var r=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,n={};if(r)return n=Object.assign(n,e.row.getData()),e.column.setFieldValue(n,i),r.mutator(i,n,"edit",r.params,e.getComponent())}return i}mutateLink(e){var i=e.column.definition.mutateLink;i&&(Array.isArray(i)||(i=[i]),i.forEach(r=>{var n=e.row.getCell(r);n&&n.setValue(n.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}}function Vpt(t,e,i,r,n){var a=document.createElement("span"),s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span"),u=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{s.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|rows",d=>{u.innerHTML=d}),r?(o.innerHTML=" "+e+"-"+Math.min(e+t-1,r)+" ",c.innerHTML=" "+r+" ",a.appendChild(s),a.appendChild(o),a.appendChild(l),a.appendChild(c),a.appendChild(u)):(o.innerHTML=" 0 ",a.appendChild(s),a.appendChild(o),a.appendChild(u)),a}function Gpt(t,e,i,r,n){var a=document.createElement("span"),s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span"),u=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{s.innerHTML=d}),o.innerHTML=" "+i+" ",this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),c.innerHTML=" "+n+" ",this.table.modules.localize.langBind("pagination|counter|pages",d=>{u.innerHTML=d}),a.appendChild(s),a.appendChild(o),a.appendChild(l),a.appendChild(c),a.appendChild(u),a}var Qpt={rows:Vpt,pages:Gpt};class hZ extends Or{static moduleName="page";static pageCounters=Qpt;constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("paginationOutOfRange",!1),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,i){var r=this.table.rowManager,n=r.getDisplayRows(),a;return i?n.length?a=n[0]:r.activeRows.length&&(a=r.activeRows[r.activeRows.length-1],i=!1):n.length&&(a=n[n.length-1],i=!(n.length<this.size)),{index:a,top:i}}calculatePageSizes(){var e,i;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",i=document.createElement("div"),i.classList.add("tabulator-cell"),i.innerHTML="Page Row Test",e.appendChild(i),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,i,r,n){return this.initialLoad||(this.progressiveLoad&&!r||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),n.page=this.page,this.size&&(n.size=this.size),n}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,i){var r,n,a;!i&&!this.table.dataLoader.loading&&(r=this.table.rowManager.getElement(),n=r.scrollHeight-r.clientHeight-e,a=this.table.options.progressiveLoadScrollMargin||r.clientHeight*2,n<a&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,i){return i||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let i=1;i<5;i++)e.push(this.size*i);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(i=>{var r=document.createElement("option");r.value=i,i===!0?this.langBind("pagination|all",function(n){r.innerHTML=n}):r.innerHTML=i,this.pageSizeSelect.appendChild(r)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,i=null;e&&(typeof e=="function"?i=e:i=hZ.pageCounters[e],i?(this.pageCounter=i,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var i,r;e||(this.langBind("pagination|first",n=>{this.firstBut.innerHTML=n}),this.langBind("pagination|first_title",n=>{this.firstBut.setAttribute("aria-label",n),this.firstBut.setAttribute("title",n)}),this.langBind("pagination|prev",n=>{this.prevBut.innerHTML=n}),this.langBind("pagination|prev_title",n=>{this.prevBut.setAttribute("aria-label",n),this.prevBut.setAttribute("title",n)}),this.langBind("pagination|next",n=>{this.nextBut.innerHTML=n}),this.langBind("pagination|next_title",n=>{this.nextBut.setAttribute("aria-label",n),this.nextBut.setAttribute("title",n)}),this.langBind("pagination|last",n=>{this.lastBut.innerHTML=n}),this.langBind("pagination|last_title",n=>{this.lastBut.setAttribute("aria-label",n),this.lastBut.setAttribute("title",n)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(i=document.createElement("label"),this.langBind("pagination|page_size",n=>{this.pageSizeSelect.setAttribute("aria-label",n),this.pageSizeSelect.setAttribute("title",n),i.innerHTML=n}),this.element.appendChild(i),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",n=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(r=document.querySelector(this.table.options.paginationCounterElement),r?r.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var i=this.displayRows(-1),r=i.indexOf(e);if(r>-1){var n=this.size===!0?1:Math.ceil((r+1)/this.size);return this.setPage(n)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,i,r){var n;if(this.pageCounter)switch(this.mode==="remote"&&(i=this.size,r=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),n=this.pageCounter.call(this,i,r,this.page,e,this.max),typeof n){case"object":if(n instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(n)}else this.pageCounterElement.innerHTML="",n!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",n);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=n}}_setPageButtons(){let e=Math.floor((this.count-1)/2),i=Math.ceil((this.count-1)/2),r=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),n=this.page<=i?Math.min(this.count,this.max):Math.min(this.page+i,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let a=r;a<=n;a++)a>0&&a<=this.max&&this.pagesElement.appendChild(this._generatePageButton(a));this.footerRedraw()}_generatePageButton(e){var i=document.createElement("button");return i.classList.add("tabulator-page"),e==this.page&&i.classList.add("active"),i.setAttribute("type","button"),i.setAttribute("role","button"),this.langBind("pagination|page_title",r=>{i.setAttribute("aria-label",r+" "+e),i.setAttribute("title",r+" "+e)}),i.setAttribute("data-page",e),i.textContent=e,i.addEventListener("click",r=>{this.setPage(e)}),i}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var i=0,r,n,a,s,o=e.filter(l=>l.type==="row");if(this.mode=="local"){r=[],this.setMaxRows(e.length),this.size===!0?(n=0,a=e.length):(n=this.size*(this.page-1),a=n+parseInt(this.size)),this._setPageButtons();for(let l=n;l<a;l++){let c=e[l];c&&(r.push(c),c.type==="row"&&(s||(s=c),i++))}return this._setPageCounter(o.length,i,s?o.indexOf(s)+1:0),r}else return this._setPageButtons(),this._setPageCounter(o.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var i,r;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),i=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+i&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else{if(this.page>this.max&&(console.warn("Remote Pagination Error - Server returned last page value lower than the current page"),r=this.options("paginationOutOfRange"),r))return this.setPage(typeof r=="function"?r.call(this,this.page,this.max):r);this.dispatchExternal("pageLoaded",this.getPage())}else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}}var jpt={local:function(t,e){var i=localStorage.getItem(t+"-"+e);return i?JSON.parse(i):!1},cookie:function(t,e){var i=document.cookie,r=t+"-"+e,n=i.indexOf(r+"="),a,s;return n>-1&&(i=i.slice(n),a=i.indexOf(";"),a>-1&&(i=i.slice(0,a)),s=i.replace(r+"=","")),s?JSON.parse(s):!1}},zpt={local:function(t,e,i){localStorage.setItem(t+"-"+e,JSON.stringify(i))},cookie:function(t,e,i){var r=new Date;r.setDate(r.getDate()+1e4),document.cookie=t+"-"+e+"="+JSON.stringify(i)+"; expires="+r.toUTCString()}};class sm extends Or{static moduleName="persistence";static moduleInitOrder=-10;static readers=jpt;static writers=zpt;constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,i=this.table.options.persistenceID,r;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:sm.readers[this.table.options.persistenceReaderFunc]?this.readFunc=sm.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):sm.readers[this.mode]?this.readFunc=sm.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:sm.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=sm.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):sm.writers[this.mode]?this.writeFunc=sm.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(i||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(r=this.retrieveData("page"),r&&(typeof r.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=r.paginationSize),typeof r.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=r.paginationInitialPage))),this.config.group&&(r=this.retrieveData("group"),r&&(typeof r.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=r.groupBy),typeof r.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=r.groupStartOpen),typeof r.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=r.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,i,r;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(i=this.load("filter"),i&&(this.table.options.initialFilter=i)),this.config.headerFilter&&(r=this.load("headerFilter"),r&&(this.table.options.initialHeaderFilter=r))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var i,r;this.config.columns&&(this.defWatcherBlock=!0,i=e.getDefinition(),r=this.config.columns===!0?Object.keys(i):this.config.columns,r.forEach(n=>{var a=Object.getOwnPropertyDescriptor(i,n),s=i[n];a&&Object.defineProperty(i,n,{set:o=>{s=o,this.defWatcherBlock||this.save("columns"),a.set&&a.set(o)},get:()=>(a.get&&a.get(),s)})}),this.defWatcherBlock=!1)}load(e,i){var r=this.retrieveData(e);return i&&(r=r?this.mergeDefinition(i,r):i),r}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,i,r){var n=[];return i=i||[],i.forEach((a,s)=>{var o=this._findColumn(e,a),l;o&&(r?l=Object.keys(a):this.config.columns===!0||this.config.columns==null?(l=Object.keys(o),l.push("width")):l=this.config.columns,l.forEach(c=>{c!=="columns"&&typeof a[c]<"u"&&(o[c]=a[c])}),o.columns&&(o.columns=this.mergeDefinition(o.columns,a.columns)),n.push(o))}),e.forEach((a,s)=>{var o=this._findColumn(i,a);o||(n.length>s?n.splice(s,0,a):n.push(a))}),n}_findColumn(e,i){var r=i.columns?"group":i.field?"field":"object";return e.find(function(n){switch(r){case"group":return n.title===i.title&&n.columns.length===i.columns.length;case"field":return n.field===i.field;case"object":return n===i}})}save(e){var i={};switch(e){case"columns":i=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":i=this.table.modules.filter.getFilters();break;case"headerFilter":i=this.table.modules.filter.getHeaderFilters();break;case"sort":i=this.validateSorters(this.table.modules.sort.getSort());break;case"group":i=this.getGroupConfig();break;case"page":i=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,i)}validateSorters(e){return e.forEach(function(i){i.column=i.field,delete i.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var i=[],r=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(n=>{var a={},s=n.getDefinition(),o;n.isGroup?(a.title=s.title,a.columns=this.parseColumns(n.getColumns())):(a.field=n.getField(),this.config.columns===!0||this.config.columns==null?(o=Object.keys(s),o.push("width"),o.push("visible")):o=this.config.columns,o.forEach(l=>{switch(l){case"width":a.width=n.getWidth();break;case"visible":a.visible=n.visible;break;default:typeof s[l]!="function"&&r.indexOf(l)===-1&&(a[l]=s[l])}})),i.push(a)}),i}}let qpt=class extends Or{static moduleName="popup";constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,i,r){this.loadPopupEvent(i,null,e,r)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var i=e.definition;i.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),i.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),i.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),i.headerPopup&&this.initializeColumnHeaderPopup(e),i.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),i.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),i.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var i=e.definition.headerPopupIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadPopupTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadPopupEvent(r.column.definition[e],i,r)}loadPopupTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadPopupEvent(r.definition[e],i,r)}loadPopupEvent(e,i,r,n){var a;function s(o){a=o}r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent(),s):e,this.loadPopup(i,r,e,a,n)}loadPopup(e,i,r,n,a){var s=!(e instanceof MouseEvent),o,l;r instanceof HTMLElement?o=r:(o=document.createElement("div"),o.innerHTML=r),o.classList.add("tabulator-popup"),o.addEventListener("click",c=>{c.stopPropagation()}),s||e.preventDefault(),l=this.popup(o),typeof n=="function"&&l.renderCallback(n),e?l.show(e):l.show(i.getElement(),a||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",i.getComponent())}),this.dispatchExternal("popupOpened",i.getComponent())}};class Wpt extends Or{static moduleName="print";constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,i,r){var n=window.scrollX,a=window.scrollY,s=document.createElement("div"),o=document.createElement("div"),l=this.table.modules.export.generateTable(typeof r<"u"?r:this.table.options.printConfig,typeof i<"u"?i:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),c,u;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(s.classList.add("tabulator-print-header"),c=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof c=="string"?s.innerHTML=c:s.appendChild(c),this.element.appendChild(s)),this.element.appendChild(l),this.table.options.printFooter&&(o.classList.add("tabulator-print-footer"),u=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof u=="string"?o.innerHTML=u:o.appendChild(u),this.element.appendChild(o)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(n,a),this.manualBlock=!1}}class Kpt extends Or{static moduleName="reactiveData";constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var i=this,r;this.currentVersion++,r=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-push"),n.forEach(s=>{i.table.rowManager.addRowActual(s,!1)}),a=i.origFuncs.push.apply(e,arguments),i.unblock("data-push")),a}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-unshift"),n.forEach(s=>{i.table.rowManager.addRowActual(s,!0)}),a=i.origFuncs.unshift.apply(e,arguments),i.unblock("data-unshift")),a}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-shift"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[0]),n&&n.deleteActual()),a=i.origFuncs.shift.call(e),i.unblock("data-shift")),a}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-pop"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[i.data.length-1]),n&&n.deleteActual()),a=i.origFuncs.pop.call(e),i.unblock("data-pop")),a}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a=n[0]<0?e.length+n[0]:n[0],s=n[1],o=n[2]?n.slice(2):!1,l,c;if(!i.blocked&&r===i.currentVersion){if(i.block("data-splice"),o&&(l=e[a]?i.table.rowManager.getRowFromDataObject(e[a]):!1,l?o.forEach(d=>{i.table.rowManager.addRowActual(d,!0,l,!0)}):(o=o.slice().reverse(),o.forEach(d=>{i.table.rowManager.addRowActual(d,!0,!1,!0)}))),s!==0){var u=e.slice(a,typeof n[1]>"u"?n[1]:a+s);u.forEach((d,p)=>{var f=i.table.rowManager.getRowFromDataObject(d);f&&f.deleteActual(p!==u.length-1)})}(o||s!==0)&&i.table.rowManager.reRenderInPosition(),c=i.origFuncs.splice.apply(e,arguments),i.unblock("data-splice")}return c}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var i=e.getData();for(var r in i)this.watchKey(e,i,r);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var i=this,r=e.getData()[this.table.options.dataTreeChildField],n={};r&&(n.push=r.push,Object.defineProperty(r,"push",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-push");var a=n.push.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-push")}return a}}),n.unshift=r.unshift,Object.defineProperty(r,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-unshift");var a=n.unshift.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-unshift")}return a}}),n.shift=r.shift,Object.defineProperty(r,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-shift");var a=n.shift.call(r);this.rebuildTree(e),i.unblock("tree-shift")}return a}}),n.pop=r.pop,Object.defineProperty(r,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-pop");var a=n.pop.call(r);this.rebuildTree(e),i.unblock("tree-pop")}return a}}),n.splice=r.splice,Object.defineProperty(r,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-splice");var a=n.splice.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-splice")}return a}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,i,r){var n=this,a=Object.getOwnPropertyDescriptor(i,r),s=i[r],o=this.currentVersion;Object.defineProperty(i,r,{set:l=>{if(s=l,!n.blocked&&o===n.currentVersion){n.block("key");var c={};c[r]=l,e.updateData(c),n.unblock("key")}a.set&&a.set(l)},get:()=>(a.get&&a.get(),s)})}unwatchRow(e){var i=e.getData();for(var r in i)Object.defineProperty(i,r,{value:i[r]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}class Ypt extends Or{static moduleName="resizeColumns";constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1),this.registerTableOption("resizableColumnGuide",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var i=e.prevColumn();this.reinitializeColumn(e),i&&this.reinitializeColumn(i)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.reinitializeColumn(i)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.reinitializeColumn(i)}))}frozenColumnOffset(e){var i=!1;return e.modules.frozen&&(i=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?i+=e.getWidth()-3:i&&(i-=3)),i!==!1?i+"px":!1}reinitializeColumn(e){var i=this.frozenColumnOffset(e);e.cells.forEach(r=>{r.modules.resize&&r.modules.resize.handleEl&&(i&&(r.modules.resize.handleEl.style[e.modules.frozen.position]=i,r.modules.resize.handleEl.style["z-index"]=11),r.element.after(r.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(i&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=i),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,i,r,n){var a=this,s=!1,o=r.definition.resizable,l={},c=r.getLastColumn();if(e==="header"&&(s=r.definition.formatter=="textarea"||r.definition.variableHeight,l={variableHeight:s}),(o===!0||o==e)&&this._checkResizability(c)){var u=document.createElement("span");u.className="tabulator-col-resize-handle",u.addEventListener("click",function(p){p.stopPropagation()});var d=function(p){a.startColumn=r,a.initialNextColumn=a.nextColumn=c.nextColumn(),a._mouseDown(p,c,u)};u.addEventListener("mousedown",d),u.addEventListener("touchstart",d,{passive:!0}),u.addEventListener("dblclick",p=>{var f=c.getWidth();p.stopPropagation(),c.reinitializeWidth(!0),f!==c.getWidth()&&(a.dispatch("column-resized",c),a.dispatchExternal("columnResized",c.getComponent()))}),r.modules.frozen&&(u.style.position="sticky",u.style[r.modules.frozen.position]=this.frozenColumnOffset(r)),l.handleEl=u,n.parentNode&&r.visible&&n.after(u)}i.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(i=>{this.deInitializeComponent(i)})}deInitializeComponent(e){var i;e.modules.resize&&(i=e.modules.resize.handleEl,i&&i.parentElement&&i.parentElement.removeChild(i))}resizeHandle(e,i){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=i)}resize(e,i){var r=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n=r-this.startX,a=r-this.latestX,s,o;if(this.latestX=r,this.table.rtl&&(n=-n,a=-a),s=i.width==i.minWidth||i.width==i.maxWidth,i.setWidth(this.startWidth+n),o=i.width==i.minWidth||i.width==i.maxWidth,a<0&&(this.nextColumn=this.initialNextColumn),this.table.options.resizableColumnFit&&this.nextColumn&&!(s&&o)){let l=this.nextColumn.getWidth();a>0&&l<=this.nextColumn.minWidth&&(this.nextColumn=this.nextColumn.nextColumn()),this.nextColumn&&this.nextColumn.setWidth(this.nextColumn.getWidth()-a)}this.table.columnManager.rerenderColumns(!0),!this.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights()}calcGuidePosition(e,i,r){var n=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,a=r.getBoundingClientRect().x-this.table.element.getBoundingClientRect().x,s=this.table.element.getBoundingClientRect().x,o=i.element.getBoundingClientRect().left-s,l=n-this.startX,c=Math.max(a+l,o+i.minWidth);return i.maxWidth&&(c=Math.min(c,o+i.maxWidth)),c}_checkResizability(e){return e.definition.resizable}_mouseDown(e,i,r){var n=this,a;this.dispatchExternal("columnResizing",i.getComponent()),n.table.options.resizableColumnGuide&&(a=document.createElement("span"),a.classList.add("tabulator-col-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.left=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function s(l){n.table.options.resizableColumnGuide?a.style.left=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function o(l){n.table.options.resizableColumnGuide&&(n.resize(l,i),a.remove()),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!1),n.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights(),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",s),r.removeEventListener("touchmove",s),r.removeEventListener("touchend",o),n.table.element.classList.remove("tabulator-block-select"),n.startWidth!==i.getWidth()&&(n.table.columnManager.verticalAlignHeaders(),n.dispatch("column-resized",i),n.dispatchExternal("columnResized",i.getComponent()))}e.stopPropagation(),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!0),n.startX=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n.latestX=n.startX,n.startWidth=i.getWidth(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",o),r.addEventListener("touchmove",s,{passive:!0}),r.addEventListener("touchend",o)}}class Xpt extends Or{static moduleName="resizeRows";constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1),this.registerTableOption("resizableRowGuide",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var i=this,r=e.getElement(),n=document.createElement("div");n.className="tabulator-row-resize-handle";var a=document.createElement("div");a.className="tabulator-row-resize-handle prev",n.addEventListener("click",function(l){l.stopPropagation()});var s=function(l){i.startRow=e,i._mouseDown(l,e,n)};n.addEventListener("mousedown",s),n.addEventListener("touchstart",s,{passive:!0}),a.addEventListener("click",function(l){l.stopPropagation()});var o=function(l){var c=i.table.rowManager.prevDisplayRow(e);c&&(i.startRow=c,i._mouseDown(l,c,a))};a.addEventListener("mousedown",o),a.addEventListener("touchstart",o,{passive:!0}),r.appendChild(n),r.appendChild(a)}resize(e,i){i.setHeight(this.startHeight+((typeof e.screenY>"u"?e.touches[0].screenY:e.screenY)-this.startY))}calcGuidePosition(e,i,r){var n=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,a=r.getBoundingClientRect().y-this.table.element.getBoundingClientRect().y,s=this.table.element.getBoundingClientRect().y,o=i.element.getBoundingClientRect().top-s,l=n-this.startY;return Math.max(a+l,o)}_mouseDown(e,i,r){var n=this,a;n.dispatchExternal("rowResizing",i.getComponent()),n.table.options.resizableRowGuide&&(a=document.createElement("span"),a.classList.add("tabulator-row-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.top=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function s(l){n.table.options.resizableRowGuide?a.style.top=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function o(l){n.table.options.resizableRowGuide&&(n.resize(l,i),a.remove()),document.body.removeEventListener("mouseup",s),document.body.removeEventListener("mousemove",s),r.removeEventListener("touchmove",s),r.removeEventListener("touchend",o),n.table.element.classList.remove("tabulator-block-select"),n.dispatchExternal("rowResized",i.getComponent())}e.stopPropagation(),n.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,n.startHeight=i.getHeight(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",o),r.addEventListener("touchmove",s,{passive:!0}),r.addEventListener("touchend",o)}}class Zpt extends Or{static moduleName="resizeTable";constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,i;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.tableHeight!=n||this.tableWidth!=a)&&(this.tableHeight=n,this.tableWidth=a,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),i=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(i.getPropertyValue("max-height")||i.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.containerHeight!=n||this.containerWidth!=a)&&(this.containerHeight=n,this.containerWidth=a,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}function Jpt(t,e,i){var r=document.createElement("div"),n=t.getRow()._row.modules.responsiveLayout;r.classList.add("tabulator-responsive-collapse-toggle"),r.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,t.getElement().classList.add("tabulator-row-handle");function a(s){var o=n.element;n.open=s,o&&(n.open?(r.classList.add("open"),o.style.display=""):(r.classList.remove("open"),o.style.display="none"))}return r.addEventListener("click",function(s){s.stopImmediatePropagation(),a(!n.open),t.getTable().rowManager.adjustTableSize()}),a(n.open),r}var eft={format:{formatters:{responsiveCollapse:Jpt}}};class tft extends Or{static moduleName="responsiveLayout";static moduleExtensions=eft;constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.collapseFormatter&&(this.collapseFormatter=this.collapseFormatter.bind(this.table)),this.table.columnManager.columnsByIndex.forEach((i,r)=>{i.modules.responsive&&i.modules.responsive.order&&i.modules.responsive.visible&&(i.modules.responsive.index=r,e.push(i),!i.visible&&this.mode==="collapse"&&this.hiddenColumns.push(i))}),e=e.reverse(),e=e.sort((i,r)=>{var n=r.modules.responsive.order-i.modules.responsive.order;return n||r.modules.responsive.index-i.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let i of this.table.columnManager.columnsByIndex)if(i.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=i;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var i=e.getDefinition();e.modules.responsive={order:typeof i.responsive>"u"?1:i.responsive,visible:i.visible!==!1}}initializeRow(e){var i;e.type!=="calc"&&(i=document.createElement("div"),i.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:i,open:this.collapseStartOpen},this.collapseStartOpen||(i.style.display="none"))}layoutRow(e){var i=e.getElement();e.modules.responsiveLayout&&(i.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,i){!i&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var i=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!i&&this.collapseHandleColumn.show())}showColumn(e){var i;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(i=this.hiddenColumns.indexOf(e),i>-1&&this.hiddenColumns.splice(i,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let i=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),r=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-i;if(r<0){let n=this.columns[this.index];n?(this.hideColumn(n),this.index++):e=!1}else{let n=this.columns[this.index-1];n&&r>0&&r>=n.getWidth()?(this.showColumn(n),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(i=>{this.generateCollapsedRowContent(i)})}generateCollapsedRowContent(e){var i,r;if(e.modules.responsiveLayout){for(i=e.modules.responsiveLayout.element;i.firstChild;)i.removeChild(i.firstChild);r=this.collapseFormatter(this.generateCollapsedRowData(e)),r&&i.appendChild(r),e.calcHeight(!0)}}generateCollapsedRowData(e){var i=e.getData(),r=[],n;return this.hiddenColumns.forEach(a=>{var s=a.getFieldValue(i);if(a.definition.title&&a.field)if(a.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let o=function(l){l()};n={value:!1,data:{},getValue:function(){return s},getData:function(){return i},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return a.getComponent()},getTable:()=>this.table},r.push({field:a.field,title:a.definition.title,value:a.modules.format.formatter.call(this.table.modules.format,n,a.modules.format.params,o)})}else r.push({field:a.field,title:a.definition.title,value:s})}),r}formatCollapsedData(e){var i=document.createElement("table");return e.forEach(r=>{var n=document.createElement("tr"),a=document.createElement("td"),s=document.createElement("td"),o,l=document.createElement("strong");a.appendChild(l),this.modules.localize.bind("columns|"+r.field,function(c){l.innerHTML=c||r.title}),r.value instanceof Node?(o=document.createElement("div"),o.appendChild(r.value),s.appendChild(o)):s.innerHTML=r.value,n.appendChild(a),n.appendChild(s),i.appendChild(n)}),Object.keys(e).length?i:""}}function ift(t,e,i){var r=document.createElement("input"),n=!1;if(r.type="checkbox",r.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(r.addEventListener("click",s=>{s.stopPropagation()}),typeof t.getRow=="function"){var a=t.getRow();a instanceof PH?(r.addEventListener("change",s=>{this.table.options.selectableRowsRangeMode==="click"&&n?n=!1:a.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&r.addEventListener("click",s=>{n=!0,this.table.modules.selectRow.handleComplexRowClick(a._row,s)}),r.checked=a.isSelected&&a.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(a,r)):r=""}else r.addEventListener("change",s=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(r);return r}var rft={format:{formatters:{rowSelection:ift}}};class nft extends Or{static moduleName="selectRow";static moduleExtensions=rft;constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(i,r){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){}rowRetrieve(e,i){return e==="selected"?this.selectedRows:i}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var i=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],i&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var i=this,r=i.checkRowSelectability(e),n=e.getElement(),a=function(){setTimeout(function(){i.selecting=!1},50),document.body.removeEventListener("mouseup",a)};e.modules.select={selected:!1},n.classList.toggle("tabulator-selectable",r),n.classList.toggle("tabulator-unselectable",!r),i.checkRowSelectability(e)&&i.table.options.selectableRows&&i.table.options.selectableRows!="highlight"&&(i.table.options.selectableRowsRangeMode==="click"?n.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(n.addEventListener("click",function(s){(!i.table.modExists("edit")||!i.table.modules.edit.getCurrentCell())&&i.table._clearSelection(),i.selecting||i.toggleRow(e)}),n.addEventListener("mousedown",function(s){if(s.shiftKey)return i.table._clearSelection(),i.selecting=!0,i.selectPrev=[],document.body.addEventListener("mouseup",a),document.body.addEventListener("keyup",a),i.toggleRow(e),!1}),n.addEventListener("mouseenter",function(s){i.selecting&&(i.table._clearSelection(),i.toggleRow(e),i.selectPrev[1]==e&&i.toggleRow(i.selectPrev[0]))}),n.addEventListener("mouseout",function(s){i.selecting&&(i.table._clearSelection(),i.selectPrev.unshift(e))})))}handleComplexRowClick(e,i){if(i.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var r=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),n=this.table.rowManager.getDisplayRowIndex(e),a=r<=n?r:n,s=r>=n?r:n,o=this.table.rowManager.getDisplayRows().slice(0),l=o.splice(a,s-a+1);i.ctrlKey||i.metaKey?(l.forEach(c=>{c!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(c):this.toggleRow(c))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&l.length>this.table.options.selectableRows&&(l=l.slice(0,this.table.options.selectableRows)),this.selectRows(l)),this.table._clearSelection()}else i.ctrlKey||i.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var i=[],r,n;switch(typeof e){case"undefined":r=this.table.rowManager.rows;break;case"number":r=this.table.rowManager.findRow(e);break;case"string":r=this.table.rowManager.findRow(e),r||(r=this.table.rowManager.getRows(e));break;default:r=e;break}Array.isArray(r)?r.length&&(r.forEach(a=>{n=this._selectRow(a,!0,!0),n&&i.push(n)}),this._rowSelectionChanged(!1,i)):r&&this._selectRow(r,!1,!0)}_selectRow(e,i,r){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!r&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var n=this.table.rowManager.findRow(e);if(n){if(this.selectedRows.indexOf(n)==-1)return n.getElement().classList.add("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!0,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!0),this.selectedRows.push(n),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!0),this.dispatchExternal("rowSelected",n.getComponent()),this._rowSelectionChanged(i,n),n}else i||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,i){var r=[],n,a;switch(typeof e){case"undefined":n=Object.assign([],this.selectedRows);break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(s=>{a=this._deselectRow(s,!0,!0),a&&r.push(a)}),this._rowSelectionChanged(i,[],r)):n&&this._deselectRow(n,i,!0)}_deselectRow(e,i){var r=this,n=r.table.rowManager.findRow(e),a,s;if(n){if(a=r.selectedRows.findIndex(function(o){return o==n}),a>-1)return s=n.getElement(),s&&s.classList.remove("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!1,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!1),r.selectedRows.splice(a,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!1),this.dispatchExternal("rowDeselected",n.getComponent()),r._rowSelectionChanged(i,void 0,n),n}else i||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getComponent())}),e}_rowSelectionChanged(e,i=[],r=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(i)||(i=[i]),i=i.map(n=>n.getComponent()),Array.isArray(r)||(r=[r]),r=r.map(n=>n.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),i,r))}registerRowSelectCheckbox(e,i){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=i}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,i){var r=this.table.modules.dataTree.getChildren(e,!0,!0);if(i)for(let n of r)this._selectRow(n,!0);else for(let n of r)this._deselectRow(n,!0)}}class aft{constructor(e){return this._range=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._range.table.componentFunctionBinder.handle("range",i._range,r)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0,!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,i){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,i&&i._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}let sft=class extends sc{constructor(e,i,r,n){super(e),this.rangeManager=i,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.rangeManager.rowHeader&&(this.left=1,this.right=1,this.start.col=1,this.end.col=1),this.initElement(),setTimeout(()=>{this.initBounds(r,n)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,i){this._updateMinMax(),e&&this.setBounds(e,i||e)}setStart(e,i){(this.start.row!==e||this.start.col!==i)&&(this.start.row=e,this.start.col=i,this.initializing.start=!0,this._updateMinMax())}setEnd(e,i){(this.end.row!==e||this.end.col!==i)&&(this.end.row=e,this.end.col=i,this.initializing.end=!0,this._updateMinMax())}setBounds(e,i,r){e&&this.setStartBound(e),this.setEndBound(i||e),this.rangeManager.layoutElement(r)}setStartBound(e){var i,r;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-1):(i=e.row.position-1,r=e.column.getPosition()-1,e.column===this.rangeManager.rowHeader?this.setStart(i,1):this.setStart(i,r))}setEndBound(e){var i=this._getTableRows().length,r,n,a;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(i-1,e.getPosition()-1):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-1)):(r=e.row.position-1,n=e.column.getPosition()-1,a=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(r,this._getTableColumns().length-1):this.rangeManager.selecting!=="row"&&a?this.setEnd(r,0):this.rangeManager.selecting==="column"?this.setEnd(i-1,n):this.setEnd(r,n))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}layout(){var e=this.table.rowManager.renderer.vDomTop,i=this.table.rowManager.renderer.vDomBottom,r=this.table.columnManager.renderer.leftCol,n=this.table.columnManager.renderer.rightCol,a,s,o,l,c,u,d,p,f,h;this.table.options.renderHorizontal==="virtual"&&this.rangeManager.rowHeader&&(n+=1),e==null&&(e=0),i==null&&(i=1/0),r==null&&(r=0),n==null&&(n=1/0),this.overlaps(r,e,n,i)&&(a=Math.max(this.top,e),s=Math.min(this.bottom,i),o=Math.max(this.left,r),l=Math.min(this.right,n),c=this.rangeManager.getCell(a,o),u=this.rangeManager.getCell(s,l),d=c.getElement(),p=u.getElement(),f=c.row.getElement(),h=u.row.getElement(),this.element.classList.add("tabulator-range-active"),this.table.rtl?(this.element.style.right=f.offsetWidth-d.offsetLeft-d.offsetWidth+"px",this.element.style.width=d.offsetLeft+d.offsetWidth-p.offsetLeft+"px"):(this.element.style.left=f.offsetLeft+d.offsetLeft+"px",this.element.style.width=p.offsetLeft+p.offsetWidth-d.offsetLeft+"px"),this.element.style.top=f.offsetTop+"px",this.element.style.height=h.offsetTop+h.offsetHeight-f.offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-1===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-1===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-1&&e.getPosition()-1<=this.right}overlaps(e,i,r,n){return!(this.left>r||e>this.right||this.top>n||i>this.bottom)}getData(){var e=[],i=this.getRows(),r=this.getColumns();return i.forEach(n=>{var a=n.getData(),s={};r.forEach(o=>{s[o.field]=a[o.field]}),e.push(s)}),e}getCells(e,i){var r=[],n=this.getRows(),a=this.getColumns();return e?r=n.map(s=>{var o=[];return s.getCells().forEach(l=>{a.includes(l.column)&&o.push(i?l.getComponent():l)}),o}):n.forEach(s=>{s.getCells().forEach(o=>{a.includes(o.column)&&r.push(i?o.getComponent():o)})}),r}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left,this.right+1)}clearValues(){var e=this.getCells(),i=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(r=>{r.setValue(i)}),this.table.restoreRedraw()}getBounds(e){var i=this.getCells(!1,e),r={start:null,end:null};return i.length?(r.start=i[0],r.end=i[i.length-1]):console.warn("No bounds defined on range"),r}getComponent(){return this.component||(this.component=new aft(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}};var oft={rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},lft={rangeJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!1)},rangeJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!1)},rangeJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!1)},rangeJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!1)},rangeExpandLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!1,!0)},rangeExpandRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!1,!0)},rangeExpandUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!1,!0)},rangeExpandDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!1,!0)},rangeExpandJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!0)},rangeExpandJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!0)},rangeExpandJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!0)},rangeExpandJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!0)}},cft={range:function(t){var e=[],i=this.table.modules.selectRange.activeRange,r=!1,n,a,s,o,l;return l=t.length,i&&(n=i.getBounds(),a=n.start,n.start===n.end&&(r=!0),a&&(e=this.table.rowManager.activeRows.slice(),s=e.indexOf(a.row),r?o=t.length:o=e.indexOf(n.end.row)-s+1,s>-1&&(this.table.blockRedraw(),e=e.slice(s,s+o),e.forEach((c,u)=>{c.updateData(t[u%l])}),this.table.restoreRedraw()))),e}},uft={range:function(t){var e=[],i=[],r=this.table.modules.selectRange.activeRange,n=!1,a,s,o,l,c;return r&&(a=r.getBounds(),s=a.start,a.start===a.end&&(n=!0),s&&(t=t.split(`
`),t.forEach(function(u){e.push(u.split("	"))}),e.length&&(l=this.table.columnManager.getVisibleColumnsByIndex(),c=l.indexOf(s.column),c>-1)))?(n?o=e[0].length:o=l.indexOf(a.end.column)-c+1,l=l.slice(c,c+o),e.forEach(u=>{var d={},p=u.length;l.forEach(function(f,h){d[f.field]=u[h%p]}),i.push(d)}),i):!1}},dft={range:function(){var t=this.modules.selectRange.selectedColumns();return this.columnManager.rowHeader&&t.unshift(this.columnManager.rowHeader),t}},pft={range:function(){return this.modules.selectRange.selectedRows()}},fft={keybindings:{bindings:oft,actions:lft},clipboard:{pasteActions:cft,pasteParsers:uft},export:{columnLookups:dft,rowLookups:pft}};class hft extends Or{static moduleName="selectRange";static moduleInitOrder=1;static moduleExtensions=fft;constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableOption("selectableRangeAutoFocus",!0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()),this.options("columns").findIndex(e=>e.frozen)>0&&console.warn("Having frozen column in arbitrary position with selectRange option may result in unpredictable behavior."),this.options("columns").filter(e=>e.frozen)>1&&console.warn("Having multiple frozen columns with selectRange option may result in unpredictable behavior."))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-moving",this.handleColumnMoving.bind(this)),this.subscribe("column-moved",this.handleColumnMoved.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'."),e.modules.edit}updateHeaderColumn(){var e;this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior"))),this.table.modules.frozenColumns&&this.table.modules.frozenColumns.active&&(e=this.table.modules.frozenColumns.getFrozenColumns(),(e.length>1||e.length===1&&e[0]!==this.rowHeader)&&console.warn("Using frozen columns that are not the range header in combination with the selectRange option may result in unpredictable behavior"))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,i){return e=e?e._cell:null,i=i?i._cell:null,this.addRange(e,i)}cellGetRanges(e){var i=[];return e.column===this.rowHeader?i=this.ranges.filter(r=>r.occupiesRow(e.row)):i=this.ranges.filter(r=>r.occupies(e)),i.map(r=>r.getComponent())}rowGetRanges(e){var i=this.ranges.filter(r=>r.occupiesRow(e));return i.map(r=>r.getComponent())}colGetRanges(e){var i=this.ranges.filter(r=>r.occupiesColumn(e));return i.map(r=>r.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var i;this.restoreFocus();try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(e.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var i;this.selecting!=="column"&&this.selecting!=="all"||(i=this.ranges.some(r=>r.occupiesColumn(e)),i&&this.ranges.forEach(r=>{var n=r.getColumns(!0);n.forEach(a=>{a!==e&&a.setWidth(e.width)})}))}handleColumnMoving(e,i){this.resetRanges().setBounds(i),this.overlay.style.visibility="hidden"}handleColumnMoved(e,i,r){this.activeRange.setBounds(e),this.layoutElement()}handleColumnMouseDown(e,i){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(i)||this.table.options.movableColumns&&this.selecting==="column"&&this.activeRange.occupiesColumn(i)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleColumnMouseMove(e,i){i===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}renderCell(e){var i=e.getElement(),r=this.ranges.findIndex(n=>n.occupies(e));i.classList.toggle("tabulator-range-selected",r!==-1),i.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),i.dataset.range=r}handleCellMouseDown(e,i){e.button===2&&(this.activeRange.occupies(i)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(i.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleCellMouseMove(e,i){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}handleCellClick(e,i){this.initializeFocus(i)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,i){this.navigate(!1,!1,e),i.preventDefault()}keyNavigateRange(e,i,r,n){this.navigate(r,n,i),e.preventDefault()}navigate(e,i,r){var n=!1,a,s,o,l,c,u,d,p,f,h,m;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(A=>A===this.activeRange?(A.setEnd(A.start.row,A.start.col),!0):(A.destroy(),!1))),a=this.activeRange,o={top:a.top,bottom:a.bottom,left:a.left,right:a.right},s=i?a.end:a.start,l=s.row,c=s.col,e)switch(r){case"left":c=this.findJumpCellLeft(a.start.row,s.col);break;case"right":c=this.findJumpCellRight(a.start.row,s.col);break;case"up":l=this.findJumpCellUp(s.row,a.start.col);break;case"down":l=this.findJumpCellDown(s.row,a.start.col);break}else{if(i&&(this.selecting==="row"&&(r==="left"||r==="right")||this.selecting==="column"&&(r==="up"||r==="down")))return;switch(r){case"left":c=Math.max(c-1,0);break;case"right":c=Math.min(c+1,this.getTableColumns().length-1);break;case"up":l=Math.max(l-1,0);break;case"down":l=Math.min(l+1,this.getTableRows().length-1);break}}if(this.rowHeader&&c===0&&(c=1),i||a.setStart(l,c),a.setEnd(l,c),i||(this.selecting="cell"),n=o.top!==a.top||o.bottom!==a.bottom||o.left!==a.left||o.right!==a.right,n)return u=this.getRowByRangePos(a.end.row),d=this.getColumnByRangePos(a.end.col),p=u.getElement().getBoundingClientRect(),h=d.getElement().getBoundingClientRect(),f=this.table.rowManager.getElement().getBoundingClientRect(),m=this.table.columnManager.getElement().getBoundingClientRect(),p.top>=f.top&&p.bottom<=f.bottom||(u.getElement().parentNode&&d.getElement().parentNode?this.autoScroll(a,u.getElement(),d.getElement()):u.getComponent().scrollTo(void 0,!1)),h.left>=m.left+this.getRowHeaderWidth()&&h.right<=m.right||(u.getElement().parentNode&&d.getElement().parentNode?this.autoScroll(a,u.getElement(),d.getElement()):d.getComponent().scrollTo(void 0,!1)),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(i=>i!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpRow(e,i,r,n,a){return r&&(i=i.reverse()),this.findJumpItem(n,a,i,function(s){return s.getData()[e.getField()]})}findJumpCol(e,i,r,n,a){return r&&(i=i.reverse()),this.findJumpItem(n,a,i,function(s){return e.getData()[s.getField()]})}findJumpItem(e,i,r,n){var a;for(let s of r){let o=n(s);if(e){if(a=s,o)break}else if(i){if(a=s,o)break}else if(o)a=s;else break}return a}findJumpCellLeft(e,i){var r=this.getRowByRangePos(e),n=this.getTableColumns(),a=this.isEmpty(r.getData()[n[i].getField()]),s=n[i-1]?this.isEmpty(r.getData()[n[i-1].getField()]):!1,o=this.rowHeader?n.slice(1,i):n.slice(0,i),l=this.findJumpCol(r,o,!0,a,s);return l?l.getPosition()-1:i}findJumpCellRight(e,i){var r=this.getRowByRangePos(e),n=this.getTableColumns(),a=this.isEmpty(r.getData()[n[i].getField()]),s=n[i+1]?this.isEmpty(r.getData()[n[i+1].getField()]):!1,o=this.findJumpCol(r,n.slice(i+1,n.length),!1,a,s);return o?o.getPosition()-1:i}findJumpCellUp(e,i){var r=this.getColumnByRangePos(i),n=this.getTableRows(),a=this.isEmpty(n[e].getData()[r.getField()]),s=n[e-1]?this.isEmpty(n[e-1].getData()[r.getField()]):!1,o=this.findJumpRow(r,n.slice(0,e),!0,a,s);return o?o.position-1:e}findJumpCellDown(e,i){var r=this.getColumnByRangePos(i),n=this.getTableRows(),a=this.isEmpty(n[e].getData()[r.getField()]),s=n[e+1]?this.isEmpty(n[e+1].getData()[r.getField()]):!1,o=this.findJumpRow(r,n.slice(e+1,n.length),!1,a,s);return o?o.position-1:e}newSelection(e,i){var r;if(i.type==="column"){if(!this.columnSelection)return;if(i===this.rowHeader){r=this.resetRanges(),this.selecting="all";var n,a=this.getCell(-1,-1);this.rowHeader?n=this.getCell(0,1):n=this.getCell(0,0),r.setBounds(n,a);return}else this.selecting="column"}else i.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,i):e.ctrlKey?this.addRange().setBounds(i):this.resetRanges().setBounds(i)}autoScroll(e,i,r){var n=this.table.rowManager.element,a,s,o,l;typeof i>"u"&&(i=this.getRowByRangePos(e.end.row).getElement()),typeof r>"u"&&(r=this.getColumnByRangePos(e.end.col).getElement()),a={left:r.offsetLeft,right:r.offsetLeft+r.offsetWidth,top:i.offsetTop,bottom:i.offsetTop+i.offsetHeight},s={left:n.scrollLeft+this.getRowHeaderWidth(),right:Math.ceil(n.scrollLeft+n.clientWidth),top:n.scrollTop,bottom:n.scrollTop+n.offsetHeight-this.table.rowManager.scrollbarWidth},o=s.left<a.left&&a.left<s.right&&s.left<a.right&&a.right<s.right,l=s.top<a.top&&a.top<s.bottom&&s.top<a.bottom&&a.bottom<s.bottom,o||(a.left<s.left?n.scrollLeft=a.left-this.getRowHeaderWidth():a.right>s.right&&(n.scrollLeft=Math.min(a.right-n.clientWidth,a.left-this.getRowHeaderWidth()))),l||(a.top<s.top?n.scrollTop=a.top:a.bottom>s.bottom&&(n.scrollTop=a.bottom-n.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var i;e?i=this.table.rowManager.getVisibleRows(!0):i=this.table.rowManager.getRows(),i.forEach(r=>{r.type==="row"&&(this.layoutRow(r),r.cells.forEach(n=>this.renderCell(n)))}),this.getTableColumns().forEach(r=>{this.layoutColumn(r)}),this.layoutRanges()}layoutRow(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesRow(e));this.selecting==="row"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutColumn(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesColumn(e));this.selecting==="column"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutRanges(){var e,i,r;this.table.initialized&&(e=this.getActiveCell(),e&&(i=e.getElement(),r=e.row.getElement(),this.table.rtl?this.activeRangeCellElement.style.right=r.offsetWidth-i.offsetLeft-i.offsetWidth+"px":this.activeRangeCellElement.style.left=r.offsetLeft+i.offsetLeft+"px",this.activeRangeCellElement.style.top=r.offsetTop+"px",this.activeRangeCellElement.style.width=i.offsetWidth+"px",this.activeRangeCellElement.style.height=r.offsetHeight+"px",this.ranges.forEach(n=>n.layout()),this.overlay.style.visibility="visible"))}getCell(e,i){var r;return i<0&&(i=this.getTableColumns().length+i,i<0)?null:(e<0&&(e=this.getTableRows().length+e),r=this.table.rowManager.getRowFromPosition(e+1),r?r.getCells(!1,!0).filter(n=>n.column.visible)[i]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e]}getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,i){var r;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),r=new sft(this.table,this,e,i),this.activeRange=r,this.ranges.push(r),this.rangeContainer.appendChild(r.element),r}resetRanges(){var e,i,r;return this.ranges.forEach(n=>n.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(r=this.table.rowManager.activeRows[0].cells.filter(n=>n.column.visible),i=r[this.rowHeader?1:0],i&&(e.setBounds(i),this.options("selectableRangeAutoFocus")&&this.initializeFocus(i))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(i=>i.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(i=>i.getComponent()):this.activeRange.getColumns()}getRowHeaderWidth(){return this.rowHeader?this.rowHeader.getElement().offsetWidth:0}isEmpty(e){return e==null||e===""}}function mft(t,e,i,r,n,a,s){var o=s.alignEmptyValues,l=s.decimalSeparator,c=s.thousandSeparator,u=0;if(t=String(t),e=String(e),c&&(t=t.split(c).join(""),e=e.split(c).join("")),l&&(t=t.split(l).join("."),e=e.split(l).join(".")),t=parseFloat(t),e=parseFloat(e),isNaN(t))u=isNaN(e)?0:-1;else if(isNaN(e))u=1;else return t-e;return(o==="top"&&a==="desc"||o==="bottom"&&a==="asc")&&(u*=-1),u}function Aft(t,e,i,r,n,a,s){var o=s.alignEmptyValues,l=0,c;if(!t)l=e?-1:0;else if(!e)l=1;else{switch(typeof s.locale){case"boolean":s.locale&&(c=this.langLocale());break;case"string":c=s.locale;break}return String(t).toLowerCase().localeCompare(String(e).toLowerCase(),c)}return(o==="top"&&a==="desc"||o==="bottom"&&a==="asc")&&(l*=-1),l}function mZ(t,e,i,r,n,a,s){var o=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),l=s.format||"dd/MM/yyyy HH:mm:ss",c=s.alignEmptyValues,u=0;if(typeof o<"u"){if(o.isDateTime(t)||(l==="iso"?t=o.fromISO(String(t)):t=o.fromFormat(String(t),l)),o.isDateTime(e)||(l==="iso"?e=o.fromISO(String(e)):e=o.fromFormat(String(e),l)),!t.isValid)u=e.isValid?-1:0;else if(!e.isValid)u=1;else return t-e;return(c==="top"&&a==="desc"||c==="bottom"&&a==="asc")&&(u*=-1),u}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function gft(t,e,i,r,n,a,s){return s.format||(s.format="dd/MM/yyyy"),mZ.call(this,t,e,i,r,n,a,s)}function vft(t,e,i,r,n,a,s){return s.format||(s.format="HH:mm"),mZ.call(this,t,e,i,r,n,a,s)}function yft(t,e,i,r,n,a,s){var o=t===!0||t==="true"||t==="True"||t===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return o-l}function bft(t,e,i,r,n,a,s){var o=s.type||"length",l=s.alignEmptyValues,c=0,u=this.table,d;s.valueMap&&(typeof s.valueMap=="string"?d=function(f){return f.map(h=>Ma.retrieveNestedData(u.options.nestedFieldSeparator,s.valueMap,h))}:d=s.valueMap);function p(f){var h;switch(d&&(f=d(f)),o){case"length":h=f.length;break;case"sum":h=f.reduce(function(m,A){return m+A});break;case"max":h=Math.max.apply(null,f);break;case"min":h=Math.min.apply(null,f);break;case"avg":h=f.reduce(function(m,A){return m+A})/f.length;break;case"string":h=f.join("");break}return h}if(!Array.isArray(t))c=Array.isArray(e)?-1:0;else if(!Array.isArray(e))c=1;else return o==="string"?String(p(t)).toLowerCase().localeCompare(String(p(e)).toLowerCase()):p(e)-p(t);return(l==="top"&&a==="desc"||l==="bottom"&&a==="asc")&&(c*=-1),c}function Ift(t,e,i,r,n,a,s){var o=typeof t>"u"?0:1,l=typeof e>"u"?0:1;return o-l}function wft(t,e,i,r,n,a,s){var o,l,c,u,d=0,p,f=/(\d+)|(\D+)/g,h=/\d/,m=s.alignEmptyValues,A=0;if(!t&&t!==0)A=!e&&e!==0?0:-1;else if(!e&&e!==0)A=1;else{if(isFinite(t)&&isFinite(e))return t-e;if(o=String(t).toLowerCase(),l=String(e).toLowerCase(),o===l)return 0;if(!(h.test(o)&&h.test(l)))return o>l?1:-1;for(o=o.match(f),l=l.match(f),p=o.length>l.length?l.length:o.length;d<p;)if(c=o[d],u=l[d++],c!==u)return isFinite(c)&&isFinite(u)?(c.charAt(0)==="0"&&(c="."+c),u.charAt(0)==="0"&&(u="."+u),c-u):c>u?1:-1;return o.length>l.length}return(m==="top"&&a==="desc"||m==="bottom"&&a==="asc")&&(A*=-1),A}var Sft={number:mft,string:Aft,date:gft,time:vft,datetime:mZ,boolean:yft,array:bft,exists:Ift,alphanum:wft};class R0 extends Or{static moduleName="sort";static sorters=Sft;constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,i,r,n){var a=this.getSort();return a.forEach(s=>{delete s.column}),n.sort=a,n}userSetSort(e,i){this.setSort(e,i),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var i=!1,r,n;switch(typeof e.definition.sorter){case"string":R0.sorters[e.definition.sorter]?i=R0.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":i=e.definition.sorter;break}if(e.modules.sort={sorter:i,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(r=e.getElement(),r.classList.add("tabulator-sortable"),n=document.createElement("div"),n.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":n.classList.add("tabulator-col-sorter-element");break;case"header":r.classList.add("tabulator-col-sorter-element");break;default:r.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":n.appendChild(this.table.options.headerSortElement);break;default:n.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(n),e.modules.sort.element=n,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&n.addEventListener("mousedown",a=>{a.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?n:r).addEventListener("click",a=>{var s="",o=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?s=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?s=e.modules.sort.dir=="asc"?"desc":"asc":s="none";else switch(e.modules.sort.dir){case"asc":s="desc";break;case"desc":s="asc";break;default:s=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(a.shiftKey||a.ctrlKey)?(o=this.getSort(),l=o.findIndex(c=>c.field===e.getField()),l>-1?(o[l].dir=s,l=o.splice(l,1)[0],s!="none"&&o.push(l)):s!="none"&&o.push({column:e,dir:s}),this.setSort(o)):s=="none"?this.clear():this.setSort(e,s),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,i=[];return e.sortList.forEach(function(r){r.column&&i.push({column:r.column.getComponent(),field:r.column.getField(),dir:r.dir})}),i}setSort(e,i){var r=this,n=[];Array.isArray(e)||(e=[{column:e,dir:i}]),e.forEach(function(a){var s;s=r.table.columnManager.findColumn(a.column),s?(a.column=s,n.push(a),r.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",a.column)}),r.sortList=n,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var i=this.table.rowManager.activeRows[0],r="string",n,a;if(i&&(i=i.getData(),n=e.getField(),n))switch(a=e.getFieldValue(i),typeof a){case"undefined":r="string";break;case"boolean":r="boolean";break;default:!isNaN(a)&&a!==""?r="number":a.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(r="alphanum");break}return R0.sorters[r]}sort(e,i){var r=this,n=this.table.options.sortOrderReverse?r.sortList.slice().reverse():r.sortList,a=[],s=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",r.getSort()),i||r.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(n.forEach(function(o,l){var c;o.column&&(c=o.column.modules.sort,c&&(c.sorter||(c.sorter=r.findSorter(o.column)),o.params=typeof c.params=="function"?c.params(o.column.getComponent(),o.dir):c.params,a.push(o)),i||r.setColumnHeader(o.column,o.dir))}),a.length&&r._sortItems(e,a)):i||n.forEach(function(o,l){r.setColumnHeader(o.column,o.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(o=>{s.push(o.getComponent())}),this.dispatchExternal("dataSorted",r.getSort(),s)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,i){e.modules.sort.dir=i,e.getElement().setAttribute("aria-sort",i==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,i)}setColumnHeaderSortIcon(e,i){var r=e.modules.sort.element,n;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;r.firstChild;)r.removeChild(r.firstChild);n=this.table.options.headerSortElement.call(this.table,e.getComponent(),i),typeof n=="object"?r.appendChild(n):r.innerHTML=n}}_sortItems(e,i){var r=i.length-1;e.sort((n,a)=>{for(var s,o=r;o>=0;o--){let l=i[o];if(s=this._sortRow(n,a,l.column,l.dir,l.params),s!==0)break}return s})}_sortRow(e,i,r,n,a){var s,o,l=n=="asc"?e:i,c=n=="asc"?i:e;return e=r.getFieldValue(l.getData()),i=r.getFieldValue(c.getData()),e=typeof e<"u"?e:"",i=typeof i<"u"?i:"",s=l.getComponent(),o=c.getComponent(),r.modules.sort.sorter.call(this,e,i,s,o,r.getComponent(),n,a)}}class Uft{constructor(e,i){this.columnCount=e,this.rowCount=i,this.columnString=[],this.columns=[],this.rows=[]}genColumns(e){var i=Math.max(this.columnCount,Math.max(...e.map(r=>r.length)));this.columnString=[],this.columns=[];for(let r=1;r<=i;r++)this.incrementChar(this.columnString.length-1),this.columns.push(this.columnString.join(""));return this.columns}genRows(e){var i=Math.max(this.rowCount,e.length);this.rows=[];for(let r=1;r<=i;r++)this.rows.push(r);return this.rows}incrementChar(e){let i=this.columnString[e];i?i!=="Z"?this.columnString[e]=String.fromCharCode(this.columnString[e].charCodeAt(0)+1):(this.columnString[e]="A",e?this.incrementChar(e-1):this.columnString.push("A")):this.columnString.push("A")}setRowCount(e){this.rowCount=e}setColumnCount(e){this.columnCount=e}}class hMe{constructor(e){return this._sheet=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._sheet.table.componentFunctionBinder.handle("sheet",i._sheet,r)}})}getTitle(){return this._sheet.title}getKey(){return this._sheet.key}getDefinition(){return this._sheet.getDefinition()}getData(){return this._sheet.getData()}setData(e){return this._sheet.setData(e)}clear(){return this._sheet.clear()}remove(){return this._sheet.remove()}active(){return this._sheet.active()}setTitle(e){return this._sheet.setTitle(e)}setRows(e){return this._sheet.setRows(e)}setColumns(e){return this._sheet.setColumns(e)}}class rne extends sc{constructor(e,i){super(e.table),this.spreadsheetManager=e,this.definition=i,this.title=this.definition.title||"",this.key=this.definition.key||this.definition.title,this.rowCount=this.definition.rows,this.columnCount=this.definition.columns,this.data=this.definition.data||[],this.element=null,this.isActive=!1,this.grid=new Uft(this.columnCount,this.rowCount),this.defaultColumnDefinition={width:100,headerHozAlign:"center",headerSort:!1},this.columnDefinition=Object.assign(this.defaultColumnDefinition,this.options("spreadsheetColumnDefinition")),this.columnDefs=[],this.rowDefs=[],this.columnFields=[],this.columns=[],this.rows=[],this.scrollTop=null,this.scrollLeft=null,this.initialize(),this.dispatchExternal("sheetAdded",this.getComponent())}initialize(){this.initializeElement(),this.initializeColumns(),this.initializeRows()}reinitialize(){this.initializeColumns(),this.initializeRows()}initializeElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tab"),this.element.innerText=this.title,this.element.addEventListener("click",()=>{this.spreadsheetManager.loadSheet(this)})}initializeColumns(){this.grid.setColumnCount(this.columnCount),this.columnFields=this.grid.genColumns(this.data),this.columnDefs=[],this.columnFields.forEach(e=>{var i=Object.assign({},this.columnDefinition);i.field=e,i.title=e,this.columnDefs.push(i)})}initializeRows(){var e;this.grid.setRowCount(this.rowCount),e=this.grid.genRows(this.data),this.rowDefs=[],e.forEach((i,r)=>{var n={_id:i},a=this.data[r];a&&a.forEach((s,o)=>{var l=this.columnFields[o];l&&(n[l]=s)}),this.rowDefs.push(n)})}unload(){this.isActive=!1,this.scrollTop=this.table.rowManager.scrollTop,this.scrollLeft=this.table.rowManager.scrollLeft,this.data=this.getData(!0),this.element.classList.remove("tabulator-spreadsheet-tab-active")}load(){var e=!this.isActive;this.isActive=!0,this.table.blockRedraw(),this.table.setData([]),this.table.setColumns(this.columnDefs),this.table.setData(this.rowDefs),this.table.restoreRedraw(),e&&this.scrollTop!==null&&(this.table.rowManager.element.scrollLeft=this.scrollLeft,this.table.rowManager.element.scrollTop=this.scrollTop),this.element.classList.add("tabulator-spreadsheet-tab-active"),this.dispatchExternal("sheetLoaded",this.getComponent())}getComponent(){return new hMe(this)}getDefinition(){return{title:this.title,key:this.key,rows:this.rowCount,columns:this.columnCount,data:this.getData()}}getData(e){var i=[],r,n,a;return this.rowDefs.forEach(s=>{var o=[];this.columnFields.forEach(l=>{o.push(s[l])}),i.push(o)}),!e&&!this.options("spreadsheetOutputFull")&&(r=i.map(s=>s.findLastIndex(o=>typeof o<"u")+1),n=Math.max(...r),a=r.findLastIndex(s=>s>0)+1,i=i.slice(0,a),i=i.map(s=>s.slice(0,n))),i}setData(e){this.data=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}clear(){this.setData([])}setTitle(e){this.title=e,this.element.innerText=e,this.dispatchExternal("sheetUpdated",this.getComponent())}setRows(e){this.rowCount=e,this.initializeRows(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}setColumns(e){this.columnCount=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}remove(){this.spreadsheetManager.removeSheet(this)}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchExternal("sheetRemoved",this.getComponent())}active(){this.spreadsheetManager.loadSheet(this)}}class Tft extends Or{static moduleName="spreadsheet";constructor(e){super(e),this.sheets=[],this.element=null,this.registerTableOption("spreadsheet",!1),this.registerTableOption("spreadsheetRows",50),this.registerTableOption("spreadsheetColumns",50),this.registerTableOption("spreadsheetColumnDefinition",{}),this.registerTableOption("spreadsheetOutputFull",!1),this.registerTableOption("spreadsheetData",!1),this.registerTableOption("spreadsheetSheets",!1),this.registerTableOption("spreadsheetSheetTabs",!1),this.registerTableOption("spreadsheetSheetTabsElement",!1),this.registerTableFunction("setSheets",this.setSheets.bind(this)),this.registerTableFunction("addSheet",this.addSheet.bind(this)),this.registerTableFunction("getSheets",this.getSheets.bind(this)),this.registerTableFunction("getSheetDefinitions",this.getSheetDefinitions.bind(this)),this.registerTableFunction("setSheetData",this.setSheetData.bind(this)),this.registerTableFunction("getSheet",this.getSheet.bind(this)),this.registerTableFunction("getSheetData",this.getSheetData.bind(this)),this.registerTableFunction("clearSheet",this.clearSheet.bind(this)),this.registerTableFunction("removeSheet",this.removeSheetFunc.bind(this)),this.registerTableFunction("activeSheet",this.activeSheetFunc.bind(this))}initialize(){this.options("spreadsheet")&&(this.subscribe("table-initialized",this.tableInitialized.bind(this)),this.subscribe("data-loaded",this.loadRemoteData.bind(this)),this.table.options.index="_id",this.options("spreadsheetData")&&this.options("spreadsheetSheets")&&(console.warn("You cannot use spreadsheetData and spreadsheetSheets at the same time, ignoring spreadsheetData"),this.table.options.spreadsheetData=!1),this.compatibilityCheck(),this.options("spreadsheetSheetTabs")&&this.initializeTabset())}compatibilityCheck(){this.options("data")&&console.warn("Do not use the data option when working with spreadsheets, use either spreadsheetData or spreadsheetSheets to pass data into the table"),this.options("pagination")&&console.warn("The spreadsheet module is not compatible with the pagination module"),this.options("groupBy")&&console.warn("The spreadsheet module is not compatible with the row grouping module"),this.options("responsiveCollapse")&&console.warn("The spreadsheet module is not compatible with the responsive collapse module")}initializeTabset(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tabs");var e=this.options("spreadsheetSheetTabsElement");e&&!(e instanceof HTMLElement)&&(e=document.querySelector(e),e||console.warn("Unable to find element matching spreadsheetSheetTabsElement selector:",this.options("spreadsheetSheetTabsElement"))),e?e.appendChild(this.element):this.footerAppend(this.element)}tableInitialized(){this.sheets.length?this.loadSheet(this.sheets[0]):this.options("spreadsheetSheets")?this.loadSheets(this.options("spreadsheetSheets")):this.options("spreadsheetData")&&this.loadData(this.options("spreadsheetData"))}loadRemoteData(e,i,r){return console.log("data",e,i,r),Array.isArray(e)?(this.table.dataLoader.clearAlert(),this.dispatchExternal("dataLoaded",e),!e.length||Array.isArray(e[0])?this.loadData(e):this.loadSheets(e)):console.error(`Spreadsheet Loading Error - Unable to process remote data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e),!1}loadData(e){var i={data:e};this.loadSheet(this.newSheet(i))}destroySheets(){this.sheets.forEach(e=>{e.destroy()}),this.sheets=[],this.activeSheet=null}loadSheets(e){Array.isArray(e)||(e=[]),this.destroySheets(),e.forEach(i=>{this.newSheet(i)}),this.loadSheet(this.sheets[0])}loadSheet(e){this.activeSheet!==e&&(this.activeSheet&&this.activeSheet.unload(),this.activeSheet=e,e.load())}newSheet(e={}){var i;return e.rows||(e.rows=this.options("spreadsheetRows")),e.columns||(e.columns=this.options("spreadsheetColumns")),i=new rne(this,e),this.sheets.push(i),this.element&&this.element.appendChild(i.element),i}removeSheet(e){var i=this.sheets.indexOf(e),r;this.sheets.length>1?i>-1&&(this.sheets.splice(i,1),e.destroy(),this.activeSheet===e&&(r=this.sheets[i-1]||this.sheets[0],r?this.loadSheet(r):this.activeSheet=null)):console.warn("Unable to remove sheet, at least one sheet must be active")}lookupSheet(e){return e?e instanceof rne?e:e instanceof hMe?e._sheet:this.sheets.find(i=>i.key===e)||!1:this.activeSheet}setSheets(e){return this.loadSheets(e),this.getSheets()}addSheet(e){return this.newSheet(e).getComponent()}getSheetDefinitions(){return this.sheets.map(e=>e.getDefinition())}getSheets(){return this.sheets.map(e=>e.getComponent())}getSheet(e){var i=this.lookupSheet(e);return i?i.getComponent():!1}setSheetData(e,i){e&&!i&&(i=e,e=!1);var r=this.lookupSheet(e);return r?r.setData(i):!1}getSheetData(e){var i=this.lookupSheet(e);return i?i.getData():!1}clearSheet(e){var i=this.lookupSheet(e);return i?i.clear():!1}removeSheetFunc(e){var i=this.lookupSheet(e);i&&this.removeSheet(i)}activeSheetFunc(e){var i=this.lookupSheet(e);return i?this.loadSheet(i):!1}}let Cft=class extends Or{static moduleName="tooltip";constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,i,r){var n=e==="tooltip"?r.column.definition.tooltip:r.definition.headerTooltip;n&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,i,r,n),this.table.options.tooltipDelay))}mouseoutCheck(e,i,r){this.popupInstance||this.clearPopup()}clearPopup(e,i,r){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,i,r){var n,a,s;function o(l){a=l}typeof r=="function"&&(r=r(e,i.getComponent(),o)),r instanceof HTMLElement?n=r:(n=document.createElement("div"),r===!0&&(i instanceof CN?r=i.value:i.definition.field?this.langBind("columns|"+i.definition.field,l=>{n.innerHTML=r=l||i.definition.title}):r=i.definition.title),n.innerHTML=r),(r||r===0||r===!1)&&(n.classList.add("tabulator-tooltip"),n.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(n),typeof a=="function"&&this.popupInstance.renderCallback(a),s=this.popupInstance.containerEventCoords(e),this.popupInstance.show(s.x+15,s.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",i.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",i.getComponent()))}};var Eft={integer:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(/^[a-z0-9]+$/i);return r.test(e)},max:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=i},min:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=i},starts:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(i).toLowerCase())},ends:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(i).toLowerCase())},minLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length>=i},maxLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length<=i},in:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(typeof i=="string"&&(i=i.split("|")),i.indexOf(e)>-1)},regex:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(i);return r.test(e)},unique:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=!0,n=t.getData(),a=t.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(s){var o=s.getData();o!==n&&e==a.getFieldValue(o)&&(r=!1)}),r},required:function(t,e,i){return e!==""&&e!==null&&typeof e<"u"}};class AZ extends Or{static moduleName="validate";static validators=Eft;constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,i,r){var n=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,i):!0;return n!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),i,n)}),n}editorClear(e,i){i&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}rowValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.clearValidation(i._getSelf())})}userValidate(e){var i=[];return this.table.rowManager.rows.forEach(r=>{r=r.getComponent();var n=r.validate();n!==!0&&(i=i.concat(n))}),i.length?i:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var i=this,r=[],n;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(a=>{n=i._extractValidator(a),n&&r.push(n)}):(n=this._extractValidator(e.definition.validator),n&&r.push(n)),e.modules.validate=r.length?r:!1)}_extractValidator(e){var i,r,n;switch(typeof e){case"string":return n=e.indexOf(":"),n>-1?(i=e.substring(0,n),r=e.substring(n+1)):i=e,this._buildValidator(i,r);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,i){var r=typeof e=="function"?e:AZ.validators[e];return r?{type:typeof e=="function"?"function":e,func:r,params:i}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,i,r){var n=this,a=[],s=this.invalidCells.indexOf(i);return e&&e.forEach(o=>{o.func.call(n,i.getComponent(),r,o.params)||a.push({type:o.type,parameters:o.params})}),i.modules.validate||(i.modules.validate={}),a.length?(i.modules.validate.invalid=a,this.table.options.validationMode!=="manual"&&i.getElement().classList.add("tabulator-validation-fail"),s==-1&&this.invalidCells.push(i)):(i.modules.validate.invalid=!1,i.getElement().classList.remove("tabulator-validation-fail"),s>-1&&this.invalidCells.splice(s,1)),a.length?a:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(i=>{e.push(i.getComponent())}),e}clearValidation(e){var i;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,i=this.invalidCells.indexOf(e),i>-1&&this.invalidCells.splice(i,1))}}var MG=Object.freeze({__proto__:null,AccessorModule:aO,AjaxModule:QU,ClipboardModule:Idt,ColumnCalcsModule:jU,DataTreeModule:Udt,DownloadModule:sO,EditModule:pZ,ExportModule:D0,FilterModule:rI,FormatModule:zU,FrozenColumnsModule:vpt,FrozenRowsModule:ypt,GroupRowsModule:Ipt,HistoryModule:Ept,HtmlTableImportModule:Dpt,ImportModule:fZ,InteractionModule:kpt,KeybindingsModule:P0,MenuModule:Opt,MoveColumnsModule:Fpt,MoveRowsModule:oO,MutatorModule:lO,PageModule:hZ,PersistenceModule:sm,PopupModule:qpt,PrintModule:Wpt,ReactiveDataModule:Kpt,ResizeColumnsModule:Ypt,ResizeRowsModule:Xpt,ResizeTableModule:Zpt,ResponsiveLayoutModule:tft,SelectRangeModule:hft,SelectRowModule:nft,SortModule:R0,SpreadsheetModule:Tft,TooltipModule:Cft,ValidateModule:AZ}),Dft={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},rowHeader:!1,data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{},dependencies:{}};class mMe{constructor(e,i,r={}){this.table=e,this.msgType=i,this.registeredDefaults=Object.assign({},r)}register(e,i){this.registeredDefaults[e]=i}generate(e,i={}){var r=Object.assign({},this.registeredDefaults),n=this.table.options.debugInvalidOptions||i.debugInvalidOptions===!0;Object.assign(r,e);for(let a in i)r.hasOwnProperty(a)||(n&&console.warn("Invalid "+this.msgType+" option:",a),r[a]=i.key);for(let a in r)a in i?r[a]=i[a]:Array.isArray(r[a])?r[a]=Object.assign([],r[a]):typeof r[a]=="object"&&r[a]!==null?r[a]=Object.assign({},r[a]):typeof r[a]>"u"&&delete r[a];return r}}let MH=class extends sc{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,i){}renderRowCells(e){}rerenderRowCells(e,i){}scrollColumns(e,i){}scrollRows(e,i){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,i,r){var n=this.rows().indexOf(e),a=e.getElement(),s=0;return new Promise((o,l)=>{if(n>-1){if(typeof r>"u"&&(r=this.table.options.scrollToRowIfVisible),!r&&Ma.elVisible(a)&&(s=Ma.elOffset(a).top-Ma.elOffset(this.elementVertical).top,s>0&&s<this.elementVertical.clientHeight-a.offsetHeight))return o(),!1;switch(typeof i>"u"&&(i=this.table.options.scrollToRowPosition),i==="nearest"&&(i=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),i){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(a.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-a.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-a.offsetTop)+a.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+a.offsetHeight;break;case"top":this.elementVertical.scrollTop=a.offsetTop;break}o()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}};class Pft extends MH{constructor(e){super(e)}renderRowCells(e,i){const r=document.createDocumentFragment();e.cells.forEach(n=>{r.appendChild(n.getElement())}),e.element.appendChild(r),i||e.cells.forEach(n=>{n.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(i){i.reinitializeWidth()})}}class Rft extends MH{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,i){this.dataChange()}scrollColumns(e,i){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(i=>{if(i.visible){var r=i.getWidth();r>e&&(e=r)}}),this.windowBuffer=e*2}rerenderColumns(e,i){var r={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},n=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(a=>{var s={},o;a.visible&&(a.modules.frozen||(o=a.getWidth(),s.leftPos=n,s.rightPos=n+o,s.width=o,this.isFitData&&(s.fitDataCheck=a.modules.vdomHoz?a.modules.vdomHoz.fitDataCheck:!0),n+o>this.vDomScrollPosLeft&&n<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=n),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=o),this.columns.push(a),a.modules.vdomHoz=s,n+=o))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,i||(!e||this.reinitChanged(r))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const i=document.createDocumentFragment();e.cells.forEach(r=>{i.appendChild(r.getElement())}),e.element.appendChild(i),e.cells.forEach(r=>{r.cellRendered()})}}rerenderRowCells(e,i){this.reinitializeRow(e,i)}reinitializeColumnWidths(e){for(let i=this.leftCol;i<=this.rightCol;i++){let r=this.columns[i];r&&r.reinitializeWidth()}}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,i,r;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(n=>{!n.definition.width&&n.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,i=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],i)){r=i.getElement(),i.generateCells(),this.tableElement.appendChild(r);for(let n=0;n<i.cells.length;n++){let a=i.cells[n];r.appendChild(a.getElement()),a.column.reinitializeWidth()}r.parentNode.removeChild(r),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var i=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((r,n)=>{r!==this.columns[n]&&(i=!1)}),!i)}reinitializeRows(){var e=this.getVisibleRows(),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));e.forEach(r=>{this.reinitializeRow(r,!0)}),i.forEach(r=>{r.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,i,r){for(let n=e;n<i;n++){let a=this.columns[n];a.modules.vdomHoz.leftPos+=r,a.modules.vdomHoz.rightPos+=r}}addColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol+1];r&&r.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);n.getElement().insertBefore(a.getElement(),n.getCell(this.columns[this.rightCol]).getElement().nextSibling),a.cellRendered()}}),this.fitDataColActualWidthCheck(r),this.rightCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=r.getWidth()):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol-1];if(r)if(r.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(a=>{if(a.type!=="group"){var s=a.getCell(r);a.getElement().insertBefore(s.getElement(),a.getCell(this.columns[this.leftCol]).getElement()),s.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(a=>{a.type!=="group"&&(a.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=r.getWidth();let n=this.fitDataColActualWidthCheck(r);n&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+n,this.vDomPadRight-=n)}else i=!1;else i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol];r&&r.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(s){console.warn("Could not removeColRight",s.message)}}}),this.vDomPadRight+=r.getWidth(),this.rightCol--,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)})):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol];r&&r.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(s){console.warn("Could not removeColLeft",s.message)}}}),this.vDomPadLeft+=r.getWidth(),this.leftCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.leftCol=this.leftCol)})):i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var i,r;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),i=e.getWidth(),r=i-e.modules.vdomHoz.width,r&&(e.modules.vdomHoz.rightPos+=r,e.modules.vdomHoz.width=i,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,r)),e.modules.vdomHoz.fitDataCheck=!1),r}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.appendCell(e,i)});for(let i=this.leftCol;i<=this.rightCol;i++)this.appendCell(e,this.columns[i]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.appendCell(e,i)})}}appendCell(e,i){if(i&&i.visible){let r=e.getCell(i);e.getElement().appendChild(r.getElement()),r.cellRendered()}}reinitializeRow(e,i){if(e.type!=="group"&&(i||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var r=e.getElement();r.firstChild;)r.removeChild(r.firstChild);this.initializeRow(e)}}}class Mft extends sc{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.rowHeader=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new mMe(this.table,"column definition",fMe),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,i={virtual:Rft,basic:Pft};typeof this.table.options.renderHorizontal=="string"?e=i[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var i;e.deltaX&&(i=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(i),this.table.columnManager.scrollHorizontal(i))})}generateColumnsFromRowData(e){var i=[],r={},n=this.table.options.autoColumns==="full"?e:[e[0]],a=this.table.options.autoColumnsDefinitions;if(e&&e.length){if(n.forEach(s=>{Object.keys(s).forEach((o,l)=>{let c=s[o],u;r[o]?r[o]!==!0&&typeof c<"u"&&(r[o].sorter=this.calculateSorterFromValue(c),r[o]=!0):(u={field:o,title:o,sorter:this.calculateSorterFromValue(c)},i.splice(l,0,u),r[o]=typeof c>"u"?u:!0)})}),a)switch(typeof a){case"function":this.table.options.columns=a.call(this.table,i);break;case"object":Array.isArray(a)?i.forEach(s=>{var o=a.find(l=>l.field===s.field);o&&Object.assign(s,o)}):i.forEach(s=>{a[s.field]&&Object.assign(s,a[s.field])}),this.table.options.columns=i;break}else this.table.options.columns=i;this.setColumns(this.table.options.columns)}}calculateSorterFromValue(e){var i;switch(typeof e){case"undefined":i="string";break;case"boolean":i="boolean";break;case"number":i="number";break;case"object":Array.isArray(e)?i="array":i="string";break;default:!isNaN(e)&&e!==""?i="number":e.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?i="alphanum":i="string";break}return i}setColumns(e,i){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),this.dispatchExternal("columnsLoading"),this.table.options.rowHeader&&(this.rowHeader=new ym(this.table.options.rowHeader===!0?{}:this.table.options.rowHeader,this,!0),this.columns.push(this.rowHeader),this.headersElement.appendChild(this.rowHeader.getElement()),this.rowHeader.columnRendered()),e.forEach((r,n)=>{this._addColumn(r)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.subscribedExternal("columnsLoaded")&&this.dispatchExternal("columnsLoaded",this.getComponents()),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,i,r){var n=new ym(e,this),a=n.getElement(),s=r&&this.findColumnIndex(r);if(i&&this.rowHeader&&(!r||r===this.rowHeader)&&(i=!1,r=this.rowHeader,s=0),r&&s>-1){var o=r.getTopColumn(),l=this.columns.indexOf(o),c=o.getElement();i?(this.columns.splice(l,0,n),c.parentNode.insertBefore(a,c)):(this.columns.splice(l+1,0,n),c.parentNode.insertBefore(a,c.nextSibling))}else i?(this.columns.unshift(n),this.headersElement.insertBefore(n.getElement(),this.headersElement.firstChild)):(this.columns.push(n),this.headersElement.appendChild(n.getElement()));return n.columnRendered(),n}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(i=>{i.clearVerticalAlign()}),this.columns.forEach(i=>{var r=i.getHeight();r>e&&(e=r)}),this.headersElement.style.height=e+"px",this.columns.forEach(i=>{i.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var i;if(typeof e=="object"){if(e instanceof ym)return e;if(e instanceof pMe)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return i=[],this.columns.forEach(n=>{i.push(n),i=i.concat(n.getColumns(!0))}),i.find(n=>n.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var i=[];return Object.keys(this.columnsByField).forEach(r=>{var n=this.table.options.nestedFieldSeparator?r.split(this.table.options.nestedFieldSeparator)[0]:r;n===e&&i.push(this.columnsByField[r])}),i}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(i=>i.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(i=>e===i)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((i,r)=>{e(i,r)})}getDefinitions(e){var i=[];return this.columnsByIndex.forEach(r=>{(!e||e&&r.visible)&&i.push(r.getDefinition())}),i}getDefinitionTree(){var e=[];return this.columns.forEach(i=>{e.push(i.getDefinition(!0))}),e}getComponents(e){var i=[],r=e?this.columns:this.columnsByIndex;return r.forEach(n=>{i.push(n.getComponent())}),i}getWidth(){var e=0;return this.columnsByIndex.forEach(i=>{i.visible&&(e+=i.getWidth())}),e}moveColumn(e,i,r){i.element.parentNode.insertBefore(e.element,i.element),r&&i.element.parentNode.insertBefore(i.element,e.element),this.moveColumnActual(e,i,r),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,i,r){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,i,r):this._moveColumnInArray(this.columns,e,i,r),this._moveColumnInArray(this.columnsByIndex,e,i,r,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,i,r),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,i,r,n,a){var s=e.indexOf(i),o,l=[];s>-1&&(e.splice(s,1),o=e.indexOf(r),o>-1?n&&(o=o+1):o=s,e.splice(o,0,i),a&&(l=this.chain("column-moving-rows",[i,r,n],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(c){if(c.cells.length){var u=c.cells.splice(s,1)[0];c.cells.splice(o,0,u)}})))}scrollToColumn(e,i,r){var n=0,a=e.getLeftOffset(),s=0,o=e.getElement();return new Promise((l,c)=>{if(typeof i>"u"&&(i=this.table.options.scrollToColumnPosition),typeof r>"u"&&(r=this.table.options.scrollToColumnIfVisible),e.visible){switch(i){case"middle":case"center":s=-this.element.clientWidth/2;break;case"right":s=o.clientWidth-this.headersElement.clientWidth;break}if(!r&&a>0&&a+o.offsetWidth<this.element.clientWidth)return!1;n=a+s,n=Math.max(Math.min(n,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(n),this.scrollHorizontal(n),l()}else console.warn("Scroll Error - Column not visible"),c("Scroll Error - Column not visible")})}generateCells(e){var i=[];return this.columnsByIndex.forEach(r=>{i.push(r.generateCell(e))}),i}getFlexBaseWidth(){var e=this.table.element.clientWidth,i=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(r){var n,a,s;r.visible&&(n=r.definition.width||0,a=parseInt(r.minWidth),typeof n=="string"?n.indexOf("%")>-1?s=e/100*parseInt(n):s=parseInt(n):s=n,i+=s>a?s:a)}),i}addColumn(e,i,r){return new Promise((n,a)=>{var s=this._addColumn(e,i,r);this._reIndexColumns(),this.dispatch("column-add",e,i,r),this.layoutMode()!="fitColumns"&&s.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),n(s)})}deregisterColumn(e){var i=e.getField(),r;i&&delete this.columnsByField[i],r=this.columnsByIndex.indexOf(e),r>-1&&this.columnsByIndex.splice(r,1),r=this.columns.indexOf(e),r>-1&&this.columns.splice(r,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,i){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,i)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){Ma.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class Nft extends MH{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,i=!0,r=document.createDocumentFragment(),n=this.rows();n.forEach((a,s)=>{this.styleRow(a,s),a.initialize(!1,!0),a.type!=="group"&&(i=!1),r.appendChild(a.getElement())}),e.appendChild(r),n.forEach(a=>{a.rendered(),a.heightInitialized||a.calcHeight(!0)}),n.forEach(a=>{a.heightInitialized||a.setCellHeight()}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var i=Ma.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-i)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-i))}scrollToRow(e){var i=e.getElement();this.elementVertical.scrollTop=Ma.elOffset(i).top-Ma.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class Bft extends MH{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var i=this.elementVertical.scrollTop,r=!1,n=!1,a=this.table.rowManager.scrollLeft,s=this.rows(),o=this.vDomTop;o<=this.vDomBottom;o++)if(s[o]){var l=i-s[o].getElement().offsetTop;if(n===!1||Math.abs(l)<n)n=l,r=o;else break}s.forEach(c=>{c.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(r===!1?this.rows.length-1:r,!0,n||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(a)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,i){var r=e-this.vDomScrollPosTop,n=e-this.vDomScrollPosBottom,a=this.vDomWindowBuffer*2,s=this.rows();if(this.scrollTop=e,-r>a||n>a){var o=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*s.length)),this.scrollColumns(o)}else i?(r<0&&this._addTopRow(s,-r),n<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(s,-n):this.vDomScrollPosBottom=this.scrollTop)):(n>=0&&this._addBottomRow(s,n),r>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(s,r):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var i=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-i)>Math.abs(this.vDomBottom-i))}scrollToRow(e){var i=this.rows().indexOf(e);i>-1&&this._virtualRenderFill(i,!0)}visibleRows(e){var i=this.elementVertical.scrollTop,r=this.elementVertical.clientHeight+i,n=!1,a=0,s=0,o=this.rows();if(e)a=this.vDomTop,s=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(o[l])if(n)if(r-o[l].getElement().offsetTop>=0)s=l;else break;else if(i-o[l].getElement().offsetTop>=0)a=l;else if(n=!0,r-o[l].getElement().offsetTop>=0)s=l;else break;return o.slice(a,s+1)}_virtualRenderFill(e,i,r){var n=this.tableElement,a=this.elementVertical,s=0,o=0,l=0,c=0,u=0,d=0,p=this.rows(),f=p.length,h=0,m,A,g=[],v=0,b=0,y=this.table.rowManager.fixedHeight,I=this.elementVertical.clientHeight,w=this.table.options.rowHeight,S=!0;if(e=e||0,r=r||0,!e)this.clear();else{for(;n.firstChild;)n.removeChild(n.firstChild);c=(f-e+1)*this.vDomRowHeight,c<I&&(e-=Math.ceil((I-c)/this.vDomRowHeight),e<0&&(e=0)),s=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=s}if(f&&Ma.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,y||this.table.options.maxHeight?(w&&(b=I/w+this.vDomWindowBuffer/w),b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(b))):b=f;(b==f||o<=I+this.vDomWindowBuffer||v<this.vDomWindowMinTotalRows)&&this.vDomBottom<f-1;){for(g=[],A=document.createDocumentFragment(),d=0;d<b&&this.vDomBottom<f-1;)h=this.vDomBottom+1,m=p[h],this.styleRow(m,h),m.initialize(!1,!0),!m.heightInitialized&&!this.table.options.rowHeight&&m.clearCellHeight(),A.appendChild(m.getElement()),g.push(m),this.vDomBottom++,d++;if(!g.length)break;n.appendChild(A),g.forEach(T=>{T.rendered(),T.heightInitialized||T.calcHeight(!0)}),g.forEach(T=>{T.heightInitialized||T.setCellHeight()}),g.forEach(T=>{l=T.getHeight(),v<s?u+=l:o+=l,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=l*2),v++}),S=this.table.rowManager.adjustTableSize(),I=this.elementVertical.clientHeight,S&&(y||this.table.options.maxHeight)&&(w=o/v,b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(I/w+this.vDomWindowBuffer/w)))}e?(this.vDomTopPad=i?this.vDomRowHeight*this.vDomTop+r:this.scrollTop-u,this.vDomBottomPad=this.vDomBottom==f-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-o-u,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((o+u)/v),this.vDomBottomPad=this.vDomRowHeight*(f-this.vDomBottom-1),this.vDomScrollHeight=u+o+this.vDomBottomPad-I),n.style.paddingTop=this.vDomTopPad+"px",n.style.paddingBottom=this.vDomBottomPad+"px",i&&(this.scrollTop=this.vDomTopPad+u+r-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-I:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-I),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&i&&(this.scrollTop+=this.elementVertical.offsetHeight-I),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,a.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,i){for(var r=this.tableElement,n=[],a=0,s=this.vDomTop-1,o=0,l=!0;l;)if(this.vDomTop){let c=e[s],u,d;c&&o<this.vDomMaxRenderChain?(u=c.getHeight()||this.vDomRowHeight,d=c.initialized,i>=u?(this.styleRow(c,s),r.insertBefore(c.getElement(),r.firstChild),(!c.initialized||!c.heightInitialized)&&n.push(c),c.initialize(),d||(u=c.getElement().offsetHeight,u>this.vDomWindowBuffer&&(this.vDomWindowBuffer=u*2)),i-=u,a+=u,this.vDomTop--,s--,o++):l=!1):l=!1}else l=!1;for(let c of n)c.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomTopPad-=a,this.vDomTopPad<0&&(this.vDomTopPad=s*this.vDomRowHeight),s<1&&(this.vDomTopPad=0),r.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=a)}_removeTopRow(e,i){for(var r=[],n=0,a=0,s=!0;s;){let o=e[this.vDomTop],l;o&&a<this.vDomMaxRenderChain?(l=o.getHeight()||this.vDomRowHeight,i>=l?(this.vDomTop++,i-=l,n+=l,r.push(o),a++):s=!1):s=!1}for(let o of r){let l=o.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomTopPad+=n,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?n:n+this.vDomWindowBuffer)}_addBottomRow(e,i){for(var r=this.tableElement,n=[],a=0,s=this.vDomBottom+1,o=0,l=!0;l;){let c=e[s],u,d;c&&o<this.vDomMaxRenderChain?(u=c.getHeight()||this.vDomRowHeight,d=c.initialized,i>=u?(this.styleRow(c,s),r.appendChild(c.getElement()),(!c.initialized||!c.heightInitialized)&&n.push(c),c.initialize(),d||(u=c.getElement().offsetHeight,u>this.vDomWindowBuffer&&(this.vDomWindowBuffer=u*2)),i-=u,a+=u,this.vDomBottom++,s++,o++):l=!1):l=!1}for(let c of n)c.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomBottomPad-=a,(this.vDomBottomPad<0||s==e.length-1)&&(this.vDomBottomPad=0),r.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=a)}_removeBottomRow(e,i){for(var r=[],n=0,a=0,s=!0;s;){let o=e[this.vDomBottom],l;o&&a<this.vDomMaxRenderChain?(l=o.getHeight()||this.vDomRowHeight,i>=l?(this.vDomBottom--,i-=l,n+=l,r.push(o),a++):s=!1):s=!1}for(let o of r){let l=o.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomBottomPad+=n,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=n)}_quickNormalizeRowHeight(e){for(let i of e)i.calcHeight();for(let i of e)i.setCellHeight()}}class kft extends sc{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let i=document.createElement("div");if(i.classList.add("tabulator-placeholder"),typeof e=="string"){let r=document.createElement("div");r.classList.add("tabulator-placeholder-contents"),r.innerHTML=e,i.appendChild(r),this.placeholderContents=r}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(i.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=i}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,i=this.scrollLeft>e,r=this.element.scrollTop,n=this.scrollTop>r;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,i),this.dispatchExternal("scrollHorizontal",e,i),this._positionPlaceholder()),this.scrollTop!=r&&(this.scrollTop=r,this.renderer.scrollRows(r,n),this.dispatch("scroll-vertical",r,n),this.dispatchExternal("scrollVertical",r,n))})}findRow(e){if(typeof e=="object"){if(e instanceof gc)return e;if(e instanceof PH)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(r=>r.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(r=>r.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var i=this.rows.find(r=>r.data===e);return i||!1}getRowFromPosition(e){return this.getDisplayRows().find(i=>i.type==="row"&&i.getPosition()===e&&i.isDisplayed())}scrollToRow(e,i,r){return this.renderer.scrollToRowPosition(e,i,r)}setData(e,i,r){return new Promise((n,a)=>{i&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&r&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),n()})}_setDataActual(e,i){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((r,n)=>{if(r&&typeof r=="object"){var a=new gc(r,this);this.rows.push(a)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",r)}),this.refreshActiveData(!1,!1,i),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,i){var r=this.rows.indexOf(e),n=this.activeRows.indexOf(e);n>-1&&this.activeRows.splice(n,1),r>-1&&this.rows.splice(r,1),this.setActiveRows(this.activeRows),this.displayRowIterator(a=>{var s=a.indexOf(e);s>-1&&a.splice(s,1)}),i||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,i,r,n){var a=this.addRowActual(e,i,r,n);return a}addRows(e,i,r,n){var a=[];return new Promise((s,o)=>{i=this.findAddRowPos(i),Array.isArray(e)||(e=[e]),(typeof r>"u"&&i||typeof r<"u"&&!i)&&e.reverse(),e.forEach((l,c)=>{var u=this.addRow(l,i,r,!0);a.push(u),this.dispatch("row-added",u,l,i,r)}),this.refreshActiveData(n?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),s(a)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,i,r,n){var a=e instanceof gc?e:new gc(e||{},this),s=this.findAddRowPos(i),o=-1,l,c;return r||(c=this.chain("row-adding-position",[a,s],null,{index:r,top:s}),r=c.index,s=c.top),typeof r<"u"&&(r=this.findRow(r)),r=this.chain("row-adding-index",[a,r,s],null,r),r&&(o=this.rows.indexOf(r)),r&&o>-1?(l=this.activeRows.indexOf(r),this.displayRowIterator(function(u){var d=u.indexOf(r);d>-1&&u.splice(s?d:d+1,0,a)}),l>-1&&this.activeRows.splice(s?l:l+1,0,a),this.rows.splice(s?o:o+1,0,a)):s?(this.displayRowIterator(function(u){u.unshift(a)}),this.activeRows.unshift(a),this.rows.unshift(a)):(this.displayRowIterator(function(u){u.push(a)}),this.activeRows.push(a),this.rows.push(a)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",a.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),n||this.reRenderInPosition(),a}moveRow(e,i,r){this.dispatch("row-move",e,i,r),this.moveRowActual(e,i,r),this.regenerateRowPositions(),this.dispatch("row-moved",e,i,r),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,i,r){this.moveRowInArray(this.rows,e,i,r),this.moveRowInArray(this.activeRows,e,i,r),this.displayRowIterator(n=>{this.moveRowInArray(n,e,i,r)}),this.dispatch("row-moving",e,i,r)}moveRowInArray(e,i,r,n){var a,s,o,l;if(i!==r&&(a=e.indexOf(i),a>-1&&(e.splice(a,1),s=e.indexOf(r),s>-1?n?e.splice(s+1,0,i):e.splice(s,0,i):e.splice(a,0,i)),e===this.getDisplayRows())){o=a<s?a:s,l=s>a?s:a+1;for(let c=o;c<=l;c++)e[c]&&this.styleRow(e[c],c)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var i=this.getDisplayRows().indexOf(e);return i>-1?i:!1}nextDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r!==!1&&r<this.displayRowsCount-1&&(n=this.getDisplayRows()[r+1]),n&&(!(n instanceof gc)||n.type!="row")?this.nextDisplayRow(n,i):n}prevDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r&&(n=this.getDisplayRows()[r-1]),i&&n&&(!(n instanceof gc)||n.type!="row")?this.prevDisplayRow(n,i):n}findRowIndex(e,i){var r;return e=this.findRow(e),e&&(r=i.indexOf(e),r>-1)?r:!1}getData(e,i){var r=[],n=this.getRows(e);return n.forEach(function(a){a.type=="row"&&r.push(a.getData(i||"data"))}),r}getComponents(e){var i=[],r=this.getRows(e);return r.forEach(function(n){i.push(n.getComponent())}),i}getDataCount(e){var i=this.getRows(e);return i.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,i){typeof i<"u"?(this.dataPipeline.push({handler:e,priority:i}),this.dataPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,i){typeof i<"u"?(this.displayPipeline.push({handler:e,priority:i}),this.displayPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,i,r){var n=this.table,a="",s=0,o=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(s=this.dataPipeline.findIndex(l=>l.handler===e),s>-1)a="dataPipeline",i&&(s==this.dataPipeline.length-1?a="display":s++);else if(s=this.displayPipeline.findIndex(l=>l.handler===e),s>-1)a="displayPipeline",i&&(s==this.displayPipeline.length-1?a="end":s++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else a=e||"all",s=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===a&&s<this.redrawBlockRestoreConfig.index||o.indexOf(a)<o.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:i,renderInPosition:r,stage:a,index:s});return}else Ma.elVisible(this.element)?r?this.reRenderInPosition(this.refreshPipelines.bind(this,e,a,s,r)):(this.refreshPipelines(e,a,s,r),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),n.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,a,s,r),this.dispatch("data-refreshed")}}refreshPipelines(e,i,r,n){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),i){case"all":case"dataPipeline":for(let a=r;a<this.dataPipeline.length;a++){let s=this.dataPipeline[a].handler(this.activeRowsPipeline[a].slice(0));this.activeRowsPipeline[a+1]=s||this.activeRowsPipeline[a].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":r=0,this.resetDisplayRows();case"displayPipeline":for(let a=r;a<this.displayPipeline.length;a++){let s=this.displayPipeline[a].handler((a?this.getDisplayRows(a-1):this.activeRows).slice(0),n);this.setDisplayRows(s||this.getDisplayRows(a-1).slice(0),a)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),i=1;e.forEach(r=>{r.type==="row"&&(r.setPosition(i),i++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,i){this.displayRows[i]=e,i==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,i){var r=Object.assign([],this.renderer.visibleRows(!i));return e&&(r=this.chain("rows-visible",[i],r,r)),r}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var i=[];switch(e){case"active":i=this.activeRows;break;case"display":i=this.table.rowManager.getDisplayRows();break;case"visible":i=this.getVisibleRows(!1,!0);break;default:i=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return i}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,i={virtual:Bft,basic:Nft};typeof this.table.options.renderVertical=="string"?e=i[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}normalizeHeight(e){this.activeRows.forEach(function(i){i.normalizeHeight(e)})}adjustTableSize(){let e=this.element.clientHeight,i,r=!1;if(this.renderer.verticalFillMode==="fill"){let n=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){i=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const a="calc(100% - "+n+"px)";this.element.style.minHeight=i||"calc(100% - "+n+"px)",this.element.style.height=a,this.element.style.maxHeight=a}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-n+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(r=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),r}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class xft extends sc{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){this.table.options.footerElement&&(typeof this.table.options.footerElement==="string"?this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement)):this.element=this.table.options.footerElement)}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class _ft extends sc{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(i=>{e[i]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,i,r){this.pseudoTrackers[e].target!==r&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",i,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,i),this.pseudoTrackers[e].target=r,this.dispatch(e+"-mouseenter",i,r))}pseudoMouseLeave(e,i){var r=Object.keys(this.pseudoTrackers),n={row:["cell"],cell:["row"]};r=r.filter(a=>{var s=n[e];return a!==e&&(!s||s&&!s.includes(a))}),r.forEach(a=>{var s=this.pseudoTrackers[a].target;this.pseudoTrackers[a].target&&(this.dispatch(a+"-mouseleave",i,s),this.pseudoTrackers[a].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),i=Object.values(this.componentMap);for(let r of i)for(let n of e){let a=r+"-"+n;this.subscriptionChange(a,this.subscriptionChanged.bind(this,r,n))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,i,r){var n=this.listeners[i].components,a=n.indexOf(e),s=!1;r?a===-1&&(n.push(e),s=!0):this.subscribed(e+"-"+i)||a>-1&&(n.splice(a,1),s=!0),(i==="mouseenter"||i==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),s&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let i=this.listeners[e];i.components.length?i.handler||(i.handler=this.track.bind(this,e),this.el.addEventListener(e,i.handler)):i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}track(e,i){var r=i.composedPath&&i.composedPath()||i.path,n=this.findTargets(r);n=this.bindComponents(e,n),this.triggerEvents(e,i,n),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(n).length&&this.pseudoMouseLeave("none",i)}findTargets(e){var i={};let r=Object.keys(this.componentMap);for(let n of e){let a=n.classList?[...n.classList]:[];if(a.filter(l=>this.abortClasses.includes(l)).length)break;let o=a.filter(l=>r.includes(l));for(let l of o)i[this.componentMap[l]]||(i[this.componentMap[l]]=n)}return i.group&&i.group===i.row&&delete i.row,i}bindComponents(e,i){var r=Object.keys(i).reverse(),n=this.listeners[e],a={},s={},o={};for(let l of r){let c,u=i[l],d=this.previousTargets[l];if(d&&d.target===u)c=d.component;else switch(l){case"row":case"group":(n.components.includes("row")||n.components.includes("cell")||n.components.includes("group"))&&(c=this.table.rowManager.getVisibleRows(!0).find(f=>f.getElement()===u),i.row&&i.row.parentNode&&i.row.parentNode.closest(".tabulator-row")&&(i[l]=!1));break;case"column":n.components.includes("column")&&(c=this.table.columnManager.findColumn(u));break;case"cell":n.components.includes("cell")&&(a.row instanceof gc?c=a.row.findCell(u):i.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}c&&(a[l]=c,o[l]={target:u,component:c})}return this.previousTargets=o,Object.keys(i).forEach(l=>{let c=a[l];s[l]=c}),s}triggerEvents(e,i,r){var n=this.listeners[e];for(let a in r)r[a]&&n.components.includes(a)&&this.dispatch(a+"-"+e,i,r[a])}clearWatchers(){for(let e in this.listeners){let i=this.listeners[e];i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}}class Oft{constructor(e){this.table=e,this.bindings={}}bind(e,i,r){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][i]?console.warn("Unable to bind component handler, a matching function name is already bound",e,i,r):this.bindings[e][i]=r}handle(e,i,r){if(this.bindings[e]&&this.bindings[e][r]&&typeof this.bindings[e][r].bind=="function")return this.bindings[e][r].bind(null,i);r!=="then"&&typeof r=="string"&&!r.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+r+" function, have you checked that you have the correct Tabulator module installed?")}}class Fft extends sc{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,i,r,n,a,s){var o=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,i,r,a])){this.loading=!0,a||this.alertLoader(),i=this.chain("data-params",[e,r,a],i||{},i||{}),i=this.mapParams(i,this.table.options.dataSendParams);var l=this.chain("data-load",[e,i,r,a],!1,Promise.resolve([]));return l.then(c=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(c)&&typeof c=="object"&&(c=this.mapParams(c,this.objectInvert(this.table.options.dataReceiveParams)));var u=this.chain("data-loaded",[c],null,c);o==this.requestOrder?(this.clearAlert(),u!==!1&&(this.dispatchExternal("dataLoaded",u),this.table.rowManager.setData(u,n,typeof s>"u"?!n:s))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(c=>{console.error("Data Load Error: ",c),this.dispatchExternal("dataLoadError",c),a||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,n,typeof s>"u"?!n:s),Promise.resolve()}mapParams(e,i){var r={};for(let n in e)r[i.hasOwnProperty(n)?i[n]:n]=e[n];return r}objectInvert(e){var i={};for(let r in e)i[e[r]]=r;return i}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class Lft{constructor(e,i,r){this.table=e,this.events={},this.optionsList=i||{},this.subscriptionNotifiers={},this.dispatch=r?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=r}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e])if(i)if(r=this.events[e].findIndex(n=>n===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift(),r;return this.events[i]&&this.events[i].forEach((n,a)=>{let s=n.apply(this.table,e);a||(r=s)}),r}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}}class $ft{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i,r=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:i,priority:r}),this.events[e].sort((n,a)=>n.priority-a.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e]){if(i)if(r=this.events[e].findIndex(n=>n.callback===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,i,r,n){var a=r;return Array.isArray(i)||(i=[i]),this.subscribed(e)?(this.events[e].forEach((s,o)=>{a=s.callback.apply(this,i.concat([a]))}),a):typeof n=="function"?n():n}_confirm(e,i){var r=!1;return Array.isArray(i)||(i=[i]),this.subscribed(e)&&this.events[e].forEach((n,a)=>{n.callback.apply(this,i)&&(r=!0)}),r}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift();this.events[i]&&this.events[i].forEach(r=>{r.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._confirm(...arguments)}}class Hft extends sc{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,i,r){var n="";return typeof this.options(e)<"u"?(n="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",i?(n=n+", Please use the %c"+i+"%c option instead",this._warnUser(n,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),r&&(this.table.options[i]=this.table.options[e])):this._warnUser(n,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,i){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+i,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}class Vft extends sc{constructor(e){super(e),this.deps={},this.props={}}initialize(){this.deps=Object.assign({},this.options("dependencies"))}lookup(e,i,r){if(Array.isArray(e)){for(const a of e){var n=this.lookup(a,i,!0);if(n)break}if(n)return n;this.error(e)}else return i?this.lookupProp(e,i,r):this.lookupKey(e,r)}lookupProp(e,i,r){var n;if(this.props[e]&&this.props[e][i])return this.props[e][i];if(n=this.lookupKey(e,r),n)return this.props[e]||(this.props[e]={}),this.props[e][i]=n[i]||n,this.props[e][i]}lookupKey(e,i){var r;return this.deps[e]?r=this.deps[e]:window[e]?(this.deps[e]=window[e],r=this.deps[e]):i||this.error(e),r}error(e){console.error("Unable to find dependency",e,"Please check documentation and ensure you have imported the required library into your project")}}function Gft(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function nne(t,e){t.forEach(function(i){i.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function Qft(t,e){var i=0,r=this.table.rowManager.element.clientWidth,n=0,a=!1;t.forEach((s,o)=>{s.widthFixed||s.reinitializeWidth(),(this.table.options.responsiveLayout?s.modules.responsive.visible:s.visible)&&(a=s),s.visible&&(i+=s.getWidth())}),a?(n=r-i+a.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(a.setWidth(0),this.table.modules.responsiveLayout.update()),n>0?a.setWidth(n):a.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function jft(t,e){var i=this.table.rowManager.element.getBoundingClientRect().width,r=0,n=0,a=0,s=0,o=[],l=[],c=0,u=0,d=0;function p(h){var m;return typeof h=="string"?h.indexOf("%")>-1?m=i/100*parseInt(h):m=parseInt(h):m=h,m}function f(h,m,A,g){var v=[],b=0,y=0,I=0,w=a,S=0,T=0,D=[];function C(P){return A*(P.column.definition.widthGrow||1)}function E(P){return p(P.width)-A*(P.column.definition.widthShrink||0)}return h.forEach(function(P,R){var M=g?E(P):C(P);P.column.minWidth>=M?v.push(P):P.column.maxWidth&&P.column.maxWidth<M?(P.width=P.column.maxWidth,m-=P.column.maxWidth,w-=g?P.column.definition.widthShrink||1:P.column.definition.widthGrow||1,w&&(A=Math.floor(m/w))):(D.push(P),T+=g?P.column.definition.widthShrink||1:P.column.definition.widthGrow||1)}),v.length?(v.forEach(function(P){b+=g?P.width-P.column.minWidth:P.column.minWidth,P.width=P.column.minWidth}),y=m-b,I=T?Math.floor(y/T):y,S=f(D,y,I,g)):(S=T?m-Math.floor(m/T)*T:m,D.forEach(function(P){P.width=g?E(P):C(P)})),S}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(i-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(h){var m,A,g;h.visible&&(m=h.definition.width,A=parseInt(h.minWidth),m?(g=p(m),r+=g>A?g:A,h.definition.widthShrink&&(l.push({column:h,width:g>A?g:A}),c+=h.definition.widthShrink)):(o.push({column:h,width:0}),a+=h.definition.widthGrow||1))}),n=i-r,s=Math.floor(n/a),d=f(o,n,s,!1),o.length&&d>0&&(o[o.length-1].width+=d),o.forEach(function(h){n-=h.width}),u=Math.abs(d)+n,u>0&&c&&(d=f(l,u,Math.floor(u/c),!0)),d&&l.length&&(l[l.length-1].width-=d),o.forEach(function(h){h.column.setWidth(h.width)}),l.forEach(function(h){h.column.setWidth(h.width)})}var zft={fitData:Gft,fitDataFill:nne,fitDataTable:nne,fitDataStretch:Qft,fitColumns:jft};class cO extends Or{static moduleName="layout";static modes=zft;constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;cO.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){var i=this.table.columnManager.columnsByIndex.find(r=>r.definition.variableHeight||r.definition.formatter==="textarea");this.dispatch("layout-refreshing"),cO.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),i&&this.table.rowManager.normalizeHeight(!0),this.dispatch("layout-refreshed")}}var qft={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};class gZ extends Or{static moduleName="localize";static langs=qft;constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=Ma.deepClone(gZ.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,i){this.langList[e]?this._setLangProp(this.langList[e],i):this.langList[e]=i}_setLangProp(e,i){for(let r in i)e[r]&&typeof e[r]=="object"?this._setLangProp(e[r],i[r]):e[r]=i[r]}setLocale(e){e=e||"default";function i(r,n){for(var a in r)typeof r[a]=="object"?(n[a]||(n[a]={}),i(r[a],n[a])):n[a]=r[a]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let r=e.split("-")[0];this.langList[r]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,r),e=r):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=Ma.deepClone(this.langList.default||{}),e!="default"&&i(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,i){var r=i?e+"|"+i:e,n=r.split("|"),a=this._getLangElement(n,this.locale);return a||""}_getLangElement(e,i){var r=this.lang;return e.forEach(function(n){var a;r&&(a=r[n],typeof a<"u"?r=a:r=!1)}),r}bind(e,i){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(i),i(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(i=>{i(this.getText(e),this.lang)})}}class Wft extends Or{static moduleName="comms";constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var i=[],r;return r=this.table.constructor.registry.lookupTable(e),r.forEach(n=>{this.table!==n&&i.push(n)}),i}send(e,i,r,n){var a=this.getConnections(e);a.forEach(s=>{s.tableComms(this.table.element,i,r,n)}),!a.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,i,r,n){if(this.table.modExists(i))return this.table.modules[i].commsReceived(e,r,n);console.warn("Inter-table Comms Error - no such module:",i)}}var Kft=Object.freeze({__proto__:null,CommsModule:Wft,LayoutModule:cO,LocalizeModule:gZ});class Dp{static registry={tables:[],register(e){Dp.registry.tables.push(e)},deregister(e){var i=Dp.registry.tables.indexOf(e);i>-1&&Dp.registry.tables.splice(i,1)},lookupTable(e,i){var r=[],n,a;if(typeof e=="string"){if(n=document.querySelectorAll(e),n.length)for(var s=0;s<n.length;s++)a=Dp.registry.matchElement(n[s]),a&&r.push(a)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof Dp?(a=Dp.registry.matchElement(e),a&&r.push(a)):Array.isArray(e)?e.forEach(function(o){r=r.concat(Dp.registry.lookupTable(o))}):i||console.warn("Table Connection Error - Invalid Selector",e);return r},matchElement(e){return Dp.registry.tables.find(function(i){return e instanceof Dp?i===e:i.element===e})}};static findTable(e){var i=Dp.registry.lookupTable(e,!0);return Array.isArray(i)&&!i.length?!1:i}}class ps extends Dp{static moduleBindings={};static moduleExtensions={};static modulesRegistered=!1;static defaultModules=!1;constructor(){super()}static initializeModuleBinder(e){ps.modulesRegistered||(ps.modulesRegistered=!0,ps._registerModules(Kft,!0),e&&ps._registerModules(e))}static _extendModule(e,i,r){if(ps.moduleBindings[e]){var n=ps.moduleBindings[e][i];if(n)if(typeof r=="object")for(let a in r)n[a]=r[a];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",i)}else console.warn("Module Error - module does not exist:",e)}static _registerModules(e,i){var r=Object.values(e);i&&r.forEach(n=>{n.prototype.moduleCore=!0}),ps._registerModule(r)}static _registerModule(e){Array.isArray(e)||(e=[e]),e.forEach(i=>{ps._registerModuleBinding(i),ps._registerModuleExtensions(i)})}static _registerModuleBinding(e){e.moduleName?ps.moduleBindings[e.moduleName]=e:console.error("Unable to bind module, no moduleName defined",e.moduleName)}static _registerModuleExtensions(e){var i=e.moduleExtensions;if(e.moduleExtensions)for(let r in i){let n=i[r];if(ps.moduleBindings[r])for(let a in n)ps._extendModule(r,a,n[a]);else{ps.moduleExtensions[r]||(ps.moduleExtensions[r]={});for(let a in n)ps.moduleExtensions[r][a]||(ps.moduleExtensions[r][a]={}),Object.assign(ps.moduleExtensions[r][a],n[a])}}ps._extendModuleFromQueue(e)}static _extendModuleFromQueue(e){var i=ps.moduleExtensions[e.moduleName];if(i)for(let r in i)ps._extendModule(e.moduleName,r,i[r])}_bindModules(){var e=[],i=[],r=[];this.modules={};for(var n in ps.moduleBindings){let a=ps.moduleBindings[n],s=new a(this);this.modules[n]=s,a.prototype.moduleCore?this.modulesCore.push(s):a.moduleInitOrder?a.moduleInitOrder<0?e.push(s):i.push(s):r.push(s)}e.sort((a,s)=>a.moduleInitOrder>s.moduleInitOrder?1:-1),i.sort((a,s)=>a.moduleInitOrder>s.moduleInitOrder?1:-1),this.modulesRegular=e.concat(r.concat(i))}}class Yft extends sc{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,i="msg"){if(e){for(this.clear(),this.dispatch("alert-show",i),this.type=i;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}class Fv extends ps{static defaultOptions=Dft;static extendModule(){Fv.initializeModuleBinder(),Fv._extendModule(...arguments)}static registerModule(){Fv.initializeModuleBinder(),Fv._registerModule(...arguments)}constructor(e,i,r){super(),Fv.initializeModuleBinder(r),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new Oft(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new Hft(this),this.optionsList=new mMe(this,"table constructor"),this.dependencyRegistry=new Vft(this),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(i),setTimeout(()=>{this._create()})),this.constructor.registry.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new Mft(this),this.rowManager=new kft(this),this.footerManager=new xft(this),this.dataLoader=new Fft(this),this.alertManager=new Yft(this),this._bindModules(),this.options=this.optionsList.generate(Fv.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new Lft(this,this.options,this.options.debugEventsExternal),this.eventBus=new $ft(this.options.debugEventsInternal),this.interactionMonitor=new _ft(this),this.dataLoader.initialize(),this.footerManager.initialize(),this.dependencyRegistry.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this.initialized=!0,this._loadInitialData().finally(()=>{this.eventBus.dispatch("table-initialized"),this.externalEvents.dispatch("tableBuilt")})}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,i=this.options,r;if(e.tagName==="TABLE"){this.originalElement=this.element,r=document.createElement("div");var n=e.attributes;for(var a in n)typeof n[a]=="object"&&r.setAttribute(n[a].name,n[a].value);e.parentNode.replaceChild(r,e),this.element=e=r}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),i.minHeight!==!1&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),i.maxHeight!==!1&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var e=this.element,i=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(r=>{r.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),i.footerElement&&this.footerManager.activate(),i.autoColumns&&i.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(r=>{r.initialize()}),this.columnManager.setColumns(i.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){return this.dataLoader.load(this.options.data).finally(()=>{this.columnManager.verticalAlignHeaders()})}destroy(){var e=this.element;for(this.destroyed=!0,this.constructor.registry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,i){var r,n;return this.options.debugInitialization&&!this.initialized&&(e||(r=new Error().stack.split(`
`),n=r[0]=="Error"?r[2]:r[1],n[0]==" "?e=n.trim().split(" ")[1].split(".")[1]:e=n.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(i?" "+i:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,i,r){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,i,r,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,i,r){return this.initGuard(),this.dataLoader.load(e,i,r,!0,!0)}updateData(e){var i=0;return this.initGuard(),new Promise((r,n)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(a=>{var s=this.rowManager.findRow(a[this.options.index]);s?(i++,s.updateData(a).then(()=>{i--,i||r()}).catch(o=>{n("Update Error - Unable to update row",a,o)})):n("Update Error - Unable to find row",a)}):(console.warn("Update Error - No data provided"),n("Update Error - No data provided"))})}addData(e,i,r){return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,i,r).then(s=>{var o=[];s.forEach(function(l){o.push(l.getComponent())}),n(o)}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}updateOrAddData(e){var i=[],r=0;return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(s=>{var o=this.rowManager.findRow(s[this.options.index]);r++,o?o.updateData(s).then(()=>{r--,i.push(o.getComponent()),r||n(i)}):this.rowManager.addRows(s).then(l=>{r--,i.push(l[0].getComponent()),r||n(i)})}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}getRow(e){var i=this.rowManager.findRow(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var i=this.rowManager.getRowFromPosition(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var i=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let r of e){let n=this.rowManager.findRow(r,!0);if(n)i.push(n);else return console.error("Delete Error - No matching row found:",r),Promise.reject("Delete Error - No matching row found")}return i.sort((r,n)=>this.rowManager.rows.indexOf(r)>this.rowManager.rows.indexOf(n)?1:-1),i.forEach(r=>{r.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,i,r){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,i,r,!0).then(n=>n[0].getComponent())}updateOrAddRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>r.getComponent()):this.rowManager.addRows(i).then(n=>n[0].getComponent())}updateRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>Promise.resolve(r.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,i,r){var n=this.rowManager.findRow(e);return n?this.rowManager.scrollToRow(n,i,r):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,i,r){var n=this.rowManager.findRow(e);this.initGuard(),n?n.moveToRow(i,r):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var i=this.rowManager.findRow(e);return i?i.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var i=this.columnManager.findColumn(e);return i?i.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.visible?i.hide():i.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,i,r){var n=this.columnManager.findColumn(r);return this.initGuard(),this.columnManager.addColumn(e,i,n).then(a=>a.getComponent())}deleteColumn(e){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,i){var r=this.columnManager.findColumn(e);return this.initGuard(),r?r.updateDefinition(i):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,i,r){var n=this.columnManager.findColumn(e),a=this.columnManager.findColumn(i);this.initGuard(),n?a?this.columnManager.moveColumn(n,a,r):console.warn("Move Error - No matching column found:",a):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,i,r){return new Promise((n,a)=>{var s=this.columnManager.findColumn(e);return s?this.columnManager.scrollToColumn(s,i,r):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(e,i){this.externalEvents.subscribe(e,i)}off(e,i){this.externalEvents.unsubscribe(e,i)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,i){this.initGuard(),this.alertManager.alert(e,i)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,i){return this.modules[e]?!0:(i&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var i=this.modules[e];return i||console.error("Tabulator module not installed: "+e),i}}var dD=Fv;class Xft extends dD{static extendModule(){dD.initializeModuleBinder(MG),dD._extendModule(...arguments)}static registerModule(){dD.initializeModuleBinder(MG),dD._registerModule(...arguments)}constructor(e,i,r){super(e,i,MG)}}var es=Xft;const{MALE:Zft,FEMALE:Jft}=Fh;function eht(t){const e=t.getValue(),i=t.getRow().getData(),r=i.sex||i.person?.sex,n=r?.toUpperCase()===Zft&&"#2E86C1"||r?.toUpperCase()===Jft&&"#AA336A"||"",a=document.createElement("div");return a.style.color=n,a.innerHTML=e,a}function tht(t){return[{visible:t.some(i=>i.drawPosition),field:"drawPosition",title:"Position",headerSort:!1,responsive:!1,editor:!1,maxWidth:100},{formatter:eht,field:"participantName",title:"Participant",responsive:!1,minWidth:200,widthGrow:2}]}function AMe(t){let{data:e=[]}=t;const{selectedParticipantIds:i,selectionLimit:r=1,targetAttribute:n,placeholder:a,onSelected:s,anchorId:o}=t;e.some(p=>p.participant)&&(e=e.map(({participant:p,...f})=>({...f,participantName:"BYE",...p}))),e.forEach(p=>p.searchText=p.participantName?.toLowerCase());const c=tht(e),u=document.getElementById(o),d=new es(u,{placeholder:a||"No options",selectableRows:r,index:n,layout:"fitColumns",reactiveData:!0,maxHeight:350,columns:c,data:e});return ot.tables||(ot.tables=[]),ot.tables.selectionTable||(ot.tables={...ot.tables,selectionTable:d}),d.on("tableBuilt",()=>{i?.length&&d.selectRow(i)}),d.on("rowSelectionChanged",(p,f)=>{const h=f?.map(m=>m.getData());Mt(s)&&s?.(h)}),u?.addEventListener("mousedown",p=>{p.preventDefault()}),{table:d}}function vZ(t){const{title:e,placeholder:i,options:r,selectionLimit:n}=t,a="selectionControl",s="selectionTable",o=[{label:"Cancel",intent:"is-none",close:!0}],l=()=>{ot.tables.selectionTable?.destroy(),delete ot.tables.selectionTable},c=`
    <div style='min-height: 420px'>
      <div id='${a}'></div>
      <div id='${s}'></div>
    </div>
  `;Jr({title:e,content:c,buttons:o,onClose:l});const u=m=>{m?.[0]?.onClick&&(m[0].onClick(),Wy())},{table:d}=AMe({targetAttribute:"participantid",selectionLimit:n,data:r,placeholder:i,onSelected:u,anchorId:s}),p=DS(d),f=[{onKeyDown:m=>m.keyCode===8&&m.target.value.length===1&&p(""),onChange:m=>p(m.target.value),onKeyUp:m=>p(m.target.value),clearSearch:()=>p(""),placeholder:"Search",location:ii,search:!0}],h=document.getElementById(a)||void 0;eo({table:d,target:h,items:f})}var hd="top",Sf="bottom",Uf="right",md="left",yZ="auto",EN=[hd,Sf,Uf,md],pC="start",d1="end",iht="clippingParents",gMe="viewport",pD="popper",rht="reference",ane=EN.reduce(function(t,e){return t.concat([e+"-"+pC,e+"-"+d1])},[]),vMe=[].concat(EN,[yZ]).reduce(function(t,e){return t.concat([e,e+"-"+pC,e+"-"+d1])},[]),nht="beforeRead",aht="read",sht="afterRead",oht="beforeMain",lht="main",cht="afterMain",uht="beforeWrite",dht="write",pht="afterWrite",fht=[nht,aht,sht,oht,lht,cht,uht,dht,pht];function tA(t){return t?(t.nodeName||"").toLowerCase():null}function pp(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function hw(t){var e=pp(t).Element;return t instanceof e||t instanceof Element}function Jp(t){var e=pp(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function bZ(t){if(typeof ShadowRoot>"u")return!1;var e=pp(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function hht(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var r=e.styles[i]||{},n=e.attributes[i]||{},a=e.elements[i];!Jp(a)||!tA(a)||(Object.assign(a.style,r),Object.keys(n).forEach(function(s){var o=n[s];o===!1?a.removeAttribute(s):a.setAttribute(s,o===!0?"":o)}))})}function mht(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(r){var n=e.elements[r],a=e.attributes[r]||{},s=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:i[r]),o=s.reduce(function(l,c){return l[c]="",l},{});!Jp(n)||!tA(n)||(Object.assign(n.style,o),Object.keys(a).forEach(function(l){n.removeAttribute(l)}))})}}const yMe={name:"applyStyles",enabled:!0,phase:"write",fn:hht,effect:mht,requires:["computeStyles"]};function Em(t){return t.split("-")[0]}var xI=Math.max,uO=Math.min,fC=Math.round;function R3(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function bMe(){return!/^((?!chrome|android).)*safari/i.test(R3())}function hC(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var r=t.getBoundingClientRect(),n=1,a=1;e&&Jp(t)&&(n=t.offsetWidth>0&&fC(r.width)/t.offsetWidth||1,a=t.offsetHeight>0&&fC(r.height)/t.offsetHeight||1);var s=hw(t)?pp(t):window,o=s.visualViewport,l=!bMe()&&i,c=(r.left+(l&&o?o.offsetLeft:0))/n,u=(r.top+(l&&o?o.offsetTop:0))/a,d=r.width/n,p=r.height/a;return{width:d,height:p,top:u,right:c+d,bottom:u+p,left:c,x:c,y:u}}function IZ(t){var e=hC(t),i=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:r}}function IMe(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&bZ(i)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Ng(t){return pp(t).getComputedStyle(t)}function Aht(t){return["table","td","th"].indexOf(tA(t))>=0}function Nb(t){return((hw(t)?t.ownerDocument:t.document)||window.document).documentElement}function NH(t){return tA(t)==="html"?t:t.assignedSlot||t.parentNode||(bZ(t)?t.host:null)||Nb(t)}function sne(t){return!Jp(t)||Ng(t).position==="fixed"?null:t.offsetParent}function ght(t){var e=/firefox/i.test(R3()),i=/Trident/i.test(R3());if(i&&Jp(t)){var r=Ng(t);if(r.position==="fixed")return null}var n=NH(t);for(bZ(n)&&(n=n.host);Jp(n)&&["html","body"].indexOf(tA(n))<0;){var a=Ng(n);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return n;n=n.parentNode}return null}function DN(t){for(var e=pp(t),i=sne(t);i&&Aht(i)&&Ng(i).position==="static";)i=sne(i);return i&&(tA(i)==="html"||tA(i)==="body"&&Ng(i).position==="static")?e:i||ght(t)||e}function wZ(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function M0(t,e,i){return xI(t,uO(e,i))}function vht(t,e,i){var r=M0(t,e,i);return r>i?i:r}function wMe(){return{top:0,right:0,bottom:0,left:0}}function SMe(t){return Object.assign({},wMe(),t)}function UMe(t,e){return e.reduce(function(i,r){return i[r]=t,i},{})}var yht=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,SMe(typeof e!="number"?e:UMe(e,EN))};function bht(t){var e,i=t.state,r=t.name,n=t.options,a=i.elements.arrow,s=i.modifiersData.popperOffsets,o=Em(i.placement),l=wZ(o),c=[md,Uf].indexOf(o)>=0,u=c?"height":"width";if(!(!a||!s)){var d=yht(n.padding,i),p=IZ(a),f=l==="y"?hd:md,h=l==="y"?Sf:Uf,m=i.rects.reference[u]+i.rects.reference[l]-s[l]-i.rects.popper[u],A=s[l]-i.rects.reference[l],g=DN(a),v=g?l==="y"?g.clientHeight||0:g.clientWidth||0:0,b=m/2-A/2,y=d[f],I=v-p[u]-d[h],w=v/2-p[u]/2+b,S=M0(y,w,I),T=l;i.modifiersData[r]=(e={},e[T]=S,e.centerOffset=S-w,e)}}function Iht(t){var e=t.state,i=t.options,r=i.element,n=r===void 0?"[data-popper-arrow]":r;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||IMe(e.elements.popper,n)&&(e.elements.arrow=n))}const wht={name:"arrow",enabled:!0,phase:"main",fn:bht,effect:Iht,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function mC(t){return t.split("-")[1]}var Sht={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Uht(t,e){var i=t.x,r=t.y,n=e.devicePixelRatio||1;return{x:fC(i*n)/n||0,y:fC(r*n)/n||0}}function one(t){var e,i=t.popper,r=t.popperRect,n=t.placement,a=t.variation,s=t.offsets,o=t.position,l=t.gpuAcceleration,c=t.adaptive,u=t.roundOffsets,d=t.isFixed,p=s.x,f=p===void 0?0:p,h=s.y,m=h===void 0?0:h,A=typeof u=="function"?u({x:f,y:m}):{x:f,y:m};f=A.x,m=A.y;var g=s.hasOwnProperty("x"),v=s.hasOwnProperty("y"),b=md,y=hd,I=window;if(c){var w=DN(i),S="clientHeight",T="clientWidth";if(w===pp(i)&&(w=Nb(i),Ng(w).position!=="static"&&o==="absolute"&&(S="scrollHeight",T="scrollWidth")),w=w,n===hd||(n===md||n===Uf)&&a===d1){y=Sf;var D=d&&w===I&&I.visualViewport?I.visualViewport.height:w[S];m-=D-r.height,m*=l?1:-1}if(n===md||(n===hd||n===Sf)&&a===d1){b=Uf;var C=d&&w===I&&I.visualViewport?I.visualViewport.width:w[T];f-=C-r.width,f*=l?1:-1}}var E=Object.assign({position:o},c&&Sht),P=u===!0?Uht({x:f,y:m},pp(i)):{x:f,y:m};if(f=P.x,m=P.y,l){var R;return Object.assign({},E,(R={},R[y]=v?"0":"",R[b]=g?"0":"",R.transform=(I.devicePixelRatio||1)<=1?"translate("+f+"px, "+m+"px)":"translate3d("+f+"px, "+m+"px, 0)",R))}return Object.assign({},E,(e={},e[y]=v?m+"px":"",e[b]=g?f+"px":"",e.transform="",e))}function Tht(t){var e=t.state,i=t.options,r=i.gpuAcceleration,n=r===void 0?!0:r,a=i.adaptive,s=a===void 0?!0:a,o=i.roundOffsets,l=o===void 0?!0:o,c={placement:Em(e.placement),variation:mC(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,one(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,one(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const Cht={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Tht,data:{}};var IB={passive:!0};function Eht(t){var e=t.state,i=t.instance,r=t.options,n=r.scroll,a=n===void 0?!0:n,s=r.resize,o=s===void 0?!0:s,l=pp(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&c.forEach(function(u){u.addEventListener("scroll",i.update,IB)}),o&&l.addEventListener("resize",i.update,IB),function(){a&&c.forEach(function(u){u.removeEventListener("scroll",i.update,IB)}),o&&l.removeEventListener("resize",i.update,IB)}}const Dht={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Eht,data:{}};var Pht={left:"right",right:"left",bottom:"top",top:"bottom"};function ax(t){return t.replace(/left|right|bottom|top/g,function(e){return Pht[e]})}var Rht={start:"end",end:"start"};function lne(t){return t.replace(/start|end/g,function(e){return Rht[e]})}function SZ(t){var e=pp(t),i=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:i,scrollTop:r}}function UZ(t){return hC(Nb(t)).left+SZ(t).scrollLeft}function Mht(t,e){var i=pp(t),r=Nb(t),n=i.visualViewport,a=r.clientWidth,s=r.clientHeight,o=0,l=0;if(n){a=n.width,s=n.height;var c=bMe();(c||!c&&e==="fixed")&&(o=n.offsetLeft,l=n.offsetTop)}return{width:a,height:s,x:o+UZ(t),y:l}}function Nht(t){var e,i=Nb(t),r=SZ(t),n=(e=t.ownerDocument)==null?void 0:e.body,a=xI(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),s=xI(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),o=-r.scrollLeft+UZ(t),l=-r.scrollTop;return Ng(n||i).direction==="rtl"&&(o+=xI(i.clientWidth,n?n.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}function TZ(t){var e=Ng(t),i=e.overflow,r=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+r)}function TMe(t){return["html","body","#document"].indexOf(tA(t))>=0?t.ownerDocument.body:Jp(t)&&TZ(t)?t:TMe(NH(t))}function N0(t,e){var i;e===void 0&&(e=[]);var r=TMe(t),n=r===((i=t.ownerDocument)==null?void 0:i.body),a=pp(r),s=n?[a].concat(a.visualViewport||[],TZ(r)?r:[]):r,o=e.concat(s);return n?o:o.concat(N0(NH(s)))}function M3(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function Bht(t,e){var i=hC(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function cne(t,e,i){return e===gMe?M3(Mht(t,i)):hw(e)?Bht(e,i):M3(Nht(Nb(t)))}function kht(t){var e=N0(NH(t)),i=["absolute","fixed"].indexOf(Ng(t).position)>=0,r=i&&Jp(t)?DN(t):t;return hw(r)?e.filter(function(n){return hw(n)&&IMe(n,r)&&tA(n)!=="body"}):[]}function xht(t,e,i,r){var n=e==="clippingParents"?kht(t):[].concat(e),a=[].concat(n,[i]),s=a[0],o=a.reduce(function(l,c){var u=cne(t,c,r);return l.top=xI(u.top,l.top),l.right=uO(u.right,l.right),l.bottom=uO(u.bottom,l.bottom),l.left=xI(u.left,l.left),l},cne(t,s,r));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function CMe(t){var e=t.reference,i=t.element,r=t.placement,n=r?Em(r):null,a=r?mC(r):null,s=e.x+e.width/2-i.width/2,o=e.y+e.height/2-i.height/2,l;switch(n){case hd:l={x:s,y:e.y-i.height};break;case Sf:l={x:s,y:e.y+e.height};break;case Uf:l={x:e.x+e.width,y:o};break;case md:l={x:e.x-i.width,y:o};break;default:l={x:e.x,y:e.y}}var c=n?wZ(n):null;if(c!=null){var u=c==="y"?"height":"width";switch(a){case pC:l[c]=l[c]-(e[u]/2-i[u]/2);break;case d1:l[c]=l[c]+(e[u]/2-i[u]/2);break}}return l}function p1(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=r===void 0?t.placement:r,a=i.strategy,s=a===void 0?t.strategy:a,o=i.boundary,l=o===void 0?iht:o,c=i.rootBoundary,u=c===void 0?gMe:c,d=i.elementContext,p=d===void 0?pD:d,f=i.altBoundary,h=f===void 0?!1:f,m=i.padding,A=m===void 0?0:m,g=SMe(typeof A!="number"?A:UMe(A,EN)),v=p===pD?rht:pD,b=t.rects.popper,y=t.elements[h?v:p],I=xht(hw(y)?y:y.contextElement||Nb(t.elements.popper),l,u,s),w=hC(t.elements.reference),S=CMe({reference:w,element:b,placement:n}),T=M3(Object.assign({},b,S)),D=p===pD?T:w,C={top:I.top-D.top+g.top,bottom:D.bottom-I.bottom+g.bottom,left:I.left-D.left+g.left,right:D.right-I.right+g.right},E=t.modifiersData.offset;if(p===pD&&E){var P=E[n];Object.keys(C).forEach(function(R){var M=[Uf,Sf].indexOf(R)>=0?1:-1,N=[hd,Sf].indexOf(R)>=0?"y":"x";C[R]+=P[N]*M})}return C}function _ht(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=i.boundary,a=i.rootBoundary,s=i.padding,o=i.flipVariations,l=i.allowedAutoPlacements,c=l===void 0?vMe:l,u=mC(r),d=u?o?ane:ane.filter(function(h){return mC(h)===u}):EN,p=d.filter(function(h){return c.indexOf(h)>=0});p.length===0&&(p=d);var f=p.reduce(function(h,m){return h[m]=p1(t,{placement:m,boundary:n,rootBoundary:a,padding:s})[Em(m)],h},{});return Object.keys(f).sort(function(h,m){return f[h]-f[m]})}function Oht(t){if(Em(t)===yZ)return[];var e=ax(t);return[lne(t),e,lne(e)]}function Fht(t){var e=t.state,i=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!0:s,l=i.fallbackPlacements,c=i.padding,u=i.boundary,d=i.rootBoundary,p=i.altBoundary,f=i.flipVariations,h=f===void 0?!0:f,m=i.allowedAutoPlacements,A=e.options.placement,g=Em(A),v=g===A,b=l||(v||!h?[ax(A)]:Oht(A)),y=[A].concat(b).reduce(function(Q,j){return Q.concat(Em(j)===yZ?_ht(e,{placement:j,boundary:u,rootBoundary:d,padding:c,flipVariations:h,allowedAutoPlacements:m}):j)},[]),I=e.rects.reference,w=e.rects.popper,S=new Map,T=!0,D=y[0],C=0;C<y.length;C++){var E=y[C],P=Em(E),R=mC(E)===pC,M=[hd,Sf].indexOf(P)>=0,N=M?"width":"height",k=p1(e,{placement:E,boundary:u,rootBoundary:d,altBoundary:p,padding:c}),O=M?R?Uf:md:R?Sf:hd;I[N]>w[N]&&(O=ax(O));var x=ax(O),F=[];if(a&&F.push(k[P]<=0),o&&F.push(k[O]<=0,k[x]<=0),F.every(function(Q){return Q})){D=E,T=!1;break}S.set(E,F)}if(T)for(var _=h?3:1,V=function(j){var W=y.find(function(Y){var X=S.get(Y);if(X)return X.slice(0,j).every(function(J){return J})});if(W)return D=W,"break"},G=_;G>0;G--){var z=V(G);if(z==="break")break}e.placement!==D&&(e.modifiersData[r]._skip=!0,e.placement=D,e.reset=!0)}}const Lht={name:"flip",enabled:!0,phase:"main",fn:Fht,requiresIfExists:["offset"],data:{_skip:!1}};function une(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function dne(t){return[hd,Uf,Sf,md].some(function(e){return t[e]>=0})}function $ht(t){var e=t.state,i=t.name,r=e.rects.reference,n=e.rects.popper,a=e.modifiersData.preventOverflow,s=p1(e,{elementContext:"reference"}),o=p1(e,{altBoundary:!0}),l=une(s,r),c=une(o,n,a),u=dne(l),d=dne(c);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}const Hht={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:$ht};function Vht(t,e,i){var r=Em(t),n=[md,hd].indexOf(r)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,s=a[0],o=a[1];return s=s||0,o=(o||0)*n,[md,Uf].indexOf(r)>=0?{x:o,y:s}:{x:s,y:o}}function Ght(t){var e=t.state,i=t.options,r=t.name,n=i.offset,a=n===void 0?[0,0]:n,s=vMe.reduce(function(u,d){return u[d]=Vht(d,e.rects,a),u},{}),o=s[e.placement],l=o.x,c=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[r]=s}const Qht={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Ght};function jht(t){var e=t.state,i=t.name;e.modifiersData[i]=CMe({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const zht={name:"popperOffsets",enabled:!0,phase:"read",fn:jht,data:{}};function qht(t){return t==="x"?"y":"x"}function Wht(t){var e=t.state,i=t.options,r=t.name,n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!1:s,l=i.boundary,c=i.rootBoundary,u=i.altBoundary,d=i.padding,p=i.tether,f=p===void 0?!0:p,h=i.tetherOffset,m=h===void 0?0:h,A=p1(e,{boundary:l,rootBoundary:c,padding:d,altBoundary:u}),g=Em(e.placement),v=mC(e.placement),b=!v,y=wZ(g),I=qht(y),w=e.modifiersData.popperOffsets,S=e.rects.reference,T=e.rects.popper,D=typeof m=="function"?m(Object.assign({},e.rects,{placement:e.placement})):m,C=typeof D=="number"?{mainAxis:D,altAxis:D}:Object.assign({mainAxis:0,altAxis:0},D),E=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,P={x:0,y:0};if(w){if(a){var R,M=y==="y"?hd:md,N=y==="y"?Sf:Uf,k=y==="y"?"height":"width",O=w[y],x=O+A[M],F=O-A[N],_=f?-T[k]/2:0,V=v===pC?S[k]:T[k],G=v===pC?-T[k]:-S[k],z=e.elements.arrow,Q=f&&z?IZ(z):{width:0,height:0},j=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:wMe(),W=j[M],Y=j[N],X=M0(0,S[k],Q[k]),J=b?S[k]/2-_-X-W-C.mainAxis:V-X-W-C.mainAxis,ie=b?-S[k]/2+_+X+Y+C.mainAxis:G+X+Y+C.mainAxis,ue=e.elements.arrow&&DN(e.elements.arrow),ne=ue?y==="y"?ue.clientTop||0:ue.clientLeft||0:0,ge=(R=E?.[y])!=null?R:0,he=O+J-ge-ne,Ie=O+ie-ge,xe=M0(f?uO(x,he):x,O,f?xI(F,Ie):F);w[y]=xe,P[y]=xe-O}if(o){var Je,qe=y==="x"?hd:md,dt=y==="x"?Sf:Uf,ft=w[I],je=I==="y"?"height":"width",Tt=ft+A[qe],Oe=ft-A[dt],mt=[hd,md].indexOf(g)!==-1,Le=(Je=E?.[I])!=null?Je:0,lt=mt?Tt:ft-S[je]-T[je]-Le+C.altAxis,it=mt?ft+S[je]+T[je]-Le-C.altAxis:Oe,Fe=f&&mt?vht(lt,ft,it):M0(f?lt:Tt,ft,f?it:Oe);w[I]=Fe,P[I]=Fe-ft}e.modifiersData[r]=P}}const Kht={name:"preventOverflow",enabled:!0,phase:"main",fn:Wht,requiresIfExists:["offset"]};function Yht(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function Xht(t){return t===pp(t)||!Jp(t)?SZ(t):Yht(t)}function Zht(t){var e=t.getBoundingClientRect(),i=fC(e.width)/t.offsetWidth||1,r=fC(e.height)/t.offsetHeight||1;return i!==1||r!==1}function Jht(t,e,i){i===void 0&&(i=!1);var r=Jp(e),n=Jp(e)&&Zht(e),a=Nb(e),s=hC(t,n,i),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!i)&&((tA(e)!=="body"||TZ(a))&&(o=Xht(e)),Jp(e)?(l=hC(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=UZ(a))),{x:s.left+o.scrollLeft-l.x,y:s.top+o.scrollTop-l.y,width:s.width,height:s.height}}function emt(t){var e=new Map,i=new Set,r=[];t.forEach(function(a){e.set(a.name,a)});function n(a){i.add(a.name);var s=[].concat(a.requires||[],a.requiresIfExists||[]);s.forEach(function(o){if(!i.has(o)){var l=e.get(o);l&&n(l)}}),r.push(a)}return t.forEach(function(a){i.has(a.name)||n(a)}),r}function tmt(t){var e=emt(t);return fht.reduce(function(i,r){return i.concat(e.filter(function(n){return n.phase===r}))},[])}function imt(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function rmt(t){var e=t.reduce(function(i,r){var n=i[r.name];return i[r.name]=n?Object.assign({},n,r,{options:Object.assign({},n.options,r.options),data:Object.assign({},n.data,r.data)}):r,i},{});return Object.keys(e).map(function(i){return e[i]})}var pne={placement:"bottom",modifiers:[],strategy:"absolute"};function fne(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function nmt(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,r=i===void 0?[]:i,n=e.defaultOptions,a=n===void 0?pne:n;return function(o,l,c){c===void 0&&(c=a);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},pne,a),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},d=[],p=!1,f={state:u,setOptions:function(g){var v=typeof g=="function"?g(u.options):g;m(),u.options=Object.assign({},a,u.options,v),u.scrollParents={reference:hw(o)?N0(o):o.contextElement?N0(o.contextElement):[],popper:N0(l)};var b=tmt(rmt([].concat(r,u.options.modifiers)));return u.orderedModifiers=b.filter(function(y){return y.enabled}),h(),f.update()},forceUpdate:function(){if(!p){var g=u.elements,v=g.reference,b=g.popper;if(fne(v,b)){u.rects={reference:Jht(v,DN(b),u.options.strategy==="fixed"),popper:IZ(b)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(C){return u.modifiersData[C.name]=Object.assign({},C.data)});for(var y=0;y<u.orderedModifiers.length;y++){if(u.reset===!0){u.reset=!1,y=-1;continue}var I=u.orderedModifiers[y],w=I.fn,S=I.options,T=S===void 0?{}:S,D=I.name;typeof w=="function"&&(u=w({state:u,options:T,name:D,instance:f})||u)}}}},update:imt(function(){return new Promise(function(A){f.forceUpdate(),A(u)})}),destroy:function(){m(),p=!0}};if(!fne(o,l))return f;f.setOptions(c).then(function(A){!p&&c.onFirstUpdate&&c.onFirstUpdate(A)});function h(){u.orderedModifiers.forEach(function(A){var g=A.name,v=A.options,b=v===void 0?{}:v,y=A.effect;if(typeof y=="function"){var I=y({state:u,name:g,instance:f,options:b}),w=function(){};d.push(I||w)}})}function m(){d.forEach(function(A){return A()}),d=[]}return f}}var amt=[Dht,zht,Cht,yMe,Qht,Lht,Kht,wht,Hht],smt=nmt({defaultModifiers:amt}),omt="tippy-box",EMe="tippy-content",lmt="tippy-backdrop",DMe="tippy-arrow",PMe="tippy-svg-arrow",eI={passive:!0,capture:!0},RMe=function(){return document.body};function NG(t,e,i){if(Array.isArray(t)){var r=t[e];return r??(Array.isArray(i)?i[e]:i)}return t}function CZ(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function MMe(t,e){return typeof t=="function"?t.apply(void 0,e):t}function hne(t,e){if(e===0)return t;var i;return function(r){clearTimeout(i),i=setTimeout(function(){t(r)},e)}}function cmt(t){return t.split(/\s+/).filter(Boolean)}function TU(t){return[].concat(t)}function mne(t,e){t.indexOf(e)===-1&&t.push(e)}function umt(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function dmt(t){return t.split("-")[0]}function dO(t){return[].slice.call(t)}function Ane(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function B0(){return document.createElement("div")}function BH(t){return["Element","Fragment"].some(function(e){return CZ(t,e)})}function pmt(t){return CZ(t,"NodeList")}function fmt(t){return CZ(t,"MouseEvent")}function hmt(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function mmt(t){return BH(t)?[t]:pmt(t)?dO(t):Array.isArray(t)?t:dO(document.querySelectorAll(t))}function BG(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function gne(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function Amt(t){var e,i=TU(t),r=i[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function gmt(t,e){var i=e.clientX,r=e.clientY;return t.every(function(n){var a=n.popperRect,s=n.popperState,o=n.props,l=o.interactiveBorder,c=dmt(s.placement),u=s.modifiersData.offset;if(!u)return!0;var d=c==="bottom"?u.top.y:0,p=c==="top"?u.bottom.y:0,f=c==="right"?u.left.x:0,h=c==="left"?u.right.x:0,m=a.top-r+d>l,A=r-a.bottom-p>l,g=a.left-i+f>l,v=i-a.right-h>l;return m||A||g||v})}function kG(t,e,i){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(n){t[r](n,i)})}function vne(t,e){for(var i=e;i;){var r;if(t.contains(i))return!0;i=i.getRootNode==null||(r=i.getRootNode())==null?void 0:r.host}return!1}var lm={isTouch:!1},yne=0;function vmt(){lm.isTouch||(lm.isTouch=!0,window.performance&&document.addEventListener("mousemove",NMe))}function NMe(){var t=performance.now();t-yne<20&&(lm.isTouch=!1,document.removeEventListener("mousemove",NMe)),yne=t}function ymt(){var t=document.activeElement;if(hmt(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function bmt(){document.addEventListener("touchstart",vmt,eI),window.addEventListener("blur",ymt)}var Imt=typeof window<"u"&&typeof document<"u",wmt=Imt?!!window.msCrypto:!1,Smt={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},Umt={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Xf=Object.assign({appendTo:RMe,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},Smt,Umt),Tmt=Object.keys(Xf),Cmt=function(e){var i=Object.keys(e);i.forEach(function(r){Xf[r]=e[r]})};function BMe(t){var e=t.plugins||[],i=e.reduce(function(r,n){var a=n.name,s=n.defaultValue;if(a){var o;r[a]=t[a]!==void 0?t[a]:(o=Xf[a])!=null?o:s}return r},{});return Object.assign({},t,i)}function Emt(t,e){var i=e?Object.keys(BMe(Object.assign({},Xf,{plugins:e}))):Tmt,r=i.reduce(function(n,a){var s=(t.getAttribute("data-tippy-"+a)||"").trim();if(!s)return n;if(a==="content")n[a]=s;else try{n[a]=JSON.parse(s)}catch{n[a]=s}return n},{});return r}function bne(t,e){var i=Object.assign({},e,{content:MMe(e.content,[t])},e.ignoreAttributes?{}:Emt(t,e.plugins));return i.aria=Object.assign({},Xf.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var Dmt=function(){return"innerHTML"};function N3(t,e){t[Dmt()]=e}function Ine(t){var e=B0();return t===!0?e.className=DMe:(e.className=PMe,BH(t)?e.appendChild(t):N3(e,t)),e}function wne(t,e){BH(e.content)?(N3(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?N3(t,e.content):t.textContent=e.content)}function B3(t){var e=t.firstElementChild,i=dO(e.children);return{box:e,content:i.find(function(r){return r.classList.contains(EMe)}),arrow:i.find(function(r){return r.classList.contains(DMe)||r.classList.contains(PMe)}),backdrop:i.find(function(r){return r.classList.contains(lmt)})}}function kMe(t){var e=B0(),i=B0();i.className=omt,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var r=B0();r.className=EMe,r.setAttribute("data-state","hidden"),wne(r,t.props),e.appendChild(i),i.appendChild(r),n(t.props,t.props);function n(a,s){var o=B3(e),l=o.box,c=o.content,u=o.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(a.content!==s.content||a.allowHTML!==s.allowHTML)&&wne(c,t.props),s.arrow?u?a.arrow!==s.arrow&&(l.removeChild(u),l.appendChild(Ine(s.arrow))):l.appendChild(Ine(s.arrow)):u&&l.removeChild(u)}return{popper:e,onUpdate:n}}kMe.$$tippy=!0;var Pmt=1,wB=[],xG=[];function Rmt(t,e){var i=bne(t,Object.assign({},Xf,BMe(Ane(e)))),r,n,a,s=!1,o=!1,l=!1,c=!1,u,d,p,f=[],h=hne(he,i.interactiveDebounce),m,A=Pmt++,g=null,v=umt(i.plugins),b={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},y={id:A,reference:t,popper:B0(),popperInstance:g,props:i,state:b,plugins:v,clearDelayTimeouts:lt,setProps:it,setContent:Fe,show:Xe,hide:ct,hideWithInteractivity:We,enable:mt,disable:Le,unmount:ht,destroy:xt};if(!i.render)return y;var I=i.render(y),w=I.popper,S=I.onUpdate;w.setAttribute("data-tippy-root",""),w.id="tippy-"+y.id,y.popper=w,t._tippy=y,w._tippy=y;var T=v.map(function(pe){return pe.fn(y)}),D=t.hasAttribute("aria-expanded");return ue(),_(),O(),x("onCreate",[y]),i.showOnCreate&&Tt(),w.addEventListener("mouseenter",function(){y.props.interactive&&y.state.isVisible&&y.clearDelayTimeouts()}),w.addEventListener("mouseleave",function(){y.props.interactive&&y.props.trigger.indexOf("mouseenter")>=0&&M().addEventListener("mousemove",h)}),y;function C(){var pe=y.props.touch;return Array.isArray(pe)?pe:[pe,0]}function E(){return C()[0]==="hold"}function P(){var pe;return!!((pe=y.props.render)!=null&&pe.$$tippy)}function R(){return m||t}function M(){var pe=R().parentNode;return pe?Amt(pe):document}function N(){return B3(w)}function k(pe){return y.state.isMounted&&!y.state.isVisible||lm.isTouch||u&&u.type==="focus"?0:NG(y.props.delay,pe?0:1,Xf.delay)}function O(pe){pe===void 0&&(pe=!1),w.style.pointerEvents=y.props.interactive&&!pe?"":"none",w.style.zIndex=""+y.props.zIndex}function x(pe,Se,ye){if(ye===void 0&&(ye=!0),T.forEach(function(Ce){Ce[pe]&&Ce[pe].apply(Ce,Se)}),ye){var ke;(ke=y.props)[pe].apply(ke,Se)}}function F(){var pe=y.props.aria;if(pe.content){var Se="aria-"+pe.content,ye=w.id,ke=TU(y.props.triggerTarget||t);ke.forEach(function(Ce){var Ke=Ce.getAttribute(Se);if(y.state.isVisible)Ce.setAttribute(Se,Ke?Ke+" "+ye:ye);else{var _e=Ke&&Ke.replace(ye,"").trim();_e?Ce.setAttribute(Se,_e):Ce.removeAttribute(Se)}})}}function _(){if(!(D||!y.props.aria.expanded)){var pe=TU(y.props.triggerTarget||t);pe.forEach(function(Se){y.props.interactive?Se.setAttribute("aria-expanded",y.state.isVisible&&Se===R()?"true":"false"):Se.removeAttribute("aria-expanded")})}}function V(){M().removeEventListener("mousemove",h),wB=wB.filter(function(pe){return pe!==h})}function G(pe){if(!(lm.isTouch&&(l||pe.type==="mousedown"))){var Se=pe.composedPath&&pe.composedPath()[0]||pe.target;if(!(y.props.interactive&&vne(w,Se))){if(TU(y.props.triggerTarget||t).some(function(ye){return vne(ye,Se)})){if(lm.isTouch||y.state.isVisible&&y.props.trigger.indexOf("click")>=0)return}else x("onClickOutside",[y,pe]);y.props.hideOnClick===!0&&(y.clearDelayTimeouts(),y.hide(),o=!0,setTimeout(function(){o=!1}),y.state.isMounted||W())}}}function z(){l=!0}function Q(){l=!1}function j(){var pe=M();pe.addEventListener("mousedown",G,!0),pe.addEventListener("touchend",G,eI),pe.addEventListener("touchstart",Q,eI),pe.addEventListener("touchmove",z,eI)}function W(){var pe=M();pe.removeEventListener("mousedown",G,!0),pe.removeEventListener("touchend",G,eI),pe.removeEventListener("touchstart",Q,eI),pe.removeEventListener("touchmove",z,eI)}function Y(pe,Se){J(pe,function(){!y.state.isVisible&&w.parentNode&&w.parentNode.contains(w)&&Se()})}function X(pe,Se){J(pe,Se)}function J(pe,Se){var ye=N().box;function ke(Ce){Ce.target===ye&&(kG(ye,"remove",ke),Se())}if(pe===0)return Se();kG(ye,"remove",d),kG(ye,"add",ke),d=ke}function ie(pe,Se,ye){ye===void 0&&(ye=!1);var ke=TU(y.props.triggerTarget||t);ke.forEach(function(Ce){Ce.addEventListener(pe,Se,ye),f.push({node:Ce,eventType:pe,handler:Se,options:ye})})}function ue(){E()&&(ie("touchstart",ge,{passive:!0}),ie("touchend",Ie,{passive:!0})),cmt(y.props.trigger).forEach(function(pe){if(pe!=="manual")switch(ie(pe,ge),pe){case"mouseenter":ie("mouseleave",Ie);break;case"focus":ie(wmt?"focusout":"blur",xe);break;case"focusin":ie("focusout",xe);break}})}function ne(){f.forEach(function(pe){var Se=pe.node,ye=pe.eventType,ke=pe.handler,Ce=pe.options;Se.removeEventListener(ye,ke,Ce)}),f=[]}function ge(pe){var Se,ye=!1;if(!(!y.state.isEnabled||Je(pe)||o)){var ke=((Se=u)==null?void 0:Se.type)==="focus";u=pe,m=pe.currentTarget,_(),!y.state.isVisible&&fmt(pe)&&wB.forEach(function(Ce){return Ce(pe)}),pe.type==="click"&&(y.props.trigger.indexOf("mouseenter")<0||s)&&y.props.hideOnClick!==!1&&y.state.isVisible?ye=!0:Tt(pe),pe.type==="click"&&(s=!ye),ye&&!ke&&Oe(pe)}}function he(pe){var Se=pe.target,ye=R().contains(Se)||w.contains(Se);if(!(pe.type==="mousemove"&&ye)){var ke=je().concat(w).map(function(Ce){var Ke,_e=Ce._tippy,wt=(Ke=_e.popperInstance)==null?void 0:Ke.state;return wt?{popperRect:Ce.getBoundingClientRect(),popperState:wt,props:i}:null}).filter(Boolean);gmt(ke,pe)&&(V(),Oe(pe))}}function Ie(pe){var Se=Je(pe)||y.props.trigger.indexOf("click")>=0&&s;if(!Se){if(y.props.interactive){y.hideWithInteractivity(pe);return}Oe(pe)}}function xe(pe){y.props.trigger.indexOf("focusin")<0&&pe.target!==R()||y.props.interactive&&pe.relatedTarget&&w.contains(pe.relatedTarget)||Oe(pe)}function Je(pe){return lm.isTouch?E()!==pe.type.indexOf("touch")>=0:!1}function qe(){dt();var pe=y.props,Se=pe.popperOptions,ye=pe.placement,ke=pe.offset,Ce=pe.getReferenceClientRect,Ke=pe.moveTransition,_e=P()?B3(w).arrow:null,wt=Ce?{getBoundingClientRect:Ce,contextElement:Ce.contextElement||R()}:t,ut={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Wt){var Ji=Wt.state;if(P()){var $i=N(),xi=$i.box;["placement","reference-hidden","escaped"].forEach(function(en){en==="placement"?xi.setAttribute("data-placement",Ji.placement):Ji.attributes.popper["data-popper-"+en]?xi.setAttribute("data-"+en,""):xi.removeAttribute("data-"+en)}),Ji.attributes.popper={}}}},Ct=[{name:"offset",options:{offset:ke}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Ke}},ut];P()&&_e&&Ct.push({name:"arrow",options:{element:_e,padding:3}}),Ct.push.apply(Ct,Se?.modifiers||[]),y.popperInstance=smt(wt,w,Object.assign({},Se,{placement:ye,onFirstUpdate:p,modifiers:Ct}))}function dt(){y.popperInstance&&(y.popperInstance.destroy(),y.popperInstance=null)}function ft(){var pe=y.props.appendTo,Se,ye=R();y.props.interactive&&pe===RMe||pe==="parent"?Se=ye.parentNode:Se=MMe(pe,[ye]),Se.contains(w)||Se.appendChild(w),y.state.isMounted=!0,qe()}function je(){return dO(w.querySelectorAll("[data-tippy-root]"))}function Tt(pe){y.clearDelayTimeouts(),pe&&x("onTrigger",[y,pe]),j();var Se=k(!0),ye=C(),ke=ye[0],Ce=ye[1];lm.isTouch&&ke==="hold"&&Ce&&(Se=Ce),Se?r=setTimeout(function(){y.show()},Se):y.show()}function Oe(pe){if(y.clearDelayTimeouts(),x("onUntrigger",[y,pe]),!y.state.isVisible){W();return}if(!(y.props.trigger.indexOf("mouseenter")>=0&&y.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(pe.type)>=0&&s)){var Se=k(!1);Se?n=setTimeout(function(){y.state.isVisible&&y.hide()},Se):a=requestAnimationFrame(function(){y.hide()})}}function mt(){y.state.isEnabled=!0}function Le(){y.hide(),y.state.isEnabled=!1}function lt(){clearTimeout(r),clearTimeout(n),cancelAnimationFrame(a)}function it(pe){if(!y.state.isDestroyed){x("onBeforeUpdate",[y,pe]),ne();var Se=y.props,ye=bne(t,Object.assign({},Se,Ane(pe),{ignoreAttributes:!0}));y.props=ye,ue(),Se.interactiveDebounce!==ye.interactiveDebounce&&(V(),h=hne(he,ye.interactiveDebounce)),Se.triggerTarget&&!ye.triggerTarget?TU(Se.triggerTarget).forEach(function(ke){ke.removeAttribute("aria-expanded")}):ye.triggerTarget&&t.removeAttribute("aria-expanded"),_(),O(),S&&S(Se,ye),y.popperInstance&&(qe(),je().forEach(function(ke){requestAnimationFrame(ke._tippy.popperInstance.forceUpdate)})),x("onAfterUpdate",[y,pe])}}function Fe(pe){y.setProps({content:pe})}function Xe(){var pe=y.state.isVisible,Se=y.state.isDestroyed,ye=!y.state.isEnabled,ke=lm.isTouch&&!y.props.touch,Ce=NG(y.props.duration,0,Xf.duration);if(!(pe||Se||ye||ke)&&!R().hasAttribute("disabled")&&(x("onShow",[y],!1),y.props.onShow(y)!==!1)){if(y.state.isVisible=!0,P()&&(w.style.visibility="visible"),O(),j(),y.state.isMounted||(w.style.transition="none"),P()){var Ke=N(),_e=Ke.box,wt=Ke.content;BG([_e,wt],0)}p=function(){var Ct;if(!(!y.state.isVisible||c)){if(c=!0,w.offsetHeight,w.style.transition=y.props.moveTransition,P()&&y.props.animation){var Gi=N(),Wt=Gi.box,Ji=Gi.content;BG([Wt,Ji],Ce),gne([Wt,Ji],"visible")}F(),_(),mne(xG,y),(Ct=y.popperInstance)==null||Ct.forceUpdate(),x("onMount",[y]),y.props.animation&&P()&&X(Ce,function(){y.state.isShown=!0,x("onShown",[y])})}},ft()}}function ct(){var pe=!y.state.isVisible,Se=y.state.isDestroyed,ye=!y.state.isEnabled,ke=NG(y.props.duration,1,Xf.duration);if(!(pe||Se||ye)&&(x("onHide",[y],!1),y.props.onHide(y)!==!1)){if(y.state.isVisible=!1,y.state.isShown=!1,c=!1,s=!1,P()&&(w.style.visibility="hidden"),V(),W(),O(!0),P()){var Ce=N(),Ke=Ce.box,_e=Ce.content;y.props.animation&&(BG([Ke,_e],ke),gne([Ke,_e],"hidden"))}F(),_(),y.props.animation?P()&&Y(ke,y.unmount):y.unmount()}}function We(pe){M().addEventListener("mousemove",h),mne(wB,h),h(pe)}function ht(){y.state.isVisible&&y.hide(),y.state.isMounted&&(dt(),je().forEach(function(pe){pe._tippy.unmount()}),w.parentNode&&w.parentNode.removeChild(w),xG=xG.filter(function(pe){return pe!==y}),y.state.isMounted=!1,x("onHidden",[y]))}function xt(){y.state.isDestroyed||(y.clearDelayTimeouts(),y.unmount(),ne(),delete t._tippy,y.state.isDestroyed=!0,x("onDestroy",[y]))}}function Bg(t,e){e===void 0&&(e={});var i=Xf.plugins.concat(e.plugins||[]);bmt();var r=Object.assign({},e,{plugins:i}),n=mmt(t),a=n.reduce(function(s,o){var l=o&&Rmt(o,r);return l&&s.push(l),s},[]);return BH(t)?a[0]:a}Bg.defaultProps=Xf;Bg.setDefaultProps=Cmt;Bg.currentInput=lm;Object.assign({},yMe,{effect:function(e){var i=e.state,r={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,r.popper),i.styles=r,i.elements.arrow&&Object.assign(i.elements.arrow.style,r.arrow)}});Bg.setDefaultProps({render:kMe});function Sne(t){const e=document.createElement("button");return e.className="button font-medium",t.disabled&&(e.disabled=!0),t.class&&e.classList.add(t.class),t.id&&(e.id=t.id),t.location===Ht?e.style.marginLeft="1em":e.style.marginRight="1em",t.intent&&e.classList.add(t.intent),t.toolTip?.content&&Bg(e,t.toolTip),e.innerHTML=t.label,t.visible===!1&&(e.style.display=jt),e}const EZ=({target:t})=>(e=[])=>{t.style.backgroundColor=e?.length?"lightgray":NT;const i=(r,n,a)=>{const s=t.getElementsByClassName(`options_${r}`)[0];s&&(s.style.display=e?.length?n:a)};i(sa,nB,jt),i(ii,jt,nB),i(si,jt,nB),i(Ht,jt,nB)};function eo(t){const{table:e,targetClassName:i,items:r=[],onSelection:n}=t;let{target:a}=t;const s=!!a;if(!a&&i&&(a=document.getElementsByClassName(i)?.[0]),!a)return{elements:{},inputs:{}};let o=0,l=0;const c={},u={};let d;if(s){fo(a);const g=Mmt();Object.assign(c,g.elements),a.appendChild(g.anchor)}const p=Object.assign({},...[sa,ii,si,Ht,u_].map(g=>{const v=a.getElementsByClassName(`options_${g}`)?.[0];return fo(v),{[g]:v}}).filter(Boolean)),f=EZ({target:a}),h=(g,v)=>{Mt(v.onClick)&&(g.stopPropagation(),v.disabled||v.onClick(g,e),v.stateChange&&f())},m={onClick:()=>{},location:Ht};for(const g of r){const v={...m};Ad(g)&&Object.assign(v,g);const b=p[v.location];if(!b){console.log(v.location,p);continue}if(v.location===sa&&(o+=1),v.location===u_){if(Mt(v.headerClick)){const y=a.getElementsByClassName("panelHeader")[0];y&&(y.onclick=v.headerClick)}l+=1}if(!v.hide&&(v.input||v.placeholder||v.search)){const y=document.createElement("p");y.style.cssText="margin-right: 1em",y.className=`control ${v.search?"has-icons-left has-icons-right":""}`;const I=document.createElement("input");if(v.focus&&(d=I),I.className="input font-medium",I.setAttribute("type","text"),I.setAttribute("autocomplete","off"),I.setAttribute("placeholder",g.placeholder||NT),v.id&&(u[v.id]=I),v.id&&I.setAttribute("id",v.id),v.onKeyDown&&I.addEventListener("keydown",w=>v.onKeyDown(w,v)),v.onChange&&I.addEventListener("change",w=>v.onChange(w,v)),v.onKeyUp&&I.addEventListener("keyup",w=>{v.clearSearch&&w.key==="Escape"&&(w.stopPropagation(),I.value="",v.clearSearch()),v.onKeyUp(w,v)}),v.class&&I.classList.add(v.class),v.visible===!1&&(y.style.display=jt),v.value&&(I.value=v.value),y.appendChild(I),v.search){const w=document.createElement("span");if(w.className="icon is-small is-left font-medium",w.innerHTML='<i class="fa-solid fa-magnifying-glass"></i>',y.appendChild(w),Mt(v.clearSearch)){const S=document.createElement("span");S.className="icon is-small is-right font-medium",S.innerHTML='<i class="fa-solid fa-circle-xmark" style="color: #dddada; pointer-events: all; cursor: pointer"></i>',S.onclick=T=>{T.stopPropagation(),I.value="",v.clearSearch()},y.appendChild(S)}}if(g.validator){const w=document.createElement("p");w.className="help font-medium",y.appendChild(w),I.addEventListener("input",S=>RIe(g,S,I,w,g.validator))}v.id&&(c[v.id]=y,y.id=v.id),b?.appendChild(y);continue}if(!v.hide&&v.text){const y=document.createElement("div");y.className="font-medium",v.id&&(c[v.id]=y,y.id=v.id),y.innerHTML=v.text,y.onclick=I=>h(I,v),b?.appendChild(y);continue}if(!(!v.id&&(!v?.label||v.hide))){if(v.options){const y=T3({target:b,button:v,stateChange:f});v.visible===!1&&(y.style.display=jt),v.id&&(c[v.id]=y)}else if(Ad(v.selection)){const{selection:{options:y,actions:I},actionPlacement:w,threshold:S=8,...T}=v;if(y?.length<S){y.length&&(w===rte?y.unshift({divider:!0}):y.push({divider:!0})),I.forEach(E=>{const{label:P,...R}=E,M={...R,label:`<p style="font-weight: bold">${P}</p>`};w===rte?y.unshift(M):y.push(M)});const D={...T,options:y},C=T3({target:b,button:D,stateChange:f});D.visible===!1&&(C.style.display=jt),D.id&&(c[v.id]=C)}else{const D=Sne(v);D.onclick=C=>{C.stopPropagation(),vZ({title:"Select team",options:y})},v.id&&(c[v.id]=D),b?.appendChild(D)}}else if(v.tabs){const y=document.createElement("div");y.className="tabs is-toggle is-toggle-rounded";const I=document.createElement("ul");y.appendChild(I),v.tabs.forEach(w=>{const S=document.createElement("li");w.active&&S.classList.add("is-active");const T=document.createElement("a");S.appendChild(T),T.onclick=C=>{I.querySelectorAll("li").forEach(E=>E.classList.remove("is-active")),S.classList.add("is-active"),Mt(w.onClick)&&w.onClick(C,v)};const D=document.createElement("span");D.innerHTML=w.label,T.appendChild(D),I.appendChild(S)}),v.id&&(c[v.id]=y),b.appendChild(y)}else{const y=Sne(v);y.onclick=I=>h(I,v),v.id&&(c[v.id]=y),b?.appendChild(y)}(!(v?.label||v.tabs)||v.hide)&&c[v.id]&&(c[v.id].style.display=jt)}}const A=a.getElementsByClassName("panelHeader")[0];return A&&(A.style.display=l?NT:jt),e?.on("rowSelectionChanged",(g,v)=>{Mt(n)&&n(v),o&&f(v)}),f(),d&&setTimeout(()=>d.focus(),200),{elements:c,inputs:u}}function Mmt(){const t=document.createElement("div");t.className="panel_container flexcol flexcenter";const e=document.createElement("div");e.className="panelHeader options_header",e.style.display=jt,t.appendChild(e);const i=document.createElement("div");i.className=Pbe;const r={optionsOverlay:document.createElement("div"),optionsLeft:document.createElement("div"),optionsCenter:document.createElement("div"),optionsRight:document.createElement("div")};r.optionsOverlay.className="options_overlay",r.optionsCenter.className="options_center",r.optionsRight.className="options_right",r.optionsLeft.className="options_left";for(const n of Object.values(r))i.appendChild(n);return t.appendChild(i),{elements:r,anchor:t,header:e}}const{FIRST_MATCH_LOSER_CONSOLATION:Nmt,COMPASS:Bmt,ROUND_ROBIN:kmt}=Wn,{MALE:xmt,FEMALE:_mt}=Qn.genderConstants,{DOUBLES:Une}=Qn.eventConstants,{WTN:SB}=Qn.ratingConstants;function Omt(t){const e=t.getData().map(r=>r.tournamentId),i=Fmt();for(const r of i)UN({tournamentRecord:r,tournamentIds:e,table:t});return{...qR}}function Fmt(){const e=[{venueName:"Super Fast Courts",venueAbbreviation:"SFC",startTime:"08:00",endTime:"20:00",courtsCount:8}];return[{tournamentAttributes:{tournamentId:"tournament-id-1"},participantsProfile:{scaledParticipantsCount:200,idPrefix:"p"},tournamentName:"CourtHive Challenge",drawProfiles:[{category:{categoryName:"U18"},eventName:"U18 Boys Doubles",eventId:"event-id-1",drawId:"draw-id-1",eventType:Une,gender:xmt,seedsCount:4,drawSize:16},{drawType:Nmt,category:{categoryName:"U16"},eventName:"U16 Girls Singles",eventId:"event-id-2",drawId:"draw-id-2",gender:_mt,seedsCount:8,drawSize:32},{category:{ratingType:SB,ratingMin:18,ratingMax:24.99},eventName:"WTN 18-25 SINGLES",scaledParticipantsCount:32,eventId:"event-id-3",drawId:"draw-id-3",seedsCount:8,drawSize:32},{category:{ratingType:SB,ratingMin:18,ratingMax:24.99},eventName:"WTN 18-25 DOUBLES",scaledParticipantsCount:32,eventId:"event-id-4",drawId:"draw-id-4",eventType:Une,seedsCount:8,drawSize:32}],venueProfiles:e},{tournamentAttributes:{tournamentId:"tournament-id-02"},participantsProfile:{idPrefix:"p"},tournamentName:"Level Based Play",drawProfiles:[{eventName:"WTN 14-19 SINGLES",category:{ratingType:SB,ratingMin:14,ratingMax:19.99},scaledParticipantsCount:32,eventId:"event-id-1",drawId:"draw-id-1",drawType:Bmt,seedsCount:8,drawSize:32},{eventName:"WTN 20-26 SINGLES",category:{ratingType:SB,ratingMin:20,ratingMax:25.99},scaledParticipantsCount:16,drawType:kmt,eventId:"event-id-2",drawId:"draw-id-2",seedsCount:4,drawSize:16}],venueProfiles:e}].map(r=>r2.generateTournamentRecord(r).tournamentRecord)}function Lmt(t){const e=gu(),i=e?.roles?.includes(n2),r=e?.services?.includes("tournamentProfile"),n=[{label:"Create new tournament",onClick:()=>lMe({table:t})},{label:"Import tournament",onClick:()=>Rut({table:t})},r&&{label:"Fetch tournament",onClick:()=>Mut({table:t})},i&&{label:"Load by ID",onClick:()=>Nut({table:t})},{divider:!0},{divider:!0},{label:"Example tournaments",onClick:()=>Omt(t),close:!0}].filter(Boolean),a=DS(t),s=[{label:"Actions",options:n,align:Ht},{onKeyDown:l=>l.key==="Backspace"&&l.target.value.length===1&&a(""),onChange:l=>a(l.target.value),onKeyUp:l=>a(l.target.value),clearSearch:()=>a(""),placeholder:"Search tournaments",id:"tournamentSearch",location:ii,search:!0}],o=document.getElementById(Dbe)||void 0;eo({target:o,items:s})}const $mt=t=>e=>{const i=document.createElement("table"),r=e.getValue();i.style.width="400px";const n="4em",a=document.createElement("tr");if(r.offline){const c=e.getRow().getElement();c.style.backgroundColor="lightyellow"}const s=r.tournamentImageURL?`<img src='${r.tournamentImageURL}' style='width: ${n}' alt=''>`:"",o=(t?"":`<td style='min-width: ${n};'>${s}</td>`)+`<td><div style='margin-left: 1em'><strong style='font-size: 1.5em'>${r.tournamentName}</strong></div><div style='margin-left: 1em'>${r.startDate} / ${r.endDate}</div></td>`;a.innerHTML=o,i.appendChild(a);const l=document.createElement("span");return l.appendChild(i),l};function Hmt({providerId:t,tournamentId:e}){const i=()=>ot.router.navigate(`/tournaments/${e}`),r=n=>{n&&(n.calendar=n.calendar.filter(a=>a.tournamentId!==e),ou.addProvider(n).then(i))};ou.findProvider(t).then(r)}let $v;function Kd(t){$v&&($v?.destroy(!0),$v=void 0),t?.remove&&t.remove()}function nl(t){const{title:e,options:i,menuItems:r=[],coords:n,callback:a,config:s}=t;let{target:o,items:l}=t;if(!i?.length&&!l?.length&&!r)return;Kd();const c=document.createElement("div");let u;const d=()=>{l=l?.filter(h=>!h.hide&&!h.disabled).map(h=>({...h,onClick:()=>{Kd(c),Mt(h.onClick)&&h.onClick()}}))||i?.filter(h=>!h.hide&&!h.disabled).map(h=>({text:typeof h=="object"?h.option:h,style:h.style,onClick:()=>{h.subMenu?$v.setContent("IMPLEMENT SUB MENU"):Mt(h.onClick)?(Kd(c),h.onClick()):Mt(a)&&a&&(Kd(c),a(typeof h=="object"?{...h,coords:n}:h))}}));const p=[{text:e,items:l},...r];return u=Flt(c,p).focusElement,c};return o=o||n?.evt?.target,o&&($v=Bg(o,{content:d,theme:"light-border",trigger:"click",onShown:()=>{u&&setTimeout(()=>u?.focus(),0)},...s}),$v.show(),$v.setProps({interactive:!0})),$v}const Vmt=(t,e,i)=>{t.delete(),i&&Hmt({tournamentId:e,providerId:i})},Gmt=(t,e)=>ou.deleteTournament(t).then(e,i=>console.log(i)),Qmt=(t,e)=>{const i=t.getRow(),r=gu()?.providerId||i.getData().providerId,n=()=>Vmt(i,e,r),a=()=>Gmt(e,n);gu()?.provider||ot?.provider?T5e({providerId:r,tournamentId:e}).then(a,l=>console.log(l)):a()},jmt=t=>e=>{const i=document.createElement("span");i.style.width="100%";const r=e.getValue(),n=()=>Qmt(e,r),a=()=>{const u=`<div style='font-size: 2em'>${e.getTable().getData().find(p=>p.tournamentId===r).tournament.tournamentName} will be deleted!</div>`,d=[{onClick:n,intent:"is-danger",label:"Delete",close:!0},{label:"Cancel"}];Jr({title:Rm.tr("actions.delete_tournament"),buttons:d,content:u})},s=()=>zmt({table:e.getTable(),tournamentId:r}),o=document.createElement("span");return o.innerHTML="<i class='fa fa-ellipsis-vertical'></i>",i.onclick=l=>{l.stopPropagation(),nl({target:o,items:[{text:"Delete",onClick:a},{text:"Edit",onClick:s}],config:{placement:wd}})},i.appendChild(o),i};function zmt({tournamentId:t,table:e}){const r=gu()?.provider,n=()=>{Pt({message:"Tournament not found",onClose:()=>{ot.router.navigate("/tournaments")},intent:"is-warning",pauseOnHover:!0})},a=o=>{o?lMe({table:e,tournamentRecord:o}):n()},s=o=>{const l=o?.data?.tournamentRecords?.[t];a(l)};r?f2({tournamentId:t}).then(s,o=>console.log(o)):ou.findTournament(t).then(a,o=>console.log(o))}function qmt(t){const e=/Mobile/.test(navigator.userAgent),i=(r,n)=>{const a=n.getRow().getData().tournamentId;if(a){Ge.reset();const s=`/${js}/${a}`;ot.router.navigate(s)}};return[{formatter:$mt(e),cellClick:i,field:"tournament",headerSort:!1,resizable:!0,minWidth:250,widthGrow:3},{formatter:()=>'<div class="button font-medium">Open</div>',cellClick:i,vertAlign:"middle",visible:!e,title:"Open",width:90},{formatter:jmt(),field:"tournamentId",vertAlign:"middle",headerSort:!1,hozAlign:Ht,width:10}]}function UA({anchorId:t}){const e=es.findTable(`#${t}`)[0];e&&e.destroy()}function kH(){if(ot.tables)for(const t of Object.keys(ot.tables))ot.tables[t]?.destroy(),delete ot.tables[t];for(;(ot.collectionTables||[]).length;)ot.collectionTables?.pop()?.destroy()}function xMe(){const t=u=>console.log("db Error",{error:u}),e=document.getElementById("dnav");e&&(e.style.backgroundColor="");let i;const r=qmt(),n=u=>{UA({anchorId:l4});const d=document.getElementById(l4);i=new es(d,{height:window.innerHeight*.85,placeholder:"No tournaments",layout:"fitColumns",index:"tournamentId",headerVisible:!1,reactiveData:!0,data:u,columns:r}),i.on("tableBuilt",()=>Lmt(i)),i.on("scrollVertical",Kd)},a=u=>{u.sort((d,p)=>new Date(p.startDate||p.start).getTime()-new Date(d.startDate||d.start).getTime()),n(u.map(DH))},s=({tournaments:u,provider:d})=>{const f=[...u].sort((h,m)=>new Date(m.tournament.startDate).getTime()-new Date(h.tournament.startDate).getTime()).map(h=>{const m=h.tournament.timeItemValues?.TMX?.offline;h.tournament.offline=m;const A=h.tournament.onlineResources?.find(({name:g,resourceType:v})=>g==="tournamentImage"&&v==="URL")?.identifier;return A&&(h.tournament.tournamentImageURL=A),{...h,provider:d}});n(f)},l=gu()?.provider||ot?.provider,c=()=>ou.findAllTournaments().then(a,t);if(l?.organisationAbbreviation){const u=d=>{d?.data?.calendar?s(d.data.calendar):c()};S5e({providerAbbr:l.organisationAbbreviation}).then(u)}else c();return{table:i}}const _Me="leaveTournament",Wmt="providerCalendar",Kmt="processDirective",Ymt="tmxDirective",Xmt="tmxMessage";function OMe(t){const e=YRe({data:t}),{directive:i,content:r}=e||{};i&&(i===Wmt&&r.calendar&&Pt({action:{onClick:()=>Zmt({providerId:r.providerId,calendar:r.calendar}),text:"Load"},message:"Calendar Received",duration:!1}),i.subKey&&ot.ee.emit("sendKey",i.subKey))}function Zmt({providerId:t,calendar:e}){const i=()=>xMe();t&&e&&ou.addProvider({providerId:t,calendar:e}).then(i)}const iA=Object.create(null);iA.open="0";iA.close="1";iA.ping="2";iA.pong="3";iA.message="4";iA.upgrade="5";iA.noop="6";const sx=Object.create(null);Object.keys(iA).forEach(t=>{sx[iA[t]]=t});const k3={type:"error",data:"parser error"},FMe=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",LMe=typeof ArrayBuffer=="function",$Me=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,DZ=({type:t,data:e},i,r)=>FMe&&e instanceof Blob?i?r(e):Tne(e,r):LMe&&(e instanceof ArrayBuffer||$Me(e))?i?r(e):Tne(new Blob([e]),r):r(iA[t]+(e||"")),Tne=(t,e)=>{const i=new FileReader;return i.onload=function(){const r=i.result.split(",")[1];e("b"+(r||""))},i.readAsDataURL(t)};function Cne(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let _G;function Jmt(t,e){if(FMe&&t.data instanceof Blob)return t.data.arrayBuffer().then(Cne).then(e);if(LMe&&(t.data instanceof ArrayBuffer||$Me(t.data)))return e(Cne(t.data));DZ(t,!1,i=>{_G||(_G=new TextEncoder),e(_G.encode(i))})}const Ene="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_D=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<Ene.length;t++)_D[Ene.charCodeAt(t)]=t;const eAt=t=>{let e=t.length*.75,i=t.length,r,n=0,a,s,o,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const c=new ArrayBuffer(e),u=new Uint8Array(c);for(r=0;r<i;r+=4)a=_D[t.charCodeAt(r)],s=_D[t.charCodeAt(r+1)],o=_D[t.charCodeAt(r+2)],l=_D[t.charCodeAt(r+3)],u[n++]=a<<2|s>>4,u[n++]=(s&15)<<4|o>>2,u[n++]=(o&3)<<6|l&63;return c},tAt=typeof ArrayBuffer=="function",PZ=(t,e)=>{if(typeof t!="string")return{type:"message",data:HMe(t,e)};const i=t.charAt(0);return i==="b"?{type:"message",data:iAt(t.substring(1),e)}:sx[i]?t.length>1?{type:sx[i],data:t.substring(1)}:{type:sx[i]}:k3},iAt=(t,e)=>{if(tAt){const i=eAt(t);return HMe(i,e)}else return{base64:!0,data:t}},HMe=(t,e)=>e==="blob"?t instanceof Blob?t:new Blob([t]):t instanceof ArrayBuffer?t:t.buffer,VMe="",rAt=(t,e)=>{const i=t.length,r=new Array(i);let n=0;t.forEach((a,s)=>{DZ(a,!1,o=>{r[s]=o,++n===i&&e(r.join(VMe))})})},nAt=(t,e)=>{const i=t.split(VMe),r=[];for(let n=0;n<i.length;n++){const a=PZ(i[n],e);if(r.push(a),a.type==="error")break}return r};function aAt(){return new TransformStream({transform(t,e){Jmt(t,i=>{const r=i.length;let n;if(r<126)n=new Uint8Array(1),new DataView(n.buffer).setUint8(0,r);else if(r<65536){n=new Uint8Array(3);const a=new DataView(n.buffer);a.setUint8(0,126),a.setUint16(1,r)}else{n=new Uint8Array(9);const a=new DataView(n.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(r))}t.data&&typeof t.data!="string"&&(n[0]|=128),e.enqueue(n),e.enqueue(i)})}})}let OG;function UB(t){return t.reduce((e,i)=>e+i.length,0)}function TB(t,e){if(t[0].length===e)return t.shift();const i=new Uint8Array(e);let r=0;for(let n=0;n<e;n++)i[n]=t[0][r++],r===t[0].length&&(t.shift(),r=0);return t.length&&r<t[0].length&&(t[0]=t[0].slice(r)),i}function sAt(t,e){OG||(OG=new TextDecoder);const i=[];let r=0,n=-1,a=!1;return new TransformStream({transform(s,o){for(i.push(s);;){if(r===0){if(UB(i)<1)break;const l=TB(i,1);a=(l[0]&128)===128,n=l[0]&127,n<126?r=3:n===126?r=1:r=2}else if(r===1){if(UB(i)<2)break;const l=TB(i,2);n=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),r=3}else if(r===2){if(UB(i)<8)break;const l=TB(i,8),c=new DataView(l.buffer,l.byteOffset,l.length),u=c.getUint32(0);if(u>Math.pow(2,21)-1){o.enqueue(k3);break}n=u*Math.pow(2,32)+c.getUint32(4),r=3}else{if(UB(i)<n)break;const l=TB(i,n);o.enqueue(PZ(a?l:OG.decode(l),e)),r=0}if(n===0||n>t){o.enqueue(k3);break}}}})}const GMe=4;function wo(t){if(t)return oAt(t)}function oAt(t){for(var e in wo.prototype)t[e]=wo.prototype[e];return t}wo.prototype.on=wo.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};wo.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this};wo.prototype.off=wo.prototype.removeListener=wo.prototype.removeAllListeners=wo.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var i=this._callbacks["$"+t];if(!i)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var r,n=0;n<i.length;n++)if(r=i[n],r===e||r.fn===e){i.splice(n,1);break}return i.length===0&&delete this._callbacks["$"+t],this};wo.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),i=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(i){i=i.slice(0);for(var r=0,n=i.length;r<n;++r)i[r].apply(this,e)}return this};wo.prototype.emitReserved=wo.prototype.emit;wo.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};wo.prototype.hasListeners=function(t){return!!this.listeners(t).length};const xH=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,i)=>i(e,0),Bp=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),lAt="arraybuffer";function QMe(t,...e){return e.reduce((i,r)=>(t.hasOwnProperty(r)&&(i[r]=t[r]),i),{})}const cAt=Bp.setTimeout,uAt=Bp.clearTimeout;function _H(t,e){e.useNativeTimers?(t.setTimeoutFn=cAt.bind(Bp),t.clearTimeoutFn=uAt.bind(Bp)):(t.setTimeoutFn=Bp.setTimeout.bind(Bp),t.clearTimeoutFn=Bp.clearTimeout.bind(Bp))}const dAt=1.33;function pAt(t){return typeof t=="string"?fAt(t):Math.ceil((t.byteLength||t.size)*dAt)}function fAt(t){let e=0,i=0;for(let r=0,n=t.length;r<n;r++)e=t.charCodeAt(r),e<128?i+=1:e<2048?i+=2:e<55296||e>=57344?i+=3:(r++,i+=4);return i}function jMe(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function hAt(t){let e="";for(let i in t)t.hasOwnProperty(i)&&(e.length&&(e+="&"),e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e}function mAt(t){let e={},i=t.split("&");for(let r=0,n=i.length;r<n;r++){let a=i[r].split("=");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return e}class AAt extends Error{constructor(e,i,r){super(e),this.description=i,this.context=r,this.type="TransportError"}}class RZ extends wo{constructor(e){super(),this.writable=!1,_H(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,i,r){return super.emitReserved("error",new AAt(e,i,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const i=PZ(e,this.socket.binaryType);this.onPacket(i)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,i={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(i)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port)!==443||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const i=hAt(e);return i.length?"?"+i:""}}class gAt extends RZ{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const i=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||i()})),this.writable||(r++,this.once("drain",function(){--r||i()}))}else i()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const i=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};nAt(e,this.socket.binaryType).forEach(i),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,rAt(e,i=>{this.doWrite(i,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",i=this.query||{};return this.opts.timestampRequests!==!1&&(i[this.opts.timestampParam]=jMe()),!this.supportsBinary&&!i.sid&&(i.b64=1),this.createUri(e,i)}}let zMe=!1;try{zMe=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const vAt=zMe;function yAt(){}class bAt extends gAt{constructor(e){if(super(e),typeof location<"u"){const i=location.protocol==="https:";let r=location.port;r||(r=i?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,i){const r=this.request({method:"POST",data:e});r.on("success",i),r.on("error",(n,a)=>{this.onError("xhr post error",n,a)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(i,r)=>{this.onError("xhr poll error",i,r)}),this.pollXhr=e}}class Dm extends wo{constructor(e,i,r){super(),this.createRequest=e,_H(this,r),this._opts=r,this._method=r.method||"GET",this._uri=i,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var e;const i=QMe(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");i.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(i);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let n in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(n)&&r.setRequestHeader(n,this._opts.extraHeaders[n])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var n;r.readyState===3&&((n=this._opts.cookieJar)===null||n===void 0||n.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(n){this.setTimeoutFn(()=>{this._onError(n)},0);return}typeof document<"u"&&(this._index=Dm.requestsCount++,Dm.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=yAt,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Dm.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Dm.requestsCount=0;Dm.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Dne);else if(typeof addEventListener=="function"){const t="onpagehide"in Bp?"pagehide":"unload";addEventListener(t,Dne,!1)}}function Dne(){for(let t in Dm.requests)Dm.requests.hasOwnProperty(t)&&Dm.requests[t].abort()}const IAt=(function(){const t=qMe({xdomain:!1});return t&&t.responseType!==null})();class wAt extends bAt{constructor(e){super(e);const i=e&&e.forceBase64;this.supportsBinary=IAt&&!i}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Dm(qMe,this.uri(),e)}}function qMe(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||vAt))return new XMLHttpRequest}catch{}if(!e)try{return new Bp[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const WMe=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class SAt extends RZ{get name(){return"websocket"}doOpen(){const e=this.uri(),i=this.opts.protocols,r=WMe?{}:QMe(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,i,r)}catch(n){return this.emitReserved("error",n)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const r=e[i],n=i===e.length-1;DZ(r,this.supportsBinary,a=>{try{this.doWrite(r,a)}catch{}n&&xH(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",i=this.query||{};return this.opts.timestampRequests&&(i[this.opts.timestampParam]=jMe()),this.supportsBinary||(i.b64=1),this.createUri(e,i)}}const FG=Bp.WebSocket||Bp.MozWebSocket;class UAt extends SAt{createSocket(e,i,r){return WMe?new FG(e,i,r):i?new FG(e,i):new FG(e)}doWrite(e,i){this.ws.send(i)}}class TAt extends RZ{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const i=sAt(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(i).getReader(),n=aAt();n.readable.pipeTo(e.writable),this._writer=n.writable.getWriter();const a=()=>{r.read().then(({done:o,value:l})=>{o||(this.onPacket(l),a())}).catch(o=>{})};a();const s={type:"open"};this.query.sid&&(s.data=`{"sid":"${this.query.sid}"}`),this._writer.write(s).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const r=e[i],n=i===e.length-1;this._writer.write(r).then(()=>{n&&xH(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const CAt={websocket:UAt,webtransport:TAt,polling:wAt},EAt=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,DAt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function x3(t){if(t.length>8e3)throw"URI too long";const e=t,i=t.indexOf("["),r=t.indexOf("]");i!=-1&&r!=-1&&(t=t.substring(0,i)+t.substring(i,r).replace(/:/g,";")+t.substring(r,t.length));let n=EAt.exec(t||""),a={},s=14;for(;s--;)a[DAt[s]]=n[s]||"";return i!=-1&&r!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=PAt(a,a.path),a.queryKey=RAt(a,a.query),a}function PAt(t,e){const i=/\/{2,9}/g,r=e.replace(i,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function RAt(t,e){const i={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,n,a){n&&(i[n]=a)}),i}const _3=typeof addEventListener=="function"&&typeof removeEventListener=="function",ox=[];_3&&addEventListener("offline",()=>{ox.forEach(t=>t())},!1);class cy extends wo{constructor(e,i){if(super(),this.binaryType=lAt,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(i=e,e=null),e){const r=x3(e);i.hostname=r.host,i.secure=r.protocol==="https"||r.protocol==="wss",i.port=r.port,r.query&&(i.query=r.query)}else i.host&&(i.hostname=x3(i.host).host);_H(this,i),this.secure=i.secure!=null?i.secure:typeof location<"u"&&location.protocol==="https:",i.hostname&&!i.port&&(i.port=this.secure?"443":"80"),this.hostname=i.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=i.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},i.transports.forEach(r=>{const n=r.prototype.name;this.transports.push(n),this._transportsByName[n]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},i),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=mAt(this.opts.query)),_3&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},ox.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const i=Object.assign({},this.opts.query);i.EIO=GMe,i.transport=e,this.id&&(i.sid=this.id);const r=Object.assign({},this.opts,{query:i,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&cy.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const i=this.createTransport(e);i.open(),this.setTransport(i)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",i=>this._onClose("transport close",i))}onOpen(){this.readyState="open",cy.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const i=new Error("server error");i.code=e.data,this._onError(i);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let i=1;for(let r=0;r<this.writeBuffer.length;r++){const n=this.writeBuffer[r].data;if(n&&(i+=pAt(n)),r>0&&i>this._maxPayload)return this.writeBuffer.slice(0,r);i+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,xH(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,i,r){return this._sendPacket("message",e,i,r),this}send(e,i,r){return this._sendPacket("message",e,i,r),this}_sendPacket(e,i,r,n){if(typeof i=="function"&&(n=i,i=void 0),typeof r=="function"&&(n=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const a={type:e,data:i,options:r};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},i=()=>{this.off("upgrade",i),this.off("upgradeError",i),e()},r=()=>{this.once("upgrade",i),this.once("upgradeError",i)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(cy.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,i){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),_3&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=ox.indexOf(this._offlineEventListener);r!==-1&&ox.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,i),this.writeBuffer=[],this._prevBufferLen=0}}}cy.protocol=GMe;class MAt extends cy{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let i=this.createTransport(e),r=!1;cy.priorWebsocketSuccess=!1;const n=()=>{r||(i.send([{type:"ping",data:"probe"}]),i.once("packet",d=>{if(!r)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",i),!i)return;cy.priorWebsocketSuccess=i.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(i),i.send([{type:"upgrade"}]),this.emitReserved("upgrade",i),i=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=i.name,this.emitReserved("upgradeError",p)}}))};function a(){r||(r=!0,u(),i.close(),i=null)}const s=d=>{const p=new Error("probe error: "+d);p.transport=i.name,a(),this.emitReserved("upgradeError",p)};function o(){s("transport closed")}function l(){s("socket closed")}function c(d){i&&d.name!==i.name&&a()}const u=()=>{i.removeListener("open",n),i.removeListener("error",s),i.removeListener("close",o),this.off("close",l),this.off("upgrading",c)};i.once("open",n),i.once("error",s),i.once("close",o),this.once("close",l),this.once("upgrading",c),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||i.open()},200):i.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const i=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&i.push(e[r]);return i}}let NAt=class extends MAt{constructor(e,i={}){const r=typeof e=="object"?e:i;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(n=>CAt[n]).filter(n=>!!n)),super(e,r)}};function BAt(t,e="",i){let r=t;i=i||typeof location<"u"&&location,t==null&&(t=i.protocol+"//"+i.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=i.protocol+t:t=i.host+t),/^(https?|wss?):\/\//.test(t)||(typeof i<"u"?t=i.protocol+"//"+t:t="https://"+t),r=x3(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const a=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+a+":"+r.port+e,r.href=r.protocol+"://"+a+(i&&i.port===r.port?"":":"+r.port),r}const kAt=typeof ArrayBuffer=="function",xAt=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,KMe=Object.prototype.toString,_At=typeof Blob=="function"||typeof Blob<"u"&&KMe.call(Blob)==="[object BlobConstructor]",OAt=typeof File=="function"||typeof File<"u"&&KMe.call(File)==="[object FileConstructor]";function MZ(t){return kAt&&(t instanceof ArrayBuffer||xAt(t))||_At&&t instanceof Blob||OAt&&t instanceof File}function lx(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let i=0,r=t.length;i<r;i++)if(lx(t[i]))return!0;return!1}if(MZ(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return lx(t.toJSON(),!0);for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&lx(t[i]))return!0;return!1}function FAt(t){const e=[],i=t.data,r=t;return r.data=O3(i,e),r.attachments=e.length,{packet:r,buffers:e}}function O3(t,e){if(!t)return t;if(MZ(t)){const i={_placeholder:!0,num:e.length};return e.push(t),i}else if(Array.isArray(t)){const i=new Array(t.length);for(let r=0;r<t.length;r++)i[r]=O3(t[r],e);return i}else if(typeof t=="object"&&!(t instanceof Date)){const i={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=O3(t[r],e));return i}return t}function LAt(t,e){return t.data=F3(t.data,e),delete t.attachments,t}function F3(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let i=0;i<t.length;i++)t[i]=F3(t[i],e);else if(typeof t=="object")for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t[i]=F3(t[i],e));return t}const $At=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var pn;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(pn||(pn={}));class HAt{constructor(e){this.replacer=e}encode(e){return(e.type===pn.EVENT||e.type===pn.ACK)&&lx(e)?this.encodeAsBinary({type:e.type===pn.EVENT?pn.BINARY_EVENT:pn.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let i=""+e.type;return(e.type===pn.BINARY_EVENT||e.type===pn.BINARY_ACK)&&(i+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(i+=e.nsp+","),e.id!=null&&(i+=e.id),e.data!=null&&(i+=JSON.stringify(e.data,this.replacer)),i}encodeAsBinary(e){const i=FAt(e),r=this.encodeAsString(i.packet),n=i.buffers;return n.unshift(r),n}}class NZ extends wo{constructor(e){super(),this.reviver=e}add(e){let i;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");i=this.decodeString(e);const r=i.type===pn.BINARY_EVENT;r||i.type===pn.BINARY_ACK?(i.type=r?pn.EVENT:pn.ACK,this.reconstructor=new VAt(i),i.attachments===0&&super.emitReserved("decoded",i)):super.emitReserved("decoded",i)}else if(MZ(e)||e.base64)if(this.reconstructor)i=this.reconstructor.takeBinaryData(e),i&&(this.reconstructor=null,super.emitReserved("decoded",i));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let i=0;const r={type:Number(e.charAt(0))};if(pn[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===pn.BINARY_EVENT||r.type===pn.BINARY_ACK){const a=i+1;for(;e.charAt(++i)!=="-"&&i!=e.length;);const s=e.substring(a,i);if(s!=Number(s)||e.charAt(i)!=="-")throw new Error("Illegal attachments");r.attachments=Number(s)}if(e.charAt(i+1)==="/"){const a=i+1;for(;++i&&!(e.charAt(i)===","||i===e.length););r.nsp=e.substring(a,i)}else r.nsp="/";const n=e.charAt(i+1);if(n!==""&&Number(n)==n){const a=i+1;for(;++i;){const s=e.charAt(i);if(s==null||Number(s)!=s){--i;break}if(i===e.length)break}r.id=Number(e.substring(a,i+1))}if(e.charAt(++i)){const a=this.tryParse(e.substr(i));if(NZ.isPayloadValid(r.type,a))r.data=a;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,i){switch(e){case pn.CONNECT:return Pne(i);case pn.DISCONNECT:return i===void 0;case pn.CONNECT_ERROR:return typeof i=="string"||Pne(i);case pn.EVENT:case pn.BINARY_EVENT:return Array.isArray(i)&&(typeof i[0]=="number"||typeof i[0]=="string"&&$At.indexOf(i[0])===-1);case pn.ACK:case pn.BINARY_ACK:return Array.isArray(i)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class VAt{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const i=LAt(this.reconPack,this.buffers);return this.finishedReconstruction(),i}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Pne(t){return Object.prototype.toString.call(t)==="[object Object]"}const GAt=Object.freeze(Object.defineProperty({__proto__:null,Decoder:NZ,Encoder:HAt,get PacketType(){return pn}},Symbol.toStringTag,{value:"Module"}));function Qf(t,e,i){return t.on(e,i),function(){t.off(e,i)}}const QAt=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class YMe extends wo{constructor(e,i,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=i,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Qf(e,"open",this.onopen.bind(this)),Qf(e,"packet",this.onpacket.bind(this)),Qf(e,"error",this.onerror.bind(this)),Qf(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...i){var r,n,a;if(QAt.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(i.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(i),this;const s={type:pn.EVENT,data:i};if(s.options={},s.options.compress=this.flags.compress!==!1,typeof i[i.length-1]=="function"){const u=this.ids++,d=i.pop();this._registerAckCallback(u,d),s.id=u}const o=(n=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||n===void 0?void 0:n.writable,l=this.connected&&!(!((a=this.io.engine)===null||a===void 0)&&a._hasPingExpired());return this.flags.volatile&&!o||(l?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(e,i){var r;const n=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(n===void 0){this.acks[e]=i;return}const a=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);i.call(this,new Error("operation has timed out"))},n),s=(...o)=>{this.io.clearTimeoutFn(a),i.apply(this,o)};s.withError=!0,this.acks[e]=s}emitWithAck(e,...i){return new Promise((r,n)=>{const a=(s,o)=>s?n(s):r(o);a.withError=!0,i.push(a),this.emit(e,...i)})}_addToQueue(e){let i;typeof e[e.length-1]=="function"&&(i=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((n,...a)=>(this._queue[0],n!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),i&&i(n)):(this._queue.shift(),i&&i(null,...a)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const i=this._queue[0];i.pending&&!e||(i.pending=!0,i.tryCount++,this.flags=i.flags,this.emit.apply(this,i.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:pn.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,i){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,i),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(r=>String(r.id)===e)){const r=this.acks[e];delete this.acks[e],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case pn.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case pn.EVENT:case pn.BINARY_EVENT:this.onevent(e);break;case pn.ACK:case pn.BINARY_ACK:this.onack(e);break;case pn.DISCONNECT:this.ondisconnect();break;case pn.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const i=e.data||[];e.id!=null&&i.push(this.ack(e.id)),this.connected?this.emitEvent(i):this.receiveBuffer.push(Object.freeze(i))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const i=this._anyListeners.slice();for(const r of i)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const i=this;let r=!1;return function(...n){r||(r=!0,i.packet({type:pn.ACK,id:e,data:n}))}}onack(e){const i=this.acks[e.id];typeof i=="function"&&(delete this.acks[e.id],i.withError&&e.data.unshift(null),i.apply(this,e.data))}onconnect(e,i){this.id=e,this.recovered=i&&this._pid===i,this._pid=i,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:pn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const i=this._anyListeners;for(let r=0;r<i.length;r++)if(e===i[r])return i.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const i=this._anyOutgoingListeners;for(let r=0;r<i.length;r++)if(e===i[r])return i.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const i=this._anyOutgoingListeners.slice();for(const r of i)r.apply(this,e.data)}}}function VE(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}VE.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),i=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-i:t+i}return Math.min(t,this.max)|0};VE.prototype.reset=function(){this.attempts=0};VE.prototype.setMin=function(t){this.ms=t};VE.prototype.setMax=function(t){this.max=t};VE.prototype.setJitter=function(t){this.jitter=t};class L3 extends wo{constructor(e,i){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(i=e,e=void 0),i=i||{},i.path=i.path||"/socket.io",this.opts=i,_H(this,i),this.reconnection(i.reconnection!==!1),this.reconnectionAttempts(i.reconnectionAttempts||1/0),this.reconnectionDelay(i.reconnectionDelay||1e3),this.reconnectionDelayMax(i.reconnectionDelayMax||5e3),this.randomizationFactor((r=i.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new VE({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(i.timeout==null?2e4:i.timeout),this._readyState="closed",this.uri=e;const n=i.parser||GAt;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=i.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var i;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(i=this.backoff)===null||i===void 0||i.setMin(e),this)}randomizationFactor(e){var i;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(i=this.backoff)===null||i===void 0||i.setJitter(e),this)}reconnectionDelayMax(e){var i;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(i=this.backoff)===null||i===void 0||i.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new NAt(this.uri,this.opts);const i=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=Qf(i,"open",function(){r.onopen(),e&&e()}),a=o=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",o),e?e(o):this.maybeReconnectOnOpen()},s=Qf(i,"error",a);if(this._timeout!==!1){const o=this._timeout,l=this.setTimeoutFn(()=>{n(),a(new Error("timeout")),i.close()},o);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(n),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Qf(e,"ping",this.onping.bind(this)),Qf(e,"data",this.ondata.bind(this)),Qf(e,"error",this.onerror.bind(this)),Qf(e,"close",this.onclose.bind(this)),Qf(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(i){this.onclose("parse error",i)}}ondecoded(e){xH(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,i){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new YMe(this,e,i),this.nsps[e]=r),r}_destroy(e){const i=Object.keys(this.nsps);for(const r of i)if(this.nsps[r].active)return;this._close()}_packet(e){const i=this.encoder.encode(e);for(let r=0;r<i.length;r++)this.engine.write(i[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,i){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,i),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const i=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(n=>{n?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",n)):e.onreconnect()}))},i);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const fD={};function cx(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const i=BAt(t,e.path||"/socket.io"),r=i.source,n=i.id,a=i.path,s=fD[n]&&a in fD[n].nsps,o=e.forceNew||e["force new connection"]||e.multiplex===!1||s;let l;return o?l=new L3(r,e):(fD[n]||(fD[n]=new L3(r,e)),l=fD[n]),i.query&&!e.query&&(e.query=i.queryKey),l.socket(i.path,e)}Object.assign(cx,{Manager:L3,Socket:YMe,io:cx,connect:cx});function jAt(){const t=WRe();return t?{authorization:`Bearer ${t}`}:void 0}const Rl={timestampOffset:0,socket:void 0},cm={},$3=[];function zAt(t){console.log("tmxMessage:",{data:t})}function XMe(t){const e={transportOptions:{polling:{extraHeaders:jAt()}},"force new connection":!0,reconnectionDelay:1e3,reconnectionAttempts:"Infinity",timeout:2e4};if(Rl.socket)console.log("socket exists");else{const r=`${$t.socketPath||"https://courthive.net"}/tmx`;Rl.socket=cx(r,e),Rl.socket.on("ack",KAt),Rl.socket.on(Xmt,zAt),Rl.socket.on(Ymt,OMe),Rl.socket.on("connect",()=>qAt(t)),Rl.socket.on("disconnect",()=>console.log("disconnect")),Rl.socket.on("timestamp",n=>Rl.timestampOffset=new Date().getTime()-n.timestamp),Rl.socket.on("connect_error",n=>{console.log("connection error:",{data:n}),Pt({message:"Connection error",intent:"is-danger"}),OH()})}}function OH(){Rl?.socket?.disconnect(),setTimeout(()=>delete Rl.socket,1e3)}function BZ({data:t,ackCallback:e}){const i=gu(),{email:r}=i||{},n=t.type??"tmx",a=()=>{if(e&&Mt(e)){const o=Ri.UUID();t.payload&&Object.assign(t.payload,{ackId:o}),WAt({ackId:o,callback:e})}const s=Rl.timestampOffset?new Date().getTime()+Rl.timestampOffset:new Date().getTime();Object.assign(t.payload||t,{factoryVersion:TC(),tmxVersion:nZ,timestamp:s,userId:r}),ZMe(n,t)};if(Rl.socket)a();else try{XMe(a)}catch{$3.push({header:n,data:t,ackCallback:e})}}function ZMe(t,e){Rl.socket.connected?Rl.socket.emit(t,e):console.log("socket not connected")}function qAt(t){for(console.log("** connected"),BZ({data:{type:"timestamp"}});$3.length;){const e=$3.pop();ZMe(e.header,e.data)}Mt(t)&&t()}function WAt({ackId:t,uuid:e,callback:i}){const r=()=>{t&&delete cm[t],e&&delete cm[e]},n=($t.serverTimeout??1e4)*3,a=setTimeout(r,n),s=o=>{clearTimeout(a),i(o)};t&&(cm[t]=s),e&&(cm[e]=s)}function KAt(t){t.ackId&&cm[t.ackId]&&(cm[t.ackId](t),delete cm[t.ackId]),t.uuid&&cm[t.uuid]&&(cm[t.uuid](t),delete cm[t.uuid])}var ux={exports:{}},YAt=ux.exports,Rne;function XAt(){return Rne||(Rne=1,(function(t,e){(function(i,r){t.exports=r()})(YAt,(function(){var i=1e3,r=6e4,n=36e5,a="millisecond",s="second",o="minute",l="hour",c="day",u="week",d="month",p="quarter",f="year",h="date",m="Invalid Date",A=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(M){var N=["th","st","nd","rd"],k=M%100;return"["+M+(N[(k-20)%10]||N[k]||N[0])+"]"}},b=function(M,N,k){var O=String(M);return!O||O.length>=N?M:""+Array(N+1-O.length).join(k)+M},y={s:b,z:function(M){var N=-M.utcOffset(),k=Math.abs(N),O=Math.floor(k/60),x=k%60;return(N<=0?"+":"-")+b(O,2,"0")+":"+b(x,2,"0")},m:function M(N,k){if(N.date()<k.date())return-M(k,N);var O=12*(k.year()-N.year())+(k.month()-N.month()),x=N.clone().add(O,d),F=k-x<0,_=N.clone().add(O+(F?-1:1),d);return+(-(O+(k-x)/(F?x-_:_-x))||0)},a:function(M){return M<0?Math.ceil(M)||0:Math.floor(M)},p:function(M){return{M:d,y:f,w:u,d:c,D:h,h:l,m:o,s,ms:a,Q:p}[M]||String(M||"").toLowerCase().replace(/s$/,"")},u:function(M){return M===void 0}},I="en",w={};w[I]=v;var S="$isDayjsObject",T=function(M){return M instanceof P||!(!M||!M[S])},D=function M(N,k,O){var x;if(!N)return I;if(typeof N=="string"){var F=N.toLowerCase();w[F]&&(x=F),k&&(w[F]=k,x=F);var _=N.split("-");if(!x&&_.length>1)return M(_[0])}else{var V=N.name;w[V]=N,x=V}return!O&&x&&(I=x),x||!O&&I},C=function(M,N){if(T(M))return M.clone();var k=typeof N=="object"?N:{};return k.date=M,k.args=arguments,new P(k)},E=y;E.l=D,E.i=T,E.w=function(M,N){return C(M,{locale:N.$L,utc:N.$u,x:N.$x,$offset:N.$offset})};var P=(function(){function M(k){this.$L=D(k.locale,null,!0),this.parse(k),this.$x=this.$x||k.x||{},this[S]=!0}var N=M.prototype;return N.parse=function(k){this.$d=(function(O){var x=O.date,F=O.utc;if(x===null)return new Date(NaN);if(E.u(x))return new Date;if(x instanceof Date)return new Date(x);if(typeof x=="string"&&!/Z$/i.test(x)){var _=x.match(A);if(_){var V=_[2]-1||0,G=(_[7]||"0").substring(0,3);return F?new Date(Date.UTC(_[1],V,_[3]||1,_[4]||0,_[5]||0,_[6]||0,G)):new Date(_[1],V,_[3]||1,_[4]||0,_[5]||0,_[6]||0,G)}}return new Date(x)})(k),this.init()},N.init=function(){var k=this.$d;this.$y=k.getFullYear(),this.$M=k.getMonth(),this.$D=k.getDate(),this.$W=k.getDay(),this.$H=k.getHours(),this.$m=k.getMinutes(),this.$s=k.getSeconds(),this.$ms=k.getMilliseconds()},N.$utils=function(){return E},N.isValid=function(){return this.$d.toString()!==m},N.isSame=function(k,O){var x=C(k);return this.startOf(O)<=x&&x<=this.endOf(O)},N.isAfter=function(k,O){return C(k)<this.startOf(O)},N.isBefore=function(k,O){return this.endOf(O)<C(k)},N.$g=function(k,O,x){return E.u(k)?this[O]:this.set(x,k)},N.unix=function(){return Math.floor(this.valueOf()/1e3)},N.valueOf=function(){return this.$d.getTime()},N.startOf=function(k,O){var x=this,F=!!E.u(O)||O,_=E.p(k),V=function(J,ie){var ue=E.w(x.$u?Date.UTC(x.$y,ie,J):new Date(x.$y,ie,J),x);return F?ue:ue.endOf(c)},G=function(J,ie){return E.w(x.toDate()[J].apply(x.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(ie)),x)},z=this.$W,Q=this.$M,j=this.$D,W="set"+(this.$u?"UTC":"");switch(_){case f:return F?V(1,0):V(31,11);case d:return F?V(1,Q):V(0,Q+1);case u:var Y=this.$locale().weekStart||0,X=(z<Y?z+7:z)-Y;return V(F?j-X:j+(6-X),Q);case c:case h:return G(W+"Hours",0);case l:return G(W+"Minutes",1);case o:return G(W+"Seconds",2);case s:return G(W+"Milliseconds",3);default:return this.clone()}},N.endOf=function(k){return this.startOf(k,!1)},N.$set=function(k,O){var x,F=E.p(k),_="set"+(this.$u?"UTC":""),V=(x={},x[c]=_+"Date",x[h]=_+"Date",x[d]=_+"Month",x[f]=_+"FullYear",x[l]=_+"Hours",x[o]=_+"Minutes",x[s]=_+"Seconds",x[a]=_+"Milliseconds",x)[F],G=F===c?this.$D+(O-this.$W):O;if(F===d||F===f){var z=this.clone().set(h,1);z.$d[V](G),z.init(),this.$d=z.set(h,Math.min(this.$D,z.daysInMonth())).$d}else V&&this.$d[V](G);return this.init(),this},N.set=function(k,O){return this.clone().$set(k,O)},N.get=function(k){return this[E.p(k)]()},N.add=function(k,O){var x,F=this;k=Number(k);var _=E.p(O),V=function(Q){var j=C(F);return E.w(j.date(j.date()+Math.round(Q*k)),F)};if(_===d)return this.set(d,this.$M+k);if(_===f)return this.set(f,this.$y+k);if(_===c)return V(1);if(_===u)return V(7);var G=(x={},x[o]=r,x[l]=n,x[s]=i,x)[_]||1,z=this.$d.getTime()+k*G;return E.w(z,this)},N.subtract=function(k,O){return this.add(-1*k,O)},N.format=function(k){var O=this,x=this.$locale();if(!this.isValid())return x.invalidDate||m;var F=k||"YYYY-MM-DDTHH:mm:ssZ",_=E.z(this),V=this.$H,G=this.$m,z=this.$M,Q=x.weekdays,j=x.months,W=x.meridiem,Y=function(ie,ue,ne,ge){return ie&&(ie[ue]||ie(O,F))||ne[ue].slice(0,ge)},X=function(ie){return E.s(V%12||12,ie,"0")},J=W||function(ie,ue,ne){var ge=ie<12?"AM":"PM";return ne?ge.toLowerCase():ge};return F.replace(g,(function(ie,ue){return ue||(function(ne){switch(ne){case"YY":return String(O.$y).slice(-2);case"YYYY":return E.s(O.$y,4,"0");case"M":return z+1;case"MM":return E.s(z+1,2,"0");case"MMM":return Y(x.monthsShort,z,j,3);case"MMMM":return Y(j,z);case"D":return O.$D;case"DD":return E.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return Y(x.weekdaysMin,O.$W,Q,2);case"ddd":return Y(x.weekdaysShort,O.$W,Q,3);case"dddd":return Q[O.$W];case"H":return String(V);case"HH":return E.s(V,2,"0");case"h":return X(1);case"hh":return X(2);case"a":return J(V,G,!0);case"A":return J(V,G,!1);case"m":return String(G);case"mm":return E.s(G,2,"0");case"s":return String(O.$s);case"ss":return E.s(O.$s,2,"0");case"SSS":return E.s(O.$ms,3,"0");case"Z":return _}return null})(ie)||_.replace(":","")}))},N.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},N.diff=function(k,O,x){var F,_=this,V=E.p(O),G=C(k),z=(G.utcOffset()-this.utcOffset())*r,Q=this-G,j=function(){return E.m(_,G)};switch(V){case f:F=j()/12;break;case d:F=j();break;case p:F=j()/3;break;case u:F=(Q-z)/6048e5;break;case c:F=(Q-z)/864e5;break;case l:F=Q/n;break;case o:F=Q/r;break;case s:F=Q/i;break;default:F=Q}return x?F:E.a(F)},N.daysInMonth=function(){return this.endOf(d).$D},N.$locale=function(){return w[this.$L]},N.locale=function(k,O){if(!k)return this.$L;var x=this.clone(),F=D(k,O,!0);return F&&(x.$L=F),x},N.clone=function(){return E.w(this.$d,this)},N.toDate=function(){return new Date(this.valueOf())},N.toJSON=function(){return this.isValid()?this.toISOString():null},N.toISOString=function(){return this.$d.toISOString()},N.toString=function(){return this.$d.toUTCString()},M})(),R=P.prototype;return C.prototype=R,[["$ms",a],["$s",s],["$m",o],["$H",l],["$W",c],["$M",d],["$y",f],["$D",h]].forEach((function(M){R[M[1]]=function(N){return this.$g(N,M[0],M[1])}})),C.extend=function(M,N){return M.$i||(M(N,P,C),M.$i=!0),C},C.locale=D,C.isDayjs=T,C.unix=function(M){return C(1e3*M)},C.en=w[I],C.Ls=w,C.p={},C}))})(ux)),ux.exports}var ZAt=XAt();const kZ=EH(ZAt);async function Nt(t){const{tournamentRecord:e,methods:i,engine:r=mqe,callback:n}=t,a=gu(),s=b=>{e&&r4[r].reset(),n&&Mt(n)?n(b):b?.error&&Pt({message:b.error.message??"Error",intent:"is-danger"})};if(!Array.isArray(i))return s();const o=r4[r];if(!o)return s();e&&o.setState(e);const l=b=>b?.parentOrganisation?.organisationId,c=o.getState()?.tournamentRecords??{},u=b=>b.timeItems?.find(({itemType:y})=>y==="TMX")?.itemValue?.offline,d=Object.values(c)?.map(u).filter(Boolean);if(d.length>1&&!d.every(b=>!b.email||b.email===d[0].email))return Pt({message:"Not all linked tournaments are offline",intent:"is-danger"});const f=d.length,h=Object.values(c)?.map(b=>b.tournamentId),m=Ri.unique(Object.values(c)?.map(l)).filter(Boolean);if(m.length>1)return Pt({message:"Multiple providers",intent:"is-danger"});const A=new Date().getTime(),g=Object.values(c).every(b=>{const y=kZ(b.endDate).endOf("day").valueOf();return!!(y&&y>=A)}),v=b=>egt({offline:f,methods:i,factoryEngine:o,tournamentIds:h,completion:s,saveLocal:b});if(!g){JAt({state:a,providerIds:m,mutate:v});return}if(m.length&&!f){JMe({state:a,providerIds:m,mutate:v});return}await v(!0)}function JAt({state:t,providerIds:e,mutate:i}){return Pt({action:{onClick:()=>e?.length?JMe({state:t,providerIds:e,mutate:i}):i(),text:"Modify?"},message:"Not in date range",intent:"is-danger",pauseOnHover:!0,duration:8e3})}function JMe({state:t,providerIds:e,mutate:i}){if(!t)return ot.provider=void 0,cV(!1),Pt({message:"Not logged in",intent:"is-warning"});const r=!!(t?.providerIds?.includes(e[0])||t?.provider?.organisationId===e[0]),n=t?.roles?.includes(n2),a=ot.provider?.organisationId===e[0];if(!r&&!n)return Pt({message:"Not authorized",intent:"is-danger"});if(!r&&n&&!a)return Pt({action:{onClick:()=>(ot.provider={organisationId:e[0]},i(!1)),text:"Impersonate?"},message:"Super Admin",intent:"is-danger"});i(!r&&!(n&&a))}function Mne({factoryEngine:t,methods:e}){$t.log?.verbose&&console.log("%c executing locally","color: lightgreen");const i=Ri.makeDeepCopy(e);return t.executionQueue(i,!0)||{}}async function LG(t){(t||$t.saveLocal)&&await aZ()}async function egt({offline:t,methods:e,completion:i,factoryEngine:r,tournamentIds:n,saveLocal:a}){const s=r.getTournament().tournamentRecord?.parentOrganisation?.organisationId;if(window.dev?.params)for(const c of e)window.dev.params[c.method]&&(c.params={...c.params,...window.dev.params[c.method]});window?.dev?.getContext().internal&&console.log({methods:e});const o=!$t.serverFirst||!s;let l;if(o||t){if(l=Mne({factoryEngine:r,methods:e}),l.error)return i(l);if(!s||t)return await LG(!0),i(l)}if(s&&(l?.success||$t.serverFirst)){let c=!1,u=!1;const d=p=>{if(u)return;c=!0;const f=p?.error?.code==="ERR_MISSING_TOURNAMENT";$t.serverFirst&&(p?.success||f)?(async()=>(l=Mne({factoryEngine:r,methods:e}),l.error||await LG(a||f),i(l)))():$t.serverFirst&&!o&&i(p?.error?p:{error:{message:"Server rejected mutation"}})};$t.log?.verbose&&console.log("%c invoking remote","color: lightblue"),BZ({data:{type:"executionQueue",payload:{methods:e,tournamentIds:n,rollbackOnError:!0}},ackCallback:d}),o?await LG(a||!1):setTimeout(()=>{c||(u=!0,Pt({message:"Server not responding",intent:"is-danger"}),i({error:{message:"Server not responding"}}))},$t.serverTimeout??1e4)}if(o)return i(l)}function eNe(t,e){const i=document.createElement("a");i.style.display="none",i.setAttribute("href",e),i.setAttribute("download",t);const r=document.body.appendChild(i);r.click(),r.remove()}function tNe(t,e){const i="data:text/json;charset=utf-8,"+encodeURIComponent(Put(e)||"");eNe(t,i)}function tgt(t,e){const i="data:text/plain;charset=utf-8,"+encodeURIComponent(e);eNe(t,i)}function iNe(){const t=l=>l.toString()[1]?l:"0"+l,e=l=>{if(!l)return"";const c=new Date(l);return[t(c.getMonth()+1),t(c.getDate()),c.getFullYear()].join("/")},{tournamentInfo:i}=Ge.getTournamentInfo(),{completedMatchUps:r}=Ge.tournamentMatchUps({context:{tournamentSanctionBody:i.parentOrganisation?.organisationName,tournamentStartDate:e(i.startDate),tournamentEndDate:e(i.endDate),tournamentEventSource:"CourtHive",tournamentEventCategory:"Junior",tournamentEventType:"Tournament",...i,idType:ZI}}),n=r.map(l=>{const{winningSide:c,sides:u,score:d}=l,p=u.find(({sideNumber:m})=>m===c),f=u.find(({sideNumber:m})=>m!==c);return{winnerScore:d[`scoreStringSide${c}`],...l,winners:p,losers:f}}),a=l=>l?.slice(0,1),s={columnAccessors:[""],columnTransform:{Date:["tournamentEndDate"],"Winner 1 Name":["winners.participant.individualParticipants.0.participantName","winners.participant.participantName"],"Winner 1 Third Party ID":["winners.participant.individualParticipants.0.participantId","winners.participant.participantId"],"Winner 1 UTR ID":["winners.participant.individualParticipants.0.person.personOtherIds.0.idValue"],"Winner 1 Gender":["winners.participant.individualParticipants.0.person.sex","winners.participant.person.sex"],"Winner 1 DOB":["winners.participant.individualParticipants.0.person.birthDate","winners.participant.person.birthDate"],"Winner 1 City":["winners.participant.individualParticipants.0.addresses.0.city","winners.participant.addresses.0.city"],"Winner 1 State":["winners.participant.individualParticipants.0.addresses.0.state","winners.participant.addresses.0.state"],"Winner 1 Country":["winners.participant.individualParticipants.0.addresses.0.nationalityCode","winners.participant.addresses.0nationalityCode"],"Winner 1 College":["winners.participant.individualParticipants.0.college"],"Winner 2 Name":["winner.participant.individualParticipants.1.participantName"],"Winner 2 Third Party ID":["winners.participant.individualParticipants.1.participantId"],"Winner 2 UTR ID":["winners.participant.individualParticipants.1.person.personOtherIds.0.idValue"],"Winner 2 Gender":["winners.participant.individualParticipants.1.person.sex"],"Winner 2 DOB":["winners.participant.individualParticipants.1.person.birthDate"],"Winner 2 City":["winners.participant.individualParticipants.1.addresses.0.city"],"Winner 2 State":["winners.participant.individualParticipants.1.addresses.0.state"],"Winner 2 Country":["winners.participant.individualParticipants.1.addresses.0.nationalityCode"],"Winner 2 College":["winners.participant.individualParticipants.1.college"],"Loser 1 Name":["losers.participant.individualParticipants.0.participantName","losers.participant.participantName"],"Loser 1 Third Party ID":["losers.participant.individualParticipants.0.participantId","losers.participant.participantId"],"Loser 1 UTR ID":["losers.participant.individualParticipants.1.person.personOtherIds.0.idValue"],"Loser 1 Gender":["losers.participant.individualParticipants.0.person.sex","winners.participant.person.sex"],"Loser 1 DOB":["losers.participant.individualParticipants.0.person.birthDate","losers.participant.person.birthDate"],"Loser 1 City":["losers.participant.individualParticipants.0.addresses.0.city","losers.participant.addresses.0.city"],"Loser 1 State":["losers.participant.individualParticipants.0.addresses.0.state","losers.participant.addresses.0.state"],"Loser 1 Country":["losers.participant.individualParticipants.0.addresses.0.nationalityCode","losers.participant.addresses.0nationalityCode"],"Loser 1 College":["losers.participant.individualParticipants.0.college"],"Loser 2 Name":["losers.participant.individualParticipants.1.participantName"],"Loser 2 Third Party ID":["losers.participant.individualParticipants.1.participantId"],"Loser 2 UTR ID":["losers.participant.individualParticipants.1.person.personOtherIds.1.idValue"],"Loser 2 Gender":["losers.participant.individualParticipants.1.person.sex"],"Loser 2 DOB":["losers.participant.individualParticipants.1.person.birthDate"],"Loser 2 City":["losers.participant.individualParticipants.1.addresses.0.city"],"Loser 2 State":["losers.participant.individualParticipants.1.addresses.0.state"],"Loser 2 Country":["losers.participant.individualParticipants.1.addresses.0.nationalityCode"],"Loser 2 College":["losers.participant.individualParticipants.1.college"],Score:["winnerScore"],"Id Type":["idType"],"Draw Name":[XI],"Draw Gender":["gender"],"Draw Team Type":["eventType"],"Draw Bracket Type":[""],"Draw Bracket Value":[""],"Draw Type":[Kf],"Tournament Name":["tournamentName"],"Tournament URL":[""],"Tournament Start Date":["tournamentStartDate"],"Tournament End Date":["tournamentEndDate"],"Tournament City":[""],"Tournament State":[""],"Tournament Country":[""],"Tournament Country Code":[""],"Tournament Host":[""],"Tournament Location Type":[""],"Tournament Surface":[""],"Tournament Event Type":["tournamentEventType"],"Tournament Event Category":["tournamentEventCategory"],"Tournament Import Source":["tournamentEventSource"],"Tournament Sanction Body":["tournamentSanctionBody"],"Match ID":["matchUpId"],"Tournament Event Grade":[""]},functionMap:{"Winner 1 Gender":a,"Winner 2 Gender":a,"Loser 1 Gender":a,"Loser 2 Gender":a}},o=Ri.JSON2CSV(n,s);tgt(`UTR-${i.tournamentId}.csv`,o)}function igt(){Pt({intent:"is-success",message:"Success"})}function rgt(t){Pt({intent:"is-danger",message:t?.message??"Failure"})}function ngt(){const t=Ge.getTournament().tournamentRecord,e=t?.timeItems?.find(({itemType:p})=>p==="TMX")?.itemValue?.offline,r=t?.parentOrganisation?.organisationId,n=gu(),a=n?.permissions?.includes("deleteTournament"),s=n?.roles?.includes(vbe);let o;const l=()=>{if(o.action.value==="upload"&&o.replace.checked){const p=Ge.getTournament().tournamentRecord;return Pt({action:{onClick:()=>l0({tournamentRecord:p}).then(igt,rgt),text:"Send??"},message:"Upload tournament",intent:"is-danger"})}if(o.action.value==="claim"&&n?.provider){const p=Ge.getTournament().tournamentRecord;if(!p.parentOrganisation){p.parentOrganisation=n.provider,Ge.setState(p);const f=()=>{ou.deleteTournament(p.tournamentId),ot.router.navigate(`/tournament/${p.tournamentId}/detail`),Pt({message:"Tournament claimed",intent:"is-info"})},h=m=>{Pt({message:m.message||"Not claimed",intent:"is-danger"})};l0({tournamentRecord:p}).then(f,h)}}o.action.value==="goOffline"&&n?.provider&&$G({postMutation:f=>{if(f?.success){aZ();const h=document.getElementById("dnav");h&&(h.style.backgroundColor="lightyellow"),Pt({message:"Offline",intent:"is-info"})}},state:n,offline:!0}),o.action.value==="goOnline"&&n?.provider&&$G({postMutation:f=>{if(f?.success){const h=()=>{ou.deleteTournament(t.tournamentId);const g=document.getElementById("dnav");g&&(g.style.backgroundColor=""),Pt({message:"Online",intent:"is-info"})},m=g=>{console.log({err:g}),$G({state:n,offline:!0})},A=Ge.getTournament().tournamentRecord;l0({tournamentRecord:A}).then(h,m)}},state:n,offline:!1}),o.action.value==="utrExport"&&iNe(),o.action.value==="todsExport"&&(t?tNe(`${t.tournamentId}.tods.json`,t):Pt({message:"Error"}))},c=[{control:"replace",onChange:({e:p})=>{const f=document.getElementById("go");f&&(f.disabled=!p.target.checked)}},{control:"action",onChange:({e:p})=>{const f=document.getElementById("replace"),h=ac(f,"field");h&&(h.style.display=p.target.value==="upload"?"block":"none");const m=document.getElementById("go");m&&(m.disabled=o.action.value==="upload")}}],u=[{label:"-- select action --",close:!0},r&&{label:"Upload tournament",value:"upload",close:!0},t&&{label:"Delete tournament",disabled:!a,value:"delete",close:!0},t&&!r&&n?.provider&&{label:"Claim tournament",value:"claim",close:!0},r&&!e&&{label:"Go offline - standalone mode",value:"goOffline",close:!0},r&&e&&{label:"Go online - exit standalone mode",value:"goOnline",close:!0},t&&s&&{label:"Export UTR matches",value:"utrExport"},t&&s&&{label:"Export TODS file",value:"todsExport"}].filter(Boolean);if(u.length<2)return Pt({message:"No actions available"});Jr({title:"Tournament actions",content:p=>o=Sr(p,[{label:"Action",field:"action",options:u},{label:"Replace tournament on server",field:"replace",visible:!1,checkbox:!0,id:"replace"}],c),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Go",id:"go",intent:"is-danger",disabled:!0,onClick:l,close:!0}]})}function $G({postMutation:t,state:e,offline:i}){const r={...Ge.getTournamentTimeItem({itemType:"TMX"})?.timeItem?.itemValue};i?r.offline={email:e.email}:delete r.offline,Nt({methods:[{method:Gut,params:{removePriorValues:!0,timeItem:{itemType:"TMX",itemValue:r}}}],callback:t})}function rNe(){const t=!window.location.host.startsWith("localhost");!window.location.host.endsWith("github.io")&&t&&window.dev&&(delete window.dev,console.log("%c dev cancelled","color: cyan"))}function agt(){const{tournamentRecord:t}=Ge.getTournament();if(!t)return;const i=[{label:"Cancel",intent:"none"},{label:ZI,intent:"is-warning",onClick:iNe,close:!0},{label:"TODS",intent:"is-primary",onClick:()=>{t?tNe(`${t.tournamentId}.tods.json`,t):Pt({message:"Error"})},close:!0}],r=`${Rm.tr("phrases.export")}: ${Rm.tr("trn")}`;Jr({title:r,content:t.tournamentName,buttons:i})}function sgt(t){t.getElement().style.border="1px solid black";const e=t.getValue(),i=document.createElement("div");return i.innerHTML=e||"",i}function GE(t){const{e,table:i,classNames:r=[],className:n,visible:a,columns:s}=t,o=ac(e.target,"options_right"),l=a?"":jt,c=a?jt:"";if(o)for(const u of o.children){const d=n?Array.from(u.classList).includes(n):Array.from(u.classList).some(p=>r.includes(p));u.style.display=d?l:c}for(const u of s)i.updateColumnDefinition(u,{formatter:a?sgt:void 0,editable:a})}function ogt(t,e){GE({columns:["ratings.wtn.wtnRating","ratings.utr.utrRating"],className:"saveRatings",visible:!0,table:e,e:t}),e.showColumn("ratings.utr.utrRating"),e.showColumn("ratings.wtn.wtnRating"),e.redraw(!0)}const lgt=(t,e)=>t.groups?.find(i=>i.participantRoleResponsibilities?.includes(e))?.participantName,cgt=t=>lgt(t,"CLUB"),nNe=(t,e)=>(t.events||[]).map(({eventId:i})=>e?.[i]),aNe=t=>vg.countries.find(e=>e.ioc===t||e.iso===t)?.label||"",H3=/[\p{Lu}]/u,ugt=/[\p{Ll}]/u,dgt=/^[\p{Lu}](?![\p{Lu}])/u,PN=/[_.\- ]+/,sNe=/([\p{Alpha}\p{N}_]|$)/u,pgt=new RegExp("^"+PN.source),fgt=new RegExp(PN.source+sNe.source,"gu"),hgt=new RegExp(String.raw`\d+`+sNe.source,"gu"),mgt=(t,e,i,r)=>{let n=!1,a=!1,s=!1,o=!1;for(let l=0;l<t.length;l++){const c=t[l];o=l>2?t[l-3]==="-":!0,n&&H3.test(c)?(t=t.slice(0,l)+"-"+t.slice(l),n=!1,s=a,a=!0,l++):a&&s&&ugt.test(c)&&(!o||r)?(t=t.slice(0,l-1)+"-"+t.slice(l-1),s=a,a=!1,n=!0):(n=e(c)===c&&i(c)!==c,s=a,a=i(c)===c&&e(c)!==c)}return t},Agt=(t,e)=>t.replace(dgt,i=>e(i)),ggt=(t,e,i)=>{let r="",n=!1,a=!1;const s=[...t];for(let o=0;o<s.length;o++){const l=s[o],c=H3.test(l),u=o+1<s.length&&H3.test(s[o+1]);n&&/[\p{Alpha}]/u.test(l)?(r+=l,n=!1,a=c):i&&c&&(a||u)?(r+=l,a=!0):/\d/.test(l)?(r+=l,n=!0,a=!1):PN.test(l)?(r+=l,a=!1):(r+=e(l),n=!1,a=!1)}return r},vgt=(t,e,{capitalizeAfterNumber:i})=>{const r=i?(n,a,s,o)=>{const l=o.charAt(s+n.length);return PN.test(l)?n:a?n.slice(0,-a.length)+e(a):n}:n=>n;return t.replaceAll(hgt,r).replaceAll(fgt,(n,a)=>e(a))};function ygt(t,e){if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,capitalizeAfterNumber:!0,...e},Array.isArray(t)?t=t.map(s=>s.trim()).filter(s=>s.length>0).join("-"):t=t.trim(),t.length===0)return"";const i=t.match(/^[_$]*/)[0];if(t=t.slice(i.length),t.length===0)return i;const r=e.locale===!1?s=>s.toLowerCase():s=>s.toLocaleLowerCase(e.locale),n=e.locale===!1?s=>s.toUpperCase():s=>s.toLocaleUpperCase(e.locale);return t.length===1?PN.test(t)?i:i+(e.pascalCase?n(t):r(t)):(t!==r(t)&&(t=mgt(t,r,n,e.preserveConsecutiveUppercase)),t=t.replace(pgt,""),e.capitalizeAfterNumber?t=e.preserveConsecutiveUppercase?Agt(t,r):r(t):t=ggt(t,r,e.preserveConsecutiveUppercase),e.pascalCase&&t.length>0&&(t=n(t[0])+t.slice(1)),i+vgt(t,n,e))}const{WTN:bgt,UTR:Igt}=Qn.ratingConstants,{SINGLES:Nne}=Qn.eventConstants,wgt=(t,e)=>{const{participantId:i,participantName:r,participantType:n,person:a}=t,{standardFamilyName:s,standardGivenName:o}=a||{},l=t.person?.addresses?.[0],c=l?.city&&l?.state?`${l.city}, ${l.state}`:void 0,u=t.ratings?.[Nne]?.find(f=>f.scaleName===Igt)?.scaleValue,p={wtn:t.ratings?.[Nne]?.find(f=>f.scaleName===bgt)?.scaleValue,utr:u};return{searchText:`${r} ${o} ${s}`.toLowerCase(),sex:ygt(t.person.sex||"",{pascalCase:!0}),eventIds:t.events.map(({eventId:f})=>f),ioc:aNe(t.person?.nationalityCode),events:nNe(t,e),penalties:t.penalties||[],tennisId:t.person.tennisId,signedIn:t.signedIn,lastName:s,firstName:o,club:cgt(t),teams:t.teams,participantName:r,participantType:n,participantId:i,participant:t,cityState:c,ratings:p}},kf=t=>(e,i)=>{const r=e.getDefinition();return t.includes(r.field)?"":i==="asc"&&"<div><i class='fas fa-sort-up'></div>"||i==="desc"&&"<div><i class=' fas fa-sort-down'></div>"||"<div><i class='fas fa-sort'></div>"},{MALE:Sgt,FEMALE:Ugt}=Fh,{PAIR:Tgt}=io,Bb=t=>(e,i,r)=>{const n=e.getColumn().getDefinition(),a=n.field==="side1"&&1||n.field==="side2"&&2,s=document.createElement("div"),o=e.getRow().getData(),l=o.winningSide,c=e.getValue(),u=o.participant||c?.participant||o.person&&o;if(u){const d=$t.scales[$t.activeScale],p=h=>J1e({eventHandlers:{participantClick:m=>Mt(t)&&t({...m,event:m.pointerEvent,cell:e})},composition:{theme:"default",configuration:{participantDetail:"TEAM",genderColor:!0,winnerColor:!0,scaleAttributes:d,flag:!1}},sideContainer:s?!0:void 0,matchUp:o.matchUp,participant:h,placeholder:i,sideNumber:a||void 0}),f=h=>{const m=document.createElement("div");return m.className="flexrow flexjustifystart",h.individualParticipants?.forEach((A,g)=>{if(m.appendChild(p(A)),!g){const v=document.createElement("span");v.style.width="1em",v.innerHTML="&nbsp;",m.appendChild(v)}}),m};return r==="sideBySide"&&u.participantType===Tgt?f(u):p(u)}if(l){const d=n.field===o.winningSide;s.style.color=d?"green":"red"}else{const d=c?.sex||o?.person?.sex,p=d===Sgt&&"#2E86C1"||d===Ugt&&"#AA336A"||"";s.style.color=p}return s.innerHTML=(Ad(c)?c.participantName:c)||"",s};function Cgt(t){return t.getValue()?.length||0}function AC(t,e){const i=t?.person||t?.participant?.person,r=e?.person||e?.participant?.person;return i||r?i?.standardFamilyName&&!r?.standardFamilyName||r?.standardFamilyName&&!i?.standardFamilyName||!i?.standardFamilyName&&!r?.standardFamilyName?1:i.standardFamilyName?.localeCompare(r?.standardFamilyName):t.participantName&&!e.participantName||e.participantName&&!t.participantName||!t?.participantName&&!e?.participantName?1:t?.participantName?.localeCompare(e?.participantName)}async function oNe({participantIds:t,participantId:e,callback:i}){(e||t)&&Nt({methods:[{params:{participantIds:t||[e]},method:qut}],callback:a=>{a.success?Mt(i)&&i&&i(a):console.log({result:a})}})}const{COMPETITOR:Egt,OFFICIAL:Bne}=Yg,{INDIVIDUAL:Dgt}=io;function lNe({participant:t,view:e,callback:i}){const r=vg.countries.map(m=>({label:vg.countryToFlag(m.iso||"")+" "+m.label,value:m.ioc})),n={nationalityCode:t?.person?.nationalityCode,firstName:t?.person?.standardGivenName,lastName:t?.person?.standardFamilyName,birthDate:t?.person?.birthDate,sex:t?.person?.sex};let a;const s=m=>n.nationalityCode=m,o=({firstName:m,lastName:A})=>fi.nameValidator(2)(m||"")&&fi.nameValidator(2)(A||""),l=({inputs:m})=>{const A=o({firstName:m.firstName.value,lastName:m.lastName.value}),g=document.getElementById("saveParticipant");g&&(g.disabled=!A)},c=[{onInput:l,control:"firstName"},{onInput:l,control:"lastName"}],u=m=>{a=Sr(m,[{error:"Please enter a name of at least 3 characters",value:n.firstName||"",validator:fi.nameValidator(2),placeholder:"Given name",label:"First name",field:"firstName",focus:!0},{error:"Please enter a name of at least 3 characters",value:n.lastName||"",validator:fi.nameValidator(2),placeholder:"Family name",label:"Last name",field:"lastName"},{value:void 0,label:"Sex",field:"sex",options:[{label:"Unknown",value:void 0,selected:!n.sex},{label:"Male",value:"MALE",selected:n.sex==="MALE"},{label:"Female",value:"FEMALE",selected:n.sex==="FEMALE"}]},{placeholder:"Birthday",value:n.birthDate||"",label:"Date of birth",field:"birthday",date:!0},{typeAhead:{list:r,callback:s},placeholder:"Country of origin",value:n.nationalityCode||"",field:"nationalityCode",label:"Country"}],c)},d=(m,A)=>uv(m,[{label:"Cancel",close:!0},{disabled:!o(n),onClick:f,id:"saveParticipant",intent:"is-info",label:"Save",close:!0}],A),p=t?"Edit":"New";ot.drawer.open({title:`<b style='larger'>${p} participant</b>`,callback:()=>{},width:"300px",side:Ht,content:u,footer:d});function f(){if(t?.participantId){const m={nationalityCode:a.nationalityCode.value,standardFamilyName:a.lastName.value,standardGivenName:a.firstName.value,birthdate:a.birthday.value,sex:a.sex.value},A=[{params:{participant:{participantId:t.participantId,person:m}},method:nO}];Nt({methods:A,callback:v=>{v.success?Mt(i)&&i():console.log(v)}})}else h()}function h(){const m=a.firstName.value,A=a.lastName.value,g=a.sex.value,v={participantRole:e===Bne?Bne:Egt,participantType:Dgt,participantId:Ri.UUID(),person:{nationalityCode:n.nationalityCode,standardGivenName:m,standardFamilyName:A,sex:g}};Nt({methods:[{params:{participants:[v]},method:TN}],callback:I=>{I.success&&Mt(i)&&i(),I.success||console.log(I)}})}return{...qR}}function Pgt({participantId:t,callback:e}){const i=Ge.getParticipants({participantFilters:{participantIds:[t]},inContext:!1}).participants?.[0];if(i)return lNe({participant:i,callback:e,view:void 0})}const dx=t=>(e,i)=>{const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(u=>u.remove());return}const n=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],a=i.getRow(),s=a.getData(),{participantId:o,participantType:l}=s;nl({items:[{hide:l!=="INDIVIDUAL",text:"<i class='fas fa-address-card'></i> Participant profile",onClick:()=>console.log("Participant profile",i.getData()?.participant)},{hide:l!=="INDIVIDUAL",text:"<i class='fas fa-user'></i> Edit Participant",onClick:()=>{Pgt({participantId:o,callback:t})}},{text:"<div style='color: red'><i class='fas fa-check-square'></i> Delete participant</div>",onClick:()=>{oNe({participantId:o,callback:d=>{if(d.success)a.delete();else{const p=i.getTable();p.alert(d.error.message||"Cannot Remove Participant"),setTimeout(()=>p.clearAlert(),2500)}}})}}],target:n||e.target,config:{placement:wd}})},{SINGLES:Rgt}=Ul,cNe=t=>e=>{e.getColumn().getDefinition();const i=document.createElement("div");i.className="tags";const r=e.getValue(),n=e.getRow().getData(),{participantId:a}=n,s=(o,l)=>o?.eventName?.localeCompare(l?.eventName);return r.sort(s).forEach(o=>{const l=uNe({participantId:a,event:o,eventClick:t});i.appendChild(l)}),i};function uNe({matchUpId:t,participantId:e,event:i,eventClick:r}){const n=document.createElement("span");return Mt(r)&&r&&(n.onclick=()=>r({eventId:i.eventId,participantId:e,matchUpId:t})),n.className="tag event-pill",i.gender?.toLowerCase().includes("female")?n.classList.add("is-danger"):i.gender?.toLowerCase().includes("male")?n.classList.add("is-link"):n.classList.add("is-primary"),i.eventType===Rgt&&n.classList.add("is-light"),n.innerHTML=i.eventName,n}const Mgt=t=>e=>{e.getColumn().getDefinition();const i=e.getRow().getData(),{matchUpId:r}=i,n=document.createElement("div");n.className="tags";const a=uNe({matchUpId:r,event:i,eventClick:t});return n.append(a),n},dNe=t=>e=>{const i=e.getColumn().getDefinition(),r=document.createElement("div");r.className="tags";const n=e.getValue(),a=(s,o)=>s?.participantName?.localeCompare(o?.participantName);return n.sort(a).forEach(s=>{const o=Ngt({matchUpId:i.matchUpId,team:s,teamClick:t});r.appendChild(o)}),r};function Ngt({matchUpId:t,team:e,teamClick:i}){const r=document.createElement("span"),{participantId:n,participantName:a}=e;return Mt(i)&&i&&(r.onclick=()=>i({participantId:n,matchUpId:t})),r.className="tag event-pill",r.innerHTML=a,r}const pO=({maxValue:t,decimals:e,field:i})=>(r,n,a)=>{const s=e?/[^0-9.]/g:/^\D/g,o=document.createElement("input");o.style.backgroundColor="lightyellow",o.style.boxSizing="border-box",o.style.textAlign="center",o.style.padding="3px",o.style.height="100%",o.style.width="100%",o.value=r.getValue()||"",n(()=>{o.focus(),o.select()});function l(){let c=o.value;e&&(c=parseFloat(c).toFixed(2)),a(isNaN(c)?void 0:c)}return o.addEventListener("keydown",c=>{c.key==="Tab"&&(c.preventDefault(),c.stopPropagation())}),o.addEventListener("keyup",c=>{const u=c.target.value.replace(s,"")||"";if(c.target.value=u>t?"":u,c.key==="Tab"&&c.shiftKey&&i){const p=ac(c.target,"tabulator-row")?.previousSibling,f=p&&Mg(p,"tabulator-editable");if(f)for(r of f)r.getAttribute("tabulator-field")===i&&r.focus()}else if((c.key==="Enter"||c.key==="Tab")&&i){const p=ac(c.target,"tabulator-row")?.nextSibling,f=p&&Mg(p,"tabulator-editable");if(f)for(r of f)r.getAttribute("tabulator-field")===i&&r.focus()}}),o.addEventListener("blur",l),o},kne=t=>ot.columns[t]!==!1;function _n({eventId:t,drawId:e,structureId:i,renderDraw:r,participantId:n,matchUpId:a,view:s}){const o=Ge.getTournament()?.tournamentRecord?.tournamentId,l=t&&Ge.getEvent({eventId:t,drawId:e}).event,c=l?.drawDefinitions?.length===1&&l.drawDefinitions[0];n&&c&&(e=c.drawId,r=!0),a&&(e=l.drawDefinitions.find(({drawId:d})=>Ge.allDrawMatchUps({drawId:d,inContext:!1}).matchUps.find(f=>f.matchUpId===a))?.drawId,r=!!e);let u=`/${js}/${o}/${Xb}/${t}`;r&&e?(u+=`/${DD}/${e}`,i&&(u+=`/${a4}/${i}`),[c4,kT,BT].includes(s||"")&&(u+=`/${s4}/${s}`)):e&&(u+=`/${ybe}/${e}`),ot.router.navigate(u),ot.router.resolve()}const dv=()=>"<i class='fa fa-ellipsis-vertical'></i>",{SIGNED_IN:Bgt,SIGNED_OUT:kgt}=io;function xgt(t,e){const i=e.getRow().getData().participantId,r=!e.getValue();Nt({methods:[{params:{signInState:r?Bgt:kgt,participantIds:[i]},method:uZ}],callback:o=>{o.success&&e.setValue(r)}})}const _gt=({field:t})=>(e,i,r)=>{const n=document.createElement("input");n.style.backgroundColor="lightyellow",n.style.boxSizing="border-box",n.style.textAlign="center",n.style.padding="3px",n.style.height="100%",n.style.width="100%",n.value=e.getValue()||"",i(()=>{n.focus(),n.select()});function a(){const s=n.value;r(s)}return n.addEventListener("keydown",s=>{s.key==="Tab"&&(s.preventDefault(),s.stopPropagation())}),n.addEventListener("keyup",s=>{if(s.key==="Tab"&&s.shiftKey&&t){const l=ac(s.target,"tabulator-row")?.previousSibling,c=l&&Mg(l,"tabulator-editable");if(c)for(e of c)e.getAttribute("tabulator-field")===t&&e.focus()}else if((s.key==="Enter"||s.key==="Tab")&&t){const l=ac(s.target,"tabulator-row")?.nextSibling,c=l&&Mg(l,"tabulator-editable");if(c)for(e of c)e.getAttribute("tabulator-field")===t&&e.focus()}}),n.addEventListener("blur",a),n},HG="fa-check-square",TA=t=>(e,i)=>{const r=i.getTable(),n=r.getColumns(),a=[];for(const s of n){const o=s.getDefinition();if(o.title){const l=document.createElement("i");l.classList.add("fas"),l.classList.add(s.isVisible()?HG:"fa-square");const c=document.createElement("span"),u=document.createElement("span"),d=t?.[o.field]||o.displayTitle||o.title;u.textContent=" "+d,c.appendChild(l),c.appendChild(u),a.push({label:c,action:function(p){p.stopPropagation(),s.toggle(),ot.columns[s.getField()]=s.isVisible(),r.redraw(),s.isVisible()?(l.classList.remove("fa-square"),l.classList.add(HG)):(l.classList.remove(HG),l.classList.add("fa-square"))}})}}return a},{WTN:Ogt,UTR:Fgt}=Qn.ratingConstants,{FEMALE:Lgt,MALE:$gt}=Fh,xne="ratings.utr.utrRating",_ne="ratings.wtn.wtnRating";function Hgt({data:t,replaceTableData:e}){const i=t.some(s=>s.cityState),r=t.some(s=>s.tennisId),n=t.some(s=>s.ratings?.utr),a=t.some(s=>s.ratings?.wtn);return[{cellClick:(s,o)=>o.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ii,width:5},{headerMenu:TA({signedIn:"Sign In Status",sex:"Gender"}),formatter:"rownum",headerSort:!1,hozAlign:ii,width:55},{formatter:Bb(({event:s,cell:o})=>dx(e)(s,o)),cellClick:dx(e),sorter:AC,field:"participant",responsive:!1,resizable:!1,minWidth:200,widthGrow:2,title:"Name"},{editor:_gt({field:"tennisId"}),visible:r,field:"tennisId",editable:!1,title:"WTID",width:120},{headerFilter:"input",title:"First Name",field:"firstName",visible:!1,width:150},{headerFilter:"input",title:"Last Name",field:"lastName",visible:!1,width:150},{title:'<i class="fa-solid fa-venus-mars" />',field:"sex",hozAlign:ii,editor:"list",width:80,editorParams:{itemFormatter:(s,o)=>o,values:{Male:$gt,Female:Lgt,"":"Unknown"}}},{title:"Country",field:"ioc",width:130,visible:!1,headerFilter:"input"},{title:"<div class='fa-solid fa-check' style='color: green' />",cellClick:xgt,formatter:"tickCross",resizable:!1,field:"signedIn",hozAlign:ii,tooltip:!1,width:40},{sorter:(s,o)=>(s.length||0)-(o?.length||0),formatter:Cgt,title:"Penalties",field:"penalties",hozAlign:ii,visible:!1,width:130},{headerFilter:"input",title:"Club",field:"club",hozAlign:ii,minWidth:70,editor:!1,visible:!1},{sorter:(s,o)=>s?.[0]?.eventName?.localeCompare(o?.[0]?.eventName),formatter:cNe(_n),visible:kne("events"),title:"Events",field:"events",hozAlign:ii,minWidth:200,editor:!1,widthGrow:2},{sorter:(s,o)=>s?.[0]?.participantName?.localeCompare(o?.[0]?.participantName),formatter:dNe(()=>console.log("boo")),visible:kne("teams"),title:"Teams",field:"teams",hozAlign:ii,minWidth:200,editor:!1,widthGrow:2},{visible:!!i,title:"City/State",field:"cityState",minWidth:110},{editor:pO({maxValue:40,decimals:!0,field:_ne}),sorterParams:{alignEmptyValues:"bottom"},responsive:!0,resizable:!1,sorter:"number",field:_ne,editable:!1,visible:!!a,title:Ogt,width:70},{editor:pO({maxValue:16,decimals:!0,field:xne}),sorterParams:{alignEmptyValues:"bottom"},responsive:!0,resizable:!1,sorter:"number",field:xne,editable:!1,visible:!!n,title:Fgt,width:70},{cellClick:dx(e),formatter:dv,responsive:!1,headerSort:!1,hozAlign:Ht,maxWidth:40}]}const{INDIVIDUAL:Vgt,GROUP:Ggt,TEAM:Qgt}=io,{OFFICIAL:One,COMPETITOR:jgt}=Yg;function zgt({view:t}={}){let e,i=[],r,n,a=[],s;const o={participantRoles:[t===One?One:jgt]},l=()=>{({participants:r=[],derivedEventInfo:n}=Ge.getParticipants({withSignInStatus:!0,withScaleValues:!0,participantFilters:o,withEvents:!0,withISO2:!0}));const m=r.filter(({participantType:A})=>A===Vgt);return i=r.filter(({participantType:A})=>A===Ggt),a=r.filter(({participantType:A})=>A===Qgt),m?.map(A=>wgt(A,n))||[]},c=()=>{const h=l(),m=h?.some(y=>y.cityState),A=h?.some(y=>y.tennisId),g=h?.some(y=>y.ratings?.utr),v=h?.some(y=>y.ratings?.wtn);m&&e?.showColumn("cityState"),A&&e?.showColumn("tennisId"),g&&e?.showColumn("ratings.utr.utrRating"),v&&e?.showColumn("ratings.wtn.wtnRating"),setTimeout(()=>e.replaceData(h),s?0:1e3)},u=l(),d=Hgt({data:u,replaceTableData:c}),p=(h,m)=>(Ri.isNumeric(h)&&h||0)+(Ri.isNumeric(m)&&m||0);return(h=>{UA({anchorId:a_});const m=document.getElementById(a_),A=ac(m,"section")?.querySelector(".tabHeader");e=new es(m,{headerSortElement:kf(["sex","signedIn","events","teams","ratings.wtn.wtnRating","ratings.utr.utrRating","cityState","tennisId"]),height:window.innerHeight*.86,placeholder:"No participants",index:"participantId",layout:"fitColumns",reactiveData:!0,columns:d,data:h});const g=v=>`Participants (${v.length})`;e.on("dataChanged",v=>A&&(A.innerHTML=g(v))),e.on("dataFiltered",(v,b)=>{A&&(A.innerHTML=g(b));const y=[],I=[];for(const C of b){const E=C.getData(),{wtn:P,utr:R}=E.ratings;Ri.isNumeric(R?.utrRating)&&I.push(parseFloat(R.utrRating)),Ri.isNumeric(P?.wtnRating)&&y.push(parseFloat(P.wtnRating))}const w=I.reduce(p,0),S=y.reduce(p,0),T=(I.length?w/I.length:0).toFixed(2),D=(y.length?S/y.length:0).toFixed(2);$t.averages&&console.log(`UTR ${T}x`),$t.averages&&console.log(`WTN ${D}x`)}),e.on("scrollVertical",Kd),e.on("tableBuilt",()=>s=!0)})(u),{table:e,replaceTableData:c,teamParticipants:a,groupParticipants:i}}function qgt(t,e){GE({className:"saveTennisId",columns:["tennisId"],visible:!0,table:e,e:t}),e.showColumn("tennisId"),e.redraw(!0)}function Wgt(t,e){GE({columns:["ratings.wtn.wtnRating","ratings.utr.utrRating"],classNames:["saveRatings","saveTennisId"],visible:!1,table:e,e:t}),e.showColumn("ratings.utr.utrRating"),e.showColumn("ratings.wtn.wtnRating"),e.redraw(!0);const r=e.getData().flatMap(a=>{const s=a.ratings?.wtn,o=s?.wtnRating,l=s?.confidence||o?50:0;let c=l?{...s,wtnRating:o,confidence:l}:"";const u={method:Zre,params:{participantId:a.participantId,removePriorValues:!0,timeItem:{itemType:"SCALE.RATING.SINGLES.WTN",itemValue:c}}},d=a.ratings?.utr?.utrRating,p=d?50:0;c=p?{utrRating:d,confidence:p}:"";const f={method:Zre,params:{participantId:a.participantId,removePriorValues:!0,timeItem:{itemType:"SCALE.RATING.SINGLES.UTR",itemValue:c}}};return[u,f]});Nt({methods:r,callback:a=>{a.success||console.log(a)}})}const{COMPETITOR:Kgt,OTHER:Ygt}=Yg,{TEAM:Fne}=io;function pNe({individualParticipantIds:t,participantType:e=Fne,title:i="Edit team",participant:r,refresh:n,table:a}){const s="participantName",o={[s]:r?.[s]};let l;const c=()=>{},u=h=>{l=Sr(h,[{error:"Please enter a name of at least 3 characters",placeholder:"Participant name",value:o[s]||"",validator:fi.nameValidator(3),field:s,onChange:c,label:"Name"}])},d=(h,m)=>uv(h,[{label:"Cancel",onClick:()=>a?.deselectRow(),close:!0},{label:"Save",onClick:p,close:!0,intent:"is-info"}],m);ot.drawer.open({title:`<b style='larger'>${i}</b>`,callback:()=>{},width:"300px",side:Ht,content:u,footer:d});function p(){a?.deselectRow(),r?.participantId?console.log("update existing"):f()}function f(){const h=e===Fne?Kgt:Ygt,m={individualParticipantIds:t||r?.individualParticipantIds||[],participantName:l[s]?.value,participantRole:h,participantType:e};Nt({methods:[{params:{participants:[m]},method:TN}],callback:v=>{v.success?Mt(n)&&n?.():console.log({result:v})}})}return{...qR}}const{TEAM:VG}=io;function Lne({participants:t,table:e,replaceTableData:i,participantType:r=VG}){const n=({team:o})=>{const c=e.getSelectedData().map(({participantId:p})=>p);e.deselectRow();const u=[{method:JRe,params:{groupingParticipantId:o.participantId,individualParticipantIds:c}}];Nt({methods:u,callback:p=>{p.success&&i()}})},a=()=>{const o=r===VG?"New team":"New Group",c=e.getSelectedData().map(({participantId:u})=>u);pNe({refresh:i,individualParticipantIds:c,participantType:r,participant:{},table:e,title:o})},s=r===VG?"Create new team":"Create new group";return{options:t.map(o=>({onClick:()=>n({team:o}),label:o.participantName,participant:o,close:!0})),actions:[{onClick:()=>a(),close:!0,label:s}]}}const Xgt=t=>e=>{if(e.key==="Enter"){const r=t.getSelectedData().map(({participantId:o})=>o),s=t.getData("active").map(({participantId:o})=>o).filter(o=>!r.includes(o));s.length===1&&(t.selectRow(s),e.target.value="",t.clearFilter())}};function Zgt(t,e){GE({classNames:["saveTennisId","saveRatings"],columns:["tennisId"],visible:!1,table:e,e:t}),e.showColumn("tennisId"),e.redraw(!0);const i=Ge.getParticipants().participantMap,n=e.getData().map(a=>{const{tennisId:s,participantId:o}=a;if(s!==i[o].participant.person.tennisId)return{params:{participant:{participantId:o,person:{tennisId:s}}},method:nO}}).filter(Boolean);n.length&&Nt({methods:n,callback:s=>{s.success||console.log(s)}})}function fNe(t){let e;const i=l=>e===jt?!l?.eventIds?.length:l?.eventIds?.includes(e),r=l=>{t.removeFilter(i),e=l,l&&t.addFilter(i)},n=Ge.getEvents().events||[],a={label:`<span style='font-weight: bold'>${yg}</span>`,onClick:()=>r(),close:!0},s={label:`<span style='font-weight: bold'>${dqe}</span>`,onClick:()=>r(jt),close:!0};return{eventOptions:[a,s,{divider:!0}].concat(n.map(l=>({onClick:()=>r(l.eventId),label:l.eventName,close:!0}))),events:n}}function Jgt({callback:t}){const e=Ge.getTournamentInfo()?.tournamentInfo||{},i=e.endDate||e.startDate;qst({consideredDate:i,callback:r=>{Nt({methods:[{method:TN,params:{participants:r}}],callback:t})}})}function evt({callback:t}){const e=n=>{const a=n?.players;a?.length?tvt(a):a&&!a.length&&ot.modal.inform({message:"Sheet Empty: No Player Rows"}),Mt(t)&&t&&t()},{extension:i}=Ge.findExtension({discover:!0,name:th.REGISTRATION});i?.value||Jgt({callback:e})}function tvt(t){console.log({registeredPlayers:t})}function ivt({table:t,teamParticipants:e}){let i;const r=o=>o.teams.some(l=>l?.participantId===i),n=o=>{t.removeFilter(r),i=o,o&&t.addFilter(r)};return{teamOptions:[{label:`<span style='font-weight: bold'>${pqe}</span>`,onClick:()=>n(),close:!0},{divider:!0}].concat(e.sort((o,l)=>o?.participantName?.localeCompare(l?.participantName)).map(o=>({onClick:()=>n(o.participantId),label:o.participantName,close:!0})))}}function hNe(t){const i=t.getSelectedData().filter(n=>!n.events?.length).map(({participantId:n})=>n),r=()=>{oNe({participantIds:i,callback:a=>{a.success&&(t.deleteRow(i),t.deselectRow())}})};Jr({content:`Delete ${i.length} participants?`,onClose:()=>t.deselectRow(),title:"Delete participants",buttons:[{label:"Cancel",intent:jt,close:!0},{label:"Delete",id:"deleteDraw",intent:"is-danger",close:!0,onClick:r}]})}const{FEMALE:$ne,MALE:Hne,ANY:Vne}=Fh;function rvt(t){let e;const i=l=>l.participant?.person?.sex===e,r=l=>{t.removeFilter(i),e=l,l&&t.addFilter(i)},n=[Hne,$ne],a={[Hne]:"Male",[$ne]:"Female",[Vne]:n4};return{sexOptions:[{label:`<span style='font-weight: bold'>${a[Vne]}</span>`,onClick:()=>r(),close:!0},{divider:!0}].concat(n.map(l=>({onClick:()=>r(l),label:a[l],close:!0}))),genders:a}}const{SIGNED_IN:nvt}=io;function avt(t){const e=t.getSelectedData(),i=e.map(({participantId:a})=>a);Nt({methods:[{params:{signInState:nvt,participantIds:i},method:uZ}],callback:a=>{a.success&&(e.forEach(s=>s.signedIn=!0),t.updateData(e),t.deselectRow())}})}const{INDIVIDUAL:svt,SIGNED_OUT:ovt}=io;function lvt(t){const i=Ge.getParticipants({participantFilters:{participantTypes:[svt]},withSignInStatus:!0,withEvents:!0}).participants.filter(a=>a.signedIn&&!a.events.length).map(a=>a.participantId);Nt({methods:[{params:{signInState:ovt,participantIds:i},method:uZ}],callback:a=>{a.success&&t()}})}function cvt(t){let e=0;if(t.length===0)return e;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);e=(e<<5)-e+r,e=e&e}return e}const VA={participantName:["full name","name"],participantId:["id","participantid"],person:{standardFamilyName:["last","last name","last_name"],standardGivenName:["first","First Name","first_name"],nationalityCode:["ioc","country","nationality"],address:{city:["city"],state:["state"]},birthDate:["*birth"],sex:["gender","sex"]}};function uvt({data:t,sheetId:e,callback:i}){const n=Ge.getParticipants().participants.map(({participantId:c})=>c),a=vg.countries.map(c=>[c.ioc,c.iso]).flat().filter(Boolean),s=[],o=c=>c.map(u=>[u.toLowerCase(),u.toLowerCase().split(" ").join("")]).flat(),l=c=>(u=[])=>{const d=Object.keys(c),p=o(u),f=p.reduce((m,A)=>c[A]||m,void 0),h=!f&&d.filter(m=>p.find(A=>A.startsWith("*")&&m.toLowerCase().includes(A.slice(1))));return f||c[h[0]]};for(const c of t||[]){const u=Object.assign({},...Object.keys(c).map(D=>({[D.toLowerCase()]:c[D]}))),d=l(u),p={participantType:"INDIVIDUAL",participantRole:"COMPETITOR",person:{}};p.participantName=d(VA.participantName);const f=d(["tennis id","tennisid"]);f&&(p.person.tennisId=f);const h=d(VA.person.standardFamilyName),m=d(VA.person.standardGivenName);if(h&&m)p.person.standardFamilyName=h,p.person.standardGivenName=m,p.participantName=`${m} ${h}`;else continue;const A=d(VA.person.address.state),g=d(VA.person.address.city);(g||A)&&(p.person.addresses=[{city:g,state:A}]);const v=d(VA.person.nationalityCode);v&&a.includes(v.toUpperCase())&&(p.person.nationalityCode=v);const b=d(VA.person.birthDate);if(Ri.dateTime.dateValidation.test(b)){const D=Ri.dateTime.extractDate(b);D&&(p.person.birthDate=D)}const y=d(VA.person.sex);if(y){const D=y.toUpperCase();["MALE","FEMALE"].includes(D)?p.person.sex=D:["F","W","G"].includes(y[0])?p.person.sex="FEMALE":["M","B"].includes(y[0])&&(p.person.sex="MALE")}const I=d(["utr profile"]);if(I){p.onlineResources||(p.onlineResources=[]);const D=I.split("profiles/")?.reverse()[0];D&&(p.person.personOtherIds||(p.person.personOtherIds=[]),p.person.personOtherIds.push({uniqueOrganisationName:"UTR",personId:D}),I.startsWith("http")&&p.onlineResources.push({resourceSubType:"PROFILE",identifier:I,name:"UTR Profile",resource:"URL"}))}const w=d(["utr"]);if(w){p.timeItems||(p.timeItems=[]);const D={itemType:"SCALE.RATING.SINGLES.UTR",itemValue:{utrRating:w}};p.timeItems.push(D)}const S=d(["wtn"]);if(S){p.timeItems||(p.timeItems=[]);const D={itemType:"SCALE.RATING.SINGLES.WTN",itemValue:{wtnRating:S}};p.timeItems.push(D)}p.participantId=d(VA.participantId)||`XXX-${cvt(p.participantName)}`,n.includes(p.participantId)||s.push(Ri.definedAttributes(p))}s.length?Nt({methods:[{method:TN,params:{participants:s}},{method:Vut,params:{extension:{name:Abe,value:e}}}],callback:d=>{d.success?(Pt({message:`Added ${d.results[0].addedCount} participant(s)`,intent:"is-success"}),Mt(i)&&i&&i()):console.log(d)}}):Pt({message:"No new participants found",intent:"is-primary"}),Mt(i)&&i&&i()}const mNe=t=>![null,void 0].includes(t),ANe=({c:t})=>t.map(e=>mNe(e?.v)?e:{});function Gne({header:t,rows:e,useFormat:i=!1}){const r=c=>L_e(c)&&/Date\((\d+),(\d+),(\d+)\)/.test(c),n=c=>c.f||c.v,a=c=>i||r(c.v)?n(c):c.v,s=(c,u,d)=>({...c,[t[d]]:a(u)}),o=(c,u,d)=>mNe(u.v)?s(c,u,d):c,l=c=>c.reduce((u,d,p)=>o(u,d,p),{});return e.map(ANe).map(l)}function dvt(t){try{const e=t.split("setResponse(")[1].split(");")[0],i=JSON.parse(e),{cols:r,rows:n}=i.table??{},a=r.map(({label:s})=>s.split(" ")[0]);if(a.filter(Boolean).length)return Gne({header:a,rows:n});{const[s,...o]=n,l=ANe(s).map(c=>c.v);return console.log({header:l}),Gne({header:l,rows:o})}}catch(e){return console.error("Error parsing sheet response:",e),[]}}async function pvt({sheetId:t}){const e=`https://docs.google.com/spreadsheets/d/${t}/gviz/tq?`;try{const i=await window.fetch(e);return i?.ok?i.text():void 0}catch(i){console.error("Error fetching sheet:",i);return}}async function fvt({sheetId:t}){const e=await pvt({sheetId:t});return e?dvt(e):[]}const hvt=`
  <b>Sharing Requirements</b>
  <ul>
    <li>Open your Google Sheet</li>
    <li>Click "Share" button (top right)</li>
    <li>Set to "Anyone with the link can view"</li>
    <li>Copy the shareable link</li>
  </ul>
  <br> 
  <b>Required Columns</b>
  <ul>
    <li><strong>First Name</strong> (or "first", "first_name")</li>
    <li><strong>Last Name</strong> (or "last", "last_name")</li>
  </ul>
  <br> 
  <b>Optional Columns</b>
  <ul>
    <li><strong>id</strong> or <strong>participantid</strong> - Unique identifier</li>
    <li><strong>Gender</strong> or <strong>sex</strong> - MALE, FEMALE, M, F, W, B, G</li>
    <li><strong>Birth Date</strong> - Format: YYYY-MM-DD</li>
    <li><strong>IOC</strong>, <strong>country</strong>, or <strong>nationality</strong> - 3-letter country code</li>
    <li><strong>City</strong> - City of residence</li>
    <li><strong>State</strong> - State/province</li>
    <li><strong>Tennis ID</strong> - Official tennis organization ID</li>
    <li><strong>UTR</strong> - Universal Tennis Rating (numeric)</li>
    <li><strong>WTN</strong> - World Tennis Number (numeric)</li>
    <li><strong>UTR Profile</strong> - Link to UTR profile page</li>
  </ul>
  <br> 
  <b>Column Name Flexibility</b>
  <ul>
    <li>Column names are case-insensitive</li>
    <li>Spaces and underscores are treated the same</li>
    <li>Partial matches work</li>
  </ul>`;function mvt({callback:t}){const{extension:e}=Ge.findExtension({discover:!0,name:Abe}),i=e?.value;let r;const n=d=>{r=Sr(d,[{text:"Pull participants from a Google Sheet which has a shared link"},{placeholder:"URL of Google Sheet",value:i,label:"Sheet URL",field:"url"}])},a="Import participants",{update:s}=Jr({title:a,buttons:[],content:n}),o=()=>{const d=r.url.value;if(d){const p=d.split("/"),f=p.reduce((g,v)=>!g||v.length>g.length?v:g,void 0),h=!i||i&&f!==i,m=i||p.indexOf("docs.google.com")>0&&p.indexOf("spreadsheets")>0,A=h?f:i;if(m)m?fvt({sheetId:A}).then(g=>uvt({data:g,sheetId:A,callback:t})):Pt({message:"URL unchanged",intent:"is-info"});else{const g=Rm.tr("phrases.invalidsheeturl");Pt({message:g,intent:"is-danger"}),r.url.value=""}}},l=()=>{s({buttons:u,content:n,title:a})},u=[{label:"Cancel",intent:"is-nothing"},{label:"Info",intent:"is-info",onClick:()=>{s({buttons:[{label:"Close",intent:"is-nothing",close:!0},{label:"Enter",intent:"is-primary",onClick:l,close:!1}],title:"Google Sheets Import Instructions",content:hvt})},close:!1},{label:"Submit",intent:"is-primary",onClick:o,close:!0}];s({buttons:u})}const{ALTERNATE:Avt,WILDCARD:gvt,DIRECT_ACCEPTANCE:Qne,UNGROUPED:vvt}=Iu,{MAIN:jne,QUALIFYING:yvt}=Wn,{INDIVIDUAL:bvt}=io,{TEAM:zne,DOUBLES:Ivt}=Ul;function wvt({callback:t,eventName:e,eventType:i,participantType:r,participantIds:n}={}){const a=[zne,Ivt].includes(i)&&r===bvt;if(!n?.length){Pt({message:"Nothing to do",intent:"is-info"});return}const o=[{label:"Main",value:jne,selected:!0},{label:"Qualifying",value:yvt}].map(({label:p,value:f,selected:h})=>({selected:h,label:p,value:f})),l=[{hide:a,label:"Direct Acceptance",value:Qne,selected:!0},{hide:a,label:"Alternate",value:Avt},{hide:a,label:"Wildcard",value:gvt},{hide:r===zne,label:"Ungrouped",value:vvt,selected:a}];let c;Jr({title:"Add to event",content:p=>c=Sr(p,[{text:`Add ${n.length} participant to ${e}`},{options:o,label:"Event stage",field:"entryStage",value:jne},{options:l,value:Qne,label:"Entry status",field:"entryStatus"}]),buttons:[{label:"Cancel",intent:jt,close:!0},{label:"Add",intent:"is-info",close:!0,onClick:()=>{const p=c.entryStatus.value,f=c.entryStage.value;Mt(t)&&t&&t({entryStatus:p,entryStage:f})}}]})}function Svt(t){if(typeof t=="string")return{mismatchedGender:"Gender does not match event requirements",invalidAge:"Age outside category range",invalidRating:"Rating outside category range",age:"Age outside category range",rating:"Rating outside category range"}[t]||t;if(t.reason)return t.reason;const e=t.error;switch(e){case"mismatchedGender":return`Gender mismatch: ${t.sex} participant in ${t.expectedGender} event`;case"age":case"invalidAge":return t.reason||"Age outside category range";case"rating":case"invalidRating":return t.reason||"Rating outside category range";default:return t.message||e||"Validation error"}}function gNe({invalidParticipants:t}){if(!t?.length){console.error("No invalid participants provided");return}const e=t.some(c=>!c.participantName);let i;if(e){const c=t.filter(d=>!d.participantName).map(d=>d.participantId),{participants:u}=Ge.getParticipants({participantFilters:{participantIds:c},withIndividualParticipants:!0})??{};if(!u?.length&&c.length){console.error("Could not fetch participant details");return}i=new Map(u?.map(d=>[d.participantId,d])||[])}const r=t.map(c=>{let u=c.participantName;!u&&i&&(u=i.get(c.participantId)?.participantName||"Unknown Participant");const d=c.errors.map(p=>Svt(p)).join("; ");return{participantId:c.participantId,participantName:u,reasons:d}}),n=document.createElement("div");n.style.width="100%";const a=document.createElement("div");a.className="tmxTable",a.style.width="100%",n.appendChild(a);const s=[{title:"Participant",field:"participantName",widthGrow:2,headerSort:!1},{title:"Reason",field:"reasons",widthGrow:3,headerSort:!1}],o=new es(a,{columns:s,data:r,layout:"fitColumns",height:Math.min(300+r.length*40,600),placeholder:"No invalid participants"}),l=()=>{o?.destroy()};pf.open({title:"Invalid Participants",content:n,buttons:[{label:"OK",close:!0}],config:{maxWidth:800},onClose:l})}function vNe({event:t,participantType:e,table:i,callback:r}){const n=i.getSelectedData(),{eventId:a,eventName:s,eventType:o}=t,l=n.filter(u=>!u.events.map(d=>d.eventId).includes(a)).map(({participantId:u})=>u);if(!l.length&&n.length){Pt({message:`All selected participants are already in ${s}`,intent:"is-info"});return}wvt({callback:({entryStatus:u,entryStage:d}={})=>{i.deselectRow(),Nt({methods:[{params:{eventId:a,participantIds:l,entryStatus:u,entryStage:d,enforceGender:!0,enforceCategory:!0},method:oZ}],callback:h=>{if(h.success)Mt(r)&&r?.();else{const m=h.context;let A=[];if(m){if(m.categoryRejections?.length&&A.push(...m.categoryRejections.map(g=>({participantId:g.participantId,participantName:g.participantName,errors:[{error:g.rejectionReasons[0]?.type||"categoryRejection",reason:g.rejectionReasons[0]?.reason}]}))),m.mismatchedGender?.length){const g=m.gender;A.push(...m.mismatchedGender.map(v=>({participantId:v.participantId,errors:[{error:"mismatchedGender",sex:v.sex,expectedGender:g}]})))}m.invalidAge?.length&&A.push(...m.invalidAge.map(g=>({participantId:g.participantId,errors:[{error:"invalidAge",...g}]}))),m.invalidRating?.length&&A.push(...m.invalidRating.map(g=>({participantId:g.participantId,errors:[{error:"invalidRating",...g}]})))}A.length?(Wy(),setTimeout(()=>{gNe({invalidParticipants:A})},100)):h.misMatchedGender?Pt({intent:"is-danger",message:"Invalid gender"}):Pt({intent:"is-danger",message:h.error?.message||"Error adding participants"})}}})},eventName:s,participantType:e,eventType:o,participantIds:l})}const{ALTERNATE:Uvt,DIRECT_ACCEPTANCE:Tvt,UNGROUPED:Cvt,STRUCTURE_SELECTED_STATUSES:Evt}=Iu,{ANY:zb,FEMALE:nU,MALE:aU,MIXED:qb}=Fh,{DOUBLES:Sv,SINGLES:sU,TEAM:Uv}=Ul,{INDIVIDUAL:hD,PAIR:qne}=io,{MAIN:Dvt}=Wn;function FH({table:t,event:e,participants:i,callback:r}={}){const n=Ge.getEvents().events?.length||0,a=Ge.getTournamentInfo()?.tournamentInfo||{},s={eventName:e?.eventName||`Event ${n+1}`,startDate:e?.startDate??a.startDate,endDate:e?.endDate??a.endDate,ageCategoryCode:e?.category?.ageCategoryCode,eventType:e?.eventType||sU,gender:e?.gender||zb},o=e?.entries?.filter(({entryStatus:R})=>[...Evt,Uvt].includes(R)).map(({participantId:R})=>R),l=o?Ge.getParticipants({participantFilters:{participantIds:o},withIndividualParticipants:!0}).participants:[];let c,u;const d=i?.[0].participantType;if(i?.length){s.eventType=d===hD&&sU||d===qne&&Sv||Uv,d===hD&&(c=[sU,Sv,Uv]),d===qne&&(c=[Sv]),d===Uv&&(c=[Uv]);const R=d===hD&&Ri.unique(i.map(M=>M.participant?.person?.sex));u=[zb],R.length===1?(R[0]===nU&&u.push(nU),R[0]===aU&&u.push(aU),s.gender=R[0]):R.length>1&&u.push(qb)}const p=[],f=l.reduce((R,M)=>{const N=M.participantType===hD?[M.person.sex]:Ri.unique(M.individualParticipants?.map(k=>k.person?.sex)||[]);return p.push(N),R.includes(M.participantType)?R:R.concat(M.participantType)},[]),h=[];for(const R of[...l,...(i||[]).map(M=>M.participant)].filter(Boolean)){const M=R.timeItems?.filter(({itemType:N})=>N?.startsWith(`SCALE.RANKING.${s.eventType}`)).map(({itemType:N})=>N?.split(".").pop());h.push(M)}const m=Ri.unique(...h);if(m.length===1&&(s.ageCategoryCode=m[0]),p.length){u=[zb],e.gender&&e.gender!==zb&&u.push(e.gender),e.eventType===Sv&&!u.includes(qb)&&u.push(qb);const R=Ri.unique(...p);R.length===1&&!u.includes(R[0])&&u.push(...R)}else e&&(u=[zb,aU,qb,nU]);const A=Ge.getTournament().tournamentRecord,g=A?.tournamentCategories||[],v=()=>{const R=[{selected:["",void 0].includes(s.ageCategoryCode),label:"------------",value:""}];return g.length>0?g.forEach(M=>{const N=M.ageCategoryCode?`${M.categoryName} (${M.ageCategoryCode})`:M.categoryName;R.push({selected:s.ageCategoryCode===(M.ageCategoryCode||M.categoryName),label:N,value:M.ageCategoryCode||M.categoryName})}):R.push({selected:s.ageCategoryCode==="U10",label:"10 and Under",value:"U10"},{selected:s.ageCategoryCode==="U12",label:"12 and Under",value:"U12"},{selected:s.ageCategoryCode==="U14",label:"14 and Under",value:"U14"},{selected:s.ageCategoryCode==="U16",label:"16 and Under",value:"U16"},{selected:s.ageCategoryCode==="U18",label:"18 and Under",value:"U18"}),R.push({selected:!1,label:"Custom",value:"custom"}),R},b=()=>{},y=[{fields:["startDate","endDate"],minDate:a.startDate,maxDate:a.endDate,dateRange:!0}];let I;const w=R=>(I=Sr(R,[{error:"minimum of 5 characters",validator:fi.nameValidator(5),placeholder:"Event name",value:s.eventName,onChange:b,selectOnFocus:!0,label:"Event name",field:"eventName",focus:!0},{disabled:f.length,value:s.eventType,field:"eventType",label:"Format",options:[{hide:c&&!c.includes(sU),selected:s.eventType===sU,label:"Singles",value:sU},{hide:c&&!c.includes(Sv),selected:s.eventType===Sv,label:"Doubles",value:Sv},{hide:c&&!c.includes(Uv),selected:s.eventType===Uv,label:"Team",value:Uv}],onChange:b},{value:s.gender,label:"Gender",field:"gender",options:[{hide:u&&!u.includes(aU),selected:s.gender===aU,label:"Male",value:aU},{hide:u&&!u.includes(nU),selected:s.gender===nU,label:"Female",value:nU},{selected:s.gender===zb,label:"Any",value:zb},{hide:u&&!u.includes(qb),selected:s.gender===qb,label:"Mixed",value:qb}],onChange:b},{value:s.ageCategoryCode,field:"ageCategoryCode",label:"Category",options:v(),onChange:b},{value:e?.startDate??a.startDate,placeholder:"YYYY-MM-DD",label:"Start date",field:"startDate"},{value:e?.endDate??a.endDate,placeholder:"YYYY-MM-DD",label:"End date",field:"endDate"},{hide:e||i,divider:!0}],y),I),S=()=>{const R=ot.drawer.attributes.content.ageCategoryCode.value,M=ot.drawer.attributes.content.eventName.value,N=ot.drawer.attributes.content.startDate.value;if(!M||M.length<5){Pt({message:"Event name must be at least 5 characters",intent:"is-danger"});return}if(R==="custom"){const k=O=>{if(O?.ageCategoryCode){const x=A?.tournamentCategories||[];if(!x.some(_=>_.ageCategoryCode===O.ageCategoryCode||_.categoryName===O.categoryName)){const _=[...x,O];if(Ge.setTournamentCategories({categories:_}).success){if(I?.ageCategoryCode){const G=O.ageCategoryCode?`${O.categoryName} (${O.ageCategoryCode})`:O.categoryName,z=O.ageCategoryCode||O.categoryName,Q=I.ageCategoryCode.options.length-1,j=new Option(G,z);I.ageCategoryCode.options.add(j,Q),I.ageCategoryCode.value=z}}else Pt({message:"Category saved to event but not added to tournament categories",intent:"is-warning"})}ot.drawer.attributes.content.ageCategoryCode.value=O.ageCategoryCode,T(O)}};dot({existingCategory:e?.category||{},editorConfig:{defaultConsideredDate:N||a.startDate},callback:k});return}T()},T=R=>{const M=R?.ageCategoryCode||ot.drawer.attributes.content.ageCategoryCode.value,N=ot.drawer.attributes.content.eventName.value,k=ot.drawer.attributes.content.eventType.value,O=ot.drawer.attributes.content.startDate.value,x=ot.drawer.attributes.content.endDate.value,F=ot.drawer.attributes.content.gender.value,_={eventName:N,eventType:k,gender:F,startDate:O,endDate:x};R?_.category=R:M&&M!=="custom"&&(_.category={...e?.category,ageCategoryCode:M});const V=G=>{if(t?.deselectRow(),G.success){const z=G.results?.[0]?.event;Mt(r)&&r({...G,event:z,eventUpdates:_})}else G.error&&(Pt({intent:"is-warning",message:G.error?.message||"Error"}),Mt(r)&&r(G))};if(e){const G=e.eventId;Nt({methods:[{method:Yut,params:{eventId:G,eventUpdates:_}}],callback:V})}else{const G=R||(M&&M!=="custom"?{ageCategoryCode:M}:void 0),z=Ri.UUID(),Q=[{params:{event:{category:G,eventId:z,eventName:N,eventType:k,gender:F,startDate:O,endDate:x}},method:Lut}];if(i?.length){const j=i.map(({participantId:X})=>X),W=d===hD&&[Sv,Uv].includes(k)?Cvt:Tvt,Y={params:{enforceCategory:!0,enforceGender:!0,entryStage:Dvt,participantIds:j,entryStatus:W,eventId:z},method:oZ};Q.push(Y)}Nt({methods:Q,callback:V})}},D=()=>{const R=ot.drawer.attributes.content.eventName.value;return R&&R.length>=5},C=()=>ot.drawer.attributes.content.ageCategoryCode.value!=="custom"&&D(),E=(R,M)=>uv(R,[{label:"Cancel",onClick:()=>t?.deselectRow(),close:!0},{label:"Save",onClick:S,close:C,intent:"is-info"}],M),P=e?.eventId?"Edit event":"Add event";ot.drawer.open({title:`<b style='larger'>${P}</b>`,onClose:()=>t?.deselectRow(),width:"300px",side:Ht,content:w,footer:E})}const fO=(t,e)=>{const i=t.getSelectedData(),r=t.getData("active").map(s=>s.participantId),n=i.filter(s=>r.includes(s.participantId));FH({table:t,callback:s=>{if(t.deselectRow(),s?.success){const o=s?.results[0]?.event?.eventId;Mt(e)&&e?e({eventId:o}):o&&_n({eventId:o})}else Mt(e)&&e&&e()},participants:n})},{INDIVIDUAL:Wne,TEAM:Kne,GROUP:Yne}=io,{OFFICIAL:Xne}=Yg,yNe=t=>[{label:"Individuals",value:Wne,isActive:t===Wne,close:!0},{label:"Officials",value:Xne,isActive:t===Xne,close:!0},{label:"Groups",value:Yne,isActive:t===Yne,close:!0},{label:"Teams",value:Kne,isActive:t===Kne,close:!0}].map(e=>({...e,onClick:()=>{if(e.value!==t){const r=`/tournament/${Ge.getTournament().tournamentRecord.tournamentId}/${Vm}/${e.value}`;ot.router.navigate(r)}}})),{INDIVIDUAL:Pvt,GROUP:Rvt}=io,{OFFICIAL:Mvt}=Yg,{ANY:Nvt}=Fh,GG="is-primary";function bNe({view:t}){const{table:e,replaceTableData:i,teamParticipants:r,groupParticipants:n}=zgt({view:t}),a=DS(e),s=t===Mvt?"Officials":"Individuals",{extension:o}=Ge.findExtension({discover:!0,name:th.REGISTRATION}),l=o?.value,c=gu(),u=c?.roles?.includes("superadmin")||c?.permissions?.includes("editTennisId"),d=()=>bNe({view:t}),{eventOptions:p,events:f}=fNe(e),{sexOptions:h,genders:m}=rvt(e),{teamOptions:A}=ivt({table:e,teamParticipants:r}),b=[{onClick:()=>lvt(i),label:"Sign out players not approved for events",close:!0},{onClick:C=>ogt(C,e),label:"Edit ratings",close:!0},{onClick:C=>qgt(C,e),hide:!u,label:"Edit WTID",close:!0},{divider:!0},{heading:"Add participants"},{hide:l,label:"Generate mock participants",onClick:()=>{evt({callback:()=>{i(),e?.redraw(!0)}})},close:!0},{label:"Import from Google sheet",onClick:()=>mvt({callback:i}),close:!0},{onClick:()=>lNe({callback:i,view:t}),label:"New participant",close:!0}],y=f.map(C=>({onClick:()=>vNe({event:C,participantType:Pvt,table:e,callback:d}),label:C.eventName,close:!0})).concat([{divider:!0},{label:'<p style="font-weight: bold">Create new event</p>',onClick:()=>fO(e,d),close:!0}]),I=Lne({participants:n,participantType:Rvt,replaceTableData:i,table:e}),w=Lne({participants:r,table:e,replaceTableData:i}),S=Xgt(e),T=[{onKeyDown:C=>{C.keyCode===8&&C.target.value.length===1&&a(""),S(C)},onChange:C=>a(C.target.value),onKeyUp:C=>a(C.target.value),clearSearch:()=>a(""),placeholder:"Search participants",location:sa,search:!0},{options:y,label:"Add to event",hide:!f.length,intent:"is-none",location:sa},{onClick:()=>fO(e,d),label:"Create event",hide:f.length,intent:"is-info",location:sa},{selection:w,label:"Add to team",intent:"is-none",location:sa},{selection:I,label:"Add to group",intent:"is-none",location:sa},{onClick:()=>avt(e),intent:GG,location:sa,label:"Sign in"},{onClick:()=>hNe(e),label:"Delete selected",intent:"is-danger",stateChange:!0,location:sa},{onKeyDown:C=>{C.keyCode===8&&C.target.value.length===1&&a(""),S(C)},onChange:C=>a(C.target.value),onKeyUp:C=>a(C.target.value),clearSearch:()=>a(""),placeholder:"Search participants",location:ii,search:!0},{hide:(f||[]).length<1,options:p,label:yg,modifyLabel:!0,selection:!0,location:ii},{label:A[0]?.label||"",options:A,modifyLabel:!0,selection:!0,location:ii},{options:h,label:m[Nvt],modifyLabel:!0,selection:!0,location:ii},{options:yNe(t),label:s,intent:"is-info",modifyLabel:!0,location:Ht,selection:!0,align:Ht},{options:b,label:"Actions",selection:!1,location:Ht,align:Ht},{onClick:C=>Zgt(C,e),class:"saveTennisId",intent:GG,label:"Save WTID",location:Ht,visible:!1},{onClick:C=>Wgt(C,e),label:"Save ratings",intent:GG,class:"saveRatings",location:Ht,visible:!1}],D=document.getElementById(W6)||void 0;eo({table:e,target:D,items:T})}const Bvt=t=>{const e=document.createElement("ul");return Object.keys(t).length&&t.forEach(i=>{const r=document.createElement("li");if(i.field==="sex")r.innerHTML="<strong>Gender:&nbsp;</strong>"+i.value;else if(Ad(i.value)){if(i.value){const n=document.createElement("div");n.innerHTML=`<strong>${i.title}:&nbsp;</strong>`,r.appendChild(n),r.appendChild(i.value)}}else r.innerHTML="<strong>"+i.title+"</strong>:&nbsp;"+i.value;e.appendChild(r)}),e};function kvt(t,e){const{individualParticipantIds:i,individualParticipants:r,participantName:n,participantType:a,participantId:s,representing:o}=t,l=i?.length||0;return{events:nNe(t,e),eventIds:t.events.map(({eventId:c})=>c),searchText:n.toLowerCase(),representing:aNe(o),individualParticipants:r,participantName:n,participantType:a,participantId:s,membersCount:l}}function xvt({table:t,team:e}){const r=t.getSelectedData().map(({participantId:s})=>s);t.deselectRow();const n=[{method:Jut,params:{groupingParticipantId:e.participantId,individualParticipantIds:r,suppressErrors:!0}}];Nt({methods:n,callback:s=>{s.success&&t.deleteRow(r)}})}const{ALTERNATE_PARTICIPANT:_vt,ASSIGN_PARTICIPANT:Ovt,LUCKY_PARTICIPANT:Fvt,QUALIFYING_PARTICIPANT:Lvt,SWAP_PARTICIPANTS:$vt}=Qw,Hvt={[_vt]:{selections:"availableAlternates",targetAttribute:"participantId",param:"alternateParticipantId",title:"Assign alternate"},[Ovt]:{selections:"participantsAvailable",targetAttribute:"participantId",title:"Select participant"},[Fvt]:{selections:"availableLuckyLosers",targetAttribute:"participantId",param:"luckyLoserParticipantId",title:"Assign lucky loser"},[Lvt]:{selections:"qualifyingParticipants",targetAttribute:"participantId",param:"qualifyingParticipantId",title:"Assign qualifier"},[$vt]:{selections:["availableAssignments","swappableParticipants"],targetAttribute:"drawPosition",title:"Swap draw positions",param:"drawPositions"},selectParticipants:{selections:"participantsAvailable",targetAttribute:"participantId",title:"Select participants"}};function RN(t){const{selectedParticipantIds:e,selectionLimit:i,activeOnEnter:r,selectOnEnter:n,onSelection:a,update:s,action:o}=t,l=Hvt[o.type];if(!l?.targetAttribute)return;const c=t.title||l.title||"Select participant";let u,d;const p=()=>{const C=l.targetAttribute,E=l.param||l.targetAttribute,P=Array.isArray(u)?u[0]?.[C]:u?.[C];if(o.type==="SWAP"){if(P)o.payload.drawPositions.push(P),a({[E]:o.payload.drawPositions});else if(u?.length===1){const R=u?.[0]?.participantId;o.payload.participantIds.push(R),a({participantIds:o.payload.participantIds})}}else P&&a({[E]:P,selected:u})},f="selectionControl",h="selectionTable",m=[{label:"Cancel",intent:"is-none",close:!0},{hide:i===1,label:"Select",intent:"is-info",onClick:p,close:!0}],A=()=>{ot.tables.selectionTable?.destroy(),delete ot.tables.selectionTable},g=`
    <div style='min-height: 420px'>
      <div id='${f}'></div>
      <div id='${h}'></div>
    </div>
  `;s?s({title:c,content:g,buttons:m,onClose:A}):Jr({title:c,content:g,buttons:m,onClose:A});const v=C=>{u=C,i&&u?.length===i&&(Wy(),p())},b=Array.isArray(l.selections)?o[l.selections.find(C=>o[C])]:o[l.selections],{table:y}=AMe({selectedParticipantIds:e,targetAttribute:l.targetAttribute,selectionLimit:i,onSelected:v,anchorId:h,data:b}),I=DS(y),w=()=>{const C=y.getData("active");if(C.length===1){if(n)u=C[0],Wy(),p();else if(r){const E=u?.map(R=>R.participantId)||[],P=C[0].participantId;E.includes(P)||(Array.isArray(u)?u.push(C[0]):u=C,y.selectRow([P]),d.participantSearch.value="")}}},T=[{onKeyDown:C=>{C.key==="Backspace"&&C.target.value.length===1&&I(""),C.key==="Enter"&&w()},onChange:C=>I(C.target.value),onKeyUp:C=>I(C.target.value),clearSearch:()=>I(""),placeholder:"Search entries",id:"participantSearch",location:ii,search:!0,focus:!0}],D=document.getElementById(f)||void 0;d=eo({table:y,target:D,items:T})?.inputs}const{ASSIGN_PARTICIPANT:Vvt}=Qw,QG=Ri.extractAttributes,Gvt=t=>{const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em",e.appendChild(i);const r="1px solid #333",n=document.createElement("div");n.style.backgroundColor="white",n.style.border=r,n.style.width="99%",e.className=o2,e.style.display=jt,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=r,e.style.borderBottom=r,e.appendChild(n),t.getElement().appendChild(e);const a=t.getData(),s=d=>{const p={};return d?.map(f=>{const h=f.person?.sex||"OTHER";return p[h]||(p[h]=0),p[h]+=1,{...f,order:p[h]}})},o=s(a.individualParticipants),l=new es(n,{placeholder:"No individual participants",index:"participantId",layout:"fitColumns",movableRows:!0,maxHeight:400,data:o,columns:[{cellClick:(d,p)=>p.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ii,width:5},{title:"Order",headerSort:!1,field:"order",width:70},{title:"Name",field:"participantName",formatter:Bb(void 0)},{title:"Gender",field:"person.sex",width:100}]});l.on("scrollVertical",Kd),l.on("rowMoved",d=>{const p=d.getTable(),h=p.getData().map((g,v)=>({...g,order:v+1})).map(({participantId:g})=>g),m=[{params:{participant:{participantId:a.participantId,individualParticipantIds:h}},method:nO}];Nt({methods:m,callback:g=>{if(g.success){const v=p.getRows(),b=v.map(I=>I.getData()),y=s(b);v.forEach((I,w)=>I.update(y[w]))}}})}),eo({table:l,target:i,items:[{onClick:()=>xvt({table:l,team:a}),label:"Delete selected",intent:"is-danger",stateChange:!0,location:sa},{onClick:()=>{const d=A=>{if(A.participantId){const g=A.selected,v=(A.selected?A.selected.map(QG("participantId")):[A.participantId]).filter(Boolean),b=(a.individualParticipants??[]).map(QG("participantId")).concat(v);if(v?.length){const y=[{method:JRe,params:{groupingParticipantId:a.participantId,individualParticipantIds:v}},{params:{participant:{participantId:a.participantId,individualParticipantIds:b}},method:nO}];Nt({methods:y,callback:w=>{w.success&&(a.individualParticipants=(a.individualParticipants??[]).concat(g),a.membersCount=a.individualParticipants.length,t.update(a),t.getTable().redraw(!0))}})}}},p=a.individualParticipants?.map(QG("participantId"))||[],{participants:f}=Ge.getParticipants({participantFilters:{participantTypes:["INDIVIDUAL"]},withISO2:!0}),h=f.filter(({participantId:A})=>!p.includes(A));RN({title:"Select players to add",activeOnEnter:!0,selectionLimit:99,onSelection:d,action:{type:Vvt,participantsAvailable:h}})},label:"Add players",intent:"is-primary",location:Ht}]})},xZ="&#9660;",INe=" &#9654;",wNe=` <span class='tabulator-responsive-collapse-toggle-close toggleCaret'> ${xZ} </span>`,SNe=`<span class='tabulator-responsive-collapse-toggle-open toggleCaret'> ${INe} </span>`,UNe=o2;function _I(t,e){const i=e.getRow(),r=i._row.element.getElementsByClassName(UNe)[0];if(r){const n=r.style.display!==jt;r.style.display=n?jt:"";const s=i.getCells().find(o=>o.getColumn().getDefinition().field===Nbe)?._cell?.element;return s&&(s.innerHTML=n?SNe:wNe),{open:!n}}}function _Z(t){return t.getRow()._row.element.getElementsByClassName(UNe)[0]?.style.display!==jt?SNe:wNe}const{GROUP:Qvt}=io;function jvt({view:t,replaceTableData:e}){const i=(r,n)=>{_I(r,n)?.open};return[{cellClick:(r,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",responsive:!1,headerSort:!1,hozAlign:ii,width:5},{formatter:"responsiveCollapse",width:50,minWidth:50,hozAlign:si,resizable:!1,headerSort:!1},{headerMenu:TA({matchUpsCount:"Total MatchUps",membersCount:"Individuals",winLoss:"Win/Loss"}),formatter:"rownum",headerSort:!1,hozAlign:ii,width:55},{cellClick:(r,n)=>i(r,n),field:"participantName",title:"Name",minWidth:200,widthGrow:1},{sorter:(r,n)=>r?.[0]?.eventName?.localeCompare(n?.[0]?.eventName),formatter:cNe(_n),visible:t!==Qvt,hozAlign:ii,field:"events",title:"Events",minWidth:300,editor:!1,widthGrow:2},{title:'<div class="event_icon opponents_header" />',headerTooltip:"Individuals",headerHozAlign:si,field:"membersCount",hozAlign:si,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon matches_header" />',headerTooltip:"Total MatchUps",headerHozAlign:si,field:"matchUpsCount",hozAlign:si,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon winloss_header" />',headerTooltip:"Win/Loss",headerHozAlign:si,field:"winLoss",hozAlign:si,headerSort:!0,visible:!0,width:50},{field:"representing",title:"Representing",visible:!1,minWidth:200},{cellClick:i,formatter:_Z,responsive:!1,headerSort:!1,hozAlign:Ht,field:Nbe,width:20},{cellClick:dx(e),formatter:dv,responsive:!1,headerSort:!1,hozAlign:Ht,width:20}]}const{TEAM:jG}=io;function zvt({view:t}={}){let e,i,r,n;const a=()=>({participants:i,derivedEventInfo:r}=Ge.getParticipants({participantFilters:{participantTypes:[t||jG]},withIndividualParticipants:!0,withScaleValues:!0,withEvents:!0,withISO2:!0}),i.map(u=>kvt(u,r))),s=()=>{setTimeout(()=>e.replaceData(a()),n?0:1e3)},o=jvt({view:t});return(c=>{UA({anchorId:l_});const u=document.getElementById(l_),d=ac(u,"section")?.querySelector(".tabHeader");e=new es(u,{headerSortElement:kf(["events","membersCount","matchUpsCount","winLoss"]),responsiveLayoutCollapseFormatter:Bvt,responsiveLayoutCollapseStartOpen:!1,minHeight:window.innerHeight*.81,height:window.innerHeight*.86,placeholder:"No team participants",rowFormatter:Gvt,responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,data:c,columns:o}),e.on("dataChanged",p=>{const f=t===jG?"Teams":"Groups";d&&(d.innerHTML=`${f} (${p.length})`)}),e.on("dataFiltered",(p,f)=>{const h=t===jG?"Teams":"Groups";d&&(d.innerHTML=`${h} (${f.length})`)}),e.on("scrollVertical",Kd),e.on("tableBuilt",()=>n=!0)})(a()),{table:e,replaceTableData:s}}const qvt={country:{personAttribute:"nationalityCode"},city:{accessor:"person.addresses.city"}};function Wvt({callback:t}={}){const e=[{label:Rm.tr("cnt"),value:"country"},{label:"City",value:"city"}],i="-";Jr({title:"Create Team",content:a=>Sr(a,[{options:[{label:"Select attribute",value:i},...e],label:"Attribute",field:"selection",value:""}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Create",intent:"is-primary",onClick:({content:a})=>{const s=a?.selection.value;if(!s||s===i)return;const o=qvt[s],l=Ge.createTeamsFromParticipantAttributes({...o,addParticipants:!1});if(l.newParticipants){const c=[{params:{participants:l.newParticipants},method:TN}];Nt({methods:c,callback:t})}},close:!0}],onClose:()=>{}})}const{TEAM:Zne}=io;function Kvt({view:t}){const{table:e,replaceTableData:i}=zvt({view:t}),r=DS(e),{eventOptions:n,events:a}=fNe(e),s=[{label:"New team",onClick:()=>pNe({title:"New team",refresh:i})},{label:"Generate teams",onClick:()=>Wvt({callback:i})}],l=[{label:'<p style="font-weight: bold">Create new event</p>',onClick:()=>fO(e,i),close:!0},{divider:!0}].concat(a.filter(({eventType:p})=>p===Zne).map(p=>({onClick:()=>vNe({event:p,participantType:Zne,table:e,callback:i}),label:p.eventName,close:!0}))),c=t==="GROUP"?"Groups":"Teams",u=[{onKeyDown:p=>p.keyCode===8&&p.target.value.length===1&&r(""),onChange:p=>r(p.target.value),onKeyUp:p=>r(p.target.value),clearSearch:()=>r(""),placeholder:"Search teams",location:sa,search:!0},{options:l,label:"Add to event",hide:!a.length,intent:"is-none",location:sa},{onClick:()=>fO(e,i),label:"Create event",hide:a.length,intent:"is-info",location:sa},{onClick:()=>hNe(e),label:"Delete selected",intent:"is-danger",stateChange:!0,location:sa},{onKeyDown:p=>p.keyCode===8&&p.target.value.length===1&&r(""),onChange:p=>r(p.target.value),onKeyUp:p=>r(p.target.value),clearSearch:()=>r(""),placeholder:"Search teams",location:ii,search:!0},{hide:n.length<2,options:n,modifyLabel:!0,label:yg,location:ii,selection:!0},{options:yNe(t),label:c,modifyLabel:!0,intent:"is-info",location:Ht,selection:!0,align:Ht},{options:s,label:"Actions",selection:!1,location:Ht,align:Ht}],d=document.getElementById(e8)||void 0;eo({table:e,target:d,items:u})}const{INDIVIDUAL:Yvt,TEAM:Xvt,GROUP:Zvt}=io;function Jvt({participantView:t=Yvt}={}){const e=t.toUpperCase(),i=[Xvt,Zvt].includes(e),r=document.getElementById("individuals"),n=document.getElementById("participantGroupings");i?(r&&(r.style.display=jt),n&&(n.style.display="")):(n&&(n.style.display=jt),r&&(r.style.display="")),i?Kvt({view:e}):bNe({view:e})}var TNe=function(t){return String.prototype.normalize?t.normalize("NFKD").replace(/[\u0300-\u036F]/g,""):t};const{TEAM:eyt}=Ul,PS=t=>{const{potentialParticipants:e,matchUpType:i,matchUpId:r,eventName:n,roundName:a,schedule:s,eventId:o,drawId:l,gender:c,sides:u,...d}=t,{scheduledDate:p,scheduledTime:f,courtName:h}=s||{},m=N=>N.person?.standardFamilyName||N.participantName,A=e?.map(N=>({participantName:N.map(m).filter(Boolean).join(" or ")}))||[],g=u?.[0]?.participant||A.shift(),v=u?.[1]?.participant||A.shift(),b={participantName:g?.participantName,sex:g?.person?.sex,participant:g},y={participantName:v?.participantName,sex:v?.person?.sex,participant:v},I=u.flatMap(({participant:N})=>N?.individualParticipantIds?.length?N.individualParticipantIds:N?.participantId).filter(Boolean),w=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,S=!!d.winningSide,T=!!(d.winningSide||d.readyToScore),D=d.score?.scoreStringSide1,C=u.flatMap(N=>{const k=N.participant?.person;return k?[k.standardGivenName,k.standardFamilyName]:N.participant?.individualParticipants?.map(({person:O})=>[O.standardGivenName,O.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),E=TNe([C,g?.participantName,v?.participantName].filter(Boolean).join(" ")).toLowerCase(),P=t.collectionId?eyt:i,R=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,M={score:D,matchUpStatus:t.matchUpStatus,readyToScore:T,complete:S,winningSide:w};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:I,flight:t.drawName,competitiveProfile:R,scheduledDate:p,readyToScore:T,scheduledTime:f,matchUpType:i,scoreDetail:M,winningSide:w,searchText:E,courtName:h,eventName:n,eventType:P,matchUpId:r,roundName:a,complete:S,eventId:o,matchUp:t,gender:c,drawId:l,side1:b,side2:y,score:D}};function CNe(t,e){const i=t.target.id;t.dataTransfer?.setData("itemid",i),e&&t.dataTransfer&&(t.dataTransfer.setData("itemtype",Aqe),t.dataTransfer.setDragImage(ot.dragMatch,10,10)),t.dataTransfer&&(t.dataTransfer.effectAllowed="move")}const{MALE:tyt,FEMALE:iyt}=Fh;function ryt(t){function e(a){const s=document.createElement("div"),o=a.getValue(),l=Ad(o)&&o?.sex===tyt&&"#2E86C1"||o?.sex===iyt&&"#AA336A"||"";return s.style.color=l,s.innerHTML=(Ad(o)?o.participantName:o)||"",s}function i(a){const s=document.createElement("div");return s.innerHTML=a.getValue(),s}function r(a){const s=a.getElement();return s.classList.add("tag"),s.classList.add("is-info"),s.classList.add("is-light"),t?.length||0}const n=(a,s)=>a.participantName&&!s.participantName||s.participantName&&!a.participantName||!a?.participantName&&!s?.participantName?1:a?.participantName?.localeCompare(s?.participantName);return[{titleFormatter:r,formatter:"rownum",headerSort:!1,hozAlign:si,frozen:!0,width:55},{formatter:i,field:"eventName",resizable:!1,title:"Event",visible:!0,minWidth:250},{title:"Flight",field:"flight"},{formatter:i,field:"roundName",resizable:!1,title:"Round",minWidth:90},{formatter:e,sorter:n,responsive:!1,resizable:!1,title:"Side 1",minWidth:120,field:"side1"},{formatter:e,sorter:n,responsive:!1,resizable:!1,title:"Side 2",minWidth:120,field:"side2"},{field:"matchUp.matchUpFormat",title:"Scoring Format",formatter:i,responsive:!1,resizable:!1,minWidth:100}]}const Jne=Object.keys(o4);function eae(t,e){return Jne.indexOf(t.issue)-Jne.indexOf(e.issue)}const{scheduleConstants:tae}=Qn;function f1(t,e){const i=t.getData(),r=i.flatMap(l=>Object.values(l).filter(Ad)).filter(l=>l.matchUpId),{courtIssues:n,rowIssues:a}=Jd.proConflicts({matchUps:e??r});n&&Object.keys(n)?.length;const s=new Map;a&&a.flat().forEach(c=>{c.matchUpId&&s.set(c.matchUpId,c)}),r.forEach(l=>{if(l.matchUpId&&s.has(l.matchUpId)){const c=s.get(l.matchUpId);l.issueType=c.issueType,l.issueIds=c.issueIds,l.schedule||(l.schedule={}),l.schedule[tae.SCHEDULE_STATE]=c.issue}else delete l.issueType,delete l.issueIds,l.schedule&&delete l.schedule[tae.SCHEDULE_STATE]}),i?.length&&t.updateData(i);const o=t.getColumns()[0].getCells();a?.length&&a.forEach((l,c)=>{const u=c+1,d=o.find(p=>p.getData().rowNumber===u);if(d){d.getElement().classList.forEach(f=>{f.startsWith("matchup")&&d.getElement().classList.remove(f)});const p=d.getData();if(l.length){l.sort(eae),p.issues=l;const f=o4[l[0].issue];d.getElement().classList.add(f)}else d.getElement().style.backgroundColor="white",p.issues=[]}}),n&&Object.keys(n).length?t.getColumns().slice(1).forEach(c=>{const d=c.getDefinition().courtId,p=c.getElement().querySelector(".tabulator-col-content");if(p)if(p.classList.forEach(f=>{f.startsWith("matchup")&&p.classList.remove(f)}),d&&n[d]){const f=n[d];if(f.length){f.sort(eae);const h=o4[f[0].issue];h&&p.classList.add(h)}}else p.style.backgroundColor=""}):t.getColumns().slice(1).forEach(c=>{const u=c.getElement().querySelector(".tabulator-col-content");u&&(u.classList.forEach(d=>{d.startsWith("matchup")&&u.classList.remove(d)}),u.style.backgroundColor="")})}function nyt(t,e){t.preventDefault();const i=t.dataTransfer?.getData("itemid"),r=es.findTable("#tournamentSchedule")[0],a=r.getData().flatMap(m=>Object.values(m).filter(A=>A&&typeof A=="object"&&"matchUpId"in A)).find(m=>m.matchUpId===i)||{};if(!a?.schedule?.courtId)return;let s;const o=r.getData().find(m=>(s=Object.keys(m).find(A=>{if(Ad(m[A]))return m[A].matchUpId===i}),s)),{courtId:l,courtOrder:c,venueId:u}=a.schedule;o&&s&&(o[s]={schedule:{courtOrder:c,courtId:l,venueId:u}},r.updateData([o])),delete a.schedule.scheduledDate,delete a.schedule.scheduledTime,delete a.schedule.courtOrder,delete a.schedule.courtId,delete a.schedule.venueId;const d={scheduledTime:"",scheduledDate:"",courtOrder:"",venueId:"",courtId:""},p=[{method:rO,params:{tournamentId:a.tournamentId,matchUpId:a.matchUpId,schedule:d,drawId:a.drawId,removePriorValues:!0}}];Nt({methods:p,engine:a2,callback:m=>!m.success&&console.log({result:m})}),a.schedule=d;const h=PS(a);e.addRow(h,!0),f1(r)}const{SINGLES:ayt,DOUBLES:syt}=Ul;function oyt(t){const e=t.getElement(),r=t.getData().matchUp.matchUpId;e.id=r,e.addEventListener("dragstart",n=>CNe(n,!0)),e.draggable=!0}function lyt({scheduledDate:t}={}){const e=t;let i=[],r,n;function a({scheduledDate:u}){const d=Jd.allCompetitionMatchUps({matchUpFilters:{matchUpStatuses:Qn.upcomingMatchUpStatuses,matchUpTypes:[ayt,syt]},nextMatchUps:!0}).matchUps?.filter(h=>!h.schedule?.courtId&&!h.sides?.some(({bye:m})=>m))||[],p=u||e;return i=d.filter(h=>!h.schedule?.scheduledDate||h.schedule.scheduledDate===p),{rowMatchUps:i.map(PS)}}function s({scheduledDate:u}={}){return setTimeout(()=>{const{rowMatchUps:p=[]}=a({scheduledDate:u});n&&n.replaceData(p)},r?0:1e3),{unscheduledMatchUps:i}}const o=ryt(i);UA({anchorId:ny});const l=document.getElementById(ny),{rowMatchUps:c=[]}=a({scheduledDate:e});return n=new es(l,{headerSortElement:kf(["flight"]),placeholder:"No unscheduled matches",rowFormatter:oyt,layout:"fitDataStretch",index:"matchUpId",data:c,height:250,columns:o}),n.on("tableBuilt",()=>{r=!0;const u=l?.getElementsByClassName("tabulator-tableholder")[0];u.addEventListener("drop",d=>nyt(d,n)),u.ondragover=d=>d.preventDefault(),u.draggable=!0}),n.on("dataChanged",u=>{const d=n.getColumns()[0]._getSelf().titleElement;d.innerHTML=`${u.length}`}),n.on("dataFiltered",(u,d)=>{const p=n.getColumns()[0]._getSelf().titleElement;p.innerHTML=`${d.length}`}),n.on("rowClick",(u,d)=>{const p=d.getData();console.log({matchUp:p})}),{table:n,replaceTableData:s,unscheduledMatchUps:i}}function cyt({e:t,cell:e,booking:i,updateScheduleTable:r}){const n=e.getRow().getData(),a=e.getColumn().getDefinition().field,s=n[a],{courtId:o}=s?.schedule||{},l=ot.displayed.selectedScheduleDate;if(!o||!i?.courtOrder)return;const c=()=>{const h=[{method:"removeCourtGridBooking",params:{courtId:o,scheduledDate:l,courtOrder:i.courtOrder}}];Nt({methods:h,callback:A=>{A.success&&r&&l&&r({scheduledDate:l})}})},u=i.rowCount>1?`${i.rowCount} rows`:"1 row",d=i.bookingType||"BLOCKED",p=[{option:`Unblock court (${u}, ${d})`,onClick:c},i.notes&&{option:`Notes: ${i.notes}`,disabled:!0}].filter(Boolean),f=t.target;nl({options:p,target:f,config:{placement:Ht}})}function uyt({e:t,cell:e,updateScheduleTable:i}){const r=e.getRow().getData(),n=e.getColumn().getDefinition().field,a=r[n],{courtId:s,courtOrder:o}=a?.schedule||{};if(!s||!o)return;const l=(d,p="BLOCKED")=>{const f=ot.displayed.selectedScheduleDate;Nt({methods:[{method:"addCourtGridBooking",params:{courtId:s,scheduledDate:f,courtOrder:o,rowCount:d,bookingType:p}}],callback:A=>{A.success&&i&&f&&i({scheduledDate:f})}})},c=[{option:"Block court (1 row)",onClick:()=>l(1,"BLOCKED")},{option:"Block court (2 rows)",onClick:()=>l(2,"BLOCKED")},{option:"Block court (3 rows)",onClick:()=>l(3,"BLOCKED")},{option:"Mark court for practice (1 row)",onClick:()=>l(1,"PRACTICE")},{option:"Mark court for maintenance (1 row)",onClick:()=>l(1,"MAINTENANCE")}].filter(Boolean),u=t.target;nl({options:c,target:u,config:{placement:Ht}})}function OZ(t,e){return t?Ri.dateTime.convertTime(t,e):""}function dyt(t){const e=OZ(t,!0).split(":");return+e[0]*60*60+ +e[1]*60+(+e[2]||0)}function iae(t){return t.toString()[1]?t.toString():"0"+t}function pyt(t,e){let i=Math.floor(t/3600),r=Math.floor((t-i*3600)/60);return e&&(r=0,i+=1,i>23&&(i=0)),`${iae(i)}:${iae(r)}`}const ENe="tmx_settings";function FZ(){try{const t=localStorage.getItem(ENe);return t?JSON.parse(t):null}catch(t){return console.error("Error loading settings from localStorage:",t),null}}function fyt(t){try{localStorage.setItem(ENe,JSON.stringify(t))}catch(e){console.error("Error saving settings to localStorage:",e)}}function hyt(){const t=FZ();return t?.smartComplements!==void 0?t.smartComplements:$t.smartComplements!==void 0?$t.smartComplements:!1}function myt(t){const e={compositionName:"Australian",smartComplements:!1},i=hyt();if(t?.drawId)try{const r=Ge.findExtension({name:th.DISPLAY,discover:!0,drawId:t.drawId});if(r?.extension?.value?.compositionName)return{compositionName:r.extension.value.compositionName,smartComplements:i}}catch(r){console.warn("Failed to resolve composition from draw extension:",r)}if($t.composition?.compositionName)return{compositionName:$t.composition.compositionName,smartComplements:i};try{const r=localStorage.getItem("tmx_composition");if(r){const n=JSON.parse(r);if(n.compositionName)return{compositionName:n.compositionName,smartComplements:i}}}catch(r){console.warn("Failed to parse composition from localStorage:",r)}return{...e,smartComplements:i}}function Ayt(t){const e=myt(t.matchUp);Tlt({scoringApproach:$t.scoringApproach||"dynamicSets",smartComplements:e.smartComplements,composition:e.compositionName}),$t.log?.verbose&&console.log("%c TMX  courthive-components scoring","color: green",{approach:$t.scoringApproach||"dynamicSets",composition:e.compositionName,smartComplements:e.smartComplements}),Olt(t)}function MN(t){const{matchUpId:e,callback:i}=t,r={withScaleValues:!0},n=t.matchUp??Ge.findMatchUp({participantsProfile:r,matchUpId:e}).matchUp;Ayt({matchUp:n,callback:s=>{const{matchUpStatus:o,matchUpFormat:l,winningSide:c,score:u,sets:d}=s;let p=d||[];!p.length&&u&&(p=Ge.parseScoreString({scoreString:u})||[]);const f=[{method:dZ,params:{allowChangePropagation:!0,drawId:n.drawId,outcome:{score:{sets:p},matchUpFormat:l,matchUpStatus:o,winningSide:c},matchUpId:e}}];Nt({methods:f,callback:m=>{Wy(),Mt(i)&&i({...m,outcome:s})}})}})}var uy=()=>typeof window>"u",$l=()=>typeof document<"u",gyt=class{state;constructor(t,e,i,r){this.state={degreesHours:null,degreesMinutes:null,options:e,element:t,instanceId:i,isMobileView:!1,isTouchMouseMove:!1,disabledTime:null,cloned:null,isModalRemove:!0,isInitialized:!1,customId:r,eventHandlersRegistered:!1,isDestroyed:!1}}get degreesHours(){return this.state.degreesHours}get degreesMinutes(){return this.state.degreesMinutes}get options(){return this.state.options}get element(){return this.state.element}get instanceId(){return this.state.instanceId}get isMobileView(){return this.state.isMobileView}get isTouchMouseMove(){return this.state.isTouchMouseMove}get disabledTime(){return this.state.disabledTime}get cloned(){return this.state.cloned}get isModalRemove(){return this.state.isModalRemove}get isInitialized(){return this.state.isInitialized}get customId(){return this.state.customId}get eventHandlersRegistered(){return this.state.eventHandlersRegistered}get isDestroyed(){return this.state.isDestroyed}setDegreesHours(t){this.state={...this.state,degreesHours:t}}setDegreesMinutes(t){this.state={...this.state,degreesMinutes:t}}setOptions(t){this.state={...this.state,options:t}}setIsMobileView(t){this.state={...this.state,isMobileView:t}}setIsTouchMouseMove(t){this.state={...this.state,isTouchMouseMove:t}}setDisabledTime(t){this.state={...this.state,disabledTime:t}}setCloned(t){this.state={...this.state,cloned:t}}setIsModalRemove(t){this.state={...this.state,isModalRemove:t}}setIsInitialized(t){this.state={...this.state,isInitialized:t}}setEventHandlersRegistered(t){this.state={...this.state,eventHandlersRegistered:t}}setIsDestroyed(t){this.state={...this.state,isDestroyed:t}}updateOptions(t){this.state={...this.state,options:{...this.state.options,clock:{...this.state.options.clock,...t.clock||{}},ui:{...this.state.options.ui,...t.ui||{}},labels:{...this.state.options.labels,...t.labels||{}},behavior:{...this.state.options.behavior,...t.behavior||{}},callbacks:{...this.state.options.callbacks,...t.callbacks||{}}}}}reset(){this.state={...this.state,degreesHours:null,degreesMinutes:null,isTouchMouseMove:!1,disabledTime:null,cloned:null,isModalRemove:!0,isInitialized:!1,isDestroyed:!0,eventHandlersRegistered:!1}}getModalElement(){return $l()===!1?null:document.querySelector(`[data-owner-id="${this.state.instanceId}"]`)}getInput(){return this.state.element?.querySelector("input")}getClockFace(){let t=this.getModalElement();return t?this.state.isMobileView?t.querySelector(".tp-ui-clock-face.mobile"):t.querySelector(".tp-ui-clock-face:not(.mobile)"):null}getClockHand(){let t=this.getModalElement();return t?this.state.isMobileView?t.querySelector(".tp-ui-mobile-clock-wrapper .tp-ui-clock-hand"):t.querySelector(".tp-ui-clock-hand:not(.mobile)"):null}getCircle(){let t=this.getModalElement();return t?this.state.isMobileView?t.querySelector(".tp-ui-mobile-clock-wrapper .tp-ui-circle-hand"):t.querySelector(".tp-ui-circle-hand:not(.mobile)"):null}getTipsWrapper(){let t=this.getModalElement();return t?this.state.isMobileView?t.querySelector(".tp-ui-mobile-clock-wrapper .tp-ui-tips-wrapper"):t.querySelector(".tp-ui-tips-wrapper:not(.mobile)"):null}getTipsWrapperFor24h(){let t=this.getModalElement();return t?this.state.isMobileView?t.querySelector(".tp-ui-mobile-clock-wrapper .tp-ui-tips-wrapper-24h"):t.querySelector(".tp-ui-tips-wrapper-24h:not(.mobile)"):null}getMinutes(){return this.getModalElement()?.querySelector(".tp-ui-minutes")||null}getHour(){return this.getModalElement()?.querySelector(".tp-ui-hour")||null}getAM(){return this.getModalElement()?.querySelector(".tp-ui-am")||null}getPM(){return this.getModalElement()?.querySelector(".tp-ui-pm")||null}getHourText(){return this.getModalElement()?.querySelector(".tp-ui-hour-text")||null}getMinutesText(){return this.getModalElement()?.querySelector(".tp-ui-minute-text")||null}getHeader(){return this.getModalElement()?.querySelector(".tp-ui-header")||null}getInputWrappers(){return this.getModalElement()?.querySelectorAll(".tp-ui-input-wrapper")||null}getDots(){return this.getModalElement()?.querySelector(".tp-ui-dots")||null}getMinutesTips(){return this.getModalElement()?.querySelector(".tp-ui-minutes-time")||null}getHourTips(){return this.getModalElement()?.querySelector(".tp-ui-hour-time-12")||null}getAllValueTips(){let t=this.getModalElement();return t?[...t.querySelectorAll(".tp-ui-value-tips"),...t.querySelectorAll(".tp-ui-value-tips-24h")]:[]}getOpenElementData(){let t=this.state.element?.querySelectorAll("[data-open]");if(t?.length>0){let e=[];return t.forEach(({dataset:i})=>e.push(i.open??"")),[...new Set(e)]}return null}getOpenElement(){let t=this.getInput(),e=this.getOpenElementData();return e===null?(t?.setAttribute("data-open","tp-ui-input"),[t]):e.map(i=>this.state.element?.querySelectorAll(`[data-open='${i}']`))[0]??""}getCancelButton(){return this.getModalElement()?.querySelector(".tp-ui-cancel-btn")||null}getOkButton(){return this.getModalElement()?.querySelector(".tp-ui-ok-btn")||null}getActiveTypeMode(){return this.getModalElement()?.querySelector(".tp-ui-type-mode.active")||null}getKeyboardClockIcon(){return this.getModalElement()?.querySelector(".tp-ui-keyboard-icon-wrapper")||null}getFooter(){return this.getModalElement()?.querySelector(".tp-ui-footer")||null}getWrapper(){return this.getModalElement()?.querySelector(".tp-ui-wrapper")||null}},ef={DEFAULT_DELAY:300,MODAL_ANIMATION:150,SCROLLBAR_RESTORE:400,MODAL_REMOVE:300,CLOCK_ANIMATION:600,TIPS_ANIMATION:401,MOBILE_TOGGLE:450,CLOCK_SCALE_DELAY:150},vyt=class{core;emitter;timeouts=[];constructor(e,i){this.core=e,this.emitter=i,this.setupEventListeners()}setupEventListeners(){this.emitter.on("animation:clock",()=>{this.handleAnimationSwitchTipsMode()})}runWithAnimation(e,i=ef.MODAL_ANIMATION){if(this.core.options.ui.animation){let r=setTimeout(e,i);this.timeouts.push(r)}else e()}clearAllTimeouts(){this.timeouts.forEach(clearTimeout),this.timeouts=[]}setAnimationToOpen(){this.clearAllTimeouts(),this.core.getModalElement()?.classList.add("opacity"),this.runWithAnimation(()=>{this.core.getModalElement()?.classList.add("show")})}removeAnimationToClose(){this.clearAllTimeouts(),this.core.getModalElement()&&this.runWithAnimation(()=>{let e=this.core.getModalElement();e?.classList.remove("show"),e?.classList.remove("opacity")})}handleAnimationClock(){this.core.options.ui.animation&&this.runWithAnimation(()=>{this.core.getClockFace()?.classList.add("tp-ui-clock-animation");let e=setTimeout(()=>{this.core.getClockFace()?.classList.remove("tp-ui-clock-animation")},ef.CLOCK_ANIMATION);this.timeouts.push(e)})}handleAnimationSwitchTipsMode(){let e=this.core.getClockHand();if(!e)return;this.emitter.emit("animation:start",{}),e.classList.add("tp-ui-tips-animation");let i=setTimeout(()=>{this.core.getClockHand()?.classList.remove("tp-ui-tips-animation"),this.emitter.emit("animation:end",{})},ef.TIPS_ANIMATION);this.timeouts.push(i)}destroy(){this.clearAllTimeouts()}},yyt=()=>{if($l()===!1)return 0;let t=document.createElement("div");t.className="tp-ui-measure",document.body.appendChild(t);let e=t.getBoundingClientRect().width-t.clientWidth;return document.body.removeChild(t),e},byt=(t,e)=>t?t.classList.contains(e):!1,CB=(t,e)=>Array.from({length:Number(e)-Number(t)+1},(i,r)=>Number(t)+r),zG=(t,e)=>Array.from({length:Number(e)-Number(t)+1},(i,r)=>Number(e)-r).reverse(),rae=(t="")=>{let e=t.replace(/(AM|PM|am|pm)/,a=>` ${a}`),i=new Date(`September 20, 2000 ${e}`),r=i.getHours().toString().padStart(2,"0"),n=i.getMinutes().toString().padStart(2,"0");return`${r}:${n}`},nae=t=>{let[e,i]=t.split(":");return`${e.padStart(2,"0")}:${i.padStart(2,"0")}`},DNe=(t,e)=>{if(t.length<2)return!1;let i=t.map(r=>{let[n,a]=r.trim().split("-"),s,o;if(e==="12h"){if(!/\s?(AM|PM|am|pm)\s?$/.test(n.trim())||!/\s?(AM|PM|am|pm)\s?$/.test(a.trim()))throw new Error(`Invalid 12h format: "${r}"`);s=rae(n.trim()),o=rae(a.trim())}else{if(/\s?(AM|PM|am|pm)\s?/.test(n.trim())||/\s?(AM|PM|am|pm)\s?/.test(a.trim()))throw new Error(`Invalid 24h format: "${r}"`);s=nae(n.trim()),o=nae(a.trim())}return{start:s,end:o,original:r}});for(let r=0;r<i.length;r++)for(let n=r+1;n<i.length;n++){let a=i[r],s=i[n];if(a.start<=s.end&&a.end>=s.start||s.start<=a.end&&s.end>=a.start)throw new Error(`Overlapping intervals: "${a.original}" and "${s.original}"`)}return!1},Iyt=()=>typeof window<"u"&&window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),PNe='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M160-200q-33 0-56.5-23.5T80-280v-400q0-33 23.5-56.5T160-760h640q33 0 56.5 23.5T880-680v400q0 33-23.5 56.5T800-200H160Zm0-80h640v-400H160v400Zm160-40h320v-80H320v80ZM200-440h80v-80h-80v80Zm120 0h80v-80h-80v80Zm120 0h80v-80h-80v80Zm120 0h80v-80h-80v80Zm120 0h80v-80h-80v80ZM200-560h80v-80h-80v80Zm120 0h80v-80h-80v80Zm120 0h80v-80h-80v80Zm120 0h80v-80h-80v80Zm120 0h80v-80h-80v80ZM160-280v-400 400Z"/></svg>',RNe='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="m612-292 56-56-148-148v-184h-80v216l172 172ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-400Zm0 320q133 0 226.5-93.5T800-480q0-133-93.5-226.5T480-800q-133 0-226.5 93.5T160-480q0 133 93.5 226.5T480-160Z"/></svg>',wyt=["00","13","14","15","16","17","18","19","20","21","22","23"],aae=["12","1","2","3","4","5","6","7","8","9","10","11"],V3=["00","05","10","15","20","25","30","35","40","45","50","55"],Syt=(t,e)=>{let{ui:{iconTemplate:i,enableSwitchIcon:r,animation:n,theme:a,mobile:s,editable:o,iconTemplateMobile:l},labels:{time:c,mobileTime:u,am:d,pm:p,cancel:f,ok:h,mobileMinute:m,mobileHour:A},clock:{type:g},timezone:{enabled:v,label:b},range:{enabled:y,fromLabel:I,toLabel:w}}=t,S=s?"mobile":"",T=`<button aria-label="Keyboard" type="button" class="tp-ui-keyboard-icon">${i||PNe}</button>`,D=l||`<button aria-label="Clock" type="button" class="tp-ui-keyboard-icon">${l||RNe}</button>`,C=v?`<div class="tp-ui-timezone ${S}">
        <span class="tp-ui-timezone-label" id="tp-tz-label-${e}">${b}</span>
        <div class="tp-ui-timezone-dropdown" role="combobox" aria-expanded="false" aria-haspopup="listbox" aria-labelledby="tp-tz-label-${e}" tabindex="0" data-tz-id="${e}">
          <div class="tp-ui-timezone-selected" data-placeholder="${b}...">${b}...</div>
          <svg class="tp-ui-timezone-arrow" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
          <div class="tp-ui-timezone-menu" role="listbox" aria-labelledby="tp-tz-label-${e}"></div>
        </div>
      </div>`:"",E=y?`<div class="tp-ui-range-header" role="tablist" aria-label="Range selection"><button type="button" class="tp-ui-range-tab tp-ui-range-from active" role="tab" tabindex="0" aria-selected="true"><span class="tp-ui-range-tab-label">${I}</span><span class="tp-ui-range-tab-value tp-ui-range-from-time">--:--</span></button><button type="button" class="tp-ui-range-tab tp-ui-range-to" role="tab" tabindex="-1" aria-selected="false"><span class="tp-ui-range-tab-label">${w}</span><span class="tp-ui-range-tab-value tp-ui-range-to-time">--:--</span></button></div>`:"";return`<div class="tp-ui-modal normalize ${S}${y?" tp-ui-range-mode":""}" data-theme="${a}" role="dialog" aria-modal="true" aria-labelledby="tp-ui-label-${e}" data-owner-id="${e}" style='transition:${n?"opacity 0.15s linear":"none"}'><div class="tp-ui-wrapper ${S}" tabindex="0">${E}<div class="tp-ui-select-time ${S}" id="tp-ui-label-${e}">${S?u:c}</div><div class="tp-ui-header ${S}"><div class="tp-ui-wrapper-time ${S} ${g==="24h"?"tp-ui-wrapper-time-24h":""}" role="group" aria-label="${S?u:c}"><div class="tp-ui-input-wrapper ${S}"><div class="tp-ui-input-ripple-wrapper ${S}" data-md3-ripple><input name="hour" ${!o&&!S?"readonly":""} class="tp-ui-hour ${S}" tabindex="0" type="number" min="0" max="${g==="12h"?"12":"23"}" aria-label="${S?A:"Hour"}" role="spinbutton" aria-valuenow="12"></div><div class="tp-ui-hour-text ${S}">${A}</div></div><div class="tp-ui-dots ${S}" aria-hidden="true"><span></span><span></span></div><div class="tp-ui-input-wrapper ${S}"><div class="tp-ui-input-ripple-wrapper ${S}" data-md3-ripple><input name="minutes" ${!o&&!S?"readonly":""} class="tp-ui-minutes ${S}" tabindex="0" type="number" min="0" max="59" aria-label="${S?m:"Minute"}" role="spinbutton" aria-valuenow="0"></div><div class="tp-ui-minute-text ${S}">${m}</div></div></div>${g!=="24h"?`<div class="tp-ui-wrapper-type-time ${S}" role="group" aria-label="Period"><div class="tp-ui-type-mode tp-ui-am ${S?"mobile":"tp-ui-ripple"}" data-md3-ripple tabindex="0" role="button" aria-label="${d}" aria-pressed="false" data-type="AM">${d}</div><div class="tp-ui-type-mode tp-ui-pm ${S?"mobile":"tp-ui-ripple"}" data-md3-ripple tabindex="0" role="button" aria-label="${p}" aria-pressed="false" data-type="PM">${p}</div></div>`:""}</div>${C}<div class="tp-ui-mobile-clock-wrapper ${S}"><div class="tp-ui-body ${S}"><div class="tp-ui-clock-face ${S}" role="group" aria-label="Clock"><div class="tp-ui-dot ${S}" aria-hidden="true"></div><div class="tp-ui-clock-hand ${S}" aria-hidden="true"><div class="tp-ui-circle-hand ${S}"></div></div><div class="tp-ui-tips-wrapper ${S}" role="listbox" aria-label="Time"></div>${g==="24h"?`<div class="tp-ui-tips-wrapper-24h ${S}" role="listbox" aria-label="24h"></div>`:""}</div></div></div><div class="tp-ui-footer ${S}" ${S?'data-view="mobile"':""}>${r?`<div class="tp-ui-keyboard-icon-wrapper ${S}" tabindex="0" role="button" aria-pressed="false" aria-label="Toggle" data-view="desktop">${S?D:T}</div>`:""}<div class="tp-ui-wrapper-btn ${S}"><div class="tp-ui-cancel-btn ${S}" data-md3-ripple tabindex="0" role="button" aria-pressed="false" aria-label="${f}">${f}</div><div class="tp-ui-ok-btn ${S}" data-md3-ripple tabindex="0" role="button" aria-pressed="false" aria-label="${h}">${h}</div></div></div></div><div class="timepicker-announcer sr-only" role="status" aria-live="polite" aria-atomic="true"></div></div>`},Uyt=class{core;emitter;timeouts=[];originalOverflow;originalPaddingRight;constructor(e,i){this.core=e,this.emitter=i}runWithTimeout(e,i=ef.DEFAULT_DELAY){let r=setTimeout(e,i);this.timeouts.push(r)}clearAllTimeouts(){this.timeouts.forEach(clearTimeout),this.timeouts=[]}clearExistingModal(){if($l()===!1)return;let e=document.querySelector(".tp-ui-modal");e&&e.remove()}setModalTemplate(){if($l()===!1)return;this.clearExistingModal();let e=Syt(this.core.options,this.core.instanceId);if(this.core.options.ui.inline?.enabled){let r=document.getElementById(this.core.options.ui.inline.containerId);if(!r)return;r.innerHTML="",r.insertAdjacentHTML("beforeend",e);let n=r.querySelector(".tp-ui-modal");if(n){n.classList.add("tp-ui--inline");let{showButtons:a}=this.core.options.ui.inline;(a===!1||a===void 0)&&n.querySelectorAll(".tp-ui-wrapper-btn, .tp-ui-wrapper-btn.mobile").forEach(s=>s.style.display="none")}return}let{appendModalSelector:i}=this.core.options.ui;i?document.querySelector(i)?.insertAdjacentHTML("beforeend",e):document.body.insertAdjacentHTML("beforeend",e)}setScrollbarOrNot(){$l()!==!1&&(this.core.options.ui.inline?.enabled||(this.core.options.ui.enableScrollbar?this.runWithTimeout(()=>{uy()||this.runWithTimeout(()=>{typeof document<"u"&&(document.body.style.overflowY=this.originalOverflow||"",document.body.style.paddingRight=this.originalPaddingRight||"")},ef.SCROLLBAR_RESTORE)},400):(this.originalOverflow=document.body.style.overflowY,this.originalPaddingRight=document.body.style.paddingRight,document.body.style.paddingRight=`${yyt()}px`,document.body.style.overflowY="hidden")))}removeBackdrop(){if(this.core.options.ui.inline?.enabled||this.core.options.ui.backdrop)return;let e=this.core.getModalElement(),i=this.core.getOpenElement();e?.classList.add("removed"),i.forEach(r=>r?.classList.add("disabled"))}setNormalizeClass(){let e=this.core.getModalElement();e&&(e.classList.add("tp-ui-normalize"),e.querySelectorAll(":scope > div").forEach(i=>i.classList.add("tp-ui-normalize")))}setShowClassToBackdrop(){if(this.core.options.ui.inline?.enabled){this.core.getModalElement()?.classList.add("show"),this.setInitialFocus();return}this.core.options.ui.backdrop&&this.runWithTimeout(()=>{this.core.getModalElement()?.classList.add("show"),this.setInitialFocus()},ef.MODAL_ANIMATION)}setInitialFocus(){if(!this.core.options.behavior.focusTrap)return;let e=this.core.getWrapper();e&&typeof requestAnimationFrame<"u"&&requestAnimationFrame(()=>{e.focus()})}setFlexEndToFooterIfNoKeyboardIcon(){let e=this.core.getFooter();!this.core.options.ui.enableSwitchIcon&&e&&(e.style.justifyContent="flex-end")}destroy(){this.clearAllTimeouts(),!uy()&&!this.core.options.ui.inline?.enabled&&(document.body.style.overflowY=this.originalOverflow||"",document.body.style.paddingRight=this.originalPaddingRight||""),this.clearExistingModal()}},Wv=(t,e,i,r)=>{let n={hour:"12",minutes:"00",type:e==="24h"?void 0:"PM"};if(!t)return n;let a=t.value.trim();if(!i&&!a)return n;if(typeof i=="boolean"&&i){let m=new Date,[A,g]=m.toLocaleTimeString().split(":"),v=A.padStart(2,"0");if(/[a-z]/i.test(g)&&e==="12h"){let[b,y]=g.split(" ");return{hour:v,minutes:b,type:y}}return{hour:v,minutes:g,type:void 0}}if(typeof i=="object"){let{time:m,locales:A,preventClockType:g}=i,v=m??new Date;if(g&&r){let[w,S]=new Date(v).toLocaleTimeString().split(":");if(/[a-z]/i.test(S)){let[T,D]=S.split(" ");return{hour:w,minutes:T,type:D}}return{hour:w.padStart(2,"0"),minutes:S,type:void 0}}let b=new Date(v).toLocaleTimeString(A||"en-US",{hour:"2-digit",minute:"2-digit",hour12:e==="12h"}),[y,I]=b.split(":");if(e==="12h"&&/[a-z]/i.test(I)){let w=I.trim().split(" "),S=w[0],T=w[1]||"AM";return{hour:y,minutes:S,type:T}}return{hour:y,minutes:I.replace(/\D/g,""),type:void 0}}let[s,o]=a.split(" "),[l="",c=""]=s.split(":"),u=l.replace(/\D/g,""),d=c.replace(/\D/g,""),p={hour:u.padStart(2,"0"),minutes:d.padStart(2,"0"),type:e==="12h"?o:void 0};if(u.length>2||d.length>2)return{...p,error:"Invalid input: too many digits.",currentHour:l,currentMin:c};if(/[a-z]/i.test(s))return{...p,error:"Input contains invalid letters."};if(a.includes(" ")&&(!o||a.length>8||o!=="AM"&&o!=="PM"))return{...p,error:"Invalid AM/PM format or length.",currentLength:a.length,currentType:o};let f=Number(u),h=Number(d);if(e==="12h"){if(f<1||f>12||h<0||h>59||o!=="AM"&&o!=="PM")return{...p,error:"Invalid 12h time.",currentHour:f,currentMin:h,currentType:o}}else if(f<0||f>23||h<0||h>59)return{...p,error:"Invalid 24h time.",currentHour:f,currentMin:h};return p},sae=(t,e,i)=>{let r=Number(t);if(Number.isNaN(r))return!1;switch(e){case"hour":return i==="24h"?r>=0&&r<=23:r>0&&r<=12;case"minutes":return r>=0&&r<=59;default:return}},oae="tp-ui",Tyt="mousedown mouseup mousemove mouseleave mouseover",Cyt="touchstart touchmove touchend",Eyt=`${Tyt} ${Cyt}`,k0="active",Dyt=class{core;emitter;constructor(t,e){this.core=t,this.emitter=e}isCurrentTimeEnabled(t){let e=this.core.options.clock.currentTime;return typeof e=="boolean"?e:!!e?.[t]}preventClockTypeByCurrentTime(){if(!this.isCurrentTimeEnabled("preventClockType"))return;let t=this.core.getInput();if(!t)return;let{currentTime:e,clockType:i}={currentTime:this.core.options.clock.currentTime,clockType:this.core.options.clock.type},{type:r}=Wv(t,i,e,!0);this.core.updateOptions({clock:{type:r?"12h":"24h"}})}updateInputValueWithCurrentTimeOnStart(){if(!this.isCurrentTimeEnabled("updateInput"))return;let t=this.core.getInput();if(!t)return;let{hour:e,minutes:i,type:r}=Wv(t,this.core.options.clock.type,this.core.options.clock.currentTime);t.value=r?`${e}:${i} ${r}`:`${e}:${i}`}getInputValueOnOpenAndSet(){let t=this.core.getInput();if(!t)return;let e=Wv(t,this.core.options.clock.type,this.core.options.clock.currentTime),i=this.core.getHour(),r=this.core.getMinutes(),n=this.core.getActiveTypeMode(),a=this.core.getAM();if(e===void 0){i&&(i.value="12"),r&&(r.value="00");let d={hour:i?.value||"12",minutes:r?.value||"00",type:n?.dataset.type,degreesHours:this.core.degreesHours,degreesMinutes:this.core.degreesMinutes};this.emitter.emit("open",d);let p=this.core.options.range?.enabled===!0;this.core.options.clock.type!=="24h"&&a&&!p&&a.classList.add(k0);return}let[s,o,l]=t.value.split(":").join(" ").split(" ");t.value.length===0&&(s=e.hour,o=e.minutes,l=e.type),i&&(i.value=s.padStart(2,"0")),r&&(r.value=o.padStart(2,"0"));let c=this.core.getModalElement()?.querySelector(`[data-type='${l}']`);this.core.options.clock.type!=="24h"&&c&&c.classList.add(k0);let u={...e,type:n?.dataset.type,degreesHours:this.core.degreesHours,degreesMinutes:this.core.degreesMinutes};this.emitter.emit("open",u)}getInputValue(t,e,i){return Wv(t,e,i)}destroy(){}},Pyt=class{core;emitter;isAnimating=!1;constructor(t,e){this.core=t,this.emitter=e,this.setupEventListeners()}setupEventListeners(){this.emitter.on("switch:view",()=>{this.toggleMobileClockFace()})}checkMobileOption(){this.core.setIsMobileView(!!this.core.options.ui.mobile),this.core.options.ui.mobile&&this.core.updateOptions({ui:{editable:!0}})}toggleMobileClockFace(){if(this.isAnimating)return;let t=this.core.getModalElement();if(!t)return;let e=t.querySelector(".tp-ui-wrapper"),i=this.core.getKeyboardClockIcon(),r=t.querySelector(".tp-ui-mobile-clock-wrapper"),n=t.querySelectorAll("*"),a=t.querySelector(".tp-ui-select-time"),s=this.core.getHour(),o=this.core.getMinutes(),l=this.core.getClockFace();if(!e)return;let c=e.classList.contains("expanded"),u=this.core.isMobileView;c?this.collapseClockFace(e,r,n,i,a,s,o,l,u):this.expandClockFace(e,r,n,i,a,s,o,l)}collapseClockFace(t,e,i,r,n,a,s,o,l){this.isAnimating=!0,this.switchView(n,r,a,s,!0),i.forEach(c=>{c!==e&&c!==t&&c!==n&&(c.classList.remove("expanded"),l&&c.classList.add("mobile"))}),n&&(n.classList.remove("expanded"),l&&n.classList.add("mobile")),typeof requestAnimationFrame<"u"?requestAnimationFrame(()=>{e?.classList.remove("expanded"),l&&e?.classList.add("mobile"),t?.classList.remove("expanded"),l&&t?.classList.add("mobile"),l?o?.classList.remove("scale-in"):o?.classList.add("scale-in"),setTimeout(()=>{this.isAnimating=!1},ef.MOBILE_TOGGLE)}):this.isAnimating=!1,r?.setAttribute("aria-label","Show clock face"),r?.setAttribute("aria-pressed","false")}expandClockFace(t,e,i,r,n,a,s,o){this.isAnimating=!0,s?.classList.contains("active")&&s?this.emitter.emit("select:minute",{minutes:s.value}):a&&this.emitter.emit("select:hour",{hour:a.value}),i.forEach(l=>{l!==e&&l!==t&&l!==n&&(l.classList.remove("mobile"),l.classList.add("expanded"))}),n&&(n.classList.remove("mobile"),n.classList.add("expanded")),this.switchView(n,r,a,s,!1),typeof requestAnimationFrame<"u"?requestAnimationFrame(()=>{t.classList.remove("mobile"),t.classList.add("expanded"),requestAnimationFrame(()=>{e&&(e.classList.remove("mobile"),e.classList.add("expanded")),o&&o.classList.remove("scale-in"),setTimeout(()=>{o&&o.classList.add("scale-in")},ef.CLOCK_SCALE_DELAY),setTimeout(()=>{this.isAnimating=!1},ef.MOBILE_TOGGLE)})}):this.isAnimating=!1,r?.setAttribute("aria-label","Hide clock face"),r?.setAttribute("aria-pressed","true")}switchView(t,e,i,r,n){let a=this.core.getModalElement(),s=a?.querySelector(".tp-ui-hour-text"),o=a?.querySelector(".tp-ui-minute-text"),l=e?.querySelector(".tp-ui-keyboard-icon"),c=this.core.getInputWrappers(),u=this.core.getHeader(),d=a?.querySelector(".tp-ui-wrapper-type-time"),p=a?.querySelector(".tp-ui-am"),f=a?.querySelector(".tp-ui-pm"),h=a?.querySelectorAll(".tp-ui-input-ripple-wrapper"),{iconTemplate:m,iconTemplateMobile:A}=this.core.options.ui,{time:g,mobileTime:v}=this.core.options.labels;n?(t?.classList.add("mobile"),e?.classList.add("mobile"),i?.classList.add("mobile"),i?.removeAttribute("readonly"),r?.classList.add("mobile"),r?.removeAttribute("readonly"),s?.classList.add("mobile"),o?.classList.add("mobile"),u?.classList.add("mobile"),d?.classList.add("mobile"),p?.classList.add("mobile"),p?.classList.remove("tp-ui-ripple"),f?.classList.add("mobile"),f?.classList.remove("tp-ui-ripple"),c?.forEach(b=>{b.classList.add("mobile")}),h?.forEach(b=>{b.classList.add("mobile")}),t&&v&&(t.textContent=v),l&&(l.innerHTML=A||RNe),this.updateClockFaceAccessibility(!0)):(t?.classList.remove("mobile"),e?.classList.remove("mobile"),i?.classList.remove("mobile"),r?.classList.remove("mobile"),this.core.options.ui.editable||(i?.setAttribute("readonly",""),r?.setAttribute("readonly","")),s?.classList.remove("mobile"),o?.classList.remove("mobile"),u?.classList.remove("mobile"),d?.classList.remove("mobile"),p?.classList.remove("mobile"),p?.classList.add("tp-ui-ripple"),f?.classList.remove("mobile"),f?.classList.add("tp-ui-ripple"),c?.forEach(b=>{b.classList.remove("mobile")}),h?.forEach(b=>{b.classList.remove("mobile")}),t&&g&&(t.textContent=g),l&&(l.innerHTML=m||PNe),this.updateClockFaceAccessibility(!1))}updateClockFaceAccessibility(t){let e=this.core.getClockFace();if(!e)return;let i=e.querySelector(".tp-ui-tips-wrapper"),r=e.querySelector(".tp-ui-tips-wrapper-24h"),n=e.querySelectorAll(".tp-ui-tip");t?(e.setAttribute("aria-hidden","true"),i?.setAttribute("aria-hidden","true"),r?.setAttribute("aria-hidden","true"),n.forEach(a=>{a.setAttribute("tabindex","-1"),a.setAttribute("aria-hidden","true")})):(e.removeAttribute("aria-hidden"),i?.removeAttribute("aria-hidden"),r?.removeAttribute("aria-hidden"),n.forEach(a=>{a.setAttribute("tabindex","0"),a.removeAttribute("aria-hidden")}))}destroy(){}},Ryt=t=>{if(!t)return;let{disabledTime:e,type:i}=t.clock;if(!e||!Object.keys(e).length)return;let{hours:r,minutes:n,interval:a}=e;if(a){delete e.hours,delete e.minutes;let s=Array.isArray(a)?a:[a];if(!i)throw new Error("clockType required for interval");return DNe(s,i),{value:s.map(o=>{let[l,c]=o.trim().split("-"),{hour:u,minutes:d,type:p}=Wv({value:l.trim()},i),{hour:f,minutes:h,type:m}=Wv({value:c.trim()},i),A=CB(u,f).map(y=>Number(y)===0?"00":String(Number(y))),g=[],v=Number(d),b=Number(h);if(m===p)return v>0&&b<=0?(g.push(A[0],A[A.length-1]),A=A.slice(1,-1)):b<59&&b>0&&v<=0?(g.push(void 0,A[A.length-1]),A=A.slice(0,-1)):b>0&&v>0?(g.push(A[0],A[A.length-1]),A=A.slice(1,-1)):b===0&&v===0&&(g.push(void 0,A[A.length-1]),A.pop()),{removedStartedHour:g[0]!==void 0&&Number(g[0])<=9?`0${g[0]}`:g[0],removedEndHour:g[1]!==void 0&&Number(g[1])<=9?`0${g[1]}`:g[1],rangeArrHour:A,startMinutes:CB(d,59).map(y=>Number(y)<=9?`0${y}`:`${y}`),endMinutes:zG(0,h).map(y=>Number(y)<=9?`0${y}`:`${y}`),startType:p,endType:m};{let y=CB(u,12).map(String),I=zG(1,f).map(String),w=[],S=[];return v>0&&b<=0?(S.push(I[I.length-1]),w.push(y[0]),I.pop(),y.shift()):b<59&&b>0&&v<=0?(w.push(y[0]),S.push(I[I.length-1]),I.pop()):b>0&&v>0?(S.push(I[I.length-1]),w.push(y[0]),I.pop(),y.shift()):b===0&&v===0&&(S.push(I[I.length-1]),w.push(y[0]),I.pop()),{startType:p,endType:m,amHours:y,pmHours:I,removedAmHour:w[0]&&Number(w[0])<=9?`0${w[0]}`:w[0],removedPmHour:S[0]&&Number(S[0])<=9?`0${S[0]}`:S[0],startMinutes:Number(d)===0?[]:CB(d,59).map(T=>Number(T)<=9?`0${T}`:`${T}`),endMinutes:zG(0,h).map(T=>Number(T)<=9?`0${T}`:`${T}`)}}}).reduce((o,l)=>(Object.entries(l).forEach(([c,u])=>{Array.isArray(u)?o[c]=Array.isArray(o[c])?[...o[c],...u]:[...u]:o[c]=u}),o),{isInterval:!0,clockType:i,intervals:s})}}return r?.forEach(s=>{if(i==="12h"&&Number(s)>12)throw new Error("The disabled hours value has to be less than 13");if(i==="24h"&&Number(s)>23)throw new Error("The disabled hours value has to be less than 24")}),n?.forEach(s=>{if(Number(s)>59)throw new Error("The disabled minutes value has to be less than 60")}),{value:{hours:r?.map(s=>s==="00"||Number(s)===0?`0${Number(s)}`:`${Number(s)}`),minutes:n?.map(s=>Number(s)<=9?`0${s}`:`${s}`)}}},lae=(t,e,i,r)=>{if(t){if(Array.isArray(t)&&t.length>0)return!t.map(n=>sae(n,e,i)).some(n=>n===!1);if(typeof t=="string"||typeof t=="number")return!!sae(t,e,i)}},Myt=class{core;constructor(t){this.core=t}getDisableTime(){let t=Ryt(this.core.options);this.core.setDisabledTime(t||null)}destroy(){}},Nyt=class{inputValueHandler;mobileViewHandler;disabledTimeHandler;core;constructor(e,i){this.core=e,this.inputValueHandler=new Dyt(e,i),this.mobileViewHandler=new Pyt(e,i),this.disabledTimeHandler=new Myt(e)}preventClockTypeByCurrentTime(){this.inputValueHandler.preventClockTypeByCurrentTime()}updateInputValueWithCurrentTimeOnStart(){this.inputValueHandler.updateInputValueWithCurrentTimeOnStart()}getInputValueOnOpenAndSet(){this.inputValueHandler.getInputValueOnOpenAndSet()}getInputValue(e,i,r){return this.inputValueHandler.getInputValue(e,i,r)}checkMobileOption(){this.mobileViewHandler.checkMobileOption()}toggleMobileClockFace(){this.mobileViewHandler.toggleMobileClockFace()}updateClockFaceAccessibility(e){this.mobileViewHandler.updateClockFaceAccessibility(e)}getDisableTime(){this.disabledTimeHandler.getDisableTime()}destroy(){this.inputValueHandler.destroy(),this.mobileViewHandler.destroy(),this.disabledTimeHandler.destroy()}},Byt=class{core;emitter;constructor(e,i){this.core=e,this.emitter=i}setTheme(){let e=this.core.getModalElement();if(!e)return;let{theme:i}=this.core.options.ui;i&&e.setAttribute("data-theme",i)}setInputClassToInputElement(){let e=this.core.getInput();e&&(byt(e,"tp-ui-input")||e.classList.add("tp-ui-input"))}setDataOpenToInputIfDoesntExistInWrapper(){let e=this.core.getOpenElementData(),i=this.core.getInput();e===null&&i&&i.setAttribute("data-open","tp-ui-input")}setClassTopOpenElement(){let e=this.core.getOpenElement();for(let i of e)i&&i.classList.add("tp-ui-open-element")}setTimepickerClassToElement(){let e=this.core.element;if(!e)return;e.classList.add(oae);let i=this.core.options.ui.cssClass;i&&i!==oae&&e.classList.add(i)}destroy(){let e=this.core.getModalElement();e&&e.removeAttribute("data-theme")}},qG=class MNe extends Error{constructor(e,i){super(`[TimepickerUI] ${e}`),this.code=i,this.name="TimepickerError",Object.setPrototypeOf(this,MNe.prototype)}},WG={INVALID_PARAMETER:"INVALID_PARAMETER"},kyt=class{core;emitter;constructor(e,i){this.core=e,this.emitter=i}setErrorHandler(){let e=this.core.getInput();if(!e)return!0;let{error:i,currentHour:r,currentMin:n,currentType:a,currentLength:s}=Wv(e,this.core.options.clock.type);if(this.removeErrorHandler(),i){if($l()===!1)return!1;let o=document.createElement("div");o.classList.add("tp-ui-invalid-text"),o.innerHTML="<b>Invalid Time Format</b>",e.classList.add("tp-ui-invalid-format"),e.nextElementSibling?.classList.contains("tp-ui-invalid-text")||e.after(o);let l={error:i,rejectedHour:void 0,rejectedMinute:void 0,inputHour:r,inputMinute:n,inputType:a,inputLength:s};return this.emitter.emit("error",l),!1}return!0}removeErrorHandler(){let e=this.core.getInput();if(!e)return;e.classList.remove("tp-ui-invalid-format");let i=e.nextElementSibling;i?.classList.contains("tp-ui-invalid-text")&&i.remove()}checkDisabledValuesOnStart(){if(!this.core.options.clock.disabledTime)return;let{disabledTime:e,type:i}=this.core.options.clock;if(e.interval){if(!i)throw new qG("clockType is required when using disabledTime.interval",WG.INVALID_PARAMETER);let o=Array.isArray(e.interval)?e.interval:[e.interval];try{DNe(o,i)}catch(l){throw new qG(`Invalid disabledTime.interval: ${l.message}`,WG.INVALID_PARAMETER)}return}let{hours:r,minutes:n}=e,a=r?lae(r,"hour",i):!0,s=n?lae(n,"minutes",i):!0;if(!a||!s)throw new qG("Invalid hours or minutes in disabledTime option",WG.INVALID_PARAMETER)}destroy(){this.removeErrorHandler()}},gC=(t,e)=>{if(!t)return;let i=t.querySelector(".timepicker-announcer");i&&(i.textContent="",setTimeout(()=>{i.textContent=e},100))},EB=(t,e)=>{t&&t.setAttribute("aria-pressed",String(e))},xyt=class{core;emitter;cleanupHandlers=[];constructor(t,e){this.core=t,this.emitter=e}handleOpenOnClick(){let t=this.core.getOpenElement();if(!t)return;let e=()=>{this.core.isDestroyed||this.emitter.emit("show",{})};t.forEach(i=>{i.addEventListener("click",e),this.cleanupHandlers.push(()=>i.removeEventListener("click",e))})}handleCancelButton(){let t=this.core.getCancelButton();if(!t)return;let e=()=>{this.core.isDestroyed||this.emitter.emit("cancel",{})};t.addEventListener("click",e),this.cleanupHandlers.push(()=>t.removeEventListener("click",e))}handleOkButton(){let t=this.core.getOkButton();if(!t)return;let e=()=>{if(this.core.isDestroyed)return;let i=this.core.getHour(),r=this.core.getMinutes(),n=this.core.getActiveTypeMode();this.emitter.emit("confirm",{hour:i?.value,minutes:r?.value,type:n?.textContent||void 0})};t.addEventListener("click",e),this.cleanupHandlers.push(()=>t.removeEventListener("click",e))}handleAmClick(){let t=this.core.getAM();if(!t)return;let e=()=>{if(this.core.isDestroyed)return;let i=this.core.getPM();t.classList.add("active"),i?.classList.remove("active"),EB(t,!0),EB(i,!1);let r=this.core.getModalElement();gC(r,"AM selected"),this.emitter.emit("select:am",{});let n=this.core.getHour(),a=this.core.getMinutes();this.emitter.emit("update",{hour:n?.value,minutes:a?.value,type:"AM"})};t.addEventListener("click",e),this.cleanupHandlers.push(()=>t.removeEventListener("click",e))}handlePmClick(){let t=this.core.getPM();if(!t)return;let e=()=>{if(this.core.isDestroyed)return;let i=this.core.getAM();t.classList.add("active"),i?.classList.remove("active"),EB(t,!0),EB(i,!1);let r=this.core.getModalElement();gC(r,"PM selected"),this.emitter.emit("select:pm",{});let n=this.core.getHour(),a=this.core.getMinutes();this.emitter.emit("update",{hour:n?.value,minutes:a?.value,type:"PM"})};t.addEventListener("click",e),this.cleanupHandlers.push(()=>t.removeEventListener("click",e))}handleSwitchViewButton(){let t=this.core.getKeyboardClockIcon();if(!t)return;let e=()=>{this.core.isDestroyed||this.emitter.emit("switch:view",{})};t.addEventListener("click",e),this.cleanupHandlers.push(()=>t.removeEventListener("click",e))}destroy(){this.cleanupHandlers.forEach(t=>t()),this.cleanupHandlers=[]}},NNe=(t,e,i)=>Math.max(e,Math.min(i,t)),_yt=(t,e)=>{if(t==="")return"";let i=parseInt(t,10);return Number.isNaN(i)?"":NNe(i,e?1:0,e?12:23).toString().padStart(2,"0")},Oyt=t=>{if(t==="")return"";let e=parseInt(t,10);return Number.isNaN(e)?"":NNe(e,0,59).toString().padStart(2,"0")},Fyt=class{core;emitter;cleanupHandlers=[];constructor(t,e){this.core=t,this.emitter=e}handleHourEvents(){let t=this.core.getHour();if(!t)return;let e=()=>{if(this.core.isDestroyed)return;t.classList.add("active");let n=this.core.getMinutes();n?.classList.remove("active"),this.emitter.emit("select:hour",{hour:t.value});let a=this.core.getActiveTypeMode();this.emitter.emit("update",{hour:t.value,minutes:n?.value,type:a?.textContent||void 0})};t.addEventListener("click",e),this.cleanupHandlers.push(()=>t.removeEventListener("click",e));let i=t.value,r=()=>{if(this.core.isDestroyed||t.hasAttribute("readonly"))return;let n=this.core.options.clock.type==="12h",a=_yt(t.value,n);if(t.value=a,t.setAttribute("aria-valuenow",a),t.value!==i){i=t.value,this.emitter.emit("animation:clock",{}),this.emitter.emit("select:hour",{hour:t.value});let s=this.core.getMinutes(),o=this.core.getActiveTypeMode();this.emitter.emit("update",{hour:t.value,minutes:s?.value,type:o?.textContent||void 0})}};t.addEventListener("blur",r),this.cleanupHandlers.push(()=>t.removeEventListener("blur",r))}handleMinutesEvents(){let t=this.core.getMinutes();if(!t)return;let e=()=>{if(this.core.isDestroyed)return;t.classList.add("active");let n=this.core.getHour();n?.classList.remove("active"),this.emitter.emit("select:minute",{minutes:t.value});let a=this.core.getActiveTypeMode();this.emitter.emit("update",{hour:n?.value,minutes:t.value,type:a?.textContent||void 0})};t.addEventListener("click",e),this.cleanupHandlers.push(()=>t.removeEventListener("click",e));let i=t.value,r=()=>{if(this.core.isDestroyed||t.hasAttribute("readonly"))return;let n=Oyt(t.value);if(t.value=n,t.setAttribute("aria-valuenow",n),t.value!==i){i=t.value,this.emitter.emit("animation:clock",{}),this.emitter.emit("select:minute",{minutes:t.value});let a=this.core.getHour(),s=this.core.getActiveTypeMode();this.emitter.emit("update",{hour:a?.value,minutes:t.value,type:s?.textContent||void 0})}};t.addEventListener("blur",r),this.cleanupHandlers.push(()=>t.removeEventListener("blur",r))}destroy(){this.cleanupHandlers.forEach(t=>t()),this.cleanupHandlers=[]}},Lyt=class{core;emitter;cleanupHandlers=[];constructor(t,e){this.core=t,this.emitter=e}handleOpenOnEnterFocus(){let t=this.core.getInput();if(!t)return;let e=i=>{i.key==="Enter"&&!this.core.isDestroyed&&this.emitter.emit("show",{})};t.addEventListener("keydown",e),this.cleanupHandlers.push(()=>t.removeEventListener("keydown",e))}handleEscClick(){if($l()===!1)return;let t=e=>{this.core.isDestroyed||e.key==="Escape"&&this.emitter.emit("cancel",{})};document.addEventListener("keydown",t),this.cleanupHandlers.push(()=>document.removeEventListener("keydown",t))}handleKeyboardInput(){let t=this.core.getHour(),e=this.core.getMinutes();if(t){let i=r=>{if(this.core.isDestroyed||r.key!=="ArrowUp"&&r.key!=="ArrowDown")return;r.preventDefault();let n=parseInt(t.value)||0,a=parseInt(t.getAttribute("max")||"23");parseInt(t.getAttribute("min")||"0");let s=this.core.options.clock.type==="12h",o;r.key==="ArrowUp"?s?o=n>=12?1:n+1:o=n>=a?0:n+1:s?o=n<=1?12:n-1:o=n<=0?a:n-1,t.value=o.toString().padStart(2,"0"),t.setAttribute("aria-valuenow",t.value);let l=this.core.getModalElement();gC(l,`Hour: ${t.value}`),this.emitter.emit("animation:clock",{}),this.emitter.emit("select:hour",{hour:t.value});let c=this.core.getMinutes(),u=this.core.getActiveTypeMode();this.emitter.emit("update",{hour:t.value,minutes:c?.value,type:u?.textContent||void 0})};t.addEventListener("keydown",i),this.cleanupHandlers.push(()=>t.removeEventListener("keydown",i))}if(e){let i=r=>{if(this.core.isDestroyed||r.key!=="ArrowUp"&&r.key!=="ArrowDown")return;r.preventDefault();let n=parseInt(e.value)||0,a=59,s=0,o;r.key==="ArrowUp"?o=n>=a?s:n+1:o=n<=s?a:n-1,e.value=o.toString().padStart(2,"0"),e.setAttribute("aria-valuenow",e.value);let l=this.core.getModalElement();gC(l,`Minutes: ${e.value}`),this.emitter.emit("animation:clock",{}),this.emitter.emit("select:minute",{minutes:e.value});let c=this.core.getHour(),u=this.core.getActiveTypeMode();this.emitter.emit("update",{hour:c?.value,minutes:e.value,type:u?.textContent||void 0})};e.addEventListener("keydown",i),this.cleanupHandlers.push(()=>e.removeEventListener("keydown",i))}}focusTrapHandler(){if($l()===!1)return;let t=this.core.getWrapper();if(!t)return;let e=i=>{if(this.core.isDestroyed||i.key!=="Tab")return;let r=t.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),n=r[0],a=r[r.length-1];i.shiftKey&&document.activeElement===n?(a?.focus(),i.preventDefault()):!i.shiftKey&&document.activeElement===a&&(n?.focus(),i.preventDefault())};t.addEventListener("keydown",e),this.cleanupHandlers.push(()=>t.removeEventListener("keydown",e))}destroy(){this.cleanupHandlers.forEach(t=>t()),this.cleanupHandlers=[]}},$yt=class{core;emitter;cleanupHandlers=[];constructor(t,e){this.core=t,this.emitter=e}handleBackdropClick(){let t=this.core.getModalElement();if(!t)return;let e=i=>{this.core.isDestroyed||i.target===t&&this.emitter.emit("cancel",{})};t.addEventListener("click",e),this.cleanupHandlers.push(()=>t.removeEventListener("click",e))}handleMoveHand(){if($l()===!1)return;let t=e=>{this.core.isDestroyed||e.preventDefault()};document.addEventListener("mousedown",t,!1),document.addEventListener("touchstart",t,{passive:!1}),this.cleanupHandlers.push(()=>{document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",t)})}destroy(){this.cleanupHandlers.forEach(t=>t()),this.cleanupHandlers=[]}},Hyt=class{buttonHandlers;inputHandlers;keyboardHandlers;modalHandlers;constructor(e,i){this.buttonHandlers=new xyt(e,i),this.inputHandlers=new Fyt(e,i),this.keyboardHandlers=new Lyt(e,i),this.modalHandlers=new $yt(e,i)}handleOpenOnClick(){this.buttonHandlers.handleOpenOnClick()}handleOpenOnEnterFocus(){this.keyboardHandlers.handleOpenOnEnterFocus()}handleCancelButton(){this.buttonHandlers.handleCancelButton()}handleOkButton(){this.buttonHandlers.handleOkButton()}handleBackdropClick(){this.modalHandlers.handleBackdropClick()}handleEscClick(){this.keyboardHandlers.handleEscClick()}handleAmClick(){this.buttonHandlers.handleAmClick()}handlePmClick(){this.buttonHandlers.handlePmClick()}handleHourEvents(){this.inputHandlers.handleHourEvents()}handleMinutesEvents(){this.inputHandlers.handleMinutesEvents()}handleKeyboardInput(){this.keyboardHandlers.handleKeyboardInput()}focusTrapHandler(){this.keyboardHandlers.focusTrapHandler()}handleMoveHand(){this.modalHandlers.handleMoveHand()}handleSwitchViewButton(){this.buttonHandlers.handleSwitchViewButton()}destroy(){this.buttonHandlers.destroy(),this.inputHandlers.destroy(),this.keyboardHandlers.destroy(),this.modalHandlers.destroy()}},Vyt=class{emitter;getClockSystem;setHoursToClock;setMinutesToClock;updateAmPm;convertDisabledTime;constructor(e,i,r,n,a,s){this.emitter=e,this.getClockSystem=i,this.setHoursToClock=r,this.setMinutesToClock=n,this.updateAmPm=a,this.convertDisabledTime=s}setup(){this.emitter.on("select:hour",({hour:e})=>{this.emitter.emit("animation:clock",{}),this.setHoursToClock(e||null)}),this.emitter.on("select:minute",({minutes:e})=>{this.emitter.emit("animation:clock",{}),this.setMinutesToClock(e||null)}),this.emitter.on("select:am",()=>{this.updateAmPm()}),this.emitter.on("select:pm",()=>{this.updateAmPm()}),this.emitter.on("animation:start",()=>{this.getClockSystem()?.blockInteractions()}),this.emitter.on("animation:end",()=>{this.getClockSystem()?.unblockInteractions()}),this.emitter.on("range:switch",e=>{this.refreshDisabledTimeForRange(e.disabledTime)})}refreshDisabledTimeForRange(e){let i=this.getClockSystem();if(!i)return;let r=this.convertDisabledTime(),n=r;if(e){let a=[...r?.hours||[],...e.hours||[]],s=[...r?.minutes||[],...e.minutes||[]];n={...r,hours:a.length>0?a:void 0,minutes:s.length>0?s:void 0,rangeFromType:e.fromType,rangeFromHour:e.fromHour}}i.updateDisabledTime(n)}},Mv=class{static angleToIndex(e,i,r){let n=Math.round(e/30)%12;if(i==="24h")if(r){let a=n+12;return a===12?0:a}else return n===0?12:n;return n===0?12:n}static indexToValue(e,i,r){if(i==="24h")return e.toString().padStart(2,"0");let n=e;return n===0&&(n=12),n>12&&(n=n-12),n.toString().padStart(2,"0")}static indexToAngle(e,i){return i==="24h"?e>=12?(e-12)%12*30:e%12*30:(e===0?12:e)%12*30}static isDisabled(e,i,r){return r?r.isInterval&&r.intervals&&r.clockType?this.isDisabledByInterval(e,i,r):r.rangeFromType!==void 0&&r.rangeFromHour!==void 0?this.isDisabledForRange12h(e,i,r):r.hours?r.hours.some(n=>String(n)===e||Number(n)===Number(e)||n===e):!1:!1}static isDisabledForRange12h(e,i,r){let n=r.rangeFromType,a=r.rangeFromHour,s=parseInt(e,10);return n===null||a===void 0?!1:i==="AM"&&n==="PM"?!0:i==="AM"&&n==="AM"?a===12?!1:s===12?!0:s<a:i==="PM"&&n==="AM"?!1:i==="PM"&&n==="PM"?a===12?!1:s===12?!0:s<a:!1}static isDisabledByInterval(e,i,r){if(!r.intervals)return!1;for(let n=0;n<60;n++){let a=n.toString().padStart(2,"0");if(!this.isTimeInIntervals(e,a,i,r.intervals,r.clockType))return!1}return!0}static isTimeInIntervals(e,i,r,n,a){let s=a==="12h"?`${e}:${i} ${r}`:`${e}:${i}`;for(let o of n){let[l,c]=o.split("-").map(u=>u.trim());if(this.isTimeBetween(s,l,c,a))return!0}return!1}static isTimeBetween(e,i,r,n){let a=this.timeToMinutes(e,n),s=this.timeToMinutes(i,n),o=this.timeToMinutes(r,n);return a>=s&&a<=o}static timeToMinutes(e,i){if(i==="12h"){let r=e.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);if(!r)return 0;let n=parseInt(r[1]),a=parseInt(r[2]),s=r[3].toUpperCase();return s==="PM"&&n!==12&&(n+=12),s==="AM"&&n===12&&(n=0),n*60+a}else{let[r,n]=e.split(":").map(Number);return r*60+n}}static findNearestValid(e,i,r,n,a){let s=i==="24h"?23:12;for(let o=0;o<=s;o++){let l=o===0?[e]:[e+o,e-o];for(let c of l){let u=c;u<0&&(u+=s+1),u>s&&(u=u%(s+1));let d=this.indexToValue(u,i,r);if(!this.isDisabled(d,r,n))return u}}return e}},Nv=class{static angleToIndex(e){return Math.round(e/6)%60}static indexToValue(e){return e.toString().padStart(2,"0")}static indexToAngle(e){return e%60*6}static isDisabled(e,i,r,n,a){return n?n.isInterval&&n.intervals?this.isDisabledByInterval(e,i,r,n,a):n.rangeFromType!==void 0&&n.rangeFromHour!==void 0?this.isDisabledForRange12h(e,i,r,n):n.minutes?n.minutes.some(s=>String(s)===e||Number(s)===Number(e)||s===e):!1:!1}static isDisabledForRange12h(e,i,r,n){let a=n.rangeFromType,s=n.rangeFromHour,o=parseInt(i,10),l=parseInt(e,10);if(a===null||s===void 0)return!1;let c=n.minutes||[],u=c.length>0?parseInt(c[c.length-1],10)+1:0;return r==="AM"&&a==="PM"?!0:r==="PM"&&a==="AM"?!1:o===s||o===12&&s===12||r===a&&o===s?l<u:!1}static isDisabledByInterval(e,i,r,n,a){if(!n.intervals)return!1;let s=a==="12h"?`${i}:${e} ${r}`:`${i}:${e}`;for(let o of n.intervals){let[l,c]=o.split("-").map(u=>u.trim());if(this.isTimeBetween(s,l,c,a))return!0}return!1}static isTimeBetween(e,i,r,n){let a=this.timeToMinutes(e,n),s=this.timeToMinutes(i,n),o=this.timeToMinutes(r,n);return a>=s&&a<=o}static timeToMinutes(e,i){if(i==="12h"){let r=e.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);if(!r)return 0;let n=parseInt(r[1]),a=parseInt(r[2]),s=r[3].toUpperCase();return s==="PM"&&n!==12&&(n+=12),s==="AM"&&n===12&&(n=0),n*60+a}else{let[r,n]=e.split(":").map(Number);return r*60+n}}static findNearestValid(e,i,r,n,a){for(let s=0;s<60;s++){let o=s===0?[e]:[e+s,e-s];for(let l of o){let c=l;c<0&&(c+=60),c>=60&&(c=c%60);let u=this.indexToValue(c);if(!this.isDisabled(u,i,r,n,a))return c}}return e}},nI=class{static normalizeAngle(e){let i=e%360;return i<0&&(i+=360),i}static calculateRawAngle(e,i){let r=e.x-i.x,n=e.y-i.y,a=Math.atan2(n,r)*180/Math.PI+90;return this.normalizeAngle(a)}static snapToIncrement(e,i){let r=Math.round(e/i)*i;return this.normalizeAngle(r)}static calculateDistance(e,i){let r=e.x-i.x,n=e.y-i.y;return Math.sqrt(r*r+n*n)}static isInnerCircle(e,i){return e<i*.75}static calculateShortestPath(e,i){let r=this.normalizeAngle(e),n=this.normalizeAngle(i)-r,a=n>=0?n:n+360,s=n<=0?n:n-360,o=Math.abs(a)<Math.abs(s)?a:s;return e+o}},Gyt=class{config;currentAngle=0;tipsCache=new Map;cachedDimensions=new Map;constructor(t){this.config=t}getCachedDimensions(t){let e=this.cachedDimensions.get(t);if(!e){let i=(t.offsetWidth-32)/2,r=(t.offsetHeight-32)/2,n=i-9;e={width:i,height:r,radius:n},this.cachedDimensions.set(t,e)}return e}setHandAngle(t){let e=nI.calculateShortestPath(this.currentAngle,t);Math.abs(this.currentAngle-e)<.01||(this.currentAngle=e,this.config.clockHand.style.transform=`rotateZ(${e}deg)`)}animateToAngle(t){let e=nI.calculateShortestPath(this.currentAngle,t);this.currentAngle=e,this.config.tipsWrapper.classList.add("tp-ui-tips-animation"),this.config.clockHand.style.transform=`rotateZ(${e}deg)`,setTimeout(()=>{this.config.tipsWrapper.classList.remove("tp-ui-tips-animation")},401)}setActiveValue(t){let e=[this.config.tipsWrapper];this.config.tipsWrapperFor24h&&e.push(this.config.tipsWrapperFor24h),e.forEach(i=>{i.querySelectorAll(".tp-ui-value-tips, .tp-ui-value-tips-24h").forEach(r=>{let n=r;n.textContent===t||Number(n.textContent)===Number(t)?(n.classList.add("active"),n.setAttribute("aria-selected","true")):(n.classList.remove("active"),n.setAttribute("aria-selected","false"))})})}renderTips(t,e,i,r,n,a=!0,s,o="",l="12"){if($l()===!1)return;let c=s||this.config.tipsWrapper;a&&(c.innerHTML="",this.tipsCache.clear());let{width:u,height:d,radius:p}=this.getCachedDimensions(c),f=document.createDocumentFragment(),h=`${e}-${this.config.theme||"default"}`;t.forEach((m,A)=>{let g=`${h}-${m}`,v=this.tipsCache.get(g);v||(v=this.createTip(m,e,n),this.tipsCache.set(g,v));let{wrapper:b,tip:y}=v;this.updateTipState(b,y,m,i,r,n,o,l);let I=A*(360/t.length)*(Math.PI/180);b.style.left=`${u+Math.sin(I)*p}px`,b.style.bottom=`${d+Math.cos(I)*p}px`,f.appendChild(b)}),c.appendChild(f)}createTip(t,e,i){if($l()===!1){let s={};return{wrapper:s,tip:s}}let r=document.createElement("span"),n=document.createElement("span");n.textContent=t,n.setAttribute("role","option"),n.setAttribute("aria-selected","false"),n.tabIndex=0;let a=i==="24h"&&e.includes("24")?"tp-ui-value-tips-24h":"tp-ui-value-tips";return n.classList.add(a),r.classList.add(e),this.config.theme&&(r.classList.add(this.config.theme),n.classList.add(this.config.theme)),r.appendChild(n),{wrapper:r,tip:n}}updateTipState(t,e,i,r,n,a,s,o){t.classList.remove("tp-ui-tips-disabled"),e.classList.remove("tp-ui-tips-disabled"),e.removeAttribute("aria-disabled"),e.tabIndex=0,this.checkIfDisabled(i,r,n,a,s,o)&&(t.classList.add("tp-ui-tips-disabled"),e.classList.add("tp-ui-tips-disabled"),e.setAttribute("aria-disabled","true"),e.tabIndex=-1)}checkIfDisabled(t,e,i,r,n,a){return i?e==="hours"?Mv.isDisabled(t,n,i):e==="minutes"?Nv.isDisabled(t,a,n,i,r):!1:!1}setCircleSize(t){t?this.config.circle.classList.remove("small-circle"):this.config.circle.classList.add("small-circle")}setCircle24hMode(t){t?(this.config.circle.classList.add("tp-ui-circle-hand-24h"),this.config.clockHand.classList.add("tp-ui-clock-hand-24h")):(this.config.circle.classList.remove("tp-ui-circle-hand-24h"),this.config.clockHand.classList.remove("tp-ui-clock-hand-24h"))}destroy(){this.tipsCache.clear(),this.cachedDimensions.clear(),this.config.tipsWrapper.innerHTML=""}},KG=class{static processPointerInput(e){let i=nI.calculateRawAngle(e.pointerPosition,e.clockCenter);return e.mode==="hours"?this.processHours(i,e):this.processMinutes(i,e)}static processHours(e,i){let r=i.smoothHourSnap??!0,n;if(r)n=e;else{let p=i.incrementHours*30;n=nI.snapToIncrement(e,p)}let a=nI.calculateDistance(i.pointerPosition,i.clockCenter),s=i.clockType==="24h"&&nI.isInnerCircle(a,i.clockRadius),o=Mv.angleToIndex(n,i.clockType,s),l=Mv.indexToValue(o,i.clockType,i.amPm),c=Mv.isDisabled(l,i.amPm,i.disabledTime);c&&(o=Mv.findNearestValid(o,i.clockType,i.amPm,i.disabledTime,s));let u=Mv.indexToValue(o,i.clockType,i.amPm),d;return r?d=e:d=Mv.indexToAngle(o,i.clockType),{angle:d,value:u,index:o,isValid:!c,isInnerCircle:i.clockType==="24h"?s:void 0}}static processMinutes(e,i){let r=i.incrementMinutes*6,n=nI.snapToIncrement(e,r),a=Nv.angleToIndex(n),s=Nv.indexToValue(a),o=i.currentHour||"00",l=Nv.isDisabled(s,o,i.amPm,i.disabledTime,i.clockType);l&&(a=Nv.findNearestValid(a,o,i.amPm,i.disabledTime,i.clockType));let c=Nv.indexToValue(a);return{angle:Nv.indexToAngle(a),value:c,index:a,isValid:!l}}static valueToAngle(e,i,r){let n=parseInt(e,10);return i==="hours"?Mv.indexToAngle(n,r):Nv.indexToAngle(n)}},Qyt=class{state;renderer;clockType;disabledTime;incrementHours;incrementMinutes;smoothHourSnap;isDragging=!1;callbacks;lastProcessedX=null;lastProcessedY=null;constructor(t,e,i,r,n=1,a=1,s=!0,o={}){this.renderer=t,this.state={...e},this.clockType=i,this.disabledTime=r,this.incrementHours=n,this.incrementMinutes=a,this.smoothHourSnap=s,this.callbacks=o}handlePointerMove(t,e,i){if(this.isDragging=!0,this.lastProcessedX===t.x&&this.lastProcessedY===t.y)return;this.lastProcessedX=t.x,this.lastProcessedY=t.y;let r={pointerPosition:t,clockCenter:e,clockRadius:i,mode:this.state.mode,clockType:this.clockType,amPm:this.state.amPm,disabledTime:this.disabledTime,incrementHours:this.incrementHours,incrementMinutes:this.incrementMinutes,smoothHourSnap:this.smoothHourSnap,currentHour:this.state.hour},n=KG.processPointerInput(r);if(n.isValid){if(this.state.mode==="hours"){let a=this.state.hour;this.state.hour=n.value,this.state.hourAngle=n.angle,this.clockType==="24h"&&n.isInnerCircle!==void 0&&(this.renderer.setCircleSize(!0),this.renderer.setCircle24hMode(n.isInnerCircle)),this.callbacks.onHourChange&&a!==n.value&&this.callbacks.onHourChange(n.value)}else{let a=this.state.minute;this.state.minute=n.value,this.state.minuteAngle=n.angle,this.renderer.setCircleSize(!0),this.renderer.setCircle24hMode(!1),this.callbacks.onMinuteChange&&a!==n.value&&this.callbacks.onMinuteChange(n.value)}this.renderer.setHandAngle(n.angle),this.renderer.setActiveValue(n.value)}}handlePointerUp(){this.isDragging=!1,this.lastProcessedX=null,this.lastProcessedY=null}snapToNearestHour(){if(this.state.mode!=="hours")return;let t=KG.valueToAngle(this.state.hour,"hours",this.clockType);this.state.hourAngle=t,this.renderer.animateToAngle(t)}switchMode(t){this.state.mode=t;let e=t==="hours"?this.state.hourAngle:this.state.minuteAngle,i=t==="hours"?this.state.hour:this.state.minute;if(t==="hours"&&this.clockType==="24h"){let r=parseInt(i,10),n=r===0||r>=13;this.renderer.setCircleSize(!0),this.renderer.setCircle24hMode(n)}else this.renderer.setCircleSize(!0),this.renderer.setCircle24hMode(!1);this.renderer.setHandAngle(e),this.renderer.setActiveValue(i)}setValue(t,e){let i=KG.valueToAngle(e,t,this.clockType);if(t==="hours")if(this.state.hour=e,this.state.hourAngle=i,this.clockType==="24h"){let r=parseInt(e,10),n=r===0||r>=13;this.renderer.setCircleSize(!0),this.renderer.setCircle24hMode(n)}else this.renderer.setCircle24hMode(!1);else this.state.minute=e,this.state.minuteAngle=i,this.renderer.setCircleSize(!0),this.renderer.setCircle24hMode(!1);this.state.mode===t&&(this.renderer.setHandAngle(i),this.renderer.setActiveValue(e))}setAmPm(t){this.state.amPm=t}getState(){return{...this.state}}getHour(){return this.state.hour}getMinute(){return this.state.minute}getAmPm(){return this.state.amPm}updateDisabledTime(t){this.disabledTime=t}destroy(){this.renderer.destroy()}},jyt=class{controller;clockFace;isActive=!1;isBlocked=!1;config;cachedRect=null;cachedCenter=null;cachedRadius=null;rafId=null;constructor(t,e,i={}){this.controller=t,this.clockFace=e,this.config=i}attach(){this.clockFace.addEventListener("mousedown",this.handlePointerDown),this.clockFace.addEventListener("touchstart",this.handlePointerDown,{passive:!1})}detach(){this.clockFace.removeEventListener("mousedown",this.handlePointerDown),this.clockFace.removeEventListener("touchstart",this.handlePointerDown),this.removeGlobalListeners()}block(){this.isBlocked=!0}unblock(){this.isBlocked=!1}handlePointerDown=t=>{if(uy()||this.isBlocked)return;let e=t.target;e&&e.classList&&e.classList.contains("tp-ui-tips-disabled")||(t.preventDefault(),this.isActive=!0,this.cachedRect=this.clockFace.getBoundingClientRect(),this.cachedCenter=this.getClockCenter(),this.cachedRadius=this.getClockRadius(),this.processPointerEvent(t),document.addEventListener("mousemove",this.handlePointerMove),document.addEventListener("touchmove",this.handlePointerMove,{passive:!1}),document.addEventListener("mouseup",this.handlePointerUp),document.addEventListener("touchend",this.handlePointerUp))};handlePointerMove=t=>{if(!this.isActive||this.isBlocked)return;let e=this.getTargetElement(t);e&&e.classList&&e.classList.contains("tp-ui-tips-disabled")||(t.preventDefault(),this.rafId===null&&(this.rafId=requestAnimationFrame(()=>{this.rafId=null,this.processPointerEvent(t)})))};handlePointerUp=()=>{if(!this.isActive)return;this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.isActive=!1,this.cachedRect=null,this.cachedCenter=null,this.cachedRadius=null,this.controller.handlePointerUp();let{autoSwitchToMinutes:t,isMobileView:e,smoothHourSnap:i,hourElement:r,minutesElement:n}=this.config;i&&r?.classList.contains("active")&&this.controller.snapToNearestHour(),this.removeGlobalListeners(),t&&r?.classList.contains("active")&&!e?(r.classList.remove("active"),n?.classList.add("active"),n?.click(),n?.focus(),r.blur()):n?.classList.contains("active")&&this.config.onMinuteCommit&&this.config.onMinuteCommit()};processPointerEvent(t){let e=this.getPointerPosition(t),i=this.cachedCenter||this.getClockCenter(),r=this.cachedRadius||this.getClockRadius();this.controller.handlePointerMove(e,i,r)}getPointerPosition(t){let e=this.cachedRect||this.clockFace.getBoundingClientRect();if("touches"in t){let i=t.touches[0]||t.changedTouches[0];return{x:i.clientX-e.left,y:i.clientY-e.top}}else return{x:t.clientX-e.left,y:t.clientY-e.top}}getTargetElement(t){if("touches"in t){let e=t.touches[0]||t.changedTouches[0];if(e&&!uy())return document.elementFromPoint(e.clientX,e.clientY)}return t.target}getClockCenter(){let t=this.clockFace.offsetWidth,e=this.clockFace.offsetHeight;return{x:t/2,y:e/2}}getClockRadius(){return this.clockFace.offsetWidth/2}removeGlobalListeners(){$l()!==!1&&(document.removeEventListener("mousemove",this.handlePointerMove),document.removeEventListener("touchmove",this.handlePointerMove),document.removeEventListener("mouseup",this.handlePointerUp),document.removeEventListener("touchend",this.handlePointerUp))}},zyt=class{renderer;controller;dragHandlers;clockType;disabledTime;tipsWrapper;tipsWrapperFor24h;constructor(t){this.clockType=t.clockType,this.disabledTime=t.disabledTime,this.tipsWrapper=t.tipsWrapper,this.tipsWrapperFor24h=t.tipsWrapperFor24h;let e={clockFace:t.clockFace,tipsWrapper:t.tipsWrapper,tipsWrapperFor24h:t.tipsWrapperFor24h,clockHand:t.clockHand,circle:t.circle,theme:t.theme};this.renderer=new Gyt(e);let i={hour:t.initialHour,minute:t.initialMinute,amPm:t.initialAmPm,hourAngle:this.calculateInitialAngle("hours",t.initialHour),minuteAngle:this.calculateInitialAngle("minutes",t.initialMinute),mode:"hours"},r={onHourChange:t.onHourChange,onMinuteChange:t.onMinuteChange};this.controller=new Qyt(this.renderer,i,t.clockType,t.disabledTime,t.incrementHours||1,t.incrementMinutes||1,t.smoothHourSnap??!0,r),this.dragHandlers=new jyt(this.controller,t.clockFace,t.dragConfig||{})}initialize(){this.dragHandlers.attach(),this.switchToHours()}switchToHours(){this.controller.switchMode("hours"),this.clockType==="24h"&&this.tipsWrapperFor24h&&this.tipsWrapperFor24h.classList.remove("none"),this.renderHourTips();let t=this.controller.getState();this.renderer.setActiveValue(t.hour)}switchToMinutes(){this.controller.switchMode("minutes"),this.tipsWrapperFor24h&&this.tipsWrapperFor24h.classList.add("none"),this.renderMinuteTips();let t=this.controller.getState();this.renderer.setActiveValue(t.minute)}setHour(t){this.controller.setValue("hours",t)}setMinute(t){this.controller.setValue("minutes",t)}setAmPm(t){this.controller.setAmPm(t);let e=this.controller.getState();e.mode==="hours"?(this.renderHourTips(),this.renderer.setHandAngle(e.hourAngle),this.renderer.setActiveValue(e.hour)):(this.renderMinuteTips(),this.renderer.setHandAngle(e.minuteAngle),this.renderer.setActiveValue(e.minute))}getHour(){return this.controller.getHour()}getMinute(){return this.controller.getMinute()}getAmPm(){return this.controller.getAmPm()}updateDisabledTime(t){this.disabledTime=t,this.controller.updateDisabledTime(t),this.controller.getState().mode==="hours"?this.renderHourTips():this.renderMinuteTips()}renderHourTips(){let t=this.controller.getState().amPm;this.clockType==="24h"?(this.renderer.renderTips(aae,"tp-ui-hour-time-12","hours",this.disabledTime,this.clockType,!0,this.tipsWrapper,t),this.tipsWrapperFor24h&&this.renderer.renderTips(wyt,"tp-ui-hour-time-24","hours",this.disabledTime,this.clockType,!0,this.tipsWrapperFor24h,t)):this.renderer.renderTips(aae,"tp-ui-hour-time-12","hours",this.disabledTime,this.clockType,!0,void 0,t)}renderMinuteTips(){let t=this.controller.getState(),e=t.amPm,i=t.hour;this.renderer.renderTips(V3,"tp-ui-minutes-time","minutes",this.disabledTime,this.clockType,!0,void 0,e,i)}calculateInitialAngle(t,e){let i=parseInt(e,10);return t==="hours"?i%12*30:i*6}destroy(){this.dragHandlers.detach(),this.controller.destroy()}blockInteractions(){this.dragHandlers.block()}unblockInteractions(){this.dragHandlers.unblock()}},qyt=class{core;emitter;clockSystem=null;constructor(e,i){this.core=e,this.emitter=i}getClockSystem(){return this.clockSystem}initialize(){let e=this.core.getClockFace(),i=this.core.getClockHand(),r=this.core.getCircle();if(!e||!i||!r)return;let n=this.core.options.clock.type==="24h",a=this.core.getTipsWrapper();if(!a)return;let s=this.core.getHour(),o=this.core.getMinutes(),l={clockFace:e,tipsWrapper:a,tipsWrapperFor24h:n&&this.core.getTipsWrapperFor24h()||void 0,clockHand:i,circle:r,clockType:this.core.options.clock.type||"12h",disabledTime:this.convertDisabledTime(),initialHour:s?.value||"12",initialMinute:o?.value||"00",initialAmPm:this.getAmPmValue(),theme:this.core.options.ui.theme,incrementHours:this.core.options.clock.incrementHours||1,incrementMinutes:this.core.options.clock.incrementMinutes||1,smoothHourSnap:this.core.options.clock.smoothHourSnap??!0,timepicker:null,dragConfig:{autoSwitchToMinutes:this.core.options.clock.autoSwitchToMinutes,isMobileView:this.core.isMobileView,smoothHourSnap:this.core.options.clock.smoothHourSnap??!0,hourElement:s,minutesElement:o,onMinuteCommit:()=>{let c=this.core.getMinutes(),u=this.core.getHour(),d=this.core.getActiveTypeMode();this.emitter.emit("range:minute:commit",{hour:u?.value??"12",minutes:c?.value??"00",type:d?.textContent??void 0})}},onHourChange:c=>{let u=this.core.getHour();u&&(u.value=c,u.setAttribute("aria-valuenow",c));let d=this.core.getModalElement();gC(d,`Hour: ${c}`);let p=this.core.getMinutes(),f=this.core.getActiveTypeMode();this.emitter.emit("update",{hour:c,minutes:p?.value,type:f?.textContent||void 0})},onMinuteChange:c=>{let u=this.core.getMinutes();u&&(u.value=c,u.setAttribute("aria-valuenow",c));let d=this.core.getModalElement();gC(d,`Minutes: ${c}`);let p=this.core.getHour(),f=this.core.getActiveTypeMode();this.emitter.emit("update",{hour:p?.value,minutes:c,type:f?.textContent||void 0})}};this.clockSystem=new zyt(l),this.clockSystem.initialize()}convertDisabledTime(){let e=this.core.disabledTime?.value;if(!e)return null;let i;return e.intervals&&(i=Array.isArray(e.intervals)?e.intervals:[e.intervals]),{hours:e.hours,minutes:e.minutes,isInterval:e.isInterval,intervals:i,clockType:e.clockType}}getAmPmValue(){if(this.core.options.clock.type==="24h")return"";let e=this.core.getActiveTypeMode();if(e){let r=e.textContent?.trim();if(r==="AM"||r==="PM")return r}let i=this.core.getAM();return this.core.options.range?.enabled===!0?i?.classList.contains("active")?"AM":"":i?.classList.contains("active")?"AM":"PM"}destroy(){this.clockSystem&&(this.clockSystem.destroy(),this.clockSystem=null)}},Wyt=class{core;constructor(e){this.core=e}removeCircleClockClasses24h(){let e=this.core.getCircle(),i=this.core.getClockHand();e?.classList.remove("tp-ui-circle-hand-24h"),i?.classList.remove("tp-ui-clock-hand-24h")}setCircleClockClasses24h(){let e=this.core.getCircle(),i=this.core.getClockHand();e&&e.classList.add("tp-ui-circle-hand-24h"),i&&i.classList.add("tp-ui-clock-hand-24h")}setOnStartCSSClassesIfClockType24h(){if(this.core.options.clock.type==="24h"){let e=this.core.getInput();if(!e)return;let i;e.value.length>0&&(i=e.value.split(":")[0]),i&&(Number(i)>12||Number(i)===0)&&this.setCircleClockClasses24h()}}setBgColorToCircleWithMinutesTips(){let e=this.core.getMinutes(),i=this.core.getCircle();if(!(!e||!i)&&e.value&&V3.includes(e.value)){let r=getComputedStyle(i).getPropertyValue("--timepicker-primary").trim();r&&(i.style.backgroundColor=r),i.classList.remove("small-circle")}}removeBgColorToCirleWithMinutesTips(){let e=this.core.getMinutes(),i=this.core.getCircle();!e||!i||e.value&&V3.includes(e.value)||(i.style.backgroundColor="",i.classList.add("small-circle"))}setClassActiveToHourOnOpen(){this.core.options.ui.mobile||this.core.isMobileView||this.core.getHour()?.classList.add(k0)}toggleClassActiveToValueTips(e,i){if(e)return;let r=this.core.getAllValueTips();if(!r)return;let n=r.find(a=>Number(a.innerText)===Number(i));r.forEach(a=>{a.classList.remove(k0),a.setAttribute("aria-selected","false")}),n!==void 0&&(n.classList.add(k0),n.setAttribute("aria-selected","true"))}},Kyt=class{getClockSystem;styleHandler;getAmPmValue;clockType;constructor(e,i,r,n){this.getClockSystem=e,this.styleHandler=i,this.getAmPmValue=r,this.clockType=n}setMinutesToClock(e){let i=this.getClockSystem();i&&(this.styleHandler.removeBgColorToCirleWithMinutesTips(),e&&i.setMinute(e),i.switchToMinutes())}setHoursToClock(e){let i=this.getClockSystem();i&&(e&&i.setHour(e),i.switchToHours())}setTransformToCircleWithSwitchesHour(e){let i=this.getClockSystem();!i||!e||i.setHour(e)}setTransformToCircleWithSwitchesMinutes(e){let i=this.getClockSystem();!i||!e||i.setMinute(e)}updateAmPm(){let e=this.getClockSystem();if(!e||this.clockType==="24h")return;let i=this.getAmPmValue();i!==""&&e.setAmPm(i)}},Yyt=class{systemInitializer;styleHandler;timeHandler;eventHandler;constructor(t,e){this.systemInitializer=new qyt(t,e),this.styleHandler=new Wyt(t);let i=t.options.clock.type||"12h";this.timeHandler=new Kyt(()=>this.systemInitializer.getClockSystem(),this.styleHandler,()=>this.systemInitializer.getAmPmValue(),i),this.eventHandler=new Vyt(e,()=>this.systemInitializer.getClockSystem(),r=>this.timeHandler.setHoursToClock(r),r=>this.timeHandler.setMinutesToClock(r),()=>this.timeHandler.updateAmPm(),()=>this.systemInitializer.convertDisabledTime()),this.eventHandler.setup()}initializeClockSystem(){this.systemInitializer.initialize()}destroyClockSystem(){this.systemInitializer.destroy()}removeCircleClockClasses24h(){this.styleHandler.removeCircleClockClasses24h()}setCircleClockClasses24h(){this.styleHandler.setCircleClockClasses24h()}setOnStartCSSClassesIfClockType24h(){this.styleHandler.setOnStartCSSClassesIfClockType24h()}setBgColorToCircleWithMinutesTips=()=>{this.styleHandler.setBgColorToCircleWithMinutesTips()};removeBgColorToCirleWithMinutesTips=()=>{this.styleHandler.removeBgColorToCirleWithMinutesTips()};setClassActiveToHourOnOpen=()=>{this.styleHandler.setClassActiveToHourOnOpen()};setMinutesToClock=t=>{this.timeHandler.setMinutesToClock(t)};setHoursToClock=t=>{this.timeHandler.setHoursToClock(t)};setTransformToCircleWithSwitchesHour=t=>{this.timeHandler.setTransformToCircleWithSwitchesHour(t)};setTransformToCircleWithSwitchesMinutes=t=>{this.timeHandler.setTransformToCircleWithSwitchesMinutes(t)};updateAmPm=()=>{this.timeHandler.updateAmPm()};toggleClassActiveToValueTips=t=>{let e=this.systemInitializer.getClockSystem()!==null;this.styleHandler.toggleClassActiveToValueTips(e,t)};destroy(){this.destroyClockSystem()}},Xyt=class{plugins=new Map;register(t){this.plugins.has(t.name)||this.plugins.set(t.name,t)}getAll(){return Array.from(this.plugins.values())}has(t){return this.plugins.has(t)}get(t){return this.plugins.get(t)}},Zyt=new Xyt,Jyt=class{animation;modal;config;theme;validation;events;clock;plugins=new Map;constructor(t,e){this.animation=new vyt(t,e),this.modal=new Uyt(t,e),this.config=new Nyt(t,e),this.theme=new Byt(t,e),this.validation=new kyt(t,e),this.events=new Hyt(t,e),this.clock=new Yyt(t,e),Zyt.getAll().forEach(i=>{let r=i.factory(t,e);this.plugins.set(i.name,r)})}getPlugin(t){return this.plugins.get(t)}destroy(){this.animation.destroy(),this.modal.destroy(),this.config.destroy(),this.theme.destroy(),this.validation.destroy(),this.events.destroy(),this.clock.destroy(),this.plugins.forEach(t=>t.destroy()),this.plugins.clear()}},hO="is-rippling",mO="ripple-hold",nT=null;function ebt(t){let e=t.target,i=e.hasAttribute("data-md3-ripple")?e:e.closest("[data-md3-ripple]");if(!i||t.button!==0&&t.pointerType==="mouse")return;let r=i.getBoundingClientRect(),n=Math.max(r.width,r.height)*2,a=t.clientX-r.left,s=t.clientY-r.top;i.style.setProperty("--ripple-size",`${n}px`),i.style.setProperty("--ripple-x",`${a}px`),i.style.setProperty("--ripple-y",`${s}px`),i.classList.remove(hO,mO),i.offsetWidth,i.classList.add(hO,mO),i._rippleHold=!0,nT=i}function cae(t){let e=t.target,i=(e.hasAttribute("data-md3-ripple")?e:e.closest("[data-md3-ripple]"))||nT;i&&(i._rippleHold=!1,i.classList.remove(mO),setTimeout(()=>{i.classList.remove(hO),nT===i&&(nT=null)},1e3))}function tbt(t){let e=t.currentTarget;!e||!e._rippleHold||(e._rippleHold=!1,e.classList.remove(mO),setTimeout(()=>{e.classList.remove(hO),nT===e&&(nT=null)},1e3))}function ibt(t){if($l()===!1)return;let e=t||document;e.addEventListener("pointerdown",ebt),e.addEventListener("pointerup",cae),e.addEventListener("pointercancel",cae),e.querySelectorAll("[data-md3-ripple]").forEach(i=>{i.addEventListener("mouseleave",tbt)})}var rbt=(t,e)=>{let i;return(...r)=>{clearTimeout(i),i=setTimeout(()=>{t(...r)},e)}},nbt=class{core;managers;emitter;eventsClickMobileHandler=()=>{};mutliEventsMoveHandler=()=>{};constructor(t,e,i){this.core=t,this.managers=e,this.emitter=i}init(){if(!this.core.isDestroyed&&!this.core.isInitialized){try{this.managers.config.updateInputValueWithCurrentTimeOnStart(),this.managers.validation.checkDisabledValuesOnStart()}catch{this.core.setIsDestroyed(!0);return}this.managers.theme.setTimepickerClassToElement(),this.managers.theme.setInputClassToInputElement(),this.managers.theme.setDataOpenToInputIfDoesntExistInWrapper(),this.managers.theme.setClassTopOpenElement(),this.managers.config.getDisableTime(),this.core.options.ui.inline?.enabled||this.managers.events.handleOpenOnClick(),this.managers.events.handleOpenOnEnterFocus(),this.setupCallbackBridge(),this.core.setIsInitialized(!0)}}setupCallbackBridge(){let{callbacks:t}=this.core.options;t.onOpen&&this.emitter.on("open",t.onOpen),t.onCancel&&this.emitter.on("cancel",t.onCancel),t.onConfirm&&this.emitter.on("confirm",t.onConfirm),t.onUpdate&&this.emitter.on("update",t.onUpdate),t.onSelectHour&&this.emitter.on("select:hour",t.onSelectHour),t.onSelectMinute&&this.emitter.on("select:minute",t.onSelectMinute),t.onSelectAM&&this.emitter.on("select:am",t.onSelectAM),t.onSelectPM&&this.emitter.on("select:pm",t.onSelectPM),t.onError&&this.emitter.on("error",t.onError),t.onTimezoneChange&&this.emitter.on("timezone:change",t.onTimezoneChange),t.onRangeConfirm&&this.emitter.on("range:confirm",t.onRangeConfirm),t.onRangeSwitch&&this.emitter.on("range:switch",t.onRangeSwitch),t.onRangeValidation&&this.emitter.on("range:validation",t.onRangeValidation)}mount(){this.core.isDestroyed||(this.core.isInitialized||this.init(),this.eventsBundle())}unmount(t){let e=rbt((...i)=>{if(i.length>2||!this.core.getModalElement())return;let[r]=i.filter(a=>typeof a=="boolean"),[n]=i.filter(a=>typeof a=="function");this.core.setIsMobileView(!!this.core.options.ui.mobile),r&&this.core.getOkButton()?.click(),this.core.setIsTouchMouseMove(!1),this.removeEventListeners(),this.managers.animation.removeAnimationToClose(),this.core.getOpenElement().forEach(a=>a?.classList.remove("disabled")),setTimeout(()=>{$l()&&(document.body.style.overflowY="",document.body.style.paddingRight="")},ef.SCROLLBAR_RESTORE),setTimeout(()=>{let a=this.core.getInput();this.core.options.behavior.focusInputAfterClose&&a?.focus();let s=this.core.getModalElement();s!==null&&(s.remove(),this.core.setIsModalRemove(!0))},ef.MODAL_REMOVE),n&&n()},this.core.options.behavior.delayHandler||ef.DEFAULT_DELAY);t?e(t):e()}destroy(t){if(this.core.isDestroyed)return;let e=typeof t=="function"?{callback:t}:t||{},{keepInputValue:i=!1,callback:r}=e,n=this.core.getInput(),a=i?n?.value:null;this.removeEventListeners(),this.core.getModalElement()?.remove(),this.core.getOpenElement()?.forEach(o=>{o&&(o.classList.remove("disabled","active","tp-ui-open-element"),o.classList.remove("basic","crane-straight","crane","m2","m3-green"))}),n&&(n.classList.remove("tp-ui-invalid-format","invalid-value","error","active","tp-ui-input"),n.removeAttribute("data-open"),n.removeAttribute("data-owner-id"),i&&a&&(n.value=a));let s=this.core.element;s&&(s.classList.remove("basic","crane-straight","crane","m2","m3-green"),s.classList.remove("error","active","disabled"),s.removeAttribute("data-owner-id"),s.removeAttribute("data-open"),this.core.options.ui.cssClass&&s.classList.remove(this.core.options.ui.cssClass)),s?.querySelectorAll(".tp-ui-invalid-text")?.forEach(o=>o.remove()),this.mutliEventsMoveHandler=()=>{},this.eventsClickMobileHandler=()=>{},this.core.reset(),this.managers.destroy(),this.emitter.clear(),uy()||(document.body.style.overflowY="",document.body.style.paddingRight=""),r&&r()}eventsBundle(){if(this.core.isDestroyed||!this.core.isModalRemove)return;if(this.managers.validation.setErrorHandler(),this.managers.validation.removeErrorHandler(),!this.core.options.ui.inline?.enabled){let n=this.core.getOpenElement(),a=this.core.getInput();n.forEach(s=>s?.classList.add("disabled")),a?.blur()}if(this.managers.modal.setScrollbarOrNot(),this.managers.modal.setModalTemplate(),this.managers.modal.setNormalizeClass(),this.managers.modal.removeBackdrop(),this.core.isMobileView)this.managers.config.updateClockFaceAccessibility(!0);else{let n=this.core.getModalElement(),a=n?.querySelector(".tp-ui-mobile-clock-wrapper"),s=n?.querySelector(".tp-ui-wrapper"),o=n?.querySelectorAll("*");a?.classList.add("expanded"),s?.classList.add("expanded"),o?.forEach(l=>{!l.classList.contains("tp-ui-select-time")&&!l.classList.contains("tp-ui-mobile-clock-wrapper")&&!l.classList.contains("tp-ui-wrapper")&&l.classList.add("expanded")})}this.managers.modal.setFlexEndToFooterIfNoKeyboardIcon(),setTimeout(()=>{this.managers.theme.setTheme();let n=this.core.getWrapper();n&&this.core.options.ui.cssClass&&n.classList.add(this.core.options.ui.cssClass)},0),this.managers.animation.setAnimationToOpen(),this.managers.config.getInputValueOnOpenAndSet(),this.managers.clock.initializeClockSystem(),this.managers.clock.setOnStartCSSClassesIfClockType24h(),this.managers.clock.setClassActiveToHourOnOpen();let t=this.managers.getPlugin("timezone");t&&t.init();let e=this.managers.getPlugin("range");e&&e.init(),this.managers.events.handleCancelButton(),this.managers.events.handleOkButton(),this.managers.events.handleHourEvents(),this.managers.events.handleMinutesEvents(),this.managers.events.handleKeyboardInput(),this.core.options.ui.enableSwitchIcon&&this.managers.events.handleSwitchViewButton(),this.core.options.clock.type!=="24h"&&(this.managers.events.handleAmClick(),this.managers.events.handlePmClick()),this.core.options.behavior.focusTrap&&this.managers.events.focusTrapHandler(),this.core.options.ui.inline?.enabled||(this.managers.events.handleEscClick(),this.managers.events.handleBackdropClick());let i=this.core.getModalElement();i&&ibt(i);let r=this.core.getClockFace();r&&typeof requestAnimationFrame<"u"&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{r?.classList.add("scale-in")})}),this.managers.modal.setShowClassToBackdrop()}removeEventListeners(){$l()!==!1&&(Eyt.split(" ").forEach(t=>{document.removeEventListener(t,this.mutliEventsMoveHandler,!1)}),document.removeEventListener("mousedown",this.eventsClickMobileHandler))}},abt=class{events=new Map;on(t,e){this.events.has(t)||this.events.set(t,new Set),this.events.get(t).add(e)}once(t,e){let i=r=>{e(r),this.off(t,i)};this.on(t,i)}off(t,e){e?this.events.get(t)?.delete(e):this.events.delete(t)}emit(t,e){this.events.get(t)?.forEach(i=>{i(e)})}clear(){this.events.clear()}hasListeners(t){return(this.events.get(t)?.size??0)>0}},Wb={clock:{type:"12h",incrementHours:1,incrementMinutes:1,autoSwitchToMinutes:!0,disabledTime:void 0,currentTime:void 0},ui:{theme:"basic",animation:!0,backdrop:!0,mobile:!1,enableSwitchIcon:!1,editable:!1,enableScrollbar:!1,cssClass:void 0,appendModalSelector:"",iconTemplate:"",iconTemplateMobile:"",inline:void 0},labels:{am:"AM",pm:"PM",ok:"OK",cancel:"Cancel",time:"Select time",mobileTime:"Enter Time",mobileHour:"Hour",mobileMinute:"Minute"},behavior:{focusInputAfterClose:!1,focusTrap:!0,delayHandler:300,id:void 0},callbacks:{onOpen:void 0,onCancel:void 0,onConfirm:void 0,onUpdate:void 0,onSelectHour:void 0,onSelectMinute:void 0,onSelectAM:void 0,onSelectPM:void 0,onError:void 0,onTimezoneChange:void 0,onRangeConfirm:void 0,onRangeSwitch:void 0,onRangeValidation:void 0},timezone:{enabled:!1,default:void 0,whitelist:void 0,label:"Timezone"},range:{enabled:!1,minDuration:void 0,maxDuration:void 0,fromLabel:"From",toLabel:"To"}};function sbt(t={}){return{clock:{...Wb.clock,...t.clock||{}},ui:{...Wb.ui,...t.ui||{}},labels:{...Wb.labels,...t.labels||{}},behavior:{...Wb.behavior,...t.behavior||{}},callbacks:{...Wb.callbacks,...t.callbacks||{}},timezone:{...Wb.timezone,...t.timezone||{}},range:{...Wb.range,...t.range||{}}}}var obt=t=>t.replace(/[^0-9:APMapm\s]/g,""),oU=new Map,lbt=class{core;managers;lifecycle;emitter;constructor(t,e){if(uy())throw new Error("TimepickerUI requires browser environment");let i=this.resolveInputElement(t);if(!i)throw new Error("Input element not found");let r=e?.behavior?.id,n=r||`tp-ui-${Iyt()}`,a=this.createWrapperElement(i),s=sbt(e||{});if(s.ui.inline?.enabled&&typeof e?.behavior?.focusTrap>"u"&&(s.behavior.focusTrap=!1),s.ui.inline?.enabled){if(!s.ui.inline.containerId)throw new Error("inline.containerId is required when inline mode is enabled");if(!uy()&&!document.getElementById(s.ui.inline.containerId))throw new Error(`Container element with id "${s.ui.inline.containerId}" not found`)}this.emitter=new abt,this.core=new gyt(a,s,n,r);let o=this.core.getInput();if(o){let l=Wv(o,s.clock.type),c=Number(l.hour)*30,u=Number(l.minutes)*6;this.core.setDegreesHours(c),this.core.setDegreesMinutes(u)}this.managers=new Jyt(this.core,this.emitter),this.lifecycle=new nbt(this.core,this.managers,this.emitter),this.managers.config.checkMobileOption(),this.managers.config.preventClockTypeByCurrentTime(),this.setupInternalEventListeners(),oU.set(this.core.instanceId,this)}setupInternalEventListeners(){this.emitter.on("show",()=>{this.core.isDestroyed||this.lifecycle.mount()}),this.emitter.on("cancel",()=>{this.core.isDestroyed||this.lifecycle.unmount()}),this.emitter.on("confirm",t=>{if(!this.core.isDestroyed){if(this.core.options.range?.enabled)return;let e=this.core.getInput();if(e&&t.hour&&t.minutes){let i=t.type?` ${t.type}`:"";e.value=`${t.hour}:${t.minutes}${i}`}this.lifecycle.unmount()}}),this.emitter.on("range:confirm",t=>{if(this.core.isDestroyed)return;let e=this.core.getInput();e&&(e.value=`${t.from} - ${t.to}`),this.lifecycle.unmount()})}create(){this.lifecycle.init(),this.core.options.ui.inline?.enabled&&this.lifecycle.mount()}open(t){this.lifecycle.mount(),t&&t()}close(t,e){this.lifecycle.unmount(t?e:void 0),!t&&e&&e()}destroy(t){oU.delete(this.core.instanceId),this.lifecycle.destroy(t)}update(t,e){this.core.isDestroyed||(this.core.updateOptions(t.options),this.managers.config.checkMobileOption(),this.managers.config.getDisableTime(),t.create&&this.create(),e&&e())}getValue(){if(this.core.isDestroyed)return{hour:"",minutes:"",type:void 0,time:"",degreesHours:null,degreesMinutes:null};let t=this.core.getHour(),e=this.core.getMinutes(),i=this.core.getActiveTypeMode(),r=t?.value||"12",n=e?.value||"00",a=this.core.options.clock.type==="24h"?void 0:i?.textContent||"AM",s="";return this.core.options.clock.type==="24h"?s=`${r.padStart(2,"0")}:${n.padStart(2,"0")}`:s=`${r}:${n.padStart(2,"0")} ${a}`,{hour:r,minutes:n,type:a,time:s,degreesHours:this.core.degreesHours,degreesMinutes:this.core.degreesMinutes}}setValue(t,e=!0){if(this.core.isDestroyed||!t||typeof t!="string")return;this.core.isInitialized||this.create();let i=obt(t.trim()),r="12",n="00",a="AM";try{if(this.core.options.clock.type==="24h"){let d=i.match(/^([0-1]?[0-9]|2[0-3]):([0-5][0-9])$/);if(!d)throw new Error("Invalid 24h format. Expected HH:MM");r=d[1].padStart(2,"0"),n=d[2]}else{let d=i.match(/^(1[0-2]|[1-9]):([0-5][0-9])\s*(AM|PM)$/i);if(!d)throw new Error("Invalid 12h format. Expected HH:MM AM/PM");r=d[1],n=d[2],a=d[3].toUpperCase()}let s=this.core.getHour(),o=this.core.getMinutes(),l=this.core.getAM(),c=this.core.getPM();if(s&&(s.value=r,s.setAttribute("aria-valuenow",r),this.core.setDegreesHours(Number(r)*30)),o&&(o.value=n,o.setAttribute("aria-valuenow",n),this.core.setDegreesMinutes(Number(n)*6)),this.core.options.clock.type!=="24h"&&l&&c&&(a==="AM"?(l.classList.add("active"),c.classList.remove("active")):(c.classList.add("active"),l.classList.remove("active"))),e){let d=this.core.getInput();d&&(d.value=i)}let u=this.core.getClockHand();u&&(u.style.transform=`rotateZ(${this.core.degreesHours||0}deg)`)}catch{return}}getElement(){return this.core.element}get instanceId(){return this.core.instanceId}get options(){return this.core.options}get isInitialized(){return this.core.isInitialized}get isDestroyed(){return this.core.isDestroyed}get hour(){return this.core.getHour()}get minutes(){return this.core.getMinutes()}get okButton(){return this.core.getOkButton()}get cancelButton(){return this.core.getCancelButton()}get clockHand(){return this.core.getClockHand()}on(t,e){this.core.isDestroyed||this.emitter.on(t,e)}once(t,e){this.core.isDestroyed||this.emitter.once(t,e)}off(t,e){this.core.isDestroyed||this.emitter.off(t,e)}resolveInputElement(t){if($l()===!1)return null;let e=null;if(typeof t=="string"){if(e=document.querySelector(t),!e)return null}else if(t instanceof HTMLElement)e=t;else return null;return e.tagName==="INPUT"?e:e.querySelector("input")}createWrapperElement(t){if($l()===!1)return t;let e=t.parentElement;if(t.tagName==="INPUT"&&!e?.classList.contains("tp-ui")){let i=document.createElement("div");return i.className="tp-ui",t.parentNode?.insertBefore(i,t),i.appendChild(t),i}return e&&!e.classList.contains("tp-ui")&&e.classList.add("tp-ui"),e||t}static getById(t){return oU.get(t)}static getAllInstances(){return Array.from(oU.values())}static isAvailable(t){return uy()?!1:typeof t=="string"?document.querySelector(t)!==null:t instanceof HTMLElement?document.contains(t):!1}static destroyAll(){Array.from(oU.values()).forEach(t=>t.destroy()),oU.clear()}},cbt=lbt;function BNe({time:t,options:e,callback:i}={}){const r=document.getElementById("timevalue");r.value=ubt(t);const n=new cbt(document.getElementById("timepicker"),{clock:{type:"12h"},behavior:{autoSwitchToMinutes:!0},callbacks:{onConfirm:()=>{const a=r.value;Mt(i)&&i&&i({time:a}),n.destroy()}},...e});n.create(),n.open()}function ubt(t,e){const i=dbt(t||e?.schedule?.default_time);return i.ampm?t||"":(Number(i.hours)>12?(i.hours=(Number(i.hours)-12).toString(),i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),`${i.hours||"12"}:${i.minutes} ${i.ampm}`)}function dbt(t="00:00"){const e=t?.split(" ")||[],i=e[0]?.split(":")||[];return{hours:i[0]||"00",minutes:i[1]||"00",ampm:e[1]}}const{AFTER_REST:uae,FOLLOWED_BY:dae,NEXT_AVAILABLE:pae,NOT_BEFORE:fae,TO_BE_ANNOUNCED:hae}=HF;function kNe({e:t,cell:e,callback:i,matchUpId:r,rowData:n}={}){const a=n||e.getRow().getData(),s=b=>{const y=Object.values(a).filter(T=>T?.matchUpId),w=[{params:{matchUpIds:r?[r]:y.map(({matchUpId:T})=>T),schedule:b,removePriorValues:!0},method:lZ}];Nt({methods:w,callback:T=>{T.success&&Mt(i)&&i&&i(b)}})},o=b=>MN({matchUp:b,matchUpId:r,callback:i}),l=()=>s({scheduledTime:"",timeModifiers:[]}),c=({time:b})=>{const I=Ri.dateTime.convertTime(b,!0)||"";s({scheduledTime:I})},u=()=>{const y=e.getTable().getData();let I;const w=y.flatMap((C,E)=>{if(!I&&!(C.rowId===a.rowId&&(I=E+1,E)))return Object.values(C).flatMap(P=>P?.schedule?.scheduledTime)}).filter(Boolean).map(dyt),S=Math.max(...w,0),T=(I??0)>1,D=S&&pyt(S,T)||"8:00 AM";BNe({time:D,callback:c})},d=b=>s({timeModifiers:[b]}),p=r?"Set match time":"Set match times",f=Object.values(e.getData()).find(b=>b?.matchUpId===r),h=f?.readyToScore||f?.winningSide||f?.score?.sets,m=()=>{!f?.drawId||!f?.eventId||_n({eventId:f.eventId,drawId:f.drawId,renderDraw:!0})},A=()=>{if(!f?.matchUpId||!f?.schedule?.courtId)return;const b=e.getTable(),{courtId:y,courtOrder:I,venueId:w}=f.schedule,S={scheduledTime:"",scheduledDate:"",courtOrder:"",venueId:"",courtId:""},T=[{method:rO,params:{tournamentId:f.tournamentId,matchUpId:f.matchUpId,schedule:S,drawId:f.drawId,removePriorValues:!0}}];Nt({methods:T,engine:a2,callback:C=>{if(C.success){f.schedule=S;const E=b.getRows();let P,R;E.find(k=>(R=k.getData(),P=Object.keys(R).find(O=>{const x=R[O];return x&&typeof x=="object"&&x.matchUpId===f.matchUpId}),P))&&R&&P&&(R[P]={schedule:{courtOrder:I,courtId:y,venueId:w}},b.updateData([R]));const N=es.findTable(`#${ny}`)[0];if(N){const k=PS(f);N.addRow(k,!0)}f1(b)}}})},g=[{option:p,onClick:u},h&&{option:"Enter score",onClick:()=>o(f)},{option:tD[dae],onClick:()=>d(dae)},{option:tD[pae],onClick:()=>d(pae)},{option:tD[fae],onClick:()=>d(fae)},{option:tD[uae],onClick:()=>d(uae)},{option:tD[hae],onClick:()=>d(hae)},{option:"Clear time settings",onClick:l},f?.schedule?.courtId&&{option:"Remove from schedule",onClick:A},f?.drawId&&{option:"View draw",onClick:m}].filter(Boolean),v=t.target;nl({options:g,target:v,config:{placement:Ht}})}function pbt({column:t,courtInfo:e}){const i=e.courtId;Jr({title:"Rename Court",content:a=>Sr(a,[{value:e.courtName,label:"Court Name",field:"courtName"}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Rename",intent:"is-primary",onClick:({content:a})=>{const s=a?.courtName.value;s.length&&s!==e.courtName&&Nt({methods:[{method:cZ,params:{courtId:i,modifications:{courtName:s}}}],callback:c=>{c.success?t.updateDefinition({title:s}):console.log({result:c})}})},close:!0}]})}function fbt(t,e,i){const n=[{option:`${Rm.tr("remove")} court identifiers`,onClick:s},{option:Rm.tr("rename"),onClick:()=>pbt({column:e,courtInfo:i})}],a=t.target;nl({options:n,target:a});function s(){console.log("toggle court identifiers",{column:e})}}async function hbt(t,e){t.preventDefault();const i=t.dataTransfer?.getData("itemid"),r=[],n=e.getTable(),a=n.getData(),s=e.getRow().getData(),o=n.getData().flatMap(E=>Object.values(E).filter(P=>P.matchUpId));let l=o.find(E=>E.matchUpId===i);l||(l=es.findTable(`#${ny}`)[0].getData().map(R=>R.matchUp).find(R=>R.matchUpId===i)||{});const c=ot.displayed.selectedScheduleDate,{courtOrder:u,courtId:d,venueId:p}=l.schedule||{},f=t.currentTarget,h=f.id;if(i===h)return;const m=l.schedule,A=h&&o.find(E=>E.matchUpId===h),g=f.getAttribute("venueId"),v=f.getAttribute("courtId"),b=f.getAttribute("courtOrder"),y=Object.keys(s).find(E=>{if(!Ad(s[E]))return;const P=s[E]?.schedule||{},{courtOrder:R,courtId:M,venueId:N}=P;return R?.toString()===b?.toString()&&N===g&&M===v});let I;const w=a.find(E=>(I=Object.keys(E).find(P=>{if(!Ad(E[P]))return;const R=E[P]?.schedule||{},{courtOrder:M,courtId:N,venueId:k}=R;return M===u&&k===p&&N===d}),I)),S=()=>{Nt({methods:r,engine:a2,callback:P=>{P.success||console.log({result:P}),f1(n)}})},T=({scheduledTime:E="",timeModifiers:P=[]}={})=>{const R={courtOrder:b,scheduledDate:c,venueId:g,courtId:v,scheduledTime:E,timeModifiers:P};r.push({method:rO,params:{tournamentId:l?.tournamentId,matchUpId:l?.matchUpId,schedule:R,drawId:l?.drawId,removePriorValues:!0}}),l.schedule=R},D={scheduledDate:m?.scheduledDate,scheduledTime:m?.scheduledTime,timeModifiers:m?.timeModifiers,courtOrder:u,venueId:p,courtId:d},C=()=>{r.push({method:rO,params:{tournamentId:A?.tournamentId,matchUpId:A?.matchUpId,schedule:D,drawId:A?.drawId,removePriorValues:!0}}),A?A.schedule=D:console.log("missing targetMatchUp")};if(h==="")w?(T(),w[I]={schedule:{courtOrder:u,venueId:p,courtId:d}},w.rowId==s.rowId?(w[y]=l,n.updateData([w])):(s[y]=l,n.updateData([w,s]))):(es.findTable(`#${ny}`)[0].deleteRow(i),T(),s[y]=l,n.updateData([s]));else if(!w&&A){const E=es.findTable(`#${ny}`)[0];E.deleteRow(i),T(),s[y]=l,n.updateData([s]),E.addRow(PS(A),!0),C()}else{const E=A?.schedule;T({scheduledTime:E?.scheduledTime,timeModifiers:E?.timeModifiers}),C(),w.rowId==s.rowId?(w[I]=A,w[y]=l,n.updateData([w])):(w[I]=A,s[y]=l,n.updateData([w,s]))}S()}const{SCHEDULE_STATE:mae,SCHEDULE_ERROR:Aae,SCHEDULE_WARNING:gae,SCHEDULE_CONFLICT:vae,SCHEDULE_ISSUE:yae}=Qn.scheduleConstants,{ABANDONED:bae,CANCELLED:Iae,DEFAULTED:mbt,DOUBLE_DEFAULT:YG,DOUBLE_WALKOVER:wae,IN_PROGRESS:Abt,WALKOVER:gbt}=Qn.matchUpStatusConstants,{completedMatchUpStatuses:vbt}=Qn;function xNe(t){const e=document.createElement("span");if(!t.getColumn().getDefinition().field)return e.className="schedule-cell",e;const r=t.getValue();if(r?.isBlocked){const x=r.booking;e.className="schedule-cell blocked-cell",e.dataset.bookingType=x.bookingType||"BLOCKED";const F=document.createElement("div");F.className="block-label";const _=document.createElement("div");if(_.className="block-type",_.textContent=x.bookingType||"BLOCKED",F.appendChild(_),x.rowCount&&x.rowCount>1){const V=document.createElement("div");V.className="block-rows",V.textContent=`${x.rowCount} rows`,F.appendChild(V)}if(x.notes){const V=document.createElement("div");V.className="block-notes",V.textContent=x.notes,F.appendChild(V)}return e.appendChild(F),e}const{potentialParticipants:n,eventName:a="",roundName:s="",schedule:o={},matchUpStatus:l,winningSide:c,matchUpId:u,sides:d,issueType:p,issueIds:f}=r||{},{courtOrder:h="",scheduledTime:m="",courtId:A="",timeModifiers:g,venueId:v=""}=o;if(e.setAttribute("courtOrder",h),e.setAttribute("courtId",A),e.setAttribute("venueId",v),e.className="schedule-cell dragdrop",e.ondragover=x=>x.preventDefault(),u)if(e.draggable=!0,e.id=u,l===bae)e.classList.add("matchup-abandoned");else if(l===Iae)e.classList.add("matchup-cancelled");else if(l===wae||l===YG)e.classList.add("matchup-double-walkover-default");else if(c)e.classList.add("matchup-complete");else{const x=o[mae];l===Abt?e.classList.add("matchup-inprogress"):x===vae?p===vqe?e.classList.add("matchup-double-booking"):e.classList.add("matchup-conflict"):x===yae?e.classList.add("matchup-issue"):x===gae?e.classList.add("matchup-warning"):x===Aae&&e.classList.add("matchup-error")}e.addEventListener("drop",x=>hbt(x,t)),e.addEventListener("dragstart",CNe);const b=o[mae],y=l&&vbt.includes(l),I=b&&[vae,gae,Aae,yae].includes(b);if(u&&f&&f.length>0&&I&&!y&&(e.addEventListener("mouseenter",()=>{f.forEach(x=>{const F=document.getElementById(x);F&&F.classList.add("conflict-highlight")})}),e.addEventListener("mouseleave",()=>{f.forEach(x=>{const F=document.getElementById(x);F&&F.classList.remove("conflict-highlight")})})),!u)return e;const w=`${a} ${s}`,S=x=>x.person?.standardFamilyName?.toUpperCase()||x.participantName,T=n?.map(x=>x?.map(F=>`<span class='potential nowrap'>${S(F)}</span>`).join('<span style="font-weight: bold">&nbsp;or&nbsp;</span>')),D=x=>{const F=d?.find(_=>x===_.sideNumber)?.participant?.participantName;if(F)return c===x?`<span style='font-weight: bold'>${F}</span>`:F},C=D(1)||T?.shift()||"Unkown",E=D(2)||T?.shift()||"Unknown";e.id=u;const P=document.createElement("div");P.className="header flexrow",P.innerHTML=(g?.[0]&&Sqe[g[0]]+"&nbsp;"||"")+OZ(m),e.appendChild(P);const R=document.createElement("div");R.className="catround",R.innerHTML=w,e.appendChild(R);const M=document.createElement("div");M.className="scheduled_teams";const N=document.createElement("div");N.className="scheduled_team",N.style.fontSize="1em",N.innerHTML=C,M.appendChild(N);const k=document.createElement("div");k.className="divider",k.innerHTML="vs.",M.appendChild(k);const O=document.createElement("div");if(O.className="scheduled_team",O.style.fontSize="1em",O.innerHTML=E,M.appendChild(O),c){const x=document.createElement("div");x.className="match_status",l===gbt?x.innerHTML="WALKOVER":l===mbt?x.innerHTML="DEFAULTED":x.innerHTML=r.score?.scoreStringSide1||"",M.appendChild(x)}else if([YG,wae].includes(l)){const x=document.createElement("div");x.className="match_status",x.innerHTML=l===YG?"DBL DEFAULT":"DBL WALKOVER",M.appendChild(x)}else if([bae,Iae].includes(l)){const x=document.createElement("div");x.className="match_status",x.innerHTML=l,M.appendChild(x)}return e.appendChild(M),e}function ybt({values:t,valueChange:e,isValid:i}){const r=a=>!isNaN(Number(a)),n=a=>e(a);return[{error:"Please enter a name of at least 5 characters",placeholder:"Venue name",value:t.venueName||"",validator:fi.nameValidator(5),label:"Venue name",field:"venueName",focus:!0,onChange:n},{error:"Please enter an abbreviation of 2-6 characters",value:t.venueAbbreviation||"",validator:fi.nameValidator(2,6),field:"venueAbbreviation",label:"Abbreviation",onChange:n},{error:"Must be a whole number",value:t.courtsCount||"",validator:r,label:"Number of courts",field:"courtsCount",onChange:n}]}function bbt(t){return{venueAbbreviation:t?.venueAbbreviation.value,courtsCount:t?.courtsCount.value,venueName:t?.venueName.value}}const Ibt=t=>{const e=bbt(ot.drawer.attributes.content),{venueName:i,venueAbbreviation:r,courtsCount:n}=e,a=Ri.UUID();if(!i||!r||!n){Pt({message:"Invalid values",intent:"is-danger"});return}const s=[{params:{venue:{venueName:i,venueAbbreviation:r,venueId:a},returnDetails:!0},method:Qut},{params:{courtsCount:parseInt(n),venueId:a,venueAbbreviationRoot:!0},method:But}];Nt({methods:s,callback:l=>{if(l?.success&&Mt(t)&&t){const{venue:c}=Ge.findVenue({venueId:a});c&&t({...l,venue:c})}}})};function _Ne(t){const e=()=>{},i=o=>o&&!isNaN(Number(o)),r=({inputs:o})=>{const l=!!(fi.nameValidator(2,6)(o.venueAbbreviation.value)&&i(o.courtsCount.value)&&fi.nameValidator(5)(o.venueName.value)),c=document.getElementById("addVenueButton");c&&(c.disabled=!l)},n=[{control:"venueAbbreviation",onInput:r},{control:"courtsCount",onInput:r},{control:"venueName",onInput:r}],a=o=>Sr(o,ybt({values:{},valueChange:e}),n),s=(o,l)=>uv(o,[{label:"Cancel",close:!0},{onClick:()=>Ibt(t),id:"addVenueButton",intent:"is-info",disabled:!0,label:"Add",close:!0}],l);ot.drawer.open({title:"<b style='larger'>Add venue</b>",width:"300px",side:Ht,content:a,footer:s})}function wbt({courtsData:t,count:e}){const i=n=>{n.stopPropagation(),n.preventDefault(),_Ne($Ne)},r=n=>n?"":t?.length?"<p style='font-weight: normal; color: lightblue'>Add venue</p>":"<button class='button is-danger'>Add venue</button>";return e>0?Ri.generateRange(0,e).map(n=>({headerClick:a=>n===0&&i(a),title:r(n),headerHozAlign:si,formatter:xNe,headerSort:!1,resizable:!1,minWidth:150})):[]}function Sbt({notice:t,notes:e,callback:i}){let r;Jr({title:"Order of play",buttons:[{label:"Cancel",intent:"is-nothing"},{label:"Save",intent:"is-info",onClick:()=>{const o=r.notice.value,l=r.notes.value;typeof i=="function"&&i({notice:o,notes:l})},close:!0}],content:o=>{r=Sr(o,[{placeholder:"appears on PDF Header",value:t,label:"Schedule notice",field:"notice"},{placeholder:"appears on PDF Footer",value:e,label:"Umpire notes",field:"notes"}])}})}const{NOT_BEFORE:Sae}=HF;function Ubt(t,e){const i=e.getRow().getData(),r=Object.values(i).filter(n=>n?.matchUpId);i.issues?.length&&console.log({issues:i.issues}),r.length&&kNe({e:t,cell:e,rowData:i,callback:a=>{if(Ad(a)){const s=e.getTable(),o=s.getData().find(l=>l.rowId===i.rowId);Object.values(o).forEach(l=>{l?.matchUpId&&l?.schedule&&(a.scheduledTime&&(l.schedule.scheduledTime=OZ(a.scheduledTime),l.schedule.timeModifiers?.[0]!==Sae&&(l.schedule.timeModifiers=[])),a.timeModifiers&&(l.schedule?.scheduledTime&&a.timeModifiers[0]!==Sae&&(l.schedule.scheduledTime=""),l.schedule&&(l.schedule.timeModifiers=a.timeModifiers)))}),s.updateData([o])}}})}function Tbt(){function t(r){const n=r.getElement();return n.classList.add("tag"),n.classList.add("is-info"),n.classList.add("is-light"),'<i class="fa-regular fa-note-sticky"></i>'}function e(r){r.getElement().style.backgroundColor="white";const n=document.createElement("span"),a=r.getRow().getData();return n.innerHTML=a.rowNumber,n}return{titleFormatter:t,formatter:e,headerClick:()=>{Sbt({notes:"",notice:"",callback:r});function r(n){console.log({result:n})}},cellClick:Ubt,headerSort:!1,resizable:!1,hozAlign:si,frozen:!0,width:55}}function Cbt({courtsData:t,courtPrefix:e,updateScheduleTable:i}){const r=(c,u)=>{const d=u.getColumn().getDefinition().field,p=u.getData()[d];if(p?.isBlocked){cyt({e:c,cell:u,booking:p.booking,updateScheduleTable:i});return}if(!p?.matchUpId){uyt({e:c,cell:u,updateScheduleTable:i});return}const{drawId:f,matchUpId:h}=p;kNe({e:c,cell:u,matchUpId:h,callback:()=>{const A=Ge.allTournamentMatchUps({matchUpFilters:{drawIds:[f],matchUpIds:[h]},nextMatchUps:!0})?.matchUps?.[0],g=u.getRow().getData();g[d]=A,u.getTable().updateData([g])}})},n=gqe-t?.length||0,a=n<=0?1:n,s=wbt({courtsData:t,count:a}),o=Tbt(),l=(c,u)=>({headerClick:(d,p)=>fbt(d,p,c),cellClick:r,field:`${e}${u}`,title:c.courtName,courtId:c.courtId,headerHozAlign:si,formatter:xNe,headerSort:!1,resizable:!1,hozAlign:si,minWidth:150});return[o].concat(t?.map(l),s)}function Ebt({minCourtGridRows:t=10,scheduledDate:e}={}){let i,r,n,a=[],s=[];const o=({scheduledDate:f})=>{const h={localPerspective:!0,scheduledDate:f},m=Jd.competitionScheduleMatchUps({courtCompletedMatchUps:!0,withCourtGridRows:!0,nextMatchUps:!0,minCourtGridRows:t,matchUpFilters:h}),{dateMatchUps:A=[],completedMatchUps:g=[],courtsData:v,courtPrefix:b="C|",rows:y,groupInfo:I}=m;s=A.concat(...g);const w=Cbt({courtsData:v,courtPrefix:b,updateScheduleTable:l});return y?.forEach((S,T)=>{S.rowId=`rowId-${T+1}`,S.rowNumber=T+1}),{rows:y,columns:w,matchUps:s,courtsCount:v?.length??0,courtsData:v,groupInfo:I}},l=({scheduledDate:f}={})=>{setTimeout(()=>{const{rows:m,matchUps:A,columns:g,courtsData:v}=o({scheduledDate:f}),b=v?.map(I=>I.courtId);Ri.intersection(a,b).length===b?.length||(r.setColumns(g),a=b),n=!0,r?.replaceData(m),r.matchUps=A},i?0:1e3)};UA({anchorId:o_});const c=document.getElementById(o_),{rows:u=[],columns:d=[],courtsCount:p}=o({scheduledDate:e});return a=d.map(f=>f?.courtId).filter(Boolean),r=new es(c,{height:window.innerHeight*.84,renderHorizontal:"virtual",placeholder:"No courts",index:"rowId",data:u,columns:d}),r.on("scrollVertical",Kd),r.on("tableBuilt",()=>{f1(r,s),i=!0}),r.on("dataProcessed",()=>{n&&(n=!1,f1(r))}),{table:r,replaceTableData:l,courtsCount:p}}function Dbt({updateUnscheduledTable:t,updateScheduleTable:e,minCourtGridRows:i,scheduledDate:r,table:n}){const s=[{params:{matchUps:n.getData("active").map(l=>l.matchUp),scheduledDate:r,minCourtGridRows:i},method:Zut}];Nt({methods:s,callback:l=>{l.success&&(t(),e({scheduledDate:r}))},engine:a2})}function Pbt({scheduledDate:t,target:e,roundNameFilter:i,eventIdFilter:r,callback:n}){const a=Jd.competitionScheduleMatchUps({courtCompletedMatchUps:!0}),{dateMatchUps:s=[],completedMatchUps:o=[]}=a,c=s.concat(...o).filter(({schedule:m})=>m.scheduledDate||m.scheduledTime||m.courtId),u=c.filter(({schedule:m})=>m.scheduledDate===t),d=[{disabled:!u.length,option:"Clear scheduled matches",onClick:h},{disabled:!u.length,option:"Clear all matches",onClick:f},{disabled:!c.length,option:"Clear all days",onClick:p}];d.filter(m=>!m.disabled).length&&nl({target:e,options:d,config:{placement:wd}});function p(){h({all:!0})}function f(){h({completed:!0})}function h({all:m,completed:A}={}){let g=c.filter(({schedule:w})=>w.scheduledDate===t).filter(({roundName:w})=>!i||i===w).filter(({eventId:w})=>!r||r===w);A||(g=g?.filter(({matchUpStatus:w,winningSide:S})=>w!=="COMPLETED"&&!S));const b=(m?c:g).map(w=>w.matchUpId);Nt({methods:[{method:lZ,params:{schedule:{courtId:"",scheduledDate:"",courtOrder:"",scheduledTime:"",venueId:""},removePriorValues:!0,matchUpIds:b}}],callback:w=>{w.success&&n&&Mt(n)&&n()}})}}function Rbt({updateUnscheduledTable:t,updateScheduleTable:e,toggleUnscheduled:i,minCourtGridRows:r,eventTypeFilter:n,flightNameFilter:a,roundNameFilter:s,controlAnchor:o,eventIdFilter:l,scheduledDate:c,matchUps:u=[],genderFilter:d,table:p}){let f=c;const h=X=>{f=X},m=X=>X.eventId===l,A=X=>{p.removeFilter(m),l=X,X&&p.addFilter(m)},g=Ge.getEvents().events||[],b=[{label:yg,onClick:()=>A(),close:!0}].concat(g.map(X=>({onClick:()=>A(X.eventId),label:X.eventName,close:!0}))),y=X=>X.matchUpType===n,I=X=>{p.removeFilter(y),n=X,X&&p.addFilter(y)},S=[{label:tte,onClick:()=>I(),close:!0}].concat(Ri.unique(g.map(X=>X.eventType)).map(X=>({onClick:()=>I(X),label:X,close:!0}))),T=X=>X.gender===d,D=X=>{console.log({gender:X}),p.removeFilter(T),d=X,X&&p.addFilter(T)},E=[{label:n4,onClick:()=>D(),close:!0}].concat(Ri.unique(g.map(X=>X.gender)).map(X=>({onClick:()=>D(X),label:X,close:!0})).filter(X=>X.gender)),P=X=>X.roundName===s,R=Ri.unique(u.map(X=>X.roundName)),M=X=>{p.removeFilter(P),s=X,X&&p.addFilter(P)},k=[{label:ite,onClick:()=>M(),close:!0}].concat(R.map(X=>({onClick:()=>M(X),label:X,close:!0}))),O=X=>X.flight===a,x=Ri.unique(u.map(X=>X.drawName)),F=X=>{p.removeFilter(O),a=X,X&&p.addFilter(O)},V=[{label:SP,onClick:()=>F(),close:!0}].concat(x.map(X=>({onClick:()=>F(X),label:X,close:!0}))),G=()=>{t()&&e({scheduledDate:f}),console.log("clear filters ?")},z=X=>{const J=ac(X.target,"dropdown");Pbt({target:J||X?.target,scheduledDate:f,callback:G,roundNameFilter:s,eventIdFilter:l})},Q=DS(p),W=[{onClick:()=>Dbt({scheduledDate:f,updateUnscheduledTable:t,updateScheduleTable:e,minCourtGridRows:r,table:p}),label:"Auto schedule",intent:"is-primary",id:"autoSchedule",close:!0},{label:"Clear schedule",onClick:z,intent:"is-warning",id:"clearSchedule",close:!0}],Y=[{onKeyDown:X=>X.key==="Backspace"&&X.target.value.length===1&&Q(""),onChange:X=>Q(X.target.value),onKeyUp:X=>Q(X.target.value),clearSearch:()=>Q(""),placeholder:"Search participants",location:ii,search:!0},{hide:S.length<2,options:S,label:tte,id:"eventTypeOptions",modifyLabel:!0,location:ii,selection:!0},{hide:b.length<2,options:b,id:"eventOptions",label:yg,modifyLabel:!0,location:ii,selection:!0},{hide:V.length<2,options:V,id:"flightOptions",label:SP,modifyLabel:!0,location:ii,selection:!0},{hide:E.length<2,options:E,id:"genderOptions",label:n4,modifyLabel:!0,location:ii,selection:!0},{hide:k.length<2,options:k,id:"roundOptions",label:ite,modifyLabel:!0,location:ii,selection:!0},{options:W,label:"Actions",selection:!1,location:Ht,align:Ht},{onClick:i,id:"doneScheduling",intent:"is-info",label:"Done"}];return eo({target:o,items:Y}),{updateScheduledDate:h}}const Mbt="modulepreload",Nbt=function(t,e){return new URL(t,e).href},Uae={},Tae=function(e,i,r){let n=Promise.resolve();if(i&&i.length>0){let c=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};const s=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");n=c(i.map(u=>{if(u=Nbt(u,r),u in Uae)return;Uae[u]=!0;const d=u.endsWith(".css"),p=d?'[rel="stylesheet"]':"";if(r)for(let h=s.length-1;h>=0;h--){const m=s[h];if(m.href===u&&(!d||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${p}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":Mbt,d||(f.as="script"),f.crossOrigin="",f.href=u,l&&f.setAttribute("nonce",l),document.head.appendChild(f),d)return new Promise((h,m)=>{f.addEventListener("load",h),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${u}`)))})}))}function a(s){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s}return n.then(s=>{for(const o of s||[])o.status==="rejected"&&a(o.reason);return e().catch(a)})};async function ONe(){const t=await Tae(()=>import("./pdfmake-D2kE9BJS.js").then(n=>n.p),[],import.meta.url),e=await Tae(()=>import("./vfs_fonts-DLCLZ9Sc.js").then(n=>n.v),[],import.meta.url),i=t.default||t,r=e.default||e;return i&&r&&(i.vfs=r.pdfMake?.vfs||r.vfs),i}async function FNe({docDefinition:t}){(await ONe()).createPdf(t).open()}async function LNe({docDefinition:t,filename:e="document.pdf"}){(await ONe()).createPdf(t).download(e)}async function Cae(t){const{tournament:e,scheduledDate:i,courts:r,rows:n,options:a,action:s}=t,o=r.length>=5||a.landscape?"landscape":"portrait",l=o==="portrait",c=kbt(r,a.fullCourtNames),d=Bbt(n,r).filter(b=>b.some(y=>y&&Object.keys(y).length>0&&y.matchUpId)),f=[{table:{widths:["*"],headerRows:1,body:[[xbt(c)],...d.map((b,y)=>[_bt(y+1,b)])]},layout:"noBorders"}],h=l?10:8,m=a.includeHeader?80:0,A=a.includeFooter?50:0,g={pageSize:"LETTER",pageOrientation:o,pageMargins:[20,m,20,A],content:f,header:a.includeHeader?()=>Obt(e,i):void 0,footer:a.includeFooter?Fbt(e,i):void 0,styles:{docTitle:{fontSize:12,bold:!0},subtitle:{fontSize:10,italics:!0,bold:!0},docName:{alignment:"center",fontSize:10,bold:!0},tableHeader:{fontSize:9},tableData:{fontSize:9,bold:!0},headerNotice:{fontSize:9,bold:!0,italics:!0,color:"red"},teamName:{alignment:"center",fontSize:h-1,bold:!0},centeredText:{alignment:"center",fontSize:9,bold:!1},centeredItalic:{alignment:"center",fontSize:8,bold:!1,italics:!0},centeredTableHeader:{alignment:"center",fontSize:9,bold:!0}}},v=`Schedule_${i}.pdf`;s==="open"?await FNe({docDefinition:g}):await LNe({docDefinition:g,filename:v})}function Bbt(t,e){return t.map(i=>e.map((n,a)=>{const s=`C|${a}`;return i[s]||{}}))}function kbt(t,e){const i=t.length<5?1:8,r=new Array(Math.max(i,t.length)).fill("");return t.forEach((n,a)=>{r[a]=e?n.courtName||n.name||"":(n.courtName||n.name||"").split(" ")[0]}),r}function xbt(t){const e=t.map(n=>({table:{widths:["*"],body:[[{text:n||" ",style:"centeredTableHeader",margin:[0,0,0,0]}]]},layout:"noBorders"})),i=[{text:" ",width:30},...e];return{table:{widths:[30,...t.map(()=>"*")],body:[i]},layout:"noBorders"}}function _bt(t,e){const i=e.map(a=>Eae(a)),r=[{stack:[Eae({oop:t})],width:30},...i];return{unbreakable:!0,table:{widths:[30,...e.map(()=>"*")],body:[r]},layout:{paddingLeft:()=>0,paddingRight:()=>0,paddingTop:()=>0,paddingBottom:()=>0,hLineWidth:(a,s)=>a===0||a===s.table.body.length?1:0,vLineWidth:()=>1,hLineColor:()=>"#999999",vLineColor:()=>"#999999"}}}function Eae(t){if(t?.oop!==void 0)return{table:{widths:["*"],body:[[{text:t.oop||" ",style:"centeredText",margin:[0,0,0,0]}]]},layout:{paddingLeft:()=>0,paddingRight:()=>0,paddingTop:()=>0,paddingBottom:()=>0,hLineWidth:()=>0,vLineWidth:()=>0}};if(!t?.matchUpId)return{table:{widths:["*"],body:[[{text:" ",style:"centeredText",margin:[0,0,0,0]}]]},layout:{paddingLeft:()=>0,paddingRight:()=>0,paddingTop:()=>0,paddingBottom:()=>0,hLineWidth:()=>0,vLineWidth:()=>0}};const e=t.schedule?.scheduledTime||"",r=(t.schedule?.timeModifiers||[])[0]||"";let n="";if(r){const b={FOLLOWED_BY:"Followed by",NOT_BEFORE:"Not before",AFTER_REST:"After rest"}[r]||r;n=e?`${b} ${e}`:b}else n=e;const a=t.roundName||"",s=t.eventName||"",o=t.category?.categoryName||"",l=v=>v?.person?.standardFamilyName?.toUpperCase()||v?.participantName||"",u=(t.potentialParticipants||[]).map(v=>!v||!Array.isArray(v)?"":v.map(l).filter(Boolean).join(" or ")),d=v=>t.sides?.find(y=>y.sideNumber===v)?.participant?.participantName||"",p=d(1)||u[0]||"TBD",f=d(2)||u[1]||"TBD",h=p.includes(" or "),m=f.includes(" or "),A=t.score?.scoreStringSide1||"",g=" ";return{table:{widths:["*"],body:[[{text:n||g,style:"centeredText",margin:[0,1,0,1],border:[!1,!1,!1,!1]}],[{text:`${s} ${a}`||g,style:"centeredItalic",margin:[0,1,0,1],border:[!1,!1,!1,!1]}],[{text:o||g,style:"centeredText",margin:[0,1,0,1],border:[!1,!1,!1,!1]}],[{text:p||g,style:"teamName",margin:[0,1,0,1],border:[!1,!1,!1,!1],color:h?"#555555":void 0}],[{text:p&&f?"vs.":g,style:"centeredText",margin:[0,1,0,1],border:[!1,!1,!1,!1]}],[{text:f||g,style:"teamName",margin:[0,1,0,1],border:[!1,!1,!1,!1],color:m?"#555555":void 0}],[{text:g,style:"centeredText",margin:[0,0,0,0],border:[!1,!1,!1,!1]}],[{text:A||g,style:"centeredText",margin:[0,1,0,1],border:[!1,!1,!1,!1]}]]},layout:{paddingLeft:()=>3,paddingRight:()=>3,paddingTop:()=>1,paddingBottom:()=>1,hLineWidth:()=>0,vLineWidth:()=>0}}}function Obt(t,e){const i=t.tournamentName||"",r=t.organizationName||"";return{margin:[20,10,20,10],fontSize:10,table:{widths:["*","*","*"],body:[[{text:i,colSpan:3,style:"docTitle",margin:[0,0,0,5]},{},{}],[{text:"Order of Play",colSpan:3,style:"docName",margin:[0,0,0,5]},{},{}],[{text:e,colSpan:3,style:"centeredText",margin:[0,0,0,5]},{},{}],[{text:r||"",style:"tableData"},{},{}]]},layout:"noBorders"}}function Fbt(t,e){return{margin:[20,10,20,10],text:`${t.tournamentName||""} - ${e}`,alignment:"center",fontSize:9}}function Lbt(t){const{scheduledDate:e,courts:i,rows:r}=t,n=Jd.getTournamentInfo().tournamentInfo,a=`
    <div style="padding: 20px;">
      <h3 class="title is-5">Print Schedule</h3>
      <p class="mb-4">Generate a PDF of the schedule for ${e}</p>
      
      <form id="printScheduleForm">
        <div class="field">
          <label class="checkbox">
            <input type="checkbox" id="includeHeader" checked>
            Include header
          </label>
        </div>
        
        <div class="field">
          <label class="checkbox">
            <input type="checkbox" id="includeFooter" checked>
            Include footer
          </label>
        </div>
        
        <div class="field">
          <label class="checkbox">
            <input type="checkbox" id="landscapeOrientation" ${i.length>=5?"checked":""}>
            Landscape orientation (recommended for ${i.length}+ courts)
          </label>
        </div>
        
        <div class="field">
          <label class="label">Court identifiers</label>
          <div class="control">
            <label class="radio">
              <input type="radio" name="courtIdentifiers" value="full" checked>
              Full court names
            </label>
            <label class="radio">
              <input type="radio" name="courtIdentifiers" value="short">
              Short court names (first word)
            </label>
          </div>
        </div>
        
        <div class="notification is-info is-light mt-4">
          <p><strong>Schedule:</strong> ${e}</p>
          <p><strong>Courts:</strong> ${i.length}</p>
          <p><strong>Rows:</strong> ${r.length}</p>
        </div>
      </form>
    </div>
  `;Jr({title:"Print Schedule",content:a,buttons:[{label:"Cancel",close:!0},{label:"View",intent:"is-info",onClick:async()=>{const o=document.getElementById("includeHeader").checked,l=document.getElementById("includeFooter").checked,c=document.getElementById("landscapeOrientation").checked,u=document.querySelector('input[name="courtIdentifiers"]:checked').value;try{await Cae({tournament:n,scheduledDate:e,courts:i,rows:r,options:{includeHeader:o,includeFooter:l,landscape:c,fullCourtNames:u==="full"},action:"open"})}catch(d){console.error("Error generating schedule PDF:",d),alert("Failed to generate schedule PDF. Check console for details.")}}},{label:"Download",intent:"is-primary",onClick:async()=>{const o=document.getElementById("includeHeader").checked,l=document.getElementById("includeFooter").checked,c=document.getElementById("landscapeOrientation").checked,u=document.querySelector('input[name="courtIdentifiers"]:checked').value;try{await Cae({tournament:n,scheduledDate:e,courts:i,rows:r,options:{includeHeader:o,includeFooter:l,landscape:c,fullCourtNames:u==="full"},action:"save"})}catch(d){console.error("Error generating schedule PDF:",d),alert("Failed to generate schedule PDF. Check console for details.")}}}]})}function $bt({toggleUnscheduled:t,schedulingActive:e,controlAnchor:i,scheduledDate:r,courtsCount:n}={}){if(!i)return{elements:void 0};let a;const s=f=>kZ(f).format("dddd MMM D"),{startDate:o,endDate:l}=Jd.getCompetitionDateRange(),u=Ri.generateDateRange(o,l).map(f=>({onClick:()=>{const h=Jd.getTournamentInfo().tournamentInfo.tournamentId;ot.router.navigate(`/tournament/${h}/schedule/${f}`)},isActive:f===r,label:s(f),value:f,close:!0})),d=()=>{},p=[{clearSearch:()=>d(),placeholder:"Search participants",id:"searchParticipants",visible:!!n,location:ii,search:!0},{options:[{label:"Team ",onClick:()=>console.log("team clicked"),close:!0}],label:"Highlight team",visible:!!n,id:"highlightTeam",location:ii,align:ii},{visible:!!n&&$t.pdfPrinting,onClick:()=>{const f={localPerspective:!0,scheduledDate:r},h=Jd.competitionScheduleMatchUps({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,nextMatchUps:!0,matchUpFilters:f}),{courtsData:m=[],rows:A=[]}=h;Lbt({scheduledDate:r||o,courts:m,rows:A})},label:"Print",id:"printSchedule",intent:"is-info",location:Ht},{visible:!!n&&!e,onClick:t,label:"Schedule matches",id:"scheduleMatchUps",intent:"is-primary",location:Ht},{label:s(r||o),value:r||o,id:bqe,options:u,modifyLabel:!0,intent:"is-info",location:Ht,align:Ht}];return a=eo({target:i,items:p})?.elements,{elements:a}}function $Ne(t){let e;const{startDate:i,endDate:r}=Jd.getCompetitionDateRange(),n=new Date,a=Ri.dateTime.formatDate(n),s=n>=new Date(i)&&n<=new Date(r),o=n>new Date(r)?r:i;if(!t.scheduledDate){const y=s?a:o,I=Jd.getTournamentInfo().tournamentInfo?.tournamentId;ot.router.navigate(`/tournament/${I}/schedule/${y}`)}const l=t.scheduledDate||(s?a:o);ot.displayed.selectedScheduleDate=l;const c=document.getElementById(Ebe),u=document.getElementById(K6),d=document.getElementById(Y6);u.style.paddingBottom="1em",d.style.paddingBottom="1em";let p=ot.state.schedulingActive;c.style.display=p?"":jt;const{replaceTableData:f,table:h,unscheduledMatchUps:m}=lyt({scheduledDate:l}),A=()=>{p=!p,ot.state.schedulingActive=p,c.style.display=p?"":jt,e?.scheduleMatchUps&&(e.scheduleMatchUps.style.display=p?jt:"")},g=Math.min(50,m?.length||0),{replaceTableData:v,courtsCount:b}=Ebt({minCourtGridRows:Math.max($t.schedule.minCourtGridRows,g),scheduledDate:l});Rbt({minCourtGridRows:$t.schedule.minCourtGridRows,controlAnchor:u,matchUps:m,table:h,updateUnscheduledTable:f,updateScheduleTable:v,toggleUnscheduled:A,scheduledDate:l}),e=$bt({toggleUnscheduled:A,schedulingActive:p,controlAnchor:d,scheduledDate:l,courtsCount:b}).elements}const{SUBSTITUTION:Dae,PENALTY:Pae,REMOVE_PARTICIPANT:Rae,REPLACE_PARTICIPANT:Mae}=B5,{POLICY_TYPE_MATCHUP_ACTIONS:Hbt}=Gg,{ASSIGN_PARTICIPANT:G3}=Qw,{TEAM:Vbt,DOUBLES:HNe}=Ul,Gbt=Ri.extractAttributes;function h1(t,e,i,r){if(!e)return;const n=Array.from(document.querySelectorAll(".tippy-content"));if(n.length){n.forEach(g=>g.remove());return}const s=e.getRow().getData(),o=e.getColumn().getDefinition(),l=s.matchUpType===HNe,c=s.eventType===Vbt,{matchUpId:u,drawId:d}=s,p=o.field==="side1"&&1||o.field==="side2"&&2,{validActions:f}=Ge.matchUpActions({matchUpId:u,drawId:d,sideNumber:p,policyDefinitions:{[Hbt]:{substituteAfterCompleted:!0,substituteWithoutScore:!0}}}),h=r?.individualParticipant?.participantId,m={[G3]:{params:{data:s,sideNumber:p,callback:i,isTeam:c,isDoubles:l},text:"Assign participant",method:XG},[Pae]:{onClick:()=>console.log({data:s}),text:"Assess penalty"},[Rae]:{params:{data:s,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:h},text:"Remove participant",method:Qbt},[Mae]:{params:{data:s,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:h},text:"Replace participant",method:XG},[Dae]:{params:{data:s,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:h},method:XG,text:"Substitution"}},A=f.filter(({type:g})=>[G3,Pae,Rae,Mae,Dae].includes(g)).map(g=>{const v=m[g.type];return{onClick:()=>{Mt(v.method)?v.method({...v.params,action:g}):Mt(v.onClick)&&v.onClick()},text:v.text}});A.length===1?A[0].onClick():A.length>0&&t?.target&&nl({items:A,target:t.target,config:{placement:wd}})}function Qbt(t){const{action:e,callback:i,clickedParticipantId:r}=t;e.payload.participantId=r;const n=[{method:e.method,params:e.payload}];Nt({methods:n,callback:s=>Mt(i)&&i?.(s)})}function XG(t){const{sideNumber:e,callback:i,isTeam:r,isDoubles:n,data:a}=t,s=t.action.availableParticipants,o=a.matchUp.matchUpType,c=a.matchUp.sides.find(m=>e===m.sideNumber)?.participant?.individualParticipantIds,u=t.clickedParticipantId;RN({selectedParticipantIds:c,selectOnEnter:!0,selectionLimit:o===HNe&&!u?2:1,onSelection:m=>{if(m.participantId||m.selected){const A=[];(Array.isArray(m.selected)?m.selected.map(Gbt("participantId")):[m.participantId]).filter(Boolean).forEach(b=>{A.push({params:{...t.action.payload,substituteParticipantId:b,newParticipantId:b,existingParticipantId:u,participantId:b},method:t.action.method})}),Nt({methods:A,callback:b=>{Mt(i)&&i?.(b)}})}},action:{type:G3,participantsAvailable:s},title:r&&n?"Doubles: Select participants":void 0})}function VNe(t,e){return t.pctSpread&&!e.pctSpread?-1:e.pctSpread&&!t.pctSpread?1:!t.pctSpread&&!e.pctSpread?0:e.pctSpread-t.pctSpread}function GNe(t){const e=t.getRow().getData(),i=document.createElement("span");if(!e.competitiveProfile?.competitiveness)return i;const{competitiveProfile:r,score:n}=e,a={COMPETITIVE:"green",DECISIVE:"magenta",ROUTINE:"blue"};if(n){const{competitiveness:s}=r;i.style.color=a[s],i.style.fontSize="smaller",i.innerHTML=s}return i}function LZ(t){const e=t.getRow().getData();if(!e.readyToScore)return;const i=e.matchUp.matchUpStatus==="WALKOVER",r=document.createElement("span");return r.classList.add("scoreCell"),e.score?(r.style.fontSize="smaller",r.innerHTML=e.score):i?r.innerHTML="WO":(r.style.color="blue",r.style.fontSize="smaller",r.innerHTML="Enter score"),r}function Nae(t){const e=document.createElement("div");return e.style.fontWeight="bold",e.innerHTML=t.getValue(),e}function QNe(t){const{matchUpId:e,schedule:i,callback:r}=t;Nt({methods:[{params:{matchUpIds:[e],schedule:i,removePriorValues:!0},method:lZ}],callback:s=>{s.success&&r&&Mt(r)&&r()}})}function $Z({pointerEvent:t,cell:e,matchUp:i,callback:r}){const n=Array.from(document.querySelectorAll(".tippy-content"));if(n.length){n.forEach(p=>p.remove());return}const a=!i?.roundPosition&&!i?.drawPositions,s=e&&t.target?.getElementsByClassName("fa-ellipsis-vertical")[0],o=e?.getRow().getData()||i,l=()=>{Mt(r)&&r&&r(o)},c=i?.schedule?.scheduledTime||i?.schedule?.scheduledDate||i?.schedule?.venueId||i?.schedule?.courtId,d=[{onClick:()=>{const p={scheduledDate:"",scheduledTime:"",courtId:"",venueId:""},f=()=>{if(!e){r&&r({refresh:!0});return}e.getRow().update({...o,...p,courtName:"",venueName:""})};QNe({matchUpId:i.matchUpId,schedule:p,callback:f})},text:"Clear schedule",hide:!c},{onClick:l,text:"Schedule"},{onClick:l,text:"Start time"},{onClick:l,text:"End time"},{onClick:l,text:"Set referee"}];a&&d.push({onClick:()=>jbt({...i,callback:l}),text:"Delete match",color:"red"}),nl({items:d,target:s||t.target,config:{placement:wd}})}function jbt({drawId:t,structureId:e,matchUpId:i,callback:r}){Nt({methods:[{method:tMe,params:{matchUpIds:[i],removeIncomplete:!0,removeCompleted:!0,structureId:e,drawId:t}}],callback:s=>{s.success?Mt(r)&&r&&r():console.log({postMutationError:s.error})}})}const Bae=t=>e=>{const i=document.createElement("div");return i.className="has-text-warning-dark",i.innerHTML="Select participant",(e.getValue().participantName&&Bb(t)(e,i,void 0))??i},DB=t=>({cell:e,event:i,...r})=>{h1(i,e,a=>{if(a.success){const s=e.getRow(),{drawId:o,matchUpId:l}=t,c=Ge.findMatchUp({drawId:o,matchUpId:l}).matchUp,u=s.getData().matchUp.collectionId,p=c.tieMatchUps.filter(h=>h.collectionId===u).map(h=>PS({...h,dualMatchUp:t})),f=e.getTable();f.updateData(p),f.redraw(!0)}},r)};function zbt(t,e){const i=e.getRow(),r=i.getData(),{matchUpId:n,readyToScore:a}=r;a&&MN({matchUpId:n,callback:o=>{if(o.success){const{matchUpStatus:l,sets:c,matchUpFormat:u,score:d,winningSide:p}=o.outcome;Object.assign(r,{matchUpStatus:l,sets:c,matchUpFormat:u,score:d}),r.winningSide=p&&`side${p}`,i.update(r),e.getTable().redraw(!0);const h=o.results.find(({methodName:m})=>m===dZ)?.tieMatchUpResult;rIt(h)}else console.log({result:o})}})}function qbt({matchUp:t}){const e=t.sides?.find(n=>n.sideNumber===1)?.participant?.participantName||"Side 1",i=t.sides?.find(n=>n.sideNumber===2)?.participant?.participantName||"Side 2",r=(n,a)=>n?.participantName?.localeCompare(a?.participantName);return[{formatter:Bae(DB(t)),cellClick:(n,a)=>DB(t)({event:n,cell:a}),sorter:r,title:e,responsive:!1,minWidth:100,field:"side1",widthGrow:2},{formatter:Bae(DB(t)),cellClick:(n,a)=>DB(t)({event:n,cell:a}),sorter:r,title:i,responsive:!1,minWidth:100,field:"side2",widthGrow:2},{formatter:LZ,cellClick:zbt,responsive:!1,title:"Score",field:"score",width:140},{field:"matchUpStatus",title:"Status",width:150}]}function Wbt({matchUp:t,tableElement:e,collectionMatchUps:i}){const r=i.map(s=>PS({...s,dualMatchUp:t})),n=qbt({matchUp:t});return{table:new es(e,{responsiveLayoutCollapseStartOpen:!1,responsiveLayout:"collapse",placeholder:"No matches",reactiveData:!0,layout:"fitColumns",index:"matchUpId",columns:n,data:r})}}function jNe({side1:t,side2:e,side1Score:i,side2Score:r}){const n=document.createElement("div");n.className="overlay-content-overview";const a=document.createElement("div");a.className="overlay-content-body";const s=Kbt({side1Score:i,side2Score:r});return a.appendChild(t),a.appendChild(s),a.appendChild(e),n.appendChild(a),n}function AO({participantName:t,justify:e="start"}){const i=document.createElement("div");i.className=`matchup-side justify-${e}`;const r=document.createElement("div");return r.className="side-name",r.innerHTML=t,i.appendChild(r),i}function Kbt({side1Score:t,side2Score:e}){const i=document.createElement("div");i.className="score-box";const r=document.createElement("div");r.className="score-flex";const n=document.createElement("div");return n.className="score-vs",n.innerHTML="vs",r.appendChild(t),r.appendChild(n),r.appendChild(e),i.appendChild(r),i}function gO({winningSide:t,sets:e,sideNumber:i,id:r}){const n=`side${i}Score`,a=e?.[0]?.[n]||0,s=document.createElement("span");return r&&(s.id=r),s.className="side-score",i===1?s.style.paddingLeft="1rem":s.style.paddingRight="1rem",i===t&&s.classList.add("has-text-success"),s.innerHTML=String(a),s}let zNe;function qNe({title:t,content:e,footer:i}={}){if(!e||!i)return;const r=document.getElementById(CP);r&&fo(r);const n=document.createElement("div");n.className="overlay noselect",n.id=CP;const a=document.createElement("div");a.className="overlay-center-align",n.appendChild(a);const s=document.createElement("div");if(s.className="overlay-root",a.appendChild(s),t){const u=Xbt({title:t});s.appendChild(u)}const o=document.createElement("div");o.className="overlay-content",typeof e=="string"?o.innerHTML=e:e&&o.appendChild(e),s.appendChild(o);const l=document.createElement("div");l.className="overlay-footer",typeof i=="string"?l.innerHTML=i:i&&l.appendChild(i),s.appendChild(l),document.body.appendChild(n),zNe=window.scrollY||document.documentElement.scrollTop;const c=document.getElementById("root");c.style.display=jt}function Ybt({content:t}){const e=document.getElementById(CP)?.getElementsByClassName("overlay-content")?.[0];e&&(fo(e),typeof t=="string"?e.innerHTML=t:t&&e.appendChild(t))}function Xbt({title:t}){const e=document.createElement("h2");return e.className="overlay-header",e.innerHTML=`
    <div class="overlay-header-content">
      <h1 class="overlay-title">${t}</h1> 
    </div>
  `,e}function WNe(){const t=document.getElementById("root");t.style.display="inline",window.scrollTo({top:zNe});let e=document.getElementById(CP);fo(e);let i=0;for(;i<5&&e;)e.remove(),i+=1,e=document.getElementById(CP)}function Zbt(){return[{rowHandle:!0,formatter:"handle",width:30,minWidth:30},{cellClick:(e,i)=>i.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",responsive:!1,hozAlign:ii,width:5},{formatter:"responsiveCollapse",responsive:!1,resizable:!1,hozAlign:si,width:50},{editorParams:{selectContents:!0},field:"collectionName",minWidth:200,title:"Name",editor:!0},{field:"matchUpCount",editor:"number",title:"#",width:70,editorParams:{elementAttributes:{maxlength:2},selectContents:!0,mask:"99",step:1,max:20,min:0}},{field:"matchUpType",editor:"list",title:"Type",width:100,editorParams:{values:["Singles","Doubles"]}},{title:"Gender",field:"gender",editor:"list",width:100,editorParams:{values:["Male","Female","Any"]}},{cellClick:(e,i)=>{const r=i.getRow(),n=r.getData();IH({callback:s=>{s&&(Object.assign(n,{matchUpFormat:s}),r.update(n),i.getTable().redraw(!0))},existingMatchUpFormat:n.matchUpFormat,modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})},title:"Score format",field:a8,minWidth:150},{title:"Award type",field:"awardType",editor:"list",width:150,editorParams:{values:[t8,i8,n8,r8]}},{field:"awardValue",editor:"number",title:"Value",width:70,editorParams:{elementAttributes:{maxlength:2},selectContents:!0,mask:"99",step:1,max:99,min:0}}]}function kae(t){return t?.[0].toUpperCase()+t?.substring(1).toLowerCase()||""}function Jbt({tableElement:t,tieFormat:e}){const i=(e?.collectionDefinitions?.sort((a,s)=>a.collectionOrder-s.collectionOrder)||[]).map(a=>{const{collectionValue:s,matchUpValue:o,scoreValue:l,setValue:c,matchUpType:u,gender:d}=a,p=Ri.isConvertableInteger(s)&&t8||Ri.isConvertableInteger(l)&&r8||Ri.isConvertableInteger(c)&&n8||i8,f=s??l??c??o;return{...a,matchUpType:kae(u),gender:kae(d),awardValue:f,awardType:p}}),r=Zbt();return{table:new es(t,{responsiveLayoutCollapseStartOpen:!1,columnDefaults:{headerSort:!1},placeholder:"No collections",responsiveLayout:"collapse",index:"collectionId",reactiveData:!0,layout:"fitColumns",movableRows:!0,minHeight:200,columns:r,data:i})}}function KNe(t){const e=t?.winCriteria?.valueGoal,i=t?.collectionDefinitions?.length?t?.winCriteria?.aggregateValue&&"Aggregate value":"none";return`<div style="font-weight: bold">Win criteria: <span class="has-text-success">${e||i}</span></div>`}function YNe({title:t,tieFormat:e,onClose:i}){const{content:r,inputs:n,elements:a,table:s}=eIt({tieFormat:e}),o=u=>{const d=n.tieFormatName.value,p=u.map(h=>Ri.definedAttributes({collectionValue:h.awardType===t8?h.awardValue:void 0,matchUpValue:h.awardType===i8?h.awardValue:void 0,scoreValue:h.awardType===r8?h.awardValue:void 0,setValue:h.awardType===n8?h.awardValue:void 0,matchUpType:h.matchUpType.toUpperCase(),collectionName:h.collectionName,matchUpFormat:h.matchUpFormat,gender:h.gender.toUpperCase(),collectionId:h.collectionId,matchUpCount:h.matchUpCount})),f=Ge.calculateWinCriteria({collectionDefinitions:p});return{collectionDefinitions:p,tieFormatName:d,winCriteria:f}};s.on("dataChanged",()=>{const u=o(s.getData());a.winCriteria.innerHTML=KNe(u)});const c=iIt({table:s,onClose:u=>{const d=o(u);Mt(i)&&i(d?.collectionDefinitions?.length&&d)}});return qNe({title:t,content:r,footer:c})}function eIt({tieFormat:t}){const e=document.createElement("div");e.className="overlay-content-container",e.style.backgroundColor="white";const i=document.createElement("div"),{table:r}=Jbt({tieFormat:t,tableElement:i}),n=tIt();e.appendChild(n);const a=document.createElement("div");e.appendChild(a),e.appendChild(i);const s=()=>{const u=r?.getSelectedData().map(({collectionId:d})=>d);r?.deleteRow(u)},o=[{value:t?.tieFormatName||"Custom scorecard",error:"minimum of 5 characters",placeholder:"Scorecard name",validator:fi.nameValidator(5),field:"tieFormatName",id:"tieFormatName",location:ii},{text:KNe(t),id:"winCriteria",location:ii},{onClick:s,label:"Delete selected",intent:"is-danger",stateChange:!0,location:sa},{onClick:()=>{const d={collectionName:`Collection ${r.getData().length+1}`,collectionId:Ri.UUID(),awardType:"Match value",matchUpFormat:"SET3-S:6/TB7",matchUpType:"Singles",matchUpCount:1,gender:"Any",awardValue:1};r.addRow(d)},label:"Add collection",intent:"is-info",location:Ht}],{elements:l,inputs:c}=eo({table:r,target:a,items:o})||{};return{content:e,table:r,elements:l,inputs:c}}function tIt(){const t=document.createElement("div");t.className="overlay-content-overview";const e=document.createElement("div");return e.className="overlay-content-body",t.appendChild(e),t}function iIt({table:t,onClose:e}){const i=()=>{t.destroy(),WNe()},r=document.createElement("button");r.className="button is-warning is-light",r.onclick=i,r.innerHTML="Cancel";const n=document.createElement("button");n.className="button is-info button-spacer",n.onclick=s=>{s.preventDefault(),s.stopPropagation();const o=t.getData();i(),Mt(e)&&e(o)},n.innerHTML="Done";const a=document.createElement("div");return a.className="overlay-footer-wrap",a.appendChild(r),a.appendChild(n),a}function XNe({matchUpId:t,structureId:e,eventId:i,drawId:r,callback:n}){const{tieFormat:a}=Ge.getTieFormat({structureId:e,matchUpId:t,eventId:i,drawId:r});YNe({title:"Edit scorecard",tieFormat:a,onClose:o=>{if(o){o.collectionDefinitions?.forEach((p,f)=>p.collectionOrder=f+1);const l={collectionName:!0,collectionOrder:!0};if(!NR.compareTieFormats({descendant:o,ancestor:a,considerations:l})?.different){Pt({intent:"is-info",message:"No changes"});return}Nt({methods:[{method:Xut,params:{modifiedTieFormat:o,considerations:l,structureId:e,matchUpId:t,drawId:r}}],callback:p=>p.success?(Pt({intent:"is-success",message:"Scorecard updated"}),Mt(n)&&n?.()):Pt({intent:"is-danger",message:p.error?.message||"Error"})})}}})}const PB="has-text-success",ZNe="tieSide1",JNe="tieSide2";function LH({title:t,drawId:e,matchUpId:i,onClose:r}){const n=Ge.findMatchUp({drawId:e,matchUpId:i,participantsProfile:{withISO2:!0}}),a=n.matchUp;if(!a||n.error||!t||!Array.isArray(a?.tieFormat?.collectionDefinitions))return;const s=$H({matchUp:a}),o=nIt({title:t,drawId:e,matchUpId:i,onClose:r});return qNe({title:t,content:s,footer:o})}function $H({matchUp:t}){const e=document.createElement("div");e.className="overlay-content-container";const i=AO({participantName:xae({matchUp:t,sideNumber:1})||"",justify:"end"}),r=AO({participantName:xae({matchUp:t,sideNumber:2})||"",justify:"start"}),{winningSide:n,score:a}=t,s=a?.sets||[],o=gO({winningSide:n,sets:s,sideNumber:1,id:ZNe}),l=gO({winningSide:n,sets:s,sideNumber:2,id:JNe}),c=jNe({side1:i,side2:r,side1Score:o,side2Score:l});e.appendChild(c),ot.collectionTables??=[];const u=t.tieFormat.collectionDefinitions?.sort((d,p)=>d.collectionOrder-p.collectionOrder)||[];for(const d of u){const p=t.tieMatchUps.filter(g=>g.collectionId===d.collectionId),f=document.createElement("div");f.className="collection";const h=document.createElement("div");h.className="title is-4",h.innerHTML=d.collectionName,f.appendChild(h);const m=document.createElement("div");f.appendChild(m);const{table:A}=Wbt({matchUp:t,tableElement:m,collectionMatchUps:p});ot.collectionTables.push(A),e.appendChild(f)}return e}function rIt(t){const e=t?.score?.sets?.[0];if(!e)return;const i=document.getElementById(ZNe),r=document.getElementById(JNe);i.classList.remove(PB),r.classList.remove(PB),i.innerHTML=e.side1Score,r.innerHTML=e.side2Score,t.winningSide===1&&i.classList.add(PB),t.winningSide===2&&r.classList.add(PB)}function xae({matchUp:t,sideNumber:e}){return t.sides.find(i=>i.sideNumber===e)?.participant?.participantName}function nIt({title:t,drawId:e,matchUpId:i,onClose:r}){const n=document.createElement("button");n.className="button is-warning is-light",n.onclick=()=>{XNe({matchUpId:i,drawId:e,callback:()=>LH({title:t,drawId:e,matchUpId:i,onClose:()=>console.log("closed")})})},n.innerHTML="Edit scorecard";const a=u=>{if(u.success){const d=Ge.findMatchUp({drawId:e,matchUpId:i})?.matchUp,p=$H({matchUp:d});Ybt({content:p})}},s=document.createElement("button");s.className="button is-warning is-light button-spacer",s.innerHTML="Remove players",s.onclick=()=>{Nt({methods:[{params:{drawId:e,matchUpId:i,inheritance:!1},method:sMe}],callback:a})};const o=document.createElement("button");o.className="button is-info is-light button-spacer",o.innerHTML="Clear results",o.onclick=()=>{Nt({methods:[{params:{drawId:e,matchUpId:i},method:oMe}],callback:a})};const l=document.createElement("button");l.className="button is-info button-spacer",l.onclick=u=>{for(u.preventDefault(),u.stopPropagation();ot.collectionTables?.length;)ot.collectionTables.pop().destroy();WNe(),Mt(r)&&r?.()},l.innerHTML="Done";const c=document.createElement("div");return c.className="overlay-footer-wrap",c.appendChild(n),c.appendChild(s),c.appendChild(o),c.appendChild(l),c}const{TEAM:aIt}=io,sIt=(t,e)=>(i,r)=>{const n=r.getRow().getData(),{matchUpId:a,readyToScore:s,matchUpType:o,drawId:l,eventName:c}=n.matchUp;if(o===aIt)LH({title:c,matchUpId:a,drawId:l,onClose:()=>t()});else if(s||n.matchUp.score?.scoreStringSide1)if($t.hotkeys&&!$t.device.isMobile){e({e:i,cell:r,replaceTableData:t});const u=document.querySelectorAll(".activeScoreCell");for(const d of Array.from(u))d.classList.remove("activeScoreCell");i.target.classList.contains("tabulator-cell")?i.target.firstChild.classList.add("activeScoreCell"):i.target.classList.add("activeScoreCell")}else MN({matchUp:n.matchUp,matchUpId:a,callback:t})};function eBe(t,e){if(!t.score&&!e.score){if(t.readyToScore&&!e.readyToScore)return-1;if(e.readyToScore&&!t.readyToScore)return 1}return t.score&&!e.score?-1:e.score&&!t.score?1:0}const _ae={fn:t=>({name:"dynamicContent",default:!0,onShow(){typeof t.props.dynContent=="function"&&t.setContent(t.props.dynContent(t.reference))}})},pI={"o-route":aE,"p-route":Vm,"e-route":jf,"m-route":F6,"s-route":Ny,"v-route":L6},Oae={"o-route":"Overview","p-route":"Participants","e-route":"Events","m-route":"MatchUps","s-route":"Schedule","v-route":"Venues"};function oIt(){const t=`
  <div class="side-bar collapse">
    <ul class="features-list">
      <span class="features-item-text">Overview</span>
      <span class="features-item-text">Participants</span>
      <span class="features-item-text">Events</span>
      <span class="features-item-text">Matches</span>
      <span class="features-item-text">Schedule</span>
      <span class="features-item-text">Venues</span>
    </ul>
  </div>
`,e=document.getElementById("navText");e.innerHTML=t;const i=Object.keys(pI),r=ot.router?.current?.[0]?.data?.selectedTab,n=s=>document.querySelector(".side-bar")?.classList.contains("collapse")?s:"",a=document.getElementById("o-route");Bg(a,{dynContent:()=>!$t.device.isMobile&&n(Oae["o-route"]),onShow:s=>!!s.props.content,plugins:[_ae],placement:wd,arrow:!1}),i.forEach(s=>{const o=document.getElementById(s);Bg(o,{dynContent:()=>!$t.device.isMobile&&n(Oae[s]),onShow:l=>!!l.props.content,plugins:[_ae],placement:wd,arrow:!1}),(r===pI[s]||!r&&pI[s]===Vm)&&(o.style.color="blue"),o.onclick=()=>{document.querySelectorAll(".nav-icon").forEach(u=>u.style.color=""),o.style.color="blue";const l=Ge.getTournament()?.tournamentRecord?.tournamentId,c=`/${js}/${l}/${pI[s]}`;ot.router.navigate(c)}})}function HZ(t){document.querySelectorAll(".nav-icon").forEach(i=>i.style.color=""),Object.keys(pI).forEach(i=>{const r=document.getElementById(i);r&&(t===pI[i]||!t&&pI[i]===Vm)&&(r.style.color="blue")})}function lIt({data:t,replaceTableData:e,setFocusData:i}){const r=(c,u)=>{const p=u.getRow().getData(),{courtName:f,scheduledDate:h}=p;if(f&&h){const m=Ge.getTournament()?.tournamentRecord?.tournamentId,A=`/${js}/${m}/${Ny}/${h}`;ot.router.navigate(A),HZ(Ny)}},n=(c,u)=>{const d=u.getValue();BNe({time:d,callback:({time:f})=>{const m=Ri.dateTime.convertTime(f,!0),A=u.getRow(),g=A.getData(),{matchUpId:v}=g;m!==d&&QNe({matchUpId:v,schedule:{scheduledTime:m},callback:()=>{console.log("callback"),A.update({...g,scheduledTime:m})}})}})},a=()=>e(),s=t.some(c=>c.courtName),o=(c,u)=>h1(c,u,a),l=c=>{const u=document.createElement("div");u.className="has-text-warning-dark",u.innerHTML="Select participant";const d=({event:f,...h})=>{h1(f,c,a,h)};return c.getValue().participantName&&Bb(d)(c,u)};return[{cellClick:(c,u)=>u.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ii,width:5},{headerMenu:TA({duration:"Duration",complete:"Complete"}),formatter:"rownum",headerSort:!1,hozAlign:ii,width:55},{formatter:Mgt(_n),field:"eventId",title:"Event",visible:!0,minWidth:200,widthGrow:1},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{field:"matchUpType",titleFormatter:Nae,title:"Type",minWidth:90},{field:"roundName",title:"Round",titleFormatter:Nae,minWidth:90},{cellClick:r,field:"scheduledDate",title:"Date",width:110},{cellClick:r,visible:!!s,field:"courtName",title:"Court",width:100},{cellClick:n,field:"scheduledTime",visible:!0,title:"Time",width:70},{formatter:l,cellClick:o,sorter:AC,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:l,cellClick:o,sorter:AC,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{cellClick:sIt(e,i),formatter:LZ,sorter:eBe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:VNe,formatter:GNe,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:ii,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70},{cellClick:(c,u)=>$Z({pointerEvent:c,cell:u,...u.getData()}),formatter:dv,responsive:!1,headerSort:!1,hozAlign:Ht,widthGrow:0,width:50}]}const ZG=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function JG(t,e,i,r){t.addEventListener?t.addEventListener(e,i,r):t.attachEvent&&t.attachEvent(`on${e}`,i)}function mD(t,e,i,r){t&&(t.removeEventListener?t.removeEventListener(e,i,r):t.detachEvent&&t.detachEvent(`on${e}`,i))}function tBe(t,e){const i=e.slice(0,e.length-1),r=[];for(let n=0;n<i.length;n++)r.push(t[i[n].toLowerCase()]);return r}function iBe(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let i=e.lastIndexOf("");for(;i>=0;)e[i-1]+=",",e.splice(i,1),i=e.lastIndexOf("");return e}function cIt(t,e){const i=t.length>=e.length?t:e,r=t.length>=e.length?e:t;let n=!0;for(let a=0;a<i.length;a++)r.indexOf(i[a])===-1&&(n=!1);return n}function rBe(t){let e=t.keyCode||t.which||t.charCode;return t.code&&/^Key[A-Z]$/.test(t.code)&&(e=t.code.charCodeAt(3)),e}const m1={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":ZG?173:189,"=":ZG?61:187,";":ZG?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},uh={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,meta:91,command:91},OD={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Nl={16:!1,18:!1,17:!1,91:!1},Rs={};for(let t=1;t<20;t++)m1[`f${t}`]=111+t;let hs=[],x0=null,nBe="all";const ZA=new Map,QE=t=>m1[t.toLowerCase()]||uh[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),uIt=t=>Object.keys(m1).find(e=>m1[e]===t),dIt=t=>Object.keys(uh).find(e=>uh[e]===t),aBe=t=>{nBe=t||"all"},A1=()=>nBe||"all",pIt=()=>hs.slice(0),fIt=()=>hs.map(t=>uIt(t)||dIt(t)||String.fromCharCode(t)),hIt=()=>{const t=[];return Object.keys(Rs).forEach(e=>{Rs[e].forEach(({key:i,scope:r,mods:n,shortcut:a})=>{t.push({scope:r,shortcut:a,mods:n,keys:i.split("+").map(s=>QE(s))})})}),t},sBe=t=>{const e=t.target||t.srcElement,{tagName:i}=e;let r=!0;const n=i==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(n||i==="TEXTAREA"||i==="SELECT")&&!e.readOnly)&&(r=!1),r},mIt=t=>(typeof t=="string"&&(t=QE(t)),hs.indexOf(t)!==-1),AIt=(t,e)=>{let i,r;t||(t=A1());for(const n in Rs)if(Object.prototype.hasOwnProperty.call(Rs,n))for(i=Rs[n],r=0;r<i.length;)i[r].scope===t?i.splice(r,1).forEach(({element:a})=>VZ(a)):r++;A1()===t&&aBe(e||"all")};function gIt(t){let e=rBe(t);t.key&&t.key.toLowerCase()==="capslock"&&(e=QE(t.key));const i=hs.indexOf(e);if(i>=0&&hs.splice(i,1),t.key&&t.key.toLowerCase()==="meta"&&hs.splice(0,hs.length),(e===93||e===224)&&(e=91),e in Nl){Nl[e]=!1;for(const r in uh)uh[r]===e&&(bm[r]=!1)}}const oBe=(t,...e)=>{if(typeof t>"u")Object.keys(Rs).forEach(i=>{Array.isArray(Rs[i])&&Rs[i].forEach(r=>RB(r)),delete Rs[i]}),VZ(null);else if(Array.isArray(t))t.forEach(i=>{i.key&&RB(i)});else if(typeof t=="object")t.key&&RB(t);else if(typeof t=="string"){let[i,r]=e;typeof i=="function"&&(r=i,i=""),RB({key:t,scope:i,method:r,splitKey:"+"})}},RB=({key:t,scope:e,method:i,splitKey:r="+"})=>{iBe(t).forEach(n=>{const a=n.split(r),s=a.length,o=a[s-1],l=o==="*"?"*":QE(o);if(!Rs[l])return;e||(e=A1());const c=s>1?tBe(uh,a):[],u=[];Rs[l]=Rs[l].filter(d=>{const p=(i?d.method===i:!0)&&d.scope===e&&cIt(d.mods,c);return p&&u.push(d.element),!p}),u.forEach(d=>VZ(d))})};function Fae(t,e,i,r){if(e.element!==r)return;let n;if(e.scope===i||e.scope==="all"){n=e.mods.length>0;for(const a in Nl)Object.prototype.hasOwnProperty.call(Nl,a)&&(!Nl[a]&&e.mods.indexOf(+a)>-1||Nl[a]&&e.mods.indexOf(+a)===-1)&&(n=!1);(e.mods.length===0&&!Nl[16]&&!Nl[18]&&!Nl[17]&&!Nl[91]||n||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(hs),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function Lae(t,e){const i=Rs["*"];let r=rBe(t);if(t.key&&t.key.toLowerCase()==="capslock"||!(bm.filter||sBe).call(this,t))return;if((r===93||r===224)&&(r=91),hs.indexOf(r)===-1&&r!==229&&hs.push(r),["metaKey","ctrlKey","altKey","shiftKey"].forEach(o=>{const l=OD[o];t[o]&&hs.indexOf(l)===-1?hs.push(l):!t[o]&&hs.indexOf(l)>-1?hs.splice(hs.indexOf(l),1):o==="metaKey"&&t[o]&&(hs=hs.filter(c=>c in OD||c===r))}),r in Nl){Nl[r]=!0;for(const o in uh)if(Object.prototype.hasOwnProperty.call(uh,o)){const l=OD[uh[o]];bm[o]=t[l]}if(!i)return}for(const o in Nl)Object.prototype.hasOwnProperty.call(Nl,o)&&(Nl[o]=t[OD[o]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(hs.indexOf(17)===-1&&hs.push(17),hs.indexOf(18)===-1&&hs.push(18),Nl[17]=!0,Nl[18]=!0);const n=A1();if(i)for(let o=0;o<i.length;o++)i[o].scope===n&&(t.type==="keydown"&&i[o].keydown||t.type==="keyup"&&i[o].keyup)&&Fae(t,i[o],n,e);if(!(r in Rs))return;const a=Rs[r],s=a.length;for(let o=0;o<s;o++)if((t.type==="keydown"&&a[o].keydown||t.type==="keyup"&&a[o].keyup)&&a[o].key){const l=a[o],{splitKey:c}=l,u=l.key.split(c),d=[];for(let p=0;p<u.length;p++)d.push(QE(u[p]));d.sort().join("")===hs.sort().join("")&&Fae(t,l,n,e)}}const bm=function(t,e,i){hs=[];const r=iBe(t);let n=[],a="all",s=document,o=0,l=!1,c=!0,u="+",d=!1,p=!1;if(i===void 0&&typeof e=="function"&&(i=e),Object.prototype.toString.call(e)==="[object Object]"){const f=e;f.scope&&(a=f.scope),f.element&&(s=f.element),f.keyup&&(l=f.keyup),f.keydown!==void 0&&(c=f.keydown),f.capture!==void 0&&(d=f.capture),typeof f.splitKey=="string"&&(u=f.splitKey),f.single===!0&&(p=!0)}for(typeof e=="string"&&(a=e),p&&oBe(t,a);o<r.length;o++){const f=r[o].split(u);n=[],f.length>1&&(n=tBe(uh,f));let h=f[f.length-1];h=h==="*"?"*":QE(h),h in Rs||(Rs[h]=[]),Rs[h].push({keyup:l,keydown:c,scope:a,mods:n,shortcut:r[o],method:i,key:r[o],splitKey:u,element:s})}if(typeof s<"u"&&typeof window<"u"){if(!ZA.has(s)){const f=(m=window.event)=>Lae(m,s),h=(m=window.event)=>{Lae(m,s),gIt(m)};ZA.set(s,{keydownListener:f,keyupListenr:h,capture:d}),JG(s,"keydown",f,d),JG(s,"keyup",h,d)}if(!x0){const f=()=>{hs=[]};x0={listener:f,capture:d},JG(window,"focus",f,d)}}};function vIt(t,e="all"){Object.keys(Rs).forEach(i=>{Rs[i].filter(r=>r.scope===e&&r.shortcut===t).forEach(r=>{r&&r.method&&r.method({},r)})})}function VZ(t){const e=Object.values(Rs).flat();if(e.findIndex(({element:i})=>i===t)<0&&t){const{keydownListener:i,keyupListenr:r,capture:n}=ZA.get(t)||{};i&&r&&(mD(t,"keyup",r,n),mD(t,"keydown",i,n),ZA.delete(t))}if((e.length<=0||ZA.size<=0)&&(Array.from(ZA.keys()).forEach(i=>{const{keydownListener:r,keyupListenr:n,capture:a}=ZA.get(i)||{};r&&n&&(mD(i,"keyup",n,a),mD(i,"keydown",r,a),ZA.delete(i))}),ZA.clear(),Object.keys(Rs).forEach(i=>delete Rs[i]),x0)){const{listener:i,capture:r}=x0;mD(window,"focus",i,r),x0=null}}const eQ={getPressedKeyString:fIt,setScope:aBe,getScope:A1,deleteScope:AIt,getPressedKeyCodes:pIt,getAllKeyCodes:hIt,isPressed:mIt,filter:sBe,trigger:vIt,unbind:oBe,keyMap:m1,modifier:uh,modifierMap:OD};for(const t in eQ){const e=t;Object.prototype.hasOwnProperty.call(eQ,e)&&(bm[e]=eQ[e])}if(typeof window<"u"){const t=window.hotkeys;bm.noConflict=e=>(e&&window.hotkeys===bm&&(window.hotkeys=t),bm),window.hotkeys=bm}const{HOTKEYS:yIt,SIDE1KEYS:bIt,MODIFIERS:IIt}=Q5;function wIt(){let t,e;const i=r=>{e=void 0,t=r};return bm(yIt+",esc",(r,n)=>{if(t){const a=t.cell.getElement(),s=a.classList?.contains("tabulator-cell")?a.firstChild:a;r.preventDefault();const o=t.cell.getRow().getData();e||(e=o.matchUp);const l=bm.shift,c=l?n.key.split(n.splitKey)[1]:n.key;c==="esc"&&(t.replaceTableData(),t=void 0);const u=bIt.some(d=>d===c)&&(l?2:1)||void 0;if(u||IIt.includes(c)){const{matchUpFormat:d,matchUpStatus:p,score:f,sets:h,winningSide:m}=e,{matchUpStatus:A,scoreString:g,winningSide:v,sets:b,updated:y}=ry.keyValueScore({scoreString:f?.scoreStringSide1,shiftFirst:!0,sets:h||[],matchUpStatus:p,matchUpFormat:d,winningSide:m,lowSide:u,value:c});y&&(e={matchUpId:o.matchUp.matchUpId,drawId:o.matchUp.drawId,score:{scoreStringSide1:g},matchUpStatus:A,winningSide:v,sets:b,matchUpFormat:d,updated:y},s.innerText=g||"Enter score")}}if(t&&n.key==="enter"){const a=ry.generateScoreString({sets:e.sets,reversed:!0}),s=ry.generateScoreString({sets:e.sets}),o={matchUpStatus:e.matchUpStatus,winningSide:e.winningSide,score:{sets:e.sets,scoreStringSide1:s,scoreStringSide2:a}};SIt({callback:t.replaceTableData,matchUpId:e.matchUpId,drawId:e.drawId,outcome:o}),t=void 0}}),{setFocusData:i}}function SIt({outcome:t,callback:e,matchUpId:i,drawId:r}){const{matchUpStatus:n,winningSide:a,score:s}=t;Nt({methods:[{method:dZ,params:{outcome:{matchUpStatus:n,winningSide:a,score:s},matchUpId:i,drawId:r}}],callback:c=>{Mt(e)&&e({...c,outcome:t})}})}function UIt(){let t;const{setFocusData:e}=wIt(),i=()=>(Ge.allTournamentMatchUps({participantsProfile:{withISO2:!0,withScaleValues:!0},contextProfile:{withCompetitiveness:!0}}).matchUps||[]).filter(({matchUpStatus:l})=>l!=="BYE").map(PS),r=()=>{t.replaceData(i())},n=i(),a=lIt({data:n,replaceTableData:r,setFocusData:e});return(o=>{UA({anchorId:s_});const l=document.getElementById(s_),c=ac(l,"section")?.querySelector(".tabHeader");t=new es(l,{headerSortElement:kf(["complete","duration","score","scheduledTime"]),height:window.innerHeight*.85,placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",columns:a,data:o}),t.on("dataFiltered",(u,d)=>{const p=d.map(g=>g.getData().matchUp);c&&(c.innerHTML=`Matches (${p.length})`);const f=document.getElementById("wtnPredictiveAccuracy"),h=Ge.getPredictiveAccuracy({valueAccessor:"wtnRating",scaleName:"WTN",zoneMargin:2.5,matchUps:p});h?.accuracy?.percent?(f.style.display="",f.innerHTML=`WTN ${h.accuracy.percent}%`):f.style.display=jt;const m=document.getElementById("utrPredictiveAccuracy"),A=Ge.getPredictiveAccuracy({valueAccessor:"utrRating",singlesForDoubles:!0,scaleName:"UTR",zoneMargin:1,matchUps:p});A?.accuracy?.percent?(m.style.display="",m.innerHTML=`UTR ${A.accuracy.percent}%`):m.style.display=jt})})(n),{table:t,data:n,replaceTableData:r}}function vO(t){$t.activeScale=t}const{TEAM_EVENT:$ae,SINGLES:Hae,DOUBLES:Vae}=Ul,{TEAM:TIt}=io;function CIt(){const t=new Map,e={elements:{},options:{}},{data:i,table:r,replaceTableData:n}=UIt(),a=Ge.getEvents().events||[],s=document.getElementById(H6);s.style.display=jt,e.options.flight=RIt({matchUpFilters:t,events:a,table:r});const o=MIt({matchUpFilters:t,components:e,events:a,table:r}),l=DIt({table:r,matchUpFilters:t,statsPanel:s}),c=EIt({table:r,matchUpFilters:t,data:i}),u=PIt({matchUpFilters:t,table:r}),d=m=>m.searchText?.includes(t.get("searchText")),p=m=>{m||r?.removeFilter(d),t.set("searchText",m),m&&r?.addFilter(d)},f=[{onClick:()=>r?.deselectRow(),label:"Schedule",stateChange:!0,location:sa},{onKeyDown:m=>m.keyCode===8&&m.target.value.length===1&&p(""),onKeyUp:m=>p(m.target.value),clearSearch:()=>{r?.removeFilter(d),t.set("searchText",""),r?.removeFilter()},placeholder:"Search matches",location:ii,search:!0},{hide:o.length<4,options:o,id:"eventOptions",label:yg,modifyLabel:!0,selection:!0,location:ii},{options:e.options.flight.flightOptions,hide:!t.get("eventIdFilter")||e.options.flight.flightOptions.length<3,label:SP,id:"flightOptions",modifyLabel:!0,selection:!0,location:ii},{hide:l.length<3,options:l,modifyLabel:!0,label:hbe,location:ii,selection:!0},{options:u,label:fbe,modifyLabel:!0,selection:!0,location:ii},{hide:c.length<4,options:c,modifyLabel:!0,label:mbe,selection:!0,location:ii},{onClick:()=>{vO(DP),n()},id:"wtnPredictiveAccuracy",intent:"is-danger",location:Ht,text:"WTN %",hide:!0},{onClick:()=>{vO(ZI),n()},id:"utrPredictiveAccuracy",intent:"is-info",location:Ht,text:"UTR %",hide:!0}],h=document.getElementById(X6);e.elements=eo({table:r,target:h,items:f})?.elements}function EIt({table:t,matchUpFilters:e,data:i}){const r=o=>o.matchUpType===e.get("matchUpTypeFilter"),n=o=>{t?.removeFilter(r),e.set("matchUpTypeFilter",o),o&&t?.addFilter(r)},a={label:`<span style='font-weight: bold'>${mbe}</span>`,onClick:()=>n(),close:!0},s=i.reduce((o,l)=>(o.includes(l.matchUpType)||o.push(l.matchUpType),o),[]);return[a,{divider:!0},s.includes(Hae)&&{label:"Singles",close:!0,onClick:()=>n(Hae)},s.includes(Vae)&&{label:"Doubles",close:!0,onClick:()=>n(Vae)},s.includes($ae)&&{label:"Team",close:!0,onClick:()=>n($ae)}].filter(Boolean)}function DIt({table:t,matchUpFilters:e,statsPanel:i}){const r=Ge.getParticipants({participantFilters:{participantTypes:[TIt]}}).participants||[],n=Object.assign({},...r.map(l=>({[l.participantId]:l.individualParticipantIds}))),a=l=>l.individualParticipantIds.some(c=>n[e.get("teamIdFilter")]?.includes(c)),s=l=>{if(e.get("teamIdFilter")&&t?.removeFilter(a),e.set("teamIdFilter",l),l){t?.addFilter(a);const{teamStats:c}=Ge.getParticipantStats({teamParticipantId:l});if(c?.participantName){i.style.display="";const u=AO({participantName:c.participantName,justify:"end"}),d=AO({participantName:"Opponents",justify:"start"}),p=[{side1Score:c.matchUps[0],side2Score:c.matchUps[1]}],f=gO({sets:p,sideNumber:1}),h=gO({sets:p,sideNumber:2});fo(i),i.appendChild(jNe({side1:u,side2:d,side1Score:f,side2Score:h}))}}else i.style.display=jt};return[{label:`<span style='font-weight: bold'>${hbe}</span>`,onClick:()=>s(),close:!0},{divider:!0}].concat(r.sort((l,c)=>l?.participantName?.localeCompare(c?.participantName)).map(l=>({onClick:()=>s(l.participantId),label:l.participantName,close:!0})))}function PIt({matchUpFilters:t,table:e}){const i=a=>{const s=t.get("matchUpStatusFilter");if(s==="readyToScore")return a.scoreDetail.readyToScore&&!a.scoreDetail.score&&!a.scoreDetail.winningSide;if(s==="complete")return a.scoreDetail.winningSide||["DOUBLE_WALKOVER","DOUBLE_DEFAULT","CANCELLED","ABANDONED"].includes(a.scoreDetail.matchUpStatus)},r=a=>{e?.removeFilter(i),t.set("matchUpStatusFilter",a),a&&e?.addFilter(i)};return[{label:`<span style='font-weight: bold'>${fbe}</span>`,onClick:()=>r(),close:!0},{divider:!0},{label:"Ready to score",close:!0,onClick:()=>r("readyToScore")},{label:"Complete",close:!0,onClick:()=>r("complete")}]}function RIt({matchUpFilters:t,events:e,table:i}){const r=l=>l.drawId===t.get("drawIdFilter"),n=l=>{i?.removeFilter(r),t.set("drawIdFilter",l),l&&i?.addFilter(r)},a={label:`<span style='font-weight: bold'>${SP}</span>`,onClick:()=>n(),close:!0},s=l=>l.drawDefinitions?.map(({drawId:c,drawName:u})=>({onClick:()=>n(c),label:u,close:!0})),o=[a,{divider:!0}].concat(e.flatMap(s)).filter(Boolean);return{flightFilter:r,flightOptions:o,allFlights:a,mapFlightOptions:s}}function MIt({matchUpFilters:t,table:e,events:i,components:r}){const n=o=>o.eventId===t.get("eventIdFilter"),a=o=>{if(e?.removeFilter(n),t.set("eventIdFilter",o),e?.removeFilter(r.options.flight.flightFilter),t.set("drawIdFilter",void 0),o){e?.addFilter(n),r.options.flight.flightOptions=[r.options.flight.allFlights,{divider:!0}].concat(r.options.flight.mapFlightOptions(i.find(u=>o===u.eventId))).filter(Boolean);const l={options:r.options.flight.flightOptions,label:SP,id:"flightOptions",modifyLabel:!0,selection:!0},c=T3({button:l});r.elements.flightOptions.replaceWith(c),r.elements.flightOptions=c,r.elements.flightOptions.style.display=r.options.flight.flightOptions.length<3?jt:""}else r.elements.flightOptions.style.display=jt};return[{label:`<span style='font-weight: bold'>${yg}</span>`,onClick:()=>a(),close:!0},{divider:!0}].concat(i.map(o=>({onClick:()=>a(o.eventId),label:o.eventName,close:!0})))}function NIt(){const t=Ge.getTournamentInfo().tournamentInfo;if(t?.timeItemValues?.TMX?.offline){const n=document.getElementById("dnav");n&&(n.style.backgroundColor="lightyellow")}const i=document.getElementById("provider");i&&(i.onclick=()=>ot.router.navigate("/tournaments"));const r=document.getElementById("pageTitle");r&&t?.tournamentName?(fo(r),r.innerHTML=`<div class='tmx-title'>${t?.tournamentName}</div>`):ot.router.navigate("/tournaments")}function lBe(t){const{venueName:e,venueAbbreviation:i,addresses:r,venueId:n,courts:a}=t;return{hasLocation:r?.[0]?.longitude,courtsCount:a?.length||0,scheduledMatchUpsCount:0,address:r?.[0],availableTime:"",venueAbbreviation:i,venueName:e,venueId:n,courts:a,venue:t}}const{surfaceConstants:BIt}=Qn,MB="------------";function kIt({court:t,callback:e}={}){const i={courtName:t?.courtName||"",indoorOutdoor:t?.indoorOutdoor||"",surfaceType:t?.surfaceType||""},r=()=>{},a=[{control:"courtName",onInput:({inputs:d})=>{const p=!!fi.nameValidator(1)(d.courtName.value),f=document.getElementById("saveCourtButton");f&&(f.disabled=!p)}}],s=Object.values(BIt).map(d=>({value:d,label:d.charAt(0)+d.slice(1).toLowerCase(),selected:i.surfaceType===d}));s.unshift({value:"",label:MB,selected:!i.surfaceType});const o=d=>Sr(d,[{error:"minimum of 1 character",validator:fi.nameValidator(1),placeholder:"Court name",value:i.courtName,onChange:r,selectOnFocus:!0,label:"Court name",field:"courtName",focus:!0},{label:"In / Out",field:"indoorOutdoor",value:i.indoorOutdoor,onChange:r,options:[{value:"",label:MB,selected:!i.indoorOutdoor},{value:"INDOOR",label:"Indoor",selected:i.indoorOutdoor==="INDOOR"},{value:"OUTDOOR",label:"Outdoor",selected:i.indoorOutdoor==="OUTDOOR"}]},{label:"Surface",field:"surfaceType",value:i.surfaceType,onChange:r,options:s}],a),l=()=>{const d=ot.drawer.attributes.content.courtName.value,p=ot.drawer.attributes.content.indoorOutdoor.value,f=ot.drawer.attributes.content.surfaceType.value;if(!d||d.length<1){Pt({message:"Court name must be at least 1 character",intent:"is-danger"});return}const h={courtName:d};p&&p!==MB&&p!==""?h.indoorOutdoor=p:h.indoorOutdoor=void 0,f&&f!==MB&&f!==""?h.surfaceType=f:h.surfaceType=void 0;const m=v=>{v.success?Mt(e)&&e({...v,courtUpdates:h}):v.error&&(Pt({intent:"is-warning",message:v.error?.message||"Error"}),Mt(e)&&e(v))},A=t.courtId;Nt({methods:[{method:cZ,params:{courtId:A,modifications:h}}],callback:m})},c=()=>{const d=ot.drawer.attributes.content.courtName.value;return d&&d.length>=1},u=(d,p)=>uv(d,[{label:"Cancel",close:!0},{onClick:l,id:"saveCourtButton",intent:"is-info",disabled:!c(),label:"Save",close:!0}],p);ot.drawer.open({title:"<b style='larger'>Edit court</b>",width:"300px",side:Ht,content:o,footer:u})}const xIt=()=>(t,e)=>{const i=Array.from(document.querySelectorAll(".tippy-content"));if(i.length){i.forEach(l=>l.remove());return}const r=t.target.getElementsByClassName("fa-ellipsis-vertical")[0],n=e.getRow(),a=n?.getData(),s=({success:l})=>{if(l){const{venues:c}=Jd.getVenuesAndCourts();let u=null;for(const d of c){const p=d.courts?.find(f=>f.courtId===a.courtId);if(p){u=p;break}}u&&(Object.assign(a,u),n.update(a))}};nl({items:[{onClick:()=>kIt({court:a,callback:s}),text:"Edit"}],target:r||t.target,config:{placement:wd}})};function _It(t){return t.getValue()?'<i class="fa-solid fa-check" style="color: green"></i>':'<i class="fa-solid fa-xmark"></i>'}function OIt(){return[{cellClick:(t,e)=>e.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ii,width:5},{headerMenu:TA({floodlit:"Lights"}),formatter:"rownum",headerSort:!1,hozAlign:si,width:55},{title:"Court Name",field:"courtName",editor:!0},{title:"Scheduled Time",field:"scheduledTime"},{title:"Unscheduled Time",field:"unscheduledTime"},{title:"In/Out",field:"indoorOutdoor"},{title:"Surface",field:"surfaceType"},{title:'<i class="fa-regular fa-lightbulb"></i>',formatter:_It,headerTooltip:"Lights",field:"floodlit",width:50},{cellClick:xIt(),formatter:dv,responsive:!1,headerSort:!1,hozAlign:Ht,width:50}]}const FIt=t=>e=>{const i=document.createElement("div"),r=document.createElement("div");r.className="tableControl",r.style.marginBottom="1em";const n=[{label:"Delete selected",intent:"is-danger",stateChange:!0,location:sa},{label:"Add courts",location:Ht,align:Ht}];i.appendChild(r);const a="1px solid #333",s=document.createElement("div");s.style.backgroundColor="white",s.style.border=a,s.style.width="99%",i.className=o2,i.style.display=jt,i.style.boxSizing="border-box",i.style.paddingLeft="10px",i.style.borderTop=a,i.style.borderBottom=a,i.appendChild(s),e.getElement().appendChild(i);const o=OIt(),l=new es(s,{headerSortElement:kf(["courtName","scheduledTime","unscheduledTime","floodlit","surfaceType","indoorOutdoor"]),data:e.getData().courts,placeholder:"No courts",layout:"fitColumns",index:"courtId",maxHeight:400,columns:o}),c=e.getData().venueId;t(c,l),eo({table:l,target:r,items:n}),l.on("scrollVertical",Kd),l.on("cellEdited",u=>{const d=u.getRow().getData(),p=u.getValue();if(p.length){const f=m=>{m.success?console.log("success",{result:m}):console.log({result:m})},h=[{method:cZ,params:{courtId:d.courtId,modifications:{courtName:p}}}];Nt({methods:h,callback:f})}else console.log("INVALID VALUE")})};function LIt({venue:t,callback:e}={}){const i={venueName:t?.venueName||"",venueAbbreviation:t?.venueAbbreviation||"",updateCourtNames:!1},{venue:r}=Ge.findVenue({venueId:t.venueId}),n=r?.courts||[],a=()=>{},s=({inputs:p})=>{const f=!!(fi.nameValidator(2,6)(p.venueAbbreviation.value)&&fi.nameValidator(5)(p.venueName.value)),h=document.getElementById("saveVenueButton");h&&(h.disabled=!f)},o=[{control:"venueAbbreviation",onInput:s},{control:"venueName",onInput:s}],l=p=>Sr(p,[{error:"minimum of 5 characters",validator:fi.nameValidator(5),placeholder:"Venue name",value:i.venueName,onChange:a,selectOnFocus:!0,label:"Venue name",field:"venueName",focus:!0},{error:"minimum of 2 characters, maximum of 6",validator:fi.nameValidator(2,6),placeholder:"Abbreviation",value:i.venueAbbreviation,onChange:a,selectOnFocus:!0,label:"Abbreviation",field:"venueAbbreviation"},{label:"Update court names",field:"updateCourtNames",id:"updateCourtNames",checkbox:!0,checked:i.updateCourtNames}],o),c=()=>{const p=ot.drawer.attributes.content.venueName.value,f=ot.drawer.attributes.content.venueAbbreviation.value,h=ot.drawer.attributes.content.updateCourtNames.checked;if(!p||p.length<5){Pt({message:"Venue name must be at least 5 characters",intent:"is-danger"});return}if(!f||f.length<2||f.length>6){Pt({message:"Abbreviation must be 2-6 characters",intent:"is-danger"});return}const m={venueName:p,venueAbbreviation:f},A=f!==t.venueAbbreviation;h&&A&&n.length>0&&(m.courts=n.map((I,w)=>({courtId:I.courtId,courtName:`${f} ${w+1}`})));const g=h&&A&&n.length>0,v=I=>{I.success?Mt(e)&&e({...I,venueUpdates:m,courtsUpdated:g}):I.error&&(Pt({intent:"is-warning",message:I.error?.message||"Error"}),Mt(e)&&e(I))},b=t.venueId;Nt({methods:[{method:rMe,params:{venueId:b,modifications:m}}],callback:v})},u=()=>{const p=ot.drawer.attributes.content.venueName.value,f=ot.drawer.attributes.content.venueAbbreviation.value;return p&&p.length>=5&&f&&f.length>=2&&f.length<=6},d=(p,f)=>uv(p,[{label:"Cancel",close:!0},{onClick:c,id:"saveVenueButton",intent:"is-info",disabled:!u(),label:"Save",close:!0}],f);ot.drawer.open({title:"<b style='larger'>Edit venue</b>",width:"300px",side:Ht,content:l,footer:d})}const $It=t=>(e,i)=>{const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(u=>u.remove());return}const n=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],a=i.getRow().getData(),s=i.getRow(),o=s?.getData(),l=({success:u,venueUpdates:d,courtsUpdated:p})=>{if(u&&(Object.assign(o,d),s.update(o),p)){const f=t.get(a.venueId);if(f){const{venue:h}=Ge.findVenue({venueId:a.venueId});h?.courts&&h.courts.forEach(m=>{f.updateData([m])})}}};nl({items:[{onClick:()=>LIt({venue:a,callback:l}),text:"Edit"}],target:n||e.target,config:{placement:wd}})},GZ=/[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?)\s*,\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/;function HIt(t){const e=t.split("/");if(e[2]==="www.openstreetmap.org"){const i=e.slice(4).join(",");return GZ.test(i)?{latitude:e[4],longitude:e[5]}:{}}return{}}function VIt(t){const r=t.split("/").reduce((s,o)=>o&&o[0]==="@"?o:s,void 0)?.split(","),n=r?.[0].slice(1),a=r?.[1];return{latitude:n,longitude:a}}function GIt(t){const e=t.split(",");return GZ.test(t)?{latitude:e[0],longitude:e[1]}:{}}function QIt(t){const e=t.split("=");if(e.length>1){const i=e[1].split(","),r=[i[0],i[1]].join(",");return GZ.test(r)?{latitude:i[0],longitude:i[1]}:{}}return{}}function jIt(t){return Object.assign({},...Object.keys(t).map(e=>({[e]:{id:t[e],element:document.getElementById(t[e])}})))}var FD={exports:{}};var zIt=FD.exports,Gae;function qIt(){return Gae||(Gae=1,(function(t,e){(function(i,r){r(e)})(zIt,(function(i){var r="1.9.4";function n(U){var B,H,K,re;for(H=1,K=arguments.length;H<K;H++){re=arguments[H];for(B in re)U[B]=re[B]}return U}var a=Object.create||(function(){function U(){}return function(B){return U.prototype=B,new U}})();function s(U,B){var H=Array.prototype.slice;if(U.bind)return U.bind.apply(U,H.call(arguments,1));var K=H.call(arguments,2);return function(){return U.apply(B,K.length?K.concat(H.call(arguments)):arguments)}}var o=0;function l(U){return"_leaflet_id"in U||(U._leaflet_id=++o),U._leaflet_id}function c(U,B,H){var K,re,fe,Ue;return Ue=function(){K=!1,re&&(fe.apply(H,re),re=!1)},fe=function(){K?re=arguments:(U.apply(H,arguments),setTimeout(Ue,B),K=!0)},fe}function u(U,B,H){var K=B[1],re=B[0],fe=K-re;return U===K&&H?U:((U-re)%fe+fe)%fe+re}function d(){return!1}function p(U,B){if(B===!1)return U;var H=Math.pow(10,B===void 0?6:B);return Math.round(U*H)/H}function f(U){return U.trim?U.trim():U.replace(/^\s+|\s+$/g,"")}function h(U){return f(U).split(/\s+/)}function m(U,B){Object.prototype.hasOwnProperty.call(U,"options")||(U.options=U.options?a(U.options):{});for(var H in B)U.options[H]=B[H];return U.options}function A(U,B,H){var K=[];for(var re in U)K.push(encodeURIComponent(H?re.toUpperCase():re)+"="+encodeURIComponent(U[re]));return(!B||B.indexOf("?")===-1?"?":"&")+K.join("&")}var g=/\{ *([\w_ -]+) *\}/g;function v(U,B){return U.replace(g,function(H,K){var re=B[K];if(re===void 0)throw new Error("No value provided for variable "+H);return typeof re=="function"&&(re=re(B)),re})}var b=Array.isArray||function(U){return Object.prototype.toString.call(U)==="[object Array]"};function y(U,B){for(var H=0;H<U.length;H++)if(U[H]===B)return H;return-1}var I="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function w(U){return window["webkit"+U]||window["moz"+U]||window["ms"+U]}var S=0;function T(U){var B=+new Date,H=Math.max(0,16-(B-S));return S=B+H,window.setTimeout(U,H)}var D=window.requestAnimationFrame||w("RequestAnimationFrame")||T,C=window.cancelAnimationFrame||w("CancelAnimationFrame")||w("CancelRequestAnimationFrame")||function(U){window.clearTimeout(U)};function E(U,B,H){if(H&&D===T)U.call(B);else return D.call(window,s(U,B))}function P(U){U&&C.call(window,U)}var R={__proto__:null,extend:n,create:a,bind:s,get lastId(){return o},stamp:l,throttle:c,wrapNum:u,falseFn:d,formatNum:p,trim:f,splitWords:h,setOptions:m,getParamString:A,template:v,isArray:b,indexOf:y,emptyImageUrl:I,requestFn:D,cancelFn:C,requestAnimFrame:E,cancelAnimFrame:P};function M(){}M.extend=function(U){var B=function(){m(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},H=B.__super__=this.prototype,K=a(H);K.constructor=B,B.prototype=K;for(var re in this)Object.prototype.hasOwnProperty.call(this,re)&&re!=="prototype"&&re!=="__super__"&&(B[re]=this[re]);return U.statics&&n(B,U.statics),U.includes&&(N(U.includes),n.apply(null,[K].concat(U.includes))),n(K,U),delete K.statics,delete K.includes,K.options&&(K.options=H.options?a(H.options):{},n(K.options,U.options)),K._initHooks=[],K.callInitHooks=function(){if(!this._initHooksCalled){H.callInitHooks&&H.callInitHooks.call(this),this._initHooksCalled=!0;for(var fe=0,Ue=K._initHooks.length;fe<Ue;fe++)K._initHooks[fe].call(this)}},B},M.include=function(U){var B=this.prototype.options;return n(this.prototype,U),U.options&&(this.prototype.options=B,this.mergeOptions(U.options)),this},M.mergeOptions=function(U){return n(this.prototype.options,U),this},M.addInitHook=function(U){var B=Array.prototype.slice.call(arguments,1),H=typeof U=="function"?U:function(){this[U].apply(this,B)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(H),this};function N(U){if(!(typeof L>"u"||!L||!L.Mixin)){U=b(U)?U:[U];for(var B=0;B<U.length;B++)U[B]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var k={on:function(U,B,H){if(typeof U=="object")for(var K in U)this._on(K,U[K],B);else{U=h(U);for(var re=0,fe=U.length;re<fe;re++)this._on(U[re],B,H)}return this},off:function(U,B,H){if(!arguments.length)delete this._events;else if(typeof U=="object")for(var K in U)this._off(K,U[K],B);else{U=h(U);for(var re=arguments.length===1,fe=0,Ue=U.length;fe<Ue;fe++)re?this._off(U[fe]):this._off(U[fe],B,H)}return this},_on:function(U,B,H,K){if(typeof B!="function"){console.warn("wrong listener type: "+typeof B);return}if(this._listens(U,B,H)===!1){H===this&&(H=void 0);var re={fn:B,ctx:H};K&&(re.once=!0),this._events=this._events||{},this._events[U]=this._events[U]||[],this._events[U].push(re)}},_off:function(U,B,H){var K,re,fe;if(this._events&&(K=this._events[U],!!K)){if(arguments.length===1){if(this._firingCount)for(re=0,fe=K.length;re<fe;re++)K[re].fn=d;delete this._events[U];return}if(typeof B!="function"){console.warn("wrong listener type: "+typeof B);return}var Ue=this._listens(U,B,H);if(Ue!==!1){var Qe=K[Ue];this._firingCount&&(Qe.fn=d,this._events[U]=K=K.slice()),K.splice(Ue,1)}}},fire:function(U,B,H){if(!this.listens(U,H))return this;var K=n({},B,{type:U,target:this,sourceTarget:B&&B.sourceTarget||this});if(this._events){var re=this._events[U];if(re){this._firingCount=this._firingCount+1||1;for(var fe=0,Ue=re.length;fe<Ue;fe++){var Qe=re[fe],Ye=Qe.fn;Qe.once&&this.off(U,Ye,Qe.ctx),Ye.call(Qe.ctx||this,K)}this._firingCount--}}return H&&this._propagateEvent(K),this},listens:function(U,B,H,K){typeof U!="string"&&console.warn('"string" type argument expected');var re=B;typeof B!="function"&&(K=!!B,re=void 0,H=void 0);var fe=this._events&&this._events[U];if(fe&&fe.length&&this._listens(U,re,H)!==!1)return!0;if(K){for(var Ue in this._eventParents)if(this._eventParents[Ue].listens(U,B,H,K))return!0}return!1},_listens:function(U,B,H){if(!this._events)return!1;var K=this._events[U]||[];if(!B)return!!K.length;H===this&&(H=void 0);for(var re=0,fe=K.length;re<fe;re++)if(K[re].fn===B&&K[re].ctx===H)return re;return!1},once:function(U,B,H){if(typeof U=="object")for(var K in U)this._on(K,U[K],B,!0);else{U=h(U);for(var re=0,fe=U.length;re<fe;re++)this._on(U[re],B,H,!0)}return this},addEventParent:function(U){return this._eventParents=this._eventParents||{},this._eventParents[l(U)]=U,this},removeEventParent:function(U){return this._eventParents&&delete this._eventParents[l(U)],this},_propagateEvent:function(U){for(var B in this._eventParents)this._eventParents[B].fire(U.type,n({layer:U.target,propagatedFrom:U.target},U),!0)}};k.addEventListener=k.on,k.removeEventListener=k.clearAllEventListeners=k.off,k.addOneTimeEventListener=k.once,k.fireEvent=k.fire,k.hasEventListeners=k.listens;var O=M.extend(k);function x(U,B,H){this.x=H?Math.round(U):U,this.y=H?Math.round(B):B}var F=Math.trunc||function(U){return U>0?Math.floor(U):Math.ceil(U)};x.prototype={clone:function(){return new x(this.x,this.y)},add:function(U){return this.clone()._add(_(U))},_add:function(U){return this.x+=U.x,this.y+=U.y,this},subtract:function(U){return this.clone()._subtract(_(U))},_subtract:function(U){return this.x-=U.x,this.y-=U.y,this},divideBy:function(U){return this.clone()._divideBy(U)},_divideBy:function(U){return this.x/=U,this.y/=U,this},multiplyBy:function(U){return this.clone()._multiplyBy(U)},_multiplyBy:function(U){return this.x*=U,this.y*=U,this},scaleBy:function(U){return new x(this.x*U.x,this.y*U.y)},unscaleBy:function(U){return new x(this.x/U.x,this.y/U.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=F(this.x),this.y=F(this.y),this},distanceTo:function(U){U=_(U);var B=U.x-this.x,H=U.y-this.y;return Math.sqrt(B*B+H*H)},equals:function(U){return U=_(U),U.x===this.x&&U.y===this.y},contains:function(U){return U=_(U),Math.abs(U.x)<=Math.abs(this.x)&&Math.abs(U.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}};function _(U,B,H){return U instanceof x?U:b(U)?new x(U[0],U[1]):U==null?U:typeof U=="object"&&"x"in U&&"y"in U?new x(U.x,U.y):new x(U,B,H)}function V(U,B){if(U)for(var H=B?[U,B]:U,K=0,re=H.length;K<re;K++)this.extend(H[K])}V.prototype={extend:function(U){var B,H;if(!U)return this;if(U instanceof x||typeof U[0]=="number"||"x"in U)B=H=_(U);else if(U=G(U),B=U.min,H=U.max,!B||!H)return this;return!this.min&&!this.max?(this.min=B.clone(),this.max=H.clone()):(this.min.x=Math.min(B.x,this.min.x),this.max.x=Math.max(H.x,this.max.x),this.min.y=Math.min(B.y,this.min.y),this.max.y=Math.max(H.y,this.max.y)),this},getCenter:function(U){return _((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,U)},getBottomLeft:function(){return _(this.min.x,this.max.y)},getTopRight:function(){return _(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(U){var B,H;return typeof U[0]=="number"||U instanceof x?U=_(U):U=G(U),U instanceof V?(B=U.min,H=U.max):B=H=U,B.x>=this.min.x&&H.x<=this.max.x&&B.y>=this.min.y&&H.y<=this.max.y},intersects:function(U){U=G(U);var B=this.min,H=this.max,K=U.min,re=U.max,fe=re.x>=B.x&&K.x<=H.x,Ue=re.y>=B.y&&K.y<=H.y;return fe&&Ue},overlaps:function(U){U=G(U);var B=this.min,H=this.max,K=U.min,re=U.max,fe=re.x>B.x&&K.x<H.x,Ue=re.y>B.y&&K.y<H.y;return fe&&Ue},isValid:function(){return!!(this.min&&this.max)},pad:function(U){var B=this.min,H=this.max,K=Math.abs(B.x-H.x)*U,re=Math.abs(B.y-H.y)*U;return G(_(B.x-K,B.y-re),_(H.x+K,H.y+re))},equals:function(U){return U?(U=G(U),this.min.equals(U.getTopLeft())&&this.max.equals(U.getBottomRight())):!1}};function G(U,B){return!U||U instanceof V?U:new V(U,B)}function z(U,B){if(U)for(var H=B?[U,B]:U,K=0,re=H.length;K<re;K++)this.extend(H[K])}z.prototype={extend:function(U){var B=this._southWest,H=this._northEast,K,re;if(U instanceof j)K=U,re=U;else if(U instanceof z){if(K=U._southWest,re=U._northEast,!K||!re)return this}else return U?this.extend(W(U)||Q(U)):this;return!B&&!H?(this._southWest=new j(K.lat,K.lng),this._northEast=new j(re.lat,re.lng)):(B.lat=Math.min(K.lat,B.lat),B.lng=Math.min(K.lng,B.lng),H.lat=Math.max(re.lat,H.lat),H.lng=Math.max(re.lng,H.lng)),this},pad:function(U){var B=this._southWest,H=this._northEast,K=Math.abs(B.lat-H.lat)*U,re=Math.abs(B.lng-H.lng)*U;return new z(new j(B.lat-K,B.lng-re),new j(H.lat+K,H.lng+re))},getCenter:function(){return new j((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new j(this.getNorth(),this.getWest())},getSouthEast:function(){return new j(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(U){typeof U[0]=="number"||U instanceof j||"lat"in U?U=W(U):U=Q(U);var B=this._southWest,H=this._northEast,K,re;return U instanceof z?(K=U.getSouthWest(),re=U.getNorthEast()):K=re=U,K.lat>=B.lat&&re.lat<=H.lat&&K.lng>=B.lng&&re.lng<=H.lng},intersects:function(U){U=Q(U);var B=this._southWest,H=this._northEast,K=U.getSouthWest(),re=U.getNorthEast(),fe=re.lat>=B.lat&&K.lat<=H.lat,Ue=re.lng>=B.lng&&K.lng<=H.lng;return fe&&Ue},overlaps:function(U){U=Q(U);var B=this._southWest,H=this._northEast,K=U.getSouthWest(),re=U.getNorthEast(),fe=re.lat>B.lat&&K.lat<H.lat,Ue=re.lng>B.lng&&K.lng<H.lng;return fe&&Ue},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(U,B){return U?(U=Q(U),this._southWest.equals(U.getSouthWest(),B)&&this._northEast.equals(U.getNorthEast(),B)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Q(U,B){return U instanceof z?U:new z(U,B)}function j(U,B,H){if(isNaN(U)||isNaN(B))throw new Error("Invalid LatLng object: ("+U+", "+B+")");this.lat=+U,this.lng=+B,H!==void 0&&(this.alt=+H)}j.prototype={equals:function(U,B){if(!U)return!1;U=W(U);var H=Math.max(Math.abs(this.lat-U.lat),Math.abs(this.lng-U.lng));return H<=(B===void 0?1e-9:B)},toString:function(U){return"LatLng("+p(this.lat,U)+", "+p(this.lng,U)+")"},distanceTo:function(U){return X.distance(this,W(U))},wrap:function(){return X.wrapLatLng(this)},toBounds:function(U){var B=180*U/40075017,H=B/Math.cos(Math.PI/180*this.lat);return Q([this.lat-B,this.lng-H],[this.lat+B,this.lng+H])},clone:function(){return new j(this.lat,this.lng,this.alt)}};function W(U,B,H){return U instanceof j?U:b(U)&&typeof U[0]!="object"?U.length===3?new j(U[0],U[1],U[2]):U.length===2?new j(U[0],U[1]):null:U==null?U:typeof U=="object"&&"lat"in U?new j(U.lat,"lng"in U?U.lng:U.lon,U.alt):B===void 0?null:new j(U,B,H)}var Y={latLngToPoint:function(U,B){var H=this.projection.project(U),K=this.scale(B);return this.transformation._transform(H,K)},pointToLatLng:function(U,B){var H=this.scale(B),K=this.transformation.untransform(U,H);return this.projection.unproject(K)},project:function(U){return this.projection.project(U)},unproject:function(U){return this.projection.unproject(U)},scale:function(U){return 256*Math.pow(2,U)},zoom:function(U){return Math.log(U/256)/Math.LN2},getProjectedBounds:function(U){if(this.infinite)return null;var B=this.projection.bounds,H=this.scale(U),K=this.transformation.transform(B.min,H),re=this.transformation.transform(B.max,H);return new V(K,re)},infinite:!1,wrapLatLng:function(U){var B=this.wrapLng?u(U.lng,this.wrapLng,!0):U.lng,H=this.wrapLat?u(U.lat,this.wrapLat,!0):U.lat,K=U.alt;return new j(H,B,K)},wrapLatLngBounds:function(U){var B=U.getCenter(),H=this.wrapLatLng(B),K=B.lat-H.lat,re=B.lng-H.lng;if(K===0&&re===0)return U;var fe=U.getSouthWest(),Ue=U.getNorthEast(),Qe=new j(fe.lat-K,fe.lng-re),Ye=new j(Ue.lat-K,Ue.lng-re);return new z(Qe,Ye)}},X=n({},Y,{wrapLng:[-180,180],R:6371e3,distance:function(U,B){var H=Math.PI/180,K=U.lat*H,re=B.lat*H,fe=Math.sin((B.lat-U.lat)*H/2),Ue=Math.sin((B.lng-U.lng)*H/2),Qe=fe*fe+Math.cos(K)*Math.cos(re)*Ue*Ue,Ye=2*Math.atan2(Math.sqrt(Qe),Math.sqrt(1-Qe));return this.R*Ye}}),J=6378137,ie={R:J,MAX_LATITUDE:85.0511287798,project:function(U){var B=Math.PI/180,H=this.MAX_LATITUDE,K=Math.max(Math.min(H,U.lat),-H),re=Math.sin(K*B);return new x(this.R*U.lng*B,this.R*Math.log((1+re)/(1-re))/2)},unproject:function(U){var B=180/Math.PI;return new j((2*Math.atan(Math.exp(U.y/this.R))-Math.PI/2)*B,U.x*B/this.R)},bounds:(function(){var U=J*Math.PI;return new V([-U,-U],[U,U])})()};function ue(U,B,H,K){if(b(U)){this._a=U[0],this._b=U[1],this._c=U[2],this._d=U[3];return}this._a=U,this._b=B,this._c=H,this._d=K}ue.prototype={transform:function(U,B){return this._transform(U.clone(),B)},_transform:function(U,B){return B=B||1,U.x=B*(this._a*U.x+this._b),U.y=B*(this._c*U.y+this._d),U},untransform:function(U,B){return B=B||1,new x((U.x/B-this._b)/this._a,(U.y/B-this._d)/this._c)}};function ne(U,B,H,K){return new ue(U,B,H,K)}var ge=n({},X,{code:"EPSG:3857",projection:ie,transformation:(function(){var U=.5/(Math.PI*ie.R);return ne(U,.5,-U,.5)})()}),he=n({},ge,{code:"EPSG:900913"});function Ie(U){return document.createElementNS("http://www.w3.org/2000/svg",U)}function xe(U,B){var H="",K,re,fe,Ue,Qe,Ye;for(K=0,fe=U.length;K<fe;K++){for(Qe=U[K],re=0,Ue=Qe.length;re<Ue;re++)Ye=Qe[re],H+=(re?"L":"M")+Ye.x+" "+Ye.y;H+=B?ti.svg?"z":"x":""}return H||"M0 0"}var Je=document.documentElement.style,qe="ActiveXObject"in window,dt=qe&&!document.addEventListener,ft="msLaunchUri"in navigator&&!("documentMode"in document),je=Ta("webkit"),Tt=Ta("android"),Oe=Ta("android 2")||Ta("android 3"),mt=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Le=Tt&&Ta("Google")&&mt<537&&!("AudioNode"in window),lt=!!window.opera,it=!ft&&Ta("chrome"),Fe=Ta("gecko")&&!je&&!lt&&!qe,Xe=!it&&Ta("safari"),ct=Ta("phantom"),We="OTransition"in Je,ht=navigator.platform.indexOf("Win")===0,xt=qe&&"transition"in Je,pe="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Oe,Se="MozPerspective"in Je,ye=!window.L_DISABLE_3D&&(xt||pe||Se)&&!We&&!ct,ke=typeof orientation<"u"||Ta("mobile"),Ce=ke&&je,Ke=ke&&pe,_e=!window.PointerEvent&&window.MSPointerEvent,wt=!!(window.PointerEvent||_e),ut="ontouchstart"in window||!!window.TouchEvent,Ct=!window.L_NO_TOUCH&&(ut||wt),Gi=ke&&lt,Wt=ke&&Fe,Ji=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,$i=(function(){var U=!1;try{var B=Object.defineProperty({},"passive",{get:function(){U=!0}});window.addEventListener("testPassiveEventSupport",d,B),window.removeEventListener("testPassiveEventSupport",d,B)}catch{}return U})(),xi=(function(){return!!document.createElement("canvas").getContext})(),en=!!(document.createElementNS&&Ie("svg").createSVGRect),ra=!!en&&(function(){var U=document.createElement("div");return U.innerHTML="<svg/>",(U.firstChild&&U.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),oc=!en&&(function(){try{var U=document.createElement("div");U.innerHTML='<v:shape adj="1"/>';var B=U.firstChild;return B.style.behavior="url(#default#VML)",B&&typeof B.adj=="object"}catch{return!1}})(),un=navigator.platform.indexOf("Mac")===0,dn=navigator.platform.indexOf("Linux")===0;function Ta(U){return navigator.userAgent.toLowerCase().indexOf(U)>=0}var ti={ie:qe,ielt9:dt,edge:ft,webkit:je,android:Tt,android23:Oe,androidStock:Le,opera:lt,chrome:it,gecko:Fe,safari:Xe,phantom:ct,opera12:We,win:ht,ie3d:xt,webkit3d:pe,gecko3d:Se,any3d:ye,mobile:ke,mobileWebkit:Ce,mobileWebkit3d:Ke,msPointer:_e,pointer:wt,touch:Ct,touchNative:ut,mobileOpera:Gi,mobileGecko:Wt,retina:Ji,passiveEvents:$i,canvas:xi,svg:en,vml:oc,inlineSvg:ra,mac:un,linux:dn},pr=ti.msPointer?"MSPointerDown":"pointerdown",lc=ti.msPointer?"MSPointerMove":"pointermove",xd=ti.msPointer?"MSPointerUp":"pointerup",Ho=ti.msPointer?"MSPointerCancel":"pointercancel",no={touchstart:pr,touchmove:lc,touchend:xd,touchcancel:Ho},ao={touchstart:Tl,touchmove:al,touchend:al,touchcancel:al},Cn={},Gc=!1;function cc(U,B,H){return B==="touchstart"&&Kn(),ao[B]?(H=ao[B].bind(this,H),U.addEventListener(no[B],H,!1),H):(console.warn("wrong event specified:",B),d)}function Jh(U,B,H){if(!no[B]){console.warn("wrong event specified:",B);return}U.removeEventListener(no[B],H,!1)}function Qc(U){Cn[U.pointerId]=U}function xf(U){Cn[U.pointerId]&&(Cn[U.pointerId]=U)}function Ca(U){delete Cn[U.pointerId]}function Kn(){Gc||(document.addEventListener(pr,Qc,!0),document.addEventListener(lc,xf,!0),document.addEventListener(xd,Ca,!0),document.addEventListener(Ho,Ca,!0),Gc=!0)}function al(U,B){if(B.pointerType!==(B.MSPOINTER_TYPE_MOUSE||"mouse")){B.touches=[];for(var H in Cn)B.touches.push(Cn[H]);B.changedTouches=[B],U(B)}}function Tl(U,B){B.MSPOINTER_TYPE_TOUCH&&B.pointerType===B.MSPOINTER_TYPE_TOUCH&&Ga(B),al(U,B)}function em(U){var B={},H,K;for(K in U)H=U[K],B[K]=H&&H.bind?H.bind(U):H;return U=B,B.type="dblclick",B.detail=2,B.isTrusted=!1,B._simulated=!0,B}var uc=200;function dc(U,B){U.addEventListener("dblclick",B);var H=0,K;function re(fe){if(fe.detail!==1){K=fe.detail;return}if(!(fe.pointerType==="mouse"||fe.sourceCapabilities&&!fe.sourceCapabilities.firesTouchEvents)){var Ue=ee(fe);if(!(Ue.some(function(Ye){return Ye instanceof HTMLLabelElement&&Ye.attributes.for})&&!Ue.some(function(Ye){return Ye instanceof HTMLInputElement||Ye instanceof HTMLSelectElement}))){var Qe=Date.now();Qe-H<=uc?(K++,K===2&&B(em(fe))):K=1,H=Qe}}}return U.addEventListener("click",re),{dblclick:B,simDblclick:re}}function vp(U,B){U.removeEventListener("dblclick",B.dblclick),U.removeEventListener("click",B.simDblclick)}var pc=et(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Ea=et(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Bu=Ea==="webkitTransition"||Ea==="OTransition"?Ea+"End":"transitionend";function ku(U){return typeof U=="string"?document.getElementById(U):U}function jc(U,B){var H=U.style[B]||U.currentStyle&&U.currentStyle[B];if((!H||H==="auto")&&document.defaultView){var K=document.defaultView.getComputedStyle(U,null);H=K?K[B]:null}return H==="auto"?null:H}function Xt(U,B,H){var K=document.createElement(U);return K.className=B||"",H&&H.appendChild(K),K}function xn(U){var B=U.parentNode;B&&B.removeChild(U)}function Cl(U){for(;U.firstChild;)U.removeChild(U.firstChild)}function bs(U){var B=U.parentNode;B&&B.lastChild!==U&&B.appendChild(U)}function vo(U){var B=U.parentNode;B&&B.firstChild!==U&&B.insertBefore(U,B.firstChild)}function Hs(U,B){if(U.classList!==void 0)return U.classList.contains(B);var H=fc(U);return H.length>0&&new RegExp("(^|\\s)"+B+"(\\s|$)").test(H)}function Hi(U,B){if(U.classList!==void 0)for(var H=h(B),K=0,re=H.length;K<re;K++)U.classList.add(H[K]);else if(!Hs(U,B)){var fe=fc(U);sn(U,(fe?fe+" ":"")+B)}}function In(U,B){U.classList!==void 0?U.classList.remove(B):sn(U,f((" "+fc(U)+" ").replace(" "+B+" "," ")))}function sn(U,B){U.className.baseVal===void 0?U.className=B:U.className.baseVal=B}function fc(U){return U.correspondingElement&&(U=U.correspondingElement),U.className.baseVal===void 0?U.className:U.className.baseVal}function ls(U,B){"opacity"in U.style?U.style.opacity=B:"filter"in U.style&&_d(U,B)}function _d(U,B){var H=!1,K="DXImageTransform.Microsoft.Alpha";try{H=U.filters.item(K)}catch{if(B===1)return}B=Math.round(B*100),H?(H.Enabled=B!==100,H.Opacity=B):U.style.filter+=" progid:"+K+"(opacity="+B+")"}function et(U){for(var B=document.documentElement.style,H=0;H<U.length;H++)if(U[H]in B)return U[H];return!1}function Ai(U,B,H){var K=B||new x(0,0);U.style[pc]=(ti.ie3d?"translate("+K.x+"px,"+K.y+"px)":"translate3d("+K.x+"px,"+K.y+"px,0)")+(H?" scale("+H+")":"")}function _i(U,B){U._leaflet_pos=B,ti.any3d?Ai(U,B):(U.style.left=B.x+"px",U.style.top=B.y+"px")}function Oi(U){return U._leaflet_pos||new x(0,0)}var wn,Va,zc;if("onselectstart"in document)wn=function(){pi(window,"selectstart",Ga)},Va=function(){Fr(window,"selectstart",Ga)};else{var Ur=et(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);wn=function(){if(Ur){var U=document.documentElement.style;zc=U[Ur],U[Ur]="none"}},Va=function(){Ur&&(document.documentElement.style[Ur]=zc,zc=void 0)}}function El(){pi(window,"dragstart",Ga)}function RA(){Fr(window,"dragstart",Ga)}var tm,so;function xu(U){for(;U.tabIndex===-1;)U=U.parentNode;U.style&&(_u(),tm=U,so=U.style.outlineStyle,U.style.outlineStyle="none",pi(window,"keydown",_u))}function _u(){tm&&(tm.style.outlineStyle=so,tm=void 0,so=void 0,Fr(window,"keydown",_u))}function Da(U){do U=U.parentNode;while((!U.offsetWidth||!U.offsetHeight)&&U!==document.body);return U}function _f(U){var B=U.getBoundingClientRect();return{x:B.width/U.offsetWidth||1,y:B.height/U.offsetHeight||1,boundingClientRect:B}}var MA={__proto__:null,TRANSFORM:pc,TRANSITION:Ea,TRANSITION_END:Bu,get:ku,getStyle:jc,create:Xt,remove:xn,empty:Cl,toFront:bs,toBack:vo,hasClass:Hs,addClass:Hi,removeClass:In,setClass:sn,getClass:fc,setOpacity:ls,testProp:et,setTransform:Ai,setPosition:_i,getPosition:Oi,get disableTextSelection(){return wn},get enableTextSelection(){return Va},disableImageDrag:El,enableImageDrag:RA,preventOutline:xu,restoreOutline:_u,getSizedParentNode:Da,getScale:_f};function pi(U,B,H,K){if(B&&typeof B=="object")for(var re in B)sl(U,re,B[re],H);else{B=h(B);for(var fe=0,Ue=B.length;fe<Ue;fe++)sl(U,B[fe],H,K)}return this}var Pa="_leaflet_events";function Fr(U,B,H,K){if(arguments.length===1)yp(U),delete U[Pa];else if(B&&typeof B=="object")for(var re in B)im(U,re,B[re],H);else if(B=h(B),arguments.length===2)yp(U,function(Qe){return y(B,Qe)!==-1});else for(var fe=0,Ue=B.length;fe<Ue;fe++)im(U,B[fe],H,K);return this}function yp(U,B){for(var H in U[Pa]){var K=H.split(/\d/)[0];(!B||B(K))&&im(U,K,null,null,H)}}var bp={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function sl(U,B,H,K){var re=B+l(H)+(K?"_"+l(K):"");if(U[Pa]&&U[Pa][re])return this;var fe=function(Qe){return H.call(K||U,Qe||window.event)},Ue=fe;!ti.touchNative&&ti.pointer&&B.indexOf("touch")===0?fe=cc(U,B,fe):ti.touch&&B==="dblclick"?fe=dc(U,fe):"addEventListener"in U?B==="touchstart"||B==="touchmove"||B==="wheel"||B==="mousewheel"?U.addEventListener(bp[B]||B,fe,ti.passiveEvents?{passive:!1}:!1):B==="mouseenter"||B==="mouseleave"?(fe=function(Qe){Qe=Qe||window.event,ir(U,Qe)&&Ue(Qe)},U.addEventListener(bp[B],fe,!1)):U.addEventListener(B,Ue,!1):U.attachEvent("on"+B,fe),U[Pa]=U[Pa]||{},U[Pa][re]=fe}function im(U,B,H,K,re){re=re||B+l(H)+(K?"_"+l(K):"");var fe=U[Pa]&&U[Pa][re];if(!fe)return this;!ti.touchNative&&ti.pointer&&B.indexOf("touch")===0?Jh(U,B,fe):ti.touch&&B==="dblclick"?vp(U,fe):"removeEventListener"in U?U.removeEventListener(bp[B]||B,fe,!1):U.detachEvent("on"+B,fe),U[Pa][re]=null}function Yn(U){return U.stopPropagation?U.stopPropagation():U.originalEvent?U.originalEvent._stopped=!0:U.cancelBubble=!0,this}function Ip(U){return sl(U,"wheel",Yn),this}function Ou(U){return pi(U,"mousedown touchstart dblclick contextmenu",Yn),U._leaflet_disable_click=!0,this}function Ga(U){return U.preventDefault?U.preventDefault():U.returnValue=!1,this}function Dl(U){return Ga(U),Yn(U),this}function ee(U){if(U.composedPath)return U.composedPath();for(var B=[],H=U.target;H;)B.push(H),H=H.parentNode;return B}function me(U,B){if(!B)return new x(U.clientX,U.clientY);var H=_f(B),K=H.boundingClientRect;return new x((U.clientX-K.left)/H.x-B.clientLeft,(U.clientY-K.top)/H.y-B.clientTop)}var Te=ti.linux&&ti.chrome?window.devicePixelRatio:ti.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function at(U){return ti.edge?U.wheelDeltaY/2:U.deltaY&&U.deltaMode===0?-U.deltaY/Te:U.deltaY&&U.deltaMode===1?-U.deltaY*20:U.deltaY&&U.deltaMode===2?-U.deltaY*60:U.deltaX||U.deltaZ?0:U.wheelDelta?(U.wheelDeltaY||U.wheelDelta)/2:U.detail&&Math.abs(U.detail)<32765?-U.detail*20:U.detail?U.detail/-32765*60:0}function ir(U,B){var H=B.relatedTarget;if(!H)return!0;try{for(;H&&H!==U;)H=H.parentNode}catch{return!1}return H!==U}var Di={__proto__:null,on:pi,off:Fr,stopPropagation:Yn,disableScrollPropagation:Ip,disableClickPropagation:Ou,preventDefault:Ga,stop:Dl,getPropagationPath:ee,getMousePosition:me,getWheelDelta:at,isExternalTarget:ir,addListener:pi,removeListener:Fr},xr=O.extend({run:function(U,B,H,K){this.stop(),this._el=U,this._inProgress=!0,this._duration=H||.25,this._easeOutPower=1/Math.max(K||.5,.2),this._startPos=Oi(U),this._offset=B.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=E(this._animate,this),this._step()},_step:function(U){var B=+new Date-this._startTime,H=this._duration*1e3;B<H?this._runFrame(this._easeOut(B/H),U):(this._runFrame(1),this._complete())},_runFrame:function(U,B){var H=this._startPos.add(this._offset.multiplyBy(U));B&&H._round(),_i(this._el,H),this.fire("step")},_complete:function(){P(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(U){return 1-Math.pow(1-U,this._easeOutPower)}}),Zt=O.extend({options:{crs:ge,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(U,B){B=m(this,B),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(U),this._initLayout(),this._onResize=s(this._onResize,this),this._initEvents(),B.maxBounds&&this.setMaxBounds(B.maxBounds),B.zoom!==void 0&&(this._zoom=this._limitZoom(B.zoom)),B.center&&B.zoom!==void 0&&this.setView(W(B.center),B.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Ea&&ti.any3d&&!ti.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),pi(this._proxy,Bu,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(U,B,H){if(B=B===void 0?this._zoom:this._limitZoom(B),U=this._limitCenter(W(U),B,this.options.maxBounds),H=H||{},this._stop(),this._loaded&&!H.reset&&H!==!0){H.animate!==void 0&&(H.zoom=n({animate:H.animate},H.zoom),H.pan=n({animate:H.animate,duration:H.duration},H.pan));var K=this._zoom!==B?this._tryAnimatedZoom&&this._tryAnimatedZoom(U,B,H.zoom):this._tryAnimatedPan(U,H.pan);if(K)return clearTimeout(this._sizeTimer),this}return this._resetView(U,B,H.pan&&H.pan.noMoveStart),this},setZoom:function(U,B){return this._loaded?this.setView(this.getCenter(),U,{zoom:B}):(this._zoom=U,this)},zoomIn:function(U,B){return U=U||(ti.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+U,B)},zoomOut:function(U,B){return U=U||(ti.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-U,B)},setZoomAround:function(U,B,H){var K=this.getZoomScale(B),re=this.getSize().divideBy(2),fe=U instanceof x?U:this.latLngToContainerPoint(U),Ue=fe.subtract(re).multiplyBy(1-1/K),Qe=this.containerPointToLatLng(re.add(Ue));return this.setView(Qe,B,{zoom:H})},_getBoundsCenterZoom:function(U,B){B=B||{},U=U.getBounds?U.getBounds():Q(U);var H=_(B.paddingTopLeft||B.padding||[0,0]),K=_(B.paddingBottomRight||B.padding||[0,0]),re=this.getBoundsZoom(U,!1,H.add(K));if(re=typeof B.maxZoom=="number"?Math.min(B.maxZoom,re):re,re===1/0)return{center:U.getCenter(),zoom:re};var fe=K.subtract(H).divideBy(2),Ue=this.project(U.getSouthWest(),re),Qe=this.project(U.getNorthEast(),re),Ye=this.unproject(Ue.add(Qe).divideBy(2).add(fe),re);return{center:Ye,zoom:re}},fitBounds:function(U,B){if(U=Q(U),!U.isValid())throw new Error("Bounds are not valid.");var H=this._getBoundsCenterZoom(U,B);return this.setView(H.center,H.zoom,B)},fitWorld:function(U){return this.fitBounds([[-90,-180],[90,180]],U)},panTo:function(U,B){return this.setView(U,this._zoom,{pan:B})},panBy:function(U,B){if(U=_(U).round(),B=B||{},!U.x&&!U.y)return this.fire("moveend");if(B.animate!==!0&&!this.getSize().contains(U))return this._resetView(this.unproject(this.project(this.getCenter()).add(U)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new xr,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),B.noMoveStart||this.fire("movestart"),B.animate!==!1){Hi(this._mapPane,"leaflet-pan-anim");var H=this._getMapPanePos().subtract(U).round();this._panAnim.run(this._mapPane,H,B.duration||.25,B.easeLinearity)}else this._rawPanBy(U),this.fire("move").fire("moveend");return this},flyTo:function(U,B,H){if(H=H||{},H.animate===!1||!ti.any3d)return this.setView(U,B,H);this._stop();var K=this.project(this.getCenter()),re=this.project(U),fe=this.getSize(),Ue=this._zoom;U=W(U),B=B===void 0?Ue:B;var Qe=Math.max(fe.x,fe.y),Ye=Qe*this.getZoomScale(Ue,B),At=re.distanceTo(K)||1,ai=1.42,rr=ai*ai;function jr(yo){var ZN=yo?-1:1,x_e=yo?Ye:Qe,__e=Ye*Ye-Qe*Qe+ZN*rr*rr*At*At,O_e=2*x_e*rr*At,hV=__e/O_e,VJ=Math.sqrt(hV*hV+1)-hV,F_e=VJ<1e-9?-18:Math.log(VJ);return F_e}function qc(yo){return(Math.exp(yo)-Math.exp(-yo))/2}function ll(yo){return(Math.exp(yo)+Math.exp(-yo))/2}function Tp(yo){return qc(yo)/ll(yo)}var Vu=jr(0);function GS(yo){return Qe*(ll(Vu)/ll(Vu+ai*yo))}function M_e(yo){return Qe*(ll(Vu)*Tp(Vu+ai*yo)-qc(Vu))/rr}function N_e(yo){return 1-Math.pow(1-yo,1.5)}var B_e=Date.now(),$J=(jr(1)-Vu)/ai,k_e=H.duration?1e3*H.duration:1e3*$J*.8;function HJ(){var yo=(Date.now()-B_e)/k_e,ZN=N_e(yo)*$J;yo<=1?(this._flyToFrame=E(HJ,this),this._move(this.unproject(K.add(re.subtract(K).multiplyBy(M_e(ZN)/At)),Ue),this.getScaleZoom(Qe/GS(ZN),Ue),{flyTo:!0})):this._move(U,B)._moveEnd(!0)}return this._moveStart(!0,H.noMoveStart),HJ.call(this),this},flyToBounds:function(U,B){var H=this._getBoundsCenterZoom(U,B);return this.flyTo(H.center,H.zoom,B)},setMaxBounds:function(U){return U=Q(U),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),U.isValid()?(this.options.maxBounds=U,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(U){var B=this.options.minZoom;return this.options.minZoom=U,this._loaded&&B!==U&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(U):this},setMaxZoom:function(U){var B=this.options.maxZoom;return this.options.maxZoom=U,this._loaded&&B!==U&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(U):this},panInsideBounds:function(U,B){this._enforcingBounds=!0;var H=this.getCenter(),K=this._limitCenter(H,this._zoom,Q(U));return H.equals(K)||this.panTo(K,B),this._enforcingBounds=!1,this},panInside:function(U,B){B=B||{};var H=_(B.paddingTopLeft||B.padding||[0,0]),K=_(B.paddingBottomRight||B.padding||[0,0]),re=this.project(this.getCenter()),fe=this.project(U),Ue=this.getPixelBounds(),Qe=G([Ue.min.add(H),Ue.max.subtract(K)]),Ye=Qe.getSize();if(!Qe.contains(fe)){this._enforcingBounds=!0;var At=fe.subtract(Qe.getCenter()),ai=Qe.extend(fe).getSize().subtract(Ye);re.x+=At.x<0?-ai.x:ai.x,re.y+=At.y<0?-ai.y:ai.y,this.panTo(this.unproject(re),B),this._enforcingBounds=!1}return this},invalidateSize:function(U){if(!this._loaded)return this;U=n({animate:!1,pan:!0},U===!0?{animate:!0}:U);var B=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var H=this.getSize(),K=B.divideBy(2).round(),re=H.divideBy(2).round(),fe=K.subtract(re);return!fe.x&&!fe.y?this:(U.animate&&U.pan?this.panBy(fe):(U.pan&&this._rawPanBy(fe),this.fire("move"),U.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(s(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:B,newSize:H}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(U){if(U=this._locateOptions=n({timeout:1e4,watch:!1},U),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var B=s(this._handleGeolocationResponse,this),H=s(this._handleGeolocationError,this);return U.watch?this._locationWatchId=navigator.geolocation.watchPosition(B,H,U):navigator.geolocation.getCurrentPosition(B,H,U),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(U){if(this._container._leaflet_id){var B=U.code,H=U.message||(B===1?"permission denied":B===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:B,message:"Geolocation error: "+H+"."})}},_handleGeolocationResponse:function(U){if(this._container._leaflet_id){var B=U.coords.latitude,H=U.coords.longitude,K=new j(B,H),re=K.toBounds(U.coords.accuracy*2),fe=this._locateOptions;if(fe.setView){var Ue=this.getBoundsZoom(re);this.setView(K,fe.maxZoom?Math.min(Ue,fe.maxZoom):Ue)}var Qe={latlng:K,bounds:re,timestamp:U.timestamp};for(var Ye in U.coords)typeof U.coords[Ye]=="number"&&(Qe[Ye]=U.coords[Ye]);this.fire("locationfound",Qe)}},addHandler:function(U,B){if(!B)return this;var H=this[U]=new B(this);return this._handlers.push(H),this.options[U]&&H.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),xn(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(P(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var U;for(U in this._layers)this._layers[U].remove();for(U in this._panes)xn(this._panes[U]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(U,B){var H="leaflet-pane"+(U?" leaflet-"+U.replace("Pane","")+"-pane":""),K=Xt("div",H,B||this._mapPane);return U&&(this._panes[U]=K),K},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var U=this.getPixelBounds(),B=this.unproject(U.getBottomLeft()),H=this.unproject(U.getTopRight());return new z(B,H)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(U,B,H){U=Q(U),H=_(H||[0,0]);var K=this.getZoom()||0,re=this.getMinZoom(),fe=this.getMaxZoom(),Ue=U.getNorthWest(),Qe=U.getSouthEast(),Ye=this.getSize().subtract(H),At=G(this.project(Qe,K),this.project(Ue,K)).getSize(),ai=ti.any3d?this.options.zoomSnap:1,rr=Ye.x/At.x,jr=Ye.y/At.y,qc=B?Math.max(rr,jr):Math.min(rr,jr);return K=this.getScaleZoom(qc,K),ai&&(K=Math.round(K/(ai/100))*(ai/100),K=B?Math.ceil(K/ai)*ai:Math.floor(K/ai)*ai),Math.max(re,Math.min(fe,K))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new x(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(U,B){var H=this._getTopLeftPoint(U,B);return new V(H,H.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(U){return this.options.crs.getProjectedBounds(U===void 0?this.getZoom():U)},getPane:function(U){return typeof U=="string"?this._panes[U]:U},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(U,B){var H=this.options.crs;return B=B===void 0?this._zoom:B,H.scale(U)/H.scale(B)},getScaleZoom:function(U,B){var H=this.options.crs;B=B===void 0?this._zoom:B;var K=H.zoom(U*H.scale(B));return isNaN(K)?1/0:K},project:function(U,B){return B=B===void 0?this._zoom:B,this.options.crs.latLngToPoint(W(U),B)},unproject:function(U,B){return B=B===void 0?this._zoom:B,this.options.crs.pointToLatLng(_(U),B)},layerPointToLatLng:function(U){var B=_(U).add(this.getPixelOrigin());return this.unproject(B)},latLngToLayerPoint:function(U){var B=this.project(W(U))._round();return B._subtract(this.getPixelOrigin())},wrapLatLng:function(U){return this.options.crs.wrapLatLng(W(U))},wrapLatLngBounds:function(U){return this.options.crs.wrapLatLngBounds(Q(U))},distance:function(U,B){return this.options.crs.distance(W(U),W(B))},containerPointToLayerPoint:function(U){return _(U).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(U){return _(U).add(this._getMapPanePos())},containerPointToLatLng:function(U){var B=this.containerPointToLayerPoint(_(U));return this.layerPointToLatLng(B)},latLngToContainerPoint:function(U){return this.layerPointToContainerPoint(this.latLngToLayerPoint(W(U)))},mouseEventToContainerPoint:function(U){return me(U,this._container)},mouseEventToLayerPoint:function(U){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(U))},mouseEventToLatLng:function(U){return this.layerPointToLatLng(this.mouseEventToLayerPoint(U))},_initContainer:function(U){var B=this._container=ku(U);if(B){if(B._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");pi(B,"scroll",this._onScroll,this),this._containerId=l(B)},_initLayout:function(){var U=this._container;this._fadeAnimated=this.options.fadeAnimation&&ti.any3d,Hi(U,"leaflet-container"+(ti.touch?" leaflet-touch":"")+(ti.retina?" leaflet-retina":"")+(ti.ielt9?" leaflet-oldie":"")+(ti.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var B=jc(U,"position");B!=="absolute"&&B!=="relative"&&B!=="fixed"&&B!=="sticky"&&(U.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var U=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),_i(this._mapPane,new x(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Hi(U.markerPane,"leaflet-zoom-hide"),Hi(U.shadowPane,"leaflet-zoom-hide"))},_resetView:function(U,B,H){_i(this._mapPane,new x(0,0));var K=!this._loaded;this._loaded=!0,B=this._limitZoom(B),this.fire("viewprereset");var re=this._zoom!==B;this._moveStart(re,H)._move(U,B)._moveEnd(re),this.fire("viewreset"),K&&this.fire("load")},_moveStart:function(U,B){return U&&this.fire("zoomstart"),B||this.fire("movestart"),this},_move:function(U,B,H,K){B===void 0&&(B=this._zoom);var re=this._zoom!==B;return this._zoom=B,this._lastCenter=U,this._pixelOrigin=this._getNewPixelOrigin(U),K?H&&H.pinch&&this.fire("zoom",H):((re||H&&H.pinch)&&this.fire("zoom",H),this.fire("move",H)),this},_moveEnd:function(U){return U&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return P(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(U){_i(this._mapPane,this._getMapPanePos().subtract(U))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(U){this._targets={},this._targets[l(this._container)]=this;var B=U?Fr:pi;B(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&B(window,"resize",this._onResize,this),ti.any3d&&this.options.transform3DLimit&&(U?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){P(this._resizeRequest),this._resizeRequest=E(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var U=this._getMapPanePos();Math.max(Math.abs(U.x),Math.abs(U.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(U,B){for(var H=[],K,re=B==="mouseout"||B==="mouseover",fe=U.target||U.srcElement,Ue=!1;fe;){if(K=this._targets[l(fe)],K&&(B==="click"||B==="preclick")&&this._draggableMoved(K)){Ue=!0;break}if(K&&K.listens(B,!0)&&(re&&!ir(fe,U)||(H.push(K),re))||fe===this._container)break;fe=fe.parentNode}return!H.length&&!Ue&&!re&&this.listens(B,!0)&&(H=[this]),H},_isClickDisabled:function(U){for(;U&&U!==this._container;){if(U._leaflet_disable_click)return!0;U=U.parentNode}},_handleDOMEvent:function(U){var B=U.target||U.srcElement;if(!(!this._loaded||B._leaflet_disable_events||U.type==="click"&&this._isClickDisabled(B))){var H=U.type;H==="mousedown"&&xu(B),this._fireDOMEvent(U,H)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(U,B,H){if(U.type==="click"){var K=n({},U);K.type="preclick",this._fireDOMEvent(K,K.type,H)}var re=this._findEventTargets(U,B);if(H){for(var fe=[],Ue=0;Ue<H.length;Ue++)H[Ue].listens(B,!0)&&fe.push(H[Ue]);re=fe.concat(re)}if(re.length){B==="contextmenu"&&Ga(U);var Qe=re[0],Ye={originalEvent:U};if(U.type!=="keypress"&&U.type!=="keydown"&&U.type!=="keyup"){var At=Qe.getLatLng&&(!Qe._radius||Qe._radius<=10);Ye.containerPoint=At?this.latLngToContainerPoint(Qe.getLatLng()):this.mouseEventToContainerPoint(U),Ye.layerPoint=this.containerPointToLayerPoint(Ye.containerPoint),Ye.latlng=At?Qe.getLatLng():this.layerPointToLatLng(Ye.layerPoint)}for(Ue=0;Ue<re.length;Ue++)if(re[Ue].fire(B,Ye,!0),Ye.originalEvent._stopped||re[Ue].options.bubblingMouseEvents===!1&&y(this._mouseEvents,B)!==-1)return}},_draggableMoved:function(U){return U=U.dragging&&U.dragging.enabled()?U:this,U.dragging&&U.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var U=0,B=this._handlers.length;U<B;U++)this._handlers[U].disable()},whenReady:function(U,B){return this._loaded?U.call(B||this,{target:this}):this.on("load",U,B),this},_getMapPanePos:function(){return Oi(this._mapPane)||new x(0,0)},_moved:function(){var U=this._getMapPanePos();return U&&!U.equals([0,0])},_getTopLeftPoint:function(U,B){var H=U&&B!==void 0?this._getNewPixelOrigin(U,B):this.getPixelOrigin();return H.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(U,B){var H=this.getSize()._divideBy(2);return this.project(U,B)._subtract(H)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(U,B,H){var K=this._getNewPixelOrigin(H,B);return this.project(U,B)._subtract(K)},_latLngBoundsToNewLayerBounds:function(U,B,H){var K=this._getNewPixelOrigin(H,B);return G([this.project(U.getSouthWest(),B)._subtract(K),this.project(U.getNorthWest(),B)._subtract(K),this.project(U.getSouthEast(),B)._subtract(K),this.project(U.getNorthEast(),B)._subtract(K)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(U){return this.latLngToLayerPoint(U).subtract(this._getCenterLayerPoint())},_limitCenter:function(U,B,H){if(!H)return U;var K=this.project(U,B),re=this.getSize().divideBy(2),fe=new V(K.subtract(re),K.add(re)),Ue=this._getBoundsOffset(fe,H,B);return Math.abs(Ue.x)<=1&&Math.abs(Ue.y)<=1?U:this.unproject(K.add(Ue),B)},_limitOffset:function(U,B){if(!B)return U;var H=this.getPixelBounds(),K=new V(H.min.add(U),H.max.add(U));return U.add(this._getBoundsOffset(K,B))},_getBoundsOffset:function(U,B,H){var K=G(this.project(B.getNorthEast(),H),this.project(B.getSouthWest(),H)),re=K.min.subtract(U.min),fe=K.max.subtract(U.max),Ue=this._rebound(re.x,-fe.x),Qe=this._rebound(re.y,-fe.y);return new x(Ue,Qe)},_rebound:function(U,B){return U+B>0?Math.round(U-B)/2:Math.max(0,Math.ceil(U))-Math.max(0,Math.floor(B))},_limitZoom:function(U){var B=this.getMinZoom(),H=this.getMaxZoom(),K=ti.any3d?this.options.zoomSnap:1;return K&&(U=Math.round(U/K)*K),Math.max(B,Math.min(H,U))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){In(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(U,B){var H=this._getCenterOffset(U)._trunc();return(B&&B.animate)!==!0&&!this.getSize().contains(H)?!1:(this.panBy(H,B),!0)},_createAnimProxy:function(){var U=this._proxy=Xt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(U),this.on("zoomanim",function(B){var H=pc,K=this._proxy.style[H];Ai(this._proxy,this.project(B.center,B.zoom),this.getZoomScale(B.zoom,1)),K===this._proxy.style[H]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){xn(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var U=this.getCenter(),B=this.getZoom();Ai(this._proxy,this.project(U,B),this.getZoomScale(B,1))},_catchTransitionEnd:function(U){this._animatingZoom&&U.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(U,B,H){if(this._animatingZoom)return!0;if(H=H||{},!this._zoomAnimated||H.animate===!1||this._nothingToAnimate()||Math.abs(B-this._zoom)>this.options.zoomAnimationThreshold)return!1;var K=this.getZoomScale(B),re=this._getCenterOffset(U)._divideBy(1-1/K);return H.animate!==!0&&!this.getSize().contains(re)?!1:(E(function(){this._moveStart(!0,H.noMoveStart||!1)._animateZoom(U,B,!0)},this),!0)},_animateZoom:function(U,B,H,K){this._mapPane&&(H&&(this._animatingZoom=!0,this._animateToCenter=U,this._animateToZoom=B,Hi(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:U,zoom:B,noUpdate:K}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(s(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&In(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Na(U,B){return new Zt(U,B)}var Ar=M.extend({options:{position:"topright"},initialize:function(U){m(this,U)},getPosition:function(){return this.options.position},setPosition:function(U){var B=this._map;return B&&B.removeControl(this),this.options.position=U,B&&B.addControl(this),this},getContainer:function(){return this._container},addTo:function(U){this.remove(),this._map=U;var B=this._container=this.onAdd(U),H=this.getPosition(),K=U._controlCorners[H];return Hi(B,"leaflet-control"),H.indexOf("bottom")!==-1?K.insertBefore(B,K.firstChild):K.appendChild(B),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(xn(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(U){this._map&&U&&U.screenX>0&&U.screenY>0&&this._map.getContainer().focus()}}),cs=function(U){return new Ar(U)};Zt.include({addControl:function(U){return U.addTo(this),this},removeControl:function(U){return U.remove(),this},_initControlPos:function(){var U=this._controlCorners={},B="leaflet-",H=this._controlContainer=Xt("div",B+"control-container",this._container);function K(re,fe){var Ue=B+re+" "+B+fe;U[re+fe]=Xt("div",Ue,H)}K("top","left"),K("top","right"),K("bottom","left"),K("bottom","right")},_clearControlPos:function(){for(var U in this._controlCorners)xn(this._controlCorners[U]);xn(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Vo=Ar.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(U,B,H,K){return H<K?-1:K<H?1:0}},initialize:function(U,B,H){m(this,H),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var K in U)this._addLayer(U[K],K);for(K in B)this._addLayer(B[K],K,!0)},onAdd:function(U){this._initLayout(),this._update(),this._map=U,U.on("zoomend",this._checkDisabledLayers,this);for(var B=0;B<this._layers.length;B++)this._layers[B].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(U){return Ar.prototype.addTo.call(this,U),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var U=0;U<this._layers.length;U++)this._layers[U].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(U,B){return this._addLayer(U,B),this._map?this._update():this},addOverlay:function(U,B){return this._addLayer(U,B,!0),this._map?this._update():this},removeLayer:function(U){U.off("add remove",this._onLayerChange,this);var B=this._getLayer(l(U));return B&&this._layers.splice(this._layers.indexOf(B),1),this._map?this._update():this},expand:function(){Hi(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var U=this._map.getSize().y-(this._container.offsetTop+50);return U<this._section.clientHeight?(Hi(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=U+"px"):In(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return In(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var U="leaflet-control-layers",B=this._container=Xt("div",U),H=this.options.collapsed;B.setAttribute("aria-haspopup",!0),Ou(B),Ip(B);var K=this._section=Xt("section",U+"-list");H&&(this._map.on("click",this.collapse,this),pi(B,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var re=this._layersLink=Xt("a",U+"-toggle",B);re.href="#",re.title="Layers",re.setAttribute("role","button"),pi(re,{keydown:function(fe){fe.keyCode===13&&this._expandSafely()},click:function(fe){Ga(fe),this._expandSafely()}},this),H||this.expand(),this._baseLayersList=Xt("div",U+"-base",K),this._separator=Xt("div",U+"-separator",K),this._overlaysList=Xt("div",U+"-overlays",K),B.appendChild(K)},_getLayer:function(U){for(var B=0;B<this._layers.length;B++)if(this._layers[B]&&l(this._layers[B].layer)===U)return this._layers[B]},_addLayer:function(U,B,H){this._map&&U.on("add remove",this._onLayerChange,this),this._layers.push({layer:U,name:B,overlay:H}),this.options.sortLayers&&this._layers.sort(s(function(K,re){return this.options.sortFunction(K.layer,re.layer,K.name,re.name)},this)),this.options.autoZIndex&&U.setZIndex&&(this._lastZIndex++,U.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Cl(this._baseLayersList),Cl(this._overlaysList),this._layerControlInputs=[];var U,B,H,K,re=0;for(H=0;H<this._layers.length;H++)K=this._layers[H],this._addItem(K),B=B||K.overlay,U=U||!K.overlay,re+=K.overlay?0:1;return this.options.hideSingleBase&&(U=U&&re>1,this._baseLayersList.style.display=U?"":"none"),this._separator.style.display=B&&U?"":"none",this},_onLayerChange:function(U){this._handlingClick||this._update();var B=this._getLayer(l(U.target)),H=B.overlay?U.type==="add"?"overlayadd":"overlayremove":U.type==="add"?"baselayerchange":null;H&&this._map.fire(H,B)},_createRadioElement:function(U,B){var H='<input type="radio" class="leaflet-control-layers-selector" name="'+U+'"'+(B?' checked="checked"':"")+"/>",K=document.createElement("div");return K.innerHTML=H,K.firstChild},_addItem:function(U){var B=document.createElement("label"),H=this._map.hasLayer(U.layer),K;U.overlay?(K=document.createElement("input"),K.type="checkbox",K.className="leaflet-control-layers-selector",K.defaultChecked=H):K=this._createRadioElement("leaflet-base-layers_"+l(this),H),this._layerControlInputs.push(K),K.layerId=l(U.layer),pi(K,"click",this._onInputClick,this);var re=document.createElement("span");re.innerHTML=" "+U.name;var fe=document.createElement("span");B.appendChild(fe),fe.appendChild(K),fe.appendChild(re);var Ue=U.overlay?this._overlaysList:this._baseLayersList;return Ue.appendChild(B),this._checkDisabledLayers(),B},_onInputClick:function(){if(!this._preventClick){var U=this._layerControlInputs,B,H,K=[],re=[];this._handlingClick=!0;for(var fe=U.length-1;fe>=0;fe--)B=U[fe],H=this._getLayer(B.layerId).layer,B.checked?K.push(H):B.checked||re.push(H);for(fe=0;fe<re.length;fe++)this._map.hasLayer(re[fe])&&this._map.removeLayer(re[fe]);for(fe=0;fe<K.length;fe++)this._map.hasLayer(K[fe])||this._map.addLayer(K[fe]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var U=this._layerControlInputs,B,H,K=this._map.getZoom(),re=U.length-1;re>=0;re--)B=U[re],H=this._getLayer(B.layerId).layer,B.disabled=H.options.minZoom!==void 0&&K<H.options.minZoom||H.options.maxZoom!==void 0&&K>H.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var U=this._section;this._preventClick=!0,pi(U,"click",Ga),this.expand();var B=this;setTimeout(function(){Fr(U,"click",Ga),B._preventClick=!1})}}),Qa=function(U,B,H){return new Vo(U,B,H)},us=Ar.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(U){var B="leaflet-control-zoom",H=Xt("div",B+" leaflet-bar"),K=this.options;return this._zoomInButton=this._createButton(K.zoomInText,K.zoomInTitle,B+"-in",H,this._zoomIn),this._zoomOutButton=this._createButton(K.zoomOutText,K.zoomOutTitle,B+"-out",H,this._zoomOut),this._updateDisabled(),U.on("zoomend zoomlevelschange",this._updateDisabled,this),H},onRemove:function(U){U.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(U){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(U.shiftKey?3:1))},_zoomOut:function(U){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(U.shiftKey?3:1))},_createButton:function(U,B,H,K,re){var fe=Xt("a",H,K);return fe.innerHTML=U,fe.href="#",fe.title=B,fe.setAttribute("role","button"),fe.setAttribute("aria-label",B),Ou(fe),pi(fe,"click",Dl),pi(fe,"click",re,this),pi(fe,"click",this._refocusOnMap,this),fe},_updateDisabled:function(){var U=this._map,B="leaflet-disabled";In(this._zoomInButton,B),In(this._zoomOutButton,B),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||U._zoom===U.getMinZoom())&&(Hi(this._zoomOutButton,B),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||U._zoom===U.getMaxZoom())&&(Hi(this._zoomInButton,B),this._zoomInButton.setAttribute("aria-disabled","true"))}});Zt.mergeOptions({zoomControl:!0}),Zt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new us,this.addControl(this.zoomControl))});var Vs=function(U){return new us(U)},hc=Ar.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(U){var B="leaflet-control-scale",H=Xt("div",B),K=this.options;return this._addScales(K,B+"-line",H),U.on(K.updateWhenIdle?"moveend":"move",this._update,this),U.whenReady(this._update,this),H},onRemove:function(U){U.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(U,B,H){U.metric&&(this._mScale=Xt("div",B,H)),U.imperial&&(this._iScale=Xt("div",B,H))},_update:function(){var U=this._map,B=U.getSize().y/2,H=U.distance(U.containerPointToLatLng([0,B]),U.containerPointToLatLng([this.options.maxWidth,B]));this._updateScales(H)},_updateScales:function(U){this.options.metric&&U&&this._updateMetric(U),this.options.imperial&&U&&this._updateImperial(U)},_updateMetric:function(U){var B=this._getRoundNum(U),H=B<1e3?B+" m":B/1e3+" km";this._updateScale(this._mScale,H,B/U)},_updateImperial:function(U){var B=U*3.2808399,H,K,re;B>5280?(H=B/5280,K=this._getRoundNum(H),this._updateScale(this._iScale,K+" mi",K/H)):(re=this._getRoundNum(B),this._updateScale(this._iScale,re+" ft",re/B))},_updateScale:function(U,B,H){U.style.width=Math.round(this.options.maxWidth*H)+"px",U.innerHTML=B},_getRoundNum:function(U){var B=Math.pow(10,(Math.floor(U)+"").length-1),H=U/B;return H=H>=10?10:H>=5?5:H>=3?3:H>=2?2:1,B*H}}),mc=function(U){return new hc(U)},Fu='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',NA=Ar.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(ti.inlineSvg?Fu+" ":"")+"Leaflet</a>"},initialize:function(U){m(this,U),this._attributions={}},onAdd:function(U){U.attributionControl=this,this._container=Xt("div","leaflet-control-attribution"),Ou(this._container);for(var B in U._layers)U._layers[B].getAttribution&&this.addAttribution(U._layers[B].getAttribution());return this._update(),U.on("layeradd",this._addAttribution,this),this._container},onRemove:function(U){U.off("layeradd",this._addAttribution,this)},_addAttribution:function(U){U.layer.getAttribution&&(this.addAttribution(U.layer.getAttribution()),U.layer.once("remove",function(){this.removeAttribution(U.layer.getAttribution())},this))},setPrefix:function(U){return this.options.prefix=U,this._update(),this},addAttribution:function(U){return U?(this._attributions[U]||(this._attributions[U]=0),this._attributions[U]++,this._update(),this):this},removeAttribution:function(U){return U?(this._attributions[U]&&(this._attributions[U]--,this._update()),this):this},_update:function(){if(this._map){var U=[];for(var B in this._attributions)this._attributions[B]&&U.push(B);var H=[];this.options.prefix&&H.push(this.options.prefix),U.length&&H.push(U.join(", ")),this._container.innerHTML=H.join(' <span aria-hidden="true">|</span> ')}}});Zt.mergeOptions({attributionControl:!0}),Zt.addInitHook(function(){this.options.attributionControl&&new NA().addTo(this)});var hv=function(U){return new NA(U)};Ar.Layers=Vo,Ar.Zoom=us,Ar.Scale=hc,Ar.Attribution=NA,cs.layers=Qa,cs.zoom=Vs,cs.scale=mc,cs.attribution=hv;var Gs=M.extend({initialize:function(U){this._map=U},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Gs.addTo=function(U,B){return U.addHandler(B,this),this};var WE={Events:k},FS=ti.touch?"touchstart mousedown":"mousedown",wp=O.extend({options:{clickTolerance:3},initialize:function(U,B,H,K){m(this,K),this._element=U,this._dragStartTarget=B||U,this._preventOutline=H},enable:function(){this._enabled||(pi(this._dragStartTarget,FS,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(wp._dragging===this&&this.finishDrag(!0),Fr(this._dragStartTarget,FS,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(U){if(this._enabled&&(this._moved=!1,!Hs(this._element,"leaflet-zoom-anim"))){if(U.touches&&U.touches.length!==1){wp._dragging===this&&this.finishDrag();return}if(!(wp._dragging||U.shiftKey||U.which!==1&&U.button!==1&&!U.touches)&&(wp._dragging=this,this._preventOutline&&xu(this._element),El(),wn(),!this._moving)){this.fire("down");var B=U.touches?U.touches[0]:U,H=Da(this._element);this._startPoint=new x(B.clientX,B.clientY),this._startPos=Oi(this._element),this._parentScale=_f(H);var K=U.type==="mousedown";pi(document,K?"mousemove":"touchmove",this._onMove,this),pi(document,K?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(U){if(this._enabled){if(U.touches&&U.touches.length>1){this._moved=!0;return}var B=U.touches&&U.touches.length===1?U.touches[0]:U,H=new x(B.clientX,B.clientY)._subtract(this._startPoint);!H.x&&!H.y||Math.abs(H.x)+Math.abs(H.y)<this.options.clickTolerance||(H.x/=this._parentScale.x,H.y/=this._parentScale.y,Ga(U),this._moved||(this.fire("dragstart"),this._moved=!0,Hi(document.body,"leaflet-dragging"),this._lastTarget=U.target||U.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Hi(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(H),this._moving=!0,this._lastEvent=U,this._updatePosition())}},_updatePosition:function(){var U={originalEvent:this._lastEvent};this.fire("predrag",U),_i(this._element,this._newPos),this.fire("drag",U)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(U){In(document.body,"leaflet-dragging"),this._lastTarget&&(In(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Fr(document,"mousemove touchmove",this._onMove,this),Fr(document,"mouseup touchend touchcancel",this._onUp,this),RA(),Va();var B=this._moved&&this._moving;this._moving=!1,wp._dragging=!1,B&&this.fire("dragend",{noInertia:U,distance:this._newPos.distanceTo(this._startPos)})}});function LS(U,B,H){var K,re=[1,4,2,8],fe,Ue,Qe,Ye,At,ai,rr,jr;for(fe=0,ai=U.length;fe<ai;fe++)U[fe]._code=Sp(U[fe],B);for(Qe=0;Qe<4;Qe++){for(rr=re[Qe],K=[],fe=0,ai=U.length,Ue=ai-1;fe<ai;Ue=fe++)Ye=U[fe],At=U[Ue],Ye._code&rr?At._code&rr||(jr=Av(At,Ye,rr,B,H),jr._code=Sp(jr,B),K.push(jr)):(At._code&rr&&(jr=Av(At,Ye,rr,B,H),jr._code=Sp(jr,B),K.push(jr)),K.push(Ye));U=K}return U}function Go(U,B){var H,K,re,fe,Ue,Qe,Ye,At,ai;if(!U||U.length===0)throw new Error("latlngs not passed");Lu(U)||(console.warn("latlngs are not flat! Only the first ring will be used"),U=U[0]);var rr=W([0,0]),jr=Q(U),qc=jr.getNorthWest().distanceTo(jr.getSouthWest())*jr.getNorthEast().distanceTo(jr.getNorthWest());qc<1700&&(rr=BA(U));var ll=U.length,Tp=[];for(H=0;H<ll;H++){var Vu=W(U[H]);Tp.push(B.project(W([Vu.lat-rr.lat,Vu.lng-rr.lng])))}for(Qe=Ye=At=0,H=0,K=ll-1;H<ll;K=H++)re=Tp[H],fe=Tp[K],Ue=re.y*fe.x-fe.y*re.x,Ye+=(re.x+fe.x)*Ue,At+=(re.y+fe.y)*Ue,Qe+=Ue*3;Qe===0?ai=Tp[0]:ai=[Ye/Qe,At/Qe];var GS=B.unproject(_(ai));return W([GS.lat+rr.lat,GS.lng+rr.lng])}function BA(U){for(var B=0,H=0,K=0,re=0;re<U.length;re++){var fe=W(U[re]);B+=fe.lat,H+=fe.lng,K++}return W([B/K,H/K])}var Ob={__proto__:null,clipPolygon:LS,polygonCenter:Go,centroid:BA};function KE(U,B){if(!B||!U.length)return U.slice();var H=B*B;return U=YE(U,H),U=jN(U,H),U}function Fb(U,B,H){return Math.sqrt(gv(U,B,H,!0))}function QN(U,B,H){return gv(U,B,H)}function jN(U,B){var H=U.length,K=typeof Uint8Array<"u"?Uint8Array:Array,re=new K(H);re[0]=re[H-1]=1,mv(U,re,B,0,H-1);var fe,Ue=[];for(fe=0;fe<H;fe++)re[fe]&&Ue.push(U[fe]);return Ue}function mv(U,B,H,K,re){var fe=0,Ue,Qe,Ye;for(Qe=K+1;Qe<=re-1;Qe++)Ye=gv(U[Qe],U[K],U[re],!0),Ye>fe&&(Ue=Qe,fe=Ye);fe>H&&(B[Ue]=1,mv(U,B,H,K,Ue),mv(U,B,H,Ue,re))}function YE(U,B){for(var H=[U[0]],K=1,re=0,fe=U.length;K<fe;K++)XE(U[K],U[re])>B&&(H.push(U[K]),re=K);return re<fe-1&&H.push(U[fe-1]),H}var rm;function $S(U,B,H,K,re){var fe=K?rm:Sp(U,H),Ue=Sp(B,H),Qe,Ye,At;for(rm=Ue;;){if(!(fe|Ue))return[U,B];if(fe&Ue)return!1;Qe=fe||Ue,Ye=Av(U,B,Qe,H,re),At=Sp(Ye,H),Qe===fe?(U=Ye,fe=At):(B=Ye,Ue=At)}}function Av(U,B,H,K,re){var fe=B.x-U.x,Ue=B.y-U.y,Qe=K.min,Ye=K.max,At,ai;return H&8?(At=U.x+fe*(Ye.y-U.y)/Ue,ai=Ye.y):H&4?(At=U.x+fe*(Qe.y-U.y)/Ue,ai=Qe.y):H&2?(At=Ye.x,ai=U.y+Ue*(Ye.x-U.x)/fe):H&1&&(At=Qe.x,ai=U.y+Ue*(Qe.x-U.x)/fe),new x(At,ai,re)}function Sp(U,B){var H=0;return U.x<B.min.x?H|=1:U.x>B.max.x&&(H|=2),U.y<B.min.y?H|=4:U.y>B.max.y&&(H|=8),H}function XE(U,B){var H=B.x-U.x,K=B.y-U.y;return H*H+K*K}function gv(U,B,H,K){var re=B.x,fe=B.y,Ue=H.x-re,Qe=H.y-fe,Ye=Ue*Ue+Qe*Qe,At;return Ye>0&&(At=((U.x-re)*Ue+(U.y-fe)*Qe)/Ye,At>1?(re=H.x,fe=H.y):At>0&&(re+=Ue*At,fe+=Qe*At)),Ue=U.x-re,Qe=U.y-fe,K?Ue*Ue+Qe*Qe:new x(re,fe)}function Lu(U){return!b(U[0])||typeof U[0][0]!="object"&&typeof U[0][0]<"u"}function HS(U){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Lu(U)}function Lb(U,B){var H,K,re,fe,Ue,Qe,Ye,At;if(!U||U.length===0)throw new Error("latlngs not passed");Lu(U)||(console.warn("latlngs are not flat! Only the first ring will be used"),U=U[0]);var ai=W([0,0]),rr=Q(U),jr=rr.getNorthWest().distanceTo(rr.getSouthWest())*rr.getNorthEast().distanceTo(rr.getNorthWest());jr<1700&&(ai=BA(U));var qc=U.length,ll=[];for(H=0;H<qc;H++){var Tp=W(U[H]);ll.push(B.project(W([Tp.lat-ai.lat,Tp.lng-ai.lng])))}for(H=0,K=0;H<qc-1;H++)K+=ll[H].distanceTo(ll[H+1])/2;if(K===0)At=ll[0];else for(H=0,fe=0;H<qc-1;H++)if(Ue=ll[H],Qe=ll[H+1],re=Ue.distanceTo(Qe),fe+=re,fe>K){Ye=(fe-K)/re,At=[Qe.x-Ye*(Qe.x-Ue.x),Qe.y-Ye*(Qe.y-Ue.y)];break}var Vu=B.unproject(_(At));return W([Vu.lat+ai.lat,Vu.lng+ai.lng])}var dV={__proto__:null,simplify:KE,pointToSegmentDistance:Fb,closestPointOnSegment:QN,clipSegment:$S,_getEdgeIntersection:Av,_getBitCode:Sp,_sqClosestPointOnSegment:gv,isFlat:Lu,_flat:HS,polylineCenter:Lb},$b={project:function(U){return new x(U.lng,U.lat)},unproject:function(U){return new j(U.y,U.x)},bounds:new V([-180,-90],[180,90])},Hb={R:6378137,R_MINOR:6356752314245179e-9,bounds:new V([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(U){var B=Math.PI/180,H=this.R,K=U.lat*B,re=this.R_MINOR/H,fe=Math.sqrt(1-re*re),Ue=fe*Math.sin(K),Qe=Math.tan(Math.PI/4-K/2)/Math.pow((1-Ue)/(1+Ue),fe/2);return K=-H*Math.log(Math.max(Qe,1e-10)),new x(U.lng*B*H,K)},unproject:function(U){for(var B=180/Math.PI,H=this.R,K=this.R_MINOR/H,re=Math.sqrt(1-K*K),fe=Math.exp(-U.y/H),Ue=Math.PI/2-2*Math.atan(fe),Qe=0,Ye=.1,At;Qe<15&&Math.abs(Ye)>1e-7;Qe++)At=re*Math.sin(Ue),At=Math.pow((1-At)/(1+At),re/2),Ye=Math.PI/2-2*Math.atan(fe*At)-Ue,Ue+=Ye;return new j(Ue*B,U.x*B/H)}},pV={__proto__:null,LonLat:$b,Mercator:Hb,SphericalMercator:ie},zN=n({},X,{code:"EPSG:3395",projection:Hb,transformation:(function(){var U=.5/(Math.PI*Hb.R);return ne(U,.5,-U,.5)})()}),qN=n({},X,{code:"EPSG:4326",projection:$b,transformation:ne(1/180,1,-1/180,.5)}),WN=n({},Y,{projection:$b,transformation:ne(1,0,-1,0),scale:function(U){return Math.pow(2,U)},zoom:function(U){return Math.log(U)/Math.LN2},distance:function(U,B){var H=B.lng-U.lng,K=B.lat-U.lat;return Math.sqrt(H*H+K*K)},infinite:!0});Y.Earth=X,Y.EPSG3395=zN,Y.EPSG3857=ge,Y.EPSG900913=he,Y.EPSG4326=qN,Y.Simple=WN;var $u=O.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(U){return U.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(U){return U&&U.removeLayer(this),this},getPane:function(U){return this._map.getPane(U?this.options[U]||U:this.options.pane)},addInteractiveTarget:function(U){return this._map._targets[l(U)]=this,this},removeInteractiveTarget:function(U){return delete this._map._targets[l(U)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(U){var B=U.target;if(B.hasLayer(this)){if(this._map=B,this._zoomAnimated=B._zoomAnimated,this.getEvents){var H=this.getEvents();B.on(H,this),this.once("remove",function(){B.off(H,this)},this)}this.onAdd(B),this.fire("add"),B.fire("layeradd",{layer:this})}}});Zt.include({addLayer:function(U){if(!U._layerAdd)throw new Error("The provided object is not a Layer.");var B=l(U);return this._layers[B]?this:(this._layers[B]=U,U._mapToAdd=this,U.beforeAdd&&U.beforeAdd(this),this.whenReady(U._layerAdd,U),this)},removeLayer:function(U){var B=l(U);return this._layers[B]?(this._loaded&&U.onRemove(this),delete this._layers[B],this._loaded&&(this.fire("layerremove",{layer:U}),U.fire("remove")),U._map=U._mapToAdd=null,this):this},hasLayer:function(U){return l(U)in this._layers},eachLayer:function(U,B){for(var H in this._layers)U.call(B,this._layers[H]);return this},_addLayers:function(U){U=U?b(U)?U:[U]:[];for(var B=0,H=U.length;B<H;B++)this.addLayer(U[B])},_addZoomLimit:function(U){(!isNaN(U.options.maxZoom)||!isNaN(U.options.minZoom))&&(this._zoomBoundLayers[l(U)]=U,this._updateZoomLevels())},_removeZoomLimit:function(U){var B=l(U);this._zoomBoundLayers[B]&&(delete this._zoomBoundLayers[B],this._updateZoomLevels())},_updateZoomLevels:function(){var U=1/0,B=-1/0,H=this._getZoomSpan();for(var K in this._zoomBoundLayers){var re=this._zoomBoundLayers[K].options;U=re.minZoom===void 0?U:Math.min(U,re.minZoom),B=re.maxZoom===void 0?B:Math.max(B,re.maxZoom)}this._layersMaxZoom=B===-1/0?void 0:B,this._layersMinZoom=U===1/0?void 0:U,H!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var vv=$u.extend({initialize:function(U,B){m(this,B),this._layers={};var H,K;if(U)for(H=0,K=U.length;H<K;H++)this.addLayer(U[H])},addLayer:function(U){var B=this.getLayerId(U);return this._layers[B]=U,this._map&&this._map.addLayer(U),this},removeLayer:function(U){var B=U in this._layers?U:this.getLayerId(U);return this._map&&this._layers[B]&&this._map.removeLayer(this._layers[B]),delete this._layers[B],this},hasLayer:function(U){var B=typeof U=="number"?U:this.getLayerId(U);return B in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(U){var B=Array.prototype.slice.call(arguments,1),H,K;for(H in this._layers)K=this._layers[H],K[U]&&K[U].apply(K,B);return this},onAdd:function(U){this.eachLayer(U.addLayer,U)},onRemove:function(U){this.eachLayer(U.removeLayer,U)},eachLayer:function(U,B){for(var H in this._layers)U.call(B,this._layers[H]);return this},getLayer:function(U){return this._layers[U]},getLayers:function(){var U=[];return this.eachLayer(U.push,U),U},setZIndex:function(U){return this.invoke("setZIndex",U)},getLayerId:function(U){return l(U)}}),KN=function(U,B){return new vv(U,B)},Od=vv.extend({addLayer:function(U){return this.hasLayer(U)?this:(U.addEventParent(this),vv.prototype.addLayer.call(this,U),this.fire("layeradd",{layer:U}))},removeLayer:function(U){return this.hasLayer(U)?(U in this._layers&&(U=this._layers[U]),U.removeEventParent(this),vv.prototype.removeLayer.call(this,U),this.fire("layerremove",{layer:U})):this},setStyle:function(U){return this.invoke("setStyle",U)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var U=new z;for(var B in this._layers){var H=this._layers[B];U.extend(H.getBounds?H.getBounds():H.getLatLng())}return U}}),YN=function(U,B){return new Od(U,B)},kA=M.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(U){m(this,U)},createIcon:function(U){return this._createIcon("icon",U)},createShadow:function(U){return this._createIcon("shadow",U)},_createIcon:function(U,B){var H=this._getIconUrl(U);if(!H){if(U==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var K=this._createImg(H,B&&B.tagName==="IMG"?B:null);return this._setIconStyles(K,U),(this.options.crossOrigin||this.options.crossOrigin==="")&&(K.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),K},_setIconStyles:function(U,B){var H=this.options,K=H[B+"Size"];typeof K=="number"&&(K=[K,K]);var re=_(K),fe=_(B==="shadow"&&H.shadowAnchor||H.iconAnchor||re&&re.divideBy(2,!0));U.className="leaflet-marker-"+B+" "+(H.className||""),fe&&(U.style.marginLeft=-fe.x+"px",U.style.marginTop=-fe.y+"px"),re&&(U.style.width=re.x+"px",U.style.height=re.y+"px")},_createImg:function(U,B){return B=B||document.createElement("img"),B.src=U,B},_getIconUrl:function(U){return ti.retina&&this.options[U+"RetinaUrl"]||this.options[U+"Url"]}});function fV(U){return new kA(U)}var Vb=kA.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(U){return typeof Vb.imagePath!="string"&&(Vb.imagePath=this._detectIconPath()),(this.options.imagePath||Vb.imagePath)+kA.prototype._getIconUrl.call(this,U)},_stripUrl:function(U){var B=function(H,K,re){var fe=K.exec(H);return fe&&fe[re]};return U=B(U,/^url\((['"])?(.+)\1\)$/,2),U&&B(U,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var U=Xt("div","leaflet-default-icon-path",document.body),B=jc(U,"background-image")||jc(U,"backgroundImage");if(document.body.removeChild(U),B=this._stripUrl(B),B)return B;var H=document.querySelector('link[href$="leaflet.css"]');return H?H.href.substring(0,H.href.length-11-1):""}}),XN=Gs.extend({initialize:function(U){this._marker=U},addHooks:function(){var U=this._marker._icon;this._draggable||(this._draggable=new wp(U,U,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Hi(U,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&In(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(U){var B=this._marker,H=B._map,K=this._marker.options.autoPanSpeed,re=this._marker.options.autoPanPadding,fe=Oi(B._icon),Ue=H.getPixelBounds(),Qe=H.getPixelOrigin(),Ye=G(Ue.min._subtract(Qe).add(re),Ue.max._subtract(Qe).subtract(re));if(!Ye.contains(fe)){var At=_((Math.max(Ye.max.x,fe.x)-Ye.max.x)/(Ue.max.x-Ye.max.x)-(Math.min(Ye.min.x,fe.x)-Ye.min.x)/(Ue.min.x-Ye.min.x),(Math.max(Ye.max.y,fe.y)-Ye.max.y)/(Ue.max.y-Ye.max.y)-(Math.min(Ye.min.y,fe.y)-Ye.min.y)/(Ue.min.y-Ye.min.y)).multiplyBy(K);H.panBy(At,{animate:!1}),this._draggable._newPos._add(At),this._draggable._startPos._add(At),_i(B._icon,this._draggable._newPos),this._onDrag(U),this._panRequest=E(this._adjustPan.bind(this,U))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(U){this._marker.options.autoPan&&(P(this._panRequest),this._panRequest=E(this._adjustPan.bind(this,U)))},_onDrag:function(U){var B=this._marker,H=B._shadow,K=Oi(B._icon),re=B._map.layerPointToLatLng(K);H&&_i(H,K),B._latlng=re,U.latlng=re,U.oldLatLng=this._oldLatLng,B.fire("move",U).fire("drag",U)},_onDragEnd:function(U){P(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",U)}}),xA=$u.extend({options:{icon:new Vb,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(U,B){m(this,B),this._latlng=W(U)},onAdd:function(U){this._zoomAnimated=this._zoomAnimated&&U.options.markerZoomAnimation,this._zoomAnimated&&U.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(U){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&U.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(U){var B=this._latlng;return this._latlng=W(U),this.update(),this.fire("move",{oldLatLng:B,latlng:this._latlng})},setZIndexOffset:function(U){return this.options.zIndexOffset=U,this.update()},getIcon:function(){return this.options.icon},setIcon:function(U){return this.options.icon=U,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var U=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(U)}return this},_initIcon:function(){var U=this.options,B="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),H=U.icon.createIcon(this._icon),K=!1;H!==this._icon&&(this._icon&&this._removeIcon(),K=!0,U.title&&(H.title=U.title),H.tagName==="IMG"&&(H.alt=U.alt||"")),Hi(H,B),U.keyboard&&(H.tabIndex="0",H.setAttribute("role","button")),this._icon=H,U.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&pi(H,"focus",this._panOnFocus,this);var re=U.icon.createShadow(this._shadow),fe=!1;re!==this._shadow&&(this._removeShadow(),fe=!0),re&&(Hi(re,B),re.alt=""),this._shadow=re,U.opacity<1&&this._updateOpacity(),K&&this.getPane().appendChild(this._icon),this._initInteraction(),re&&fe&&this.getPane(U.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Fr(this._icon,"focus",this._panOnFocus,this),xn(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&xn(this._shadow),this._shadow=null},_setPos:function(U){this._icon&&_i(this._icon,U),this._shadow&&_i(this._shadow,U),this._zIndex=U.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(U){this._icon&&(this._icon.style.zIndex=this._zIndex+U)},_animateZoom:function(U){var B=this._map._latLngToNewLayerPoint(this._latlng,U.zoom,U.center).round();this._setPos(B)},_initInteraction:function(){if(this.options.interactive&&(Hi(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),XN)){var U=this.options.draggable;this.dragging&&(U=this.dragging.enabled(),this.dragging.disable()),this.dragging=new XN(this),U&&this.dragging.enable()}},setOpacity:function(U){return this.options.opacity=U,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var U=this.options.opacity;this._icon&&ls(this._icon,U),this._shadow&&ls(this._shadow,U)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var U=this._map;if(U){var B=this.options.icon.options,H=B.iconSize?_(B.iconSize):_(0,0),K=B.iconAnchor?_(B.iconAnchor):_(0,0);U.panInside(this._latlng,{paddingTopLeft:K,paddingBottomRight:H.subtract(K)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Of(U,B){return new xA(U,B)}var jn=$u.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(U){this._renderer=U.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(U){return m(this,U),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&U&&Object.prototype.hasOwnProperty.call(U,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),_A=jn.extend({options:{fill:!0,radius:10},initialize:function(U,B){m(this,B),this._latlng=W(U),this._radius=this.options.radius},setLatLng:function(U){var B=this._latlng;return this._latlng=W(U),this.redraw(),this.fire("move",{oldLatLng:B,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(U){return this.options.radius=this._radius=U,this.redraw()},getRadius:function(){return this._radius},setStyle:function(U){var B=U&&U.radius||this._radius;return jn.prototype.setStyle.call(this,U),this.setRadius(B),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var U=this._radius,B=this._radiusY||U,H=this._clickTolerance(),K=[U+H,B+H];this._pxBounds=new V(this._point.subtract(K),this._point.add(K))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(U){return U.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function yv(U,B){return new _A(U,B)}var ZE=_A.extend({initialize:function(U,B,H){if(typeof B=="number"&&(B=n({},H,{radius:B})),m(this,B),this._latlng=W(U),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(U){return this._mRadius=U,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var U=[this._radius,this._radiusY||this._radius];return new z(this._map.layerPointToLatLng(this._point.subtract(U)),this._map.layerPointToLatLng(this._point.add(U)))},setStyle:jn.prototype.setStyle,_project:function(){var U=this._latlng.lng,B=this._latlng.lat,H=this._map,K=H.options.crs;if(K.distance===X.distance){var re=Math.PI/180,fe=this._mRadius/X.R/re,Ue=H.project([B+fe,U]),Qe=H.project([B-fe,U]),Ye=Ue.add(Qe).divideBy(2),At=H.unproject(Ye).lat,ai=Math.acos((Math.cos(fe*re)-Math.sin(B*re)*Math.sin(At*re))/(Math.cos(B*re)*Math.cos(At*re)))/re;(isNaN(ai)||ai===0)&&(ai=fe/Math.cos(Math.PI/180*B)),this._point=Ye.subtract(H.getPixelOrigin()),this._radius=isNaN(ai)?0:Ye.x-H.project([At,U-ai]).x,this._radiusY=Ye.y-Ue.y}else{var rr=K.unproject(K.project(this._latlng).subtract([this._mRadius,0]));this._point=H.latLngToLayerPoint(this._latlng),this._radius=this._point.x-H.latLngToLayerPoint(rr).x}this._updateBounds()}});function JE(U,B,H){return new ZE(U,B,H)}var Up=jn.extend({options:{smoothFactor:1,noClip:!1},initialize:function(U,B){m(this,B),this._setLatLngs(U)},getLatLngs:function(){return this._latlngs},setLatLngs:function(U){return this._setLatLngs(U),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(U){for(var B=1/0,H=null,K=gv,re,fe,Ue=0,Qe=this._parts.length;Ue<Qe;Ue++)for(var Ye=this._parts[Ue],At=1,ai=Ye.length;At<ai;At++){re=Ye[At-1],fe=Ye[At];var rr=K(U,re,fe,!0);rr<B&&(B=rr,H=K(U,re,fe))}return H&&(H.distance=Math.sqrt(B)),H},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Lb(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(U,B){return B=B||this._defaultShape(),U=W(U),B.push(U),this._bounds.extend(U),this.redraw()},_setLatLngs:function(U){this._bounds=new z,this._latlngs=this._convertLatLngs(U)},_defaultShape:function(){return Lu(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(U){for(var B=[],H=Lu(U),K=0,re=U.length;K<re;K++)H?(B[K]=W(U[K]),this._bounds.extend(B[K])):B[K]=this._convertLatLngs(U[K]);return B},_project:function(){var U=new V;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,U),this._bounds.isValid()&&U.isValid()&&(this._rawPxBounds=U,this._updateBounds())},_updateBounds:function(){var U=this._clickTolerance(),B=new x(U,U);this._rawPxBounds&&(this._pxBounds=new V([this._rawPxBounds.min.subtract(B),this._rawPxBounds.max.add(B)]))},_projectLatlngs:function(U,B,H){var K=U[0]instanceof j,re=U.length,fe,Ue;if(K){for(Ue=[],fe=0;fe<re;fe++)Ue[fe]=this._map.latLngToLayerPoint(U[fe]),H.extend(Ue[fe]);B.push(Ue)}else for(fe=0;fe<re;fe++)this._projectLatlngs(U[fe],B,H)},_clipPoints:function(){var U=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(U))){if(this.options.noClip){this._parts=this._rings;return}var B=this._parts,H,K,re,fe,Ue,Qe,Ye;for(H=0,re=0,fe=this._rings.length;H<fe;H++)for(Ye=this._rings[H],K=0,Ue=Ye.length;K<Ue-1;K++)Qe=$S(Ye[K],Ye[K+1],U,K,!0),Qe&&(B[re]=B[re]||[],B[re].push(Qe[0]),(Qe[1]!==Ye[K+1]||K===Ue-2)&&(B[re].push(Qe[1]),re++))}},_simplifyPoints:function(){for(var U=this._parts,B=this.options.smoothFactor,H=0,K=U.length;H<K;H++)U[H]=KE(U[H],B)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(U,B){var H,K,re,fe,Ue,Qe,Ye=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(U))return!1;for(H=0,fe=this._parts.length;H<fe;H++)for(Qe=this._parts[H],K=0,Ue=Qe.length,re=Ue-1;K<Ue;re=K++)if(!(!B&&K===0)&&Fb(U,Qe[re],Qe[K])<=Ye)return!0;return!1}});function OA(U,B){return new Up(U,B)}Up._flat=HS;var nm=Up.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Go(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(U){var B=Up.prototype._convertLatLngs.call(this,U),H=B.length;return H>=2&&B[0]instanceof j&&B[0].equals(B[H-1])&&B.pop(),B},_setLatLngs:function(U){Up.prototype._setLatLngs.call(this,U),Lu(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Lu(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var U=this._renderer._bounds,B=this.options.weight,H=new x(B,B);if(U=new V(U.min.subtract(H),U.max.add(H)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(U))){if(this.options.noClip){this._parts=this._rings;return}for(var K=0,re=this._rings.length,fe;K<re;K++)fe=LS(this._rings[K],U,!0),fe.length&&this._parts.push(fe)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(U){var B=!1,H,K,re,fe,Ue,Qe,Ye,At;if(!this._pxBounds||!this._pxBounds.contains(U))return!1;for(fe=0,Ye=this._parts.length;fe<Ye;fe++)for(H=this._parts[fe],Ue=0,At=H.length,Qe=At-1;Ue<At;Qe=Ue++)K=H[Ue],re=H[Qe],K.y>U.y!=re.y>U.y&&U.x<(re.x-K.x)*(U.y-K.y)/(re.y-K.y)+K.x&&(B=!B);return B||Up.prototype._containsPoint.call(this,U,!0)}});function bv(U,B){return new nm(U,B)}var ol=Od.extend({initialize:function(U,B){m(this,B),this._layers={},U&&this.addData(U)},addData:function(U){var B=b(U)?U:U.features,H,K,re;if(B){for(H=0,K=B.length;H<K;H++)re=B[H],(re.geometries||re.geometry||re.features||re.coordinates)&&this.addData(re);return this}var fe=this.options;if(fe.filter&&!fe.filter(U))return this;var Ue=Gb(U,fe);return Ue?(Ue.feature=Ae(U),Ue.defaultOptions=Ue.options,this.resetStyle(Ue),fe.onEachFeature&&fe.onEachFeature(U,Ue),this.addLayer(Ue)):this},resetStyle:function(U){return U===void 0?this.eachLayer(this.resetStyle,this):(U.options=n({},U.defaultOptions),this._setLayerStyle(U,this.options.style),this)},setStyle:function(U){return this.eachLayer(function(B){this._setLayerStyle(B,U)},this)},_setLayerStyle:function(U,B){U.setStyle&&(typeof B=="function"&&(B=B(U.feature)),U.setStyle(B))}});function Gb(U,B){var H=U.type==="Feature"?U.geometry:U,K=H?H.coordinates:null,re=[],fe=B&&B.pointToLayer,Ue=B&&B.coordsToLatLng||q,Qe,Ye,At,ai;if(!K&&!H)return null;switch(H.type){case"Point":return Qe=Ue(K),$(fe,U,Qe,B);case"MultiPoint":for(At=0,ai=K.length;At<ai;At++)Qe=Ue(K[At]),re.push($(fe,U,Qe,B));return new Od(re);case"LineString":case"MultiLineString":return Ye=Z(K,H.type==="LineString"?0:1,Ue),new Up(Ye,B);case"Polygon":case"MultiPolygon":return Ye=Z(K,H.type==="Polygon"?1:2,Ue),new nm(Ye,B);case"GeometryCollection":for(At=0,ai=H.geometries.length;At<ai;At++){var rr=Gb({geometry:H.geometries[At],type:"Feature",properties:U.properties},B);rr&&re.push(rr)}return new Od(re);case"FeatureCollection":for(At=0,ai=H.features.length;At<ai;At++){var jr=Gb(H.features[At],B);jr&&re.push(jr)}return new Od(re);default:throw new Error("Invalid GeoJSON object.")}}function $(U,B,H,K){return U?U(B,H):new xA(H,K&&K.markersInheritOptions&&K)}function q(U){return new j(U[1],U[0],U[2])}function Z(U,B,H){for(var K=[],re=0,fe=U.length,Ue;re<fe;re++)Ue=B?Z(U[re],B-1,H):(H||q)(U[re]),K.push(Ue);return K}function te(U,B){return U=W(U),U.alt!==void 0?[p(U.lng,B),p(U.lat,B),p(U.alt,B)]:[p(U.lng,B),p(U.lat,B)]}function ae(U,B,H,K){for(var re=[],fe=0,Ue=U.length;fe<Ue;fe++)re.push(B?ae(U[fe],Lu(U[fe])?0:B-1,H,K):te(U[fe],K));return!B&&H&&re.length>0&&re.push(re[0].slice()),re}function de(U,B){return U.feature?n({},U.feature,{geometry:B}):Ae(B)}function Ae(U){return U.type==="Feature"||U.type==="FeatureCollection"?U:{type:"Feature",properties:{},geometry:U}}var ve={toGeoJSON:function(U){return de(this,{type:"Point",coordinates:te(this.getLatLng(),U)})}};xA.include(ve),ZE.include(ve),_A.include(ve),Up.include({toGeoJSON:function(U){var B=!Lu(this._latlngs),H=ae(this._latlngs,B?1:0,!1,U);return de(this,{type:(B?"Multi":"")+"LineString",coordinates:H})}}),nm.include({toGeoJSON:function(U){var B=!Lu(this._latlngs),H=B&&!Lu(this._latlngs[0]),K=ae(this._latlngs,H?2:B?1:0,!0,U);return B||(K=[K]),de(this,{type:(H?"Multi":"")+"Polygon",coordinates:K})}}),vv.include({toMultiPoint:function(U){var B=[];return this.eachLayer(function(H){B.push(H.toGeoJSON(U).geometry.coordinates)}),de(this,{type:"MultiPoint",coordinates:B})},toGeoJSON:function(U){var B=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(B==="MultiPoint")return this.toMultiPoint(U);var H=B==="GeometryCollection",K=[];return this.eachLayer(function(re){if(re.toGeoJSON){var fe=re.toGeoJSON(U);if(H)K.push(fe.geometry);else{var Ue=Ae(fe);Ue.type==="FeatureCollection"?K.push.apply(K,Ue.features):K.push(Ue)}}}),H?de(this,{geometries:K,type:"GeometryCollection"}):{type:"FeatureCollection",features:K}}});function Pe(U,B){return new ol(U,B)}var Ve=Pe,De=$u.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(U,B,H){this._url=U,this._bounds=Q(B),m(this,H)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Hi(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){xn(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(U){return this.options.opacity=U,this._image&&this._updateOpacity(),this},setStyle:function(U){return U.opacity&&this.setOpacity(U.opacity),this},bringToFront:function(){return this._map&&bs(this._image),this},bringToBack:function(){return this._map&&vo(this._image),this},setUrl:function(U){return this._url=U,this._image&&(this._image.src=U),this},setBounds:function(U){return this._bounds=Q(U),this._map&&this._reset(),this},getEvents:function(){var U={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(U.zoomanim=this._animateZoom),U},setZIndex:function(U){return this.options.zIndex=U,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var U=this._url.tagName==="IMG",B=this._image=U?this._url:Xt("img");if(Hi(B,"leaflet-image-layer"),this._zoomAnimated&&Hi(B,"leaflet-zoom-animated"),this.options.className&&Hi(B,this.options.className),B.onselectstart=d,B.onmousemove=d,B.onload=s(this.fire,this,"load"),B.onerror=s(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(B.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),U){this._url=B.src;return}B.src=this._url,B.alt=this.options.alt},_animateZoom:function(U){var B=this._map.getZoomScale(U.zoom),H=this._map._latLngBoundsToNewLayerBounds(this._bounds,U.zoom,U.center).min;Ai(this._image,H,B)},_reset:function(){var U=this._image,B=new V(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),H=B.getSize();_i(U,B.min),U.style.width=H.x+"px",U.style.height=H.y+"px"},_updateOpacity:function(){ls(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var U=this.options.errorOverlayUrl;U&&this._url!==U&&(this._url=U,this._image.src=U)},getCenter:function(){return this._bounds.getCenter()}}),Ee=function(U,B,H){return new De(U,B,H)},Ne=De.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var U=this._url.tagName==="VIDEO",B=this._image=U?this._url:Xt("video");if(Hi(B,"leaflet-image-layer"),this._zoomAnimated&&Hi(B,"leaflet-zoom-animated"),this.options.className&&Hi(B,this.options.className),B.onselectstart=d,B.onmousemove=d,B.onloadeddata=s(this.fire,this,"load"),U){for(var H=B.getElementsByTagName("source"),K=[],re=0;re<H.length;re++)K.push(H[re].src);this._url=H.length>0?K:[B.src];return}b(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(B.style,"objectFit")&&(B.style.objectFit="fill"),B.autoplay=!!this.options.autoplay,B.loop=!!this.options.loop,B.muted=!!this.options.muted,B.playsInline=!!this.options.playsInline;for(var fe=0;fe<this._url.length;fe++){var Ue=Xt("source");Ue.src=this._url[fe],B.appendChild(Ue)}}});function Be(U,B,H){return new Ne(U,B,H)}var Re=De.extend({_initImage:function(){var U=this._image=this._url;Hi(U,"leaflet-image-layer"),this._zoomAnimated&&Hi(U,"leaflet-zoom-animated"),this.options.className&&Hi(U,this.options.className),U.onselectstart=d,U.onmousemove=d}});function Me(U,B,H){return new Re(U,B,H)}var He=$u.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(U,B){U&&(U instanceof j||b(U))?(this._latlng=W(U),m(this,B)):(m(this,U),this._source=B),this.options.content&&(this._content=this.options.content)},openOn:function(U){return U=arguments.length?U:this._source._map,U.hasLayer(this)||U.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(U){return this._map?this.close():(arguments.length?this._source=U:U=this._source,this._prepareOpen(),this.openOn(U._map)),this},onAdd:function(U){this._zoomAnimated=U._zoomAnimated,this._container||this._initLayout(),U._fadeAnimated&&ls(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),U._fadeAnimated&&ls(this._container,1),this.bringToFront(),this.options.interactive&&(Hi(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(U){U._fadeAnimated?(ls(this._container,0),this._removeTimeout=setTimeout(s(xn,void 0,this._container),200)):xn(this._container),this.options.interactive&&(In(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(U){return this._latlng=W(U),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(U){return this._content=U,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var U={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(U.zoomanim=this._animateZoom),U},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&bs(this._container),this},bringToBack:function(){return this._map&&vo(this._container),this},_prepareOpen:function(U){var B=this._source;if(!B._map)return!1;if(B instanceof Od){B=null;var H=this._source._layers;for(var K in H)if(H[K]._map){B=H[K];break}if(!B)return!1;this._source=B}if(!U)if(B.getCenter)U=B.getCenter();else if(B.getLatLng)U=B.getLatLng();else if(B.getBounds)U=B.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(U),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var U=this._contentNode,B=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof B=="string")U.innerHTML=B;else{for(;U.hasChildNodes();)U.removeChild(U.firstChild);U.appendChild(B)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var U=this._map.latLngToLayerPoint(this._latlng),B=_(this.options.offset),H=this._getAnchor();this._zoomAnimated?_i(this._container,U.add(H)):B=B.add(U).add(H);var K=this._containerBottom=-B.y,re=this._containerLeft=-Math.round(this._containerWidth/2)+B.x;this._container.style.bottom=K+"px",this._container.style.left=re+"px"}},_getAnchor:function(){return[0,0]}});Zt.include({_initOverlay:function(U,B,H,K){var re=B;return re instanceof U||(re=new U(K).setContent(B)),H&&re.setLatLng(H),re}}),$u.include({_initOverlay:function(U,B,H,K){var re=H;return re instanceof U?(m(re,K),re._source=this):(re=B&&!K?B:new U(K,this),re.setContent(H)),re}});var ze=He.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(U){return U=arguments.length?U:this._source._map,!U.hasLayer(this)&&U._popup&&U._popup.options.autoClose&&U.removeLayer(U._popup),U._popup=this,He.prototype.openOn.call(this,U)},onAdd:function(U){He.prototype.onAdd.call(this,U),U.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof jn||this._source.on("preclick",Yn))},onRemove:function(U){He.prototype.onRemove.call(this,U),U.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof jn||this._source.off("preclick",Yn))},getEvents:function(){var U=He.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(U.preclick=this.close),this.options.keepInView&&(U.moveend=this._adjustPan),U},_initLayout:function(){var U="leaflet-popup",B=this._container=Xt("div",U+" "+(this.options.className||"")+" leaflet-zoom-animated"),H=this._wrapper=Xt("div",U+"-content-wrapper",B);if(this._contentNode=Xt("div",U+"-content",H),Ou(B),Ip(this._contentNode),pi(B,"contextmenu",Yn),this._tipContainer=Xt("div",U+"-tip-container",B),this._tip=Xt("div",U+"-tip",this._tipContainer),this.options.closeButton){var K=this._closeButton=Xt("a",U+"-close-button",B);K.setAttribute("role","button"),K.setAttribute("aria-label","Close popup"),K.href="#close",K.innerHTML='<span aria-hidden="true">&#215;</span>',pi(K,"click",function(re){Ga(re),this.close()},this)}},_updateLayout:function(){var U=this._contentNode,B=U.style;B.width="",B.whiteSpace="nowrap";var H=U.offsetWidth;H=Math.min(H,this.options.maxWidth),H=Math.max(H,this.options.minWidth),B.width=H+1+"px",B.whiteSpace="",B.height="";var K=U.offsetHeight,re=this.options.maxHeight,fe="leaflet-popup-scrolled";re&&K>re?(B.height=re+"px",Hi(U,fe)):In(U,fe),this._containerWidth=this._container.offsetWidth},_animateZoom:function(U){var B=this._map._latLngToNewLayerPoint(this._latlng,U.zoom,U.center),H=this._getAnchor();_i(this._container,B.add(H))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var U=this._map,B=parseInt(jc(this._container,"marginBottom"),10)||0,H=this._container.offsetHeight+B,K=this._containerWidth,re=new x(this._containerLeft,-H-this._containerBottom);re._add(Oi(this._container));var fe=U.layerPointToContainerPoint(re),Ue=_(this.options.autoPanPadding),Qe=_(this.options.autoPanPaddingTopLeft||Ue),Ye=_(this.options.autoPanPaddingBottomRight||Ue),At=U.getSize(),ai=0,rr=0;fe.x+K+Ye.x>At.x&&(ai=fe.x+K-At.x+Ye.x),fe.x-ai-Qe.x<0&&(ai=fe.x-Qe.x),fe.y+H+Ye.y>At.y&&(rr=fe.y+H-At.y+Ye.y),fe.y-rr-Qe.y<0&&(rr=fe.y-Qe.y),(ai||rr)&&(this.options.keepInView&&(this._autopanning=!0),U.fire("autopanstart").panBy([ai,rr]))}},_getAnchor:function(){return _(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),$e=function(U,B){return new ze(U,B)};Zt.mergeOptions({closePopupOnClick:!0}),Zt.include({openPopup:function(U,B,H){return this._initOverlay(ze,U,B,H).openOn(this),this},closePopup:function(U){return U=arguments.length?U:this._popup,U&&U.close(),this}}),$u.include({bindPopup:function(U,B){return this._popup=this._initOverlay(ze,this._popup,U,B),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(U){return this._popup&&(this instanceof Od||(this._popup._source=this),this._popup._prepareOpen(U||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(U){return this._popup&&this._popup.setContent(U),this},getPopup:function(){return this._popup},_openPopup:function(U){if(!(!this._popup||!this._map)){Dl(U);var B=U.layer||U.target;if(this._popup._source===B&&!(B instanceof jn)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(U.latlng);return}this._popup._source=B,this.openPopup(U.latlng)}},_movePopup:function(U){this._popup.setLatLng(U.latlng)},_onKeyPress:function(U){U.originalEvent.keyCode===13&&this._openPopup(U)}});var st=He.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(U){He.prototype.onAdd.call(this,U),this.setOpacity(this.options.opacity),U.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(U){He.prototype.onRemove.call(this,U),U.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var U=He.prototype.getEvents.call(this);return this.options.permanent||(U.preclick=this.close),U},_initLayout:function(){var U="leaflet-tooltip",B=U+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Xt("div",B),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(U){var B,H,K=this._map,re=this._container,fe=K.latLngToContainerPoint(K.getCenter()),Ue=K.layerPointToContainerPoint(U),Qe=this.options.direction,Ye=re.offsetWidth,At=re.offsetHeight,ai=_(this.options.offset),rr=this._getAnchor();Qe==="top"?(B=Ye/2,H=At):Qe==="bottom"?(B=Ye/2,H=0):Qe==="center"?(B=Ye/2,H=At/2):Qe==="right"?(B=0,H=At/2):Qe==="left"?(B=Ye,H=At/2):Ue.x<fe.x?(Qe="right",B=0,H=At/2):(Qe="left",B=Ye+(ai.x+rr.x)*2,H=At/2),U=U.subtract(_(B,H,!0)).add(ai).add(rr),In(re,"leaflet-tooltip-right"),In(re,"leaflet-tooltip-left"),In(re,"leaflet-tooltip-top"),In(re,"leaflet-tooltip-bottom"),Hi(re,"leaflet-tooltip-"+Qe),_i(re,U)},_updatePosition:function(){var U=this._map.latLngToLayerPoint(this._latlng);this._setPosition(U)},setOpacity:function(U){this.options.opacity=U,this._container&&ls(this._container,U)},_animateZoom:function(U){var B=this._map._latLngToNewLayerPoint(this._latlng,U.zoom,U.center);this._setPosition(B)},_getAnchor:function(){return _(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),bt=function(U,B){return new st(U,B)};Zt.include({openTooltip:function(U,B,H){return this._initOverlay(st,U,B,H).openOn(this),this},closeTooltip:function(U){return U.close(),this}}),$u.include({bindTooltip:function(U,B){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(st,this._tooltip,U,B),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(U){if(!(!U&&this._tooltipHandlersAdded)){var B=U?"off":"on",H={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?H.add=this._openTooltip:(H.mouseover=this._openTooltip,H.mouseout=this.closeTooltip,H.click=this._openTooltip,this._map?this._addFocusListeners():H.add=this._addFocusListeners),this._tooltip.options.sticky&&(H.mousemove=this._moveTooltip),this[B](H),this._tooltipHandlersAdded=!U}},openTooltip:function(U){return this._tooltip&&(this instanceof Od||(this._tooltip._source=this),this._tooltip._prepareOpen(U)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(U){return this._tooltip&&this._tooltip.setContent(U),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(U){var B=typeof U.getElement=="function"&&U.getElement();B&&(pi(B,"focus",function(){this._tooltip._source=U,this.openTooltip()},this),pi(B,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(U){var B=typeof U.getElement=="function"&&U.getElement();B&&B.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(U){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var B=this;this._map.once("moveend",function(){B._openOnceFlag=!1,B._openTooltip(U)});return}this._tooltip._source=U.layer||U.target,this.openTooltip(this._tooltip.options.sticky?U.latlng:void 0)}},_moveTooltip:function(U){var B=U.latlng,H,K;this._tooltip.options.sticky&&U.originalEvent&&(H=this._map.mouseEventToContainerPoint(U.originalEvent),K=this._map.containerPointToLayerPoint(H),B=this._map.layerPointToLatLng(K)),this._tooltip.setLatLng(B)}});var _t=kA.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(U){var B=U&&U.tagName==="DIV"?U:document.createElement("div"),H=this.options;if(H.html instanceof Element?(Cl(B),B.appendChild(H.html)):B.innerHTML=H.html!==!1?H.html:"",H.bgPos){var K=_(H.bgPos);B.style.backgroundPosition=-K.x+"px "+-K.y+"px"}return this._setIconStyles(B,"icon"),B},createShadow:function(){return null}});function Ot(U){return new _t(U)}kA.Default=Vb;var yt=$u.extend({options:{tileSize:256,opacity:1,updateWhenIdle:ti.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(U){m(this,U)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(U){U._addZoomLimit(this)},onRemove:function(U){this._removeAllTiles(),xn(this._container),U._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(bs(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(vo(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(U){return this.options.opacity=U,this._updateOpacity(),this},setZIndex:function(U){return this.options.zIndex=U,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var U=this._clampZoom(this._map.getZoom());U!==this._tileZoom&&(this._tileZoom=U,this._updateLevels()),this._update()}return this},getEvents:function(){var U={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=c(this._onMoveEnd,this.options.updateInterval,this)),U.move=this._onMove),this._zoomAnimated&&(U.zoomanim=this._animateZoom),U},createTile:function(){return document.createElement("div")},getTileSize:function(){var U=this.options.tileSize;return U instanceof x?U:new x(U,U)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(U){for(var B=this.getPane().children,H=-U(-1/0,1/0),K=0,re=B.length,fe;K<re;K++)fe=B[K].style.zIndex,B[K]!==this._container&&fe&&(H=U(H,+fe));isFinite(H)&&(this.options.zIndex=H+U(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!ti.ielt9){ls(this._container,this.options.opacity);var U=+new Date,B=!1,H=!1;for(var K in this._tiles){var re=this._tiles[K];if(!(!re.current||!re.loaded)){var fe=Math.min(1,(U-re.loaded)/200);ls(re.el,fe),fe<1?B=!0:(re.active?H=!0:this._onOpaqueTile(re),re.active=!0)}}H&&!this._noPrune&&this._pruneTiles(),B&&(P(this._fadeFrame),this._fadeFrame=E(this._updateOpacity,this))}},_onOpaqueTile:d,_initContainer:function(){this._container||(this._container=Xt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var U=this._tileZoom,B=this.options.maxZoom;if(U!==void 0){for(var H in this._levels)H=Number(H),this._levels[H].el.children.length||H===U?(this._levels[H].el.style.zIndex=B-Math.abs(U-H),this._onUpdateLevel(H)):(xn(this._levels[H].el),this._removeTilesAtZoom(H),this._onRemoveLevel(H),delete this._levels[H]);var K=this._levels[U],re=this._map;return K||(K=this._levels[U]={},K.el=Xt("div","leaflet-tile-container leaflet-zoom-animated",this._container),K.el.style.zIndex=B,K.origin=re.project(re.unproject(re.getPixelOrigin()),U).round(),K.zoom=U,this._setZoomTransform(K,re.getCenter(),re.getZoom()),d(K.el.offsetWidth),this._onCreateLevel(K)),this._level=K,K}},_onUpdateLevel:d,_onRemoveLevel:d,_onCreateLevel:d,_pruneTiles:function(){if(this._map){var U,B,H=this._map.getZoom();if(H>this.options.maxZoom||H<this.options.minZoom){this._removeAllTiles();return}for(U in this._tiles)B=this._tiles[U],B.retain=B.current;for(U in this._tiles)if(B=this._tiles[U],B.current&&!B.active){var K=B.coords;this._retainParent(K.x,K.y,K.z,K.z-5)||this._retainChildren(K.x,K.y,K.z,K.z+2)}for(U in this._tiles)this._tiles[U].retain||this._removeTile(U)}},_removeTilesAtZoom:function(U){for(var B in this._tiles)this._tiles[B].coords.z===U&&this._removeTile(B)},_removeAllTiles:function(){for(var U in this._tiles)this._removeTile(U)},_invalidateAll:function(){for(var U in this._levels)xn(this._levels[U].el),this._onRemoveLevel(Number(U)),delete this._levels[U];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(U,B,H,K){var re=Math.floor(U/2),fe=Math.floor(B/2),Ue=H-1,Qe=new x(+re,+fe);Qe.z=+Ue;var Ye=this._tileCoordsToKey(Qe),At=this._tiles[Ye];return At&&At.active?(At.retain=!0,!0):(At&&At.loaded&&(At.retain=!0),Ue>K?this._retainParent(re,fe,Ue,K):!1)},_retainChildren:function(U,B,H,K){for(var re=2*U;re<2*U+2;re++)for(var fe=2*B;fe<2*B+2;fe++){var Ue=new x(re,fe);Ue.z=H+1;var Qe=this._tileCoordsToKey(Ue),Ye=this._tiles[Qe];if(Ye&&Ye.active){Ye.retain=!0;continue}else Ye&&Ye.loaded&&(Ye.retain=!0);H+1<K&&this._retainChildren(re,fe,H+1,K)}},_resetView:function(U){var B=U&&(U.pinch||U.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),B,B)},_animateZoom:function(U){this._setView(U.center,U.zoom,!0,U.noUpdate)},_clampZoom:function(U){var B=this.options;return B.minNativeZoom!==void 0&&U<B.minNativeZoom?B.minNativeZoom:B.maxNativeZoom!==void 0&&B.maxNativeZoom<U?B.maxNativeZoom:U},_setView:function(U,B,H,K){var re=Math.round(B);this.options.maxZoom!==void 0&&re>this.options.maxZoom||this.options.minZoom!==void 0&&re<this.options.minZoom?re=void 0:re=this._clampZoom(re);var fe=this.options.updateWhenZooming&&re!==this._tileZoom;(!K||fe)&&(this._tileZoom=re,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),re!==void 0&&this._update(U),H||this._pruneTiles(),this._noPrune=!!H),this._setZoomTransforms(U,B)},_setZoomTransforms:function(U,B){for(var H in this._levels)this._setZoomTransform(this._levels[H],U,B)},_setZoomTransform:function(U,B,H){var K=this._map.getZoomScale(H,U.zoom),re=U.origin.multiplyBy(K).subtract(this._map._getNewPixelOrigin(B,H)).round();ti.any3d?Ai(U.el,re,K):_i(U.el,re)},_resetGrid:function(){var U=this._map,B=U.options.crs,H=this._tileSize=this.getTileSize(),K=this._tileZoom,re=this._map.getPixelWorldBounds(this._tileZoom);re&&(this._globalTileRange=this._pxBoundsToTileRange(re)),this._wrapX=B.wrapLng&&!this.options.noWrap&&[Math.floor(U.project([0,B.wrapLng[0]],K).x/H.x),Math.ceil(U.project([0,B.wrapLng[1]],K).x/H.y)],this._wrapY=B.wrapLat&&!this.options.noWrap&&[Math.floor(U.project([B.wrapLat[0],0],K).y/H.x),Math.ceil(U.project([B.wrapLat[1],0],K).y/H.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(U){var B=this._map,H=B._animatingZoom?Math.max(B._animateToZoom,B.getZoom()):B.getZoom(),K=B.getZoomScale(H,this._tileZoom),re=B.project(U,this._tileZoom).floor(),fe=B.getSize().divideBy(K*2);return new V(re.subtract(fe),re.add(fe))},_update:function(U){var B=this._map;if(B){var H=this._clampZoom(B.getZoom());if(U===void 0&&(U=B.getCenter()),this._tileZoom!==void 0){var K=this._getTiledPixelBounds(U),re=this._pxBoundsToTileRange(K),fe=re.getCenter(),Ue=[],Qe=this.options.keepBuffer,Ye=new V(re.getBottomLeft().subtract([Qe,-Qe]),re.getTopRight().add([Qe,-Qe]));if(!(isFinite(re.min.x)&&isFinite(re.min.y)&&isFinite(re.max.x)&&isFinite(re.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var At in this._tiles){var ai=this._tiles[At].coords;(ai.z!==this._tileZoom||!Ye.contains(new x(ai.x,ai.y)))&&(this._tiles[At].current=!1)}if(Math.abs(H-this._tileZoom)>1){this._setView(U,H);return}for(var rr=re.min.y;rr<=re.max.y;rr++)for(var jr=re.min.x;jr<=re.max.x;jr++){var qc=new x(jr,rr);if(qc.z=this._tileZoom,!!this._isValidTile(qc)){var ll=this._tiles[this._tileCoordsToKey(qc)];ll?ll.current=!0:Ue.push(qc)}}if(Ue.sort(function(Vu,GS){return Vu.distanceTo(fe)-GS.distanceTo(fe)}),Ue.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Tp=document.createDocumentFragment();for(jr=0;jr<Ue.length;jr++)this._addTile(Ue[jr],Tp);this._level.el.appendChild(Tp)}}}},_isValidTile:function(U){var B=this._map.options.crs;if(!B.infinite){var H=this._globalTileRange;if(!B.wrapLng&&(U.x<H.min.x||U.x>H.max.x)||!B.wrapLat&&(U.y<H.min.y||U.y>H.max.y))return!1}if(!this.options.bounds)return!0;var K=this._tileCoordsToBounds(U);return Q(this.options.bounds).overlaps(K)},_keyToBounds:function(U){return this._tileCoordsToBounds(this._keyToTileCoords(U))},_tileCoordsToNwSe:function(U){var B=this._map,H=this.getTileSize(),K=U.scaleBy(H),re=K.add(H),fe=B.unproject(K,U.z),Ue=B.unproject(re,U.z);return[fe,Ue]},_tileCoordsToBounds:function(U){var B=this._tileCoordsToNwSe(U),H=new z(B[0],B[1]);return this.options.noWrap||(H=this._map.wrapLatLngBounds(H)),H},_tileCoordsToKey:function(U){return U.x+":"+U.y+":"+U.z},_keyToTileCoords:function(U){var B=U.split(":"),H=new x(+B[0],+B[1]);return H.z=+B[2],H},_removeTile:function(U){var B=this._tiles[U];B&&(xn(B.el),delete this._tiles[U],this.fire("tileunload",{tile:B.el,coords:this._keyToTileCoords(U)}))},_initTile:function(U){Hi(U,"leaflet-tile");var B=this.getTileSize();U.style.width=B.x+"px",U.style.height=B.y+"px",U.onselectstart=d,U.onmousemove=d,ti.ielt9&&this.options.opacity<1&&ls(U,this.options.opacity)},_addTile:function(U,B){var H=this._getTilePos(U),K=this._tileCoordsToKey(U),re=this.createTile(this._wrapCoords(U),s(this._tileReady,this,U));this._initTile(re),this.createTile.length<2&&E(s(this._tileReady,this,U,null,re)),_i(re,H),this._tiles[K]={el:re,coords:U,current:!0},B.appendChild(re),this.fire("tileloadstart",{tile:re,coords:U})},_tileReady:function(U,B,H){B&&this.fire("tileerror",{error:B,tile:H,coords:U});var K=this._tileCoordsToKey(U);H=this._tiles[K],H&&(H.loaded=+new Date,this._map._fadeAnimated?(ls(H.el,0),P(this._fadeFrame),this._fadeFrame=E(this._updateOpacity,this)):(H.active=!0,this._pruneTiles()),B||(Hi(H.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:H.el,coords:U})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),ti.ielt9||!this._map._fadeAnimated?E(this._pruneTiles,this):setTimeout(s(this._pruneTiles,this),250)))},_getTilePos:function(U){return U.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(U){var B=new x(this._wrapX?u(U.x,this._wrapX):U.x,this._wrapY?u(U.y,this._wrapY):U.y);return B.z=U.z,B},_pxBoundsToTileRange:function(U){var B=this.getTileSize();return new V(U.min.unscaleBy(B).floor(),U.max.unscaleBy(B).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var U in this._tiles)if(!this._tiles[U].loaded)return!1;return!0}});function ni(U){return new yt(U)}var Vt=yt.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(U,B){this._url=U,B=m(this,B),B.detectRetina&&ti.retina&&B.maxZoom>0?(B.tileSize=Math.floor(B.tileSize/2),B.zoomReverse?(B.zoomOffset--,B.minZoom=Math.min(B.maxZoom,B.minZoom+1)):(B.zoomOffset++,B.maxZoom=Math.max(B.minZoom,B.maxZoom-1)),B.minZoom=Math.max(0,B.minZoom)):B.zoomReverse?B.minZoom=Math.min(B.maxZoom,B.minZoom):B.maxZoom=Math.max(B.minZoom,B.maxZoom),typeof B.subdomains=="string"&&(B.subdomains=B.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(U,B){return this._url===U&&B===void 0&&(B=!0),this._url=U,B||this.redraw(),this},createTile:function(U,B){var H=document.createElement("img");return pi(H,"load",s(this._tileOnLoad,this,B,H)),pi(H,"error",s(this._tileOnError,this,B,H)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(H.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(H.referrerPolicy=this.options.referrerPolicy),H.alt="",H.src=this.getTileUrl(U),H},getTileUrl:function(U){var B={r:ti.retina?"@2x":"",s:this._getSubdomain(U),x:U.x,y:U.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var H=this._globalTileRange.max.y-U.y;this.options.tms&&(B.y=H),B["-y"]=H}return v(this._url,n(B,this.options))},_tileOnLoad:function(U,B){ti.ielt9?setTimeout(s(U,this,null,B),0):U(null,B)},_tileOnError:function(U,B,H){var K=this.options.errorTileUrl;K&&B.getAttribute("src")!==K&&(B.src=K),U(H,B)},_onTileRemove:function(U){U.tile.onload=null},_getZoomForUrl:function(){var U=this._tileZoom,B=this.options.maxZoom,H=this.options.zoomReverse,K=this.options.zoomOffset;return H&&(U=B-U),U+K},_getSubdomain:function(U){var B=Math.abs(U.x+U.y)%this.options.subdomains.length;return this.options.subdomains[B]},_abortLoading:function(){var U,B;for(U in this._tiles)if(this._tiles[U].coords.z!==this._tileZoom&&(B=this._tiles[U].el,B.onload=d,B.onerror=d,!B.complete)){B.src=I;var H=this._tiles[U].coords;xn(B),delete this._tiles[U],this.fire("tileabort",{tile:B,coords:H})}},_removeTile:function(U){var B=this._tiles[U];if(B)return B.el.setAttribute("src",I),yt.prototype._removeTile.call(this,U)},_tileReady:function(U,B,H){if(!(!this._map||H&&H.getAttribute("src")===I))return yt.prototype._tileReady.call(this,U,B,H)}});function Rt(U,B){return new Vt(U,B)}var oi=Vt.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(U,B){this._url=U;var H=n({},this.defaultWmsParams);for(var K in B)K in this.options||(H[K]=B[K]);B=m(this,B);var re=B.detectRetina&&ti.retina?2:1,fe=this.getTileSize();H.width=fe.x*re,H.height=fe.y*re,this.wmsParams=H},onAdd:function(U){this._crs=this.options.crs||U.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var B=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[B]=this._crs.code,Vt.prototype.onAdd.call(this,U)},getTileUrl:function(U){var B=this._tileCoordsToNwSe(U),H=this._crs,K=G(H.project(B[0]),H.project(B[1])),re=K.min,fe=K.max,Ue=(this._wmsVersion>=1.3&&this._crs===qN?[re.y,re.x,fe.y,fe.x]:[re.x,re.y,fe.x,fe.y]).join(","),Qe=Vt.prototype.getTileUrl.call(this,U);return Qe+A(this.wmsParams,Qe,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Ue},setParams:function(U,B){return n(this.wmsParams,U),B||this.redraw(),this}});function on(U,B){return new oi(U,B)}Vt.WMS=oi,Rt.wms=on;var Tr=$u.extend({options:{padding:.1},initialize:function(U){m(this,U),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Hi(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var U={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(U.zoomanim=this._onAnimZoom),U},_onAnimZoom:function(U){this._updateTransform(U.center,U.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(U,B){var H=this._map.getZoomScale(B,this._zoom),K=this._map.getSize().multiplyBy(.5+this.options.padding),re=this._map.project(this._center,B),fe=K.multiplyBy(-H).add(re).subtract(this._map._getNewPixelOrigin(U,B));ti.any3d?Ai(this._container,fe,H):_i(this._container,fe)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var U in this._layers)this._layers[U]._reset()},_onZoomEnd:function(){for(var U in this._layers)this._layers[U]._project()},_updatePaths:function(){for(var U in this._layers)this._layers[U]._update()},_update:function(){var U=this.options.padding,B=this._map.getSize(),H=this._map.containerPointToLayerPoint(B.multiplyBy(-U)).round();this._bounds=new V(H,H.add(B.multiplyBy(1+U*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Vi=Tr.extend({options:{tolerance:0},getEvents:function(){var U=Tr.prototype.getEvents.call(this);return U.viewprereset=this._onViewPreReset,U},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Tr.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var U=this._container=document.createElement("canvas");pi(U,"mousemove",this._onMouseMove,this),pi(U,"click dblclick mousedown mouseup contextmenu",this._onClick,this),pi(U,"mouseout",this._handleMouseOut,this),U._leaflet_disable_events=!0,this._ctx=U.getContext("2d")},_destroyContainer:function(){P(this._redrawRequest),delete this._ctx,xn(this._container),Fr(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var U;this._redrawBounds=null;for(var B in this._layers)U=this._layers[B],U._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Tr.prototype._update.call(this);var U=this._bounds,B=this._container,H=U.getSize(),K=ti.retina?2:1;_i(B,U.min),B.width=K*H.x,B.height=K*H.y,B.style.width=H.x+"px",B.style.height=H.y+"px",ti.retina&&this._ctx.scale(2,2),this._ctx.translate(-U.min.x,-U.min.y),this.fire("update")}},_reset:function(){Tr.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(U){this._updateDashArray(U),this._layers[l(U)]=U;var B=U._order={layer:U,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=B),this._drawLast=B,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(U){this._requestRedraw(U)},_removePath:function(U){var B=U._order,H=B.next,K=B.prev;H?H.prev=K:this._drawLast=K,K?K.next=H:this._drawFirst=H,delete U._order,delete this._layers[l(U)],this._requestRedraw(U)},_updatePath:function(U){this._extendRedrawBounds(U),U._project(),U._update(),this._requestRedraw(U)},_updateStyle:function(U){this._updateDashArray(U),this._requestRedraw(U)},_updateDashArray:function(U){if(typeof U.options.dashArray=="string"){var B=U.options.dashArray.split(/[, ]+/),H=[],K,re;for(re=0;re<B.length;re++){if(K=Number(B[re]),isNaN(K))return;H.push(K)}U.options._dashArray=H}else U.options._dashArray=U.options.dashArray},_requestRedraw:function(U){this._map&&(this._extendRedrawBounds(U),this._redrawRequest=this._redrawRequest||E(this._redraw,this))},_extendRedrawBounds:function(U){if(U._pxBounds){var B=(U.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new V,this._redrawBounds.extend(U._pxBounds.min.subtract([B,B])),this._redrawBounds.extend(U._pxBounds.max.add([B,B]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var U=this._redrawBounds;if(U){var B=U.getSize();this._ctx.clearRect(U.min.x,U.min.y,B.x,B.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var U,B=this._redrawBounds;if(this._ctx.save(),B){var H=B.getSize();this._ctx.beginPath(),this._ctx.rect(B.min.x,B.min.y,H.x,H.y),this._ctx.clip()}this._drawing=!0;for(var K=this._drawFirst;K;K=K.next)U=K.layer,(!B||U._pxBounds&&U._pxBounds.intersects(B))&&U._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(U,B){if(this._drawing){var H,K,re,fe,Ue=U._parts,Qe=Ue.length,Ye=this._ctx;if(Qe){for(Ye.beginPath(),H=0;H<Qe;H++){for(K=0,re=Ue[H].length;K<re;K++)fe=Ue[H][K],Ye[K?"lineTo":"moveTo"](fe.x,fe.y);B&&Ye.closePath()}this._fillStroke(Ye,U)}}},_updateCircle:function(U){if(!(!this._drawing||U._empty())){var B=U._point,H=this._ctx,K=Math.max(Math.round(U._radius),1),re=(Math.max(Math.round(U._radiusY),1)||K)/K;re!==1&&(H.save(),H.scale(1,re)),H.beginPath(),H.arc(B.x,B.y/re,K,0,Math.PI*2,!1),re!==1&&H.restore(),this._fillStroke(H,U)}},_fillStroke:function(U,B){var H=B.options;H.fill&&(U.globalAlpha=H.fillOpacity,U.fillStyle=H.fillColor||H.color,U.fill(H.fillRule||"evenodd")),H.stroke&&H.weight!==0&&(U.setLineDash&&U.setLineDash(B.options&&B.options._dashArray||[]),U.globalAlpha=H.opacity,U.lineWidth=H.weight,U.strokeStyle=H.color,U.lineCap=H.lineCap,U.lineJoin=H.lineJoin,U.stroke())},_onClick:function(U){for(var B=this._map.mouseEventToLayerPoint(U),H,K,re=this._drawFirst;re;re=re.next)H=re.layer,H.options.interactive&&H._containsPoint(B)&&(!(U.type==="click"||U.type==="preclick")||!this._map._draggableMoved(H))&&(K=H);this._fireEvent(K?[K]:!1,U)},_onMouseMove:function(U){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var B=this._map.mouseEventToLayerPoint(U);this._handleMouseHover(U,B)}},_handleMouseOut:function(U){var B=this._hoveredLayer;B&&(In(this._container,"leaflet-interactive"),this._fireEvent([B],U,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(U,B){if(!this._mouseHoverThrottled){for(var H,K,re=this._drawFirst;re;re=re.next)H=re.layer,H.options.interactive&&H._containsPoint(B)&&(K=H);K!==this._hoveredLayer&&(this._handleMouseOut(U),K&&(Hi(this._container,"leaflet-interactive"),this._fireEvent([K],U,"mouseover"),this._hoveredLayer=K)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,U),this._mouseHoverThrottled=!0,setTimeout(s(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(U,B,H){this._map._fireDOMEvent(B,H||B.type,U)},_bringToFront:function(U){var B=U._order;if(B){var H=B.next,K=B.prev;if(H)H.prev=K;else return;K?K.next=H:H&&(this._drawFirst=H),B.prev=this._drawLast,this._drawLast.next=B,B.next=null,this._drawLast=B,this._requestRedraw(U)}},_bringToBack:function(U){var B=U._order;if(B){var H=B.next,K=B.prev;if(K)K.next=H;else return;H?H.prev=K:K&&(this._drawLast=K),B.prev=null,B.next=this._drawFirst,this._drawFirst.prev=B,this._drawFirst=B,this._requestRedraw(U)}}});function Cr(U){return ti.canvas?new Vi(U):null}var Xn=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(U){return document.createElement("<lvml:"+U+' class="lvml">')}}catch{}return function(U){return document.createElement("<"+U+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),Hu={_initContainer:function(){this._container=Xt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Tr.prototype._update.call(this),this.fire("update"))},_initPath:function(U){var B=U._container=Xn("shape");Hi(B,"leaflet-vml-shape "+(this.options.className||"")),B.coordsize="1 1",U._path=Xn("path"),B.appendChild(U._path),this._updateStyle(U),this._layers[l(U)]=U},_addPath:function(U){var B=U._container;this._container.appendChild(B),U.options.interactive&&U.addInteractiveTarget(B)},_removePath:function(U){var B=U._container;xn(B),U.removeInteractiveTarget(B),delete this._layers[l(U)]},_updateStyle:function(U){var B=U._stroke,H=U._fill,K=U.options,re=U._container;re.stroked=!!K.stroke,re.filled=!!K.fill,K.stroke?(B||(B=U._stroke=Xn("stroke")),re.appendChild(B),B.weight=K.weight+"px",B.color=K.color,B.opacity=K.opacity,K.dashArray?B.dashStyle=b(K.dashArray)?K.dashArray.join(" "):K.dashArray.replace(/( *, *)/g," "):B.dashStyle="",B.endcap=K.lineCap.replace("butt","flat"),B.joinstyle=K.lineJoin):B&&(re.removeChild(B),U._stroke=null),K.fill?(H||(H=U._fill=Xn("fill")),re.appendChild(H),H.color=K.fillColor||K.color,H.opacity=K.fillOpacity):H&&(re.removeChild(H),U._fill=null)},_updateCircle:function(U){var B=U._point.round(),H=Math.round(U._radius),K=Math.round(U._radiusY||H);this._setPath(U,U._empty()?"M0 0":"AL "+B.x+","+B.y+" "+H+","+K+" 0,"+65535*360)},_setPath:function(U,B){U._path.v=B},_bringToFront:function(U){bs(U._container)},_bringToBack:function(U){vo(U._container)}},Ra=ti.vml?Xn:Ie,Fd=Tr.extend({_initContainer:function(){this._container=Ra("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Ra("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){xn(this._container),Fr(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Tr.prototype._update.call(this);var U=this._bounds,B=U.getSize(),H=this._container;(!this._svgSize||!this._svgSize.equals(B))&&(this._svgSize=B,H.setAttribute("width",B.x),H.setAttribute("height",B.y)),_i(H,U.min),H.setAttribute("viewBox",[U.min.x,U.min.y,B.x,B.y].join(" ")),this.fire("update")}},_initPath:function(U){var B=U._path=Ra("path");U.options.className&&Hi(B,U.options.className),U.options.interactive&&Hi(B,"leaflet-interactive"),this._updateStyle(U),this._layers[l(U)]=U},_addPath:function(U){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(U._path),U.addInteractiveTarget(U._path)},_removePath:function(U){xn(U._path),U.removeInteractiveTarget(U._path),delete this._layers[l(U)]},_updatePath:function(U){U._project(),U._update()},_updateStyle:function(U){var B=U._path,H=U.options;B&&(H.stroke?(B.setAttribute("stroke",H.color),B.setAttribute("stroke-opacity",H.opacity),B.setAttribute("stroke-width",H.weight),B.setAttribute("stroke-linecap",H.lineCap),B.setAttribute("stroke-linejoin",H.lineJoin),H.dashArray?B.setAttribute("stroke-dasharray",H.dashArray):B.removeAttribute("stroke-dasharray"),H.dashOffset?B.setAttribute("stroke-dashoffset",H.dashOffset):B.removeAttribute("stroke-dashoffset")):B.setAttribute("stroke","none"),H.fill?(B.setAttribute("fill",H.fillColor||H.color),B.setAttribute("fill-opacity",H.fillOpacity),B.setAttribute("fill-rule",H.fillRule||"evenodd")):B.setAttribute("fill","none"))},_updatePoly:function(U,B){this._setPath(U,xe(U._parts,B))},_updateCircle:function(U){var B=U._point,H=Math.max(Math.round(U._radius),1),K=Math.max(Math.round(U._radiusY),1)||H,re="a"+H+","+K+" 0 1,0 ",fe=U._empty()?"M0 0":"M"+(B.x-H)+","+B.y+re+H*2+",0 "+re+-H*2+",0 ";this._setPath(U,fe)},_setPath:function(U,B){U._path.setAttribute("d",B)},_bringToFront:function(U){bs(U._path)},_bringToBack:function(U){vo(U._path)}});ti.vml&&Fd.include(Hu);function VS(U){return ti.svg||ti.vml?new Fd(U):null}Zt.include({getRenderer:function(U){var B=U.options.renderer||this._getPaneRenderer(U.options.pane)||this.options.renderer||this._renderer;return B||(B=this._renderer=this._createRenderer()),this.hasLayer(B)||this.addLayer(B),B},_getPaneRenderer:function(U){if(U==="overlayPane"||U===void 0)return!1;var B=this._paneRenderers[U];return B===void 0&&(B=this._createRenderer({pane:U}),this._paneRenderers[U]=B),B},_createRenderer:function(U){return this.options.preferCanvas&&Cr(U)||VS(U)}});var NJ=nm.extend({initialize:function(U,B){nm.prototype.initialize.call(this,this._boundsToLatLngs(U),B)},setBounds:function(U){return this.setLatLngs(this._boundsToLatLngs(U))},_boundsToLatLngs:function(U){return U=Q(U),[U.getSouthWest(),U.getNorthWest(),U.getNorthEast(),U.getSouthEast()]}});function D_e(U,B){return new NJ(U,B)}Fd.create=Ra,Fd.pointsToPath=xe,ol.geometryToLayer=Gb,ol.coordsToLatLng=q,ol.coordsToLatLngs=Z,ol.latLngToCoords=te,ol.latLngsToCoords=ae,ol.getFeature=de,ol.asFeature=Ae,Zt.mergeOptions({boxZoom:!0});var BJ=Gs.extend({initialize:function(U){this._map=U,this._container=U._container,this._pane=U._panes.overlayPane,this._resetStateTimeout=0,U.on("unload",this._destroy,this)},addHooks:function(){pi(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Fr(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){xn(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(U){if(!U.shiftKey||U.which!==1&&U.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),wn(),El(),this._startPoint=this._map.mouseEventToContainerPoint(U),pi(document,{contextmenu:Dl,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(U){this._moved||(this._moved=!0,this._box=Xt("div","leaflet-zoom-box",this._container),Hi(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(U);var B=new V(this._point,this._startPoint),H=B.getSize();_i(this._box,B.min),this._box.style.width=H.x+"px",this._box.style.height=H.y+"px"},_finish:function(){this._moved&&(xn(this._box),In(this._container,"leaflet-crosshair")),Va(),RA(),Fr(document,{contextmenu:Dl,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(U){if(!(U.which!==1&&U.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(s(this._resetState,this),0);var B=new z(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(B).fire("boxzoomend",{boxZoomBounds:B})}},_onKeyDown:function(U){U.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Zt.addInitHook("addHandler","boxZoom",BJ),Zt.mergeOptions({doubleClickZoom:!0});var kJ=Gs.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(U){var B=this._map,H=B.getZoom(),K=B.options.zoomDelta,re=U.originalEvent.shiftKey?H-K:H+K;B.options.doubleClickZoom==="center"?B.setZoom(re):B.setZoomAround(U.containerPoint,re)}});Zt.addInitHook("addHandler","doubleClickZoom",kJ),Zt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var xJ=Gs.extend({addHooks:function(){if(!this._draggable){var U=this._map;this._draggable=new wp(U._mapPane,U._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),U.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),U.on("zoomend",this._onZoomEnd,this),U.whenReady(this._onZoomEnd,this))}Hi(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){In(this._map._container,"leaflet-grab"),In(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var U=this._map;if(U._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var B=Q(this._map.options.maxBounds);this._offsetLimit=G(this._map.latLngToContainerPoint(B.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(B.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;U.fire("movestart").fire("dragstart"),U.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(U){if(this._map.options.inertia){var B=this._lastTime=+new Date,H=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(H),this._times.push(B),this._prunePositions(B)}this._map.fire("move",U).fire("drag",U)},_prunePositions:function(U){for(;this._positions.length>1&&U-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var U=this._map.getSize().divideBy(2),B=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=B.subtract(U).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(U,B){return U-(U-B)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var U=this._draggable._newPos.subtract(this._draggable._startPos),B=this._offsetLimit;U.x<B.min.x&&(U.x=this._viscousLimit(U.x,B.min.x)),U.y<B.min.y&&(U.y=this._viscousLimit(U.y,B.min.y)),U.x>B.max.x&&(U.x=this._viscousLimit(U.x,B.max.x)),U.y>B.max.y&&(U.y=this._viscousLimit(U.y,B.max.y)),this._draggable._newPos=this._draggable._startPos.add(U)}},_onPreDragWrap:function(){var U=this._worldWidth,B=Math.round(U/2),H=this._initialWorldOffset,K=this._draggable._newPos.x,re=(K-B+H)%U+B-H,fe=(K+B+H)%U-B-H,Ue=Math.abs(re+H)<Math.abs(fe+H)?re:fe;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Ue},_onDragEnd:function(U){var B=this._map,H=B.options,K=!H.inertia||U.noInertia||this._times.length<2;if(B.fire("dragend",U),K)B.fire("moveend");else{this._prunePositions(+new Date);var re=this._lastPos.subtract(this._positions[0]),fe=(this._lastTime-this._times[0])/1e3,Ue=H.easeLinearity,Qe=re.multiplyBy(Ue/fe),Ye=Qe.distanceTo([0,0]),At=Math.min(H.inertiaMaxSpeed,Ye),ai=Qe.multiplyBy(At/Ye),rr=At/(H.inertiaDeceleration*Ue),jr=ai.multiplyBy(-rr/2).round();!jr.x&&!jr.y?B.fire("moveend"):(jr=B._limitOffset(jr,B.options.maxBounds),E(function(){B.panBy(jr,{duration:rr,easeLinearity:Ue,noMoveStart:!0,animate:!0})}))}}});Zt.addInitHook("addHandler","dragging",xJ),Zt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var _J=Gs.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(U){this._map=U,this._setPanDelta(U.options.keyboardPanDelta),this._setZoomDelta(U.options.zoomDelta)},addHooks:function(){var U=this._map._container;U.tabIndex<=0&&(U.tabIndex="0"),pi(U,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Fr(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var U=document.body,B=document.documentElement,H=U.scrollTop||B.scrollTop,K=U.scrollLeft||B.scrollLeft;this._map._container.focus(),window.scrollTo(K,H)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(U){var B=this._panKeys={},H=this.keyCodes,K,re;for(K=0,re=H.left.length;K<re;K++)B[H.left[K]]=[-1*U,0];for(K=0,re=H.right.length;K<re;K++)B[H.right[K]]=[U,0];for(K=0,re=H.down.length;K<re;K++)B[H.down[K]]=[0,U];for(K=0,re=H.up.length;K<re;K++)B[H.up[K]]=[0,-1*U]},_setZoomDelta:function(U){var B=this._zoomKeys={},H=this.keyCodes,K,re;for(K=0,re=H.zoomIn.length;K<re;K++)B[H.zoomIn[K]]=U;for(K=0,re=H.zoomOut.length;K<re;K++)B[H.zoomOut[K]]=-U},_addHooks:function(){pi(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Fr(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(U){if(!(U.altKey||U.ctrlKey||U.metaKey)){var B=U.keyCode,H=this._map,K;if(B in this._panKeys){if(!H._panAnim||!H._panAnim._inProgress)if(K=this._panKeys[B],U.shiftKey&&(K=_(K).multiplyBy(3)),H.options.maxBounds&&(K=H._limitOffset(_(K),H.options.maxBounds)),H.options.worldCopyJump){var re=H.wrapLatLng(H.unproject(H.project(H.getCenter()).add(K)));H.panTo(re)}else H.panBy(K)}else if(B in this._zoomKeys)H.setZoom(H.getZoom()+(U.shiftKey?3:1)*this._zoomKeys[B]);else if(B===27&&H._popup&&H._popup.options.closeOnEscapeKey)H.closePopup();else return;Dl(U)}}});Zt.addInitHook("addHandler","keyboard",_J),Zt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var OJ=Gs.extend({addHooks:function(){pi(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Fr(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(U){var B=at(U),H=this._map.options.wheelDebounceTime;this._delta+=B,this._lastMousePos=this._map.mouseEventToContainerPoint(U),this._startTime||(this._startTime=+new Date);var K=Math.max(H-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(s(this._performZoom,this),K),Dl(U)},_performZoom:function(){var U=this._map,B=U.getZoom(),H=this._map.options.zoomSnap||0;U._stop();var K=this._delta/(this._map.options.wheelPxPerZoomLevel*4),re=4*Math.log(2/(1+Math.exp(-Math.abs(K))))/Math.LN2,fe=H?Math.ceil(re/H)*H:re,Ue=U._limitZoom(B+(this._delta>0?fe:-fe))-B;this._delta=0,this._startTime=null,Ue&&(U.options.scrollWheelZoom==="center"?U.setZoom(B+Ue):U.setZoomAround(this._lastMousePos,B+Ue))}});Zt.addInitHook("addHandler","scrollWheelZoom",OJ);var P_e=600;Zt.mergeOptions({tapHold:ti.touchNative&&ti.safari&&ti.mobile,tapTolerance:15});var FJ=Gs.extend({addHooks:function(){pi(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Fr(this._map._container,"touchstart",this._onDown,this)},_onDown:function(U){if(clearTimeout(this._holdTimeout),U.touches.length===1){var B=U.touches[0];this._startPos=this._newPos=new x(B.clientX,B.clientY),this._holdTimeout=setTimeout(s(function(){this._cancel(),this._isTapValid()&&(pi(document,"touchend",Ga),pi(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",B))},this),P_e),pi(document,"touchend touchcancel contextmenu",this._cancel,this),pi(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function U(){Fr(document,"touchend",Ga),Fr(document,"touchend touchcancel",U)},_cancel:function(){clearTimeout(this._holdTimeout),Fr(document,"touchend touchcancel contextmenu",this._cancel,this),Fr(document,"touchmove",this._onMove,this)},_onMove:function(U){var B=U.touches[0];this._newPos=new x(B.clientX,B.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(U,B){var H=new MouseEvent(U,{bubbles:!0,cancelable:!0,view:window,screenX:B.screenX,screenY:B.screenY,clientX:B.clientX,clientY:B.clientY});H._simulated=!0,B.target.dispatchEvent(H)}});Zt.addInitHook("addHandler","tapHold",FJ),Zt.mergeOptions({touchZoom:ti.touch,bounceAtZoomLimits:!0});var LJ=Gs.extend({addHooks:function(){Hi(this._map._container,"leaflet-touch-zoom"),pi(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){In(this._map._container,"leaflet-touch-zoom"),Fr(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(U){var B=this._map;if(!(!U.touches||U.touches.length!==2||B._animatingZoom||this._zooming)){var H=B.mouseEventToContainerPoint(U.touches[0]),K=B.mouseEventToContainerPoint(U.touches[1]);this._centerPoint=B.getSize()._divideBy(2),this._startLatLng=B.containerPointToLatLng(this._centerPoint),B.options.touchZoom!=="center"&&(this._pinchStartLatLng=B.containerPointToLatLng(H.add(K)._divideBy(2))),this._startDist=H.distanceTo(K),this._startZoom=B.getZoom(),this._moved=!1,this._zooming=!0,B._stop(),pi(document,"touchmove",this._onTouchMove,this),pi(document,"touchend touchcancel",this._onTouchEnd,this),Ga(U)}},_onTouchMove:function(U){if(!(!U.touches||U.touches.length!==2||!this._zooming)){var B=this._map,H=B.mouseEventToContainerPoint(U.touches[0]),K=B.mouseEventToContainerPoint(U.touches[1]),re=H.distanceTo(K)/this._startDist;if(this._zoom=B.getScaleZoom(re,this._startZoom),!B.options.bounceAtZoomLimits&&(this._zoom<B.getMinZoom()&&re<1||this._zoom>B.getMaxZoom()&&re>1)&&(this._zoom=B._limitZoom(this._zoom)),B.options.touchZoom==="center"){if(this._center=this._startLatLng,re===1)return}else{var fe=H._add(K)._divideBy(2)._subtract(this._centerPoint);if(re===1&&fe.x===0&&fe.y===0)return;this._center=B.unproject(B.project(this._pinchStartLatLng,this._zoom).subtract(fe),this._zoom)}this._moved||(B._moveStart(!0,!1),this._moved=!0),P(this._animRequest);var Ue=s(B._move,B,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=E(Ue,this,!0),Ga(U)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,P(this._animRequest),Fr(document,"touchmove",this._onTouchMove,this),Fr(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Zt.addInitHook("addHandler","touchZoom",LJ),Zt.BoxZoom=BJ,Zt.DoubleClickZoom=kJ,Zt.Drag=xJ,Zt.Keyboard=_J,Zt.ScrollWheelZoom=OJ,Zt.TapHold=FJ,Zt.TouchZoom=LJ,i.Bounds=V,i.Browser=ti,i.CRS=Y,i.Canvas=Vi,i.Circle=ZE,i.CircleMarker=_A,i.Class=M,i.Control=Ar,i.DivIcon=_t,i.DivOverlay=He,i.DomEvent=Di,i.DomUtil=MA,i.Draggable=wp,i.Evented=O,i.FeatureGroup=Od,i.GeoJSON=ol,i.GridLayer=yt,i.Handler=Gs,i.Icon=kA,i.ImageOverlay=De,i.LatLng=j,i.LatLngBounds=z,i.Layer=$u,i.LayerGroup=vv,i.LineUtil=dV,i.Map=Zt,i.Marker=xA,i.Mixin=WE,i.Path=jn,i.Point=x,i.PolyUtil=Ob,i.Polygon=nm,i.Polyline=Up,i.Popup=ze,i.PosAnimation=xr,i.Projection=pV,i.Rectangle=NJ,i.Renderer=Tr,i.SVG=Fd,i.SVGOverlay=Re,i.TileLayer=Vt,i.Tooltip=st,i.Transformation=ue,i.Util=R,i.VideoOverlay=Ne,i.bind=s,i.bounds=G,i.canvas=Cr,i.circle=JE,i.circleMarker=yv,i.control=cs,i.divIcon=Ot,i.extend=n,i.featureGroup=YN,i.geoJSON=Pe,i.geoJson=Ve,i.gridLayer=ni,i.icon=fV,i.imageOverlay=Ee,i.latLng=W,i.latLngBounds=Q,i.layerGroup=KN,i.map=Na,i.marker=Of,i.point=_,i.polygon=bv,i.polyline=OA,i.popup=$e,i.rectangle=D_e,i.setOptions=m,i.stamp=l,i.svg=VS,i.svgOverlay=Me,i.tileLayer=Rt,i.tooltip=bt,i.transformation=ne,i.version=r,i.videoOverlay=Be;var R_e=window.L;i.noConflict=function(){return window.L=R_e,this},window.L=i}))})(FD,FD.exports)),FD.exports}var px=qIt();function WIt(){try{return navigator||window.navigator}catch(t){console.log(t);return}}function KIt({coords:t,callback:e}){let i=16;(!t?.latitude||!t?.longitude)&&(t={latitude:0,longitude:0},i=2);const r={map:"latLongMap",link:"latLonglink"},a=`
    <div style='min-height: 150px'>
    <h2 class='tmx-title'>Enter map URL</h2>
    <div class='flexcenter'>${Rm.tr("phrases.addgooglemap")}</div>
    <div class='flexcenter flexcol'>
      <input id='${r.link}' value='' style='text-align: center; width: 25em; margin: 1em;'>
      <div class='flexrow' style='margin-top: 1em; margin-bottom: 1em;'>
      </div>
    </div>
    <div class='location_detail_body' style='min-width: 350px; min-height: 350px;'>
      <div id='${r.map}' class='location_map' style='width: 100%; height: 100%; min-width: 350px; min-height: 350px;'>
    </div>
  </div>`,l=[{label:"Cancel",intent:"none",close:!0},{onClick:m,intent:"is-warning",label:"Clear"},{onClick:()=>{!t.latitude||!t.longitude?c():m(t)},intent:"is-primary",label:"View",close:!1},{onClick:()=>{(!t.latitude||!t.longitude)&&c(),Mt(e)&&e&&e(t)},intent:"is-info",label:"Submit",close:!0}],c=()=>{const A=d.link.element?.value,g=VIt(A)||GIt(A)||HIt(A)||QIt(A);g.latitude?m(g):A&&g.latitude===void 0&&Pt({message:"Invalid URL"})},u=A=>{A.key==="Enter"&&c()};Jr({title:"Location",content:a,buttons:l});const d=jIt(r),{map:p,marker:f}=YIt({successElement:d.map.element,mapElementId:d.map.id,coords:t,zoom:i});d.link.element&&(d.link.element.value="",d.link.element.focus(),d.link.element.addEventListener("keyup",u)),p&&(p.on("click",A=>h({latitude:A.latlng.lat,longitude:A.latlng.lng})),p.on("contextmenu",A=>console.log("Coordinates: "+A.latlng.toString())));function h({latitude:A,longitude:g}){t={latitude:A,longitude:g};const v=new px.LatLng(A,g);f.setLatLng(v)}function m({latitude:A=0,longitude:g=0}={}){return A&&g?(t={latitude:+A,longitude:+g},p.setView([+A,+g],16),!0):(t={latitude:0,longitude:0},p.fitWorld(),!1)}}function YIt({successElement:t,mapElementId:e,coords:i,zoom:r}){if(!WIt()?.onLine)return{};if(i.latitude&&i.longitude)return t&&(t.style.display="inline"),a(i.latitude,i.longitude,r);return{};function a(s,o,l){if(Number.isNaN(s)||Number.isNaN(o))return{};const c=$t.locations.map_view||"map",u=px.tileLayer($t.leaflet[c].tileLayer,{attribution:$t.leaflet[c].attribution,maxZoom:$t.leaflet[c].maxZoom??16}),d=px.map(e).fitWorld().addLayer(u);(s||o)&&d.setView([+s,+o],l);const p=px.marker([+s,+o]).addTo(d);return setTimeout(function(){d.invalidateSize()},300),{map:d,marker:p}}}function XIt(t,e){const i=e.getRow().getData(),{latitude:r,longitude:n}=i?.address||{};KIt({coords:{latitude:r,longitude:n},callback:(s={})=>{i.address||(i.address={});const o=i.venue;o.addresses||(o.addresses=[]),o.addresses.length?Object.assign(o.addresses[0],{latitude:s.latitude,longitude:s.longitude}):o.addresses.push({latitude:s.latitude,longitude:s.longitude});const l=u=>{if(u.results?.[0]?.success){const d=e.getTable();i.address.latitude=s.latitude,i.address.longitude=s.longitude,i.hasLocation=s.latitude&&s.longitude,d.updateData([i])}},c=[{method:rMe,params:{venueId:i.venueId,modifications:{addresses:o.addresses}}}];Nt({methods:c,callback:l})}})}function ZIt(t){const e=i=>i.getValue()?'<i class="fa-sharp fa-solid fa-location-dot" style="color: blue"></i>':"?";return[{cellClick:(i,r)=>r.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ii,width:5},{headerMenu:TA({scheduledMatchUpsCount:"Scheduled matches",availableTime:"Time Available",courtsCount:"Number of courts",hasLocation:"Location"}),formatter:"rownum",headerSort:!1,hozAlign:si,width:55},{cellClick:_I,field:"venueAbbreviation",title:"Abbr",visible:!0,width:120},{cellClick:_I,field:"venueName",title:"Venue",visible:!0,minWidth:200,widthGrow:3},{title:'<div class="event_icon surface_header"></div>',headerTooltip:"Number of courts",headerHozAlign:si,field:"courtsCount",hozAlign:si,headerSort:!0,visible:!0,width:50},{title:"Scheduled",headerTooltip:"Scheduled matches",field:"scheduledMatchUpsCount",headerHozAlign:si,headerSort:!0,hozAlign:si,visible:!0,minWidth:120},{title:"Time",headerHozAlign:si,field:"availableTime",headerSort:!0,hozAlign:si,visible:!0,minWidth:120},{title:'<i class="fa-sharp fa-solid fa-location-dot"></i>',formatter:e,headerTooltip:"Location",headerHozAlign:si,cellClick:XIt,field:"hasLocation",headerSort:!1,hozAlign:si,visible:!0,width:50},{cellClick:_I,formatter:_Z,responsive:!1,headerSort:!1,hozAlign:Ht,field:"isOpen",width:20},{cellClick:$It(t),formatter:dv,responsive:!1,headerSort:!1,hozAlign:Ht,width:50}]}function JIt({table:t}={}){const e=new Map,i=(s,o)=>{e.has(s)||e.set(s,o)},r=()=>{const{venues:s}=Jd.getVenuesAndCourts();return{rows:s.map(lBe)}},n=()=>{const{rows:s}=r();t?.replaceData(s)},a=ZIt(e);if(t)n();else{UA({anchorId:c_});const s=document.getElementById(c_),{rows:o}=r();t=new es(s,{headerSortElement:kf(["scheduledMatchUpsCount","venueAbbreviation","availableTime","courtsCount","venueName"]),minHeight:window.innerHeight*.81,rowFormatter:FIt(i),placeholder:"No venues",layout:"fitColumns",reactiveData:!0,index:"venueId",columns:a,data:o}),t.on("scrollVertical",Kd),t.on("cellEdited",l=>{const c=l.getColumn().getDefinition(),u=l.getRow().getData(),d=l.getValue();console.log({cell:l,row:u,value:d,def:c})})}return{table:t,replaceTableData:n}}function ewt({table:t,updateVenueRow:e,controlAnchor:i}={}){return i?eo({table:t,target:i,items:[{onClick:()=>{const a=t.getSelectedData().map(({venueId:l})=>l);Nt({methods:[{method:Wut,params:{venueIds:a,force:!0}}],callback:l=>l.success&&t.deleteRow(a)})},label:"Delete selected",intent:"is-danger",stateChange:!0,location:sa},{label:"Add venue",onClick:()=>_Ne(e),location:Ht,id:"addVenue",intent:"none"}]})?.elements:void 0}function twt(){const t=document.getElementById(Z6)||void 0,{table:e}=JIt();ewt({table:e,controlAnchor:t,updateVenueRow:({venue:r})=>{e.updateOrAddData([lBe(r)])}})}const{POLICY_TYPE_AVOIDANCE:Qae}=Gg;function cBe({eventId:t,drawId:e}){return Ge.getPolicyDefinitions({policyTypes:[Qae],eventId:t,drawId:e})?.policyDefinitions?.[Qae]?.policyAttributes}const Q3={city:[{key:"person.addresses.city"},{key:"individualParticipants.person.addresses.city"}],state:[{key:"person.addresses.state"},{key:"individualParticipants.person.addresses.state"}],postal:[{key:"person.addresses.postalCode",significantCharacters:5},{key:"individualParticipants.person.addresses.postalCode",significantCharacters:5}],iso:[{key:"person.addresses.country"},{key:"individualParticipants.person.addresses.country"}],groups:[{directive:"groupParticipants"}],pairs:[{directive:"pairParticipants"}],teams:[{directive:"teamParticipants"}]};function iwt({event:t}){const i=cBe({eventId:t.eventId})?.map(n=>Object.keys(Q3).find(a=>Q3[a].some(o=>o.directive&&o.directive===n.directive||o.key&&o.key===n.key))).filter(Boolean)??[];return{items:[{text:"Select rules"},{checked:i.includes("pairs"),label:"Doubles pairs",id:"avoidancePairs",checkbox:!0,field:"pairs"},{checked:i.includes("groups"),id:"avoidanceGroups",checkbox:!0,label:"Groups",field:"groups"},{checked:i.includes("teams"),id:"avoidanceTeams",checkbox:!0,label:"Teams",field:"teams"},{checked:i.includes("iso"),id:"avoidanceCountry",label:"Country",checkbox:!0,field:"iso"},{checked:i?.includes("city"),id:"avoidancedCity",checkbox:!0,label:"City",field:"city"},{checked:i.includes("state"),id:"avoidancedState",checkbox:!0,label:"State",field:"state"},{checked:i.includes("zip"),id:"avoidancedPostal",label:"Postal code",checkbox:!0,field:"zip"},{label:"Postal code digits",visible:!1,field:"zip"}]}}function uBe({eventId:t}){const e=Ge.getEvent({eventId:t}).event;if(!e)return;const{items:i}=iwt({event:e});let r;const n=!0,a=u=>r=Sr(u,i),o=[{label:"Cancel",intent:jt,close:!0},{label:"Save",id:"setAvoidances",intent:"is-info",onClick:()=>{const d=Object.keys(r).filter(h=>r[h].checked).flatMap(h=>Q3[h]).filter(Boolean);Nt({methods:[{method:zut,params:{policyDefinitions:{avoidance:{policyAttributes:d}},allowReplacement:!0,eventId:t}}],callback:h=>{if(h.success){const m="is-success",A=document.getElementById("editAvoidances");A&&(d.length?A.classList.add(m):A.classList.remove(m))}else Pt({message:"Error",intent:"is-danger"})}})},close:n}],l="Set avoidances",c=(u,d)=>uv(u,o,d);ot.drawer.open({title:l,content:a,footer:c,side:Ht,width:"300px"})}const{WTN:rwt,UTR:nwt}=Qn.ratingConstants,{TEAM:awt}=Qn.eventConstants,{QUALIFYING:jae}=Wn;function NN({entry:t,derivedDrawInfo:e,participants:i,participant:r,eventType:n,categoryName:a,eventId:s}){r=r||i?.find(v=>v.participantId===t.participantId);const o=r?.draws?.filter(v=>v.eventId===s).map(v=>({...v,drawName:e[v.drawId].drawName}))??[],l=r?.person?.addresses?.[0],c=l?`${l.city}, ${l.state}`:void 0,u=n===awt?"AVERAGE":n,d=r?.ratings?.[u]?.find(v=>v.scaleName===rwt)?.scaleValue,p=r?.ratings?.[u]?.find(v=>v.scaleName===nwt)?.scaleValue,f={wtn:d,utr:p},h=r?.rankings?.[n]?.find(v=>v.scaleName===a)?.scaleValue,m=t.entryStage===jae?`${s}${jae}`:s,A=r?.seedings?.[n]?.find(v=>v.scaleName===m)?.scaleValue,g=Bbe[t.entryStatus];return{searchText:r?.participantName.toLowerCase(),participant:r,seedNumber:A,cityState:c,...t,ranking:h,ratings:f,flights:o,status:g}}const{ORGANISER_ACCEPTANCE:swt,DIRECT_ACCEPTANCE:owt,SPECIAL_EXEMPT:lwt,JUNIOR_EXEMPT:cwt,WILDCARD:uwt}=Iu,{MAIN:dwt}=Wn,yO=(t=dwt)=>[`${t}.${owt}`,`${t}.${swt}`,`${t}.${lwt}`,`${t}.${cwt}`,`${t}.${uwt}`],{FLIGHT_PROFILE:pwt}=Qn.extensionConstants,{MAIN:zae}=Qn.drawDefinitionConstants;function fx({stage:t=zae,drawId:e,event:i}){return(i?.extensions?.find(s=>s.name===pwt)?.value?.flights?.find(s=>s.drawId===e)?.drawEntries||i?.entries||[]).filter(({entryStage:s=zae,entryStatus:o})=>yO(t).includes(`${s}.${o}`)).length}const{FEED_IN:fwt,LUCKY_DRAW:hwt,MAIN:mwt,QUALIFYING:Awt,ROUND_ROBIN:qae,ROUND_ROBIN_WITH_PLAYOFF:NB}=Wn;function gwt({isQualifying:t,maxQualifiers:e,drawId:i,event:r}){const n=t?Awt:mwt,a=({fields:f,inputs:h})=>{const m=h[_v].value||0,A=fi.numericValidator(m)?Number.parseInt(m):0,g=fx({drawId:i,event:r,stage:n}),v=h.qualifiersCount.value||0,b=fi.numericValidator(v)?Number.parseInt(v):0,y=e||t&&A<g||A<g+b;y&&(h[Zc].value=$6);const I=f&&Mg(f[Zc],"help")?.[0];I&&(I.style.display=y?"":jt);for(const w of h[Zc].options)w.label===Zc&&(w.disabled=y)},s=({drawType:f,drawId:h,fields:m,inputs:A})=>{const g=e?A[_v].value:fx({drawId:h,event:r,stage:n}),v=A.qualifiersCount.value||1,b=fi.numericValidator(v)&&Number.parseInt(v)||e?1:0,y=t&&!e?g:Number.parseInt(g)+b,I=(e||[hwt,fwt,qae,NB].includes(f))&&y||Ri.nextPowerOf2(y);return A[_v].value=I,a({fields:m,inputs:A}),I},o=({fields:f,inputs:h})=>{let m=Number.parseInt(h[_v].value);const A=h.qualifiersCount.value;fi.numericValidator(A)&&Number.parseInt(A)<1&&(h.qualifiersCount.value=e?1:0);const g=document.getElementById("generateDraw");let v=h.qualifiersCount.value;if(g&&(g.disabled=!1),e&&fi.numericValidator(v)&&Number.parseInt(v)>e)h.qualifiersCount.value=e;else if(!e){const b=h[Kf].value;m=s({drawId:i,drawType:b,fields:f,inputs:h})}v=h.qualifiersCount.value,g&&(!fi.numericValidator(v)||m<=Number.parseInt(v))&&(g.disabled=!0)},l=({e:f,fields:h,inputs:m})=>{const A=m[a0].value,g=f.target.value;if(e||s({drawId:i,drawType:g,fields:h,inputs:m}),a({fields:h,inputs:m}),h){h[bU].style.display=g===NB&&A===s0?"":jt,h[a0].style.display=g===NB?"":jt;const v=[qae,NB].includes(g);h[mm].style.display=v?"":jt}},c=({fields:f,inputs:h})=>{const m=document.getElementById("generateDraw"),A=h[_v].value||0,g=fi.numericValidator(A)?Number.parseInt(A):0,v=fx({drawId:i,event:r,stage:n}),b=Math.max(Ri.nextPowerOf2(v),512),y=fi.numericRange(2,b)(A);m&&(m.disabled=!y);const{validGroupSizes:I}=Ge.getValidGroupSizes({drawSize:g,groupSizeLimit:8}),w=I.map(D=>({label:D,value:D})),S=h[mm],T=I.includes(g)?4:I[0];fo(S),y8(S,{options:w,value:T}),a({fields:f,inputs:h})},u=({e:f,fields:h})=>{const m=f.target.value;h&&(h[bU].style.display=m===s0?"":jt,h[h_].style.display=m===s0?"":jt)},d=({inputs:f})=>{const h=Number.parseInt(f[mm].value),m=f[bU].options,A=Array.from(m).map(v=>Number.parseInt(v.value)),g=Math.max(...A);g>h?Ri.generateRange(h+1,g+1).reverse().forEach(v=>{f[bU].remove(v-2)}):g<h&&Ri.generateRange(g+1,h+1).forEach(v=>f[bU].add(new Option(v.toString(),v.toString())))},p=({inputs:f,name:h})=>{const m=f[h].value,A=document.getElementById("generateDraw"),g=fi.nameValidator(4)(m);A&&(A.disabled=!g)};return[{onInput:({inputs:f})=>p({inputs:f,name:XI}),control:XI},{onInput:({inputs:f})=>p({inputs:f,name:EP}),control:EP},{onChange:d,control:mm},{onChange:l,control:Kf},{onChange:u,control:a0},{onInput:c,control:_v},{onInput:o,control:f_}]}const{AD_HOC:vwt,COMPASS:ywt,CURTIS:bwt,DOUBLE_ELIMINATION:Iwt,FEED_IN_CHAMPIONSHIP:wwt,FEED_IN:Swt,FIRST_MATCH_LOSER_CONSOLATION:Uwt,FIRST_ROUND_LOSER_CONSOLATION:Twt,LUCKY_DRAW:Cwt,OLYMPIC:Ewt,PLAY_OFF:Dwt,ROUND_ROBIN:Pwt,ROUND_ROBIN_WITH_PLAYOFF:Rwt,SINGLE_ELIMINATION:Mwt}=Wn;function dBe({isPlayoff:t,isQualifying:e}={}){return[{label:"Ad-hoc",value:vwt,hide:e},{label:"Compass",value:ywt,hide:e},{label:"Curtis consolation",value:bwt,hide:e},{label:"Double elimination",value:Iwt,hide:t||e},{label:"Elimination: fed consolation",value:wwt,hide:e},{label:"First match loser consolation",value:Uwt,hide:e},{label:"First round loser consolation",value:Twt,hide:e},{label:"Lucky",value:Cwt,hide:t||e},{label:"Olympic",value:Ewt,hide:e},{label:"Playoff",value:Dwt,hide:e},{label:"Round robin w/ playoff",value:Rwt,hide:t||e},{label:"Round robin",value:Pwt},{label:"Single elimination",value:Mwt},{label:"Staggered Entry",value:Swt,hide:t||e}]}const{POLICY_TYPE_SCORING:Nwt}=Gg,{MAIN:Bwt}=Wn,kwt={[Nwt]:{requireAllPositionsAssigned:!1,stage:{[Bwt]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:"SET3-S:6/TB7",matchUpFormats:[{categoryNames:[],categoryTypes:[],description:"Best of 3 sets with 7-point tiebreak at 6-6",matchUpFormat:"SET3-S:6/TB7"},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One set set to 6, 7-point tiebreak at 6-6",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three sets to 4 with 5-point tiebreak at 3-3",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One set to 4, 7-point tiebreak at 4-4",matchUpFormat:"SET1-S:4/TB7"},{description:"One set to 4, 5-point tiebreak at 3-3",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5-5",matchUpFormat:"SET1-S:6NOAD"},{description:"One set to 4, deciding game is played at 3-3",matchUpFormat:"SET1-S:4NOAD"},{description:"8 game pro-set with 7 point tiebreak at 8-8",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7-7",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"},{description:"Timed 20 minute game - point based",matchUpFormat:"SET1-S:T20P"},{description:"Aggregate Points - Four 10 minute quarters",matchUpFormat:"SET4-S:T10P"}]}},{ROUND_ROBIN:xwt,ROUND_ROBIN_WITH_PLAYOFF:Wae,SINGLE_ELIMINATION:_wt,QUALIFYING:Owt,MAIN:Kae}=Wn,{DOMINANT_DUO:Fwt,COLLEGE_DEFAULT:Lwt,LAVER_CUP:$wt}=Qn.tieFormatConstants,{POLICY_TYPE_SCORING:Hwt,POLICY_TYPE_SEEDING:Yae}=Gg,{FLIGHT_PROFILE:Vwt}=Qn.extensionConstants,{TEAM:Xae}=Ul,{ENTRY_PROFILE:Gwt}=Qn.extensionConstants,Qwt="CLUSTER",jwt="SEPARATE",zwt="INHERIT";function qwt({event:t,drawId:e,isQualifying:i,structureId:r}){const n=i?Owt:Kae,a=t.drawDefinitions?.length||0,s=_wt,o=e&&t.drawDefinitions?.find(M=>M.drawId===e),l=r&&Ge.getPositionAssignments({drawId:e,structureId:r})?.positionAssignments,c=Ge.findExtension({element:o,name:Gwt})?.extension?.value,u=r?1:0,d=!r&&c?.[Kae]?.qualifiersCount||u,p="Qualifying",f=l?.length||Ri.nextPowerOf2(fx({drawId:e,event:t,stage:n})),h=Math.max(f,512),m=Ge.getTournamentInfo()?.tournamentRecord,A=t?.policyDefinitions?.[Yae],g=m?.policyDefinitions?.[Yae],v=A||g,y=t?.extensions?.find(M=>M.name===Vwt)?.value?.flights?.find(M=>M.drawId===e),I=[{label:"Custom",value:p_}].concat(kwt[Hwt].matchUpFormats.map(({matchUpFormat:M,description:N})=>({selected:M==="SET3-S:6/TB7",value:M,label:N}))),w=[{label:"Dominant Duo",value:Fwt,selected:!0},{label:"College Default",value:Lwt},{label:"Laver Cup",value:$wt},{label:"Custom",value:p_}],S=[...v?[{label:"Inherited",value:zwt,selected:!0}]:[],{label:"Separated (USTA)",value:jwt,selected:!v},{label:"Adjacent (ITF)",value:Qwt}],{validGroupSizes:T}=Ge.getValidGroupSizes({drawSize:32,groupSizeLimit:8}),D=T.map(M=>({label:M,value:M})),C=[{label:"Group winners",value:Uqe},{label:"Group positions",value:xbe},{label:"Top finishers",value:s0}],E=[{label:"2",value:2},{label:"3",value:3},{label:"4",value:4}],P=[{label:Zc,value:Zc,selected:!r,disabled:!!r},{label:$6,value:!1,selected:r}];return{items:[{error:"minimum of 4 characters",placeholder:"Display name of the structure",validator:fi.nameValidator(4),label:"Structure name",value:p,field:EP,selectOnFocus:!0,hide:!i},{error:"minimum of 4 characters",placeholder:"Display name of the draw",value:y?.drawName||`Draw ${a+1}`,validator:fi.nameValidator(4),selectOnFocus:!0,hide:i,label:"Draw name",field:XI,focus:!0},{options:dBe({isQualifying:i}),label:"Draw Type",field:Kf,value:s},{error:`Must be in range 2-${h}`,validator:fi.numericRange(2,h),selectOnFocus:!0,label:"Draw size",value:f,field:_v},{visible:[xwt,Wae].includes(s),options:D,label:"Group size",field:mm,value:4},{visible:[Wae].includes(s),options:C,label:"Playoff Type",field:a0},{label:"Advance per group",options:E,field:bU,visible:!1},{label:"2nd playoff from remaining",field:h_,id:h_,checkbox:!0,visible:!1},{help:{text:"Automation disabled",visible:!1},options:P,label:"Creation",field:Zc,value:""},{hide:t.eventType===Xae,options:I,field:a8,label:"Score format",value:""},{options:S,field:kbe,label:"Seeding policy",value:""},{hide:t.eventType!==Xae,options:w,field:"tieFormatName",label:"Scorecard",value:""},{disabled:i&&!r,validator:fi.numericValidator,field:f_,value:d,selectOnFocus:!0,label:"Qualifiers"}],structurePositionAssignments:l}}function Zae({eventId:t,drawOptions:e,callback:i}){const r=$t.scales[$t.activeScale?.toLowerCase()],n={scaleAccessor:r?.accessor,scaleName:r?.scaleName},a=Ge.generateDrawDefinition({...e,...n,ignoreStageSpace:!0});if(a.success){const s=a.drawDefinition;Nt({methods:[{method:xut,params:{eventId:t,drawDefinition:s,allowReplacement:!0}}],callback:c=>Mt(i)&&i({drawDefinition:s,...c})})}else a.error&&Pt({message:a.error?.message||"Error",intent:"is-warning",pauseOnHover:!0})}const{POLICY_TYPE_SEEDING:Wwt}=Gg,{SEPARATE:Kwt}=Wn,{SEEDING:Ywt}=xC,pBe={[Wwt]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{positioning:Kwt},policyName:Ywt,seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},{AD_HOC:Xwt,FEED_IN:Zwt,LUCKY_DRAW:Jwt,MAIN:eSt,QUALIFYING:tSt,ROUND_ROBIN:QZ,ROUND_ROBIN_WITH_PLAYOFF:jZ,SEPARATE:fBe,CLUSTER:hBe}=Wn,{TIME_TENNIS_PRO_CIRCUIT:iSt}=Qn.tieFormatConstants,{DIRECT_ENTRY_STATUSES:Jae}=Iu,{POLICY_TYPE_ROUND_NAMING:rSt,POLICY_TYPE_SEEDING:mBe}=Gg,nSt="INHERIT",ese={[mBe]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[jZ]:{positioning:Qn.drawDefinitionConstants.WATERFALL},[QZ]:{positioning:Qn.drawDefinitionConstants.WATERFALL}},positioning:fBe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},aSt={[mBe]:{seedingProfile:{positioning:hBe},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}};function sSt(t,e,i,r){const n=[];if(t===s0){const a=[Ri.generateRange(1,e+1)];if(i){const s=Ri.generateRange(e+1,r+1);s.length&&a.push(s)}a.forEach((s,o)=>{n.push({structureName:`Playoff ${o+1}`,finishingPositions:s})})}else t===xbe&&Ri.generateRange(1,r+1).forEach(a=>{n.push({structureName:`Playoff ${a}`,finishingPositions:[a]})});return n}function oSt(t,e){const i=Number.parseInt(e[mm].value);if(t===jZ){const r=Number.parseInt(e.advancePerGroup?.value||0),n=e[h_]?.checked,a=e[a0]?.value,s=sSt(a,r,n,i),o={groupSize:i};return s.length&&(o.playoffGroups=s),o}else if(t===QZ)return{groupSize:i}}function lSt(t){return t===fBe?ese:t===hBe?aSt:t===nSt?void 0:ese}function cSt(t){const{structureId:e,qualifiersCount:i,structureOptions:r,matchUpFormat:n,structureName:a,automated:s,drawSize:o,drawType:l,drawId:c,eventId:u,callback:d}=t,p=Ge.generateQualifyingStructure({qualifyingPositions:i,targetStructureId:e,structureOptions:r,matchUpFormat:n,structureName:a,automated:s,drawSize:o,drawType:l,drawId:c});if(p.success){const f=[{method:jut,params:{structure:p.structure,link:p.link,eventId:u,drawId:c}}];Nt({methods:f,callback:m=>{Mt(d)&&d({...p,...m.results?.[0]})}})}}function uSt(t){const{isQualifying:e,existingDrawName:i,qualifiersCount:r,structureOptions:n,matchUpFormat:a,structureName:s,seedsCount:o,drawSize:l,drawType:c,drawName:u,eventId:d,drawOptions:p}=t;e?(p.drawName=i,p.qualifyingProfiles=[{structureProfiles:[{qualifyingPositions:r,structureOptions:n,matchUpFormat:a,structureName:s,seedsCount:o,drawSize:l,drawType:c}]}]):(r&&(p.qualifiersCount=r,p.qualifyingPlaceholder=!0),Object.assign(p,{seedingScaleName:d,structureOptions:n,matchUpFormat:a,seedsCount:o,drawName:u,drawSize:l,drawType:c}))}function dSt(t){const{drawOptions:e,tieFormatName:i,seedingPolicyDefinition:r,eventId:n,callback:a}=t;if(i===p_)YNe({title:"Custom scorecard",tieFormat:void 0,onClose:o=>{o&&(e.tieFormat=o,Zae({drawOptions:e,eventId:n,callback:a}))}});else{if(e.tieFormatName=i,r&&(e.policyDefinitions={...e.policyDefinitions,...r}),i===iSt){const s={[rSt]:{namingConventions:{round:"Day"},affixes:{roundNumber:"D"},policyName:"TTPro 4 Day"}};e.policyDefinitions={...e.policyDefinitions,...s}}Zae({drawOptions:e,eventId:n,callback:a})}}function tse({drawName:t,matchUpFormat:e,isQualifying:i,structureId:r,callback:n,inputs:a,drawId:s,event:o}){const l=a[Kf].options[a[Kf].selectedIndex].getAttribute("value"),c=e||a[a8]?.value,u=a[kbe]?.value,p=o?.extensions?.find(P=>P.name===Qn.extensionConstants.FLIGHT_PROFILE)?.value?.flights?.find(P=>P.drawId===s),f=a[EP]?.value,h=a.tieFormatName?.value,m=a[XI]?.value,A=a[_v].value||0,g=Ri.isConvertableInteger(A)&&Number.parseInt(A),v=[Jwt,Zwt,QZ,jZ].includes(l)&&g||Ri.nextPowerOf2(g),b=o.entries.filter(({entryStage:P,entryStatus:R})=>P===tSt&&Jae.includes(R)),y=i&&b.length?b:p?.drawEntries||o.entries.filter(({entryStage:P,entryStatus:R})=>(!P||P===eSt)&&Jae.includes(R)),I=v<y.length?!1:a[Zc].value===Zc,w=o.eventId,S={drawEntries:y,automated:I,eventId:w,drawId:s},T=oSt(l,a);l===Xwt&&Object.assign(S,{roundsCount:1});const D=lSt(u),C=Ge.getSeedsCount({participantsCount:y?.length,policyDefinitions:D||pBe,drawSizeProgression:!0})?.seedsCount,E=fi.numericValidator(a[f_].value)&&Number.parseInt(a[f_]?.value)||0;if(r&&s){cSt({structureId:r,qualifiersCount:E,structureOptions:T,matchUpFormat:c,structureName:f,automated:I,drawSize:v,drawType:l,drawId:s,eventId:w,callback:n});return}uSt({isQualifying:i??!1,existingDrawName:t,qualifiersCount:E,structureOptions:T,matchUpFormat:c,structureName:f,seedsCount:C,drawSize:v,drawType:l,drawName:m,eventId:w,drawOptions:S}),g?dSt({drawOptions:S,tieFormatName:h,seedingPolicyDefinition:D,eventId:w,callback:n}):Pt({message:"Invalid draw size",intent:"is-warning",pauseOnHover:!0})}function mw({isQualifying:t,flightNumber:e,structureId:i,callback:r,drawName:n,eventId:a,drawId:s}){const o=Ge.getEvent({eventId:a}).event;if(!o)return;const{items:l,structurePositionAssignments:c}=qwt({event:o,drawId:s,isQualifying:t,structureId:i}),u=gwt({maxQualifiers:c?.length,isQualifying:t,drawId:s,event:o});let d;const p=v=>{d=Sr(v,l,u)},f=()=>t?fi.nameValidator(4)(d[EP].value):fi.nameValidator(3)(d[XI].value),m=[{label:"Cancel",intent:jt,close:!0},{label:"Generate",id:"generateDraw",intent:"is-primary",onClick:()=>{f()?d.matchUpFormat?.value===p_?IH({callback:b=>{b&&tse({event:o,inputs:d,callback:r,structureId:i,matchUpFormat:b,drawId:s,drawName:n,isQualifying:t})},modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}}):tse({event:o,inputs:d,callback:r,structureId:i,drawId:s,drawName:n,isQualifying:t}):Pt({message:"Missing Draw name",intent:"is-danger"})},close:f}],A=e?"Generate flight":"Configure draw",g=(v,b)=>uv(v,m,b);ot.drawer.open({title:A,content:p,footer:g,side:Ht,width:"300px"})}const tQ={high:[80,100],medium:[60,80],low:[40,60]},{ratingsParameters:pSt}=vg,bO=t=>(e,i)=>{const r=pSt[t];if(!r)return 0;const{accessor:n,ascending:a}=r,s=!a,o=ise(e),l=ise(i);if(o<l)return 1;if(l<o)return-1;const c=e?.[n]||0,u=i?.[n]||0;return s?c-u:u-c};function ise(t){const e=IO(t.confidence??100);return e==="high"&&100||e==="medium"&&80||e==="low"&&60||0}function IO(t){return parseInt(t.toString())>=tQ.high[0]?"high":parseInt(t.toString())>=tQ.medium[0]?"medium":parseInt(t.toString())>=tQ.low[0]?"low":"unrated"}const{ratingsParameters:fSt}=vg,wO=t=>e=>{const i=fSt[t],{accessor:r}=i,n=e.getValue(),a=n?.confidence??100,s=n?.[r],o=IO(a),l=document.createElement("span"),c={medium:"darkgreen",low:"lightblue",high:"blue"};return l.style.color=c[o],l.innerHTML=s??"",l},{SINGLES:hSt}=Ul,mSt=t=>e=>{e.getColumn().getDefinition();const i=document.createElement("div");i.className="tags";const r=o=>t({...o,renderDraw:!0}),n=e.getValue(),a=e.getRow().getData(),{participantId:s}=a;return n?.forEach(o=>{const l=ASt({flight:o,flightClick:r});i.appendChild(l)}),i};function ASt({flight:t,flightClick:e}){const i=document.createElement("span");return Mt(e)&&e&&(i.onclick=()=>e(t)),i.className="tag event-pill",t.gender?.toLowerCase().includes("female")?i.classList.add("is-danger"):t.gender?.toLowerCase().includes("male")?i.classList.add("is-link"):i.classList.add("is-primary"),t.eventType===hSt&&i.classList.add("is-light"),i.innerHTML=t.drawName,i}const{MAIN:gSt,QUALIFYING:iQ}=Wn,{DIRECT_ACCEPTANCE:rse}=Iu;function ABe({participantIds:t,group:e,eventId:i,drawId:r,callback:n}){Nt({methods:[{method:iMe,params:{autoEntryPositions:!0,participantIds:t,entryStatus:e===Qu&&rse||e===iQ&&rse||e,entryStage:e===iQ?iQ:gSt,eventId:i,drawId:r}}],callback:n})}const{ALTERNATE:nse,DIRECT_ACCEPTANCE:ase,WITHDRAWN:sse,UNGROUPED:vSt}=Iu,{QUALIFYING:ose}=Wn,ySt=(t,e,i)=>(r,n)=>{const{participant:a}=n.getRow().getData(),s=c=>()=>{const u=p=>{if(p.success){const f=n.getRow(),h=c===Qu?ase:c;ot.tables[h]?.addRow(f.getData()),f.delete()}else console.log({result:p})},d=[a.participantId];ABe({participantIds:d,callback:u,eventId:e,drawId:i,group:c})},o=()=>{const c=Ge.destroyPairEntry({participantIds:[a.participantId],autoEntryPositions:!0,eventId:e,drawId:i});console.log({result:c})},l=[{onClick:s(ase),option:"Move to accepted",action:Qu},{onClick:s(ose),option:"Move to qualifying",action:ose},{onClick:s(nse),option:"Move to alternates",action:nse},{onClick:o,option:"Unpair players",action:vSt},{onClick:s(sse),option:"Withdraw participant",action:sse}].filter(c=>t.includes(c.action));if(l.length){const c=r.target;nl({options:l,target:c,config:{placement:wd}})}},{WTN:rQ,UTR:nQ}=Qn.ratingConstants;function bSt({entries:t,exclude:e=[],eventId:i,drawId:r,actions:n=[],drawCreated:a}={}){const s=t.find(p=>p.participant?.teams?.length),o=t.find(p=>p.ratings?.utr),l=t.find(p=>p.ratings?.wtn),c=t.find(p=>p.cityState),u=t.find(p=>p.seedNumber),d=t.find(p=>p.ranking);return[{cellClick:(p,f)=>f.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",visible:!a,headerSort:!1,responsive:!1,hozAlign:ii,width:5},{headerMenu:TA({}),formatter:"rownum",headerSort:!1,hozAlign:ii,width:55},{formatter:"responsiveCollapse",responsive:!1,headerSort:!1,hozAlign:si,resizable:!1,width:50},{formatter:p=>Bb(void 0)(p,void 0,"sideBySide"),field:"participant",responsive:!1,resizable:!1,minWidth:200,widthGrow:1,title:"Name"},{sorterParams:{alignEmptyValues:"bottom"},visible:!!d,resizable:!1,sorter:"number",field:"ranking",title:"Rank",width:70},{formatter:wO(rQ),sorter:bO(rQ),visible:!!l,field:"ratings.wtn",resizable:!1,title:rQ,width:70},{formatter:wO(nQ),sorter:bO(nQ),visible:!!o,field:"ratings.utr",resizable:!1,title:nQ,width:70},{sorter:(p,f)=>p?.[0]?.participantName?.localeCompare(f?.[0]?.participantName),formatter:dNe(()=>console.log("boo")),field:"participant.teams",visible:!!s,title:"Teams",responsive:!1,resizable:!1,minWidth:100},{visible:!!c,title:"City/State",field:"cityState",responsive:!1,resizable:!1,minWidth:100},{editor:pO({maxValue:t?.length||0,decimals:!1,field:"seedNumber"}),sorterParams:{alignEmptyValues:"bottom"},visible:!!u,field:"seedNumber",hozAlign:si,resizable:!1,sorter:"number",editable:!1,title:"Seed",maxWidth:70},{formatter:mSt(_n),title:"Flights",responsive:!0,field:"flights",minWidth:100,widthGrow:1},{responsive:!1,resizable:!1,title:"Status",field:"status",maxWidth:80},{cellClick:ySt(n,i||"",r),formatter:dv,responsive:!1,headerSort:!1,hozAlign:Ht,maxWidth:40}].filter(({field:p})=>Array.isArray(e)&&!e?.includes(p||""))}function gBe(){const t=Ge.getTournament().tournamentRecord.tournamentId,e=`/${js}/${t}/${jf}`;ot.router.navigate(e)}function vBe(t,e){GE({classNames:["saveSeeding","cancelManualSeeding"],columns:["seedNumber"],visible:!1,table:e,e:t})}const{SEEDING:ISt}=xC;function yBe({scaleItemsWithParticipantIds:t,scaleBasis:e,eventId:i,callback:r}){Nt({methods:[{method:ndt,params:{scaleItemsWithParticipantIds:t,removePriorValues:!0,context:{scaleAttributes:{scaleType:ISt},scaleBasis:{scaleType:e},eventId:i}}}],callback:s=>{s.success&&Mt(r)&&r&&r()}})}const{QUALIFYING:lse}=Wn,{SEEDING:wSt,MANUAL:SSt}=xC;function bBe({event:t,rows:e,callback:i}){const{eventId:r,eventType:n}=t,a=e.map(({entryStage:s,participantId:o,seedNumber:l})=>{const c=s===lse?`${r}${lse}`:r;return{participantId:o,scaleItems:[{scaleValue:l,scaleType:wSt,scaleName:c,eventType:n}]}});yBe({scaleItemsWithParticipantIds:a,scaleBasis:SSt,eventId:r,callback:i})}function IBe({table:t}){const e=t.getRows();let i;for(const r of e){const n=r.getData();i=n.entryStage,n.seedNumber=void 0,r.update(n)}return i}function wBe({event:t,table:e}){IBe({table:e});const i=e.getData();bBe({event:t,rows:i})}const{DIRECT_ACCEPTANCE:USt}=Iu,{QUALIFYING:TSt}=Wn,CSt=(t,e,i)=>{const r=t?.seedings?.[e];return r?r.find(a=>a.scaleName===i)?.scaleValue:void 0},ESt=(t,e,i,r,n)=>{vBe(t,e);const a=IBe({table:e}),s=Ge.getEvent({eventId:i})?.event,l=(s.entries?.filter(h=>h.entryStage===a&&h.entryStatus===r)).map(({participantId:h})=>h),{participants:c}=Ge.getParticipants({participantFilters:{participantIds:l},withScaleValues:!0}),u=a===n?`${i}${n}`:i,d=c.map(h=>{const m=CSt(h,s.eventType,u);if(m)return{participantId:h.participantId,seedNumber:m}}).filter(Boolean),p=Object.assign({},...d.map(h=>({[h.participantId]:h}))),f=e.getRows();for(const h of f){const m=h.getData(),A=m.participantId;p[A]&&(m.seedNumber=p[A].seedNumber,h.update(m))}},j3=t=>e=>{const i=t?.eventId;return{class:"cancelManualSeeding",intent:"is-warning",location:Ht,label:"Cancel",visible:!1,onClick:n=>ESt(n,e,i,USt,TSt)}};function SBe(t,e){GE({classNames:["saveSeeding","cancelManualSeeding"],columns:["seedNumber"],visible:!0,table:e,e:t}),e.showColumn("seedNumber"),e.redraw(!0)}const{QUALIFYING:BB,MAIN:DSt}=Wn,{SEEDING:PSt,RATING:RSt}=xC,{ratingsParameters:cse}=vg;function UBe({event:t,group:e,table:i,field:r}){const{eventId:n,eventType:a}=t,{seedsCount:s,stageEntries:o}=Ge.getEntriesAndSeedsCount({stage:e===BB?BB:DSt,policyDefinitions:pBe,eventId:n}),[l,c]=r.split("."),u=c?!cse[c.toUpperCase()].ascending:!1,d=cse[c.toUpperCase()].accessor,p=T=>T.ratings?.[c]||{confidence:0,[d]:1/0},f=T=>p(T)?.[d]||0,h=(T,D)=>(l==="ratings"&&u?f(T)-f(D):f(D)-f(T))||T-D,m=i.getData(),A={high:[],medium:[],low:[]};let g=0;for(const T of m){const D=p(T);D[d]&&(g+=1);const C=D.confidence??100;IO(C)==="high"?A.high.push(T):IO(C)==="medium"?A.medium.push(T):A.low.push(T)}const b=(Mt(h)&&[].concat([...A.high].sort(h),[...A.medium].sort(h),[...A.low].sort(h))||[]).slice(0,Math.min(g,s)),y=e===BB?`${n}${BB}`:n,I={scaleType:PSt,scaleName:y,eventType:a},{scaleItemsWithParticipantIds:w}=Ge.generateSeedingScaleItems({scaleAttributes:I,scaledEntries:b,stageEntries:o,seedsCount:s,scaleName:y});yBe({scaleItemsWithParticipantIds:w,scaleBasis:RSt,eventId:n,callback:()=>{const T=Object.assign({},...b.map((C,E)=>({[C.participantId]:E+1}))),D=i.getRows();i.showColumn("seedNumber"),i.redraw(!0);for(const C of D){const E=C.getData(),P=T[E.participantId];E.seedNumber=P,C.update(E)}}})}const use=(t,e)=>i=>{const r={ranking:"Seed by ranking","ratings.wtn":"Seed by WTN","ratings.utr":"Seed by UTR"},n=i.getColumns().map(s=>s.getDefinition()).filter(s=>["ratings.wtn","ratings.utr"].includes(s.field)),a=[{label:"Manual seeding",onClick:s=>SBe(s,i),close:!0},{label:"Clear seeding",onClick:()=>wBe({event:t,table:i}),close:!0}].concat(...n.map(s=>({onClick:()=>UBe({event:t,group:e,table:i,field:s.field}),label:r[s.field],value:s.field,close:!0})));return{class:"seedingOptions",label:"Seeding",selection:!1,location:Ht,align:Ht,options:a}},MSt=(t,e,i,r)=>{const a=t.getSelectedData().filter(u=>!u.events?.length).map(({participantId:u})=>u),[s,o]=e.split(".");Nt({methods:[{method:iMe,params:{ignoreAssignment:!0,participantIds:a,entryStatus:o,entryStage:s,eventId:i,drawId:r}}],callback:u=>{if(t.deselectRow(),u.success){const d=t.getRows();for(const p of d){const f=p.getData();a.includes(f.participantId)&&(f.status=Bbe[o],p.update(f))}}else console.log(u.error)}})},NSt=(t,e,i)=>r=>{const n=t.map(a=>({onClick:()=>MSt(r,a,e,i),label:a,value:a,close:!0}));return{location:sa,label:"Change status",options:n}},BSt=(t,e=0)=>{const i=`${t} <span class='${Ibe}'>${e}</span>`;return{location:u_,text:i}},CU=({target:t,table:e,close:i})=>{if(!t)return;const r=ac(t,tI);if(r){const n=r.getElementsByClassName("toggle")?.[0],a=r.getElementsByClassName(Pbe)?.[0],s=r.getElementsByClassName(Rbe)?.[0];if(n){const o=i||n.innerHTML.charCodeAt(0)===9660;a.style.display=o?jt:NT,s.style.display=o?jt:NT,n.parentNode.innerHTML=`<span class='toggle' style='color: white'>${o?INe:xZ}</span>`,o||e.redraw(!0)}}},kSt=t=>{const e=i=>CU({target:i.target,table:t});return{headerClick:e,text:`<span class='toggle' style='color: white'>${xZ}</span>`,location:u_,onClick:e}},AD=({heading:t,count:e})=>[BSt(t,e),i=>kSt(i)],dse=(t,e,i)=>(r,n="Search participants")=>{let a,s;const o=l=>{const c=dC(r.element,"tableClass");if(c){const u=Mg(c,"controlBar")?.[0];if(u){const d=Mg(u,"search");Array.from(d).forEach(p=>p.value=l)}}a=r.getSelectedData().map(u=>u[e]),r.removeFilter(s),s=u=>u.searchText?.includes(l?.toLowerCase())||a?.length&&a.includes(u[e]),l&&r.addFilter(s)};return{onKeyDown:l=>{l.keyCode===8&&l.target.value.length===1&&o(""),(l.key==="Enter"||l.keyCode===13)&&Mt(i)&&i&&i(r)&&o("")},onChange:l=>o(l.target.value),onKeyUp:l=>o(l.target.value),location:t||ii,class:"search",search:!0,placeholder:n}},z3=t=>e=>({label:"Save seeding",class:"saveSeeding",intent:"is-info",location:Ht,visible:!1,onClick:r=>{vBe(r,e);const n=e.getData();bBe({event:t,rows:n})}}),{UNGROUPED:pse}=Iu,{DOUBLES:xSt}=Ul,_St=(t,e)=>i=>{const r=n=>{const a=n.getSelectedData(),s=a.filter(c=>!c.events?.length).map(({participantId:c})=>c);Nt({methods:[{method:Kut,params:{removeGroupParticipant:!0,participantIds:s,eventId:t,drawId:e}}],callback:c=>{if(c?.error)n.deselectRow(),Pt({message:c.error[0]?.message??"Error destroying pair",intent:"is-danger"});else{n.deleteRow(s);const d=dC(n.element,"tableClass")?.parent?.getElementsByClassName("controlBar")?.[0];d&&setTimeout(()=>EZ({target:d})(),100);const p=a.flatMap(({participant:m})=>m?.individualParticipantIds),{participants:f}=Ge.getParticipants({participantFilters:{participantIds:p}}),h=f.map(m=>NN({entry:{participantId:m.participantId,entryStatus:pse},eventType:xSt,participant:m}));ot.tables[pse].updateOrAddData(h)}}})};return{onClick:()=>r(i),label:"Destroy pairs",intent:"is-danger",location:sa}},OSt=(t,e)=>{const r=t.getSelectedData().map(({participantId:o})=>o),n=e.entries.filter(({participantId:o})=>r.includes(o)),a=[{method:kut,params:{eventId:e.eventId,drawName:"Flight",drawEntries:n}}];Nt({methods:a,callback:o=>{o.success?t.deselectRow():console.log(o.error)}})},FSt=(t,e)=>i=>({onClick:()=>OSt(i,t),label:"Add flight",location:sa,hide:e}),LSt=(t,e,i,r)=>{const a=t.getSelectedData().filter(o=>!o.events?.length).map(({participantId:o})=>o);ABe({participantIds:a,group:e,eventId:i,drawId:r,callback:o=>{if(o?.success){const c=t.getData().filter(({participantId:u})=>a.includes(u));ot.tables[e].updateOrAddData(c),t.deleteRow(a)}else t.deselectRow(),Pt({message:o.error.message??"Error moving participants",intent:"is-danger"})}})},gD=(t,e,i)=>r=>{const n=t.map(a=>({onClick:()=>LSt(r,a,e,i),stateChange:!0,label:a,value:a,close:!0}));return{label:"Move participants",location:sa,options:n}},{ASSIGN_PARTICIPANT:$St}=Qw,aQ=(t,e)=>i=>({label:"Add entries",class:"addEntries",location:Ht,onClick:()=>{const{entries:n=[],eventId:a,eventType:s}=t,o=new Set((n||[]).map(({participantId:p})=>p)),l=t.eventType==="TEAM"&&"TEAM"||t.eventType==="DOUBLES"&&"PAIR"||"INDIVIDUAL",c=Ge.getParticipants({inContext:!0,participantFilters:{participantTypes:[l]},withISO2:!0}).participants.filter(p=>!o.has(p.participantId));RN({title:"Select participants to add",activeOnEnter:!0,selectionLimit:99,onSelection:({selected:p})=>{if(!p?.length)return;const f=p.map(({participantId:v})=>v),h=e===WR?"QUALIFYING":"MAIN",m="DIRECT_ACCEPTANCE";Nt({methods:[{params:{eventId:a,participantIds:f,entryStatus:m,entryStage:h,enforceGender:!0,enforceCategory:!0},method:oZ}],callback:v=>{if(v.success){const{participants:b,derivedDrawInfo:y}=Ge.getParticipants({participantFilters:{participantIds:f},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0}),I=f.map(w=>NN({entry:{participantId:w,entryStage:h,entryStatus:m},derivedDrawInfo:y,participants:b,eventType:s,eventId:a}));i.addRow(I)}else{const b=v.context;let y=[];if(b){if(b.categoryRejections?.length&&y.push(...b.categoryRejections.map(I=>({participantId:I.participantId,participantName:I.participantName,errors:[{error:I.rejectionReasons[0]?.type||"categoryRejection",reason:I.rejectionReasons[0]?.reason}]}))),b.mismatchedGender?.length){const I=b.gender;y.push(...b.mismatchedGender.map(w=>({participantId:w.participantId,errors:[{error:"mismatchedGender",sex:w.sex,expectedGender:I}]})))}b.invalidAge?.length&&y.push(...b.invalidAge.map(I=>({participantId:I.participantId,errors:[{error:"invalidAge",...I}]}))),b.invalidRating?.length&&y.push(...b.invalidRating.map(I=>({participantId:I.participantId,errors:[{error:"invalidRating",...I}]})))}y.length&&(Wy(),setTimeout(()=>{gNe({invalidParticipants:y})},100))}}})},action:{type:$St,participantsAvailable:c}})}}),{ALTERNATE:sQ,UNGROUPED:HSt}=Iu,{MAIN:fse}=Wn,{DOUBLES:hse}=Ul,VSt=(t,e=!0)=>{const{eventId:i,eventType:r,gender:n}=t,a=(l,c)=>{const u=c.getSelectedData().map(A=>A.participantId);if(u.length!==2)return;const p=[Ri.UUID()],f=[{method:$ut,params:{participantIdPairs:[u],allowDuplicateParticipantIdPairs:!0,entryStatus:sQ,entryStage:fse,eventId:i,uuids:p}}],h=A=>{c.deleteRow(u),c.clearFilter();const g=dC(c.element,"tableClass");if(g){const I=Mg(g,"controlBar")?.[0];if(I){const w=Mg(I,"search");Array.from(w).forEach(S=>S.value="")}}const v=A.results[0].newParticipantIds,{participants:[b],derivedDrawInfo:y}=Ge.getParticipants({participantFilters:{participantIds:v},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0,withISO2:!0});if(b){const{event:I}=Ge.getEvent({eventId:i}),w=I?.category?.categoryName??I?.category?.ageCategoryCode,S=NN({entry:{participantId:b.participantId,entryStatus:sQ,entryStage:fse},derivedDrawInfo:y,eventType:hse,categoryName:w,participant:b,eventId:i});ot.tables[sQ]?.updateOrAddData([S]);const D=dC(l.target,"tableClass")?.parent?.getElementsByClassName("controlBar")?.[0];D&&setTimeout(()=>EZ({target:D})(),100)}else console.log("participant not found",{participantIds:v,methods:f,result:A})};Nt({methods:f,callback:A=>{A.success?h(A):A.error?.code==="ERR_INVALID_PARTICIPANT_IDS"?(Pt({intent:"is-danger",message:n==="MIXED"?"Genders must be mixed":"Invalid pairing"}),c.deselectRow()):console.log({methods:f,result:A})}})};return{createPairButton:{hide:r!==hse,label:"Create pair",onClick:a,intent:"is-info",location:sa,id:"create-pair",visible:!1},createPairFromSelected:l=>{const c=l?.length===2;if(c&&e){const u=ot.tables[HSt];a({target:u.element},u)}else{const u=document.getElementById("create-pair");u&&(u.style.display=c?"":jt)}}}},{DIRECT_ACCEPTANCE:GSt}=Iu,{MAIN:QSt}=Wn,jSt=(t,e,i)=>{const n=t.getSelectedData().filter(o=>!o.events?.length).map(({participantId:o})=>o);Nt({methods:[{method:_ut,params:{entryStatus:GSt,ignoreStageSpace:!0,entryStage:QSt,participantIds:n,eventId:e,drawId:i}}],callback:o=>{o.success?t.deselectRow():console.log(o.error)}})},zSt=(t,e)=>i=>{const r=(t.drawDefinitions||[]).filter(Boolean).map(({drawName:n,drawId:a})=>({onClick:()=>jSt(i,t.eventId,a),stateChange:!0,label:n,value:a,close:!0}));return{hide:!t.drawDefinitions?.length||e,label:"Add to draw",location:sa,options:r}},{DIRECT_ACCEPTANCE:qSt,ALTERNATE:GA,UNGROUPED:oQ,WITHDRAWN:Ep}=Iu,{MAIN:lU,QUALIFYING:Tv}=Wn,{SINGLES:WSt,DOUBLES:kB}=Ul;function KSt({drawDefinition:t,event:e,entryData:i,hasFlights:r}){const n=v=>i.filter(({entryStage:b=lU,entryStatus:y})=>v.includes(`${b}.${y}`)),a=!!t,s=t?.drawId,o=e?.eventId,l={[Qu]:[GA,Ep],[Tv]:[Qu,GA,Ep],[GA]:[Qu,Tv,Ep],[Ep]:e?.eventType===kB?[oQ]:[GA]},{createPairButton:c}=VSt(e,!1),u=r?[]:["flights"],d=v=>{const b=v.getData("active"),y=b.map(({participantId:I})=>I);return b.length===1?(v.selectRow(y),!0):(b.length===2&&v.selectRow(y),!1)},p=v=>{if(v?.length){const S=document.getElementsByClassName("search");Array.from(S).forEach(T=>{T.value&&(T.value="")}),setTimeout(()=>{const T=document.querySelector(".options_overlay .search");T&&T.focus()},50)}const b=document.getElementById("create-pair"),y=document.getElementById("auto-pair-toggle");y&&!y.hasAttribute("data-enabled")&&y.setAttribute("data-enabled","true");const I=y?.getAttribute("data-enabled")==="true",w=v?.length===2;e?.eventType===kB&&w?I?b?.click():b&&(b.style.display=""):b&&(b.style.display="none")},f=n(yO(lU)),h=n([`${Tv}.${qSt}`]),m=n([`${lU}.${GA}`]),A=n([`${lU}.${oQ}`]),g=n([`${lU}.${Ep}`]);return[{placeholder:"No accepted participants",items:[gD(l[Qu],o,s),NSt(yO(lU),o,s),zSt(e,s),FSt(e,s),...AD({heading:"Accepted",count:f.length}),!a&&use(e,Qu),j3(e),z3(e),!a&&aQ(e,Qu)],actions:l[Qu],anchorId:G6,entries:f,group:Qu,excludeColumns:u,drawCreated:a,togglePanel:CU},{placeholder:"No qualifying participants",items:[...AD({heading:"Qualifying",count:h.length}),gD(l[Tv],o,s),!a&&use(e,Tv),j3(e),z3(e),!a&&aQ(e,Tv)],actions:[Qu,GA,Ep],anchorId:j6,entries:h,group:Tv,excludeColumns:u,drawCreated:a,togglePanel:CU},{items:[...AD({heading:"Alternates",count:m.length}),gD(l[GA],o,s),e?.eventType===kB&&_St(o,s),!a&&aQ(e,GA)],actions:[Qu,Tv,Ep],excludeColumns:["seedNumber","flights"],placeholder:"No alternates",anchorId:Q6,entries:m,group:GA,drawCreated:a,togglePanel:CU},{hide:!!([WSt].includes(e?.eventType)||a),items:[...AD({heading:"Ungrouped",count:A.length}),dse(ii,"participantId",d),dse(sa,"participantId",d),c,gD([Ep],o,s),{hide:e?.eventType!==kB,onClick:v=>{const b=v.target.closest("button"),I=!(b.getAttribute("data-enabled")==="true");b.setAttribute("data-enabled",String(I)),b.innerHTML=`Auto Pair: ${I?"ON":"OFF"}`;const w=document.getElementById("create-pair");w&&I&&(w.style.display="none")},label:"Auto Pair: ON",intent:"is-info",id:"auto-pair-toggle",location:Ht}],placeholder:"No ungrouped participants",excludeColumns:["seedNumber","flights"],onSelection:p,anchorId:z6,entries:A,actions:[Ep],group:oQ,drawCreated:a,togglePanel:CU},{items:[...AD({heading:"Withdrawn",count:g.length}),!a&&gD(l[Ep],o,s)],placeholder:"No withdrawn participants",excludeColumns:["seedNumber","flights"],anchorId:q6,entries:g,actions:l[Ep],hide:a,group:Ep,collapsed:!0,drawCreated:a,togglePanel:CU}]}function mse({headerElement:t,eventId:e,drawId:i}){(!e||e==="undefined")&&ot.router.navigate("/");let r;const n=l=>{r&&Object.values(ot.tables).forEach(u=>u.removeFilter(r));const c=l?.toLowerCase();r=u=>u.searchText?.includes(c),l?Object.values(ot.tables).forEach(u=>u.addFilter(r)):r=void 0},a=()=>{const{event:l,drawDefinition:c}=Ge.getEvent({eventId:e,drawId:i});if(t&&(t.innerHTML=l?.eventName),!l)return{error:"EVENT_NOT_FOUND"};const{participants:u,derivedDrawInfo:d}=Ge.getParticipants({participantFilters:{eventIds:[e]},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0,withISO2:!0})??{},p=l?.drawDefinitions?.length>1,f=l.category?.categoryName??l.category?.ageCategoryCode,h=(c?.entries||l?.entries||[]).map(A=>NN({eventType:l.eventType,derivedDrawInfo:d,categoryName:f,participants:u,eventId:e,entry:A})),{events:m}=Ge.getEvents();return{tableData:KSt({event:l,drawDefinition:c,entryData:h,hasFlights:p}),events:m,event:l}},s=l=>{for(const c of l){const{entries:u,group:d,anchorId:p,placeholder:f,excludeColumns:h,actions:m,drawCreated:A}=c,g=document.getElementById(p);if(g){g.style.display=c.hide?jt:NT,fo(g);const v=document.createElement("div");v.className=`${wqe} flexcol flexcenter`,g.appendChild(v);const b=document.createElement("div");b.className=`${Rbe} flexcol flexcenter`,g.appendChild(b);const y=new es(b,{headerSortElement:kf(["ratings.utr","ratings.wtn","seedNumber","ranking","cityState","status","flights"]),columns:bSt({actions:m,exclude:h,entries:u,eventId:e,drawId:i,drawCreated:A}),responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,height:"400px",data:u,placeholder:f});ot.tables[d]=y;const I=ac(g,tI);y.on("tableBuilt",()=>{const w=c.items?.map(S=>Mt(S)?S(y):S);eo({target:v,table:y,items:w,onSelection:c.onSelection}),!u.length&&c.togglePanel&&c.togglePanel({target:I,table:y,close:!0})}),y.on("dataChanged",()=>{const T=dC(y.element,"tableClass")?.parent?.getElementsByClassName("controlBar")?.[0]?.getElementsByClassName(Ibe)?.[0],D=y.getData().length;c.togglePanel&&!D&&c.togglePanel({target:I,table:y,close:!0}),T&&(T.innerHTML=D||0)})}}},o=a();if(!o.error){const l="All entries",c=document.getElementById(sE)||void 0,u={label:l,onClick:()=>_n({eventId:e}),close:!0},d=(o.event.drawDefinitions||[]).map(I=>({onClick:()=>_n({eventId:e,drawId:I.drawId}),label:I?.drawName,close:!0})).concat([{divider:!0},u]),p={label:yg,onClick:gBe,close:!0},f=o.events.map(I=>({onClick:()=>_n({eventId:I.eventId}),label:I.eventName,close:!0})).concat([{divider:!0},p]),h=I=>{I.success&&_n({eventId:e,drawId:I.drawDefinition?.drawId,renderDraw:!0})},m={label:"<div style='font-weight: bold'>Add draw</div>",onClick:()=>mw({eventId:e,callback:h})},A=o.event.drawDefinitions?.map(I=>({onClick:()=>_n({eventId:e,drawId:I?.drawId,renderDraw:!0}),label:I?.drawName,close:!0})).concat([{divider:!0},m]),g=o.event?.drawDefinitions?.find(I=>I?.drawId===i)?.drawName,v=({eventId:I})=>{console.log("generateFlights",{eventId:I})},b=cBe({eventId:e})?.length?"is-success":jt,y=[{onKeyDown:I=>I.keyCode===8&&I.target.value.length===1&&n(""),onChange:I=>n(I.target.value),onKeyUp:I=>n(I.target.value),clearSearch:()=>n(""),placeholder:"Search entries",location:ii,search:!0},{label:o.event.eventName,options:f.length>1&&f,location:ii},{label:g||l,options:d,location:ii},{onClick:()=>_n({eventId:e,drawId:i,renderDraw:!0}),label:"View draw",intent:"is-info",location:Ht,hide:!i},{onClick:()=>uBe({eventId:e}),intent:b,id:"editAvoidances",label:"Avoidances",location:Ht},{onClick:()=>v({eventId:e}),label:"Flights",location:Ht,hide:i,intent:jt},{options:A?.length>2&&A,hide:(A?.length||0)<3||i,intent:"is-info",location:Ht,label:"Draws",align:Ht},{onClick:()=>mw({eventId:e,callback:h}),hide:A?.length>2||i,intent:"is-info",label:"Add draw",location:Ht}];eo({target:c,items:y}),o.tableData&&s(o.tableData)}}function YSt({drawId:t,callback:e}){const i=Ge.getEvent({drawId:t})?.drawDefinition?.structures;if(!i?.length)return;const r=i.map(({structureName:c,structureId:u},d)=>({text:`${c}:`,fieldPair:{error:"minimum 4 characters",validator:fi.nameValidator(4),placeholder:c,focus:d===0,field:u,id:u}}));let n;const a=()=>{const c=i.map(({structureId:p})=>n[p]?.value&&{structureId:p,structureName:n[p].value.trim()}).filter(Boolean);Nt({methods:[{params:{drawId:t,structureDetails:c},method:aMe}],callback:p=>{p.success&&(Pt({message:"Structure renamed",intent:"is-success"}),Mt(e)&&e?.())}})},s=()=>{const c=i.map(({structureId:f})=>n[f]?.value).filter(Boolean),u=c.every(fi.nameValidator(4)),d=document.getElementById("renameStructures"),p=c.length&&u;d&&(d.disabled=!p)},o=i.map(({structureId:c})=>({control:c,onInput:s}));Jr({title:"Edit structure names",content:c=>n=Sr(c,r,o),buttons:[{label:"Cancel",intent:jt,close:!0},{label:"Rename",id:"renameStructures",disabled:!0,intent:"is-info",close:!0,onClick:a}]})}function XSt({drawId:t,structure:e,callback:i}){const n=Object.values(e.roundMatchUps).flat().reduce((d,p)=>{const{structureName:f,structureId:h}=p;return d[h]||(d[h]={structureName:f,structureId:h}),d},{}),a=Object.values(n).map(({structureName:d,structureId:p})=>({text:`${d}:`,fieldPair:{error:"minimum 4 characters",validator:fi.nameValidator(4),placeholder:d,field:p,id:p}}));let s;const o=()=>{const d=Object.values(n).map(({structureId:h})=>s[h]?.value&&{structureId:h,structureName:s[h].value.trim()}).filter(Boolean);Nt({methods:[{params:{drawId:t,structureDetails:d},method:aMe}],callback:h=>{h.success&&(Pt({message:"Groups renamed",intent:"is-success"}),Mt(i)&&i?.(h))}})},l=()=>{const d=Object.values(n).map(({structureId:m})=>s[m]?.value).filter(Boolean),p=d.every(fi.nameValidator(4)),f=document.getElementById("renameGroups"),h=d.length&&p;f&&(f.disabled=!h)},c=Object.values(n).map(({structureId:d})=>({control:d,onInput:l}));Jr({title:"Edit group names",content:d=>s=Sr(d,a,c),buttons:[{label:"Cancel",intent:jt,close:!0},{label:"Rename",id:"renameGroups",disabled:!0,intent:"is-info",close:!0,onClick:o}]})}const{ROUND_ROBIN:Ase,SINGLE_ELIMINATION:ZSt}=Wn;function JSt({callback:t,drawId:e,structureId:i,playoffFinishingPositionRanges:r}){const n=S=>`finishingPosition-${S}`,a=r.map(({finishingPosition:S,finishingPositionRange:T})=>({field:n(S),id:n(S),label:S,checkbox:!0,fieldPair:{text:`Creates playoff for positions ${T}`,width:"400px"}}));if(!a||a.length<1){Pt({message:"No playoff positions available",intent:"is-danger"});return}const s={value:d_,label:"Playoff name",field:"structureName",id:"structureName"},o=dBe({isPlayoff:!0}),l={value:ZSt,options:o,label:"Draw type",field:Kf,id:Kf},{validGroupSizes:c}=Ge.getValidGroupSizes({drawSize:4,groupSizeLimit:8}),d={options:c.map(S=>({label:S,value:S})),label:"Group size",field:mm,visible:!1,value:4},p="Positions to be played off:",f={text:`${p} None`,id:"selectedPlayoffRange"},m=[s,l,d,f,{text:"Select group finishing positions. Selections must be sequential"}].concat(a);let A;const g=()=>{const T=r.filter(({finishingPosition:M})=>A[n(M)]?.checked).map(({finishingPosition:M})=>M),D=A.structureName.value,C=A[Kf].value,E={finishingPositions:T,structureName:D,drawType:C};if(C===Ase){const M=Number.parseInt(A[mm].value);E.structureOptions={groupSize:M}}Nt({methods:[{params:{drawId:e,structureId:i,playoffGroups:[E],playoffStructureNameBase:d_},method:eMe}],callback:M=>{M.success?(Pt({message:"Structure added",intent:"is-success"}),Mt(t)&&t?.()):(console.log({result:M}),Pt({message:M.error?.message||"Error",intent:"is-danger"}))}})},v=S=>`${Math.min(...S)}-${Math.max(...S)}`,b=()=>{const S=r.filter(({finishingPosition:F})=>A[n(F)]?.checked).flatMap(({finishingPositions:F})=>F),T=r.map(({finishingPosition:F})=>A[n(F)].checked),D=r.map(({finishingPosition:F})=>A[n(F)].checked&&F).filter(Boolean),C=D.map((F,_)=>(D[_+1]||F)-F).every(F=>F<2),E=T.filter(Boolean).length,P=document.getElementById("addStructure"),R=E&&C;P&&(P.disabled=!R);const M=document.getElementById("selectedPlayoffRange");if(M){const F=R?v(S):"None";M.innerHTML=`${p} ${F}`}const{validGroupSizes:N}=Ge.getValidGroupSizes({drawSize:S?.length||4,groupSizeLimit:8}),k=N.map(F=>({label:F,value:F})),O=A[mm],x=N.includes(4)?4:N[0];fo(O),y8(O,{options:k,value:x})},y=({e:S,fields:T})=>{const D=S.target.value,C=[Ase].includes(D);T[mm].style.display=C?"":jt},I=r.map(({finishingPosition:S})=>({control:n(S),onChange:b})).concat([{onChange:y,control:Kf}]);Jr({title:"Add playoff structure",content:S=>A=Sr(S,m,I),buttons:[{label:"Cancel",intent:jt,close:!0},{label:"Add",id:"addStructure",intent:"is-info",disabled:!0,close:!0,onClick:g}]})}function eUt({drawId:t,structureId:e,callback:i}){const r=Ge.getAvailablePlayoffProfiles({drawId:t,structureId:e}),n=h=>h.finishingPositions.reduce((m,A)=>(m||0)+(A||0));if(!r.playoffRoundsRanges&&r.finishingPositionsAvailable?.length)return JSt({...r,drawId:t,structureId:e,callback:i});const a=r.playoffRoundsRanges?.sort((h,m)=>n(h)-n(m)).map(({finishingPositionRange:h})=>({label:h,field:h,id:h,checkbox:!0,fieldPair:{field:`${h}-name`,placeholder:`${d_} ${h}`,id:`${h}-name`,width:"350px"}}));if(!a||a.length<1){Pt({message:"No playoff positions available",intent:"is-danger"});return}const s=h=>{a.forEach(({label:m,fieldPair:A})=>{const g=document.getElementById(A.id);g&&(g.placeholder=`${h} ${m}`)})},l=[{onChange:h=>s(h.target.value),onKeyDown:h=>h.key==="Tab"&&s(h.target.value),value:d_,label:"Name base",field:"nameBase",id:"nameBase"}].concat(a);let c;const u=()=>{const h=r.playoffRoundsRanges.filter(y=>c[y.finishingPositionRange]?.checked),m=c.nameBase.value,A={},g=h.map(({roundNumber:y,finishingPositionRange:I})=>{const w=c[`${I}-name`]?.value;return w&&(A[`0-${y}`]={name:w}),{[y]:1}});Nt({methods:[{params:{drawId:t,structureId:e,playoffAttributes:A,roundProfiles:g,playoffStructureNameBase:m},method:eMe}],callback:y=>{y.success?(Pt({message:"Structure(s) added",intent:"is-success"}),Mt(i)&&i?.()):Pt({message:y.error?.message||"Error",intent:"is-danger"})}})},d=()=>{const h=r.playoffRoundsRanges.filter(A=>c[A.finishingPositionRange]?.checked),m=document.getElementById("addStructure");m&&(m.disabled=!h.length)},p=r.playoffRoundsRanges.map(({finishingPositionRange:h})=>({control:h,onChange:d}));Jr({title:"Add playoff structures",content:h=>c=Sr(h,l,p),buttons:[{label:"Cancel",intent:jt,close:!0},{label:"Add",id:"addStructure",disabled:!0,intent:"is-info",close:!0,onClick:u}]})}const{FINISHING_POSITIONS:tUt,CONTAINER:iUt}=Wn;function rUt({drawData:t,eventId:e,structureId:i,updateControlBar:r}){const n=t.drawId,a=Ge.getAvailablePlayoffProfiles({drawId:n,structureId:i})?.playoffRounds?.length,s=Ge.isValidForQualifying({drawId:n,structureId:i})?.valid,o=()=>{mw({callback:u=>{if(u.success){const d=u.structure.structureId;_n({eventId:e,drawId:n,structureId:d,renderDraw:!0})}},drawName:"Qualifying",isQualifying:!0,structureId:i,eventId:e,drawId:n})},l=t.structures.find(u=>u.structureId===i),c=l?.structureType===iUt;return t.structures.sort((u,d)=>Ri.structureSort(u,d,{mode:tUt})).map(u=>({onClick:()=>{_n({eventId:e,drawId:n,structureId:u.structureId,renderDraw:!0})},label:u.structureName,close:!0})).concat([{divider:!0},{onClick:()=>YSt({drawId:n,callback:()=>r(!0)}),label:"Edit structure names",modifyLabel:!1,close:!0},{onClick:()=>XSt({drawId:n,structure:l,callback:u=>console.log(u)}),label:"Edit group names",hide:!c,modifyLabel:!1,close:!0},{onClick:()=>o(),hide:!s,label:"Add qualifying",modifyLabel:!1,close:!0},{onClick:()=>eUt({drawId:n,structureId:i,callback:()=>r(!0)}),hide:!a,label:"Add playoffs",modifyLabel:!1,close:!0}])}function nUt(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML))e.style.fontWeight="bold",e.style.color="#ed0c76"}function aUt(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML))e.style.fontWeight="",e.style.color=""}function TBe({drawId:t,roundNumber:e,structure:i,structureId:r,callback:n}={}){r=r||i?.structureId;const a=Ge.allDrawMatchUps({matchUpFilters:{structureIds:[r]},drawId:t}).matchUps||[],s=a.reduce((h,m)=>{const A=m.roundNumber;return A&&!h.includes(A)&&h.push(A),h},[]);if(e=e||s.length&&s[s.length-1],!e)return;let o;const c=[{label:"Cancel",intent:"none",close:!0},{label:"Delete",intent:"is-danger",close:!0,onClick:()=>{const h=a.filter(g=>{if(g.roundNumber===e)return g.winningSide&&o.completed.checked||g.sides.some(({participantId:v})=>v)&&!g.winningSide&&o.unscored.checked?!0:g.sides.every(({participantId:v})=>!v)&&o.empties.checked}).map(({matchUpId:g})=>g),m=[{params:{removeCompleted:o.completed.checked,removeIncomplete:o.unscored.checked,removeUnassigned:o.empties.checked,structureId:r,matchUpIds:h,drawId:t},method:tMe}],A=g=>{g.success?Mt(n)&&n&&n({refresh:!0}):console.log({postMutationError:g.error})};h.length&&Nt({methods:m,callback:A})}}],p=[{text:"Round number",fieldPair:{options:s.map(h=>({label:h,value:h})),field:"roundNumber",value:e,id:"roundNumber"}},{spacer:!0},{label:"Remove empty (TBD) matches",intent:"is-success",checkbox:!0,field:"empties",checked:!0,id:"empties"},{label:"Remove incomplete/unscored matches",intent:"is-danger",field:"unscored",checkbox:!0,id:"unscored"},{label:"Remove completed matches",intent:"is-danger",field:"completed",id:"completed",checkbox:!0,color:"red"}];Jr({title:"Delete matches",content:h=>o=Sr(h,p),buttons:c})}function CBe({drawId:t,structure:e,structureId:i,roundNumber:r,callback:n}={}){i=i||e?.structureId;const a=Ge.allDrawMatchUps({matchUpFilters:{structureIds:[i]},drawId:t}).matchUps||[],s=a.reduce((g,v)=>{const b=v.roundNumber;return b&&!g.includes(b)&&g.push(b),g},[]),o=Math.max(...s,1);a.length?s.push(o+1):s.length||s.push(1);let l;const u=[{label:"Cancel",intent:"none",close:!0},{label:"Add",intent:"is-success",close:!0,onClick:()=>{const g=Number.parseInt(l.roundNumber.value),v=l.matchUpsCount.value==="Auto"?void 0:Number.parseInt(l.matchUpsCount.value),b=Ge.generateAdHocMatchUps({roundNumber:g,matchUpsCount:v,structureId:i,drawId:t});if(!b.matchUps?.length)return;const y=[{method:XRe,params:{matchUps:b.matchUps,structureId:i,drawId:t}}];Nt({methods:y,callback:w=>{w.success?Mt(n)&&n&&n({refresh:!0}):console.log(w.error)}})}}],p={text:"Round number:",fieldPair:{options:s.map(g=>({label:g,value:g})),field:"roundNumber",value:r,id:"roundNumber"}},h={text:"Number to add:",fieldPair:{options:["Auto",1,5,10].map(g=>({label:g,value:g})),field:"matchUpsCount",id:"matchUpsCount",value:"Auto"}},m=[p,{spacer:!0},h];Jr({title:"Add matches",content:g=>l=Sr(g,m),buttons:u})}const{ASSIGN_PARTICIPANT:sUt}=Qw;function zZ({drawId:t,structure:e,structureId:i,callback:r}={}){i=i||e?.structureId;let n,a;const s=Ge.allDrawMatchUps({matchUpFilters:{structureIds:[i]},drawId:t}).matchUps||[],o=s.reduce((g,v)=>{const b=v.roundNumber;return b&&!g.includes(b)&&g.push(b),g},[]),l=o[o.length-1],c=Math.max(...o,1);s.length&&o.push(c+1);const u=({matchUps:g,roundResults:v})=>{const b=[{params:{structureId:i,matchUps:g,drawId:t},method:XRe}];if(v?.length)for(const I of v){const w=I?.modifiedScaleValues;b.push({params:{modifiedScaleValues:w,replacePriorValues:!0},method:Fut})}Nt({methods:b,callback:I=>{I.success?Mt(r)&&r&&r({refresh:!0}):console.log(I.error)}})},d=g=>{const v=a.wtn.checked&&"wtn"||a.utr.checked&&"utr"||"",{accessor:b,scaleName:y}=$t.scales[v]??{};vO(v);const I=Ge.drawMatic({updateParticipantRatings:!0,dynamicRatings:!0,refreshRatings:!0,participantIds:g,scaleAccessor:b,scaleName:y,drawId:t});I.matchUps?.length&&u(I)},p=({participantIds:g})=>{const v=Ge.getParticipants({participantFilters:{participantIds:g}}).participants,b=l?s.filter(({roundNumber:S,sides:T})=>S===l&&T?.some(({participantId:D})=>D)).flatMap(({sides:S})=>S.map(({participantId:T})=>T)):[],y=b.length?b:g;RN({title:"Confirm player selection",selectedParticipantIds:y,activeOnEnter:!0,selectionLimit:99,onSelection:S=>{const T=S.selected?.map(({participantId:D})=>D);d(T)},action:{type:sUt,participantsAvailable:v},update:n})},h=[{label:"Cancel",intent:"none",close:!0},{label:"Add round",intent:"is-success",close:!1,onClick:()=>{if(a[Zc].value===Zc){const{drawDefinition:g}=Ge.getEvent({drawId:t}),v=g.entries.filter(({entryStatus:b,entryStage:y})=>!["WITHDRAWN","UNGROUPED"].includes(b)&&(!y||y===e.stage)).map(({participantId:b})=>b);p({participantIds:v})}else{Wy();const g=Ge.generateAdHocMatchUps({newRound:!0,structureId:i,drawId:t});if(!g.matchUps?.length)return;u(g)}}}],m=[{field:Zc,value:Zc,options:[{label:Zc,value:Zc,selected:!0},{label:$6,value:!1}]},{options:[{text:"WTN",field:"wtn",checked:$t.activeScale===DP},{text:"UTR",field:"utr",checked:$t.activeScale===ZI},{text:"None",field:"none",checked:!$t.activeScale}],onClick:g=>console.log({x:g}),label:"Level of play",field:"levelOfPlay",id:"levelOfPlay",radio:!0}];n=Jr({title:"Add round",content:g=>a=Sr(g,m),buttons:h}).update}const EBe="Delete matches",DBe="Add matches",PBe="Add round";function oUt({structure:t,drawId:e,callback:i}){if(!Ge.isAdHoc({structure:t}))return{};const r=()=>i({refresh:!0});return{label:"Round actions",options:[{onClick:()=>CBe({drawId:e,structure:t,callback:r}),label:DBe,color:"blue"},{onClick:()=>zZ({drawId:e,structure:t,callback:r}),label:PBe,color:"blue"},{label:EBe,color:"red",onClick:()=>TBe({drawId:e,structure:t,callback:r})}],selection:!1,location:Ht,align:Ht}}const{CONTAINER:lUt}=Wn;function cUt({callback:t,structure:e,existingView:i}){const r=o=>i!==o&&t({refresh:!0,view:o}),n=e?.structureType===lUt,a=Ge.isAdHoc({structure:e}),s=[];return s.push({active:!i||i===c4,onClick:()=>r(c4),label:a?"Columns":"Draw",close:!0}),s.push({active:i===kT,onClick:()=>r(kT),label:"Table",close:!0}),(a||n)&&s.push({active:i===BT,onClick:()=>r(BT),label:"Stats",close:!0}),{tabs:s}}const{MAIN:uUt,QUALIFYING:dUt,VOLUNTARY_CONSOLATION:pUt}=Wn,gse="autoPositionPlayoff";function qZ({updateDisplay:t,existingView:e,structure:i,callback:r,drawId:n}){const a=document.getElementById(V6),{sourceStructuresComplete:s,hasDrawFeedProfile:o}=i??{},l=!(i?.stage===uUt&&i?.stageSequence===1)&&i?.stage!==dUt&&o,c=Ge.isAdHoc({structure:i}),u=[];let d=null;if(l){const h=()=>{const A=i.sourceStructureIds[0],g=Ge.automatedPlayoffPositioning({structureId:A,applyPositioning:!1,drawId:n});if(!g.success||!g.structurePositionAssignments?.length){Pt({message:g.error?.message||"No position assignments generated",intent:"is-warning"});return}d.elements[gse].style.display=jt;const v={params:{structurePositionAssignments:g.structurePositionAssignments,structureId:i.structureId,drawId:n},method:rdt};Nt({methods:[v],callback:y=>{y.success&&typeof t=="function"?t():y.error&&Pt({message:y.error.message||"Failed to set positions",intent:"is-danger"})}})},m=i.positionAssignments?.filter(({participantId:A})=>A).length;u.push({intent:s?"is-primary":jt,disabled:s!==!0,visible:!m,onClick:h,id:gse,label:"Auto position",location:Ht})}const p=({refresh:h,view:m})=>typeof r=="function"&&r?.({refresh:h,view:m});if(c){const h=oUt({structure:i,drawId:n,callback:r});u.push(h)}i?.stage===pUt&&console.log("voluntary controlBar with [View participants]");const f=cUt({structure:i,existingView:e,callback:p}).tabs;u.push({onClick:()=>p({refresh:!0,view:"participants"}),id:"roundDisplayTabs",location:ii,tabs:f}),u.length&&a&&(d=eo({target:a,items:u}))}function HH(){[V6,Sbe,Ube].forEach(t=>{const e=document.getElementById(t);e&&fo(e)})}const fUt=t=>t.reduce((e,i)=>e+Number.parseFloat(i.toString()),0),vse=t=>Number.parseFloat((fUt(t)/t.length).toFixed(2));function yse({participantResult:t,participantMap:e,participantId:i,drawPosition:r}={}){const n=`${t?.pointsWon||0}/${t?.pointsLost||0}`,a=`${t?.gamesWon||0}/${t?.gamesLost||0}`,s=`${t?.setsWon||0}/${t?.setsLost||0}`,o=t?.groupOrder||t?.provisionalOrder,l=t?.pressureScores?.length?vse(t.pressureScores):0,c=t?.ratingVariation?.length?vse(t.ratingVariation):0,u=e?.[i||""],d=t?.subOrder||0,p=t?.ties||0;return{participantName:u?.participantName,groupName:u?.groupName,...t,averageVariation:c,averagePressure:l,participantId:i,pointsResult:n,drawPosition:r,participant:u,gamesResult:a,setsResult:s,subOrder:d,order:o,ties:p}}function q3(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:t-e}const hUt=t=>{const e=document.createElement("div"),i=t.getValue(),n=t.getRow()?.getData();if(n?.ties){const o=n?.subOrder?"blue":"red";e.innerHTML=`<span style='font-weight: bold; color: ${o}'>[${Ad(i)?i.groupOrder:i}]</span>`}else e.innerHTML=(Ad(i)?i.groupOrder:i)||"";return e};function cU(t){const e=t.getValue();return e&&`${(Number.parseFloat(e)*100).toFixed(0)}%`}function bse(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:e-t}function mUt({tiedAssignments:t,participants:e,structureId:i,drawId:r,callback:n}){if(!e?.length||!t?.length)return;const a=e.length,s=Array.from({length:a},(m,A)=>({label:(A+1).toString(),value:A+1}));let o;const l=m=>(m.individualParticipantIds||[]).length>0&&m.individualParticipants?m.individualParticipants.map(g=>g.participantName||"Unknown").join(" / "):m.participantName||"Unknown Participant",c=()=>{const m=e.map(y=>o[y.participantId]?.value).filter(y=>y!==void 0&&y!==""),A=new Set(m),g=m.length===a,v=A.size===m.length,b=document.getElementById("submitOrder");b&&(b.disabled=!(g&&v))},u=m=>{const A=o[m]?.value;A&&e.forEach(g=>{if(g.participantId!==m&&o[g.participantId]?.value===A){const b=s.map(y=>y.value).filter(y=>e.every(I=>I.participantId===g.participantId||o[I.participantId]?.value!==y));if(b.length===1){const y=document.getElementById(g.participantId);y&&(y.value=b[0].toString(),o[g.participantId].value=b[0])}else{const y=document.getElementById(g.participantId);y&&(y.value="",o[g.participantId].value=void 0)}}}),c()},d=e.map(m=>({control:m.participantId,onChange:()=>u(m.participantId)})),p=e.map(m=>({text:l(m),style:"font-size: 0.9em;",fieldPair:{options:[{label:"",value:""},...s],field:m.participantId,id:m.participantId,style:"font-size: 0.9em;",width:"80px",value:""}}));Jr({title:"Order Resolution",content:m=>o=Sr(m,p,d),buttons:[{label:"Cancel",intent:jt,close:!0},{label:"Submit",id:"submitOrder",disabled:!0,intent:"is-info",close:!0,onClick:()=>{const m=t.map(v=>({groupOrder:o[v.participantId]?.value,participantId:v.participantId,drawPosition:v.drawPosition})),A=t.map(v=>{const b=o[v.participantId]?.value;return b?{method:adt,params:{drawPosition:v.drawPosition,structureId:i,subOrder:b,drawId:r}}:null}).filter(Boolean);Nt({methods:A,callback:v=>{v.success?(Pt({message:"Order assignments updated",intent:"is-success"}),Mt(n)&&n(m)):Pt({message:"Failed to update order assignments",intent:"is-error"})}})}}]})}function AUt(t,e){return t?.find(i=>i.structureId===e)}function gUt(t,e){return t?.some(i=>i.drawPosition===e)}function vUt(t,e){return t.structures?.find(i=>gUt(i.positionAssignments,e))}function yUt(t,e){return t?.filter(i=>i.extensions?.find(r=>r.name==="tally")?.value?.groupOrder===e).map(i=>({drawPosition:i.drawPosition,participantId:i.participantId}))}const bUt=({eventId:t,drawId:e,structureId:i,table:r})=>(n,a)=>{const s=a.getRow(),o=u=>{const d=r.getRows(),p=new Set(u.map(f=>f.drawPosition));for(const f of d){const h=f.getData();if(p.has(h.drawPosition)){const m=u?.find(A=>A.drawPosition===h.drawPosition)?.groupOrder||h.groupOrder;Object.assign(h,{groupOrder:m}),f.update(h)}}},l=s?.getData();if(l?.ties){const{drawDefinition:u}=Ge.getEvent({eventId:t,drawId:e,structureId:i});if(u){const d=AUt(u.structures,i),p=vUt(d,l.drawPosition),f=yUt(p.positionAssignments,l.order),h=f.map(A=>A.participantId),m=Ge.getParticipants({participantFilters:{participantIds:h}})?.participants?.sort((A,g)=>{const v=f.find(y=>y.participantId===A.participantId)?.drawPosition||0,b=f.find(y=>y.participantId===g.participantId)?.drawPosition||0;return v-b})||[];mUt({tiedAssignments:f,participants:m,structureId:i,callback:o,drawId:e})}}};function IUt({eventId:t,drawId:e,structureId:i,table:r}){return[{headerMenu:TA({}),field:"drawPosition",headerSort:!1,hozAlign:ii,width:55},{formatter:"responsiveCollapse",hozAlign:si,responsive:!1,headerSort:!1,resizable:!1,width:50},{formatter:Bb(({event:n,cell:a,...s})=>console.log("cell clicked",{event:n,cell:a,undefined:void 0,params:s})),sorter:AC,field:"participantName",responsive:!1,resizable:!1,maxWidth:400,minWidth:200,widthGrow:2,title:"Name"},{headerHozAlign:si,headerWordWrap:!0,title:"Match W/L",hozAlign:si,maxWidth:80,field:"result"},{formatter:cU,headerHozAlign:si,headerWordWrap:!0,field:"matchUpsPct",title:"Match Win%",hozAlign:si,maxWidth:80},{headerHozAlign:si,headerWordWrap:!0,field:"setsResult",title:"Sets W/L",hozAlign:si,maxWidth:80},{formatter:cU,headerHozAlign:si,headerWordWrap:!0,title:"Set Win%",hozAlign:si,field:"setsPct",maxWidth:80},{headerHozAlign:si,headerWordWrap:!0,field:"gamesResult",title:"Games W/L",hozAlign:si,maxWidth:80},{formatter:cU,headerHozAlign:si,headerWordWrap:!0,title:"Game Win%",hozAlign:si,field:"gamesPct",maxWidth:80},{headerHozAlign:si,headerWordWrap:!0,field:"pointsResult",title:"Points W/L",hozAlign:si,maxWidth:80},{formatter:cU,headerHozAlign:si,headerWordWrap:!0,title:"Points Win%",field:"pointsPct",hozAlign:si,maxWidth:80},{formatter:cU,field:"averageVariation",headerHozAlign:si,sorter:bse,hozAlign:si,maxWidth:70,title:"RV"},{formatter:cU,field:"averagePressure",headerHozAlign:si,sorter:bse,hozAlign:si,maxWidth:70,title:"PS"},{headerHozAlign:si,field:"pressureOrder",sorter:q3,title:"PS#",hozAlign:si,maxWidth:80},{cellClick:bUt({eventId:t,drawId:e,structureId:i,table:r}),formatter:hUt,headerHozAlign:si,sorter:q3,hozAlign:si,title:"Order",field:"order",maxWidth:80},{field:"groupName",visible:!1,title:"Group"}]}async function RBe({structureId:t,eventId:e,drawId:i}){let r,n,a,s;const o=v=>(v??[]).reduce((b,y)=>(b[y.participantId]=y,b),{}),l={},c=()=>{const{participants:v,eventData:b}=Ge.getEventData({participantFilters:{eventIds:[e],positionedParticipants:!0},participantsProfile:{withScaleValues:!0},allParticipantResults:!0,pressureRating:!0,refreshResults:!0,eventId:e});return a=b?.drawsData?.find(w=>w.drawId===i)?.structures?.find(w=>w.structureId===t),n||(n=o(v)),(a?.roundMatchUps?Object.values(a.roundMatchUps).flat():[]).forEach(({sides:w,structureName:S,structureId:T})=>{l[T]=S,w.forEach(D=>{D.participantId&&(n[D.participantId].groupName=S)})}),(a?.participantResults??[]).filter(w=>{const S=n[w.participantId];return!r||S?.participantName?.toLowerCase().includes(r?.toLowerCase())})},u=c(),d=()=>u?.map(v=>yse({...v,participantMap:n})).sort((v,b)=>q3(v.order,b.order)),p=()=>c()?.map(v=>yse({...v,participantMap:n})),f=v=>{v?.participantFilter!==void 0&&(r=v.participantFilter),s.replaceData(p())},h=d(),m=IUt({eventId:e,drawId:i,structureId:t,table:s});return(v=>{UA({anchorId:df});const b=document.getElementById(df),y=Object.values(l).length>1?["groupName"]:void 0;s=new es(b,{headerSortElement:kf(["averageVariation","averagePressure","participantName","pressureOrder","pointsResult","gamesResult","matchUpsPct","setsResult","pointsPct","gamesPct","setsPct","result","order"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,groupHeader:[I=>I],placeholder:"No participants",responsiveLayout:"collapse",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:y,columns:m,data:v})})(h),qZ({structure:a,drawId:i,existingView:BT,callback:({refresh:v,view:b}={})=>{HH(),b?_n({eventId:e,drawId:i,structureId:t,renderDraw:!0,view:b}):vC({eventId:e,drawId:i,structureId:t,redraw:v,roundsView:b})},updateDisplay:f}),iJ({eventId:e,drawId:i,structureId:t,updateDisplay:f}),{table:s,replaceTableData:f}}const Ise=(function(){let t;const e={elapsed:1e5,held:void 0,touched:void 0,holdTime:800,holdAction:void 0,holdActions:{}},i={};let r={};const n=(d,p)=>d.filter(f=>p.indexOf(f)!==-1).filter((f,h,m)=>m.indexOf(f)===h);e.reset=()=>(r={},e),e.register=(d,p,f,h)=>(typeof f=="function"&&(r[p]||(r[p]={},i[p]=[]),r[p][d]={fx:f,delay:h},i[p]=Object.keys(r[p])),e),e.deRegister=(d,p)=>(r[p]&&(delete r[p][d],i[p]=Object.keys(r[p])),e),e.call=(d,p,...f)=>r?.[p]?.[d]?.fx(...f),e.trigger=(d,p,f,h)=>r[p][d].fx(f,h,p),e.list=()=>console.log(r);const a="ontouchstart"in document.documentElement?"touchstart":"click";document.addEventListener(a,d=>o({evt:d,evnt:"tap"})),document.addEventListener("change",d=>o({evt:d,evnt:"change"})),document.addEventListener("click",d=>o({evt:d,evnt:"click"})),document.addEventListener("mouseover",d=>o({evt:d,evnt:"mouseover",stopPropagation:!1})),document.addEventListener("mouseout",d=>o({evt:d,evnt:"mouseout",stopPropagation:!1})),document.addEventListener("keyup",d=>o({evt:d,evnt:"keyup",stopPropagation:!1}));let s=0;function o({evt:d,evnt:p,stopPropagation:f=!0}){f&&d.stopPropagation();const h=d,m={x:h.clientX,y:h.clientY,pageX:h.pageX,pageY:h.pageY},A=Array.from(d.target.classList),g=A.length&&i[p]?n(A,i[p]):[];if(g.length){const v=new Date().getTime();e.elapsed=v-s,s=v,g.forEach(b=>{l({cls:b,evt:d,evnt:p,mouse:m})})}}function l({cls:d,evt:p,evnt:f,mouse:h}){const m=p.target;r[f][d].fx(m,h,f,p)}document.addEventListener("touchstart",d=>{const p=d;e.touched=p.target,e.coords=[p.touches[0].clientX,p.touches[0].clientY],e.touched&&(t=setTimeout(function(){u()},e.holdTime))},!1),document.addEventListener("touchend",function(){c()},!1),document.addEventListener("touchmove",function(d){const p=d;e.touched!==p.target&&c()},!1);function c(){clearTimeout(t)}function u(){typeof e.holdAction=="function"&&(e.held=e.touched,e.holdAction(e.held,e.coords))}return(function(){let d=!1,p,f="";function h(){clearTimeout(p),d=!0,f!=="can-touch"&&(f="can-touch",document.documentElement.classList.add(f)),p=setTimeout(function(){d=!1},500)}function m(){!d&&f==="can-touch"&&(d=!1,f="",document.documentElement.classList.remove("can-touch"))}document.addEventListener("touchstart",h,{passive:!0}),document.addEventListener("mouseover",m,{passive:!0})})(),e})();function wUt({structure:t,drawId:e,callback:i}){const r=document.createElement("div");r.className="flexcol flexcenter",r.style.width="100%",r.style.height="300px";const n=document.createElement("button");n.onclick=s=>{s.stopPropagation(),s.preventDefault(),zZ({structure:t,callback:i,drawId:e})},n.className="button is-info",n.innerHTML="Generate round",r.appendChild(n);const a=document.getElementById(df);a&&a.appendChild(r)}function SUt({drawData:t,eventId:e,drawId:i}){const r=document.createElement("div");r.className="flexcol flexcenter",r.style.width="100%",r.style.height="300px";const n=document.createElement("button");n.onclick=s=>{s.stopPropagation(),s.preventDefault();const o=t.drawName;mw({callback:l=>{const c=l.drawDefinition?.structures?.find(({stage:u})=>u===WR)?.structureId;_n({eventId:e,drawId:i,structureId:c,renderDraw:!0})},isQualifying:!0,drawName:o,eventId:e,drawId:i})},n.className="button is-info",n.innerHTML="Generate qualifying",r.appendChild(n);const a=document.getElementById(df);a&&a.appendChild(r)}const wse={ALTERNATE:"Assign alternate",ASSIGN:"Assign participant",BYE:"Assign BYE",REMOVE_PARTICIPANT:"Remove assignment",REMOVE:"Remove assignment",QUALIFIER:"Assign qualifier",LUCKY:"Assign Lucky Loser",SEED_VALUE:"Assign seed",SWAP:"Swap draw positions",WITHDRAW:"Withdraw participant"};function UUt({pointerEvent:t,actions:e,callback:i}){const r=t.target,n=s=>{["WITHDRAW","BYE","REMOVE","REMOVE_PARTICIPANT"].includes(s.type)&&TUt({action:s,callback:i}),["ASSIGN","ALTERNATE","SWAP","QUALIFIER","LUCKY"].includes(s.type)&&CUt({action:s,callback:i}),["SEED_VALUE"].includes(s.type)&&EUt({target:r,action:s,callback:i})},a=e?.filter(({type:s})=>wse[s]).map(s=>({option:wse[s.type]||s.type,onClick:()=>n(s)}));a?.length&&nl({options:a,target:r,config:{arrow:!1,offset:[0,0]}})}function TUt({action:t,callback:e}){const i=n=>n.success?e():console.log({result:n}),r=[{method:t.method,params:t.payload}];Nt({methods:r,callback:i})}function CUt({action:t,callback:e}){RN({action:t,onSelection:r=>{const n=s=>s.success?e():console.log({result:s}),a=[{params:{...t.payload,...r},method:t.method}];Nt({methods:a,callback:n})},selectOnEnter:!0})}function EUt({target:t,action:e,callback:i}){let r;function n(s){if(s?.key==="Enter"){const o=s.target.value;if(Ri.isConvertableInteger(o)){const l=u=>u.success?i():console.log({result:u}),c=[{params:{...e.payload,seedValue:o},method:e.method}];Nt({methods:c,callback:l})}r.destroy()}}const a=[{label:"Assign seed number ",validator:fi.numericValidator,placeholder:"Seed number",field:"seedNumber",id:"seedNumber",type:"input",focus:!0,onKeyDown:n}];r=nl({menuItems:a,target:t,config:{arrow:!1,offset:[0,0]}})}function DUt(t){const{structureId:e,drawId:i}=t?.context??t,r=t.eventData?.drawsData?.find(a=>a.drawId===i)?.structures?.find(a=>a.structureId===e),n=[];if(Ge.isAdHoc({structure:r})){const a=[{onClick:()=>CBe({...t}),text:DBe,color:"blue"},{onClick:()=>zZ({...t,structure:r}),text:PBe,color:"blue"},{onClick:()=>TBe({...t}),text:EBe,color:"red"}];n.push(...a)}t?.pointerEvent&&n.length&&nl({items:n,target:t.pointerEvent.target,config:{placement:wd}})}const{TEAM:PUt}=io;function RUt({callback:t,drawId:e,eventData:i}){const r=i?.drawsData?.flatMap(({structures:d})=>d.flatMap(p=>[p.structures?.flatMap(f=>Object.values(f.roundMatchUps||{}).flat()),...Object.values(p.roundMatchUps||{}).flat()]).filter(Boolean)),n=Ri.createMap(r,"matchUpId"),a=d=>{const p=uD(d.pointerEvent.target,"tmx-m","id");return n[p]},s=d=>parseInt(uD(d.pointerEvent.target,"tmx-sd","sideNumber")),o=d=>uD(d.pointerEvent.target,"tmx-str","id"),l=d=>parseInt(uD(d.pointerEvent.target,"tmx-rd","roundNumber")),c=d=>{const p=a(d);if(!p)return;const f=s(d),h=d.side||p.sides?.find(A=>A.sideNumber===f),{validActions:m}=p.drawId&&Ge.positionActions({sideNumber:f||h?.sideNumber,structureId:p?.structureId,drawPosition:h?.drawPosition,matchUpId:p?.matchUpId,drawId:p?.drawId,policyDefinitions:{positionActions:{},...vg.policies.POLICY_POSITION_ACTIONS_UNRESTRICTED}})||{};UUt({...d,actions:m,callback:t})},u=d=>{const p=s(d),f=a(d);if(!f)return;const{validActions:h}=Ge.matchUpActions({matchUpId:f.matchUpId,drawId:f.drawId,sideNumber:p})||{},m=h?.find(({type:A})=>A==="SCORE");if(m)if(f.matchUpType===PUt){const A=()=>t(),g=i?.eventInfo?.eventName,{matchUpId:v,drawId:b}=f;LH({title:g,drawId:b,matchUpId:v,onClose:A})}else MN({matchUpId:m.payload.matchUpId,callback:t})};return{centerInfoClick:()=>console.log("centerInfo click"),roundHeaderClick:d=>{const p=l(d),f=o(d);return DUt({pointerEvent:d.pointerEvent,roundNumber:p,structureId:f,eventData:i,callback:t,drawId:e})},scheduleClick:d=>{if(d?.pointerEvent){d.pointerEvent.stopPropagation();const p=uD(d.pointerEvent.target,"tmx-m","id"),f=n[p];$Z({pointerEvent:d.pointerEvent,matchUp:f,callback:t})}},venueClick:d=>{const p=a(d);if(d?.pointerEvent&&p?.schedule?.venueId){const f=p.schedule.venueId,h=Ge.findVenue({venueId:f})?.venue?.addresses?.[0],{latitude:m,longitude:A}=h||{};if(!m||!A)return;const g=`https://www.google.com/maps/@?api=1&map_action=map&center=${m}%2C${A}&zoom=18&basemap=satellite`,v=`https://bing.com/maps/default.aspx?cp=${m}~${A}&lvl=17&style=h`,b=I=>{const w=I&&m&&A&&(I==="google"&&g||v);w&&window.open(w,"_blank")};nl({items:[{heading:"Venue Location"},{divider:"divider"},{onClick:()=>b("google"),hide:!m||!A,text:"Open in Google Maps"},{onClick:()=>b("bing"),hide:!m||!A,text:"Open in Bing Maps"}],target:d.pointerEvent.target,config:{placement:wd}})}},participantClick:c,matchUpClick:u,scoreClick:u}}var Sse=11;function MUt(t,e){var i=e.attributes,r,n,a,s,o;if(!(e.nodeType===Sse||t.nodeType===Sse)){for(var l=i.length-1;l>=0;l--)r=i[l],n=r.name,a=r.namespaceURI,s=r.value,a?(n=r.localName||n,o=t.getAttributeNS(a,n),o!==s&&(r.prefix==="xmlns"&&(n=r.name),t.setAttributeNS(a,n,s))):(o=t.getAttribute(n),o!==s&&t.setAttribute(n,s));for(var c=t.attributes,u=c.length-1;u>=0;u--)r=c[u],n=r.name,a=r.namespaceURI,a?(n=r.localName||n,e.hasAttributeNS(a,n)||t.removeAttributeNS(a,n)):e.hasAttribute(n)||t.removeAttribute(n)}}var xB,NUt="http://www.w3.org/1999/xhtml",su=typeof document>"u"?void 0:document,BUt=!!su&&"content"in su.createElement("template"),kUt=!!su&&su.createRange&&"createContextualFragment"in su.createRange();function xUt(t){var e=su.createElement("template");return e.innerHTML=t,e.content.childNodes[0]}function _Ut(t){xB||(xB=su.createRange(),xB.selectNode(su.body));var e=xB.createContextualFragment(t);return e.childNodes[0]}function OUt(t){var e=su.createElement("body");return e.innerHTML=t,e.childNodes[0]}function FUt(t){return t=t.trim(),BUt?xUt(t):kUt?_Ut(t):OUt(t)}function _B(t,e){var i=t.nodeName,r=e.nodeName,n,a;return i===r?!0:(n=i.charCodeAt(0),a=r.charCodeAt(0),n<=90&&a>=97?i===r.toUpperCase():a<=90&&n>=97?r===i.toUpperCase():!1)}function LUt(t,e){return!e||e===NUt?su.createElement(t):su.createElementNS(e,t)}function $Ut(t,e){for(var i=t.firstChild;i;){var r=i.nextSibling;e.appendChild(i),i=r}return e}function lQ(t,e,i){t[i]!==e[i]&&(t[i]=e[i],t[i]?t.setAttribute(i,""):t.removeAttribute(i))}var Use={OPTION:function(t,e){var i=t.parentNode;if(i){var r=i.nodeName.toUpperCase();r==="OPTGROUP"&&(i=i.parentNode,r=i&&i.nodeName.toUpperCase()),r==="SELECT"&&!i.hasAttribute("multiple")&&(t.hasAttribute("selected")&&!e.selected&&(t.setAttribute("selected","selected"),t.removeAttribute("selected")),i.selectedIndex=-1)}lQ(t,e,"selected")},INPUT:function(t,e){lQ(t,e,"checked"),lQ(t,e,"disabled"),t.value!==e.value&&(t.value=e.value),e.hasAttribute("value")||t.removeAttribute("value")},TEXTAREA:function(t,e){var i=e.value;t.value!==i&&(t.value=i);var r=t.firstChild;if(r){var n=r.nodeValue;if(n==i||!i&&n==t.placeholder)return;r.nodeValue=i}},SELECT:function(t,e){if(!e.hasAttribute("multiple")){for(var i=-1,r=0,n=t.firstChild,a,s;n;)if(s=n.nodeName&&n.nodeName.toUpperCase(),s==="OPTGROUP")a=n,n=a.firstChild,n||(n=a.nextSibling,a=null);else{if(s==="OPTION"){if(n.hasAttribute("selected")){i=r;break}r++}n=n.nextSibling,!n&&a&&(n=a.nextSibling,a=null)}t.selectedIndex=i}}},vD=1,Tse=11,Cse=3,Ese=8;function Cv(){}function HUt(t){if(t)return t.getAttribute&&t.getAttribute("id")||t.id}function VUt(t){return function(i,r,n){if(n||(n={}),typeof r=="string")if(i.nodeName==="#document"||i.nodeName==="HTML"){var a=r;r=su.createElement("html"),r.innerHTML=a}else if(i.nodeName==="BODY"){var s=r;r=su.createElement("html"),r.innerHTML=s;var o=r.querySelector("body");o&&(r=o)}else r=FUt(r);else r.nodeType===Tse&&(r=r.firstElementChild);var l=n.getNodeKey||HUt,c=n.onBeforeNodeAdded||Cv,u=n.onNodeAdded||Cv,d=n.onBeforeElUpdated||Cv,p=n.onElUpdated||Cv,f=n.onBeforeNodeDiscarded||Cv,h=n.onNodeDiscarded||Cv,m=n.onBeforeElChildrenUpdated||Cv,A=n.skipFromChildren||Cv,g=n.addChild||function(F,_){return F.appendChild(_)},v=n.childrenOnly===!0,b=Object.create(null),y=[];function I(F){y.push(F)}function w(F,_){if(F.nodeType===vD)for(var V=F.firstChild;V;){var G=void 0;_&&(G=l(V))?I(G):(h(V),V.firstChild&&w(V,_)),V=V.nextSibling}}function S(F,_,V){f(F)!==!1&&(_&&_.removeChild(F),h(F),w(F,V))}function T(F){if(F.nodeType===vD||F.nodeType===Tse)for(var _=F.firstChild;_;){var V=l(_);V&&(b[V]=_),T(_),_=_.nextSibling}}T(i);function D(F){u(F);for(var _=F.firstChild;_;){var V=_.nextSibling,G=l(_);if(G){var z=b[G];z&&_B(_,z)?(_.parentNode.replaceChild(z,_),E(z,_)):D(_)}else D(_);_=V}}function C(F,_,V){for(;_;){var G=_.nextSibling;(V=l(_))?I(V):S(_,F,!0),_=G}}function E(F,_,V){var G=l(_);if(G&&delete b[G],!V){var z=d(F,_);if(z===!1||(z instanceof HTMLElement&&(F=z,T(F)),t(F,_),p(F),m(F,_)===!1))return}F.nodeName!=="TEXTAREA"?P(F,_):Use.TEXTAREA(F,_)}function P(F,_){var V=A(F,_),G=_.firstChild,z=F.firstChild,Q,j,W,Y,X;e:for(;G;){for(Y=G.nextSibling,Q=l(G);!V&&z;){if(W=z.nextSibling,G.isSameNode&&G.isSameNode(z)){G=Y,z=W;continue e}j=l(z);var J=z.nodeType,ie=void 0;if(J===G.nodeType&&(J===vD?(Q?Q!==j&&((X=b[Q])?W===X?ie=!1:(F.insertBefore(X,z),j?I(j):S(z,F,!0),z=X,j=l(z)):ie=!1):j&&(ie=!1),ie=ie!==!1&&_B(z,G),ie&&E(z,G)):(J===Cse||J==Ese)&&(ie=!0,z.nodeValue!==G.nodeValue&&(z.nodeValue=G.nodeValue))),ie){G=Y,z=W;continue e}j?I(j):S(z,F,!0),z=W}if(Q&&(X=b[Q])&&_B(X,G))V||g(F,X),E(X,G);else{var ue=c(G);ue!==!1&&(ue&&(G=ue),G.actualize&&(G=G.actualize(F.ownerDocument||su)),g(F,G),D(G))}G=Y,z=W}C(F,z,j);var ne=Use[F.nodeName];ne&&ne(F,_)}var R=i,M=R.nodeType,N=r.nodeType;if(!v){if(M===vD)N===vD?_B(i,r)||(h(i),R=$Ut(i,LUt(r.nodeName,r.namespaceURI))):R=r;else if(M===Cse||M===Ese){if(N===M)return R.nodeValue!==r.nodeValue&&(R.nodeValue=r.nodeValue),R;R=r}}if(R===r)h(i);else{if(r.isSameNode&&r.isSameNode(R))return;if(E(R,r,v),y)for(var k=0,O=y.length;k<O;k++){var x=b[y[k]];x&&S(x,x.parentNode,!1)}}return!v&&R!==i&&i.parentNode&&(R.actualize&&(R=R.actualize(i.ownerDocument||su)),i.parentNode.replaceChild(R,i)),R}}var GUt=VUt(MUt);const{DOUBLES:QUt,TEAM:Dse}=Ul;function vC({eventId:t,drawId:e,structureId:i,roundsView:r,redraw:n}){if(jUt()||!Ge.getEvents().events?.length)return;let s;Ise.register("tmx-tm","mouseover",nUt),Ise.register("tmx-tm","mouseout",aUt);let o,l,c=[],u,d="",p,f,h=[],m;const A=()=>{u=Ge.getEventData({participantsProfile:{convertExtensions:!0,withScaleValues:!0,withGroupings:!0,withISO2:!0,withIOC:!0},includePositionAssignments:!0,eventId:t})?.eventData,d=u?.eventInfo?.eventType,f=u?.drawsData?.find(R=>R.drawId===e),c=f?.structures||[],i=i||c?.[0]?.structureId,p=c.find(R=>R.structureId===i),s=Ge.isAdHoc({structure:p}),{roundMatchUps:l,stage:m}=Ri.makeDeepCopy(p||{}),h=Object.values(l||{}).flat(),s&&h.sort(Ri.matchUpScheduleSort)};kH(),A();const g=R=>{const{refresh:M,view:N}=R??{},k=M||o;HH(),N?_n({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:N}):vC({eventId:t,drawId:e,structureId:i,redraw:k,roundsView:N})},v=h?.length===1&&u?.eventInfo?.eventType===Dse,b=RUt({eventData:u,callback:g,drawId:e}),y=p?.display||f?.display||u?.eventInfo?.display||{},I=y?.compositionName,w=y?.configuration,S=wc[I]||$t.composition||wc[d===QUt&&"National"||d===Dse&&"Basic"||"National"];S.configuration??={},S.configuration.flags=!1,Object.assign(S.configuration,w),S.configuration.scaleAttributes&&(S.configuration.scaleAttributes=$t.scales[$t.activeScale]),$t.composition||(S.configuration.genderColor=!0,S.configuration.showAddress=void 0,S.configuration.allDrawPositions=!0,S.configuration.drawPositions=!0),S.configuration.roundHeader=!0;const T=document.getElementById(df);n&&T&&fo(T);const D=()=>{if(v)return;for(const M of Object.keys(p?.roundMatchUps??{}))p.roundMatchUps[M]=l?.[M]?.filter(({sides:N})=>N?.some(({participant:O})=>O?.participantName.toLowerCase().includes(o))||!o);const R=Object.values(p.roundMatchUps||{}).flat();if(h.length)if(r===kT)xke({matchUps:R,eventData:u});else if(r===BT)RBe({eventId:t,drawId:e,structureId:i});else{const M=jX({content:QX({context:{drawId:e,structureId:i},searchActive:!!o,matchUps:R,eventHandlers:b,composition:S,selectedMatchUpId:void 0,structureId:i,finalColumn:void 0,minWidth:void 0}),theme:S.theme}),N=O=>O?.classList?.contains("tmx-p")?O:ac(O,"tmx-p"),k=T?.firstChild;k?GUt(k,M,{addChild:function(O,x){if(x.classList){const F=O.firstChild,_=x.getAttribute("id"),V=![null,"undefined",void 0].includes(_),G=O.firstChild?.getAttribute?.("id"),z=![null,"undefined",void 0].includes(G);try{if(!V&&!z){$t.renderLog&&console.log("condition 0");const Q=N(F)?.nextSibling;Q?.getAttribute("id")&&N(F)?.getAttribute("id")&&Q.remove()}else V&&z&&_&&G&&_!==G?($t.renderLog&&console.log("condition 1"),O.firstChild.remove()):x.classList?.contains("tmx-p")&&!z?($t.renderLog&&console.log("condition 2"),O.firstChild.remove()):O.firstChild?.classList?.contains("tmx-p")&&O.firstChild.getAttribute("id")!=="undefined"&&x.getAttribute("id")==="undefined"?($t.renderLog&&console.log("condition 3"),O.firstChild.remove()):!V&&z?$t.renderLog&&console.log("condition 4"):console.log({incomingId:V,existingId:z,incomingIdValue:_,existingIdValue:G})}catch(Q){console.log({err:Q})}}O.appendChild(x)}}):T&&T.appendChild(M)}else if(m===WR)SUt({drawData:f,drawId:e,eventId:t});else if(s)wUt({structure:p,drawId:e,callback:g});else{const M=c?.[0]?.structureId;return vC({eventId:t,drawId:e,structureId:M,redraw:!0})}};qZ({updateDisplay:()=>{A(),D()},drawId:e,structure:p,existingView:r,callback:g});const E=document.getElementById(sE)||void 0,P=R=>{R&&A();const M=O=>O.searchText?.includes(o),k=kke({updateParticipantFilter:O=>{O||Object.values(ot.tables).filter(Boolean).forEach(x=>x.clearFilter()),o=O?.toLowerCase(),O&&Object.values(ot.tables).filter(Boolean).forEach(x=>x.addFilter(M)),T&&fo(T),D()},updateControlBar:P,structureId:i,eventData:u,matchUps:h,eventId:t,drawId:e});eo({target:E,items:k})};if(!f){console.log("no draw data",{eventData:u,drawData:f});return}if(i||(i=f.structures?.[0]?.structureId),!i){console.log("structure not found");return}if(v){const R=$H({matchUp:h[0]});R&&T&&T.appendChild(R)}else D();P()}let WZ=!1,Gf=null;function jUt(){return WZ}function zUt({drawId:t,eventId:e,structureId:i}){WZ=!0;const r=Ge.getTournament().tournamentRecord,n=new wut({tournamentRecord:r,drawId:t,structureId:i,eventId:e});Gf=WUt(n,{drawId:t,structureId:i}),Gf.setRenderCallback(()=>{Pse({drawId:t,eventId:e,structureId:i})}),Pse({drawId:t,eventId:e,structureId:i}),KUt({drawId:t,eventId:e,structureId:i})}function qUt({drawId:t,eventId:e,structureId:i}){WZ=!1,Gf=null,vC({eventId:e,drawId:t,structureId:i,redraw:!0})}function WUt(t,e){const{drawId:i,structureId:r}=e,n=t.assignParticipant.bind(t);t.assignParticipant=({drawPosition:l,participantId:c})=>(Nt({methods:[{method:"assignDrawPosition",params:{drawId:i,structureId:r,drawPosition:l,participantId:c}}],callback:d=>(d.success&&n({drawPosition:l,participantId:c}),d)}),{success:!0});const a=t.assignBye.bind(t);t.assignBye=({drawPosition:l})=>(Nt({methods:[{method:"assignDrawPositionBye",params:{drawId:i,structureId:r,drawPosition:l}}],callback:u=>(u.success&&a({drawPosition:l}),u)}),{success:!0});const s=t.assignQualifier.bind(t);t.assignQualifier=({drawPosition:l})=>(Nt({methods:[{method:"assignDrawPosition",params:{drawId:i,structureId:r,drawPosition:l,qualifier:!0}}],callback:u=>(u.success&&s({drawPosition:l}),u)}),{success:!0});const o=t.removeAssignment.bind(t);return t.removeAssignment=({drawPosition:l})=>(Nt({methods:[{method:"removeDrawPositionAssignment",params:{drawId:i,structureId:r,drawPosition:l}}],callback:u=>(u.success&&o({drawPosition:l}),u)}),{success:!0}),t}function Pse({drawId:t,eventId:e,structureId:i}){if(!Gf)return;const r=Gf.getMatchUps(),n=Ge.getEventData({eventId:e})?.eventData,a=n?.drawsData?.find(m=>m.drawId===t),o=(a?.display||n?.eventInfo?.display||{})?.compositionName,l=wc[o]||wc.National,c=a?.structures?.some(m=>m.stage==="QUALIFYING"),u={...l,configuration:{...l.configuration,inlineAssignment:!0,persistInputFields:$t.persistInputFields,hasQualifying:c,participantProvider:()=>Gf.getAvailableParticipants()}},p=jX({content:QX({context:{drawId:t,structureId:i},matchUps:r,eventHandlers:{assignParticipant:({side:m,participant:A})=>{const g=m?.drawPosition;if(!g)return;const v=Gf.assignParticipant({drawPosition:g,participantId:A.participantId});v.success||console.error("Failed to assign participant:",v.error)},assignBye:({side:m})=>{const A=m?.drawPosition;if(!A)return;const g=Gf.assignBye({drawPosition:A});g.success||console.error("Failed to assign BYE:",g.error)},assignQualifier:({side:m})=>{const A=m?.drawPosition;if(!A)return;const g=Gf.assignQualifier({drawPosition:A});g.success||console.error("Failed to assign QUALIFIER:",g.error)},removeAssignment:({side:m})=>{const A=m?.drawPosition;if(!A)return;const g=Gf.removeAssignment({drawPosition:A});g.success||console.error("Failed to remove assignment:",g.error)}},composition:u,structureId:i}),theme:l.theme}),f=document.getElementById(df);f&&(f.innerHTML="",f.appendChild(p));const h=Gf.getAndClearFocusDrawPosition();setTimeout(h?()=>{const m=f?.querySelector(`.participant-assignment-input[data-draw-position="${h}"] input`);m&&m.focus()}:()=>{f?.querySelector(".participant-assignment-input input")?.focus()},100)}function KUt({drawId:t,eventId:e,structureId:i}){const r=document.getElementById(sE)||void 0;eo({target:r,items:[{label:"Exit Assignment Mode",icon:"fa fa-times-circle",onClick:()=>qUt({drawId:t,eventId:e,structureId:i}),intent:"is-warning"}]})}function Rse(){try{return globalThis}catch{return}}const VH=()=>Rse()?.dev&&typeof Rse()?.dev=="object";function GH(t){const{eventData:e,drawIds:i,callback:r}=t,n=t.eventId??e.eventInfo.eventId;if(VH()){const f={auditReason:"Reason skipped"},h=i.map(A=>({params:{eventId:n,drawId:A,auditData:f,force:!0},method:Jre}));Nt({methods:h,callback:A=>r?r(A):_n({eventId:n})});return}const a=i.length===1&&e?.drawsData?.find(f=>i.includes(f.drawId)).drawName,s=a?`Delete ${a}`:"Delete flights";let o;const l=()=>{const f={auditReason:o.drawDeletionReason.value},h=i.map(A=>({params:{eventId:n,drawId:A,auditData:f,force:!0},method:Jre}));Nt({methods:h,callback:A=>r?r(A):_n({eventId:n})})},c=[{text:"Please provide a reason for draw deletion.",style:"height: 2.5em; padding-right: 1em; font-size: 0.9em;"},{placeholder:"Explanation",field:"drawDeletionReason",validator:fi.wordValidator(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!",style:"height: 2.5em; padding-right: 1em; font-size: 0.9em;"}],d=[{control:"drawDeletionReason",onInput:({inputs:f})=>{const h=f.drawDeletionReason.value,m=fi.wordValidator(5)(h),A=document.getElementById("deleteDraw");A&&(A.disabled=!m)}}];Jr({title:s,content:f=>o=Sr(f,c,d),buttons:[{label:"Cancel",intent:jt,close:!0},{label:"Delete",id:"deleteDraw",disabled:!0,intent:"is-danger",close:!0,onClick:l}]})}function YUt({eventData:t,drawIds:e}){const i=t.eventInfo.eventId,r=e.length===1&&t?.drawsData?.find(d=>e.includes(d.drawId)).drawName,n=r?`Delete ${r}`:"Delete flights";let a;const s=()=>{const d={auditReason:a.drawDeletionReason.value},p=e.map(h=>({params:{eventId:i,drawId:h,auditData:d},method:tdt}));Nt({methods:p,callback:h=>h.success&&_n({eventId:i,drawId:e[0]})})},o=[{text:"Please provide a reason for resetting draws.",style:"height: 2.5em; padding-right: 1em; font-size: 0.9em;"},{placeholder:"Explanation",field:"drawDeletionReason",validator:fi.wordValidator(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!",style:"height: 2.5em; padding-right: 1em; font-size: 0.9em;"}],c=[{control:"drawDeletionReason",onInput:({inputs:d})=>{const p=d.drawDeletionReason.value,f=fi.wordValidator(5)(p),h=document.getElementById("deleteDraw");h&&(h.disabled=!f)}}];Jr({title:n,content:d=>a=Sr(d,o,c),buttons:[{label:"Cancel",intent:jt,close:!0},{label:"Delete",id:"deleteDraw",disabled:!0,intent:"is-danger",close:!0,onClick:s}]})}function XUt({structureId:t,drawId:e}){const i=Ge.getMatchUpFormat({drawId:e,structureId:t}).matchUpFormat;IH({callback:n=>{n&&(n===i?Pt({message:"No changes",intent:"is-warning"}):Nt({methods:[{params:{matchUpFormat:n,structureId:t,drawId:e},method:idt}],callback:o=>o.success&&Pt({message:"Scoring changed"})}))},existingMatchUpFormat:i,modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})}function ZUt({drawId:t,eventId:e,structureId:i}){const r=[{params:{drawId:t,structureId:i,force:!0},method:edt}],n=l=>{l.success?_n({eventId:e,drawId:t,renderDraw:!0}):Pt({message:l.error?.message||"Error",intent:"is-danger "})};Jr({title:"Remove structure",buttons:[{intent:"is-danger",onClick:()=>Nt({methods:r,callback:n}),label:"Remove",close:!0},{label:"Cancel"}],content:"<div style='font-size: 2em'>Structure will be removed!</div>"})}function JUt(t){const e=typeof t=="string"?new Date(t):t;if(!e||isNaN(e.getTime()))return"";const i=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${i}-${r}-${n}`}var W3=function(t,e){return W3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i[n]=r[n])},W3(t,e)};function Kh(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");W3(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var K3=function(){return K3=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},K3.apply(this,arguments)};function Kc(t,e,i,r){function n(a){return a instanceof i?a:new i(function(s){s(a)})}return new(i||(i=Promise))(function(a,s){function o(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?a(u.value):n(u.value).then(o,l)}c((r=r.apply(t,[])).next())})}function Ac(t,e){var i={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,n,a,s;return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=c[0]&2?n.return:c[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,c[1])).done)return a;switch(n=0,a&&(c=[c[0]&2,a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,n=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(a=i.trys,!(a=a.length>0&&a[a.length-1])&&(c[0]===6||c[0]===2)){i=0;continue}if(c[0]===3&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(c[0]===6&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(t,i)}catch(u){c=[6,u],n=0}finally{r=a=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function OB(t,e,i){if(arguments.length===2)for(var r=0,n=e.length,a;r<n;r++)(a||!(r in e))&&(a||(a=Array.prototype.slice.call(e,0,r)),a[r]=e[r]);return t.concat(a||e)}var kg=(function(){function t(e,i,r,n){this.left=e,this.top=i,this.width=r,this.height=n}return t.prototype.add=function(e,i,r,n){return new t(this.left+e,this.top+i,this.width+r,this.height+n)},t.fromClientRect=function(e,i){return new t(i.left+e.windowBounds.left,i.top+e.windowBounds.top,i.width,i.height)},t.fromDOMRectList=function(e,i){var r=Array.from(i).find(function(n){return n.width!==0});return r?new t(r.left+e.windowBounds.left,r.top+e.windowBounds.top,r.width,r.height):t.EMPTY},t.EMPTY=new t(0,0,0,0),t})(),QH=function(t,e){return kg.fromClientRect(t,e.getBoundingClientRect())},eTt=function(t){var e=t.body,i=t.documentElement;if(!e||!i)throw new Error("Unable to get document size");var r=Math.max(Math.max(e.scrollWidth,i.scrollWidth),Math.max(e.offsetWidth,i.offsetWidth),Math.max(e.clientWidth,i.clientWidth)),n=Math.max(Math.max(e.scrollHeight,i.scrollHeight),Math.max(e.offsetHeight,i.offsetHeight),Math.max(e.clientHeight,i.clientHeight));return new kg(0,0,r,n)},jH=function(t){for(var e=[],i=0,r=t.length;i<r;){var n=t.charCodeAt(i++);if(n>=55296&&n<=56319&&i<r){var a=t.charCodeAt(i++);(a&64512)===56320?e.push(((n&1023)<<10)+(a&1023)+65536):(e.push(n),i--)}else e.push(n)}return e},lo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var i=t.length;if(!i)return"";for(var r=[],n=-1,a="";++n<i;){var s=t[n];s<=65535?r.push(s):(s-=65536,r.push((s>>10)+55296,s%1024+56320)),(n+1===i||r.length>16384)&&(a+=String.fromCharCode.apply(String,r),r.length=0)}return a},Mse="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",tTt=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var FB=0;FB<Mse.length;FB++)tTt[Mse.charCodeAt(FB)]=FB;var Nse="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",LD=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var LB=0;LB<Nse.length;LB++)LD[Nse.charCodeAt(LB)]=LB;var iTt=function(t){var e=t.length*.75,i=t.length,r,n=0,a,s,o,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);var c=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),u=Array.isArray(c)?c:new Uint8Array(c);for(r=0;r<i;r+=4)a=LD[t.charCodeAt(r)],s=LD[t.charCodeAt(r+1)],o=LD[t.charCodeAt(r+2)],l=LD[t.charCodeAt(r+3)],u[n++]=a<<2|s>>4,u[n++]=(s&15)<<4|o>>2,u[n++]=(o&3)<<6|l&63;return c},rTt=function(t){for(var e=t.length,i=[],r=0;r<e;r+=2)i.push(t[r+1]<<8|t[r]);return i},nTt=function(t){for(var e=t.length,i=[],r=0;r<e;r+=4)i.push(t[r+3]<<24|t[r+2]<<16|t[r+1]<<8|t[r]);return i},OI=5,KZ=11,cQ=2,aTt=KZ-OI,MBe=65536>>OI,sTt=1<<OI,uQ=sTt-1,oTt=1024>>OI,lTt=MBe+oTt,cTt=lTt,uTt=32,dTt=cTt+uTt,pTt=65536>>KZ,fTt=1<<aTt,hTt=fTt-1,Bse=function(t,e,i){return t.slice?t.slice(e,i):new Uint16Array(Array.prototype.slice.call(t,e,i))},mTt=function(t,e,i){return t.slice?t.slice(e,i):new Uint32Array(Array.prototype.slice.call(t,e,i))},ATt=function(t,e){var i=iTt(t),r=Array.isArray(i)?nTt(i):new Uint32Array(i),n=Array.isArray(i)?rTt(i):new Uint16Array(i),a=24,s=Bse(n,a/2,r[4]/2),o=r[5]===2?Bse(n,(a+r[4])/2):mTt(r,Math.ceil((a+r[4])/4));return new gTt(r[0],r[1],r[2],r[3],s,o)},gTt=(function(){function t(e,i,r,n,a,s){this.initialValue=e,this.errorValue=i,this.highStart=r,this.highValueIndex=n,this.index=a,this.data=s}return t.prototype.get=function(e){var i;if(e>=0){if(e<55296||e>56319&&e<=65535)return i=this.index[e>>OI],i=(i<<cQ)+(e&uQ),this.data[i];if(e<=65535)return i=this.index[MBe+(e-55296>>OI)],i=(i<<cQ)+(e&uQ),this.data[i];if(e<this.highStart)return i=dTt-pTt+(e>>KZ),i=this.index[i],i+=e>>OI&hTt,i=this.index[i],i=(i<<cQ)+(e&uQ),this.data[i];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t})(),kse="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",vTt=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var $B=0;$B<kse.length;$B++)vTt[kse.charCodeAt($B)]=$B;var yTt="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",xse=50,bTt=1,NBe=2,BBe=3,ITt=4,wTt=5,_se=7,kBe=8,Ose=9,Kv=10,Y3=11,Fse=12,X3=13,STt=14,$D=15,Z3=16,HB=17,yD=18,UTt=19,Lse=20,J3=21,bD=22,dQ=23,uU=24,$d=25,HD=26,VD=27,dU=28,TTt=29,aI=30,CTt=31,VB=32,GB=33,ez=34,tz=35,iz=36,g1=37,rz=38,hx=39,mx=40,pQ=41,xBe=42,ETt=43,DTt=[9001,65288],_Be="!",ln="",QB="",nz=ATt(yTt),QA=[aI,iz],az=[bTt,NBe,BBe,wTt],OBe=[Kv,kBe],$se=[VD,HD],PTt=az.concat(OBe),Hse=[rz,hx,mx,ez,tz],RTt=[$D,X3],MTt=function(t,e){e===void 0&&(e="strict");var i=[],r=[],n=[];return t.forEach(function(a,s){var o=nz.get(a);if(o>xse?(n.push(!0),o-=xse):n.push(!1),["normal","auto","loose"].indexOf(e)!==-1&&[8208,8211,12316,12448].indexOf(a)!==-1)return r.push(s),i.push(Z3);if(o===ITt||o===Y3){if(s===0)return r.push(s),i.push(aI);var l=i[s-1];return PTt.indexOf(l)===-1?(r.push(r[s-1]),i.push(l)):(r.push(s),i.push(aI))}if(r.push(s),o===CTt)return i.push(e==="strict"?J3:g1);if(o===xBe||o===TTt)return i.push(aI);if(o===ETt)return a>=131072&&a<=196605||a>=196608&&a<=262141?i.push(g1):i.push(aI);i.push(o)}),[r,i,n]},fQ=function(t,e,i,r){var n=r[i];if(Array.isArray(t)?t.indexOf(n)!==-1:t===n)for(var a=i;a<=r.length;){a++;var s=r[a];if(s===e)return!0;if(s!==Kv)break}if(n===Kv)for(var a=i;a>0;){a--;var o=r[a];if(Array.isArray(t)?t.indexOf(o)!==-1:t===o)for(var l=i;l<=r.length;){l++;var s=r[l];if(s===e)return!0;if(s!==Kv)break}if(o!==Kv)break}return!1},Vse=function(t,e){for(var i=t;i>=0;){var r=e[i];if(r===Kv)i--;else return r}return 0},NTt=function(t,e,i,r,n){if(i[r]===0)return ln;var a=r-1;if(Array.isArray(n)&&n[a]===!0)return ln;var s=a-1,o=a+1,l=e[a],c=s>=0?e[s]:0,u=e[o];if(l===NBe&&u===BBe)return ln;if(az.indexOf(l)!==-1)return _Be;if(az.indexOf(u)!==-1||OBe.indexOf(u)!==-1)return ln;if(Vse(a,e)===kBe)return QB;if(nz.get(t[a])===Y3||(l===VB||l===GB)&&nz.get(t[o])===Y3||l===_se||u===_se||l===Ose||[Kv,X3,$D].indexOf(l)===-1&&u===Ose||[HB,yD,UTt,uU,dU].indexOf(u)!==-1||Vse(a,e)===bD||fQ(dQ,bD,a,e)||fQ([HB,yD],J3,a,e)||fQ(Fse,Fse,a,e))return ln;if(l===Kv)return QB;if(l===dQ||u===dQ)return ln;if(u===Z3||l===Z3)return QB;if([X3,$D,J3].indexOf(u)!==-1||l===STt||c===iz&&RTt.indexOf(l)!==-1||l===dU&&u===iz||u===Lse||QA.indexOf(u)!==-1&&l===$d||QA.indexOf(l)!==-1&&u===$d||l===VD&&[g1,VB,GB].indexOf(u)!==-1||[g1,VB,GB].indexOf(l)!==-1&&u===HD||QA.indexOf(l)!==-1&&$se.indexOf(u)!==-1||$se.indexOf(l)!==-1&&QA.indexOf(u)!==-1||[VD,HD].indexOf(l)!==-1&&(u===$d||[bD,$D].indexOf(u)!==-1&&e[o+1]===$d)||[bD,$D].indexOf(l)!==-1&&u===$d||l===$d&&[$d,dU,uU].indexOf(u)!==-1)return ln;if([$d,dU,uU,HB,yD].indexOf(u)!==-1)for(var d=a;d>=0;){var p=e[d];if(p===$d)return ln;if([dU,uU].indexOf(p)!==-1)d--;else break}if([VD,HD].indexOf(u)!==-1)for(var d=[HB,yD].indexOf(l)!==-1?s:a;d>=0;){var p=e[d];if(p===$d)return ln;if([dU,uU].indexOf(p)!==-1)d--;else break}if(rz===l&&[rz,hx,ez,tz].indexOf(u)!==-1||[hx,ez].indexOf(l)!==-1&&[hx,mx].indexOf(u)!==-1||[mx,tz].indexOf(l)!==-1&&u===mx||Hse.indexOf(l)!==-1&&[Lse,HD].indexOf(u)!==-1||Hse.indexOf(u)!==-1&&l===VD||QA.indexOf(l)!==-1&&QA.indexOf(u)!==-1||l===uU&&QA.indexOf(u)!==-1||QA.concat($d).indexOf(l)!==-1&&u===bD&&DTt.indexOf(t[o])===-1||QA.concat($d).indexOf(u)!==-1&&l===yD)return ln;if(l===pQ&&u===pQ){for(var f=i[a],h=1;f>0&&(f--,e[f]===pQ);)h++;if(h%2!==0)return ln}return l===VB&&u===GB?ln:QB},BTt=function(t,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var i=MTt(t,e.lineBreak),r=i[0],n=i[1],a=i[2];(e.wordBreak==="break-all"||e.wordBreak==="break-word")&&(n=n.map(function(o){return[$d,aI,xBe].indexOf(o)!==-1?g1:o}));var s=e.wordBreak==="keep-all"?a.map(function(o,l){return o&&t[l]>=19968&&t[l]<=40959}):void 0;return[r,n,s]},kTt=(function(){function t(e,i,r,n){this.codePoints=e,this.required=i===_Be,this.start=r,this.end=n}return t.prototype.slice=function(){return lo.apply(void 0,this.codePoints.slice(this.start,this.end))},t})(),xTt=function(t,e){var i=jH(t),r=BTt(i,e),n=r[0],a=r[1],s=r[2],o=i.length,l=0,c=0;return{next:function(){if(c>=o)return{done:!0,value:null};for(var u=ln;c<o&&(u=NTt(i,a,n,++c,s))===ln;);if(u!==ln||c===o){var d=new kTt(i,u,l,c);return l=c,{value:d,done:!1}}return{done:!0,value:null}}}},_Tt=1,OTt=2,BN=4,Gse=8,SO=10,Qse=47,_0=92,FTt=9,LTt=32,jB=34,ID=61,$Tt=35,HTt=36,VTt=37,zB=39,qB=40,wD=41,GTt=95,qu=45,QTt=33,jTt=60,zTt=62,qTt=64,WTt=91,KTt=93,YTt=61,XTt=123,WB=63,ZTt=125,jse=124,JTt=126,eCt=128,zse=65533,hQ=42,fI=43,tCt=44,iCt=58,rCt=59,v1=46,nCt=0,aCt=8,sCt=11,oCt=14,lCt=31,cCt=127,am=-1,FBe=48,LBe=97,$Be=101,uCt=102,dCt=117,pCt=122,HBe=65,VBe=69,GBe=70,fCt=85,hCt=90,vc=function(t){return t>=FBe&&t<=57},mCt=function(t){return t>=55296&&t<=57343},pU=function(t){return vc(t)||t>=HBe&&t<=GBe||t>=LBe&&t<=uCt},ACt=function(t){return t>=LBe&&t<=pCt},gCt=function(t){return t>=HBe&&t<=hCt},vCt=function(t){return ACt(t)||gCt(t)},yCt=function(t){return t>=eCt},KB=function(t){return t===SO||t===FTt||t===LTt},UO=function(t){return vCt(t)||yCt(t)||t===GTt},qse=function(t){return UO(t)||vc(t)||t===qu},bCt=function(t){return t>=nCt&&t<=aCt||t===sCt||t>=oCt&&t<=lCt||t===cCt},Lv=function(t,e){return t!==_0?!1:e!==SO},YB=function(t,e,i){return t===qu?UO(e)||Lv(e,i):UO(t)?!0:!!(t===_0&&Lv(t,e))},mQ=function(t,e,i){return t===fI||t===qu?vc(e)?!0:e===v1&&vc(i):vc(t===v1?e:t)},ICt=function(t){var e=0,i=1;(t[e]===fI||t[e]===qu)&&(t[e]===qu&&(i=-1),e++);for(var r=[];vc(t[e]);)r.push(t[e++]);var n=r.length?parseInt(lo.apply(void 0,r),10):0;t[e]===v1&&e++;for(var a=[];vc(t[e]);)a.push(t[e++]);var s=a.length,o=s?parseInt(lo.apply(void 0,a),10):0;(t[e]===VBe||t[e]===$Be)&&e++;var l=1;(t[e]===fI||t[e]===qu)&&(t[e]===qu&&(l=-1),e++);for(var c=[];vc(t[e]);)c.push(t[e++]);var u=c.length?parseInt(lo.apply(void 0,c),10):0;return i*(n+o*Math.pow(10,-s))*Math.pow(10,l*u)},wCt={type:2},SCt={type:3},UCt={type:4},TCt={type:13},CCt={type:8},ECt={type:21},DCt={type:9},PCt={type:10},RCt={type:11},MCt={type:12},NCt={type:14},XB={type:23},BCt={type:1},kCt={type:25},xCt={type:24},_Ct={type:26},OCt={type:27},FCt={type:28},LCt={type:29},$Ct={type:31},sz={type:32},QBe=(function(){function t(){this._value=[]}return t.prototype.write=function(e){this._value=this._value.concat(jH(e))},t.prototype.read=function(){for(var e=[],i=this.consumeToken();i!==sz;)e.push(i),i=this.consumeToken();return e},t.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case jB:return this.consumeStringToken(jB);case $Tt:var i=this.peekCodePoint(0),r=this.peekCodePoint(1),n=this.peekCodePoint(2);if(qse(i)||Lv(r,n)){var a=YB(i,r,n)?OTt:_Tt,s=this.consumeName();return{type:5,value:s,flags:a}}break;case HTt:if(this.peekCodePoint(0)===ID)return this.consumeCodePoint(),TCt;break;case zB:return this.consumeStringToken(zB);case qB:return wCt;case wD:return SCt;case hQ:if(this.peekCodePoint(0)===ID)return this.consumeCodePoint(),NCt;break;case fI:if(mQ(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case tCt:return UCt;case qu:var o=e,l=this.peekCodePoint(0),c=this.peekCodePoint(1);if(mQ(o,l,c))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(YB(o,l,c))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(l===qu&&c===zTt)return this.consumeCodePoint(),this.consumeCodePoint(),xCt;break;case v1:if(mQ(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case Qse:if(this.peekCodePoint(0)===hQ)for(this.consumeCodePoint();;){var u=this.consumeCodePoint();if(u===hQ&&(u=this.consumeCodePoint(),u===Qse))return this.consumeToken();if(u===am)return this.consumeToken()}break;case iCt:return _Ct;case rCt:return OCt;case jTt:if(this.peekCodePoint(0)===QTt&&this.peekCodePoint(1)===qu&&this.peekCodePoint(2)===qu)return this.consumeCodePoint(),this.consumeCodePoint(),kCt;break;case qTt:var d=this.peekCodePoint(0),p=this.peekCodePoint(1),f=this.peekCodePoint(2);if(YB(d,p,f)){var s=this.consumeName();return{type:7,value:s}}break;case WTt:return FCt;case _0:if(Lv(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case KTt:return LCt;case YTt:if(this.peekCodePoint(0)===ID)return this.consumeCodePoint(),CCt;break;case XTt:return RCt;case ZTt:return MCt;case dCt:case fCt:var h=this.peekCodePoint(0),m=this.peekCodePoint(1);return h===fI&&(pU(m)||m===WB)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case jse:if(this.peekCodePoint(0)===ID)return this.consumeCodePoint(),DCt;if(this.peekCodePoint(0)===jse)return this.consumeCodePoint(),ECt;break;case JTt:if(this.peekCodePoint(0)===ID)return this.consumeCodePoint(),PCt;break;case am:return sz}return KB(e)?(this.consumeWhiteSpace(),$Ct):vc(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):UO(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:lo(e)}},t.prototype.consumeCodePoint=function(){var e=this._value.shift();return typeof e>"u"?-1:e},t.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},t.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},t.prototype.consumeUnicodeRangeToken=function(){for(var e=[],i=this.consumeCodePoint();pU(i)&&e.length<6;)e.push(i),i=this.consumeCodePoint();for(var r=!1;i===WB&&e.length<6;)e.push(i),i=this.consumeCodePoint(),r=!0;if(r){var n=parseInt(lo.apply(void 0,e.map(function(l){return l===WB?FBe:l})),16),a=parseInt(lo.apply(void 0,e.map(function(l){return l===WB?GBe:l})),16);return{type:30,start:n,end:a}}var s=parseInt(lo.apply(void 0,e),16);if(this.peekCodePoint(0)===qu&&pU(this.peekCodePoint(1))){this.consumeCodePoint(),i=this.consumeCodePoint();for(var o=[];pU(i)&&o.length<6;)o.push(i),i=this.consumeCodePoint();var a=parseInt(lo.apply(void 0,o),16);return{type:30,start:s,end:a}}else return{type:30,start:s,end:s}},t.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return e.toLowerCase()==="url"&&this.peekCodePoint(0)===qB?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===qB?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},t.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===am)return{type:22,value:""};var i=this.peekCodePoint(0);if(i===zB||i===jB){var r=this.consumeStringToken(this.consumeCodePoint());return r.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===am||this.peekCodePoint(0)===wD)?(this.consumeCodePoint(),{type:22,value:r.value}):(this.consumeBadUrlRemnants(),XB)}for(;;){var n=this.consumeCodePoint();if(n===am||n===wD)return{type:22,value:lo.apply(void 0,e)};if(KB(n))return this.consumeWhiteSpace(),this.peekCodePoint(0)===am||this.peekCodePoint(0)===wD?(this.consumeCodePoint(),{type:22,value:lo.apply(void 0,e)}):(this.consumeBadUrlRemnants(),XB);if(n===jB||n===zB||n===qB||bCt(n))return this.consumeBadUrlRemnants(),XB;if(n===_0)if(Lv(n,this.peekCodePoint(0)))e.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),XB;else e.push(n)}},t.prototype.consumeWhiteSpace=function(){for(;KB(this.peekCodePoint(0));)this.consumeCodePoint()},t.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===wD||e===am)return;Lv(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},t.prototype.consumeStringSlice=function(e){for(var i=5e4,r="";e>0;){var n=Math.min(i,e);r+=lo.apply(void 0,this._value.splice(0,n)),e-=n}return this._value.shift(),r},t.prototype.consumeStringToken=function(e){var i="",r=0;do{var n=this._value[r];if(n===am||n===void 0||n===e)return i+=this.consumeStringSlice(r),{type:0,value:i};if(n===SO)return this._value.splice(0,r),BCt;if(n===_0){var a=this._value[r+1];a!==am&&a!==void 0&&(a===SO?(i+=this.consumeStringSlice(r),r=-1,this._value.shift()):Lv(n,a)&&(i+=this.consumeStringSlice(r),i+=lo(this.consumeEscapedCodePoint()),r=-1))}r++}while(!0)},t.prototype.consumeNumber=function(){var e=[],i=BN,r=this.peekCodePoint(0);for((r===fI||r===qu)&&e.push(this.consumeCodePoint());vc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0);var n=this.peekCodePoint(1);if(r===v1&&vc(n))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),i=Gse;vc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0),n=this.peekCodePoint(1);var a=this.peekCodePoint(2);if((r===VBe||r===$Be)&&((n===fI||n===qu)&&vc(a)||vc(n)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),i=Gse;vc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[ICt(e),i]},t.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),i=e[0],r=e[1],n=this.peekCodePoint(0),a=this.peekCodePoint(1),s=this.peekCodePoint(2);if(YB(n,a,s)){var o=this.consumeName();return{type:15,number:i,flags:r,unit:o}}return n===VTt?(this.consumeCodePoint(),{type:16,number:i,flags:r}):{type:17,number:i,flags:r}},t.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(pU(e)){for(var i=lo(e);pU(this.peekCodePoint(0))&&i.length<6;)i+=lo(this.consumeCodePoint());KB(this.peekCodePoint(0))&&this.consumeCodePoint();var r=parseInt(i,16);return r===0||mCt(r)||r>1114111?zse:r}return e===am?zse:e},t.prototype.consumeName=function(){for(var e="";;){var i=this.consumeCodePoint();if(qse(i))e+=lo(i);else if(Lv(i,this.peekCodePoint(0)))e+=lo(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(i),e}},t})(),jBe=(function(){function t(e){this._tokens=e}return t.create=function(e){var i=new QBe;return i.write(e),new t(i.read())},t.parseValue=function(e){return t.create(e).parseComponentValue()},t.parseValues=function(e){return t.create(e).parseComponentValues()},t.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===31;)e=this.consumeToken();if(e.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var i=this.consumeComponentValue();do e=this.consumeToken();while(e.type===31);if(e.type===32)return i;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},t.prototype.parseComponentValues=function(){for(var e=[];;){var i=this.consumeComponentValue();if(i.type===32)return e;e.push(i),e.push()}},t.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},t.prototype.consumeSimpleBlock=function(e){for(var i={type:e,values:[]},r=this.consumeToken();;){if(r.type===32||VCt(r,e))return i;this.reconsumeToken(r),i.values.push(this.consumeComponentValue()),r=this.consumeToken()}},t.prototype.consumeFunction=function(e){for(var i={name:e.value,values:[],type:18};;){var r=this.consumeToken();if(r.type===32||r.type===3)return i;this.reconsumeToken(r),i.values.push(this.consumeComponentValue())}},t.prototype.consumeToken=function(){var e=this._tokens.shift();return typeof e>"u"?sz:e},t.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},t})(),kN=function(t){return t.type===15},jE=function(t){return t.type===17},pa=function(t){return t.type===20},HCt=function(t){return t.type===0},oz=function(t,e){return pa(t)&&t.value===e},zBe=function(t){return t.type!==31},yC=function(t){return t.type!==31&&t.type!==4},CA=function(t){var e=[],i=[];return t.forEach(function(r){if(r.type===4){if(i.length===0)throw new Error("Error parsing function args, zero tokens for arg");e.push(i),i=[];return}r.type!==31&&i.push(r)}),i.length&&e.push(i),e},VCt=function(t,e){return e===11&&t.type===12||e===28&&t.type===29?!0:e===2&&t.type===3},Ky=function(t){return t.type===17||t.type===15},Io=function(t){return t.type===16||Ky(t)},qBe=function(t){return t.length>1?[t[0],t[1]]:[t[0]]},Ol={type:17,number:0,flags:BN},YZ={type:16,number:50,flags:BN},Yv={type:16,number:100,flags:BN},GD=function(t,e,i){var r=t[0],n=t[1];return[ka(r,e),ka(typeof n<"u"?n:r,i)]},ka=function(t,e){if(t.type===16)return t.number/100*e;if(kN(t))switch(t.unit){case"rem":case"em":return 16*t.number;default:return t.number}return t.number},WBe="deg",KBe="grad",YBe="rad",XBe="turn",zH={name:"angle",parse:function(t,e){if(e.type===15)switch(e.unit){case WBe:return Math.PI*e.number/180;case KBe:return Math.PI/200*e.number;case YBe:return e.number;case XBe:return Math.PI*2*e.number}throw new Error("Unsupported angle type")}},ZBe=function(t){return t.type===15&&(t.unit===WBe||t.unit===KBe||t.unit===YBe||t.unit===XBe)},JBe=function(t){var e=t.filter(pa).map(function(i){return i.value}).join(" ");switch(e){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Ol,Ol];case"to top":case"bottom":return Hp(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Ol,Yv];case"to right":case"left":return Hp(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Yv,Yv];case"to bottom":case"top":return Hp(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Yv,Ol];case"to left":case"right":return Hp(270)}return 0},Hp=function(t){return Math.PI*t/180},dy={name:"color",parse:function(t,e){if(e.type===18){var i=GCt[e.name];if(typeof i>"u")throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return i(t,e.values)}if(e.type===5){if(e.value.length===3){var r=e.value.substring(0,1),n=e.value.substring(1,2),a=e.value.substring(2,3);return Xv(parseInt(r+r,16),parseInt(n+n,16),parseInt(a+a,16),1)}if(e.value.length===4){var r=e.value.substring(0,1),n=e.value.substring(1,2),a=e.value.substring(2,3),s=e.value.substring(3,4);return Xv(parseInt(r+r,16),parseInt(n+n,16),parseInt(a+a,16),parseInt(s+s,16)/255)}if(e.value.length===6){var r=e.value.substring(0,2),n=e.value.substring(2,4),a=e.value.substring(4,6);return Xv(parseInt(r,16),parseInt(n,16),parseInt(a,16),1)}if(e.value.length===8){var r=e.value.substring(0,2),n=e.value.substring(2,4),a=e.value.substring(4,6),s=e.value.substring(6,8);return Xv(parseInt(r,16),parseInt(n,16),parseInt(a,16),parseInt(s,16)/255)}}if(e.type===20){var o=cg[e.value.toUpperCase()];if(typeof o<"u")return o}return cg.TRANSPARENT}},py=function(t){return(255&t)===0},cl=function(t){var e=255&t,i=255&t>>8,r=255&t>>16,n=255&t>>24;return e<255?"rgba("+n+","+r+","+i+","+e/255+")":"rgb("+n+","+r+","+i+")"},Xv=function(t,e,i,r){return(t<<24|e<<16|i<<8|Math.round(r*255)<<0)>>>0},Wse=function(t,e){if(t.type===17)return t.number;if(t.type===16){var i=e===3?1:255;return e===3?t.number/100*i:Math.round(t.number/100*i)}return 0},Kse=function(t,e){var i=e.filter(yC);if(i.length===3){var r=i.map(Wse),n=r[0],a=r[1],s=r[2];return Xv(n,a,s,1)}if(i.length===4){var o=i.map(Wse),n=o[0],a=o[1],s=o[2],l=o[3];return Xv(n,a,s,l)}return 0};function AQ(t,e,i){return i<0&&(i+=1),i>=1&&(i-=1),i<1/6?(e-t)*i*6+t:i<1/2?e:i<2/3?(e-t)*6*(2/3-i)+t:t}var Yse=function(t,e){var i=e.filter(yC),r=i[0],n=i[1],a=i[2],s=i[3],o=(r.type===17?Hp(r.number):zH.parse(t,r))/(Math.PI*2),l=Io(n)?n.number/100:0,c=Io(a)?a.number/100:0,u=typeof s<"u"&&Io(s)?ka(s,1):1;if(l===0)return Xv(c*255,c*255,c*255,1);var d=c<=.5?c*(l+1):c+l-c*l,p=c*2-d,f=AQ(p,d,o+1/3),h=AQ(p,d,o),m=AQ(p,d,o-1/3);return Xv(f*255,h*255,m*255,u)},GCt={hsl:Yse,hsla:Yse,rgb:Kse,rgba:Kse},O0=function(t,e){return dy.parse(t,jBe.create(e).parseComponentValue())},cg={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},QCt={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(t,e){return e.map(function(i){if(pa(i))switch(i.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},jCt={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},qH=function(t,e){var i=dy.parse(t,e[0]),r=e[1];return r&&Io(r)?{color:i,stop:r}:{color:i,stop:null}},Xse=function(t,e){var i=t[0],r=t[t.length-1];i.stop===null&&(i.stop=Ol),r.stop===null&&(r.stop=Yv);for(var n=[],a=0,s=0;s<t.length;s++){var o=t[s].stop;if(o!==null){var l=ka(o,e);l>a?n.push(l):n.push(a),a=l}else n.push(null)}for(var c=null,s=0;s<n.length;s++){var u=n[s];if(u===null)c===null&&(c=s);else if(c!==null){for(var d=s-c,p=n[c-1],f=(u-p)/(d+1),h=1;h<=d;h++)n[c+h-1]=f*h;c=null}}return t.map(function(m,A){var g=m.color;return{color:g,stop:Math.max(Math.min(1,n[A]/e),0)}})},zCt=function(t,e,i){var r=e/2,n=i/2,a=ka(t[0],e)-r,s=n-ka(t[1],i);return(Math.atan2(s,a)+Math.PI*2)%(Math.PI*2)},qCt=function(t,e,i){var r=typeof t=="number"?t:zCt(t,e,i),n=Math.abs(e*Math.sin(r))+Math.abs(i*Math.cos(r)),a=e/2,s=i/2,o=n/2,l=Math.sin(r-Math.PI/2)*o,c=Math.cos(r-Math.PI/2)*o;return[n,a-c,a+c,s-l,s+l]},Hf=function(t,e){return Math.sqrt(t*t+e*e)},Zse=function(t,e,i,r,n){var a=[[0,0],[0,e],[t,0],[t,e]];return a.reduce(function(s,o){var l=o[0],c=o[1],u=Hf(i-l,r-c);return(n?u<s.optimumDistance:u>s.optimumDistance)?{optimumCorner:o,optimumDistance:u}:s},{optimumDistance:n?1/0:-1/0,optimumCorner:null}).optimumCorner},WCt=function(t,e,i,r,n){var a=0,s=0;switch(t.size){case 0:t.shape===0?a=s=Math.min(Math.abs(e),Math.abs(e-r),Math.abs(i),Math.abs(i-n)):t.shape===1&&(a=Math.min(Math.abs(e),Math.abs(e-r)),s=Math.min(Math.abs(i),Math.abs(i-n)));break;case 2:if(t.shape===0)a=s=Math.min(Hf(e,i),Hf(e,i-n),Hf(e-r,i),Hf(e-r,i-n));else if(t.shape===1){var o=Math.min(Math.abs(i),Math.abs(i-n))/Math.min(Math.abs(e),Math.abs(e-r)),l=Zse(r,n,e,i,!0),c=l[0],u=l[1];a=Hf(c-e,(u-i)/o),s=o*a}break;case 1:t.shape===0?a=s=Math.max(Math.abs(e),Math.abs(e-r),Math.abs(i),Math.abs(i-n)):t.shape===1&&(a=Math.max(Math.abs(e),Math.abs(e-r)),s=Math.max(Math.abs(i),Math.abs(i-n)));break;case 3:if(t.shape===0)a=s=Math.max(Hf(e,i),Hf(e,i-n),Hf(e-r,i),Hf(e-r,i-n));else if(t.shape===1){var o=Math.max(Math.abs(i),Math.abs(i-n))/Math.max(Math.abs(e),Math.abs(e-r)),d=Zse(r,n,e,i,!1),c=d[0],u=d[1];a=Hf(c-e,(u-i)/o),s=o*a}break}return Array.isArray(t.size)&&(a=ka(t.size[0],r),s=t.size.length===2?ka(t.size[1],n):a),[a,s]},KCt=function(t,e){var i=Hp(180),r=[];return CA(e).forEach(function(n,a){if(a===0){var s=n[0];if(s.type===20&&s.value==="to"){i=JBe(n);return}else if(ZBe(s)){i=zH.parse(t,s);return}}var o=qH(t,n);r.push(o)}),{angle:i,stops:r,type:1}},ZB=function(t,e){var i=Hp(180),r=[];return CA(e).forEach(function(n,a){if(a===0){var s=n[0];if(s.type===20&&["top","left","right","bottom"].indexOf(s.value)!==-1){i=JBe(n);return}else if(ZBe(s)){i=(zH.parse(t,s)+Hp(270))%Hp(360);return}}var o=qH(t,n);r.push(o)}),{angle:i,stops:r,type:1}},YCt=function(t,e){var i=Hp(180),r=[],n=1,a=0,s=3,o=[];return CA(e).forEach(function(l,c){var u=l[0];if(c===0){if(pa(u)&&u.value==="linear"){n=1;return}else if(pa(u)&&u.value==="radial"){n=2;return}}if(u.type===18){if(u.name==="from"){var d=dy.parse(t,u.values[0]);r.push({stop:Ol,color:d})}else if(u.name==="to"){var d=dy.parse(t,u.values[0]);r.push({stop:Yv,color:d})}else if(u.name==="color-stop"){var p=u.values.filter(yC);if(p.length===2){var d=dy.parse(t,p[1]),f=p[0];jE(f)&&r.push({stop:{type:16,number:f.number*100,flags:f.flags},color:d})}}}}),n===1?{angle:(i+Hp(180))%Hp(360),stops:r,type:n}:{size:s,shape:a,stops:r,position:o,type:n}},eke="closest-side",tke="farthest-side",ike="closest-corner",rke="farthest-corner",nke="circle",ake="ellipse",ske="cover",oke="contain",XCt=function(t,e){var i=0,r=3,n=[],a=[];return CA(e).forEach(function(s,o){var l=!0;if(o===0){var c=!1;l=s.reduce(function(d,p){if(c)if(pa(p))switch(p.value){case"center":return a.push(YZ),d;case"top":case"left":return a.push(Ol),d;case"right":case"bottom":return a.push(Yv),d}else(Io(p)||Ky(p))&&a.push(p);else if(pa(p))switch(p.value){case nke:return i=0,!1;case ake:return i=1,!1;case"at":return c=!0,!1;case eke:return r=0,!1;case ske:case tke:return r=1,!1;case oke:case ike:return r=2,!1;case rke:return r=3,!1}else if(Ky(p)||Io(p))return Array.isArray(r)||(r=[]),r.push(p),!1;return d},l)}if(l){var u=qH(t,s);n.push(u)}}),{size:r,shape:i,stops:n,position:a,type:2}},JB=function(t,e){var i=0,r=3,n=[],a=[];return CA(e).forEach(function(s,o){var l=!0;if(o===0?l=s.reduce(function(u,d){if(pa(d))switch(d.value){case"center":return a.push(YZ),!1;case"top":case"left":return a.push(Ol),!1;case"right":case"bottom":return a.push(Yv),!1}else if(Io(d)||Ky(d))return a.push(d),!1;return u},l):o===1&&(l=s.reduce(function(u,d){if(pa(d))switch(d.value){case nke:return i=0,!1;case ake:return i=1,!1;case oke:case eke:return r=0,!1;case tke:return r=1,!1;case ike:return r=2,!1;case ske:case rke:return r=3,!1}else if(Ky(d)||Io(d))return Array.isArray(r)||(r=[]),r.push(d),!1;return u},l)),l){var c=qH(t,s);n.push(c)}}),{size:r,shape:i,stops:n,position:a,type:2}},ZCt=function(t){return t.type===1},JCt=function(t){return t.type===2},XZ={name:"image",parse:function(t,e){if(e.type===22){var i={url:e.value,type:0};return t.cache.addImage(e.value),i}if(e.type===18){var r=lke[e.name];if(typeof r>"u")throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return r(t,e.values)}throw new Error("Unsupported image type "+e.type)}};function eEt(t){return!(t.type===20&&t.value==="none")&&(t.type!==18||!!lke[t.name])}var lke={"linear-gradient":KCt,"-moz-linear-gradient":ZB,"-ms-linear-gradient":ZB,"-o-linear-gradient":ZB,"-webkit-linear-gradient":ZB,"radial-gradient":XCt,"-moz-radial-gradient":JB,"-ms-radial-gradient":JB,"-o-radial-gradient":JB,"-webkit-radial-gradient":JB,"-webkit-gradient":YCt},tEt={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(t,e){if(e.length===0)return[];var i=e[0];return i.type===20&&i.value==="none"?[]:e.filter(function(r){return yC(r)&&eEt(r)}).map(function(r){return XZ.parse(t,r)})}},iEt={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(t,e){return e.map(function(i){if(pa(i))switch(i.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},rEt={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(t,e){return CA(e).map(function(i){return i.filter(Io)}).map(qBe)}},nEt={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(t,e){return CA(e).map(function(i){return i.filter(pa).map(function(r){return r.value}).join(" ")}).map(aEt)}},aEt=function(t){switch(t){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}},aT;(function(t){t.AUTO="auto",t.CONTAIN="contain",t.COVER="cover"})(aT||(aT={}));var sEt={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(t,e){return CA(e).map(function(i){return i.filter(oEt)})}},oEt=function(t){return pa(t)||Io(t)},WH=function(t){return{name:"border-"+t+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},lEt=WH("top"),cEt=WH("right"),uEt=WH("bottom"),dEt=WH("left"),KH=function(t){return{name:"border-radius-"+t,initialValue:"0 0",prefix:!1,type:1,parse:function(e,i){return qBe(i.filter(Io))}}},pEt=KH("top-left"),fEt=KH("top-right"),hEt=KH("bottom-right"),mEt=KH("bottom-left"),YH=function(t){return{name:"border-"+t+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,i){switch(i){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},AEt=YH("top"),gEt=YH("right"),vEt=YH("bottom"),yEt=YH("left"),XH=function(t){return{name:"border-"+t+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,i){return kN(i)?i.number:0}}},bEt=XH("top"),IEt=XH("right"),wEt=XH("bottom"),SEt=XH("left"),UEt={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},TEt={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(t,e){return e==="rtl"?1:0}},CEt={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(t,e){return e.filter(pa).reduce(function(i,r){return i|EEt(r.value)},0)}},EEt=function(t){switch(t){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},DEt={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},PEt={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(t,e){return e.type===20&&e.value==="normal"?0:e.type===17||e.type===15?e.number:0}},TO;(function(t){t.NORMAL="normal",t.STRICT="strict"})(TO||(TO={}));var REt={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){return e==="strict"?TO.STRICT:TO.NORMAL}},MEt={name:"line-height",initialValue:"normal",prefix:!1,type:4},Jse=function(t,e){return pa(t)&&t.value==="normal"?1.2*e:t.type===17?e*t.number:Io(t)?ka(t,e):e},NEt={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(t,e){return e.type===20&&e.value==="none"?null:XZ.parse(t,e)}},BEt={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(t,e){return e==="inside"?0:1}},lz={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},ZH=function(t){return{name:"margin-"+t,initialValue:"0",prefix:!1,type:4}},kEt=ZH("top"),xEt=ZH("right"),_Et=ZH("bottom"),OEt=ZH("left"),FEt={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(t,e){return e.filter(pa).map(function(i){switch(i.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}})}},LEt={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){return e==="break-word"?"break-word":"normal"}},JH=function(t){return{name:"padding-"+t,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},$Et=JH("top"),HEt=JH("right"),VEt=JH("bottom"),GEt=JH("left"),QEt={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(t,e){switch(e){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},jEt={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(t,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},zEt={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return e.length===1&&oz(e[0],"none")?[]:CA(e).map(function(i){for(var r={color:cg.TRANSPARENT,offsetX:Ol,offsetY:Ol,blur:Ol},n=0,a=0;a<i.length;a++){var s=i[a];Ky(s)?(n===0?r.offsetX=s:n===1?r.offsetY=s:r.blur=s,n++):r.color=dy.parse(t,s)}return r})}},qEt={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},WEt={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(t,e){if(e.type===20&&e.value==="none")return null;if(e.type===18){var i=XEt[e.name];if(typeof i>"u")throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return i(e.values)}return null}},KEt=function(t){var e=t.filter(function(i){return i.type===17}).map(function(i){return i.number});return e.length===6?e:null},YEt=function(t){var e=t.filter(function(l){return l.type===17}).map(function(l){return l.number}),i=e[0],r=e[1];e[2],e[3];var n=e[4],a=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var s=e[12],o=e[13];return e[14],e[15],e.length===16?[i,r,n,a,s,o]:null},XEt={matrix:KEt,matrix3d:YEt},eoe={type:16,number:50,flags:BN},ZEt=[eoe,eoe],JEt={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(t,e){var i=e.filter(Io);return i.length!==2?ZEt:[i[0],i[1]]}},eDt={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"hidden":return 1;case"collapse":return 2;default:return 0}}},F0;(function(t){t.NORMAL="normal",t.BREAK_ALL="break-all",t.KEEP_ALL="keep-all"})(F0||(F0={}));var tDt={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"break-all":return F0.BREAK_ALL;case"keep-all":return F0.KEEP_ALL;default:return F0.NORMAL}}},iDt={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(t,e){if(e.type===20)return{auto:!0,order:0};if(jE(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},cke={name:"time",parse:function(t,e){if(e.type===15)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")}},rDt={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(t,e){return jE(e)?e.number:1}},nDt={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},aDt={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(t,e){return e.filter(pa).map(function(i){switch(i.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(i){return i!==0})}},sDt={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(t,e){var i=[],r=[];return e.forEach(function(n){switch(n.type){case 20:case 0:i.push(n.value);break;case 17:i.push(n.number.toString());break;case 4:r.push(i.join(" ")),i.length=0;break}}),i.length&&r.push(i.join(" ")),r.map(function(n){return n.indexOf(" ")===-1?n:"'"+n+"'"})}},oDt={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},lDt={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(t,e){return jE(e)?e.number:pa(e)&&e.value==="bold"?700:400}},cDt={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return e.filter(pa).map(function(i){return i.value})}},uDt={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},Qo=function(t,e){return(t&e)!==0},dDt={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(t,e){if(e.length===0)return[];var i=e[0];return i.type===20&&i.value==="none"?[]:e}},pDt={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(e.length===0)return null;var i=e[0];if(i.type===20&&i.value==="none")return null;for(var r=[],n=e.filter(zBe),a=0;a<n.length;a++){var s=n[a],o=n[a+1];if(s.type===20){var l=o&&jE(o)?o.number:1;r.push({counter:s.value,increment:l})}}return r}},fDt={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(e.length===0)return[];for(var i=[],r=e.filter(zBe),n=0;n<r.length;n++){var a=r[n],s=r[n+1];if(pa(a)&&a.value!=="none"){var o=s&&jE(s)?s.number:0;i.push({counter:a.value,reset:o})}}return i}},hDt={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(t,e){return e.filter(kN).map(function(i){return cke.parse(t,i)})}},mDt={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(e.length===0)return null;var i=e[0];if(i.type===20&&i.value==="none")return null;var r=[],n=e.filter(HCt);if(n.length%2!==0)return null;for(var a=0;a<n.length;a+=2){var s=n[a].value,o=n[a+1].value;r.push({open:s,close:o})}return r}},toe=function(t,e,i){if(!t)return"";var r=t[Math.min(e,t.length-1)];return r?i?r.open:r.close:""},ADt={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return e.length===1&&oz(e[0],"none")?[]:CA(e).map(function(i){for(var r={color:255,offsetX:Ol,offsetY:Ol,blur:Ol,spread:Ol,inset:!1},n=0,a=0;a<i.length;a++){var s=i[a];oz(s,"inset")?r.inset=!0:Ky(s)?(n===0?r.offsetX=s:n===1?r.offsetY=s:n===2?r.blur=s:r.spread=s,n++):r.color=dy.parse(t,s)}return r})}},gDt={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(t,e){var i=[0,1,2],r=[];return e.filter(pa).forEach(function(n){switch(n.value){case"stroke":r.push(1);break;case"fill":r.push(0);break;case"markers":r.push(2);break}}),i.forEach(function(n){r.indexOf(n)===-1&&r.push(n)}),r}},vDt={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},yDt={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return kN(e)?e.number:0}},bDt=(function(){function t(e,i){var r,n;this.animationDuration=li(e,hDt,i.animationDuration),this.backgroundClip=li(e,QCt,i.backgroundClip),this.backgroundColor=li(e,jCt,i.backgroundColor),this.backgroundImage=li(e,tEt,i.backgroundImage),this.backgroundOrigin=li(e,iEt,i.backgroundOrigin),this.backgroundPosition=li(e,rEt,i.backgroundPosition),this.backgroundRepeat=li(e,nEt,i.backgroundRepeat),this.backgroundSize=li(e,sEt,i.backgroundSize),this.borderTopColor=li(e,lEt,i.borderTopColor),this.borderRightColor=li(e,cEt,i.borderRightColor),this.borderBottomColor=li(e,uEt,i.borderBottomColor),this.borderLeftColor=li(e,dEt,i.borderLeftColor),this.borderTopLeftRadius=li(e,pEt,i.borderTopLeftRadius),this.borderTopRightRadius=li(e,fEt,i.borderTopRightRadius),this.borderBottomRightRadius=li(e,hEt,i.borderBottomRightRadius),this.borderBottomLeftRadius=li(e,mEt,i.borderBottomLeftRadius),this.borderTopStyle=li(e,AEt,i.borderTopStyle),this.borderRightStyle=li(e,gEt,i.borderRightStyle),this.borderBottomStyle=li(e,vEt,i.borderBottomStyle),this.borderLeftStyle=li(e,yEt,i.borderLeftStyle),this.borderTopWidth=li(e,bEt,i.borderTopWidth),this.borderRightWidth=li(e,IEt,i.borderRightWidth),this.borderBottomWidth=li(e,wEt,i.borderBottomWidth),this.borderLeftWidth=li(e,SEt,i.borderLeftWidth),this.boxShadow=li(e,ADt,i.boxShadow),this.color=li(e,UEt,i.color),this.direction=li(e,TEt,i.direction),this.display=li(e,CEt,i.display),this.float=li(e,DEt,i.cssFloat),this.fontFamily=li(e,sDt,i.fontFamily),this.fontSize=li(e,oDt,i.fontSize),this.fontStyle=li(e,uDt,i.fontStyle),this.fontVariant=li(e,cDt,i.fontVariant),this.fontWeight=li(e,lDt,i.fontWeight),this.letterSpacing=li(e,PEt,i.letterSpacing),this.lineBreak=li(e,REt,i.lineBreak),this.lineHeight=li(e,MEt,i.lineHeight),this.listStyleImage=li(e,NEt,i.listStyleImage),this.listStylePosition=li(e,BEt,i.listStylePosition),this.listStyleType=li(e,lz,i.listStyleType),this.marginTop=li(e,kEt,i.marginTop),this.marginRight=li(e,xEt,i.marginRight),this.marginBottom=li(e,_Et,i.marginBottom),this.marginLeft=li(e,OEt,i.marginLeft),this.opacity=li(e,rDt,i.opacity);var a=li(e,FEt,i.overflow);this.overflowX=a[0],this.overflowY=a[a.length>1?1:0],this.overflowWrap=li(e,LEt,i.overflowWrap),this.paddingTop=li(e,$Et,i.paddingTop),this.paddingRight=li(e,HEt,i.paddingRight),this.paddingBottom=li(e,VEt,i.paddingBottom),this.paddingLeft=li(e,GEt,i.paddingLeft),this.paintOrder=li(e,gDt,i.paintOrder),this.position=li(e,jEt,i.position),this.textAlign=li(e,QEt,i.textAlign),this.textDecorationColor=li(e,nDt,(r=i.textDecorationColor)!==null&&r!==void 0?r:i.color),this.textDecorationLine=li(e,aDt,(n=i.textDecorationLine)!==null&&n!==void 0?n:i.textDecoration),this.textShadow=li(e,zEt,i.textShadow),this.textTransform=li(e,qEt,i.textTransform),this.transform=li(e,WEt,i.transform),this.transformOrigin=li(e,JEt,i.transformOrigin),this.visibility=li(e,eDt,i.visibility),this.webkitTextStrokeColor=li(e,vDt,i.webkitTextStrokeColor),this.webkitTextStrokeWidth=li(e,yDt,i.webkitTextStrokeWidth),this.wordBreak=li(e,tDt,i.wordBreak),this.zIndex=li(e,iDt,i.zIndex)}return t.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},t.prototype.isTransparent=function(){return py(this.backgroundColor)},t.prototype.isTransformed=function(){return this.transform!==null},t.prototype.isPositioned=function(){return this.position!==0},t.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},t.prototype.isFloating=function(){return this.float!==0},t.prototype.isInlineLevel=function(){return Qo(this.display,4)||Qo(this.display,33554432)||Qo(this.display,268435456)||Qo(this.display,536870912)||Qo(this.display,67108864)||Qo(this.display,134217728)},t})(),IDt=(function(){function t(e,i){this.content=li(e,dDt,i.content),this.quotes=li(e,mDt,i.quotes)}return t})(),ioe=(function(){function t(e,i){this.counterIncrement=li(e,pDt,i.counterIncrement),this.counterReset=li(e,fDt,i.counterReset)}return t})(),li=function(t,e,i){var r=new QBe,n=i!==null&&typeof i<"u"?i.toString():e.initialValue;r.write(n);var a=new jBe(r.read());switch(e.type){case 2:var s=a.parseComponentValue();return e.parse(t,pa(s)?s.value:e.initialValue);case 0:return e.parse(t,a.parseComponentValue());case 1:return e.parse(t,a.parseComponentValues());case 4:return a.parseComponentValue();case 3:switch(e.format){case"angle":return zH.parse(t,a.parseComponentValue());case"color":return dy.parse(t,a.parseComponentValue());case"image":return XZ.parse(t,a.parseComponentValue());case"length":var o=a.parseComponentValue();return Ky(o)?o:Ol;case"length-percentage":var l=a.parseComponentValue();return Io(l)?l:Ol;case"time":return cke.parse(t,a.parseComponentValue())}break}},wDt="data-html2canvas-debug",SDt=function(t){var e=t.getAttribute(wDt);switch(e){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},cz=function(t,e){var i=SDt(t);return i===1||e===i},EA=(function(){function t(e,i){if(this.context=e,this.textNodes=[],this.elements=[],this.flags=0,cz(i,3))debugger;this.styles=new bDt(e,window.getComputedStyle(i,null)),pz(i)&&(this.styles.animationDuration.some(function(r){return r>0})&&(i.style.animationDuration="0s"),this.styles.transform!==null&&(i.style.transform="none")),this.bounds=QH(this.context,i),cz(i,4)&&(this.flags|=16)}return t})(),UDt="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",roe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",QD=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var ek=0;ek<roe.length;ek++)QD[roe.charCodeAt(ek)]=ek;var TDt=function(t){var e=t.length*.75,i=t.length,r,n=0,a,s,o,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);var c=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),u=Array.isArray(c)?c:new Uint8Array(c);for(r=0;r<i;r+=4)a=QD[t.charCodeAt(r)],s=QD[t.charCodeAt(r+1)],o=QD[t.charCodeAt(r+2)],l=QD[t.charCodeAt(r+3)],u[n++]=a<<2|s>>4,u[n++]=(s&15)<<4|o>>2,u[n++]=(o&3)<<6|l&63;return c},CDt=function(t){for(var e=t.length,i=[],r=0;r<e;r+=2)i.push(t[r+1]<<8|t[r]);return i},EDt=function(t){for(var e=t.length,i=[],r=0;r<e;r+=4)i.push(t[r+3]<<24|t[r+2]<<16|t[r+1]<<8|t[r]);return i},FI=5,ZZ=11,gQ=2,DDt=ZZ-FI,uke=65536>>FI,PDt=1<<FI,vQ=PDt-1,RDt=1024>>FI,MDt=uke+RDt,NDt=MDt,BDt=32,kDt=NDt+BDt,xDt=65536>>ZZ,_Dt=1<<DDt,ODt=_Dt-1,noe=function(t,e,i){return t.slice?t.slice(e,i):new Uint16Array(Array.prototype.slice.call(t,e,i))},FDt=function(t,e,i){return t.slice?t.slice(e,i):new Uint32Array(Array.prototype.slice.call(t,e,i))},LDt=function(t,e){var i=TDt(t),r=Array.isArray(i)?EDt(i):new Uint32Array(i),n=Array.isArray(i)?CDt(i):new Uint16Array(i),a=24,s=noe(n,a/2,r[4]/2),o=r[5]===2?noe(n,(a+r[4])/2):FDt(r,Math.ceil((a+r[4])/4));return new $Dt(r[0],r[1],r[2],r[3],s,o)},$Dt=(function(){function t(e,i,r,n,a,s){this.initialValue=e,this.errorValue=i,this.highStart=r,this.highValueIndex=n,this.index=a,this.data=s}return t.prototype.get=function(e){var i;if(e>=0){if(e<55296||e>56319&&e<=65535)return i=this.index[e>>FI],i=(i<<gQ)+(e&vQ),this.data[i];if(e<=65535)return i=this.index[uke+(e-55296>>FI)],i=(i<<gQ)+(e&vQ),this.data[i];if(e<this.highStart)return i=kDt-xDt+(e>>ZZ),i=this.index[i],i+=e>>FI&ODt,i=this.index[i],i=(i<<gQ)+(e&vQ),this.data[i];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t})(),aoe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",HDt=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var tk=0;tk<aoe.length;tk++)HDt[aoe.charCodeAt(tk)]=tk;var VDt=1,yQ=2,bQ=3,soe=4,ooe=5,GDt=7,loe=8,IQ=9,wQ=10,coe=11,uoe=12,doe=13,poe=14,SQ=15,QDt=function(t){for(var e=[],i=0,r=t.length;i<r;){var n=t.charCodeAt(i++);if(n>=55296&&n<=56319&&i<r){var a=t.charCodeAt(i++);(a&64512)===56320?e.push(((n&1023)<<10)+(a&1023)+65536):(e.push(n),i--)}else e.push(n)}return e},jDt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var i=t.length;if(!i)return"";for(var r=[],n=-1,a="";++n<i;){var s=t[n];s<=65535?r.push(s):(s-=65536,r.push((s>>10)+55296,s%1024+56320)),(n+1===i||r.length>16384)&&(a+=String.fromCharCode.apply(String,r),r.length=0)}return a},zDt=LDt(UDt),Pp="",UQ="",qDt=function(t){return zDt.get(t)},WDt=function(t,e,i){var r=i-2,n=e[r],a=e[i-1],s=e[i];if(a===yQ&&s===bQ)return Pp;if(a===yQ||a===bQ||a===soe||s===yQ||s===bQ||s===soe)return UQ;if(a===loe&&[loe,IQ,coe,uoe].indexOf(s)!==-1||(a===coe||a===IQ)&&(s===IQ||s===wQ)||(a===uoe||a===wQ)&&s===wQ||s===doe||s===ooe||s===GDt||a===VDt)return Pp;if(a===doe&&s===poe){for(;n===ooe;)n=e[--r];if(n===poe)return Pp}if(a===SQ&&s===SQ){for(var o=0;n===SQ;)o++,n=e[--r];if(o%2===0)return Pp}return UQ},KDt=function(t){var e=QDt(t),i=e.length,r=0,n=0,a=e.map(qDt);return{next:function(){if(r>=i)return{done:!0,value:null};for(var s=Pp;r<i&&(s=WDt(e,a,++r))===Pp;);if(s!==Pp||r===i){var o=jDt.apply(null,e.slice(n,r));return n=r,{value:o,done:!1}}return{done:!0,value:null}}}},YDt=function(t){for(var e=KDt(t),i=[],r;!(r=e.next()).done;)r.value&&i.push(r.value.slice());return i},XDt=function(t){var e=123;if(t.createRange){var i=t.createRange();if(i.getBoundingClientRect){var r=t.createElement("boundtest");r.style.height=e+"px",r.style.display="block",t.body.appendChild(r),i.selectNode(r);var n=i.getBoundingClientRect(),a=Math.round(n.height);if(t.body.removeChild(r),a===e)return!0}}return!1},ZDt=function(t){var e=t.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",t.body.appendChild(e);var i=t.createRange();e.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var r=e.firstChild,n=jH(r.data).map(function(l){return lo(l)}),a=0,s={},o=n.every(function(l,c){i.setStart(r,a),i.setEnd(r,a+l.length);var u=i.getBoundingClientRect();a+=l.length;var d=u.x>s.x||u.y>s.y;return s=u,c===0?!0:d});return t.body.removeChild(e),o},JDt=function(){return typeof new Image().crossOrigin<"u"},e0t=function(){return typeof new XMLHttpRequest().responseType=="string"},t0t=function(t){var e=new Image,i=t.createElement("canvas"),r=i.getContext("2d");if(!r)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(e,0,0),i.toDataURL()}catch{return!1}return!0},foe=function(t){return t[0]===0&&t[1]===255&&t[2]===0&&t[3]===255},i0t=function(t){var e=t.createElement("canvas"),i=100;e.width=i,e.height=i;var r=e.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,i,i);var n=new Image,a=e.toDataURL();n.src=a;var s=uz(i,i,0,0,n);return r.fillStyle="red",r.fillRect(0,0,i,i),hoe(s).then(function(o){r.drawImage(o,0,0);var l=r.getImageData(0,0,i,i).data;r.fillStyle="red",r.fillRect(0,0,i,i);var c=t.createElement("div");return c.style.backgroundImage="url("+a+")",c.style.height=i+"px",foe(l)?hoe(uz(i,i,0,0,c)):Promise.reject(!1)}).then(function(o){return r.drawImage(o,0,0),foe(r.getImageData(0,0,i,i).data)}).catch(function(){return!1})},uz=function(t,e,i,r,n){var a="http://www.w3.org/2000/svg",s=document.createElementNS(a,"svg"),o=document.createElementNS(a,"foreignObject");return s.setAttributeNS(null,"width",t.toString()),s.setAttributeNS(null,"height",e.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",i.toString()),o.setAttributeNS(null,"y",r.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),s.appendChild(o),o.appendChild(n),s},hoe=function(t){return new Promise(function(e,i){var r=new Image;r.onload=function(){return e(r)},r.onerror=i,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(t))})},Ml={get SUPPORT_RANGE_BOUNDS(){var t=XDt(document);return Object.defineProperty(Ml,"SUPPORT_RANGE_BOUNDS",{value:t}),t},get SUPPORT_WORD_BREAKING(){var t=Ml.SUPPORT_RANGE_BOUNDS&&ZDt(document);return Object.defineProperty(Ml,"SUPPORT_WORD_BREAKING",{value:t}),t},get SUPPORT_SVG_DRAWING(){var t=t0t(document);return Object.defineProperty(Ml,"SUPPORT_SVG_DRAWING",{value:t}),t},get SUPPORT_FOREIGNOBJECT_DRAWING(){var t=typeof Array.from=="function"&&typeof window.fetch=="function"?i0t(document):Promise.resolve(!1);return Object.defineProperty(Ml,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:t}),t},get SUPPORT_CORS_IMAGES(){var t=JDt();return Object.defineProperty(Ml,"SUPPORT_CORS_IMAGES",{value:t}),t},get SUPPORT_RESPONSE_TYPE(){var t=e0t();return Object.defineProperty(Ml,"SUPPORT_RESPONSE_TYPE",{value:t}),t},get SUPPORT_CORS_XHR(){var t="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Ml,"SUPPORT_CORS_XHR",{value:t}),t},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var t=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(Ml,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:t}),t}},L0=(function(){function t(e,i){this.text=e,this.bounds=i}return t})(),r0t=function(t,e,i,r){var n=s0t(e,i),a=[],s=0;return n.forEach(function(o){if(i.textDecorationLine.length||o.trim().length>0)if(Ml.SUPPORT_RANGE_BOUNDS){var l=moe(r,s,o.length).getClientRects();if(l.length>1){var c=JZ(o),u=0;c.forEach(function(p){a.push(new L0(p,kg.fromDOMRectList(t,moe(r,u+s,p.length).getClientRects()))),u+=p.length})}else a.push(new L0(o,kg.fromDOMRectList(t,l)))}else{var d=r.splitText(o.length);a.push(new L0(o,n0t(t,r))),r=d}else Ml.SUPPORT_RANGE_BOUNDS||(r=r.splitText(o.length));s+=o.length}),a},n0t=function(t,e){var i=e.ownerDocument;if(i){var r=i.createElement("html2canvaswrapper");r.appendChild(e.cloneNode(!0));var n=e.parentNode;if(n){n.replaceChild(r,e);var a=QH(t,r);return r.firstChild&&n.replaceChild(r.firstChild,r),a}}return kg.EMPTY},moe=function(t,e,i){var r=t.ownerDocument;if(!r)throw new Error("Node has no owner document");var n=r.createRange();return n.setStart(t,e),n.setEnd(t,e+i),n},JZ=function(t){if(Ml.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(t)).map(function(i){return i.segment})}return YDt(t)},a0t=function(t,e){if(Ml.SUPPORT_NATIVE_TEXT_SEGMENTATION){var i=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(i.segment(t)).map(function(r){return r.segment})}return l0t(t,e)},s0t=function(t,e){return e.letterSpacing!==0?JZ(t):a0t(t,e)},o0t=[32,160,4961,65792,65793,4153,4241],l0t=function(t,e){for(var i=xTt(t,{lineBreak:e.lineBreak,wordBreak:e.overflowWrap==="break-word"?"break-word":e.wordBreak}),r=[],n,a=function(){if(n.value){var s=n.value.slice(),o=jH(s),l="";o.forEach(function(c){o0t.indexOf(c)===-1?l+=lo(c):(l.length&&r.push(l),r.push(lo(c)),l="")}),l.length&&r.push(l)}};!(n=i.next()).done;)a();return r},c0t=(function(){function t(e,i,r){this.text=u0t(i.data,r.textTransform),this.textBounds=r0t(e,this.text,r,i)}return t})(),u0t=function(t,e){switch(e){case 1:return t.toLowerCase();case 3:return t.replace(d0t,p0t);case 2:return t.toUpperCase();default:return t}},d0t=/(^|\s|:|-|\(|\))([a-z])/g,p0t=function(t,e,i){return t.length>0?e+i.toUpperCase():t},dke=(function(t){Kh(e,t);function e(i,r){var n=t.call(this,i,r)||this;return n.src=r.currentSrc||r.src,n.intrinsicWidth=r.naturalWidth,n.intrinsicHeight=r.naturalHeight,n.context.cache.addImage(n.src),n}return e})(EA),pke=(function(t){Kh(e,t);function e(i,r){var n=t.call(this,i,r)||this;return n.canvas=r,n.intrinsicWidth=r.width,n.intrinsicHeight=r.height,n}return e})(EA),fke=(function(t){Kh(e,t);function e(i,r){var n=t.call(this,i,r)||this,a=new XMLSerializer,s=QH(i,r);return r.setAttribute("width",s.width+"px"),r.setAttribute("height",s.height+"px"),n.svg="data:image/svg+xml,"+encodeURIComponent(a.serializeToString(r)),n.intrinsicWidth=r.width.baseVal.value,n.intrinsicHeight=r.height.baseVal.value,n.context.cache.addImage(n.svg),n}return e})(EA),hke=(function(t){Kh(e,t);function e(i,r){var n=t.call(this,i,r)||this;return n.value=r.value,n}return e})(EA),dz=(function(t){Kh(e,t);function e(i,r){var n=t.call(this,i,r)||this;return n.start=r.start,n.reversed=typeof r.reversed=="boolean"&&r.reversed===!0,n}return e})(EA),f0t=[{type:15,flags:0,unit:"px",number:3}],h0t=[{type:16,flags:0,number:50}],m0t=function(t){return t.width>t.height?new kg(t.left+(t.width-t.height)/2,t.top,t.height,t.height):t.width<t.height?new kg(t.left,t.top+(t.height-t.width)/2,t.width,t.width):t},A0t=function(t){var e=t.type===g0t?new Array(t.value.length+1).join(""):t.value;return e.length===0?t.placeholder||"":e},CO="checkbox",EO="radio",g0t="password",Aoe=707406591,eJ=(function(t){Kh(e,t);function e(i,r){var n=t.call(this,i,r)||this;switch(n.type=r.type.toLowerCase(),n.checked=r.checked,n.value=A0t(r),(n.type===CO||n.type===EO)&&(n.styles.backgroundColor=3739148031,n.styles.borderTopColor=n.styles.borderRightColor=n.styles.borderBottomColor=n.styles.borderLeftColor=2779096575,n.styles.borderTopWidth=n.styles.borderRightWidth=n.styles.borderBottomWidth=n.styles.borderLeftWidth=1,n.styles.borderTopStyle=n.styles.borderRightStyle=n.styles.borderBottomStyle=n.styles.borderLeftStyle=1,n.styles.backgroundClip=[0],n.styles.backgroundOrigin=[0],n.bounds=m0t(n.bounds)),n.type){case CO:n.styles.borderTopRightRadius=n.styles.borderTopLeftRadius=n.styles.borderBottomRightRadius=n.styles.borderBottomLeftRadius=f0t;break;case EO:n.styles.borderTopRightRadius=n.styles.borderTopLeftRadius=n.styles.borderBottomRightRadius=n.styles.borderBottomLeftRadius=h0t;break}return n}return e})(EA),mke=(function(t){Kh(e,t);function e(i,r){var n=t.call(this,i,r)||this,a=r.options[r.selectedIndex||0];return n.value=a&&a.text||"",n}return e})(EA),Ake=(function(t){Kh(e,t);function e(i,r){var n=t.call(this,i,r)||this;return n.value=r.value,n}return e})(EA),gke=(function(t){Kh(e,t);function e(i,r){var n=t.call(this,i,r)||this;n.src=r.src,n.width=parseInt(r.width,10)||0,n.height=parseInt(r.height,10)||0,n.backgroundColor=n.styles.backgroundColor;try{if(r.contentWindow&&r.contentWindow.document&&r.contentWindow.document.documentElement){n.tree=yke(i,r.contentWindow.document.documentElement);var a=r.contentWindow.document.documentElement?O0(i,getComputedStyle(r.contentWindow.document.documentElement).backgroundColor):cg.TRANSPARENT,s=r.contentWindow.document.body?O0(i,getComputedStyle(r.contentWindow.document.body).backgroundColor):cg.TRANSPARENT;n.backgroundColor=py(a)?py(s)?n.styles.backgroundColor:s:a}}catch{}return n}return e})(EA),v0t=["OL","UL","MENU"],Ax=function(t,e,i,r){for(var n=e.firstChild,a=void 0;n;n=a)if(a=n.nextSibling,bke(n)&&n.data.trim().length>0)i.textNodes.push(new c0t(t,n,i.styles));else if(WU(n))if(Uke(n)&&n.assignedNodes)n.assignedNodes().forEach(function(o){return Ax(t,o,i,r)});else{var s=vke(t,n);s.styles.isVisible()&&(y0t(n,s,r)?s.flags|=4:b0t(s.styles)&&(s.flags|=2),v0t.indexOf(n.tagName)!==-1&&(s.flags|=8),i.elements.push(s),n.slot,n.shadowRoot?Ax(t,n.shadowRoot,s,r):!DO(n)&&!Ike(n)&&!PO(n)&&Ax(t,n,s,r))}},vke=function(t,e){return fz(e)?new dke(t,e):wke(e)?new pke(t,e):Ike(e)?new fke(t,e):I0t(e)?new hke(t,e):w0t(e)?new dz(t,e):S0t(e)?new eJ(t,e):PO(e)?new mke(t,e):DO(e)?new Ake(t,e):Ske(e)?new gke(t,e):new EA(t,e)},yke=function(t,e){var i=vke(t,e);return i.flags|=4,Ax(t,e,i,i),i},y0t=function(t,e,i){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||tJ(t)&&i.styles.isTransparent()},b0t=function(t){return t.isPositioned()||t.isFloating()},bke=function(t){return t.nodeType===Node.TEXT_NODE},WU=function(t){return t.nodeType===Node.ELEMENT_NODE},pz=function(t){return WU(t)&&typeof t.style<"u"&&!gx(t)},gx=function(t){return typeof t.className=="object"},I0t=function(t){return t.tagName==="LI"},w0t=function(t){return t.tagName==="OL"},S0t=function(t){return t.tagName==="INPUT"},U0t=function(t){return t.tagName==="HTML"},Ike=function(t){return t.tagName==="svg"},tJ=function(t){return t.tagName==="BODY"},wke=function(t){return t.tagName==="CANVAS"},goe=function(t){return t.tagName==="VIDEO"},fz=function(t){return t.tagName==="IMG"},Ske=function(t){return t.tagName==="IFRAME"},voe=function(t){return t.tagName==="STYLE"},T0t=function(t){return t.tagName==="SCRIPT"},DO=function(t){return t.tagName==="TEXTAREA"},PO=function(t){return t.tagName==="SELECT"},Uke=function(t){return t.tagName==="SLOT"},yoe=function(t){return t.tagName.indexOf("-")>0},C0t=(function(){function t(){this.counters={}}return t.prototype.getCounterValue=function(e){var i=this.counters[e];return i&&i.length?i[i.length-1]:1},t.prototype.getCounterValues=function(e){var i=this.counters[e];return i||[]},t.prototype.pop=function(e){var i=this;e.forEach(function(r){return i.counters[r].pop()})},t.prototype.parse=function(e){var i=this,r=e.counterIncrement,n=e.counterReset,a=!0;r!==null&&r.forEach(function(o){var l=i.counters[o.counter];l&&o.increment!==0&&(a=!1,l.length||l.push(1),l[Math.max(0,l.length-1)]+=o.increment)});var s=[];return a&&n.forEach(function(o){var l=i.counters[o.counter];s.push(o.counter),l||(l=i.counters[o.counter]=[]),l.push(o.reset)}),s},t})(),boe={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Ioe={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},E0t={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},D0t={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},fU=function(t,e,i,r,n,a){return t<e||t>i?y1(t,n,a.length>0):r.integers.reduce(function(s,o,l){for(;t>=o;)t-=o,s+=r.values[l];return s},"")+a},Tke=function(t,e,i,r){var n="";do i||t--,n=r(t)+n,t/=e;while(t*e>=e);return n},oo=function(t,e,i,r,n){var a=i-e+1;return(t<0?"-":"")+(Tke(Math.abs(t),a,r,function(s){return lo(Math.floor(s%a)+e)})+n)},Kb=function(t,e,i){i===void 0&&(i=". ");var r=e.length;return Tke(Math.abs(t),r,!1,function(n){return e[Math.floor(n%r)]})+i},EU=1,Bv=2,kv=4,jD=8,jA=function(t,e,i,r,n,a){if(t<-9999||t>9999)return y1(t,4,n.length>0);var s=Math.abs(t),o=n;if(s===0)return e[0]+o;for(var l=0;s>0&&l<=4;l++){var c=s%10;c===0&&Qo(a,EU)&&o!==""?o=e[c]+o:c>1||c===1&&l===0||c===1&&l===1&&Qo(a,Bv)||c===1&&l===1&&Qo(a,kv)&&t>100||c===1&&l>1&&Qo(a,jD)?o=e[c]+(l>0?i[l-1]:"")+o:c===1&&l>0&&(o=i[l-1]+o),s=Math.floor(s/10)}return(t<0?r:"")+o},woe="",Soe="",Uoe="",TQ="",y1=function(t,e,i){var r=i?". ":"",n=i?"":"",a=i?", ":"",s=i?" ":"";switch(e){case 0:return""+s;case 1:return""+s;case 2:return""+s;case 5:var o=oo(t,48,57,!0,r);return o.length<4?"0"+o:o;case 4:return Kb(t,"",n);case 6:return fU(t,1,3999,boe,3,r).toLowerCase();case 7:return fU(t,1,3999,boe,3,r);case 8:return oo(t,945,969,!1,r);case 9:return oo(t,97,122,!1,r);case 10:return oo(t,65,90,!1,r);case 11:return oo(t,1632,1641,!0,r);case 12:case 49:return fU(t,1,9999,Ioe,3,r);case 35:return fU(t,1,9999,Ioe,3,r).toLowerCase();case 13:return oo(t,2534,2543,!0,r);case 14:case 30:return oo(t,6112,6121,!0,r);case 15:return Kb(t,"",n);case 16:return Kb(t,"",n);case 17:case 48:return jA(t,"",woe,"",n,Bv|kv|jD);case 47:return jA(t,"",Soe,"",n,EU|Bv|kv|jD);case 42:return jA(t,"",woe,"",n,Bv|kv|jD);case 41:return jA(t,"",Soe,"",n,EU|Bv|kv|jD);case 26:return jA(t,"","",Uoe,n,0);case 25:return jA(t,"","",Uoe,n,EU|Bv|kv);case 31:return jA(t,"","",TQ,a,EU|Bv|kv);case 33:return jA(t,"","",TQ,a,0);case 32:return jA(t,"","",TQ,a,EU|Bv|kv);case 18:return oo(t,2406,2415,!0,r);case 20:return fU(t,1,19999,D0t,3,r);case 21:return oo(t,2790,2799,!0,r);case 22:return oo(t,2662,2671,!0,r);case 22:return fU(t,1,10999,E0t,3,r);case 23:return Kb(t,"");case 24:return Kb(t,"");case 27:return oo(t,3302,3311,!0,r);case 28:return Kb(t,"",n);case 29:return Kb(t,"",n);case 34:return oo(t,3792,3801,!0,r);case 37:return oo(t,6160,6169,!0,r);case 38:return oo(t,4160,4169,!0,r);case 39:return oo(t,2918,2927,!0,r);case 40:return oo(t,1776,1785,!0,r);case 43:return oo(t,3046,3055,!0,r);case 44:return oo(t,3174,3183,!0,r);case 45:return oo(t,3664,3673,!0,r);case 46:return oo(t,3872,3881,!0,r);default:return oo(t,48,57,!0,r)}},Cke="data-html2canvas-ignore",Toe=(function(){function t(e,i,r){if(this.context=e,this.options=r,this.scrolledElements=[],this.referenceElement=i,this.counters=new C0t,this.quoteDepth=0,!i.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(i.ownerDocument.documentElement,!1)}return t.prototype.toIFrame=function(e,i){var r=this,n=P0t(e,i);if(!n.contentWindow)return Promise.reject("Unable to find iframe window");var a=e.defaultView.pageXOffset,s=e.defaultView.pageYOffset,o=n.contentWindow,l=o.document,c=N0t(n).then(function(){return Kc(r,void 0,void 0,function(){var u,d;return Ac(this,function(p){switch(p.label){case 0:return this.scrolledElements.forEach(_0t),o&&(o.scrollTo(i.left,i.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(o.scrollY!==i.top||o.scrollX!==i.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(o.scrollX-i.left,o.scrollY-i.top,0,0))),u=this.options.onclone,d=this.clonedReferenceElement,typeof d>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:l.fonts&&l.fonts.ready?[4,l.fonts.ready]:[3,2];case 1:p.sent(),p.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,M0t(l)]:[3,4];case 3:p.sent(),p.label=4;case 4:return typeof u=="function"?[2,Promise.resolve().then(function(){return u(l,d)}).then(function(){return n})]:[2,n]}})})});return l.open(),l.write(k0t(document.doctype)+"<html></html>"),x0t(this.referenceElement.ownerDocument,a,s),l.replaceChild(l.adoptNode(this.documentElement),l.documentElement),l.close(),c},t.prototype.createElementClone=function(e){if(cz(e,2))debugger;if(wke(e))return this.createCanvasClone(e);if(goe(e))return this.createVideoClone(e);if(voe(e))return this.createStyleClone(e);var i=e.cloneNode(!1);return fz(i)&&(fz(e)&&e.currentSrc&&e.currentSrc!==e.src&&(i.src=e.currentSrc,i.srcset=""),i.loading==="lazy"&&(i.loading="eager")),yoe(i)?this.createCustomElementClone(i):i},t.prototype.createCustomElementClone=function(e){var i=document.createElement("html2canvascustomelement");return CQ(e.style,i),i},t.prototype.createStyleClone=function(e){try{var i=e.sheet;if(i&&i.cssRules){var r=[].slice.call(i.cssRules,0).reduce(function(a,s){return s&&typeof s.cssText=="string"?a+s.cssText:a},""),n=e.cloneNode(!1);return n.textContent=r,n}}catch(a){if(this.context.logger.error("Unable to access cssRules property",a),a.name!=="SecurityError")throw a}return e.cloneNode(!1)},t.prototype.createCanvasClone=function(e){var i;if(this.options.inlineImages&&e.ownerDocument){var r=e.ownerDocument.createElement("img");try{return r.src=e.toDataURL(),r}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var n=e.cloneNode(!1);try{n.width=e.width,n.height=e.height;var a=e.getContext("2d"),s=n.getContext("2d");if(s)if(!this.options.allowTaint&&a)s.putImageData(a.getImageData(0,0,e.width,e.height),0,0);else{var o=(i=e.getContext("webgl2"))!==null&&i!==void 0?i:e.getContext("webgl");if(o){var l=o.getContextAttributes();l?.preserveDrawingBuffer===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}s.drawImage(e,0,0)}return n}catch{this.context.logger.info("Unable to clone canvas as it is tainted",e)}return n},t.prototype.createVideoClone=function(e){var i=e.ownerDocument.createElement("canvas");i.width=e.offsetWidth,i.height=e.offsetHeight;var r=i.getContext("2d");try{return r&&(r.drawImage(e,0,0,i.width,i.height),this.options.allowTaint||r.getImageData(0,0,i.width,i.height)),i}catch{this.context.logger.info("Unable to clone video as it is tainted",e)}var n=e.ownerDocument.createElement("canvas");return n.width=e.offsetWidth,n.height=e.offsetHeight,n},t.prototype.appendChildNode=function(e,i,r){(!WU(i)||!T0t(i)&&!i.hasAttribute(Cke)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(i)))&&(!this.options.copyStyles||!WU(i)||!voe(i))&&e.appendChild(this.cloneNode(i,r))},t.prototype.cloneChildNodes=function(e,i,r){for(var n=this,a=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;a;a=a.nextSibling)if(WU(a)&&Uke(a)&&typeof a.assignedNodes=="function"){var s=a.assignedNodes();s.length&&s.forEach(function(o){return n.appendChildNode(i,o,r)})}else this.appendChildNode(i,a,r)},t.prototype.cloneNode=function(e,i){if(bke(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var r=e.ownerDocument.defaultView;if(r&&WU(e)&&(pz(e)||gx(e))){var n=this.createElementClone(e);n.style.transitionProperty="none";var a=r.getComputedStyle(e),s=r.getComputedStyle(e,":before"),o=r.getComputedStyle(e,":after");this.referenceElement===e&&pz(n)&&(this.clonedReferenceElement=n),tJ(n)&&L0t(n);var l=this.counters.parse(new ioe(this.context,a)),c=this.resolvePseudoContent(e,n,s,$0.BEFORE);yoe(e)&&(i=!0),goe(e)||this.cloneChildNodes(e,n,i),c&&n.insertBefore(c,n.firstChild);var u=this.resolvePseudoContent(e,n,o,$0.AFTER);return u&&n.appendChild(u),this.counters.pop(l),(a&&(this.options.copyStyles||gx(e))&&!Ske(e)||i)&&CQ(a,n),(e.scrollTop!==0||e.scrollLeft!==0)&&this.scrolledElements.push([n,e.scrollLeft,e.scrollTop]),(DO(e)||PO(e))&&(DO(n)||PO(n))&&(n.value=e.value),n}return e.cloneNode(!1)},t.prototype.resolvePseudoContent=function(e,i,r,n){var a=this;if(r){var s=r.content,o=i.ownerDocument;if(!(!o||!s||s==="none"||s==="-moz-alt-content"||r.display==="none")){this.counters.parse(new ioe(this.context,r));var l=new IDt(this.context,r),c=o.createElement("html2canvaspseudoelement");CQ(r,c),l.content.forEach(function(d){if(d.type===0)c.appendChild(o.createTextNode(d.value));else if(d.type===22){var p=o.createElement("img");p.src=d.value,p.style.opacity="1",c.appendChild(p)}else if(d.type===18){if(d.name==="attr"){var f=d.values.filter(pa);f.length&&c.appendChild(o.createTextNode(e.getAttribute(f[0].value)||""))}else if(d.name==="counter"){var h=d.values.filter(yC),m=h[0],A=h[1];if(m&&pa(m)){var g=a.counters.getCounterValue(m.value),v=A&&pa(A)?lz.parse(a.context,A.value):3;c.appendChild(o.createTextNode(y1(g,v,!1)))}}else if(d.name==="counters"){var b=d.values.filter(yC),m=b[0],y=b[1],A=b[2];if(m&&pa(m)){var I=a.counters.getCounterValues(m.value),w=A&&pa(A)?lz.parse(a.context,A.value):3,S=y&&y.type===0?y.value:"",T=I.map(function(E){return y1(E,w,!1)}).join(S);c.appendChild(o.createTextNode(T))}}}else if(d.type===20)switch(d.value){case"open-quote":c.appendChild(o.createTextNode(toe(l.quotes,a.quoteDepth++,!0)));break;case"close-quote":c.appendChild(o.createTextNode(toe(l.quotes,--a.quoteDepth,!1)));break;default:c.appendChild(o.createTextNode(d.value))}}),c.className=hz+" "+mz;var u=n===$0.BEFORE?" "+hz:" "+mz;return gx(i)?i.className.baseValue+=u:i.className+=u,c}}},t.destroy=function(e){return e.parentNode?(e.parentNode.removeChild(e),!0):!1},t})(),$0;(function(t){t[t.BEFORE=0]="BEFORE",t[t.AFTER=1]="AFTER"})($0||($0={}));var P0t=function(t,e){var i=t.createElement("iframe");return i.className="html2canvas-container",i.style.visibility="hidden",i.style.position="fixed",i.style.left="-10000px",i.style.top="0px",i.style.border="0",i.width=e.width.toString(),i.height=e.height.toString(),i.scrolling="no",i.setAttribute(Cke,"true"),t.body.appendChild(i),i},R0t=function(t){return new Promise(function(e){if(t.complete){e();return}if(!t.src){e();return}t.onload=e,t.onerror=e})},M0t=function(t){return Promise.all([].slice.call(t.images,0).map(R0t))},N0t=function(t){return new Promise(function(e,i){var r=t.contentWindow;if(!r)return i("No window assigned for iframe");var n=r.document;r.onload=t.onload=function(){r.onload=t.onload=null;var a=setInterval(function(){n.body.childNodes.length>0&&n.readyState==="complete"&&(clearInterval(a),e(t))},50)}})},B0t=["all","d","content"],CQ=function(t,e){for(var i=t.length-1;i>=0;i--){var r=t.item(i);B0t.indexOf(r)===-1&&e.style.setProperty(r,t.getPropertyValue(r))}return e},k0t=function(t){var e="";return t&&(e+="<!DOCTYPE ",t.name&&(e+=t.name),t.internalSubset&&(e+=t.internalSubset),t.publicId&&(e+='"'+t.publicId+'"'),t.systemId&&(e+='"'+t.systemId+'"'),e+=">"),e},x0t=function(t,e,i){t&&t.defaultView&&(e!==t.defaultView.pageXOffset||i!==t.defaultView.pageYOffset)&&t.defaultView.scrollTo(e,i)},_0t=function(t){var e=t[0],i=t[1],r=t[2];e.scrollLeft=i,e.scrollTop=r},O0t=":before",F0t=":after",hz="___html2canvas___pseudoelement_before",mz="___html2canvas___pseudoelement_after",Coe=`{
    content: "" !important;
    display: none !important;
}`,L0t=function(t){$0t(t,"."+hz+O0t+Coe+`
         .`+mz+F0t+Coe)},$0t=function(t,e){var i=t.ownerDocument;if(i){var r=i.createElement("style");r.textContent=e,t.appendChild(r)}},Eke=(function(){function t(){}return t.getOrigin=function(e){var i=t._link;return i?(i.href=e,i.href=i.href,i.protocol+i.hostname+i.port):"about:blank"},t.isSameOrigin=function(e){return t.getOrigin(e)===t._origin},t.setContext=function(e){t._link=e.document.createElement("a"),t._origin=t.getOrigin(e.location.href)},t._origin="about:blank",t})(),H0t=(function(){function t(e,i){this.context=e,this._options=i,this._cache={}}return t.prototype.addImage=function(e){var i=Promise.resolve();return this.has(e)||(DQ(e)||j0t(e))&&(this._cache[e]=this.loadImage(e)).catch(function(){}),i},t.prototype.match=function(e){return this._cache[e]},t.prototype.loadImage=function(e){return Kc(this,void 0,void 0,function(){var i,r,n,a,s=this;return Ac(this,function(o){switch(o.label){case 0:return i=Eke.isSameOrigin(e),r=!EQ(e)&&this._options.useCORS===!0&&Ml.SUPPORT_CORS_IMAGES&&!i,n=!EQ(e)&&!i&&!DQ(e)&&typeof this._options.proxy=="string"&&Ml.SUPPORT_CORS_XHR&&!r,!i&&this._options.allowTaint===!1&&!EQ(e)&&!DQ(e)&&!n&&!r?[2]:(a=e,n?[4,this.proxy(a)]:[3,2]);case 1:a=o.sent(),o.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise(function(l,c){var u=new Image;u.onload=function(){return l(u)},u.onerror=c,(z0t(a)||r)&&(u.crossOrigin="anonymous"),u.src=a,u.complete===!0&&setTimeout(function(){return l(u)},500),s._options.imageTimeout>0&&setTimeout(function(){return c("Timed out ("+s._options.imageTimeout+"ms) loading image")},s._options.imageTimeout)})];case 3:return[2,o.sent()]}})})},t.prototype.has=function(e){return typeof this._cache[e]<"u"},t.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},t.prototype.proxy=function(e){var i=this,r=this._options.proxy;if(!r)throw new Error("No proxy defined");var n=e.substring(0,256);return new Promise(function(a,s){var o=Ml.SUPPORT_RESPONSE_TYPE?"blob":"text",l=new XMLHttpRequest;l.onload=function(){if(l.status===200)if(o==="text")a(l.response);else{var d=new FileReader;d.addEventListener("load",function(){return a(d.result)},!1),d.addEventListener("error",function(p){return s(p)},!1),d.readAsDataURL(l.response)}else s("Failed to proxy resource "+n+" with status code "+l.status)},l.onerror=s;var c=r.indexOf("?")>-1?"&":"?";if(l.open("GET",""+r+c+"url="+encodeURIComponent(e)+"&responseType="+o),o!=="text"&&l instanceof XMLHttpRequest&&(l.responseType=o),i._options.imageTimeout){var u=i._options.imageTimeout;l.timeout=u,l.ontimeout=function(){return s("Timed out ("+u+"ms) proxying "+n)}}l.send()})},t})(),V0t=/^data:image\/svg\+xml/i,G0t=/^data:image\/.*;base64,/i,Q0t=/^data:image\/.*/i,j0t=function(t){return Ml.SUPPORT_SVG_DRAWING||!q0t(t)},EQ=function(t){return Q0t.test(t)},z0t=function(t){return G0t.test(t)},DQ=function(t){return t.substr(0,4)==="blob"},q0t=function(t){return t.substr(-3).toLowerCase()==="svg"||V0t.test(t)},ei=(function(){function t(e,i){this.type=0,this.x=e,this.y=i}return t.prototype.add=function(e,i){return new t(this.x+e,this.y+i)},t})(),hU=function(t,e,i){return new ei(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)},ik=(function(){function t(e,i,r,n){this.type=1,this.start=e,this.startControl=i,this.endControl=r,this.end=n}return t.prototype.subdivide=function(e,i){var r=hU(this.start,this.startControl,e),n=hU(this.startControl,this.endControl,e),a=hU(this.endControl,this.end,e),s=hU(r,n,e),o=hU(n,a,e),l=hU(s,o,e);return i?new t(this.start,r,s,l):new t(l,o,a,this.end)},t.prototype.add=function(e,i){return new t(this.start.add(e,i),this.startControl.add(e,i),this.endControl.add(e,i),this.end.add(e,i))},t.prototype.reverse=function(){return new t(this.end,this.endControl,this.startControl,this.start)},t})(),kp=function(t){return t.type===1},W0t=(function(){function t(e){var i=e.styles,r=e.bounds,n=GD(i.borderTopLeftRadius,r.width,r.height),a=n[0],s=n[1],o=GD(i.borderTopRightRadius,r.width,r.height),l=o[0],c=o[1],u=GD(i.borderBottomRightRadius,r.width,r.height),d=u[0],p=u[1],f=GD(i.borderBottomLeftRadius,r.width,r.height),h=f[0],m=f[1],A=[];A.push((a+l)/r.width),A.push((h+d)/r.width),A.push((s+m)/r.height),A.push((c+p)/r.height);var g=Math.max.apply(Math,A);g>1&&(a/=g,s/=g,l/=g,c/=g,d/=g,p/=g,h/=g,m/=g);var v=r.width-l,b=r.height-p,y=r.width-d,I=r.height-m,w=i.borderTopWidth,S=i.borderRightWidth,T=i.borderBottomWidth,D=i.borderLeftWidth,C=ka(i.paddingTop,e.bounds.width),E=ka(i.paddingRight,e.bounds.width),P=ka(i.paddingBottom,e.bounds.width),R=ka(i.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=a>0||s>0?ds(r.left+D/3,r.top+w/3,a-D/3,s-w/3,zn.TOP_LEFT):new ei(r.left+D/3,r.top+w/3),this.topRightBorderDoubleOuterBox=a>0||s>0?ds(r.left+v,r.top+w/3,l-S/3,c-w/3,zn.TOP_RIGHT):new ei(r.left+r.width-S/3,r.top+w/3),this.bottomRightBorderDoubleOuterBox=d>0||p>0?ds(r.left+y,r.top+b,d-S/3,p-T/3,zn.BOTTOM_RIGHT):new ei(r.left+r.width-S/3,r.top+r.height-T/3),this.bottomLeftBorderDoubleOuterBox=h>0||m>0?ds(r.left+D/3,r.top+I,h-D/3,m-T/3,zn.BOTTOM_LEFT):new ei(r.left+D/3,r.top+r.height-T/3),this.topLeftBorderDoubleInnerBox=a>0||s>0?ds(r.left+D*2/3,r.top+w*2/3,a-D*2/3,s-w*2/3,zn.TOP_LEFT):new ei(r.left+D*2/3,r.top+w*2/3),this.topRightBorderDoubleInnerBox=a>0||s>0?ds(r.left+v,r.top+w*2/3,l-S*2/3,c-w*2/3,zn.TOP_RIGHT):new ei(r.left+r.width-S*2/3,r.top+w*2/3),this.bottomRightBorderDoubleInnerBox=d>0||p>0?ds(r.left+y,r.top+b,d-S*2/3,p-T*2/3,zn.BOTTOM_RIGHT):new ei(r.left+r.width-S*2/3,r.top+r.height-T*2/3),this.bottomLeftBorderDoubleInnerBox=h>0||m>0?ds(r.left+D*2/3,r.top+I,h-D*2/3,m-T*2/3,zn.BOTTOM_LEFT):new ei(r.left+D*2/3,r.top+r.height-T*2/3),this.topLeftBorderStroke=a>0||s>0?ds(r.left+D/2,r.top+w/2,a-D/2,s-w/2,zn.TOP_LEFT):new ei(r.left+D/2,r.top+w/2),this.topRightBorderStroke=a>0||s>0?ds(r.left+v,r.top+w/2,l-S/2,c-w/2,zn.TOP_RIGHT):new ei(r.left+r.width-S/2,r.top+w/2),this.bottomRightBorderStroke=d>0||p>0?ds(r.left+y,r.top+b,d-S/2,p-T/2,zn.BOTTOM_RIGHT):new ei(r.left+r.width-S/2,r.top+r.height-T/2),this.bottomLeftBorderStroke=h>0||m>0?ds(r.left+D/2,r.top+I,h-D/2,m-T/2,zn.BOTTOM_LEFT):new ei(r.left+D/2,r.top+r.height-T/2),this.topLeftBorderBox=a>0||s>0?ds(r.left,r.top,a,s,zn.TOP_LEFT):new ei(r.left,r.top),this.topRightBorderBox=l>0||c>0?ds(r.left+v,r.top,l,c,zn.TOP_RIGHT):new ei(r.left+r.width,r.top),this.bottomRightBorderBox=d>0||p>0?ds(r.left+y,r.top+b,d,p,zn.BOTTOM_RIGHT):new ei(r.left+r.width,r.top+r.height),this.bottomLeftBorderBox=h>0||m>0?ds(r.left,r.top+I,h,m,zn.BOTTOM_LEFT):new ei(r.left,r.top+r.height),this.topLeftPaddingBox=a>0||s>0?ds(r.left+D,r.top+w,Math.max(0,a-D),Math.max(0,s-w),zn.TOP_LEFT):new ei(r.left+D,r.top+w),this.topRightPaddingBox=l>0||c>0?ds(r.left+Math.min(v,r.width-S),r.top+w,v>r.width+S?0:Math.max(0,l-S),Math.max(0,c-w),zn.TOP_RIGHT):new ei(r.left+r.width-S,r.top+w),this.bottomRightPaddingBox=d>0||p>0?ds(r.left+Math.min(y,r.width-D),r.top+Math.min(b,r.height-T),Math.max(0,d-S),Math.max(0,p-T),zn.BOTTOM_RIGHT):new ei(r.left+r.width-S,r.top+r.height-T),this.bottomLeftPaddingBox=h>0||m>0?ds(r.left+D,r.top+Math.min(I,r.height-T),Math.max(0,h-D),Math.max(0,m-T),zn.BOTTOM_LEFT):new ei(r.left+D,r.top+r.height-T),this.topLeftContentBox=a>0||s>0?ds(r.left+D+R,r.top+w+C,Math.max(0,a-(D+R)),Math.max(0,s-(w+C)),zn.TOP_LEFT):new ei(r.left+D+R,r.top+w+C),this.topRightContentBox=l>0||c>0?ds(r.left+Math.min(v,r.width+D+R),r.top+w+C,v>r.width+D+R?0:l-D+R,c-(w+C),zn.TOP_RIGHT):new ei(r.left+r.width-(S+E),r.top+w+C),this.bottomRightContentBox=d>0||p>0?ds(r.left+Math.min(y,r.width-(D+R)),r.top+Math.min(b,r.height+w+C),Math.max(0,d-(S+E)),p-(T+P),zn.BOTTOM_RIGHT):new ei(r.left+r.width-(S+E),r.top+r.height-(T+P)),this.bottomLeftContentBox=h>0||m>0?ds(r.left+D+R,r.top+I,Math.max(0,h-(D+R)),m-(T+P),zn.BOTTOM_LEFT):new ei(r.left+D+R,r.top+r.height-(T+P))}return t})(),zn;(function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_RIGHT=1]="TOP_RIGHT",t[t.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",t[t.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(zn||(zn={}));var ds=function(t,e,i,r,n){var a=4*((Math.sqrt(2)-1)/3),s=i*a,o=r*a,l=t+i,c=e+r;switch(n){case zn.TOP_LEFT:return new ik(new ei(t,c),new ei(t,c-o),new ei(l-s,e),new ei(l,e));case zn.TOP_RIGHT:return new ik(new ei(t,e),new ei(t+s,e),new ei(l,c-o),new ei(l,c));case zn.BOTTOM_RIGHT:return new ik(new ei(l,e),new ei(l,e+o),new ei(t+s,c),new ei(t,c));case zn.BOTTOM_LEFT:default:return new ik(new ei(l,c),new ei(l-s,c),new ei(t,e+o),new ei(t,e))}},RO=function(t){return[t.topLeftBorderBox,t.topRightBorderBox,t.bottomRightBorderBox,t.bottomLeftBorderBox]},K0t=function(t){return[t.topLeftContentBox,t.topRightContentBox,t.bottomRightContentBox,t.bottomLeftContentBox]},MO=function(t){return[t.topLeftPaddingBox,t.topRightPaddingBox,t.bottomRightPaddingBox,t.bottomLeftPaddingBox]},Y0t=(function(){function t(e,i,r){this.offsetX=e,this.offsetY=i,this.matrix=r,this.type=0,this.target=6}return t})(),rk=(function(){function t(e,i){this.path=e,this.target=i,this.type=1}return t})(),X0t=(function(){function t(e){this.opacity=e,this.type=2,this.target=6}return t})(),Z0t=function(t){return t.type===0},Dke=function(t){return t.type===1},J0t=function(t){return t.type===2},Eoe=function(t,e){return t.length===e.length?t.some(function(i,r){return i===e[r]}):!1},ePt=function(t,e,i,r,n){return t.map(function(a,s){switch(s){case 0:return a.add(e,i);case 1:return a.add(e+r,i);case 2:return a.add(e+r,i+n);case 3:return a.add(e,i+n)}return a})},Pke=(function(){function t(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return t})(),Rke=(function(){function t(e,i){if(this.container=e,this.parent=i,this.effects=[],this.curves=new W0t(this.container),this.container.styles.opacity<1&&this.effects.push(new X0t(this.container.styles.opacity)),this.container.styles.transform!==null){var r=this.container.bounds.left+this.container.styles.transformOrigin[0].number,n=this.container.bounds.top+this.container.styles.transformOrigin[1].number,a=this.container.styles.transform;this.effects.push(new Y0t(r,n,a))}if(this.container.styles.overflowX!==0){var s=RO(this.curves),o=MO(this.curves);Eoe(s,o)?this.effects.push(new rk(s,6)):(this.effects.push(new rk(s,2)),this.effects.push(new rk(o,4)))}}return t.prototype.getEffects=function(e){for(var i=[2,3].indexOf(this.container.styles.position)===-1,r=this.parent,n=this.effects.slice(0);r;){var a=r.effects.filter(function(l){return!Dke(l)});if(i||r.container.styles.position!==0||!r.parent){if(n.unshift.apply(n,a),i=[2,3].indexOf(r.container.styles.position)===-1,r.container.styles.overflowX!==0){var s=RO(r.curves),o=MO(r.curves);Eoe(s,o)||n.unshift(new rk(o,6))}}else n.unshift.apply(n,a);r=r.parent}return n.filter(function(l){return Qo(l.target,e)})},t})(),Az=function(t,e,i,r){t.container.elements.forEach(function(n){var a=Qo(n.flags,4),s=Qo(n.flags,2),o=new Rke(n,t);Qo(n.styles.display,2048)&&r.push(o);var l=Qo(n.flags,8)?[]:r;if(a||s){var c=a||n.styles.isPositioned()?i:e,u=new Pke(o);if(n.styles.isPositioned()||n.styles.opacity<1||n.styles.isTransformed()){var d=n.styles.zIndex.order;if(d<0){var p=0;c.negativeZIndex.some(function(h,m){return d>h.element.container.styles.zIndex.order?(p=m,!1):p>0}),c.negativeZIndex.splice(p,0,u)}else if(d>0){var f=0;c.positiveZIndex.some(function(h,m){return d>=h.element.container.styles.zIndex.order?(f=m+1,!1):f>0}),c.positiveZIndex.splice(f,0,u)}else c.zeroOrAutoZIndexOrTransformedOrOpacity.push(u)}else n.styles.isFloating()?c.nonPositionedFloats.push(u):c.nonPositionedInlineLevel.push(u);Az(o,u,a?u:i,l)}else n.styles.isInlineLevel()?e.inlineLevel.push(o):e.nonInlineLevel.push(o),Az(o,e,i,l);Qo(n.flags,8)&&Mke(n,l)})},Mke=function(t,e){for(var i=t instanceof dz?t.start:1,r=t instanceof dz?t.reversed:!1,n=0;n<e.length;n++){var a=e[n];a.container instanceof hke&&typeof a.container.value=="number"&&a.container.value!==0&&(i=a.container.value),a.listValue=y1(i,a.container.styles.listStyleType,!0),i+=r?-1:1}},tPt=function(t){var e=new Rke(t,null),i=new Pke(e),r=[];return Az(e,i,i,r),Mke(e.container,r),i},Doe=function(t,e){switch(e){case 0:return Vp(t.topLeftBorderBox,t.topLeftPaddingBox,t.topRightBorderBox,t.topRightPaddingBox);case 1:return Vp(t.topRightBorderBox,t.topRightPaddingBox,t.bottomRightBorderBox,t.bottomRightPaddingBox);case 2:return Vp(t.bottomRightBorderBox,t.bottomRightPaddingBox,t.bottomLeftBorderBox,t.bottomLeftPaddingBox);default:return Vp(t.bottomLeftBorderBox,t.bottomLeftPaddingBox,t.topLeftBorderBox,t.topLeftPaddingBox)}},iPt=function(t,e){switch(e){case 0:return Vp(t.topLeftBorderBox,t.topLeftBorderDoubleOuterBox,t.topRightBorderBox,t.topRightBorderDoubleOuterBox);case 1:return Vp(t.topRightBorderBox,t.topRightBorderDoubleOuterBox,t.bottomRightBorderBox,t.bottomRightBorderDoubleOuterBox);case 2:return Vp(t.bottomRightBorderBox,t.bottomRightBorderDoubleOuterBox,t.bottomLeftBorderBox,t.bottomLeftBorderDoubleOuterBox);default:return Vp(t.bottomLeftBorderBox,t.bottomLeftBorderDoubleOuterBox,t.topLeftBorderBox,t.topLeftBorderDoubleOuterBox)}},rPt=function(t,e){switch(e){case 0:return Vp(t.topLeftBorderDoubleInnerBox,t.topLeftPaddingBox,t.topRightBorderDoubleInnerBox,t.topRightPaddingBox);case 1:return Vp(t.topRightBorderDoubleInnerBox,t.topRightPaddingBox,t.bottomRightBorderDoubleInnerBox,t.bottomRightPaddingBox);case 2:return Vp(t.bottomRightBorderDoubleInnerBox,t.bottomRightPaddingBox,t.bottomLeftBorderDoubleInnerBox,t.bottomLeftPaddingBox);default:return Vp(t.bottomLeftBorderDoubleInnerBox,t.bottomLeftPaddingBox,t.topLeftBorderDoubleInnerBox,t.topLeftPaddingBox)}},nPt=function(t,e){switch(e){case 0:return nk(t.topLeftBorderStroke,t.topRightBorderStroke);case 1:return nk(t.topRightBorderStroke,t.bottomRightBorderStroke);case 2:return nk(t.bottomRightBorderStroke,t.bottomLeftBorderStroke);default:return nk(t.bottomLeftBorderStroke,t.topLeftBorderStroke)}},nk=function(t,e){var i=[];return kp(t)?i.push(t.subdivide(.5,!1)):i.push(t),kp(e)?i.push(e.subdivide(.5,!0)):i.push(e),i},Vp=function(t,e,i,r){var n=[];return kp(t)?n.push(t.subdivide(.5,!1)):n.push(t),kp(i)?n.push(i.subdivide(.5,!0)):n.push(i),kp(r)?n.push(r.subdivide(.5,!0).reverse()):n.push(r),kp(e)?n.push(e.subdivide(.5,!1).reverse()):n.push(e),n},Nke=function(t){var e=t.bounds,i=t.styles;return e.add(i.borderLeftWidth,i.borderTopWidth,-(i.borderRightWidth+i.borderLeftWidth),-(i.borderTopWidth+i.borderBottomWidth))},NO=function(t){var e=t.styles,i=t.bounds,r=ka(e.paddingLeft,i.width),n=ka(e.paddingRight,i.width),a=ka(e.paddingTop,i.width),s=ka(e.paddingBottom,i.width);return i.add(r+e.borderLeftWidth,a+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+r+n),-(e.borderTopWidth+e.borderBottomWidth+a+s))},aPt=function(t,e){return t===0?e.bounds:t===2?NO(e):Nke(e)},sPt=function(t,e){return t===0?e.bounds:t===2?NO(e):Nke(e)},PQ=function(t,e,i){var r=aPt(DU(t.styles.backgroundOrigin,e),t),n=sPt(DU(t.styles.backgroundClip,e),t),a=oPt(DU(t.styles.backgroundSize,e),i,r),s=a[0],o=a[1],l=GD(DU(t.styles.backgroundPosition,e),r.width-s,r.height-o),c=lPt(DU(t.styles.backgroundRepeat,e),l,a,r,n),u=Math.round(r.left+l[0]),d=Math.round(r.top+l[1]);return[c,u,d,s,o]},mU=function(t){return pa(t)&&t.value===aT.AUTO},ak=function(t){return typeof t=="number"},oPt=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=t[0],o=t[1];if(!s)return[0,0];if(Io(s)&&o&&Io(o))return[ka(s,i.width),ka(o,i.height)];var l=ak(a);if(pa(s)&&(s.value===aT.CONTAIN||s.value===aT.COVER)){if(ak(a)){var c=i.width/i.height;return c<a!=(s.value===aT.COVER)?[i.width,i.width/a]:[i.height*a,i.height]}return[i.width,i.height]}var u=ak(r),d=ak(n),p=u||d;if(mU(s)&&(!o||mU(o))){if(u&&d)return[r,n];if(!l&&!p)return[i.width,i.height];if(p&&l){var f=u?r:n*a,h=d?n:r/a;return[f,h]}var m=u?r:i.width,A=d?n:i.height;return[m,A]}if(l){var g=0,v=0;return Io(s)?g=ka(s,i.width):Io(o)&&(v=ka(o,i.height)),mU(s)?g=v*a:(!o||mU(o))&&(v=g/a),[g,v]}var b=null,y=null;if(Io(s)?b=ka(s,i.width):o&&Io(o)&&(y=ka(o,i.height)),b!==null&&(!o||mU(o))&&(y=u&&d?b/r*n:i.height),y!==null&&mU(s)&&(b=u&&d?y/n*r:i.width),b!==null&&y!==null)return[b,y];throw new Error("Unable to calculate background-size for element")},DU=function(t,e){var i=t[e];return typeof i>"u"?t[0]:i},lPt=function(t,e,i,r,n){var a=e[0],s=e[1],o=i[0],l=i[1];switch(t){case 2:return[new ei(Math.round(r.left),Math.round(r.top+s)),new ei(Math.round(r.left+r.width),Math.round(r.top+s)),new ei(Math.round(r.left+r.width),Math.round(l+r.top+s)),new ei(Math.round(r.left),Math.round(l+r.top+s))];case 3:return[new ei(Math.round(r.left+a),Math.round(r.top)),new ei(Math.round(r.left+a+o),Math.round(r.top)),new ei(Math.round(r.left+a+o),Math.round(r.height+r.top)),new ei(Math.round(r.left+a),Math.round(r.height+r.top))];case 1:return[new ei(Math.round(r.left+a),Math.round(r.top+s)),new ei(Math.round(r.left+a+o),Math.round(r.top+s)),new ei(Math.round(r.left+a+o),Math.round(r.top+s+l)),new ei(Math.round(r.left+a),Math.round(r.top+s+l))];default:return[new ei(Math.round(n.left),Math.round(n.top)),new ei(Math.round(n.left+n.width),Math.round(n.top)),new ei(Math.round(n.left+n.width),Math.round(n.height+n.top)),new ei(Math.round(n.left),Math.round(n.height+n.top))]}},cPt="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",Poe="Hidden Text",uPt=(function(){function t(e){this._data={},this._document=e}return t.prototype.parseMetrics=function(e,i){var r=this._document.createElement("div"),n=this._document.createElement("img"),a=this._document.createElement("span"),s=this._document.body;r.style.visibility="hidden",r.style.fontFamily=e,r.style.fontSize=i,r.style.margin="0",r.style.padding="0",r.style.whiteSpace="nowrap",s.appendChild(r),n.src=cPt,n.width=1,n.height=1,n.style.margin="0",n.style.padding="0",n.style.verticalAlign="baseline",a.style.fontFamily=e,a.style.fontSize=i,a.style.margin="0",a.style.padding="0",a.appendChild(this._document.createTextNode(Poe)),r.appendChild(a),r.appendChild(n);var o=n.offsetTop-a.offsetTop+2;r.removeChild(a),r.appendChild(this._document.createTextNode(Poe)),r.style.lineHeight="normal",n.style.verticalAlign="super";var l=n.offsetTop-r.offsetTop+2;return s.removeChild(r),{baseline:o,middle:l}},t.prototype.getMetrics=function(e,i){var r=e+" "+i;return typeof this._data[r]>"u"&&(this._data[r]=this.parseMetrics(e,i)),this._data[r]},t})(),Bke=(function(){function t(e,i){this.context=e,this.options=i}return t})(),dPt=1e4,pPt=(function(t){Kh(e,t);function e(i,r){var n=t.call(this,i,r)||this;return n._activeEffects=[],n.canvas=r.canvas?r.canvas:document.createElement("canvas"),n.ctx=n.canvas.getContext("2d"),r.canvas||(n.canvas.width=Math.floor(r.width*r.scale),n.canvas.height=Math.floor(r.height*r.scale),n.canvas.style.width=r.width+"px",n.canvas.style.height=r.height+"px"),n.fontMetrics=new uPt(document),n.ctx.scale(n.options.scale,n.options.scale),n.ctx.translate(-r.x,-r.y),n.ctx.textBaseline="bottom",n._activeEffects=[],n.context.logger.debug("Canvas renderer initialized ("+r.width+"x"+r.height+") with scale "+r.scale),n}return e.prototype.applyEffects=function(i){for(var r=this;this._activeEffects.length;)this.popEffect();i.forEach(function(n){return r.applyEffect(n)})},e.prototype.applyEffect=function(i){this.ctx.save(),J0t(i)&&(this.ctx.globalAlpha=i.opacity),Z0t(i)&&(this.ctx.translate(i.offsetX,i.offsetY),this.ctx.transform(i.matrix[0],i.matrix[1],i.matrix[2],i.matrix[3],i.matrix[4],i.matrix[5]),this.ctx.translate(-i.offsetX,-i.offsetY)),Dke(i)&&(this.path(i.path),this.ctx.clip()),this._activeEffects.push(i)},e.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},e.prototype.renderStack=function(i){return Kc(this,void 0,void 0,function(){var r;return Ac(this,function(n){switch(n.label){case 0:return r=i.element.container.styles,r.isVisible()?[4,this.renderStackContent(i)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})})},e.prototype.renderNode=function(i){return Kc(this,void 0,void 0,function(){return Ac(this,function(r){switch(r.label){case 0:if(Qo(i.container.flags,16))debugger;return i.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(i)]:[3,3];case 1:return r.sent(),[4,this.renderNodeContent(i)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e.prototype.renderTextWithLetterSpacing=function(i,r,n){var a=this;if(r===0)this.ctx.fillText(i.text,i.bounds.left,i.bounds.top+n);else{var s=JZ(i.text);s.reduce(function(o,l){return a.ctx.fillText(l,o,i.bounds.top+n),o+a.ctx.measureText(l).width},i.bounds.left)}},e.prototype.createFontStyle=function(i){var r=i.fontVariant.filter(function(s){return s==="normal"||s==="small-caps"}).join(""),n=gPt(i.fontFamily).join(", "),a=kN(i.fontSize)?""+i.fontSize.number+i.fontSize.unit:i.fontSize.number+"px";return[[i.fontStyle,r,i.fontWeight,a,n].join(" "),n,a]},e.prototype.renderTextNode=function(i,r){return Kc(this,void 0,void 0,function(){var n,a,s,o,l,c,u,d,p=this;return Ac(this,function(f){return n=this.createFontStyle(r),a=n[0],s=n[1],o=n[2],this.ctx.font=a,this.ctx.direction=r.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",l=this.fontMetrics.getMetrics(s,o),c=l.baseline,u=l.middle,d=r.paintOrder,i.textBounds.forEach(function(h){d.forEach(function(m){switch(m){case 0:p.ctx.fillStyle=cl(r.color),p.renderTextWithLetterSpacing(h,r.letterSpacing,c);var A=r.textShadow;A.length&&h.text.trim().length&&(A.slice(0).reverse().forEach(function(g){p.ctx.shadowColor=cl(g.color),p.ctx.shadowOffsetX=g.offsetX.number*p.options.scale,p.ctx.shadowOffsetY=g.offsetY.number*p.options.scale,p.ctx.shadowBlur=g.blur.number,p.renderTextWithLetterSpacing(h,r.letterSpacing,c)}),p.ctx.shadowColor="",p.ctx.shadowOffsetX=0,p.ctx.shadowOffsetY=0,p.ctx.shadowBlur=0),r.textDecorationLine.length&&(p.ctx.fillStyle=cl(r.textDecorationColor||r.color),r.textDecorationLine.forEach(function(g){switch(g){case 1:p.ctx.fillRect(h.bounds.left,Math.round(h.bounds.top+c),h.bounds.width,1);break;case 2:p.ctx.fillRect(h.bounds.left,Math.round(h.bounds.top),h.bounds.width,1);break;case 3:p.ctx.fillRect(h.bounds.left,Math.ceil(h.bounds.top+u),h.bounds.width,1);break}}));break;case 1:r.webkitTextStrokeWidth&&h.text.trim().length&&(p.ctx.strokeStyle=cl(r.webkitTextStrokeColor),p.ctx.lineWidth=r.webkitTextStrokeWidth,p.ctx.lineJoin=window.chrome?"miter":"round",p.ctx.strokeText(h.text,h.bounds.left,h.bounds.top+c)),p.ctx.strokeStyle="",p.ctx.lineWidth=0,p.ctx.lineJoin="miter";break}})}),[2]})})},e.prototype.renderReplacedElement=function(i,r,n){if(n&&i.intrinsicWidth>0&&i.intrinsicHeight>0){var a=NO(i),s=MO(r);this.path(s),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,i.intrinsicWidth,i.intrinsicHeight,a.left,a.top,a.width,a.height),this.ctx.restore()}},e.prototype.renderNodeContent=function(i){return Kc(this,void 0,void 0,function(){var r,n,a,s,o,l,v,v,c,u,d,p,y,f,h,I,m,A,g,v,b,y,I;return Ac(this,function(w){switch(w.label){case 0:this.applyEffects(i.getEffects(4)),r=i.container,n=i.curves,a=r.styles,s=0,o=r.textNodes,w.label=1;case 1:return s<o.length?(l=o[s],[4,this.renderTextNode(l,a)]):[3,4];case 2:w.sent(),w.label=3;case 3:return s++,[3,1];case 4:if(!(r instanceof dke))return[3,8];w.label=5;case 5:return w.trys.push([5,7,,8]),[4,this.context.cache.match(r.src)];case 6:return v=w.sent(),this.renderReplacedElement(r,n,v),[3,8];case 7:return w.sent(),this.context.logger.error("Error loading image "+r.src),[3,8];case 8:if(r instanceof pke&&this.renderReplacedElement(r,n,r.canvas),!(r instanceof fke))return[3,12];w.label=9;case 9:return w.trys.push([9,11,,12]),[4,this.context.cache.match(r.svg)];case 10:return v=w.sent(),this.renderReplacedElement(r,n,v),[3,12];case 11:return w.sent(),this.context.logger.error("Error loading svg "+r.svg.substring(0,255)),[3,12];case 12:return r instanceof gke&&r.tree?(c=new e(this.context,{scale:this.options.scale,backgroundColor:r.backgroundColor,x:0,y:0,width:r.width,height:r.height}),[4,c.render(r.tree)]):[3,14];case 13:u=w.sent(),r.width&&r.height&&this.ctx.drawImage(u,0,0,r.width,r.height,r.bounds.left,r.bounds.top,r.bounds.width,r.bounds.height),w.label=14;case 14:if(r instanceof eJ&&(d=Math.min(r.bounds.width,r.bounds.height),r.type===CO?r.checked&&(this.ctx.save(),this.path([new ei(r.bounds.left+d*.39363,r.bounds.top+d*.79),new ei(r.bounds.left+d*.16,r.bounds.top+d*.5549),new ei(r.bounds.left+d*.27347,r.bounds.top+d*.44071),new ei(r.bounds.left+d*.39694,r.bounds.top+d*.5649),new ei(r.bounds.left+d*.72983,r.bounds.top+d*.23),new ei(r.bounds.left+d*.84,r.bounds.top+d*.34085),new ei(r.bounds.left+d*.39363,r.bounds.top+d*.79)]),this.ctx.fillStyle=cl(Aoe),this.ctx.fill(),this.ctx.restore()):r.type===EO&&r.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(r.bounds.left+d/2,r.bounds.top+d/2,d/4,0,Math.PI*2,!0),this.ctx.fillStyle=cl(Aoe),this.ctx.fill(),this.ctx.restore())),fPt(r)&&r.value.length){switch(p=this.createFontStyle(a),y=p[0],f=p[1],h=this.fontMetrics.getMetrics(y,f).baseline,this.ctx.font=y,this.ctx.fillStyle=cl(a.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=mPt(r.styles.textAlign),I=NO(r),m=0,r.styles.textAlign){case 1:m+=I.width/2;break;case 2:m+=I.width;break}A=I.add(m,0,0,-I.height/2+1),this.ctx.save(),this.path([new ei(I.left,I.top),new ei(I.left+I.width,I.top),new ei(I.left+I.width,I.top+I.height),new ei(I.left,I.top+I.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new L0(r.value,A),a.letterSpacing,h),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Qo(r.styles.display,2048))return[3,20];if(r.styles.listStyleImage===null)return[3,19];if(g=r.styles.listStyleImage,g.type!==0)return[3,18];v=void 0,b=g.url,w.label=15;case 15:return w.trys.push([15,17,,18]),[4,this.context.cache.match(b)];case 16:return v=w.sent(),this.ctx.drawImage(v,r.bounds.left-(v.width+10),r.bounds.top),[3,18];case 17:return w.sent(),this.context.logger.error("Error loading list-style-image "+b),[3,18];case 18:return[3,20];case 19:i.listValue&&r.styles.listStyleType!==-1&&(y=this.createFontStyle(a)[0],this.ctx.font=y,this.ctx.fillStyle=cl(a.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",I=new kg(r.bounds.left,r.bounds.top+ka(r.styles.paddingTop,r.bounds.width),r.bounds.width,Jse(a.lineHeight,a.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new L0(i.listValue,I),a.letterSpacing,Jse(a.lineHeight,a.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),w.label=20;case 20:return[2]}})})},e.prototype.renderStackContent=function(i){return Kc(this,void 0,void 0,function(){var r,n,g,a,s,g,o,l,g,c,u,g,d,p,g,f,h,g,m,A,g;return Ac(this,function(v){switch(v.label){case 0:if(Qo(i.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(i.element)];case 1:v.sent(),r=0,n=i.negativeZIndex,v.label=2;case 2:return r<n.length?(g=n[r],[4,this.renderStack(g)]):[3,5];case 3:v.sent(),v.label=4;case 4:return r++,[3,2];case 5:return[4,this.renderNodeContent(i.element)];case 6:v.sent(),a=0,s=i.nonInlineLevel,v.label=7;case 7:return a<s.length?(g=s[a],[4,this.renderNode(g)]):[3,10];case 8:v.sent(),v.label=9;case 9:return a++,[3,7];case 10:o=0,l=i.nonPositionedFloats,v.label=11;case 11:return o<l.length?(g=l[o],[4,this.renderStack(g)]):[3,14];case 12:v.sent(),v.label=13;case 13:return o++,[3,11];case 14:c=0,u=i.nonPositionedInlineLevel,v.label=15;case 15:return c<u.length?(g=u[c],[4,this.renderStack(g)]):[3,18];case 16:v.sent(),v.label=17;case 17:return c++,[3,15];case 18:d=0,p=i.inlineLevel,v.label=19;case 19:return d<p.length?(g=p[d],[4,this.renderNode(g)]):[3,22];case 20:v.sent(),v.label=21;case 21:return d++,[3,19];case 22:f=0,h=i.zeroOrAutoZIndexOrTransformedOrOpacity,v.label=23;case 23:return f<h.length?(g=h[f],[4,this.renderStack(g)]):[3,26];case 24:v.sent(),v.label=25;case 25:return f++,[3,23];case 26:m=0,A=i.positiveZIndex,v.label=27;case 27:return m<A.length?(g=A[m],[4,this.renderStack(g)]):[3,30];case 28:v.sent(),v.label=29;case 29:return m++,[3,27];case 30:return[2]}})})},e.prototype.mask=function(i){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(i.slice(0).reverse()),this.ctx.closePath()},e.prototype.path=function(i){this.ctx.beginPath(),this.formatPath(i),this.ctx.closePath()},e.prototype.formatPath=function(i){var r=this;i.forEach(function(n,a){var s=kp(n)?n.start:n;a===0?r.ctx.moveTo(s.x,s.y):r.ctx.lineTo(s.x,s.y),kp(n)&&r.ctx.bezierCurveTo(n.startControl.x,n.startControl.y,n.endControl.x,n.endControl.y,n.end.x,n.end.y)})},e.prototype.renderRepeat=function(i,r,n,a){this.path(i),this.ctx.fillStyle=r,this.ctx.translate(n,a),this.ctx.fill(),this.ctx.translate(-n,-a)},e.prototype.resizeImage=function(i,r,n){var a;if(i.width===r&&i.height===n)return i;var s=(a=this.canvas.ownerDocument)!==null&&a!==void 0?a:document,o=s.createElement("canvas");o.width=Math.max(1,r),o.height=Math.max(1,n);var l=o.getContext("2d");return l.drawImage(i,0,0,i.width,i.height,0,0,r,n),o},e.prototype.renderBackgroundImage=function(i){return Kc(this,void 0,void 0,function(){var r,n,a,s,o,l;return Ac(this,function(c){switch(c.label){case 0:r=i.styles.backgroundImage.length-1,n=function(u){var d,p,f,C,k,O,R,M,T,h,C,k,O,R,M,m,A,g,v,b,y,I,w,S,T,D,C,E,P,R,M,N,k,O,x,F,_,V,G,z,Q,j;return Ac(this,function(W){switch(W.label){case 0:if(u.type!==0)return[3,5];d=void 0,p=u.url,W.label=1;case 1:return W.trys.push([1,3,,4]),[4,a.context.cache.match(p)];case 2:return d=W.sent(),[3,4];case 3:return W.sent(),a.context.logger.error("Error loading background-image "+p),[3,4];case 4:return d&&(f=PQ(i,r,[d.width,d.height,d.width/d.height]),C=f[0],k=f[1],O=f[2],R=f[3],M=f[4],T=a.ctx.createPattern(a.resizeImage(d,R,M),"repeat"),a.renderRepeat(C,T,k,O)),[3,6];case 5:ZCt(u)?(h=PQ(i,r,[null,null,null]),C=h[0],k=h[1],O=h[2],R=h[3],M=h[4],m=qCt(u.angle,R,M),A=m[0],g=m[1],v=m[2],b=m[3],y=m[4],I=document.createElement("canvas"),I.width=R,I.height=M,w=I.getContext("2d"),S=w.createLinearGradient(g,b,v,y),Xse(u.stops,A).forEach(function(Y){return S.addColorStop(Y.stop,cl(Y.color))}),w.fillStyle=S,w.fillRect(0,0,R,M),R>0&&M>0&&(T=a.ctx.createPattern(I,"repeat"),a.renderRepeat(C,T,k,O))):JCt(u)&&(D=PQ(i,r,[null,null,null]),C=D[0],E=D[1],P=D[2],R=D[3],M=D[4],N=u.position.length===0?[YZ]:u.position,k=ka(N[0],R),O=ka(N[N.length-1],M),x=WCt(u,k,O,R,M),F=x[0],_=x[1],F>0&&_>0&&(V=a.ctx.createRadialGradient(E+k,P+O,0,E+k,P+O,F),Xse(u.stops,F*2).forEach(function(Y){return V.addColorStop(Y.stop,cl(Y.color))}),a.path(C),a.ctx.fillStyle=V,F!==_?(G=i.bounds.left+.5*i.bounds.width,z=i.bounds.top+.5*i.bounds.height,Q=_/F,j=1/Q,a.ctx.save(),a.ctx.translate(G,z),a.ctx.transform(1,0,0,Q,0,0),a.ctx.translate(-G,-z),a.ctx.fillRect(E,j*(P-z)+z,R,M*j),a.ctx.restore()):a.ctx.fill())),W.label=6;case 6:return r--,[2]}})},a=this,s=0,o=i.styles.backgroundImage.slice(0).reverse(),c.label=1;case 1:return s<o.length?(l=o[s],[5,n(l)]):[3,4];case 2:c.sent(),c.label=3;case 3:return s++,[3,1];case 4:return[2]}})})},e.prototype.renderSolidBorder=function(i,r,n){return Kc(this,void 0,void 0,function(){return Ac(this,function(a){return this.path(Doe(n,r)),this.ctx.fillStyle=cl(i),this.ctx.fill(),[2]})})},e.prototype.renderDoubleBorder=function(i,r,n,a){return Kc(this,void 0,void 0,function(){var s,o;return Ac(this,function(l){switch(l.label){case 0:return r<3?[4,this.renderSolidBorder(i,n,a)]:[3,2];case 1:return l.sent(),[2];case 2:return s=iPt(a,n),this.path(s),this.ctx.fillStyle=cl(i),this.ctx.fill(),o=rPt(a,n),this.path(o),this.ctx.fill(),[2]}})})},e.prototype.renderNodeBackgroundAndBorders=function(i){return Kc(this,void 0,void 0,function(){var r,n,a,s,o,l,c,u,d=this;return Ac(this,function(p){switch(p.label){case 0:return this.applyEffects(i.getEffects(2)),r=i.container.styles,n=!py(r.backgroundColor)||r.backgroundImage.length,a=[{style:r.borderTopStyle,color:r.borderTopColor,width:r.borderTopWidth},{style:r.borderRightStyle,color:r.borderRightColor,width:r.borderRightWidth},{style:r.borderBottomStyle,color:r.borderBottomColor,width:r.borderBottomWidth},{style:r.borderLeftStyle,color:r.borderLeftColor,width:r.borderLeftWidth}],s=hPt(DU(r.backgroundClip,0),i.curves),n||r.boxShadow.length?(this.ctx.save(),this.path(s),this.ctx.clip(),py(r.backgroundColor)||(this.ctx.fillStyle=cl(r.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(i.container)]):[3,2];case 1:p.sent(),this.ctx.restore(),r.boxShadow.slice(0).reverse().forEach(function(f){d.ctx.save();var h=RO(i.curves),m=f.inset?0:dPt,A=ePt(h,-m+(f.inset?1:-1)*f.spread.number,(f.inset?1:-1)*f.spread.number,f.spread.number*(f.inset?-2:2),f.spread.number*(f.inset?-2:2));f.inset?(d.path(h),d.ctx.clip(),d.mask(A)):(d.mask(h),d.ctx.clip(),d.path(A)),d.ctx.shadowOffsetX=f.offsetX.number+m,d.ctx.shadowOffsetY=f.offsetY.number,d.ctx.shadowColor=cl(f.color),d.ctx.shadowBlur=f.blur.number,d.ctx.fillStyle=f.inset?cl(f.color):"rgba(0,0,0,1)",d.ctx.fill(),d.ctx.restore()}),p.label=2;case 2:o=0,l=0,c=a,p.label=3;case 3:return l<c.length?(u=c[l],u.style!==0&&!py(u.color)&&u.width>0?u.style!==2?[3,5]:[4,this.renderDashedDottedBorder(u.color,u.width,o,i.curves,2)]:[3,11]):[3,13];case 4:return p.sent(),[3,11];case 5:return u.style!==3?[3,7]:[4,this.renderDashedDottedBorder(u.color,u.width,o,i.curves,3)];case 6:return p.sent(),[3,11];case 7:return u.style!==4?[3,9]:[4,this.renderDoubleBorder(u.color,u.width,o,i.curves)];case 8:return p.sent(),[3,11];case 9:return[4,this.renderSolidBorder(u.color,o,i.curves)];case 10:p.sent(),p.label=11;case 11:o++,p.label=12;case 12:return l++,[3,3];case 13:return[2]}})})},e.prototype.renderDashedDottedBorder=function(i,r,n,a,s){return Kc(this,void 0,void 0,function(){var o,l,c,u,d,p,f,h,m,A,g,v,b,y,I,w,I,w;return Ac(this,function(S){return this.ctx.save(),o=nPt(a,n),l=Doe(a,n),s===2&&(this.path(l),this.ctx.clip()),kp(l[0])?(c=l[0].start.x,u=l[0].start.y):(c=l[0].x,u=l[0].y),kp(l[1])?(d=l[1].end.x,p=l[1].end.y):(d=l[1].x,p=l[1].y),n===0||n===2?f=Math.abs(c-d):f=Math.abs(u-p),this.ctx.beginPath(),s===3?this.formatPath(o):this.formatPath(l.slice(0,2)),h=r<3?r*3:r*2,m=r<3?r*2:r,s===3&&(h=r,m=r),A=!0,f<=h*2?A=!1:f<=h*2+m?(g=f/(2*h+m),h*=g,m*=g):(v=Math.floor((f+m)/(h+m)),b=(f-v*h)/(v-1),y=(f-(v+1)*h)/v,m=y<=0||Math.abs(m-b)<Math.abs(m-y)?b:y),A&&(s===3?this.ctx.setLineDash([0,h+m]):this.ctx.setLineDash([h,m])),s===3?(this.ctx.lineCap="round",this.ctx.lineWidth=r):this.ctx.lineWidth=r*2+1.1,this.ctx.strokeStyle=cl(i),this.ctx.stroke(),this.ctx.setLineDash([]),s===2&&(kp(l[0])&&(I=l[3],w=l[0],this.ctx.beginPath(),this.formatPath([new ei(I.end.x,I.end.y),new ei(w.start.x,w.start.y)]),this.ctx.stroke()),kp(l[1])&&(I=l[1],w=l[2],this.ctx.beginPath(),this.formatPath([new ei(I.end.x,I.end.y),new ei(w.start.x,w.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},e.prototype.render=function(i){return Kc(this,void 0,void 0,function(){var r;return Ac(this,function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=cl(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),r=tPt(i),[4,this.renderStack(r)];case 1:return n.sent(),this.applyEffects([]),[2,this.canvas]}})})},e})(Bke),fPt=function(t){return t instanceof Ake||t instanceof mke?!0:t instanceof eJ&&t.type!==EO&&t.type!==CO},hPt=function(t,e){switch(t){case 0:return RO(e);case 2:return K0t(e);default:return MO(e)}},mPt=function(t){switch(t){case 1:return"center";case 2:return"right";default:return"left"}},APt=["-apple-system","system-ui"],gPt=function(t){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?t.filter(function(e){return APt.indexOf(e)===-1}):t},vPt=(function(t){Kh(e,t);function e(i,r){var n=t.call(this,i,r)||this;return n.canvas=r.canvas?r.canvas:document.createElement("canvas"),n.ctx=n.canvas.getContext("2d"),n.options=r,n.canvas.width=Math.floor(r.width*r.scale),n.canvas.height=Math.floor(r.height*r.scale),n.canvas.style.width=r.width+"px",n.canvas.style.height=r.height+"px",n.ctx.scale(n.options.scale,n.options.scale),n.ctx.translate(-r.x,-r.y),n.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+r.width+"x"+r.height+" at "+r.x+","+r.y+") with scale "+r.scale),n}return e.prototype.render=function(i){return Kc(this,void 0,void 0,function(){var r,n;return Ac(this,function(a){switch(a.label){case 0:return r=uz(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,i),[4,yPt(r)];case 1:return n=a.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=cl(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},e})(Bke),yPt=function(t){return new Promise(function(e,i){var r=new Image;r.onload=function(){e(r)},r.onerror=i,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(t))})},bPt=(function(){function t(e){var i=e.id,r=e.enabled;this.id=i,this.enabled=r,this.start=Date.now()}return t.prototype.debug=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,OB([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},t.prototype.getTime=function(){return Date.now()-this.start},t.prototype.info=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,OB([this.id,this.getTime()+"ms"],e))},t.prototype.warn=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,OB([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},t.prototype.error=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,OB([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},t.instances={},t})(),IPt=(function(){function t(e,i){var r;this.windowBounds=i,this.instanceName="#"+t.instanceCount++,this.logger=new bPt({id:this.instanceName,enabled:e.logging}),this.cache=(r=e.cache)!==null&&r!==void 0?r:new H0t(this,e)}return t.instanceCount=1,t})(),wPt=function(t,e){return e===void 0&&(e={}),SPt(t,e)};typeof window<"u"&&Eke.setContext(window);var SPt=function(t,e){return Kc(void 0,void 0,void 0,function(){var i,r,n,a,s,o,l,c,u,d,p,f,h,m,A,g,v,b,y,I,S,w,S,T,D,C,E,P,R,M,N,k,O,x,F,_,V,G,z,Q;return Ac(this,function(j){switch(j.label){case 0:if(!t||typeof t!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(i=t.ownerDocument,!i)throw new Error("Element is not attached to a Document");if(r=i.defaultView,!r)throw new Error("Document is not attached to a Window");return n={allowTaint:(T=e.allowTaint)!==null&&T!==void 0?T:!1,imageTimeout:(D=e.imageTimeout)!==null&&D!==void 0?D:15e3,proxy:e.proxy,useCORS:(C=e.useCORS)!==null&&C!==void 0?C:!1},a=K3({logging:(E=e.logging)!==null&&E!==void 0?E:!0,cache:e.cache},n),s={windowWidth:(P=e.windowWidth)!==null&&P!==void 0?P:r.innerWidth,windowHeight:(R=e.windowHeight)!==null&&R!==void 0?R:r.innerHeight,scrollX:(M=e.scrollX)!==null&&M!==void 0?M:r.pageXOffset,scrollY:(N=e.scrollY)!==null&&N!==void 0?N:r.pageYOffset},o=new kg(s.scrollX,s.scrollY,s.windowWidth,s.windowHeight),l=new IPt(a,o),c=(k=e.foreignObjectRendering)!==null&&k!==void 0?k:!1,u={allowTaint:(O=e.allowTaint)!==null&&O!==void 0?O:!1,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:c,copyStyles:c},l.logger.debug("Starting document clone with size "+o.width+"x"+o.height+" scrolled to "+-o.left+","+-o.top),d=new Toe(l,t,u),p=d.clonedReferenceElement,p?[4,d.toIFrame(i,o)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return f=j.sent(),h=tJ(p)||U0t(p)?eTt(p.ownerDocument):QH(l,p),m=h.width,A=h.height,g=h.left,v=h.top,b=UPt(l,p,e.backgroundColor),y={canvas:e.canvas,backgroundColor:b,scale:(F=(x=e.scale)!==null&&x!==void 0?x:r.devicePixelRatio)!==null&&F!==void 0?F:1,x:((_=e.x)!==null&&_!==void 0?_:0)+g,y:((V=e.y)!==null&&V!==void 0?V:0)+v,width:(G=e.width)!==null&&G!==void 0?G:Math.ceil(m),height:(z=e.height)!==null&&z!==void 0?z:Math.ceil(A)},c?(l.logger.debug("Document cloned, using foreign object rendering"),S=new vPt(l,y),[4,S.render(p)]):[3,3];case 2:return I=j.sent(),[3,5];case 3:return l.logger.debug("Document cloned, element located at "+g+","+v+" with size "+m+"x"+A+" using computed rendering"),l.logger.debug("Starting DOM parsing"),w=yke(l,p),b===w.styles.backgroundColor&&(w.styles.backgroundColor=cg.TRANSPARENT),l.logger.debug("Starting renderer for element at "+y.x+","+y.y+" with size "+y.width+"x"+y.height),S=new pPt(l,y),[4,S.render(w)];case 4:I=j.sent(),j.label=5;case 5:return(!((Q=e.removeContainer)!==null&&Q!==void 0)||Q)&&(Toe.destroy(f)||l.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),l.logger.debug("Finished rendering"),[2,I]}})})},UPt=function(t,e,i){var r=e.ownerDocument,n=r.documentElement?O0(t,getComputedStyle(r.documentElement).backgroundColor):cg.TRANSPARENT,a=r.body?O0(t,getComputedStyle(r.body).backgroundColor):cg.TRANSPARENT,s=typeof i=="string"?O0(t,i):i===null?cg.TRANSPARENT:4294967295;return e===r.documentElement?py(n)?py(a)?s:a:n:s};async function TPt(t){const{drawId:e,structureId:i,width:r=2e3}=t,a=Ge.allDrawMatchUps({drawId:e,inContext:!0,matchUpFilters:i?{structureIds:[i]}:void 0})?.matchUps||[];if(a.length===0)throw new Error("No matchUps found for draw");const s=wc?.tableView||wc?.gridView||wc?.[Object.keys(wc||{})[0]],o=document.createElement("div");o.style.position="absolute",o.style.top="-99999px",o.style.left="-99999px",o.style.width=`${r}px`,o.style.backgroundColor="white",document.body.appendChild(o);try{const l={roundClick:()=>{},scheduleClick:()=>{},venueClick:()=>{},participantClick:()=>{},matchUpClick:()=>{}};if(!s)throw new Error("No composition available. compositions object may not be loaded.");const c=jX({content:QX({context:{drawId:e,structureId:i},matchUps:a,composition:s,searchActive:!1,eventHandlers:l,selectedMatchUpId:void 0,structureId:i,finalColumn:void 0,minWidth:void 0}),theme:s.theme});o.appendChild(c),await new Promise(g=>setTimeout(g,100));const u=o.querySelector('.c-iZKoSQ, [class*="c-"]');u&&(u.style.overflow="visible !important",u.style.height="auto !important",u.style.maxHeight="none !important"),o.querySelectorAll("*").forEach(g=>{const v=window.getComputedStyle(g);v.overflow!=="visible"&&(g.style.overflow="visible"),v.maxHeight!=="none"&&(g.style.maxHeight="none")}),await new Promise(g=>setTimeout(g,500));const p=o.firstElementChild,f=p?p.scrollHeight:o.scrollHeight,h=p?p.offsetWidth:o.offsetWidth;return(await wPt(o,{backgroundColor:"#ffffff",scale:2,logging:!1,useCORS:!0,allowTaint:!0,width:h,height:f,windowWidth:h,windowHeight:f})).toDataURL("image/png")}finally{document.body.removeChild(o)}}function CPt(t,e){try{return(Ge.allDrawMatchUps({drawId:t,matchUpFilters:e?{structureIds:[e]}:void 0})?.matchUps?.length||0)>0}catch{return!1}}async function Roe({tournament:t,event:e,drawDefinition:i,structureId:r,options:n={},action:a="download"}){const{drawTitle:s=i.drawName||e.eventName,includeSeeding:o=!0,includeRankings:l=!0,includeTimestamp:c=!0,includeOrganizers:u=!0}=n;let d;if(CPt(i.drawId,r))try{d=await TPt({drawId:i.drawId,structureId:r,width:1600,height:1e4})}catch(h){console.error("Error rendering draw to PNG:",h)}const f={pageSize:"LETTER",pageOrientation:"portrait",pageMargins:[20,40,20,40],content:[{columns:[{width:"*",stack:[{text:t?.tournamentName||e.eventName||"Tournament",style:"tournamentName"},{text:JUt(t?.startDate||e.startDate||new Date),style:"tournamentDate"}]},{width:80,text:""}]},{text:s,style:"drawTitle",alignment:"center",margin:[0,10,0,20]},{text:[{text:"Event: ",bold:!0},{text:e.eventName||""},{text:" | Category: ",bold:!0},{text:e.category?.categoryName||""},{text:" | Draw Size: ",bold:!0},{text:i.drawSize||""}],fontSize:9,margin:[0,5,0,10]},...d?[{image:d,width:550,alignment:"center",margin:[0,10,0,10]}]:[{text:"[Draw Bracket]",alignment:"center",fontSize:14,italics:!0,color:"#999",margin:[0,40,0,40]},{text:"Unable to render draw bracket. Ensure draw has participants and matches.",alignment:"center",fontSize:10,color:"#666",margin:[0,0,0,40]}],...o?EPt():[],...c?[{text:`Generated: ${new Date().toLocaleString()}`,fontSize:8,color:"#666",margin:[0,20,0,0]}]:[],...u&&t?.organizers?[{text:`Organizers: ${t.organizers}`,fontSize:8,color:"#666"}]:[]],styles:{tournamentName:{fontSize:16,bold:!0},tournamentDate:{fontSize:10,color:"#666"},drawTitle:{fontSize:18,bold:!0},label:{fontSize:10,bold:!0,color:"#666"},value:{fontSize:10},sectionHeader:{fontSize:12,bold:!0,margin:[0,10,0,5]},seededPlayer:{fontSize:9}}};if(a==="open")await FNe({docDefinition:f});else{const h=`${s.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.pdf`;await LNe({docDefinition:f,filename:h})}}function EPt(t,e){return[{text:"Seeded Players",style:"sectionHeader"},{text:"Seeded players list will be populated from draw data.",fontSize:9,italics:!0,color:"#999",margin:[0,5,0,0]}]}function DPt({drawId:t,eventId:e,structureId:i}){const n=Ge.getTournamentInfo()?.tournamentInfo,s=Ge.getEvent({eventId:e})?.event;let o;if(s?.drawDefinitions?o=s.drawDefinitions.find(f=>f.drawId===t):o=Ge.findDrawDefinition({drawId:t})?.drawDefinition,!s||!o)return;let l=o.drawName||s.eventName;if(i){const f=o.structures?.find(h=>h.structureId===i);f?.structureName&&(l=f.structureName)}let c={drawTitle:l,includeSeeding:!0,includeRankings:!0,includeTimestamp:!0,includeOrganizers:!0};const u=[{label:"Draw Title",field:"drawTitle",value:c.drawTitle,placeholder:"Enter draw title"},{text:"Options",class:"itemTitle"},{label:"Include seeding",field:"includeSeeding",checkbox:!0,checked:c.includeSeeding},{label:"Include rankings",field:"includeRankings",checkbox:!0,checked:c.includeRankings},{label:"Include timestamp",field:"includeTimestamp",checkbox:!0,checked:c.includeTimestamp},{label:"Include organizers",field:"includeOrganizers",checkbox:!0,checked:c.includeOrganizers}],d=document.createElement("div");d.style.padding="1em",Sr(d,u),d.addEventListener("change",f=>{const h=f.target,m=h.getAttribute("field");m&&(h.type==="checkbox"?c[m]=h.checked:c[m]=h.value)}),Jr({title:"Print Draw",content:d,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"View",intent:"is-info",onClick:async()=>{try{await Roe({tournament:n,event:s,drawDefinition:o,structureId:i,options:c,action:"open"})}catch{alert("Failed to generate PDF.")}},close:!0},{label:"Download",intent:"is-primary",onClick:async()=>{try{await Roe({tournament:n,event:s,drawDefinition:o,structureId:i,options:c,action:"download"})}catch{alert("Failed to generate PDF.")}},close:!0}]})}const{POLICY_TYPE_SCORING:PPt}=Gg,{MAIN:RPt}=Wn,{TEAM:RQ}=Ul;function MPt({structureName:t,dualMatchUp:e,structureId:i,eventData:r,drawData:n,drawId:a}){const s=n.structures?.find(A=>A.stage===WR),o=n.structures?.find(A=>A.structureId===i),l=r.eventInfo.eventId,u=Ge.findPolicy({policyType:PPt,eventId:l})?.requireParticipantsForScoring,d=o?.roundMatchUps?Object.values(o.roundMatchUps).flat().some(A=>Ge.checkScoreHasValue(A)):!1,p=u&&d,f=o?.stage===RPt&&o?.stageSequence===1,h=()=>{const A=e.matchUpId,g=Ge.findMatchUp({drawId:a,matchUpId:A})?.matchUp,v=$H({matchUp:g}),b=document.getElementById(df);fo(b),b.appendChild(v)},m=[{hide:!f||p||r.eventInfo.eventType===RQ,onClick:()=>zUt({drawId:a,eventId:l,structureId:i}),label:"Assign participants",close:!0},{hide:r.eventInfo.eventType!==RQ,onClick:()=>XNe({matchUpId:e.matchUpId,structureId:i,eventId:l,drawId:a,callback:h}),label:"Edit scorecard",close:!0},{hide:r.eventInfo.eventType===RQ,onClick:()=>XUt({structureId:i,drawId:a}),label:`Edit ${t} scoring`,close:!0},{hide:o?.stage==="MAIN"&&o.stageSequence===1&&!s,onClick:()=>ZUt({drawId:a,eventId:l,structureId:i}),label:"Remove structure",close:!0},{hide:!$t.pdfPrinting,onClick:()=>DPt({drawId:a,eventId:l,structureId:i}),label:"Print draw",close:!0},{onClick:()=>GH({eventData:r,drawIds:[a]}),label:"Delete draw"},{onClick:()=>YUt({eventData:r,drawIds:[a]}),label:"Reset draw"}];if(e){const A=e.matchUpId;m.push({divider:!0});const g=w=>w.success&&h(),b={label:"Remove players",onClick:()=>{Ge.findMatchUp({matchUpId:A,drawId:a}).matchUp.tieMatchUps?.some(Ge.checkScoreHasValue)?Pt({message:"Cannot remove when scores are present",intent:"is-warning",pauseOnHover:!0}):Nt({methods:[{params:{drawId:a,matchUpId:A,inheritance:!1},method:sMe}],callback:g})},close:!0};m.push(b);const I={label:"Clear results",onClick:()=>{Nt({methods:[{params:{drawId:a,matchUpId:A},method:oMe}],callback:g})},close:!0};m.push(I)}return m}function NPt({eventData:t}){const e=t.drawsData.map(({drawId:o,drawName:l})=>({label:l,checkbox:!0,field:o,id:o}));let i;const r=()=>{const o=t.drawsData.filter(({drawId:l})=>i[l]?.checked).map(({drawId:l})=>l);setTimeout(()=>GH({eventData:t,drawIds:o}),200)},n=()=>{const o=t.drawsData.filter(({drawId:c})=>i[c]?.checked).length,l=document.getElementById("deleteSelected");l&&(l.disabled=!o)},a=t.drawsData.map(({drawId:o})=>({onChange:n,control:o}));Jr({title:"Delete flights",content:o=>i=Sr(o,e,a),buttons:[{label:"Cancel",intent:jt,close:!0},{label:"Delete",id:"deleteSelected",intent:"is-danger",disabled:!0,close:!0,onClick:r}]})}function BPt({eventData:t,drawId:e}){const i=()=>{const s=o=>{if(o.drawDefinition){const l=o.drawDefinition.structures?.[0]?.structureId,c=t.eventInfo.eventId,u=o.drawDefinition.drawId;_n({eventId:c,drawId:u,structureId:l,renderDraw:!0})}};mw({eventId:t.eventInfo.eventId,callback:s})},r=()=>NPt({eventData:t}),n=t.drawsData.length>1&&{onClick:r,label:"Delete flights",modifyLabel:!1,close:!0},a=t.drawsData.length&&{onClick:()=>_n({eventId:t.eventInfo.eventId,drawId:e}),label:"View entries",modifyLabel:!1,close:!0};return t.drawsData.map(s=>({onClick:()=>{const o=s.structures?.[0]?.structureId,l=t.eventInfo.eventId,c=s.drawId;_n({eventId:l,drawId:c,structureId:o,renderDraw:!0})},label:s.drawName,close:!0})).concat([{divider:!0},a,n,{label:"Add flight",modifyLabel:!1,onClick:i}]).filter(Boolean)}function kPt(){return{eventOptions:(Ge.getEvents().events??[]).map(i=>({onClick:()=>{const r=Ge.getEventData({eventId:i.eventId});if(!r?.eventData?.drawsData?.length)_n({eventId:i.eventId});else{const n=r.eventData.drawsData?.[0]?.drawId;_n({eventId:r.eventData.eventInfo.eventId,drawId:n,renderDraw:!0})}},label:i.eventName,close:!0})).concat([{divider:!0},{label:`<div style='font-weight: bold'>${yg}</div>`,onClick:gBe,close:!0}])}}const{TEAM:xPt}=Ul;function kke({updateParticipantFilter:t,updateControlBar:e,structureId:i,eventData:r,matchUps:n,eventId:a,drawId:s}){const{eventOptions:o}=kPt(),l=BPt({eventData:r,drawId:s}),c=r?.drawsData?.find(h=>h.drawId===s),u=c?.structures?.find(h=>h.structureId===i)?.structureName,d=n?.length===1&&r.eventInfo.eventType===xPt,p=rUt({updateControlBar:e,structureId:i,drawData:c,eventId:a}),f=MPt({dualMatchUp:d&&n[0],structureName:u,structureId:i,eventData:r,drawData:c,drawId:s});return[{onKeyDown:h=>h.key==="Backspace"&&h.target.value.length===1&&t(""),onChange:h=>t(h.target.value),onKeyUp:h=>t(h.target.value),clearSearch:()=>t(""),placeholder:"Participant name",location:ii,search:!0},{options:o.length>1?o:void 0,label:r.eventInfo.eventName,modifyLabel:!0,location:ii},{options:l.length>1?l:void 0,label:c.drawName,modifyLabel:!0,location:ii},{options:p.length>1?p:void 0,label:u,modifyLabel:!0,location:ii},{options:f,intent:"is-info",label:"Actions",location:Ht,align:Ht}]}function iJ({eventId:t,drawId:e,structureId:i,updateDisplay:r}){const n=Ge.getEventData({eventId:t}).eventData,s=n?.drawsData?.find(m=>m.drawId===e)?.structures||[];i=i||s?.[0]?.structureId;const o=s.find(m=>m.structureId===i),{roundMatchUps:l}=Ri.makeDeepCopy(o||{}),c=Object.values(l||{}).flat();let u;const d=m=>m.searchText?.includes(u),f=kke({updateControlBar:iJ,updateParticipantFilter:m=>{m||Object.values(ot.tables).filter(Boolean).forEach(A=>A.clearFilter()),u=m?.toLowerCase(),m&&Object.values(ot.tables).filter(Boolean).forEach(A=>A.addFilter(d)),typeof r=="function"&&r({participantFilter:u})},structureId:i,eventData:n,matchUps:c,eventId:t,drawId:e}),h=document.getElementById(sE)||void 0;eo({target:h,items:f})}function _Pt(t,e){const i=e>1?"items":"item";return t+`<span style='color:blue; margin-left:10px;'>(${e} ${i})</span>`}const{TEAM:OPt}=io,FPt=t=>(e,i)=>{const n=i.getRow().getData(),{matchUpId:a,readyToScore:s,matchUpType:o,drawId:l,eventName:c}=n.matchUp;if(o===OPt)LH({title:c,matchUpId:a,drawId:l,onClose:()=>t()});else if(s||ry.checkScoreHasValue(n.matchUp)){const u=()=>{t()};MN({matchUp:n.matchUp,matchUpId:a,callback:u})}};function LPt({data:t,replaceTableData:e}){const i=(o,l)=>{const u=l.getRow().getData(),{courtName:d,scheduledDate:p}=u;if(d&&p){const f=Ge.getTournament()?.tournamentRecord?.tournamentId,h=`/${js}/${f}/${Ny}/${p}`;ot.router.navigate(h)}},r=()=>e(),n=t.some(o=>o.courtName),a=(o,l)=>h1(o,l,r),s=o=>{const l=document.createElement("div");l.className="has-text-warning-dark",l.innerHTML="Select participant";const c=({event:d,...p})=>{h1(d,o,r,p)};return o.getValue().participantName&&Bb(c)(o,l)};return[{cellClick:(o,l)=>l.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ii,width:5},{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:si,minWidth:50,width:50},{headerMenu:TA({duration:"Duration",complete:"Complete"}),formatter:"rownum",headerSort:!1,hozAlign:ii,width:55},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{cellClick:i,field:"scheduledDate",title:"Date",width:110},{cellClick:i,visible:!!n,field:"courtName",title:"Court",width:100},{cellClick:i,field:"scheduleTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:s,cellClick:a,sorter:AC,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:s,cellClick:a,sorter:AC,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{cellClick:FPt(e),formatter:LZ,sorter:eBe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:VNe,formatter:GNe,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:ii,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70},{cellClick:(o,l)=>$Z({pointerEvent:o,...l.getData()}),formatter:dv,responsive:!1,headerSort:!1,hozAlign:Ht,widthGrow:0,width:50}]}const{TEAM:$Pt}=Ul,Moe=t=>{const{potentialParticipants:e,structureName:i,matchUpType:r,roundNumber:n,matchUpId:a,roundName:s,schedule:o,eventId:l,drawId:c,sides:u,...d}=t,{scheduledDate:p,scheduleTime:f,courtName:h}=o||{},m=N=>N.person?.standardFamilyName||N.participantName,A=e?.map(N=>({participantName:N.map(m).filter(Boolean).join(" or ")}))||[],g=u?.[0]?.participant||A.shift(),v=u?.[1]?.participant||A.shift(),b={participantName:g?.participantName,sex:g?.person?.sex,participant:g},y={participantName:v?.participantName,sex:v?.person?.sex,participant:v},I=u.flatMap(({participant:N})=>N?.individualParticipantIds?.length?N.individualParticipantIds:N?.participantId).filter(Boolean),w=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,S=!!d.winningSide,T=!!(d.winningSide||d.readyToScore),D=d.score?.scoreStringSide1,C=u.flatMap(N=>{const k=N.participant?.person;return k?[k.standardGivenName,k.standardFamilyName]:N.participant?.individualParticipants?.map(({person:O})=>[O.standardGivenName,O.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),E=TNe([C,g?.participantName,v?.participantName].filter(Boolean).join(" ")).toLowerCase(),P=t.collectionId?$Pt:r,R=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,M={score:D,matchUpStatus:t.matchUpStatus,readyToScore:T,complete:S,winningSide:w};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:I,flight:t.drawName,competitiveProfile:R,structureName:i,scheduledDate:p,readyToScore:T,scheduleTime:f,matchUpType:r,scoreDetail:M,winningSide:w,roundNumber:n,searchText:E,courtName:h,eventType:P,matchUpId:a,roundName:s,complete:S,eventId:l,matchUp:t,drawId:c,side1:b,side2:y,score:D}},{CONTAINER:HPt}=Wn;async function xke({eventId:t,drawId:e,structureId:i,matchUps:r,eventData:n}){let a,s,o,l=!1;const c=()=>{const v={withISO2:!0,withScaleValues:!0},b={withCompetitiveness:!0};s=Ge.getEventData({eventId:t,contextProfile:b,participantsProfile:v}).eventData?.drawsData?.find(T=>T.drawId===e)?.structures?.find(T=>T.structureId===i),l=s?.structureType===HPt;const w=s?.roundMatchUps?Object.values(s?.roundMatchUps||{}).flat():[],S=w.flatMap(T=>T.tieMatchUps||[]);return S.length&&w.push(...S),w.filter(({matchUpStatus:T})=>T!=="BYE").filter(({sides:T})=>!o||T.find(D=>D.participant?.participantName?.toLowerCase().includes(o?.toLowerCase())))};r||(r=c()),n&&r.forEach(v=>v.eventName=n.eventInfo.eventName);const u=()=>r?.map(Moe),d=()=>c().map(Moe),p=v=>{v?.participantFilter&&(o=v.participantFilter),a.replaceData(d())},f=u(),h=LPt({data:f,replaceTableData:p}),m=l?["roundName","structureName"]:["roundName"];return(v=>{UA({anchorId:df});const b=document.getElementById(df);a=new es(b,{groupHeader:[_Pt,y=>y],headerSortElement:kf(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:m,columns:h,data:v})})(f),qZ({structure:s,drawId:e,existingView:kT,callback:({refresh:v,view:b}={})=>{HH(),b?_n({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:b}):vC({eventId:t,drawId:e,structureId:i,redraw:v,roundsView:b})}}),iJ({eventId:t,drawId:e,structureId:i,updateDisplay:p}),{table:a,replaceTableData:p}}function sk({eventId:t,renderDraw:e}={}){const i=document.getElementById(Tbe),r=document.getElementById(wbe),n=document.getElementById(df),a=document.getElementById(Cbe);a&&(a.style.display=t||e?"":jt),i&&(i.style.display=t&&!e?"":jt),r&&(r.style.display=t||e?jt:""),n&&(n.style.display=e?"":jt)}function VPt({eventId:t,drawId:e,headerElement:i}){const{event:r,drawDefinition:n}=Ge.getEvent({eventId:t,drawId:e});return r&&n?(i.innerHTML=r.eventName,{success:!0}):{}}const{WITHDRAWN:GPt}=Iu,gz=t=>({drawDefinition:e,scaleValues:i})=>{const{drawId:r,drawName:n,drawType:a,entries:s,matchUpFormat:o,tieFormat:l,structures:c,flightNumber:u}=e,p=Ge.getPublishState({drawId:r}).publishState?.status?.published,f=s?.filter(({entryStatus:A})=>A!==GPt)?.length,m=(Ge.getAssignedParticipantIds({drawDefinition:e}).assignedParticipantIds?.filter(Boolean)?.length||f)??0;return{utrAvg:i?.ratingsStats?.UTR?.avg,wtnAvg:i?.ratingsStats?.WTN?.avg,generated:c?.length>0,entries:m,matchUpFormat:o,flightNumber:u,tieFormat:l,published:p,drawName:n,drawType:a,eventId:t,drawId:r}},{MAIN:Noe}=Wn;function _ke({lightMode:t=!1,scaleValues:e,event:i}){const{drawDefinitions:r=[],eventName:n,entries:a,eventId:s,extensions:o}=i,l=[];o?.find(v=>v.name===th.FLIGHT_PROFILE)?.value?.flights?.forEach(v=>{const b=r.find(y=>y.drawId===v.drawId);b?b.flightNumber=v.flightNumber:l.push({flightNumber:v.flightNumber,entries:v.drawEntries,drawName:v.drawName,drawId:v.drawId})});const u=ZL.getPublishState({event:i}).publishState,d=r.length,p=a.filter(({entryStage:v=Noe,entryStatus:b})=>yO(Noe).includes(`${v}.${b}`))?.length||0;let f=0,h=0,m=0,A=[];if(!t){const v=Ge.allEventMatchUps({inContext:!0,eventId:s}).matchUps;f=v?.length||0,h=v?.filter(({winningSide:b,schedule:y})=>!b&&y?.scheduledTime)?.length||0,m=v.filter(({winningSide:b})=>b)?.length||0,A=[...r,...l].map(b=>gz(s)({drawDefinition:b,scaleValues:e?.draws?.[b.drawId]}))}const g=[n].concat([...r,...l].map(({drawName:v})=>v||"")).join(" ").toLowerCase();return{published:u?.status.published,scheduledMatchUpsCount:h,completedMatchUpsCount:m,matchUpsCount:f,entriesCount:p,drawsCount:d,searchText:g,drawDefs:A,eventId:s,event:i}}const{SINGLES:QPt}=Yz;function jPt({eventId:t,callback:e}){const i=Ge.getEvent({eventId:t}).event;Eot({callback:n=>{const a={eventType:i.eventType||QPt,...n.scaleAttributes},s={uuids:Ri.UUIDS(n.flightsCount),flightsCount:n.flightsCount,splitMethod:n.splitMethod,drawNames:n.drawNames,scaleAttributes:a,eventId:t},o=Ge.generateFlightProfile(s);if(o.success){const l={name:Qn.extensionConstants.FLIGHT_PROFILE,value:o.flightProfile};Nt({methods:[{method:ZRe,params:{eventId:t,extension:l}}],callback:p=>{p.success?(Pt({message:"Flights generated",intent:"is-success"}),Mt(e)&&e({generated:!0,result:o})):(Pt({message:"Flight profile generation failed",intent:"is-danger"}),Mt(e)&&e({generated:!1,result:p}))}})}else Mt(e)&&e({generated:!1,result:o})}})}function Oke({eventRow:t,drawsTable:e,drawIds:i}){e.deleteRow(i);const r=t?.getData();if(r){const n=Ge.allEventMatchUps({eventId:r.eventId,inContext:!1}).matchUps;r.drawDefs=r.drawDefs.filter(a=>!i.includes(a.drawId)),r.matchUpsCount=n?.length||0,r.drawsCount-=i.length}}const Fke=t=>(e,i)=>{const r=i.getRow().getData(),n=r.published?[r.drawId]:void 0,a=r.published?void 0:[r.drawId],o=[{method:nMe,params:{eventId:r.eventId,drawIdsToRemove:n,drawIdsToAdd:a,eventDataParams:{participantsProfile:{withScaleValues:!0},pressureRating:!0,refreshResults:!0}}}];Nt({methods:o,callback:c=>{if(c?.success){i.getRow().update({published:!r.published});const u=t.getData().eventId,p=Ge.getPublishState({eventId:u}).publishState?.status?.published;t.update({published:p})}else Pt({message:c.error.message,intent:"is-danger"})}})},Lke=t=>t.getValue()?'<i class="fa-solid fa-eye" style="color: blue">':'<i class="fa-solid fa-eye-slash" style="color: red">';function $ke(t){const{eventId:e,drawId:i,callback:r}=t,n=Ge.findExtension({name:th.DISPLAY,discover:!0,eventId:e,drawId:i}).extension?.value,a=n?.admin??n,s=new Set(["Wimbledon","French","ITF"]),o="saveDisplaySettings",l={compositionName:a?.compositionName??$t.composition?.compositionName??"Australian",configuration:a?.configuration??{},composition:void 0,inputs:void 0},c=Ri.dateTime.extractDate(new Date().toISOString()),u="drawId",p=[{onlineResources:[{link:"https://www.google.com",label:"Google"}],venueName:"Club Courts",venueAbbreviation:"CC",startTime:"08:00",endTime:"20:00",courtsCount:6,venueId:"venueId"}],f=[{eventName:"WTN 14-19 SINGLES",category:{ratingType:"WTN",ratingMin:14,ratingMax:19.99},drawId:u,generate:!0,drawSize:4}],h=[{scheduleDate:c,venues:[{rounds:[{drawId:u,winnerFinishingPositionRange:"1-2"}],venueId:p[0].venueId}]}],m={withScaleValues:!0},A=r2.generateTournamentRecord({scheduleCompletedMatchUps:!0,completeAllMatchUps:!0,participantsProfile:m,autoSchedule:!0,schedulingProfile:h,venueProfiles:p,drawProfiles:f,startDate:c}).tournamentRecord,v=NR.allTournamentMatchUps({tournamentRecord:A}).matchUps.find(M=>M.matchUpType==="SINGLES"),b=document.createElement("div");b.style.maxWidth="500px";const y=document.createElement("div");b.appendChild(y);const I=({compositionName:M,configuration:N})=>{fo(y),l.composition=wc[M],l.composition.configuration.flags=void 0,Object.assign(l.composition.configuration,N),l.composition.genderColor=!0,l.composition.compositionName=M;const k=bN({isLucky:!0,composition:l.composition,matchUp:v});y.appendChild(k)};I(l);const w=Object.keys(wc).filter(M=>M!=="Night").map(M=>({selected:M===l.compositionName,label:M,value:M})),S=l.configuration.participantDetail,T=[{label:"None",value:"NONE",selected:!S},{label:"Address",value:"ADDRESS",selected:S==="ADDRESS"},{label:"Team",value:"TEAM",selected:S==="TEAM"}],D=()=>{l.compositionName=l.inputs.composition.value,l.configuration.scheduleInfo=!s.has(l.compositionName)&&l.inputs.showSchedule.checked,l.configuration.participantDetail=l.inputs.detail.value,I(l)},C=[{options:w,label:"Composition",field:"composition",onChange:D},{controlVisible:!s.has(l.compositionName),checked:l.configuration.scheduleInfo,controlId:"scheduleToggle",label:"Show Schedule",field:"showSchedule",id:"showSchedule",checkbox:!0,onChange:D},{options:T,label:"Detail",field:"detail",onChange:D}],E=document.createElement("div");b.appendChild(E);const P=[{onChange:({e:M})=>{const N=!s.has(M.target.value),k=document.getElementById("scheduleToggle");k&&(k.style.display=N?"block":jt)},control:"composition"}];l.inputs=Sr(E,C,P),Jr({title:"Edit display settings",buttons:[{label:"Cancel",intent:jt,close:!0},{label:"Save",id:o,intent:"is-info",close:!0,onClick:()=>{const M=()=>{console.log("Mutation completed")},k={value:{...Ge.findExtension({name:th.DISPLAY,discover:!0,eventId:e,drawId:i})?.extension?.value,compositionName:l.composition.compositionName,configuration:l.configuration},name:th.DISPLAY};Nt({methods:[{method:i?Out:ZRe,params:{eventId:e,drawId:i,extension:k}}],callback:M}),Mt(r)&&r(l.composition),$t.composition=l.composition}}],content:b})}const zPt=t=>(e,i)=>{const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(f=>f.remove());return}const n=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],s=i.getRow()?.getData(),{published:o,drawId:l,eventId:c}=s;nl({items:[{onClick:()=>$ke({drawId:s.drawId}),text:"Display settings"},{text:o?"Unpublish":"Publish",onClick:()=>{Fke(t)(e,i)}},{onClick:()=>{GH({eventId:c,drawIds:[l],callback:h=>{h.success||h.error?.message&&Pt({message:h.error.message,intent:"is-danger"}),Oke({eventRow:t,drawsTable:i.getTable(),drawIds:[l]})}})},text:"Delete"},{text:"Edit"}],target:n||e.target,config:{placement:wd}})},{QUALIFYING:Boe}=Wn,qPt=(t,e,i)=>{const r={ranking:"Seed by ranking","ratings.wtn":"Seed by WTN","ratings.utr":"Seed by UTR"},n=e===Boe?Boe:Qu,a=i.getColumns().map(o=>o.getDefinition()).filter(o=>["ratings.wtn","ratings.utr"].includes(o.field)),s=[{label:"Manual seeding",onClick:o=>SBe(o,i),close:!0},{label:"Clear seeding",onClick:()=>wBe({event:t,table:i}),close:!0}].concat(...a.map(o=>({onClick:()=>UBe({event:t,group:n,table:i,field:o.field}),label:r[o.field],value:o.field,close:!0})));return{class:"seedingOptions",label:"Seeding",selection:!1,location:Ht,align:Ht,options:s}},{WTN:MQ,UTR:NQ}=Qn.ratingConstants;function WPt({entries:t,exclude:e=[]}){const i=t.find(o=>o.ratings?.utr),r=t.find(o=>o.ratings?.wtn),n=t.find(o=>o.cityState),a=t.find(o=>o.seedNumber),s=t.find(o=>o.ranking);return[{formatter:"rownum",headerSort:!1,hozAlign:ii,width:55},{formatter:"responsiveCollapse",responsive:!1,headerSort:!1,hozAlign:si,width:50},{formatter:o=>Bb(void 0)(o,void 0,"sideBySide"),field:"participant",responsive:!1,minWidth:250,widthGrow:3,title:"Name"},{sorterParams:{alignEmptyValues:"bottom"},visible:!!s,sorter:"number",field:"ranking",title:"Rank",widthGrow:1,minWidth:80},{formatter:wO(MQ),sorter:bO(MQ),visible:!!r,field:"ratings.wtn",title:MQ,widthGrow:1,minWidth:80},{formatter:wO(NQ),sorter:bO(NQ),visible:!!i,field:"ratings.utr",title:NQ,widthGrow:1,minWidth:80},{visible:!!n,title:"City/State",field:"cityState",responsive:!1,minWidth:150,widthGrow:2},{editor:pO({maxValue:t?.length||0,decimals:!1,field:"seedNumber"}),sorterParams:{alignEmptyValues:"bottom"},visible:!!a,field:"seedNumber",hozAlign:si,sorter:"number",editable:!1,title:"Seed",maxWidth:70}].filter(({field:o})=>Array.isArray(e)&&!e?.includes(o||""))}function KPt({eventId:t,drawId:e,drawName:i,eventName:r}){const{event:n,drawDefinition:a}=Ge.getEvent({eventId:t,drawId:e});if(!n){console.error("Event not found",{eventId:t});return}const s=n?.extensions?.find(I=>I.name===th.FLIGHT_PROFILE)?.value,o=a||s?.flights?.find(I=>I.drawId===e);if(!o){console.error("Draw not found",{eventId:t,drawId:e});return}const l=o.stage||"MAIN",{participants:c,derivedDrawInfo:u}=Ge.getParticipants({participantFilters:{eventIds:[t]},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0,withISO2:!0})??{},d=o.entries||o.drawEntries||[],p=n.category?.categoryName??n.category?.ageCategoryCode,f=d.map(I=>NN({eventType:n.eventType,derivedDrawInfo:u,categoryName:p,participants:c,eventId:t,entry:I})).filter(I=>I.entryStatus!=="WITHDRAWN"),h=document.createElement("div");h.style.width="100%";const m=document.createElement("div");m.className="controlBar flexrow flexcenter",m.style.marginBottom="1em",h.appendChild(m);const A=document.createElement("div");A.className="tmxTable",A.style.width="100%",h.appendChild(A);const g=new es(A,{headerSortElement:kf(["ratings.utr","ratings.wtn","seedNumber","ranking","participant"]),columns:WPt({entries:f}),placeholder:"No entries in this draw",responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,height:"500px",data:f}),v=[{label:`${f.length} ${f.length===1?"Entry":"Entries"}`,class:"entriesCount",location:ii,stateDisplay:!0},qPt(n,l,g),j3(n),z3(n)];g.on("tableBuilt",()=>{const I=v.map(w=>Mt(w)?w(g):w);eo({target:m,table:g,items:I})});const b=(i||"Draw")+" Entries"+(r?" - "+r:""),y=()=>{g?.destroy()};pf.open({title:b,content:h,buttons:[{label:"Close",close:!0}],config:{maxWidth:1400},onClose:y})}const YPt=t=>(e,i)=>{const{eventId:r,eventName:n}=t.getData(),{drawId:a,drawName:s}=i.getRow().getData();KPt({eventName:n,eventId:r,drawName:s,drawId:a})};function XPt(t,e){const i=(s,o)=>{const l=o.getRow().getData(),{eventId:c,drawId:u,flightNumber:d}=l;mw({eventId:c,drawId:u,flightNumber:d,callback:f=>{f.success&&_n({eventId:c,drawId:f.drawDefinition?.drawId,renderDraw:!0})}})},r=(s,o)=>{s.stopPropagation();const l=o.getRow().getData(),{eventId:c,drawId:u,generated:d}=l;d?_n({eventId:c,drawId:u,renderDraw:!0}):i(s,o)},n=t.find(s=>s.utrAvg),a=t.find(s=>s.wtnAvg);return[{cellClick:(s,o)=>o.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ii,width:5},{headerMenu:TA({entries:"Entries",wtnAvg:"WTN avg",utrAvg:"UTR avg"}),headerSort:!1,formatter:"rownum",hozAlign:si,width:55},{title:'<i class="fa-solid fa-eye"></i>',cellClick:Fke(e),formatter:Lke,headerSort:!1,field:"published",width:55},{title:"Draw Name",field:XI,cellClick:r},{title:"Draw Type",field:Kf,cellClick:r},{title:"Flight",field:"flightNumber",width:70,headerSort:!1,hozAlign:si},{title:'<div class="event_icon opponents_header" />',cellClick:YPt(e),field:"entries",width:50},{visible:!!a,field:"wtnAvg",title:DP,width:80},{visible:!!n,field:"utrAvg",title:ZI,width:80},{cellClick:zPt(e),formatter:dv,responsive:!1,headerSort:!1,hozAlign:Ht}]}const ZPt=t=>e=>{const i=document.createElement("div"),r=document.createElement("div");r.className="tableControl",r.style.marginBottom="1em";const n=e.getData().drawDefs;i.appendChild(r);const a=document.createElement("div");a.style.backgroundColor="white";const s="1px solid #333";a.style.border=s,a.style.width="99%",i.style.borderBottom=s,i.style.boxSizing="border-box",i.style.borderTop=s,i.style.paddingLeft="10px",i.className=o2,i.style.display=jt,i.appendChild(a),e.getElement().appendChild(i);const o=XPt(n,e),l=new es(a,{headerSortElement:kf(["entries"]),placeholder:"No draws",layout:"fitColumns",index:"drawId",maxHeight:400,columns:o,data:n});l.on("scrollVertical",Kd);const c=e.getData().event,u=c.eventId;t(u,l);const d=()=>{const g=l.getSelectedData().map(({drawId:b})=>b);l.deselectRow(),GH({eventId:u,drawIds:g,callback:b=>{if(!b.success){b.error?.message&&Pt({message:b.error.message,intent:"is-danger"});return}Oke({eventRow:e,drawsTable:l,drawIds:g})}})},p=A=>{A.generated&&A.result?.flightProfile?.flights?.map(b=>({flightNumber:b.flightNumber,entries:b.drawEntries,drawName:b.drawName,drawId:b.drawId}))?.map(b=>gz(u)({drawDefinition:b}))?.forEach(b=>{l.updateOrAddData([b])})},f=A=>{if(A.success){l?.addRow(gz(u)({drawDefinition:A.drawDefinition}));const g=e?.getData();if(a.style.display="",g)if(g.matchUpsCount){const v=Ge.allDrawMatchUps({drawId:A.drawDefinition.drawId,inContext:!1,eventId:u}).matchUps;g.matchUpsCount+=v?.length||0,g.drawsCount+=1}else _n({eventId:u,drawId:A.drawDefinition?.drawId,renderDraw:!0})}},h=({success:A,eventUpdates:g})=>{if(A){const v=e?.getData();Object.assign(v.event,g),e.update(v)}};eo({table:l,target:r,items:[{onClick:d,label:"Delete selected",intent:"is-danger",stateChange:!0,location:sa},{onClick:()=>_n({eventId:u}),label:"View entries",intent:"is-info",location:ii},{onClick:()=>uBe({eventId:u}),id:"editAvoidances",label:"Avoidances",location:ii},{onClick:()=>FH({event:c,callback:h}),label:"Edit event",location:Ht},{onClick:()=>mw({eventId:u,callback:f}),intent:"is-primary",label:"Add draw",location:Ht},{onClick:()=>jPt({eventId:u,callback:p}),label:"Add flights",intent:"is-info",location:Ht}]})},Hke=t=>(e,i)=>{const r=i.getRow().getData(),n=r.eventId,a=!r.published,s=r.published?cdt:nMe;t.get(n).getRows().forEach(u=>u.update({published:a})),Nt({methods:[{method:s,params:{eventDataParams:{participantsProfile:{withScaleValues:!0},pressureRating:!0,refreshResults:!0},eventId:n}}],callback:u=>{u?.success?i.getRow().update({published:!r.published}):Pt({message:u.error.message,intent:"is-danger"})}})};function Vke(t){const{eventIds:e,callback:i}=t;if(VH()){Nt({methods:[{method:ene,params:{eventIds:e,auditData:{auditReason:"Reason skipped"}}}],callback:i});return}const r=e.length>1?"Delete Events":"Delete Event";let n;const a=()=>{const u={auditReason:n.eventDeletionReason.value};Nt({methods:[{method:ene,params:{eventIds:e,auditData:u}}],callback:i})},s=[{text:"Please provide a reason for event deletion."},{placeholder:"Explanation",field:"eventDeletionReason",validator:fi.wordValidator(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],l=[{control:"eventDeletionReason",onInput:({inputs:u})=>{const d=u.eventDeletionReason.value,p=fi.wordValidator(5)(d),f=document.getElementById("deleteEvent");f&&(f.disabled=!p)}}];Jr({title:r,content:u=>n=Sr(u,s,l),buttons:[{label:"Cancel",intent:jt,close:!0},{label:"Delete",id:"deleteEvent",disabled:!0,intent:"is-danger",close:!0,onClick:a}]})}const JPt=t=>(e,i)=>{const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(f=>f.remove());return}const n=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],a=i.getRow().getData(),s=i.getRow(),o=s?.getData(),l=o?.published,c=({success:f,eventUpdates:h})=>{f&&(Object.assign(o.event,h),s.update(o))};nl({items:[{onClick:()=>$ke({eventId:a.eventId}),text:"Display settings"},{text:l?"Unpublish":"Publish",onClick:()=>{Hke(t)(e,i)}},{onClick:()=>{const f=[a.eventId];return Vke({eventIds:f,callback:m=>{const A=i.getTable();m.success&&A?.deleteRow(f)}})},text:"Delete"},{onClick:()=>FH({event:a.event,callback:c}),text:"Edit"}],target:n||e.target,config:{placement:wd}})};function e1t(t,e){const i=typeof e=="function"?e():!1,r=(a,s)=>{a.stopPropagation();const o=s.getRow().getData().eventId;_n({eventId:o})},n=(a,s)=>{_I(a,s)};return[{cellClick:(a,s)=>s.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,hozAlign:ii,width:5},{headerMenu:TA({completedMatchUpsCount:"Completed MatchUps",scheduledMatchUpsCount:"Scheduled MatchUps",entriesCount:"Accepted entries",matchUpsCount:"Total matches",drawsCount:"Number of draws",published:"Published"}),formatter:"rownum",headerSort:!1,hozAlign:si,width:55},{title:'<i class="fa-solid fa-eye"></i>',cellClick:Hke(t),formatter:Lke,headerSort:!1,field:"published",width:55},{field:"event.eventName",cellClick:n,title:"Event",minWidth:200,visible:!0,widthGrow:3},{field:"event.eventType",title:"Type",visible:!0},{field:"event.gender",title:"Gender",visible:!0},{title:'<div class="event_icon drawsize_header" />',headerTooltip:"Number of Draws",cellClick:_I,headerHozAlign:si,field:"drawsCount",hozAlign:si,headerSort:!0,visible:!0,width:45},{title:'<div class="event_icon opponents_header" />',headerTooltip:"Accepted Entries",headerHozAlign:si,field:"entriesCount",cellClick:r,hozAlign:si,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon matches_header" />',headerTooltip:"Total MatchUps",headerHozAlign:si,field:"matchUpsCount",hozAlign:si,headerSort:!0,visible:!i,width:50},{title:'<div class="event_icon time_header" />',headerTooltip:"Scheduled MatchUps",field:"scheduledMatchUpsCount",headerHozAlign:si,hozAlign:si,headerSort:!0,visible:!i,width:50},{title:'<div class="event_icon rank_header" />',headerTooltip:"Completed MatchUps",field:"completedMatchUpsCount",headerHozAlign:si,hozAlign:si,headerSort:!0,visible:!i,width:50},{cellClick:_I,formatter:_Z,responsive:!1,headerSort:!1,hozAlign:Ht,field:"isOpen",width:20},{cellClick:JPt(t),formatter:dv,responsive:!1,headerSort:!1,hozAlign:Ht,width:20}]}const t1t=15;function i1t(){let t;const e=new Map,i=(u,d)=>{e.has(u)||e.set(u,d)},a=(Ge.getEvents({withScaleValues:!1})?.events?.length||0)>t1t,s=()=>{const u=Ge.getEvents({withScaleValues:!a});return u?.events?.map(d=>_ke({scaleValues:u.eventScaleValues?.[d.eventId],lightMode:a,event:d}))},o=()=>{t.replaceData(s())},l=e1t(e,()=>a);return(u=>{UA({anchorId:TP});const d=document.getElementById(TP),p=ac(d,"section")?.querySelector(".tabHeader");p?.innerHTML&&(p.innerHTML=`Events (${u.length})`),t=new es(d,{columnDefaults:{},headerSortElement:kf(["scheduledMatchUpsCount","completedMatchUpsCount","matchUpsCount","entriesCount","drawsCount"]),rowFormatter:ZPt(i),height:window.innerHeight*.8,placeholder:"No events",layout:"fitColumns",reactiveData:!0,index:"eventId",columns:l,data:u}),t.on("scrollVertical",Kd),t.on("dataChanged",f=>{p&&(p.innerHTML=`Events (${f.length})`)}),t.on("dataFiltered",(f,h)=>{p&&(p.innerHTML=`Events (${h.length})`)})})(s()),{table:t,replaceTableData:o}}function r1t(){const t=Ge.getPublishState().publishState?.tournament,{table:e}=i1t(),i=u=>{if(u?.event){const d=_ke({event:u.event});e?.updateOrAddData([d])}},r=DS(e),n=()=>{const u=e?.getSelectedData().map(({eventId:p})=>p);return Vke({eventIds:u,callback:p=>p.success&&e?.deleteRow(u)})},a=u=>u?"Unpublish":"Publish",s=u=>`${a(u)} OOP`,o=u=>{if(u?.success){const d=Ge.getPublishState().publishState?.tournament,p=document.getElementById("oopButton");p.innerText=s(d?.orderOfPlay?.published),p.classList.toggle("is-primary")}},l=[{onClick:n,label:"Delete selected",intent:"is-danger",stateChange:!0,location:sa},{onKeyDown:u=>u.key==="Backspace"&&u.target.value.length===1&&r(""),onChange:u=>r(u.target.value),onKeyUp:u=>r(u.target.value),clearSearch:()=>r(""),placeholder:"Search events",location:ii,search:!0},{onClick:()=>n1t(o),label:s(t?.orderOfPlay?.published),intent:t?.orderOfPlay?.published?"is-primary":"",id:"oopButton",location:Ht},{onClick:()=>FH({callback:i}),label:"Add event",location:Ht}],c=document.getElementById(J6)||void 0;eo({table:e,target:c,items:l})}function n1t(t){const n=[{method:Ge.getPublishState().publishState?.tournament?.orderOfPlay?.published?"unPublishOrderOfPlay":"publishOrderOfPlay"}];Nt({methods:n,callback:t})}function a1t(t){const{eventId:e,drawId:i,structureId:r,renderDraw:n,roundsView:a="roundsColumns"}=t;if(HZ(jf),kH(),HH(),e||i){const s=document.getElementById(TP),o=ac(s,"section")?.querySelector(".tabHeader");i&&n?VPt({eventId:e,drawId:i,headerElement:o}).success?(a===kT?xke({eventId:e,drawId:i,structureId:r}):a===BT?RBe({eventId:e,drawId:i,structureId:r}):vC({eventId:e,drawId:i,structureId:r,redraw:!0,roundsView:a}),sk({renderDraw:n})):(mse({eventId:e,drawId:i}),sk({eventId:e})):(mse({eventId:e,drawId:i,headerElement:o}),sk({eventId:e}))}else r1t(),sk({eventId:e})}function s1t({callback:t}={}){let e,i=!1;const n=Ge.getTournament().tournamentRecord?.onlineResources?.find(({name:p,resourceType:f})=>p==="tournamentImage"&&f==="URL")?.identifier,a=()=>{const p=document.getElementById("tournamentImagePreview");p&&(p.style.display=jt),s(!0)},s=p=>{const f=document.getElementById("createButton"),h=p?!1:!i&&e.tournamentImage.value;f.disabled=h},o=()=>{s(!1),i=!1;const p=document.getElementById("tournamentImagePreview");p&&(p.onload=()=>{i=!0,s()},p.src=e.tournamentImage.value,p.style.display="")},l=p=>e=Sr(p,[{onKeyUp:f=>f.key==="Enter"&&o(),onChange:()=>e.tournamentImage.value?o():a(),label:"Web address of online image",value:n,placeholder:"Image URL",field:"tournamentImage",autocomplete:"off"}]),c=document.createElement("div");l(c);const u=document.createElement("img");u.id="tournamentImagePreview",u.onload=()=>i=!0,n&&(u.src=n),u.style.width="100%",c.appendChild(u),Jr({title:"Tournament image",content:c,buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{const p=e.tournamentImage.value;Nt({methods:[{method:Hut,params:{onlineResource:{resourceSubType:"IMAGE",name:"tournamentImage",resourceType:"URL",identifier:p}}}],callback:m=>{m.success&&(Pt({message:"Tournament image updated",intent:"is-success"}),Mt(t)&&t(p))}})},intent:"is-primary",id:"createButton",disabled:!0,label:"Save",close:!0}]})}var Gke=typeof global=="object"&&global&&global.Object===Object&&global,o1t=typeof self=="object"&&self&&self.Object===Object&&self,DA=Gke||o1t||Function("return this")(),Yy=DA.Symbol,Qke=Object.prototype,l1t=Qke.hasOwnProperty,c1t=Qke.toString,SD=Yy?Yy.toStringTag:void 0;function u1t(t){var e=l1t.call(t,SD),i=t[SD];try{t[SD]=void 0;var r=!0}catch{}var n=c1t.call(t);return r&&(e?t[SD]=i:delete t[SD]),n}var d1t=Object.prototype,p1t=d1t.toString;function f1t(t){return p1t.call(t)}var h1t="[object Null]",m1t="[object Undefined]",koe=Yy?Yy.toStringTag:void 0;function zE(t){return t==null?t===void 0?m1t:h1t:koe&&koe in Object(t)?u1t(t):f1t(t)}function xg(t){return t!=null&&typeof t=="object"}var Aw=Array.isArray;function kb(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function jke(t){return t}var A1t="[object AsyncFunction]",g1t="[object Function]",v1t="[object GeneratorFunction]",y1t="[object Proxy]";function rJ(t){if(!kb(t))return!1;var e=zE(t);return e==g1t||e==v1t||e==A1t||e==y1t}var BQ=DA["__core-js_shared__"],xoe=(function(){var t=/[^.]+$/.exec(BQ&&BQ.keys&&BQ.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function b1t(t){return!!xoe&&xoe in t}var I1t=Function.prototype,w1t=I1t.toString;function RS(t){if(t!=null){try{return w1t.call(t)}catch{}try{return t+""}catch{}}return""}var S1t=/[\\^$.*+?()[\]{}|]/g,U1t=/^\[object .+?Constructor\]$/,T1t=Function.prototype,C1t=Object.prototype,E1t=T1t.toString,D1t=C1t.hasOwnProperty,P1t=RegExp("^"+E1t.call(D1t).replace(S1t,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function R1t(t){if(!kb(t)||b1t(t))return!1;var e=rJ(t)?P1t:U1t;return e.test(RS(t))}function M1t(t,e){return t?.[e]}function MS(t,e){var i=M1t(t,e);return R1t(i)?i:void 0}var vz=MS(DA,"WeakMap"),_oe=Object.create,N1t=(function(){function t(){}return function(e){if(!kb(e))return{};if(_oe)return _oe(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}})();function B1t(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function k1t(t,e){var i=-1,r=t.length;for(e||(e=Array(r));++i<r;)e[i]=t[i];return e}var x1t=800,_1t=16,O1t=Date.now;function F1t(t){var e=0,i=0;return function(){var r=O1t(),n=_1t-(r-i);if(i=r,n>0){if(++e>=x1t)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function L1t(t){return function(){return t}}var BO=(function(){try{var t=MS(Object,"defineProperty");return t({},"",{}),t}catch{}})(),$1t=BO?function(t,e){return BO(t,"toString",{configurable:!0,enumerable:!1,value:L1t(e),writable:!0})}:jke,H1t=F1t($1t);function V1t(t,e){for(var i=-1,r=t==null?0:t.length;++i<r&&e(t[i],i,t)!==!1;);return t}var G1t=9007199254740991,Q1t=/^(?:0|[1-9]\d*)$/;function zke(t,e){var i=typeof t;return e=e??G1t,!!e&&(i=="number"||i!="symbol"&&Q1t.test(t))&&t>-1&&t%1==0&&t<e}function nJ(t,e,i){e=="__proto__"&&BO?BO(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function xN(t,e){return t===e||t!==t&&e!==e}var j1t=Object.prototype,z1t=j1t.hasOwnProperty;function qke(t,e,i){var r=t[e];(!(z1t.call(t,e)&&xN(r,i))||i===void 0&&!(e in t))&&nJ(t,e,i)}function q1t(t,e,i,r){var n=!i;i||(i={});for(var a=-1,s=e.length;++a<s;){var o=e[a],l=void 0;l===void 0&&(l=t[o]),n?nJ(i,o,l):qke(i,o,l)}return i}var Ooe=Math.max;function W1t(t,e,i){return e=Ooe(e===void 0?t.length-1:e,0),function(){for(var r=arguments,n=-1,a=Ooe(r.length-e,0),s=Array(a);++n<a;)s[n]=r[e+n];n=-1;for(var o=Array(e+1);++n<e;)o[n]=r[n];return o[e]=i(s),B1t(t,this,o)}}function K1t(t,e){return H1t(W1t(t,e,jke),t+"")}var Y1t=9007199254740991;function Wke(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Y1t}function eV(t){return t!=null&&Wke(t.length)&&!rJ(t)}function X1t(t,e,i){if(!kb(i))return!1;var r=typeof e;return(r=="number"?eV(i)&&zke(e,i.length):r=="string"&&e in i)?xN(i[e],t):!1}function Z1t(t){return K1t(function(e,i){var r=-1,n=i.length,a=n>1?i[n-1]:void 0,s=n>2?i[2]:void 0;for(a=t.length>3&&typeof a=="function"?(n--,a):void 0,s&&X1t(i[0],i[1],s)&&(a=n<3?void 0:a,n=1),e=Object(e);++r<n;){var o=i[r];o&&t(e,o,r,a)}return e})}var J1t=Object.prototype;function aJ(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||J1t;return t===i}function eRt(t,e){for(var i=-1,r=Array(t);++i<t;)r[i]=e(i);return r}var tRt="[object Arguments]";function Foe(t){return xg(t)&&zE(t)==tRt}var Kke=Object.prototype,iRt=Kke.hasOwnProperty,rRt=Kke.propertyIsEnumerable,yz=Foe((function(){return arguments})())?Foe:function(t){return xg(t)&&iRt.call(t,"callee")&&!rRt.call(t,"callee")};function nRt(){return!1}var Yke=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Loe=Yke&&typeof module=="object"&&module&&!module.nodeType&&module,aRt=Loe&&Loe.exports===Yke,$oe=aRt?DA.Buffer:void 0,sRt=$oe?$oe.isBuffer:void 0,b1=sRt||nRt,oRt="[object Arguments]",lRt="[object Array]",cRt="[object Boolean]",uRt="[object Date]",dRt="[object Error]",pRt="[object Function]",fRt="[object Map]",hRt="[object Number]",mRt="[object Object]",ARt="[object RegExp]",gRt="[object Set]",vRt="[object String]",yRt="[object WeakMap]",bRt="[object ArrayBuffer]",IRt="[object DataView]",wRt="[object Float32Array]",SRt="[object Float64Array]",URt="[object Int8Array]",TRt="[object Int16Array]",CRt="[object Int32Array]",ERt="[object Uint8Array]",DRt="[object Uint8ClampedArray]",PRt="[object Uint16Array]",RRt="[object Uint32Array]",ja={};ja[wRt]=ja[SRt]=ja[URt]=ja[TRt]=ja[CRt]=ja[ERt]=ja[DRt]=ja[PRt]=ja[RRt]=!0;ja[oRt]=ja[lRt]=ja[bRt]=ja[cRt]=ja[IRt]=ja[uRt]=ja[dRt]=ja[pRt]=ja[fRt]=ja[hRt]=ja[mRt]=ja[ARt]=ja[gRt]=ja[vRt]=ja[yRt]=!1;function MRt(t){return xg(t)&&Wke(t.length)&&!!ja[zE(t)]}function sJ(t){return function(e){return t(e)}}var Xke=typeof exports=="object"&&exports&&!exports.nodeType&&exports,H0=Xke&&typeof module=="object"&&module&&!module.nodeType&&module,NRt=H0&&H0.exports===Xke,kQ=NRt&&Gke.process,bC=(function(){try{var t=H0&&H0.require&&H0.require("util").types;return t||kQ&&kQ.binding&&kQ.binding("util")}catch{}})(),Hoe=bC&&bC.isTypedArray,oJ=Hoe?sJ(Hoe):MRt,BRt=Object.prototype,kRt=BRt.hasOwnProperty;function Zke(t,e){var i=Aw(t),r=!i&&yz(t),n=!i&&!r&&b1(t),a=!i&&!r&&!n&&oJ(t),s=i||r||n||a,o=s?eRt(t.length,String):[],l=o.length;for(var c in t)(e||kRt.call(t,c))&&!(s&&(c=="length"||n&&(c=="offset"||c=="parent")||a&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||zke(c,l)))&&o.push(c);return o}function Jke(t,e){return function(i){return t(e(i))}}var xRt=Jke(Object.keys,Object),_Rt=Object.prototype,ORt=_Rt.hasOwnProperty;function FRt(t){if(!aJ(t))return xRt(t);var e=[];for(var i in Object(t))ORt.call(t,i)&&i!="constructor"&&e.push(i);return e}function LRt(t){return eV(t)?Zke(t):FRt(t)}function $Rt(t){var e=[];if(t!=null)for(var i in Object(t))e.push(i);return e}var HRt=Object.prototype,VRt=HRt.hasOwnProperty;function GRt(t){if(!kb(t))return $Rt(t);var e=aJ(t),i=[];for(var r in t)r=="constructor"&&(e||!VRt.call(t,r))||i.push(r);return i}function exe(t){return eV(t)?Zke(t,!0):GRt(t)}var I1=MS(Object,"create");function QRt(){this.__data__=I1?I1(null):{},this.size=0}function jRt(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var zRt="__lodash_hash_undefined__",qRt=Object.prototype,WRt=qRt.hasOwnProperty;function KRt(t){var e=this.__data__;if(I1){var i=e[t];return i===zRt?void 0:i}return WRt.call(e,t)?e[t]:void 0}var YRt=Object.prototype,XRt=YRt.hasOwnProperty;function ZRt(t){var e=this.__data__;return I1?e[t]!==void 0:XRt.call(e,t)}var JRt="__lodash_hash_undefined__";function eMt(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=I1&&e===void 0?JRt:e,this}function gw(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}gw.prototype.clear=QRt;gw.prototype.delete=jRt;gw.prototype.get=KRt;gw.prototype.has=ZRt;gw.prototype.set=eMt;function tMt(){this.__data__=[],this.size=0}function tV(t,e){for(var i=t.length;i--;)if(xN(t[i][0],e))return i;return-1}var iMt=Array.prototype,rMt=iMt.splice;function nMt(t){var e=this.__data__,i=tV(e,t);if(i<0)return!1;var r=e.length-1;return i==r?e.pop():rMt.call(e,i,1),--this.size,!0}function aMt(t){var e=this.__data__,i=tV(e,t);return i<0?void 0:e[i][1]}function sMt(t){return tV(this.__data__,t)>-1}function oMt(t,e){var i=this.__data__,r=tV(i,t);return r<0?(++this.size,i.push([t,e])):i[r][1]=e,this}function pv(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}pv.prototype.clear=tMt;pv.prototype.delete=nMt;pv.prototype.get=aMt;pv.prototype.has=sMt;pv.prototype.set=oMt;var w1=MS(DA,"Map");function lMt(){this.size=0,this.__data__={hash:new gw,map:new(w1||pv),string:new gw}}function cMt(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function iV(t,e){var i=t.__data__;return cMt(e)?i[typeof e=="string"?"string":"hash"]:i.map}function uMt(t){var e=iV(this,t).delete(t);return this.size-=e?1:0,e}function dMt(t){return iV(this,t).get(t)}function pMt(t){return iV(this,t).has(t)}function fMt(t,e){var i=iV(this,t),r=i.size;return i.set(t,e),this.size+=i.size==r?0:1,this}function NS(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}NS.prototype.clear=lMt;NS.prototype.delete=uMt;NS.prototype.get=dMt;NS.prototype.has=pMt;NS.prototype.set=fMt;function hMt(t,e){for(var i=-1,r=e.length,n=t.length;++i<r;)t[n+i]=e[i];return t}var txe=Jke(Object.getPrototypeOf,Object),mMt="[object Object]",AMt=Function.prototype,gMt=Object.prototype,ixe=AMt.toString,vMt=gMt.hasOwnProperty,yMt=ixe.call(Object);function bMt(t){if(!xg(t)||zE(t)!=mMt)return!1;var e=txe(t);if(e===null)return!0;var i=vMt.call(e,"constructor")&&e.constructor;return typeof i=="function"&&i instanceof i&&ixe.call(i)==yMt}function IMt(){this.__data__=new pv,this.size=0}function wMt(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}function SMt(t){return this.__data__.get(t)}function UMt(t){return this.__data__.has(t)}var TMt=200;function CMt(t,e){var i=this.__data__;if(i instanceof pv){var r=i.__data__;if(!w1||r.length<TMt-1)return r.push([t,e]),this.size=++i.size,this;i=this.__data__=new NS(r)}return i.set(t,e),this.size=i.size,this}function Pm(t){var e=this.__data__=new pv(t);this.size=e.size}Pm.prototype.clear=IMt;Pm.prototype.delete=wMt;Pm.prototype.get=SMt;Pm.prototype.has=UMt;Pm.prototype.set=CMt;var rxe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Voe=rxe&&typeof module=="object"&&module&&!module.nodeType&&module,EMt=Voe&&Voe.exports===rxe,Goe=EMt?DA.Buffer:void 0,Qoe=Goe?Goe.allocUnsafe:void 0;function nxe(t,e){if(e)return t.slice();var i=t.length,r=Qoe?Qoe(i):new t.constructor(i);return t.copy(r),r}function DMt(t,e){for(var i=-1,r=t==null?0:t.length,n=0,a=[];++i<r;){var s=t[i];e(s,i,t)&&(a[n++]=s)}return a}function PMt(){return[]}var RMt=Object.prototype,MMt=RMt.propertyIsEnumerable,joe=Object.getOwnPropertySymbols,NMt=joe?function(t){return t==null?[]:(t=Object(t),DMt(joe(t),function(e){return MMt.call(t,e)}))}:PMt;function BMt(t,e,i){var r=e(t);return Aw(t)?r:hMt(r,i(t))}function bz(t){return BMt(t,LRt,NMt)}var Iz=MS(DA,"DataView"),wz=MS(DA,"Promise"),Sz=MS(DA,"Set"),zoe="[object Map]",kMt="[object Object]",qoe="[object Promise]",Woe="[object Set]",Koe="[object WeakMap]",Yoe="[object DataView]",xMt=RS(Iz),_Mt=RS(w1),OMt=RS(wz),FMt=RS(Sz),LMt=RS(vz),zf=zE;(Iz&&zf(new Iz(new ArrayBuffer(1)))!=Yoe||w1&&zf(new w1)!=zoe||wz&&zf(wz.resolve())!=qoe||Sz&&zf(new Sz)!=Woe||vz&&zf(new vz)!=Koe)&&(zf=function(t){var e=zE(t),i=e==kMt?t.constructor:void 0,r=i?RS(i):"";if(r)switch(r){case xMt:return Yoe;case _Mt:return zoe;case OMt:return qoe;case FMt:return Woe;case LMt:return Koe}return e});var $Mt=Object.prototype,HMt=$Mt.hasOwnProperty;function VMt(t){var e=t.length,i=new t.constructor(e);return e&&typeof t[0]=="string"&&HMt.call(t,"index")&&(i.index=t.index,i.input=t.input),i}var kO=DA.Uint8Array;function lJ(t){var e=new t.constructor(t.byteLength);return new kO(e).set(new kO(t)),e}function GMt(t,e){var i=lJ(t.buffer);return new t.constructor(i,t.byteOffset,t.byteLength)}var QMt=/\w*$/;function jMt(t){var e=new t.constructor(t.source,QMt.exec(t));return e.lastIndex=t.lastIndex,e}var Xoe=Yy?Yy.prototype:void 0,Zoe=Xoe?Xoe.valueOf:void 0;function zMt(t){return Zoe?Object(Zoe.call(t)):{}}function axe(t,e){var i=e?lJ(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}var qMt="[object Boolean]",WMt="[object Date]",KMt="[object Map]",YMt="[object Number]",XMt="[object RegExp]",ZMt="[object Set]",JMt="[object String]",eNt="[object Symbol]",tNt="[object ArrayBuffer]",iNt="[object DataView]",rNt="[object Float32Array]",nNt="[object Float64Array]",aNt="[object Int8Array]",sNt="[object Int16Array]",oNt="[object Int32Array]",lNt="[object Uint8Array]",cNt="[object Uint8ClampedArray]",uNt="[object Uint16Array]",dNt="[object Uint32Array]";function pNt(t,e,i){var r=t.constructor;switch(e){case tNt:return lJ(t);case qMt:case WMt:return new r(+t);case iNt:return GMt(t);case rNt:case nNt:case aNt:case sNt:case oNt:case lNt:case cNt:case uNt:case dNt:return axe(t,i);case KMt:return new r;case YMt:case JMt:return new r(t);case XMt:return jMt(t);case ZMt:return new r;case eNt:return zMt(t)}}function sxe(t){return typeof t.constructor=="function"&&!aJ(t)?N1t(txe(t)):{}}var fNt="[object Map]";function hNt(t){return xg(t)&&zf(t)==fNt}var Joe=bC&&bC.isMap,mNt=Joe?sJ(Joe):hNt,ANt="[object Set]";function gNt(t){return xg(t)&&zf(t)==ANt}var ele=bC&&bC.isSet,vNt=ele?sJ(ele):gNt,yNt=1,oxe="[object Arguments]",bNt="[object Array]",INt="[object Boolean]",wNt="[object Date]",SNt="[object Error]",lxe="[object Function]",UNt="[object GeneratorFunction]",TNt="[object Map]",CNt="[object Number]",cxe="[object Object]",ENt="[object RegExp]",DNt="[object Set]",PNt="[object String]",RNt="[object Symbol]",MNt="[object WeakMap]",NNt="[object ArrayBuffer]",BNt="[object DataView]",kNt="[object Float32Array]",xNt="[object Float64Array]",_Nt="[object Int8Array]",ONt="[object Int16Array]",FNt="[object Int32Array]",LNt="[object Uint8Array]",$Nt="[object Uint8ClampedArray]",HNt="[object Uint16Array]",VNt="[object Uint32Array]",Ba={};Ba[oxe]=Ba[bNt]=Ba[NNt]=Ba[BNt]=Ba[INt]=Ba[wNt]=Ba[kNt]=Ba[xNt]=Ba[_Nt]=Ba[ONt]=Ba[FNt]=Ba[TNt]=Ba[CNt]=Ba[cxe]=Ba[ENt]=Ba[DNt]=Ba[PNt]=Ba[RNt]=Ba[LNt]=Ba[$Nt]=Ba[HNt]=Ba[VNt]=!0;Ba[SNt]=Ba[lxe]=Ba[MNt]=!1;function vx(t,e,i,r,n,a){var s,o=e&yNt;if(s!==void 0)return s;if(!kb(t))return t;var l=Aw(t);if(l)s=VMt(t);else{var c=zf(t),u=c==lxe||c==UNt;if(b1(t))return nxe(t,o);if(c==cxe||c==oxe||u&&!n)s=u?{}:sxe(t);else{if(!Ba[c])return n?t:{};s=pNt(t,c,o)}}a||(a=new Pm);var d=a.get(t);if(d)return d;a.set(t,s),vNt(t)?t.forEach(function(h){s.add(vx(h,e,i,h,t,a))}):mNt(t)&&t.forEach(function(h,m){s.set(m,vx(h,e,i,m,t,a))});var p=bz,f=l?void 0:p(t);return V1t(f||t,function(h,m){f&&(m=h,h=t[m]),qke(s,m,vx(h,e,i,m,t,a))}),s}var GNt=1,QNt=4;function sT(t){return vx(t,GNt|QNt)}var jNt="__lodash_hash_undefined__";function zNt(t){return this.__data__.set(t,jNt),this}function qNt(t){return this.__data__.has(t)}function xO(t){var e=-1,i=t==null?0:t.length;for(this.__data__=new NS;++e<i;)this.add(t[e])}xO.prototype.add=xO.prototype.push=zNt;xO.prototype.has=qNt;function WNt(t,e){for(var i=-1,r=t==null?0:t.length;++i<r;)if(e(t[i],i,t))return!0;return!1}function KNt(t,e){return t.has(e)}var YNt=1,XNt=2;function uxe(t,e,i,r,n,a){var s=i&YNt,o=t.length,l=e.length;if(o!=l&&!(s&&l>o))return!1;var c=a.get(t),u=a.get(e);if(c&&u)return c==e&&u==t;var d=-1,p=!0,f=i&XNt?new xO:void 0;for(a.set(t,e),a.set(e,t);++d<o;){var h=t[d],m=e[d];if(r)var A=s?r(m,h,d,e,t,a):r(h,m,d,t,e,a);if(A!==void 0){if(A)continue;p=!1;break}if(f){if(!WNt(e,function(g,v){if(!KNt(f,v)&&(h===g||n(h,g,i,r,a)))return f.push(v)})){p=!1;break}}else if(!(h===m||n(h,m,i,r,a))){p=!1;break}}return a.delete(t),a.delete(e),p}function ZNt(t){var e=-1,i=Array(t.size);return t.forEach(function(r,n){i[++e]=[n,r]}),i}function JNt(t){var e=-1,i=Array(t.size);return t.forEach(function(r){i[++e]=r}),i}var eBt=1,tBt=2,iBt="[object Boolean]",rBt="[object Date]",nBt="[object Error]",aBt="[object Map]",sBt="[object Number]",oBt="[object RegExp]",lBt="[object Set]",cBt="[object String]",uBt="[object Symbol]",dBt="[object ArrayBuffer]",pBt="[object DataView]",tle=Yy?Yy.prototype:void 0,xQ=tle?tle.valueOf:void 0;function fBt(t,e,i,r,n,a,s){switch(i){case pBt:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case dBt:return!(t.byteLength!=e.byteLength||!a(new kO(t),new kO(e)));case iBt:case rBt:case sBt:return xN(+t,+e);case nBt:return t.name==e.name&&t.message==e.message;case oBt:case cBt:return t==e+"";case aBt:var o=ZNt;case lBt:var l=r&eBt;if(o||(o=JNt),t.size!=e.size&&!l)return!1;var c=s.get(t);if(c)return c==e;r|=tBt,s.set(t,e);var u=uxe(o(t),o(e),r,n,a,s);return s.delete(t),u;case uBt:if(xQ)return xQ.call(t)==xQ.call(e)}return!1}var hBt=1,mBt=Object.prototype,ABt=mBt.hasOwnProperty;function gBt(t,e,i,r,n,a){var s=i&hBt,o=bz(t),l=o.length,c=bz(e),u=c.length;if(l!=u&&!s)return!1;for(var d=l;d--;){var p=o[d];if(!(s?p in e:ABt.call(e,p)))return!1}var f=a.get(t),h=a.get(e);if(f&&h)return f==e&&h==t;var m=!0;a.set(t,e),a.set(e,t);for(var A=s;++d<l;){p=o[d];var g=t[p],v=e[p];if(r)var b=s?r(v,g,p,e,t,a):r(g,v,p,t,e,a);if(!(b===void 0?g===v||n(g,v,i,r,a):b)){m=!1;break}A||(A=p=="constructor")}if(m&&!A){var y=t.constructor,I=e.constructor;y!=I&&"constructor"in t&&"constructor"in e&&!(typeof y=="function"&&y instanceof y&&typeof I=="function"&&I instanceof I)&&(m=!1)}return a.delete(t),a.delete(e),m}var vBt=1,ile="[object Arguments]",rle="[object Array]",ok="[object Object]",yBt=Object.prototype,nle=yBt.hasOwnProperty;function bBt(t,e,i,r,n,a){var s=Aw(t),o=Aw(e),l=s?rle:zf(t),c=o?rle:zf(e);l=l==ile?ok:l,c=c==ile?ok:c;var u=l==ok,d=c==ok,p=l==c;if(p&&b1(t)){if(!b1(e))return!1;s=!0,u=!1}if(p&&!u)return a||(a=new Pm),s||oJ(t)?uxe(t,e,i,r,n,a):fBt(t,e,l,i,r,n,a);if(!(i&vBt)){var f=u&&nle.call(t,"__wrapped__"),h=d&&nle.call(e,"__wrapped__");if(f||h){var m=f?t.value():t,A=h?e.value():e;return a||(a=new Pm),n(m,A,i,r,a)}}return p?(a||(a=new Pm),gBt(t,e,i,r,n,a)):!1}function dxe(t,e,i,r,n){return t===e?!0:t==null||e==null||!xg(t)&&!xg(e)?t!==t&&e!==e:bBt(t,e,i,r,dxe,n)}function IBt(t){return function(e,i,r){for(var n=-1,a=Object(e),s=r(e),o=s.length;o--;){var l=s[++n];if(i(a[l],l,a)===!1)break}return e}}var wBt=IBt();function Uz(t,e,i){(i!==void 0&&!xN(t[e],i)||i===void 0&&!(e in t))&&nJ(t,e,i)}function SBt(t){return xg(t)&&eV(t)}function Tz(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}function UBt(t){return q1t(t,exe(t))}function TBt(t,e,i,r,n,a,s){var o=Tz(t,i),l=Tz(e,i),c=s.get(l);if(c){Uz(t,i,c);return}var u=a?a(o,l,i+"",t,e,s):void 0,d=u===void 0;if(d){var p=Aw(l),f=!p&&b1(l),h=!p&&!f&&oJ(l);u=l,p||f||h?Aw(o)?u=o:SBt(o)?u=k1t(o):f?(d=!1,u=nxe(l,!0)):h?(d=!1,u=axe(l,!0)):u=[]:bMt(l)||yz(l)?(u=o,yz(o)?u=UBt(o):(!kb(o)||rJ(o))&&(u=sxe(l))):d=!1}d&&(s.set(l,u),n(u,l,r,a,s),s.delete(l)),Uz(t,i,u)}function pxe(t,e,i,r,n){t!==e&&wBt(e,function(a,s){if(n||(n=new Pm),kb(a))TBt(t,e,s,i,pxe,r,n);else{var o=r?r(Tz(t,s),a,s+"",t,e,n):void 0;o===void 0&&(o=a),Uz(t,s,o)}},exe)}function cJ(t,e){return dxe(t,e)}var fy=Z1t(function(t,e,i){pxe(t,e,i)}),Pi=(t=>(t[t.TYPE=3]="TYPE",t[t.LEVEL=12]="LEVEL",t[t.ATTRIBUTE=13]="ATTRIBUTE",t[t.BLOT=14]="BLOT",t[t.INLINE=7]="INLINE",t[t.BLOCK=11]="BLOCK",t[t.BLOCK_BLOT=10]="BLOCK_BLOT",t[t.INLINE_BLOT=6]="INLINE_BLOT",t[t.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",t[t.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",t[t.ANY=15]="ANY",t))(Pi||{});class rA{constructor(e,i,r={}){this.attrName=e,this.keyName=i;const n=Pi.TYPE&Pi.ATTRIBUTE;this.scope=r.scope!=null?r.scope&Pi.LEVEL|n:Pi.ATTRIBUTE,r.whitelist!=null&&(this.whitelist=r.whitelist)}static keys(e){return Array.from(e.attributes).map(i=>i.name)}add(e,i){return this.canAdd(e,i)?(e.setAttribute(this.keyName,i),!0):!1}canAdd(e,i){return this.whitelist==null?!0:typeof i=="string"?this.whitelist.indexOf(i.replace(/["']/g,""))>-1:this.whitelist.indexOf(i)>-1}remove(e){e.removeAttribute(this.keyName)}value(e){const i=e.getAttribute(this.keyName);return this.canAdd(e,i)&&i?i:""}}class oT extends Error{constructor(e){e="[Parchment] "+e,super(e),this.message=e,this.name=this.constructor.name}}const fxe=class Cz{constructor(){this.attributes={},this.classes={},this.tags={},this.types={}}static find(e,i=!1){if(e==null)return null;if(this.blots.has(e))return this.blots.get(e)||null;if(i){let r=null;try{r=e.parentNode}catch{return null}return this.find(r,i)}return null}create(e,i,r){const n=this.query(i);if(n==null)throw new oT(`Unable to create ${i} blot`);const a=n,s=i instanceof Node||i.nodeType===Node.TEXT_NODE?i:a.create(r),o=new a(e,s,r);return Cz.blots.set(o.domNode,o),o}find(e,i=!1){return Cz.find(e,i)}query(e,i=Pi.ANY){let r;return typeof e=="string"?r=this.types[e]||this.attributes[e]:e instanceof Text||e.nodeType===Node.TEXT_NODE?r=this.types.text:typeof e=="number"?e&Pi.LEVEL&Pi.BLOCK?r=this.types.block:e&Pi.LEVEL&Pi.INLINE&&(r=this.types.inline):e instanceof Element&&((e.getAttribute("class")||"").split(/\s+/).some(n=>(r=this.classes[n],!!r)),r=r||this.tags[e.tagName]),r==null?null:"scope"in r&&i&Pi.LEVEL&r.scope&&i&Pi.TYPE&r.scope?r:null}register(...e){return e.map(i=>{const r="blotName"in i,n="attrName"in i;if(!r&&!n)throw new oT("Invalid definition");if(r&&i.blotName==="abstract")throw new oT("Cannot register abstract class");const a=r?i.blotName:n?i.attrName:void 0;return this.types[a]=i,n?typeof i.keyName=="string"&&(this.attributes[i.keyName]=i):r&&(i.className&&(this.classes[i.className]=i),i.tagName&&(Array.isArray(i.tagName)?i.tagName=i.tagName.map(s=>s.toUpperCase()):i.tagName=i.tagName.toUpperCase(),(Array.isArray(i.tagName)?i.tagName:[i.tagName]).forEach(s=>{(this.tags[s]==null||i.className==null)&&(this.tags[s]=i)}))),i})}};fxe.blots=new WeakMap;let IC=fxe;function ale(t,e){return(t.getAttribute("class")||"").split(/\s+/).filter(i=>i.indexOf(`${e}-`)===0)}class CBt extends rA{static keys(e){return(e.getAttribute("class")||"").split(/\s+/).map(i=>i.split("-").slice(0,-1).join("-"))}add(e,i){return this.canAdd(e,i)?(this.remove(e),e.classList.add(`${this.keyName}-${i}`),!0):!1}remove(e){ale(e,this.keyName).forEach(i=>{e.classList.remove(i)}),e.classList.length===0&&e.removeAttribute("class")}value(e){const i=(ale(e,this.keyName)[0]||"").slice(this.keyName.length+1);return this.canAdd(e,i)?i:""}}const Yh=CBt;function _Q(t){const e=t.split("-"),i=e.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("");return e[0]+i}class EBt extends rA{static keys(e){return(e.getAttribute("style")||"").split(";").map(i=>i.split(":")[0].trim())}add(e,i){return this.canAdd(e,i)?(e.style[_Q(this.keyName)]=i,!0):!1}remove(e){e.style[_Q(this.keyName)]="",e.getAttribute("style")||e.removeAttribute("style")}value(e){const i=e.style[_Q(this.keyName)];return this.canAdd(e,i)?i:""}}const xb=EBt;class DBt{constructor(e){this.attributes={},this.domNode=e,this.build()}attribute(e,i){i?e.add(this.domNode,i)&&(e.value(this.domNode)!=null?this.attributes[e.attrName]=e:delete this.attributes[e.attrName]):(e.remove(this.domNode),delete this.attributes[e.attrName])}build(){this.attributes={};const e=IC.find(this.domNode);if(e==null)return;const i=rA.keys(this.domNode),r=Yh.keys(this.domNode),n=xb.keys(this.domNode);i.concat(r).concat(n).forEach(a=>{const s=e.scroll.query(a,Pi.ATTRIBUTE);s instanceof rA&&(this.attributes[s.attrName]=s)})}copy(e){Object.keys(this.attributes).forEach(i=>{const r=this.attributes[i].value(this.domNode);e.format(i,r)})}move(e){this.copy(e),Object.keys(this.attributes).forEach(i=>{this.attributes[i].remove(this.domNode)}),this.attributes={}}values(){return Object.keys(this.attributes).reduce((e,i)=>(e[i]=this.attributes[i].value(this.domNode),e),{})}}const rV=DBt,hxe=class{constructor(e,i){this.scroll=e,this.domNode=i,IC.blots.set(i,this),this.prev=null,this.next=null}static create(e){if(this.tagName==null)throw new oT("Blot definition missing tagName");let i,r;return Array.isArray(this.tagName)?(typeof e=="string"?(r=e.toUpperCase(),parseInt(r,10).toString()===r&&(r=parseInt(r,10))):typeof e=="number"&&(r=e),typeof r=="number"?i=document.createElement(this.tagName[r-1]):r&&this.tagName.indexOf(r)>-1?i=document.createElement(r):i=document.createElement(this.tagName[0])):i=document.createElement(this.tagName),this.className&&i.classList.add(this.className),i}get statics(){return this.constructor}attach(){}clone(){const e=this.domNode.cloneNode(!1);return this.scroll.create(e)}detach(){this.parent!=null&&this.parent.removeChild(this),IC.blots.delete(this.domNode)}deleteAt(e,i){this.isolate(e,i).remove()}formatAt(e,i,r,n){const a=this.isolate(e,i);if(this.scroll.query(r,Pi.BLOT)!=null&&n)a.wrap(r,n);else if(this.scroll.query(r,Pi.ATTRIBUTE)!=null){const s=this.scroll.create(this.statics.scope);a.wrap(s),s.format(r,n)}}insertAt(e,i,r){const n=r==null?this.scroll.create("text",i):this.scroll.create(i,r),a=this.split(e);this.parent.insertBefore(n,a||void 0)}isolate(e,i){const r=this.split(e);if(r==null)throw new Error("Attempt to isolate at end");return r.split(i),r}length(){return 1}offset(e=this.parent){return this.parent==null||this===e?0:this.parent.children.offset(this)+this.parent.offset(e)}optimize(e){this.statics.requiredContainer&&!(this.parent instanceof this.statics.requiredContainer)&&this.wrap(this.statics.requiredContainer.blotName)}remove(){this.domNode.parentNode!=null&&this.domNode.parentNode.removeChild(this.domNode),this.detach()}replaceWith(e,i){const r=typeof e=="string"?this.scroll.create(e,i):e;return this.parent!=null&&(this.parent.insertBefore(r,this.next||void 0),this.remove()),r}split(e,i){return e===0?this:this.next}update(e,i){}wrap(e,i){const r=typeof e=="string"?this.scroll.create(e,i):e;if(this.parent!=null&&this.parent.insertBefore(r,this.next||void 0),typeof r.appendChild!="function")throw new oT(`Cannot wrap ${e}`);return r.appendChild(this),r}};hxe.blotName="abstract";let mxe=hxe;const Axe=class extends mxe{static value(e){return!0}index(e,i){return this.domNode===e||this.domNode.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(i,1):-1}position(e,i){let r=Array.from(this.parent.domNode.childNodes).indexOf(this.domNode);return e>0&&(r+=1),[this.parent.domNode,r]}value(){return{[this.statics.blotName]:this.statics.value(this.domNode)||!0}}};Axe.scope=Pi.INLINE_BLOT;let PBt=Axe;const Ic=PBt;class RBt{constructor(){this.head=null,this.tail=null,this.length=0}append(...e){if(this.insertBefore(e[0],null),e.length>1){const i=e.slice(1);this.append(...i)}}at(e){const i=this.iterator();let r=i();for(;r&&e>0;)e-=1,r=i();return r}contains(e){const i=this.iterator();let r=i();for(;r;){if(r===e)return!0;r=i()}return!1}indexOf(e){const i=this.iterator();let r=i(),n=0;for(;r;){if(r===e)return n;n+=1,r=i()}return-1}insertBefore(e,i){e!=null&&(this.remove(e),e.next=i,i!=null?(e.prev=i.prev,i.prev!=null&&(i.prev.next=e),i.prev=e,i===this.head&&(this.head=e)):this.tail!=null?(this.tail.next=e,e.prev=this.tail,this.tail=e):(e.prev=null,this.head=this.tail=e),this.length+=1)}offset(e){let i=0,r=this.head;for(;r!=null;){if(r===e)return i;i+=r.length(),r=r.next}return-1}remove(e){this.contains(e)&&(e.prev!=null&&(e.prev.next=e.next),e.next!=null&&(e.next.prev=e.prev),e===this.head&&(this.head=e.next),e===this.tail&&(this.tail=e.prev),this.length-=1)}iterator(e=this.head){return()=>{const i=e;return e!=null&&(e=e.next),i}}find(e,i=!1){const r=this.iterator();let n=r();for(;n;){const a=n.length();if(e<a||i&&e===a&&(n.next==null||n.next.length()!==0))return[n,e];e-=a,n=r()}return[null,0]}forEach(e){const i=this.iterator();let r=i();for(;r;)e(r),r=i()}forEachAt(e,i,r){if(i<=0)return;const[n,a]=this.find(e);let s=e-a;const o=this.iterator(n);let l=o();for(;l&&s<e+i;){const c=l.length();e>s?r(l,e-s,Math.min(i,s+c-e)):r(l,0,Math.min(c,e+i-s)),s+=c,l=o()}}map(e){return this.reduce((i,r)=>(i.push(e(r)),i),[])}reduce(e,i){const r=this.iterator();let n=r();for(;n;)i=e(i,n),n=r();return i}}function sle(t,e){const i=e.find(t);if(i)return i;try{return e.create(t)}catch{const r=e.create(Pi.INLINE);return Array.from(t.childNodes).forEach(n=>{r.domNode.appendChild(n)}),t.parentNode&&t.parentNode.replaceChild(r.domNode,t),r.attach(),r}}const gxe=class xv extends mxe{constructor(e,i){super(e,i),this.uiNode=null,this.build()}appendChild(e){this.insertBefore(e)}attach(){super.attach(),this.children.forEach(e=>{e.attach()})}attachUI(e){this.uiNode!=null&&this.uiNode.remove(),this.uiNode=e,xv.uiClass&&this.uiNode.classList.add(xv.uiClass),this.uiNode.setAttribute("contenteditable","false"),this.domNode.insertBefore(this.uiNode,this.domNode.firstChild)}build(){this.children=new RBt,Array.from(this.domNode.childNodes).filter(e=>e!==this.uiNode).reverse().forEach(e=>{try{const i=sle(e,this.scroll);this.insertBefore(i,this.children.head||void 0)}catch(i){if(i instanceof oT)return;throw i}})}deleteAt(e,i){if(e===0&&i===this.length())return this.remove();this.children.forEachAt(e,i,(r,n,a)=>{r.deleteAt(n,a)})}descendant(e,i=0){const[r,n]=this.children.find(i);return e.blotName==null&&e(r)||e.blotName!=null&&r instanceof e?[r,n]:r instanceof xv?r.descendant(e,n):[null,-1]}descendants(e,i=0,r=Number.MAX_VALUE){let n=[],a=r;return this.children.forEachAt(i,r,(s,o,l)=>{(e.blotName==null&&e(s)||e.blotName!=null&&s instanceof e)&&n.push(s),s instanceof xv&&(n=n.concat(s.descendants(e,o,a))),a-=l}),n}detach(){this.children.forEach(e=>{e.detach()}),super.detach()}enforceAllowedChildren(){let e=!1;this.children.forEach(i=>{e||this.statics.allowedChildren.some(r=>i instanceof r)||(i.statics.scope===Pi.BLOCK_BLOT?(i.next!=null&&this.splitAfter(i),i.prev!=null&&this.splitAfter(i.prev),i.parent.unwrap(),e=!0):i instanceof xv?i.unwrap():i.remove())})}formatAt(e,i,r,n){this.children.forEachAt(e,i,(a,s,o)=>{a.formatAt(s,o,r,n)})}insertAt(e,i,r){const[n,a]=this.children.find(e);if(n)n.insertAt(a,i,r);else{const s=r==null?this.scroll.create("text",i):this.scroll.create(i,r);this.appendChild(s)}}insertBefore(e,i){e.parent!=null&&e.parent.children.remove(e);let r=null;this.children.insertBefore(e,i||null),e.parent=this,i!=null&&(r=i.domNode),(this.domNode.parentNode!==e.domNode||this.domNode.nextSibling!==r)&&this.domNode.insertBefore(e.domNode,r),e.attach()}length(){return this.children.reduce((e,i)=>e+i.length(),0)}moveChildren(e,i){this.children.forEach(r=>{e.insertBefore(r,i)})}optimize(e){if(super.optimize(e),this.enforceAllowedChildren(),this.uiNode!=null&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),this.children.length===0)if(this.statics.defaultChild!=null){const i=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(i)}else this.remove()}path(e,i=!1){const[r,n]=this.children.find(e,i),a=[[this,e]];return r instanceof xv?a.concat(r.path(n,i)):(r!=null&&a.push([r,n]),a)}removeChild(e){this.children.remove(e)}replaceWith(e,i){const r=typeof e=="string"?this.scroll.create(e,i):e;return r instanceof xv&&this.moveChildren(r),super.replaceWith(r)}split(e,i=!1){if(!i){if(e===0)return this;if(e===this.length())return this.next}const r=this.clone();return this.parent&&this.parent.insertBefore(r,this.next||void 0),this.children.forEachAt(e,this.length(),(n,a,s)=>{const o=n.split(a,i);o!=null&&r.appendChild(o)}),r}splitAfter(e){const i=this.clone();for(;e.next!=null;)i.appendChild(e.next);return this.parent&&this.parent.insertBefore(i,this.next||void 0),i}unwrap(){this.parent&&this.moveChildren(this.parent,this.next||void 0),this.remove()}update(e,i){const r=[],n=[];e.forEach(a=>{a.target===this.domNode&&a.type==="childList"&&(r.push(...a.addedNodes),n.push(...a.removedNodes))}),n.forEach(a=>{if(a.parentNode!=null&&a.tagName!=="IFRAME"&&document.body.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_CONTAINED_BY)return;const s=this.scroll.find(a);s!=null&&(s.domNode.parentNode==null||s.domNode.parentNode===this.domNode)&&s.detach()}),r.filter(a=>a.parentNode===this.domNode&&a!==this.uiNode).sort((a,s)=>a===s?0:a.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1).forEach(a=>{let s=null;a.nextSibling!=null&&(s=this.scroll.find(a.nextSibling));const o=sle(a,this.scroll);(o.next!==s||o.next==null)&&(o.parent!=null&&o.parent.removeChild(this),this.insertBefore(o,s||void 0))}),this.enforceAllowedChildren()}};gxe.uiClass="";let MBt=gxe;const dh=MBt;function NBt(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(t[i]!==e[i])return!1;return!0}const PU=class RU extends dh{static create(e){return super.create(e)}static formats(e,i){const r=i.query(RU.blotName);if(!(r!=null&&e.tagName===r.tagName)){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return e.tagName.toLowerCase()}}constructor(e,i){super(e,i),this.attributes=new rV(this.domNode)}format(e,i){if(e===this.statics.blotName&&!i)this.children.forEach(r=>{r instanceof RU||(r=r.wrap(RU.blotName,!0)),this.attributes.copy(r)}),this.unwrap();else{const r=this.scroll.query(e,Pi.INLINE);if(r==null)return;r instanceof rA?this.attributes.attribute(r,i):i&&(e!==this.statics.blotName||this.formats()[e]!==i)&&this.replaceWith(e,i)}}formats(){const e=this.attributes.values(),i=this.statics.formats(this.domNode,this.scroll);return i!=null&&(e[this.statics.blotName]=i),e}formatAt(e,i,r,n){this.formats()[r]!=null||this.scroll.query(r,Pi.ATTRIBUTE)?this.isolate(e,i).format(r,n):super.formatAt(e,i,r,n)}optimize(e){super.optimize(e);const i=this.formats();if(Object.keys(i).length===0)return this.unwrap();const r=this.next;r instanceof RU&&r.prev===this&&NBt(i,r.formats())&&(r.moveChildren(this),r.remove())}replaceWith(e,i){const r=super.replaceWith(e,i);return this.attributes.copy(r),r}update(e,i){super.update(e,i),e.some(r=>r.target===this.domNode&&r.type==="attributes")&&this.attributes.build()}wrap(e,i){const r=super.wrap(e,i);return r instanceof RU&&this.attributes.move(r),r}};PU.allowedChildren=[PU,Ic],PU.blotName="inline",PU.scope=Pi.INLINE_BLOT,PU.tagName="SPAN";let BBt=PU;const uJ=BBt,MU=class Ez extends dh{static create(e){return super.create(e)}static formats(e,i){const r=i.query(Ez.blotName);if(!(r!=null&&e.tagName===r.tagName)){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return e.tagName.toLowerCase()}}constructor(e,i){super(e,i),this.attributes=new rV(this.domNode)}format(e,i){const r=this.scroll.query(e,Pi.BLOCK);r!=null&&(r instanceof rA?this.attributes.attribute(r,i):e===this.statics.blotName&&!i?this.replaceWith(Ez.blotName):i&&(e!==this.statics.blotName||this.formats()[e]!==i)&&this.replaceWith(e,i))}formats(){const e=this.attributes.values(),i=this.statics.formats(this.domNode,this.scroll);return i!=null&&(e[this.statics.blotName]=i),e}formatAt(e,i,r,n){this.scroll.query(r,Pi.BLOCK)!=null?this.format(r,n):super.formatAt(e,i,r,n)}insertAt(e,i,r){if(r==null||this.scroll.query(i,Pi.INLINE)!=null)super.insertAt(e,i,r);else{const n=this.split(e);if(n!=null){const a=this.scroll.create(i,r);n.parent.insertBefore(a,n)}else throw new Error("Attempt to insertAt after block boundaries")}}replaceWith(e,i){const r=super.replaceWith(e,i);return this.attributes.copy(r),r}update(e,i){super.update(e,i),e.some(r=>r.target===this.domNode&&r.type==="attributes")&&this.attributes.build()}};MU.blotName="block",MU.scope=Pi.BLOCK_BLOT,MU.tagName="P",MU.allowedChildren=[uJ,MU,Ic];let kBt=MU;const S1=kBt,Dz=class extends dh{checkMerge(){return this.next!==null&&this.next.statics.blotName===this.statics.blotName}deleteAt(e,i){super.deleteAt(e,i),this.enforceAllowedChildren()}formatAt(e,i,r,n){super.formatAt(e,i,r,n),this.enforceAllowedChildren()}insertAt(e,i,r){super.insertAt(e,i,r),this.enforceAllowedChildren()}optimize(e){super.optimize(e),this.children.length>0&&this.next!=null&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}};Dz.blotName="container",Dz.scope=Pi.BLOCK_BLOT;let xBt=Dz;const nV=xBt;class _Bt extends Ic{static formats(e,i){}format(e,i){super.formatAt(0,this.length(),e,i)}formatAt(e,i,r,n){e===0&&i===this.length()?this.format(r,n):super.formatAt(e,i,r,n)}formats(){return this.statics.formats(this.domNode,this.scroll)}}const mp=_Bt,OBt={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},FBt=100,NU=class extends dh{constructor(e,i){super(null,i),this.registry=e,this.scroll=this,this.build(),this.observer=new MutationObserver(r=>{this.update(r)}),this.observer.observe(this.domNode,OBt),this.attach()}create(e,i){return this.registry.create(this,e,i)}find(e,i=!1){const r=this.registry.find(e,i);return r?r.scroll===this?r:i?this.find(r.scroll.domNode.parentNode,!0):null:null}query(e,i=Pi.ANY){return this.registry.query(e,i)}register(...e){return this.registry.register(...e)}build(){this.scroll!=null&&super.build()}detach(){super.detach(),this.observer.disconnect()}deleteAt(e,i){this.update(),e===0&&i===this.length()?this.children.forEach(r=>{r.remove()}):super.deleteAt(e,i)}formatAt(e,i,r,n){this.update(),super.formatAt(e,i,r,n)}insertAt(e,i,r){this.update(),super.insertAt(e,i,r)}optimize(e=[],i={}){super.optimize(i);const r=i.mutationsMap||new WeakMap;let n=Array.from(this.observer.takeRecords());for(;n.length>0;)e.push(n.pop());const a=(l,c=!0)=>{l==null||l===this||l.domNode.parentNode!=null&&(r.has(l.domNode)||r.set(l.domNode,[]),c&&a(l.parent))},s=l=>{r.has(l.domNode)&&(l instanceof dh&&l.children.forEach(s),r.delete(l.domNode),l.optimize(i))};let o=e;for(let l=0;o.length>0;l+=1){if(l>=FBt)throw new Error("[Parchment] Maximum optimize iterations reached");for(o.forEach(c=>{const u=this.find(c.target,!0);u!=null&&(u.domNode===c.target&&(c.type==="childList"?(a(this.find(c.previousSibling,!1)),Array.from(c.addedNodes).forEach(d=>{const p=this.find(d,!1);a(p,!1),p instanceof dh&&p.children.forEach(f=>{a(f,!1)})})):c.type==="attributes"&&a(u.prev)),a(u))}),this.children.forEach(s),o=Array.from(this.observer.takeRecords()),n=o.slice();n.length>0;)e.push(n.pop())}}update(e,i={}){e=e||this.observer.takeRecords();const r=new WeakMap;e.map(n=>{const a=this.find(n.target,!0);return a==null?null:r.has(a.domNode)?(r.get(a.domNode).push(n),null):(r.set(a.domNode,[n]),a)}).forEach(n=>{n!=null&&n!==this&&r.has(n.domNode)&&n.update(r.get(n.domNode)||[],i)}),i.mutationsMap=r,r.has(this.domNode)&&super.update(r.get(this.domNode),i),this.optimize(e,i)}};NU.blotName="scroll",NU.defaultChild=S1,NU.allowedChildren=[S1,nV],NU.scope=Pi.BLOCK_BLOT,NU.tagName="DIV";let LBt=NU;const dJ=LBt,Pz=class vxe extends Ic{static create(e){return document.createTextNode(e)}static value(e){return e.data}constructor(e,i){super(e,i),this.text=this.statics.value(this.domNode)}deleteAt(e,i){this.domNode.data=this.text=this.text.slice(0,e)+this.text.slice(e+i)}index(e,i){return this.domNode===e?i:-1}insertAt(e,i,r){r==null?(this.text=this.text.slice(0,e)+i+this.text.slice(e),this.domNode.data=this.text):super.insertAt(e,i,r)}length(){return this.text.length}optimize(e){super.optimize(e),this.text=this.statics.value(this.domNode),this.text.length===0?this.remove():this.next instanceof vxe&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())}position(e,i=!1){return[this.domNode,e]}split(e,i=!1){if(!i){if(e===0)return this;if(e===this.length())return this.next}const r=this.scroll.create(this.domNode.splitText(e));return this.parent.insertBefore(r,this.next||void 0),this.text=this.statics.value(this.domNode),r}update(e,i){e.some(r=>r.type==="characterData"&&r.target===this.domNode)&&(this.text=this.statics.value(this.domNode))}value(){return this.text}};Pz.blotName="text",Pz.scope=Pi.INLINE_BLOT;let $Bt=Pz;const _O=$Bt,HBt=Object.freeze(Object.defineProperty({__proto__:null,Attributor:rA,AttributorStore:rV,BlockBlot:S1,ClassAttributor:Yh,ContainerBlot:nV,EmbedBlot:mp,InlineBlot:uJ,LeafBlot:Ic,ParentBlot:dh,Registry:IC,Scope:Pi,ScrollBlot:dJ,StyleAttributor:xb,TextBlot:_O},Symbol.toStringTag,{value:"Module"}));var lk={exports:{}},OQ,ole;function VBt(){if(ole)return OQ;ole=1;var t=-1,e=1,i=0;function r(E,P,R,M,N){if(E===P)return E?[[i,E]]:[];if(R!=null){var k=D(E,P,R);if(k)return k}var O=o(E,P),x=E.substring(0,O);E=E.substring(O),P=P.substring(O),O=c(E,P);var F=E.substring(E.length-O);E=E.substring(0,E.length-O),P=P.substring(0,P.length-O);var _=n(E,P);return x&&_.unshift([i,x]),F&&_.push([i,F]),v(_,N),M&&d(_),_}function n(E,P){var R;if(!E)return[[e,P]];if(!P)return[[t,E]];var M=E.length>P.length?E:P,N=E.length>P.length?P:E,k=M.indexOf(N);if(k!==-1)return R=[[e,M.substring(0,k)],[i,N],[e,M.substring(k+N.length)]],E.length>P.length&&(R[0][0]=R[2][0]=t),R;if(N.length===1)return[[t,E],[e,P]];var O=u(E,P);if(O){var x=O[0],F=O[1],_=O[2],V=O[3],G=O[4],z=r(x,_),Q=r(F,V);return z.concat([[i,G]],Q)}return a(E,P)}function a(E,P){for(var R=E.length,M=P.length,N=Math.ceil((R+M)/2),k=N,O=2*N,x=new Array(O),F=new Array(O),_=0;_<O;_++)x[_]=-1,F[_]=-1;x[k+1]=0,F[k+1]=0;for(var V=R-M,G=V%2!==0,z=0,Q=0,j=0,W=0,Y=0;Y<N;Y++){for(var X=-Y+z;X<=Y-Q;X+=2){var J=k+X,ie;X===-Y||X!==Y&&x[J-1]<x[J+1]?ie=x[J+1]:ie=x[J-1]+1;for(var ue=ie-X;ie<R&&ue<M&&E.charAt(ie)===P.charAt(ue);)ie++,ue++;if(x[J]=ie,ie>R)Q+=2;else if(ue>M)z+=2;else if(G){var ne=k+V-X;if(ne>=0&&ne<O&&F[ne]!==-1){var ge=R-F[ne];if(ie>=ge)return s(E,P,ie,ue)}}}for(var he=-Y+j;he<=Y-W;he+=2){var ne=k+he,ge;he===-Y||he!==Y&&F[ne-1]<F[ne+1]?ge=F[ne+1]:ge=F[ne-1]+1;for(var Ie=ge-he;ge<R&&Ie<M&&E.charAt(R-ge-1)===P.charAt(M-Ie-1);)ge++,Ie++;if(F[ne]=ge,ge>R)W+=2;else if(Ie>M)j+=2;else if(!G){var J=k+V-he;if(J>=0&&J<O&&x[J]!==-1){var ie=x[J],ue=k+ie-J;if(ge=R-ge,ie>=ge)return s(E,P,ie,ue)}}}}return[[t,E],[e,P]]}function s(E,P,R,M){var N=E.substring(0,R),k=P.substring(0,M),O=E.substring(R),x=P.substring(M),F=r(N,k),_=r(O,x);return F.concat(_)}function o(E,P){if(!E||!P||E.charAt(0)!==P.charAt(0))return 0;for(var R=0,M=Math.min(E.length,P.length),N=M,k=0;R<N;)E.substring(k,N)==P.substring(k,N)?(R=N,k=R):M=N,N=Math.floor((M-R)/2+R);return b(E.charCodeAt(N-1))&&N--,N}function l(E,P){var R=E.length,M=P.length;if(R==0||M==0)return 0;R>M?E=E.substring(R-M):R<M&&(P=P.substring(0,R));var N=Math.min(R,M);if(E==P)return N;for(var k=0,O=1;;){var x=E.substring(N-O),F=P.indexOf(x);if(F==-1)return k;O+=F,(F==0||E.substring(N-O)==P.substring(0,O))&&(k=O,O++)}}function c(E,P){if(!E||!P||E.slice(-1)!==P.slice(-1))return 0;for(var R=0,M=Math.min(E.length,P.length),N=M,k=0;R<N;)E.substring(E.length-N,E.length-k)==P.substring(P.length-N,P.length-k)?(R=N,k=R):M=N,N=Math.floor((M-R)/2+R);return y(E.charCodeAt(E.length-N))&&N--,N}function u(E,P){var R=E.length>P.length?E:P,M=E.length>P.length?P:E;if(R.length<4||M.length*2<R.length)return null;function N(Q,j,W){for(var Y=Q.substring(W,W+Math.floor(Q.length/4)),X=-1,J="",ie,ue,ne,ge;(X=j.indexOf(Y,X+1))!==-1;){var he=o(Q.substring(W),j.substring(X)),Ie=c(Q.substring(0,W),j.substring(0,X));J.length<Ie+he&&(J=j.substring(X-Ie,X)+j.substring(X,X+he),ie=Q.substring(0,W-Ie),ue=Q.substring(W+he),ne=j.substring(0,X-Ie),ge=j.substring(X+he))}return J.length*2>=Q.length?[ie,ue,ne,ge,J]:null}var k=N(R,M,Math.ceil(R.length/4)),O=N(R,M,Math.ceil(R.length/2)),x;if(!k&&!O)return null;O?k?x=k[4].length>O[4].length?k:O:x=O:x=k;var F,_,V,G;E.length>P.length?(F=x[0],_=x[1],V=x[2],G=x[3]):(V=x[0],G=x[1],F=x[2],_=x[3]);var z=x[4];return[F,_,V,G,z]}function d(E){for(var P=!1,R=[],M=0,N=null,k=0,O=0,x=0,F=0,_=0;k<E.length;)E[k][0]==i?(R[M++]=k,O=F,x=_,F=0,_=0,N=E[k][1]):(E[k][0]==e?F+=E[k][1].length:_+=E[k][1].length,N&&N.length<=Math.max(O,x)&&N.length<=Math.max(F,_)&&(E.splice(R[M-1],0,[t,N]),E[R[M-1]+1][0]=e,M--,M--,k=M>0?R[M-1]:-1,O=0,x=0,F=0,_=0,N=null,P=!0)),k++;for(P&&v(E),g(E),k=1;k<E.length;){if(E[k-1][0]==t&&E[k][0]==e){var V=E[k-1][1],G=E[k][1],z=l(V,G),Q=l(G,V);z>=Q?(z>=V.length/2||z>=G.length/2)&&(E.splice(k,0,[i,G.substring(0,z)]),E[k-1][1]=V.substring(0,V.length-z),E[k+1][1]=G.substring(z),k++):(Q>=V.length/2||Q>=G.length/2)&&(E.splice(k,0,[i,V.substring(0,Q)]),E[k-1][0]=e,E[k-1][1]=G.substring(0,G.length-Q),E[k+1][0]=t,E[k+1][1]=V.substring(Q),k++),k++}k++}}var p=/[^a-zA-Z0-9]/,f=/\s/,h=/[\r\n]/,m=/\n\r?\n$/,A=/^\r?\n\r?\n/;function g(E){function P(Q,j){if(!Q||!j)return 6;var W=Q.charAt(Q.length-1),Y=j.charAt(0),X=W.match(p),J=Y.match(p),ie=X&&W.match(f),ue=J&&Y.match(f),ne=ie&&W.match(h),ge=ue&&Y.match(h),he=ne&&Q.match(m),Ie=ge&&j.match(A);return he||Ie?5:ne||ge?4:X&&!ie&&ue?3:ie||ue?2:X||J?1:0}for(var R=1;R<E.length-1;){if(E[R-1][0]==i&&E[R+1][0]==i){var M=E[R-1][1],N=E[R][1],k=E[R+1][1],O=c(M,N);if(O){var x=N.substring(N.length-O);M=M.substring(0,M.length-O),N=x+N.substring(0,N.length-O),k=x+k}for(var F=M,_=N,V=k,G=P(M,N)+P(N,k);N.charAt(0)===k.charAt(0);){M+=N.charAt(0),N=N.substring(1)+k.charAt(0),k=k.substring(1);var z=P(M,N)+P(N,k);z>=G&&(G=z,F=M,_=N,V=k)}E[R-1][1]!=F&&(F?E[R-1][1]=F:(E.splice(R-1,1),R--),E[R][1]=_,V?E[R+1][1]=V:(E.splice(R+1,1),R--))}R++}}function v(E,P){E.push([i,""]);for(var R=0,M=0,N=0,k="",O="",x;R<E.length;){if(R<E.length-1&&!E[R][1]){E.splice(R,1);continue}switch(E[R][0]){case e:N++,O+=E[R][1],R++;break;case t:M++,k+=E[R][1],R++;break;case i:var F=R-N-M-1;if(P){if(F>=0&&w(E[F][1])){var _=E[F][1].slice(-1);if(E[F][1]=E[F][1].slice(0,-1),k=_+k,O=_+O,!E[F][1]){E.splice(F,1),R--;var V=F-1;E[V]&&E[V][0]===e&&(N++,O=E[V][1]+O,V--),E[V]&&E[V][0]===t&&(M++,k=E[V][1]+k,V--),F=V}}if(I(E[R][1])){var _=E[R][1].charAt(0);E[R][1]=E[R][1].slice(1),k+=_,O+=_}}if(R<E.length-1&&!E[R][1]){E.splice(R,1);break}if(k.length>0||O.length>0){k.length>0&&O.length>0&&(x=o(O,k),x!==0&&(F>=0?E[F][1]+=O.substring(0,x):(E.splice(0,0,[i,O.substring(0,x)]),R++),O=O.substring(x),k=k.substring(x)),x=c(O,k),x!==0&&(E[R][1]=O.substring(O.length-x)+E[R][1],O=O.substring(0,O.length-x),k=k.substring(0,k.length-x)));var G=N+M;k.length===0&&O.length===0?(E.splice(R-G,G),R=R-G):k.length===0?(E.splice(R-G,G,[e,O]),R=R-G+1):O.length===0?(E.splice(R-G,G,[t,k]),R=R-G+1):(E.splice(R-G,G,[t,k],[e,O]),R=R-G+2)}R!==0&&E[R-1][0]===i?(E[R-1][1]+=E[R][1],E.splice(R,1)):R++,N=0,M=0,k="",O="";break}}E[E.length-1][1]===""&&E.pop();var z=!1;for(R=1;R<E.length-1;)E[R-1][0]===i&&E[R+1][0]===i&&(E[R][1].substring(E[R][1].length-E[R-1][1].length)===E[R-1][1]?(E[R][1]=E[R-1][1]+E[R][1].substring(0,E[R][1].length-E[R-1][1].length),E[R+1][1]=E[R-1][1]+E[R+1][1],E.splice(R-1,1),z=!0):E[R][1].substring(0,E[R+1][1].length)==E[R+1][1]&&(E[R-1][1]+=E[R+1][1],E[R][1]=E[R][1].substring(E[R+1][1].length)+E[R+1][1],E.splice(R+1,1),z=!0)),R++;z&&v(E,P)}function b(E){return E>=55296&&E<=56319}function y(E){return E>=56320&&E<=57343}function I(E){return y(E.charCodeAt(0))}function w(E){return b(E.charCodeAt(E.length-1))}function S(E){for(var P=[],R=0;R<E.length;R++)E[R][1].length>0&&P.push(E[R]);return P}function T(E,P,R,M){return w(E)||I(M)?null:S([[i,E],[t,P],[e,R],[i,M]])}function D(E,P,R){var M=typeof R=="number"?{index:R,length:0}:R.oldRange,N=typeof R=="number"?null:R.newRange,k=E.length,O=P.length;if(M.length===0&&(N===null||N.length===0)){var x=M.index,F=E.slice(0,x),_=E.slice(x),V=N?N.index:null;e:{var G=x+O-k;if(V!==null&&V!==G||G<0||G>O)break e;var z=P.slice(0,G),Q=P.slice(G);if(Q!==_)break e;var j=Math.min(x,G),W=F.slice(0,j),Y=z.slice(0,j);if(W!==Y)break e;var X=F.slice(j),J=z.slice(j);return T(W,X,J,_)}e:{if(V!==null&&V!==x)break e;var ie=x,z=P.slice(0,ie),Q=P.slice(ie);if(z!==F)break e;var ue=Math.min(k-ie,O-ie),ne=_.slice(_.length-ue),ge=Q.slice(Q.length-ue);if(ne!==ge)break e;var X=_.slice(0,_.length-ue),J=Q.slice(0,Q.length-ue);return T(F,X,J,ne)}}if(M.length>0&&N&&N.length===0)e:{var W=E.slice(0,M.index),ne=E.slice(M.index+M.length),j=W.length,ue=ne.length;if(O<j+ue)break e;var Y=P.slice(0,j),ge=P.slice(O-ue);if(W!==Y||ne!==ge)break e;var X=E.slice(j,k-ue),J=P.slice(j,O-ue);return T(W,X,J,ne)}return null}function C(E,P,R,M){return r(E,P,R,M,!0)}return C.INSERT=e,C.DELETE=t,C.EQUAL=i,OQ=C,OQ}var zD={exports:{}};zD.exports;var lle;function yxe(){return lle||(lle=1,(function(t,e){var i=200,r="__lodash_hash_undefined__",n=9007199254740991,a="[object Arguments]",s="[object Array]",o="[object Boolean]",l="[object Date]",c="[object Error]",u="[object Function]",d="[object GeneratorFunction]",p="[object Map]",f="[object Number]",h="[object Object]",m="[object Promise]",A="[object RegExp]",g="[object Set]",v="[object String]",b="[object Symbol]",y="[object WeakMap]",I="[object ArrayBuffer]",w="[object DataView]",S="[object Float32Array]",T="[object Float64Array]",D="[object Int8Array]",C="[object Int16Array]",E="[object Int32Array]",P="[object Uint8Array]",R="[object Uint8ClampedArray]",M="[object Uint16Array]",N="[object Uint32Array]",k=/[\\^$.*+?()[\]{}|]/g,O=/\w*$/,x=/^\[object .+?Constructor\]$/,F=/^(?:0|[1-9]\d*)$/,_={};_[a]=_[s]=_[I]=_[w]=_[o]=_[l]=_[S]=_[T]=_[D]=_[C]=_[E]=_[p]=_[f]=_[h]=_[A]=_[g]=_[v]=_[b]=_[P]=_[R]=_[M]=_[N]=!0,_[c]=_[u]=_[y]=!1;var V=typeof ig=="object"&&ig&&ig.Object===Object&&ig,G=typeof self=="object"&&self&&self.Object===Object&&self,z=V||G||Function("return this")(),Q=e&&!e.nodeType&&e,j=Q&&!0&&t&&!t.nodeType&&t,W=j&&j.exports===Q;function Y(ee,me){return ee.set(me[0],me[1]),ee}function X(ee,me){return ee.add(me),ee}function J(ee,me){for(var Te=-1,at=ee?ee.length:0;++Te<at&&me(ee[Te],Te,ee)!==!1;);return ee}function ie(ee,me){for(var Te=-1,at=me.length,ir=ee.length;++Te<at;)ee[ir+Te]=me[Te];return ee}function ue(ee,me,Te,at){for(var ir=-1,Di=ee?ee.length:0;++ir<Di;)Te=me(Te,ee[ir],ir,ee);return Te}function ne(ee,me){for(var Te=-1,at=Array(ee);++Te<ee;)at[Te]=me(Te);return at}function ge(ee,me){return ee?.[me]}function he(ee){var me=!1;if(ee!=null&&typeof ee.toString!="function")try{me=!!(ee+"")}catch{}return me}function Ie(ee){var me=-1,Te=Array(ee.size);return ee.forEach(function(at,ir){Te[++me]=[ir,at]}),Te}function xe(ee,me){return function(Te){return ee(me(Te))}}function Je(ee){var me=-1,Te=Array(ee.size);return ee.forEach(function(at){Te[++me]=at}),Te}var qe=Array.prototype,dt=Function.prototype,ft=Object.prototype,je=z["__core-js_shared__"],Tt=(function(){var ee=/[^.]+$/.exec(je&&je.keys&&je.keys.IE_PROTO||"");return ee?"Symbol(src)_1."+ee:""})(),Oe=dt.toString,mt=ft.hasOwnProperty,Le=ft.toString,lt=RegExp("^"+Oe.call(mt).replace(k,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),it=W?z.Buffer:void 0,Fe=z.Symbol,Xe=z.Uint8Array,ct=xe(Object.getPrototypeOf,Object),We=Object.create,ht=ft.propertyIsEnumerable,xt=qe.splice,pe=Object.getOwnPropertySymbols,Se=it?it.isBuffer:void 0,ye=xe(Object.keys,Object),ke=wn(z,"DataView"),Ce=wn(z,"Map"),Ke=wn(z,"Promise"),_e=wn(z,"Set"),wt=wn(z,"WeakMap"),ut=wn(Object,"create"),Ct=Da(ke),Gi=Da(Ce),Wt=Da(Ke),Ji=Da(_e),$i=Da(wt),xi=Fe?Fe.prototype:void 0,en=xi?xi.valueOf:void 0;function ra(ee){var me=-1,Te=ee?ee.length:0;for(this.clear();++me<Te;){var at=ee[me];this.set(at[0],at[1])}}function oc(){this.__data__=ut?ut(null):{}}function un(ee){return this.has(ee)&&delete this.__data__[ee]}function dn(ee){var me=this.__data__;if(ut){var Te=me[ee];return Te===r?void 0:Te}return mt.call(me,ee)?me[ee]:void 0}function Ta(ee){var me=this.__data__;return ut?me[ee]!==void 0:mt.call(me,ee)}function ti(ee,me){var Te=this.__data__;return Te[ee]=ut&&me===void 0?r:me,this}ra.prototype.clear=oc,ra.prototype.delete=un,ra.prototype.get=dn,ra.prototype.has=Ta,ra.prototype.set=ti;function pr(ee){var me=-1,Te=ee?ee.length:0;for(this.clear();++me<Te;){var at=ee[me];this.set(at[0],at[1])}}function lc(){this.__data__=[]}function xd(ee){var me=this.__data__,Te=pc(me,ee);if(Te<0)return!1;var at=me.length-1;return Te==at?me.pop():xt.call(me,Te,1),!0}function Ho(ee){var me=this.__data__,Te=pc(me,ee);return Te<0?void 0:me[Te][1]}function no(ee){return pc(this.__data__,ee)>-1}function ao(ee,me){var Te=this.__data__,at=pc(Te,ee);return at<0?Te.push([ee,me]):Te[at][1]=me,this}pr.prototype.clear=lc,pr.prototype.delete=xd,pr.prototype.get=Ho,pr.prototype.has=no,pr.prototype.set=ao;function Cn(ee){var me=-1,Te=ee?ee.length:0;for(this.clear();++me<Te;){var at=ee[me];this.set(at[0],at[1])}}function Gc(){this.__data__={hash:new ra,map:new(Ce||pr),string:new ra}}function cc(ee){return Oi(this,ee).delete(ee)}function Jh(ee){return Oi(this,ee).get(ee)}function Qc(ee){return Oi(this,ee).has(ee)}function xf(ee,me){return Oi(this,ee).set(ee,me),this}Cn.prototype.clear=Gc,Cn.prototype.delete=cc,Cn.prototype.get=Jh,Cn.prototype.has=Qc,Cn.prototype.set=xf;function Ca(ee){this.__data__=new pr(ee)}function Kn(){this.__data__=new pr}function al(ee){return this.__data__.delete(ee)}function Tl(ee){return this.__data__.get(ee)}function em(ee){return this.__data__.has(ee)}function uc(ee,me){var Te=this.__data__;if(Te instanceof pr){var at=Te.__data__;if(!Ce||at.length<i-1)return at.push([ee,me]),this;Te=this.__data__=new Cn(at)}return Te.set(ee,me),this}Ca.prototype.clear=Kn,Ca.prototype.delete=al,Ca.prototype.get=Tl,Ca.prototype.has=em,Ca.prototype.set=uc;function dc(ee,me){var Te=Pa(ee)||pi(ee)?ne(ee.length,String):[],at=Te.length,ir=!!at;for(var Di in ee)mt.call(ee,Di)&&!(ir&&(Di=="length"||tm(Di,at)))&&Te.push(Di);return Te}function vp(ee,me,Te){var at=ee[me];(!(mt.call(ee,me)&&MA(at,Te))||Te===void 0&&!(me in ee))&&(ee[me]=Te)}function pc(ee,me){for(var Te=ee.length;Te--;)if(MA(ee[Te][0],me))return Te;return-1}function Ea(ee,me){return ee&&et(me,Ou(me),ee)}function Bu(ee,me,Te,at,ir,Di,xr){var Zt;if(at&&(Zt=Di?at(ee,ir,Di,xr):at(ee)),Zt!==void 0)return Zt;if(!Yn(ee))return ee;var Na=Pa(ee);if(Na){if(Zt=Ur(ee),!me)return _d(ee,Zt)}else{var Ar=zc(ee),cs=Ar==u||Ar==d;if(bp(ee))return bs(ee,me);if(Ar==h||Ar==a||cs&&!Di){if(he(ee))return Di?ee:{};if(Zt=El(cs?{}:ee),!me)return Ai(ee,Ea(Zt,ee))}else{if(!_[Ar])return Di?ee:{};Zt=RA(ee,Ar,Bu,me)}}xr||(xr=new Ca);var Vo=xr.get(ee);if(Vo)return Vo;if(xr.set(ee,Zt),!Na)var Qa=Te?_i(ee):Ou(ee);return J(Qa||ee,function(us,Vs){Qa&&(Vs=us,us=ee[Vs]),vp(Zt,Vs,Bu(us,me,Te,at,Vs,ee,xr))}),Zt}function ku(ee){return Yn(ee)?We(ee):{}}function jc(ee,me,Te){var at=me(ee);return Pa(ee)?at:ie(at,Te(ee))}function Xt(ee){return Le.call(ee)}function xn(ee){if(!Yn(ee)||xu(ee))return!1;var me=sl(ee)||he(ee)?lt:x;return me.test(Da(ee))}function Cl(ee){if(!_u(ee))return ye(ee);var me=[];for(var Te in Object(ee))mt.call(ee,Te)&&Te!="constructor"&&me.push(Te);return me}function bs(ee,me){if(me)return ee.slice();var Te=new ee.constructor(ee.length);return ee.copy(Te),Te}function vo(ee){var me=new ee.constructor(ee.byteLength);return new Xe(me).set(new Xe(ee)),me}function Hs(ee,me){var Te=me?vo(ee.buffer):ee.buffer;return new ee.constructor(Te,ee.byteOffset,ee.byteLength)}function Hi(ee,me,Te){var at=me?Te(Ie(ee),!0):Ie(ee);return ue(at,Y,new ee.constructor)}function In(ee){var me=new ee.constructor(ee.source,O.exec(ee));return me.lastIndex=ee.lastIndex,me}function sn(ee,me,Te){var at=me?Te(Je(ee),!0):Je(ee);return ue(at,X,new ee.constructor)}function fc(ee){return en?Object(en.call(ee)):{}}function ls(ee,me){var Te=me?vo(ee.buffer):ee.buffer;return new ee.constructor(Te,ee.byteOffset,ee.length)}function _d(ee,me){var Te=-1,at=ee.length;for(me||(me=Array(at));++Te<at;)me[Te]=ee[Te];return me}function et(ee,me,Te,at){Te||(Te={});for(var ir=-1,Di=me.length;++ir<Di;){var xr=me[ir],Zt=void 0;vp(Te,xr,Zt===void 0?ee[xr]:Zt)}return Te}function Ai(ee,me){return et(ee,Va(ee),me)}function _i(ee){return jc(ee,Ou,Va)}function Oi(ee,me){var Te=ee.__data__;return so(me)?Te[typeof me=="string"?"string":"hash"]:Te.map}function wn(ee,me){var Te=ge(ee,me);return xn(Te)?Te:void 0}var Va=pe?xe(pe,Object):Ga,zc=Xt;(ke&&zc(new ke(new ArrayBuffer(1)))!=w||Ce&&zc(new Ce)!=p||Ke&&zc(Ke.resolve())!=m||_e&&zc(new _e)!=g||wt&&zc(new wt)!=y)&&(zc=function(ee){var me=Le.call(ee),Te=me==h?ee.constructor:void 0,at=Te?Da(Te):void 0;if(at)switch(at){case Ct:return w;case Gi:return p;case Wt:return m;case Ji:return g;case $i:return y}return me});function Ur(ee){var me=ee.length,Te=ee.constructor(me);return me&&typeof ee[0]=="string"&&mt.call(ee,"index")&&(Te.index=ee.index,Te.input=ee.input),Te}function El(ee){return typeof ee.constructor=="function"&&!_u(ee)?ku(ct(ee)):{}}function RA(ee,me,Te,at){var ir=ee.constructor;switch(me){case I:return vo(ee);case o:case l:return new ir(+ee);case w:return Hs(ee,at);case S:case T:case D:case C:case E:case P:case R:case M:case N:return ls(ee,at);case p:return Hi(ee,at,Te);case f:case v:return new ir(ee);case A:return In(ee);case g:return sn(ee,at,Te);case b:return fc(ee)}}function tm(ee,me){return me=me??n,!!me&&(typeof ee=="number"||F.test(ee))&&ee>-1&&ee%1==0&&ee<me}function so(ee){var me=typeof ee;return me=="string"||me=="number"||me=="symbol"||me=="boolean"?ee!=="__proto__":ee===null}function xu(ee){return!!Tt&&Tt in ee}function _u(ee){var me=ee&&ee.constructor,Te=typeof me=="function"&&me.prototype||ft;return ee===Te}function Da(ee){if(ee!=null){try{return Oe.call(ee)}catch{}try{return ee+""}catch{}}return""}function _f(ee){return Bu(ee,!0,!0)}function MA(ee,me){return ee===me||ee!==ee&&me!==me}function pi(ee){return yp(ee)&&mt.call(ee,"callee")&&(!ht.call(ee,"callee")||Le.call(ee)==a)}var Pa=Array.isArray;function Fr(ee){return ee!=null&&im(ee.length)&&!sl(ee)}function yp(ee){return Ip(ee)&&Fr(ee)}var bp=Se||Dl;function sl(ee){var me=Yn(ee)?Le.call(ee):"";return me==u||me==d}function im(ee){return typeof ee=="number"&&ee>-1&&ee%1==0&&ee<=n}function Yn(ee){var me=typeof ee;return!!ee&&(me=="object"||me=="function")}function Ip(ee){return!!ee&&typeof ee=="object"}function Ou(ee){return Fr(ee)?dc(ee):Cl(ee)}function Ga(){return[]}function Dl(){return!1}t.exports=_f})(zD,zD.exports)),zD.exports}var qD={exports:{}};qD.exports;var cle;function bxe(){return cle||(cle=1,(function(t,e){var i=200,r="__lodash_hash_undefined__",n=1,a=2,s=9007199254740991,o="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",d="[object Date]",p="[object Error]",f="[object Function]",h="[object GeneratorFunction]",m="[object Map]",A="[object Number]",g="[object Null]",v="[object Object]",b="[object Promise]",y="[object Proxy]",I="[object RegExp]",w="[object Set]",S="[object String]",T="[object Symbol]",D="[object Undefined]",C="[object WeakMap]",E="[object ArrayBuffer]",P="[object DataView]",R="[object Float32Array]",M="[object Float64Array]",N="[object Int8Array]",k="[object Int16Array]",O="[object Int32Array]",x="[object Uint8Array]",F="[object Uint8ClampedArray]",_="[object Uint16Array]",V="[object Uint32Array]",G=/[\\^$.*+?()[\]{}|]/g,z=/^\[object .+?Constructor\]$/,Q=/^(?:0|[1-9]\d*)$/,j={};j[R]=j[M]=j[N]=j[k]=j[O]=j[x]=j[F]=j[_]=j[V]=!0,j[o]=j[l]=j[E]=j[u]=j[P]=j[d]=j[p]=j[f]=j[m]=j[A]=j[v]=j[I]=j[w]=j[S]=j[C]=!1;var W=typeof ig=="object"&&ig&&ig.Object===Object&&ig,Y=typeof self=="object"&&self&&self.Object===Object&&self,X=W||Y||Function("return this")(),J=e&&!e.nodeType&&e,ie=J&&!0&&t&&!t.nodeType&&t,ue=ie&&ie.exports===J,ne=ue&&W.process,ge=(function(){try{return ne&&ne.binding&&ne.binding("util")}catch{}})(),he=ge&&ge.isTypedArray;function Ie(ee,me){for(var Te=-1,at=ee==null?0:ee.length,ir=0,Di=[];++Te<at;){var xr=ee[Te];me(xr,Te,ee)&&(Di[ir++]=xr)}return Di}function xe(ee,me){for(var Te=-1,at=me.length,ir=ee.length;++Te<at;)ee[ir+Te]=me[Te];return ee}function Je(ee,me){for(var Te=-1,at=ee==null?0:ee.length;++Te<at;)if(me(ee[Te],Te,ee))return!0;return!1}function qe(ee,me){for(var Te=-1,at=Array(ee);++Te<ee;)at[Te]=me(Te);return at}function dt(ee){return function(me){return ee(me)}}function ft(ee,me){return ee.has(me)}function je(ee,me){return ee?.[me]}function Tt(ee){var me=-1,Te=Array(ee.size);return ee.forEach(function(at,ir){Te[++me]=[ir,at]}),Te}function Oe(ee,me){return function(Te){return ee(me(Te))}}function mt(ee){var me=-1,Te=Array(ee.size);return ee.forEach(function(at){Te[++me]=at}),Te}var Le=Array.prototype,lt=Function.prototype,it=Object.prototype,Fe=X["__core-js_shared__"],Xe=lt.toString,ct=it.hasOwnProperty,We=(function(){var ee=/[^.]+$/.exec(Fe&&Fe.keys&&Fe.keys.IE_PROTO||"");return ee?"Symbol(src)_1."+ee:""})(),ht=it.toString,xt=RegExp("^"+Xe.call(ct).replace(G,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),pe=ue?X.Buffer:void 0,Se=X.Symbol,ye=X.Uint8Array,ke=it.propertyIsEnumerable,Ce=Le.splice,Ke=Se?Se.toStringTag:void 0,_e=Object.getOwnPropertySymbols,wt=pe?pe.isBuffer:void 0,ut=Oe(Object.keys,Object),Ct=Va(X,"DataView"),Gi=Va(X,"Map"),Wt=Va(X,"Promise"),Ji=Va(X,"Set"),$i=Va(X,"WeakMap"),xi=Va(Object,"create"),en=Da(Ct),ra=Da(Gi),oc=Da(Wt),un=Da(Ji),dn=Da($i),Ta=Se?Se.prototype:void 0,ti=Ta?Ta.valueOf:void 0;function pr(ee){var me=-1,Te=ee==null?0:ee.length;for(this.clear();++me<Te;){var at=ee[me];this.set(at[0],at[1])}}function lc(){this.__data__=xi?xi(null):{},this.size=0}function xd(ee){var me=this.has(ee)&&delete this.__data__[ee];return this.size-=me?1:0,me}function Ho(ee){var me=this.__data__;if(xi){var Te=me[ee];return Te===r?void 0:Te}return ct.call(me,ee)?me[ee]:void 0}function no(ee){var me=this.__data__;return xi?me[ee]!==void 0:ct.call(me,ee)}function ao(ee,me){var Te=this.__data__;return this.size+=this.has(ee)?0:1,Te[ee]=xi&&me===void 0?r:me,this}pr.prototype.clear=lc,pr.prototype.delete=xd,pr.prototype.get=Ho,pr.prototype.has=no,pr.prototype.set=ao;function Cn(ee){var me=-1,Te=ee==null?0:ee.length;for(this.clear();++me<Te;){var at=ee[me];this.set(at[0],at[1])}}function Gc(){this.__data__=[],this.size=0}function cc(ee){var me=this.__data__,Te=bs(me,ee);if(Te<0)return!1;var at=me.length-1;return Te==at?me.pop():Ce.call(me,Te,1),--this.size,!0}function Jh(ee){var me=this.__data__,Te=bs(me,ee);return Te<0?void 0:me[Te][1]}function Qc(ee){return bs(this.__data__,ee)>-1}function xf(ee,me){var Te=this.__data__,at=bs(Te,ee);return at<0?(++this.size,Te.push([ee,me])):Te[at][1]=me,this}Cn.prototype.clear=Gc,Cn.prototype.delete=cc,Cn.prototype.get=Jh,Cn.prototype.has=Qc,Cn.prototype.set=xf;function Ca(ee){var me=-1,Te=ee==null?0:ee.length;for(this.clear();++me<Te;){var at=ee[me];this.set(at[0],at[1])}}function Kn(){this.size=0,this.__data__={hash:new pr,map:new(Gi||Cn),string:new pr}}function al(ee){var me=wn(this,ee).delete(ee);return this.size-=me?1:0,me}function Tl(ee){return wn(this,ee).get(ee)}function em(ee){return wn(this,ee).has(ee)}function uc(ee,me){var Te=wn(this,ee),at=Te.size;return Te.set(ee,me),this.size+=Te.size==at?0:1,this}Ca.prototype.clear=Kn,Ca.prototype.delete=al,Ca.prototype.get=Tl,Ca.prototype.has=em,Ca.prototype.set=uc;function dc(ee){var me=-1,Te=ee==null?0:ee.length;for(this.__data__=new Ca;++me<Te;)this.add(ee[me])}function vp(ee){return this.__data__.set(ee,r),this}function pc(ee){return this.__data__.has(ee)}dc.prototype.add=dc.prototype.push=vp,dc.prototype.has=pc;function Ea(ee){var me=this.__data__=new Cn(ee);this.size=me.size}function Bu(){this.__data__=new Cn,this.size=0}function ku(ee){var me=this.__data__,Te=me.delete(ee);return this.size=me.size,Te}function jc(ee){return this.__data__.get(ee)}function Xt(ee){return this.__data__.has(ee)}function xn(ee,me){var Te=this.__data__;if(Te instanceof Cn){var at=Te.__data__;if(!Gi||at.length<i-1)return at.push([ee,me]),this.size=++Te.size,this;Te=this.__data__=new Ca(at)}return Te.set(ee,me),this.size=Te.size,this}Ea.prototype.clear=Bu,Ea.prototype.delete=ku,Ea.prototype.get=jc,Ea.prototype.has=Xt,Ea.prototype.set=xn;function Cl(ee,me){var Te=pi(ee),at=!Te&&MA(ee),ir=!Te&&!at&&Fr(ee),Di=!Te&&!at&&!ir&&Ip(ee),xr=Te||at||ir||Di,Zt=xr?qe(ee.length,String):[],Na=Zt.length;for(var Ar in ee)ct.call(ee,Ar)&&!(xr&&(Ar=="length"||ir&&(Ar=="offset"||Ar=="parent")||Di&&(Ar=="buffer"||Ar=="byteLength"||Ar=="byteOffset")||RA(Ar,Na)))&&Zt.push(Ar);return Zt}function bs(ee,me){for(var Te=ee.length;Te--;)if(_f(ee[Te][0],me))return Te;return-1}function vo(ee,me,Te){var at=me(ee);return pi(ee)?at:xe(at,Te(ee))}function Hs(ee){return ee==null?ee===void 0?D:g:Ke&&Ke in Object(ee)?zc(ee):_u(ee)}function Hi(ee){return Yn(ee)&&Hs(ee)==o}function In(ee,me,Te,at,ir){return ee===me?!0:ee==null||me==null||!Yn(ee)&&!Yn(me)?ee!==ee&&me!==me:sn(ee,me,Te,at,In,ir)}function sn(ee,me,Te,at,ir,Di){var xr=pi(ee),Zt=pi(me),Na=xr?l:El(ee),Ar=Zt?l:El(me);Na=Na==o?v:Na,Ar=Ar==o?v:Ar;var cs=Na==v,Vo=Ar==v,Qa=Na==Ar;if(Qa&&Fr(ee)){if(!Fr(me))return!1;xr=!0,cs=!1}if(Qa&&!cs)return Di||(Di=new Ea),xr||Ip(ee)?et(ee,me,Te,at,ir,Di):Ai(ee,me,Na,Te,at,ir,Di);if(!(Te&n)){var us=cs&&ct.call(ee,"__wrapped__"),Vs=Vo&&ct.call(me,"__wrapped__");if(us||Vs){var hc=us?ee.value():ee,mc=Vs?me.value():me;return Di||(Di=new Ea),ir(hc,mc,Te,at,Di)}}return Qa?(Di||(Di=new Ea),_i(ee,me,Te,at,ir,Di)):!1}function fc(ee){if(!im(ee)||so(ee))return!1;var me=bp(ee)?xt:z;return me.test(Da(ee))}function ls(ee){return Yn(ee)&&sl(ee.length)&&!!j[Hs(ee)]}function _d(ee){if(!xu(ee))return ut(ee);var me=[];for(var Te in Object(ee))ct.call(ee,Te)&&Te!="constructor"&&me.push(Te);return me}function et(ee,me,Te,at,ir,Di){var xr=Te&n,Zt=ee.length,Na=me.length;if(Zt!=Na&&!(xr&&Na>Zt))return!1;var Ar=Di.get(ee);if(Ar&&Di.get(me))return Ar==me;var cs=-1,Vo=!0,Qa=Te&a?new dc:void 0;for(Di.set(ee,me),Di.set(me,ee);++cs<Zt;){var us=ee[cs],Vs=me[cs];if(at)var hc=xr?at(Vs,us,cs,me,ee,Di):at(us,Vs,cs,ee,me,Di);if(hc!==void 0){if(hc)continue;Vo=!1;break}if(Qa){if(!Je(me,function(mc,Fu){if(!ft(Qa,Fu)&&(us===mc||ir(us,mc,Te,at,Di)))return Qa.push(Fu)})){Vo=!1;break}}else if(!(us===Vs||ir(us,Vs,Te,at,Di))){Vo=!1;break}}return Di.delete(ee),Di.delete(me),Vo}function Ai(ee,me,Te,at,ir,Di,xr){switch(Te){case P:if(ee.byteLength!=me.byteLength||ee.byteOffset!=me.byteOffset)return!1;ee=ee.buffer,me=me.buffer;case E:return!(ee.byteLength!=me.byteLength||!Di(new ye(ee),new ye(me)));case u:case d:case A:return _f(+ee,+me);case p:return ee.name==me.name&&ee.message==me.message;case I:case S:return ee==me+"";case m:var Zt=Tt;case w:var Na=at&n;if(Zt||(Zt=mt),ee.size!=me.size&&!Na)return!1;var Ar=xr.get(ee);if(Ar)return Ar==me;at|=a,xr.set(ee,me);var cs=et(Zt(ee),Zt(me),at,ir,Di,xr);return xr.delete(ee),cs;case T:if(ti)return ti.call(ee)==ti.call(me)}return!1}function _i(ee,me,Te,at,ir,Di){var xr=Te&n,Zt=Oi(ee),Na=Zt.length,Ar=Oi(me),cs=Ar.length;if(Na!=cs&&!xr)return!1;for(var Vo=Na;Vo--;){var Qa=Zt[Vo];if(!(xr?Qa in me:ct.call(me,Qa)))return!1}var us=Di.get(ee);if(us&&Di.get(me))return us==me;var Vs=!0;Di.set(ee,me),Di.set(me,ee);for(var hc=xr;++Vo<Na;){Qa=Zt[Vo];var mc=ee[Qa],Fu=me[Qa];if(at)var NA=xr?at(Fu,mc,Qa,me,ee,Di):at(mc,Fu,Qa,ee,me,Di);if(!(NA===void 0?mc===Fu||ir(mc,Fu,Te,at,Di):NA)){Vs=!1;break}hc||(hc=Qa=="constructor")}if(Vs&&!hc){var hv=ee.constructor,Gs=me.constructor;hv!=Gs&&"constructor"in ee&&"constructor"in me&&!(typeof hv=="function"&&hv instanceof hv&&typeof Gs=="function"&&Gs instanceof Gs)&&(Vs=!1)}return Di.delete(ee),Di.delete(me),Vs}function Oi(ee){return vo(ee,Ou,Ur)}function wn(ee,me){var Te=ee.__data__;return tm(me)?Te[typeof me=="string"?"string":"hash"]:Te.map}function Va(ee,me){var Te=je(ee,me);return fc(Te)?Te:void 0}function zc(ee){var me=ct.call(ee,Ke),Te=ee[Ke];try{ee[Ke]=void 0;var at=!0}catch{}var ir=ht.call(ee);return at&&(me?ee[Ke]=Te:delete ee[Ke]),ir}var Ur=_e?function(ee){return ee==null?[]:(ee=Object(ee),Ie(_e(ee),function(me){return ke.call(ee,me)}))}:Ga,El=Hs;(Ct&&El(new Ct(new ArrayBuffer(1)))!=P||Gi&&El(new Gi)!=m||Wt&&El(Wt.resolve())!=b||Ji&&El(new Ji)!=w||$i&&El(new $i)!=C)&&(El=function(ee){var me=Hs(ee),Te=me==v?ee.constructor:void 0,at=Te?Da(Te):"";if(at)switch(at){case en:return P;case ra:return m;case oc:return b;case un:return w;case dn:return C}return me});function RA(ee,me){return me=me??s,!!me&&(typeof ee=="number"||Q.test(ee))&&ee>-1&&ee%1==0&&ee<me}function tm(ee){var me=typeof ee;return me=="string"||me=="number"||me=="symbol"||me=="boolean"?ee!=="__proto__":ee===null}function so(ee){return!!We&&We in ee}function xu(ee){var me=ee&&ee.constructor,Te=typeof me=="function"&&me.prototype||it;return ee===Te}function _u(ee){return ht.call(ee)}function Da(ee){if(ee!=null){try{return Xe.call(ee)}catch{}try{return ee+""}catch{}}return""}function _f(ee,me){return ee===me||ee!==ee&&me!==me}var MA=Hi((function(){return arguments})())?Hi:function(ee){return Yn(ee)&&ct.call(ee,"callee")&&!ke.call(ee,"callee")},pi=Array.isArray;function Pa(ee){return ee!=null&&sl(ee.length)&&!bp(ee)}var Fr=wt||Dl;function yp(ee,me){return In(ee,me)}function bp(ee){if(!im(ee))return!1;var me=Hs(ee);return me==f||me==h||me==c||me==y}function sl(ee){return typeof ee=="number"&&ee>-1&&ee%1==0&&ee<=s}function im(ee){var me=typeof ee;return ee!=null&&(me=="object"||me=="function")}function Yn(ee){return ee!=null&&typeof ee=="object"}var Ip=he?dt(he):ls;function Ou(ee){return Pa(ee)?Cl(ee):_d(ee)}function Ga(){return[]}function Dl(){return!1}t.exports=yp})(qD,qD.exports)),qD.exports}var ck={},ule;function GBt(){if(ule)return ck;ule=1,Object.defineProperty(ck,"__esModule",{value:!0});const t=yxe(),e=bxe();var i;return(function(r){function n(l={},c={},u=!1){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});let d=t(c);u||(d=Object.keys(d).reduce((p,f)=>(d[f]!=null&&(p[f]=d[f]),p),{}));for(const p in l)l[p]!==void 0&&c[p]===void 0&&(d[p]=l[p]);return Object.keys(d).length>0?d:void 0}r.compose=n;function a(l={},c={}){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});const u=Object.keys(l).concat(Object.keys(c)).reduce((d,p)=>(e(l[p],c[p])||(d[p]=c[p]===void 0?null:c[p]),d),{});return Object.keys(u).length>0?u:void 0}r.diff=a;function s(l={},c={}){l=l||{};const u=Object.keys(c).reduce((d,p)=>(c[p]!==l[p]&&l[p]!==void 0&&(d[p]=c[p]),d),{});return Object.keys(l).reduce((d,p)=>(l[p]!==c[p]&&c[p]===void 0&&(d[p]=null),d),u)}r.invert=s;function o(l,c,u=!1){if(typeof l!="object")return c;if(typeof c!="object")return;if(!u)return c;const d=Object.keys(c).reduce((p,f)=>(l[f]===void 0&&(p[f]=c[f]),p),{});return Object.keys(d).length>0?d:void 0}r.transform=o})(i||(i={})),ck.default=i,ck}var uk={},dle;function Ixe(){if(dle)return uk;dle=1,Object.defineProperty(uk,"__esModule",{value:!0});var t;return(function(e){function i(r){return typeof r.delete=="number"?r.delete:typeof r.retain=="number"?r.retain:typeof r.retain=="object"&&r.retain!==null?1:typeof r.insert=="string"?r.insert.length:1}e.length=i})(t||(t={})),uk.default=t,uk}var dk={},ple;function QBt(){if(ple)return dk;ple=1,Object.defineProperty(dk,"__esModule",{value:!0});const t=Ixe();class e{constructor(r){this.ops=r,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(r){r||(r=1/0);const n=this.ops[this.index];if(n){const a=this.offset,s=t.default.length(n);if(r>=s-a?(r=s-a,this.index+=1,this.offset=0):this.offset+=r,typeof n.delete=="number")return{delete:r};{const o={};return n.attributes&&(o.attributes=n.attributes),typeof n.retain=="number"?o.retain=r:typeof n.retain=="object"&&n.retain!==null?o.retain=n.retain:typeof n.insert=="string"?o.insert=n.insert.substr(a,r):o.insert=n.insert,o}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?t.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const r=this.ops[this.index];return r?typeof r.delete=="number"?"delete":typeof r.retain=="number"||typeof r.retain=="object"&&r.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const r=this.offset,n=this.index,a=this.next(),s=this.ops.slice(this.index);return this.offset=r,this.index=n,[a].concat(s)}}else return[]}}return dk.default=e,dk}var fle;function jBt(){return fle||(fle=1,(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const i=VBt(),r=yxe(),n=bxe(),a=GBt();e.AttributeMap=a.default;const s=Ixe();e.Op=s.default;const o=QBt();e.OpIterator=o.default;const l="\0",c=(d,p)=>{if(typeof d!="object"||d===null)throw new Error(`cannot retain a ${typeof d}`);if(typeof p!="object"||p===null)throw new Error(`cannot retain a ${typeof p}`);const f=Object.keys(d)[0];if(!f||f!==Object.keys(p)[0])throw new Error(`embed types not matched: ${f} != ${Object.keys(p)[0]}`);return[f,d[f],p[f]]};class u{constructor(p){Array.isArray(p)?this.ops=p:p!=null&&Array.isArray(p.ops)?this.ops=p.ops:this.ops=[]}static registerEmbed(p,f){this.handlers[p]=f}static unregisterEmbed(p){delete this.handlers[p]}static getHandler(p){const f=this.handlers[p];if(!f)throw new Error(`no handlers for embed type "${p}"`);return f}insert(p,f){const h={};return typeof p=="string"&&p.length===0?this:(h.insert=p,f!=null&&typeof f=="object"&&Object.keys(f).length>0&&(h.attributes=f),this.push(h))}delete(p){return p<=0?this:this.push({delete:p})}retain(p,f){if(typeof p=="number"&&p<=0)return this;const h={retain:p};return f!=null&&typeof f=="object"&&Object.keys(f).length>0&&(h.attributes=f),this.push(h)}push(p){let f=this.ops.length,h=this.ops[f-1];if(p=r(p),typeof h=="object"){if(typeof p.delete=="number"&&typeof h.delete=="number")return this.ops[f-1]={delete:h.delete+p.delete},this;if(typeof h.delete=="number"&&p.insert!=null&&(f-=1,h=this.ops[f-1],typeof h!="object"))return this.ops.unshift(p),this;if(n(p.attributes,h.attributes)){if(typeof p.insert=="string"&&typeof h.insert=="string")return this.ops[f-1]={insert:h.insert+p.insert},typeof p.attributes=="object"&&(this.ops[f-1].attributes=p.attributes),this;if(typeof p.retain=="number"&&typeof h.retain=="number")return this.ops[f-1]={retain:h.retain+p.retain},typeof p.attributes=="object"&&(this.ops[f-1].attributes=p.attributes),this}}return f===this.ops.length?this.ops.push(p):this.ops.splice(f,0,p),this}chop(){const p=this.ops[this.ops.length-1];return p&&typeof p.retain=="number"&&!p.attributes&&this.ops.pop(),this}filter(p){return this.ops.filter(p)}forEach(p){this.ops.forEach(p)}map(p){return this.ops.map(p)}partition(p){const f=[],h=[];return this.forEach(m=>{(p(m)?f:h).push(m)}),[f,h]}reduce(p,f){return this.ops.reduce(p,f)}changeLength(){return this.reduce((p,f)=>f.insert?p+s.default.length(f):f.delete?p-f.delete:p,0)}length(){return this.reduce((p,f)=>p+s.default.length(f),0)}slice(p=0,f=1/0){const h=[],m=new o.default(this.ops);let A=0;for(;A<f&&m.hasNext();){let g;A<p?g=m.next(p-A):(g=m.next(f-A),h.push(g)),A+=s.default.length(g)}return new u(h)}compose(p){const f=new o.default(this.ops),h=new o.default(p.ops),m=[],A=h.peek();if(A!=null&&typeof A.retain=="number"&&A.attributes==null){let v=A.retain;for(;f.peekType()==="insert"&&f.peekLength()<=v;)v-=f.peekLength(),m.push(f.next());A.retain-v>0&&h.next(A.retain-v)}const g=new u(m);for(;f.hasNext()||h.hasNext();)if(h.peekType()==="insert")g.push(h.next());else if(f.peekType()==="delete")g.push(f.next());else{const v=Math.min(f.peekLength(),h.peekLength()),b=f.next(v),y=h.next(v);if(y.retain){const I={};if(typeof b.retain=="number")I.retain=typeof y.retain=="number"?v:y.retain;else if(typeof y.retain=="number")b.retain==null?I.insert=b.insert:I.retain=b.retain;else{const S=b.retain==null?"insert":"retain",[T,D,C]=c(b[S],y.retain),E=u.getHandler(T);I[S]={[T]:E.compose(D,C,S==="retain")}}const w=a.default.compose(b.attributes,y.attributes,typeof b.retain=="number");if(w&&(I.attributes=w),g.push(I),!h.hasNext()&&n(g.ops[g.ops.length-1],I)){const S=new u(f.rest());return g.concat(S).chop()}}else typeof y.delete=="number"&&(typeof b.retain=="number"||typeof b.retain=="object"&&b.retain!==null)&&g.push(y)}return g.chop()}concat(p){const f=new u(this.ops.slice());return p.ops.length>0&&(f.push(p.ops[0]),f.ops=f.ops.concat(p.ops.slice(1))),f}diff(p,f){if(this.ops===p.ops)return new u;const h=[this,p].map(b=>b.map(y=>{if(y.insert!=null)return typeof y.insert=="string"?y.insert:l;const I=b===p?"on":"with";throw new Error("diff() called "+I+" non-document")}).join("")),m=new u,A=i(h[0],h[1],f,!0),g=new o.default(this.ops),v=new o.default(p.ops);return A.forEach(b=>{let y=b[1].length;for(;y>0;){let I=0;switch(b[0]){case i.INSERT:I=Math.min(v.peekLength(),y),m.push(v.next(I));break;case i.DELETE:I=Math.min(y,g.peekLength()),g.next(I),m.delete(I);break;case i.EQUAL:I=Math.min(g.peekLength(),v.peekLength(),y);const w=g.next(I),S=v.next(I);n(w.insert,S.insert)?m.retain(I,a.default.diff(w.attributes,S.attributes)):m.push(S).delete(I);break}y-=I}}),m.chop()}eachLine(p,f=`
`){const h=new o.default(this.ops);let m=new u,A=0;for(;h.hasNext();){if(h.peekType()!=="insert")return;const g=h.peek(),v=s.default.length(g)-h.peekLength(),b=typeof g.insert=="string"?g.insert.indexOf(f,v)-v:-1;if(b<0)m.push(h.next());else if(b>0)m.push(h.next(b));else{if(p(m,h.next(1).attributes||{},A)===!1)return;A+=1,m=new u}}m.length()>0&&p(m,{},A)}invert(p){const f=new u;return this.reduce((h,m)=>{if(m.insert)f.delete(s.default.length(m));else{if(typeof m.retain=="number"&&m.attributes==null)return f.retain(m.retain),h+m.retain;if(m.delete||typeof m.retain=="number"){const A=m.delete||m.retain;return p.slice(h,h+A).forEach(v=>{m.delete?f.push(v):m.retain&&m.attributes&&f.retain(s.default.length(v),a.default.invert(m.attributes,v.attributes))}),h+A}else if(typeof m.retain=="object"&&m.retain!==null){const A=p.slice(h,h+1),g=new o.default(A.ops).next(),[v,b,y]=c(m.retain,g.insert),I=u.getHandler(v);return f.retain({[v]:I.invert(b,y)},a.default.invert(m.attributes,g.attributes)),h+1}}return h},0),f.chop()}transform(p,f=!1){if(f=!!f,typeof p=="number")return this.transformPosition(p,f);const h=p,m=new o.default(this.ops),A=new o.default(h.ops),g=new u;for(;m.hasNext()||A.hasNext();)if(m.peekType()==="insert"&&(f||A.peekType()!=="insert"))g.retain(s.default.length(m.next()));else if(A.peekType()==="insert")g.push(A.next());else{const v=Math.min(m.peekLength(),A.peekLength()),b=m.next(v),y=A.next(v);if(b.delete)continue;if(y.delete)g.push(y);else{const I=b.retain,w=y.retain;let S=typeof w=="object"&&w!==null?w:v;if(typeof I=="object"&&I!==null&&typeof w=="object"&&w!==null){const T=Object.keys(I)[0];if(T===Object.keys(w)[0]){const D=u.getHandler(T);D&&(S={[T]:D.transform(I[T],w[T],f)})}}g.retain(S,a.default.transform(b.attributes,y.attributes,f))}}return g.chop()}transformPosition(p,f=!1){f=!!f;const h=new o.default(this.ops);let m=0;for(;h.hasNext()&&m<=p;){const A=h.peekLength(),g=h.peekType();if(h.next(),g==="delete"){p-=Math.min(A,p-m);continue}else g==="insert"&&(m<p||!f)&&(p+=A);m+=A}return p}}u.Op=s.default,u.OpIterator=o.default,u.AttributeMap=a.default,u.handlers={},e.default=u,t.exports=u,t.exports.default=u})(lk,lk.exports)),lk.exports}var Gp=jBt();const Ti=EH(Gp);class Xh extends mp{static value(){}optimize(){(this.prev||this.next)&&this.remove()}length(){return 0}value(){return""}}Xh.blotName="break";Xh.tagName="BR";let Oh=class extends _O{};const zBt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function aV(t){return t.replace(/[&<>"']/g,e=>zBt[e])}class eu extends uJ{static allowedChildren=[eu,Xh,mp,Oh];static order=["cursor","inline","link","underline","strike","italic","bold","script","code"];static compare(e,i){const r=eu.order.indexOf(e),n=eu.order.indexOf(i);return r>=0||n>=0?r-n:e===i?0:e<i?-1:1}formatAt(e,i,r,n){if(eu.compare(this.statics.blotName,r)<0&&this.scroll.query(r,Pi.BLOT)){const a=this.isolate(e,i);n&&a.wrap(r,n)}else super.formatAt(e,i,r,n)}optimize(e){if(super.optimize(e),this.parent instanceof eu&&eu.compare(this.statics.blotName,this.parent.statics.blotName)>0){const i=this.parent.isolate(this.offset(),this.length());this.moveChildren(i),i.wrap(this)}}}const hle=1;class Hl extends S1{cache={};delta(){return this.cache.delta==null&&(this.cache.delta=wxe(this)),this.cache.delta}deleteAt(e,i){super.deleteAt(e,i),this.cache={}}formatAt(e,i,r,n){i<=0||(this.scroll.query(r,Pi.BLOCK)?e+i===this.length()&&this.format(r,n):super.formatAt(e,Math.min(i,this.length()-e-1),r,n),this.cache={})}insertAt(e,i,r){if(r!=null){super.insertAt(e,i,r),this.cache={};return}if(i.length===0)return;const n=i.split(`
`),a=n.shift();a.length>0&&(e<this.length()-1||this.children.tail==null?super.insertAt(Math.min(e,this.length()-1),a):this.children.tail.insertAt(this.children.tail.length(),a),this.cache={});let s=this;n.reduce((o,l)=>(s=s.split(o,!0),s.insertAt(0,l),l.length),e+a.length)}insertBefore(e,i){const{head:r}=this.children;super.insertBefore(e,i),r instanceof Xh&&r.remove(),this.cache={}}length(){return this.cache.length==null&&(this.cache.length=super.length()+hle),this.cache.length}moveChildren(e,i){super.moveChildren(e,i),this.cache={}}optimize(e){super.optimize(e),this.cache={}}path(e){return super.path(e,!0)}removeChild(e){super.removeChild(e),this.cache={}}split(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(i&&(e===0||e>=this.length()-hle)){const n=this.clone();return e===0?(this.parent.insertBefore(n,this),this):(this.parent.insertBefore(n,this.next),n)}const r=super.split(e,i);return this.cache={},r}}Hl.blotName="block";Hl.tagName="P";Hl.defaultChild=Xh;Hl.allowedChildren=[Xh,eu,mp,Oh];class Fp extends mp{attach(){super.attach(),this.attributes=new rV(this.domNode)}delta(){return new Ti().insert(this.value(),{...this.formats(),...this.attributes.values()})}format(e,i){const r=this.scroll.query(e,Pi.BLOCK_ATTRIBUTE);r!=null&&this.attributes.attribute(r,i)}formatAt(e,i,r,n){this.format(r,n)}insertAt(e,i,r){if(r!=null){super.insertAt(e,i,r);return}const n=i.split(`
`),a=n.pop(),s=n.map(l=>{const c=this.scroll.create(Hl.blotName);return c.insertAt(0,l),c}),o=this.split(e);s.forEach(l=>{this.parent.insertBefore(l,o)}),a&&this.parent.insertBefore(this.scroll.create("text",a),o)}}Fp.scope=Pi.BLOCK_BLOT;function wxe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return t.descendants(Ic).reduce((i,r)=>r.length()===0?i:i.insert(r.value(),xp(r,{},e)),new Ti).insert(`
`,xp(t))}function xp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return t==null||("formats"in t&&typeof t.formats=="function"&&(e={...e,...t.formats()},i&&delete e["code-token"]),t.parent==null||t.parent.statics.blotName==="scroll"||t.parent.statics.scope!==t.statics.scope)?e:xp(t.parent,e,i)}class qf extends mp{static blotName="cursor";static className="ql-cursor";static tagName="span";static CONTENTS="\uFEFF";static value(){}constructor(e,i,r){super(e,i),this.selection=r,this.textNode=document.createTextNode(qf.CONTENTS),this.domNode.appendChild(this.textNode),this.savedLength=0}detach(){this.parent!=null&&this.parent.removeChild(this)}format(e,i){if(this.savedLength!==0){super.format(e,i);return}let r=this,n=0;for(;r!=null&&r.statics.scope!==Pi.BLOCK_BLOT;)n+=r.offset(r.parent),r=r.parent;r!=null&&(this.savedLength=qf.CONTENTS.length,r.optimize(),r.formatAt(n,qf.CONTENTS.length,e,i),this.savedLength=0)}index(e,i){return e===this.textNode?0:super.index(e,i)}length(){return this.savedLength}position(){return[this.textNode,this.textNode.data.length]}remove(){super.remove(),this.parent=null}restore(){if(this.selection.composing||this.parent==null)return null;const e=this.selection.getNativeRange();for(;this.domNode.lastChild!=null&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);const i=this.prev instanceof Oh?this.prev:null,r=i?i.length():0,n=this.next instanceof Oh?this.next:null,a=n?n.text:"",{textNode:s}=this,o=s.data.split(qf.CONTENTS).join("");s.data=qf.CONTENTS;let l;if(i)l=i,(o||n)&&(i.insertAt(i.length(),o+a),n&&n.remove());else if(n)l=n,n.insertAt(0,o);else{const c=document.createTextNode(o);l=this.scroll.create(c),this.parent.insertBefore(l,this)}if(this.remove(),e){const c=(p,f)=>i&&p===i.domNode?f:p===s?r+f-1:n&&p===n.domNode?r+o.length+f:null,u=c(e.start.node,e.start.offset),d=c(e.end.node,e.end.offset);if(u!==null&&d!==null)return{startNode:l.domNode,startOffset:u,endNode:l.domNode,endOffset:d}}return null}update(e,i){if(e.some(r=>r.type==="characterData"&&r.target===this.textNode)){const r=this.restore();r&&(i.range=r)}}optimize(e){super.optimize(e);let{parent:i}=this;for(;i;){if(i.domNode.tagName==="A"){this.savedLength=qf.CONTENTS.length,i.isolate(this.offset(i),this.length()).unwrap(),this.savedLength=0;break}i=i.parent}}value(){return""}}var FQ={exports:{}},mle;function qBt(){return mle||(mle=1,(function(t){var e=Object.prototype.hasOwnProperty,i="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(i=!1));function n(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function a(l,c,u,d,p){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new n(u,d||l,p),h=i?i+c:c;return l._events[h]?l._events[h].fn?l._events[h]=[l._events[h],f]:l._events[h].push(f):(l._events[h]=f,l._eventsCount++),l}function s(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(i?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},o.prototype.listeners=function(c){var u=i?i+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var p=0,f=d.length,h=new Array(f);p<f;p++)h[p]=d[p].fn;return h},o.prototype.listenerCount=function(c){var u=i?i+c:c,d=this._events[u];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,u,d,p,f,h){var m=i?i+c:c;if(!this._events[m])return!1;var A=this._events[m],g=arguments.length,v,b;if(A.fn){switch(A.once&&this.removeListener(c,A.fn,void 0,!0),g){case 1:return A.fn.call(A.context),!0;case 2:return A.fn.call(A.context,u),!0;case 3:return A.fn.call(A.context,u,d),!0;case 4:return A.fn.call(A.context,u,d,p),!0;case 5:return A.fn.call(A.context,u,d,p,f),!0;case 6:return A.fn.call(A.context,u,d,p,f,h),!0}for(b=1,v=new Array(g-1);b<g;b++)v[b-1]=arguments[b];A.fn.apply(A.context,v)}else{var y=A.length,I;for(b=0;b<y;b++)switch(A[b].once&&this.removeListener(c,A[b].fn,void 0,!0),g){case 1:A[b].fn.call(A[b].context);break;case 2:A[b].fn.call(A[b].context,u);break;case 3:A[b].fn.call(A[b].context,u,d);break;case 4:A[b].fn.call(A[b].context,u,d,p);break;default:if(!v)for(I=1,v=new Array(g-1);I<g;I++)v[I-1]=arguments[I];A[b].fn.apply(A[b].context,v)}}return!0},o.prototype.on=function(c,u,d){return a(this,c,u,d,!1)},o.prototype.once=function(c,u,d){return a(this,c,u,d,!0)},o.prototype.removeListener=function(c,u,d,p){var f=i?i+c:c;if(!this._events[f])return this;if(!u)return s(this,f),this;var h=this._events[f];if(h.fn)h.fn===u&&(!p||h.once)&&(!d||h.context===d)&&s(this,f);else{for(var m=0,A=[],g=h.length;m<g;m++)(h[m].fn!==u||p&&!h[m].once||d&&h[m].context!==d)&&A.push(h[m]);A.length?this._events[f]=A.length===1?A[0]:A:s(this,f)}return this},o.prototype.removeAllListeners=function(c){var u;return c?(u=i?i+c:c,this._events[u]&&s(this,u)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,t.exports=o})(FQ)),FQ.exports}var WBt=qBt();const KBt=EH(WBt),Rz=new WeakMap,Mz=["error","warn","log","info"];let Nz="warn";function Sxe(t){if(Nz&&Mz.indexOf(t)<=Mz.indexOf(Nz)){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];console[t](...i)}}function fv(t){return Mz.reduce((e,i)=>(e[i]=Sxe.bind(console,i,t),e),{})}fv.level=t=>{Nz=t};Sxe.level=fv.level;const LQ=fv("quill:events"),YBt=["selectionchange","mousedown","mouseup","click"];YBt.forEach(t=>{document.addEventListener(t,function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];Array.from(document.querySelectorAll(".ql-container")).forEach(n=>{const a=Rz.get(n);a&&a.emitter&&a.emitter.handleDOM(...i)})})});class vi extends KBt{static events={EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_BLOT_MOUNT:"scroll-blot-mount",SCROLL_BLOT_UNMOUNT:"scroll-blot-unmount",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SCROLL_EMBED_UPDATE:"scroll-embed-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change",COMPOSITION_BEFORE_START:"composition-before-start",COMPOSITION_START:"composition-start",COMPOSITION_BEFORE_END:"composition-before-end",COMPOSITION_END:"composition-end"};static sources={API:"api",SILENT:"silent",USER:"user"};constructor(){super(),this.domListeners={},this.on("error",LQ.error)}emit(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return LQ.log.call(LQ,...i),super.emit(...i)}handleDOM(e){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];(this.domListeners[e.type]||[]).forEach(a=>{let{node:s,handler:o}=a;(e.target===s||s.contains(e.target))&&o(e,...r)})}listenDOM(e,i,r){this.domListeners[e]||(this.domListeners[e]=[]),this.domListeners[e].push({node:i,handler:r})}}const $Q=fv("quill:selection");class vw{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.index=e,this.length=i}}class XBt{constructor(e,i){this.emitter=i,this.scroll=e,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=this.scroll.create("cursor",this),this.savedRange=new vw(0,0),this.lastRange=this.savedRange,this.lastNative=null,this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,()=>{!this.mouseDown&&!this.composing&&setTimeout(this.update.bind(this,vi.sources.USER),1)}),this.emitter.on(vi.events.SCROLL_BEFORE_UPDATE,()=>{if(!this.hasFocus())return;const r=this.getNativeRange();r!=null&&r.start.node!==this.cursor.textNode&&this.emitter.once(vi.events.SCROLL_UPDATE,(n,a)=>{try{this.root.contains(r.start.node)&&this.root.contains(r.end.node)&&this.setNativeRange(r.start.node,r.start.offset,r.end.node,r.end.offset);const s=a.some(o=>o.type==="characterData"||o.type==="childList"||o.type==="attributes"&&o.target===this.root);this.update(s?vi.sources.SILENT:n)}catch{}})}),this.emitter.on(vi.events.SCROLL_OPTIMIZE,(r,n)=>{if(n.range){const{startNode:a,startOffset:s,endNode:o,endOffset:l}=n.range;this.setNativeRange(a,s,o,l),this.update(vi.sources.SILENT)}}),this.update(vi.sources.SILENT)}handleComposition(){this.emitter.on(vi.events.COMPOSITION_BEFORE_START,()=>{this.composing=!0}),this.emitter.on(vi.events.COMPOSITION_END,()=>{if(this.composing=!1,this.cursor.parent){const e=this.cursor.restore();if(!e)return;setTimeout(()=>{this.setNativeRange(e.startNode,e.startOffset,e.endNode,e.endOffset)},1)}})}handleDragging(){this.emitter.listenDOM("mousedown",document.body,()=>{this.mouseDown=!0}),this.emitter.listenDOM("mouseup",document.body,()=>{this.mouseDown=!1,this.update(vi.sources.USER)})}focus(){this.hasFocus()||(this.root.focus({preventScroll:!0}),this.setRange(this.savedRange))}format(e,i){this.scroll.update();const r=this.getNativeRange();if(!(r==null||!r.native.collapsed||this.scroll.query(e,Pi.BLOCK))){if(r.start.node!==this.cursor.textNode){const n=this.scroll.find(r.start.node,!1);if(n==null)return;if(n instanceof Ic){const a=n.split(r.start.offset);n.parent.insertBefore(this.cursor,a)}else n.insertBefore(this.cursor,r.start.node);this.cursor.attach()}this.cursor.format(e,i),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}getBounds(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const r=this.scroll.length();e=Math.min(e,r-1),i=Math.min(e+i,r-1)-e;let n,[a,s]=this.scroll.leaf(e);if(a==null)return null;if(i>0&&s===a.length()){const[u]=this.scroll.leaf(e+1);if(u){const[d]=this.scroll.line(e),[p]=this.scroll.line(e+1);d===p&&(a=u,s=0)}}[n,s]=a.position(s,!0);const o=document.createRange();if(i>0)return o.setStart(n,s),[a,s]=this.scroll.leaf(e+i),a==null?null:([n,s]=a.position(s,!0),o.setEnd(n,s),o.getBoundingClientRect());let l="left",c;if(n instanceof Text){if(!n.data.length)return null;s<n.data.length?(o.setStart(n,s),o.setEnd(n,s+1)):(o.setStart(n,s-1),o.setEnd(n,s),l="right"),c=o.getBoundingClientRect()}else{if(!(a.domNode instanceof Element))return null;c=a.domNode.getBoundingClientRect(),s>0&&(l="right")}return{bottom:c.top+c.height,height:c.height,left:c[l],right:c[l],top:c.top,width:0}}getNativeRange(){const e=document.getSelection();if(e==null||e.rangeCount<=0)return null;const i=e.getRangeAt(0);if(i==null)return null;const r=this.normalizeNative(i);return $Q.info("getNativeRange",r),r}getRange(){const e=this.scroll.domNode;if("isConnected"in e&&!e.isConnected)return[null,null];const i=this.getNativeRange();return i==null?[null,null]:[this.normalizedToRange(i),i]}hasFocus(){return document.activeElement===this.root||document.activeElement!=null&&HQ(this.root,document.activeElement)}normalizedToRange(e){const i=[[e.start.node,e.start.offset]];e.native.collapsed||i.push([e.end.node,e.end.offset]);const r=i.map(s=>{const[o,l]=s,c=this.scroll.find(o,!0),u=c.offset(this.scroll);return l===0?u:c instanceof Ic?u+c.index(o,l):u+c.length()}),n=Math.min(Math.max(...r),this.scroll.length()-1),a=Math.min(n,...r);return new vw(a,n-a)}normalizeNative(e){if(!HQ(this.root,e.startContainer)||!e.collapsed&&!HQ(this.root,e.endContainer))return null;const i={start:{node:e.startContainer,offset:e.startOffset},end:{node:e.endContainer,offset:e.endOffset},native:e};return[i.start,i.end].forEach(r=>{let{node:n,offset:a}=r;for(;!(n instanceof Text)&&n.childNodes.length>0;)if(n.childNodes.length>a)n=n.childNodes[a],a=0;else if(n.childNodes.length===a)n=n.lastChild,n instanceof Text?a=n.data.length:n.childNodes.length>0?a=n.childNodes.length:a=n.childNodes.length+1;else break;r.node=n,r.offset=a}),i}rangeToNative(e){const i=this.scroll.length(),r=(n,a)=>{n=Math.min(i-1,n);const[s,o]=this.scroll.leaf(n);return s?s.position(o,a):[null,-1]};return[...r(e.index,!1),...r(e.index+e.length,!0)]}setNativeRange(e,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:i,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if($Q.info("setNativeRange",e,i,r,n),e!=null&&(this.root.parentNode==null||e.parentNode==null||r.parentNode==null))return;const s=document.getSelection();if(s!=null)if(e!=null){this.hasFocus()||this.root.focus({preventScroll:!0});const{native:o}=this.getNativeRange()||{};if(o==null||a||e!==o.startContainer||i!==o.startOffset||r!==o.endContainer||n!==o.endOffset){e instanceof Element&&e.tagName==="BR"&&(i=Array.from(e.parentNode.childNodes).indexOf(e),e=e.parentNode),r instanceof Element&&r.tagName==="BR"&&(n=Array.from(r.parentNode.childNodes).indexOf(r),r=r.parentNode);const l=document.createRange();l.setStart(e,i),l.setEnd(r,n),s.removeAllRanges(),s.addRange(l)}}else s.removeAllRanges(),this.root.blur()}setRange(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vi.sources.API;if(typeof i=="string"&&(r=i,i=!1),$Q.info("setRange",e),e!=null){const n=this.rangeToNative(e);this.setNativeRange(...n,i)}else this.setNativeRange(null);this.update(r)}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:vi.sources.USER;const i=this.lastRange,[r,n]=this.getRange();if(this.lastRange=r,this.lastNative=n,this.lastRange!=null&&(this.savedRange=this.lastRange),!cJ(i,this.lastRange)){if(!this.composing&&n!=null&&n.native.collapsed&&n.start.node!==this.cursor.textNode){const s=this.cursor.restore();s&&this.setNativeRange(s.startNode,s.startOffset,s.endNode,s.endOffset)}const a=[vi.events.SELECTION_CHANGE,sT(this.lastRange),sT(i),e];this.emitter.emit(vi.events.EDITOR_CHANGE,...a),e!==vi.sources.SILENT&&this.emitter.emit(...a)}}}function HQ(t,e){try{e.parentNode}catch{return!1}return t.contains(e)}const ZBt=/^[ -~]*$/;class JBt{constructor(e){this.scroll=e,this.delta=this.getDelta()}applyDelta(e){this.scroll.update();let i=this.scroll.length();this.scroll.batchStart();const r=Ale(e),n=new Ti;return tkt(r.ops.slice()).reduce((s,o)=>{const l=Gp.Op.length(o);let c=o.attributes||{},u=!1,d=!1;if(o.insert!=null){if(n.retain(l),typeof o.insert=="string"){const h=o.insert;d=!h.endsWith(`
`)&&(i<=s||!!this.scroll.descendant(Fp,s)[0]),this.scroll.insertAt(s,h);const[m,A]=this.scroll.line(s);let g=fy({},xp(m));if(m instanceof Hl){const[v]=m.descendant(Ic,A);v&&(g=fy(g,xp(v)))}c=Gp.AttributeMap.diff(g,c)||{}}else if(typeof o.insert=="object"){const h=Object.keys(o.insert)[0];if(h==null)return s;const m=this.scroll.query(h,Pi.INLINE)!=null;if(m)(i<=s||this.scroll.descendant(Fp,s)[0])&&(d=!0);else if(s>0){const[A,g]=this.scroll.descendant(Ic,s-1);A instanceof Oh?A.value()[g]!==`
`&&(u=!0):A instanceof mp&&A.statics.scope===Pi.INLINE_BLOT&&(u=!0)}if(this.scroll.insertAt(s,h,o.insert[h]),m){const[A]=this.scroll.descendant(Ic,s);if(A){const g=fy({},xp(A));c=Gp.AttributeMap.diff(g,c)||{}}}}i+=l}else if(n.push(o),o.retain!==null&&typeof o.retain=="object"){const h=Object.keys(o.retain)[0];if(h==null)return s;this.scroll.updateEmbedAt(s,h,o.retain[h])}Object.keys(c).forEach(h=>{this.scroll.formatAt(s,l,h,c[h])});const p=u?1:0,f=d?1:0;return i+=p+f,n.retain(p),n.delete(f),s+l+p+f},0),n.reduce((s,o)=>typeof o.delete=="number"?(this.scroll.deleteAt(s,o.delete),s):s+Gp.Op.length(o),0),this.scroll.batchEnd(),this.scroll.optimize(),this.update(r)}deleteText(e,i){return this.scroll.deleteAt(e,i),this.update(new Ti().retain(e).delete(i))}formatLine(e,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.scroll.update(),Object.keys(r).forEach(a=>{this.scroll.lines(e,Math.max(i,1)).forEach(s=>{s.format(a,r[a])})}),this.scroll.optimize();const n=new Ti().retain(e).retain(i,sT(r));return this.update(n)}formatText(e,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.keys(r).forEach(a=>{this.scroll.formatAt(e,i,a,r[a])});const n=new Ti().retain(e).retain(i,sT(r));return this.update(n)}getContents(e,i){return this.delta.slice(e,e+i)}getDelta(){return this.scroll.lines().reduce((e,i)=>e.concat(i.delta()),new Ti)}getFormat(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=[],n=[];i===0?this.scroll.path(e).forEach(o=>{const[l]=o;l instanceof Hl?r.push(l):l instanceof Ic&&n.push(l)}):(r=this.scroll.lines(e,i),n=this.scroll.descendants(Ic,e,i));const[a,s]=[r,n].map(o=>{const l=o.shift();if(l==null)return{};let c=xp(l);for(;Object.keys(c).length>0;){const u=o.shift();if(u==null)return c;c=ekt(xp(u),c)}return c});return{...a,...s}}getHTML(e,i){const[r,n]=this.scroll.line(e);if(r){const a=r.length();return r.length()>=n+i&&!(n===0&&i===a)?U1(r,n,i,!0):U1(this.scroll,e,i,!0)}return""}getText(e,i){return this.getContents(e,i).filter(r=>typeof r.insert=="string").map(r=>r.insert).join("")}insertContents(e,i){const r=Ale(i),n=new Ti().retain(e).concat(r);return this.scroll.insertContents(e,r),this.update(n)}insertEmbed(e,i,r){return this.scroll.insertAt(e,i,r),this.update(new Ti().retain(e).insert({[i]:r}))}insertText(e,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return i=i.replace(/\r\n/g,`
`).replace(/\r/g,`
`),this.scroll.insertAt(e,i),Object.keys(r).forEach(n=>{this.scroll.formatAt(e,i.length,n,r[n])}),this.update(new Ti().retain(e).insert(i,sT(r)))}isBlank(){if(this.scroll.children.length===0)return!0;if(this.scroll.children.length>1)return!1;const e=this.scroll.children.head;if(e?.statics.blotName!==Hl.blotName)return!1;const i=e;return i.children.length>1?!1:i.children.head instanceof Xh}removeFormat(e,i){const r=this.getText(e,i),[n,a]=this.scroll.line(e+i);let s=0,o=new Ti;n!=null&&(s=n.length()-a,o=n.delta().slice(a,a+s-1).insert(`
`));const c=this.getContents(e,i+s).diff(new Ti().insert(r).concat(o)),u=new Ti().retain(e).concat(c);return this.applyDelta(u)}update(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;const n=this.delta;if(i.length===1&&i[0].type==="characterData"&&i[0].target.data.match(ZBt)&&this.scroll.find(i[0].target)){const a=this.scroll.find(i[0].target),s=xp(a),o=a.offset(this.scroll),l=i[0].oldValue.replace(qf.CONTENTS,""),c=new Ti().insert(l),u=new Ti().insert(a.value()),d=r&&{oldRange:gle(r.oldRange,-o),newRange:gle(r.newRange,-o)};e=new Ti().retain(o).concat(c.diff(u,d)).reduce((f,h)=>h.insert?f.insert(h.insert,s):f.push(h),new Ti),this.delta=n.compose(e)}else this.delta=this.getDelta(),(!e||!cJ(n.compose(e),this.delta))&&(e=n.diff(this.delta,r));return e}}function BU(t,e,i){if(t.length===0){const[f]=VQ(i.pop());return e<=0?`</li></${f}>`:`</li></${f}>${BU([],e-1,i)}`}const[{child:r,offset:n,length:a,indent:s,type:o},...l]=t,[c,u]=VQ(o);if(s>e)return i.push(o),s===e+1?`<${c}><li${u}>${U1(r,n,a)}${BU(l,s,i)}`:`<${c}><li>${BU(t,e+1,i)}`;const d=i[i.length-1];if(s===e&&o===d)return`</li><li${u}>${U1(r,n,a)}${BU(l,s,i)}`;const[p]=VQ(i.pop());return`</li></${p}>${BU(t,e-1,i)}`}function U1(t,e,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if("html"in t&&typeof t.html=="function")return t.html(e,i);if(t instanceof Oh)return aV(t.value().slice(e,e+i)).replaceAll(" ","&nbsp;");if(t instanceof dh){if(t.statics.blotName==="list-container"){const c=[];return t.children.forEachAt(e,i,(u,d,p)=>{const f="formats"in u&&typeof u.formats=="function"?u.formats():{};c.push({child:u,offset:d,length:p,indent:f.indent||0,type:f.list})}),BU(c,-1,[])}const n=[];if(t.children.forEachAt(e,i,(c,u,d)=>{n.push(U1(c,u,d))}),r||t.statics.blotName==="list")return n.join("");const{outerHTML:a,innerHTML:s}=t.domNode,[o,l]=a.split(`>${s}<`);return o==="<table"?`<table style="border: 1px solid #000;">${n.join("")}<${l}`:`${o}>${n.join("")}<${l}`}return t.domNode instanceof Element?t.domNode.outerHTML:""}function ekt(t,e){return Object.keys(e).reduce((i,r)=>{if(t[r]==null)return i;const n=e[r];return n===t[r]?i[r]=n:Array.isArray(n)?n.indexOf(t[r])<0?i[r]=n.concat([t[r]]):i[r]=n:i[r]=[n,t[r]],i},{})}function VQ(t){const e=t==="ordered"?"ol":"ul";switch(t){case"checked":return[e,' data-list="checked"'];case"unchecked":return[e,' data-list="unchecked"'];default:return[e,""]}}function Ale(t){return t.reduce((e,i)=>{if(typeof i.insert=="string"){const r=i.insert.replace(/\r\n/g,`
`).replace(/\r/g,`
`);return e.insert(r,i.attributes)}return e.push(i)},new Ti)}function gle(t,e){let{index:i,length:r}=t;return new vw(i+e,r)}function tkt(t){const e=[];return t.forEach(i=>{typeof i.insert=="string"?i.insert.split(`
`).forEach((n,a)=>{a&&e.push({insert:`
`,attributes:i.attributes}),n&&e.push({insert:n,attributes:i.attributes})}):e.push(i)}),e}class PA{static DEFAULTS={};constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.quill=e,this.options=i}}const pk="\uFEFF";class pJ extends mp{constructor(e,i){super(e,i),this.contentNode=document.createElement("span"),this.contentNode.setAttribute("contenteditable","false"),Array.from(this.domNode.childNodes).forEach(r=>{this.contentNode.appendChild(r)}),this.leftGuard=document.createTextNode(pk),this.rightGuard=document.createTextNode(pk),this.domNode.appendChild(this.leftGuard),this.domNode.appendChild(this.contentNode),this.domNode.appendChild(this.rightGuard)}index(e,i){return e===this.leftGuard?0:e===this.rightGuard?1:super.index(e,i)}restore(e){let i=null,r;const n=e.data.split(pk).join("");if(e===this.leftGuard)if(this.prev instanceof Oh){const a=this.prev.length();this.prev.insertAt(a,n),i={startNode:this.prev.domNode,startOffset:a+n.length}}else r=document.createTextNode(n),this.parent.insertBefore(this.scroll.create(r),this),i={startNode:r,startOffset:n.length};else e===this.rightGuard&&(this.next instanceof Oh?(this.next.insertAt(0,n),i={startNode:this.next.domNode,startOffset:n.length}):(r=document.createTextNode(n),this.parent.insertBefore(this.scroll.create(r),this.next),i={startNode:r,startOffset:n.length}));return e.data=pk,i}update(e,i){e.forEach(r=>{if(r.type==="characterData"&&(r.target===this.leftGuard||r.target===this.rightGuard)){const n=this.restore(r.target);n&&(i.range=n)}})}}class ikt{isComposing=!1;constructor(e,i){this.scroll=e,this.emitter=i,this.setupListeners()}setupListeners(){this.scroll.domNode.addEventListener("compositionstart",e=>{this.isComposing||this.handleCompositionStart(e)}),this.scroll.domNode.addEventListener("compositionend",e=>{this.isComposing&&queueMicrotask(()=>{this.handleCompositionEnd(e)})})}handleCompositionStart(e){const i=e.target instanceof Node?this.scroll.find(e.target,!0):null;i&&!(i instanceof pJ)&&(this.emitter.emit(vi.events.COMPOSITION_BEFORE_START,e),this.scroll.batchStart(),this.emitter.emit(vi.events.COMPOSITION_START,e),this.isComposing=!0)}handleCompositionEnd(e){this.emitter.emit(vi.events.COMPOSITION_BEFORE_END,e),this.scroll.batchEnd(),this.emitter.emit(vi.events.COMPOSITION_END,e),this.isComposing=!1}}class qE{static DEFAULTS={modules:{}};static themes={default:qE};modules={};constructor(e,i){this.quill=e,this.options=i}init(){Object.keys(this.options.modules).forEach(e=>{this.modules[e]==null&&this.addModule(e)})}addModule(e){const i=this.quill.constructor.import(`modules/${e}`);return this.modules[e]=new i(this.quill,this.options.modules[e]||{}),this.modules[e]}}const rkt=t=>t.parentElement||t.getRootNode().host||null,nkt=t=>{const e=t.getBoundingClientRect(),i="offsetWidth"in t&&Math.abs(e.width)/t.offsetWidth||1,r="offsetHeight"in t&&Math.abs(e.height)/t.offsetHeight||1;return{top:e.top,right:e.left+t.clientWidth*i,bottom:e.top+t.clientHeight*r,left:e.left}},fk=t=>{const e=parseInt(t,10);return Number.isNaN(e)?0:e},vle=(t,e,i,r,n,a)=>t<i&&e>r?0:t<i?-(i-t+n):e>r?e-t>r-i?t+n-i:e-r+a:0,akt=(t,e)=>{const i=t.ownerDocument;let r=e,n=t;for(;n;){const a=n===i.body,s=a?{top:0,right:window.visualViewport?.width??i.documentElement.clientWidth,bottom:window.visualViewport?.height??i.documentElement.clientHeight,left:0}:nkt(n),o=getComputedStyle(n),l=vle(r.left,r.right,s.left,s.right,fk(o.scrollPaddingLeft),fk(o.scrollPaddingRight)),c=vle(r.top,r.bottom,s.top,s.bottom,fk(o.scrollPaddingTop),fk(o.scrollPaddingBottom));if(l||c)if(a)i.defaultView?.scrollBy(l,c);else{const{scrollLeft:u,scrollTop:d}=n;c&&(n.scrollTop+=c),l&&(n.scrollLeft+=l);const p=n.scrollLeft-u,f=n.scrollTop-d;r={left:r.left-p,top:r.top-f,right:r.right-p,bottom:r.bottom-f}}n=a||o.position==="fixed"?null:rkt(n)}},skt=100,okt=["block","break","cursor","inline","scroll","text"],lkt=(t,e,i)=>{const r=new IC;return okt.forEach(n=>{const a=e.query(n);a&&r.register(a)}),t.forEach(n=>{let a=e.query(n);a||i.error(`Cannot register "${n}" specified in "formats" config. Are you sure it was registered?`);let s=0;for(;a;)if(r.register(a),a="blotName"in a?a.requiredContainer??null:null,s+=1,s>skt){i.error(`Cycle detected in registering blot requiredContainer: "${n}"`);break}}),r},lT=fv("quill"),hk=new IC;dh.uiClass="ql-ui";class pt{static DEFAULTS={bounds:null,modules:{clipboard:!0,keyboard:!0,history:!0,uploader:!0},placeholder:"",readOnly:!1,registry:hk,theme:"default"};static events=vi.events;static sources=vi.sources;static version="2.0.3";static imports={delta:Ti,parchment:HBt,"core/module":PA,"core/theme":qE};static debug(e){e===!0&&(e="log"),fv.level(e)}static find(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return Rz.get(e)||hk.find(e,i)}static import(e){return this.imports[e]==null&&lT.error(`Cannot import ${e}. Are you sure it was registered?`),this.imports[e]}static register(){if(typeof(arguments.length<=0?void 0:arguments[0])!="string"){const e=arguments.length<=0?void 0:arguments[0],i=!!(!(arguments.length<=1)&&arguments[1]),r="attrName"in e?e.attrName:e.blotName;typeof r=="string"?this.register(`formats/${r}`,e,i):Object.keys(e).forEach(n=>{this.register(n,e[n],i)})}else{const e=arguments.length<=0?void 0:arguments[0],i=arguments.length<=1?void 0:arguments[1],r=!!(!(arguments.length<=2)&&arguments[2]);this.imports[e]!=null&&!r&&lT.warn(`Overwriting ${e} with`,i),this.imports[e]=i,(e.startsWith("blots/")||e.startsWith("formats/"))&&i&&typeof i!="boolean"&&i.blotName!=="abstract"&&hk.register(i),typeof i.register=="function"&&i.register(hk)}}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.options=ckt(e,i),this.container=this.options.container,this.container==null){lT.error("Invalid Quill container",e);return}this.options.debug&&pt.debug(this.options.debug);const r=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",Rz.set(this.container,this),this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.emitter=new vi;const n=dJ.blotName,a=this.options.registry.query(n);if(!a||!("blotName"in a))throw new Error(`Cannot initialize Quill without "${n}" blot`);if(this.scroll=new a(this.options.registry,this.root,{emitter:this.emitter}),this.editor=new JBt(this.scroll),this.selection=new XBt(this.scroll,this.emitter),this.composition=new ikt(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.uploader=this.theme.addModule("uploader"),this.theme.addModule("input"),this.theme.addModule("uiNode"),this.theme.init(),this.emitter.on(vi.events.EDITOR_CHANGE,s=>{s===vi.events.TEXT_CHANGE&&this.root.classList.toggle("ql-blank",this.editor.isBlank())}),this.emitter.on(vi.events.SCROLL_UPDATE,(s,o)=>{const l=this.selection.lastRange,[c]=this.selection.getRange(),u=l&&c?{oldRange:l,newRange:c}:void 0;$f.call(this,()=>this.editor.update(null,o,u),s)}),this.emitter.on(vi.events.SCROLL_EMBED_UPDATE,(s,o)=>{const l=this.selection.lastRange,[c]=this.selection.getRange(),u=l&&c?{oldRange:l,newRange:c}:void 0;$f.call(this,()=>{const d=new Ti().retain(s.offset(this)).retain({[s.statics.blotName]:o});return this.editor.update(d,[],u)},pt.sources.USER)}),r){const s=this.clipboard.convert({html:`${r}<p><br></p>`,text:`
`});this.setContents(s)}this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable(),this.allowReadOnlyEdits=!1}addContainer(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof e=="string"){const r=e;e=document.createElement("div"),e.classList.add(r)}return this.container.insertBefore(e,i),e}blur(){this.selection.setRange(null)}deleteText(e,i,r){return[e,i,,r]=zA(e,i,r),$f.call(this,()=>this.editor.deleteText(e,i),r,e,-1*i)}disable(){this.enable(!1)}editReadOnly(e){this.allowReadOnlyEdits=!0;const i=e();return this.allowReadOnlyEdits=!1,i}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.scroll.enable(e),this.container.classList.toggle("ql-disabled",!e)}focus(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.selection.focus(),e.preventScroll||this.scrollSelectionIntoView()}format(e,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vi.sources.API;return $f.call(this,()=>{const n=this.getSelection(!0);let a=new Ti;if(n==null)return a;if(this.scroll.query(e,Pi.BLOCK))a=this.editor.formatLine(n.index,n.length,{[e]:i});else{if(n.length===0)return this.selection.format(e,i),a;a=this.editor.formatText(n.index,n.length,{[e]:i})}return this.setSelection(n,vi.sources.SILENT),a},r)}formatLine(e,i,r,n,a){let s;return[e,i,s,a]=zA(e,i,r,n,a),$f.call(this,()=>this.editor.formatLine(e,i,s),a,e,0)}formatText(e,i,r,n,a){let s;return[e,i,s,a]=zA(e,i,r,n,a),$f.call(this,()=>this.editor.formatText(e,i,s),a,e,0)}getBounds(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=null;if(typeof e=="number"?r=this.selection.getBounds(e,i):r=this.selection.getBounds(e.index,e.length),!r)return null;const n=this.container.getBoundingClientRect();return{bottom:r.bottom-n.top,height:r.height,left:r.left-n.left,right:r.right-n.left,top:r.top-n.top,width:r.width}}getContents(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-e;return[e,i]=zA(e,i),this.editor.getContents(e,i)}getFormat(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.getSelection(!0),i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return typeof e=="number"?this.editor.getFormat(e,i):this.editor.getFormat(e.index,e.length)}getIndex(e){return e.offset(this.scroll)}getLength(){return this.scroll.length()}getLeaf(e){return this.scroll.leaf(e)}getLine(e){return this.scroll.line(e)}getLines(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;return typeof e!="number"?this.scroll.lines(e.index,e.length):this.scroll.lines(e,i)}getModule(e){return this.theme.modules[e]}getSelection(){return arguments.length>0&&arguments[0]!==void 0&&arguments[0]&&this.focus(),this.update(),this.selection.getRange()[0]}getSemanticHTML(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;return typeof e=="number"&&(i=i??this.getLength()-e),[e,i]=zA(e,i),this.editor.getHTML(e,i)}getText(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;return typeof e=="number"&&(i=i??this.getLength()-e),[e,i]=zA(e,i),this.editor.getText(e,i)}hasFocus(){return this.selection.hasFocus()}insertEmbed(e,i,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:pt.sources.API;return $f.call(this,()=>this.editor.insertEmbed(e,i,r),n,e)}insertText(e,i,r,n,a){let s;return[e,,s,a]=zA(e,0,r,n,a),$f.call(this,()=>this.editor.insertText(e,i,s),a,e,i.length)}isEnabled(){return this.scroll.isEnabled()}off(){return this.emitter.off(...arguments)}on(){return this.emitter.on(...arguments)}once(){return this.emitter.once(...arguments)}removeFormat(e,i,r){return[e,i,,r]=zA(e,i,r),$f.call(this,()=>this.editor.removeFormat(e,i),r,e)}scrollRectIntoView(e){akt(this.root,e)}scrollIntoView(){console.warn("Quill#scrollIntoView() has been deprecated and will be removed in the near future. Please use Quill#scrollSelectionIntoView() instead."),this.scrollSelectionIntoView()}scrollSelectionIntoView(){const e=this.selection.lastRange,i=e&&this.selection.getBounds(e.index,e.length);i&&this.scrollRectIntoView(i)}setContents(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vi.sources.API;return $f.call(this,()=>{e=new Ti(e);const r=this.getLength(),n=this.editor.deleteText(0,r),a=this.editor.insertContents(0,e),s=this.editor.deleteText(this.getLength()-1,1);return n.compose(a).compose(s)},i)}setSelection(e,i,r){e==null?this.selection.setRange(null,i||pt.sources.API):([e,i,,r]=zA(e,i,r),this.selection.setRange(new vw(Math.max(0,e),i),r),r!==vi.sources.SILENT&&this.scrollSelectionIntoView())}setText(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vi.sources.API;const r=new Ti().insert(e);return this.setContents(r,i)}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:vi.sources.USER;const i=this.scroll.update(e);return this.selection.update(e),i}updateContents(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vi.sources.API;return $f.call(this,()=>(e=new Ti(e),this.editor.applyDelta(e)),i,!0)}}function yle(t){return typeof t=="string"?document.querySelector(t):t}function GQ(t){return Object.entries(t??{}).reduce((e,i)=>{let[r,n]=i;return{...e,[r]:n===!0?{}:n}},{})}function ble(t){return Object.fromEntries(Object.entries(t).filter(e=>e[1]!==void 0))}function ckt(t,e){const i=yle(t);if(!i)throw new Error("Invalid Quill container");const n=!e.theme||e.theme===pt.DEFAULTS.theme?qE:pt.import(`themes/${e.theme}`);if(!n)throw new Error(`Invalid theme ${e.theme}. Did you register it?`);const{modules:a,...s}=pt.DEFAULTS,{modules:o,...l}=n.DEFAULTS;let c=GQ(e.modules);c!=null&&c.toolbar&&c.toolbar.constructor!==Object&&(c={...c,toolbar:{container:c.toolbar}});const u=fy({},GQ(a),GQ(o),c),d={...s,...ble(l),...ble(e)};let p=e.registry;return p?e.formats&&lT.warn('Ignoring "formats" option because "registry" is specified'):p=e.formats?lkt(e.formats,d.registry,lT):d.registry,{...d,registry:p,container:i,theme:n,modules:Object.entries(u).reduce((f,h)=>{let[m,A]=h;if(!A)return f;const g=pt.import(`modules/${m}`);return g==null?(lT.error(`Cannot load ${m} module. Are you sure you registered it?`),f):{...f,[m]:fy({},g.DEFAULTS||{},A)}},{}),bounds:yle(d.bounds)}}function $f(t,e,i,r){if(!this.isEnabled()&&e===vi.sources.USER&&!this.allowReadOnlyEdits)return new Ti;let n=i==null?null:this.getSelection();const a=this.editor.delta,s=t();if(n!=null&&(i===!0&&(i=n.index),r==null?n=Ile(n,s,e):r!==0&&(n=Ile(n,i,r,e)),this.setSelection(n,vi.sources.SILENT)),s.length()>0){const o=[vi.events.TEXT_CHANGE,s,a,e];this.emitter.emit(vi.events.EDITOR_CHANGE,...o),e!==vi.sources.SILENT&&this.emitter.emit(...o)}return s}function zA(t,e,i,r,n){let a={};return typeof t.index=="number"&&typeof t.length=="number"?typeof e!="number"?(n=r,r=i,i=e,e=t.length,t=t.index):(e=t.length,t=t.index):typeof e!="number"&&(n=r,r=i,i=e,e=0),typeof i=="object"?(a=i,n=r):typeof i=="string"&&(r!=null?a[i]=r:n=i),n=n||vi.sources.API,[t,e,a,n]}function Ile(t,e,i,r){const n=typeof i=="number"?i:0;if(t==null)return null;let a,s;return e&&typeof e.transformPosition=="function"?[a,s]=[t.index,t.index+t.length].map(o=>e.transformPosition(o,r!==vi.sources.USER)):[a,s]=[t.index,t.index+t.length].map(o=>o<e||o===e&&r===vi.sources.USER?o:n>=0?o+n:Math.max(e,o+n)),new vw(a,s-a)}class BS extends nV{}function wle(t){return t instanceof Hl||t instanceof Fp}function Sle(t){return typeof t.updateContent=="function"}class ukt extends dJ{static blotName="scroll";static className="ql-editor";static tagName="DIV";static defaultChild=Hl;static allowedChildren=[Hl,Fp,BS];constructor(e,i,r){let{emitter:n}=r;super(e,i),this.emitter=n,this.batch=!1,this.optimize(),this.enable(),this.domNode.addEventListener("dragstart",a=>this.handleDragStart(a))}batchStart(){Array.isArray(this.batch)||(this.batch=[])}batchEnd(){if(!this.batch)return;const e=this.batch;this.batch=!1,this.update(e)}emitMount(e){this.emitter.emit(vi.events.SCROLL_BLOT_MOUNT,e)}emitUnmount(e){this.emitter.emit(vi.events.SCROLL_BLOT_UNMOUNT,e)}emitEmbedUpdate(e,i){this.emitter.emit(vi.events.SCROLL_EMBED_UPDATE,e,i)}deleteAt(e,i){const[r,n]=this.line(e),[a]=this.line(e+i);if(super.deleteAt(e,i),a!=null&&r!==a&&n>0){if(r instanceof Fp||a instanceof Fp){this.optimize();return}const s=a.children.head instanceof Xh?null:a.children.head;r.moveChildren(a,s),r.remove()}this.optimize()}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.domNode.setAttribute("contenteditable",e?"true":"false")}formatAt(e,i,r,n){super.formatAt(e,i,r,n),this.optimize()}insertAt(e,i,r){if(e>=this.length())if(r==null||this.scroll.query(i,Pi.BLOCK)==null){const n=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(n),r==null&&i.endsWith(`
`)?n.insertAt(0,i.slice(0,-1),r):n.insertAt(0,i,r)}else{const n=this.scroll.create(i,r);this.appendChild(n)}else super.insertAt(e,i,r);this.optimize()}insertBefore(e,i){if(e.statics.scope===Pi.INLINE_BLOT){const r=this.scroll.create(this.statics.defaultChild.blotName);r.appendChild(e),super.insertBefore(r,i)}else super.insertBefore(e,i)}insertContents(e,i){const r=this.deltaToRenderBlocks(i.concat(new Ti().insert(`
`))),n=r.pop();if(n==null)return;this.batchStart();const a=r.shift();if(a){const l=a.type==="block"&&(a.delta.length()===0||!this.descendant(Fp,e)[0]&&e<this.length()),c=a.type==="block"?a.delta:new Ti().insert({[a.key]:a.value});QQ(this,e,c);const u=a.type==="block"?1:0,d=e+c.length()+u;l&&this.insertAt(d-1,`
`);const p=xp(this.line(e)[0]),f=Gp.AttributeMap.diff(p,a.attributes)||{};Object.keys(f).forEach(h=>{this.formatAt(d-1,1,h,f[h])}),e=d}let[s,o]=this.children.find(e);if(r.length&&(s&&(s=s.split(o),o=0),r.forEach(l=>{if(l.type==="block"){const c=this.createBlock(l.attributes,s||void 0);QQ(c,0,l.delta)}else{const c=this.create(l.key,l.value);this.insertBefore(c,s||void 0),Object.keys(l.attributes).forEach(u=>{c.format(u,l.attributes[u])})}})),n.type==="block"&&n.delta.length()){const l=s?s.offset(s.scroll)+o:this.length();QQ(this,l,n.delta)}this.batchEnd(),this.optimize()}isEnabled(){return this.domNode.getAttribute("contenteditable")==="true"}leaf(e){const i=this.path(e).pop();if(!i)return[null,-1];const[r,n]=i;return r instanceof Ic?[r,n]:[null,-1]}line(e){return e===this.length()?this.line(e-1):this.descendant(wle,e)}lines(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;const r=(n,a,s)=>{let o=[],l=s;return n.children.forEachAt(a,s,(c,u,d)=>{wle(c)?o.push(c):c instanceof nV&&(o=o.concat(r(c,u,l))),l-=d}),o};return r(this,e,i)}optimize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.batch||(super.optimize(e,i),e.length>0&&this.emitter.emit(vi.events.SCROLL_OPTIMIZE,e,i))}path(e){return super.path(e).slice(1)}remove(){}update(e){if(this.batch){Array.isArray(e)&&(this.batch=this.batch.concat(e));return}let i=vi.sources.USER;typeof e=="string"&&(i=e),Array.isArray(e)||(e=this.observer.takeRecords()),e=e.filter(r=>{let{target:n}=r;const a=this.find(n,!0);return a&&!Sle(a)}),e.length>0&&this.emitter.emit(vi.events.SCROLL_BEFORE_UPDATE,i,e),super.update(e.concat([])),e.length>0&&this.emitter.emit(vi.events.SCROLL_UPDATE,i,e)}updateEmbedAt(e,i,r){const[n]=this.descendant(a=>a instanceof Fp,e);n&&n.statics.blotName===i&&Sle(n)&&n.updateContent(r)}handleDragStart(e){e.preventDefault()}deltaToRenderBlocks(e){const i=[];let r=new Ti;return e.forEach(n=>{const a=n?.insert;if(a)if(typeof a=="string"){const s=a.split(`
`);s.slice(0,-1).forEach(l=>{r.insert(l,n.attributes),i.push({type:"block",delta:r,attributes:n.attributes??{}}),r=new Ti});const o=s[s.length-1];o&&r.insert(o,n.attributes)}else{const s=Object.keys(a)[0];if(!s)return;this.query(s,Pi.INLINE)?r.push(n):(r.length()&&i.push({type:"block",delta:r,attributes:{}}),r=new Ti,i.push({type:"blockEmbed",key:s,value:a[s],attributes:n.attributes??{}}))}}),r.length()&&i.push({type:"block",delta:r,attributes:{}}),i}createBlock(e,i){let r;const n={};Object.entries(e).forEach(o=>{let[l,c]=o;this.query(l,Pi.BLOCK&Pi.BLOT)!=null?r=l:n[l]=c});const a=this.create(r||this.statics.defaultChild.blotName,r?e[r]:void 0);this.insertBefore(a,i||void 0);const s=a.length();return Object.entries(n).forEach(o=>{let[l,c]=o;a.formatAt(0,s,l,c)}),a}}function QQ(t,e,i){i.reduce((r,n)=>{const a=Gp.Op.length(n);let s=n.attributes||{};if(n.insert!=null){if(typeof n.insert=="string"){const o=n.insert;t.insertAt(r,o);const[l]=t.descendant(Ic,r),c=xp(l);s=Gp.AttributeMap.diff(c,s)||{}}else if(typeof n.insert=="object"){const o=Object.keys(n.insert)[0];if(o==null)return r;if(t.insertAt(r,o,n.insert[o]),t.scroll.query(o,Pi.INLINE)!=null){const[c]=t.descendant(Ic,r),u=xp(c);s=Gp.AttributeMap.diff(u,s)||{}}}}return Object.keys(s).forEach(o=>{t.formatAt(r,a,o,s[o])}),r+a},e)}const fJ={scope:Pi.BLOCK,whitelist:["right","center","justify"]},dkt=new rA("align","align",fJ),Uxe=new Yh("align","ql-align",fJ),Txe=new xb("align","text-align",fJ);class Cxe extends xb{value(e){let i=super.value(e);return i.startsWith("rgb(")?(i=i.replace(/^[^\d]+/,"").replace(/[^\d]+$/,""),`#${i.split(",").map(n=>`00${parseInt(n,10).toString(16)}`.slice(-2)).join("")}`):i}}const pkt=new Yh("color","ql-color",{scope:Pi.INLINE}),hJ=new Cxe("color","color",{scope:Pi.INLINE}),fkt=new Yh("background","ql-bg",{scope:Pi.INLINE}),mJ=new Cxe("background","background-color",{scope:Pi.INLINE});class kS extends BS{static create(e){const i=super.create(e);return i.setAttribute("spellcheck","false"),i}code(e,i){return this.children.map(r=>r.length()<=1?"":r.domNode.innerText).join(`
`).slice(e,e+i)}html(e,i){return`<pre>
${aV(this.code(e,i))}
</pre>`}}class lu extends Hl{static TAB="  ";static register(){pt.register(kS)}}class AJ extends eu{}AJ.blotName="code";AJ.tagName="CODE";lu.blotName="code-block";lu.className="ql-code-block";lu.tagName="DIV";kS.blotName="code-block-container";kS.className="ql-code-block-container";kS.tagName="DIV";kS.allowedChildren=[lu];lu.allowedChildren=[Oh,Xh,qf];lu.requiredContainer=kS;const gJ={scope:Pi.BLOCK,whitelist:["rtl"]},Exe=new rA("direction","dir",gJ),Dxe=new Yh("direction","ql-direction",gJ),Pxe=new xb("direction","direction",gJ),Rxe={scope:Pi.INLINE,whitelist:["serif","monospace"]},Mxe=new Yh("font","ql-font",Rxe);class hkt extends xb{value(e){return super.value(e).replace(/["']/g,"")}}const Nxe=new hkt("font","font-family",Rxe),Bxe=new Yh("size","ql-size",{scope:Pi.INLINE,whitelist:["small","large","huge"]}),kxe=new xb("size","font-size",{scope:Pi.INLINE,whitelist:["10px","18px","32px"]}),mkt=fv("quill:keyboard"),Akt=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey";class sV extends PA{static match(e,i){return["altKey","ctrlKey","metaKey","shiftKey"].some(r=>!!i[r]!==e[r]&&i[r]!==null)?!1:i.key===e.key||i.key===e.which}constructor(e,i){super(e,i),this.bindings={},Object.keys(this.options.bindings).forEach(r=>{this.options.bindings[r]&&this.addBinding(this.options.bindings[r])}),this.addBinding({key:"Enter",shiftKey:null},this.handleEnter),this.addBinding({key:"Enter",metaKey:null,ctrlKey:null,altKey:null},()=>{}),/Firefox/i.test(navigator.userAgent)?(this.addBinding({key:"Backspace"},{collapsed:!0},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0},this.handleDelete)):(this.addBinding({key:"Backspace"},{collapsed:!0,prefix:/^.?$/},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0,suffix:/^.?$/},this.handleDelete)),this.addBinding({key:"Backspace"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Delete"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Backspace",altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},this.handleBackspace),this.listen()}addBinding(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=vkt(e);if(n==null){mkt.warn("Attempted to add invalid keyboard binding",n);return}typeof i=="function"&&(i={handler:i}),typeof r=="function"&&(r={handler:r}),(Array.isArray(n.key)?n.key:[n.key]).forEach(s=>{const o={...n,key:s,...i,...r};this.bindings[o.key]=this.bindings[o.key]||[],this.bindings[o.key].push(o)})}listen(){this.quill.root.addEventListener("keydown",e=>{if(e.defaultPrevented||e.isComposing||e.keyCode===229&&(e.key==="Enter"||e.key==="Backspace"))return;const n=(this.bindings[e.key]||[]).concat(this.bindings[e.which]||[]).filter(g=>sV.match(e,g));if(n.length===0)return;const a=pt.find(e.target,!0);if(a&&a.scroll!==this.quill.scroll)return;const s=this.quill.getSelection();if(s==null||!this.quill.hasFocus())return;const[o,l]=this.quill.getLine(s.index),[c,u]=this.quill.getLeaf(s.index),[d,p]=s.length===0?[c,u]:this.quill.getLeaf(s.index+s.length),f=c instanceof _O?c.value().slice(0,u):"",h=d instanceof _O?d.value().slice(p):"",m={collapsed:s.length===0,empty:s.length===0&&o.length()<=1,format:this.quill.getFormat(s),line:o,offset:l,prefix:f,suffix:h,event:e};n.some(g=>{if(g.collapsed!=null&&g.collapsed!==m.collapsed||g.empty!=null&&g.empty!==m.empty||g.offset!=null&&g.offset!==m.offset)return!1;if(Array.isArray(g.format)){if(g.format.every(v=>m.format[v]==null))return!1}else if(typeof g.format=="object"&&!Object.keys(g.format).every(v=>g.format[v]===!0?m.format[v]!=null:g.format[v]===!1?m.format[v]==null:cJ(g.format[v],m.format[v])))return!1;return g.prefix!=null&&!g.prefix.test(m.prefix)||g.suffix!=null&&!g.suffix.test(m.suffix)?!1:g.handler.call(this,s,m,g)!==!0})&&e.preventDefault()})}handleBackspace(e,i){const r=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(i.prefix)?2:1;if(e.index===0||this.quill.getLength()<=1)return;let n={};const[a]=this.quill.getLine(e.index);let s=new Ti().retain(e.index-r).delete(r);if(i.offset===0){const[o]=this.quill.getLine(e.index-1);if(o&&!(o.statics.blotName==="block"&&o.length()<=1)){const c=a.formats(),u=this.quill.getFormat(e.index-1,1);if(n=Gp.AttributeMap.diff(c,u)||{},Object.keys(n).length>0){const d=new Ti().retain(e.index+a.length()-2).retain(1,n);s=s.compose(d)}}}this.quill.updateContents(s,pt.sources.USER),this.quill.focus()}handleDelete(e,i){const r=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(i.suffix)?2:1;if(e.index>=this.quill.getLength()-r)return;let n={};const[a]=this.quill.getLine(e.index);let s=new Ti().retain(e.index).delete(r);if(i.offset>=a.length()-1){const[o]=this.quill.getLine(e.index+1);if(o){const l=a.formats(),c=this.quill.getFormat(e.index,1);n=Gp.AttributeMap.diff(l,c)||{},Object.keys(n).length>0&&(s=s.retain(o.length()-1).retain(1,n))}}this.quill.updateContents(s,pt.sources.USER),this.quill.focus()}handleDeleteRange(e){vJ({range:e,quill:this.quill}),this.quill.focus()}handleEnter(e,i){const r=Object.keys(i.format).reduce((a,s)=>(this.quill.scroll.query(s,Pi.BLOCK)&&!Array.isArray(i.format[s])&&(a[s]=i.format[s]),a),{}),n=new Ti().retain(e.index).delete(e.length).insert(`
`,r);this.quill.updateContents(n,pt.sources.USER),this.quill.setSelection(e.index+1,pt.sources.SILENT),this.quill.focus()}}const gkt={bindings:{bold:jQ("bold"),italic:jQ("italic"),underline:jQ("underline"),indent:{key:"Tab",format:["blockquote","indent","list"],handler(t,e){return e.collapsed&&e.offset!==0?!0:(this.quill.format("indent","+1",pt.sources.USER),!1)}},outdent:{key:"Tab",shiftKey:!0,format:["blockquote","indent","list"],handler(t,e){return e.collapsed&&e.offset!==0?!0:(this.quill.format("indent","-1",pt.sources.USER),!1)}},"outdent backspace":{key:"Backspace",collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler(t,e){e.format.indent!=null?this.quill.format("indent","-1",pt.sources.USER):e.format.list!=null&&this.quill.format("list",!1,pt.sources.USER)}},"indent code-block":Ule(!0),"outdent code-block":Ule(!1),"remove tab":{key:"Tab",shiftKey:!0,collapsed:!0,prefix:/\t$/,handler(t){this.quill.deleteText(t.index-1,1,pt.sources.USER)}},tab:{key:"Tab",handler(t,e){if(e.format.table)return!0;this.quill.history.cutoff();const i=new Ti().retain(t.index).delete(t.length).insert("	");return this.quill.updateContents(i,pt.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(t.index+1,pt.sources.SILENT),!1}},"blockquote empty enter":{key:"Enter",collapsed:!0,format:["blockquote"],empty:!0,handler(){this.quill.format("blockquote",!1,pt.sources.USER)}},"list empty enter":{key:"Enter",collapsed:!0,format:["list"],empty:!0,handler(t,e){const i={list:!1};e.format.indent&&(i.indent=!1),this.quill.formatLine(t.index,t.length,i,pt.sources.USER)}},"checklist enter":{key:"Enter",collapsed:!0,format:{list:"checked"},handler(t){const[e,i]=this.quill.getLine(t.index),r={...e.formats(),list:"checked"},n=new Ti().retain(t.index).insert(`
`,r).retain(e.length()-i-1).retain(1,{list:"unchecked"});this.quill.updateContents(n,pt.sources.USER),this.quill.setSelection(t.index+1,pt.sources.SILENT),this.quill.scrollSelectionIntoView()}},"header enter":{key:"Enter",collapsed:!0,format:["header"],suffix:/^$/,handler(t,e){const[i,r]=this.quill.getLine(t.index),n=new Ti().retain(t.index).insert(`
`,e.format).retain(i.length()-r-1).retain(1,{header:null});this.quill.updateContents(n,pt.sources.USER),this.quill.setSelection(t.index+1,pt.sources.SILENT),this.quill.scrollSelectionIntoView()}},"table backspace":{key:"Backspace",format:["table"],collapsed:!0,offset:0,handler(){}},"table delete":{key:"Delete",format:["table"],collapsed:!0,suffix:/^$/,handler(){}},"table enter":{key:"Enter",shiftKey:null,format:["table"],handler(t){const e=this.quill.getModule("table");if(e){const[i,r,n,a]=e.getTable(t),s=ykt(i,r,n,a);if(s==null)return;let o=i.offset();if(s<0){const l=new Ti().retain(o).insert(`
`);this.quill.updateContents(l,pt.sources.USER),this.quill.setSelection(t.index+1,t.length,pt.sources.SILENT)}else if(s>0){o+=i.length();const l=new Ti().retain(o).insert(`
`);this.quill.updateContents(l,pt.sources.USER),this.quill.setSelection(o,pt.sources.USER)}}}},"table tab":{key:"Tab",shiftKey:null,format:["table"],handler(t,e){const{event:i,line:r}=e,n=r.offset(this.quill.scroll);i.shiftKey?this.quill.setSelection(n-1,pt.sources.USER):this.quill.setSelection(n+r.length(),pt.sources.USER)}},"list autofill":{key:" ",shiftKey:null,collapsed:!0,format:{"code-block":!1,blockquote:!1,table:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler(t,e){if(this.quill.scroll.query("list")==null)return!0;const{length:i}=e.prefix,[r,n]=this.quill.getLine(t.index);if(n>i)return!0;let a;switch(e.prefix.trim()){case"[]":case"[ ]":a="unchecked";break;case"[x]":a="checked";break;case"-":case"*":a="bullet";break;default:a="ordered"}this.quill.insertText(t.index," ",pt.sources.USER),this.quill.history.cutoff();const s=new Ti().retain(t.index-n).delete(i+1).retain(r.length()-2-n).retain(1,{list:a});return this.quill.updateContents(s,pt.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(t.index-i,pt.sources.SILENT),!1}},"code exit":{key:"Enter",collapsed:!0,format:["code-block"],prefix:/^$/,suffix:/^\s*$/,handler(t){const[e,i]=this.quill.getLine(t.index);let r=2,n=e;for(;n!=null&&n.length()<=1&&n.formats()["code-block"];)if(n=n.prev,r-=1,r<=0){const a=new Ti().retain(t.index+e.length()-i-2).retain(1,{"code-block":null}).delete(1);return this.quill.updateContents(a,pt.sources.USER),this.quill.setSelection(t.index-1,pt.sources.SILENT),!1}return!0}},"embed left":mk("ArrowLeft",!1),"embed left shift":mk("ArrowLeft",!0),"embed right":mk("ArrowRight",!1),"embed right shift":mk("ArrowRight",!0),"table down":Tle(!1),"table up":Tle(!0)}};sV.DEFAULTS=gkt;function Ule(t){return{key:"Tab",shiftKey:!t,format:{"code-block":!0},handler(e,i){let{event:r}=i;const n=this.quill.scroll.query("code-block"),{TAB:a}=n;if(e.length===0&&!r.shiftKey){this.quill.insertText(e.index,a,pt.sources.USER),this.quill.setSelection(e.index+a.length,pt.sources.SILENT);return}const s=e.length===0?this.quill.getLines(e.index,1):this.quill.getLines(e);let{index:o,length:l}=e;s.forEach((c,u)=>{t?(c.insertAt(0,a),u===0?o+=a.length:l+=a.length):c.domNode.textContent.startsWith(a)&&(c.deleteAt(0,a.length),u===0?o-=a.length:l-=a.length)}),this.quill.update(pt.sources.USER),this.quill.setSelection(o,l,pt.sources.SILENT)}}}function mk(t,e){return{key:t,shiftKey:e,altKey:null,[t==="ArrowLeft"?"prefix":"suffix"]:/^$/,handler(r){let{index:n}=r;t==="ArrowRight"&&(n+=r.length+1);const[a]=this.quill.getLeaf(n);return a instanceof mp?(t==="ArrowLeft"?e?this.quill.setSelection(r.index-1,r.length+1,pt.sources.USER):this.quill.setSelection(r.index-1,pt.sources.USER):e?this.quill.setSelection(r.index,r.length+1,pt.sources.USER):this.quill.setSelection(r.index+r.length+1,pt.sources.USER),!1):!0}}}function jQ(t){return{key:t[0],shortKey:!0,handler(e,i){this.quill.format(t,!i.format[t],pt.sources.USER)}}}function Tle(t){return{key:t?"ArrowUp":"ArrowDown",collapsed:!0,format:["table"],handler(e,i){const r=t?"prev":"next",n=i.line,a=n.parent[r];if(a!=null){if(a.statics.blotName==="table-row"){let s=a.children.head,o=n;for(;o.prev!=null;)o=o.prev,s=s.next;const l=s.offset(this.quill.scroll)+Math.min(i.offset,s.length()-1);this.quill.setSelection(l,0,pt.sources.USER)}}else{const s=n.table()[r];s!=null&&(t?this.quill.setSelection(s.offset(this.quill.scroll)+s.length()-1,0,pt.sources.USER):this.quill.setSelection(s.offset(this.quill.scroll),0,pt.sources.USER))}return!1}}}function vkt(t){if(typeof t=="string"||typeof t=="number")t={key:t};else if(typeof t=="object")t=sT(t);else return null;return t.shortKey&&(t[Akt]=t.shortKey,delete t.shortKey),t}function vJ(t){let{quill:e,range:i}=t;const r=e.getLines(i);let n={};if(r.length>1){const a=r[0].formats(),s=r[r.length-1].formats();n=Gp.AttributeMap.diff(s,a)||{}}e.deleteText(i,pt.sources.USER),Object.keys(n).length>0&&e.formatLine(i.index,1,n,pt.sources.USER),e.setSelection(i.index,pt.sources.SILENT)}function ykt(t,e,i,r){return e.prev==null&&e.next==null?i.prev==null&&i.next==null?r===0?-1:1:i.prev==null?-1:1:e.prev==null?-1:e.next==null?1:null}const bkt=/font-weight:\s*normal/,Ikt=["P","OL","UL"],Cle=t=>t&&Ikt.includes(t.tagName),wkt=t=>{Array.from(t.querySelectorAll("br")).filter(e=>Cle(e.previousElementSibling)&&Cle(e.nextElementSibling)).forEach(e=>{e.parentNode?.removeChild(e)})},Skt=t=>{Array.from(t.querySelectorAll('b[style*="font-weight"]')).filter(e=>e.getAttribute("style")?.match(bkt)).forEach(e=>{const i=t.createDocumentFragment();i.append(...e.childNodes),e.parentNode?.replaceChild(i,e)})};function Ukt(t){t.querySelector('[id^="docs-internal-guid-"]')&&(Skt(t),wkt(t))}const Tkt=/\bmso-list:[^;]*ignore/i,Ckt=/\bmso-list:[^;]*\bl(\d+)/i,Ekt=/\bmso-list:[^;]*\blevel(\d+)/i,Dkt=(t,e)=>{const i=t.getAttribute("style"),r=i?.match(Ckt);if(!r)return null;const n=Number(r[1]),a=i?.match(Ekt),s=a?Number(a[1]):1,o=new RegExp(`@list l${n}:level${s}\\s*\\{[^\\}]*mso-level-number-format:\\s*([\\w-]+)`,"i"),l=e.match(o),c=l&&l[1]==="bullet"?"bullet":"ordered";return{id:n,indent:s,type:c,element:t}},Pkt=t=>{const e=Array.from(t.querySelectorAll("[style*=mso-list]")),i=[],r=[];e.forEach(s=>{(s.getAttribute("style")||"").match(Tkt)?i.push(s):r.push(s)}),i.forEach(s=>s.parentNode?.removeChild(s));const n=t.documentElement.innerHTML,a=r.map(s=>Dkt(s,n)).filter(s=>s);for(;a.length;){const s=[];let o=a.shift();for(;o;)s.push(o),o=a.length&&a[0]?.element===o.element.nextElementSibling&&a[0].id===o.id?a.shift():null;const l=document.createElement("ul");s.forEach(d=>{const p=document.createElement("li");p.setAttribute("data-list",d.type),d.indent>1&&p.setAttribute("class",`ql-indent-${d.indent-1}`),p.innerHTML=d.element.innerHTML,l.appendChild(p)});const c=s[0]?.element,{parentNode:u}=c??{};c&&u?.replaceChild(l,c),s.slice(1).forEach(d=>{let{element:p}=d;u?.removeChild(p)})}};function Rkt(t){t.documentElement.getAttribute("xmlns:w")==="urn:schemas-microsoft-com:office:word"&&Pkt(t)}const Mkt=[Rkt,Ukt],Nkt=t=>{t.documentElement&&Mkt.forEach(e=>{e(t)})},Bkt=fv("quill:clipboard"),kkt=[[Node.TEXT_NODE,qkt],[Node.TEXT_NODE,Dle],["br",$kt],[Node.ELEMENT_NODE,Dle],[Node.ELEMENT_NODE,Lkt],[Node.ELEMENT_NODE,Fkt],[Node.ELEMENT_NODE,jkt],["li",Gkt],["ol, ul",Qkt],["pre",Hkt],["tr",zkt],["b",zQ("bold")],["i",zQ("italic")],["strike",zQ("strike")],["style",Vkt]],xkt=[dkt,Exe].reduce((t,e)=>(t[e.keyName]=e,t),{}),Ele=[Txe,mJ,hJ,Pxe,Nxe,kxe].reduce((t,e)=>(t[e.keyName]=e,t),{});class _kt extends PA{static DEFAULTS={matchers:[]};constructor(e,i){super(e,i),this.quill.root.addEventListener("copy",r=>this.onCaptureCopy(r,!1)),this.quill.root.addEventListener("cut",r=>this.onCaptureCopy(r,!0)),this.quill.root.addEventListener("paste",this.onCapturePaste.bind(this)),this.matchers=[],kkt.concat(this.options.matchers??[]).forEach(r=>{let[n,a]=r;this.addMatcher(n,a)})}addMatcher(e,i){this.matchers.push([e,i])}convert(e){let{html:i,text:r}=e,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n[lu.blotName])return new Ti().insert(r||"",{[lu.blotName]:n[lu.blotName]});if(!i)return new Ti().insert(r||"",n);const a=this.convertHTML(i);return _N(a,`
`)&&(a.ops[a.ops.length-1].attributes==null||n.table)?a.compose(new Ti().retain(a.length()-1).delete(1)):a}normalizeHTML(e){Nkt(e)}convertHTML(e){const i=new DOMParser().parseFromString(e,"text/html");this.normalizeHTML(i);const r=i.body,n=new WeakMap,[a,s]=this.prepareMatching(r,n);return yJ(this.quill.scroll,r,a,s,n)}dangerouslyPasteHTML(e,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:pt.sources.API;if(typeof e=="string"){const n=this.convert({html:e,text:""});this.quill.setContents(n,i),this.quill.setSelection(0,pt.sources.SILENT)}else{const n=this.convert({html:i,text:""});this.quill.updateContents(new Ti().retain(e).concat(n),r),this.quill.setSelection(e+n.length(),pt.sources.SILENT)}}onCaptureCopy(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.defaultPrevented)return;e.preventDefault();const[r]=this.quill.selection.getRange();if(r==null)return;const{html:n,text:a}=this.onCopy(r,i);e.clipboardData?.setData("text/plain",a),e.clipboardData?.setData("text/html",n),i&&vJ({range:r,quill:this.quill})}normalizeURIList(e){return e.split(/\r?\n/).filter(i=>i[0]!=="#").join(`
`)}onCapturePaste(e){if(e.defaultPrevented||!this.quill.isEnabled())return;e.preventDefault();const i=this.quill.getSelection(!0);if(i==null)return;const r=e.clipboardData?.getData("text/html");let n=e.clipboardData?.getData("text/plain");if(!r&&!n){const s=e.clipboardData?.getData("text/uri-list");s&&(n=this.normalizeURIList(s))}const a=Array.from(e.clipboardData?.files||[]);if(!r&&a.length>0){this.quill.uploader.upload(i,a);return}if(r&&a.length>0){const s=new DOMParser().parseFromString(r,"text/html");if(s.body.childElementCount===1&&s.body.firstElementChild?.tagName==="IMG"){this.quill.uploader.upload(i,a);return}}this.onPaste(i,{html:r,text:n})}onCopy(e){const i=this.quill.getText(e);return{html:this.quill.getSemanticHTML(e),text:i}}onPaste(e,i){let{text:r,html:n}=i;const a=this.quill.getFormat(e.index),s=this.convert({text:r,html:n},a);Bkt.log("onPaste",s,{text:r,html:n});const o=new Ti().retain(e.index).delete(e.length).concat(s);this.quill.updateContents(o,pt.sources.USER),this.quill.setSelection(o.length()-e.length,pt.sources.SILENT),this.quill.scrollSelectionIntoView()}prepareMatching(e,i){const r=[],n=[];return this.matchers.forEach(a=>{const[s,o]=a;switch(s){case Node.TEXT_NODE:n.push(o);break;case Node.ELEMENT_NODE:r.push(o);break;default:Array.from(e.querySelectorAll(s)).forEach(l=>{i.has(l)?i.get(l)?.push(o):i.set(l,[o])});break}}),[r,n]}}function xS(t,e,i,r){return r.query(e)?t.reduce((n,a)=>{if(!a.insert)return n;if(a.attributes&&a.attributes[e])return n.push(a);const s=i?{[e]:i}:{};return n.insert(a.insert,{...s,...a.attributes})},new Ti):t}function _N(t,e){let i="";for(let r=t.ops.length-1;r>=0&&i.length<e.length;--r){const n=t.ops[r];if(typeof n.insert!="string")break;i=n.insert+i}return i.slice(-1*e.length)===e}function Zv(t,e){if(!(t instanceof Element))return!1;const i=e.query(t);return i&&i.prototype instanceof mp?!1:["address","article","blockquote","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","iframe","li","main","nav","ol","output","p","pre","section","table","td","tr","ul","video"].includes(t.tagName.toLowerCase())}function Okt(t,e){return t.previousElementSibling&&t.nextElementSibling&&!Zv(t.previousElementSibling,e)&&!Zv(t.nextElementSibling,e)}const Ak=new WeakMap;function xxe(t){return t==null?!1:(Ak.has(t)||(t.tagName==="PRE"?Ak.set(t,!0):Ak.set(t,xxe(t.parentNode))),Ak.get(t))}function yJ(t,e,i,r,n){return e.nodeType===e.TEXT_NODE?r.reduce((a,s)=>s(e,a,t),new Ti):e.nodeType===e.ELEMENT_NODE?Array.from(e.childNodes||[]).reduce((a,s)=>{let o=yJ(t,s,i,r,n);return s.nodeType===e.ELEMENT_NODE&&(o=i.reduce((l,c)=>c(s,l,t),o),o=(n.get(s)||[]).reduce((l,c)=>c(s,l,t),o)),a.concat(o)},new Ti):new Ti}function zQ(t){return(e,i,r)=>xS(i,t,!0,r)}function Fkt(t,e,i){const r=rA.keys(t),n=Yh.keys(t),a=xb.keys(t),s={};return r.concat(n).concat(a).forEach(o=>{let l=i.query(o,Pi.ATTRIBUTE);l!=null&&(s[l.attrName]=l.value(t),s[l.attrName])||(l=xkt[o],l!=null&&(l.attrName===o||l.keyName===o)&&(s[l.attrName]=l.value(t)||void 0),l=Ele[o],l!=null&&(l.attrName===o||l.keyName===o)&&(l=Ele[o],s[l.attrName]=l.value(t)||void 0))}),Object.entries(s).reduce((o,l)=>{let[c,u]=l;return xS(o,c,u,i)},e)}function Lkt(t,e,i){const r=i.query(t);if(r==null)return e;if(r.prototype instanceof mp){const n={},a=r.value(t);if(a!=null)return n[r.blotName]=a,new Ti().insert(n,r.formats(t,i))}else if(r.prototype instanceof S1&&!_N(e,`
`)&&e.insert(`
`),"blotName"in r&&"formats"in r&&typeof r.formats=="function")return xS(e,r.blotName,r.formats(t,i),i);return e}function $kt(t,e){return _N(e,`
`)||e.insert(`
`),e}function Hkt(t,e,i){const r=i.query("code-block"),n=r&&"formats"in r&&typeof r.formats=="function"?r.formats(t,i):!0;return xS(e,"code-block",n,i)}function Vkt(){return new Ti}function Gkt(t,e,i){const r=i.query(t);if(r==null||r.blotName!=="list"||!_N(e,`
`))return e;let n=-1,a=t.parentNode;for(;a!=null;)["OL","UL"].includes(a.tagName)&&(n+=1),a=a.parentNode;return n<=0?e:e.reduce((s,o)=>o.insert?o.attributes&&typeof o.attributes.indent=="number"?s.push(o):s.insert(o.insert,{indent:n,...o.attributes||{}}):s,new Ti)}function Qkt(t,e,i){const r=t;let n=r.tagName==="OL"?"ordered":"bullet";const a=r.getAttribute("data-checked");return a&&(n=a==="true"?"checked":"unchecked"),xS(e,"list",n,i)}function Dle(t,e,i){if(!_N(e,`
`)){if(Zv(t,i)&&(t.childNodes.length>0||t instanceof HTMLParagraphElement))return e.insert(`
`);if(e.length()>0&&t.nextSibling){let r=t.nextSibling;for(;r!=null;){if(Zv(r,i))return e.insert(`
`);const n=i.query(r);if(n&&n.prototype instanceof Fp)return e.insert(`
`);r=r.firstChild}}}return e}function jkt(t,e,i){const r={},n=t.style||{};return n.fontStyle==="italic"&&(r.italic=!0),n.textDecoration==="underline"&&(r.underline=!0),n.textDecoration==="line-through"&&(r.strike=!0),(n.fontWeight?.startsWith("bold")||parseInt(n.fontWeight,10)>=700)&&(r.bold=!0),e=Object.entries(r).reduce((a,s)=>{let[o,l]=s;return xS(a,o,l,i)},e),parseFloat(n.textIndent||0)>0?new Ti().insert("	").concat(e):e}function zkt(t,e,i){const r=t.parentElement?.tagName==="TABLE"?t.parentElement:t.parentElement?.parentElement;if(r!=null){const a=Array.from(r.querySelectorAll("tr")).indexOf(t)+1;return xS(e,"table",a,i)}return e}function qkt(t,e,i){let r=t.data;if(t.parentElement?.tagName==="O:P")return e.insert(r.trim());if(!xxe(t)){if(r.trim().length===0&&r.includes(`
`)&&!Okt(t,i))return e;r=r.replace(/[^\S\u00a0]/g," "),r=r.replace(/ {2,}/g," "),(t.previousSibling==null&&t.parentElement!=null&&Zv(t.parentElement,i)||t.previousSibling instanceof Element&&Zv(t.previousSibling,i))&&(r=r.replace(/^ /,"")),(t.nextSibling==null&&t.parentElement!=null&&Zv(t.parentElement,i)||t.nextSibling instanceof Element&&Zv(t.nextSibling,i))&&(r=r.replace(/ $/,"")),r=r.replaceAll(""," ")}return e.insert(r)}class Wkt extends PA{static DEFAULTS={delay:1e3,maxStack:100,userOnly:!1};lastRecorded=0;ignoreChange=!1;stack={undo:[],redo:[]};currentRange=null;constructor(e,i){super(e,i),this.quill.on(pt.events.EDITOR_CHANGE,(r,n,a,s)=>{r===pt.events.SELECTION_CHANGE?n&&s!==pt.sources.SILENT&&(this.currentRange=n):r===pt.events.TEXT_CHANGE&&(this.ignoreChange||(!this.options.userOnly||s===pt.sources.USER?this.record(n,a):this.transform(n)),this.currentRange=Bz(this.currentRange,n))}),this.quill.keyboard.addBinding({key:"z",shortKey:!0},this.undo.bind(this)),this.quill.keyboard.addBinding({key:["z","Z"],shortKey:!0,shiftKey:!0},this.redo.bind(this)),/Win/i.test(navigator.platform)&&this.quill.keyboard.addBinding({key:"y",shortKey:!0},this.redo.bind(this)),this.quill.root.addEventListener("beforeinput",r=>{r.inputType==="historyUndo"?(this.undo(),r.preventDefault()):r.inputType==="historyRedo"&&(this.redo(),r.preventDefault())})}change(e,i){if(this.stack[e].length===0)return;const r=this.stack[e].pop();if(!r)return;const n=this.quill.getContents(),a=r.delta.invert(n);this.stack[i].push({delta:a,range:Bz(r.range,a)}),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(r.delta,pt.sources.USER),this.ignoreChange=!1,this.restoreSelection(r)}clear(){this.stack={undo:[],redo:[]}}cutoff(){this.lastRecorded=0}record(e,i){if(e.ops.length===0)return;this.stack.redo=[];let r=e.invert(i),n=this.currentRange;const a=Date.now();if(this.lastRecorded+this.options.delay>a&&this.stack.undo.length>0){const s=this.stack.undo.pop();s&&(r=r.compose(s.delta),n=s.range)}else this.lastRecorded=a;r.length()!==0&&(this.stack.undo.push({delta:r,range:n}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift())}redo(){this.change("redo","undo")}transform(e){Ple(this.stack.undo,e),Ple(this.stack.redo,e)}undo(){this.change("undo","redo")}restoreSelection(e){if(e.range)this.quill.setSelection(e.range,pt.sources.USER);else{const i=Ykt(this.quill.scroll,e.delta);this.quill.setSelection(i,pt.sources.USER)}}}function Ple(t,e){let i=e;for(let r=t.length-1;r>=0;r-=1){const n=t[r];t[r]={delta:i.transform(n.delta,!0),range:n.range&&Bz(n.range,i)},i=n.delta.transform(i),t[r].delta.length()===0&&t.splice(r,1)}}function Kkt(t,e){const i=e.ops[e.ops.length-1];return i==null?!1:i.insert!=null?typeof i.insert=="string"&&i.insert.endsWith(`
`):i.attributes!=null?Object.keys(i.attributes).some(r=>t.query(r,Pi.BLOCK)!=null):!1}function Ykt(t,e){const i=e.reduce((n,a)=>n+(a.delete||0),0);let r=e.length()-i;return Kkt(t,e)&&(r-=1),r}function Bz(t,e){if(!t)return t;const i=e.transformPosition(t.index),r=e.transformPosition(t.index+t.length);return{index:i,length:r-i}}class _xe extends PA{constructor(e,i){super(e,i),e.root.addEventListener("drop",r=>{r.preventDefault();let n=null;if(document.caretRangeFromPoint)n=document.caretRangeFromPoint(r.clientX,r.clientY);else if(document.caretPositionFromPoint){const s=document.caretPositionFromPoint(r.clientX,r.clientY);n=document.createRange(),n.setStart(s.offsetNode,s.offset),n.setEnd(s.offsetNode,s.offset)}const a=n&&e.selection.normalizeNative(n);if(a){const s=e.selection.normalizedToRange(a);r.dataTransfer?.files&&this.upload(s,r.dataTransfer.files)}})}upload(e,i){const r=[];Array.from(i).forEach(n=>{n&&this.options.mimetypes?.includes(n.type)&&r.push(n)}),r.length>0&&this.options.handler.call(this,e,r)}}_xe.DEFAULTS={mimetypes:["image/png","image/jpeg"],handler(t,e){if(!this.quill.scroll.query("image"))return;const i=e.map(r=>new Promise(n=>{const a=new FileReader;a.onload=()=>{n(a.result)},a.readAsDataURL(r)}));Promise.all(i).then(r=>{const n=r.reduce((a,s)=>a.insert({image:s}),new Ti().retain(t.index).delete(t.length));this.quill.updateContents(n,vi.sources.USER),this.quill.setSelection(t.index+r.length,vi.sources.SILENT)})}};const Xkt=["insertText","insertReplacementText"];class Zkt extends PA{constructor(e,i){super(e,i),e.root.addEventListener("beforeinput",r=>{this.handleBeforeInput(r)}),/Android/i.test(navigator.userAgent)||e.on(pt.events.COMPOSITION_BEFORE_START,()=>{this.handleCompositionStart()})}deleteRange(e){vJ({range:e,quill:this.quill})}replaceText(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e.length===0)return!1;if(i){const r=this.quill.getFormat(e.index,1);this.deleteRange(e),this.quill.updateContents(new Ti().retain(e.index).insert(i,r),pt.sources.USER)}else this.deleteRange(e);return this.quill.setSelection(e.index+i.length,0,pt.sources.SILENT),!0}handleBeforeInput(e){if(this.quill.composition.isComposing||e.defaultPrevented||!Xkt.includes(e.inputType))return;const i=e.getTargetRanges?e.getTargetRanges()[0]:null;if(!i||i.collapsed===!0)return;const r=Jkt(e);if(r==null)return;const n=this.quill.selection.normalizeNative(i),a=n?this.quill.selection.normalizedToRange(n):null;a&&this.replaceText(a,r)&&e.preventDefault()}handleCompositionStart(){const e=this.quill.getSelection();e&&this.replaceText(e)}}function Jkt(t){return typeof t.data=="string"?t.data:t.dataTransfer?.types.includes("text/plain")?t.dataTransfer.getData("text/plain"):null}const ext=/Mac/i.test(navigator.platform),txt=100,ixt=t=>!!(t.key==="ArrowLeft"||t.key==="ArrowRight"||t.key==="ArrowUp"||t.key==="ArrowDown"||t.key==="Home"||ext&&t.key==="a"&&t.ctrlKey===!0);class rxt extends PA{isListening=!1;selectionChangeDeadline=0;constructor(e,i){super(e,i),this.handleArrowKeys(),this.handleNavigationShortcuts()}handleArrowKeys(){this.quill.keyboard.addBinding({key:["ArrowLeft","ArrowRight"],offset:0,shiftKey:null,handler(e,i){let{line:r,event:n}=i;if(!(r instanceof dh)||!r.uiNode)return!0;const a=getComputedStyle(r.domNode).direction==="rtl";return a&&n.key!=="ArrowRight"||!a&&n.key!=="ArrowLeft"?!0:(this.quill.setSelection(e.index-1,e.length+(n.shiftKey?1:0),pt.sources.USER),!1)}})}handleNavigationShortcuts(){this.quill.root.addEventListener("keydown",e=>{!e.defaultPrevented&&ixt(e)&&this.ensureListeningToSelectionChange()})}ensureListeningToSelectionChange(){if(this.selectionChangeDeadline=Date.now()+txt,this.isListening)return;this.isListening=!0;const e=()=>{this.isListening=!1,Date.now()<=this.selectionChangeDeadline&&this.handleSelectionChange()};document.addEventListener("selectionchange",e,{once:!0})}handleSelectionChange(){const e=document.getSelection();if(!e)return;const i=e.getRangeAt(0);if(i.collapsed!==!0||i.startOffset!==0)return;const r=this.quill.scroll.find(i.startContainer);if(!(r instanceof dh)||!r.uiNode)return;const n=document.createRange();n.setStartAfter(r.uiNode),n.setEndAfter(r.uiNode),e.removeAllRanges(),e.addRange(n)}}pt.register({"blots/block":Hl,"blots/block/embed":Fp,"blots/break":Xh,"blots/container":BS,"blots/cursor":qf,"blots/embed":pJ,"blots/inline":eu,"blots/scroll":ukt,"blots/text":Oh,"modules/clipboard":_kt,"modules/history":Wkt,"modules/keyboard":sV,"modules/uploader":_xe,"modules/input":Zkt,"modules/uiNode":rxt});class nxt extends Yh{add(e,i){let r=0;if(i==="+1"||i==="-1"){const n=this.value(e)||0;r=i==="+1"?n+1:n-1}else typeof i=="number"&&(r=i);return r===0?(this.remove(e),!0):super.add(e,r.toString())}canAdd(e,i){return super.canAdd(e,i)||super.canAdd(e,parseInt(i,10))}value(e){return parseInt(super.value(e),10)||void 0}}const axt=new nxt("indent","ql-indent",{scope:Pi.BLOCK,whitelist:[1,2,3,4,5,6,7,8]});class sxt extends Hl{static blotName="blockquote";static tagName="blockquote"}let oxt=class extends Hl{static blotName="header";static tagName=["H1","H2","H3","H4","H5","H6"];static formats(e){return this.tagName.indexOf(e.tagName)+1}};class ON extends BS{}ON.blotName="list-container";ON.tagName="OL";class FN extends Hl{static create(e){const i=super.create();return i.setAttribute("data-list",e),i}static formats(e){return e.getAttribute("data-list")||void 0}static register(){pt.register(ON)}constructor(e,i){super(e,i);const r=i.ownerDocument.createElement("span"),n=a=>{if(!e.isEnabled())return;const s=this.statics.formats(i,e);s==="checked"?(this.format("list","unchecked"),a.preventDefault()):s==="unchecked"&&(this.format("list","checked"),a.preventDefault())};r.addEventListener("mousedown",n),r.addEventListener("touchstart",n),this.attachUI(r)}format(e,i){e===this.statics.blotName&&i?this.domNode.setAttribute("data-list",i):super.format(e,i)}}FN.blotName="list";FN.tagName="LI";ON.allowedChildren=[FN];FN.requiredContainer=ON;class bJ extends eu{static blotName="bold";static tagName=["STRONG","B"];static create(){return super.create()}static formats(){return!0}optimize(e){super.optimize(e),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}}class lxt extends bJ{static blotName="italic";static tagName=["EM","I"]}class OO extends eu{static blotName="link";static tagName="A";static SANITIZED_URL="about:blank";static PROTOCOL_WHITELIST=["http","https","mailto","tel","sms"];static create(e){const i=super.create(e);return i.setAttribute("href",this.sanitize(e)),i.setAttribute("rel","noopener noreferrer"),i.setAttribute("target","_blank"),i}static formats(e){return e.getAttribute("href")}static sanitize(e){return Oxe(e,this.PROTOCOL_WHITELIST)?e:this.SANITIZED_URL}format(e,i){e!==this.statics.blotName||!i?super.format(e,i):this.domNode.setAttribute("href",this.constructor.sanitize(i))}}function Oxe(t,e){const i=document.createElement("a");i.href=t;const r=i.href.slice(0,i.href.indexOf(":"));return e.indexOf(r)>-1}class cxt extends eu{static blotName="script";static tagName=["SUB","SUP"];static create(e){return e==="super"?document.createElement("sup"):e==="sub"?document.createElement("sub"):super.create(e)}static formats(e){if(e.tagName==="SUB")return"sub";if(e.tagName==="SUP")return"super"}}class uxt extends bJ{static blotName="strike";static tagName=["S","STRIKE"]}class dxt extends eu{static blotName="underline";static tagName="U"}class pxt extends pJ{static blotName="formula";static className="ql-formula";static tagName="SPAN";static create(e){if(window.katex==null)throw new Error("Formula module requires KaTeX.");const i=super.create(e);return typeof e=="string"&&(window.katex.render(e,i,{throwOnError:!1,errorColor:"#f00"}),i.setAttribute("data-value",e)),i}static value(e){return e.getAttribute("data-value")}html(){const{formula:e}=this.value();return`<span>${e}</span>`}}const Rle=["alt","height","width"];let fxt=class extends mp{static blotName="image";static tagName="IMG";static create(e){const i=super.create(e);return typeof e=="string"&&i.setAttribute("src",this.sanitize(e)),i}static formats(e){return Rle.reduce((i,r)=>(e.hasAttribute(r)&&(i[r]=e.getAttribute(r)),i),{})}static match(e){return/\.(jpe?g|gif|png)$/.test(e)||/^data:image\/.+;base64/.test(e)}static sanitize(e){return Oxe(e,["http","https","data"])?e:"//:0"}static value(e){return e.getAttribute("src")}format(e,i){Rle.indexOf(e)>-1?i?this.domNode.setAttribute(e,i):this.domNode.removeAttribute(e):super.format(e,i)}};const Mle=["height","width"];class hxt extends Fp{static blotName="video";static className="ql-video";static tagName="IFRAME";static create(e){const i=super.create(e);return i.setAttribute("frameborder","0"),i.setAttribute("allowfullscreen","true"),i.setAttribute("src",this.sanitize(e)),i}static formats(e){return Mle.reduce((i,r)=>(e.hasAttribute(r)&&(i[r]=e.getAttribute(r)),i),{})}static sanitize(e){return OO.sanitize(e)}static value(e){return e.getAttribute("src")}format(e,i){Mle.indexOf(e)>-1?i?this.domNode.setAttribute(e,i):this.domNode.removeAttribute(e):super.format(e,i)}html(){const{video:e}=this.value();return`<a href="${e}">${e}</a>`}}const WD=new Yh("code-token","hljs",{scope:Pi.INLINE});class _g extends eu{static formats(e,i){for(;e!=null&&e!==i.domNode;){if(e.classList&&e.classList.contains(lu.className))return super.formats(e,i);e=e.parentNode}}constructor(e,i,r){super(e,i,r),WD.add(this.domNode,r)}format(e,i){e!==_g.blotName?super.format(e,i):i?WD.add(this.domNode,i):(WD.remove(this.domNode),this.domNode.classList.remove(this.statics.className))}optimize(){super.optimize(...arguments),WD.value(this.domNode)||this.unwrap()}}_g.blotName="code-token";_g.className="ql-token";class _p extends lu{static create(e){const i=super.create(e);return typeof e=="string"&&i.setAttribute("data-language",e),i}static formats(e){return e.getAttribute("data-language")||"plain"}static register(){}format(e,i){e===this.statics.blotName&&i?this.domNode.setAttribute("data-language",i):super.format(e,i)}replaceWith(e,i){return this.formatAt(0,this.length(),_g.blotName,!1),super.replaceWith(e,i)}}class V0 extends kS{attach(){super.attach(),this.forceNext=!1,this.scroll.emitMount(this)}format(e,i){e===_p.blotName&&(this.forceNext=!0,this.children.forEach(r=>{r.format(e,i)}))}formatAt(e,i,r,n){r===_p.blotName&&(this.forceNext=!0),super.formatAt(e,i,r,n)}highlight(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.children.head==null)return;const n=`${Array.from(this.domNode.childNodes).filter(s=>s!==this.uiNode).map(s=>s.textContent).join(`
`)}
`,a=_p.formats(this.children.head.domNode);if(i||this.forceNext||this.cachedText!==n){if(n.trim().length>0||this.cachedText==null){const s=this.children.reduce((l,c)=>l.concat(wxe(c,!1)),new Ti),o=e(n,a);s.diff(o).reduce((l,c)=>{let{retain:u,attributes:d}=c;return u?(d&&Object.keys(d).forEach(p=>{[_p.blotName,_g.blotName].includes(p)&&this.formatAt(l,u,p,d[p])}),l+u):l},0)}this.cachedText=n,this.forceNext=!1}}html(e,i){const[r]=this.children.find(e);return`<pre data-language="${r?_p.formats(r.domNode):"plain"}">
${aV(this.code(e,i))}
</pre>`}optimize(e){if(super.optimize(e),this.parent!=null&&this.children.head!=null&&this.uiNode!=null){const i=_p.formats(this.children.head.domNode);i!==this.uiNode.value&&(this.uiNode.value=i)}}}V0.allowedChildren=[_p];_p.requiredContainer=V0;_p.allowedChildren=[_g,qf,Oh,Xh];const mxt=(t,e,i)=>{if(typeof t.versionString=="string"){const r=t.versionString.split(".")[0];if(parseInt(r,10)>=11)return t.highlight(i,{language:e}).value}return t.highlight(e,i).value};class Fxe extends PA{static register(){pt.register(_g,!0),pt.register(_p,!0),pt.register(V0,!0)}constructor(e,i){if(super(e,i),this.options.hljs==null)throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");this.languages=this.options.languages.reduce((r,n)=>{let{key:a}=n;return r[a]=!0,r},{}),this.highlightBlot=this.highlightBlot.bind(this),this.initListener(),this.initTimer()}initListener(){this.quill.on(pt.events.SCROLL_BLOT_MOUNT,e=>{if(!(e instanceof V0))return;const i=this.quill.root.ownerDocument.createElement("select");this.options.languages.forEach(r=>{let{key:n,label:a}=r;const s=i.ownerDocument.createElement("option");s.textContent=a,s.setAttribute("value",n),i.appendChild(s)}),i.addEventListener("change",()=>{e.format(_p.blotName,i.value),this.quill.root.focus(),this.highlight(e,!0)}),e.uiNode==null&&(e.attachUI(i),e.children.head&&(i.value=_p.formats(e.children.head.domNode)))})}initTimer(){let e=null;this.quill.on(pt.events.SCROLL_OPTIMIZE,()=>{e&&clearTimeout(e),e=setTimeout(()=>{this.highlight(),e=null},this.options.interval)})}highlight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.quill.selection.composing)return;this.quill.update(pt.sources.USER);const r=this.quill.getSelection();(e==null?this.quill.scroll.descendants(V0):[e]).forEach(a=>{a.highlight(this.highlightBlot,i)}),this.quill.update(pt.sources.SILENT),r!=null&&this.quill.setSelection(r,pt.sources.SILENT)}highlightBlot(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"plain";if(i=this.languages[i]?i:"plain",i==="plain")return aV(e).split(`
`).reduce((n,a,s)=>(s!==0&&n.insert(`
`,{[lu.blotName]:i}),n.insert(a)),new Ti);const r=this.quill.root.ownerDocument.createElement("div");return r.classList.add(lu.className),r.innerHTML=mxt(this.options.hljs,i,e),yJ(this.quill.scroll,r,[(n,a)=>{const s=WD.value(n);return s?a.compose(new Ti().retain(a.length(),{[_g.blotName]:s})):a}],[(n,a)=>n.data.split(`
`).reduce((s,o,l)=>(l!==0&&s.insert(`
`,{[lu.blotName]:i}),s.insert(o)),a)],new WeakMap)}}Fxe.DEFAULTS={hljs:window.hljs,interval:1e3,languages:[{key:"plain",label:"Plain"},{key:"bash",label:"Bash"},{key:"cpp",label:"C++"},{key:"cs",label:"C#"},{key:"css",label:"CSS"},{key:"diff",label:"Diff"},{key:"xml",label:"HTML/XML"},{key:"java",label:"Java"},{key:"javascript",label:"JavaScript"},{key:"markdown",label:"Markdown"},{key:"php",label:"PHP"},{key:"python",label:"Python"},{key:"ruby",label:"Ruby"},{key:"sql",label:"SQL"}]};class Wf extends Hl{static blotName="table";static tagName="TD";static create(e){const i=super.create();return e?i.setAttribute("data-row",e):i.setAttribute("data-row",IJ()),i}static formats(e){if(e.hasAttribute("data-row"))return e.getAttribute("data-row")}cellOffset(){return this.parent?this.parent.children.indexOf(this):-1}format(e,i){e===Wf.blotName&&i?this.domNode.setAttribute("data-row",i):super.format(e,i)}row(){return this.parent}rowOffset(){return this.row()?this.row().rowOffset():-1}table(){return this.row()&&this.row().table()}}class yw extends BS{static blotName="table-row";static tagName="TR";checkMerge(){if(super.checkMerge()&&this.next.children.head!=null){const e=this.children.head.formats(),i=this.children.tail.formats(),r=this.next.children.head.formats(),n=this.next.children.tail.formats();return e.table===i.table&&e.table===r.table&&e.table===n.table}return!1}optimize(e){super.optimize(e),this.children.forEach(i=>{if(i.next==null)return;const r=i.formats(),n=i.next.formats();if(r.table!==n.table){const a=this.splitAfter(i);a&&a.optimize(),this.prev&&this.prev.optimize()}})}rowOffset(){return this.parent?this.parent.children.indexOf(this):-1}table(){return this.parent&&this.parent.parent}}class hy extends BS{static blotName="table-body";static tagName="TBODY"}class FO extends BS{static blotName="table-container";static tagName="TABLE";balanceCells(){const e=this.descendants(yw),i=e.reduce((r,n)=>Math.max(n.children.length,r),0);e.forEach(r=>{new Array(i-r.children.length).fill(0).forEach(()=>{let n;r.children.head!=null&&(n=Wf.formats(r.children.head.domNode));const a=this.scroll.create(Wf.blotName,n);r.appendChild(a),a.optimize()})})}cells(e){return this.rows().map(i=>i.children.at(e))}deleteColumn(e){const[i]=this.descendant(hy);i==null||i.children.head==null||i.children.forEach(r=>{const n=r.children.at(e);n?.remove()})}insertColumn(e){const[i]=this.descendant(hy);i==null||i.children.head==null||i.children.forEach(r=>{const n=r.children.at(e),a=Wf.formats(r.children.head.domNode),s=this.scroll.create(Wf.blotName,a);r.insertBefore(s,n)})}insertRow(e){const[i]=this.descendant(hy);if(i==null||i.children.head==null)return;const r=IJ(),n=this.scroll.create(yw.blotName);i.children.head.children.forEach(()=>{const s=this.scroll.create(Wf.blotName,r);n.appendChild(s)});const a=i.children.at(e);i.insertBefore(n,a)}rows(){const e=this.children.head;return e==null?[]:e.children.map(i=>i)}}FO.allowedChildren=[hy];hy.requiredContainer=FO;hy.allowedChildren=[yw];yw.requiredContainer=hy;yw.allowedChildren=[Wf];Wf.requiredContainer=yw;function IJ(){return`row-${Math.random().toString(36).slice(2,6)}`}class Axt extends PA{static register(){pt.register(Wf),pt.register(yw),pt.register(hy),pt.register(FO)}constructor(){super(...arguments),this.listenBalanceCells()}balanceTables(){this.quill.scroll.descendants(FO).forEach(e=>{e.balanceCells()})}deleteColumn(){const[e,,i]=this.getTable();i!=null&&(e.deleteColumn(i.cellOffset()),this.quill.update(pt.sources.USER))}deleteRow(){const[,e]=this.getTable();e!=null&&(e.remove(),this.quill.update(pt.sources.USER))}deleteTable(){const[e]=this.getTable();if(e==null)return;const i=e.offset();e.remove(),this.quill.update(pt.sources.USER),this.quill.setSelection(i,pt.sources.SILENT)}getTable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.quill.getSelection();if(e==null)return[null,null,null,-1];const[i,r]=this.quill.getLine(e.index);if(i==null||i.statics.blotName!==Wf.blotName)return[null,null,null,-1];const n=i.parent;return[n.parent.parent,n,i,r]}insertColumn(e){const i=this.quill.getSelection();if(!i)return;const[r,n,a]=this.getTable(i);if(a==null)return;const s=a.cellOffset();r.insertColumn(s+e),this.quill.update(pt.sources.USER);let o=n.rowOffset();e===0&&(o+=1),this.quill.setSelection(i.index+o,i.length,pt.sources.SILENT)}insertColumnLeft(){this.insertColumn(0)}insertColumnRight(){this.insertColumn(1)}insertRow(e){const i=this.quill.getSelection();if(!i)return;const[r,n,a]=this.getTable(i);if(a==null)return;const s=n.rowOffset();r.insertRow(s+e),this.quill.update(pt.sources.USER),e>0?this.quill.setSelection(i,pt.sources.SILENT):this.quill.setSelection(i.index+n.children.length,i.length,pt.sources.SILENT)}insertRowAbove(){this.insertRow(0)}insertRowBelow(){this.insertRow(1)}insertTable(e,i){const r=this.quill.getSelection();if(r==null)return;const n=new Array(e).fill(0).reduce(a=>{const s=new Array(i).fill(`
`).join("");return a.insert(s,{table:IJ()})},new Ti().retain(r.index));this.quill.updateContents(n,pt.sources.USER),this.quill.setSelection(r.index,pt.sources.SILENT),this.balanceTables()}listenBalanceCells(){this.quill.on(pt.events.SCROLL_OPTIMIZE,e=>{e.some(i=>["TD","TR","TBODY","TABLE"].includes(i.target.tagName)?(this.quill.once(pt.events.TEXT_CHANGE,(r,n,a)=>{a===pt.sources.USER&&this.balanceTables()}),!0):!1)})}}const Nle=fv("quill:toolbar");let wJ=class extends PA{constructor(e,i){if(super(e,i),Array.isArray(this.options.container)){const r=document.createElement("div");r.setAttribute("role","toolbar"),gxt(r,this.options.container),e.container?.parentNode?.insertBefore(r,e.container),this.container=r}else typeof this.options.container=="string"?this.container=document.querySelector(this.options.container):this.container=this.options.container;if(!(this.container instanceof HTMLElement)){Nle.error("Container required for toolbar",this.options);return}this.container.classList.add("ql-toolbar"),this.controls=[],this.handlers={},this.options.handlers&&Object.keys(this.options.handlers).forEach(r=>{const n=this.options.handlers?.[r];n&&this.addHandler(r,n)}),Array.from(this.container.querySelectorAll("button, select")).forEach(r=>{this.attach(r)}),this.quill.on(pt.events.EDITOR_CHANGE,()=>{const[r]=this.quill.selection.getRange();this.update(r)})}addHandler(e,i){this.handlers[e]=i}attach(e){let i=Array.from(e.classList).find(n=>n.indexOf("ql-")===0);if(!i)return;if(i=i.slice(3),e.tagName==="BUTTON"&&e.setAttribute("type","button"),this.handlers[i]==null&&this.quill.scroll.query(i)==null){Nle.warn("ignoring attaching to nonexistent format",i,e);return}const r=e.tagName==="SELECT"?"change":"click";e.addEventListener(r,n=>{let a;if(e.tagName==="SELECT"){if(e.selectedIndex<0)return;const o=e.options[e.selectedIndex];o.hasAttribute("selected")?a=!1:a=o.value||!1}else e.classList.contains("ql-active")?a=!1:a=e.value||!e.hasAttribute("value"),n.preventDefault();this.quill.focus();const[s]=this.quill.selection.getRange();if(this.handlers[i]!=null)this.handlers[i].call(this,a);else if(this.quill.scroll.query(i).prototype instanceof mp){if(a=prompt(`Enter ${i}`),!a)return;this.quill.updateContents(new Ti().retain(s.index).delete(s.length).insert({[i]:a}),pt.sources.USER)}else this.quill.format(i,a,pt.sources.USER);this.update(s)}),this.controls.push([i,e])}update(e){const i=e==null?{}:this.quill.getFormat(e);this.controls.forEach(r=>{const[n,a]=r;if(a.tagName==="SELECT"){let s=null;if(e==null)s=null;else if(i[n]==null)s=a.querySelector("option[selected]");else if(!Array.isArray(i[n])){let o=i[n];typeof o=="string"&&(o=o.replace(/"/g,'\\"')),s=a.querySelector(`option[value="${o}"]`)}s==null?(a.value="",a.selectedIndex=-1):s.selected=!0}else if(e==null)a.classList.remove("ql-active"),a.setAttribute("aria-pressed","false");else if(a.hasAttribute("value")){const s=i[n],o=s===a.getAttribute("value")||s!=null&&s.toString()===a.getAttribute("value")||s==null&&!a.getAttribute("value");a.classList.toggle("ql-active",o),a.setAttribute("aria-pressed",o.toString())}else{const s=i[n]!=null;a.classList.toggle("ql-active",s),a.setAttribute("aria-pressed",s.toString())}})}};wJ.DEFAULTS={};function Ble(t,e,i){const r=document.createElement("button");r.setAttribute("type","button"),r.classList.add(`ql-${e}`),r.setAttribute("aria-pressed","false"),i!=null?(r.value=i,r.setAttribute("aria-label",`${e}: ${i}`)):r.setAttribute("aria-label",e),t.appendChild(r)}function gxt(t,e){Array.isArray(e[0])||(e=[e]),e.forEach(i=>{const r=document.createElement("span");r.classList.add("ql-formats"),i.forEach(n=>{if(typeof n=="string")Ble(r,n);else{const a=Object.keys(n)[0],s=n[a];Array.isArray(s)?vxt(r,a,s):Ble(r,a,s)}}),t.appendChild(r)})}function vxt(t,e,i){const r=document.createElement("select");r.classList.add(`ql-${e}`),i.forEach(n=>{const a=document.createElement("option");n!==!1?a.setAttribute("value",String(n)):a.setAttribute("selected","selected"),r.appendChild(a)}),t.appendChild(r)}wJ.DEFAULTS={container:null,handlers:{clean(){const t=this.quill.getSelection();if(t!=null)if(t.length===0){const e=this.quill.getFormat();Object.keys(e).forEach(i=>{this.quill.scroll.query(i,Pi.INLINE)!=null&&this.quill.format(i,!1,pt.sources.USER)})}else this.quill.removeFormat(t.index,t.length,pt.sources.USER)},direction(t){const{align:e}=this.quill.getFormat();t==="rtl"&&e==null?this.quill.format("align","right",pt.sources.USER):!t&&e==="right"&&this.quill.format("align",!1,pt.sources.USER),this.quill.format("direction",t,pt.sources.USER)},indent(t){const e=this.quill.getSelection(),i=this.quill.getFormat(e),r=parseInt(i.indent||0,10);if(t==="+1"||t==="-1"){let n=t==="+1"?1:-1;i.direction==="rtl"&&(n*=-1),this.quill.format("indent",r+n,pt.sources.USER)}},link(t){t===!0&&(t=prompt("Enter link URL:")),this.quill.format("link",t,pt.sources.USER)},list(t){const e=this.quill.getSelection(),i=this.quill.getFormat(e);t==="check"?i.list==="checked"||i.list==="unchecked"?this.quill.format("list",!1,pt.sources.USER):this.quill.format("list","unchecked",pt.sources.USER):this.quill.format("list",t,pt.sources.USER)}}};const yxt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="13" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="9" y1="4" y2="4"/></svg>',bxt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="14" x2="4" y1="14" y2="14"/><line class="ql-stroke" x1="12" x2="6" y1="4" y2="4"/></svg>',Ixt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="5" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="9" y1="4" y2="4"/></svg>',wxt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="3" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="3" y1="4" y2="4"/></svg>',Sxt='<svg viewbox="0 0 18 18"><g class="ql-fill ql-color-label"><polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"/><rect height="1" width="1" x="4" y="4"/><polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"/><rect height="1" width="1" x="2" y="6"/><rect height="1" width="1" x="3" y="5"/><rect height="1" width="1" x="4" y="7"/><polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"/><rect height="1" width="1" x="2" y="12"/><rect height="1" width="1" x="2" y="9"/><rect height="1" width="1" x="2" y="15"/><polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"/><rect height="1" width="1" x="3" y="8"/><path d="M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z"/><path d="M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z"/><path d="M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z"/><rect height="1" width="1" x="12" y="2"/><rect height="1" width="1" x="11" y="3"/><path d="M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z"/><rect height="1" width="1" x="2" y="3"/><rect height="1" width="1" x="6" y="2"/><rect height="1" width="1" x="3" y="2"/><rect height="1" width="1" x="5" y="3"/><rect height="1" width="1" x="9" y="2"/><rect height="1" width="1" x="15" y="14"/><polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"/><rect height="1" width="1" x="13" y="7"/><rect height="1" width="1" x="15" y="5"/><rect height="1" width="1" x="14" y="6"/><rect height="1" width="1" x="15" y="8"/><rect height="1" width="1" x="14" y="9"/><path d="M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z"/><rect height="1" width="1" x="14" y="3"/><polygon points="12 6.868 12 6 11.62 6 12 6.868"/><rect height="1" width="1" x="15" y="2"/><rect height="1" width="1" x="12" y="5"/><rect height="1" width="1" x="13" y="4"/><polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"/><rect height="1" width="1" x="9" y="14"/><rect height="1" width="1" x="8" y="15"/><path d="M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z"/><rect height="1" width="1" x="5" y="15"/><path d="M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z"/><rect height="1" width="1" x="11" y="15"/><path d="M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z"/><rect height="1" width="1" x="14" y="15"/><rect height="1" width="1" x="15" y="11"/></g><polyline class="ql-stroke" points="5.5 13 9 5 12.5 13"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="11" y2="11"/></svg>',Uxt='<svg viewbox="0 0 18 18"><rect class="ql-fill ql-stroke" height="3" width="3" x="4" y="5"/><rect class="ql-fill ql-stroke" height="3" width="3" x="11" y="5"/><path class="ql-even ql-fill ql-stroke" d="M7,8c0,4.031-3,5-3,5"/><path class="ql-even ql-fill ql-stroke" d="M14,8c0,4.031-3,5-3,5"/></svg>',Txt='<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z"/><path class="ql-stroke" d="M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z"/></svg>',Cxt='<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="5" x2="13" y1="3" y2="3"/><line class="ql-stroke" x1="6" x2="9.35" y1="12" y2="3"/><line class="ql-stroke" x1="11" x2="15" y1="11" y2="15"/><line class="ql-stroke" x1="15" x2="11" y1="11" y2="15"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="7" x="2" y="14"/></svg>',kle='<svg viewbox="0 0 18 18"><polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"/><polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"/><line class="ql-stroke" x1="10" x2="8" y1="5" y2="13"/></svg>',Ext='<svg viewbox="0 0 18 18"><line class="ql-color-label ql-stroke ql-transparent" x1="3" x2="15" y1="15" y2="15"/><polyline class="ql-stroke" points="5.5 11 9 3 12.5 11"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="9" y2="9"/></svg>',Dxt='<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"/><line class="ql-stroke ql-fill" x1="15" x2="11" y1="4" y2="4"/><path class="ql-fill" d="M11,3a3,3,0,0,0,0,6h1V3H11Z"/><rect class="ql-fill" height="11" width="1" x="11" y="4"/><rect class="ql-fill" height="11" width="1" x="13" y="4"/></svg>',Pxt='<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"/><line class="ql-stroke ql-fill" x1="9" x2="5" y1="4" y2="4"/><path class="ql-fill" d="M5,3A3,3,0,0,0,5,9H6V3H5Z"/><rect class="ql-fill" height="11" width="1" x="5" y="4"/><rect class="ql-fill" height="11" width="1" x="7" y="4"/></svg>',Rxt='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z"/><rect class="ql-fill" height="1.6" rx="0.8" ry="0.8" width="5" x="5.15" y="6.2"/><path class="ql-fill" d="M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z"/></svg>',Mxt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z"/></svg>',Nxt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',Bxt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.65186,12.30664a2.6742,2.6742,0,0,1-2.915,2.68457,3.96592,3.96592,0,0,1-2.25537-.6709.56007.56007,0,0,1-.13232-.83594L11.64648,13c.209-.34082.48389-.36328.82471-.1543a2.32654,2.32654,0,0,0,1.12256.33008c.71484,0,1.12207-.35156,1.12207-.78125,0-.61523-.61621-.86816-1.46338-.86816H13.2085a.65159.65159,0,0,1-.68213-.41895l-.05518-.10937a.67114.67114,0,0,1,.14307-.78125l.71533-.86914a8.55289,8.55289,0,0,1,.68213-.7373V8.58887a3.93913,3.93913,0,0,1-.748.05469H11.9873a.54085.54085,0,0,1-.605-.60547V7.59863a.54085.54085,0,0,1,.605-.60547h3.75146a.53773.53773,0,0,1,.60547.59375v.17676a1.03723,1.03723,0,0,1-.27539.748L14.74854,10.0293A2.31132,2.31132,0,0,1,16.65186,12.30664ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',kxt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm7.05371,7.96582v.38477c0,.39648-.165.60547-.46191.60547h-.47314v1.29785a.54085.54085,0,0,1-.605.60547h-.69336a.54085.54085,0,0,1-.605-.60547V12.95605H11.333a.5412.5412,0,0,1-.60547-.60547v-.15332a1.199,1.199,0,0,1,.22021-.748l2.56348-4.05957a.7819.7819,0,0,1,.72607-.39648h1.27637a.54085.54085,0,0,1,.605.60547v3.7627h.33008A.54055.54055,0,0,1,17.05371,11.96582ZM14.28125,8.7207h-.022a4.18969,4.18969,0,0,1-.38525.81348l-1.188,1.80469v.02246h1.5293V9.60059A7.04058,7.04058,0,0,1,14.28125,8.7207Z"/></svg>',xxt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.74023,12.18555a2.75131,2.75131,0,0,1-2.91553,2.80566,3.908,3.908,0,0,1-2.25537-.68164.54809.54809,0,0,1-.13184-.8252L11.73438,13c.209-.34082.48389-.36328.8252-.1543a2.23757,2.23757,0,0,0,1.1001.33008,1.01827,1.01827,0,0,0,1.1001-.96777c0-.61621-.53906-.97949-1.25439-.97949a2.15554,2.15554,0,0,0-.64893.09961,1.15209,1.15209,0,0,1-.814.01074l-.12109-.04395a.64116.64116,0,0,1-.45117-.71484l.231-3.00391a.56666.56666,0,0,1,.62744-.583H15.541a.54085.54085,0,0,1,.605.60547v.43945a.54085.54085,0,0,1-.605.60547H13.41748l-.04395.72559a1.29306,1.29306,0,0,1-.04395.30859h.022a2.39776,2.39776,0,0,1,.57227-.07715A2.53266,2.53266,0,0,1,16.74023,12.18555ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',_xt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M14.51758,9.64453a1.85627,1.85627,0,0,0-1.24316.38477H13.252a1.73532,1.73532,0,0,1,1.72754-1.4082,2.66491,2.66491,0,0,1,.5498.06641c.35254.05469.57227.01074.70508-.40723l.16406-.5166a.53393.53393,0,0,0-.373-.75977,4.83723,4.83723,0,0,0-1.17773-.14258c-2.43164,0-3.7627,2.17773-3.7627,4.43359,0,2.47559,1.60645,3.69629,3.19043,3.69629A2.70585,2.70585,0,0,0,16.96,12.19727,2.43861,2.43861,0,0,0,14.51758,9.64453Zm-.23047,3.58691c-.67187,0-1.22168-.81445-1.22168-1.45215,0-.47363.30762-.583.72559-.583.96875,0,1.27734.59375,1.27734,1.12207A.82182.82182,0,0,1,14.28711,13.23145ZM10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Z"/></svg>',Oxt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="13" y1="4" y2="4"/><line class="ql-stroke" x1="5" x2="11" y1="14" y2="14"/><line class="ql-stroke" x1="8" x2="10" y1="14" y2="4"/></svg>',Fxt='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="10" width="12" x="3" y="4"/><circle class="ql-fill" cx="6" cy="7" r="1"/><polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"/></svg>',Lxt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"/></svg>',$xt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="5 7 5 11 3 9 5 7"/></svg>',Hxt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="11" y1="7" y2="11"/><path class="ql-even ql-stroke" d="M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z"/><path class="ql-even ql-stroke" d="M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z"/></svg>',Vxt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="6" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="6" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="6" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="3" y1="4" y2="4"/><line class="ql-stroke" x1="3" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="3" y1="14" y2="14"/></svg>',Gxt='<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="9" x2="15" y1="4" y2="4"/><polyline class="ql-stroke" points="3 4 4 5 6 3"/><line class="ql-stroke" x1="9" x2="15" y1="14" y2="14"/><polyline class="ql-stroke" points="3 14 4 15 6 13"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="3 9 4 10 6 8"/></svg>',Qxt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="7" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="7" x2="15" y1="14" y2="14"/><line class="ql-stroke ql-thin" x1="2.5" x2="4.5" y1="5.5" y2="5.5"/><path class="ql-fill" d="M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z"/><path class="ql-stroke ql-thin" d="M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156"/><path class="ql-stroke ql-thin" d="M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109"/></svg>',jxt='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z"/><path class="ql-fill" d="M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z"/></svg>',zxt='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z"/><path class="ql-fill" d="M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z"/></svg>',qxt='<svg viewbox="0 0 18 18"><line class="ql-stroke ql-thin" x1="15.5" x2="2.5" y1="8.5" y2="9.5"/><path class="ql-fill" d="M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z"/><path class="ql-fill" d="M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z"/></svg>',Wxt='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="2" width="3" x="5" y="5"/><rect class="ql-fill" height="2" width="4" x="9" y="5"/><g class="ql-fill ql-transparent"><rect height="2" width="3" x="5" y="8"/><rect height="2" width="4" x="9" y="8"/><rect height="2" width="3" x="5" y="11"/><rect height="2" width="4" x="9" y="11"/></g></svg>',Kxt='<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="12" x="3" y="15"/></svg>',Yxt='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="12" width="1" x="5" y="3"/><rect class="ql-fill" height="12" width="1" x="12" y="3"/><rect class="ql-fill" height="2" width="8" x="5" y="8"/><rect class="ql-fill" height="1" width="3" x="3" y="5"/><rect class="ql-fill" height="1" width="3" x="3" y="7"/><rect class="ql-fill" height="1" width="3" x="3" y="10"/><rect class="ql-fill" height="1" width="3" x="3" y="12"/><rect class="ql-fill" height="1" width="3" x="12" y="5"/><rect class="ql-fill" height="1" width="3" x="12" y="7"/><rect class="ql-fill" height="1" width="3" x="12" y="10"/><rect class="ql-fill" height="1" width="3" x="12" y="12"/></svg>',T1={align:{"":yxt,center:bxt,right:Ixt,justify:wxt},background:Sxt,blockquote:Uxt,bold:Txt,clean:Cxt,code:kle,"code-block":kle,color:Ext,direction:{"":Dxt,rtl:Pxt},formula:Rxt,header:{1:Mxt,2:Nxt,3:Bxt,4:kxt,5:xxt,6:_xt},italic:Oxt,image:Fxt,indent:{"+1":Lxt,"-1":$xt},link:Hxt,list:{bullet:Vxt,check:Gxt,ordered:Qxt},script:{sub:jxt,super:zxt},strike:qxt,table:Wxt,underline:Kxt,video:Yxt},Xxt='<svg viewbox="0 0 18 18"><polygon class="ql-stroke" points="7 11 9 13 11 11 7 11"/><polygon class="ql-stroke" points="7 7 9 5 11 7 7 7"/></svg>';let xle=0;function _le(t,e){t.setAttribute(e,`${t.getAttribute(e)!=="true"}`)}class oV{constructor(e){this.select=e,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",()=>{this.togglePicker()}),this.label.addEventListener("keydown",i=>{switch(i.key){case"Enter":this.togglePicker();break;case"Escape":this.escape(),i.preventDefault();break}}),this.select.addEventListener("change",this.update.bind(this))}togglePicker(){this.container.classList.toggle("ql-expanded"),_le(this.label,"aria-expanded"),_le(this.options,"aria-hidden")}buildItem(e){const i=document.createElement("span");i.tabIndex="0",i.setAttribute("role","button"),i.classList.add("ql-picker-item");const r=e.getAttribute("value");return r&&i.setAttribute("data-value",r),e.textContent&&i.setAttribute("data-label",e.textContent),i.addEventListener("click",()=>{this.selectItem(i,!0)}),i.addEventListener("keydown",n=>{switch(n.key){case"Enter":this.selectItem(i,!0),n.preventDefault();break;case"Escape":this.escape(),n.preventDefault();break}}),i}buildLabel(){const e=document.createElement("span");return e.classList.add("ql-picker-label"),e.innerHTML=Xxt,e.tabIndex="0",e.setAttribute("role","button"),e.setAttribute("aria-expanded","false"),this.container.appendChild(e),e}buildOptions(){const e=document.createElement("span");e.classList.add("ql-picker-options"),e.setAttribute("aria-hidden","true"),e.tabIndex="-1",e.id=`ql-picker-options-${xle}`,xle+=1,this.label.setAttribute("aria-controls",e.id),this.options=e,Array.from(this.select.options).forEach(i=>{const r=this.buildItem(i);e.appendChild(r),i.selected===!0&&this.selectItem(r)}),this.container.appendChild(e)}buildPicker(){Array.from(this.select.attributes).forEach(e=>{this.container.setAttribute(e.name,e.value)}),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}escape(){this.close(),setTimeout(()=>this.label.focus(),1)}close(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}selectItem(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const r=this.container.querySelector(".ql-selected");e!==r&&(r?.classList.remove("ql-selected"),e!=null&&(e.classList.add("ql-selected"),this.select.selectedIndex=Array.from(e.parentNode.children).indexOf(e),e.hasAttribute("data-value")?this.label.setAttribute("data-value",e.getAttribute("data-value")):this.label.removeAttribute("data-value"),e.hasAttribute("data-label")?this.label.setAttribute("data-label",e.getAttribute("data-label")):this.label.removeAttribute("data-label"),i&&(this.select.dispatchEvent(new Event("change")),this.close())))}update(){let e;if(this.select.selectedIndex>-1){const r=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];e=this.select.options[this.select.selectedIndex],this.selectItem(r)}else this.selectItem(null);const i=e!=null&&e!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",i)}}class Lxe extends oV{constructor(e,i){super(e),this.label.innerHTML=i,this.container.classList.add("ql-color-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).slice(0,7).forEach(r=>{r.classList.add("ql-primary")})}buildItem(e){const i=super.buildItem(e);return i.style.backgroundColor=e.getAttribute("value")||"",i}selectItem(e,i){super.selectItem(e,i);const r=this.label.querySelector(".ql-color-label"),n=e&&e.getAttribute("data-value")||"";r&&(r.tagName==="line"?r.style.stroke=n:r.style.fill=n)}}class $xe extends oV{constructor(e,i){super(e),this.container.classList.add("ql-icon-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).forEach(r=>{r.innerHTML=i[r.getAttribute("data-value")||""]}),this.defaultItem=this.container.querySelector(".ql-selected"),this.selectItem(this.defaultItem)}selectItem(e,i){super.selectItem(e,i);const r=e||this.defaultItem;if(r!=null){if(this.label.innerHTML===r.innerHTML)return;this.label.innerHTML=r.innerHTML}}}const Zxt=t=>{const{overflowY:e}=getComputedStyle(t,null);return e!=="visible"&&e!=="clip"};class Hxe{constructor(e,i){this.quill=e,this.boundsContainer=i||document.body,this.root=e.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,Zxt(this.quill.root)&&this.quill.root.addEventListener("scroll",()=>{this.root.style.marginTop=`${-1*this.quill.root.scrollTop}px`}),this.hide()}hide(){this.root.classList.add("ql-hidden")}position(e){const i=e.left+e.width/2-this.root.offsetWidth/2,r=e.bottom+this.quill.root.scrollTop;this.root.style.left=`${i}px`,this.root.style.top=`${r}px`,this.root.classList.remove("ql-flip");const n=this.boundsContainer.getBoundingClientRect(),a=this.root.getBoundingClientRect();let s=0;if(a.right>n.right&&(s=n.right-a.right,this.root.style.left=`${i+s}px`),a.left<n.left&&(s=n.left-a.left,this.root.style.left=`${i+s}px`),a.bottom>n.bottom){const o=a.bottom-a.top,l=e.bottom-e.top+o;this.root.style.top=`${r-l}px`,this.root.classList.add("ql-flip")}return s}show(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}}const Jxt=[!1,"center","right","justify"],e_t=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],t_t=[!1,"serif","monospace"],i_t=["1","2","3",!1],r_t=["small",!1,"large","huge"];class LN extends qE{constructor(e,i){super(e,i);const r=n=>{if(!document.body.contains(e.root)){document.body.removeEventListener("click",r);return}this.tooltip!=null&&!this.tooltip.root.contains(n.target)&&document.activeElement!==this.tooltip.textbox&&!this.quill.hasFocus()&&this.tooltip.hide(),this.pickers!=null&&this.pickers.forEach(a=>{a.container.contains(n.target)||a.close()})};e.emitter.listenDOM("click",document.body,r)}addModule(e){const i=super.addModule(e);return e==="toolbar"&&this.extendToolbar(i),i}buildButtons(e,i){Array.from(e).forEach(r=>{(r.getAttribute("class")||"").split(/\s+/).forEach(a=>{if(a.startsWith("ql-")&&(a=a.slice(3),i[a]!=null))if(a==="direction")r.innerHTML=i[a][""]+i[a].rtl;else if(typeof i[a]=="string")r.innerHTML=i[a];else{const s=r.value||"";s!=null&&i[a][s]&&(r.innerHTML=i[a][s])}})})}buildPickers(e,i){this.pickers=Array.from(e).map(n=>{if(n.classList.contains("ql-align")&&(n.querySelector("option")==null&&UD(n,Jxt),typeof i.align=="object"))return new $xe(n,i.align);if(n.classList.contains("ql-background")||n.classList.contains("ql-color")){const a=n.classList.contains("ql-background")?"background":"color";return n.querySelector("option")==null&&UD(n,e_t,a==="background"?"#ffffff":"#000000"),new Lxe(n,i[a])}return n.querySelector("option")==null&&(n.classList.contains("ql-font")?UD(n,t_t):n.classList.contains("ql-header")?UD(n,i_t):n.classList.contains("ql-size")&&UD(n,r_t)),new oV(n)});const r=()=>{this.pickers.forEach(n=>{n.update()})};this.quill.on(vi.events.EDITOR_CHANGE,r)}}LN.DEFAULTS=fy({},qE.DEFAULTS,{modules:{toolbar:{handlers:{formula(){this.quill.theme.tooltip.edit("formula")},image(){let t=this.container.querySelector("input.ql-image[type=file]");t==null&&(t=document.createElement("input"),t.setAttribute("type","file"),t.setAttribute("accept",this.quill.uploader.options.mimetypes.join(", ")),t.classList.add("ql-image"),t.addEventListener("change",()=>{const e=this.quill.getSelection(!0);this.quill.uploader.upload(e,t.files),t.value=""}),this.container.appendChild(t)),t.click()},video(){this.quill.theme.tooltip.edit("video")}}}}});class Vxe extends Hxe{constructor(e,i){super(e,i),this.textbox=this.root.querySelector('input[type="text"]'),this.listen()}listen(){this.textbox.addEventListener("keydown",e=>{e.key==="Enter"?(this.save(),e.preventDefault()):e.key==="Escape"&&(this.cancel(),e.preventDefault())})}cancel(){this.hide(),this.restoreFocus()}edit(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"link",i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),this.textbox==null)return;i!=null?this.textbox.value=i:e!==this.root.getAttribute("data-mode")&&(this.textbox.value="");const r=this.quill.getBounds(this.quill.selection.savedRange);r!=null&&this.position(r),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute(`data-${e}`)||""),this.root.setAttribute("data-mode",e)}restoreFocus(){this.quill.focus({preventScroll:!0})}save(){let{value:e}=this.textbox;switch(this.root.getAttribute("data-mode")){case"link":{const{scrollTop:i}=this.quill.root;this.linkRange?(this.quill.formatText(this.linkRange,"link",e,vi.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",e,vi.sources.USER)),this.quill.root.scrollTop=i;break}case"video":e=n_t(e);case"formula":{if(!e)break;const i=this.quill.getSelection(!0);if(i!=null){const r=i.index+i.length;this.quill.insertEmbed(r,this.root.getAttribute("data-mode"),e,vi.sources.USER),this.root.getAttribute("data-mode")==="formula"&&this.quill.insertText(r+1," ",vi.sources.USER),this.quill.setSelection(r+2,vi.sources.USER)}break}}this.textbox.value="",this.hide()}}function n_t(t){let e=t.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||t.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return e?`${e[1]||"https"}://www.youtube.com/embed/${e[2]}?showinfo=0`:(e=t.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?`${e[1]||"https"}://player.vimeo.com/video/${e[2]}/`:t}function UD(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;e.forEach(r=>{const n=document.createElement("option");r===i?n.setAttribute("selected","selected"):n.setAttribute("value",String(r)),t.appendChild(n)})}const a_t=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]];class s_t extends Vxe{static TEMPLATE=['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join("");constructor(e,i){super(e,i),this.quill.on(vi.events.EDITOR_CHANGE,(r,n,a,s)=>{if(r===vi.events.SELECTION_CHANGE)if(n!=null&&n.length>0&&s===vi.sources.USER){this.show(),this.root.style.left="0px",this.root.style.width="",this.root.style.width=`${this.root.offsetWidth}px`;const o=this.quill.getLines(n.index,n.length);if(o.length===1){const l=this.quill.getBounds(n);l!=null&&this.position(l)}else{const l=o[o.length-1],c=this.quill.getIndex(l),u=Math.min(l.length()-1,n.index+n.length-c),d=this.quill.getBounds(new vw(c,u));d!=null&&this.position(d)}}else document.activeElement!==this.textbox&&this.quill.hasFocus()&&this.hide()})}listen(){super.listen(),this.root.querySelector(".ql-close").addEventListener("click",()=>{this.root.classList.remove("ql-editing")}),this.quill.on(vi.events.SCROLL_OPTIMIZE,()=>{setTimeout(()=>{if(this.root.classList.contains("ql-hidden"))return;const e=this.quill.getSelection();if(e!=null){const i=this.quill.getBounds(e);i!=null&&this.position(i)}},1)})}cancel(){this.show()}position(e){const i=super.position(e),r=this.root.querySelector(".ql-tooltip-arrow");return r.style.marginLeft="",i!==0&&(r.style.marginLeft=`${-1*i-r.offsetWidth/2}px`),i}}class Gxe extends LN{constructor(e,i){i.modules.toolbar!=null&&i.modules.toolbar.container==null&&(i.modules.toolbar.container=a_t),super(e,i),this.quill.container.classList.add("ql-bubble")}extendToolbar(e){this.tooltip=new s_t(this.quill,this.options.bounds),e.container!=null&&(this.tooltip.root.appendChild(e.container),this.buildButtons(e.container.querySelectorAll("button"),T1),this.buildPickers(e.container.querySelectorAll("select"),T1))}}Gxe.DEFAULTS=fy({},LN.DEFAULTS,{modules:{toolbar:{handlers:{link(t){t?this.quill.theme.tooltip.edit():this.quill.format("link",!1,pt.sources.USER)}}}}});const o_t=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]];class l_t extends Vxe{static TEMPLATE=['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join("");preview=this.root.querySelector("a.ql-preview");listen(){super.listen(),this.root.querySelector("a.ql-action").addEventListener("click",e=>{this.root.classList.contains("ql-editing")?this.save():this.edit("link",this.preview.textContent),e.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",e=>{if(this.linkRange!=null){const i=this.linkRange;this.restoreFocus(),this.quill.formatText(i,"link",!1,vi.sources.USER),delete this.linkRange}e.preventDefault(),this.hide()}),this.quill.on(vi.events.SELECTION_CHANGE,(e,i,r)=>{if(e!=null){if(e.length===0&&r===vi.sources.USER){const[n,a]=this.quill.scroll.descendant(OO,e.index);if(n!=null){this.linkRange=new vw(e.index-a,n.length());const s=OO.formats(n.domNode);this.preview.textContent=s,this.preview.setAttribute("href",s),this.show();const o=this.quill.getBounds(this.linkRange);o!=null&&this.position(o);return}}else delete this.linkRange;this.hide()}})}show(){super.show(),this.root.removeAttribute("data-mode")}}class Qxe extends LN{constructor(e,i){i.modules.toolbar!=null&&i.modules.toolbar.container==null&&(i.modules.toolbar.container=o_t),super(e,i),this.quill.container.classList.add("ql-snow")}extendToolbar(e){e.container!=null&&(e.container.classList.add("ql-snow"),this.buildButtons(e.container.querySelectorAll("button"),T1),this.buildPickers(e.container.querySelectorAll("select"),T1),this.tooltip=new l_t(this.quill,this.options.bounds),e.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"k",shortKey:!0},(i,r)=>{e.handlers.link.call(e,!r.format.link)}))}}Qxe.DEFAULTS=fy({},LN.DEFAULTS,{modules:{toolbar:{handlers:{link(t){if(t){const e=this.quill.getSelection();if(e==null||e.length===0)return;let i=this.quill.getText(e);/^\S+@\S+\.\S+$/.test(i)&&i.indexOf("mailto:")!==0&&(i=`mailto:${i}`);const{tooltip:r}=this.quill.theme;r.edit("link",i)}else this.quill.format("link",!1,pt.sources.USER)}}}}});pt.register({"attributors/attribute/direction":Exe,"attributors/class/align":Uxe,"attributors/class/background":fkt,"attributors/class/color":pkt,"attributors/class/direction":Dxe,"attributors/class/font":Mxe,"attributors/class/size":Bxe,"attributors/style/align":Txe,"attributors/style/background":mJ,"attributors/style/color":hJ,"attributors/style/direction":Pxe,"attributors/style/font":Nxe,"attributors/style/size":kxe},!0);pt.register({"formats/align":Uxe,"formats/direction":Dxe,"formats/indent":axt,"formats/background":mJ,"formats/color":hJ,"formats/font":Mxe,"formats/size":Bxe,"formats/blockquote":sxt,"formats/code-block":lu,"formats/header":oxt,"formats/list":FN,"formats/bold":bJ,"formats/code":AJ,"formats/italic":lxt,"formats/link":OO,"formats/script":cxt,"formats/strike":uxt,"formats/underline":dxt,"formats/formula":pxt,"formats/image":fxt,"formats/video":hxt,"modules/syntax":Fxe,"modules/table":Axt,"modules/toolbar":wJ,"themes/bubble":Gxe,"themes/snow":Qxe,"ui/icons":T1,"ui/picker":oV,"ui/icon-picker":$xe,"ui/color-picker":Lxe,"ui/tooltip":Hxe},!0);function c_t({controlAnchor:t}){const e={editing:!1};return eo({target:t,items:[{label:"Tournament image",onClick:s1t,id:"tournamentImage",location:Ht,intent:"none"},{label:"Edit overview",onClick:()=>{const n=document.getElementById("editOverview"),a=document.getElementById("notes");if(!(!n||!a)){if(n.innerHTML=e.editing?"Edit overview":"Save overview",e.editing){a.previousElementSibling&&a.previousElementSibling.remove(),a.style.border="none";const s=a.querySelector(".ql-editor"),l=s?.innerText?.replace(`
`,"")?s.innerHTML:"";fo(a),a.innerHTML=l,Nt({methods:[{method:ldt,params:{notes:l}}]})}else{a.style.border=".5px solid",a.style.borderTop="";const s=new pt("#notes",{modules:{toolbar:[[{header:[1,2,3,4,5,6,!1]}],[{font:[]}],["bold","italic","underline"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["blockquote","code-block","link","video"],["clean"]]},theme:"snow"});ot.quill=s}e.editing=!e.editing}},id:"editOverview",location:Ht,intent:"none"}]})?.elements}function u_t({tournamentName:t}){const e=document.getElementById(aE);if(!e)return;e.style.minHeight=`${window.innerHeight*.9}px`,fo(e);const i=document.createElement("div");i.style.fontWeight="bold",i.className="block",i.innerHTML=$t.device.isMobile?t??"Tournament overview":"Tournament overview",e.appendChild(i);const r=document.createElement("div");e.appendChild(r);const n=Ge.getTournament().tournamentRecord?.notes,a=document.createElement("div");a.className="ql-container ql-snow",a.style.border="none",a.innerHTML=n??"",a.id="notes",e.appendChild(a),c_t({controlAnchor:r})}let wC;function lV(t){gk(n0,t),gk(UP,t),gk(Uh,t),gk(s2,t);const e=document.getElementById("trnynav"),i=document.getElementById("dnav");[n0,Uh].includes(t)?(e&&(e.style.display=t===n0?"":jt),i&&(i.style.display="")):i&&(i.style.display=jt)}function gk(t,e){const i=t===e,r=document.getElementById(t);r&&(r.style.display=i?"flex":"none")}const qQ=()=>{const t=document.getElementById("dnav");t&&(t.style.display=jt),wC=UP,lV(UP)},d_t=t=>{wC=t,lV(n0)},p_t=()=>{const t=document.getElementById("pageTitle");t&&(t.innerHTML="<div class='tmx-title'>Tournaments</div>"),wC=Uh,lV(wC)},f_t=()=>{wC=s2,lV(wC)};function h_t({config:t}={}){const{tournamentRecord:e}=Ge.getTournament();e?.tournamentId===t.tournamentId?jxe(t):(ot.ee.emit(_Me,ot.tournamentId),ou.findTournament(t.tournamentId).then(i=>kz({tournamentRecord:i,config:t})))}function WQ({config:t}){d_t(js),NIt(),HZ(t.selectedTab),jxe(t)}function jxe(t){const{selectedTab:e=Vm}=t;_be(e)&&(e===Vm&&Jvt({participantView:t.participantView}),e===Ny&&$Ne({scheduledDate:t.scheduledDate}),e===aE&&u_t({tournamentName:Ge.getTournamentInfo().tournamentInfo?.tournamentName}),e===jf&&a1t(t),e===F6&&CIt(),e===L6&&twt())}function kz({tournamentRecord:t,config:e}){const r=gu()?.provider||ot?.provider,n=()=>{Pt({message:"Tournament not found",onClose:()=>{ot.router.navigate("/tournaments")},intent:"is-warning",pauseOnHover:!0})},a=s=>{const o=s?.data?.tournamentRecords?.[e.tournamentId];o?(Ge.setState(o),WQ({config:e})):n()};if(r){const s=()=>{t?(Ge.setState(t),WQ({config:e})):n()};if(e.tournamentId){if(t?.timeItems?.find(({itemType:l})=>l==="TMX")?.itemValue?.offline)return s();f2({tournamentId:e.tournamentId}).then(a,s)}}else Ge.setState(t),WQ({config:e})}const Ole={addDrawDefinition:t=>Is("addDrawDefinition",t),addMatchUps:t=>Is("addMatchUps",t),addParticipants:t=>Is("addParticipants",t),addVenue:t=>Is("addVenue",t),deletedDrawIds:t=>Is("deletedDrawIds",t),deletedMatchUpIds:t=>Is("deletedMatchUpIds",t),deleteVenue:t=>Is("deleteVenue",t),modifyDrawDefinition:t=>Is("modifyDrawDefinition",t),modifyDrawEntries:t=>Is("modifyDrawEntries",t),modifyEventEntries:t=>Is("modifyEventEntries",t),modifyMatchUp:t=>Is("modifyMatchUp",t),modifyParticipants:t=>Is("modifyParticipants",t),modifyPositionAssignments:t=>Is("modifyPositionAssignments",t),modifySeedAssignments:t=>Is("modifySeedAssignments",t),modifyVenue:t=>Is("modifyVenue",t),publishEvent:t=>Is("publishEvent",t),publishEventSeeding:t=>Is("publishEventSeeding",t),publishOrderOfPlay:t=>Is("publishOrderOfPlay",t),unPublishEvent:t=>Is("unPublishEvent",t),unPublishEventSeeding:t=>Is("unPublishEventSeeding",t),unPublishOrderOfPlay:t=>Is("unPublishOrderOfPlay",t),updateInContextMatchUp:t=>Is("updateInContextMatchUp",t),modifyTournamentDetail:t=>Is("modifyTournamentDetail",t)};function Is(t,e){return typeof window.dev?.subs?.[t]=="function"?window.dev.subs[t](e):(window.dev.allSubscriptions||window.dev.subs?.[t])&&console.log(t,e)}function zxe(){if(!window.dev)console.log("%c dev initialized","color: yellow"),window.dev={};else return;const t=()=>console.log("set window.socketURL for messaging"),e=n=>{if(!Array.isArray(n)){Pt({message:"missing methods array",intent:"is-danger"});return}Ge.getTournament().tournamentRecord?.tournamentId?Nt({methods:n,callback:o=>{if(o?.success){Pt({message:"success",intent:"is-success"});const l=Ge.getTournament().tournamentRecord;kz({tournamentRecord:l,config:{selectedTab:js}})}else Pt({message:o?.error?.message??"error",intent:"is-danger"}),console.log({result:o})}}):Pt({message:"missing tournament",intent:"is-danger"})},i=n=>{f2({tournamentId:n}).then(a=>{if(a?.error)console.log({error:a.error});else{const s=a?.data?.tournamentRecords?.[n];s&&kz({tournamentRecord:s,config:{selectedTab:js}})}})},r=Object.assign({},...Object.keys(Ole).map(n=>({[n]:!1})));vk({getProviders:PP,getProvider:n=>PP().then(a=>console.log(a?.data?.providers.find(s=>s.value.organisationName.toLowerCase().includes(n.toLowerCase())))),getTournament:()=>Ge.getTournament()?.tournamentRecord,getContext:KU.getDevContext,tournamentEngine:Ge,context:KU.setDevContext,generateMockTournament:A_t,modifyTournament:e,fetchTournament:i,sendTournament:l0,getLoginState:gu,getUsers:lIe,factory:r4,baseApi:Uu,dayjs:kZ,help:t,subs:r}),vk({connectSocket:XMe,disconnectSocket:OH,emitTmx:BZ}),vk({tmx2db:ou,load:m_t,exportTournamentRecord:agt}),vk({env:$t,tournamentContext:ot}),KU.setSubscriptions({subscriptions:Ole})}function vk(t){if(Ad(window.dev))try{Object.keys(t).forEach(e=>window.dev[e]=t[e])}catch(e){Pt({message:"An error occurred while adding dev variables",intent:"is-danger"}),console.error("Error adding dev variables:",e)}}function m_t(t){if(typeof t=="object"){const e=t.tournamentRecord||t;e?.tournamentId&&qxe(e)}}function A_t(t){const{tournamentRecord:e,error:i}=r2.generateTournamentRecord(t);i?console.log({error:i}):qxe(e)}function qxe(t){const e=t?.tournamentId;KRe({tournamentRecord:t,callback:()=>ot.router.navigate(`/${js}/${e}`)})}class KD extends Error{}KD.prototype.name="InvalidTokenError";function g_t(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,i)=>{let r=i.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function v_t(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return g_t(e)}catch{return atob(e)}}function y_t(t,e){if(typeof t!="string")throw new KD("Invalid token specified: must be a string");e||(e={});const i=e.header===!0?0:1,r=t.split(".")[i];if(typeof r!="string")throw new KD(`Invalid token specified: missing part #${i+1}`);let n;try{n=v_t(r)}catch(a){throw new KD(`Invalid token specified: invalid base64 for part #${i+1} (${a.message})`)}try{return JSON.parse(n)}catch(a){throw new KD(`Invalid token specified: invalid json for part #${i+1} (${a.message})`)}}function Wxe(t){if(!t||t==="undefined"){rNe();return}let e;try{e=y_t(t)}catch{qRe();return}const i=new Date;return e?.exp<i.getTime()/1e3?SJ():((e?.permissions?.includes("devMode")||e?.roles?.includes("develope"))&&zxe(),e)}function Fle(t){const{callback:e,provider:i}=t||{},r=i?.onlineResources?.find(m=>m.name==="providerImage"&&m.resourceType==="URL"&&m.resourceSubType==="IMAGE");let n,a;const s=i||{},o=()=>{const m=document.getElementById("providerImagePreview");m&&(m.style.display=jt)},l=()=>{c({inputs:n}),a=!1;const m=document.getElementById("providerImagePreview");m&&(m.onload=()=>{a=!0,c({inputs:n})},m.src=n.tournamentImage.value,m.style.display="")},c=({inputs:m})=>{const A=(a||!m.tournamentImage.value||a===void 0)&&fi.nameValidator(10)(m.providerName.value)&&fi.nameValidator(3)(m.providerAbbr.value)&&(!m.providerId.value.length||fi.nameValidator(36)(m.providerId.value)),g=document.getElementById("createButton");g&&(g.disabled=!A)},u=[{control:"providerAbbr",onInput:c},{control:"providerName",onInput:c},{control:"providerId",onInput:c}],d=m=>n=Sr(m,[{value:s.organisationName,placeholder:"Provider name",validator:fi.nameValidator(10),label:"Provider Name",field:"providerName",autocomplete:"off"},{value:s.organisationAbbreviation,placeholder:"Abbreviation",validator:fi.nameValidator(3),label:"Abbreviation",field:"providerAbbr",autocomplete:"off"},{placeholder:"NOT REQUIRED - automatically generated",value:t?.provider?.organisationId??"",disabled:t?.provider?.organisationId,label:"Provider ID",autocomplete:"off",field:"providerId"},{onKeyUp:A=>A.key==="Enter"&&l(),onChange:()=>n.tournamentImage.value?l():o(),label:"Web address of online image",value:r?.identifier,placeholder:"Image URL",field:"tournamentImage",autocomplete:"off"}],u),p=document.createElement("div");d(p);const f=document.createElement("img");f.id="providerImagePreview",f.style.width="100%",p.appendChild(f);const h=()=>{const m=n.providerAbbr.value,A=n.providerName.value,g=t?.provider?.organisationId||n.providerId.value||Ri.UUID(),v={organisationAbbreviation:m,organisationName:A,organisationId:g};if(a){const I={resourceSubType:"IMAGE",name:"providerImage",resourceType:"URL",identifier:n.tournamentImage.value};v.onlineResources=[I]}const b=y=>Mt(e)&&e(y);t?.provider?I5e({provider:v}).then(b,y=>console.log({err:y})):b5e({provider:v}).then(b,y=>console.log({err:y}))};Jr({title:"Create provider",content:p,buttons:[{label:"Cancel",intent:"none",close:!0},{label:t?.provider?"Update":"Create",onClick:h,id:"createButton",intent:"is-info",disabled:!0,close:!0}]}),r&&setTimeout(l,400)}function Kxe(){let t;const e=FZ();Jr({title:"Settings",content:n=>t=Sr(n,[{text:"Active rating",class:"section-title"},{options:[{text:"WTN",field:"wtn",checked:$t.activeScale===DP},{text:"UTR",field:"utr",checked:$t.activeScale===ZI}],onClick:a=>console.log({x:a}),field:"activeRating",id:"activeRating",radio:!0},{text:"Scoring approach",class:"section-title"},{options:[{text:"Dynamic Sets",field:"dynamicSets",checked:$t.scoringApproach==="dynamicSets"},{text:"Dial Pad",field:"dialPad",checked:$t.scoringApproach==="dialPad"},{text:"Free Score",field:"freeScore",checked:$t.scoringApproach==="freeScore"}],onClick:a=>console.log({x:a}),field:"scoringApproach",id:"scoringApproach",radio:!0},{label:"Smart complements (Dynamic Sets only)",checked:e?.smartComplements||!1,field:"smartComplements",id:"smartComplements",checkbox:!0},{text:"Storage",class:"section-title"},{label:"Save local copies",checked:$t.saveLocal,field:"saveLocal",id:"saveLocal",checkbox:!0},{text:"Scheduling",class:"section-title"},{label:"Minimum schedule grid rows",value:e?.minCourtGridRows??$t.schedule.minCourtGridRows,field:"minCourtGridRows",id:"minCourtGridRows",validator:fi.numericRange(1,100),error:"Must be a number between 1 and 100",selectOnFocus:!0,onInput:()=>{const a=document.getElementById("saveSettingsButton"),s=t.minCourtGridRows.value,o=fi.numericRange(1,100)(s);a&&(a.disabled=!o)}},{text:"Participant Assignment",class:"section-title"},{label:"Keep input fields after assignment (Persist mode)",checked:e?.persistInputFields??!0,field:"persistInputFields",id:"persistInputFields",checkbox:!0},{text:"Beta features",class:"section-title"},{label:"PDF printing",checked:$t.pdfPrinting||!1,field:"pdfPrinting",id:"pdfPrinting",checkbox:!0}]),buttons:[{label:"Cancel",intent:"none",close:!0},{id:"saveSettingsButton",label:"Save",intent:"is-primary",onClick:()=>{const n=t.wtn.checked?DP:ZI;$t.saveLocal=t.saveLocal.checked,$t.pdfPrinting=t.pdfPrinting?.checked||!1;let a;t.dynamicSets.checked?a="dynamicSets":t.dialPad.checked?a="dialPad":t.freeScore.checked?a="freeScore":a="dynamicSets",$t.scoringApproach=a;const s=t.minCourtGridRows.value;fi.numericRange(1,100)(s)&&($t.schedule.minCourtGridRows=Number.parseInt(s,10)),$t.persistInputFields=t.persistInputFields?.checked??!0,vO(n),fyt({activeScale:n,scoringApproach:a,saveLocal:$t.saveLocal,smartComplements:t.smartComplements?.checked||!1,pdfPrinting:$t.pdfPrinting,minCourtGridRows:$t.schedule.minCourtGridRows,persistInputFields:$t.persistInputFields})},close:!0}]}),setTimeout(()=>{const n=document.getElementById("saveSettingsButton"),a=t?.minCourtGridRows?.value??$t.schedule.minCourtGridRows,s=fi.numericRange(1,100)(a);n&&(n.disabled=!s)},0)}function b_t(t){const e=document.getElementById(t);e&&e.addEventListener("click",Kxe)}async function I_t(t,e){return Uu.post("/auth/login",{password:e,email:t})}async function w_t(t,e,i,r,n){return Uu.post("/auth/invite",{permissions:r,providerId:e,services:n,email:t,roles:i})}async function S_t(t,e,i,r){return Uu.post("/auth/register",{firstName:t,lastName:e,password:i,code:r})}function U_t(t,e=[]){const r=[{value:{organisationName:"None"},key:""},...e].map(({key:h,value:m})=>({label:m?.organisationName,value:h}));let n;const a={providerId:""},s=h=>a.providerId=h,l=[{onInput:({inputs:h})=>{const m=h.email.value,A=fi.emailValidator(m),g=document.getElementById("inviteUser");g&&(g.disabled=!A)},control:"email"}],c=h=>n=Sr(h,[{iconLeft:"fa-regular fa-envelope",placeholder:"valid@email.com",validator:fi.emailValidator,autocomplete:"off",label:"Email",field:"email"},{text:"Roles",header:!0},{label:"Client",field:"client",checkbox:!0,width:"50%",id:"client",fieldPair:{label:"Director",field:"director",id:"director",checkbox:!0}},{label:"Admin",checkbox:!0,field:"admin",width:"50%",id:"admin",fieldPair:{label:"Official",field:"official",id:"official",checkbox:!0}},{label:"Scoring",field:"score",width:"50%",id:"score",checkbox:!0,fieldPair:{label:"Developer",field:"developer",id:"developer",checkbox:!0}},{label:"Generate",field:"generate",checkbox:!0,id:"generate"},{typeAhead:{list:r,callback:s},value:a.providerId||"",placeholder:"None",field:"providerId",label:"Provider"},{text:"Permissions",header:!0},{label:"Delete Tournaments",field:"deleteTournament",checkbox:!0,id:"delete"},{field:"editTennisId",label:"Edit WTID",id:"editTennisId",checkbox:!0},{label:"Dev mode",field:"devMode",checkbox:!0,id:"devmode"},{text:"Services",header:!0},{label:"Tournament Profiles (fetch)",field:"tournamentProfile",id:"tournamentProfile",checkbox:!0}],l),u=["client","admin","score","developer","generate","director","official"],d=["devMode","editTennisId","deleteTournament"],p=["tournamentProfile"];Jr({title:"Invite user",content:c,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Invite",intent:"is-primary",id:"inviteUser",disabled:!0,onClick:()=>{const h=n.email.value,m=a.providerId||n.providerId?.value,A=d.map(y=>n[y].checked&&y).filter(Boolean),g=p.map(y=>n[y].checked&&y).filter(Boolean),v=u.map(y=>n[y].checked&&y).filter(Boolean),b=y=>Mt(t)&&t(y);w_t(h,m,v,A,g).then(b,y=>console.log({err:y}))},close:!0}]})}function T_t(t){let e;const r=[{onInput:({inputs:s})=>{const o=s.email.value,l=fi.emailValidator(o),c=document.getElementById("loginButton");c&&(c.disabled=!l)},control:"email"}];Jr({title:"Log in",content:s=>e=Sr(s,[{iconLeft:"fa-regular fa-envelope",placeholder:"valid@email.com",validator:fi.emailValidator,autocomplete:"email",label:"Email",field:"email"},{placeholder:"minimum 8 characters",autocomplete:"current-password",iconLeft:"fa-solid fa-lock",label:"Password",field:"password",type:"password"}],r),buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{const s=e.email.value,o=e.password.value,l=c=>{c||SJ(),c?.status===200&&E_t({data:c.data,callback:t})};I_t(s,o).then(l,c=>console.log({err:c}))},intent:"is-primary",id:"loginButton",disabled:!0,label:"Login",close:!0}]})}async function C_t(t){try{await navigator.clipboard.writeText(t),Pt({message:"Copied to clipboard",intent:"is-success"})}catch(e){Pt({message:String(e),intent:"is-danger"})}}function cV(t){const e=document.getElementById("login"),i=ot?.provider,r=t?.roles?.includes(n2);e&&(t?e.style.color=i&&"red"||r&&"green"||"blue":e.style.color="")}function gu(){const t=WRe(),e=Wxe(t);return e&&cV(e),e}function SJ(){qRe(),rNe(),OH(),ot.provider=void 0,ot.router.navigate(`/${Uh}/logout`),cV(!1)}function E_t({data:t,callback:e}){const i=Wxe(t.token),r=Ge.getTournament().tournamentRecord?.tournamentId;i&&(Eut(t.token),Pt({intent:"is-success",message:"Log in successful"}),OH(),r||Ge.reset(),cV(i),Mt(e)?e():r||ot.router.navigate(`/${Uh}/${i.provider?.organisationAbbreviation}`))}function D_t(){PP().then(({data:t})=>{const e=t?.providers?.map(({value:i})=>({onClick:()=>{ot.provider=i,ot.router.navigate(`/${Uh}/${i.organisationAbbreviation}`)},participantName:i.organisationName}));e&&vZ({title:"Select Provider",options:e,selectionLimit:1})})}function P_t(t){return()=>U5e(t).then(()=>Pt({message:"User removed"}))}function R_t(){lIe().then(({data:t})=>{const e=t?.users?.map(({value:i})=>({participantName:`${i.firstName} ${i.lastName} (${i.email})`,onClick:P_t(i)}));e&&vZ({title:"Select User",options:e,selectionLimit:1})})}function M_t(){ot.provider=void 0,ot.router.navigate(`/${Uh}/superadmin`)}function Lle(t){const e=document.getElementById(t),i=r=>Pt({intent:"is-danger",message:r?.data?.message||"Error"});if(e){const r=a=>{const s=a?.data.inviteCode;if(s){const o=`${window.location.origin}${window.location.pathname}/#/${bbe}/${s}`;C_t(o),console.log({inviteCode:s,inviteURL:o})}else i(a)},n=a=>setTimeout(()=>Fle({provider:a}),200);e.addEventListener("click",()=>{const a=gu(),s=a?.roles?.includes(n2),o=a?.roles?.includes(vbe),l=ot?.provider;nl({target:e,title:"Authorization",items:[{onClick:()=>Pt({message:"TBD: Registration Modal"}),text:"Register",hide:a},{onClick:()=>T_t(),hide:a,text:"Log in"},{style:"text-decoration: line-through;",hide:!s||!l,onClick:M_t,text:"Impersonate"},{hide:!s||l,onClick:D_t,text:"Impersonate"},{onClick:Fle,text:"Create provider",hide:!s},{onClick:()=>Sut({callback:n}),text:"Edit provider",hide:!s},{onClick:R_t,text:"Remove user",hide:!s},{onClick:()=>PP().then(({data:u})=>U_t(r,u?.providers),i),hide:!s&&!l,text:"Invite User"},{text:"Log out",hide:!a,onClick:SJ},{hide:!o,divider:!0},{onClick:ngt,heading:"Actions",hide:!o},{divider:!0},{onClick:Kxe,heading:"Settings"}]})})}}const N_t=(function(){function t(){}const e=t.prototype;function i(a,s){let o=a.length;for(;o--;)if(a[o].listener===s)return o;return-1}function r(a){return function(...o){return this[a](...o)}}e.getListeners=function(s){const o=this._getEvents();let l,c;if(s instanceof RegExp){l={};for(c in o)o.hasOwnProperty(c)&&s.test(c)&&(l[c]=o[c])}else l=o[s]||(o[s]=[]);return l},e.flattenListeners=function(s){const o=[];for(let l=0;l<s.length;l+=1)o.push(s[l].listener);return o},e.getListenersAsObject=function(s){const o=this.getListeners(s);let l;return o instanceof Array&&(l={},l[s]=o),l||o};function n(a){return typeof a=="function"||a instanceof RegExp?!0:a&&typeof a=="object"?n(a.listener):!1}return e.addListener=function(s,o){if(!n(o))throw new TypeError("listener must be a function");const l=this.getListenersAsObject(s),c=typeof o=="object";let u;for(u in l)l.hasOwnProperty(u)&&i(l[u],c?o.listener:o)===-1&&l[u].push(c?o:{listener:o,once:!1});return this},e.on=r("addListener"),e.addOnceListener=function(s,o){return this.addListener(s,{listener:o,once:!0})},e.once=r("addOnceListener"),e.defineEvent=function(s){return this.getListeners(s),this},e.defineEvents=function(s){for(let o=0;o<s.length;o+=1)this.defineEvent(s[o]);return this},e.removeListener=function(s,o){const l=this.getListenersAsObject(s);let c,u;for(u in l)l.hasOwnProperty(u)&&(c=i(l[u],o),c!==-1&&l[u].splice(c,1));return this},e.off=r("removeListener"),e.addListeners=function(s,o){return this.manipulateListeners(!1,s,o)},e.removeListeners=function(s,o){return this.manipulateListeners(!0,s,o)},e.manipulateListeners=function(s,o,l){let c,u;const d=s?this.removeListener:this.addListener,p=s?this.removeListeners:this.addListeners;if(typeof o=="object"&&!(o instanceof RegExp))for(c in o)o.hasOwnProperty(c)&&(u=o[c])&&(typeof u=="function"?d.call(this,c,u):p.call(this,c,u));else for(c=l.length;c--;)d.call(this,o,l[c]);return this},e.removeEvent=function(s){const o=typeof s,l=this._getEvents();let c;if(o==="string")delete l[s];else if(s instanceof RegExp)for(c in l)l.hasOwnProperty(c)&&s.test(c)&&delete l[c];else delete this._events;return this},e.removeAllListeners=r("removeEvent"),e.emitEvent=function(s,o){const l=this.getListenersAsObject(s);let c,u,d,p,f;for(p in l)if(l.hasOwnProperty(p))for(c=l[p].slice(0),d=0;d<c.length;d++)u=c[d],u.once===!0&&this.removeListener(s,u.listener),f=u.listener.apply(this,o||[]),f===this._getOnceReturnValue()&&this.removeListener(s,u.listener);return this},e.trigger=r("emitEvent"),e.emit=function(s,...o){return this.emitEvent(s,o)},e.setOnceReturnValue=function(s){return this._onceReturnValue=s,this},e._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},e._getEvents=function(){return this._events||(this._events={})},t})();function B_t(){document.oncontextmenu=()=>!1,window.addEventListener("contextmenu",t=>{t.preventDefault()},!1),window.packageEntry={updateReady:Rqe},window.onunhandledrejection=t=>{if(VH())return;t.preventDefault();const e=t.reason,i=e&&(e.stack||e);i&&i.indexOf("blocked")>0?(Mqe(),console.warn("popup blocked")):console.warn("Unhandled rejection:",e&&(e.stack||e))}}var Yxe=["input:not([inert]):not([inert] *)","select:not([inert]):not([inert] *)","textarea:not([inert]):not([inert] *)","a[href]:not([inert]):not([inert] *)","button:not([inert]):not([inert] *)","[tabindex]:not(slot):not([inert]):not([inert] *)","audio[controls]:not([inert]):not([inert] *)","video[controls]:not([inert]):not([inert] *)",'[contenteditable]:not([contenteditable="false"]):not([inert]):not([inert] *)',"details>summary:first-of-type:not([inert]):not([inert] *)","details:not([inert]):not([inert] *)"],LO=Yxe.join(","),Xxe=typeof Element>"u",bw=Xxe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,$O=!Xxe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},HO=function(e,i){var r;i===void 0&&(i=!0);var n=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),a=n===""||n==="true",s=a||i&&e&&(typeof e.closest=="function"?e.closest("[inert]"):HO(e.parentNode));return s},k_t=function(e){var i,r=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return r===""||r==="true"},Zxe=function(e,i,r){if(HO(e))return[];var n=Array.prototype.slice.apply(e.querySelectorAll(LO));return i&&bw.call(e,LO)&&n.unshift(e),n=n.filter(r),n},VO=function(e,i,r){for(var n=[],a=Array.from(e);a.length;){var s=a.shift();if(!HO(s,!1))if(s.tagName==="SLOT"){var o=s.assignedElements(),l=o.length?o:s.children,c=VO(l,!0,r);r.flatten?n.push.apply(n,c):n.push({scopeParent:s,candidates:c})}else{var u=bw.call(s,LO);u&&r.filter(s)&&(i||!e.includes(s))&&n.push(s);var d=s.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(s),p=!HO(d,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(s));if(d&&p){var f=VO(d===!0?s.children:d.children,!0,r);r.flatten?n.push.apply(n,f):n.push({scopeParent:s,candidates:f})}else a.unshift.apply(a,s.children)}}return n},Jxe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},sI=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||k_t(e))&&!Jxe(e)?0:e.tabIndex},x_t=function(e,i){var r=sI(e);return r<0&&i&&!Jxe(e)?0:r},__t=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},e_e=function(e){return e.tagName==="INPUT"},O_t=function(e){return e_e(e)&&e.type==="hidden"},F_t=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},L_t=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},$_t=function(e){if(!e.name)return!0;var i=e.form||$O(e),r=function(o){return i.querySelectorAll('input[type="radio"][name="'+o+'"]')},n;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")n=r(window.CSS.escape(e.name));else try{n=r(e.name)}catch(s){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",s.message),!1}var a=L_t(n,e.form);return!a||a===e},H_t=function(e){return e_e(e)&&e.type==="radio"},V_t=function(e){return H_t(e)&&!$_t(e)},G_t=function(e){var i,r=e&&$O(e),n=(i=r)===null||i===void 0?void 0:i.host,a=!1;if(r&&r!==e){var s,o,l;for(a=!!((s=n)!==null&&s!==void 0&&(o=s.ownerDocument)!==null&&o!==void 0&&o.contains(n)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!a&&n;){var c,u,d;r=$O(n),n=(c=r)===null||c===void 0?void 0:c.host,a=!!((u=n)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(n))}}return a},$le=function(e){var i=e.getBoundingClientRect(),r=i.width,n=i.height;return r===0&&n===0},Q_t=function(e,i){var r=i.displayCheck,n=i.getShadowRoot;if(r==="full-native"&&"checkVisibility"in e){var a=e.checkVisibility({checkOpacity:!1,opacityProperty:!1,contentVisibilityAuto:!0,visibilityProperty:!0,checkVisibilityCSS:!0});return!a}if(getComputedStyle(e).visibility==="hidden")return!0;var s=bw.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(bw.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="full-native"||r==="legacy-full"){if(typeof n=="function"){for(var l=e;e;){var c=e.parentElement,u=$O(e);if(c&&!c.shadowRoot&&n(c)===!0)return $le(e);e.assignedSlot?e=e.assignedSlot:!c&&u!==e.ownerDocument?e=u.host:e=c}e=l}if(G_t(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return $le(e);return!1},j_t=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var n=i.children.item(r);if(n.tagName==="LEGEND")return bw.call(i,"fieldset[disabled] *")?!0:!n.contains(e)}return!0}i=i.parentElement}return!1},GO=function(e,i){return!(i.disabled||O_t(i)||Q_t(i,e)||F_t(i)||j_t(i))},xz=function(e,i){return!(V_t(i)||sI(i)<0||!GO(e,i))},z_t=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},t_e=function(e){var i=[],r=[];return e.forEach(function(n,a){var s=!!n.scopeParent,o=s?n.scopeParent:n,l=x_t(o,s),c=s?t_e(n.candidates):o;l===0?s?i.push.apply(i,c):i.push(o):r.push({documentOrder:a,tabIndex:l,item:n,isScope:s,content:c})}),r.sort(__t).reduce(function(n,a){return a.isScope?n.push.apply(n,a.content):n.push(a.content),n},[]).concat(i)},q_t=function(e,i){i=i||{};var r;return i.getShadowRoot?r=VO([e],i.includeContainer,{filter:xz.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:z_t}):r=Zxe(e,i.includeContainer,xz.bind(null,i)),t_e(r)},W_t=function(e,i){i=i||{};var r;return i.getShadowRoot?r=VO([e],i.includeContainer,{filter:GO.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=Zxe(e,i.includeContainer,GO.bind(null,i)),r},AU=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return bw.call(e,LO)===!1?!1:xz(i,e)},K_t=Yxe.concat("iframe:not([inert]):not([inert] *)").join(","),KQ=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return bw.call(e,K_t)===!1?!1:GO(i,e)};function _z(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function Y_t(t){if(Array.isArray(t))return _z(t)}function Hle(t,e,i,r,n,a,s){try{var o=t[a](s),l=o.value}catch(c){return void i(c)}o.done?e(l):Promise.resolve(l).then(r,n)}function Vle(t){return function(){var e=this,i=arguments;return new Promise(function(r,n){var a=t.apply(e,i);function s(l){Hle(a,r,n,s,o,"next",l)}function o(l){Hle(a,r,n,s,o,"throw",l)}s(void 0)})}}function Gle(t,e){var i=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=i_e(t))||e){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,s=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var l=i.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{s||i.return==null||i.return()}finally{if(o)throw a}}}}function X_t(t,e,i){return(e=iOt(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Z_t(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function J_t(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Qle(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),i.push.apply(i,r)}return i}function jle(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?Qle(Object(i),!0).forEach(function(r){X_t(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Qle(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function YD(){var t,e,i=typeof Symbol=="function"?Symbol:{},r=i.iterator||"@@iterator",n=i.toStringTag||"@@toStringTag";function a(f,h,m,A){var g=h&&h.prototype instanceof o?h:o,v=Object.create(g.prototype);return Hd(v,"_invoke",(function(b,y,I){var w,S,T,D=0,C=I||[],E=!1,P={p:0,n:0,v:t,a:R,f:R.bind(t,4),d:function(M,N){return w=M,S=0,T=t,P.n=N,s}};function R(M,N){for(S=M,T=N,e=0;!E&&D&&!k&&e<C.length;e++){var k,O=C[e],x=P.p,F=O[2];M>3?(k=F===N)&&(T=O[(S=O[4])?5:(S=3,3)],O[4]=O[5]=t):O[0]<=x&&((k=M<2&&x<O[1])?(S=0,P.v=N,P.n=O[1]):x<F&&(k=M<3||O[0]>N||N>F)&&(O[4]=M,O[5]=N,P.n=F,S=0))}if(k||M>1)return s;throw E=!0,N}return function(M,N,k){if(D>1)throw TypeError("Generator is already running");for(E&&N===1&&R(N,k),S=N,T=k;(e=S<2?t:T)||!E;){w||(S?S<3?(S>1&&(P.n=-1),R(S,T)):P.n=T:P.v=T);try{if(D=2,w){if(S||(M="next"),e=w[M]){if(!(e=e.call(w,T)))throw TypeError("iterator result is not an object");if(!e.done)return e;T=e.value,S<2&&(S=0)}else S===1&&(e=w.return)&&e.call(w),S<2&&(T=TypeError("The iterator does not provide a '"+M+"' method"),S=1);w=t}else if((e=(E=P.n<0)?T:b.call(y,P))!==s)break}catch(O){w=t,S=1,T=O}finally{D=1}}return{value:e,done:E}}})(f,m,A),!0),v}var s={};function o(){}function l(){}function c(){}e=Object.getPrototypeOf;var u=[][r]?e(e([][r]())):(Hd(e={},r,function(){return this}),e),d=c.prototype=o.prototype=Object.create(u);function p(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,c):(f.__proto__=c,Hd(f,n,"GeneratorFunction")),f.prototype=Object.create(d),f}return l.prototype=c,Hd(d,"constructor",c),Hd(c,"constructor",l),l.displayName="GeneratorFunction",Hd(c,n,"GeneratorFunction"),Hd(d),Hd(d,n,"Generator"),Hd(d,r,function(){return this}),Hd(d,"toString",function(){return"[object Generator]"}),(YD=function(){return{w:a,m:p}})()}function Hd(t,e,i,r){var n=Object.defineProperty;try{n({},"",{})}catch{n=0}Hd=function(a,s,o,l){function c(u,d){Hd(a,u,function(p){return this._invoke(u,d,p)})}s?n?n(a,s,{value:o,enumerable:!l,configurable:!l,writable:!l}):a[s]=o:(c("next",0),c("throw",1),c("return",2))},Hd(t,e,i,r)}function eOt(t){return Y_t(t)||Z_t(t)||i_e(t)||J_t()}function tOt(t,e){if(typeof t!="object"||!t)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var r=i.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function iOt(t){var e=tOt(t,"string");return typeof e=="symbol"?e:e+""}function i_e(t,e){if(t){if(typeof t=="string")return _z(t,e);var i={}.toString.call(t).slice(8,-1);return i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set"?Array.from(t):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_z(t,e):void 0}}var tg={getActiveTrap:function(e){return e?.length>0?e[e.length-1]:null},activateTrap:function(e,i){var r=tg.getActiveTrap(e);i!==r&&tg.pauseTrap(e);var n=e.indexOf(i);n===-1||e.splice(n,1),e.push(i)},deactivateTrap:function(e,i){var r=e.indexOf(i);r!==-1&&e.splice(r,1),tg.unpauseTrap(e)},pauseTrap:function(e){var i=tg.getActiveTrap(e);i?._setPausedState(!0)},unpauseTrap:function(e){var i=tg.getActiveTrap(e);i&&!i._isManuallyPaused()&&i._setPausedState(!1)}},rOt=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},nOt=function(e){return e?.key==="Escape"||e?.key==="Esc"||e?.keyCode===27},G0=function(e){return e?.key==="Tab"||e?.keyCode===9},aOt=function(e){return G0(e)&&!e.shiftKey},sOt=function(e){return G0(e)&&e.shiftKey},zle=function(e){return setTimeout(e,0)},TD=function(e){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];return typeof e=="function"?e.apply(void 0,r):e},yk=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},oOt=[],lOt=function(e,i){var r=document,n=oOt,a=jle({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isolateSubtrees:!1,isKeyForward:aOt,isKeyBackward:sOt},i),s={containers:[],containerGroups:[],tabbableGroups:[],adjacentElements:new Set,alreadySilent:new Set,nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,manuallyPaused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},o,l=function(M,N,k){return M&&M[N]!==void 0?M[N]:a[k||N]},c=function(M,N){var k=typeof N?.composedPath=="function"?N.composedPath():void 0;return s.containerGroups.findIndex(function(O){var x=O.container,F=O.tabbableNodes;return x.contains(M)||k?.includes(x)||F.find(function(_){return _===M})})},u=function(M){var N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},k=N.hasFallback,O=k===void 0?!1:k,x=N.params,F=x===void 0?[]:x,_=a[M];if(typeof _=="function"&&(_=_.apply(void 0,eOt(F))),_===!0&&(_=void 0),!_){if(_===void 0||_===!1)return _;throw new Error("`".concat(M,"` was specified but was not a node, or did not return a node"))}var V=_;if(typeof _=="string"){try{V=r.querySelector(_)}catch(G){throw new Error("`".concat(M,'` appears to be an invalid selector; error="').concat(G.message,'"'))}if(!V&&!O)throw new Error("`".concat(M,"` as selector refers to no known node"))}return V},d=function(){var M=u("initialFocus",{hasFallback:!0});if(M===!1)return!1;if(M===void 0||M&&!KQ(M,a.tabbableOptions))if(c(r.activeElement)>=0)M=r.activeElement;else{var N=s.tabbableGroups[0],k=N&&N.firstTabbableNode;M=k||u("fallbackFocus")}else M===null&&(M=u("fallbackFocus"));if(!M)throw new Error("Your focus-trap needs to have at least one focusable element");return M},p=function(){if(s.containerGroups=s.containers.map(function(M){var N=q_t(M,a.tabbableOptions),k=W_t(M,a.tabbableOptions),O=N.length>0?N[0]:void 0,x=N.length>0?N[N.length-1]:void 0,F=k.find(function(G){return AU(G)}),_=k.slice().reverse().find(function(G){return AU(G)}),V=!!N.find(function(G){return sI(G)>0});return{container:M,tabbableNodes:N,focusableNodes:k,posTabIndexesFound:V,firstTabbableNode:O,lastTabbableNode:x,firstDomTabbableNode:F,lastDomTabbableNode:_,nextTabbableNode:function(z){var Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,j=N.indexOf(z);return j<0?Q?k.slice(k.indexOf(z)+1).find(function(W){return AU(W)}):k.slice(0,k.indexOf(z)).reverse().find(function(W){return AU(W)}):N[j+(Q?1:-1)]}}}),s.tabbableGroups=s.containerGroups.filter(function(M){return M.tabbableNodes.length>0}),s.tabbableGroups.length<=0&&!u("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(s.containerGroups.find(function(M){return M.posTabIndexesFound})&&s.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},f=function(M){var N=M.activeElement;if(N)return N.shadowRoot&&N.shadowRoot.activeElement!==null?f(N.shadowRoot):N},h=function(M){if(M!==!1&&M!==f(document)){if(!M||!M.focus){h(d());return}M.focus({preventScroll:!!a.preventScroll}),s.mostRecentlyFocusedNode=M,rOt(M)&&M.select()}},m=function(M){var N=u("setReturnFocus",{params:[M]});return N||(N===!1?!1:M)},A=function(M){var N=M.target,k=M.event,O=M.isBackward,x=O===void 0?!1:O;N=N||yk(k),p();var F=null;if(s.tabbableGroups.length>0){var _=c(N,k),V=_>=0?s.containerGroups[_]:void 0;if(_<0)x?F=s.tabbableGroups[s.tabbableGroups.length-1].lastTabbableNode:F=s.tabbableGroups[0].firstTabbableNode;else if(x){var G=s.tabbableGroups.findIndex(function(X){var J=X.firstTabbableNode;return N===J});if(G<0&&(V.container===N||KQ(N,a.tabbableOptions)&&!AU(N,a.tabbableOptions)&&!V.nextTabbableNode(N,!1))&&(G=_),G>=0){var z=G===0?s.tabbableGroups.length-1:G-1,Q=s.tabbableGroups[z];F=sI(N)>=0?Q.lastTabbableNode:Q.lastDomTabbableNode}else G0(k)||(F=V.nextTabbableNode(N,!1))}else{var j=s.tabbableGroups.findIndex(function(X){var J=X.lastTabbableNode;return N===J});if(j<0&&(V.container===N||KQ(N,a.tabbableOptions)&&!AU(N,a.tabbableOptions)&&!V.nextTabbableNode(N))&&(j=_),j>=0){var W=j===s.tabbableGroups.length-1?0:j+1,Y=s.tabbableGroups[W];F=sI(N)>=0?Y.firstTabbableNode:Y.firstDomTabbableNode}else G0(k)||(F=V.nextTabbableNode(N))}}else F=u("fallbackFocus");return F},g=function(M){var N=yk(M);if(!(c(N,M)>=0)){if(TD(a.clickOutsideDeactivates,M)){o.deactivate({returnFocus:a.returnFocusOnDeactivate});return}TD(a.allowOutsideClick,M)||M.preventDefault()}},v=function(M){var N=yk(M),k=c(N,M)>=0;if(k||N instanceof Document)k&&(s.mostRecentlyFocusedNode=N);else{M.stopImmediatePropagation();var O,x=!0;if(s.mostRecentlyFocusedNode)if(sI(s.mostRecentlyFocusedNode)>0){var F=c(s.mostRecentlyFocusedNode),_=s.containerGroups[F].tabbableNodes;if(_.length>0){var V=_.findIndex(function(G){return G===s.mostRecentlyFocusedNode});V>=0&&(a.isKeyForward(s.recentNavEvent)?V+1<_.length&&(O=_[V+1],x=!1):V-1>=0&&(O=_[V-1],x=!1))}}else s.containerGroups.some(function(G){return G.tabbableNodes.some(function(z){return sI(z)>0})})||(x=!1);else x=!1;x&&(O=A({target:s.mostRecentlyFocusedNode,isBackward:a.isKeyBackward(s.recentNavEvent)})),h(O||s.mostRecentlyFocusedNode||d())}s.recentNavEvent=void 0},b=function(M){var N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;s.recentNavEvent=M;var k=A({event:M,isBackward:N});k&&(G0(M)&&M.preventDefault(),h(k))},y=function(M){(a.isKeyForward(M)||a.isKeyBackward(M))&&b(M,a.isKeyBackward(M))},I=function(M){nOt(M)&&TD(a.escapeDeactivates,M)!==!1&&(M.preventDefault(),o.deactivate())},w=function(M){var N=yk(M);c(N,M)>=0||TD(a.clickOutsideDeactivates,M)||TD(a.allowOutsideClick,M)||(M.preventDefault(),M.stopImmediatePropagation())},S=function(){if(!s.active)return Promise.resolve();tg.activateTrap(n,o);var M;return a.delayInitialFocus?M=new Promise(function(N){s.delayInitialFocusTimer=zle(function(){h(d()),N()})}):(M=Promise.resolve(),h(d())),r.addEventListener("focusin",v,!0),r.addEventListener("mousedown",g,{capture:!0,passive:!1}),r.addEventListener("touchstart",g,{capture:!0,passive:!1}),r.addEventListener("click",w,{capture:!0,passive:!1}),r.addEventListener("keydown",y,{capture:!0,passive:!1}),r.addEventListener("keydown",I),M},T=function(M){s.active&&!s.paused&&o._setSubtreeIsolation(!1),s.adjacentElements.clear(),s.alreadySilent.clear();var N=new Set,k=new Set,O=Gle(M),x;try{for(O.s();!(x=O.n()).done;){var F=x.value;N.add(F);for(var _=typeof ShadowRoot<"u"&&F.getRootNode()instanceof ShadowRoot,V=F;V;){N.add(V);var G=V.parentElement,z=[];G?z=G.children:!G&&_&&(z=V.getRootNode().children,G=V.getRootNode().host,_=typeof ShadowRoot<"u"&&G.getRootNode()instanceof ShadowRoot);var Q=Gle(z),j;try{for(Q.s();!(j=Q.n()).done;){var W=j.value;k.add(W)}}catch(Y){Q.e(Y)}finally{Q.f()}V=G}}}catch(Y){O.e(Y)}finally{O.f()}N.forEach(function(Y){k.delete(Y)}),s.adjacentElements=k},D=function(){if(s.active)return r.removeEventListener("focusin",v,!0),r.removeEventListener("mousedown",g,!0),r.removeEventListener("touchstart",g,!0),r.removeEventListener("click",w,!0),r.removeEventListener("keydown",y,!0),r.removeEventListener("keydown",I),o},C=function(M){var N=M.some(function(k){var O=Array.from(k.removedNodes);return O.some(function(x){return x===s.mostRecentlyFocusedNode})});N&&h(d())},E=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(C):void 0,P=function(){E&&(E.disconnect(),s.active&&!s.paused&&s.containers.map(function(M){E.observe(M,{subtree:!0,childList:!0})}))};return o={get active(){return s.active},get paused(){return s.paused},activate:function(M){if(s.active)return this;var N=l(M,"onActivate"),k=l(M,"onPostActivate"),O=l(M,"checkCanFocusTrap"),x=tg.getActiveTrap(n),F=!1;if(x&&!x.paused){var _;(_=x._setSubtreeIsolation)===null||_===void 0||_.call(x,!1),F=!0}try{O||p(),s.active=!0,s.paused=!1,s.nodeFocusedBeforeActivation=f(r),N?.();var V=(function(){var z=Vle(YD().m(function Q(){return YD().w(function(j){for(;;)switch(j.n){case 0:return O&&p(),j.n=1,S();case 1:o._setSubtreeIsolation(!0),P(),k?.();case 2:return j.a(2)}},Q)}));return function(){return z.apply(this,arguments)}})();if(O)return O(s.containers.concat()).then(V,V),this;V()}catch(z){if(x===tg.getActiveTrap(n)&&F){var G;(G=x._setSubtreeIsolation)===null||G===void 0||G.call(x,!0)}throw z}return this},deactivate:function(M){if(!s.active)return this;var N=jle({onDeactivate:a.onDeactivate,onPostDeactivate:a.onPostDeactivate,checkCanReturnFocus:a.checkCanReturnFocus},M);clearTimeout(s.delayInitialFocusTimer),s.delayInitialFocusTimer=void 0,s.paused||o._setSubtreeIsolation(!1),s.alreadySilent.clear(),D(),s.active=!1,s.paused=!1,P(),tg.deactivateTrap(n,o);var k=l(N,"onDeactivate"),O=l(N,"onPostDeactivate"),x=l(N,"checkCanReturnFocus"),F=l(N,"returnFocus","returnFocusOnDeactivate");k?.();var _=function(){zle(function(){F&&h(m(s.nodeFocusedBeforeActivation)),O?.()})};return F&&x?(x(m(s.nodeFocusedBeforeActivation)).then(_,_),this):(_(),this)},pause:function(M){return s.active?(s.manuallyPaused=!0,this._setPausedState(!0,M)):this},unpause:function(M){return s.active?(s.manuallyPaused=!1,n[n.length-1]!==this?this:this._setPausedState(!1,M)):this},updateContainerElements:function(M){var N=[].concat(M).filter(Boolean);return s.containers=N.map(function(k){return typeof k=="string"?r.querySelector(k):k}),a.isolateSubtrees&&T(s.containers),s.active&&(p(),s.paused||o._setSubtreeIsolation(!0)),P(),this}},Object.defineProperties(o,{_isManuallyPaused:{value:function(){return s.manuallyPaused}},_setPausedState:{value:function(M,N){if(s.paused===M)return this;if(s.paused=M,M){var k=l(N,"onPause"),O=l(N,"onPostPause");k?.(),D(),o._setSubtreeIsolation(!1),P(),O?.()}else{var x=l(N,"onUnpause"),F=l(N,"onPostUnpause");x?.();var _=(function(){var V=Vle(YD().m(function G(){return YD().w(function(z){for(;;)switch(z.n){case 0:return p(),z.n=1,S();case 1:o._setSubtreeIsolation(!0),P(),F?.();case 2:return z.a(2)}},G)}));return function(){return V.apply(this,arguments)}})();_()}return this}},_setSubtreeIsolation:{value:function(M){a.isolateSubtrees&&s.adjacentElements.forEach(function(N){var k;M?a.isolateSubtrees==="aria-hidden"?((N.ariaHidden==="true"||((k=N.getAttribute("aria-hidden"))===null||k===void 0?void 0:k.toLowerCase())==="true")&&s.alreadySilent.add(N),N.setAttribute("aria-hidden","true")):((N.inert||N.hasAttribute("inert"))&&s.alreadySilent.add(N),N.setAttribute("inert",!0)):s.alreadySilent.has(N)||(a.isolateSubtrees==="aria-hidden"?N.removeAttribute("aria-hidden"):N.removeAttribute("inert"))})}}}),o.updateContainerElements(e),o};const cOt=()=>{const t={selectorTrigger:"[data-drawer-trigger]",selectorTarget:"[data-drawer-target]",selectorClose:"[data-drawer-close]",leftAlignment:"drawer--left",visibleClass:"is-visible",activeClass:"is-active",speedClose:350,speedOpen:50},e={};let i=!1,r,n;const a=gbe;let s;const o=y=>n=y,l=()=>{Mt(n)&&n&&n()&&(n=void 0);const y=document.getElementById(a);y&&(y.classList.remove(t.visibleClass),document.documentElement.style.overflow="",setTimeout(function(){r?(y.classList.add(t.visibleClass),document.documentElement.style.overflow="hidden",Mt(r?.callback)&&r.callback()):(y.classList.remove(t.activeClass),i=!1),r=!1,s?.deactivate()},t.speedClose))},c=y=>{const I=document.getElementById(a);I&&(I.classList.contains(t.leftAlignment)||I.classList.add(t.leftAlignment),m(I,!1,y))},u=y=>{const I=document.getElementById(a);I&&(I.classList.remove(t.leftAlignment),m(I,!1,y))},d=y=>{const w=document.getElementById(a)?.querySelector(".drawer__title");w&&(w.innerHTML=y)},p=y=>{const w=document.getElementById(a)?.querySelector(".drawer__footer");w&&(fo(w),Mt(y)?e.footer=y(w,l):w.innerHTML=y||"")},f=y=>{const w=document.getElementById(a)?.querySelector(".drawer__content");w&&(fo(w),Mt(y)?e.content=y(w,l):w.innerHTML=y)},h=y=>{const w=document.getElementById(a)?.querySelector(".drawer__wrapper");w&&(w.style.width=y)},m=(y,I,w)=>{i=!0,y.classList.add(t.activeClass),document.documentElement.style.overflow="hidden",I&&(s=lOt(y),s.activate()),Mt(w)&&w&&w(),setTimeout(function(){y.classList.add(t.visibleClass)},t.speedOpen)},A=({title:y,content:I,side:w,width:S,footer:T,callback:D,onClose:C}={})=>{if(I&&f(I),C&&o(C),y&&d(y),S&&h(S),p(T),i)r={callback:D};else if(w){if(w===Ht)return u(D);if(w===ii)return c(D)}else{const E=document.getElementById(a);E&&m(E,T,D)}},g=function(y,I){let w=I.parentNode;for(;w;){if(w===y)return!0;w=w.parentNode}return!1},v=function(y){const I=y.target,w=document.querySelector(".drawer__wrapper");(!g(w,I)||I.classList.contains("drawer__close"))&&l()},b=y=>{y.key==="Escape"&&l()};return document.addEventListener("click",v,!1),document.addEventListener("keydown",b,!1),{settings:t,open:A,close:l,setTitle:d,setContent:f,setFooter:p,attributes:e}};function uOt(t){let e;const i=o=>o===e.password.value,n=[{onInput:({inputs:o})=>{const l=document.getElementById("registerButton");l&&(i(o.passwordConfirm.value)&&fi.passwordValidator(o.password.value)&&fi.nameValidator(2)(o.givenName.value)&&fi.nameValidator(2)(o.lastName.value)?l.removeAttribute("disabled"):l.setAttribute("disabled",""))},control:"passwordConfirm"}];Jr({title:"Register",content:o=>e=Sr(o,[{error:"First name must be at least 2 characters long",iconLeft:"fa-regular fa-user",validator:fi.nameValidator(2),placeholder:"First name",autocomplete:"off",label:"First Name",field:"givenName"},{error:"Last name must be at least 2 characters long",validator:fi.nameValidator(2),placeholder:"Last name",autocomplete:"off",label:"Last name",field:"lastName"},{error:"Must contain upper/lower, number, and special character",placeholder:"minimum 8 characters",iconLeft:"fa-solid fa-lock",validator:fi.passwordValidator,autocomplete:"off",label:"Password",field:"password",type:"password"},{placeholder:"minimum 8 characters",error:"Passwords do not match",iconLeft:"fa-solid fa-lock",label:"Re-enter Password",validator:i,field:"passwordConfirm",autocomplete:"off",type:"password"}],n),buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{const o=e.lastName.value,l=e.givenName.value,c=e.password.value,u=t?.data?.inviteKey,d=()=>{Pt({message:"Success",intent:"is-success "})},p=h=>{Pt({message:h?.message,intent:"is-danger"})},f=h=>{h?.status===200&&h?.data?.success?d():p(h?.data)};S_t(l,o,c,u).then(f,p)},intent:"is-primary",id:"registerButton",label:"Register",disabled:!0,close:!0}],onClose:()=>ot.router.navigate("/")})}function dOt(){const{tournamentRecord:t}=Ge.getTournament();t&&(ot.ee.emit(_Me,t.tournamentId),Ge.reset())}function qle(){kH(),p_t(),Hqe(),dOt(),xMe()}function As(){}function r_e(t){return t()}function Wle(){return Object.create(null)}function kd(t){t.forEach(r_e)}function ms(t){return typeof t=="function"}function Vc(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function pOt(t){return Object.keys(t).length===0}function UJ(t,...e){if(t==null){for(const r of e)r(void 0);return As}const i=t.subscribe(...e);return i.unsubscribe?()=>i.unsubscribe():i}function QO(t){let e;return UJ(t,i=>e=i)(),e}function tt(t,e,i){t.$$.on_destroy.push(UJ(e,i))}function fn(t,e,i){return t.set(i),e}function Og(t){return t&&ms(t.destroy)?t.destroy:As}const fOt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function En(t,e){t.appendChild(e)}function Qr(t,e,i){t.insertBefore(e,i||null)}function _r(t){t.parentNode&&t.parentNode.removeChild(t)}function _S(t,e){for(let i=0;i<t.length;i+=1)t[i]&&t[i].d(e)}function zr(t){return document.createElement(t)}function $N(t){return document.createTextNode(t)}function hl(){return $N(" ")}function Ap(){return $N("")}function Gn(t,e,i,r){return t.addEventListener(e,i,r),()=>t.removeEventListener(e,i,r)}function jO(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function It(t,e,i){i==null?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function hOt(t){return Array.from(t.childNodes)}function n_e(t,e){e=""+e,t.data!==e&&(t.data=e)}function Kle(t,e,i,r){i==null?t.style.removeProperty(e):t.style.setProperty(e,i,"")}function Jv(t,e){return new t(e)}let C1;function Q0(t){C1=t}function HN(){if(!C1)throw new Error("Function called outside component initialization");return C1}function mOt(t){HN().$$.before_update.push(t)}function AOt(t){HN().$$.on_mount.push(t)}function a_e(t){HN().$$.after_update.push(t)}function gOt(t,e){return HN().$$.context.set(t,e),e}function gp(t){return HN().$$.context.get(t)}function uV(t,e){const i=t.$$.callbacks[e.type];i&&i.slice().forEach(r=>r.call(this,e))}const kU=[],nA=[];let cT=[];const Yle=[],s_e=Promise.resolve();let Oz=!1;function o_e(){Oz||(Oz=!0,s_e.then(l_e))}function VN(){return o_e(),s_e}function Fz(t){cT.push(t)}const YQ=new Set;let gU=0;function l_e(){if(gU!==0)return;const t=C1;do{try{for(;gU<kU.length;){const e=kU[gU];gU++,Q0(e),vOt(e.$$)}}catch(e){throw kU.length=0,gU=0,e}for(Q0(null),kU.length=0,gU=0;nA.length;)nA.pop()();for(let e=0;e<cT.length;e+=1){const i=cT[e];YQ.has(i)||(YQ.add(i),i())}cT.length=0}while(kU.length);for(;Yle.length;)Yle.pop()();Oz=!1,YQ.clear(),Q0(t)}function vOt(t){if(t.fragment!==null){t.update(),kd(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Fz)}}function yOt(t){const e=[],i=[];cT.forEach(r=>t.indexOf(r)===-1?e.push(r):i.push(r)),i.forEach(r=>r()),cT=e}const yx=new Set;let hI;function So(){hI={r:0,c:[],p:hI}}function Uo(){hI.r||kd(hI.c),hI=hI.p}function mi(t,e){t&&t.i&&(yx.delete(t),t.i(e))}function Qi(t,e,i,r){if(t&&t.o){if(yx.has(t))return;yx.add(t),hI.c.push(()=>{yx.delete(t),r&&(i&&t.d(1),r())}),t.o(e)}else r&&r()}function Lo(t){return t?.length!==void 0?t:Array.from(t)}function TJ(t,e){Qi(t,1,1,()=>{e.delete(t.key)})}function CJ(t,e,i,r,n,a,s,o,l,c,u,d){let p=t.length,f=a.length,h=p;const m={};for(;h--;)m[t[h].key]=h;const A=[],g=new Map,v=new Map,b=[];for(h=f;h--;){const S=d(n,a,h),T=i(S);let D=s.get(T);D?b.push(()=>D.p(S,e)):(D=c(T,S),D.c()),g.set(T,A[h]=D),T in m&&v.set(T,Math.abs(h-m[T]))}const y=new Set,I=new Set;function w(S){mi(S,1),S.m(o,u),s.set(S.key,S),u=S.first,f--}for(;p&&f;){const S=A[f-1],T=t[p-1],D=S.key,C=T.key;S===T?(u=S.first,p--,f--):g.has(C)?!s.has(D)||y.has(D)?w(S):I.has(C)?p--:v.get(D)>v.get(C)?(I.add(D),w(S)):(y.add(C),p--):(l(T,s),p--)}for(;p--;){const S=t[p];g.has(S.key)||l(S,s)}for(;f;)w(A[f-1]);return kd(b),A}function gs(t){t&&t.c()}function Wa(t,e,i){const{fragment:r,after_update:n}=t.$$;r&&r.m(e,i),Fz(()=>{const a=t.$$.on_mount.map(r_e).filter(ms);t.$$.on_destroy?t.$$.on_destroy.push(...a):kd(a),t.$$.on_mount=[]}),n.forEach(Fz)}function Ka(t,e){const i=t.$$;i.fragment!==null&&(yOt(i.after_update),kd(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function bOt(t,e){t.$$.dirty[0]===-1&&(kU.push(t),o_e(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Mu(t,e,i,r,n,a,s=null,o=[-1]){const l=C1;Q0(t);const c=t.$$={fragment:null,ctx:[],props:a,update:As,not_equal:n,bound:Wle(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Wle(),dirty:o,skip_bound:!1,root:e.target||l.$$.root};s&&s(c.root);let u=!1;if(c.ctx=i?i(t,e.props||{},(d,p,...f)=>{const h=f.length?f[0]:p;return c.ctx&&n(c.ctx[d],c.ctx[d]=h)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](h),u&&bOt(t,d)),p}):[],c.update(),u=!0,kd(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const d=hOt(e.target);c.fragment&&c.fragment.l(d),d.forEach(_r)}else c.fragment&&c.fragment.c();e.intro&&mi(t.$$.fragment),Wa(t,e.target,e.anchor),l_e()}Q0(l)}class Nu{$$=void 0;$$set=void 0;$destroy(){Ka(this,1),this.$destroy=As}$on(e,i){if(!ms(i))return As;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(i),()=>{const n=r.indexOf(i);n!==-1&&r.splice(n,1)}}$set(e){this.$$set&&!pOt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const vU=[];function c_e(t,e){return{subscribe:dl(t,e).subscribe}}function dl(t,e=As){let i;const r=new Set;function n(o){if(Vc(t,o)&&(t=o,i)){const l=!vU.length;for(const c of r)c[1](),vU.push(c,t);if(l){for(let c=0;c<vU.length;c+=2)vU[c][0](vU[c+1]);vU.length=0}}}function a(o){n(o(t))}function s(o,l=As){const c=[o,l];return r.add(c),r.size===1&&(i=e(n,a)||As),o(t),()=>{r.delete(c),r.size===0&&i&&(i(),i=null)}}return{set:n,update:a,subscribe:s}}function Zh(t,e,i){const r=!Array.isArray(t),n=r?[t]:t;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const a=e.length<2;return c_e(i,(s,o)=>{let l=!1;const c=[];let u=0,d=As;const p=()=>{if(u)return;d();const h=e(r?c[0]:c,s,o);a?s(h):d=ms(h)?h:As},f=n.map((h,m)=>UJ(h,A=>{c[m]=A,u&=~(1<<m),l&&p()},()=>{u|=1<<m}));return l=!0,p(),function(){kd(f),d(),l=!1}})}function zO(t){return function(e){return e.key==="Enter"||e.key===" "&&!e.preventDefault()?t.call(this,e):void 0}}function _b(t,e){let i={update(r){typeof r=="string"?t.innerText=r:r?.domNodes?t.replaceChildren(...r.domNodes):r?.html&&(t.innerHTML=r.html)}};return i.update(e),i}function IOt(t,e){const i=r=>{t&&!t.contains(r.target)&&t.dispatchEvent(new CustomEvent(e+"outside",{detail:{jsEvent:r}}))};return document.addEventListener(e,i,!0),{destroy(){document.removeEventListener(e,i,!0)}}}const u_e=86400;function Fg(t=void 0){return t!==void 0?t instanceof Date?Zle(t):UOt(t):Zle(new Date)}function Op(t){if(typeof t=="number")t={seconds:t};else if(typeof t=="string"){let i=0,r=2;for(let n of t.split(":",3))i+=parseInt(n,10)*Math.pow(60,r--);t={seconds:i}}else t instanceof Date&&(t={hours:t.getUTCHours(),minutes:t.getUTCMinutes(),seconds:t.getUTCSeconds()});let e=t.weeks||t.week||0;return{years:t.years||t.year||0,months:t.months||t.month||0,days:e*7+(t.days||t.day||0),seconds:(t.hours||t.hour||0)*60*60+(t.minutes||t.minute||0)*60+(t.seconds||t.second||0),inWeeks:!!e}}function hn(t){return new Date(t.getTime())}function Np(t,e,i=1){t.setUTCFullYear(t.getUTCFullYear()+i*e.years);let r=t.getUTCMonth()+i*e.months;for(t.setUTCMonth(r),r%=12,r<0&&(r+=12);t.getUTCMonth()!==r;)Iw(t);return t.setUTCDate(t.getUTCDate()+i*e.days),t.setUTCSeconds(t.getUTCSeconds()+i*e.seconds),t}function bx(t,e,i=1){return Np(t,e,-i)}function aA(t,e=1){return t.setUTCDate(t.getUTCDate()+e),t}function Iw(t,e=1){return aA(t,-e)}function Tf(t){return t.setUTCHours(0,0,0,0),t}function Sc(t){return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds())}function tf(t,e=19){return t.toISOString().substring(0,e)}function qd(t,...e){return e.every(i=>t.getTime()===i.getTime())}function wOt(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i>=0?i:i+7)),t}function d_e(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i<=0?i:i-7)),t}function Xle(t){return typeof t=="string"&&t.length<=10}function Lz(t,e){return t.setUTCHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),0),t}function $z(t,e){return Np(t,e),t}function Hz(t,e,i){if(bx(t,e),i.length&&i.length<7)for(;i.includes(t.getUTCDay());)Iw(t);return t}function SOt(t,e){t=hn(t),e==0?t.setUTCDate(t.getUTCDate()+6-t.getUTCDay()):t.setUTCDate(t.getUTCDate()+4-(t.getUTCDay()||7));let i=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t-i)/1e3/u_e+1)/7)}function Zle(t){return new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()))}function UOt(t){const e=t.match(/\d+/g);return new Date(Date.UTC(Number(e[0]),Number(e[1])-1,Number(e[2]),Number(e[3]||0),Number(e[4]||0),Number(e[5]||0)))}function Xy(...t){return Object.assign(...t)}function Zf(t){return Object.keys(t)}function xU(...t){return Math.min(...t)}function oI(...t){return Math.max(...t)}function TOt(){return Symbol("ec")}function EJ(t){return Array.isArray(t)}function Ts(t){return typeof t=="function"}function COt(t){return t()}function p_e(t){t.forEach(COt)}function EOt(){}const DOt=t=>t;function DJ(t,e,i){i.update(r=>r.set(e,t))}function Jle(t){p_e(t),t.clear()}function f_e(t,e,i){e??=t,i.has(e)||i.set(e,setTimeout(()=>{i.delete(e),t()}))}let PJ=TOt();function h_e(t,e){t[PJ]=e}function POt(t){return!!t?.[PJ]}function j0(t){return t[PJ]}function m_e(t,e,i,r=[]){let n=document.createElement(t);n.className=e,typeof i=="string"?n.innerText=i:i.domNodes?n.replaceChildren(...i.domNodes):i.html&&(n.innerHTML=i.html);for(let a of r)n.setAttribute(...a);return n}function ROt(t){return t.scrollHeight>t.clientHeight}function my(t){return t.getBoundingClientRect()}function SC(t,e){for(;e--;)t=t.parentElement;return t}function bk(t){return my(t).height}function uT(t,e,i=document){for(let r of i.elementsFromPoint(t,e)){if(POt(r))return r;if(r.shadowRoot){let n=uT(t,e,r.shadowRoot);if(n)return n}}return null}function Ix(t,e,i,r){return t.addEventListener(e,i,r),()=>t.removeEventListener(e,i,r)}function MOt(t,e,i,r){return{type:t,title:e,currentStart:i.start,currentEnd:i.end,activeStart:r.start,activeEnd:r.end,calendar:void 0}}function Gd(t){return t=Xy({},t),t.currentStart=Sc(t.currentStart),t.currentEnd=Sc(t.currentEnd),t.activeStart=Sc(t.activeStart),t.activeEnd=Sc(t.activeEnd),t}function Vz(t){return t.startsWith("list")}function XQ(t){return t.includes("Timeline")}let NOt=1;function qO(t){return t.map(e=>{let i={id:"id"in e?String(e.id):`{generated-${NOt++}}`,resourceIds:ZQ(e,"resourceId").map(String),allDay:e.allDay??(Xle(e.start)&&Xle(e.end)),start:Fg(e.start),end:Fg(e.end),title:e.title??"",editable:e.editable,startEditable:e.startEditable,durationEditable:e.durationEditable,display:e.display??"auto",extendedProps:e.extendedProps??{},backgroundColor:e.backgroundColor??e.color,textColor:e.textColor,classNames:ZQ(e,"className"),styles:ZQ(e,"style")};if(i.allDay){Tf(i.start);let r=hn(i.end);Tf(i.end),(!qd(i.end,r)||qd(i.end,i.start))&&aA(i.end)}return i})}function ZQ(t,e){let i=t[e+"s"]??t[e]??[];return EJ(i)?i:[i]}function BOt(t){return t.map(e=>({events:e.events,url:e.url&&e.url.trimEnd("&")||"",method:e.method&&e.method.toUpperCase()||"GET",extraParams:e.extraParams||{}}))}function Gz(t,e,i){let r={start:t.start>e?t.start:e,end:t.end<i?t.end:i,event:t};return r.zeroDuration=qd(r.start,r.end),r}function kOt(t){t.sort((e,i)=>e.start-i.start||i.event.allDay-e.event.allDay)}function xOt(t,e,i,r,n,a){let s=n.formatRange(t.start,e&&t.event.display!=="pointer"&&!t.zeroDuration?Lz(hn(t.start),t.end):t.start),o;if(i&&(o=Ts(i)?i({event:Wd(t.event),timeText:s,view:Gd(a)}):i),o===void 0){let l;switch(t.event.display){case"background":l=[];break;case"pointer":l=[ece(s,t,r)];break;default:l=[...t.event.allDay?[]:[ece(s,t,r)],m_e("h4",r.eventTitle,t.event.title)]}o={domNodes:l}}return[s,o]}function ece(t,e,i){return m_e("time",i.eventTime,t,[["datetime",tf(e.start)]])}function _Ot(t,e,i){let r=e.classNames;return t&&(Ts(t)&&(t=t({event:Wd(e),view:Gd(i)})),r=[...EJ(t)?t:[t],...r]),r}function Wd(t){return A_e(t,Sc)}function JQ(t){return A_e(t,hn)}function A_e(t,e){return t=Xy({},t),t.start=e(t.start),t.end=e(t.end),t}function ej(t,e){let i={};if(t.length){kOt(t);let r;for(let n of t){let a=[],s=Tf(hn(n.start));for(;n.end>s;){if(!e.includes(s.getUTCDay())&&(a.push(hn(s)),a.length>1)){let o=s.getTime();i[o]?i[o].chunks.push(n):i[o]={sorted:!1,chunks:[n]}}aA(s)}if(a.length){n.date=a[0],n.days=a.length,n.dates=a,n.start<a[0]&&(n.start=a[0]);let o=aA(hn(a.at(-1)));n.end>o&&(n.end=o)}else n.date=Tf(hn(n.start)),n.days=1,n.dates=[n.date];r&&qd(r.date,n.date)&&(n.prev=r),r=n}}return i}function OOt(t,e,i){t.top=0,t.prev&&(t.top=t.prev.bottom+1),t.bottom=t.top+i;let r=1,n=t.date.getTime();if(e[n]){e[n].sorted||(e[n].chunks.sort((a,s)=>a.top-s.top),e[n].sorted=!0);for(let a of e[n].chunks)if(t.top<a.bottom&&t.bottom>a.top){let s=a.bottom-t.top+1;r+=s,t.top+=s,t.bottom+=s}}return r}function g_e(t,e){t.length=e.length;let i=[];for(let r of t)i.push(r?.reposition?.());return i}function tce(t,e,i,r){return t.start<i&&t.end>e?r?(EJ(r)||(r=[r]),r.some(n=>t.resourceIds.includes(n.id))):!0:!1}function UC(t){return FOt(t)||LOt(t)||$Ot(t)}function E1(t){return t==="background"}function FOt(t){return t==="preview"}function LOt(t){return t==="ghost"}function $Ot(t){return t==="pointer"}function HOt(t){return VOt(t,"month")}function VOt(t,e){return{...t,next:"Next "+e,prev:"Previous "+e}}function GOt(t){return e=>({...e,view:t})}function QOt(t){let e,i;return t&&({start:e,end:i}=t,e&&(e=Tf(Fg(e))),i&&(i=Tf(Fg(i)))),{start:e,end:i}}function v_e(t,e){return e.start&&t<e.start||e.end&&t>e.end}function ice(t,e){return e.start&&t<e.start&&(t=e.start),e.end&&t>e.end&&(t=e.end),t}function jOt(t){let e=[];return y_e(t,0,e),e}function y_e(t,e,i){let r=[];for(let n of t){let a=zOt(n);r.push(a),i.push(a);let s={level:e,children:[],expanded:!0,hidden:!1};h_e(a,s),n.children&&(s.children=y_e(n.children,e+1,i))}return r}function zOt(t){return{id:String(t.id),title:t.title||"",eventBackgroundColor:t.eventBackgroundColor,eventTextColor:t.eventTextColor,extendedProps:t.extendedProps??{}}}function qOt(t,e){return b_e(t,e)?.eventBackgroundColor}function WOt(t,e){return b_e(t,e)?.eventTextColor}function b_e(t,e){return e.find(i=>t.resourceIds.includes(i.id))}function z0(t,e){return Zh([t,e],([i,r])=>{let n=Ts(r)?{format:r}:new Intl.DateTimeFormat(i,r);return{format:a=>n.format(Sc(a))}})}function rce(t,e){return Zh([t,e],([i,r])=>{let n;if(Ts(r))n=r;else{let a=new Intl.DateTimeFormat(i,r);n=(s,o)=>{if(s<=o)return a.formatRange(s,o);{let l=a.formatRangeToParts(o,s),c="",u=["startRange","endRange"],d=[!1,!1];for(let p of l){let f=u.indexOf(p.source);f>=0?d[f]||(c+=KOt(u[1-f],l),d[f]=!0):c+=p.value}return c}}}return{formatRange:(a,s)=>n(Sc(a),Sc(s))}})}function KOt(t,e){let i="";for(let r of e)r.source==t&&(i+=r.value);return i}function YOt(t){let e={allDayContent:void 0,allDaySlot:!0,buttonText:{today:"today"},customButtons:{},date:new Date,datesSet:void 0,dayHeaderFormat:{weekday:"short",month:"numeric",day:"numeric"},dayHeaderAriaLabelFormat:{dateStyle:"full"},displayEventEnd:!0,duration:{weeks:1},events:[],eventAllUpdated:void 0,eventBackgroundColor:void 0,eventTextColor:void 0,eventClassNames:void 0,eventClick:void 0,eventColor:void 0,eventContent:void 0,eventDidMount:void 0,eventMouseEnter:void 0,eventMouseLeave:void 0,eventSources:[],eventTimeFormat:{hour:"numeric",minute:"2-digit"},filterEventsWithResources:!1,filterResourcesWithEvents:!1,firstDay:0,flexibleSlotTimeLimits:!1,headerToolbar:{start:"title",center:"",end:"today prev,next"},height:void 0,hiddenDays:[],highlightedDates:[],lazyFetching:!0,loading:void 0,locale:void 0,nowIndicator:!1,resourceLabelContent:void 0,resourceLabelDidMount:void 0,resources:[],selectable:!1,scrollTime:"06:00:00",slotDuration:"00:30:00",slotEventOverlap:!0,slotHeight:24,slotLabelInterval:void 0,slotLabelFormat:{hour:"numeric",minute:"2-digit"},slotMaxTime:"24:00:00",slotMinTime:"00:00:00",slotWidth:72,theme:{allDay:"ec-all-day",active:"ec-active",bgEvent:"ec-bg-event",bgEvents:"ec-bg-events",body:"ec-body",button:"ec-button",buttonGroup:"ec-button-group",calendar:"ec",compact:"ec-compact",content:"ec-content",day:"ec-day",dayHead:"ec-day-head",days:"ec-days",disabled:"ec-disabled",event:"ec-event",eventBody:"ec-event-body",eventTime:"ec-event-time",eventTitle:"ec-event-title",events:"ec-events",extra:"ec-extra",handle:"ec-handle",header:"ec-header",hiddenScroll:"ec-hidden-scroll",highlight:"ec-highlight",icon:"ec-icon",line:"ec-line",lines:"ec-lines",nowIndicator:"ec-now-indicator",otherMonth:"ec-other-month",resource:"ec-resource",sidebar:"ec-sidebar",sidebarTitle:"ec-sidebar-title",today:"ec-today",time:"ec-time",title:"ec-title",toolbar:"ec-toolbar",view:"",weekdays:["ec-sun","ec-mon","ec-tue","ec-wed","ec-thu","ec-fri","ec-sat"],withScroll:"ec-with-scroll"},titleFormat:{year:"numeric",month:"short",day:"numeric"},validRange:void 0,view:void 0,viewDidMount:void 0,views:{}};for(let i of t)i.createOptions?.(e);return e}function XOt(t){let e={date:i=>Tf(Fg(i)),duration:Op,events:qO,eventSources:BOt,hiddenDays:i=>[...new Set(i)],highlightedDates:i=>i.map(r=>Tf(Fg(r))),resources:jOt,scrollTime:Op,slotDuration:Op,slotLabelInterval:i=>i!==void 0?Op(i):void 0,slotMaxTime:Op,slotMinTime:Op,validRange:QOt};for(let i of t)i.createParsers?.(e);return e}function ZOt(t,e){let i=[];for(let r of Zf(t))t[r]!==e[r]&&i.push([r,t[r]]);return Xy(e,t),i}function JOt(t){return Zh(t.view,e=>e?.startsWith("dayGrid"))}function eFt(t){return Zh([t._currentRange,t.firstDay,t.slotMaxTime,t._dayGrid],([e,i,r,n])=>{let a=hn(e.start),s=hn(e.end);if(n)d_e(a,i),wOt(s,i);else if(r.days||r.seconds>u_e){Np(Iw(s),r);let o=Iw(hn(s));o<a&&(a=o)}return{start:a,end:s}})}function tFt(t){return Zh([t.date,t.duration,t.firstDay],([e,i,r])=>{let n=hn(e),a;return i.months?n.setUTCDate(1):i.inWeeks&&d_e(n,r),a=Np(hn(n),i),{start:n,end:a}})}function iFt(t){return Zh([t._activeRange,t.hiddenDays],([e,i])=>{let r=[],n=Tf(hn(e.start)),a=Tf(hn(e.end));for(;n<a;)i.includes(n.getUTCDay())||r.push(hn(n)),aA(n);return!r.length&&i.length&&i.length<7&&(t.date.update(s=>{for(;i.includes(s.getUTCDay());)aA(s);return s}),r=QO(t._viewDates)),r})}function rFt(t){return Zh([t.date,t._activeRange,t._intlTitle,t._dayGrid],([e,i,r,n])=>n?r.formatRange(e,e):r.formatRange(i.start,Iw(hn(i.end))))}function nFt(t){return Zh([t.view,t._viewTitle,t._currentRange,t._activeRange],e=>MOt(...e))}function aFt(t){let e=dl([]),i,r=0,n={};return Zh([t.events,t.eventSources,t._activeRange,t._fetchedRange,t.lazyFetching,t.loading],(a,s)=>DJ(()=>{let[o,l,c,u,d,p]=a;if(!l.length){s(o);return}if(!u.start||u.start>c.start||u.end<c.end||!d){i&&i.abort(),i=new AbortController,Ts(p)&&!r&&p(!0);let f=()=>{--r===0&&Ts(p)&&p(!1)},h=[],m=b=>f(),A=b=>{h=h.concat(qO(b)),s(h),f()},g=tf(c.start),v=tf(c.end);for(let b of l){if(Ts(b.events)){let y=b.events({start:Sc(c.start),end:Sc(c.end),startStr:g,endStr:v},A,m);y!==void 0&&Promise.resolve(y).then(A,m)}else{let y=Ts(b.extraParams)?b.extraParams():Xy({},b.extraParams);y.start=g,y.end=v,y=new URLSearchParams(y);let I=b.url,w={},S;["GET","HEAD"].includes(b.method)?I+=(I.includes("?")?"&":"?")+y:(w["content-type"]="application/x-www-form-urlencoded;charset=UTF-8",S=String(y)),fetch(I,{method:b.method,headers:w,body:S,signal:i.signal,credentials:"same-origin"}).then(T=>T.json()).then(A).catch(m)}++r}u.start=c.start,u.end=c.end}},n,t._queue),[]).subscribe(e.set),e}function sFt(){return c_e(Fg(),t=>{let e=setInterval(()=>{t(Fg())},1e3);return()=>clearInterval(e)})}function oFt(t){return Zh(t._now,e=>Tf(hn(e)))}class lFt{constructor(e,i){e=e||[];let r=YOt(e),n=XOt(e);r=Qz(r,n),i=Qz(i,n);for(let[s,o]of Object.entries(r))this[s]=dl(o);this._queue=dl(new Map),this._queue2=dl(new Map),this._tasks=new Map,this._auxiliary=dl([]),this._dayGrid=JOt(this),this._currentRange=tFt(this),this._activeRange=eFt(this),this._fetchedRange=dl({start:void 0,end:void 0}),this._events=aFt(this),this._now=sFt(),this._today=oFt(this),this._intlEventTime=rce(this.locale,this.eventTimeFormat),this._intlSlotLabel=z0(this.locale,this.slotLabelFormat),this._intlDayHeader=z0(this.locale,this.dayHeaderFormat),this._intlDayHeaderAL=z0(this.locale,this.dayHeaderAriaLabelFormat),this._intlTitle=rce(this.locale,this.titleFormat),this._bodyEl=dl(void 0),this._scrollable=dl(!1),this._viewTitle=rFt(this),this._viewDates=iFt(this),this._view=nFt(this),this._viewComponent=dl(void 0),this._interaction=dl({}),this._iEvents=dl([null,null]),this._iClasses=dl(DOt),this._iClass=dl(void 0),this._set=(s,o)=>{jz(s,this)&&(n[s]&&(o=n[s](o)),this[s].set(o))},this._get=s=>jz(s,this)?QO(this[s]):void 0;for(let s of e)s.createStores?.(this);i.view&&this.view.set(i.view);let a=new Set([...Zf(r.views),...Zf(i.views??{})]);for(let s of a){let o=nce(r,r.views[s]??{}),l=nce(o,i,i.views?.[s]??{}),c=l.component;cFt(l,this);for(let u of Zf(l)){let{set:d,_set:p=d,...f}=this[u];this[u]={set:["buttonText","theme"].includes(u)?h=>{if(Ts(h)){let m=h(o[u]);l[u]=m,d(d===p?m:h)}else l[u]=h,d(h)}:h=>{l[u]=h,d(h)},_set:p,...f}}this.view.subscribe(u=>{if(u===s){this._viewComponent.set(c),Ts(l.viewDidMount)&&VN().then(()=>l.viewDidMount(QO(this._view)));for(let d of Zf(l))this[d]._set(l[d])}})}}}function Qz(t,e){let i={...t};for(let r of Zf(e))r in i&&(i[r]=e[r](i[r]));if(t.views){i.views={};for(let r of Zf(t.views))i.views[r]=Qz(t.views[r],e)}return i}function nce(...t){let e={};for(let i of t){let r={};for(let n of["buttonText","theme"])Ts(i[n])&&(r[n]=i[n](e[n]));e={...e,...i,...r}}return e}function cFt(t,e){Zf(t).filter(i=>!jz(i,e)||i=="view").forEach(i=>delete t[i])}function jz(t,e){return e.hasOwnProperty(t)&&t[0]!=="_"}function ace(t,e,i){const r=t.slice();return r[34]=e[i],r}function uFt(t){let e,i=t[7][t[34]]+"",r,n,a,s;function o(){return t[29](t[34])}return{c(){e=zr("button"),r=$N(i),It(e,"class",n=t[5].button+(t[9]===t[34]?" "+t[5].active:"")+" ec-"+t[34])},m(l,c){Qr(l,e,c),En(e,r),a||(s=Gn(e,"click",o),a=!0)},p(l,c){t=l,c[0]&129&&i!==(i=t[7][t[34]]+"")&&n_e(r,i),c[0]&545&&n!==(n=t[5].button+(t[9]===t[34]?" "+t[5].active:"")+" ec-"+t[34])&&It(e,"class",n)},d(l){l&&_r(e),a=!1,s()}}}function dFt(t){let e,i,r,n,a;return{c(){e=zr("button"),It(e,"class",i=t[5].button+" ec-"+t[34]+(t[8][t[34]].active?" "+t[5].active:""))},m(s,o){Qr(s,e,o),n||(a=[Gn(e,"click",function(){ms(t[8][t[34]].click)&&t[8][t[34]].click.apply(this,arguments)}),Og(r=_b.call(null,e,t[8][t[34]].text))],n=!0)},p(s,o){t=s,o[0]&289&&i!==(i=t[5].button+" ec-"+t[34]+(t[8][t[34]].active?" "+t[5].active:""))&&It(e,"class",i),r&&ms(r.update)&&o[0]&257&&r.update.call(null,t[8][t[34]].text)},d(s){s&&_r(e),n=!1,kd(a)}}}function pFt(t){let e,i=t[7][t[34]]+"",r,n,a,s;return{c(){e=zr("button"),r=$N(i),It(e,"class",n=t[5].button+" ec-"+t[34]),e.disabled=t[1]},m(o,l){Qr(o,e,l),En(e,r),a||(s=Gn(e,"click",t[28]),a=!0)},p(o,l){l[0]&129&&i!==(i=o[7][o[34]]+"")&&n_e(r,i),l[0]&33&&n!==(n=o[5].button+" ec-"+o[34])&&It(e,"class",n),l[0]&2&&(e.disabled=o[1])},d(o){o&&_r(e),a=!1,s()}}}function fFt(t){let e,i,r,n,a,s,o,l;return{c(){e=zr("button"),i=zr("i"),It(i,"class",r=t[5].icon+" ec-"+t[34]),It(e,"class",n=t[5].button+" ec-"+t[34]),It(e,"aria-label",a=t[7].next),It(e,"title",s=t[7].next),e.disabled=t[4]},m(c,u){Qr(c,e,u),En(e,i),o||(l=Gn(e,"click",t[23]),o=!0)},p(c,u){u[0]&33&&r!==(r=c[5].icon+" ec-"+c[34])&&It(i,"class",r),u[0]&33&&n!==(n=c[5].button+" ec-"+c[34])&&It(e,"class",n),u[0]&128&&a!==(a=c[7].next)&&It(e,"aria-label",a),u[0]&128&&s!==(s=c[7].next)&&It(e,"title",s),u[0]&16&&(e.disabled=c[4])},d(c){c&&_r(e),o=!1,l()}}}function hFt(t){let e,i,r,n,a,s,o,l;return{c(){e=zr("button"),i=zr("i"),It(i,"class",r=t[5].icon+" ec-"+t[34]),It(e,"class",n=t[5].button+" ec-"+t[34]),It(e,"aria-label",a=t[7].prev),It(e,"title",s=t[7].prev),e.disabled=t[3]},m(c,u){Qr(c,e,u),En(e,i),o||(l=Gn(e,"click",t[22]),o=!0)},p(c,u){u[0]&33&&r!==(r=c[5].icon+" ec-"+c[34])&&It(i,"class",r),u[0]&33&&n!==(n=c[5].button+" ec-"+c[34])&&It(e,"class",n),u[0]&128&&a!==(a=c[7].prev)&&It(e,"aria-label",a),u[0]&128&&s!==(s=c[7].prev)&&It(e,"title",s),u[0]&8&&(e.disabled=c[3])},d(c){c&&_r(e),o=!1,l()}}}function mFt(t){let e,i,r,n,a;return{c(){e=zr("h2"),It(e,"class",i=t[5].title)},m(s,o){Qr(s,e,o),n||(a=Og(r=_b.call(null,e,t[6])),n=!0)},p(s,o){o[0]&32&&i!==(i=s[5].title)&&It(e,"class",i),r&&ms(r.update)&&o[0]&64&&r.update.call(null,s[6])},d(s){s&&_r(e),n=!1,a()}}}function sce(t){let e;function i(a,s){if(a[34]=="title")return mFt;if(a[34]=="prev")return hFt;if(a[34]=="next")return fFt;if(a[34]=="today")return pFt;if(a[8][a[34]])return dFt;if(a[34]!="")return uFt}let r=i(t),n=r&&r(t);return{c(){n&&n.c(),e=Ap()},m(a,s){n&&n.m(a,s),Qr(a,e,s)},p(a,s){r===(r=i(a))&&n?n.p(a,s):(n&&n.d(1),n=r&&r(a),n&&(n.c(),n.m(e.parentNode,e)))},d(a){a&&_r(e),n&&n.d(a)}}}function AFt(t){let e,i=Lo(t[0]),r=[];for(let n=0;n<i.length;n+=1)r[n]=sce(ace(t,i,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=Ap()},m(n,a){for(let s=0;s<r.length;s+=1)r[s]&&r[s].m(n,a);Qr(n,e,a)},p(n,a){if(a[0]&14681087){i=Lo(n[0]);let s;for(s=0;s<i.length;s+=1){const o=ace(n,i,s);r[s]?r[s].p(o,a):(r[s]=sce(o),r[s].c(),r[s].m(e.parentNode,e))}for(;s<r.length;s+=1)r[s].d(1);r.length=i.length}},i:As,o:As,d(n){n&&_r(e),_S(r,n)}}}function gFt(t,e,i){let r,n,a,s,o,l,c,u,d,p,f,{buttons:h}=e,{_currentRange:m,_viewTitle:A,_viewDates:g,buttonText:v,customButtons:b,date:y,duration:I,hiddenDays:w,theme:S,validRange:T,view:D}=gp("state");tt(t,m,V=>i(27,l=V)),tt(t,A,V=>i(6,u=V)),tt(t,g,V=>i(31,o=V)),tt(t,v,V=>i(7,d=V)),tt(t,b,V=>i(8,p=V)),tt(t,y,V=>i(2,n=V)),tt(t,I,V=>i(24,r=V)),tt(t,w,V=>i(25,a=V)),tt(t,S,V=>i(5,c=V)),tt(t,T,V=>i(26,s=V)),tt(t,D,V=>i(9,f=V));let C=Tf(Fg()),E,P,R,M=!1;function N(){return M}function k(){return o.every(V=>v_e(V,s))}function O(){fn(y,n=Hz(n,r,a),n)}function x(){fn(y,n=$z(n,r),n)}const F=()=>fn(y,n=hn(C),n),_=V=>fn(D,f=V,f);return t.$$set=V=>{"buttons"in V&&i(0,h=V.buttons)},t.$$.update=()=>{if(t.$$.dirty[0]&251658246&&!N()){if(M=!0,i(3,E=!1),i(4,P=!1),s.start){let V=hn(n);fn(y,n=Hz(n,r,a),n),i(3,E=k()),fn(y,n=V,n)}if(s.end){let V=hn(n);fn(y,n=$z(n,r),n),i(4,P=k()),fn(y,n=V,n)}if(i(1,R=C>=l.start&&C<l.end),!R&&(s.start||s.end)){let V=hn(n);fn(y,n=hn(C),n),i(1,R=k()),fn(y,n=V,n)}VN().then(()=>M=!1)}},[h,R,n,E,P,c,u,d,p,f,m,A,g,v,b,y,I,w,S,T,D,C,O,x,r,a,s,l,F,_]}class I_e extends Nu{constructor(e){super(),Mu(this,e,gFt,AFt,Vc,{buttons:0},null,[-1,-1])}}function oce(t,e,i){const r=t.slice();return r[5]=e[i],r}function lce(t,e,i){const r=t.slice();return r[8]=e[i],r}function vFt(t){let e,i;return e=new I_e({props:{buttons:t[8]}}),{c(){gs(e.$$.fragment)},m(r,n){Wa(e,r,n),i=!0},p(r,n){const a={};n&1&&(a.buttons=r[8]),e.$set(a)},i(r){i||(mi(e.$$.fragment,r),i=!0)},o(r){Qi(e.$$.fragment,r),i=!1},d(r){Ka(e,r)}}}function yFt(t){let e,i,r,n;return i=new I_e({props:{buttons:t[8]}}),{c(){e=zr("div"),gs(i.$$.fragment),It(e,"class",r=t[1].buttonGroup)},m(a,s){Qr(a,e,s),Wa(i,e,null),n=!0},p(a,s){const o={};s&1&&(o.buttons=a[8]),i.$set(o),(!n||s&2&&r!==(r=a[1].buttonGroup))&&It(e,"class",r)},i(a){n||(mi(i.$$.fragment,a),n=!0)},o(a){Qi(i.$$.fragment,a),n=!1},d(a){a&&_r(e),Ka(i)}}}function cce(t){let e,i,r,n;const a=[yFt,vFt],s=[];function o(l,c){return l[8].length>1?0:1}return e=o(t),i=s[e]=a[e](t),{c(){i.c(),r=Ap()},m(l,c){s[e].m(l,c),Qr(l,r,c),n=!0},p(l,c){let u=e;e=o(l),e===u?s[e].p(l,c):(So(),Qi(s[u],1,1,()=>{s[u]=null}),Uo(),i=s[e],i?i.p(l,c):(i=s[e]=a[e](l),i.c()),mi(i,1),i.m(r.parentNode,r))},i(l){n||(mi(i),n=!0)},o(l){Qi(i),n=!1},d(l){l&&_r(r),s[e].d(l)}}}function uce(t){let e,i,r,n,a=Lo(t[0][t[5]]),s=[];for(let l=0;l<a.length;l+=1)s[l]=cce(lce(t,a,l));const o=l=>Qi(s[l],1,1,()=>{s[l]=null});return{c(){e=zr("div");for(let l=0;l<s.length;l+=1)s[l].c();i=hl(),It(e,"class",r="ec-"+t[5])},m(l,c){Qr(l,e,c);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(e,null);En(e,i),n=!0},p(l,c){if(c&3){a=Lo(l[0][l[5]]);let u;for(u=0;u<a.length;u+=1){const d=lce(l,a,u);s[u]?(s[u].p(d,c),mi(s[u],1)):(s[u]=cce(d),s[u].c(),mi(s[u],1),s[u].m(e,i))}for(So(),u=a.length;u<s.length;u+=1)o(u);Uo()}(!n||c&1&&r!==(r="ec-"+l[5]))&&It(e,"class",r)},i(l){if(!n){for(let c=0;c<a.length;c+=1)mi(s[c]);n=!0}},o(l){s=s.filter(Boolean);for(let c=0;c<s.length;c+=1)Qi(s[c]);n=!1},d(l){l&&_r(e),_S(s,l)}}}function bFt(t){let e,i,r,n=Lo(Zf(t[0])),a=[];for(let o=0;o<n.length;o+=1)a[o]=uce(oce(t,n,o));const s=o=>Qi(a[o],1,1,()=>{a[o]=null});return{c(){e=zr("nav");for(let o=0;o<a.length;o+=1)a[o].c();It(e,"class",i=t[1].toolbar)},m(o,l){Qr(o,e,l);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(e,null);r=!0},p(o,[l]){if(l&3){n=Lo(Zf(o[0]));let c;for(c=0;c<n.length;c+=1){const u=oce(o,n,c);a[c]?(a[c].p(u,l),mi(a[c],1)):(a[c]=uce(u),a[c].c(),mi(a[c],1),a[c].m(e,null))}for(So(),c=n.length;c<a.length;c+=1)s(c);Uo()}(!r||l&2&&i!==(i=o[1].toolbar))&&It(e,"class",i)},i(o){if(!r){for(let l=0;l<n.length;l+=1)mi(a[l]);r=!0}},o(o){a=a.filter(Boolean);for(let l=0;l<a.length;l+=1)Qi(a[l]);r=!1},d(o){o&&_r(e),_S(a,o)}}}function IFt(t,e,i){let r,n,{headerToolbar:a,theme:s}=gp("state");tt(t,a,l=>i(4,r=l)),tt(t,s,l=>i(1,n=l));let o={start:[],center:[],end:[]};return t.$$.update=()=>{if(t.$$.dirty&17)for(let l of Zf(o))i(0,o[l]=r[l].split(" ").map(c=>c.split(",")),o)},[o,n,a,s,r]}class wFt extends Nu{constructor(e){super(),Mu(this,e,IFt,bFt,Vc,{})}}function dce(t,e,i){const r=t.slice();return r[11]=e[i],r}function pce(t){let e,i,r;var n=t[11];function a(s,o){return{}}return n&&(e=Jv(n,a())),{c(){e&&gs(e.$$.fragment),i=Ap()},m(s,o){e&&Wa(e,s,o),Qr(s,i,o),r=!0},p(s,o){if(o&1&&n!==(n=s[11])){if(e){So();const l=e;Qi(l.$$.fragment,1,0,()=>{Ka(l,1)}),Uo()}n?(e=Jv(n,a()),gs(e.$$.fragment),mi(e.$$.fragment,1),Wa(e,i.parentNode,i)):e=null}},i(s){r||(e&&mi(e.$$.fragment,s),r=!0)},o(s){e&&Qi(e.$$.fragment,s),r=!1},d(s){s&&_r(i),e&&Ka(e,s)}}}function SFt(t){let e,i,r=Lo(t[0]),n=[];for(let s=0;s<r.length;s+=1)n[s]=pce(dce(t,r,s));const a=s=>Qi(n[s],1,1,()=>{n[s]=null});return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=Ap()},m(s,o){for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(s,o);Qr(s,e,o),i=!0},p(s,[o]){if(o&1){r=Lo(s[0]);let l;for(l=0;l<r.length;l+=1){const c=dce(s,r,l);n[l]?(n[l].p(c,o),mi(n[l],1)):(n[l]=pce(c),n[l].c(),mi(n[l],1),n[l].m(e.parentNode,e))}for(So(),l=r.length;l<n.length;l+=1)a(l);Uo()}},i(s){if(!i){for(let o=0;o<r.length;o+=1)mi(n[o]);i=!0}},o(s){n=n.filter(Boolean);for(let o=0;o<n.length;o+=1)Qi(n[o]);i=!1},d(s){s&&_r(e),_S(n,s)}}}function UFt(t,e,i){let r,n,a,s,{datesSet:o,_auxiliary:l,_activeRange:c,_queue:u,_view:d}=gp("state");tt(t,o,h=>i(7,n=h)),tt(t,l,h=>i(0,s=h)),tt(t,c,h=>i(5,a=h)),tt(t,d,h=>i(6,r=h));let p={};function f(h){Ts(n)&&DJ(()=>n({start:Sc(h.start),end:Sc(h.end),startStr:tf(h.start),endStr:tf(h.end),view:Gd(r)}),p,u)}return t.$$.update=()=>{t.$$.dirty&32&&f(a)},[s,o,l,c,d,a]}let TFt=class extends Nu{constructor(e){super(),Mu(this,e,UFt,SFt,Vc,{})}};function CFt(t){let e,i,r,n,a,s,o,l,c,u,d;i=new wFt({});var p=t[5];function f(h,m){return{}}return p&&(n=Jv(p,f())),l=new TFt({}),{c(){e=zr("div"),gs(i.$$.fragment),r=hl(),n&&gs(n.$$.fragment),o=hl(),gs(l.$$.fragment),It(e,"class",a=t[1].calendar+" "+t[1].view+(t[0]?" "+t[1].withScroll:"")+(t[2]?" "+t[1][t[2]]:"")),It(e,"role",s=Vz(t[4])?"list":"table"),Kle(e,"height",t[3])},m(h,m){Qr(h,e,m),Wa(i,e,null),En(e,r),n&&Wa(n,e,null),Qr(h,o,m),Wa(l,h,m),c=!0,u||(d=Gn(window,"resize",t[20]),u=!0)},p(h,m){if(m[0]&32&&p!==(p=h[5])){if(n){So();const A=n;Qi(A.$$.fragment,1,0,()=>{Ka(A,1)}),Uo()}p?(n=Jv(p,f()),gs(n.$$.fragment),mi(n.$$.fragment,1),Wa(n,e,null)):n=null}(!c||m[0]&7&&a!==(a=h[1].calendar+" "+h[1].view+(h[0]?" "+h[1].withScroll:"")+(h[2]?" "+h[1][h[2]]:"")))&&It(e,"class",a),(!c||m[0]&16&&s!==(s=Vz(h[4])?"list":"table"))&&It(e,"role",s),m[0]&8&&Kle(e,"height",h[3])},i(h){c||(mi(i.$$.fragment,h),n&&mi(n.$$.fragment,h),mi(l.$$.fragment,h),c=!0)},o(h){Qi(i.$$.fragment,h),n&&Qi(n.$$.fragment,h),Qi(l.$$.fragment,h),c=!1},d(h){h&&(_r(e),_r(o)),Ka(i),n&&Ka(n),Ka(l,h),u=!1,d()}}}function EFt(t,e,i){let r,n,a,s,o,l,c,u,d,p,f,h,m,A,{plugins:g=[]}=e,{options:v={}}=e,b=new lFt(g,v);gOt("state",b);let{_viewComponent:y,_bodyEl:I,_interaction:w,_iClass:S,_events:T,_queue:D,_queue2:C,_tasks:E,_scrollable:P,date:R,duration:M,hiddenDays:N,height:k,theme:O,view:x}=b;tt(t,y,he=>i(5,A=he)),tt(t,I,he=>i(36,r=he)),tt(t,w,he=>i(42,u=he)),tt(t,S,he=>i(2,f=he)),tt(t,T,he=>i(43,d=he)),tt(t,D,he=>i(38,s=he)),tt(t,C,he=>i(37,a=he)),tt(t,P,he=>i(0,n=he)),tt(t,R,he=>i(41,c=he)),tt(t,M,he=>i(40,l=he)),tt(t,N,he=>i(39,o=he)),tt(t,k,he=>i(3,h=he)),tt(t,O,he=>i(1,p=he)),tt(t,x,he=>i(4,m=he));let F={...v};function _(he,Ie){return b._set(he,Ie),this}function V(he){let Ie=b._get(he);return Ie instanceof Date?Sc(Ie):Ie}function G(){return b._fetchedRange.set({start:void 0,end:void 0}),this}function z(){return d.map(Wd)}function Q(he){for(let Ie of d)if(Ie.id==he)return Wd(Ie);return null}function j(he){return he=qO([he])[0],d.push(he),T.set(d),Wd(he)}function W(he){for(let Ie of d)if(Ie.id==he.id)return he=qO([he])[0],Xy(Ie,he),T.set(d),Wd(he);return null}function Y(he){let Ie=d.findIndex(xe=>xe.id==he);return Ie>=0&&(d.splice(Ie,1),T.set(d)),this}function X(){return Gd(QO(b._view))}function J(){return u.action?.unselect(),this}function ie(he,Ie){let xe=uT(he,Ie);if(xe){let Je=j0(xe)(he,Ie);return Je.date=Sc(Je.date),Je}return null}function ue(){return fn(R,c=$z(c,l),c),this}function ne(){return fn(R,c=Hz(c,l,o),c),this}mOt(()=>{Jle(s)}),a_e(()=>{Jle(a),f_e(ge,null,E)});function ge(){r&&fn(P,n=ROt(r),n)}return t.$$set=he=>{"plugins"in he&&i(21,g=he.plugins),"options"in he&&i(22,v=he.options)},t.$$.update=()=>{if(t.$$.dirty[0]&4194304)for(let[he,Ie]of ZOt(v,F))_(he,Ie)},[n,p,f,h,m,A,y,I,w,S,T,D,C,P,R,M,N,k,O,x,ge,g,v,_,V,G,z,Q,j,W,Y,X,J,ie,ue,ne]}class DFt extends Nu{constructor(e){super(),Mu(this,e,EFt,CFt,Vc,{plugins:21,options:22,setOption:23,getOption:24,refetchEvents:25,getEvents:26,getEventById:27,addEvent:28,updateEvent:29,removeEventById:30,getView:31,unselect:32,dateFromPoint:33,next:34,prev:35},null,[-1,-1])}get setOption(){return this.$$.ctx[23]}get getOption(){return this.$$.ctx[24]}get refetchEvents(){return this.$$.ctx[25]}get getEvents(){return this.$$.ctx[26]}get getEventById(){return this.$$.ctx[27]}get addEvent(){return this.$$.ctx[28]}get updateEvent(){return this.$$.ctx[29]}get removeEventById(){return this.$$.ctx[30]}get getView(){return this.$$.ctx[31]}get unselect(){return this.$$.ctx[32]}get dateFromPoint(){return this.$$.ctx[33]}get next(){return this.$$.ctx[34]}get prev(){return this.$$.ctx[35]}}let PFt=class extends DFt{destroy(){this.$destroy()}get view(){return this.getView()}};function RFt(t){return Zh([t.date,t.firstDay,t.hiddenDays],([e,i,r])=>{let n=[],a=hn(e),s=7;for(;a.getUTCDay()!==i&&s;)Iw(a),--s;for(let o=0;o<7;++o)r.includes(a.getUTCDay())||n.push(hn(a)),aA(a);return n})}function fce(t,e,i){const r=t.slice();return r[8]=e[i],r}function hce(t){let e,i,r,n,a,s,o,l;return{c(){e=zr("div"),i=zr("span"),a=hl(),It(i,"aria-label",r=t[2].format(t[8])),It(e,"class",s=t[0].day+" "+t[0].weekdays?.[t[8].getUTCDay()]),It(e,"role","columnheader")},m(c,u){Qr(c,e,u),En(e,i),En(e,a),o||(l=Og(n=_b.call(null,i,t[3].format(t[8]))),o=!0)},p(c,u){t=c,u&6&&r!==(r=t[2].format(t[8]))&&It(i,"aria-label",r),n&&ms(n.update)&&u&10&&n.update.call(null,t[3].format(t[8])),u&3&&s!==(s=t[0].day+" "+t[0].weekdays?.[t[8].getUTCDay()])&&It(e,"class",s)},d(c){c&&_r(e),o=!1,l()}}}function MFt(t){let e,i,r,n,a,s,o,l=Lo(t[1]),c=[];for(let u=0;u<l.length;u+=1)c[u]=hce(fce(t,l,u));return{c(){e=zr("div"),i=zr("div");for(let u=0;u<c.length;u+=1)c[u].c();n=hl(),a=zr("div"),It(i,"class",r=t[0].days),It(i,"role","row"),It(a,"class",s=t[0].hiddenScroll),It(e,"class",o=t[0].header)},m(u,d){Qr(u,e,d),En(e,i);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(i,null);En(e,n),En(e,a)},p(u,[d]){if(d&15){l=Lo(u[1]);let p;for(p=0;p<l.length;p+=1){const f=fce(u,l,p);c[p]?c[p].p(f,d):(c[p]=hce(f),c[p].c(),c[p].m(i,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=l.length}d&1&&r!==(r=u[0].days)&&It(i,"class",r),d&1&&s!==(s=u[0].hiddenScroll)&&It(a,"class",s),d&1&&o!==(o=u[0].header)&&It(e,"class",o)},i:As,o:As,d(u){u&&_r(e),_S(c,u)}}}function NFt(t,e,i){let r,n,a,s,{theme:o,_intlDayHeader:l,_intlDayHeaderAL:c,_days:u}=gp("state");return tt(t,o,d=>i(0,r=d)),tt(t,l,d=>i(3,s=d)),tt(t,c,d=>i(2,a=d)),tt(t,u,d=>i(1,n=d)),[r,n,a,s,o,l,c,u]}class BFt extends Nu{constructor(e){super(),Mu(this,e,NFt,MFt,Vc,{})}}function kFt(t){let e,i,r,n,a,s,o,l,c,u,d,p,f;var h=t[8].resizer;function m(v,b){return{props:{start:!0,event:v[0]}}}h&&(i=Jv(h,m(t)),i.$on("pointerdown",function(){ms(t[32](t[8],["x","start"]))&&t[32](t[8],["x","start"]).apply(this,arguments)}));var A=t[8].resizer;function g(v,b){return{props:{event:v[0]}}}return A&&(l=Jv(A,g(t)),l.$on("pointerdown",function(){ms(t[32](t[8],["x","end"]))&&t[32](t[8],["x","end"]).apply(this,arguments)})),{c(){e=zr("article"),i&&gs(i.$$.fragment),r=hl(),n=zr("div"),o=hl(),l&&gs(l.$$.fragment),It(n,"class",a=t[2].eventBody),It(e,"class",t[4]),It(e,"style",t[5]),It(e,"role",c=t[7]?"button":void 0),It(e,"tabindex",u=t[7]?0:void 0)},m(v,b){Qr(v,e,b),i&&Wa(i,e,null),En(e,r),En(e,n),En(e,o),l&&Wa(l,e,null),t[51](e),d=!0,p||(f=[Og(s=_b.call(null,n,t[6])),Gn(e,"click",function(){ms(t[7]||void 0)&&(t[7]||void 0).apply(this,arguments)}),Gn(e,"keydown",function(){ms(t[7]&&zO(t[7]))&&(t[7]&&zO(t[7])).apply(this,arguments)}),Gn(e,"mouseenter",function(){ms(t[31](t[9],t[1]))&&t[31](t[9],t[1]).apply(this,arguments)}),Gn(e,"mouseleave",function(){ms(t[31](t[10],t[1]))&&t[31](t[10],t[1]).apply(this,arguments)}),Gn(e,"pointerdown",function(){ms(!UC(t[1])&&t[32](t[8]))&&(!UC(t[1])&&t[32](t[8])).apply(this,arguments)})],p=!0)},p(v,b){if(t=v,b[0]&256&&h!==(h=t[8].resizer)){if(i){So();const y=i;Qi(y.$$.fragment,1,0,()=>{Ka(y,1)}),Uo()}h?(i=Jv(h,m(t)),i.$on("pointerdown",function(){ms(t[32](t[8],["x","start"]))&&t[32](t[8],["x","start"]).apply(this,arguments)}),gs(i.$$.fragment),mi(i.$$.fragment,1),Wa(i,e,r)):i=null}else if(h){const y={};b[0]&1&&(y.event=t[0]),i.$set(y)}if((!d||b[0]&4&&a!==(a=t[2].eventBody))&&It(n,"class",a),s&&ms(s.update)&&b[0]&64&&s.update.call(null,t[6]),b[0]&256&&A!==(A=t[8].resizer)){if(l){So();const y=l;Qi(y.$$.fragment,1,0,()=>{Ka(y,1)}),Uo()}A?(l=Jv(A,g(t)),l.$on("pointerdown",function(){ms(t[32](t[8],["x","end"]))&&t[32](t[8],["x","end"]).apply(this,arguments)}),gs(l.$$.fragment),mi(l.$$.fragment,1),Wa(l,e,null)):l=null}else if(A){const y={};b[0]&1&&(y.event=t[0]),l.$set(y)}(!d||b[0]&16)&&It(e,"class",t[4]),(!d||b[0]&32)&&It(e,"style",t[5]),(!d||b[0]&128&&c!==(c=t[7]?"button":void 0))&&It(e,"role",c),(!d||b[0]&128&&u!==(u=t[7]?0:void 0))&&It(e,"tabindex",u)},i(v){d||(i&&mi(i.$$.fragment,v),l&&mi(l.$$.fragment,v),d=!0)},o(v){i&&Qi(i.$$.fragment,v),l&&Qi(l.$$.fragment,v),d=!1},d(v){v&&_r(e),i&&Ka(i),l&&Ka(l),t[51](null),p=!1,kd(f)}}}function xFt(t,e,i){let r,n,a,s,o,l,c,u,d,p,f,h,m,A,g,v,b,y,I,w,{chunk:S}=e,{longChunks:T={}}=e,{inPopup:D=!1}=e,{dates:C=[]}=e,{dayMaxEvents:E,displayEventEnd:P,eventAllUpdated:R,eventBackgroundColor:M,eventTextColor:N,eventClick:k,eventColor:O,eventContent:x,eventClassNames:F,eventDidMount:_,eventMouseEnter:V,eventMouseLeave:G,resources:z,theme:Q,_view:j,_intlEventTime:W,_interaction:Y,_iClasses:X,_hiddenEvents:J,_popupDate:ie,_tasks:ue}=gp("state");tt(t,E,Fe=>i(54,a=Fe)),tt(t,P,Fe=>i(44,h=Fe)),tt(t,R,Fe=>i(56,c=Fe)),tt(t,M,Fe=>i(50,y=Fe)),tt(t,N,Fe=>i(47,g=Fe)),tt(t,k,Fe=>i(40,r=Fe)),tt(t,O,Fe=>i(49,b=Fe)),tt(t,x,Fe=>i(43,f=Fe)),tt(t,F,Fe=>i(45,m=Fe)),tt(t,_,Fe=>i(57,u=Fe)),tt(t,V,Fe=>i(9,I=Fe)),tt(t,G,Fe=>i(10,w=Fe)),tt(t,z,Fe=>i(48,v=Fe)),tt(t,Q,Fe=>i(2,p=Fe)),tt(t,j,Fe=>i(41,l=Fe)),tt(t,W,Fe=>i(42,d=Fe)),tt(t,Y,Fe=>i(8,o=Fe)),tt(t,X,Fe=>i(46,A=Fe)),tt(t,J,Fe=>i(53,n=Fe)),tt(t,ie,Fe=>i(55,s=Fe));let ne,ge,he,Ie,xe,Je,qe=1,dt=!1,ft,je;AOt(()=>{Ts(u)&&u({event:Wd(ge),timeText:Je,el:ne,view:Gd(l)})}),a_e(()=>{Ts(c)&&!UC(ft)&&f_e(()=>c({view:Gd(l)}),"eau",ue)});function Tt(Fe,Xe){return!UC(Xe)&&Ts(Fe)?ct=>Fe({event:Wd(ge),el:ne,jsEvent:ct,view:Gd(l)}):void 0}function Oe(Fe,Xe){return Fe.action?ct=>o.action.drag(ge,ct,Xe,D?s:null,[my(ne).top-my(SC(ne,1)).top,C],S.zeroDuration):void 0}function mt(){ne&&(i(38,qe=OOt(S,T,bk(ne))),a===!0?Le():i(39,dt=!1))}function Le(){let Fe=SC(ne,2),Xe=bk(Fe)-bk(Fe.firstElementChild)-lt(Fe);i(39,dt=S.bottom>Xe);let ct=!1;for(let We of S.dates){let ht=n[We.getTime()];if(ht){let xt=ht.size;dt?ht.add(S.event):ht.delete(S.event),xt!==ht.size&&(ct=!0)}}ct&&J.set(n)}function lt(Fe){let Xe=0;for(let ct=0;ct<S.days&&(Xe=oI(Xe,bk(Fe.lastElementChild)),Fe=Fe.nextElementSibling,!!Fe);++ct);return Xe}function it(Fe){nA[Fe?"unshift":"push"](()=>{ne=Fe,i(3,ne)})}return t.$$set=Fe=>{"chunk"in Fe&&i(33,S=Fe.chunk),"longChunks"in Fe&&i(34,T=Fe.longChunks),"inPopup"in Fe&&i(35,D=Fe.inPopup),"dates"in Fe&&i(36,C=Fe.dates)},t.$$.update=()=>{if(t.$$.dirty[1]&4&&i(0,ge=S.event),t.$$.dirty[0]&39|t.$$.dirty[1]&1033604){i(1,ft=ge.display);let Fe=ge.backgroundColor||qOt(ge,v)||y||b,Xe=ge.textColor||WOt(ge,v)||g;if(E1(ft))i(5,Ie=`width:calc(${S.days*100}% + ${S.days-1}px);`);else{let ct=qe;if(ge._margin){let[We,ht]=ge._margin;S.date>=ht[0]&&S.date<=ht.at(-1)&&(ct=We)}i(5,Ie=`width:calc(${S.days*100}% + ${(S.days-1)*7}px);margin-top:${ct}px;`)}Fe&&i(5,Ie+=`background-color:${Fe};`),Xe&&i(5,Ie+=`color:${Xe};`),dt&&i(5,Ie+="visibility:hidden;"),i(5,Ie+=ge.styles.join(";")),i(4,he=[E1(ft)?p.bgEvent:p.event,...A([],ge),..._Ot(m,ge,l)].join(" "))}t.$$.dirty[0]&4|t.$$.dirty[1]&15364&&i(6,[Je,xe]=xOt(S,h,f,p,d,l),xe),t.$$.dirty[0]&2|t.$$.dirty[1]&512&&i(7,je=Tt(r,ft))},[ge,ft,p,ne,he,Ie,xe,je,o,I,w,E,P,R,M,N,k,O,x,F,_,V,G,z,Q,j,W,Y,X,J,ie,Tt,Oe,S,T,D,C,mt,qe,dt,r,l,d,f,h,m,A,g,v,b,y,it]}let GN=class extends Nu{constructor(e){super(),Mu(this,e,xFt,kFt,Vc,{chunk:33,longChunks:34,inPopup:35,dates:36,reposition:37},null,[-1,-1])}get reposition(){return this.$$.ctx[37]}};function mce(t,e,i){const r=t.slice();return r[20]=e[i],r}function Ace(t,e){let i,r,n;return r=new GN({props:{chunk:e[20],inPopup:!0}}),{key:t,first:null,c(){i=Ap(),gs(r.$$.fragment),this.first=i},m(a,s){Qr(a,i,s),Wa(r,a,s),n=!0},p(a,s){e=a;const o={};s&1&&(o.chunk=e[20]),r.$set(o)},i(a){n||(mi(r.$$.fragment,a),n=!0)},o(a){Qi(r.$$.fragment,a),n=!1},d(a){a&&_r(i),Ka(r,a)}}}function _Ft(t){let e,i,r,n,a,s,o,l,c,u,d,p,f=[],h=new Map,m,A,g,v,b,y=Lo(t[0]);const I=w=>w[20].event;for(let w=0;w<y.length;w+=1){let S=mce(t,y,w),T=I(S);h.set(T,f[w]=Ace(T,S))}return{c(){e=zr("div"),i=zr("div"),r=zr("time"),s=hl(),o=zr("a"),l=$N(""),d=hl(),p=zr("div");for(let w=0;w<f.length;w+=1)f[w].c();It(r,"datetime",n=tf(t[3],10)),It(o,"role","button"),It(o,"tabindex","0"),It(o,"aria-label",c=t[6].close),It(i,"class",u=t[4].dayHead),It(p,"class",m=t[4].events),It(e,"class",A=t[4].popup),It(e,"style",t[2])},m(w,S){Qr(w,e,S),En(e,i),En(i,r),En(i,s),En(i,o),En(o,l),En(e,d),En(e,p);for(let T=0;T<f.length;T+=1)f[T]&&f[T].m(p,null);t[16](e),g=!0,v||(b=[Og(a=_b.call(null,r,t[5].format(t[3]))),Gn(o,"click",jO(t[13])),Gn(o,"keydown",zO(t[13])),Og(IOt.call(null,e,"pointerdown")),Gn(e,"pointerdown",jO(t[15])),Gn(e,"pointerdownoutside",t[14])],v=!0)},p(w,[S]){(!g||S&8&&n!==(n=tf(w[3],10)))&&It(r,"datetime",n),a&&ms(a.update)&&S&40&&a.update.call(null,w[5].format(w[3])),(!g||S&64&&c!==(c=w[6].close))&&It(o,"aria-label",c),(!g||S&16&&u!==(u=w[4].dayHead))&&It(i,"class",u),S&1&&(y=Lo(w[0]),So(),f=CJ(f,S,I,1,w,y,h,p,TJ,Ace,null,mce),Uo()),(!g||S&16&&m!==(m=w[4].events))&&It(p,"class",m),(!g||S&16&&A!==(A=w[4].popup))&&It(e,"class",A),(!g||S&4)&&It(e,"style",w[2])},i(w){if(!g){for(let S=0;S<y.length;S+=1)mi(f[S]);g=!0}},o(w){for(let S=0;S<f.length;S+=1)Qi(f[S]);g=!1},d(w){w&&_r(e);for(let S=0;S<f.length;S+=1)f[S].d();t[16](null),v=!1,kd(b)}}}function OFt(t,e,i){let r,n,a,s,o,l,{buttonText:c,theme:u,_interaction:d,_intlDayPopover:p,_popupDate:f,_popupChunks:h}=gp("state");tt(t,c,S=>i(6,l=S)),tt(t,u,S=>i(4,s=S)),tt(t,d,S=>i(17,r=S)),tt(t,p,S=>i(5,o=S)),tt(t,f,S=>i(3,n=S)),tt(t,h,S=>i(0,a=S));let m,A="";function g(){let S=SC(m,1),T=SC(S,3),D=my(m),C=my(S),E=my(T);i(2,A="");let P;if(D.width>=E.width){P=E.left-C.left;let M=C.right-E.right;i(2,A+=`right:${M}px;`)}else P=(C.width-D.width)/2,C.left+P<E.left?P=E.left-C.left:C.left+P+D.width>E.right&&(P=E.right-C.left-D.width);i(2,A+=`left:${P}px;`);let R;if(D.height>=E.height){R=E.top-C.top;let M=C.bottom-E.bottom;i(2,A+=`bottom:${M}px;`)}else R=(C.height-D.height)/2,C.top+R<E.top?R=E.top-C.top:C.top+R+D.height>E.bottom&&(R=E.bottom-C.top-D.height);i(2,A+=`top:${R}px;`)}function v(){m&&(i(2,A=""),VN().then(()=>{a.length?g():b()}))}function b(S){fn(f,n=null,n)}function y(S){b(),r.action?.noClick()}function I(S){uV.call(this,t,S)}function w(S){nA[S?"unshift":"push"](()=>{m=S,i(1,m)})}return t.$$.update=()=>{t.$$.dirty&1&&a&&v()},[a,m,A,n,s,o,l,c,u,d,p,f,h,b,y,I,w]}class FFt extends Nu{constructor(e){super(),Mu(this,e,OFt,_Ft,Vc,{})}}function gce(t,e,i){const r=t.slice();return r[54]=e[i],r[55]=e,r[56]=i,r}function vce(t,e,i){const r=t.slice();return r[54]=e[i],r}function yce(t){let e,i,r,n,a;return{c(){e=zr("span"),It(e,"class",i=t[17].weekNumber)},m(s,o){Qr(s,e,o),n||(a=Og(r=_b.call(null,e,t[15])),n=!0)},p(s,o){o[0]&131072&&i!==(i=s[17].weekNumber)&&It(e,"class",i),r&&ms(r.update)&&o[0]&32768&&r.update.call(null,s[15])},d(s){s&&_r(e),n=!1,a()}}}function bce(t){let e=[],i=new Map,r,n,a=Lo(t[10]);const s=o=>o[54].event;for(let o=0;o<a.length;o+=1){let l=vce(t,a,o),c=s(l);i.set(c,e[o]=Ice(c,l))}return{c(){for(let o=0;o<e.length;o+=1)e[o].c();r=Ap()},m(o,l){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(o,l);Qr(o,r,l),n=!0},p(o,l){l[0]&1024&&(a=Lo(o[10]),So(),e=CJ(e,l,s,1,o,a,i,r.parentNode,TJ,Ice,r,vce),Uo())},i(o){if(!n){for(let l=0;l<a.length;l+=1)mi(e[l]);n=!0}},o(o){for(let l=0;l<e.length;l+=1)Qi(e[l]);n=!1},d(o){o&&_r(r);for(let l=0;l<e.length;l+=1)e[l].d(o)}}}function Ice(t,e){let i,r,n;return r=new GN({props:{chunk:e[54]}}),{key:t,first:null,c(){i=Ap(),gs(r.$$.fragment),this.first=i},m(a,s){Qr(a,i,s),Wa(r,a,s),n=!0},p(a,s){e=a;const o={};s[0]&1024&&(o.chunk=e[54]),r.$set(o)},i(a){n||(mi(r.$$.fragment,a),n=!0)},o(a){Qi(r.$$.fragment,a),n=!1},d(a){a&&_r(i),Ka(r,a)}}}function wce(t){let e=t[2][2]&&qd(t[2][2].date,t[0]),i,r=t[2][0]&&qd(t[2][0].date,t[0]),n,a,s=e&&Sce(t),o=r&&Uce(t);return{c(){s&&s.c(),i=hl(),o&&o.c(),n=Ap()},m(l,c){s&&s.m(l,c),Qr(l,i,c),o&&o.m(l,c),Qr(l,n,c),a=!0},p(l,c){c[0]&5&&(e=l[2][2]&&qd(l[2][2].date,l[0])),e?s?(s.p(l,c),c[0]&5&&mi(s,1)):(s=Sce(l),s.c(),mi(s,1),s.m(i.parentNode,i)):s&&(So(),Qi(s,1,1,()=>{s=null}),Uo()),c[0]&5&&(r=l[2][0]&&qd(l[2][0].date,l[0])),r?o?(o.p(l,c),c[0]&5&&mi(o,1)):(o=Uce(l),o.c(),mi(o,1),o.m(n.parentNode,n)):o&&(So(),Qi(o,1,1,()=>{o=null}),Uo())},i(l){a||(mi(s),mi(o),a=!0)},o(l){Qi(s),Qi(o),a=!1},d(l){l&&(_r(i),_r(n)),s&&s.d(l),o&&o.d(l)}}}function Sce(t){let e,i,r,n;return i=new GN({props:{chunk:t[2][2]}}),{c(){e=zr("div"),gs(i.$$.fragment),It(e,"class",r=t[17].events)},m(a,s){Qr(a,e,s),Wa(i,e,null),n=!0},p(a,s){const o={};s[0]&4&&(o.chunk=a[2][2]),i.$set(o),(!n||s[0]&131072&&r!==(r=a[17].events))&&It(e,"class",r)},i(a){n||(mi(i.$$.fragment,a),n=!0)},o(a){Qi(i.$$.fragment,a),n=!1},d(a){a&&_r(e),Ka(i)}}}function Uce(t){let e,i,r,n;return i=new GN({props:{chunk:t[2][0]}}),{c(){e=zr("div"),gs(i.$$.fragment),It(e,"class",r=t[17].events+" "+t[17].preview)},m(a,s){Qr(a,e,s),Wa(i,e,null),n=!0},p(a,s){const o={};s[0]&4&&(o.chunk=a[2][0]),i.$set(o),(!n||s[0]&131072&&r!==(r=a[17].events+" "+a[17].preview))&&It(e,"class",r)},i(a){n||(mi(i.$$.fragment,a),n=!0)},o(a){Qi(i.$$.fragment,a),n=!1},d(a){a&&_r(e),Ka(i)}}}function Tce(t){let e=[],i=new Map,r,n,a=Lo(t[5]);const s=o=>o[54].event;for(let o=0;o<a.length;o+=1){let l=gce(t,a,o),c=s(l);i.set(c,e[o]=Cce(c,l))}return{c(){for(let o=0;o<e.length;o+=1)e[o].c();r=Ap()},m(o,l){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(o,l);Qr(o,r,l),n=!0},p(o,l){l[0]&65578&&(a=Lo(o[5]),So(),e=CJ(e,l,s,1,o,a,i,r.parentNode,TJ,Cce,r,gce),Uo())},i(o){if(!n){for(let l=0;l<a.length;l+=1)mi(e[l]);n=!0}},o(o){for(let l=0;l<e.length;l+=1)Qi(e[l]);n=!1},d(o){o&&_r(r);for(let l=0;l<e.length;l+=1)e[l].d(o)}}}function Cce(t,e){let i,r,n=e[56],a;const s=()=>e[49](r,n),o=()=>e[49](null,n);let l={chunk:e[54],longChunks:e[1],dates:e[3]};return r=new GN({props:l}),s(),{key:t,first:null,c(){i=Ap(),gs(r.$$.fragment),this.first=i},m(c,u){Qr(c,i,u),Wa(r,c,u),a=!0},p(c,u){e=c,n!==e[56]&&(o(),n=e[56],s());const d={};u[0]&32&&(d.chunk=e[54]),u[0]&2&&(d.longChunks=e[1]),u[0]&8&&(d.dates=e[3]),r.$set(d)},i(c){a||(mi(r.$$.fragment,c),a=!0)},o(c){Qi(r.$$.fragment,c),a=!1},d(c){c&&_r(i),o(),Ka(r,c)}}}function Ece(t){let e,i;return e=new FFt({}),{c(){gs(e.$$.fragment)},m(r,n){Wa(e,r,n),i=!0},i(r){i||(mi(e.$$.fragment,r),i=!0)},o(r){Qi(e.$$.fragment,r),i=!1},d(r){Ka(e,r)}}}function Dce(t){let e,i,r,n;return{c(){e=zr("a"),It(e,"role","button"),It(e,"tabindex","0"),It(e,"aria-haspopup","true")},m(a,s){Qr(a,e,s),r||(n=[Gn(e,"click",jO(t[34])),Gn(e,"keydown",zO(t[34])),Gn(e,"pointerdown",jO(t[48])),Og(i=_b.call(null,e,t[14]))],r=!0)},p(a,s){i&&ms(i.update)&&s[0]&16384&&i.update.call(null,a[14])},d(a){a&&_r(e),r=!1,kd(n)}}}function LFt(t){let e,i,r,n,a,s,o,l,c,u,d,p,f,h,m,A,g,v,b,y,I,w,S=t[9]&&yce(t),T=!t[6]&&bce(t),D=!t[6]&&wce(t),C=!t[6]&&Tce(t),E=t[8]&&Ece(),P=!t[6]&&t[7].size&&Dce(t);return{c(){e=zr("div"),i=zr("div"),r=zr("time"),s=hl(),S&&S.c(),l=hl(),c=zr("div"),T&&T.c(),d=hl(),D&&D.c(),p=hl(),f=zr("div"),C&&C.c(),m=hl(),E&&E.c(),A=hl(),g=zr("div"),P&&P.c(),It(r,"datetime",n=tf(t[0],10)),It(i,"class",o=t[17].dayHead),It(c,"class",u=t[17].bgEvents),It(f,"class",h=t[17].events),It(g,"class",v=t[17].dayFoot),It(e,"class",b=t[17].day+" "+t[17].weekdays?.[t[0].getUTCDay()]+(t[11]?" "+t[17].today:"")+(t[12]?" "+t[17].otherMonth:"")+(t[13]?" "+t[17].highlight:"")+(t[6]?" "+t[17].disabled:"")),It(e,"role","cell")},m(R,M){Qr(R,e,M),En(e,i),En(i,r),En(i,s),S&&S.m(i,null),En(e,l),En(e,c),T&&T.m(c,null),En(e,d),D&&D.m(e,null),En(e,p),En(e,f),C&&C.m(f,null),En(e,m),E&&E.m(e,null),En(e,A),En(e,g),P&&P.m(g,null),t[50](e),y=!0,I||(w=[Og(a=_b.call(null,r,t[19].format(t[0]))),Gn(e,"pointerdown",function(){ms(t[18].action?.select)&&t[18].action?.select.apply(this,arguments)})],I=!0)},p(R,M){t=R,(!y||M[0]&1&&n!==(n=tf(t[0],10)))&&It(r,"datetime",n),a&&ms(a.update)&&M[0]&524289&&a.update.call(null,t[19].format(t[0])),t[9]?S?S.p(t,M):(S=yce(t),S.c(),S.m(i,null)):S&&(S.d(1),S=null),(!y||M[0]&131072&&o!==(o=t[17].dayHead))&&It(i,"class",o),t[6]?T&&(So(),Qi(T,1,1,()=>{T=null}),Uo()):T?(T.p(t,M),M[0]&64&&mi(T,1)):(T=bce(t),T.c(),mi(T,1),T.m(c,null)),(!y||M[0]&131072&&u!==(u=t[17].bgEvents))&&It(c,"class",u),t[6]?D&&(So(),Qi(D,1,1,()=>{D=null}),Uo()):D?(D.p(t,M),M[0]&64&&mi(D,1)):(D=wce(t),D.c(),mi(D,1),D.m(e,p)),t[6]?C&&(So(),Qi(C,1,1,()=>{C=null}),Uo()):C?(C.p(t,M),M[0]&64&&mi(C,1)):(C=Tce(t),C.c(),mi(C,1),C.m(f,null)),(!y||M[0]&131072&&h!==(h=t[17].events))&&It(f,"class",h),t[8]?E?M[0]&256&&mi(E,1):(E=Ece(),E.c(),mi(E,1),E.m(e,A)):E&&(So(),Qi(E,1,1,()=>{E=null}),Uo()),!t[6]&&t[7].size?P?P.p(t,M):(P=Dce(t),P.c(),P.m(g,null)):P&&(P.d(1),P=null),(!y||M[0]&131072&&v!==(v=t[17].dayFoot))&&It(g,"class",v),(!y||M[0]&145473&&b!==(b=t[17].day+" "+t[17].weekdays?.[t[0].getUTCDay()]+(t[11]?" "+t[17].today:"")+(t[12]?" "+t[17].otherMonth:"")+(t[13]?" "+t[17].highlight:"")+(t[6]?" "+t[17].disabled:"")))&&It(e,"class",b)},i(R){y||(mi(T),mi(D),mi(C),mi(E),y=!0)},o(R){Qi(T),Qi(D),Qi(C),Qi(E),y=!1},d(R){R&&_r(e),S&&S.d(),T&&T.d(),D&&D.d(),C&&C.d(),E&&E.d(),P&&P.d(),t[50](null),I=!1,kd(w)}}}function $Ft(t,e,i){let r,n,a,s,o,l,c,u,d,p,f,h,m,A,{date:g}=e,{chunks:v}=e,{bgChunks:b}=e,{longChunks:y}=e,{iChunks:I=[]}=e,{dates:w}=e,{date:S,dayMaxEvents:T,highlightedDates:D,firstDay:C,moreLinkContent:E,theme:P,validRange:R,weekNumbers:M,weekNumberContent:N,_hiddenEvents:k,_intlDayCell:O,_popupDate:x,_popupChunks:F,_today:_,_interaction:V}=gp("state");tt(t,S,je=>i(46,p=je)),tt(t,D,je=>i(45,d=je)),tt(t,C,je=>i(39,n=je)),tt(t,E,je=>i(42,l=je)),tt(t,P,je=>i(17,h=je)),tt(t,R,je=>i(44,u=je)),tt(t,M,je=>i(40,a=je)),tt(t,N,je=>i(38,r=je)),tt(t,k,je=>i(43,c=je)),tt(t,O,je=>i(19,A=je)),tt(t,x,je=>i(41,o=je)),tt(t,F,je=>i(51,s=je)),tt(t,_,je=>i(47,f=je)),tt(t,V,je=>i(18,m=je));let G,z,Q,j,W,Y,X,J=new Set,ie="",ue,ne,ge,he=[];function Ie(){fn(x,o=g,o)}function xe(){let je=aA(hn(g)),Tt=z.concat(y[g.getTime()]?.chunks||[]);fn(F,s=Tt.map(Oe=>Xy({},Oe,Gz(Oe.event,g,je),{days:1,dates:[g]})).sort((Oe,mt)=>Oe.top-mt.top),s)}function Je(){X||g_e(he,z)}function qe(je){uV.call(this,t,je)}function dt(je,Tt){nA[je?"unshift":"push"](()=>{he[Tt]=je,i(16,he)})}function ft(je){nA[je?"unshift":"push"](()=>{G=je,i(4,G)})}return t.$$set=je=>{"date"in je&&i(0,g=je.date),"chunks"in je&&i(35,v=je.chunks),"bgChunks"in je&&i(36,b=je.bgChunks),"longChunks"in je&&i(1,y=je.longChunks),"iChunks"in je&&i(2,I=je.iChunks),"dates"in je&&i(3,w=je.dates)},t.$$.update=()=>{if(t.$$.dirty[0]&1|t.$$.dirty[1]&8192&&i(6,X=v_e(g,u)),t.$$.dirty[0]&225|t.$$.dirty[1]&48&&!X){i(5,z=[]),i(10,Q=b.filter(je=>qd(je.date,g))),J.clear(),i(7,J),i(6,X),i(36,b),i(0,g),i(35,v),i(5,z),i(44,u);for(let je of v)qd(je.date,g)&&z.push(je)}if(t.$$.dirty[0]&129&&fn(k,c[g.getTime()]=J,c),t.$$.dirty[0]&1|t.$$.dirty[1]&65536&&i(11,j=qd(g,f)),t.$$.dirty[0]&1|t.$$.dirty[1]&32768&&i(12,W=g.getUTCMonth()!==p.getUTCMonth()),t.$$.dirty[0]&1|t.$$.dirty[1]&16384&&i(13,Y=d.some(je=>qd(je,g))),t.$$.dirty[0]&192|t.$$.dirty[1]&6144&&!X&&c&&J.size){let je="+"+J.size+" more";l?i(14,ie=Ts(l)?l({num:J.size,text:je}):l):i(14,ie=je)}if(t.$$.dirty[0]&1|t.$$.dirty[1]&1024&&i(8,ue=o&&qd(g,o)),t.$$.dirty[0]&290&&ue&&y&&z&&VN().then(xe),t.$$.dirty[0]&81&&G&&h_e(G,()=>({allDay:!0,date:g,resource:void 0,dayEl:G,disabled:X})),t.$$.dirty[0]&513|t.$$.dirty[1]&896&&(i(9,ne=a&&g.getUTCDay()==(n?1:0)),ne)){let je=SOt(g,n);r?i(15,ge=Ts(r)?r({date:Sc(g),week:je}):r):i(15,ge="W"+String(je).padStart(2,"0"))}},[g,y,I,w,G,z,X,J,ue,ne,Q,j,W,Y,ie,ge,he,h,m,A,S,D,C,E,P,R,M,N,k,O,x,F,_,V,Ie,v,b,Je,r,n,a,o,l,c,u,d,p,f,qe,dt,ft]}class HFt extends Nu{constructor(e){super(),Mu(this,e,$Ft,LFt,Vc,{date:0,chunks:35,bgChunks:36,longChunks:1,iChunks:2,dates:3,reposition:37},null,[-1,-1])}get reposition(){return this.$$.ctx[37]}}function Pce(t,e,i){const r=t.slice();return r[28]=e[i],r[29]=e,r[30]=i,r}function Rce(t){let e,i=t[30],r;const n=()=>t[25](e,i),a=()=>t[25](null,i);let s={date:t[28],chunks:t[1],bgChunks:t[2],longChunks:t[3],iChunks:t[4],dates:t[0]};return e=new HFt({props:s}),n(),{c(){gs(e.$$.fragment)},m(o,l){Wa(e,o,l),r=!0},p(o,l){i!==o[30]&&(a(),i=o[30],n());const c={};l&1&&(c.date=o[28]),l&2&&(c.chunks=o[1]),l&4&&(c.bgChunks=o[2]),l&8&&(c.longChunks=o[3]),l&16&&(c.iChunks=o[4]),l&1&&(c.dates=o[0]),e.$set(c)},i(o){r||(mi(e.$$.fragment,o),r=!0)},o(o){Qi(e.$$.fragment,o),r=!1},d(o){a(),Ka(e,o)}}}function VFt(t){let e,i,r,n,a,s=Lo(t[0]),o=[];for(let c=0;c<s.length;c+=1)o[c]=Rce(Pce(t,s,c));const l=c=>Qi(o[c],1,1,()=>{o[c]=null});return{c(){e=zr("div");for(let c=0;c<o.length;c+=1)o[c].c();It(e,"class",i=t[6].days),It(e,"role","row")},m(c,u){Qr(c,e,u);for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(e,null);r=!0,n||(a=Gn(window,"resize",t[15]),n=!0)},p(c,[u]){if(u&63){s=Lo(c[0]);let d;for(d=0;d<s.length;d+=1){const p=Pce(c,s,d);o[d]?(o[d].p(p,u),mi(o[d],1)):(o[d]=Rce(p),o[d].c(),mi(o[d],1),o[d].m(e,null))}for(So(),d=s.length;d<o.length;d+=1)l(d);Uo()}(!r||u&64&&i!==(i=c[6].days))&&It(e,"class",i)},i(c){if(!r){for(let u=0;u<s.length;u+=1)mi(o[u]);r=!0}},o(c){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)Qi(o[u]);r=!1},d(c){c&&_r(e),_S(o,c),n=!1,a()}}}function GFt(t,e,i){let r,n,a,s,o,l,c,u,{dates:d}=e,{_events:p,_iEvents:f,_queue2:h,_hiddenEvents:m,resources:A,filterEventsWithResources:g,hiddenDays:v,theme:b,validRange:y}=gp("state");tt(t,p,N=>i(23,l=N)),tt(t,f,N=>i(20,a=N)),tt(t,m,N=>i(18,r=N)),tt(t,A,N=>i(21,s=N)),tt(t,g,N=>i(22,o=N)),tt(t,v,N=>i(19,n=N)),tt(t,b,N=>i(6,u=N)),tt(t,y,N=>i(24,c=N));let I,w,S,T=[],D,C,E=[],P={};function R(){DJ(()=>g_e(E,d),P,h)}function M(N,k){nA[N?"unshift":"push"](()=>{E[k]=N,i(5,E)})}return t.$$set=N=>{"dates"in N&&i(0,d=N.dates)},t.$$.update=()=>{if(t.$$.dirty&16777217&&(i(16,D=ice(d[0],c)),i(17,C=aA(hn(ice(d.at(-1),c))))),t.$$.dirty&15400966){i(1,I=[]),i(2,w=[]);for(let N of l)if(tce(N,D,C,o?s:void 0)){let k=Gz(N,D,C);E1(N.display)?N.allDay&&w.push(k):I.push(k)}ej(w,n),i(3,S=ej(I,n)),R()}t.$$.dirty&1769472&&i(4,T=a.map(N=>{let k;return N&&tce(N,D,C)?(k=Gz(N,D,C),ej([k],n)):k=null,k})),t.$$.dirty&262144&&r&&VN().then(R)},[d,I,w,S,T,E,u,p,f,m,A,g,v,b,y,R,D,C,r,n,a,s,o,l,c,M]}class QFt extends Nu{constructor(e){super(),Mu(this,e,GFt,VFt,Vc,{dates:0})}}function Mce(t,e,i){const r=t.slice();return r[15]=e[i],r}function Nce(t){let e,i;return e=new QFt({props:{dates:t[15]}}),{c(){gs(e.$$.fragment)},m(r,n){Wa(e,r,n),i=!0},p(r,n){const a={};n&1&&(a.dates=r[15]),e.$set(a)},i(r){i||(mi(e.$$.fragment,r),i=!0)},o(r){Qi(e.$$.fragment,r),i=!1},d(r){Ka(e,r)}}}function jFt(t){let e,i,r,n,a,s=Lo(t[0]),o=[];for(let c=0;c<s.length;c+=1)o[c]=Nce(Mce(t,s,c));const l=c=>Qi(o[c],1,1,()=>{o[c]=null});return{c(){e=zr("div"),i=zr("div");for(let c=0;c<o.length;c+=1)o[c].c();It(i,"class",r=t[2].content),It(e,"class",n=t[2].body+(t[1]===!0?" "+t[2].uniform:""))},m(c,u){Qr(c,e,u),En(e,i);for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(i,null);t[13](e),a=!0},p(c,[u]){if(u&1){s=Lo(c[0]);let d;for(d=0;d<s.length;d+=1){const p=Mce(c,s,d);o[d]?(o[d].p(p,u),mi(o[d],1)):(o[d]=Nce(p),o[d].c(),mi(o[d],1),o[d].m(i,null))}for(So(),d=s.length;d<o.length;d+=1)l(d);Uo()}(!a||u&4&&r!==(r=c[2].content))&&It(i,"class",r),(!a||u&6&&n!==(n=c[2].body+(c[1]===!0?" "+c[2].uniform:"")))&&It(e,"class",n)},i(c){if(!a){for(let u=0;u<s.length;u+=1)mi(o[u]);a=!0}},o(c){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)Qi(o[u]);a=!1},d(c){c&&_r(e),_S(o,c),t[13](null)}}}function zFt(t,e,i){let r,n,a,s,o,l,{_bodyEl:c,_viewDates:u,_hiddenEvents:d,dayMaxEvents:p,hiddenDays:f,theme:h}=gp("state");tt(t,c,v=>i(3,l=v)),tt(t,u,v=>i(11,r=v)),tt(t,d,v=>i(14,a=v)),tt(t,p,v=>i(1,n=v)),tt(t,f,v=>i(12,s=v)),tt(t,h,v=>i(2,o=v));let m,A;function g(v){nA[v?"unshift":"push"](()=>{l=v,c.set(l)})}return t.$$.update=()=>{if(t.$$.dirty&7171){i(0,m=[]),i(10,A=7-s.length),fn(d,a={},a);for(let v=0;v<r.length/A;++v){let b=[];for(let y=0;y<A;++y)b.push(r[v*A+y]);m.push(b)}}},[m,n,o,l,c,u,d,p,f,h,A,r,s,g]}class qFt extends Nu{constructor(e){super(),Mu(this,e,zFt,jFt,Vc,{})}}function WFt(t){let e,i,r,n;return e=new BFt({}),r=new qFt({}),{c(){gs(e.$$.fragment),i=hl(),gs(r.$$.fragment)},m(a,s){Wa(e,a,s),Qr(a,i,s),Wa(r,a,s),n=!0},p:As,i(a){n||(mi(e.$$.fragment,a),mi(r.$$.fragment,a),n=!0)},o(a){Qi(e.$$.fragment,a),Qi(r.$$.fragment,a),n=!1},d(a){a&&_r(i),Ka(e,a),Ka(r,a)}}}class KFt extends Nu{constructor(e){super(),Mu(this,e,null,WFt,Vc,{})}}var YFt={createOptions(t){t.dayMaxEvents=!1,t.dayCellFormat={day:"numeric"},t.dayPopoverFormat={month:"long",day:"numeric",year:"numeric"},t.moreLinkContent=void 0,t.buttonText.dayGridMonth="month",t.buttonText.close="Close",t.theme.uniform="ec-uniform",t.theme.dayFoot="ec-day-foot",t.theme.popup="ec-popup",t.theme.weekNumber="ec-week-number",t.view="dayGridMonth",t.weekNumbers=!1,t.weekNumberContent=void 0,t.views.dayGridMonth={buttonText:HOt,component:KFt,dayHeaderFormat:{weekday:"short"},dayHeaderAriaLabelFormat:{weekday:"long"},displayEventEnd:!1,duration:{months:1},theme:GOt("ec-day-grid ec-month-view"),titleFormat:{year:"numeric",month:"long"}}},createStores(t){t._days=RFt(t),t._intlDayCell=z0(t.locale,t.dayCellFormat),t._intlDayPopover=z0(t.locale,t.dayPopoverFormat),t._hiddenEvents=dl({}),t._popupDate=dl(null),t._popupChunks=dl([])}};let tj=!1;function XFt(t){tj||(tj=!0,window.requestAnimationFrame(()=>{t(),tj=!1}))}function Bce(t,e,i){return oI(e,xU(i,t))}const{window:Ev}=fOt;function ZFt(t){let e,i;return{c:As,m(r,n){e||(i=[Gn(Ev,"pointermove",t[37]),Gn(Ev,"pointerup",t[38]),Gn(Ev,"pointercancel",t[38]),Gn(Ev,"scroll",t[0]),Gn(Ev,"selectstart",wx(t[39])),Gn(Ev,"contextmenu",function(){ms(wx(t[47]))&&wx(t[47]).apply(this,arguments)}),Gn(Ev,"touchstart",t[40]),Gn(Ev,"touchmove",t[46],{passive:!1})],e=!0)},p(r,n){t=r},i:As,o:As,d(r){e=!1,kd(i)}}}const kce=1,xce=2,_ce=3,Oce=4,ij=5,Ik=6;function CD(t,e){return t.start=e.start,t.end=e.end,t.resourceIds=e.resourceIds,t}function Fce(t){return t.isPrimary&&(t.pointerType!=="mouse"||t.buttons&1)}function wx(t){return e=>{t()&&e.preventDefault()}}function JFt(t,e,i){let r,n,a,s,o,l,c,u,d,p,f,h,m,A,g,v,b,y,I,w,S,T,D,C,E,P,R,M,N,k,O,x,F,_,V,{_iEvents:G,_iClass:z,_events:Q,_view:j,_dayGrid:W,_draggable:Y,_bodyEl:X,datesAboveResources:J,dateClick:ie,dragConstraint:ue,dragScroll:ne,eventDragMinDistance:ge,eventDragStart:he,eventDragStop:Ie,eventDrop:xe,eventLongPressDelay:Je,eventResizeStart:qe,eventResizeStop:dt,eventResize:ft,longPressDelay:je,resizeConstraint:Tt,selectable:Oe,select:mt,selectBackgroundColor:Le,selectConstraint:lt,selectLongPressDelay:it,selectMinDistance:Fe,slotDuration:Xe,slotHeight:ct,slotWidth:We,unselect:ht,unselectAuto:xt,unselectCancel:pe,validRange:Se,view:ye}=gp("state");tt(t,G,et=>i(77,s=et)),tt(t,z,et=>i(82,d=et)),tt(t,Q,et=>i(76,a=et)),tt(t,j,et=>i(74,r=et)),tt(t,W,et=>i(79,l=et)),tt(t,Y,et=>i(108,V=et)),tt(t,X,et=>i(105,x=et)),tt(t,J,et=>i(104,O=et)),tt(t,ie,et=>i(83,p=et)),tt(t,ue,et=>i(94,S=et)),tt(t,ne,et=>i(93,w=et)),tt(t,ge,et=>i(99,P=et)),tt(t,he,et=>i(97,C=et)),tt(t,Ie,et=>i(86,m=et)),tt(t,xe,et=>i(84,f=et)),tt(t,Je,et=>i(102,N=et)),tt(t,qe,et=>i(98,E=et)),tt(t,dt,et=>i(87,A=et)),tt(t,ft,et=>i(85,h=et)),tt(t,je,et=>i(101,M=et)),tt(t,Tt,et=>i(96,D=et)),tt(t,Oe,et=>i(107,_=et)),tt(t,mt,et=>i(88,g=et)),tt(t,Le,et=>i(78,o=et)),tt(t,lt,et=>i(95,T=et)),tt(t,it,et=>i(103,k=et)),tt(t,Fe,et=>i(100,R=et)),tt(t,Xe,et=>i(106,F=et)),tt(t,ct,et=>i(92,I=et)),tt(t,We,et=>i(91,y=et)),tt(t,ht,et=>i(75,n=et)),tt(t,xt,et=>i(90,b=et)),tt(t,pe,et=>i(89,v=et)),tt(t,Se,et=>i(81,u=et)),tt(t,ye,et=>i(80,c=et));let ke,Ce,Ke,_e,wt,ut,Ct,Gi,Wt,Ji,$i,xi,en,ra,oc,un,dn,Ta,ti,pr,lc,xd,Ho,no,ao,Cn,Gc;function cc(et,Ai,_i,Oi,wn,Va){ke||(ke=Fce(Ai)?_i?_i[1]=="start"?_ce:xce:V(et)?kce:Ik:Ik,Hi()&&(Ke=et,xf(Ai),Oi&&(wt=Oi),wn&&(Cn=wn),ti=_i?_i[0]=="x"?"resizingX":"resizingY":"dragging",_i&&(bs()?(pr=hn(Ke.end),Ta?(Lz(pr,Ke.start),pr>=Ke.end&&Iw(pr)):(bx(pr,F),pr<Ke.start&&(pr=Ke.start),wt=Ke.start)):(pr=hn(Ke.start),Ta?(Lz(pr,Ke.end),pr<=Ke.start&&!Va&&aA(pr)):(Np(pr,F),pr>Ke.end&&(pr=Ke.end),wt=Ke.end,Va||(wt=bx(hn(wt),F)))),Va&&!Ta&&(Gc=F)),Ca(Ai)))}function Jh(et){ke||(ke=Fce(et)?_&&!Vz(c)?Oce:ij:Ik,Hi()&&(xf(et),ti="selecting",lc=Ta?Op({day:1}):F,Ke={allDay:Ta,start:wt,end:Np(hn(wt),lc),resourceIds:Ct?[Ct.id]:[]},Ca(et)))}function Qc(){ke||(ke=Ik)}function xf(et){window.getSelection().removeAllRanges(),Wt=$i=et.clientX,Ji=xi=et.clientY;let Ai=uT($i,xi);({allDay:Ta,date:wt,resource:Ct}=j0(Ai)($i,xi)),XQ(c)?en=oc=x:(en=SC(Ai,Ct?4:3),oc=SC(Ai,Ct&&(xn()||O)?2:1)),dc(),et.pointerType!=="mouse"&&i(1,no=setTimeout(()=>{ke&&(Ce=!0,Ca(et))},(Hs()?k:N)??M))}function Ca(et){if(Ce||et&&et.pointerType==="mouse"&&Xt()>=(Hs()?R:P)){Ce=!0,In(et),fn(z,d=ti,d),s[0]||(Hs()?pc():vp(et,Cl()?E:C));let Ai=uc(em());if(Ai){let _i;if({allDay:_i,date:ut,resource:Gi}=Ai,_i===Ta){let Oi=CD({},s[0]),wn=D;dn=Op((ut-wt)/1e3),bs()?(Oi.start=Np(hn(Ke.start),dn),Oi.start>pr&&(Oi.start=pr,dn=Op((pr-Ke.start)/1e3))):(Oi.end=Np(hn(Ke.end),dn),Gc&&Np(Oi.end,Gc),Cl()?Oi.end<pr&&(Oi.end=pr,dn=Op((pr-Ke.end)/1e3)):Hs()?(Oi.end<Ke.end?(Oi.start=bx(Oi.end,lc),Oi.end=Ke.end):Oi.start=Ke.start,wn=T):(Oi.start=Np(hn(Ke.start),dn),Ct&&(Oi.resourceIds=Ke.resourceIds.filter(Va=>Va!==Ct.id),Oi.resourceIds.push(Gi.id)),wn=S));do{if(wn!==void 0&&(Oi=CD(JQ(Ke),Oi),wn(Hs()?ku(Oi,et):jc(Oi,Ke,et))===!1)){fn(G,s[0]=CD(s[0],Ke),s);break}fn(G,s[0]=CD(s[0],Oi),s)}while(!1)}}}if(w){let Ai=I*2,_i=y;XFt(()=>{en&&(xi<Ai&&window.scrollBy(0,oI(-10,(xi-Ai)/3)),xi<ra.top+Ai&&(en.scrollTop+=oI(-10,(xi-ra.top-Ai)/3)),xi>window.innerHeight-Ai&&window.scrollBy(0,xU(10,(xi-window.innerHeight+Ai)/3)),xi>ra.bottom-Ai&&(en.scrollTop+=xU(10,(xi-ra.bottom+Ai)/3)),XQ(c)&&($i<ra.left+_i&&(en.scrollLeft+=oI(-10,($i-ra.left-_i)/3)),$i>ra.right-_i&&(en.scrollLeft+=xU(10,($i-ra.right+_i)/3))))})}}function Kn(){Hi()&&(dc(),Ca())}function al(et){Hi()&&et.isPrimary&&($i=et.clientX,xi=et.clientY,Ca(et))}function Tl(et){if(xd&&b&&!(v&&et.target.closest(v))&&In(et),ke&&et.isPrimary){if(Ce)if(Hs()){if(xd=!0,Ts(g)){let Ai=ku(s[0],et);g(Ai)}}else{Ke.display=_e;let Ai=Cl()?A:m;Ts(Ai)&&Ai({event:Wd(Ke),jsEvent:et,view:Gd(r)});let _i=JQ(Ke);if(Bu(Ke,s[0]),Ea(),Ai=Cl()?h:f,Ts(Ai)){let Oi=Ke,wn=jc(Ke,_i,et);Ai(Xy(wn,{revert(){Bu(Oi,_i)}}))}}else if((vo()||Hs())&&Ts(p)&&!Ho){$i=et.clientX,xi=et.clientY;let Ai=uT($i,xi);if(Ai){let{allDay:_i,date:Oi,resource:wn}=j0(Ai)($i,xi);p({allDay:_i,date:Sc(Oi),dateStr:tf(Oi),dayEl:Ai,jsEvent:et,view:Gd(r),resource:wn})}}Ce=!1,ke=Wt=Ji=$i=xi=Ke=_e=wt=ut=Ct=Gi=dn=Gc=Ta=fn(z,d=pr=lc=Cn=void 0,d),en=oc=ra=un=void 0,no&&(clearTimeout(no),i(1,no=void 0))}Ho=!1}function em(){return uT(Bce($i,ao[0],ao[1]),Bce(xi,ao[2],ao[3]))}function uc(et){if(et){let Ai=j0(et)($i,xi);if(Ai.disabled){if(!u.end||Ai.date<u.end)return uc(et.nextElementSibling);if(!u.start||Ai.date>u.start)return uc(et.previousElementSibling)}else return Ai}return null}function dc(){ra=my(en),un=my(oc),ao=[oI(0,un.left+(XQ(c)?1:l?0:8)),xU(document.documentElement.clientWidth,un.left+oc.clientWidth)-2,oI(0,ra.top),xU(document.documentElement.clientHeight,ra.top+en.clientHeight)-2]}function vp(et,Ai){Ts(Ai)&&Ai({event:Wd(Ke),jsEvent:et,view:Gd(r)}),_e=Ke.display,Ke.display="preview",fn(G,s[0]=JQ(Ke),s),Cn!==void 0&&fn(G,s[0]._margin=Cn,s),Gc&&Np(s[0].end,Gc),Ke.display="ghost",Q.set(a)}function pc(){fn(G,s[0]={id:"{select}",allDay:Ke.allDay,start:Ke.start,title:"",display:"preview",extendedProps:{},backgroundColor:o,resourceIds:Ke.resourceIds,classNames:[],styles:[]},s)}function Ea(){fn(G,s[0]=null,s)}function Bu(et,Ai){CD(et,Ai),Q.set(a)}function ku(et,Ai){let{start:_i,end:Oi}=Wd(et);return{start:_i,end:Oi,startStr:tf(et.start),endStr:tf(et.end),allDay:Ta,view:Gd(r),resource:Ct,jsEvent:Ai}}function jc(et,Ai,_i){let Oi;return Cl()?Oi=bs()?{startDelta:dn,endDelta:Op(0)}:{startDelta:Op(0),endDelta:dn}:Oi={delta:dn,oldResource:Ct!==Gi?Ct:void 0,newResource:Ct!==Gi?Gi:void 0},Xy(Oi,{event:Wd(et),oldEvent:Wd(Ai),view:Gd(r),jsEvent:_i}),Oi}function Xt(){return Math.sqrt(Math.pow($i-Wt,2)+Math.pow(xi-Ji,2))}function xn(){return ke===kce}function Cl(){return ke===xce||bs()}function bs(){return ke===_ce}function vo(){return ke===ij}function Hs(){return ke===Oce}function Hi(){return ke&&ke<ij}function In(et){xd&&(xd=!1,Ea(),Ts(n)&&n({jsEvent:et,view:Gd(r)}))}function sn(){Ho=!0}j.subscribe(In);function fc(et){if(Hi()){let Ai=et.target,_i=[],Oi=()=>p_e(_i);_i.push(Ix(Ai,"touchmove",wx(()=>Ce))),_i.push(Ix(Ai,"touchend",Oi)),_i.push(Ix(Ai,"touchcancel",Oi))}}function ls(et){uV.call(this,t,et)}return[Kn,no,G,z,Q,j,W,Y,X,J,ie,ue,ne,ge,he,Ie,xe,Je,qe,dt,ft,je,Tt,Oe,mt,Le,lt,it,Fe,Xe,ct,We,ht,xt,pe,Se,ye,al,Tl,Hi,fc,cc,Jh,Qc,In,sn,ls,()=>no]}class eLt extends Nu{constructor(e){super(),Mu(this,e,JFt,ZFt,Vc,{drag:41,select:42,noAction:43,handleScroll:0,unselect:44,noClick:45},null,[-1,-1,-1,-1,-1])}get drag(){return this.$$.ctx[41]}get select(){return this.$$.ctx[42]}get noAction(){return this.$$.ctx[43]}get handleScroll(){return this.$$.ctx[0]}get unselect(){return this.$$.ctx[44]}get noClick(){return this.$$.ctx[45]}}function tLt(t){let e,i;return{c:As,m(r,n){e||(i=[Gn(window,"pointermove",t[3]),Gn(window,"scroll",t[0])],e=!0)},p:As,i:As,o:As,d(r){e=!1,kd(i)}}}function iLt(t){return t.isPrimary&&t.pointerType==="mouse"}function rLt(t,e,i){let r,n,{_iEvents:a,slotDuration:s}=gp("state");tt(t,a,h=>i(4,r=h)),tt(t,s,h=>i(7,n=h));let o=0,l=0;function c(){let h=uT(o,l);if(h){let{allDay:m,date:A,resource:g,disabled:v}=j0(h)(o,l);if(!v){let b=m?2:1;r[b]||p(b),fn(a,r[b].start=A,r),fn(a,r[b].end=Np(hn(A),n),r),fn(a,r[b].resourceIds=g?[g.id]:[],r);return}}f()}function u(){c()}function d(h){iLt(h)&&(o=h.clientX,l=h.clientY,c())}function p(h){fn(a,r[h]={id:"{pointer}",title:"",display:"pointer",extendedProps:{},backgroundColor:"transparent",classNames:[],styles:[]},r)}function f(){r[1]&&fn(a,r[1]=null,r),r[2]&&fn(a,r[2]=null,r)}return t.$$.update=()=>{t.$$.dirty&16&&r[0]&&f()},[u,a,s,d,r]}class nLt extends Nu{constructor(e){super(),Mu(this,e,rLt,tLt,Vc,{handleScroll:0})}get handleScroll(){return this.$$.ctx[0]}}function Lce(t){let e,i,r,n;return{c(){e=zr("div"),It(e,"class",i=t[2].resizer+(t[0]?" "+t[2].start:""))},m(a,s){Qr(a,e,s),r||(n=Gn(e,"pointerdown",t[11]),r=!0)},p(a,s){s&5&&i!==(i=a[2].resizer+(a[0]?" "+a[2].start:""))&&It(e,"class",i)},d(a){a&&_r(e),r=!1,n()}}}function aLt(t){let e,i=t[1]&&Lce(t);return{c(){i&&i.c(),e=Ap()},m(r,n){i&&i.m(r,n),Qr(r,e,n)},p(r,[n]){r[1]?i?i.p(r,n):(i=Lce(r),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:As,o:As,d(r){r&&_r(e),i&&i.d(r)}}}function sLt(t,e,i){let r,n,a,s,{event:o}=e,{start:l=!1}=e,{theme:c,eventDurationEditable:u,eventResizableFromStart:d,editable:p}=gp("state");tt(t,c,m=>i(2,s=m)),tt(t,u,m=>i(9,n=m)),tt(t,d,m=>i(10,a=m)),tt(t,p,m=>i(8,r=m));let f;function h(m){uV.call(this,t,m)}return t.$$set=m=>{"event"in m&&i(7,o=m.event),"start"in m&&i(0,l=m.start)},t.$$.update=()=>{t.$$.dirty&1921&&i(1,f=!E1(o.display)&&!UC(o.display)&&(!l||a)&&((o.durationEditable??n)||(o.editable??r)))},[l,f,s,c,u,d,p,o,r,n,a,h]}class oLt extends Nu{constructor(e){super(),Mu(this,e,sLt,aLt,Vc,{event:7,start:0})}}function $ce(t){let e,i,r={};return e=new nLt({props:r}),t[16](e),{c(){gs(e.$$.fragment)},m(n,a){Wa(e,n,a),i=!0},p(n,a){const s={};e.$set(s)},i(n){i||(mi(e.$$.fragment,n),i=!0)},o(n){Qi(e.$$.fragment,n),i=!1},d(n){t[16](null),Ka(e,n)}}}function lLt(t){let e,i,r,n,a={};e=new eLt({props:a}),t[15](e);let s=t[1]&&$ce(t);return{c(){gs(e.$$.fragment),i=hl(),s&&s.c(),r=Ap()},m(o,l){Wa(e,o,l),Qr(o,i,l),s&&s.m(o,l),Qr(o,r,l),n=!0},p(o,[l]){const c={};e.$set(c),o[1]?s?(s.p(o,l),l&2&&mi(s,1)):(s=$ce(o),s.c(),mi(s,1),s.m(r.parentNode,r)):s&&(So(),Qi(s,1,1,()=>{s=null}),Uo())},i(o){n||(mi(e.$$.fragment,o),mi(s),n=!0)},o(o){Qi(e.$$.fragment,o),Qi(s),n=!1},d(o){o&&(_r(i),_r(r)),t[15](null),Ka(e,o),s&&s.d(o)}}}function cLt(t,e,i){let r,n,a,s,o,l,c,u,{theme:d,editable:p,eventStartEditable:f,pointer:h,_bodyEl:m,_interaction:A,_iClasses:g,_draggable:v}=gp("state");tt(t,d,w=>i(11,a=w)),tt(t,p,w=>i(13,l=w)),tt(t,f,w=>i(14,c=w)),tt(t,h,w=>i(1,u=w)),tt(t,m,w=>i(10,n=w)),tt(t,A,w=>i(0,r=w)),tt(t,g,w=>i(17,o=w)),tt(t,v,w=>i(12,s=w)),fn(A,r.resizer=oLt,r);function b(){for(let w of Object.values(r))w?.handleScroll?.()}function y(w){nA[w?"unshift":"push"](()=>{r.action=w,A.set(r)})}function I(w){nA[w?"unshift":"push"](()=>{r.pointer=w,A.set(r)})}return t.$$.update=()=>{t.$$.dirty&24576&&fn(v,s=w=>(w.startEditable??c)||(w.editable??l),s),t.$$.dirty&6144&&fn(g,o=(w,S)=>{let{display:T}=S;return UC(T)?[a[T]]:!E1(T)&&s(S)?[a.draggable]:[]},o),t.$$.dirty&1024&&n&&Ix(n,"scroll",b)},[r,u,d,p,f,h,m,A,g,v,n,a,s,l,c,y,I]}class uLt extends Nu{constructor(e){super(),Mu(this,e,cLt,lLt,Vc,{})}}var dLt={createOptions(t){t.dateClick=void 0,t.dragConstraint=void 0,t.dragScroll=!0,t.editable=!1,t.eventDragMinDistance=5,t.eventDragStart=void 0,t.eventDragStop=void 0,t.eventDrop=void 0,t.eventDurationEditable=!0,t.eventLongPressDelay=void 0,t.eventResizableFromStart=!1,t.eventResizeStart=void 0,t.eventResizeStop=void 0,t.eventResize=void 0,t.eventStartEditable=!0,t.longPressDelay=1e3,t.pointer=!1,t.resizeConstraint=void 0,t.select=void 0,t.selectBackgroundColor=void 0,t.selectConstraint=void 0,t.selectLongPressDelay=void 0,t.selectMinDistance=5,t.unselect=void 0,t.unselectAuto=!0,t.unselectCancel="",t.theme.draggable="ec-draggable",t.theme.ghost="ec-ghost",t.theme.preview="ec-preview",t.theme.pointer="ec-pointer",t.theme.resizer="ec-resizer",t.theme.start="ec-start",t.theme.dragging="ec-dragging",t.theme.resizingY="ec-resizing-y",t.theme.resizingX="ec-resizing-x",t.theme.selecting="ec-selecting"},createStores(t){t._draggable=dl(EOt),t._auxiliary.update(e=>[...e,uLt])}};let Sx;function pLt(){const e=gu()?.provider?.organisationId;if(e){const i=r=>{r?.calendar?rj(r.calendar):ou.findAllTournaments().then(rj)};ou.findProvider(e).then(i)}else ou.findAllTournaments().then(rj)}function rj(t){const e=document.getElementById(s2);if(Sx&&e&&fo(e),f_t(),!!e)return Sx=new PFt({target:e,props:{plugins:[YFt,dLt],options:{view:"dayGridMonth",height:"800px",headerToolbar:{start:"prev,next",center:"title",end:""},buttonText:i=>(i.resourceTimeGridWeek="resources",i),resources:[{id:1,title:"Resource A"},{id:2,title:"Resource B"}],scrollTime:"09:00:00",events:hLt(t),eventClick:fLt,eventMouseEnter:mLt,views:{},dayMaxEvents:!0,nowIndicator:!0,selectable:!0}}}),{...qR,calendar:Sx}}function fLt({event:t}){if(t.id){Sx.$destroy();const e=t.id;Ge.reset();const i=`/${js}/${e}`;ot.router.navigate(i)}}function hLt(t){const e=i=>i?.split("T")[0];return t.map(i=>({title:i.tournamentName,start:e(i.startDate),end:e(i.endDate),extendedProps:{tournamentId:i.tournamentId},resourceIds:[i.tournamentId],id:i.tournamentId,color:"#FE6B64"}))}function mLt({event:t,jsEvent:e}){Bg(e.target,{content:t.title,showOnCreate:!0,arrow:!0})}var ALt=/([:*])(\w+)/g,gLt="([^/]+)",vLt=/\*/g,yLt="?(?:.*)",bLt=/\/\?/g,ILt="/?([^/]+|)",wLt="(?:/^|^)",SLt="";function w_e(t){return t===void 0&&(t="/"),MJ()?location.pathname+location.search+location.hash:t}function ws(t){return t.replace(/\/+$/,"").replace(/^\/+/,"")}function WO(t){return typeof t=="string"}function ULt(t){return typeof t=="function"}function KO(t){return t&&t.indexOf("#")>=0&&t.split("#").pop()||""}function TLt(t,e){return e.length===0||!t?null:t.slice(1,t.length).reduce(function(i,r,n){return i===null&&(i={}),i[e[n]]=decodeURIComponent(r),i},null)}function YO(t){var e=ws(t).split(/\?(.*)?$/);return[ws(e[0]),e.slice(1).join("")]}function RJ(t){for(var e={},i=t.split("&"),r=0;r<i.length;r++){var n=i[r].split("=");if(n[0]!==""){var a=decodeURIComponent(n[0]);e[a]?(Array.isArray(e[a])||(e[a]=[e[a]]),e[a].push(decodeURIComponent(n[1]||""))):e[a]=decodeURIComponent(n[1]||"")}}return e}function S_e(t,e){var i=YO(ws(t.currentLocationPath)),r=i[0],n=i[1],a=n===""?null:RJ(n),s=[],o;if(WO(e.path)){if(o=wLt+ws(e.path).replace(ALt,function(d,p,f){return s.push(f),gLt}).replace(vLt,yLt).replace(bLt,ILt)+"$",ws(e.path)===""&&ws(r)==="")return{url:r,queryString:n,hashString:KO(t.to),route:e,data:null,params:a}}else o=e.path;var l=new RegExp(o,SLt),c=r.match(l);if(c){var u=WO(e.path)?TLt(c,s):c.groups?c.groups:c.slice(1);return{url:ws(r.replace(new RegExp("^"+t.instance.root),"")),queryString:n,hashString:KO(t.to),route:e,data:u,params:a}}return!1}function U_e(){return!!(typeof window<"u"&&window.history&&window.history.pushState)}function OS(t,e){return typeof t[e]>"u"||t[e]===!0}function CLt(t){if(!t)return{};var e=t.split(","),i={},r;return e.forEach(function(n){var a=n.split(":").map(function(s){return s.replace(/(^ +| +$)/g,"")});switch(a[0]){case"historyAPIMethod":i.historyAPIMethod=a[1];break;case"resolveOptionsStrategy":r||(r={}),r.strategy=a[1];break;case"resolveOptionsHash":r||(r={}),r.hash=a[1]==="true";break;case"updateBrowserURL":case"callHandler":case"updateState":case"force":i[a[0]]=a[1]==="true";break}}),r&&(i.resolveOptions=r),i}function MJ(){return typeof window<"u"}function ELt(t,e){return t===void 0&&(t=[]),e===void 0&&(e={}),t.filter(function(i){return i}).forEach(function(i){["before","after","already","leave"].forEach(function(r){i[r]&&(e[r]||(e[r]=[]),e[r].push(i[r]))})}),e}function Im(t,e,i){var r=e||{},n=0;(function a(){if(!t[n]){i&&i(r);return}Array.isArray(t[n])?(t.splice.apply(t,[n,1].concat(t[n][0](r)?t[n][1]:t[n][2])),a()):t[n](r,function(s){typeof s>"u"||s===!0?(n+=1,a()):i&&i(r)})})()}Im.if=function(t,e,i){return Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]),[t,e,i]};function Hce(t,e){typeof t.currentLocationPath>"u"&&(t.currentLocationPath=t.to=w_e(t.instance.root)),t.currentLocationPath=t.instance._checkForAHash(t.currentLocationPath),e()}function nj(t,e){for(var i=0;i<t.instance.routes.length;i++){var r=t.instance.routes[i],n=S_e(t,r);if(n&&(t.matches||(t.matches=[]),t.matches.push(n),t.resolveOptions.strategy==="ONE")){e();return}}e()}function DLt(t,e){t.navigateOptions&&(typeof t.navigateOptions.shouldResolve<"u"&&console.warn('"shouldResolve" is deprecated. Please check the documentation.'),typeof t.navigateOptions.silent<"u"&&console.warn('"silent" is deprecated. Please check the documentation.')),e()}function PLt(t,e){t.navigateOptions.force===!0?(t.instance._setCurrent([t.instance._pathToMatchObject(t.to)]),e(!1)):e()}var Vce=MJ(),RLt=U_e();function MLt(t,e){if(OS(t.navigateOptions,"updateBrowserURL")){var i=("/"+t.to).replace(/\/\//g,"/"),r=Vce&&t.resolveOptions&&t.resolveOptions.hash===!0;RLt?(history[t.navigateOptions.historyAPIMethod||"pushState"](t.navigateOptions.stateObj||{},t.navigateOptions.title||"",r?"#"+i:i),location&&location.hash&&(t.instance.__freezeListening=!0,setTimeout(function(){if(!r){var n=location.hash;location.hash="",location.hash=n}t.instance.__freezeListening=!1},1))):Vce&&(window.location.href=t.to)}e()}function T_e(t,e){var i=t.instance;if(!i.lastResolved()){e();return}Im(i.lastResolved().map(function(r){return function(n,a){if(!r.route.hooks||!r.route.hooks.leave){a();return}var s=!1,o=t.instance.matchLocation(r.route.path,t.currentLocationPath,!1);if(r.route.path!=="*")s=!o;else{var l=t.matches?t.matches.find(function(c){return r.route.path===c.route.path}):!1;s=!l}if(OS(t.navigateOptions,"callHooks")&&s){Im(r.route.hooks.leave.map(function(c){return function(u,d){return c(function(p){p===!1?t.instance.__markAsClean(t):d()},t.matches&&t.matches.length>0?t.matches.length===1?t.matches[0]:t.matches:void 0)}}).concat([function(){return a()}]));return}else a()}}),{},function(){return e()})}function NLt(t,e){t.match.route.hooks&&t.match.route.hooks.before&&OS(t.navigateOptions,"callHooks")?Im(t.match.route.hooks.before.map(function(i){return function(n,a){return i(function(s){s===!1?t.instance.__markAsClean(t):a()},t.match)}}).concat([function(){return e()}])):e()}function BLt(t,e){OS(t.navigateOptions,"callHandler")&&t.match.route.handler(t.match),t.instance.updatePageLinks(),e()}function kLt(t,e){t.match.route.hooks&&t.match.route.hooks.after&&OS(t.navigateOptions,"callHooks")&&t.match.route.hooks.after.forEach(function(i){return i(t.match)}),e()}function xLt(t,e){var i=t.instance.lastResolved();if(i&&i[0]&&i[0].route===t.match.route&&i[0].url===t.match.url&&i[0].queryString===t.match.queryString){i.forEach(function(r){r.route.hooks&&r.route.hooks.already&&OS(t.navigateOptions,"callHooks")&&r.route.hooks.already.forEach(function(n){return n(t.match)})}),e(!1);return}e()}function _Lt(t,e){var i=t.instance._notFoundRoute;if(i){t.notFoundHandled=!0;var r=YO(t.currentLocationPath),n=r[0],a=r[1],s=KO(t.to);i.path=ws(n);var o={url:i.path,queryString:a,hashString:s,data:null,route:i,params:a!==""?RJ(a):null};t.matches=[o],t.match=o}e()}function OLt(t,e){(!t.resolveOptions||t.resolveOptions.noMatchWarning===!1||typeof t.resolveOptions.noMatchWarning>"u")&&console.warn('Navigo: "'+t.currentLocationPath+`" didn't match any of the registered routes.`),e()}function FLt(t,e){t.instance._setCurrent(null),e()}function C_e(t,e){OS(t.navigateOptions,"updateState")&&t.instance._setCurrent(t.matches),e()}var E_e=[xLt,NLt,BLt,kLt],Gce=[T_e,_Lt,Im.if(function(t){var e=t.notFoundHandled;return e},E_e.concat([C_e]),[OLt,FLt])];function zz(){return zz=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},zz.apply(this,arguments)}function Qce(t,e){var i=0;function r(){if(i===t.matches.length){C_e(t,e);return}Im(E_e,zz({},t,{match:t.matches[i]}),function(){i+=1,r()})}T_e(t,r)}function aj(t){t.instance.__markAsClean(t)}function qz(){return qz=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},qz.apply(this,arguments)}var jce="[data-navigo]";function LLt(t,e){var i=e||{strategy:"ONE",hash:!1,noMatchWarning:!1,linksSelector:jce},r=this,n="/",a=null,s=[],o=!1,l,c=U_e(),u=MJ();t?n=ws(t):console.warn('Navigo requires a root path in its constructor. If not provided will use "/" as default.');function d(_){return _.indexOf("#")>=0&&(i.hash===!0?_=_.split("#")[1]||"/":_=_.split("#")[0]),_}function p(_){return ws(n+"/"+ws(_))}function f(_,V,G,z){return _=WO(_)?p(_):_,{name:z||ws(String(_)),path:_,handler:V,hooks:ELt(G)}}function h(_,V,G){var z=this;return typeof _=="object"&&!(_ instanceof RegExp)?(Object.keys(_).forEach(function(Q){if(typeof _[Q]=="function")z.on(Q,_[Q]);else{var j=_[Q],W=j.uses,Y=j.as,X=j.hooks;s.push(f(Q,W,[l,X],Y))}}),this):(typeof _=="function"&&(G=V,V=_,_=n),s.push(f(_,V,[l,G])),this)}function m(_,V){if(r.__dirty){r.__waiting.push(function(){return r.resolve(_,V)});return}else r.__dirty=!0;_=_?ws(n)+"/"+ws(_):void 0;var G={instance:r,to:_,currentLocationPath:_,navigateOptions:{},resolveOptions:qz({},i,V)};return Im([Hce,nj,Im.if(function(z){var Q=z.matches;return Q&&Q.length>0},Qce,Gce)],G,aj),G.matches?G.matches:!1}function A(_,V){if(r.__dirty){r.__waiting.push(function(){return r.navigate(_,V)});return}else r.__dirty=!0;_=ws(n)+"/"+ws(_);var G={instance:r,to:_,navigateOptions:V||{},resolveOptions:V&&V.resolveOptions?V.resolveOptions:i,currentLocationPath:d(_)};Im([DLt,PLt,nj,Im.if(function(z){var Q=z.matches;return Q&&Q.length>0},Qce,Gce),MLt,aj],G,aj)}function g(_,V,G){var z=E(_,V);return z!==null?(A(z.replace(new RegExp("^/?"+n),""),G),!0):!1}function v(_){return this.routes=s=s.filter(function(V){return WO(_)?ws(V.path)!==ws(_):ULt(_)?_!==V.handler:String(V.path)!==String(_)}),this}function b(){c&&(this.__popstateListener=function(){r.__freezeListening||m()},window.addEventListener("popstate",this.__popstateListener))}function y(){this.routes=s=[],c&&window.removeEventListener("popstate",this.__popstateListener),this.destroyed=o=!0}function I(_,V){return r._notFoundRoute=f("*",_,[l,V],"__NOT_FOUND__"),this}function w(){if(u)return S().forEach(function(_){if(_.getAttribute("data-navigo")==="false"||_.getAttribute("target")==="_blank"){_.hasListenerAttached&&_.removeEventListener("click",_.navigoHandler);return}_.hasListenerAttached||(_.hasListenerAttached=!0,_.navigoHandler=function(V){if((V.ctrlKey||V.metaKey)&&V.target.tagName.toLowerCase()==="a")return!1;var G=_.getAttribute("href");if(typeof G>"u"||G===null)return!1;if(G.match(/^(http|https)/)&&typeof URL<"u")try{var z=new URL(G);G=z.pathname+z.search}catch{}var Q=CLt(_.getAttribute("data-navigo-options"));o||(V.preventDefault(),V.stopPropagation(),r.navigate(ws(G),Q))},_.addEventListener("click",_.navigoHandler))}),r}function S(){return u?[].slice.call(document.querySelectorAll(i.linksSelector||jce)):[]}function T(_){return"/"+n+"/"+ws(_)}function D(_){return l=_,this}function C(){return a}function E(_,V,G){var z=s.find(function(W){return W.name===_}),Q=null;if(z){if(Q=z.path,V)for(var j in V)Q=Q.replace(":"+j,V[j]);Q=Q.match(/^\//)?Q:"/"+Q}return Q&&G&&!G.includeRoot&&(Q=Q.replace(new RegExp("^/"+n),"")),Q}function P(_){return _.getAttribute("href")}function R(_){var V=YO(ws(_)),G=V[0],z=V[1],Q=z===""?null:RJ(z),j=KO(_),W=f(G,function(){},[l],G);return{url:G,queryString:z,hashString:j,route:W,data:null,params:Q}}function M(){return R(ws(w_e(n)).replace(new RegExp("^"+n),""))}function N(_){var V={instance:r,currentLocationPath:_,to:_,resolveOptions:i};return nj(V,function(){}),V.matches?V.matches:!1}function k(_,V,G){typeof V<"u"&&(typeof G>"u"||G)&&(V=p(V));var z={instance:r,to:V,currentLocationPath:V};Hce(z,function(){}),typeof _=="string"&&(_=typeof G>"u"||G?p(_):_);var Q=S_e(z,{name:String(_),path:_,handler:function(){},hooks:{}});return Q||!1}function O(_,V,G){return typeof V=="string"&&(V=x(V)),V?(V.hooks[_]||(V.hooks[_]=[]),V.hooks[_].push(G),function(){V.hooks[_]=V.hooks[_].filter(function(z){return z!==G})}):(console.warn("Route doesn't exists: "+V),function(){})}function x(_){return typeof _=="string"?s.find(function(V){return V.name===p(_)}):s.find(function(V){return V.handler===_})}function F(_){_.instance.__dirty=!1,_.instance.__waiting.length>0&&_.instance.__waiting.shift()()}this.root=n,this.routes=s,this.destroyed=o,this.current=a,this.__freezeListening=!1,this.__waiting=[],this.__dirty=!1,this.__markAsClean=F,this.on=h,this.off=v,this.resolve=m,this.navigate=A,this.navigateByName=g,this.destroy=y,this.notFound=I,this.updatePageLinks=w,this.link=T,this.hooks=D,this.extractGETParameters=function(_){return YO(d(_))},this.lastResolved=C,this.generate=E,this.getLinkPath=P,this.match=N,this.matchLocation=k,this.getCurrentLocation=M,this.addBeforeHook=O.bind(this,"before"),this.addAfterHook=O.bind(this,"after"),this.addAlreadyHook=O.bind(this,"already"),this.addLeaveHook=O.bind(this,"leave"),this.getRoute=x,this._pathToMatchObject=R,this._clean=ws,this._checkForAHash=d,this._setCurrent=function(_){return a=r.current=_},b.call(this),w.call(this)}function $Lt(){const e=new LLt("/",{hash:!0});ot.router=e;const i=({selectedTab:r,renderDraw:n,data:a})=>{kH(),h_t({config:{selectedTab:r,renderDraw:n,...a}})};return e.on(`/${js}/:tournamentId`,r=>{i({data:r?.data})}),e.on(`/${js}/:tournamentId/overview`,r=>{i({data:r?.data,selectedTab:aE})}),e.on(`/${js}/:tournamentId/${Xb}/:eventId`,r=>{i({selectedTab:jf,data:r?.data})}),e.on(`/${js}/:tournamentId/${Xb}/:eventId/${DD}/:drawId`,r=>{i({selectedTab:jf,renderDraw:!0,data:r?.data})}),e.on(`/${js}/:tournamentId/${Xb}/:eventId/${DD}/:drawId/${s4}/:roundsView`,r=>{i({selectedTab:jf,renderDraw:!0,data:r?.data})}),e.on(`/${js}/:tournamentId/${Xb}/:eventId/${DD}/:drawId/${a4}/:structureId`,r=>{i({selectedTab:jf,renderDraw:!0,data:r?.data})}),e.on(`/${js}/:tournamentId/${Xb}/:eventId/${DD}/:drawId/${a4}/:structureId/${s4}/:roundsView`,r=>{i({selectedTab:jf,renderDraw:!0,data:r?.data})}),e.on(`/${js}/:tournamentId/${Xb}/:eventId/${ybe}/:drawId`,r=>{i({selectedTab:jf,data:r?.data})}),e.on(`/${js}/:tournamentId/${Vm}/:participantView`,r=>{i({selectedTab:Vm,data:r?.data})}),e.on(`/${js}/:tournamentId/${Ny}/:scheduledDate`,r=>{i({selectedTab:Ny,data:r?.data})}),e.on(`/${js}/:tournamentId/:selectedTab`,r=>{i({data:r?.data})}),e.on(`/${Uh}/:uuid`,qle),e.on(`/${Uh}`,qle),e.on(`/${bbe}/:inviteKey`,uOt),e.on("/calendar",pLt),e.on("/actionKey/:key",r=>{r?.data?.key,e.navigate("/"),qQ()}),e.on("/",()=>{qQ()}),e.notFound(()=>{e.navigate("/"),qQ()}),e.resolve(),{success:!0}}function HLt(){return new Promise((t,e)=>{zLt();const i=()=>{t()};GLt().then(i,e)})}const VLt=t=>(...e)=>VH()?t(...e):t(...e).catch(i=>console.log(i));function GLt(){return new Promise((t,e)=>{new Promise((r,n)=>VLt(ou.initDB)().then(()=>t(),QLt).then(r,n)).then(t,e)})}function QLt(){ot.modal.inform({message:'<h2>Database Upgraded</h2><div style="margin: 1em;">Please Close Browser and Re-launch</div>'})}function jLt(t){const e=n=>Object.keys(n).map(a=>n[a]).join(""),i=e(t);$t.messages.reduce((n,a)=>e(a)===i?!0:n,!1)||$t.messages.push(t)}function zLt(){ot.ee.addListener(Kmt,OMe),ot.ee.addListener("addMessage",jLt)}const qLt=""+new URL("dragmatch-Va2U120p.png",import.meta.url).href;function sj(){const t=FZ();t&&(t.activeScale&&($t.activeScale=t.activeScale),t.scoringApproach&&($t.scoringApproach=t.scoringApproach),t.saveLocal!==void 0&&($t.saveLocal=t.saveLocal),t.pdfPrinting!==void 0&&($t.pdfPrinting=t.pdfPrinting),t.minCourtGridRows!==void 0&&($t.schedule.minCourtGridRows=t.minCourtGridRows)),ZLt(),B_t(),KLt(),$qe(),Lle("login"),Lle("burger"),b_t("config"),Array.prototype.toSorted||(Array.prototype.toSorted=function(e){return this.slice().sort(e)}),ot.drawer=cOt(),HLt().then(WLt,e=>console.log({err:e}))}function WLt(){console.log("%c TMX ready","color: lightgreen"),zxe(),JLt();const t=document.getElementById(UP);t&&(t.onclick=()=>ot.router.navigate(`/${Uh}`)),$Lt(),oIt()}function KLt(){ot.dragMatch=new Image,ot.dragMatch.src=qLt,ot.ee=new N_t}const YLt="ResizeObserver loop limit exceeded",XLt="ResizeObserver loop completed with undelivered notifications.";function ZLt(){$t.device=t2t();const t=Ge.version(),e=hut();console.log(`%cversion: ${nZ}`,"color: lightblue"),console.log(`%cfactory: ${t}`,"color: lightblue"),console.log(`%ccourthive-components: ${e}`,"color: lightblue"),e2t()}function JLt(){const t=Qn.topicConstants;KU.setSubscriptions({subscriptions:{[t.MODIFY_MATCHUP]:e=>{const i=e.matchUp?.matchUpId;ot.matchUpsToBroadcast.push(i),$t.devNotes&&console.log("MODIFY_MATCHUP",e)}}})}function e2t(){window.addEventListener("error",t=>{if([YLt,XLt].includes(t.message)){const e=document.getElementById("webpack-dev-server-client-overlay-div"),i=document.getElementById("webpack-dev-server-client-overlay");i&&i.setAttribute("style","display: none"),e&&e.setAttribute("style","display: none")}})}function t2t(){const t=i2t();return{isStandalone:t&&"standalone"in t&&t.standalone,isIDevice:t&&/iphone|ipod|ipad/i.test(t.userAgent),isIpad:t&&/iPad/i.test(t.userAgent),isWindows:t&&/indows/i.test(t.userAgent),isMobile:t&&/Mobi/.test(t.userAgent)}}function i2t(){try{return navigator||window.navigator}catch(t){console.log(t);return}}if(window.attachEvent)window.attachEvent("onload",sj);else if(window.onload){const t=window.onload,e=i=>{t(i),sj()};window.onload=e}else window.onload=sj;Oqe();Lqe();export{ig as c,EH as g};
//# sourceMappingURL=index-7T9wuNhx.js.map
