(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();const _s=(function(){const t={},e={};let i="gbr";t.define=({ioc:r,idiom:a})=>{e[r]=a},t.set=r=>{if(!r)return i;if(e[r])return i=r,e[r]},t.options=()=>Object.keys(e),t.current=()=>e[i];function n(r){if(!r)return"";let a=e[i];const s=r.split(".");for(;s.length;){const o=s.shift();a=a?.[o]||""}return a}return t.tr=r=>{if(!r)return"";if(n(r))return n(r);let a=e.default;const s=r.split(".");for(;s.length;){const o=s.shift();a=a?.[o]||""}return a},t.obj=r=>r?e?.[i]?.[r]?e[i][r]:e.default[r]?e.default[r]:{}:"",e.default={open:"Open",zoom:"Zoom",addcourts:"Add Courts",login:"Login",logout:"Logout",passwd:"Password",lang:"Language",menu:"Menu",main:"Main Menu",local:"Local Data",save:"Save",side:"Side",bye:"BYE",select:"Select",selected:"Selectd",group:"GROUP",administrator:"Administrator",revoke:"Revoke",tour:"Tour",noresults:"No Results",delete:"Delete",continue:"Do you wish to continue?",notes:"Notes",social:"Social Media",stats:"Statistics",merge:"Merge",week:"Week",warn:"WARNING",add:"Add",remove:"Remove",ptz:"Penalties",replace:"Replace",dl:"Download",or:"or",arp:"All Ranking Points",rlp:"Points - Ranking Lists",trn:"Tournament",tnz:"Tournaments",enable:"Enable",disable:"Disable",rnd:"Round",dt:"Date",fmt:"Format",cat:"Category",cta:"Cat.",team:"Team",tmz:"Teams",rnk:"Rank",rnkz:"Rankings",rtg:"Rating",rtz:"Ratings",prnk:"Rank",trnk:"Rank",rl:"Rank List",rlo:"Rank Order",alpha:"Alphabetical",opnt:"Opponent",ply:"Player",pyr:"Players",sgi:"Sign-In",sgo:"Sign-Out",scr:"Score",pts:"Points",allmatches:"All Matches",allteams:"All Teams",mts:"Matches",emts:"Matches",ests:"Sets",egms:"Games",epts:"Points",mtc:"Match",drw:"Draw",drz:"Draws",ent:"Event",evt:"Events",sch:"Schedule",rename:"Rename",crt:"Courts",ct:"Court",on:"On",off:"Off",id:"ID",nm:"Name",fnm:"First Name",lnm:"Last Name",nnm:"Nickname",attr:"Attribute",bd:"Birthday",yr:"Year",byr:"Birth Year",tot:"Total",sgl:"Singles",dbl:"Doubles",pyo:"Playoff",adh:"Ad-Hoc",snr:"Senior",unk:"Unknown",dup:"Duplicate",stt:"Status",ord:"Order",clb:"Club",scl:"School",cty:"City",state:"State",cnt:"Country",kwn:"Known",ioc:"IOC",act:"Action",agd:"Assigned",igr:"Ignore",igd:"Ignored",edt:"Edit Player",idp:"Identify Player",dlp:"Delete Player",sbt:"Submit",ccl:"Cancel",clr:"Clear",und:"Undo",apt:"Accept",dss:"Dismiss",frm:"From",to:"To",h2h:"Head-to-Head",reg:"Registered",gdr:"Gender",dtp:"Draw Type",drp:"Draw Position",manual:"Manual Draw",adr:"Automated Draw",mdo:"Draw Order",phn:"Phone",view:"View",email:"Email",asn:"Association",start:"Start",end:"End",dates:"Dates",ref:"Referee",time:"Time",duration:"Duration",qualifier:"Qualifier",qualifiers:"Qualifiers",none:"None",keys:"Keys",pos:"Position",seeding:"Seeding",home:"Home",new:"New",inout:"In/Out",indoors:"Indoors",outdoors:"Outdoors",existing:"Existing",success:"Success",loading:"Loading",set:"Settings",version:"Version",messages:"Messages",support:"Support",datastorage:"Data Storage",releasenotes:"Release Notes",documentation:"Documentation",importexport:"Import / Export",newversion:"New Version Available",latitude:"Latitude",longitude:"Longitude",i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},settings:{help:"Help",pagesize:"Page Size",schedule:"Schedule",calendar:"Calendar",search:"Search",documentation:"Documentation Links",hoverhelp:"Hover Hints",diacritics:"Diacritics",lastfirst:"Last name, First name",organization:"Organization",general:"General",categories:"Categories",points:"Points",draws:"Draws",data:"Data",sheetdata:"Sheet Data",publishing:"Publishing",printing:"Printing",savepdfs:"Save PDF",opentabs:"Open in Browser Tabs",compresseddraws:"Compressed Draw Formats",teams:"Teams Displayed",countryflags:"Country Flags Displayed",requireconfirm:"Require Confirmation",publishonscore:"Publish when score entered",publishdrawcreation:"Publish as draw created",matchesbefore:"Matches Before Count",automatedbyes:"Automatic Bye Placement",llallrounds:"LL from All Qualifying Rounds",rrh2hpriority:"RR Head-to-Head priority",qualconsolation:"Qualifying Consolation",consolationalts:"Consolation Alternates",consolationseeds:"Consolation Seeding",gemseeding:"GEM Seeding",adhocelo:"Adhoc ELO Ratings",restrictseedplacement:"Restrict Seed Placement",separate_by_team:"Auto Separate Players by Team",separate_by_ioc:"Auto Separate Players by Country",separate_by_club:"Auto Separate Players by Club",separate_by_school:"Auto Separate Players by School",clear_separation:"Clear Auto Separation",courtdetail:"Court Details",matchtimes:"Match Times",matchdates:"Match Dates",firstday:"Week Starts Monday",time24:"24 Hour Clock",draworderscores:"Scores in Draw Order",schedulecompleted:"Schedule Completed Matches",courtidentifiers:"court identifiers"},round_names:{F:"Final",SF:"Semifinal",QF:"Quarterfinal"},search:{filterplayers:"Filter Players",players:"Search Players",tournaments:"Search Tournaments",clubs:"Search Clubs",approve:"Approve Player",add2team:"Add Team Player",lastfirst:"LAST First",firstlast:"First Last"},formats:{singles:"Singles",doubles:"Doubles",team:"Team"},scoring_format:{set:"Set",sets:"Sets",timedset:"Timed Set",timedsets:"Timed Sets",tiebreak:"Tiebreak",tiebreaks:"Tiebreaks",winby:"Win By",custom:"Custom",bestof:"Best of",tbat:"TB at",finalset:"Final Set",setsto:"Sets to",tbto:"TB to",superto:"To"},scoring:{label:"Scoring",retire:"Retire",default:"Default",walkover:"Walkover",supertiebreak:"Match Tiebreak",normal:"Normal",winloss_abbreviation:"W/L",cancelled:"Cancelled",abandoned:"Abandoned"},draws:{seedlimit:"Seed Limit",blockthreshold:"Block Threshold",generating:"Generating... Please be patient...",generateround:"Generate Round",deleteround:"Delete Round",adhoc:"Adhoc",gemseeding:"GEM Seeding",playerfilter:"Ratings Filter",compass:"Compass",north:"North",south:"South",east:"East",west:"West",northeast:"Northeast",northwest:"Northwest",southeast:"Southeast",southwest:"Southwest",feedin:"Feed-in",staggered:"Staggered",standard:"Standard",elective:"Elective",backdraw:"Backdraw",roundlimit:"Round Limit",structure:"Structure",skiprounds:"Skip Rounds",feedrounds:"Feed Rounds",sequential:"Sequential",brackets:"Brackets",bracketsize:"Bracket Size",roundrobin:"Round Robin",elimination:"Elimination",consolation:"Consolation",qualification:"Qualification",preround:"Pre-Round",incidentals:"Incidentals",remove:"Remove",changestatus:"Change Status",penalty:"Assess penalty",umpire:"Select Referee",matchumpire:"Match Referee",matchtime:"Match Time",starttime:"Start Time",endtime:"Finish Time",resttime:"Rest Time",duration:"Duration",timeheader:"Time Heading",maindraw:"Main Draw",unscheduled:"Unscheduled Matches",scheduled:"Scheduled Matches",completed:"Completed",unpublished:"Unpublished",publisheduptodate:"Up to Date",publishedoutofdate:"Out of Date",published:"Published",publish:"Publish",publishQ:"Publish Draw?",organizers:"Organizers",playerrep:"Representative",playerreps:"Representatives",substitutes:"Substitutes (LL/Alts)",allindraw:"all in draw",lastdirectaccept:"Last Direct Acceptance",clear:"Clear Draw",swap:"Swap Position",alternate:"Alternate",alternatepair:"Alternate Pair",alternateplayer:"Alternate Player",luckyloser:"Lucky Loser",first:"First",last:"Last",seedrange:"Seeds",modifyseeding:"Modify Seeding",playerrange:"All Players",unpublish:"Unpublish Draw",unpublishall:"Unpublish All Events"},print:{publishpdf:"Publish PDF",schedule:"Schedule",draw:"Print",signin:"Sign-In Sheet",ranklist:"Rank List",playerlist:"Player List",matchlist:"Print Match List",matchesbytime:"Matches by Time",pendingmatches:"Pending Matches",matchesbycourt:"Matches by Court",completedmatches:"Completed Matches"},teams:{code:"Code (3 letters)",name:"Name",share:"Share Team",rankings:"Team Rankings",members:"Members",matches:"Matches",winloss:"Won/Lost",newteam:"New Team",createnew:"Create New",submitkey:"Submit Key",nameorkey:"Team Name or Import Key",club:"Club",coaches:"Coaches",school:"School",ioc:"Country",abbreviation:"Abbreviation"},tournament:{organizer_email:"Organizer Email",organizer_phone:"Organizer Phone",judge_email:"Referee Email",judge_phone:"Referee Phone",sponsor:"Sponsor(s)",logo:"Tournament Logo",images:"Tournament Images"},tournaments:{type:"Type",standard:"Standard",dual:"Dual Matches",register:"Register",registration:"Registration Link",team:"Team Tournament",new:"New Tournament",add:"Add Tournament",id:"Tournament ID",loadbyid:"Load by ID",edit:"Edit",copy:"Copy",close:"Close",done:"Finish",import:"Import Record",removeall:"Remove All",addall:"Add All",destroyall:"Destroy All",key:"Authorization",noauth:"Not Authorized",unofficial:"Unofficial",auth:"Authorized",fetch:"Download",fetchtournament:"Download Tournament Record",convert:"Convert to TODS / Save",send:"Upload Tournament Record",export:"Export Tournament Record",renewlist:"Renew List",natlassoc:"National Association",tennisclub:"Tennis Club",received:"Received Tournament Record",existing:"Existing Tournament Record",publishtime:"Publish Time",replacelocal:"Replace Local Copy?",unpublish:"Unpublish Tournament?"},ddlb:{singles:"Singles Tournament Rank:",doubles:"Doubles Tournament Rank:",category:"Tournament Category:",draws:"Select Event:",direction:"Select Draw:"},phrases:{remember_me:"Remember Me",forgot_passwd:"Forgot Password",no_account:"No account? Sign Up",selectlanguage:"Select Language",setupcourts:"Set up your courts",courtsmsg:"Before you can schedule matches we need to know more about your courts. To get started, add some court details.",sortorder:"Sort Order",eventcorrupted:"Event is Corrupted: Development Notified",singlesrankings:"Singles Rankings",doublesrankings:"Doubles Rankings",sectionscroll:"Section Scrolling",dynamicrating:"Dynamic Rating",recalcdynamic:"Re-Calculate Dynamic Rating",comingsoon:"New Feature: Coming Soon!",finalrounds:"Final Rounds",sendplayerdb:"Send Player Database",prerelease:"Pre-release version of TMX",feedback:"Please send all feedback and support requests to",improperauth:"Improper Authorization Credentials",noexportformats:"No Export Formats Enabled",verifyranking:"Please Verify Player Ranking!",nomatches2schedule:"No Matches to Schedule!",addimage:"Enter full website address for an image",addgooglemap:'Enter full URL, not "Link to Share"',retrieveFromServer:"Retrieve from CourtHive Server?",mainmenu:"Main Menu",rankbyrating:"Rank by Rating",dblsrankisrating:"Use Rating as Doubles Ranking?",sheetdataurls:"Enter Google Sheet URLs for Synchronizing Data",playerimport:"Player Import",entersheeturl:"Enter Sheet URL",entergooglemapsurl:"Enter Google Maps link",invalidurl:"Invalid URL(s)",invalidsheeturl:"Invalid Sheet URL",invalidgooglemapsurl:"Invalid Google Maps Link",geolocationdenied:"Geolocation has been denied",unblockgeo:"Unblock in browser settings",usecurrentlocation:"Use your current position?",updatelatlng:"Update Latitude/Longitude?",cleardraw:"Existing Draw will be cleared!",clearselection:"Clear Selection",selectplayer:"Select Player",matches2clear:"Matches to be cleared from the schedule",changeapproved:"Changing Approved will reset the draw and clear the schedule.",qualincomplete:"Qualifying Draw is Incomplete",delegate:"Delegate",delegate2mobile:"Delegate to Mobile",revokedelegation:"Revoke Delegation",delegationrevoked:"Delegation has been revoked",qrcode:"QR Code",scanQRcode:"Scan QR Code with Mobile",ranklists:"Rank Lists for",reset:"Database will be reset",action:"Players requiring some action...",search:"Use the search field above to find players, or click player to edit",assign:"Assign this profile by clicking a player below, or ...",accept:"Accept all players",trnyz:"Loading Tournaments ...",loadplayers:"Load Players",badfile:"File Not Recognized",invalid:"Invalid file type",fileerror:"Error reading file",servererror:"Error Message from Server",notfound:"Not Found",pointcalc:"Point calculation requires tournament category and rank",drawcreated:"Draw Created",drawactive:"Active Draw",notcreated:"Not Created",importdata:"Import Data",exportdata:"Export Data",importtemplate:"Import Template",draganddrop:"Drag and Drop files into this zone",schedulematches:"Schedule Matches",notconfigured:"Not Configured",cannotsignout:"Cannot Sign Out",cannotchangerank:"Cannot Change Rank",cannotchangewinner:"Cannot Change Winner",matchmustbecomplete:"Match Must Be Complete!",approvedplayer:"Player Approved for an Event",locallycreated:"Locally Created Tournament",noremote:"No Remote Registrations to Update",calculateranking:"Calculate Ranking Points",generateranklist:"Generate Rank List",generatekey:"Generate Key",norankingdata:"No Ranking Data",oop_system:"Order of Play",schedulepublished:"Publishing Time:",timestamp:"Date/Time: ",rankedplayers:"Ranked Players",judgesignature:"Signature of Head Umpire:",nopointcalcs:"No Point Calculations for given date",downloadtemplate:"Download Import Template",add2database:"Add Players, Tournaments, Rankings to Database",noconnection:"No Connection",schedulepriority:"Match Scheduling Priority",send:"Send",sendTODS:"Send TODS Tournament Record",export:"Export",pointsvalidfrom:"Points Valid From",linkcopied:"Link Copied to Clipboard",keycopied:"Key Copied to Clipboard",submitkey:"Enter New Key",selectkey:"Select Key",deletereplace:"Delete / Replace",weblink:"Web Link",nomatches:"No Matches",updatedioc:"Update Language File",revokeauth:"Revoke Authorization?",clearalldays:"Clear All Days?",cantdelqual:"Cannot Delete: Qualified Player Active in Main Draw",cantrefresh:"Offline: Cannot Refresh",blocked:"Pop-Up Windows are blocked by your browser",enablepopups:"Please enable Pop-Ups for PDF printing",nopersist:"Data Persistence not guaranteed"},events:{name:"Name",newevent:"New Event",customname:"Custom Name",enableeligibility:"Enable Eligibility Filter",disableeligibility:"Disable Eligibility Filter",teamevent:"Team Event",opponents:"Opponents",matchprofile:"Match Profile",teams:"Teams",draw_type:"Draw Type",draw_size:"Draw Size",created:"Created",category:"Category",rank:"Rank",surface:"Surface",approveteam:"Approve",destroyteam:"Destroy",entered:"Entered",approved:"Approved",eligible:"Eligible",ineligible:"Ineligible",unavailable:"Unavailable",wildcard:"Wildcard",received:"Received Event(s)",toggle:"Toggle Publish State?",modifyranking:"Modify Ranking"},locations:{newlocation:"New Location",abbreviation:"Abbreviation",name:"Name",address:"Address",courts:"Courts",identifiers:"Court IDs"},genders:{male:"Male",male_abbr:"M",female:"Female",female_abbr:"W",mixed:"Mixed"},surfaces:{clay:"Clay",hard:"Hard",grass:"Grass",carpet:"Carpet"},actions:{ok:"OK",actions:"Actions",add_event:"Add Event",save_event:"Save Event",save_team:"Save Team",save_location:"Save Location",done:"Done",cancel:"Cancel",refresh:"Refresh",remakedraw:"Remake Draw",delete_event:"Delete Event",delete_team:"Delete Team",delete_match:"Delete Match",add_player:"Add Player",add_team:"Add Team",create_team:"Create team",generate_team:"Generate Team",publish:"Publish",unpublish:"Unpublish",manage_players:"Manage Players",manage_teams:"Manage Teams",add_location:"Add Location",delete_location:"Delete Location",delete_tournament:"Delete tournament",edit_tournament:"Edit Tournament",copy_tournament:"Copy Tournament",createteambyattr:"Create team",add2localdb:"Add Players to Local Database",signoutunapproved:"Sign Out players not approved for Events"},requests:{syncClubs:"Synchronize Clubs",syncTournaments:"Synchronize Tournaments",syncPlayers:"Synchronize players"},signin:{tournament_date:"Start Date",organization:"Organization",place:"Location",id:"Tournament ID",rank:"Tournament Rank",judge:"Head Umpire",doc_name:"SIGN-IN SHEET",doc_subname:" ",signature:"Signature",registered:"Registered Players",notsignedin:"Not Signed In",signedin:"Signed In",withdrawn:"Withdrawn",medical:"Medical",registration:"Registration",medical_issues:"Medical Expired",create_new_player:"Create New",modifyrankings:"Modify Rankings",acceptrankings:"Accept Rankings",reglink:"Set Link"},schedule:{column:"Column",rows:"Schedule Rows",startrow:"Start Row",alldraws:"All Draws",allevents:"All Events",allrounds:"All Rounds",allcourts:"All Courts",alldual:"All Dual Matches",autoschedule:"Auto Schedule",highlightteam:"Highlight Team",limit:"Limit",clearschedule:"Clear Schedule",clearcompleted:"Clear Completed Matches",orderofplay:"ORDER OF PLAY",matchestime:"Matches => Time",notbefore:"Not Before",nb:"NB",followedby:"Followed By",afterrest:"After Rest",raindelay:"Rain Delay",tba:"TBA",nextavailable:"Next Available",called:"Called",oncourt:"On Court",warmingup:"Warming Up",suspended:"Suspended",abandoned:"Abandoned",clear:"Clear",publish:"Publish Schedule",view:"View Schedule",unpublish:"Unpublish Schedule",timing:"Timing",vs:"vs.",umpirenotes:"Umpire Notes",notice:"Schedule Notice",opponentname:"Opponent Name",scheduled:"Scheduled"},penalties:{fail2signout:"Failed to Sign Out",illegalcoaching:"Illegal Coaching",ballabuse:"Ball Abuse",racquetabuse:"Racquet Abuse",equipmentabuse:"Equipment Abuse",cursing:"Swearing",rudegestures:"Rude Gestures",foullanguage:"Foul Language",timeviolation:"Time Violation",latearrival:"Late Arrival",unsporting:"Unsporting Behavior"},datelocalization:"en-EN"},t})();function Mt(t){return typeof t=="function"}function HNe(t){return typeof t=="string"}function kp(t){return typeof t=="object"&&!Array.isArray(t)}function zNe(t,e=0){let i=e,n,r;const a=()=>{i-=new Date().getTime()-r.getTime(),window.clearTimeout(n)},s=()=>i=e,o=()=>{r=new Date,n=window.setTimeout(function(){i=e,t()},i)};return o(),{pause:a,resume:o,reset:s}}var qNe=Object.defineProperty,Fi=(t,e)=>{for(var i in e)qNe(t,i,{get:e[i],enumerable:!0})};function VU(){return"2.2.34"}var kO={};Fi(kO,{competitionGovernor:()=>Eq,drawsGovernor:()=>A3,entriesGovernor:()=>r5,eventGovernor:()=>o5,generationGovernor:()=>v5,matchUpFormatGovernor:()=>Im,matchUpGovernor:()=>I5,mocksGovernor:()=>AF,participantGovernor:()=>q5,policyGovernor:()=>P4,publishingGovernor:()=>$F,queryGovernor:()=>$R,reportGovernor:()=>Y5,scheduleGovernor:()=>K5,scoreGovernor:()=>Cy,tieFormatGovernor:()=>X5,tournamentGovernor:()=>t6,venueGovernor:()=>n6});var Eq={};Fi(Eq,{getLinkedTournamentIds:()=>iR,getTournamentIds:()=>eR,linkTournaments:()=>Ble,mutate:()=>Yae,query:()=>Gle,unlinkTournament:()=>jle,unlinkTournaments:()=>Vle});var Yae={};Fi(Yae,{linkTournaments:()=>Ble,unlinkTournament:()=>jle,unlinkTournaments:()=>Vle});var AI="SINGLES",Rn="SINGLES",jy="DOUBLES",Dn="DOUBLES",uu="TEAM",Hn="TEAM",Kae={SINGLES_MATCHUP:AI,SINGLES:Rn,DOUBLES_MATCHUP:jy,DOUBLES:Dn,TEAM_MATCHUP:uu,TEAM:Hn},Zae={[Rn]:[Rn,"S"],[Dn]:[Dn,"D"],[Hn]:[Hn,"T"],S:[Rn,"S"],D:[Dn,"D"],T:[Hn,"T"]};function ia(t,e){return(t??0)-(e??0)}function ri(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function $d(t){return isNaN(t)?!1:t&&(t&t-1)===0}function sX(t){if(!t.length)return;let e=[...t].sort(ia),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function WNe(t){if(!$d(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function Pq(t){return isNaN(t)?0:t%2&&t+1||t}function Cq(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function br(t){return!isNaN(parseFloat(t))}function Xae(t){let e=ri(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function jU(t){if(isNaN(t))return!1;for(;!$d(t);)t++;return t}function xu(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function yi(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function YNe(t=1,e=3,i=!0){let n=0;for(let r=0;r<e;r++)n+=Math.random()*(t/e);return i&&t>1?Math.round(n):n}function KNe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function Jae(t,e,i,n,r=2){let a=1-Math.random(),s=1-Math.random(),o=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*s);return o=o/10+.5,o>1||o<0?o=Jae(t,e,i):(o=Math.pow(o,i),o*=e-t,o+=t),n&&(o=KNe(o,n)),parseFloat(o.toFixed(r))}function ak(t,e=2){return parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function wi(t){return Array.isArray(t)?t?.filter((e,i,n)=>n.lastIndexOf(e)===i):[]}function ZNe(t){return Array.isArray(t)?t?.map(e=>e===null?void 0:e):t}function oo(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function DT(t){return yi(t)?t:1/0}function Rl(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function XNe(t){return Qae(Rl(t))}function Qae(t){return Object.keys(t).reduce((e,i)=>{let n=t[i];return e[n]?e[n].push(i):e[n]=[i],e},{})}function JNe(t,e,i){return i.indexOf(t)===e}function ese(t){return t.filter(JNe)}function Il(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function yl(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Dt(t,e){return Array.from({length:e-t},(i,n)=>n+t)}function Up(t,e){return e.reduce((i,n,r)=>(n===t&&i.push(r),i),[])}function Dr(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,n,r)=>r.indexOf(i)===n)}function oX(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function mo(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function QNe(t,e){return Array.isArray(e)&&e.reduce((i,n)=>(i[n]=1+i[n]||1,i),{})[t]||0}function eAe(t,e,i,n){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(n),...t.slice(e+i,t.length)):[]}function Aa(t,e){return Array.isArray(t)?t.reduce((i,n,r)=>{let a=Math.floor(r/e);return i[a]=[].concat(i[a]||[],n),i},[]):[]}function tse(t,[e,...i]){return t.length?[t.slice(0,e),...tse(t.slice(e),[...i,e])]:[]}function tAe(t){return t.reduce((e,i)=>{let n=e[e.length-1];return(!n||n[n.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function ise(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function nse(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function sG(t,e,i){return Array.isArray(t)?t.reduce((n,r,a)=>{let s=i?!!(Math.floor(a/e)%2):!1,o=a%e,l=s?e-1-o:o;return n[l]||(n[l]=[]),n[l].push(r),n},[]):[]}function iAe(t,e=1){if(!Array.isArray(t)||!t.every(yi))return[];let i=Math.min(...t,e),n=Math.max(...t);return Dt(i,n+1).filter(r=>!t.includes(r))}function Ao(t){return typeof t=="function"}function Xn(t){return typeof t=="string"}function Ki(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function nAe(t,e){if(!Ki(t)||!Ki(e))return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let r of i)if(t[r]!==e[r])return!1;return!0}function rse(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(Ki).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var rAe=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function oG(t,e){if(t===void 0)return null;if(!Ki(t)||t===null)return t;let i=Object.keys(t),n=r=>r===void 0?null:r;return Object.assign({},...i.map(r=>Array.isArray(t[r])?{[r]:e?t[r]:t[r].map(a=>oG(a))}:{[r]:e?n(t[r]):oG(t[r])}))}function lG(t){return Array.isArray(t)?t.length+t.map(lG).reduce((e,i)=>e+i,0):Ki(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>lG(t[e])).reduce((e,i)=>e+i,0):0}function aAe(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=lG(t),n=e.split("").reduce((r,a)=>r+a.charCodeAt(0),0);return[e.length,i,n].map(r=>r.toString(36)).join("")}function xO(t,e){return!Array.isArray(t)||!Xn(e)?!1:Dr(t,Zae[e]).length}var le={success:!0},ase="error",sse={SUCCESS:le,ERROR:ase};function ose({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let r of t){if(typeof r!="object")return i.push(`valueProfile is not type object: ${r}`),{errors:i};let{matchUpValue:a,collectionPosition:s}=r;if(typeof a!="number"||typeof s!="number"||s>e||s<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let n=t.map(r=>r.collectionPosition);return n.length!==wi(n).length?(i.push("collectionPositions are not unique"),{errors:i}):{...le}}var cT={};Fi(cT,{addNotice:()=>Ti,callListener:()=>tC,createInstanceState:()=>boe,cycleMutationStatus:()=>n3,deepCopyEnabled:()=>i3,deleteNotice:()=>s3,deleteNotices:()=>Xw,disableNotifications:()=>woe,enableNotifications:()=>r_,getDevContext:()=>du,getMethods:()=>r3,getNotices:()=>a3,getProvider:()=>yG,getTopics:()=>bu,getTournamentId:()=>Jw,getTournamentRecord:()=>o3,getTournamentRecords:()=>Iv,globalLog:()=>Eoe,handleCaughtError:()=>XO,hasTopic:()=>KO,removeTournamentRecord:()=>Doe,setDeepCopy:()=>eC,setDevContext:()=>QP,setGlobalLog:()=>Ioe,setGlobalMethods:()=>Soe,setGlobalSubscriptions:()=>VAe,setMethods:()=>Toe,setStateMethods:()=>Poe,setStateProvider:()=>$Ae,setSubscriptions:()=>jAe,setTournamentId:()=>iC,setTournamentRecord:()=>Uoe,setTournamentRecords:()=>ZO,timeKeeper:()=>BAe});var uG={message:"Chronological error; time violation.",code:"ANACHRONISM"},XP={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},lse={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},cG={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},fr={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},ot={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},F1={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},ET={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},_I={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},Ot={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},use={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},cu={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Ib={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},Rq={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},Mq={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},PT={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},cse={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},dse={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},sAe={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},Nq={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},$1={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},OO={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},oAe={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},GU={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},HU={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},Aq={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},LO={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},pse={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},B1={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Zd={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},hse={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},fse={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},mse={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},gse={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},vse={message:"Invalid action",code:"ERR_INVALID_ACTION"},dG={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},yse={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},bse={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},Ise={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},_q={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},wse={message:"Existing round",code:"ERR_EXISTING_ROUND"},lAe={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},yu={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},or={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},kq={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},wb={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},xq={message:"Missing MAIN structure",code:"ERR_MISSING_MAIN_STRUCTURE"},Sse={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Hh={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},qn={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},Wu={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},Tse={message:"Event exists",code:"ERR_EXISTING_EVENT"},Use={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},Dse={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},Oq={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},Ese={message:"Missing stage",code:"ERR_MISSING_STAGE"},Sb={message:"Invalid stage",code:"ERR_INVALID_STAGE"},Pse={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},Cse={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},Rse={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},pG={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},V1={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},i_={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},uAe={message:"Propagated exits downstream",code:"ERR_PROPAGATED_EXITS_DOWNSTREAM"},zU={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Rh={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},Lq={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},Fq={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},Mse={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},qU={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},eo={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},qw={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},Vs={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Vm={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},Oo={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},rl={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},$q={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},FO={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},cAe={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},Nse={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},Bq={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},Ase={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},Vq={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},dAe={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},j1={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},pAe={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},jq={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},hAe={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},$O={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},fAe={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},mAe={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},Ww={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Zt={message:"Missing value",code:"ERR_MISSING_VALUE"},_se={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},kse={message:"Missing date",code:"ERR_MISSING_DATE"},xse={message:"No valid dates",code:"ERR_NO_VALID_DATES"},sk={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},n_={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},Ose={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},ja={message:"Invalid Date",code:"ERR_INVALID_DATE"},Dc={message:"Invalid time",code:"ERR_INVALID_TIME"},Lse={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},hG={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},Fse={message:"Invalid score",code:"ERR_INVALID_SCORE"},BO={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},gAe={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},Gq={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},$se={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},VO={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},fG={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},jO={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Yw={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Bd={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Ul={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},Bse={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Vd={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},Vse={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},Kw={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},G1={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},la={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},jse={message:"Missing qualified participants",code:"ERR_MISSING_QUALIFIED_PARTICIPANTS"},Nr={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},Gse={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},vAe={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},Hse={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},yv={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},zse={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},qse={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},Wse={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},WU={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},GO={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},Hq={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},mG={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},Yse={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},yAe={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},bAe={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},Kse={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},Zse={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},gG={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},zq={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},qq={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},Xse={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},Wq={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},CT={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},Jse={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},YU={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},Qse={message:"Court exists",code:"ERR_EXISTING_COURT"},eoe={message:"Venue exists",code:"ERR_EXISTING_VENUE"},Zw={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},bv={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},toe={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},Yq={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},ioe={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},noe={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},IAe={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},Kq={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},roe={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},Zq={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},Xq={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},HO={message:"Missing context",code:"ERR_MISSING_CONTEXT"},aoe={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},aw={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},soe={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},KU={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},ooe={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},zO={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},loe={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},uoe={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},jm={message:"Invalid object",code:"ERR_INVALID_OBJECT"},cP={message:"Invalid gender",code:"ERR_INVALID_GENDER"},JP={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},Ee={message:"Invalid values",code:"ERR_INVALID_VALUES"},coe={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},Jq={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},doe={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},qO={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},Qq={message:"Value unchanged",code:"ABORT_UNCHANGED"},Ya={message:"Not found",code:"ERR_NOT_FOUND"},WO={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},poe={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},e3={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},hoe={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},foe={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},vG={message:"Existing stage",code:"ERR_EXISTING_STAGE"},t3={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},H1={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},moe={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},z1={message:"Scores present",code:"ERR_SCORES_PRESENT"},goe={ANACHRONISM:uG,CANNOT_CHANGE_WINNING_SIDE:jO,CANNOT_MODIFY_TIEFORMAT:Gq,CANNOT_MODIFY_PARTICIPANT_TYPE:$se,CANNOT_REMOVE_MAIN_STRUCTURE:lse,CANNOT_REMOVE_PARTICIPANTS:VO,CATEGORY_MISMATCH:fG,COURT_EXISTS:Qse,COURT_NOT_FOUND:YU,DRAW_DEFINITION_NOT_FOUND:cu,DRAW_ID_EXISTS:hse,DRAW_POSITION_ACTIVE:OO,DRAW_POSITION_ASSIGNED:PT,DRAW_POSITION_NOT_CLEARED:dse,DRAW_POSITION_NOT_FOUND:sAe,DRAW_SIZE_MISMATCH:pse,DUPLICATE_ENTRY:XP,DUPLICATE_VALUE:coe,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:Zse,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:Kse,EVENT_EXISTS:Tse,EVENT_NOT_FOUND:Wu,EXISTING_DRAW_DEFINITIONS:use,EXISTING_END_TIME:Yq,EXISTING_FLIGHT:poe,EXISTING_MATCHUP_ID:foe,EXISTING_OUTCOME:hoe,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:WU,EXISTING_PARTICIPANT:GO,EXISTING_POLICY_TYPE:Vq,EXISTING_PROFILE:e3,EXISTING_ROUND:wse,EXISTING_STAGE:vG,EXISTING_STRUCTURE:t3,INCOMPATIBLE_MATCHUP_STATUS:i_,INCOMPLETE_SOURCE_STRUCTURE:Rq,INSUFFICIENT_DRAW_POSITIONS:qq,INVALID_ACTION:vse,INVALID_ASSIGNMENT:dG,INVALID_BOOKINGS:sk,INVALID_CATEGORY:JP,INVALID_COLLECTION_DEFINITION:uoe,INVALID_CONFIGURATION:loe,INVALID_DATE_AVAILABILITY:n_,INVALID_DATE:ja,INVALID_DRAW_DEFINITION:_I,INVALID_DRAW_POSITION_FOR_SEEDING:Mq,INVALID_DRAW_POSITION:GU,INVALID_DRAW_SIZE:LO,INVALID_END_TIME:toe,INVALID_ENTRIES:Dse,INVALID_EVENT_TYPE:Hh,INVALID_GAME_SCORES:hG,INVALID_GENDER:cP,INVALID_MATCHUP_FORMAT:Lq,INVALID_MATCHUP_STATUS:zU,INVALID_MATCHUP_STATUS_BYE:Rse,INVALID_MATCHUP:rl,INVALID_OBJECT:jm,INVALID_PARTICIPANT_ID:Bd,INVALID_PARTICIPANT_IDS:Ul,INVALID_PARTICIPANT_ROLE:Bse,INVALID_PARTICIPANT_SEEDING:fse,INVALID_PARTICIPANT_TYPE:Vd,INVALID_PARTICIPANT:Yw,INVALID_POLICY_DEFINITION:Ase,INVALID_RECORDS:cG,INVALID_SCALE_ITEM:aw,INVALID_SEED_NUMBER:bse,INVALID_SEED_POSITION:Ise,INVALID_SET_NUMBER:hAe,INVALID_SIDE_NUMBER:jq,INVALID_SCORE:Fse,INVALID_STAGE:Sb,INVALID_START_TIME:noe,INVALID_STRUCTURE:Ib,INVALID_STOP_TIME:ioe,INVALID_TIE_FORMAT:Rh,INVALID_TIME:Dc,INVALID_TIME_ITEM:Kq,INVALID_TOURNAMENT_DATES:Lse,INVALID_TOURNAMENT_RECORD:F1,INVALID_VALUES:Ee,INVALID_WINNING_SIDE:BO,MATCHUP_NOT_FOUND:Vs,METHOD_NOT_FOUND:H1,MISSING_ASSIGNMENTS:Oq,MISSING_ASYNC_STATE_PROVIDER:roe,MISSING_AVOIDANCE_POLICY:Nse,MISSING_BIRTH_DATE:_se,MISSING_COLLECTION_DEFINITION:Mse,MISSING_COURT_ID:Ww,MISSING_COURTS_INFO:Jse,MISSING_DATE_AVAILABILITY:Ose,MISSING_DATE:kse,MISSING_DRAW_DEFINITION:Ot,MISSING_DRAW_ID:Zd,MISSING_DRAW_POSITION:HU,MISSING_DRAW_POSITIONS:$1,MISSING_DRAW_SIZE:B1,MISSING_ENTRIES:Use,MISSING_EVENT:qn,MISSING_QUALIFIED_PARTICIPANTS:jse,MISSING_MATCHUP_FORMAT:Fq,MISSING_MATCHUP_ID:eo,MISSING_MATCHUP_IDS:qw,MISSING_MATCHUP:Oo,MISSING_MATCHUPS:Vm,MISSING_PARTICIPANT_COUNT:zse,MISSING_PARTICIPANT_ID:la,MISSING_PARTICIPANT_IDS:yv,MISSING_PARTICIPANT_ROLE:Vse,MISSING_PARTICIPANT:Kw,MISSING_PARTICIPANTS:G1,MISSING_PENALTY_ID:Wq,MISSING_PENALTY_TYPE:Xse,MISSING_PERSON_DETAILS:Wse,MISSING_POLICY_ATTRIBUTES:Bq,MISSING_POLICY_DEFINITION:FO,MISSING_POLICY_TYPE:$q,MISSING_POSITION_ASSIGNMENTS:Cse,MISSING_ROUND_NUMBER:lAe,MISSING_SCHEDULE:aoe,MISSING_SCORING_POLICY:pAe,MISSING_SEED_ASSIGNMENTS:yse,MISSING_SEEDCOUNT_THRESHOLDS:gse,MISSING_SEEDING_POLICY:cAe,MISSING_SET_NUMBER:fAe,MISSING_SET_OBJECT:$O,MISSING_SIDE_NUMBER:mAe,MISSING_STAGE:Ese,MISSING_STRUCTURE_ID:yu,MISSING_STRUCTURE:wb,MISSING_MAIN_STRUCTURE:xq,MISSING_STRUCTURES:kq,MISSING_TARGET_LINK:_q,MISSING_TIE_FORMAT:qU,MISSING_TIME_ITEM:Zq,MISSING_TIME_ITEMS:Xq,MISSING_TOURNAMENT_ID:ET,MISSING_TOURNAMENT_RECORD:ot,MISSING_TOURNAMENT_RECORDS:fr,MISSING_VALUE:Zt,MISSING_VENUE_ID:bv,MODIFICATIONS_FAILED:soe,NO_CANDIDATES:zO,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:zq,NO_MODIFICATIONS_APPLIED:KU,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:gG,NO_PARTICIPANT_REMOVED:Hse,NO_VALID_ACTIONS:doe,NO_VALID_ATTRIBUTES:qO,NO_VALID_DATES:xse,NOT_FOUND:Ya,NOT_IMPLEMENTED:WO,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:Hq,PARTICIPANT_ID_EXISTS:Gse,PARTICIPANT_NOT_CHECKED_IN:qse,PARTICIPANT_NOT_FOUND:Nr,PARTICIPANT_PAIR_EXISTS:vAe,PENALTY_NOT_FOUND:CT,POLICY_NOT_ATTACHED:dAe,POLICY_NOT_FOUND:j1,SCHEDULE_NOT_CLEARED:cse,SCHEDULED_MATCHUPS:moe,SCORES_PRESENT:z1,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:mse,STAGE_SEQUENCE_LIMIT:Pse,STRUCTURE_NOT_FOUND:or,TEAM_NOT_FOUND:Jq,UNABLE_TO_ASSIGN_COURT:ooe,UNLINKED_STRUCTURES:Sse,UNRECOGNIZED_DRAW_TYPE:Nq,UNRECOGNIZED_MATCHUP_FORMAT:V1,UNRECOGNIZED_MATCHUP_STATUS:pG,VALUE_UNCHANGED:Qq,VENUE_EXISTS:eoe},ar={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},voe={addNotice:AAe,callListener:LAe,cycleMutationStatus:NAe,deleteNotice:xAe,deleteNotices:kAe,disableNotifications:wAe,enableNotifications:SAe,getMethods:YO,getNotices:_Ae,getTopics:OAe,getTournamentId:yoe,getTournamentRecord:TAe,getTournamentRecords:UAe,removeTournamentRecord:CAe,setMethods:MAe,setSubscriptions:RAe,setTournamentId:EAe,setTournamentRecord:DAe,setTournamentRecords:PAe,handleCaughtError:FAe};function wAe(){ar.disableNotifications=!0}function SAe(){ar.disableNotifications=!1}function yoe(){return ar.tournamentId}function TAe(t){return ar.tournamentRecords[t]}function UAe(){return ar.tournamentRecords}function DAe(t){let e=t?.tournamentId;return e?(ar.tournamentRecords[e]=t,{success:!0}):{error:F1}}function EAe(t){return t?ar.tournamentRecords[t]?(ar.tournamentId=t,{success:!0}):{error:ot}:(ar.tournamentId=void 0,{success:!0})}function PAe(t){ar.tournamentRecords=t;let e=Object.keys(t);e.length===1?ar.tournamentId=e[0]:e.length||(ar.tournamentId=void 0)}function CAe(t){if(typeof t!="string")return{error:Ee};if(!ar.tournamentRecords[t])return{error:Ya};delete ar.tournamentRecords[t];let e=Object.keys(ar.tournamentRecords);return e.length===1?ar.tournamentId=e[0]:e.length||(ar.tournamentId=void 0),{success:!0}}function RAe(t){return typeof t.subscriptions!="object"?{error:Ee}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?ar.subscriptions[e]=t.subscriptions[e]:delete ar.subscriptions[e]}),{...le})}function MAe(t){return typeof t!="object"?{error:Ee}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(ar.methods[e]=t[e])}),{...le})}function NAe(){let t=ar.modified;return ar.modified=!1,t}function AAe({topic:t,payload:e,key:i},n){if(!(typeof t!="string"||typeof e!="object")&&(ar.disableNotifications||(ar.modified=!0),!(ar.disableNotifications||!ar.subscriptions[t]&&!n)))return i&&(ar.notices=ar.notices.filter(r=>!(r.topic===t&&r.key===i))),ar.notices.push({topic:t,payload:e,key:i}),{...le}}function YO(){return ar.methods??{}}function _Ae({topic:t}){return ar.notices.filter(e=>e.topic===t).map(e=>e.payload)}function kAe(){ar.notices=[]}function xAe({topic:t,key:e}){ar.notices=ar.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function OAe(){return{topics:Object.keys(ar.subscriptions)}}function LAe({topic:t,notices:e},i){let n=ar.subscriptions[t];n&&typeof n=="function"&&n(e);let r=i?.[t];r&&typeof r=="function"&&r(e)}function FAe({engineName:t,methodName:e,params:i,err:n}){let r;return typeof n=="string"?r=n.toUpperCase():n instanceof Error&&(r=n.message),console.log("ERROR",{tournamentId:yoe(),params:JSON.stringify(i),engine:t,methodName:e,error:r}),{error:r}}var kn={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Ka=voe,lX=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function $Ae(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Dr(Object.keys(t),lX).length!==lX.length)throw new Error("Global state provider is missing required methods");return Ka=t,{success:!0}}function boe(){if(Ka.createInstanceState){try{Ka.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:roe}}function du(t){return!t||typeof t!="object"?kn.devContext??!1:typeof kn.devContext!="object"?!1:Object.keys(t).every(e=>kn.devContext?.[e]===t[e])&&kn.devContext}function BAe(t="reset",e="default"){let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(kn.timers).filter(n=>n!=="default"||kn.timers[n].startTime).map(n=>{let r=kn.timers[n],a=r.state==="stopped"?0:(i-(r?.startTime??0))/1e3,s=r.elapsedTime+a;return{state:kn.timers[n].state,elapsedTime:s.toFixed(2),timer:n}});{let n=kn.timers[e].state==="stopped"?0:(i-(kn.timers[e]?.startTime??0))/1e3,r=kn.timers[e].elapsedTime+n;return{state:kn.timers[e].state,elapsedTime:r.toFixed(2),timer:e}}}if(!kn.timers[e]||t==="reset"){if(e==="allTimers")return kn.timers={default:{elapsedTime:0}},!0;kn.timers[e]={startTime:i,state:"active",elapsedTime:0}}return kn.timers[e].elapsedTime||(kn.timers[e].elapsedTime=0),t==="stop"&&kn.timers[e].state!=="stopped"&&(kn.timers[e].state="stopped")&&(kn.timers[e].elapsedTime+=(i-(kn.timers[e]?.startTime??0))/1e3),t==="start"&&(kn.timers[e].startTime=i)&&(kn.timers[e].state="active"),kn.timers[e]}function Ioe(t){Ao(t)?kn.globalLog=t:delete kn.globalLog}function QP(t){kn.devContext=t}function woe(){Ka.disableNotifications()}function r_(){Ka.enableNotifications()}function eC(t,e){typeof t=="boolean"&&(kn.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(kn.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(kn.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(kn.deepCopyAttributes.stringify=e.stringify),e.threshold&&(kn.deepCopyAttributes.threshold=e.threshold))}function i3(){return{enabled:kn.deepCopy,...kn.deepCopyAttributes}}function VAe(t){return t?.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{kn.globalSubscriptions[e]=t.subscriptions[e]}),{...le}):{error:Zt,info:"missing subscriptions"}}function jAe(t){return t?.subscriptions?Ka.setSubscriptions({subscriptions:t.subscriptions}):{error:Zt,info:"missing subscriptions"}}function Soe(t){return t?typeof t!="object"?{error:Ee}:(Object.keys(t).forEach(e=>{Ao(t[e])&&(kn.globalMethods[e]=t[e])}),{...le}):{error:Zt,info:"missing method declarations"}}function Toe(t){return t?typeof t!="object"?{error:Ee}:Ka.setMethods(t):{error:Zt,info:"missing method declarations"}}function n3(){return Ka.cycleMutationStatus()}function Ti(t){if(typeof t?.topic!="string")return;let e=kn.globalSubscriptions[t.topic];return Ka.addNotice(t,e)}function r3(){return{...kn.globalMethods,...Ka.getMethods()}}function a3(t){return Ka.getNotices(t)}function s3({key:t,topic:e}){return Ka.deleteNotice({key:t,topic:e})}function Xw(){return Ka.deleteNotices()}function bu(){return Ka.getTopics()}function KO(t){return bu()?.topics?.includes(t)}async function tC(t){return Ka.callListener(t,kn.globalSubscriptions)}function Jw(){return Ka.getTournamentId()}function o3(t){return Ka.getTournamentRecord(t)}function Iv(){return Ka.getTournamentRecords()}function Uoe(t){return Ka.setTournamentRecord(t)}function ZO(t){return Ka.setTournamentRecords(t)}function iC(t){return Ka.setTournamentId(t)}function Doe(t){return Ka.removeTournamentRecord(t)}function yG(){return Ka}function XO({engineName:t,methodName:e,params:i,err:n}){let r=Ao(Ka.handleCaughtError)&&Ka.handleCaughtError||voe.handleCaughtError,{tournamentRecord:a,...s}=i;return r({params:s,engineName:t,methodName:e,err:n})}function Eoe(t,e){if(kn.globalLog)try{kn.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),Ioe()}else console.log(e,t)}function Poe(t,e,i,n){if(!Ki(t))return{error:Ee};br||(i=1);let r=Array.isArray(e)?e:[],a={},s=(o,l=0)=>{Object.keys(o).forEach(u=>{Ao(o[u])?a[u]=o[u]:Ki(o[u])&&(e===!0||r?.includes(u))&&(i===void 0||l<i)&&s(o[u],l+1)})};return s(t),n?Soe(a):Toe(a),{methods:a}}function GAe(t,e,i){return Object.keys(t).filter(n=>!e.includes(t[n])&&(!i||(Array.isArray(t[n])?t[n].length:!0)))}function Vt(t,e,i,n){if(typeof t!="object"||t===null)return t;i3()?.enabled||(n=!0);let r=["",void 0,null];e&&r.push(!1);let a=GAe(t,r,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:n?t[s]:t[s].map(o=>Vt(o))}:{[s]:n?t[s]:Vt(t[s])}))}function ce({context:t,result:e,stack:i,info:n}){return e&&!Array.isArray(e?.stack)&&(e.stack=[]),e&&Array.isArray(e?.stack)&&typeof i=="string"&&e.stack.push(i),e&&n&&(e.info=n),e&&typeof t=="object"&&Object.keys(t).length&&(e.context||(e.context={}),Object.assign(e.context,Vt(t))),e&&!e?.error&&!e?.success&&Object.assign(e,{...le}),e??{success:!0}}var ms="FEMALE",Hf="OTHER",Qw="MIXED",ta="MALE",eh={FEMALE_ABBR:"F",OTHER_ABBR:"O",MIXED_ABBR:"X",MALE_ABBR:"M",ANY_ABBR:"A",FEMALE:ms,MIXED:Qw,OTHER:Hf,MALE:ta,ANY:"ANY"};function yy(t){return[ms,"F"].includes(t)}function PI(t){return[ta,"M"].includes(t)}function su(t){return[Qw,"X"].includes(t)}function Mh(t){return["ANY","A"].includes(t)}function Ls(t){if(t){if(yy(t))return ms;if(su(t))return Qw;if(PI(t))return ta;if(Mh(t))return"ANY"}return Hf}function xp(t){return yy(t)||PI(t)}var HAe="MIXED events can not contain mixed singles or { gender: ANY } collections",zAe="events with { gender: ANY } can not contain MIXED singles collections";function JO(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:n,gender:r}=t;return i&&r&&xp(i)&&Ls(i)!==Ls(r)?ce({result:{valid:!1,error:cP},context:{gender:r},stack:e}):su(i)&&(Mh(r)||su(r)&&n!==Dn)?ce({result:{error:cP,valid:!1},info:HAe,stack:e}):Mh(i)&&su(r)&&n!==Dn?ce({result:{error:cP,valid:!1},info:zAe,stack:e}):{valid:!0}}var qAe="normal",uX="timed",WAe="final",l3="NOAD",YAe={S:qAe,F:WAe};function QO(t,e){if((t?.bestOf||t?.exactly)&&t?.setFormat)return KAe(t,e)}function nC(t){return!isNaN(Number(t))&&Number(t)}function Coe(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function KAe(t,e){let i=nC(t.bestOf)||void 0,n=nC(t.exactly)||void 0,r=i||n;if(t.setFormat?.timed&&t.simplified&&r===1)return Coe(t.setFormat);let a=r&&`SET${r}`||"",s=cX(t.setFormat,e),o=s&&`S:${s}`||"",l=cX(t.finalSetFormat,e),u=r&&r>1&&l&&s!==l&&`F:${l}`||"";if(a&&s)return[a,o,u].filter(c=>c).join("-")}function cX(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return Coe(t);if(t.tiebreakSet)return dX(t.tiebreakSet);let i=nC(t.setTo);if(i){let n=t.NoAD&&l3||"",r=dX(t.tiebreakFormat),a=r&&`/${r}`||"",s=nC(t.tiebreakAt),o=s&&(s!==i||e)&&`@${s}`||"";if(r!==!1)return`${i}${n}${a}${o}`}}}function dX(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&nC(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?l3:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function So(t){if(Xn(t)){let e=t.startsWith("T")&&uX||t.startsWith("SET")&&"SET"||"";if(e===uX){let i=Moe(t),n={simplified:!0,setFormat:i,bestOf:1};if(i)return n}if(e==="SET")return ZAe(t)}}function ZAe(t){let e=t.split("-"),i=q1(e[0].slice(3)),n=i===1||i%2!==0?i:void 0,r=i!==1&&i%2===0?i:void 0,a=e&&pX(e[1]),s=e&&pX(e[2]),o=a&&a.timed||s&&s.timed,l=n&&n<6||o&&r,u=!e[2]||s,c=a,d=Vt({setFormat:a,exactly:r,bestOf:n});if(s&&(d.finalSetFormat=s),l&&c&&u)return d}function pX(t){if(t?.[1]===":"){let e=t.split(":"),i=YAe[e[0]],n=e[1];if(i&&n){if(n.startsWith("TB")){let f=hX(n);return f===!1?!1:typeof f=="object"?{tiebreakSet:f}:void 0}if(n.startsWith("T"))return Moe(n);let r=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=r&&Noe(r[2])||!1,s=!r?.[2]||a,o=r?q1(r[1]):void 0,l=Roe(n),u=l!==!1,c=u&&l||o,d=hX(n.split("/")[1]),p=d!==!1,h={setTo:o};return a&&(h.NoAD=!0),d?(h.tiebreakFormat=d,h.tiebreakAt=c):h.noTiebreak=!0,o&&s&&p&&u&&h||!1}}}function Roe(t,e=!0){let i=t?.indexOf("@")>0&&t.split("@");if(i)return(e?q1(i[1]):i[1])||!1}function hX(t){if(t)if(t.startsWith("TB")){let e=Roe(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),n=i?.[1],r=i&&Noe(i[2]),a=!i?.[2]||r,s=q1(n);if(s&&a){let o={tiebreakTo:s};return e&&typeof e=="string"&&!yi(e)&&(o.modifier=e),r&&(o.NoAD=!0),o}else return!1}else return!1}function Moe(t){let e=t.slice(1),i=e.match(/^(\d+)(@?[A-Za-z]*)/),n=q1(i?.[1]);if(!n)return;let r={timed:!0,minutes:n},a=i?.[2],s=[void 0,"P","G"].includes(a);if(a&&!s){let o=e.match(/^(\d+)(@)([A-Za-z]+)$/)?.[3];return o?(r.modifier=o,r):void 0}return a&&(r.based=i[2]),r}function Noe(t){return t&&t.indexOf(l3)>=0}function q1(t){return isNaN(Number(t))?0:Number(t)}function Ml({matchUpFormat:t}){if(!Xn(t)||t==="")return!1;let e=So(t),i=t.match(/-S:([1-9])+\/TB(\d{1,2})@?([1-9]?)*/),n=i?.[1],r=i?.[2],a=i?.[3],s=t.match(/-F:([1-9])+\/TB(\d{1,2})@?([1-9]?)*/),o=s?.[1],l=s?.[2],u=s?.[3];return QO(e,!!(i&&r&&n===a||s&&l&&o===u))===t}var ok=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,Aoe=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,Op=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,by=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function lk(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Pi(t.scheduledTime)),!e)return;let i=Jn(t.scheduledTime),n=Pi(e);return n&&i&&(n+=`T${i}`),n}function XAe(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function ZU(t){let e=typeof t=="string"?t?.split(" "):[];return t&&e?.length>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||by.test(e0(t,!0,!0)))}function nl(t){return Gy(t)||ok.test(t)}function JAe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+3600*e.getHours();return QAe(i,{displaySeconds:!1})}function QAe(t,e){let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),a=i-n*3600-r*60;return(!e||e?.displaySeconds?n+":"+r+":"+a:n+":"+r).split(":").map(Bu).join(":")}var u3=t=>{let e=rC(t)||Gy(t)?new Date(t):new Date,i=e.getUTCMonth()+1,n=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${Bu(n)}-${Bu(e.getUTCDate())}`};function e_e(t){let e=rC(t)||Gy(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Vc(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let n=new Date(t),r=""+(n.getMonth()+1),a=""+n.getDate(),s=n.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),i==="DMY"?[a,r,s].join(e):i==="MDY"?[r,a,s].join(e):i==="YDM"?[s,a,r].join(e):i==="DYM"?[a,s,r].join(e):i==="MYD"?[r,s,a].join(e):[s,r,a].join(e)}function uk(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function t_e(t){return uk(t).getTime()}function rC(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function RT(t,e){if(!nl(t)||!nl(e))return[];let i=Pi(t)+"T00:00",n=Pi(e)+"T00:00",r=new Date(i),a=new Date(n),s=rC(a)&&rC(r)&&u(r,a),o=[],l=0;if(s){let c=r,d=c.getTime();for(;d<=a.getTime()&&l<300;)l+=1,o.push(new Date(c)),d=c.setDate(c.getDate()+1)}return o.map(c=>Vc(c));function u(c,d){return c<=d}}var i_e=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Gy(t){return typeof t!="string"?!1:i_e.test(t)}function c3(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(n=>!isNaN(parseInt(n)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function rn(t){let e=Jn(t);if(!e)return 0;let[i,n]=e.split(":").map(r=>parseInt(r));return i*60+n}function n_e(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[Bu(e),Bu(i)].join(":")}function ck(t){return c3(t)?t.split(":").slice(0,2).map(Bu).join(":"):void 0}function Jn(t){return Gy(t)&&t.indexOf("T")>0?ck(t.split("T").reverse()[0]):ck(t)}function Pi(t){return Gy(t)||Op.test(t)?t.split("T")[0]:void 0}function GE(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Pi(i.toISOString())}function dk(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function r_e(t){let e=dk(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(Bu).join(":")}function a_e(t){let e=dk(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),e.hours?.[0]==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function e0(t,e,i){let n=Pi(t),r=Jn(t),a=n?r:t;return t?e&&(n&&i&&t||r_e(a))||a_e(a):void 0}function _oe(t,e){let i=dk(t),n=dk(e);if(parseInt(i.hours)<parseInt(n.hours))return-1;if(parseInt(i.hours)>parseInt(n.hours))return 1;if(i.hours===n.hours){if(parseInt(i.minutes)<parseInt(n.minutes))return-1;if(parseInt(i.minutes)>parseInt(n.minutes))return 1}return 0}function d3(t,e=7){let i=Pi(t)+"T00:00",n=new Date(i),r=new Date(n.setDate(n.getDate()+e));return Vc(r)}function s_e(t){return d3(t)}function o_e(t,e,i,n=!1){let r=new Date(e,0,1+(t-1)*7),a=n?0:1;return r.setDate(r.getDate()+(a-r.getDay())),Vc(r,i)}function l_e(t,e,i){let n=new Date(t,0);return Vc(new Date(n.setDate(e)),i)}function zr(t,e=void 0){let[i,n]=(t||"00:00").split(":").map(Bu),r=uk(e).setHours(i,n,0,0);return uk(r)}function W1(t,e,i=!0){let n=new Date(t),r=(new Date(e).getTime()-n.getTime())/1e3/60;return i?Math.abs(Math.round(r)):Math.round(r)}function tl(t,e){let i=Jn(t);if(!i)return"00:00";let n=isNaN(e)?0:e;return Jn(p3(zr(i),n).toISOString())}function p3(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function Bu(t){return t.toString()[1]?t:"0"+t}function zh(t,e){let i=new Date(t),n=new Date(e);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate()}var koe={addDays:d3,addWeek:s_e,addMinutesToTimeString:tl,convertTime:e0,getIsoDateString:lk,getUTCdateString:u3,DateHHMM:JAe,extractDate:Pi,extractTime:Jn,formatDate:Vc,getDateByWeek:o_e,isISODateString:Gy,isDate:rC,isTimeString:c3,offsetDate:uk,offsetTime:t_e,sameDay:zh,timeStringMinutes:rn,timeToDate:zr,timeUTC:e_e,validTimeValue:ZU,validDateString:ok,timeValidation:by,dateValidation:Op},u_e=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),c_e=t=>t.filter(Boolean).every(br);function sw(t){let e=t.category;if(typeof e!="object")return{error:JP};let{ageCategoryCode:i,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:s}=e,o=e.categoryName,l;if(!(u_e([i,n,r,o],"string")&&c_e([a,s])&&[n,r].filter(Boolean).every(nl)))return{error:JP};let u=t.consideredDate??Pi(new Date().toLocaleDateString("sv"));if(!nl(u))return{error:ja};let[c]=u.split("-").slice(0,3).map($=>parseInt($)),d=GE(u,-1),[p,h]=d.split("-").slice(1,3).map($=>parseInt($)),f=`${Bu(p)}-${Bu(h)}`,m=GE(u,1),[g,v]=m.split("-").slice(1,3).map($=>parseInt($)),y=`${Bu(g)}-${Bu(v)}`,b=s&&GE(u,-1*365*s),I=a&&GE(u,-1*365*a),S=[],w=$=>!S.includes($)&&S.push($);i=i??o;let T=/^([UO]?)(\d{1,2})([UO]?)$/,U=/^C(\d{1,2})-(\d{1,2})$/,C=i?.includes("-"),E=C&&i?.match(U),P=i?.match(T),M=($,F)=>`${$}-${F}`,R=$=>{let F=c-$,j=M(F,y);e.ageMinDate&&e.ageMinDate!==j&&w(`Invalid submitted ageMinDate: ${r}`),r=j,i&&(e.ageMax&&e.ageMax!==$-1&&(w(`Invalid submitted ageMax: ${a}`),I=void 0),a=$-1)},N=$=>{let F=c-$-1,j=M(F,y);e.ageMin&&e.ageMin>$&&w(`Invalid submitted ageMin: ${s}`),e.ageMax&&e.ageMax>$&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==j&&w(`Invalid submitted ageMinDate: ${r}`),r=j,i&&(e.ageMax&&e.ageMax!==$&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=$)},A=$=>{let F=c-$,j=M(F,f);e.ageMaxDate&&e.ageMaxDate!==j&&w(`Invalid submitted ageMaxDate: ${n}`),n=j,i&&(e.ageMin&&e.ageMin!==$+1&&(w(`Invalid submitted ageMin: ${s}`),b=void 0),s=$+1)},_=$=>{let F=c-$-1,j=M(F,f);e.ageMaxDate&&e.ageMaxDate!==j&&w(`Invalid submitted ageMaxDate: ${n}`),n=j,i&&(e.ageMin&&e.ageMin!==$&&(w(`Invalid submitted ageMin: ${s}`),b=void 0),s=$)},x=$=>{let[F,j,H]=($.match(T)||[]).slice(1),G=parseInt(j);F==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),R(G)):F==="O"&&A(G),H==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N(G)):H==="O"&&_(G),n=n??b,r=r??I};if(E){if(n=void 0,r=void 0,a=void 0,s=void 0,e.ageMin){let j=c-e.ageMin;n=M(j,f)}if(e.ageMax){let j=c-e.ageMax-1;r=M(j,y)}let[$,F]=(i?.match(U)??[]).slice(1).map(j=>parseInt(j));$<=F?(s=$,a=F,l=!0):w(`Invalid combined age range ${i}`)}else C?i?.split("-").forEach(x):P?x(i):(s&&A(s),a&&N(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),s=void 0);let O=Vt({consideredDate:u,combinedAge:l,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:s});return S.length&&(O.errors=S),O}function aC({category:t}){if(!Ki(t))return{error:Ee};let e=sw({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:n}=t;return i&&!br(i)?ce({result:{error:Ee},context:{ratingMax:i}}):n&&!br(n)?ce({result:{error:Ee},context:{ratingMin:n}}):{...e}}function Y1({childCategory:t,withDetails:e,category:i}){let n=aC({category:i}),r=aC({category:t}),a=r.ageMin&&(n.ageMin&&r.ageMin<n.ageMin||n.ageMax&&r.ageMin>n.ageMax),s=r.ageMax&&(n.ageMax&&r.ageMax>n.ageMax||n.ageMin&&r.ageMax<n.ageMin),o=r.ageMinDate&&n.ageMaxDate&&new Date(r.ageMinDate)>new Date(n.ageMaxDate),l=r.ageMaxDate&&n.ageMinDate&&new Date(r.ageMaxDate)<new Date(n.ageMinDate),u=i?.ratingType&&t?.ratingType&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),c=i?.ballType&&t?.ballType&&i.ballType!==t.ballType,d=Vt({invalidRatingRange:u,invalidAgeMinDate:o,invalidAgeMaxDate:l,invalidBallType:c,invalidAgeMax:s,invalidAgeMin:a,valid:!u&&!o&&!l&&!c&&!s&&!a},!0);return e&&Object.assign(d,{categoryDetails:n,childCategoryDetails:r}),d}function K1({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:n=!0,referenceCategory:r,referenceGender:a,event:s}){a=a??s?.gender;let o="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),ce({result:{errors:l,error:jm},stack:o});let{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,collectionId:p,matchUpCount:h,matchUpFormat:f,matchUpValue:m,matchUpType:g,scoreValue:v,setValue:y,category:b,gender:I}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof h!="number"&&l.push(`matchUpCount is not type number: ${h}`),g&&!xO([Rn,Dn],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!u?.length].concat([m,d,v,y].map(yi)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),u&&h){let S=ose({collectionValueProfiles:u,matchUpCount:h});S.errors&&l.push(...S.errors)}if(c&&typeof c!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),f&&!Ml({matchUpFormat:f})&&l.push(`Invalid matchUpFormat: ${f}`),n){let S=JO({referenceGender:a,matchUpType:g,gender:I});if(S.error)return ce({context:{referenceGender:a,gender:I},result:S,stack:o})}if(t&&r&&b){let S=Y1({category:r,childCategory:b});if(!S.valid)return ce({result:{error:JP},context:S,stack:o})}return l.length?ce({result:{errors:l,error:uoe},stack:o}):{valid:!0}}function Lo(t){let e=!!(t?.enforceCategory!==!1&&t?.category),i=!!(t?.enforceGender!==!1&&t?.gender),n=t?.checkCollectionIds,r=t?.tieFormat,a=t?.event,s="validateTieFormat",o=[],l=d_e({...t,stack:s});if(l?.error)return l;let u,c=r.collectionDefinitions.every(g=>{let{setValue:v,scoreValue:y,collectionValue:b}=g;(v||y)&&!b&&(u=!0);let{valid:I,errors:S}=K1({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:g,checkCollectionIds:n,checkCategory:e,checkGender:i,event:a});return I?!0:(Array.isArray(S)&&o.push(...S),!1)}),d=typeof r.winCriteria?.valueGoal=="number"&&r.winCriteria?.valueGoal>0&&!u||r.winCriteria?.aggregateValue;if(!(d||r.winCriteria?.aggregateValue))return u?o.push("aggregateValue is required"):o.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),ce({context:{tieFormat:r,errors:o,aggregateValueImperative:u},result:{error:Rh},stack:s});let p=r.collectionDefinitions.map(({collectionId:g})=>g),h=!n||p.length===wi(p).length,f=c&&d&&h;return f?{valid:f,errors:o}:ce({result:{error:Rh},context:{tieFormat:r,errors:o},stack:s})}function d_e(t){let{tieFormat:e,stack:i}=t;return!t||!e||!Ki(e)?ce({result:{error:Rh},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):Ki(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...le}:ce({result:{error:Rh},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):ce({result:{error:Rh},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var MT="resourceSubType",NT="resourceType",AT="identifier",xoe={RESOURCE_SUB_TYPE:MT,RESOURCE_TYPE:NT,IDENTIFIER:AT};function Ct(t,e,i,n,r=0){if(yG().makeDeepCopy)return yG().makeDeepCopy(t,e,i,n);let a=i3(),{stringify:s,toJSON:o,ignore:l,modulate:u}=a||{};if(!a?.enabled&&!i||typeof t!="object"||Ao(t)||t===null||typeof a?.threshold=="number"&&r>=a.threshold)return t;let c=Array.isArray(t)?[]:{},d=Object.keys(t).filter(h=>!i||!l||Array.isArray(l)&&!l.includes(h)||Ao(l)&&!l(h)),p=(h,f)=>{c[h]=Ao(f?.toString)?f.toString():JSON.stringify(f)};for(let h of d){let f=t[h],m=Ao(u)?u(f):void 0;if(m!==void 0)c[h]=m;else if(e&&h==="extensions"&&Array.isArray(f)){let g=h3(f);Object.assign(c,...g)}else n&&h==="extensions"?c[h]=[]:Array.isArray(s)&&s.includes(h)?p(h,f):Array.isArray(o)&&o.includes(h)&&Ao(f?.toJSON)?c[h]=f.toJSON():f===null?c[h]=void 0:XAe(f)?c[h]=new Date(f).toISOString():c[h]=Ct(f,e,i,n,r+1)}return c}function h3(t){return t?.map(e=>{let{name:i,value:n}=e;return i&&n&&{[`_${i}`]:n}}).filter(Boolean)}function Ooe(t=1,e){return Dt(0,t).map(()=>mn(e))}function mn(t){let e=[];for(let o=0;o<256;o++)e[o]=(o<16?"0":"")+o.toString(16);let i=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0,a=Math.random()*4294967295|0,s=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[n&255]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[r&63|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${s.replace(/-/g,"")}`:s}var Loe={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},Foe={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},$oe={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},Boe={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},Voe={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},joe={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},Goe={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},Hoe={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},zoe={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},qoe={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},jc="SET3-S:6/TB7",p_e="SET3-S:6NOAD",Woe="SET3-S:6/TB7-F:TB10",h_e="SET3-S:4/TB7",f_e="SET3-S:4/TB5@3",m_e="SET1-S:T20",g_e="SET1-S:8/TB7",v_e="SET1-S:8/TB7@7",y_e={FORMAT_STANDARD:jc,FORMAT_STANDARD_NOAD:p_e,FORMAT_ATP_DOUBLES:Woe,FORMAT_SHORT_SETS:h_e,FORMAT_FAST4:f_e,FORMAT_PRO_SET:g_e,FORMAT_COLLEGE_PRO_SET:v_e,TIMED20:m_e},Yoe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},Koe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},Zoe={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},Xoe={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},Joe={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},Qoe={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},ele={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},pk="COLLEGE_DEFAULT",bG="COLLEGE_JUCO",IG="COLLEGE_D3",tle="DOMINANT_DUO",ile="DOMINANT_DUO_MIXED",nle="LAVER_CUP",rle="TEAM_DOUBLES_3_AGGREGATION",ale="TIME_TENNIS_DUAL",sle="TIME_TENNIS_PRO_CIRCUIT",ole="USTA_BREWER_CUP",lle="USTA_OZAKI_CUP",ule="USTA_COLLEGE",cle="USTA_GOLD_TEAM_CHALLENGE",dle="USTA_LEVEL_1",ple="USTA_INTERSECTIONAL",hle="USTA_SECTION_BATTLE",fle="USTA_SOUTHERN_LEVEL_5",mle="USTA_TOC",gle="USTA_WTT_ITT",vle="USTA_ZONAL",yle={COLLEGE_D3:IG,COLLEGE_DEFAULT:pk,COLLEGE_JUCO:bG,DOMINANT_DUO:tle,DOMINANT_DUO_MIXED:ile,LAVER_CUP:nle,TEAM_DOUBLES_3_AGGREGATION:rle,TIME_TENNIS_DUAL:ale,TIME_TENNIS_PRO_CIRCUIT:sle,USTA_BREWER_CUP:ole,USTA_OZAKI_CUP:lle,USTA_COLLEGE:ule,USTA_GOLD_TEAM_CHALLENGE:cle,USTA_INTERSECTIONAL:ple,USTA_LEVEL_1:dle,USTA_SECTION_BATTLE:hle,USTA_SOUTHERN_LEVEL_5:fle,USTA_TOC:mle,USTA_WTT_ITT:gle,USTA_ZONAL:vle},ble="STANDARD",fX={[ble]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[IG]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:jc,matchUpCount:6,matchUpValue:1},tieFormatName:IG,valueGoal:5},[pk]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:jc,matchUpCount:6,matchUpValue:1},tieFormatName:pk,valueGoal:4},[bG]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:jc,matchUpCount:6,matchUpValue:1},tieFormatName:bG,valueGoal:5},[nle]:Qoe,[tle]:Yoe,[ile]:Goe,[rle]:Foe,[ale]:Hoe,[sle]:joe,[ole]:zoe,[lle]:qoe,[ule]:Koe,[cle]:Loe,[ple]:Voe,[dle]:Zoe,[hle]:Boe,[fle]:$oe,[gle]:Xoe,[mle]:ele,[vle]:Joe},b_e=t=>{let e=t?.namedFormat&&Object.keys(fX).includes(t.namedFormat)?t.namedFormat:ble,i=Array.isArray(t?.uuids)?t?.uuids:[],n,{category:r,gender:a}=t?.event??{},s=Ct(fX[e],!1,!0),o=l=>{if(!t?.isMock&&!t?.event?.isMock||!t.event)return i?.pop()??mn();let u=t?.event?.eventId;return i.pop()??`${u}-COL-${l+1}`};return s.hydrate?(n={winCriteria:{valueGoal:s.valueGoal},collectionDefinitions:[{collectionId:o(0),matchUpFormat:Woe,collectionName:"Doubles",matchUpType:Dn,...s.doubles},{collectionId:o(1),matchUpFormat:jc,collectionName:"Singles",matchUpType:Rn,...s.singles}]},s.tieFormatName&&(n.tieFormatName=s.tieFormatName)):(s.collectionDefinitions.forEach((l,u)=>l.collectionId=o(u)),n=s),t?.hydrateCollections&&n.collectionDefinitions.forEach(l=>{r&&!l.category&&(l.category=r),a&&!l.gender&&(l.gender=a)}),n},dm=b_e,Lp="SINGLES",ow="SINGLES",Yu="DOUBLES",pm="DOUBLES",na="TEAM",Nl="TEAM",I_e="RATING",w_e="BOTH",dl={AGE:"AGE",BOTH:w_e,DOUBLES:Yu,DOUBLES_EVENT:pm,RATING:I_e,SINGLES:Lp,SINGLES_EVENT:ow,TEAM_EVENT:Nl,TEAM:na},Nt="MAIN",qt="QUALIFYING",Ts="CONSOLATION",Ga="VOLUNTARY_CONSOLATION",Sr="PLAY_OFF",eL=[Nt,qt,Ts,Sr,Ga],lw={[qt]:1,[Nt]:2,[Sr]:3,[Ts]:3,[Ga]:4},Ile="finishingPositions",wle="aggregateEventStructures",Sle={[Nt]:1,[Sr]:2,[Ts]:3,[qt]:4,[Ga]:5},S_e={[Sr]:1,[Nt]:2,[Ts]:3,[qt]:4,[Ga]:5},tL="CLUSTER",T_e="SEPARATE",Hy="WATERFALL",iL="ITEM",To="CONTAINER",Ac="DRAW",nL="RANDOM",kc="TOP_DOWN",zy="BOTTOM_UP",qh="POSITION",Wh="WINNER",Yh="LOSER",Fp="FIRST_MATCHUP",Al="AD_HOC",U_e="AD_HOC",XU="FEED_IN",_T="COMPASS",kT="OLYMPIC",D_e="SINGLE_ELIMINATION",Dp="SINGLE_ELIMINATION",Z1="DOUBLE_ELIMINATION",xT="FIRST_MATCH_LOSER_CONSOLATION",X1="FIRST_ROUND_LOSER_CONSOLATION",Tb="LUCKY_DRAW",rL="CURTIS_CONSOLATION",E_e="CURTIS_CONSOLATION",f3="FEED_IN_CHAMPIONSHIP_TO_SF",sC="FEED_IN_CHAMPIONSHIP_TO_SF",m3="FEED_IN_CHAMPIONSHIP_TO_QF",oC="FEED_IN_CHAMPIONSHIP_TO_QF",g3="FEED_IN_CHAMPIONSHIP_TO_R16",lC="FEED_IN_CHAMPIONSHIP_TO_R16",Tle="MODIFIED_FEED_IN_CHAMPIONSHIP",uC="MODIFIED_FEED_IN_CHAMPIONSHIP",J1="FEED_IN_CHAMPIONSHIP",P_e="DOUBLE_ROUND_ROBIN",id="ROUND_ROBIN",Kh="ROUND_ROBIN_WITH_PLAYOFF",Ule="DECIDER",Dle="BACKDRAW",v3={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},y3={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},qy="WIN_RATIO",t0="ROUND_OUTCOME",Ele=[_T,rL,oC,lC,sC,J1,m3,g3,f3,xT,X1,Tb,uC,kT,Sr,Kh],C_e=[Al,_T,rL,Z1,oC,lC,sC,J1,XU,xT,X1,Tb,uC,kT,Sr,id,Kh,Dp],Zr={MAIN:Nt,QUALIFYING:qt,CONSOLATION:Ts,ITEM:iL,CONTAINER:To,FIRST_MATCHUP:Fp,WINNER:Wh,LOSER:Yh,AD_HOC:Al,FEED_IN:XU,FLEX_ROUNDS:U_e,COMPASS:_T,PLAY_OFF:Sr,OLYMPIC:kT,KNOCKOUT:D_e,SINGLE_ELIMINATION:Dp,DOUBLE_ELIMINATION:Z1,CURTIS:rL,FICSF:f3,FICQF:m3,FICR16:g3,MFIC:Tle,VOLUNTARY_CONSOLATION:Ga,FIRST_MATCH_LOSER_CONSOLATION:xT,FIRST_ROUND_LOSER_CONSOLATION:X1,MODIFIED_FEED_IN_CHAMPIONSHIP:uC,FEED_IN_CHAMPIONSHIP_TO_R16:lC,FEED_IN_CHAMPIONSHIP_TO_QF:oC,FEED_IN_CHAMPIONSHIP_TO_SF:sC,FEED_IN_CHAMPIONSHIP:J1,LUCKY_DRAW:Tb,ROUND_ROBIN_WITH_PLAYOFF:Kh,ROUND_ROBIN:id,DECIDER:Ule,BACKDRAW:Dle,COMPASS_ATTRIBUTES:v3,OLYMPIC_ATTRIBUTES:y3,DRAW:Ac,RANDOM:nL,TOP_DOWN:kc,BOTTOM_UP:zy,WATERFALL:Hy,WIN_RATIO:qy,ROUND_OUTCOME:t0,MULTI_STRUCTURE_DRAWS:Ele,generatedDrawTypes:C_e,stageOrder:lw,finishOrder:Sle,AGGREGATE_EVENT_STRUCTURES:wle,FINISHING_POSITIONS:Ile},R_e=Zr,js="tournamentRecords",b3="policyDefinitions",ha="tournamentRecord",I3="onlineResource",zs="drawDefinition",Ple="tieFormatName",w3="matchUpFormat",Zh="participantId",Cle="scheduleDates",M_e="tournamentId",N_e="scheduleDate",A_e="roundNumber",aL="structureId",S3="participant",Q1="matchUpIds",Rle="entryStage",__e="policyType",Mle="structures",T3="eventType",th="matchUpId",sL="tieFormat",oL="inContext",lL="structure",uL="courtIds",k_e="personId",cL="venueIds",U3="matchUps",Nle="courtId",Ale="eventId",hf="matchUp",_le="drawId",Gc="error",Gm="event",JU="param",D3="uuids",x_e="averageMatchUpMinutes",O_e="recoveryMinutes",L_e="periodLength",F_e="number",Qo="object",xs="array",gs="_validate",kle="_message",pu="_invalid",Go="_ofType",E3="_anyOf",OT="_oneOf",mX={[I3]:t=>Dr(Object.keys(t),[MT,NT,AT]).length===3,[Ple]:t=>t&&dm({namedFormat:t}),[D3]:t=>!t||Array.isArray(t)&&t.every(Xn),[sL]:t=>!Lo({tieFormat:t}).error,[T3]:t=>[Lp,Yu,na].includes(t),[Rle]:t=>eL.includes(t)},$_e={[js]:fr,[ha]:ot,[b3]:FO,[zs]:Ot,[Zh]:la,[w3]:Fq,[M_e]:ET,[aL]:yu,[Q1]:qw,[S3]:Kw,[I3]:jm,[T3]:Hh,[Mle]:kq,[th]:eo,[sL]:Rh,[lL]:wb,[Nle]:Ww,[U3]:Vm,[Ale]:Wu,[hf]:Oo,[uL]:Zt,[cL]:Zt,[_le]:Zd,[Gm]:qn},B_e={[js]:Qo,[b3]:Qo,[ha]:Qo,[zs]:Qo,[I3]:Qo,[Cle]:xs,[S3]:Qo,[Q1]:xs,[Mle]:xs,[sL]:Qo,[lL]:Qo,[uL]:xs,[cL]:xs,[U3]:xs,[hf]:Qo,[Gm]:Qo,[D3]:xs};function zt(t,e,i){if(!t&&!Ki(t))return{error:Ee};if(!e?.length||t?._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:Ee};let{paramError:n,errorParam:r}=G_e(t,e);if(!n)return{valid:!0};let a=n[gs]&&(n[Gc]||n[pu])||t?.[r]===void 0&&(n[Gc]||n[pu]||$_e[r]||Ee)||Ee,s=r??(n[OT]&&Object.keys(n[OT]).join(", "));return ce({info:{param:s,message:n[kle]},result:{error:a},stack:i})}function xle(t,e){let i=Object.keys(t),n=Object.keys(e);return Dr(i,n)}function V_e(t,e){if(!e)return;let i=xle(t,e);return i.length!==1?{error:Ee}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function j_e(t,e){if(!e)return;let i=xle(t,e).filter(n=>t[n]);return i.length<1?{error:Ee}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function G_e(t,e){let i,n;return{paramError:e.find(({_ofType:r,_oneOf:a,_anyOf:s,_validate:o,_info:l,...u})=>{let c=a&&V_e(t,a);if(c?.error)return c.error;c&&Object.assign(u,c);let d=s&&j_e(t,s);if(d?.error)return d.error;d&&Object.assign(u,d);let p=Object.keys(u).filter(f=>typeof u[f]=="boolean"),h=p.find(f=>{let m=o&&!Ao(o),g=t[f]!==void 0&&!o&&H_e(t,f,r),v=u[f]&&[void 0,null].includes(t[f]),y=m||g||v||o&&t[f]!==void 0&&!z_e(t[f],o)||mX[f]&&!mX[f](t[f]);return y&&(i=f,n=l),y});return!p.length||h}),errorParam:i,paramInfo:n}}function H_e(t,e,i){return i=i||B_e[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function z_e(t,e){return Ao(e)?e(t):!0}var P3="DYNAMIC",zg="RANKING",Fg="RATING",Wy="SCALE",Nh="SEEDING",QU={RANKING:zg,RATING:Fg,SCALE:Wy,SEEDING:Nh};function eD(t){let e=zt(t,[{[S3]:!0}]);if(e.error)return e;let i=t.participant.timeItems?.filter(({itemType:r})=>r?.startsWith(Wy)&&[zg,Fg,Nh].includes(r.split(".")[1])),n={ratings:{},rankings:{},seedings:{}};if(i?.length){let r=s=>i.filter(o=>o?.itemType===s).sort((o,l)=>new Date(o.createdAt||void 0).getTime()-new Date(l.createdAt||void 0).getTime()).pop(),a=wi(i.map(({itemType:s})=>s));for(let s of a){let o=r(s);if(o){let[,l,u,c,d]=o.itemType.split("."),p=d?`${c}.${d}`:c,h=l===Nh&&"seedings"||l===zg&&"rankings"||"ratings";n[h][u]||(n[h][u]=[]),n[h][u].push({scaleValue:o.itemValue,scaleDate:o.itemDate,scaleName:p})}}}return{...le,...n}}function uw(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let n={};return r(e,i,n),n;function r(a,s,o){if(!a||!s)return;let l=Object.keys(a),u=Object.keys(s),c=Object.assign({},...u.filter(h=>h.indexOf("||")).map(h=>h.split("||").map(f=>({[f]:h}))).flat()),d=u.concat(...Object.keys(c)),p=d.includes("*");for(let h of l)if(d.indexOf(h)>=0||p){let f=c[h]||h,m=s[f]||p,g=a[h];if(typeof m=="object"&&typeof g!="function"&&!Array.isArray(m))if(Array.isArray(g)){let v=g.map(y=>{let b={};return r(y,m,b)!==!1?b:void 0}).filter(Boolean);o[h]=v}else g&&(o[h]={},r(g,m,o[h]));else{let v=a[h];if(Array.isArray(m)&&!m.includes(v))return!1;(s[h]||p&&s[h]!==!1)&&(o[h]=v)}}}}var wG="voluntaryConsolation",zf="competitiveBands",C3="roundRobinTally",Xh="positionActions",Ha="matchUpActions",a_="rankingPoints",hm="roundNaming",tD="participant",cC="progression",wv="scheduling",dC="avoidance",q_e="participant",W_e="display",Ku="scoring",Cc="seeding",LT="feedIn",Y_e="audit",hk="draws",Ub={POLICY_TYPE_VOLUNTARY_CONSOLATION:wG,POLICY_TYPE_COMPETITIVE_BANDS:zf,POLICY_TYPE_ROUND_ROBIN_TALLY:C3,POLICY_TYPE_POSITION_ACTIONS:Xh,POLICY_TYPE_MATCHUP_ACTIONS:Ha,POLICY_TYPE_RANKING_POINTS:a_,POLICY_TYPE_ROUND_NAMING:hm,POLICY_TYPE_PARTICIPANT:tD,POLICY_TYPE_PROGRESSION:cC,POLICY_TYPE_SCHEDULING:wv,POLICY_TYPE_AVOIDANCE:dC,POLICY_TYPE_DISPLAY:W_e,POLICY_TYPE_PRIVACY:q_e,POLICY_TYPE_FEED_IN:LT,POLICY_TYPE_SCORING:Ku,POLICY_TYPE_SEEDING:Cc,POLICY_TYPE_AUDIT:Y_e,POLICY_TYPE_DRAWS:hk};function qg({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:n,internalUse:r,personId:a}){let s=t.find(l=>n&&l.participantId===n||a&&l.person&&l.person.personId===a),o=Ct(s,!1,r);if(o){let l=e?.[tD];if(i?.withScaleValues){let{ratings:u,rankings:c}=eD({participant:o});o.rankings=c,o.ratings=u}if(l?.participant)return uw({template:l.participant,source:o})}return o}var K_e="element required",Z_e="missing name";function lo(t){if(!t||typeof t!="object")return{error:Zt};if(t.element&&typeof t?.element!="object")return{error:Ee};if(!t?.name)return{error:Zt,info:Z_e};if(!t?.element){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],n=lo({element:i,name:t.name});if(n.error)return ce({result:n,stack:"removeExtension"})}return{...le}}return{error:Zt,info:K_e}}return t?.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>e?.name!==t.name),{...le}):{...le,info:Ya}}function $p({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(n=>i.includes(n)).length===t.length}function un(t){if(typeof t!="object")return{error:Zt};let e="addExtension";if(t?.element&&typeof t.element!="object")return ce({result:{error:Ee},stack:e});if(!$p({extension:t.extension}))return ce({result:{error:Ee,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let n of Object.values(t.tournamentRecords)){let r=un({extension:t.extension,element:n});if(r.error)return ce({result:r,stack:e})}return{...le}}else return ce({result:{error:Zt},stack:e});if(t.element.extensions||(t.element.extensions=[]),t?.creationTime??!0){let n=new Date().toISOString();Object.assign(t.extension,{createdAt:n})}let i=t.element.extensions.find(({name:n})=>n===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...le}}function R3(t){return!t||typeof t!="object"?{error:Zt}:t.tournamentRecord?un({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:ot}}function dL(t){return!t||typeof t!="object"?{error:Zt}:t.drawDefinition?un({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:cu}}function Sv(t){return!t||typeof t!="object"?{error:Zt}:t.event?un({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:Wu}}function Ole(t){if(!t||typeof t!="object")return{error:Zt};if(!t.participantId)return{error:la};let e=t.tournamentRecord?.participants||[],i=qg({participantId:t.participantId,tournamentParticipants:e});return i?un({creationTime:t.creationTime,extension:t.extension,element:i}):{error:Nr}}function M3(t){return!t||typeof t!="object"?{error:Zt}:t.tournamentRecord?lo({element:t.tournamentRecord,name:t.name}):{error:ot}}function Lle(t){return!t||typeof t!="object"?{error:Zt}:t.drawDefinition?lo({element:t.drawDefinition,name:t.name}):{error:cu}}function pL(t){return!t||typeof t!="object"?{error:Zt}:t?.event?lo({element:t.event,name:t.name}):{error:Wu}}function Fle(t){if(!t||typeof t!="object")return{error:Zt};if(!t.participantId)return{error:la};let e=t.tournamentRecord?.participants||[],i=qg({participantId:t.participantId,tournamentParticipants:e});return i?lo({element:i,name:t.name}):{error:Nr}}function eR({tournamentRecords:t}){return{tournamentIds:Ki(t)?Object.keys(t):[],...le}}var X_e="extensionQueries";function _i({discover:t,element:e,name:i,...n}){if(!e||!i){if(t&&n){let a=Object.keys(n).filter(l=>typeof t=="boolean"||Array.isArray(t)&&t.includes(l)).find(l=>Array.isArray(n[l]?.extensions)?n[l].extensions.find(u=>u?.name===i):!1),s=a&&n[a];!s&&n.tournamentRecords&&(s=Object.values(n.tournamentRecords).find(l=>l.extensions?.length));let o=s?.extensions?.find(l=>l?.name===i);return{extension:o,info:o?void 0:Ya}}return ce({result:{error:Zt},stack:X_e})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let r=e.extensions.find(a=>a?.name===i);return{extension:r,info:r?void 0:Ya}}var J_e="activeSuspension",pC="appliedPolicies",$le="context",hL="delegatedOutcome",kd="disabled",cw="disableAutoCalc",fL="disableLinks",fk="display",Dy="drawDeletions",Q_e="drawProfile",mk="entryProfile",eke="eventProfile",tke="eventWithdrawalRequests",ike="factory",nd="flightProfile",SG="groupingAttribute",fm="lineUps",Yy="linkedTournamentsIds",mL="matchUpHistory",N3="participantRepresentatives",iD="personRequests",dT="positionActions",nke="rankingPoints",rke="registration",ih="roundTarget",tR="scheduleLimits",mm="scheduleTiming",dw="schedulingProfile",ake="statusDetail",FT="subOrder",gm="tally",dP="tieFormatModification",Ey={ACTIVE_SUSPENSION:J_e,APPLIED_POLICIES:pC,CONTEXT:$le,DELEGATED_OUTCOME:hL,DISABLED:kd,DISABLE_LINKS:fL,DISABLE_AUTO_CALC:cw,DISPLAY:fk,DRAW_DELETIONS:Dy,DRAW_PROFILE:Q_e,ENTRY_PROFILE:mk,EVENT_PROFILE:eke,EVENT_WITHDRAWAL_REQUESTS:tke,FLIGHT_PROFILE:nd,GROUPING_ATTRIBUTE:SG,LINEUPS:fm,LINKED_TOURNAMENTS:Yy,MATCHUP_HISTORY:mL,PARTICIPANT_REPRESENTATIVES:N3,PERSON_REQUESTS:iD,POSITION_ACTIONS:dT,RANKING_POINTS:nke,REGISTRATION:rke,ROUND_TARGET:ih,SCHEDULE_LIMITS:tR,SCHEDULE_TIMING:mm,SCHEDULING_PROFILE:dw,STATUS_DETAIL:ake,SUB_ORDER:FT,TALLY:gm,TIE_FORMAT_MODIFICATIONS:dP,FACTORY:ike},gX=[hL,kd,cw,fL,nd,fm,Yy,mL,N3,iD,ih,tR,mm,dw,FT,gm,dP];function Ble({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:fr};let e=eR({tournamentRecords:t}),{tournamentIds:i}=e;return i?.length>1?un({tournamentRecords:t,discover:!0,extension:{name:Yy,value:{tournamentIds:i}}}):{...le}}function Vle({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:fr};let e=lo({name:Yy,tournamentRecords:t,discover:!0});return ce({result:e,stack:"unlinkTournaments"})}function jle({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:Ee};if(!e)return{error:ET};let i=eR({tournamentRecords:t}),{tournamentIds:n}=i;if(!n.includes(e))return{error:ET};let r;return n.every(a=>{let s=t[a],{extension:o}=_i({element:s,name:Yy});if(!o)return!0;let l=o?.value?.tournamentIds||[];if(!l?.length||l.length===1&&l.includes(e)||a===e){let d=M3({name:Yy,tournamentRecord:s});return d.error&&(r=d.error),d.success}let u=l.filter(d=>d!==e);o.value={tournamentIds:u};let c=R3({tournamentRecord:s,extension:o});return c.error&&(r=c.error),c.success}),r?{error:r}:{...le}}var Gle={};Fi(Gle,{getLinkedTournamentIds:()=>iR,getTournamentIds:()=>eR});function iR({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:fr}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{let i=t[e],n=i?.tournamentId,{extension:r}=_i({element:i,name:Yy}),a=(r?.value?.tournamentIds||[]).filter(s=>s!==n);return{[e]:a}}))}}var A3={};Fi(A3,{adHocPositionSwap:()=>_ce,addAdHocMatchUps:()=>zL,addDrawDefinitionTimeItem:()=>FW,addFinishingRounds:()=>vR,addGoesTo:()=>Zy,addPlayoffStructures:()=>HL,addQualifyingStructure:()=>Ace,addVoluntaryConsolationStage:()=>Dce,addVoluntaryConsolationStructure:()=>DW,allPlayoffPositionsFilled:()=>xW,alternateDrawPositionAssignment:()=>hce,assignDrawPosition:()=>ade,assignDrawPositionBye:()=>Su,attachConsolationStructures:()=>tde,attachPlayoffStructures:()=>e4,attachQualifyingStructure:()=>LW,attachStructures:()=>GL,autoSeeding:()=>K$e,automatedPlayoffPositioning:()=>cD,automatedPositioning:()=>PR,checkValidEntries:()=>YL,deleteAdHocMatchUps:()=>ode,drawMatic:()=>D4,findDrawDefinition:()=>a4,generateAdHocMatchUps:()=>KL,generateAdHocRounds:()=>U4,generateAndPopulatePlayoffStructures:()=>JW,generateDrawDefinition:()=>zR,generateDrawMaticRound:()=>f4,generateDrawStructuresAndLinks:()=>d4,generateDrawTypeAndModifyDrawDefinition:()=>p4,generateQualifyingStructure:()=>HW,generateVoluntaryConsolation:()=>Ade,getAssignedParticipantIds:()=>Ab,getAvailableMatchUpsCount:()=>qL,getAvailablePlayoffProfiles:()=>MR,getDrawDefinitionTimeItem:()=>nW,getDrawParticipantRepresentativeIds:()=>n4,getDrawStructures:()=>rd,getDrawTypeCoercion:()=>OR,getEligibleVoluntaryConsolationParticipants:()=>i4,getMatchUpsMap:()=>us,getParticipantIdFinishingPositions:()=>r4,getPositionAssignments:()=>wC,getPositionsPlayedOff:()=>dD,getRandomQualifierList:()=>u4,getSeedingThresholds:()=>RW,getSeedsCount:()=>LR,getStructureSeedAssignments:()=>Zu,getTeamLineUp:()=>Ky,getValidGroupSizes:()=>DR,isAdHoc:()=>Fo,isCompletedStructure:()=>ef,isValidForQualifying:()=>c4,luckyLoserDrawPositionAssignment:()=>oce,modifyDrawDefinition:()=>ide,modifyDrawName:()=>t4,modifySeedAssignment:()=>yce,mutate:()=>Hle,positionActions:()=>l4,pruneDrawDefinition:()=>rde,qualifierDrawPositionAssignment:()=>OW,qualifierProgression:()=>bce,query:()=>cde,removeDrawPositionAssignment:()=>yC,removeRoundMatchUps:()=>lde,removeSeededParticipant:()=>Nce,removeStructure:()=>Tce,renameStructures:()=>Sce,resetDrawDefinition:()=>nde,resetQualifyingStructure:()=>Ece,resetVoluntaryConsolationStructure:()=>nue,setDrawParticipantRepresentativeIds:()=>zle,setPositionAssignments:()=>dce,setStructureOrder:()=>Ice,setSubOrder:()=>ude,shiftAdHocRounds:()=>cce,swapAdHocRounds:()=>pce,swapDrawPositionAssignments:()=>Rce,updateTeamLineUp:()=>m0,withdrawParticipantAtDrawPosition:()=>Que});var Hle={};Fi(Hle,{adHocPositionSwap:()=>_ce,addAdHocMatchUps:()=>zL,addDrawDefinitionTimeItem:()=>FW,addPlayoffStructures:()=>HL,addQualifyingStructure:()=>Ace,addVoluntaryConsolationStage:()=>Dce,addVoluntaryConsolationStructure:()=>DW,alternateDrawPositionAssignment:()=>hce,assignDrawPosition:()=>ade,assignDrawPositionBye:()=>Su,attachConsolationStructures:()=>tde,attachPlayoffStructures:()=>e4,attachQualifyingStructure:()=>LW,attachStructures:()=>GL,automatedPlayoffPositioning:()=>cD,automatedPositioning:()=>PR,deleteAdHocMatchUps:()=>ode,luckyLoserDrawPositionAssignment:()=>oce,modifyDrawDefinition:()=>ide,modifyDrawName:()=>t4,modifySeedAssignment:()=>yce,pruneDrawDefinition:()=>rde,qualifierDrawPositionAssignment:()=>OW,qualifierProgression:()=>bce,removeDrawPositionAssignment:()=>yC,removeRoundMatchUps:()=>lde,removeSeededParticipant:()=>Nce,removeStructure:()=>Tce,renameStructures:()=>Sce,resetDrawDefinition:()=>nde,resetQualifyingStructure:()=>Ece,resetVoluntaryConsolationStructure:()=>nue,setDrawParticipantRepresentativeIds:()=>zle,setPositionAssignments:()=>dce,setStructureOrder:()=>Ice,setSubOrder:()=>ude,shiftAdHocRounds:()=>cce,swapAdHocRounds:()=>pce,swapDrawPositionAssignments:()=>Rce,updateTeamLineUp:()=>m0,withdrawParticipantAtDrawPosition:()=>Que});var _3=t=>e=>t[e],k3=(t=[])=>t.map(Ma).filter(Boolean),TG=(t=[])=>t.map(Vi).filter(Boolean),Vi=(t={})=>_3(t)("participantId"),Ma=(t={})=>_3(t)("matchUpId"),hC=(t={})=>_3(t)("drawId");function zle({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:cu};if(!Array.isArray(t))return{error:Ee};let i=TG(e?.entries||[]);return t.length&&Dr(t,i).length<t.length?{error:Ee}:dL({drawDefinition:e,extension:{name:N3,value:t}})}var al="ABANDONED",i0="AWAITING_RESULT",nh="CANCELLED",Ur="COMPLETED",nD="DEAD_RUBBER",On="DEFAULTED",sa="DOUBLE_DEFAULT",cr="DOUBLE_WALKOVER",hd="IN_PROGRESS",_l="INCOMPLETE",x3="NOT_PLAYED",_a="RETIRED",Tv="SUSPENDED",Er="TO_BE_PLAYED",ir="WALKOVER",qle=[i0,Ur,On,hd,_l,_a,Tv],O3=[i0,Ur,On,cr,sa,hd,_l,_a,Tv,ir],L3=[al,i0,"BYE",nh,Ur,nD,On,cr,sa,hd,_l,x3,_a,Tv,Er,ir],F3=["BYE",cr,sa,Ur,On,_a,ir],$3=[al,i0,nh,nD,hd,_l,x3,Tv,Er,void 0],Yr=[nh,al,Ur,nD,On,cr,sa,_a,ir],gL=[al,Ur,On,cr,sa,hd,_a,ir],B3=[hd,_l,Tv,Er],V3={ABANDONED:al,AWAITING_RESULT:i0,BYE:"BYE",CANCELLED:nh,COMPLETED:Ur,DEAD_RUBBER:nD,DEFAULTED:On,DOUBLE_WALKOVER:cr,DOUBLE_DEFAULT:sa,IN_PROGRESS:hd,INCOMPLETE:_l,NOT_PLAYED:x3,RETIRED:_a,SUSPENDED:Tv,TO_BE_PLAYED:Er,WALKOVER:ir};function n0(t,e,i){let n=d=>_i({element:d,name:ih})?.extension?.value,r=i?.deprioritizeCompleted,a=i?.mode===wle&&S_e,s=i?.mode===Ile&&Sle,o=s||a||lw,l=d=>d?.stage===Nt&&d?.stageSequence===1,u=d=>l(d)?-1:o[d?.stage],c=d=>d?.matchUps.every(({matchUpStatus:p})=>Yr.includes(p)?1:-1);return r&&c(t)-c(e)||a&&u(t)-u(e)||(t?.stage&&o[t.stage]||0)-(e?.stage&&o[e.stage]||0)||(n(t)||0)-(n(e)||0)||!s&&!a&&(e?.positionAssignments?.length??1/0)-(t?.positionAssignments?.length??1/0)||(t?.stageSequence??0)-(e?.stageSequence??0)||(gk(t)||0)-(gk(e)||0)}function gk(t){return(t?.matchUps||[]).reduce((e,i)=>{let n=(i.finishingPositionRange?.winner||[]).reduce((r,a)=>r+a,0);return!e||n<e?n:e},void 0)}function li(t){let e=zt(t,[{[zs]:!0,[aL]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:n}=t,{structures:r}=rd({drawDefinition:i}),a=r?.map(l=>l.structures?[...l.structures].concat(l):l).flat(),s=a?.find(l=>l.structureId===n);if(!s)return{error:or};let o=s.structureType===iL?a?.find(l=>l.structures?.some(u=>u.structureId===n)):void 0;return{structure:s,containingStructure:o}}function rd({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:n,roundTarget:r,sortConfig:a,stages:s,stage:o}){let l=!e&&Ot||!e?.structures&&kq||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let u=f=>{let m=_i({element:f,name:ih})?.extension?.value;return!r||r===m},c=e?.structures?.filter(p).filter(h).filter(u).sort((f,m)=>n0(f,m,a))??[],d=t?Object.assign({},...eL.map(f=>{let m=c?.filter(g=>g.stage===f);return m?.length&&{[f]:m}}).filter(Boolean)):{};return{structures:c,stageStructures:d};function p(f){return!o&&!Array.isArray(s)||o&&f.stage===o||Array.isArray(s)&&s.includes(f.stage)}function h(f){return!n&&!Array.isArray(i)||n&&f.stageSequence===n||Array.isArray(i)&&i.includes(f.stageSequence)}}function Wle({drawDefinition:t}){if(!t)return{error:Ot};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let n=i.stage;e[n]||(e[n]=[]);let{positionAssignments:r}=Nn({structure:i}),a=r?.map(Vi).filter(Boolean)??[];return e[n].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Nn({drawDefinition:t,structureId:e,structure:i}){let n,r=[];if(!i){if(!t)return{positionAssignments:r,error:Ot};if({structure:i,error:n}=li({drawDefinition:t,structureId:e}),n)return{positionAssignments:r,error:n}}return i.structures?r=[].concat(...i.structures.map(a=>Nn({structure:a}).positionAssignments)):i.positionAssignments?r=i.positionAssignments:n=Cse,{positionAssignments:r,error:n}}function ua({drawDefinition:t,structureId:e,structure:i}){let n=Nn({drawDefinition:t,structureId:e,structure:i})?.positionAssignments||[],r=n?.filter(u=>u.participantId??u.bye??u.qualifier),a=n&&n?.length===r?.length,s=n?.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),o=n?.filter(u=>!u.participantId&&u.bye),l=n?.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:a,positionAssignments:n,unassignedPositions:s,assignedPositions:r,qualifierPositions:l,byePositions:o}}var j3="addDrawDefinition",vL="addMatchUps",Wg="addParticipants",G3="addScaleItems",Yle="addEvent",Kle="addVenue",im="audit",H3="dataIssue",z3="deleteParticipants",q3="deleteVenue",W3="deletedDrawIds",Y3="deletedMatchUpIds",K3="modifyDrawDefinition",Zle="modifyDrawEntries",Xle="modifyEventEntries",Z3="modifyMatchUp",Us="modifyParticipants",X3="modifyPositionAssignments",J3="modifySeedAssignments",Db="modifyTournamentDetail",Eb="modifyVenue",fC="mutations",UG="publishEvent",Jle="publishEventSeeding",Qle="publishOrderOfPlay",eue="publishParticipants",Q3="unPublishEvent",eW="unPublishEventSeeding",tW="unPublishOrderOfPlay",ske="unPublishParticipants",yL="updateInContextMatchUp",tue={ADD_DRAW_DEFINITION:j3,ADD_MATCHUPS:vL,ADD_PARTICIPANTS:Wg,ADD_SCALE_ITEMS:G3,ADD_EVENT:Yle,ADD_VENUE:Kle,AUDIT:im,DATA_ISSUE:H3,DELETE_PARTICIPANTS:z3,DELETE_VENUE:q3,DELETED_DRAW_IDS:W3,DELETED_MATCHUP_IDS:Y3,MODIFY_DRAW_DEFINITION:K3,MODIFY_DRAW_ENTRIES:Zle,MODIFY_EVENT_ENTRIES:Xle,MODIFY_MATCHUP:Z3,MODIFY_PARTICIPANTS:Us,MODIFY_POSITION_ASSIGNMENTS:X3,MODIFY_SEED_ASSIGNMENTS:J3,MODIFY_TOURNAMENT_DETAIL:Db,MODIFY_VENUE:Eb,MUTATIONS:fC,PUBLISH_EVENT_SEEDING:Jle,PUBLISH_EVENT:UG,PUBLISH_ORDER_OF_PLAY:Qle,PUBLISH_PARTICIPANTS:eue,UNPUBLISH_EVENT_SEEDING:eW,UNPUBLISH_EVENT:Q3,UNPUBLISH_ORDER_OF_PLAY:tW,UPDATE_INCONTEXT_MATCHUP:yL};function bL(t,e){if(!t)return{error:Ot};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let n=new Date(i).toISOString(),r=e?.filter(Boolean);return t.updatedAt=n,t.structures?.filter(Boolean).forEach(a=>{(!r?.length||r?.includes(a.structureId))&&(a.updatedAt=n)}),{...le}}function Yg({drawDefinition:t,tournamentId:e,matchUps:i,eventId:n}){return t&&bL(t),Ti({payload:{matchUps:i,tournamentId:e,eventId:n},topic:vL}),{...le}}function ff({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:n,action:r}){t&&bL(t),Ti({topic:Y3,payload:{tournamentId:e,matchUpIds:i,eventId:n,action:r}});for(let a of i)s3({key:a});return{...le}}function Zi({drawDefinition:t,tournamentId:e,structureId:i,context:n,eventId:r,matchUp:a}){return a?(t&&Ln({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:r}),Ti({topic:Z3,payload:{matchUp:a,tournamentId:e,context:n},key:a.matchUpId}),{...le}):(console.log(Oo),{error:Oo})}function oke({tournamentId:t,inContextMatchUp:e}){return e?(Ti({payload:{inContextMatchUp:e,tournamentId:t},topic:yL,key:e.matchUpId}),{...le}):{error:Oo}}function nR({tournamentId:t,eventId:e,drawDefinition:i}){return i?(bL(i),Ti({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:j3,key:i.drawId}),{...le}):(console.log(Ot),{error:Ot})}function lke({tournamentId:t,eventId:e,drawId:i}){return Ti({payload:{drawId:i,tournamentId:t,eventId:e},topic:W3,key:i}),s3({key:i}),{...le}}function Ln({drawDefinition:t,tournamentId:e,structureIds:i,eventId:n}){return t?(bL(t,i),Ti({payload:{tournamentId:e,eventId:n,drawDefinition:t},topic:K3,key:t.drawId}),{...le}):{error:Ot}}function iue({drawDefinition:t,tournamentId:e,structure:i,eventId:n}){if(!t)return{error:Ot};if(!i)return{error:wb};let r=i.seedAssignments,a=i.structureId,s=t.drawId;return Ti({payload:{tournamentId:e,eventId:n,drawId:s,structureId:a,seedAssignments:r},topic:J3,key:t.drawId}),Ln({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:n}),{...le}}function Kg({drawDefinition:t,tournamentId:e,structure:i,event:n}){if(!t)return{error:Ot};if(!i)return{error:wb};let r=Nn({structure:i}),a=i.structureId,s=t.drawId,o=n?.eventId;return Ti({topic:X3,payload:{positionAssignments:r,tournamentId:e,structureId:a,eventId:o,drawId:s},key:a}),Ln({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:o}),{...le}}function nue({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:n}){if(!e)return{error:Ot};let r=e.structures?.find(s=>s.stage===Ga);if(!r)return{error:or};let a=r.matchUps?.map(({matchUpId:s})=>s)||[];return r.positionAssignments=[],r.seedAssignments=[],r.matchUps=[],ff({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(s=>s.entryStage!==Ga)),Ln({tournamentId:t?.tournamentId,eventId:n?.eventId,drawDefinition:e,structureIds:[r.structureId]}),{...le}}function iW({drawPositions:t,structure:e}){if([qt,Nt].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=Nn({structure:e});i?.filter(({drawPosition:n})=>t?.includes(n))?.forEach(n=>{un({element:n,extension:{name:fL,value:!0}})})}function IL(t){let{appliedPolicies:e,positionAction:i,drawDefinition:n}=t;if(e?.audit?.[dT]===!1)return;let{extension:r}=_i({name:dT,element:n}),a=Array.isArray(r?.value)?r?.value??[]:[];if(!a?.length){let o=n.structures.find(l=>l.stage===Nt);if(o){let l=Nn({structure:o}).positionAssignments?.map(({drawPosition:u,participantId:c,bye:d,qualifier:p})=>({drawPosition:u,participantId:c,qualifier:p,bye:d}));a.push({name:"initialMainAssignments",initialAssignments:l})}}let s={value:a.concat(i),name:dT};un({element:n,extension:s})}function rD({tournamentRecord:t,drawDefinition:e,event:i}){let n=(t?.events||i&&[i])?.map(o=>o?.drawDefinitions).flat().filter(Boolean)||e&&[e]||[],r={},a={},s=n.map(o=>o?.structures?.filter(l=>l?.structures)).flat().filter(Boolean);for(let o of s){let{structures:l,structureId:u}=o??{};l&&u&&(r[u]=l?.map(c=>c.structureId))&&l.forEach(c=>a[c.structureId]=o?.structureId)}return{containedStructures:r,containerStructures:a}}function wL(t){let{sides:e,matchUpType:i}=t||{},n=t.potentialParticipants?.length?t.potentialParticipants.flat().map(a=>i===Dn?a?.individualParticipantIds||[]:a.participantId).flat():[],r=(e||[]).map(a=>i===Dn&&(a?.participant?.individualParticipantIds||[])||a?.participantId&&[a.participantId]||[]).flat();return{individualParticipantIds:r.concat(n).flat(),enteredIndividualParticipantIds:r,potentialIndividualParticipantIds:n}}function ic(t){return t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var rR="SIGN_IN_STATUS",rue="SIGNED_OUT",mC="SIGNED_IN",_o="TEAM",ji="INDIVIDUAL",Iu="GROUP",Ni="PAIR",wn="TEAM",pT={TEAM_PARTICIPANT:_o,INDIVIDUAL:ji,GROUP:Iu,TEAM:wn,PAIR:Ni},qs={INDIVIDUAL:ji,GROUP:Iu,PAIR:Ni,TEAM:wn,SIGN_IN_STATUS:rR,SIGNED_OUT:rue,SIGNED_IN:mC};function SL({participantsProfile:t,participants:e=[],deepCopy:i}){let n=new Map,r=i!==!1?Ct(e,t?.convertExtensions,!0):e,a=r.filter(l=>l.participantType===wn),s=r.filter(l=>l.participantType===Iu),o=r.filter(l=>l.participantType===Ni);return r.forEach(l=>{if(l.participantType===ji){let{participantId:u}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.teamParticipantIds?.includes(c.participantId)&&(l.teamParticipantIds.push(c.participantId),n.get(c.participantId)||n.set(c.participantId,{participantName:c.participantName,participantId:c.participantId}),l.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),o.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.pairParticipantIds.includes(c.participantId)&&l.pairParticipantIds.push(c.participantId)})}),s.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.groupParticipantIds.includes(c.participantId)&&(l.groupParticipantIds.push(c.participantId),l.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),{participantsWithGroupings:r,groupInfo:Object.fromEntries(n)}}function aue(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function uke(t){let e=Object.assign({},...$g.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return aue(e[t])}var $g=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function sue({participant:t,withISO2:e,withIOC:i}){let{person:n,individualParticipants:r}=t,a=[n,r?.map(({person:o})=>o)].flat().filter(Boolean);function s(o){let{nationalityCode:l}=o||{};if(l){let u=$g.find(({iso:c})=>c===l);i&&u?.ioc&&!o.iocNationalityCode&&(o.iocNationalityCode=u.ioc),e&&u?.iso2&&!o.iso2NationalityCode&&(o.iso2NationalityCode=u.iso2),u?.label&&!o.countryName&&(o.countryName=u.label)}}a.forEach(s)}function cke({participantMap:t,template:e}){let i=Object.values(t);for(let n of i){let r=n.participant;if(r.individualParticipantIds?.length){r.individualParticipants=[];for(let a of r.individualParticipantIds){let s=t[a].participant;r.individualParticipants.push(e?uw({template:e,source:s}):s)}}}}function Uv(t){let{tournamentRecord:e,participantId:i}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let r of Object.values(n)){let a=r.participants?.find(s=>s.participantId===i);if(a)return{participant:a,tournamentId:r.tournamentId}}return{error:Nr}}function oue(t){let{tournamentRecord:e,participantId:i}=t;if(i){let r=Uv({tournamentRecord:e,participantId:i});return r.participant??r}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Zt}}function nc(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:n}=t,r=oue(t);if(r.error)return r;if(i&&!Array.isArray(i))return{error:Ee,context:{itemSubTypes:i}};if(!Array.isArray(r.timeItems))return{error:Xq};let a=r.timeItems.filter(o=>o?.itemType===n).filter(o=>!i?.length||i.some(l=>o?.itemSubTypes?.includes(l))).sort((o,l)=>{let u=new Date(o.createdAt||void 0).getTime(),c=new Date(l.createdAt||void 0).getTime();return u-c}),s=Ct(a.pop(),!1,!0);if(s){let o={timeItem:s,...le};return e&&Object.assign(o,{previousItems:a}),o}else return{info:Ya}}function nW({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:n}){if(!e)return{error:Zd};if(!e.timeItems)return{info:Ya};let{timeItem:r,previousItems:a,info:s}=nc({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:s}}function aR({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:n}){if(!n)return{error:qn};if(!n.timeItems)return{info:Ya};let{timeItem:r,previousItems:a,info:s}=nc({returnPreviousValues:t,element:n,itemSubTypes:e,itemType:i});return r&&{timeItem:r,previousItems:a}||{info:s}}function TL({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:n}){if(!e)return{error:ot};if(!e.timeItems)return{info:Ya};let{timeItem:r,previousItems:a,info:s}=nc({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:s}}function rW({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:n,itemType:r}){if(!e)return{error:ot};if(!i)return{error:la};let a=Uv({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:s}=a;if(!s?.timeItems)return{info:Ya};let{timeItem:o,previousItems:l,info:u}=nc({element:a.participant,returnPreviousValues:t,itemSubTypes:n,itemType:r});return o&&{timeItem:o,previousItems:l}||{info:u}}var dke={[Iu]:"groupParticipantIds",[Ni]:"pairParticipantIds",[wn]:"teamParticipantIds"},pke={[Iu]:"groups",[wn]:"teams"};function lue({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:n,withScaleValues:r,withGroupings:a,internalUse:s,withISO2:o,withIOC:l}){let u=[],c={};for(let p of i.participants??[]){let h=p?.participantId;h&&mke({participantMap:c,participantId:h})}for(let p of i.participants??[]){let h=Ct(p,e,s),{participantId:f,individualParticipantIds:m,participantType:g}=h;if(!c[f]){u.push(f);continue}if(Object.assign(c[f].participant,h),m){let v=fke({individualParticipantIds:m,participantCopy:h,participantMap:c,participantType:g,participantId:f});v.missingParticipantIds.length&&u.push(...v.missingParticipantIds)}if(n&&(c[f].participant.signedIn=hke(h)),r){let{ratings:v,rankings:y,seedings:b}=eD({participant:h});c[f].participant.seedings=b,c[f].participant.rankings=y,c[f].participant.ratings=v}(l||o)&&sue({participant:c[f].participant,withISO2:o,withIOC:l})}if(t){let p=Ki(t)?t:void 0;cke({participantMap:c,template:p})}let d;return a&&(d=SL({participants:Object.values(c).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:u,participantMap:c,groupInfo:d}}function hke(t){let{timeItem:e}=nc({itemType:rR,element:t});return e?.itemValue===mC}function fke({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:n,participantId:r}){let a=[];for(let s of t){let o=i[s]?.participant;if(!o){a.push(s);continue}if(o[dke[n]].push(r),[wn,Iu].includes(n)){let{participantRoleResponsibilities:l,participantOtherName:u,participantName:c,participantId:d,teamId:p}=e,h=pke[n];o[h].push({participantRoleResponsibilities:l,participantOtherName:u,participantName:c,participantId:d,teamId:p})}if(n===Ni){let l=t.find(u=>u!==s);i[s].pairIdMap[r]=l,i[s].pairIdMap[l]=r}}return{missingParticipantIds:a}}function mke({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[Rn]:{...i},[Dn]:{...i},[wn]:{...i},...i}}}function Pb({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:n,inContext:r}){if(e)return lue({...t,...n,tournamentRecord:i});let a=Ct(i.participants,!1,!0)||[];(t?.withIOC||t?.withISO2)&&a.forEach(o=>sue({participant:o,...t}));let s;if((r||t?.withGroupings)&&a?.length&&({participantsWithGroupings:a,groupInfo:s}=SL({participantsProfile:t,deepCopy:!1,participants:a})),t?.withScaleValues&&a?.length)for(let o of a){let{ratings:l,rankings:u}=eD({participant:o});o.rankings=u,o.ratings=l}return{participants:a,groupInfo:s}}function sn({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:n,structure:r,event:a}){if(!Array.isArray(e))return{error:$q};let s={};return i&&o(i),a&&o(a),n&&o(n),r&&o(r),{appliedPolicies:s,...le};function o(l){let u=l?.extensions?.find(c=>c.name===pC)?.value;if(u)for(let c of Object.keys(u))(t?e.includes(c):!e.length||e.includes(c))&&(s[c]=Ct(u[c],!1,!0))}}function Hm({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:n,event:r}){if(!Array.isArray(t))return{error:$q};let{appliedPolicies:a}=sn({tournamentRecord:e,drawDefinition:i,structure:n,event:r}),s={};for(let o of t){let l=a?.[o];l&&(s[o]=l)}return Object.keys(s).length?{policyDefinitions:s}:{info:j1.message}}var uue="WALKOVER",vX="RETIRED",aW="COMPETITIVE",gC="ROUTINE",vC="DECISIVE",s_="winRatio",gke={[zf]:{policyName:"Competitive Bands Default",profileBands:{[vC]:20,[gC]:50}}},sW=gke;function zm({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:n,event:r}){let a={policies:{}};if(!i)return a;let s=Hm({tournamentRecord:e,drawDefinition:n,event:r}).policyDefinitions;if(i.withCompetitiveness){let o=t?.[zf]??s?.[zf]??sW[zf];a.policies[zf]=o}return a}function Cb({tournamentRecord:t,drawDefinition:e,policyType:i,structure:n,event:r}){if(!t)return{error:ot};let{appliedPolicies:a}=sn({tournamentRecord:t,drawDefinition:e,structure:n,event:r});return a?.[i]?{policy:a[i]}:{info:j1?.message}}function sR({tournamentRecord:t,categoryName:e,categoryType:i,event:n}){e=e??n?.category?.categoryName??n?.category?.ageCategoryCode,i=i??n?.category?.categoryType??n?.category?.subType;let{policy:r}=Cb({policyType:wv,tournamentRecord:t,event:n}),a=(t?_i({element:t,name:mm}).extension:void 0)?.value,s=(n&&_i({name:mm,element:n}).extension)?.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:s,categoryName:e,categoryType:i,policy:r}}}function oW({drawDefinition:t,attributes:e}){let{extension:i}=_i({element:t,name:mk}),n=i?.value||{};return e.forEach(r=>{Object.keys(r).forEach(a=>{n[a]?Object.assign(n[a],r[a]):n[a]=r[a]})}),i={name:mk,value:n},dL({drawDefinition:t,extension:i}),{entryProfile:n}}function oR({drawDefinition:t}){let{extension:e}=_i({element:t,name:mk});return{entryProfile:e?.value||{}}}var Hc="ALTERNATE",lR="CONFIRMED",sl="DIRECT_ACCEPTANCE",uR="FEED_IN",cR="JUNIOR_EXEMPT",vm="LUCKY_LOSER",dR="ORGANISER_ACCEPTANCE",pR="QUALIFIER",vke="REGISTERED",hR="SPECIAL_EXEMPT",rc="UNGROUPED",Rb="UNPAIRED",$T="WILDCARD",Jh="WITHDRAWN",o_=[lR,sl,cR,dR,hR],cue=[uR,vm,pR],Mb=[lR,sl,uR,cR,dR,hR,$T],fd=[lR,sl,cR,vm,pR,dR,hR,$T],due=[Hc,lR,sl,uR,cR,vm,dR,pR,vke,hR,rc,Rb,$T,Jh],md={ALTERNATE:Hc,CONFIRMED:lR,DIRECT_ACCEPTANCE:sl,DIRECT_ENTRY_STATUSES:Mb,DRAW_SPECIFIC_STATUSES:cue,EQUIVALENT_ACCEPTANCE_STATUSES:o_,FEED_IN:uR,JUNIOR_EXEMPT:cR,LUCKY_LOSER:vm,ORGANISER_ACCEPTANCE:dR,QUALIFIER:pR,SPECIAL_EXEMPT:hR,STRUCTURE_SELECTED_STATUSES:fd,UNGROUPED:rc,UNPAIRED:Rb,VALID_ENTRY_STATUSES:due,WILDCARD:$T,WITHDRAWN:Jh};function lW({stage:t,drawDefinition:e}){let{entryProfile:i}=oR({drawDefinition:e}),n=Object.keys(i).includes(t);if(!n&&eL.includes(t)){let r=[{[t]:{drawSize:void 0,alternates:!0}}];return oW({drawDefinition:e,attributes:r}),!0}return n}function yke({stage:t,drawDefinition:e}){let{entryProfile:i}=oR({drawDefinition:e});return i[t]?.alternates||0}function bke({stage:t,drawDefinition:e}){let{entryProfile:i}=oR({drawDefinition:e});return i[t]?.wildcardsCount||0}function DG({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((n,r)=>r.entryStage===t&&r.entryStatus===i?n+1:n,0)}function r0({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:n,entryStatuses:r,structureId:a,roundTarget:s,stages:o,stage:l}){let u=i.entries?.reduce((c,d)=>{let p=_i({name:ih,element:d})?.extension?.value,h=l&&d.entryStage===l||o?.length&&d.entryStage&&o.includes(d.entryStage),f=!r||d.entryStatus&&r.includes(d.entryStatus),m=d.entryStageSequence??1;return h&&(!n||m===n)&&f&&(!s||!p||s===p)?c.concat(d):c},[])??[];if(a&&l===Sr){let{playoffEntries:c,error:d}=Ike({provisionalPositioning:t,drawDefinition:i,structureId:a});return d&&console.log("playoff entries error"),(c?.length?c:u).filter(p=>!e||p.placementGroup===e)}return u}function Ike({provisionalPositioning:t,drawDefinition:e,structureId:i}){let n=[],r=(e.links??[]).find(a=>a.linkType===qh&&a.target.structureId===i);if(r){let{finishingPositions:a,structureId:s}=r.source,{structure:o}=li({drawDefinition:e,structureId:s});o?.structureType===To&&(o.structures??[]).forEach(l=>{let u=l.positionAssignments??[],{structureId:c}=l,d=c,p=Object.assign({},...u.map(m=>{let{participantId:g}=m,v=_i({element:m,name:gm}).extension?.value;return v&&g?{[g]:v}:void 0}).filter(Boolean)),h=Object.keys(p).reduce((m,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return m.includes(y)||m.push(y),m},[]).length===Object.keys(p).length,f=Object.keys(p).filter(m=>{let g=p[m],v=g.groupOrder||t&&g.provisionalOrder;return a?.includes(v)});(!t||h)&&f.forEach(m=>{let g=p[m],{groupOrder:v,provisionalOrder:y,GEMscore:b}=g,I=v||t&&y,S=[...a??[]].sort(ia).indexOf(I)+1;n.push({entryStage:Sr,entryStatus:uR,placementGroup:S,groupingValue:d,participantId:m,GEMscore:b})})})}return{playoffEntries:n}}function wke({stage:t,drawDefinition:e}){return Mb.reduce((i,n)=>(DG({drawDefinition:e,entryStatus:n,stage:t})||0)+i,0)}function Zu({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:n,structure:r}){let a,s=[];r||({structure:r,error:a}=li({drawDefinition:i,structureId:n}));let o=Nn({structure:r}).positionAssignments;if(a||!r)return{seedAssignments:[],error:or};n||(n=r.structureId);let{stage:l,stageSequence:u}=r,c=l===Sr&&i&&r0({provisionalPositioning:t,drawDefinition:i,stageSequence:u,structureId:n,stage:l}),d=c?c.filter(f=>f.placementGroup===1).sort((f,m)=>f.GEMscore<m.GEMscore&&1||f.GEMscore>m.GEMscore&&-1||0).map((f,m)=>{let g=m+1;return{participantId:f.participantId,seedValue:g,seedProxy:!0,seedNumber:g}}):[],p=d?.slice(0,e?d.length:o.length/2);p.length?s=p:r.seedAssignments?s=r.seedAssignments:a=yse;let h=r.seedLimit??r?.positionAssignments?.length;return{seedAssignments:s,stageSequence:u,seedLimit:h,stage:l,error:a}}function hp(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(n=>n.tieFormatId===e)}function pP({item:t,drawDefinition:e,structure:i,event:n}){if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:e.tieFormats?.find(a=>t.tieFormatId===a.tieFormatId)||(n.tieFormat?n.tieFormat:n.tieFormats?.find(a=>t.tieFormatId===a.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let r=e.tieFormats?.find(a=>i.tieFormatId===a.tieFormatId);if(r)return r}}}function Zs({drawDefinition:t,structure:e,matchUp:i,event:n}){return{tieFormat:pP({item:i,drawDefinition:t,structure:e,event:n})||pP({item:e,drawDefinition:t,structure:e,event:n})||hp(t)||hp(n)}}function Ske({matchUps:t}){let e=t.reduce((i,n)=>!n.collectionPosition||i.includes(n.collectionPosition)?i:i.concat(n.collectionPosition),[]).map(i=>({[i]:t.filter(n=>n.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function us({drawDefinition:t,structure:e}){let i={},n=[];return(t?.structures??[e]).filter(r=>r&&typeof r=="object").forEach(r=>{if(!r)return;let{structureId:a,matchUps:s,structures:o}=r,l=Array.isArray(o);if(l)l&&o.forEach(u=>{let{structureName:c}=u,d=u.matchUps;i[u.structureId]={matchUps:d,itemStructureIds:[],structureName:c},d&&(n.push(...d),d.forEach(p=>{p.tieMatchUps&&n.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(u.structureId)});else{let u=s;i[a]={matchUps:u,itemStructureIds:[]},u?.forEach(c=>{n.push(c),c.tieMatchUps&&n.push(...c.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:n}}function Zg({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:n}){t=e?.mappedMatchUps??t;let r=t[i],a=(r?.itemStructureIds||[]).map(s=>{let{matchUps:o,structureName:l}=t[s];return n?o.map(u=>Object.assign(Ct(u,!0,!0),{containerStructureId:i,structureId:s,structureName:l})):o}).flat();return(r?.matchUps||[]).concat(...a)}function pue({groupedOrder:t,roundPositionsCount:e}){if(!t||t?.length<=e)return t;let i=Aa(t,t.length/e).map(r=>r.reduce((a,s)=>a+s)),n=i.slice().sort(ia);return i.map(r=>n.indexOf(r)+1)}function UL(t){if(!Ki(t))return!1;let{matchUpId:e,drawPositions:i}=t,n=typeof e=="string",r=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>yi(a)||a===void 0||a===null);return n&&r}function ac(t){return Array.isArray(t)?t.every(UL):!1}function go({matchUps:t=[],interpolate:e}){if(!ac(t))return{roundMatchUps:[],error:Ee};let i=t.reduce((d,p)=>{let h=typeof p.roundNumber=="string"?ri(p.roundNumber):p.roundNumber;return!p.roundNumber||d.includes(h)?d:d.concat(h)},[]).sort(ia).map(d=>{let p=t.filter(m=>m.roundNumber===d),h=p.find(({matchUpType:m})=>m===Hn)?p.filter(({matchUpType:m})=>m===Hn):p,f=m=>m.sort((g,v)=>ia(g.roundPosition,v.roundPosition));return{[d]:f(h)}}),n=t.reduce((d,p)=>{let h=typeof p.roundNumber=="string"?ri(p.roundNumber):p.roundNumber;return d[h]||(d[h]=Vt({abbreviatedRoundName:p.abbreviatedRoundName,finishingRound:p.finishingRound,roundName:p.roundName})),d},{}),r=Object.assign({},...i);if(e){let d=Math.max(...Object.keys(r).map(h=>ri(h)).filter(h=>!isNaN(h))),p=r[d]?.length;if(p>1&&$d(p)){let h=d+1,f=h+p/2;Dt(h,f).forEach((m,g)=>{r[m]=Dt(0,p/(2+g*2)).map(()=>({}))})}}let a=0,s=Object.assign({},...Object.keys(r).map(d=>{let p=r[d]?.length,h=r[d]?.filter(m=>!Yr.includes(m.matchUpStatus)&&!m.score?.scoreStringSide1)?.length,f=p&&p===h;return a=Math.max(a,p),{[d]:{matchUpsCount:p,inactiveCount:h,inactiveRound:f}}})),o=0,l=0,u=Object.keys(r).map(d=>ri(d)).filter(d=>!isNaN(d));u.forEach(d=>{let p=r[d].sort((f,m)=>f.roundPosition-m.roundPosition),h=p.map(f=>f?.drawPositions||[]).flat();if(s[d].roundNumber=d,s[d].roundFactor=s[d].matchUpsCount?a/s[d].matchUpsCount:1,s[d].finishingRound=n[d]?.finishingRound,s[d].roundName=n[d]?.roundName,s[d].abbreviatedRoundName=n[d]?.abbreviatedRoundName,s[d].finishingPositionRange=r[d]?.[0]?.finishingPositionRange,d===1||!s[d-1]){let f=h.sort(ia),m=Aa(f,2);s[d].drawPositions=f,s[d].pairedDrawPositions=m}else{let f=s[d-1],m=f.drawPositions,g=f.matchUpsCount/s[d].matchUpsCount,v=Aa(m,g),y=p.map(b=>{let{roundPosition:I}=b,S=[...b.drawPositions||[],void 0,void 0].slice(0,2);if(!I)return S;let w=S?.filter(Boolean)||[];if(!w?.length)return[void 0,void 0];if(d<3&&w?.length===2)return S?.slice().sort(ia);let T=Dr(m,w).length!==w?.length;if(w?.length&&T)return w?.length===1?[w[0],void 0]:S?.slice().sort(ia);let U=(I-1)*2;return v.slice(U,U+2).map(C=>w?.find(E=>C.includes(E)))});s[d].drawPositions=y?.flat(),s[d].pairedDrawPositions=y}s[d+1]&&s[d+1].matchUpsCount===s[d].matchUpsCount&&(s[d+1].feedRound=!0,s[d+1].feedRoundIndex=l,s[d].preFeedRound=!0,l+=1),s[d]&&!s[d].feedRound&&(s[d].roundIndex=o,o+=1)});let c=!!Object.values(s).find(({matchUpsCount:d})=>!$d(d));return{hasNoRoundPositions:t.some(d=>!d.roundPosition),roundsNotPowerOf2:c,maxMatchUpsCount:a,roundMatchUps:r,roundNumbers:u,roundProfile:s,...le}}function l_(t){if(!Array.isArray(t))return"";let e=t.filter(br);return e.length?wi([Math.min(...e),Math.max(...e)]).join("-"):""}function Tke({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:Ot};if(!e)return{error:yu};let{structure:n}=li({drawDefinition:t,structureId:e});if(n?.stage!==Ts)return{error:Sb,info:"Structure is not CONSOLATION stage"};let{links:r}=t,a=r?.filter(d=>d.target.structureId===e)||[],s=a?.reduce((d,p)=>{let{structureId:h}=p.source;return d.includes(h)?d:d.concat(h)},[])||[],o=Object.assign({},...s.map(d=>{let p=Zg({structureId:d,matchUpsMap:i}),h=go({matchUps:p}).roundProfile;return{[d]:h}})),l=Zg({matchUpsMap:i,structureId:e}),{roundProfile:u}=go({matchUps:l}),c={};return a?.forEach(d=>{let{structureId:p,roundNumber:h}=d.source,{feedProfile:f,groupedOrder:m,positionInterleave:g,roundNumber:v}=d.target,y=o[p],b=y[1]?.drawPositions,I=y[h]?.matchUpsCount;if(!I)return;let S=I?b.length/I:0,w=b.length/S,T=b.slice(),U=pue({roundPositionsCount:w,groupedOrder:m}),C=U?.length||1;if(C<=w){let M=b.length/C,R=Aa(T,M);f===zy&&R.forEach(N=>N.reverse()),T=U?.length&&U?.map(N=>R[N-1]).flat()||R.flat()}let E=Aa(T,S);if(g){let M=Dt(0,g.interleave).map(()=>{}),R=Dt(0,g.offset).map(()=>{});E=E.map(A=>[A,...M]),E.unshift(R),E=E.flat(1);let N=E.length-g.offset;E=E.slice(0,N)}c[v]||(c[v]={});let P=u?.[v]?.feedRound?2:1;E.forEach((M,R)=>{let N=1+R*P;c[v][N]||(c[v][N]=l_(M))})}),{sourceDrawPositionRanges:c}}function hue({drawDefinition:t}){if(typeof t!="object")return{error:_I};let e={},{structures:i=[],links:n=[]}=t||{},r=i.reduce((s,o)=>{let{stage:l}=o;return s[l]?s[l].push(o):s[l]=[o],s},{});for(let s of Object.keys(r)){let o=r[s].find(({stageSequence:u})=>u===1);if(!o)continue;let{structureId:l}=o;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:s})}return{exitProfiles:e};function a({exitProfiles:s,exitProfile:o,structureId:l,targetRound:u,aggregator:c,stage:d}){s[l]||(s[l]=[]),o==="0"&&[Ts,Sr].includes(d)||s[l].push(o);let p=n.filter(h=>h.source.structureId===l&&h.source.roundNumber>=u);for(let h of p){let f=h.source.roundNumber,m=h.target.roundNumber,g=h.target.structureId,v=i.find(b=>b.structureId===g).stage,y=[v,g,m,f].join("|");if(c[y])return;c[y]=!0,a({exitProfile:`${o}-${f}`,structureId:g,exitProfiles:s,targetRound:m,aggregator:c,stage:v})}}}function Uke({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:n}){if(!t)return{error:Ot};if(!i)return{error:yu};if(!e){let s=Zg({matchUpsMap:n,structureId:i});if({roundProfile:e}=go({matchUps:s}),!e)return{error:Zt}}let r=(Math.min(...e?.[1]?.drawPositions??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{let o=e?.[s]?.matchUpsCount,l=e?.[1]?.drawPositions??[],u=Aa(l,l.length/o),c=u.map(l_),d=u.map(g=>g.map(v=>v-r)).map(l_),p=a.map(g=>{if(g>s)return;let v=e?.[g]?.drawPositions??[];return Aa(v,v.length/o)}).filter(Boolean),h=Dt(0,o).map(g=>p.map(v=>v[g]).flat().filter(Boolean).sort(ia)).map(g=>wi(g)),f=h.map(g=>tAe(g).map(l_).join(", ")),m=Object.assign({},...Dt(0,o).map(g=>({[g+1]:{firstRoundDrawPositionsRange:c[g],firstRoundOffsetDrawPositionsRange:d[g],possibleDrawPositions:h[g],drawPositionsRange:f[g]}})));return{[s]:m}}))}}function uW({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:n}){if(!i)return!1;n=n??i.matchUps??[],t=t??go({matchUps:n}).roundsNotPowerOf2;let r=!!i.positionAssignments?.find(({drawPosition:a})=>a)||!!n?.find(({drawPositions:a})=>a?.length);return(!e?.drawType||e.drawType!==Tb)&&!i?.structures&&t&&r}function Fo({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!e?.find(r=>r?.roundPosition),n=!!e?.find(r=>r?.drawPositions?.length);return!t?.structures&&t?.stage!==Ga&&(!e.length||!i&&!n)}var cW={[hm]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Nt]:"",[Sr]:"P",[qt]:"Q",[Ts]:"C"}}},Dke=cW;function fue({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:n}){let{roundProfile:r,roundMatchUps:a}=go({matchUps:n}),{structureAbbreviation:s,stage:o}=i,l=Fo({structure:i}),u=uW({structure:i}),c=i.structures,d={},p=cW[hm],h=i.stage===qt,f=h?Math.max(...(e?.structures??[]).filter(M=>M.stage===qt).map(({stageSequence:M})=>M??1),0):0,m=(i.stageSequence??1)<f?i.stageSequence??1:"",g=m&&(t?.affixes?.preQualifying||p.affixes.preQualifying)||"",v=t?.roundNamingMap||p.roundNamingMap||{},y=t?.abbreviatedRoundNamingMap||p.abbreviatedRoundNamingMap||{},b=t?.affixes?.preFeedRound||p.affixes.preFeedRound,I=t?.affixes?.roundNumber||p.affixes.roundNumber,S=(t?.namingConventions||p.namingConventions).round,w=o&&o!==Nt?o[0]:"",T=t?.stageConstants||p.stageConstants,U=o&&T?.[o]||w,C=`${g}${U}${m}`,E=r?Object.keys(r):[],P=h&&T?.[qt]?`${T?.[qt]}-`:"";if(c||l||u)Object.assign(d,...E.map(M=>{let R=`${P}${S} ${M}`,N=`${I}${M}`;return{[M]:{roundName:R,abbreviatedRoundName:N}}}));else{let M=h&&(t?.qualifyingFinishMap||p?.qualifyingFinishMap||{});Object.assign(d,...E.map(R=>{if(!r?.[R])return;let{matchUpsCount:N,preFeedRound:A}=r[R],_=N*2,x=M?.[r?.[R].finishingRound]||M&&`${I}${_}`||v[N]||`${I}${_}`,O=A?`-${b}`:"",$=`${x}${O}`,F=[C,s,$].filter(Boolean).join("-"),j=`${y[N]||`${I}${_}`}${O}`,H=[C,s,j].filter(Boolean).join("-");return{[R]:{abbreviatedRoundName:H,roundName:F}}}))}return{roundNamingProfile:d,roundProfile:r,roundMatchUps:a}}var Eke=(t,e)=>(t||0)+(e||0);function mue(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&uue||i<=e[vC]&&vC||i<=e[gC]&&gC||aW}function gue({score:t}){let e=t?.sets||[],i=e.reduce((r,a)=>(r[0]+=a.side1Score||0,r[1]+=a.side2Score||0,r),[0,0]),n=e.reduce((r,a)=>(r[0]+=a.side1TiebreakScore||0,r[1]+=a.side2TiebreakScore||0,r),[0,0]);return n.reduce(Eke)&&(i[n[0]>n[1]?0:1]+=1),{sets:e,games:i,score:t}}function Pke(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function vue(t){return t.map(Pke).sort().map(e=>parseFloat(e.toFixed(2)))}function fR({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:Oo};let{score:n,winningSide:r}=i;if(!r)return{error:Ee};let a=!e&&t&&Cb({policyType:zf,tournamentRecord:t}).policy,s=e||a?.profileBands||sW[zf].profileBands,o=gue({score:n}),l=vue([o]),u=mue(l,s),c=Array.isArray(l)?l[0]:l;return{...le,competitiveness:u,pctSpread:c}}function yue({matchUp:t}){if(!t)return{error:Oo};if(t&&!t.sides)return{error:rl};if(t&&!t.hasContext)return{error:HO};let e=(t.sides??[])?.map(s=>s?.participantId).filter(Boolean),i=t.sides?.filter(s=>s.participant?.participantType===ji).map(s=>s.participantId).filter(Boolean)??[],n=((t.sides??[])?.map(s=>s.participant?.individualParticipants).filter(Boolean)??[]).map(s=>(s??[]).map(o=>o?.participantId).filter(Boolean)),r=[...i,...n.flat()].filter(Boolean)??[],a=wi(r.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:n,allRelevantParticipantIds:a,individualParticipantIds:r,sideParticipantIds:e,...le}}var vk="CHECK_IN",yk="CHECK_OUT",Cke="SCHEDULE",a0="SCHEDULE.ASSIGNMENT.VENUE",Qh="SCHEDULE.ALLOCATION.COURTS",Xg="SCHEDULE.ASSIGNMENT.COURT",DL="SCHEDULE.COURT.ORDER",s0="SCHEDULE.DATE",Rke="COMPLETED.DATE",dW="HOME_PARTICIPANT_ID",pW="SCHEDULE.ASSIGN.OFFICIAL",o0="SCHEDULE.TIME.SCHEDULED",Ed="SCHEDULE.TIME.START",nm="SCHEDULE.TIME.STOP",Ah="SCHEDULE.TIME.RESUME",ym="SCHEDULE.TIME.END",EL="SCHEDULE.TIME.MODIFIERS",bue="TO_BE_ANNOUNCED",Iue="NEXT_AVAILABLE",wue="FOLLOWED_BY",Sue="AFTER_REST",Tue="RAIN_DELAY",Mke="NOT_BEFORE",EG=[bue,Iue,wue,Sue,Tue],Nke="ELIGIBILITY",Ake="REGISTRATION",_ke="SUSPENSION",kke="MEDICAL",xke="PENALTY",Uue="SCALE",Due="RATING",Eue="RANKING",hW="SEEDING",Dv="PUBLISH",wu="PUBLIC",Ev="STATUS",Oke="MODIFICATION",Lke="RETRIEVAL",Fke="other",PL={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:EG,AFTER_REST:Sue,ALLOCATE_COURTS:Qh,ASSIGN_COURT:Xg,ASSIGN_OFFICIAL:pW,ASSIGN_VENUE:a0,CHECK_IN:vk,CHECK_OUT:yk,COMPLETED_DATE:Rke,COURT_ORDER:DL,ELIGIBILITY:Nke,END_TIME:ym,FOLLOWED_BY:wue,MEDICAL:kke,MODIFICATION:Oke,NEXT_AVAILABLE:Iue,NOT_BEFORE:Mke,OTHER:Fke,PENALTY:xke,PUBLIC:wu,PUBLISH:Dv,RANKING:Eue,RATING:Due,RAIN_DELAY:Tue,REGISTRATION:Ake,RESUME_TIME:Ah,RETRIEVAL:Lke,SCALE:Uue,SCHEDULE:Cke,SCHEDULED_DATE:s0,SCHEDULED_TIME:o0,SEEDING:hW,START_TIME:Ed,STATUS:Ev,STOP_TIME:nm,SUSPENSION:_ke,TIME_MODIFIERS:EL,TO_BE_ANNOUNCED:bue};function l0({matchUp:t}){if(!t)return{error:Oo};if(!t.hasContext)return{error:HO};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:rl};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:n}=yue({matchUp:t}),r=(t.timeItems??[]).filter(o=>o?.itemType&&[vk,yk].includes(o.itemType)).sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=r.map(o=>o.itemValue).filter(o=>r.filter(l=>l?.itemValue===o).reverse()[0].itemType===vk);e?.forEach((o,l)=>{let u=n?.[l],c=o?.length&&o.every(d=>a.includes(d));u&&c&&!a.includes(u)&&a.push(u)}),n?.forEach((o,l)=>{a.includes(o)&&(e?.[l]??[]).forEach(u=>{u&&!a.includes(u)&&a.push(u)})});let s=n?.reduce((o,l)=>a.includes(l)&&o,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:s,checkedInParticipantIds:a,...le}}var _r=t=>e=>{let i=Ki(e)&&e?.matchUpType||Xn(e)&&e;return i&&Zae[t].includes(i)};function hP(t){let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},n=e?.map(({matchUpFormatCodes:a})=>a?.filter(s=>s===i)).flat().filter(Boolean).sort((a,s)=>(a?.length||0)-(s?.length||0))||[],r=n.includes(i)?i:n[0];return e?.find(({matchUpFormatCodes:a,averageTimes:s})=>a?.find(o=>r===o)&&s)?.averageTimes}function fP(t){let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:n}=t||{};return e?.find(({matchUpFormatCodes:r,averageTimes:a,recoveryTimes:s})=>{if(a&&i){let{greaterThan:o=0,lessThan:l=360}=a;if(i>o&&i<l)return!0}return r?.find(o=>o===n)&&s})?.recoveryTimes}function Pue({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(n=>Array.isArray(n)).map(n=>n.sort((r,a)=>(a.categoryNames?.length||0)-(r.categoryNames?.length||0)).find(({categoryTypes:r,categoryNames:a})=>!a?.length&&!r?.length||a?.includes(e)||r?.includes(i))).find(Boolean)}function $ke({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:n,matchUpFormat:r,categoryName:a,categoryType:s,policy:o}){let l=e?.matchUpRecoveryTimes&&fP({...e,averageMinutes:i,matchUpFormat:r}),u=t?.matchUpRecoveryTimes&&fP({...t,averageMinutes:i,matchUpFormat:r}),c=o?.matchUpRecoveryTimes&&fP({...o,averageMinutes:i,matchUpFormat:r}),d=[l,u,c,o?.defaultTimes?.recoveryTimes,n?.recoveryTimes];return Pue({categoryName:a,categoryType:s,timesBlockArray:d})}function Bke({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:n,tournamentScheduling:r,eventScheduling:a,policy:s}){let o=a?.matchUpAverageTimes&&hP({...a,matchUpFormat:t}),l=r?.matchUpAverageTimes&&hP({...r,matchUpFormat:t}),u=s?.matchUpAverageTimes&&hP({...s,matchUpFormat:t}),c=[o,l,u,s?.defaultTimes?.averageTimes,n?.averageTimes];return Pue({categoryName:e,categoryType:i,timesBlockArray:c})}var Cue="DOUBLES_SINGLES",Rue="SINGLES_DOUBLES",zc="total",PG="participantConflict",Tg="matchUpConflict",Mue="ISSUE_IDS",ay="CONFLICT",sy="WARNING",CG="ERROR",RG="ISSUE",u_="STATE",Nue={SINGLES_DOUBLES:Rue,DOUBLES_SINGLES:Cue,TOTAL:zc,CONFLICT_MATCHUP_ORDER:Tg,CONFLICT_PARTICIPANTS:PG,SCHEDULE_ISSUE_IDS:Mue,SCHEDULE_CONFLICT:ay,SCHEDULE_WARNING:sy,SCHEDULE_ERROR:CG,SCHEDULE_ISSUE:RG,SCHEDULE_STATE:u_};function mR({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:n,categoryName:r,categoryType:a,eventType:s,event:o}){if(!i)return{error:ot};s=s??o?.eventType??ow;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=sR({tournamentRecord:i,categoryName:r,categoryType:a,event:o}),c={...u,matchUpFormat:n,categoryType:a,defaultTiming:l};return CL({eventType:s,timingDetails:c})}function CL({timingDetails:t,eventType:e}){let i=Bke(t),n=Object.keys(i?.minutes||{}),r=i?.minutes&&(n?.includes(e)&&i.minutes[e]||i.minutes.default),a=$ke({...t,averageMinutes:r}),s=Object.keys(a?.minutes||{}),o=a?.minutes&&(s?.includes(e)&&a.minutes[e]||a.minutes.default),l=_r(ow)(e)?Rue:Cue,u=a?.minutes&&(s?.includes(l)&&a.minutes[l]||o);return{averageMinutes:r,recoveryMinutes:o,typeChangeRecoveryMinutes:u}}function X2(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Nb({timeItems:t,itemType:e}){let i=t.filter(r=>r&&r.itemType===e).sort((r,a)=>X2(r)-X2(a)).pop(),n=i&&X2(i);return{itemValue:i?.itemValue,timeStamp:n}}function Aue({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Nb({timeItems:i?.timeItems||[],itemType:o0});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{scheduledTime:n}:e}function u0({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Nb({timeItems:i?.timeItems||[],itemType:s0});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{scheduledDate:n}:e}function cI(t){if(Aoe.test(t)){let e=u3();return new Date(`${e}T${t}`)}else return new Date(t)}function Vke({matchUp:t}){if(!t)return{error:Oo};if(!t.timeItems)return{error:Xq};let e=t.timeItems.filter(n=>[Ed,nm,Ah,ym].includes(n?.itemType)).sort((n,r)=>cI(n.itemValue).getTime()-cI(r.itemValue).getTime()),i=e.reduce((n,r)=>{let a,s=r?.itemType?.split("."),o=`SCHEDULE.TIME.${r?.itemType?.startsWith("SCHEDULE.TIME")&&s[2]}`;switch(o){case Ed:a=0;break;case ym:if(n.lastValue&&[Ed,Ah].includes(n.lastType)){let l=cI(r.itemValue).getTime()-cI(n.lastValue).getTime();a=n.milliseconds+l}else a=n.milliseconds;break;case nm:if([Ed,"SCHECULE.TIME.RESUME"].includes(n.lastType)){let l=cI(r.itemValue).getTime()-cI(n.lastValue).getTime();a=n.milliseconds+l}else a=n.milliseconds;break;default:a=n.milliseconds;break}return{milliseconds:a,lastType:o,lastValue:r.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([Ed,Ah].includes(i.lastType)){let n=new Date().getTime()-cI(i.lastValue).getTime();i.milliseconds+=n}return{milliseconds:i.milliseconds,time:jke(i.milliseconds),relevantTimeItems:e}}function jke(t){let e=(i,n=2)=>("00"+i).slice(-n);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function Gke({matchUp:t}){let e=t?.timeItems||[],i=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{startTime:e.reduce((n,r)=>{let a=r.itemType===Ed&&r;return a&&(!n||i(a)<i(n))?a:n},void 0)?.itemValue}}function gR(t){let{disableNotice:e,venue:i,context:n}=t;if(typeof i!="object")return{error:Ee};let r=ic(t);i.venueId||(i.venueId=mn());let a;for(let s of Object.values(r)){let o=Hke({disableNotice:!0,tournamentRecord:s,context:n,venue:i});if(o?.error)return o;a=o.venue}return e||Ti({topic:Kle,payload:{venue:i}}),Vt({...le,venue:a})}function Hke({tournamentRecord:t,disableNotice:e,context:i,venue:n}){return t?n?(t.venues||(t.venues=[]),n.venueId||(n.venueId=mn()),t.venues.reduce((r,a)=>r||a.venueId===n.venueId,void 0)?{error:eoe}:(i&&un({element:n,extension:{value:i,name:$le}}),t.venues.push(n),{...le,venue:Ct(n)})):{error:Zt,info:"missing venue"}:{error:ot}}function mf({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:ot};if(!i)return{error:bv};let n=(e.venues??[]).reduce((r,a)=>a.venueId===i?a:r,void 0);if(!n&&t){let r=(iR({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of r){let s=t[a],o=mf({tournamentRecord:s,venueId:i});if(o.success&&o.venue)return gR({tournamentRecord:e,venue:o.venue}),{...le,venue:n}}}return n?{...le,venue:n}:{error:Zw}}function fW({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:n,venueId:r}=e,a=mf({tournamentRecords:i,tournamentRecord:n,venueId:r});return Ct(a,t,!0)}function c0({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:ot};if(!i)return{error:Ww};let n="findCourt",r,a;if((e.venues??[]).forEach(s=>{(s.courts??[]).forEach(o=>{o.courtId===i&&(r=o,a=s)})}),r)return{...le,court:r,venue:a};if(t){let s=(iR({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let o of s){let l=t[o],u=c0({tournamentRecord:l,courtId:i});if(u.success)return u.venue&&gR({tournamentRecord:e,venue:u.venue}),{...le,court:r,venue:a}}}return ce({result:{error:YU},stack:n})}function mW(t){return Ct(c0(t),!1,!0)}function RL({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:ot};if(!i)return{error:Ww};let n=c0({tournamentRecord:t,courtId:i});if(n.error)return n;let r=n.court&&(({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m})=>({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m}))(n.court);return{...le,courtInfo:Ct(r,!1,e)}}function BT(t){let e=zt(t,[{[ha]:!0},{venueId:!0,[Gc]:bv}]);if(e.error)return e;let{tournamentRecord:i,venueId:n}=t,r=mf({tournamentRecord:i,venueId:n});if(r.error)return r;let a=(r.venue?.courts??[]).map(l=>(({courtInfo:u})=>({...u}))(RL({courtId:l.courtId,internalUse:!0,tournamentRecord:i}))),s=r.venue&&(({venueId:l,venueName:u,venueAbbreviation:c})=>({venueAbbreviation:c,venueName:u,venueId:l}))(r.venue),o=s&&{...s,courtsInfo:a};return{...le,venueData:Ct(o,!1,!0)}}function zke({matchUp:t}){let e=t?.timeItems||[],i=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{endTime:e.reduce((n,r)=>{let a=r.itemType===ym&&r;return a&&(!n||i(a)>i(n))?a:n},void 0)?.itemValue}}function Cr({event:t,eventId:e}){if(!t)return{error:qn};let i=_i({name:nd,element:t})?.extension,n=e?Ct(i?.value,!1,!0):i?.value;return e&&t.drawDefinitions?.forEach(r=>{n?.flights?.forEach(a=>{a.drawId===r.drawId&&Object.assign(a,{drawDefinition:r})})}),{flightProfile:n}}function $o(t){let{tournamentRecord:e,eventId:i,drawId:n}=t,r="findEvent",a={},s=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},o=Object.values(s).map(({events:u,tournamentId:c})=>(u&&u.forEach(d=>{a[d.eventId]={tournamentId:c}}),u??[])).flat(),l;if(n){let u,c=o.find(d=>{let p=(d?.drawDefinitions??[]).find(h=>h.drawId===n);if(p)u=p,l=a[d.eventId].tournamentId;else{let h=(d&&Cr({event:d})?.flightProfile)?.flights?.find(f=>f.drawId===n);if(h)return l=a[d.eventId].tournamentId,{entries:h.drawEntries,drawName:h.drawName,tournamentId:l,drawId:n}}return p});if(c)return{event:c,drawDefinition:u,tournamentId:l}}if(i){let u=o.find(c=>c?.eventId===i);if(u)l=a[u.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...ce({result:{error:Wu},stack:r})};return{event:u,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...ce({result:{error:cu},context:{drawId:n,eventId:i},stack:r})}}function ML(t){let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:n,afterRecoveryTimes:r,tournamentRecord:a,usePublishState:s,scheduleTiming:o,matchUpFormat:l,publishStatus:u,matchUp:c}=t;if(!c)return{error:Oo};if(r&&!c.matchUpType&&!t.matchUpType&&(e||a)&&c.drawId){let S=t.drawDefinition||e?.drawDefinitions?.find(T=>T.drawId===c.drawId);!S&&a&&({drawDefinition:S,event:e}=$o({drawId:c.drawId,tournamentRecord:a}));let w=c.structureId&&S?.structures?.find(({structureId:T})=>T===c.structureId);i=t.matchUpType||w?.matchUpType||S?.matchUpType||e?.eventType!==na&&e?.eventType}let{milliseconds:d,time:p}=Vke({matchUp:c}),{startTime:h}=Gke({matchUp:c}),{endTime:f}=zke({matchUp:c}),m,{eventIds:g,drawIds:v}=n??{};if((!g||g.includes(c.eventId))&&(!v||v.includes(c.drawId))){let S=ne=>ne.createdAt?new Date(ne.createdAt).getTime():0,w=new Map,T=c.timeItems?.toSorted((ne,re)=>S(ne)-S(re))??[];for(let ne of T)w.set(ne.itemType,ne.itemValue);let U=w.get(dW),C=w.get(Qh),E=w.get(o0),P=w.get(EL),M=w.get(s0),R=w.get(pW),N=w.get(DL),A=w.get(a0),_=w.get(Xg),x,O,$,F,j,H=c.matchUpType??i;if(o&&E&&r&&H){let ne={matchUpFormat:c.matchUpFormat??l,...o};({averageMinutes:O=0,recoveryMinutes:$=0,typeChangeRecoveryMinutes:F=0}=CL({timingDetails:ne,eventType:H})),(O||$)&&(x=f?tl(Jn(f),$):tl(E,O+$)),F&&(j=f?tl(Jn(f),F):tl(E,O+F))}!M&&E&&(M=Pi(E));let G=lk({scheduledDate:M,scheduledTime:E}),W={},q=(a&&A&&BT({tournamentRecord:a,venueId:A}))?.venueData||{};A&&(W[A]=q);let{venueName:Z,venueAbbreviation:K,courtsInfo:Q}=q,J=(_&&Q?.find(ne=>ne.courtId===_))?.courtName;for(let ne of C||[]){if(!a)break;ne.venueId&&!W[ne.venueid]&&(W[ne.venueId]=BT({venueId:ne.venueId,tournamentRecord:a})?.venueData);let re=W[ne.venueId];ne.venueName=re?.venueName;let oe=re?.courtsInfo?.find(de=>de.courtId===ne.courtId);ne.courtName=oe?.courtName}m=Vt({typeChangeTimeAfterRecovery:j,timeAfterRecovery:x,scheduledDate:M,scheduledTime:E,isoDateString:G,homeParticipantId:U,venueAbbreviation:K,allocatedCourts:C,timeModifiers:P,venueName:Z,venueId:A,courtOrder:N,courtName:J,courtId:_,official:R,typeChangeRecoveryMinutes:F,recoveryMinutes:$,averageMinutes:O,milliseconds:d,startTime:h,endTime:f,time:p})}else m=Vt({milliseconds:d,startTime:h,endTime:f,time:p});let{scheduledDate:y}=u0({matchUp:c}),{scheduledTime:b}=Aue({matchUp:c});if(s&&u?.displaySettings?.draws){let S=u.displaySettings.draws,w=(S?.[c.drawId]??S?.default)?.scheduleDetails;if(w){let T=(w.find(U=>y&&U.dates?.includes(y))??w.find(U=>!U.dates?.length))?.attributes;if(T){let U=Object.assign({},...Object.keys(m).map(C=>({[C]:!0})),T);m=uw({source:m,template:U})}}}let I=c.matchUpStatus&&Yr.includes(c.matchUpStatus)&&(Pi(f)||Pi(y)||Pi(b))||void 0;return{schedule:m,endDate:I}}function qke({drawPositions:t,roundProfile:e,roundNumber:i}){let n=[void 0,void 0];if(nse(t))return{orderedDrawPositions:n,displayOrder:n};let r=e?.[i],a=r?.pairedDrawPositions?.find(o=>mo(o||[],t.filter(Boolean)))??n,s=r?.feedRound;if(ise(t)){let o=[...t].sort(ia);return{orderedDrawPositions:o.length===2?o:a,displayOrder:s?o:a}}if(s){let o=[t.find(l=>!isNaN(ri(l))),void 0];return{orderedDrawPositions:o,displayOrder:o}}return{orderedDrawPositions:a,displayOrder:a}}function bk({collectionPosition:t,collectionId:e,lineUp:i}){let n=[],r=[];if(i){let a=o=>o===void 0?-1:o,s=i.map(o=>{let{collectionAssignments:l,participantId:u}=o,c=l?.find(d=>d.collectionPosition===t&&d.collectionId===e);return c&&{participantId:u,...c}}).filter(Boolean).sort((o,l)=>a(o.substitutionOrder)-a(l.substitutionOrder));for(let o of s){let{participantId:l,previousParticipantId:u,substitutionOrder:c}=o;n.includes(l)||(u&&r.push({previousParticipantId:u,substitutionOrder:c,participantId:l}),n=n.filter(d=>d!==u),n.push(l))}}return{assignedParticipantIds:n,substitutions:r}}function ad({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let n="getPairedParticipant";if(!t&&!e)return{error:ot};if(!Array.isArray(i)||i.length>2)return{error:Ul};if(!i.length)return ce({result:{error:yv},stack:n});t=t??e?.participants??[];let r=t.filter(o=>o.participantType===Ni&&Dr(i,o.individualParticipantIds).length===i.length&&o.individualParticipantIds.length===i.length),a=r[0];if(!a)return ce({result:{error:Nr},stack:n});let s=Ct(r.slice(1),!1,!0);return{participant:Ct(a),duplicatedPairParticipants:s,...le}}function Ky({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:Ot};if(typeof e!="string")return{error:la};let{extension:i}=_i({element:t,name:fm});return{lineUp:(i?.value||{})[e]}}function Wke({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:n=[],participantMap:r,drawDefinition:a,collectionId:s,sideLineUps:o,matchUpType:l}){if(!s||!i)return{};let u=({attribute:d,lineUp:p,teamParticipant:h})=>{let{assignedParticipantIds:f,substitutions:m}=bk({collectionPosition:i,collectionId:s,lineUp:p});if(l===Dn){if(f?.length<=2){let g=r?.[f[0]]?.pairIdMap?.[f[1]],v=(g&&r[g]?.participant||ad({participantIds:f,tournamentParticipants:t}).participant)?.participantId;return{[d]:{participantId:v,teamParticipant:h,substitutions:m}}}else if(f?.length>2)return{[d]:{teamParticipant:h,substitutions:m}}}else{let g=f?.[0];return g&&{[d]:{participantId:g,teamParticipant:h,substitutions:m}}}};if(!n?.length){let d=o?.map(p=>{let{teamParticipant:h,sideNumber:f}=p,m=p.lineUp||Ky({participantId:h.teamParticipantId,drawDefinition:a})?.lineUp;return u({attribute:f,lineUp:m,teamParticipant:h})}).filter(Boolean)||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let c=n?.map(d=>{let p=e.find(g=>g.drawPosition===d)?.participantId,h=o?.find(g=>g?.drawPosition===d),f=h?.teamParticipant||p&&r?.[p]?.participant||t?.find(({participantId:g})=>g===p),m=h?.lineUp||Ky({participantId:p,drawDefinition:a})?.lineUp;return u({attribute:d,lineUp:m,teamParticipant:f})}).filter(Boolean)||{};return{drawPositionCollectionAssignment:Object.assign({},...c)}}function NL(t){let e=zt(t,[{[hf]:!0}]);if(e.error)return e;let i=t?.matchUp,n=i?.matchUpType;if(!n&&i?.sides?.length){let r=i.sides.find(({participant:a})=>a)?.participant?.participantType;n=r===ji&&Rn||r===Ni&&Dn||r===wn&&wn||void 0}return{matchUpType:n}}function Yke({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:n,seedAssignments:r,drawPosition:a,isFeedRound:s,sideNumber:o}){let l=i.find(h=>h.drawPosition&&h.drawPosition===a),u=a&&t,c=o&&e,d=u?u[a]?.participantId:l?.participantId,p=l?Kke({displaySideNumber:n,seedAssignments:r,participantId:d,assignment:l,sideNumber:o}):{...c?.[o]};if(s&&(o===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&u){let h=u[a]?.teamParticipant,f=u[a]?.participant,m=u[a]?.substitutions;f&&(p.participant=f),m&&(p.substitutions=m),h&&(p.teamParticipant=h)}return p}function Kke({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:n,sideNumber:r}){let a={drawPosition:n.drawPosition,displaySideNumber:t,sideNumber:r};if(i){let s=Zke({seedAssignments:e,participantId:i});Object.assign(a,s,{participantId:i}),s?.seedNumber&&s?.seedValue===""&&(a.seedValue="~")}else n.bye&&Object.assign(a,{bye:!0});return n.qualifier&&Object.assign(a,{qualifier:!0}),a}function Zke({seedAssignments:t,participantId:e}){return t?.find(i=>!i.seedProxy&&i.participantId===e)}function _ue({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:n,drawPositionsRanges:r,hydrateParticipants:a,afterRecoveryTimes:s,initialRoundOfPlay:o,additionalContext:l,roundNamingProfile:u,tournamentRecord:c,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:h,seedAssignments:f,usePublishState:m,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:b,drawDefinition:I,publishStatus:S,scoringActive:w,matchUpTieId:T,isRoundRobin:U,roundProfile:C,sideLineUps:E,structure:P,context:M,matchUp:R,event:N}){l=l??{};let A=Zs({drawDefinition:I,structure:P,matchUp:R,event:N})?.tieFormat,{roundOffset:_,structureId:x,structureName:O,stage:$,stageSequence:F}=P,{drawId:j,drawName:H,drawType:G}=I??{},W=A?.collectionDefinitions,q=R.collectionId&&W?.find(he=>he.collectionId===R.collectionId),Z=R.collectionId?q?.matchUpFormat:R.matchUpFormat??P?.matchUpFormat??I?.matchUpFormat??N?.matchUpFormat,K=R.matchUpType||q?.matchUpType||P?.matchUpType||I?.matchUpType||!_r(na)(N?.eventType)&&N?.eventType,Q=h?"BYE":R.matchUpStatus,{schedule:J,endDate:ne}=ML({scheduleVisibilityFilters:t,afterRecoveryTimes:s,tournamentRecord:c,usePublishState:m,scheduleTiming:y,drawDefinition:I,matchUpFormat:Z,publishStatus:S,matchUpType:K,matchUp:R,event:N}),re=d??R.drawPositions??[],{collectionPosition:oe,collectionId:de,roundPosition:se}=R,ge=R.roundNumber??l.roundNumber,ye=de?Wke({tournamentParticipants:i,positionAssignments:n,collectionPosition:oe,participantMap:g,drawDefinition:I,drawPositions:re,collectionId:de,sideLineUps:E,matchUpType:K}):void 0,Te=u?.[ge]?.roundName||l.roundName,De=u?.[ge]?.abbreviatedRoundName||l.abbreviatedRoundName,xe=C?.[ge]?.feedRound,Me=C?.[ge]?.preFeedRound,Oe=C?.[ge]?.roundFactor,at=r?.[ge],Fe=se?at?.[se]:void 0,mt=e?.[ge],Xe=q?.category?{...M?.category||{},...q.category}:M?.category??N?.category,gt=R.processCodes?.length&&R.processCodes||q?.processCodes?.length&&q?.processCodes||P?.processCodes?.length&&P?.processCodes||I?.processCodes?.length&&I?.processCodes||N?.processCodes?.length&&N?.processCodes||c?.processCodes,ht=b?.withCompetitiveness&&fR({...v,matchUp:R}),_e=R.finishingPositionRange??l.finishingPositionRange,Ye=$!==qt&&yi(o)&&o+(ge||0),Je=he=>Vt(he,void 0,!0),ct={...Je(M),...Je({matchUpFormat:K===na?void 0:Z,tieFormat:K!==na?void 0:A,gender:q?.gender??N?.gender,endDate:R.endDate??ne,discipline:N?.discipline,category:Xe,finishingPositionRange:_e,abbreviatedRoundName:De,drawPositionsRange:Fe,competitiveProfile:ht,structureName:O,stageSequence:F,drawPositions:re,matchUpStatus:Q,processCodes:gt,isRoundRobin:U,matchUpTieId:T,preFeedRound:Me,matchUpType:K,roundFactor:Oe,roundOffset:_,structureId:x,roundNumber:ge,roundOfPlay:Ye,feedRound:xe,roundName:Te,drawName:H,drawType:G,schedule:J,drawId:j,stage:$}),...Ct(Je(R),!0,!0)};if(Z&&R.score?.scoreStringSide1){let he=So(Z),{bestOf:we,finalSetFormat:be,setFormat:Ae}=he??{};(be?.tiebreakSet||Ae?.tiebreakSet||Ae?.timed)&&(ct.score.sets=ct.score.sets.sort((ze,We)=>ze.setNumber-We.setNumber).map((ze,We)=>(We+1===we?(be?.tiebreakSet||be?.timed)&&(ze.tiebreakSet=!0):(Ae?.tiebreakSet||Ae?.timed)&&(ze.tiebreakSet=!0),ze)))}if(Array.isArray(re)){let{orderedDrawPositions:he,displayOrder:we}=qke({drawPositions:re,roundProfile:C,roundNumber:ge}),be=C?.[ge]?.feedRound,Ae=we[0]!==he[0],ze=he.concat(void 0,void 0).slice(0,2).map((We,Le)=>{let ft=Le+1,rt=Ae?3-ft:ft,St=Yke({...ye,positionAssignments:n,displaySideNumber:rt,seedAssignments:f,drawPosition:We,isFeedRound:be,sideNumber:ft}),si=R.sides?.find(ci=>ci.sideNumber===ft),Qe=se?(se-1)*2+Le+1:void 0,bt=Qe?mt?.[Qe]:void 0;return Je({sourceDrawPositionRange:bt,...si,...St})});Object.assign(ct,Ct({sides:ze},!0,!0))}if(i&&ct.sides){let he=p?.[tD],we=be=>{let Ae=g?.[be]?.participant;return Ae&&uw({template:he?.participant,source:Ae})};if(ct.sides.filter(Boolean).forEach(be=>{if(be.participantId){let Ae=Ct(we(be.participantId)||(i?qg({policyDefinitions:p,participantId:be.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:b}):void 0),void 0,!0);if(Ae){let ze,We;if(I?.entries){let Le=I.entries.find(rt=>rt.participantId===be.participantId),ft=N?.entries?.find(rt=>rt.participantId===be.participantId);ze=Le?.entryStatus||ft?.entryStatus,Ae.entryStatus=ze,Le?.entryStage&&(We=Le.entryStage,Ae.entryStage=We)}a!==!1?Object.assign(be,{participant:Ae}):Object.assign(be,{participant:{entryStage:We,entryStatus:ze}})}}if(be?.participant?.individualParticipantIds?.length&&!be.participant.individualParticipants?.length){let Ae=be.participant.individualParticipantIds.map(ze=>we(ze)||(i?qg({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:b,participantId:ze}):void 0));a!==!1&&Object.assign(be.participant,{individualParticipants:Ae})}}),!ct.matchUpType){let{matchUpType:be}=NL({matchUp:ct});be&&Object.assign(ct,{matchUpType:be})}if(b?.inferGender&&(!ct.gender||ct.gender===Qw)&&ct.sides?.length===2&&ct.matchUpType!==na){let be=ct.sides.map(Ae=>{if(_r(Rn)(ct.matchUpType))return Ae.participant?.person?.sex;if(Ae.participant?.individualParticipants?.length===2){let ze=wi(Ae.participant.individualParticipants.map(We=>We.person?.sex)).filter(Boolean);if(ze.length===1)return ze[0]}});if(be.filter(Boolean).length===2&&wi(be).length===1){let Ae=be[0];ct.inferredGender=Ae}}}if(ct.tieMatchUps){let he=ct.matchUpStatus==="BYE",we=ct.sides?.map(({participant:be,drawPosition:Ae,sideNumber:ze,lineUp:We})=>{let Le=be?.participantType===na&&be;return{teamParticipant:Le&&Vt({participantRoleResponsibilities:Le.participantRoleResponsibilities,participantOtherName:Le.participanOthertName,participantName:Le.participantName,participantId:Le.participantId,teamId:Le.teamId}),drawPosition:Ae,sideNumber:ze,lineUp:We}});ct.tieMatchUps=ct.tieMatchUps.map(be=>{let Ae=ct.matchUpId,ze={finishingPositionRange:ct.finishingPositionRange,abbreviatedRoundName:De,roundNumber:ge,roundName:Te};return _ue({tieDrawPositions:re,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:we,drawPositionsRanges:r,initialRoundOfPlay:o,roundNamingProfile:u,additionalContext:ze,appliedPolicies:p,isCollectionBye:he,usePublishState:m,publishStatus:S,matchUpTieId:Ae,isRoundRobin:U,roundProfile:C,matchUp:be,event:N,tournamentParticipants:i,positionAssignments:n,tournamentRecord:c,seedAssignments:f,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:b,drawDefinition:I,scoringActive:w,structure:P,context:M})})}let pt=ct.sides&&ct.sides.filter(he=>he?.participantId).length===2,Se=!ct.winningSide;if(Object.assign(ct,{readyToScore:w&&pt&&Se,hasContext:!0}),pt){let{allParticipantsCheckedIn:he,checkedInParticipantIds:we}=l0({matchUp:ct});Object.assign(ct,{allParticipantsCheckedIn:he,checkedInParticipantIds:we})}return Array.isArray(b?.exclude)&&b?.exclude.forEach(he=>delete ct[he]),ct}function Xke({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Nb({timeItems:i?.timeItems||[],itemType:Qh});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{allocatedCourts:Ct(n,!1,!0)}:e}function Jke({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Nb({timeItems:i?.timeItems||[],itemType:Xg});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{courtId:n}:e}function Qke({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Nb({timeItems:i?.timeItems||[],itemType:a0});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{venueId:n}:e}function qf(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:n,isCollectionMatchUp:r,matchUpStatuses:a,hasWinningSide:s,matchUpFormats:o,roundPositions:l,matchUpFormat:u,collectionIds:c,isMatchUpTie:d,roundNumbers:p,matchUpIds:h,roundNames:f,filterMatchUpTypes:m=!0,filterMatchUpIds:g=!0,stageSequences:v,scheduledDates:y,scheduledDate:b,participantIds:I,processContext:S,tournamentIds:w,matchUpTypes:T,structureIds:U,readyToScore:C,courtIds:E,eventIds:P,venueIds:M,drawIds:R,stages:N}=t,A=Array.isArray(I)?I.filter(Boolean):[],_=Array.isArray(a)?a.filter(Boolean):[],x=Array.isArray(i)?i.filter(Boolean):[],O=Array.isArray(N)?N.filter(Boolean):[],$=Array.isArray(v)?v.filter(Boolean):[],F=Array.isArray(c)?c.filter(Boolean):[],j=Array.isArray(f)?f.filter(Boolean):[],H=Array.isArray(p)?p.filter(Boolean):[],G=Array.isArray(l)?l.filter(Boolean):[],W=Array.isArray(h)&&g?h.filter(Boolean):[],q=Array.isArray(T)&&m?T.filter(Boolean):[],Z=Array.isArray(E)?E.filter(Boolean):[],K=Array.isArray(M)?M.filter(Boolean):[],Q=Array.isArray(o)&&o.filter(Boolean)||typeof u=="string"&&[u]||[],J=Array.isArray(y)&&y.filter(Boolean)||typeof b=="string"&&b.length&&[b]||[],ne=Array.isArray(w)?w.filter(Boolean):[],re=Array.isArray(P)?P.filter(Boolean):[],oe=Array.isArray(R)?R.filter(Boolean):[],de=Array.isArray(U)?U.filter(Boolean):[];return e.filter(se=>{if(C&&!_r(uu)(se)&&!se.readyToScore||se.winningSide&&s&&![1,2].includes(se.winningSide)||d!==void 0&&(d&&!se.tieMatchUps||!d&&se.tieMatchUps)||r!==void 0&&(r&&!se.collectionId||!r&&se.collectionId)||O.length&&!O.includes(se.stage)||$.length&&!$.includes(se.stageSequence)||F.length&&(!se.collectionId||!F.includes(se.collectionId))||j.length&&(!se.roundName||!j.includes(se.roundName))||H.length&&(!se.roundNumber||!H.includes(se.roundNumber))||G.length&&(!se.roundPosition||!G.includes(se.roundPosition))||_.length&&(!se.matchUpStatus||!_.includes(se.matchUpStatus))||x.length&&se.matchUpStatus&&x.includes(se.matchUpStatus)||W.length&&!W.includes(se.matchUpId)||q.length&&(!se.matchUpType||!xO(q,se.matchUpType))||Q.length&&(!se.matchUpFormat||!Q.includes(se.matchUpFormat)))return!1;if(J?.length){let{scheduledTime:ge}=Aue({matchUp:se}),{scheduledDate:ye}=u0({matchUp:se}),Te=Pi(ge)||ye;if(!J.find(De=>zh(De,Te)))return!1}if(Z.length){let{courtId:ge}=Jke({matchUp:se}),{allocatedCourts:ye}=Xke({matchUp:se}),Te=ye?.map(({courtId:De})=>De);if(!Z.filter(Boolean).includes(ge)||Te?.includes(ge))return!1}if(K.length){let{venueId:ge}=Qke({matchUp:se});if(!K.filter(Boolean).includes(ge))return!1}if(S){if(ne.length&&!ne.includes(se.tournamentId)||re.length&&!re.includes(se.eventId)||oe.length&&!oe.includes(se.drawId)||de.length&&!de.includes(se.structureId))return!1;let ge=se.sides?.map(({participantId:ye})=>ye).filter(Boolean)??[];if(n&&ge.length<n||A.length&&!A.some(ye=>ge.includes(ye)))return!1}return!0})}function cn(t){let{provisionalPositioning:e,tournamentRecord:i,contextFilters:n,matchUpFilters:r,contextProfile:a,drawDefinition:s,context:o={},structure:l,inContext:u,event:c}=t,{seedAssignments:d,contextContent:p,exitProfiles:h,matchUpsMap:f}=t,m={},g={};if(!l)return{collectionPositionMatchUps:m,error:wb,roundMatchUps:g,matchUps:[]};let v=Array.isArray(r?.eventIds)?r?.eventIds.filter(Boolean):[],y=Array.isArray(r?.structureIds)?r?.structureIds.filter(Boolean):[],b=Array.isArray(r?.drawIds)?r?.drawIds.filter(Boolean):[],I=!o?.eventId||!v?.length&&!n?.eventIds?.filter(Boolean).length||v?.includes(o.eventId)||n?.eventIds?.includes(o.eventId),S=!y?.length||y.includes(l.structureId),w=!s||!b?.length||b.includes(s.drawId);if(!I||!S||!w)return{collectionPositionMatchUps:m,roundMatchUps:g,matchUps:[]};a&&!p&&(p=zm({tournamentRecord:i,contextProfile:a,drawDefinition:s}));let{appliedPolicies:T}=sn({drawDefinition:s}),U={...t.tournamentAppliedPolicies,...T,...t.policyDefinitions},C=U?.scoring?.structures,E=l.stage&&C?.stage?.[l.stage],P=l.stageSequence&&E?.stageSequence?.[l.stageSequence],M=U?.scoring?.requireAllPositionsAssigned||E?.requireAllPositionsAssigned||P?.requireAllPositionsAssigned;f||(f=us({drawDefinition:s,structure:l}));let{positionAssignments:R,allPositionsAssigned:N}=ua({structure:l}),A=!M||N,{seedAssignments:_}=Zu({provisionalPositioning:e,drawDefinition:s,structure:l});d=d??_;let{structureId:x}=l;h=h||s&&hue({drawDefinition:s}).exitProfiles;let O=h?.[x],$=O?.length&&(O[0].split("-").map(Z=>parseInt(Z)).reduce((Z,K)=>Z+K)||0),F=!!l.structures,j=Zg({matchUpsMap:f,structureId:x,inContext:u}),H=U?.[hm],G=fue({roundNamingPolicy:H,drawDefinition:s,structure:l,matchUps:j}),{roundNamingProfile:W,roundProfile:q}=G;if(g=G?.roundMatchUps??[],r&&(j=qf({matchUps:j,...r,filterMatchUpTypes:!1,filterMatchUpIds:!1})),u){let{sourceDrawPositionRanges:Z}=Tke({drawDefinition:s,matchUpsMap:f,structureId:x}),K=s?Uke({drawDefinition:s,roundProfile:q,matchUpsMap:f,structureId:x}).drawPositionsRanges:void 0,Q=t.tournamentParticipants,J=t.participantMap;!Q?.length&&!J&&i&&({participants:Q=[],participantMap:J}=Pb({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:i,contextProfile:a,inContext:u})),j=j.map(ne=>_ue({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:Z,tournamentParticipants:Q,positionAssignments:R,drawPositionsRanges:K,initialRoundOfPlay:$,roundNamingProfile:W,tournamentRecord:i,appliedPolicies:U,seedAssignments:d,contextContent:p,participantMap:J,contextProfile:a,drawDefinition:s,scoringActive:A,isRoundRobin:F,roundProfile:q,structure:l,context:o,matchUp:ne,event:c})),(j?.filter(ne=>Array.isArray(ne.tieMatchUps))).forEach(ne=>{let re=ne.tieMatchUps;j=j.concat(...re)}),n&&(j=qf({processContext:!0,...n,matchUps:j}))}else(j?.filter(Z=>Array.isArray(Z.tieMatchUps))).forEach(Z=>{let K=Z.tieMatchUps;j=j.concat(...K)});return r&&(j=qf({matchUps:j,...r,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(r?.matchUpTypes||r?.matchUpIds)&&(j=qf({matchUpTypes:r.matchUpTypes,matchUpIds:r.matchUpIds,matchUps:j})),(r?.matchUpTypes||r?.matchUpIds||u)&&(g=go({matchUps:j}).roundMatchUps??[]),Zs({drawDefinition:s,structure:l,event:c})?.tieFormat&&({collectionPositionMatchUps:m}=Ske({matchUps:j})),{collectionPositionMatchUps:m,roundMatchUps:g,isRoundRobin:F,roundProfile:q,matchUpsMap:f,matchUps:j}}function Py({matchUp:t}){return t?Yr.includes(t?.matchUpStatus)||t?.winningSide:!1}function AL({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:n,hydrateParticipants:r,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:h,publishStatus:f,contextProfile:m,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structureId:b,inContext:I,structure:S,context:w,event:T}){!S&&b&&({structure:S}=li({drawDefinition:g,structureId:b}));let U=cn({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:n,hydrateParticipants:r,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:h,publishStatus:f,contextProfile:m,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structure:S,inContext:I,context:w,event:T}),C=[],E=[],P=[],M=[],R=[];if(U.error)return U;let{matchUps:N}=U,{assignedPositions:A}=ua({structure:S}),_=A?.filter(O=>O.participantId).map(O=>O.drawPosition),x;return N.filter(O=>{let $=u?.matchUpTypes?.length===1&&u.matchUpTypes[0]===Hn;return!(O.matchUpType!==Hn&&$)}).forEach(O=>{if(O.matchUpStatus===al){C.push(O);return}O.matchUpType===Hn&&(x=!0);let $=!!O.collectionId,F=$&&O.sides?.every(Z=>Z.participantId),j=!$&&O.drawPositions?.filter(Boolean).length===2,H=!$&&O.drawPositions?.every(Z=>_?.includes(Z)),G=A?.filter(Z=>Z.bye).map(Z=>Z.drawPosition),W=!$&&O.drawPositions?.find(Z=>G?.includes(Z)),q=B3.includes(O.matchUpStatus)&&(F||j&&(!t||H));return W?R.push(O):Py({matchUp:O})?E.push(O):q?P.push(O):M.push(O)}),{includesTeamMatchUps:x,abandonedMatchUps:C,completedMatchUps:E,upcomingMatchUps:P,pendingMatchUps:M,byeMatchUps:R,structure:S}}function exe({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:Ot};if(!i)return{error:yu};let{links:n}=aD({drawDefinition:t,structureId:i}),r=n.source.reduce((s,o)=>!o.source.roundNumber||o.source.roundNumber===e?s.concat(o):s,[]),a=n.target.reduce((s,o)=>!o.target.roundNumber||o.target.roundNumber===e?s.concat(o):s,[]);return{links:{source:r,target:a}}}function J2({finishingPositions:t,linkCondition:e,linkType:i,source:n}){let r=n.find(a=>{let s=!a.source?.finishingPositions||!t||mo(t,a.source?.finishingPositions);return e===a.linkCondition&&s&&a.linkType===i});return[Wh,Yh].includes(r?.linkType)&&!r?.source?.roundNumber?ce({result:{error:Ee},stack:"getTargetLink",context:r}):r}function aD({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((n,r)=>(r.source?.structureId===e&&(!i||r.source.roundNumber===i)&&(n.source=n.source.concat(r)),r.target?.structureId===e&&(!i||r.target.roundNumber===i)&&(n.target=n.target.concat(r)),n),{source:[],target:[]})}:{error:yu}:{error:Ot}}function txe({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:n}=e,r=t.filter(s=>s.roundNumber===i&&!s.matchUpTieId),a=t.filter(s=>s.roundNumber===i+1&&!s.matchUpTieId);if(a.length){let s;return a.length===r.length?s=a.find(o=>o.roundPosition===n):a.length===r.length/2&&(s=a.find(o=>o.roundPosition===Math.ceil(n/2))),{matchUp:s}}return{message:"no progression found"}}function Q2({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:n,targetLink:r}){if(!r)return{error:_q};let{target:{structureId:a,feedProfile:s,groupedOrder:o,roundNumber:l,positionInterleave:u}}=r,{structure:c}=li({drawDefinition:n,structureId:a}),{positionAssignments:d}=Nn({structure:c}),p=(e?.filter(C=>C.structureId===c?.structureId)).filter(C=>C.roundNumber===l&&!C.matchUpTieId),h=p.length,f=Dt(1,h+1),m=h/t,g=Math.ceil(m*i),v=1-i%2;if(u?.interleave&&m!==.5){let C=u.offset+(i-1)*u.interleave,E=i+C;g=Math.ceil(E/2),v=1-E%2}let y=f,b=f[g-1],I=pue({roundPositionsCount:f.length,groupedOrder:o}),S=I?.length||1;if(S<=f.length){let C=h/S,E=Aa(f,C);s===zy&&E.forEach(P=>P.reverse()),y=I?.length&&I?.map(P=>E[P-1]).flat()||y}s===kc?b=y[g-1]:s===zy?((!I?.length||S>f.length)&&(g=p.length+1-g),b=y[g-1]):s===nL&&du()&&console.log(WO,{feedProfile:s});let w=b&&p.reduce((C,E)=>E.roundPosition===b?E:C,void 0),T;w?.feedRound?(v=0,T=Math.min(...(w.drawPositions||[]).filter(Boolean))):T=w?.drawPositions?.length===2&&w?.drawPositions[v];let U=d?.find(({drawPosition:C})=>C===T);if(U){let{extension:C}=_i({element:U,name:fL});if(C?.value)return{disabledDrawPosition:T}}return{matchUp:w,targetDrawPosition:T,matchUpDrawPositionIndex:v}}function vo({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:n,matchUpId:r}){let a=i;t.length&&!a&&(a=t.find(o=>o.matchUpId===r));let{structure:s}=li({structureId:a?.structureId,drawDefinition:n});return s?.finishingPosition===t0?ixe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:n,structure:s,matchUp:a}):nxe({matchUp:a})}function ixe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:n,matchUp:r}){let{winnerMatchUpId:a,loserMatchUpId:s}=r,{links:o}=exe({roundNumber:r.roundNumber,structureId:n.structureId,drawDefinition:i}),l=o?.source,u=J2({source:l,linkType:Wh}),c=J2({linkCondition:Fp,linkType:Yh,source:l}),d=J2({source:l,linkType:Yh}),p=c&&d;d||(d=c);let h=u?.target?.feedProfile,f=d?.target?.feedProfile,m=c?.target?.feedProfile,g,v,y,b,I,S,w,T,U,C;if(e&&(a||s)&&(w=a&&h!==Ac&&t.find(({matchUpId:M})=>M===a),b=s&&f!==Ac&&t.find(({matchUpId:M})=>M===s),w||b))return{matchUp:r,targetLinks:{loserTargetLink:d,winnerTargetLink:u},targetMatchUps:{loserMatchUp:b,winnerMatchUp:w}};let{roundPosition:E}=r;C=C||t.filter(M=>M.structureId===n.structureId);let P=C.reduce((M,R)=>R.roundNumber===r.roundNumber&&!R.matchUpTieId?M+1:M,0);return d&&!b&&f!==Ac&&({matchUpDrawPositionIndex:S,targetDrawPosition:I,matchUp:b}=Q2({targetLink:d,sourceRoundMatchUpCount:P,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),p&&m!==Ac&&({matchUpDrawPositionIndex:y,targetDrawPosition:v,matchUp:g}=Q2({targetLink:c,sourceRoundMatchUpCount:P,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),u&&!w&&h!==Ac&&({matchUpDrawPositionIndex:U,targetDrawPosition:T,matchUp:w}=Q2({targetLink:u,sourceRoundMatchUpCount:P,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),w||(C=C||t.filter(M=>M.structureId===n.structureId),{matchUp:w}=txe({structureMatchUps:C,matchUp:r})),Vt({matchUp:r,targetLinks:{loserTargetLink:d,winnerTargetLink:u,byeTargetLink:c},targetMatchUps:{winnerMatchUpDrawPositionIndex:U,loserMatchUpDrawPositionIndex:S,byeMatchUpDrawPositionIndex:y,winnerTargetDrawPosition:T,loserTargetDrawPosition:I,byeTargetDrawPosition:v,winnerMatchUp:w,loserMatchUp:b,byeMatchUp:g},targetMatchUpIds:!!(a||s)})}function nxe({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function rxe({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(n=>{let{matchUpId:r,structureId:a,drawPositions:s=[]}=n,{structure:o}=li({drawDefinition:t,structureId:a});if(o?.finishingPosition===qy){let{roundNumber:l}=n,u=l&&ri(l)+1,c=o.matchUps??[],{roundMatchUps:d}=go({matchUps:c});if(u&&d?.[u]){let p=[...s].sort(ia).map((h,f)=>{let m=d[u].find(g=>g.drawPositions?.includes(h));return{matchUpId:m?.matchUpId,roundNumber:u,schedule:m?.schedule,sideNumber:f+1,structureName:o.structureName}});Object.assign(n,{sidesTo:p})}}else{let l=vo({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:n,drawDefinition:t,matchUpId:r}),{winnerMatchUp:u}=l.targetMatchUps,{loserMatchUp:c}=l.targetMatchUps;!n.winnerMatchUpId&&u&&(n.winnerMatchUpId=u.matchUpId),!n.loserMatchUpId&&c&&(n.loserMatchUpId=c.matchUpId);let d=eV({upcomingMatchUp:u}),p=eV({upcomingMatchUp:c});if(n.matchUpStatus!=="BYE"&&c?.matchUpStatus==="BYE"){let{matchUp:f}=kue({matchUp:c,drawDefinition:t,inContextDrawMatchUps:e})||{};p=f&&eV({upcomingMatchUp:f})||p}let h=n.schedule?.timeAfterRecovery;if(h&&(d?.schedule?.scheduledTime&&rn(d.schedule.scheduledTime)<rn(h)&&(i[d.matchUpId]=n.matchUpId,d.schedule.scheduleConflict=n.matchUpId),p?.schedule?.scheduledTime&&rn(p.schedule.scheduledTime)<rn(h)&&(i[p.matchUpId]=n.matchUpId,p.schedule.scheduleConflict=n.matchUpId)),Object.assign(n,{winnerTo:d,loserTo:p}),n.drawPositions?.filter(Boolean).length){let f=l.targetLinks?.loserTargetLink?.linkCondition===Fp,m=axe(n);if(m.length){let g=TG(u?.sides),v=TG(c?.sides),y=m.find(({participantId:I})=>g.includes(I))?[]:m,b=m.find(({participantId:I})=>v.includes(I))?[]:m;c&&f&&b.length<2&&b.push({bye:!0,tbd:!0}),y?.length&&u&&(!l.targetMatchUpIds&&u&&(u=e.find(({matchUpId:I})=>I===u.matchUpId)),u.potentialParticipants||(u.potentialParticipants=[]),u.potentialParticipants.push(y)),b?.length&&c&&(l.targetMatchUpIds||(u=e.find(({matchUpId:I})=>I===c.matchUpId)),c.potentialParticipants||(c.potentialParticipants=[]),c.potentialParticipants.push(b))}}}}),Object.keys(i).length&&e.forEach(n=>{Object.keys(i).includes(n.matchUpId)&&(n.schedule.scheduleConflict=i[n.matchUpId])}),{scheduleConflictMatchUpIds:i}}function axe(t){return t?.sides?.map(({participant:e,participantId:i,qualifier:n})=>e||i&&{participantId:i}||n&&{qualifier:n}).filter(Boolean)||[]}function kue({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){let{matchUpId:n,matchUpStatus:r,structureId:a}=t||{};if(!t||!a||t?.matchUpStatus===Er)return{matchUp:t};if(r==="BYE"){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:o})=>o===t.winnerMatchUpId):{winnerMatchUp:s}=vo({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:n})?.targetMatchUps||{},kue({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function eV(t){if(t?.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:s})=>({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:s}))(t.upcomingMatchUp)}function Kr(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=sD(t);if(i.error)return ce({result:i,stack:e});let{abandonedMatchUps:n,completedMatchUps:r,upcomingMatchUps:a,pendingMatchUps:s,byeMatchUps:o,matchUpsMap:l}=i;return{matchUps:(n??[]).concat(...r??[],...a??[],...s??[],...o??[]),matchUpsMap:l}}function sD(t){if(!t?.drawDefinition)return{error:Ot};let{tournamentParticipants:e,contextContent:i,matchUpsMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,requireParticipants:s,participantsProfile:o,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:h,scheduleTiming:f,participantMap:m,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:b,inContext:I,context:S,event:w}=t,T=[],U=[],C=[],E=[],P=[];v&&!i&&(i=zm({policyDefinitions:u,tournamentRecord:c,contextProfile:v,event:w}));let M;!e?.length&&c&&(e=c?.participants,(I||o?.withGroupings)&&e?.length&&({participantsWithGroupings:e,groupInfo:M}=SL({participants:e,participantsProfile:o})));let{structures:R}=rd({drawDefinition:y});if(!R)return{error:or};n||(n=us({drawDefinition:y}));let N=y&&hue({drawDefinition:y}).exitProfiles;R.forEach(x=>{let{byeMatchUps:O=[],pendingMatchUps:$=[],upcomingMatchUps:F=[],completedMatchUps:j=[],abandonedMatchUps:H=[]}=AL({matchUpFilters:b?void 0:h,contextFilters:b?void 0:p,inContext:I||b||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,requireParticipants:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:f,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:N,matchUpsMap:n,structure:x,context:S,event:w});T=T.concat(...H),U=U.concat(...j),C=C.concat(...F),E=E.concat(...$),P=P.concat(...O)});let A=x=>(!h&&!b&&!p||(h&&(x=qf({matchUps:x,...h})),p&&(x=qf({matchUps:x,...p,processContext:!0}))),x),_={abandonedMatchUps:A(T),completedMatchUps:A(U),upcomingMatchUps:A(C),pendingMatchUps:A(E),byeMatchUps:A(P),matchUpsMap:n,...le,groupInfo:M};if(b){let x=typeof b=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:O,completed:$,upcoming:F,pending:j,bye:H}=x,G=[].concat(...O&&T||[],...$&&U||[],...F&&C||[],...j&&E||[],...H&&P||[]);rxe({inContextDrawMatchUps:G,drawDefinition:y})}return _}function gf(t){let{participants:e=[],contextContent:i,participantMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,inContext:g,context:v,event:y}=t;if(!y)return{error:qn};let{eventId:b,eventName:I,endDate:S,eventType:w,category:T,gender:U,matchUpFormat:C}=y??{},E={...v,...Vt({indoorOutDoor:y.indoorOutdoor??c?.indoorOutdoor,surfaceCategory:y.surfaceCategory??c?.surfaceCategory,endDate:y.endDate??c?.endDate,tournamentId:c?.tournamentId,matchUpFormat:C,eventName:I,eventType:w,category:T,eventId:b,gender:U})};S&&(E.endDate=S),f&&!i&&(i=zm({policyDefinitions:l,tournamentRecord:c,contextProfile:f,event:y}));let P;if(!e?.length&&!n&&c){let N=Pb({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:f,inContext:g});n=N.participantMap,e=N.participants??[],P=N.groupInfo}let M=y.drawDefinitions??[],R=sR({tournamentRecord:c,event:y}).scheduleTiming;return{matchUps:M.flatMap(N=>{let{matchUps:A}=Kr({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,context:E,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextFilters:p,contextProfile:f,drawDefinition:N,contextContent:i,matchUpFilters:h,participantMap:n,scheduleTiming:R,nextMatchUps:m,inContext:g,event:y});return A??[]}),groupInfo:P}}function Za(t){let e=zt(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!t?.tournamentRecord)return{error:ot};let{participantMap:i,participants:n}=t,{scheduleVisibilityFilters:r,participantsProfile:a,afterRecoveryTimes:s,useParticipantMap:o,policyDefinitions:l,tournamentRecord:u,inContext:c=!0,usePublishState:d,contextProfile:p,matchUpFilters:h,contextFilters:f,nextMatchUps:m,context:g}=t,v=t.tournamentId??u.tournamentId,y=u?.events??[];n||({participants:n,participantMap:i}=Pb({participantsProfile:a,useParticipantMap:o,tournamentRecord:u,contextProfile:p,inContext:c}));let{appliedPolicies:b}=sn({tournamentRecord:u}),I={...g,tournamentId:v,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},S=zm({policyDefinitions:l,tournamentRecord:u,contextProfile:p});return{matchUps:y.flatMap(w=>(I.eventDrawsCount=w.drawDefinitions?.length??0,gf({context:I,scheduleVisibilityFilters:r,tournamentAppliedPolicies:b,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:S,contextFilters:f,contextProfile:p,matchUpFilters:h,participantMap:i,nextMatchUps:m,participants:n,inContext:c,event:w}).matchUps??[])).concat(...u.matchUps??[])}}function jd({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:n,policyDefinitions:r,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:u}){if(typeof n!="object"||!Object.keys(n).length)return{error:fr};let c=Object.keys(n).map(d=>{let p=n[d];return Za({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:r,tournamentRecord:p,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:u}).matchUps??[]}).flat();return{...le,matchUps:c}}function d0(t,e){return sxe(t,e)||(t?.stageSequence||0)-(e?.stageSequence||0)||t?.roundNumber&&e.roundNumber&&t?.roundNumber-e?.roundNumber||(t?.roundPosition??0)-(e?.roundPosition??0)}function sxe(t,e){return(lw[t?.stage]||0)-(lw[e?.stage]||0)}function uo(t){let{participants:e,participantMap:i,contextContent:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,matchUpFilters:d,contextFilters:p,contextProfile:h,drawDefinition:f,nextMatchUps:m,inContext:g,context:v,event:y}=t,{eventId:b,eventName:I,endDate:S,eventType:w,category:T,gender:U,matchUpFormat:C}=y??{},E={...v,surfaceCategory:y?.surfaceCategory??c?.surfaceCategory,indoorOutDoor:y?.indoorOutdoor??c?.indoorOutdoor,matchUpFormat:C,eventType:w,eventName:I,category:T,eventId:b,endDate:S,gender:U},P;return!e?.length&&!i&&c&&({participants:e=[],participantMap:i,groupInfo:P}=Pb({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:h,inContext:g})),h&&!n&&(n=zm({policyDefinitions:l,tournamentRecord:c,contextProfile:h,drawDefinition:f,event:y})),{...Kr({context:E,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,drawDefinition:f,contextContent:n,contextFilters:p,contextProfile:h,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:g,event:y}),groupInfo:P}}function kI({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=Ct(t),n=e.split("."),r=[],a;o({targetElement:i,attributes:n});let s={value:a};return r.length&&(s.values=r),s;function o({targetElement:l,attributes:u=[],significantCharacters:c}){for(let[p,h]of u.entries())if(l?.[h]){let f=u.slice(p+1);f.length?Array.isArray(l[h])?l[h].forEach(m=>o({targetElement:m,attributes:f})):(l=l[h],d({targetElement:l,index:p})):(a||(a=l[h]),r.includes(l[h])||r.push(l[h]))}function d({targetElement:p,index:h}){if(p&&h===u.length-1&&["string","number"].includes(typeof p)){let f=c?p.slice(0,c):p;a?r.includes(f)||r.push(f):(a=f,r.push(f))}}}}var xue=t=>e=>!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(i=>({[i]:kI({element:e,accessor:i})?.value}))||typeof t=="object"&&Object.keys(t).map(i=>({[i]:kI({element:e,accessor:i})?.value}))||(typeof t=="string"&&kI({element:e,accessor:t}))?.value,kl=xue;function vR({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:n,roundLimit:r,matchUps:a,lucky:s,fmlc:o}){if(!ac(a))return[];let{roundProfile:l,roundNumbers:u=[]}=go({interpolate:!0,matchUps:a});n=n??Math.max(...u,0);let c=r?n-r:0,d=c&&l?.[n-c]?.matchUpsCount,p=l&&Object.values(l).map(kl("matchUpsCount")),h=(g,v)=>{let y=Math.min(...g);d&&v&&y===1&&(y=d);let b=Math.max(...g);return e&&b>e&&(b=e),[y,b]},f=l&&Object.assign({},...u.map(g=>{let v=(n??0)+1-g-c,y=l[g].matchUpsCount,b={finishingPositionRange:{},finishingRound:v},I=p?.slice(g-1).reduce((M,R)=>M+(R||0),0),S=o&&g!==1,w=1+t+(S?i??0:0),T=1,U=Dt(w,s?w+y*2:I+w+T),C=I+T-y,E=h(U.slice(C)),P=h(U.slice(0,C),!0);return b.finishingPositionRange={loser:E,winner:P},{[g]:b}})),m=du({finishingRound:!0});return a.filter(Boolean).forEach(g=>{let v=g.roundNumber&&f[g.roundNumber];m&&!v&&console.log({roundFinishingData:f,matchUp:g}),g.finishingRound=v?.finishingRound,g.finishingPositionRange=v?.finishingPositionRange}),a}function Zy({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){if(!e)return{error:Ot};let n={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=Kr({inContext:!0,drawDefinition:e,matchUpsMap:i})),!i?.drawMatchUps.some(r=>r.finishingPositionRange)&&e?.structures?.length===1&&!e?.structures[0].structures){let r=i?.drawMatchUps??[];vR({matchUps:r})}return(t??[]).filter(({collectionId:r})=>!r).forEach(r=>{let{matchUpId:a,structureId:s}=r,o=vo({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:a}),{winnerMatchUp:l,loserMatchUp:u}=o.targetMatchUps,c=l?.matchUpId,d=u?.matchUpId,p=Zg({matchUpsMap:i,structureId:s}).find(h=>h.matchUpId===a);if(p&&(c&&(n.winnerMatchUpIds[p.matchUpId]=c,Object.assign(p,{winnerMatchUpId:c}),Object.assign(r,{winnerMatchUpId:c})),d&&(n.loserMatchUpIds[p.matchUpId]=d,r.loserMatchUpId=d,p.loserMatchUpId=d,r.finishingPositionRange))){let h=u.finishingPositionRange&&[...r.finishingPositionRange.loser,...u.finishingPositionRange.loser],f=h&&[Math.min(...h),Math.max(...h)];r.finishingPositionRange.loser=f,p.finishingPositionRange.loser=f}}),{inContextDrawMatchUps:t,goesToMap:n}}function gd(t){let e=ic(t),i=t.matchUps??[],n=t.drawIds??[],{includeParticipantDependencies:r,tournamentRecord:a,drawDefinition:s}=t;if(!Array.isArray(i))return{error:Vm};if(!Array.isArray(n))return{error:Zd};let o=t.matchUpIds?.length?t.matchUpIds:i.map(y=>y.matchUpId);if(!Array.isArray(o))return{error:qw};let l={},u={},c={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),h=p.reduce((y,b)=>y.concat(b.events??[]).map(I=>(I.drawDefinitions||[]).map(S=>S.links||[])).flat(1/0),[]).filter(({linkType:y})=>y===qh),f=i;if(h.length){f=jd({nextMatchUps:!0,tournamentRecords:e}).matchUps;let y=h.reduce((b,I)=>{let S=I.source?.structureId,w=I.target?.structureId;return S&&w&&(c[w]=S),S&&!b.includes(S)&&b.push(S),b},[]);for(let b of y)l[b]=[];for(let b of f??[]){let I=b.containerStructureId||b.structureId;y.includes(I)&&l[I].push(b.matchUpId)}}let m=y=>{u[y]||(u[y]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[y]=[])},g=(y,b)=>{u[y].matchUpIds.forEach(I=>{u[b].matchUpIds.push(I)}),u[b].matchUpIds.push(y),u[y].dependentMatchUpIds.push(b),r&&u[y].participantIds.forEach(I=>u[b].participantIds.push(I))},v=y=>{let b=Object.keys(l).length;for(let I of y||[]){let{matchUpId:S,winnerMatchUpId:w,loserMatchUpId:T}=I;if(!o.length||o.includes(S)){if(m(S),r){let{individualParticipantIds:E}=wL(I);u[S].participantIds=E}w&&(m(w),g(S,w),d[w].push(S)),T&&(m(T),g(S,T),d[T].push(S)),u[S].sources.push(d[S]);let U=d[S].map(E=>u[E].sources[0]).flat(),C=d[S].map(E=>u[E].sources[1]).flat();if(u[S].sources.push(U,C),b){let E=I.containerStructureId||I.structureId,P=c[E];if(l[P])for(let M of l[P])m(M),g(M,S),d[M].push(S)}}}};if(s)Zy({drawDefinition:s}),f?.length||(f=uo({drawDefinition:s}).matchUps),v(f);else{if(f?.length||(f=jd({nextMatchUps:!0,tournamentRecords:e}).matchUps),!n.length){let y=p?.length?p.map(({events:b=[]})=>b.map(({drawDefinitions:I=[]})=>I.map(({drawId:S})=>S))).flat(1/0):[];y&&(n=y)}for(let y of n){let b=f?.filter(I=>I.drawId===y).sort(d0);if(!b?.find(({roundPosition:I})=>!I)){let I=b?.find(({tournamentId:w})=>w),{drawDefinition:S}=$o({tournamentRecord:e[I?.tournamentId],drawId:y});S&&Zy({drawDefinition:S})}v(b)}}return{positionDependencies:l,matchUpDependencies:u,sourceMatchUpIds:d,matchUps:f,...le}}function ca(t){let e=t?.matchUp,i=t?.score||e?.score,n=i?.sets?.[0],{side1Score:r,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o,side1PointScore:l,side2PointScore:u}=n||{},c=r||a||s||o||l||u;return!!(i?.sets?.length>1||c)}function yR({matchUpStatus:t}){return F3.includes(t)}function oxe({matchUpStatus:t}){return gL.includes(t)}function MG({matchUpStatus:t}){return $3.includes(t)}function gW({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:n,score:r}){let a=n?.find(({participantId:o})=>o),s=i?.filter(gW)?.length;return ca({score:r})||s||e&&a||t&&oxe({matchUpStatus:t})&&![On,ir,hd].includes(t)}function bR(t){let{drawDefinition:e,findContainer:i,structureId:n,event:r}=t,a=t.structure,{containedStructures:s}=rD({drawDefinition:e}),o=n?s[n]||[]:[],l={isCollectionMatchUp:!1};if(!a){let T=li({drawDefinition:e,structureId:n});if(T.error)return T;a=i?T.containingStructure??T.structure:T.structure}if(Fo({structure:a}))return{structure:a,isAdHoc:!0,error:GU};let{matchUps:u}=Kr({inContext:!0,matchUpFilters:l,drawDefinition:e,event:r}),c=u?.filter(T=>T.structureId===n||o.includes(T.structureId)),{matchUpDependencies:d}=gd({drawIds:[e.drawId],matchUps:u,drawDefinition:e}),p=[],h=[],f={},m=[];for(let T of u??[]){if(T.structureId===n||o.includes(T.structureId)){h.push(...T.drawPositions??[]);let U=T.roundNumber;for(let C of(T.drawPositions??[]).filter(Boolean))(!f[C]||U&&f[C]>U)&&(f[C]=U)}gW(T)&&(m.push(T),p.push(T.matchUpId,...d?.[T?.matchUpId]?.matchUpIds||[]))}let g=wi(h.filter(Boolean)).sort(ia),v=wi(p),y=wi(c?.map(({matchUpId:T,drawPositions:U})=>v.includes(T)?U:[]).flat().filter(Boolean)).sort(ia),{positionAssignments:b}=Nn({drawDefinition:e,structure:a}),I=b?.filter(T=>T.bye).map(T=>T.drawPosition),S=b?.filter(T=>T.qualifier).map(T=>T.drawPosition),w=g?.filter(T=>!y.includes(T))||[];return{allDrawPositions:g,inContextStructureMatchUps:c,drawPositionInitialRounds:f,activeDependentMatchUpIds:v,qualifyingDrawPositions:S,inactiveDrawPositions:w,positionAssignments:b,activeDrawPositions:y,byeDrawPositions:I,activeMatchUps:m,structure:a}}function pw({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&i?.includes(t)).map(({roundNumber:i})=>i).sort(ia)[0]}}var yg={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},vW=[];function Dl(t,e){Xn(t)&&(t={method:t}),(e||du())&&vW.push(t)}function lxe(t){return vW.slice()}function uxe(t){let e=lxe().map(i=>{let{color:n,keyColors:r,method:a,newline:s}=i,o=Object.keys(yg).includes(n)?yg[n]:yg.cyan,l=Object.keys(i).filter(c=>!["color","keyColors","method","newline"].includes(c)).map(c=>{let d=r&&Object.keys(r).includes(c)&&yg[r[c]]?yg[r[c]]:yg.brightwhite;return`${yg.white}${c}: ${d}${i[c]}`}).join(", "),u=a?.length<15?"		":"	";return[s?`
`:"",o,a,u,yg.white,l,yg.reset,`
`].join("")});e?.length&&console.log(...e)}function cxe(){vW.length=0}function $s(t){return[On,ir,_a].includes(t)}function Su({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,loserMatchUp:a,matchUpsMap:s,structureId:o,structure:l,event:u}){if(!n)return{error:Ot};if(l||({structure:l}=li({drawDefinition:n,structureId:o})),!l)return{error:or};o||({structureId:o}=l);let c="assignDrawPositionBye";Dl({method:c,color:"cyan",drawPosition:r}),s||(s=us({drawDefinition:n}));let{positionAssignments:d}=Nn({structure:l}),{activeDrawPositions:p}=bR({drawDefinition:n,structureId:o});if(d?.find(P=>P.drawPosition===r)?.bye)return{...le};let h=!!(a&&s.drawMatchUps.find(P=>P.loserMatchUpId===a?.matchUpId&&$s(P.matchUpStatus)));if(p?.includes(r)&&!h)return{error:OO};let f=d?.find(P=>P.drawPosition===r);if(!f)return{error:GU};let{filled:m,containsBye:g,assignedParticipantId:v}=dxe(f);if(g)return{...le};if(m&&!g&&!h)return ce({result:{error:PT},stack:c});let y=sn({tournamentRecord:i,drawDefinition:n,event:u}).appliedPolicies??{},b=Kr({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[],I={isCollectionMatchUp:!1},{matchUps:S}=cn({provisionalPositioning:t,drawDefinition:n,matchUpFilters:I,matchUpsMap:s,structure:l});if(d?.forEach(P=>{P.drawPosition===r&&(P.bye=!0,h&&(P.participantId=void 0))}),l.structureType===To)return pxe({tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUps:S}),Kg({tournamentId:i?.tournamentId,drawDefinition:n,structure:l,event:u}),yX({assignedParticipantId:v,isPositionAction:e,appliedPolicies:y,drawDefinition:n,drawPosition:r,structureId:o,stack:c});let{roundProfile:w,roundMatchUps:T}=go({matchUps:S}),U=(w&&Object.keys(w).map(P=>parseInt(P)).reverse())?.find(P=>w?.[P].drawPositions?.includes(r)),C=U?T?.[U].find(({drawPositions:P})=>P?.includes(r)):void 0;C&&Oue({tournamentRecord:i,drawDefinition:n,matchUp:C,event:u});let E=C?.drawPositions?.find(P=>P!==r);if(C&&E){let P=yW({sourceDrawPositions:C.drawPositions,matchUpId:C.matchUpId,inContextDrawMatchUps:b,drawPositionToAdvance:E,tournamentRecord:i,drawDefinition:n,matchUpsMap:s});if(P.error)return P}return Kg({tournamentId:i?.tournamentId,drawDefinition:n,structure:l,event:u}),yX({assignedParticipantId:v,isPositionAction:e,appliedPolicies:y,drawDefinition:n,drawPosition:r,structureId:o,stack:c})}function yX({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:n,drawPosition:r,structureId:a,stack:s}){return e&&IL({appliedPolicies:i,drawDefinition:n,positionAction:{removedParticipantId:t,drawPosition:r,structureId:a,name:s}}),ce({result:{...le},stack:s})}function dxe(t){let e=t.bye,i=t.qualifier,n=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:n,filled:e||i||n}}function Oue({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:n,event:r}){Object.assign(n,{matchUpStatus:"BYE",score:void 0,winningSide:void 0}),Zi({tournamentId:t?.tournamentId,eventId:i??r?.eventId,context:"setMatchUpStatusBye",drawDefinition:e,matchUp:n})}function pxe({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:n,event:r}){n.forEach(a=>{a.drawPositions?.includes(i)&&Oue({eventId:r?.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function yW({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,matchUpsMap:a,matchUpId:s,event:o}){Dl({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(b=>b.matchUpId===s),u=e.find(b=>b.matchUpId===s)?.structureId,{structure:c}=li({drawDefinition:r,structureId:u}),{positionAssignments:d}=Nn({structure:c}),p=d?.filter(b=>b.bye).map(b=>b.drawPosition),h=l?.drawPositions?.find(b=>b!==t),f=h&&p?.includes(h),{targetLinks:{loserTargetLink:m},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v,loserTargetDrawPosition:y}}=vo({inContextDrawMatchUps:e,drawDefinition:r,matchUpId:s});if(v&&v.structureId===c?.structureId&&hxe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:v,matchUpsMap:a,event:o}),g&&f&&g.structureId!==c?.structureId){let{roundNumber:b}=g;if(b===1){let I=Su({structureId:m.target.structureId,drawPosition:y,tournamentRecord:n,drawDefinition:r,event:o});if(I.error)return I}else Lue({loserTargetDrawPosition:y,tournamentRecord:n,loserTargetLink:m,drawDefinition:r,loserMatchUp:g,matchUpsMap:a,event:o})}return{...le}}function hxe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:a,matchUpsMap:s,event:o}){let l="advanceWinner",u=s.drawMatchUps.find(N=>N.matchUpId===a.matchUpId),c=e.find(N=>N.matchUpId===a.matchUpId)?.structureId,{structure:d}=li({drawDefinition:r,structureId:c}),{positionAssignments:p}=Nn({structure:d}),h=p?.find(({drawPosition:N})=>N===t)?.bye,f=u.drawPositions?.filter(Boolean),m=p?.filter(N=>f?.includes(N.drawPosition)),g=p?.find(({drawPosition:N})=>N===t),v=i?.find(N=>N!==t),y=(v&&m?.find(({drawPosition:N})=>N===v))?.bye,b=h&&y;if(b&&console.log({isByeAdvancedBye:b}),f?.length>1&&h&&!y)return ce({result:{error:PT},stack:l});let I=f?.find(N=>N!==t),S=b,w=[...(u.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),T=w.map(N=>!N&&!S||N===t?(S=!0,t):N).sort(ia);if(!S)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:m}),ce({result:{error:PT},stack:l});let U=p?.find(({drawPosition:N})=>N===I)?.bye,C=p?.find(({drawPosition:N})=>N===t)?.bye;Object.assign(u,{matchUpStatus:C||U?"BYE":Er,score:void 0,winningSide:void 0,drawPositions:T});let E=u.drawPositions.find(N=>!w.includes(N));Dl({method:l,color:"brightyellow",changedDrawPosition:E,pairedDrawPositionIsBye:U,drawPositionIsBye:C}),Zi({tournamentId:n?.tournamentId,matchUp:u,eventId:o?.eventId,context:l,drawDefinition:r});let{targetLinks:{loserTargetLink:P},targetMatchUps:{loserMatchUp:M,loserTargetDrawPosition:R}}=vo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(U||C){let N=U?t:I;if(N)yW({drawPositionToAdvance:N,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,matchUpsMap:s});else if(C&&P&&M)if(M.feedRound)Lue({loserTargetDrawPosition:R,tournamentRecord:n,loserTargetLink:P,drawDefinition:r,loserMatchUp:M,matchUpsMap:s});else{let A=1-a.roundPosition%2,_=M.drawPositions[A],x=Su({structureId:P.target.structureId,drawPosition:_,tournamentRecord:n,drawDefinition:r,event:o});if(x.error)return x}}}function Lue({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:s}){let{roundNumber:o}=r;Dl({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=(a?.mappedMatchUps||{})[r.structureId].matchUps,{initialRoundNumber:u}=pw({drawPosition:t,matchUps:l});if(u===o){let c=Su({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:n,event:s});if(c.error)return c}}function Fue({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:r,event:a}){let{matchUps:s}=cn({drawDefinition:i,matchUpsMap:n,structure:r,event:a});s.forEach(o=>{let l=t.filter(({drawPosition:u})=>o.drawPositions?.includes(u)).filter(u=>u.bye).length;o.winningSide||(Object.assign(o,{matchUpStatus:l?"BYE":Er}),Zi({tournamentId:e?.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a?.eventId,drawDefinition:i,matchUp:o}))})}function IR(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:n}=t,{tournamentRecord:r,drawDefinition:a,structureId:s,matchUpsMap:o,event:l}=t,{structure:u}=li({drawDefinition:a,structureId:s}),c=(ua({drawDefinition:a,structure:u}).positionAssignments||[]).find(p=>i&&p.participantId===i||n&&p.drawPosition===n);if(c&&i&&!n&&(n=c?.drawPosition),!n)return{error:HU};i||(i=c?.participantId);let{activeDrawPositions:d}=bR({drawDefinition:a,structureId:s});return d.includes(n)?{error:OO}:(e||({matchUps:e}=Kr({inContext:!0,drawDefinition:a,matchUpsMap:o})),NG({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,structureId:s,drawPosition:n,matchUpsMap:o,event:l}).drawPositionCleared?(Kg({tournamentId:r?.tournamentId,drawDefinition:a,structure:u,event:l}),{...le,participantId:i}):{error:dse})}function NG({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:a,event:s}){let{structure:o}=li({drawDefinition:i,structureId:a});if(!o)return{error:or};let l=ua({drawDefinition:i,structure:o}).positionAssignments||[],u=l.some(v=>{if(v.drawPosition===n)return delete v.participantId,delete v.qualifier,delete v.bye,!0});if(o.structureType===To)return Fue({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:o}),{drawPositionCleared:u,...le};let c={isCollectionMatchUp:!1},{matchUps:d}=cn({drawDefinition:i,matchUpFilters:c,matchUpsMap:r,structure:o,event:s}),{roundProfile:p,roundMatchUps:h}=go({matchUps:d}),f=(p&&Object.keys(p))?.map(v=>ri(v)),m=n,g=f?.map(v=>{let y=p?.[v]?.pairedDrawPositions?.find(E=>E.includes(m)),b=y?.find(E=>E!==m),I=l.find(E=>E.drawPosition===b),S=p?.[v+1],w=I?.bye,T=S?.pairedDrawPositions?.find(E=>E.includes(b)),U=w&&T&&S&&S.drawPositions?.includes(b),C=y&&{pairedDrawPositionByeAdvancedPair:!U&&T,pairedDrawPosition:b,targetDrawPosition:m,relevantPair:y,roundNumber:v};return U&&(m=b),C}).filter(v=>v?.targetDrawPosition)?.reduce((v,y)=>{let{roundNumber:b,relevantPair:I,targetDrawPosition:S,pairedDrawPosition:w,pairedDrawPositionByeAdvancedPair:T}=y,U={roundNumber:b,targetDrawPosition:S,relevantPair:I},C=T&&{roundNumber:b+1,targetDrawPosition:w,relevantPair:T,subsequentRoundRemoval:!0},E=[U,C].filter(Boolean);return v.concat(...E)},[]);return g?.forEach(({roundNumber:v,targetDrawPosition:y,relevantPair:b})=>{let I=h?.[v].find(S=>mo(S.drawPositions?.filter(Boolean),b.filter(Boolean)));I&&(fxe({inContextDrawMatchUps:t,targetDrawPosition:y,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:v,matchUpsMap:r}),$ue({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:I,drawPosition:n,matchUpsMap:r,structure:o,event:s}))}),{tasks:g,drawPositionCleared:u,positionAssignments:l}}function fxe({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,roundNumber:a,structureId:s}){let{structure:o}=li({drawDefinition:n,structureId:s});if(!o)return{error:or};if(o.structureType===To)return;r=r||us({drawDefinition:n});let l=(r?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:u}=pw({drawPosition:e,matchUps:l}),c=l?.filter(p=>p.roundNumber>=a&&p.roundNumber!==u&&p.drawPositions?.includes(e)),d=Nn({drawDefinition:n,structureId:s}).positionAssignments??[];return c?.forEach(p=>$ue({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,structure:o})),{...le}}function $ue({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:n,targetMatchUp:r,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let u="removeDrawPosition",c=r.drawPositions?.slice(),d=r.matchUpStatus,p=r.winningSide;s=s??us({drawDefinition:n});let h=s.mappedMatchUps[o.structureId].matchUps,{initialRoundNumber:f}=pw({drawPosition:a,matchUps:h});if(r.roundNumber&&f&&r.roundNumber>f){let T=(r.drawPositions??[]).map(U=>U===a?void 0:U);r.drawPositions=T}if(r.matchUpType===Hn){let T=(t?.find(U=>U.matchUpId===r.matchUpId)?.sides??[]).reduce((U,C,E)=>C.drawPosition===a?E:U,void 0);T!==void 0&&r.sides?.[T]?.lineUp&&(delete r.sides?.[T].lineUp,Zi({tournamentId:i?.tournamentId,context:`${u}-TEAM`,eventId:l?.eventId,matchUp:r,drawDefinition:n}))}let m=vo({matchUpId:r.matchUpId,inContextDrawMatchUps:t,drawDefinition:n}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:v,winnerMatchUp:y,loserMatchUpDrawPositionIndex:b}}=m,I=e.filter(({drawPosition:T})=>r.drawPositions?.includes(T)).filter(T=>T.bye).length,S=I&&"BYE"||r.matchUpStatus&&$s(r.matchUpStatus)&&r.matcHUpStatus||Er;r.matchUpStatus=S,r.matchUpStatus&&$s(r.matchUpStatus)&&(r.winningSide=void 0);let w=c?.find(T=>!r.drawPositions?.includes(T));if(c?.includes(a)&&d===r.matchUpStatus&&p===r.winningSide||(w&&Dl({method:u,color:"brightyellow",removedDrawPosition:w}),Zi({tournamentId:i?.tournamentId,context:`${u}-${a}`,eventId:l?.eventId,matchUp:r,drawDefinition:n})),v&&v.structureId!==m.matchUp.structureId&&!I){let{drawPositions:T,roundNumber:U}=v;if(U===1){let C=T[b];NG({structureId:v.structureId,drawPosition:C,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:s})}else{let C=Math.min(...T.filter(Boolean)),E=mxe({loserMatchUpDrawPosition:C,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,loserMatchUp:v,matchUpsMap:s,event:l});if(E.error)return ce({result:E,stack:u});let P=(s?.mappedMatchUps||{})[v.structureId].matchUps,{initialRoundNumber:M}=pw({drawPosition:C,matchUps:P});M===1&&(Dl({method:u,color:"brightyellow",loserMatchUpDrawPosition:C}),NG({structureId:v.structureId,drawPosition:C,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:s}))}}return y&&y.structureId!==m.matchUp.structureId&&g.target.feedProfile,{...le}}function mxe({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:s}){let{structure:o}=li({structureId:r.structureId,drawDefinition:n}),{positionAssignments:l}=Nn({structure:o});if(l?.find(u=>u.drawPosition===t)?.bye){let u=IR({drawPosition:t,structureId:r.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:a,event:s});if(u.error)return u}return{...le}}function Ab({drawDefinition:t,stages:e}){if(!t)return{error:Ot};let i=(t?.structures??[]).filter(r=>!e?.length||r.stage&&e.includes(r.stage)),n=wi(i.map(r=>{let{positionAssignments:a}=Nn({structure:r});return a?a.map(Vi):[]}).flat().filter(Boolean));return{...le,assignedParticipantIds:n}}function xd(t){let e=(t?.entries??[]).filter(Boolean).reduce((n,r)=>{let{entryStage:a,entryStatus:s}=r,o=`_${a||Nt}${s||""}`;return n[o]||(n[o]=[]),n[o].push(r),n},{}),i=n=>isNaN(n)?1/0:n;return Object.keys(e).map(n=>e[n].sort((r,a)=>i(r.entryPosition)-i(a.entryPosition)).map((r,a)=>{let s=a+1;return{...r,entryPosition:s}})).flat()}function cy(t){return[Rb,rc].includes(t)}function Ik({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:n,participantIds:r,entryStatus:a,entryStage:s,extension:o,eventSync:l,drawId:u,stage:c,event:d}){if(!r||!Array.isArray(r))return{error:Bd,method:"modifyEntriesStatus",participantIds:r};if(!n&&!d)return{error:qn};if(a&&!due.includes(a))return{error:mG};if(s&&!eL.includes(s))return{error:Sb};let p="modifyEntriesStatus",h=[];if(!a&&!o)return ce({result:{error:Zt},info:"Missing entryStatus",stack:p});if(o&&!$p({extension:o,requiredAttributes:["name"]}))return ce({result:{error:Ee},info:"Invalid extension",context:{extension:o},stack:p});let f=[];d?.drawDefinitions?.forEach(C=>{let E=Ab({stages:c&&[c],drawDefinition:C}).assignedParticipantIds??[];f.push(...E)});let m=i?.participants??[];if(!r.every(C=>{let E=qg({tournamentParticipants:m,participantId:C})?.participantType;return!(E&&[Ni,_o].includes(E)&&cy(a))&&!(a&&d?.eventType&&E===ji&&[Yu,Nl].includes(d.eventType)&&[Hc,...o_].includes(a))}))return{error:mG};let g=d&&Cr({event:d}).flightProfile,v=g?.flights?.find(C=>C.drawId===u),y=C=>{let E=(C||[]).filter(M=>!c||!M.entryStage||c===M.entryStage).filter(({participantId:M})=>r.includes(M)),P=M=>a&&f.includes(M.participantId)&&!(o_.includes(M.entryStatus)&&o_.includes(a));return E.every(M=>P(M)&&!e?!1:(a&&(M.entryStatus=a,delete M.entryPosition),s&&(M.entryStage=s,delete M.entryPosition),o&&(o.value?un({element:M,extension:o}):lo({element:M,name:o.name})),!0))?{...le}:{error:WU}},b=({flight:C,drawDefinition:E})=>{d&&(d.entries=xd({entries:d.entries??[]})),C&&(C.drawEntries=xd({entries:C.drawEntries})),E&&(E.entries=xd({entries:E.entries}))},I=C=>{let{flight:E,drawDefinition:P}=C,M="updateDrawEntries";if(E){let R=y(E.drawEntries);if(R.error)return ce({result:R,stack:M})}if(P){let R=y(P.entries);if(R.error)return ce({result:R,stack:M});h.includes(P.drawId)||h.push(P.drawId)}return{...le}},S=d?.entries?.find(({entryPosition:C})=>C)??(v?.drawEntries?.find(({entryPosition:C})=>C)||n?.entries?.find(({entryPosition:C})=>C));if(t&&!S&&b({flight:v,drawDefinition:n}),v||n){let C=I({flight:v,drawDefinition:n});if(C.error)return ce({result:C,stack:p})}let w=d?.drawDefinitions?.map(({drawId:C})=>C)??[],T=g?.flights?.filter(C=>!w.includes(C.drawId))||[];for(let C of T){let E=C&&I({flight:C});if(E?.error)return ce({result:E,stack:p})}let U=g?.flights?.length===1&&(d?.drawDefinitions?.length??0)<=g?.flights?.length;if(!v&&!n&&a&&cue.includes(a))return{error:Zse};if(!v&&!n||a===Jh||l&&U){let C=y(d?.entries);if(C?.error)return ce({result:C,stack:p});let E;if(a===Jh&&(g?.flights?.every(P=>{let M=y(P.drawEntries);return M.error?(E=M.error,!1):(P.drawEntries=P.drawEntries.filter(({participantId:R})=>!r.includes(R)),!0)}),d?.drawDefinitions?.every(P=>{let M=y(P.entries);return M.error?(E=M.error,!1):(P.entries=P.entries?.filter(({participantId:R})=>!r.includes(R)),!0)})),E)return ce({result:{error:E},stack:p})}t&&b({flight:v,drawDefinition:n});for(let C of d?.drawDefinitions??[])h.length&&!h.includes(C.drawId)||Ln({tournamentId:i.tournamentId,eventId:d?.eventId,drawDefinition:C});return{...le}}function _h({requireTimeStamp:t,scaleAttributes:e,participant:i}){if(!i)return{error:Kw};if(!Ki(e))return{error:Ee};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:n,scaleType:r,eventType:a,scaleName:s}=e,o=[Wy,r,a,s].join("."),l=i.timeItems.filter(u=>u?.itemType===o).filter(u=>!t||u?.itemDate).sort((u,c)=>(u.createdAt?new Date(u.createdAt).getTime():0)-(c.createdAt?new Date(c.createdAt).getTime():0)).pop();if(l){let[u,c,d,p]=l.itemType?.split(".")??[];if(u!==Wy)return{error:aw};let h=(n&&kI({element:l.itemValue,accessor:n}))?.value||l.itemValue,f={eventType:d,scaleDate:l.itemDate,scaleValue:h,scaleName:p,scaleType:c};return{...le,scaleItem:f}}}return{...le,scaleItem:void 0}}function gxe({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:n,event:r}){let a={},s=c=>[Wy,Nh,r.eventType,c].join("."),o=Object.assign({},...(n.timeItems||[]).filter(({itemType:c})=>c.split(".")[1]===Nh).map(({itemType:c,itemValue:d})=>({[c]:d}))),l=(t?.stageSeedingScaleNames&&Object.values(t?.stageSeedingScaleNames)||Array.isArray(t?.seedingScaleNames)&&t.seedingScaleNames||[]).map(s),u=Dr(Object.keys(o),l);if((!e||!Object.keys(o).length&&!t?.drawIds?.length||u.length)&&u.length){if(t?.stageSeedingScaleNames){let c=Object.keys(t.stageSeedingScaleNames).map(p=>{let h=s(t.stageSeedingScaleNames[p]),f=o[h];return[p,f]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...c);a.seedAssignments=d}else if(u){let c=u.map(d=>o[d]);a.seedValue=c.pop()}}else if(!e&&typeof i=="object"){let c=Object.keys(i).map(p=>{let h=s(i[p]),f=o[h];return[p,f]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...c);a.seedAssignments=d}else{let{categoryName:c,ageCategoryCode:d}=r.category||{},p=[d,r.eventId,c].filter(Boolean),h;for(let f of p){let m={eventType:r.eventType,scaleType:Nh,scaleName:f},g=_h({scaleAttributes:m,participant:n});if(g.scaleItem){h=g.scaleItem;break}}if(h&&(!e||t?.published&&!t?.published?.drawIds?.length)){let f=h.scaleValue;a.seedValue=f}}return a}function vxe({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:n,seedValue:r,eventId:a,ranking:s,entry:o}){let{entryStatus:l,entryStage:u,entryPosition:c,extensions:d}=o,p=d?.length&&t?Object.assign({},...h3(d??[])):{},h=Object.assign(p,{entryPosition:c,entryStatus:l,entryStage:u,ranking:s,eventId:a});i.events[a]=Vt(h,!1,!1,!0),n&&(e&&(i.events[a].seedAssignments=e),r&&(i.events[a].seedValue=r))}function wR(t){let e=zt(t,[{[ha]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:n=wu}=t,r=`${Dv}.${Ev}`;return Ct(TL({tournamentRecord:i,itemType:r})?.timeItem?.itemValue?.[n],!1,!0)}function yxe(t){let{tournamentId:e}=t??{};return!!e}function sc({event:t,status:e=wu}){let i=`${Dv}.${Ev}`;return aR({itemType:i,event:t})?.timeItem?.itemValue?.[e]}function bW({drawDetails:t,drawId:e}){return t?.[e]?.publishingDetail?.published}function p0(t){let{tournamentRecord:e,drawDefinition:i,eventIds:n,eventId:r,drawIds:a,drawId:s,event:o}=t??{};if(e&&!yxe(e))return{error:Ee};if(r&&!o)return{error:Wu};if(Array.isArray(n)&&n?.length){let d={};for(let p of n){if(!Xn(p))return{error:Ee};let h=$o({tournamentRecord:e,eventId:p})?.event;if(!h)return{error:Wu};let f=tV({event:h});d[p]=f}return{...le,publishState:d}}if(o){let d=tV({event:o}),p={};if(s)return i?{publishState:{status:{published:!!d.status.publishedDrawIds?.includes(s),drawDetail:d.status.drawDetails?.[s]},...le}}:{error:cu};if(Array.isArray(a)&&a?.length){let h=o.drawDefinitions?.map(hC)??[];for(let f of a){if(!Xn(f))return{error:Ee};if(!h.includes(f))return{error:cu};p[f]={status:{published:!!d.status.publishedDrawIds.includes(f),drawDetail:d.status.drawDetails?.[f]}}}}else p=d;return{...le,publishState:p}}let l=[],u=!1,c={};for(let d of e?.events??[]){let p=tV({event:d});c[d.eventId]=p,p.status.published&&(l.push(d.eventId),u=!0);for(let{drawId:h}of d.drawDefinitions??[]){let f=p.status?.publishedDrawIds?.includes(h);f&&(c[h]={status:{published:f}})}}if(e){let d=wR({tournamentRecord:e});c.tournament=d??{},(d?.orderOfPlay?.published||d?.participants?.published)&&(u=!0),c.tournament.status={published:u,publishedEventIds:l}}return{...le,publishState:c}}function tV({event:t}){let e=sc({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let n=e.drawDetails??{};for(let o of t.drawDefinitions?.map(hC)||[])n[o]||(n[o]={publishingDetail:{published:!1}});let r=n&&Object.keys(n).length&&Object.keys(n).filter(o=>bW({drawDetails:n,drawId:o})),a=r?.length?r:e.drawIds??[];if(a?.length&&!r?.length)for(let o of a)n[o]={publishingDetail:{published:!0}};let s=a?.length>0;return{status:{publishedDrawIds:a,publishedSeeding:i,drawDetails:n,published:s}}}function Bue(t){let{participantMap:e,participantId:i,matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:u,schedule:c,drawId:d,score:p}=t;!c||!Object.keys(c).length||n==="BYE"||e[i].scheduleItems.push({...c,scheduledDate:Pi(c?.scheduledDate),scheduledTime:Jn(c?.scheduledTime),checkScoreHasValue:ca({score:p}),matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:u,drawId:d})}function bxe({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:n,matchUpStatus:r,participantId:a,stageSequence:s,roundNumber:o,structureId:l,matchUpId:u,drawId:c,stage:d}){let p=e[a],h=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:s,winCount:0,structureId:l,drawId:c});let f=p.structureParticipation[l],{winner:m,loser:g}=t,v=n?m:g;n&&(f.winCount+=1,r===ir&&(f.walkoverWinCount+=1),r===On&&(f.defaultWinCount+=1)),v&&(!f.finishingPositionRange||h(v)<h(f.finishingPositionRange))&&(f.finishingPositionRange=v),i&&((!f.finishingRound||i<f.finishingRound)&&(f.finishingMatchUpId=u,f.finishingRound=i,f.roundNumber=o),i===1&&(f.participantWon=n))}function bX(t){let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:n,participantMap:r,withOpponents:a,withMatchUps:s,withEvents:o,withDraws:l,finishingPositionRange:u,finishingRound:c,matchUpStatus:d,stageSequence:p,roundNumber:h,structureId:f,score:m,stage:g,withRankingProfile:v,tieWinningSide:y,roundPosition:b,matchUpTieId:I,matchUpSides:S,collectionId:w,matchUpType:T,winningSide:U,matchUpId:C,schedule:E,eventId:P,drawId:M,sides:R}=t,N=a&&R?.length===2&&Object.assign({},...R.map(({sideNumber:A},_)=>{let x=R[1-_].participantId;return A&&{[A]:x}}).filter(Boolean));for(let A of R){let{participantId:_,sideNumber:x,bye:O}=A;if(O)continue;let $=U===x,F=G=>{let W=r[G]?.participant,q=W?.participantType,Z=[{participantId:G,participantType:q}];if(q!==_o)for(let K of W?.individualParticipantIds||[]){let Q=r[K]?.participant;Z.push({participantType:Q?.participantType,participantId:K})}return Z},j=(G,W)=>{if(s){if(r[G].matchUps[C]={participantWon:$,matchUpType:T,structureId:f,sideNumber:x,matchUpId:C,eventId:P,drawId:M,stage:g},a){let q=F(W);r[G].matchUps[C].opponentParticipantInfo=q}w&&(r[G].matchUps[C].collectionId=w)}a&&W&&(r[G].opponents[W]={participantId:W,matchUpId:C,eventId:P,drawId:M}),v&&bxe({finishingPositionRange:u,participantMap:r,participantWon:$,finishingRound:c,matchUpStatus:d,participantId:G,stageSequence:p,roundNumber:h,structureId:f,matchUpId:C,drawId:M,stage:g}),(i||e)&&Bue({participantMap:r,participantId:G,matchUpStatus:d,roundPosition:b,matchUpType:T,roundNumber:h,structureId:f,matchUpId:C,schedule:E,drawId:M,score:m})},H=({participant:G,partnerParticipantId:W})=>{let q=(Z,K)=>{Z&&(Z.partnerParticipantIds||(Z.partnerParticipantIds=[]),Z.partnerParticipantIds.includes(K)||Z.partnerParticipantIds.push(K))};l&&q(G?.draws?.[M],W),o&&q(G?.events?.[P],W),s&&q(G?.matchUps?.[C],W)};if(_&&r[_]){let G=N?.[x];j(_,G);let W=r[_]?.participant.participantType===Ni,q=r[_]?.participant.individualParticipantIds||[];if(I){if(n){let Z=K=>r[K].matchUps[I]={participantWon:y===x,matchUpId:I,matchUpType:Hn,sideNumber:x};Z(_),q.forEach(Z)}if(l&&!r[_].draws[M]){let Z=S.find(J=>J.sideNumber===x)?.participant?.participantId,K=r[Z]?.draws?.[M]?.entryStatus,Q=J=>r[J].draws[M]={entryStatus:K,eventId:P,drawId:M};Q(_),q.forEach(Q)}}if(W&&(q.forEach(Z=>r[Z]&&j(Z,G)),q.forEach((Z,K)=>{let Q=q[1-K],J=r[Z];J&&H({participant:J,partnerParticipantId:Q})}),o&&S)){let Z=S.find(K=>K.sideNumber===x)?.participant?.participantId;if(Z){let K=r[Z]?.events[P];K?(r[_].events[P]={...K},q.forEach(Q=>r[Q].events[P]={...K})):console.log("Missing teamEntry",{eventId:P,teamParticipantId:Z})}}if(U){let Z=K=>{$?(r[K].counters[T].wins+=1,r[K].counters.wins+=1,d===ir&&(r[K].counters[T].walkoverWins+=1,r[K].counters.walkoverWins+=1),d===On&&(r[K].counters[T].defaultWins+=1,r[K].counters.defaultWins+=1)):(r[K].counters[T].losses+=1,r[K].counters.losses+=1,d===ir&&(r[K].counters[T].walkovers+=1,r[K].counters.walkovers+=1),d===On&&(r[K].counters[T].defaults+=1,r[K].counters.defaults+=1))};Z(_),q.forEach(Z)}}}}function _L(t,e){return(t||"").localeCompare(e||"")}function Ixe(t){let{participantFilters:e,convertExtensions:i,policyDefinitions:n,tournamentRecord:r,usePublishState:a,contextFilters:s,matchUpFilters:o,participantMap:l,contextProfile:u,withPotentialMatchUps:c,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:h,withTeamMatchUps:f,withStatistics:m,withOpponents:g,withMatchUps:v,withSeeding:y,withEvents:b,withDraws:I}=t,S=e?.participantIds,w=A=>{let _=[A];return l[A]?.participant.individualParticipantIds?.forEach(x=>_.push(x)),_.some(x=>!S?.length||S.includes(x))?_:[]},T={withMatchUps:v||d,withEvents:b||d,withDraws:I||d,withPotentialMatchUps:c,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:h,withTeamMatchUps:f,withStatistics:m,participantMap:l,withOpponents:g,withSeeding:y},U=[],C={},E=[],P={},M={},R={},N=({eventType:A,scaleNames:_,participantId:x})=>l[x]?.participant?.rankings?.[A]?.find(O=>_.includes(O.scaleName))?.scaleValue;for(let A of r?.events||[]){if(e?.eventIds&&!e.eventIds.includes(A.eventId))continue;let{drawDefinitions:_=[],extensions:x=[],eventType:O,eventName:$,category:F,entries:j,eventId:H,gender:G}=A,{flightProfile:W}=Cr({event:A}),q=W?.flights??[],Z=p0({event:A}).publishState;Z&&(P[H]=Z);let K=Z?.status?.publishedSeeding;if(b||y||d){let J=i?Object.assign({},...h3(x??[])):{};M[H]={...J,eventName:$,eventType:O,category:F,eventId:H,gender:G};let ne=[F?.categoryName,F?.ageCategoryCode].filter(Boolean);for(let re of j){let{participantId:oe}=re;if(!oe||!l[oe])continue;let de=N({eventType:O,scaleNames:ne,participantId:oe}),se,ge;if(y){let Te=l[oe].participant;({seedAssignments:se,seedValue:ge}=gxe({publishedSeeding:K,usePublishState:a,withSeeding:y,participant:Te,event:A}))}let ye=Te=>{if(l[Te]?.events?.[H])return;let De=l[Te];vxe({convertExtensions:i,seedAssignments:se,participant:De,withSeeding:y,seedValue:ge,eventId:H,ranking:de,entry:re})};ye(oe),(l[oe].participant.individualParticipantIds||[]).forEach(ye)}}let Q=P?.[H]?.publishedSeeding;if(I||d||y){let J=re=>re?Object.assign({},...re.map(({participantId:oe,seedValue:de,seedNumber:se})=>({[oe]:{seedValue:de,seedNumber:se}}))):void 0,ne=wi([..._.map(hC),...q.map(hC)]);for(let re of ne){let oe=_.find(he=>he.drawId===re),de=[F?.categoryName,F?.ageCategoryCode].filter(Boolean),{structures:se=[],drawOrder:ge,drawName:ye,drawType:Te}=oe??{},De=q?.find(he=>he.drawId===re),xe=oe?.entries||De?.drawEntries,Me=De?.flightNumber,Oe=(oe?.structures||[]).sort((he,we)=>n0(he,we)).map(({structureId:he,structures:we})=>[he,...(we||[]).map(({structureId:be})=>be)]).flat(1/0),at,Fe,mt,Xe,gt=0,ht=se.filter(({stage:he,stageSequence:we})=>he===Nt&&we===1||he===qt).flatMap(he=>{let{positionAssignments:we}=Nn({structure:he}),{seedAssignments:be,stageSequence:Ae,stage:ze}=he;return ze===Nt?(gt=we?.length??0,mt=we,Xe=be):Ae===1&&(at=we,Fe=be),we}).map(({participantId:he})=>he).filter(Boolean),_e=J(Xe),Ye=J(Fe),Je=oe?xe.filter(({participantId:he})=>ht.includes(he)):xe,ct=!a||Q?.published&&(Q?.drawIds?.length===0||Q?.drawIds?.includes(re));for(let he of Je){if(!l[he.participantId])continue;let{entryStatus:we,entryStage:be,entryPosition:Ae,participantId:ze}=he,We=N({participantId:ze,scaleNames:de,eventType:O}),Le=ft=>{if(!l[ft]||l[ft].draws?.[re])return;let rt=y&&ct,St=rt?{}:void 0,si=rt?_e?.[ze]?.seedValue||_e?.[ze]?.seedNumber:void 0,Qe=si?_e?.[ze]:void 0,bt=rt?Ye?.[ze]?.seedValue||Ye?.[ze]?.seedNumber:void 0,ci=bt?Ye?.[ze]:void 0;St&&si&&(St[Nt]=Qe),St&&bt&&(St[qt]=ci);let Tt=si||bt;Tt&&(l[ft].participant.seedings[O]||(l[ft].participant.seedings[O]=[]),Qe&&l[ft].participant.seedings[O].push({...Qe,scaleName:re}),ci&&l[ft].participant.seedings[O].push({...ci,scaleName:re}),St&&(l[ft].events[H].seedAssignments||(l[ft].events[H].seedAssignments={}),Object.keys(St).forEach(Li=>l[ft].events[H].seedAssignments[Li]=St[Li]))),(I||d)&&(l[ft].draws[re]=Vt({seedAssignments:St,entryPosition:Ae,entryStatus:we,entryStage:be,seedValue:Tt,eventId:H,ranking:We,drawId:re},!1,!1,!0))};[rc,Rb].includes(we)||(Le(ze),(l[ze].participant.individualParticipantIds||[])?.forEach(Le))}let pt=(oe?.structures??[]).reduce((he,we)=>(he.includes(we.stage)||he.push(we.stage),he),[]),Se=(oe?.links??[]).length;R[re]={qualifyingPositionAssignments:at,qualifyingSeedAssignments:Fe,mainPositionAssignments:mt,qualifyingSeedingMap:Ye,mainSeedAssignments:Xe,orderedStructureIds:Oe,mainSeedingMap:_e,flightNumber:Me,linksCount:Se,drawOrder:ge,drawName:ye,drawType:Te,drawSize:gt,drawId:re,stages:pt}}}if(d||h||f||m||g||v||I){let J=!!h||c,ne=gf({afterRecoveryTimes:!!h,policyDefinitions:n,tournamentRecord:r,inContext:!0,participantMap:l,contextFilters:s,matchUpFilters:o,contextProfile:u,nextMatchUps:J,event:A})?.matchUps??[];for(let re of ne){let{finishingPositionRange:oe,potentialParticipants:de,tieMatchUps:se=[],sides:ge=[],winningSide:ye,matchUpType:Te,matchUpId:De,eventId:xe,drawId:Me,collectionId:Oe,stageSequence:at,finishingRound:Fe,matchUpStatus:mt,roundPosition:Xe,roundNumber:gt,structureId:ht,schedule:_e,score:Ye,stage:Je}=re;C[De]=re;let ct={finishingPositionRange:oe,finishingRound:Fe,stageSequence:at,roundPosition:Xe,collectionId:Oe,roundNumber:gt,structureId:ht,schedule:_e,eventId:xe,drawId:Me,score:Ye,stage:Je};bX({...ct,...T,matchUpStatus:mt,winningSide:ye,matchUpType:Te,matchUpId:De,sides:ge});for(let pt of se){let{winningSide:Se,sides:he=[],matchUpId:we,matchUpStatus:be,matchUpType:Ae}=pt;bX({...ct,...T,winningSide:Se,tieWinningSide:ye,matchUpTieId:De,matchUpId:we,sides:he,matchUpSides:ge,matchUpStatus:be,matchUpType:Ae})}Array.isArray(de)&&(J||h||p)&&de.flat().map(Vi).filter(Boolean)?.forEach(pt=>{w(pt)?.forEach(Se=>{l[Se]&&(l[Se].potentialMatchUps[De]=Vt({tournamentId:r?.tournamentId,matchUpId:De,eventId:xe,drawId:Me}))}),(h||p)&&Bue({potential:!0,participantMap:l,participantId:pt,matchUpStatus:mt,roundPosition:Xe,structureId:ht,matchUpType:Te,roundNumber:gt,matchUpId:De,schedule:_e,drawId:Me,score:Ye})})}E.push(...ne)}}if(m||d||h){let A=Object.values(l);for(let _ of A){let{wins:x,losses:O,[Rn]:{wins:$,losses:F},[Dn]:{wins:j,losses:H}}=_.counters,G=(W,q,Z)=>{let K=q+Z,Q=q,J=K&&Q/K;_.statistics[W]={denominator:K,numerator:Q,statValue:J,statCode:W}};if(m&&(G(s_,x,O),G(`${s_}.${Rn}`,$,F),G(`${s_}.${Dn}`,j,H)),d){let W=(q=[])=>Math.abs(q[0]-q[1]);for(let q of Object.keys(_.draws)){let{orderedStructureIds:Z=[],flightNumber:K}=R[q]||{};if(_.structureParticipation&&Z.length){let Q,J=0,ne=Z.map(re=>{let oe=_.structureParticipation[re];if(!oe)return;Q||(Q=oe?.finishingPositionRange),W(Q)>W(oe?.finishingPositionRange)&&(Q=oe?.finishingPositionRange);let de=oe.stage!==qt;return de&&(J+=1),Vt({...oe,participationOrder:de?J:void 0,flightNumber:K})}).filter(Boolean);_.draws[q]&&(_.draws[q].finishingPositionRange=Q,_.draws[q].structureParticipation=ne)}}}if(h){let W=Ki(h)?h.scheduledMinutesDifference:0,q=_.scheduleItems||[],Z=_.potentialMatchUps||{},K=q.reduce((J,ne)=>{let{scheduledDate:re,scheduledTime:oe}=ne;return J[re]||(J[re]=[]),oe&&J[re].push(ne),J},{});Object.values(K).forEach(J=>J.sort(_oe));for(let J of q){let{typeChangeTimeAfterRecovery:ne,timeAfterRecovery:re,scheduledDate:oe,scheduledTime:de}=J,se=K[oe],ge=rn(de);for(let ye of se){if(ye.matchUpId===J.matchUpId||$s(ye.matchUpStatus)&&!ye.checkScoreHasValue)continue;let Te=J.matchUpType!==ye.matchUpType&&ne||re,De=J.drawId===ye.drawId,xe=Z[J.matchUpId]&&Z[ye.matchUpId],Me=rn(ye.scheduledTime),Oe=Math.abs(Me-ge),at=Me>=ge;if((W&&!isNaN(W)?Oe<=W:at&&rn(ye.scheduledTime)<rn(Te))&&!(xe&&De)&&at){let Fe=[J.matchUpId,ye.matchUpId].sort(_L).join("|");_.scheduleConflicts[Fe]={priorScheduledMatchUpId:J.matchUpId,matchUpIdWithConflict:ye.matchUpId}}}}let Q=_.participant.participantId;Object.keys(_.scheduleConflicts).length&&U.push(Q),l[Q].scheduleConflicts=_.scheduleConflicts}}}return{participantIdsWithConflicts:U,eventsPublishStatuses:P,derivedEventInfo:M,derivedDrawInfo:R,mappedMatchUps:C,participantMap:l,matchUps:E}}function SR({participantFilters:t={},tournamentRecord:e,participants:i=[]}){if(!Object.keys(t).length)return i;let{accessorValues:n,drawEntryStatuses:r,positionedParticipants:a,eventEntryStatuses:s,participantRoles:o,participantRoleResponsibilities:l,participantTypes:u,participantIds:c,signInStatus:d,enableOrFiltering:p,eventIds:h,genders:f}=t,m=hh(h)&&e?.events?.filter(I=>h?.includes(I.eventId))||e?.events||[],g=r&&wxe({drawEntryStatuses:r,tournamentEvents:m}),v=s&&Sxe({eventEntryStatuses:s,tournamentEvents:m}),y=a!==void 0&&[!0,!1].includes(a)&&m.reduce((I,S)=>I.concat(...(S.drawDefinitions||[]).map(w=>Wle({drawDefinition:w}).allPositionedParticipantIds).filter(Boolean)),[]),b=I=>n?.reduce((S,w)=>{let{accessor:T,value:U}=w,{values:C}=kI({element:I,accessor:T});return S&&C?.includes(U)},!0);if(i=i?.filter(I=>{let S=nc({element:I,itemType:rR})?.timeItem?.itemValue,{participantRoleResponsibilities:w,participantType:T,participantRole:U,participantId:C,person:E}=I,P=Array.isArray(f)&&f?.length&&E?.sex&&f.includes(E.sex);return p?f&&P||a&&y.includes(C)||a===!1&&!y.includes(C)||g?.includes(C)||v?.includes(C)||c?.includes(C)||d&&S===d||u&&T&&hh(u)&&u.includes(T)||o&&U&&hh(o)&&o.includes(U)||l&&hh(w)&&hh(l)&&l.find(M=>w?.includes(M))||n?.length&&hh(n)&&b(I):(!f||P)&&(a===void 0||a&&y.includes(C)||a===!1&&!y.includes(C))&&(!g||g.includes(C))&&(!v||v.includes(C))&&(!c||c.includes(C))&&(!d||S===d)&&(!u||T&&hh(u)&&u.includes(T))&&(!o||U&&hh(o)&&o.includes(U))&&(!l||hh(w)&&hh(l)&&l.find(M=>w?.includes(M)))&&(!n?.length||hh(n)&&b(I))}),m.length&&h){let I=m.filter(S=>h.includes(S.eventId)).map(S=>{let w=(S.entries||[]).map(U=>U.participantId);if(_r(Lp)(S.eventType))return w;let T=(e?.participants??[]).filter(U=>w.includes(U.participantId)).map(U=>U.individualParticipantIds).flat(1);return w.concat(...T)}).flat(1);i=i?.filter(S=>I.includes(S.participantId))}return i}function hh(t){return t&&Array.isArray(t)&&t.length}function wxe({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:n})=>Array.isArray(t)?t.includes(n):!0;return wi(e.reduce((n,r)=>{let{flightProfile:a}=Cr({event:r}),s=a?.flights?.map(({drawEntries:l})=>Array.isArray(l)?l.filter(i).map(Vi):[]).flat()||[],o=r.drawDefinitions?.map(({entries:l})=>l?l.filter(i).map(Vi):[])||[];return n.concat(...s,...o)},[]))}function Sxe({eventEntryStatuses:t,tournamentEvents:e}){return wi(e.reduce((i,n)=>{let r=(n.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(Vi);return i.concat(...r)},[]))}function dr(t){let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:n,withRankingProfile:r,convertExtensions:a,policyDefinitions:s,withScheduleItems:o,tournamentRecord:l,scheduleAnalysis:u,withSignInStatus:c,withTeamMatchUps:d,withScaleValues:p,usePublishState:h,withStatistics:f,contextFilters:m,matchUpFilters:g,contextProfile:v,withOpponents:y,withMatchUps:b,internalUse:I,withSeeding:S,withEvents:w,withDraws:T,withISO2:U,withIOC:C}=t;if(!l)return{error:ot};(b||r)&&gd({tournamentRecord:l});let E=lue({convertExtensions:a,tournamentRecord:l,withSignInStatus:c,withScaleValues:p,internalUse:I,withISO2:U,withIOC:C}),{participantMap:P}=E,M=Ixe({withMatchUps:b??r,withEvents:w??r,withDraws:T??r,withPotentialMatchUps:n,participantFilters:i,withRankingProfile:r,convertExtensions:a,withScheduleItems:o,policyDefinitions:s,tournamentRecord:l,scheduleAnalysis:u,withTeamMatchUps:d,usePublishState:h,withStatistics:f,contextFilters:m,matchUpFilters:g,participantMap:P,withOpponents:y,contextProfile:v,withSeeding:S}),{participantIdsWithConflicts:R,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:_,mappedMatchUps:x}=M,O=M.matchUps;P=M.participantMap;let $=u??n,F=({potentialMatchUps:Z,scheduleConflicts:K,scheduleItems:Q,participant:J,statistics:ne,opponents:re,matchUps:oe,events:de,draws:se})=>{let ge=Object.values(se),ye=Object.values(re);return y&&ge?.forEach(Te=>{Te.opponents=ye.filter(De=>De.drawId===Te.drawId)}),Vt({...J,scheduleConflicts:u?Object.values(K):void 0,draws:T||r?ge:void 0,events:w||r?Object.values(de):void 0,matchUps:b||r?Object.values(oe):void 0,opponents:y?ye:void 0,potentialMatchUps:$?Object.values(Z):void 0,statistics:f?Object.values(ne):void 0,scheduleItems:o?Q:void 0},!1,!1,!0)},j=new Map;for(let Z of Object.keys(P))j.set(Z,F(P[Z]));let H=[...j.values()],G=s?.[tD]?.participant,W=SR({participants:H,participantFilters:i,tournamentRecord:l});if(e){let Z=Ki(e)?e:void 0;for(let K of W)for(let Q of K.individualParticipantIds??[]){K.individualParticipants||(K.individualParticipants=[]);let J=j.get(Q),ne=Z?uw({template:Z,source:J}):J;K.individualParticipants.push(ne)}}let q=G?W.map(Z=>uw({source:Z,template:G})):W;return{participantMap:t.returnParticipantMap!==!1?P:void 0,mappedMatchUps:t.returnMatchUps!==!1?x:void 0,matchUps:t.returnMatchUps!==!1?O:void 0,missingParticipantIds:E.missingParticipantIds,participantIdsWithConflicts:R,eventsPublishStatuses:N,derivedEventInfo:A,derivedDrawInfo:_,participants:q,...le}}function xI({participantId:t,drawDefinition:e,entryStatus:i,entryStage:n}){if(!e)return{error:Ot};let r=e.entries?.find(a=>a.participantId===t&&(!i||i===a.entryStatus)&&(!n||n===a.entryStage));return t&&r}function oD(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,structureId:r,stage:a}=t;if(!i)return{error:Ot};let{entryProfile:s}=oR({drawDefinition:i}),o=a&&n&&s?.[a]?.stageSequence?.[n]?.qualifiersCount||a&&s?.[a]?.qualifiersCount||0,l={};if(!r)return{qualifiersCount:o,roundQualifiersCounts:l};let{structure:u}=li({drawDefinition:i,structureId:r}),c=i.links?.filter(h=>h?.target?.structureId===u?.structureId),d=0;if(c?.length)for(let h of c){let f=li({structureId:h.source.structureId,drawDefinition:i})?.structure;if(f?.stage===qt){let m=h.source.roundNumber,g=h.target.roundNumber,v=0;if(f.structureType===To){let y=f.structures?.length??0,b=h.source.finishingPositions?.length??0;v=y*b}else v=cn({matchUpFilters:{roundNumbers:[m]},structure:f,afterRecoveryTimes:!1,provisionalPositioning:e,inContext:!1}).matchUps?.length||0;l[g]||(l[g]=0),l[g]+=v,d+=v}}let p=Object.keys(l);if(p.length<=1){let h=p[0]||1;l[h]=Math.max(l[h]||0,o)}return d=Math.max(d,o),{qualifiersCount:d,roundQualifiersCounts:l}}function wk({stage:t,drawDefinition:e}){let{entryProfile:i}=oR({drawDefinition:e});return i?.[t]?.drawSize||0}function Txe(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r}=t,a=wk({stage:r,drawDefinition:i}),{qualifiersCount:s}=oD({provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r});return a&&a-s}function Vue({stage:t,drawDefinition:e}){return!!(t===Ga||lW({stage:t,drawDefinition:e})&&wk({stage:t,drawDefinition:e}))}function jue({entryStatus:t=sl,drawDefinition:e,stageSequence:i,stage:n}){if(t===Hc)return yke({stage:n,drawDefinition:e})?{positionsAvailable:1/0,...le}:{error:Kse};let r=Txe({drawDefinition:e,stageSequence:i,stage:n}),a=bke({drawDefinition:e,stage:n}),s=DG({entryStatus:$T,drawDefinition:e,stage:n}),o=DG({entryStatus:sl,drawDefinition:e,stage:n}),l=s+o,u=l>=r,c=r-l;return n!==Ga&&u?{error:gG}:t===$T?s<a?{...le}:{error:gG}:{positionsAvailable:c,...le}}function IW(t){let e=zt(t,[{[zs]:!0,[Rle]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:n=sl,entryStageSequence:r,entryStage:a=Nt,ignoreStageSpace:s,drawDefinition:o,entryPosition:l,participant:u,roundTarget:c,extensions:d,extension:p,drawType:h,event:f}=t,m="addDrawEntry";if(h!==Al&&!Vue({stage:a,drawDefinition:o}))return ce({result:{error:Sb},stack:m});let g=jue({stageSequence:r,stage:a,drawDefinition:o,entryStatus:n});if(!s&&!g.success&&(!h||h!==Al))return{error:g.error};if(p&&!$p({extension:p}))return ce({result:{error:Ee},info:"Invalid extension",context:{extension:p},stack:m});let v=t.participantId||u?.participantId;if(!v)return ce({result:{error:la},stack:m});let y=n===vm&&xI({participantId:v,drawDefinition:o,entryStatus:n}),b=a===Ga&&xI({participantId:v,drawDefinition:o,entryStage:a}),I=xI({participantId:v,drawDefinition:o}),S=n!==vm&&a!==Ga&&I;if(S)return i?(Ti({payload:{drawId:o.drawId,eventId:f?.eventId,error:XP,participantId:v},topic:H3}),{...le}):ce({result:{error:XP},context:{participantId:v},stack:m});if(y||b)return ce({context:{invalidEntry:S,invalidLuckyLoser:y,invalidVoluntaryConsolation:b},result:{error:GO},stack:m});let w=Vt({entryStageSequence:r,participantId:v,entryPosition:l,entryStatus:n,entryStage:a,extensions:d});return p&&un({element:w,extension:p}),c&&un({extension:{name:"roundEntry",value:c},element:w}),o.entries||(o.entries=[]),o.entries.push(w),Ln({drawDefinition:o}),{...le}}function Uxe(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:n=sl,autoEntryPositions:r=!0,ignoreStageSpace:a,participantIds:s,drawDefinition:o,stageSequence:l,stage:u=Nt,roundTarget:c,extension:d,event:p}=t,h=o.drawType===Al;if(!u)return{error:Ese};if(!o)return{error:Ot};if(!Array.isArray(s))return{error:Ul};if(!h&&!Vue({stage:u,drawDefinition:o}))return{error:Sb};if(d&&!$p({extension:d}))return ce({result:{error:Ee},info:"Invalid extension",context:{extension:d},stack:e});let f=jue({drawDefinition:o,stageSequence:l,entryStatus:n,stage:u});if(!a&&!f.success&&!h)return{error:f.error};let m=f.positionsAvailable??0;if(!a&&!h&&u!==Ga&&m<s.length)return{error:Hq};let g=[],v=o.drawId,y=p?.eventId,b=s.reduce((I,S)=>{let w=n===vm&&xI({participantId:S,drawDefinition:o,entryStatus:n}),T=u===Ga&&xI({entryStage:u,drawDefinition:o,participantId:S}),U=xI({participantId:S,drawDefinition:o});return n!==vm&&u!==Ga&&U&&(g.push(S),i&&Ti({payload:{error:XP,participantId:S,eventId:y,drawId:v},topic:H3})),w||T?I.concat(S):I},[]);return g.length&&!i?ce({context:{eventId:y,drawId:v,duplicateEntries:g},result:{error:XP},stack:e}):(s.filter(I=>I&&!b.includes(I)).forEach(I=>{let S={entryStageSequence:l,entryStage:u,participantId:I,entryStatus:n};d&&un({element:S,extension:d}),c&&un({extension:{name:ih,value:c},element:S}),o.entries||(o.entries=[]),o.entries.push(S)}),r&&(o.entries=xd({entries:o.entries})),Ln({drawDefinition:o}),b?.length||g?.length?{info:"some participantIds could not be added",participantIdsNotAdded:b,duplicateEntries:g,...le}:{...le})}function wW({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:n,participantIds:r,drawDefinition:a,entryStatus:s,roundTarget:o,entryStage:l,extension:u,drawId:c,event:d}){if(!r?.length)return{error:yv};if(!d)return{error:Wu};if(!c)return{error:Zd};let p=(d.entries||[]).map(Vi);if(r.filter(m=>!p.includes(m)).length)return{error:Use};if(a){let m=Uxe({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:n,participantIds:r,drawDefinition:a,entryStatus:s,roundTarget:o,extension:u});if(m.error)return m}let{flightProfile:h}=Cr({event:d}),f=h?.flights.find(m=>m.drawId===c);return f?.drawEntries&&(r.forEach(m=>{let g=s===vm&&iV({participantId:m,entryStatus:s,flight:f}),v=l===Ga&&iV({participantId:m,entryStage:l,flight:f});!(s!==vm&&l!==Ga&&iV({flight:f,participantId:m}))&&!g&&!v&&f.drawEntries.push({participantId:m,entryStatus:s,entryStage:l})}),e&&(f.drawEntries=xd({entries:f.drawEntries}))),{...le}}function iV({participantId:t,entryStatus:e,entryStage:i,flight:n}){let r=n.drawEntries?.find(a=>a.participantId===t&&(!e||e===a.entryStatus)&&(!i||i===a.entryStage));return t&&r}function TR({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:n,event:r}){let a="removeEventEntries";if(!r?.eventId)return{error:qn};if(!Array.isArray(e)||e.some(d=>!Xn(d)))return ce({result:{error:Bd},stack:a});let s=(r.drawDefinitions??[]).flatMap(d=>Ab({drawDefinition:d}).assignedParticipantIds??[]),o=(i?.length&&r.entries?.filter(d=>d.entryStatus&&i.includes(d.entryStatus))||[]).map(Vi).filter(d=>!s.includes(d)),l=(n&&r.entries?.filter(d=>d.entryStage&&d.entryStage===n)||[]).map(Vi).filter(d=>!s.includes(d));if(e.length?e=e.filter(d=>(!i?.length||o.includes(d))&&(!n||l.includes(d))):o.length&&l.length?e=Dr(o,l):o.length?e=o:l.length&&(e=l),e?.length&&s.some(d=>e.includes(d)))return ce({result:{error:WU},stack:a});if(!e?.length)return{...le,participantIdsRemoved:[]};let u=[];r.entries=(r.entries??[]).filter(d=>{let p=!e.includes(d?.participantId);return p||u.push(d.participantId),p}),t&&(r.entries=xd({entries:r.entries}));let{flightProfile:c}=Cr({event:r});return c?.flights?.forEach(d=>{d.drawEntries=(d.drawEntries||[]).filter(p=>!e.includes(p.participantId))}),r.drawDefinitions?.forEach(d=>{d.entries=(d.entries??[]).filter(p=>!e.includes(p.participantId))}),{...le,participantIdsRemoved:u}}var Gue={[Ha]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},lD=Gue;function Ep(t){let{suppressDuplicateEntries:e=!0,entryStatus:i=sl,autoEntryPositions:n=!0,enforceGender:r=!0,entryStageSequence:a,policyDefinitions:s,entryStage:o=Nt,tournamentRecord:l,ignoreStageSpace:u,drawDefinition:c,roundTarget:d,extensions:p,extension:h,drawId:f,event:m}=t,g="addEventEntries";if(!Array.isArray(t.participantIds))return ce({result:{error:Ul},stack:g});let v=wi(t.participantIds??[]);if(!m)return{error:qn};if(!v?.length)return ce({result:{error:yv},stack:g});if(!m?.eventId)return{error:Wu};let y=sn({tournamentRecord:l,event:m}).appliedPolicies??{},b=s?.[Ha]??y?.[Ha]??lD[Ha],I=(r??b?.participants?.enforceGender)!==!1,S=[],w=[];if(p&&(!Array.isArray(p)||!p.every(A=>$p({extension:A})))||h&&!$p({extension:h}))return ce({context:Vt({extension:h,extensions:p}),result:{error:Ee},info:"Invalid extension(s)",stack:g});let T=!!l,U=[],C,E=l?.participants?.filter(A=>{if(!v.includes(A.participantId))return!1;let _=_r(Rn)(m.eventType)&&A.participantType===ji&&!cy(i),x=m.eventType===Dn&&A.participantType===Ni;return _&&(!m.gender||!I||su(m.gender)||Mh(m.gender)||Ls(m.gender)===Ls(A.person?.sex))||x&&!cy(i)?!0:m.eventType===Dn&&A.participantType===ji&&cy(i)?m.gender&&I&&!(su(m.gender)||Mh(m.gender))&&Ls(m.gender)!==Ls(A.person?.sex)?(U.push({participantId:A.participantId,sex:A.person?.sex}),!1):!0:_&&m.gender&&I&&!(su(m.gender)||Mh(m.gender))&&Ls(m.gender)!==Ls(A.person?.sex)?(U.push({participantId:A.participantId,sex:A.person?.sex}),!1):m.eventType===wn&&(A.participantType===wn||cy(i)&&A.participantType===ji)}).map(A=>A.participantId)??[],P=v.filter(A=>!T||E.includes(A));m.entries||(m.entries=[]);let M=m.entries.map(A=>A.participantId||A.participant?.participantId);if(P.forEach(A=>{if(!M.includes(A)){let _=Vt({participantId:A,entryStatus:i,entryStage:o,extensions:p});h&&un({element:_,extension:h}),d&&un({extension:{name:ih,value:d},element:_}),a&&(_.entryStageSequence=a),S.push(_.participantId),m.entries?.push(_)}}),f&&!cy(o)){let A=wW({participantIds:P,suppressDuplicateEntries:e,autoEntryPositions:n,entryStageSequence:a,ignoreStageSpace:u,drawDefinition:c,entryStatus:i,roundTarget:d,entryStage:o,extension:h,drawId:f,event:m});A.error&&(C=A.error)}if(m.eventType&&[pm,Nl].includes(m.eventType)){let A=(m.entries||[]).map($=>$.participantId),_=(m.entries||[]).filter($=>cy($.entryStatus)).map($=>$.participantId),x=(l?.participants??[]).filter($=>A.includes($.participantId)&&$.participantType&&[Ni,wn].includes($.participantType)).map($=>$.individualParticipantIds).flat(1/0),O=_.filter($=>x.includes($));O.length&&(w.push(...O),TR({participantIds:O,autoEntryPositions:!1,event:m}))}if(P.length!==v.length)return ce({context:{mismatchedGender:U,gender:m.gender},result:{error:Ul},stack:g});n&&(m.entries=xd({entries:m.entries||[]}));let R=S.length,N=w.length;return ce({result:{...le,addedEntriesCount:R,removedEntriesCount:N},stack:g,info:C})}var Hue="ADMINISTRATION",Dxe="CAPTAIN",Exe="COACH",bs="COMPETITOR",zue="MEDIA",que="MEDICAL",SW="OFFICIAL",Wue="OTHER",Yue="SECURITY",Pv={ADMINISTRATION:Hue,CAPTAIN:Dxe,COACH:Exe,COMPETITOR:bs,MEDIA:zue,MEDICAL:que,OFFICIAL:SW,OTHER:Wue,SECURITY:Yue};function TW({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:n,suppressErrors:r}){let a="removeIndividualParticipantIds";if(!n)return ce({result:{error:ot},stack:a});if(!i||!e)return ce({result:{error:Zt},stack:a});let s=(n.participants??[]).find(c=>c.participantId===i);if(!s)return ce({result:{error:Nr},stack:a});if(![wn,Iu].includes(s.participantType))return ce({result:{participantType:s.participantType,error:Vd},stack:a});let o=Kue({individualParticipantIds:e,groupingParticipant:s,tournamentRecord:n,suppressErrors:r}),{removed:l,error:u}=o;if(u)return ce({result:o,stack:a});if(t)for(let c of n.events??[]){let d=(c.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l?.filter(h=>!d.includes(h));Ep({participantIds:p,entryStatus:rc,tournamentRecord:n,event:c})}}return l&&Ti({topic:Us,payload:{tournamentId:n.tournamentId,participants:[s]}}),{...le,...o}}function Kue({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:n,mappedMatchUps:r,participants:a}){let s=[];if(!e)return{removed:s};let o=[],l=[];a||({participants:a,mappedMatchUps:r}=dr({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let u=a?.find(({participantId:p})=>p===e.participantId)?.events?.map(({eventId:p})=>p),c=(e.individualParticipantIds??[]).filter(p=>{let h=t?.includes(p),f=h&&a?.find(g=>g.participantId===p)?.matchUps.filter(({eventId:g})=>u.includes(g)).map(({matchUpId:g})=>r?.[g]).filter(({winningSide:g,score:v})=>g||ca({score:v})),m=h&&!f?.length;if(h&&!m&&l.push(p),m){s.push(p);for(let g of i.events??[])for(let v of g.drawDefinitions??[]){let{extension:y}=_i({element:v,name:fm}),b=y?.value[e.participantId];y&&b&&(y.value[e.participantId]=b.filter(S=>S.participantId!==p),un({element:v,extension:y}),nR({drawDefinition:v}));let I=uo({drawDefinition:v,inContext:!1}).matchUps??[];for(let S of I){let w=S.sides??[];for(let T of w){let U=T.lineUp??[];U.find(C=>C.participantId===p)&&(T.lineUp=U.filter(C=>C.participantId!==p),Zi({tournamentId:i?.tournamentId,drawDefinition:v,matchUp:S}))}}}}else o.push(p);return!m});e.individualParticipantIds=c;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:o,removed:s};return l.length&&!n&&{...d,cannotRemove:l,error:VO}||d}function kL({participantRole:t=bs,individualParticipantIds:e=[],groupingTypes:i=[_o,Iu],tournamentRecord:n}){if(!n)return{error:ot};let r=n.participants??[],{participants:a,mappedMatchUps:s}=dr({withMatchUps:!0,tournamentRecord:n,withEvents:!0}),o=0;return r.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:u}=Kue({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:n,mappedMatchUps:s,participants:a});u&&o++}),o?le:{error:Hse}}function h0(t){let e=zt(t,[{[ha]:!0},{participantIds:!0,[Go]:xs,[Gc]:yv}]);if(e.error)return e;let{addIndividualParticipantsToEvents:i,tournamentRecord:n,participantIds:r}=t,a=n.participants?.length||0;if(!a)return{...le};let s=(n.events||[])?.filter(({eventType:f})=>f===na).map(f=>f?.drawDefinitions?.map(({drawId:m})=>m)).flat(1/0),o=dr({participantFilters:{participantIds:r},tournamentRecord:n,withDraws:!0}).participants??[],l=f=>{let m=(Za({matchUpFilters:{drawIds:f,matchUpTypes:[Dn]},tournamentRecord:n}).matchUps??[]).flatMap(({sides:g})=>g?.map(({participantId:v})=>v||[])).filter(Boolean);return Dr(m,r)},u=s?.length?l(s):[],c=o.filter(f=>f.draws?.filter(m=>(!s?.length||!s?.includes(m.drawId))&&m.positionAssignments).length);if(u?.length||c.length)return{error:WU};let d={},p={};for(let f of n.events||[]){let m=TR({participantIds:r,event:f});if(m.error)return m;d[f.eventId]=m.participantIdsRemoved}n.participants=(n.participants??[]).filter(f=>{let m=r.includes(f.participantId)||f.participantType===Ni&&f.individualParticipantIds?.some(g=>r.includes(g));if(!m&&f.participantType===na&&f.individualParticipantIds?.some(g=>r.includes(g))&&(f.individualParticipantIds=f.individualParticipantIds.filter(g=>!r.includes(g))),m&&i&&f.participantType&&[Ni,wn].includes(f.participantType))for(let g of f.individualParticipantIds||[])r.includes(g)||(p[f.participantId]||(p[f.participantId]=[]),p[f.participantId].push(g));return!m});let h=a-n.participants.length;if(kL({individualParticipantIds:r,tournamentRecord:n}),i)for(let f of n.events||[]){let m=d[f.eventId].map(g=>p[g]||[]).flat();Ep({participantIds:m,entryStatus:rc,tournamentRecord:n,event:f})}return h&&Ti({payload:{participantIds:r,tournamentId:n.tournamentId},topic:z3}),h?{...le,participantsRemovedCount:h}:{error:VO}}function Zue({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:n,event:r,stage:a}){let s=r.entries??[];if(n){let{flightProfile:l}=Cr({event:r}),u=l?.flights?.find(c=>c.drawId===n);u?s=u.drawEntries:e.entries&&(s=e?.entries)}let o=s.filter(l=>(!i?.length||!l.entryStatus||i.includes(l.entryStatus))&&(!a||!l.entryStage||l.entryStage===a)&&(!t||l.entryStatus&&fd.includes(l.entryStatus)));return{entries:s,stageEntries:o}}function Xue({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,stage:a,event:s}){let o="destroyGroupEntry";if(!e)return{error:ot};if(!n)return ce({result:{error:la},stack:o});if(!s)return{error:qn};if(!s.eventType||![pm,Nl].includes(s.eventType))return ce({result:{error:Hh},stack:o});let l=e.participants??[],u=l.find(v=>v.participantId===n);if(!u)return ce({result:{error:Nr},stack:o});if(!u.participantType||![Ni,_o].includes(u.participantType)||u.participantType===_o&&s.eventType!==Nl||u.participantType===Ni&&s.eventType!==pm)return{error:Vd};let c=(s.entries??[]).find(v=>v.participantId===n);if(!c)return{error:Yse};let{stageEntries:d}=Zue({selected:!1,drawDefinition:i,drawId:r,event:s,stage:a}),p=d.map(Vi),h=l.filter(({participantId:v})=>p.includes(v)).map(({individualParticipantIds:v})=>v).flat().filter(Boolean),f=u.individualParticipantIds?.filter(v=>Up(v,h).length===1),m=TR({participantIds:[n],event:s});if(m.error||f?.length&&(m=Ep({participantIds:f,entryStatus:rc,entryStage:c.entryStage,tournamentRecord:e,drawDefinition:i,drawId:r,event:s}),m.error))return m;let g;return t&&h0({participantIds:[n],tournamentRecord:e}).success&&(g=!0),{...le,participantRemoved:g}}function UW({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a}){return Xue({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a})}function Jue(t){if(!t.tournamentRecord)return{error:ot};let{participantIds:e,...i}=t,n=0,r=[];for(let a of e){let s=Xue({participantId:a,...i});s.success&&(n+=1),s.error&&r.push(s.error)}return n?{destroyedCount:n,...le}:{error:r}}function yC(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:n,destroyPair:r,entryStatus:a,matchUpsMap:s,drawId:o}=t,l="removeDrawPositionAssignment",u=IR(t);if(u.error)return ce({result:u,stack:l});let{participantId:c}=u,{drawPosition:d,event:p,structureId:h}=t,f=sn({tournamentRecord:e,drawDefinition:n,event:p}).appliedPolicies??{};if([Hc,Jh].includes(a)&&c){let{tournamentRecord:g}=t,{participant:v}=Uv({tournamentRecord:g,participantId:c}),{participantType:y,individualParticipantIds:b}=v??{};if(r&&y===Ni){let I=UW({tournamentRecord:g,drawDefinition:n,participantId:c,event:p});if(I.error)return ce({result:I,stack:l});b&&Ik({participantIds:b,tournamentRecord:g,drawDefinition:n,entryStatus:a,drawId:o,event:p})}else Ik({participantIds:[c],tournamentRecord:g,drawDefinition:n,entryStatus:a,drawId:o,event:p})}if(i){let g=Su({tournamentRecord:e,drawDefinition:n,drawPosition:d,structureId:h,matchUpsMap:s,event:p});if(g.error)return ce({result:g,stack:l})}let{structure:m}=li({drawDefinition:n,structureId:h});return iW({structure:m,drawPositions:[d]}),IL({appliedPolicies:f,drawDefinition:n,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:h}}),u}function Que(t){return Object.assign(t,{entryStatus:Jh}),yC(t)}var Bg=({finishingPosition:t=t0,hasExistingDrawDefinition:e,qualifyingRoundNumber:i,structureAbbreviation:n,seedAssignments:r=[],stageSequence:a=1,qualifyingOnly:s,structureOrder:o,seedingProfile:l,matchUpFormat:u,structureType:c,structureName:d,matchUps:p=[],matchUpType:h,structureId:f,roundOffset:m,roundLimit:g,stageOrder:v,structures:y,tieFormat:b,stage:I})=>{let S={structureId:f??mn(),structureAbbreviation:n,finishingPosition:t,seedAssignments:r,matchUpFormat:u,stageSequence:a,structureName:d};(s||e&&b)&&(S.tieFormat=b),o&&(S.structureOrder=o),c&&(S.structureType=c),l&&(typeof l=="string"?S.seedingProfile=l:typeof l=="object"&&typeof l.positioning=="string"&&(S.seedingProfile=l.positioning)),h&&(S.matchUpType=h),m&&(S.roundOffset=m),v&&(S.stageOrder=v),g&&(S.roundLimit=g),I&&(S.stage=I),i&&(S.qualifyingRoundNumber=i);let w=p.flatMap(({drawPositions:T})=>T).filter(Boolean);return y?S.structures=y:(S.matchUps=p,S.positionAssignments=wi(w).sort((T,U)=>T-U).map(T=>({drawPosition:T}))),S},Vu=Bg;function AG(t){return Xn(t)?t.split(" ").map(e=>e.split("").map((i,n)=>n?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function Is(t){return Xn(t)?AG(t.replace(/_/g," ")):""}function DW({structureName:t=Is(Ga),structureAbbreviation:e,drawDefinition:i,matchUpType:n,structureId:r}){if(!i)return{error:Ot};let a=Vu({stage:Ga,structureAbbreviation:e,structureName:t,matchUps:[],structureId:r,matchUpType:n});return i.structures||(i.structures=[]),i.structures.push(a),Ln({drawDefinition:i,structureIds:[a.structureId]}),{...le}}function EW({drawPositions:t}){if(!t?.length)return{error:$1};let e=r=>t.filter(a=>a!==r).map(a=>[r,a]),i=[].concat(...(t??[]).map(e)),n=wi(i.map(xL)).map(r=>r.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:n}}function xL(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(ia).join("|")}function ece({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,h)=>h),n=i(2*Math.round(t/2)+1).slice(1),r=i(n.length-1).map(()=>[]),a=n.slice(0,n.length/2),s=n.slice(n.length/2);n.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{r[p].push([a[v],s[v]])});let h=a.shift(),f=a.pop(),m=s.shift();a=[h,m,...a].filter(Boolean),s=[...s,f].filter(Boolean)});let o=a.shift(),l=a.pop(),u=s.shift();a=[o,u,...a].filter(Boolean),s=[...s,l].filter(Boolean);let c=d=>d[0].reduce((p,h)=>p+h);return[...r].reverse().sort((d,p)=>c(d)-c(p)).map(d=>d.filter(p=>p.every(h=>h<=t)).map(p=>{let h=p.map(f=>f+e);return xL(h)}))}function Pxe({rounds:t,hash:e}){return t?.length?t?.reduce((i,n,r)=>n.includes(e)?r+1:i,void 0):{error:Zt}}var Cxe={getRoundRobinGroupMatchUps:EW,determineRoundNumber:Pxe,drawPositionsHash:xL,groupRounds:ece};function UR(t){let{hasExistingDrawDefinition:e,groupNameBase:i="Group",playoffAttributes:n,stageSequence:r=1,structureOptions:a,appliedPolicies:s,qualifyingOnly:o,seedingProfile:l,stage:u=Nt,matchUpType:c,roundTarget:d,structureId:p,groupNames:h,tieFormat:f,drawSize:m,idPrefix:g,isMock:v,uuids:y}=t,b=t.structureName??n?.["0"]?.name??Is(Nt),{groupCount:I,groupSize:S}=Rxe({structureOptions:a,appliedPolicies:s,drawSize:m}),w=qy,T,U=Dt(1,I+1).map(E=>{let P=Mxe({groupSize:S,structureOrder:E,matchUpType:c,drawSize:m,idPrefix:g,isMock:v});T=Array.isArray(P)?Math.max(...P.map(({roundNumber:R})=>R??0)):0;let M=h?.[E-1]??`${i} ${E}`;return Bg({structureId:y?.pop(),hasExistingDrawDefinition:e,structureType:iL,finishingPosition:w,qualifyingOnly:o,structureOrder:E,structureName:M,tieFormat:f,matchUps:P})}),C=Bg({structureId:p??y?.pop(),hasExistingDrawDefinition:e,structureType:To,finishingPosition:w,seedingProfile:l,structureName:b,stageSequence:r,structures:U,tieFormat:f,stage:u});return d&&un({extension:{name:ih,value:d},element:C}),{structures:[C],maxRoundNumber:T,groupCount:I,links:[],groupSize:S,...le}}function Rxe({appliedPolicies:t,structureOptions:e,drawSize:i}){let n=e?.groupSize,r=e?.groupSizeLimit||8,{validGroupSizes:a}=DR({groupSizeLimit:r,drawSize:i}),s=a&&Math.max(...a);n&&a?.includes(n)||(n&&n>4||!a?.includes(4)?n=s:n=4);let o=Math.ceil(i/n);return{groupSize:n,groupCount:o}}function DR(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},n=Dt(3,e+1).filter(r=>{let a=Math.ceil(i/r),s=a*r-i,o=Math.ceil(i/a),l=Math.ceil(s/a);return(!s||s<r)&&o===r&&o>=3&&l<2});return{...le,validGroupSizes:n}}function Mxe({structureOrder:t,matchUpType:e,groupSize:i,drawSize:n,idPrefix:r,isMock:a,uuids:s}){let o=(t-1)*i,l=Dt(1+o,i+1+o),u=EW({drawPositions:l}).uniqueMatchUpGroupings??[],c=ece({groupSize:i,drawPositionOffset:o});return u.map(p).sort((h,f)=>(h.roundNumber??1/0)-(f.roundNumber??1/0));function d(h){return c.reduce((f,m,g)=>m.includes(h)?g+1:f,void 0)}function p(h){let f=xL(h),m=d(f),g=[1,n],v=Nxe({structureOrder:t,drawPositions:h,roundNumber:m,idPrefix:r,uuids:s}),y={matchUpStatus:m?Er:"BYE",matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:h,roundNumber:m,matchUpId:v};return a&&(y.isMock=!0),y}}function Nxe({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:n,uuids:r}){return n?`${n}-${t}-${i}-DP-${e.join("-")}`:r?.pop()||mn()}function PW(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:n}=t;if(!yi(i))return{seedBlocks:void 0,...ce({result:{error:Ee},context:{participantsCount:i},stack:"getSeedBlocks"})};let r=jU(i);if(e){let h=Math.min(e,r),f=[],m=1;for(Dt(0,h).forEach(()=>{f.push([m]),m++});m<r;){let g=Dt(m,m+h);m+=h,f.push(g)}return{...le,seedBlocks:f}}let a=Dt(1,r+1),s=[],o=r/2;for(;o>1;){let h=Aa(a,o),f=h.length;h.forEach((m,g)=>{let v,y=g<f/2,b=g%2===0,I=m[0],S=m[m.length-1];n&&f>4?f===8?v=y?S:I:v=b?I:S:v=y?I:S,mo(m,s)||s.push(v)}),o=o/2}let l=a.filter(h=>!s.includes(h));for(;l.length;)l.length%2===0?s.push(l.pop()):s.push(l.shift());let u=Dt(0,20).map(h=>Math.pow(2,h));u.unshift(1);let c=u.indexOf(r),d=0,p=[];return Dt(0,c).forEach(h=>{p.push(s.slice(d,d+u[h])),d+=u[h]}),{...le,seedBlocks:p}}function CW({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!yi(e))return{seedGroups:void 0,...ce({result:{error:Ee},context:{drawSize:e},stack:i})};if(t){if(!yi(t))return{seedGroups:void 0,...ce({context:{roundRobinGroupsCount:t},result:{error:Ee},stack:i})};let n=1,r=Math.floor(e/t);return{seedGroups:Dt(0,r).map(()=>{let a=Dt(n,n+t);return n+=t,a})}}else{let{seedBlocks:n}=PW({participantsCount:e,roundRobinGroupsCount:t}),r=0;return{seedGroups:(n||[]).map(a=>(a||[]).map(()=>(r+=1,r)))}}}function RW({roundRobinGroupsCount:t,participantsCount:e}){if(t){let{validGroupSizes:r}=DR({drawSize:e});if(!r?.map(a=>Math.ceil(e/a))?.includes(t))return ce({context:{roundRobinGroupsCount:t},result:{error:Ee}})}let{seedGroups:i}=CW({drawSize:e,roundRobinGroupsCount:t}),n=i?.map(r=>Math.min(...r))||[];return{...le,seedingThresholds:n}}function VT(t){if(!t)return 1/0;if(yi(t))return ri(t);let e=t.split("-")[0];return yi(e)?ri(e):1/0}function Axe({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(ia),e.reverse(),e}function _xe({blockPattern:t,index:e}){let i=0;for(let n of t){if(i===e)return n;let r=0;for(;r<n.length;){if(i===e)return n;i+=1,r++}}}function kxe({positioning:t,size:e}){let i=Axe({size:e}),n=[],r=[],a=p=>p[0],s=p=>p[p.length-1],o=(p,h)=>(t&&[tL,Hy].includes(t)&&h%2?s(p):a(p))||a(p),l=(p,h)=>{if(p.every(f=>!r.includes(f))){let f=o(p,h);return r.push(f),f}},u=p=>{let h=p.filter(f=>!r.includes(f));if(h.length)return r.push(...h),h},c=(p,h)=>{let f=o(p,h);if(!r.includes(f))return r.push(f),f},d=Dt(1,e+1);for(let p of i)if(p===1){let h=Aa(d,2),f=h.map(l).filter(Boolean);f.length&&n.push(f);let m=h.flatMap(u).filter(Boolean);m.length&&n.push(m)}else{let h=Aa(d,p).map(c).filter(Boolean);h.length&&n.push(h)}return{divisions:i,divisionGroupings:n}}function f0({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:n,drawDefinition:r,allPositions:a,structure:s}){let o=[];if(!s)return{error:wb};let{matchUps:l,roundMatchUps:u}=cn({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:s}),{seedAssignments:c}=Zu({provisionalPositioning:t,returnAllProxies:e,drawDefinition:r,structure:s}),{positionAssignments:d}=ua({structure:s}),p=d?.length,h=c?.length??0,f=[],m=Object.keys(u).map(_=>parseInt(_)).sort((_,x)=>_-x).map(_=>{let x=u[_].map($=>$.drawPositions).flat(1/0).filter(Boolean),O=x.filter($=>!f.includes($));return f=f.concat(...x),O}).filter(_=>_.length).reverse(),g=m.pop()??[],v=g&&Math.min(...g)-1||0;n=n??i?.seeding?.seedingProfile;let y=g?.length||0,b=m.filter(_=>_.filter(x=>x<=h).length),{stage:I,structureType:S,roundLimit:w}=s,T=S===To,U=!T&&m?.length,C=!T&&I===qt&&w,E=b.flat(1/0),P=U?E?.length:0,M=a?p:h,R=uW({drawDefinition:r,structure:s,matchUps:l}),N=R?0:!U&&M||M&&E.length<M&&M-E.length||0;if(C){let _=s?.matchUps?s.matchUps.filter(({roundNumber:O})=>O===s.roundLimit).length:0,x=g.length/_;if(!U){let O=ER(n),$=Aa(g,x),F=1,j=Dt(0,$[0].length).map(()=>{let H=Dt(F,F+$.length);return F+=$.length,H});({validSeedBlocks:o}=tce({drawPositionBlocks:$,nonRandom:n?.nonRandom,positioning:O,seedGroups:j}))}}else T?{validSeedBlocks:o}=xxe({nonRandom:n?.nonRandom,seedingProfile:n,structure:s}):U?o=b.map(_=>({seedNumbers:_,drawPositions:_})):R&&Aa(g,2).map((_,x)=>({drawPositions:[_[0]],seedNumbers:[x+1]})).forEach(_=>o.push(_));if(!T&&!R&&!C){let{blocks:_}=Oxe({drawPositionOffset:v,seedNumberOffset:P,seedCountGoal:N,seedingProfile:n,baseDrawSize:y});_.forEach(x=>o.push(x))}let A=o.flatMap(_=>_.drawPositions).reduce((_,x)=>g?.includes(x)&&_,!0);return!R&&!U&&!T&&!A?{error:Ise,validSeedBlocks:[],isContainer:T,isFeedIn:U}:{isLuckyStructure:R,validSeedBlocks:o,isContainer:T,isFeedIn:U}}function xxe({seedingProfile:t,structure:e,nonRandom:i}){let n=e.structures||[],r=n.length,a=Nn({structure:e})?.positionAssignments,s=ER(t),o=a?.length??0,{seedGroups:l}=CW({roundRobinGroupsCount:r,drawSize:o}),u=n.map(c=>Nn({structure:c}).positionAssignments?.map(d=>d.drawPosition));return tce({drawPositionBlocks:u,positioning:s,seedGroups:l,nonRandom:i})}function tce({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:n}){let r=[],{divisionGroupings:a}=kxe({size:i.length,positioning:e}),s=[];return i.forEach((o,l)=>{let u=_xe({blockPattern:a,index:l});o.forEach((c,d)=>{let p=l%2?t.length-d-1:d,h=t[p].slice().filter((m,g)=>u.includes(g+1)&&m);e!==Hy?h=n?h:oo(h):l%2&&h.reverse();let f=h.find(m=>!s.includes(m));f&&(s.push(f),r.push({drawPositions:[f],seedNumbers:[c]}))})}),{validSeedBlocks:r}}function Oxe(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:n=0,seedingProfile:r,seedCountGoal:a,baseDrawSize:s}=t,o=1,l=[],{seedBlocks:u}=PW({cluster:ER(r)===tL,participantsCount:s,roundRobinGroupsCount:i});o=0;for(let d of u){if(o+1>a)break;let p=d.map(f=>f+e),h=c(o+1,d.length).map(f=>+f+n);o+=d.length,l.push({drawPositions:p,seedNumbers:h})}return{blocks:l};function c(d,p){return Array.from(new Array(p),(h,f)=>f+d)}}function Sk({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:n,structureId:r,seedNumber:a}){let{structure:s}=li({drawDefinition:e,structureId:r});t||(t=sn({drawDefinition:e}).appliedPolicies);let o=i?.validSeedBlocks;return!o&&s&&(o=f0({appliedPolicies:t,drawDefinition:e,structure:s})?.validSeedBlocks),t?.seeding?.validSeedPositions?.ignore?!0:t?.seeding?.validSeedPositions?.strict?(o.find(l=>l.seedNumbers.includes(a))?.drawPositions||[]).includes(n):[].concat(...o.map(l=>l.drawPositions)).includes(n)}function ice(t){let{provisionalPositioning:e,drawDefinition:i,seedingProfile:n,seedBlockInfo:r,structureId:a,randomize:s}=t,{structure:o}=li({drawDefinition:i,structureId:a}),{seedAssignments:l}=Zu({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:o}),{positionAssignments:u}=ua({structure:o}),c=u?.filter(M=>M.participantId??M.bye??M.qualifier)?.map(M=>M.drawPosition).filter(Boolean),{appliedPolicies:d}=sn({drawDefinition:i}),p=(r?.validSeedBlocks||o&&f0({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:n,structure:o})?.validSeedBlocks||[]).filter(M=>M.drawPositions.filter(R=>!c?.includes(R)).length)[0],h=l?.map(M=>M.participantId).filter(Boolean),f=u?.map(M=>M.participantId).filter(Boolean),m=h?.filter(M=>f?.includes(M)),g=h?.filter(M=>!f?.includes(M)),v=l?.filter(M=>g?.includes(M.participantId)),y=l?.filter(M=>!M.participantId),b=(v?.length&&v.length>0?v.length:y?.length??0)&&p?.drawPositions.filter(M=>!c?.includes(M))||[],I=s?oo(b):b,S=[],w=I.map(()=>{let M=P(v,S)?.participantId;return M&&S.push(M),M}).filter(Boolean),T=l?.filter(M=>m?.includes(M.participantId)).map(M=>M.seedNumber),U=(p?.seedNumbers||[]).filter(M=>!T?.includes(M)),C=l?.filter(M=>U.includes(M.seedNumber)).map(M=>M.participantId),E=d?.seeding?.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:E===void 0||E?w:C,unplacedSeedNumbers:U,unfilledPositions:I,unplacedSeedAssignments:v};function P(M,R){let N=M.filter(x=>!R.includes(x.participantId)),A=Math.min(...N.map(x=>VT(x.seedValue))),_=N.filter(x=>VT(x.seedValue)===A);return oo(_).pop()}}function ER(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function uD({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:n,participantId:r,seedBlockInfo:a,structureId:s,seedNumber:o,seedValue:l,eventId:u,event:c}){let d="assignSeed",{structure:p}=li({drawDefinition:i,structureId:s}),{positionAssignments:h}=ua({structure:p}),f=Zu({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,m=f.map(S=>S.seedNumber),g=xI({drawDefinition:i,participantId:r});if(r&&!g)return ce({result:{error:Bd},context:{participantId:r},stack:d});let v=c?Cr({event:c}).flightProfile?.flights?.length:0,y=v&&v>1,b=h?.find(S=>S.participantId===r)?.drawPosition;if(b&&!Sk({drawPosition:b,drawDefinition:i,seedBlockInfo:a,structureId:s,seedNumber:o}))return ce({result:{error:Mq},context:{assignedDrawPosition:b},info:"invalid seed position",stack:d});m.includes(o)||f.push({seedNumber:o,seedValue:l});let I;return f.forEach(S=>{S.participantId===r&&S.seedNumber!==o&&(S.participantId=void 0),S.seedNumber===o&&(S.participantId=r,!n?.groupSeedingThreshold&&!y&&(S.seedValue=l??o),I=!0)}),I?(iue({tournamentId:e?.tournamentId,drawDefinition:i,structure:p,eventId:u}),{...le}):ce({result:{error:bse},stack:d})}function MW({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:n,drawDefinition:r,matchUp:a,event:s}){let o=t?.sides?.[e]?.sideNumber,l=o&&a.sides?.find(p=>p.sideNumber===o),{extension:u}=_i({element:r,name:fm}),c=u?.value||{},d=Ct(c[i],!1,!0);if(l)a?.sides?.forEach(p=>{p.sideNumber===o&&(p.lineUp=d)});else{a.sides=[1,2].map(h=>({...a.sides?.find(f=>f.sideNumber===h)??{},sideNumber:h}));let p=a.sides.find(h=>h.sideNumber===o);p&&(p.lineUp=d)}Zi({tournamentId:n?.tournamentId,context:"updateSidLineUp",eventId:s?.eventId,drawDefinition:r,matchUp:a})}function nce(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:n,matchUpsMap:r,drawPosition:a}=t,s=i.roundNumber>1&&i.roundNumber-1,o=Zg({structureId:n.structureId,matchUpsMap:r});!e&&a&&(e=o.find(({drawPositions:f,roundNumber:m})=>m===s&&f?.includes(a)));let l=e?.roundPosition,u=l%2?1:-1,c=l+u,d=s&&o.find(({roundNumber:f,roundPosition:m})=>f===s&&m===c),p=d?.matchUpStatus,h=[cr,sa].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:h}}function Lxe({drawPosition:t,drawPositions:e}){let i=!1,n=!!e?.includes(t);return{updatedDrawPositions:n?e||[]:[...e,void 0,void 0].slice(0,2).map(r=>!r&&!n?(n=!0,i=!0,t):r).sort(ia).filter(Boolean),positionAdded:i,positionAssigned:n}}function rce({structureId:t,matchUpsMap:e,matchUp:i}){let n=i?.roundPosition,r=n%2?1:-1,a=n+r;return{pairedPreviousMatchUp:Zg({matchUpsMap:e,structureId:t}).find(({roundNumber:s,roundPosition:o})=>s===i?.roundNumber&&o===a)}}function ace({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:n,matchUp:r}){let a=t.find(o=>o.matchUpId===i),{pairedPreviousMatchUp:s}=rce({structureId:a?.structureId,matchUp:a,matchUpsMap:n});if(a&&s){let o=s?.matchUpId,l=t.find(c=>c.matchUpId===o),u=a?.structureId===l?.structureId?a?.roundPosition<l?.roundPosition&&1||2:a.structureId===l?.structureId&&2||1;r.matchUpStatusCodes=(r.matchUpStatusCodes??[]).map(c=>{let d=Xn(c)||!isNaN(c)?{code:c}:c;return d.sideNumber===u?{...d,previousMatchUpStatus:e}:d})}}function c_({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let n=t.filter(({winnerMatchUpId:r,loserMatchUpId:a})=>a===i||r===i).sort((r,a)=>r.roundPosition-a.roundPosition);return t.find(r=>r.matchUpId===i).feedRound?1:n.reduce((r,a,s)=>a.drawPositions?.includes(e)?s+1:r,void 0)}function OI({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:r,matchUpStatus:a,drawPosition:s,matchUpsMap:o,matchUpId:l,event:u}){let c="assignMatchUpDrawPosition";o||(o=us({drawDefinition:r})),t||(t=Kr({inContext:!0,drawDefinition:r,matchUpsMap:o}).matchUps??[]);let d=t.find(R=>R.matchUpId===l),p=d?.structureId,h=r?.structures?.find(R=>R.structureId===p);if(!h)return{error:or};let f=o?.drawMatchUps?.find(R=>R.matchUpId===l),m=f?.drawPositions??[],{positionAdded:g,positionAssigned:v,updatedDrawPositions:y}=Lxe({drawPositions:m,drawPosition:s}),{positionAssignments:b}=Nn({drawDefinition:r,structure:h}),I=b?.filter(R=>y.includes(R.drawPosition))?.find(({bye:R})=>R),S=f?.matchUpStatus&&$s(f.matchUpStatus)&&y.filter(Boolean).length<2;a=I&&"BYE"||a||S&&f.matchUpStatus||f?.matchUpStatus&&[cr,sa].includes(f.matchUpStatus)&&f.matchUpStatus||Er;let w=!!($s(f?.matchUpStatus)&&f?.winningSide);if(f&&g){t=Kr({inContext:!0,drawDefinition:r,matchUpsMap:o}).matchUps??[];let R=S&&c_({inContextDrawMatchUps:t,drawPosition:s,matchUpId:l})||w&&f.winningSide||void 0;f?.matchUpStatusCodes&&ace({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:n,matchUpsMap:o,matchUp:f}),Object.assign(f,{drawPositions:y,winningSide:R,matchUpStatus:w?f?.matchUpStatus:a}),Zi({tournamentId:i?.tournamentId,eventId:d?.eventId,context:c,drawDefinition:r,matchUp:f})}let T=vo({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:r,matchUpId:l}),{targetMatchUps:{winnerMatchUp:U,loserMatchUp:C,loserTargetDrawPosition:E},targetLinks:{loserTargetLink:P}}=T,M=Zg({structureId:h.structureId,matchUpsMap:o});if(v&&I){if(U)if(["BYE",cr,sa].includes(a)){let R=OI({matchUpId:U.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:s,matchUpsMap:o});if(R.error)return R}else{let{structureId:R}=U;R!==h.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(v&&w){if(U){let R=OI({matchUpId:U.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:s,matchUpsMap:o});if(R.error)return R}}else if(U&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:R}=nce({targetMatchUp:f,drawPosition:s,matchUpsMap:o,structure:h});if(R){let N=OI({matchUpId:U.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:s,matchUpsMap:o});if(N.error)return N}}if(f?.matchUpType===Hn){let R=t?.find(({matchUpId:_})=>_===f.matchUpId),N=(R?.sides??[]).reduce((_,x,O)=>x.drawPosition===s?O:_,void 0),A=b?.find(_=>_.drawPosition===s)?.participantId;A&&N!==void 0&&MW({inContextTargetMatchUp:R,drawPositionSideIndex:N,teamParticipantId:A,tournamentRecord:i,drawDefinition:r,matchUp:f})}if(P?.linkCondition===Fp&&y.filter(Boolean).length===2&&!I&&M.filter(({drawPositions:R,roundNumber:N})=>N===1&&mo(R,y)).every(({matchUpStatus:R})=>[Ur,_a].includes(R))&&C){let{structureId:R}=C,N=Su({drawPosition:E,tournamentRecord:i,drawDefinition:r,structureId:R,matchUpsMap:o,event:u});if(N.error)return N}return v?{...le}:ce({result:{error:PT},context:{drawPosition:s},stack:c})}function sce({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:n,structure:r}){let a=rD({drawDefinition:e})?.containedStructures?.[r.structureId]?.map(({structureId:c})=>c)||[];a.push(r?.structureId);let s=i?.map(({drawPosition:c})=>c)||[],o=t?.filter(c=>a.includes(c.structureId)&&Dr(c.drawPositions??[],s).length)??[],l=o.map(({matchUpId:c})=>c),u=n?.drawMatchUps?.filter(c=>l.includes(c.matchUpId))??[];return{drawPositions:s,matchUps:u,targetMatchUps:o}}function NW({lineUp:t}){if(!Array.isArray(t))return;let e={};return wi(t.flatMap(({collectionAssignments:i})=>i?.map(({collectionId:n,collectionPosition:r})=>[n,r].join("|"))).filter(Boolean)).forEach(i=>{let[n,r]=i.split("|"),a=parseInt(r),{assignedParticipantIds:s}=bk({collectionPosition:a,collectionId:n,lineUp:t});s.forEach(o=>{e[o]||(e[o]=[]),e[o].push({collectionId:n,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function Xy(t){return`${t} must be an array`}function OL({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(Xy("lineUp")),{valid:!1,errors:i,error:Ee};let n=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:s,collectionAssignments:o}=a;return s?typeof s!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(o)?o.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:u}=l;return typeof u!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(Xy("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),r=wi(t.map(Vi)).length===t.length;return r||i.push("Duplicated participantId(s)"),{valid:n&&r,errors:i,error:i.length?Ee:void 0}}function m0({drawDefinition:t,participantId:e,tieFormat:i,lineUp:n}){if(typeof t!="object")return{error:Ot};if(typeof e!="string")return{error:la};let r=OL({lineUp:n,tieFormat:i});if(!r.valid)return r;let{extension:a}=_i({element:t,name:fm}),s=a?.value||{};return s[e]=NW({lineUp:n}),un({element:t,extension:{name:fm,value:s}}),nR({drawDefinition:t}),{...le}}function AW({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,assignments:a,structure:s,event:o}){if(!n)return{error:Ot};let{drawPositions:l,matchUps:u,targetMatchUps:c}=sce({inContextDrawMatchUps:t,matchUpsMap:r,assignments:a,structure:s});for(let d of c)d.matchUpType===uu&&(d.sides??[]).forEach((p,h)=>{if(p?.drawPosition&&l?.includes(p.drawPosition)){let f=u.find(({matchUpId:m})=>m===d.matchUpId);if(f?.sides?.[h]){if(delete f.sides[h].lineUp,e===!1){let m=d.tieFormat,g=p.participantId;m&&g&&m0({drawDefinition:n,participantId:g,lineUp:[],tieFormat:m})}Zi({tournamentId:i?.tournamentId,context:"resetLineUps",eventId:o?.eventId,drawDefinition:n,matchUp:f})}}});return{...le}}function Bp({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,seedingProfile:s,participantId:o,seedBlockInfo:l,drawPosition:u,matchUpsMap:c,structureId:d,event:p}){let h="assignDrawPosition";if(!o&&!i)return ce({result:{error:la},stack:h});c=c??us({drawDefinition:a}),e||({matchUps:e}=Kr({inContext:!0,drawDefinition:a,matchUpsMap:c}));let f=li({drawDefinition:a,structureId:d});if(f.error)return ce({result:f,stack:h});let{structure:m}=f;if(!m)return{error:or};if(Fo({structure:m}))return ce({result:{error:rl},stack:h});let{seedAssignments:g}=Zu({provisionalPositioning:t,drawDefinition:a,structure:m}),v=g?.find(E=>E.participantId===o)?.seedNumber,{appliedPolicies:y}=sn({tournamentRecord:r,drawDefinition:a,structure:m,event:p});if(v&&!Sk({seedNumber:v,appliedPolicies:y,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:d}))return ce({result:{error:Mq},context:{drawPosition:u},stack:h});let b=ua({structure:m}).positionAssignments||[],I=b?.find(E=>E.drawPosition===u);if(!I)return ce({result:{error:GU},context:{drawPosition:u},stack:h});if(b?.map(Vi).includes(o))return ce({result:{error:WU},context:{drawPosition:u},stack:h});let{containsParticipant:S,containsBye:w}=C(I);if(w){let E=IR({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:c,event:p});if(E.error)return ce({result:E,stack:h})}if(S&&I.participantId!==o){let{activeDrawPositions:E}=bR({drawDefinition:a,structureId:d});if(E.includes(u))return ce({result:{error:OO},stack:h});AW({assignments:[I],inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,matchUpsMap:c,structure:m})}if(I.participantId=o,i&&(I.qualifier=!0),m.stage===Nt&&(!m.stageSequence||m.stageSequence>1)||m.stage&&[Ts,Sr].includes(m.stage)){let E=m.stage===qt?qt:Nt,P=(a.structures?.find(M=>M?.stage===E&&M?.stageSequence===1)?.seedAssignments??[]).find(M=>M.participantId===o);if(P?.participantId){let{participantId:M,seedNumber:R,seedValue:N}=P;uD({eventId:p?.eventId,provisionalPositioning:t,tournamentRecord:r,drawDefinition:a,seedingProfile:s,participantId:M,seedNumber:R,seedValue:N,structureId:d,event:p})}}if(m.structureType!==To)Fxe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,drawPosition:u,matchUpsMap:c,structure:m,event:p});else{Fue({positionAssignments:b,tournamentRecord:r,drawDefinition:a,matchUpsMap:c,structure:m});let{drawPositions:E,matchUps:P,targetMatchUps:M}=sce({assignments:[I],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c,structure:m});if(E&&P?.length===1&&P[0].matchUpType===Hn){let R=(M?.[0].sides??[]).reduce((N,A,_)=>E?.includes(A.drawPosition)?_:N,void 0);MW({inContextTargetMatchUp:M[0],teamParticipantId:o,matchUp:P[0],drawPositionSideIndex:R,tournamentRecord:r,drawDefinition:a})}}let T=a.entries?.find(E=>E.participantId===o),U=p?.entries?.find(E=>E.participantId===o);return!T&&U&&IW({entryStatus:U.entryStatus,entryStage:m.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:o,event:p}),Kg({tournamentId:r?.tournamentId,drawDefinition:a,structure:m,event:p}),{positionAssignments:b,...le};function C(E){let P=E.bye,M=E.qualifier,R=E.participantId;return{containsBye:P,containsQualifier:M,containsParticipant:R,filled:P||M||R}}}function Fxe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let u={isCollectionMatchUp:!1},{matchUps:c}=cn({provisionalPositioning:t,matchUpFilters:u,drawDefinition:r,matchUpsMap:s,structure:o,event:l}),{roundMatchUps:d}=go({matchUps:c}),{initialRoundNumber:p}=pw({drawPosition:a,matchUps:c}),h=p&&d?.[p].find(f=>f.drawPositions?.includes(a));if(h){let f=OI({matchUpId:h.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:s});if(f.error)return ce({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:f})}return{...le}}function _W(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:n,tournamentRecord:r,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,event:u}=t,c="positionParticipantAction";if(!a)return{error:Ot};let d=sn({tournamentRecord:r,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:h}=t;h||(h=us({drawDefinition:a}),Object.assign(t,{matchUpsMap:h})),p||({matchUps:p}=Kr({inContext:!0,drawDefinition:a,matchUpsMap:h}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:f}=Nn({drawDefinition:a,structureId:l}),m=f?.find(I=>I.drawPosition===o);if(m?.participantId){let I=m.participantId,S=Bp({inContextDrawMatchUps:p,tournamentRecord:r,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:h,event:u});return S.success?b({appliedPolicies:d,removedParticipantId:I}):ce({result:S,stack:c})}let g=IR({inContextDrawMatchUps:p,tournamentRecord:r,drawDefinition:a,drawPosition:o,structureId:l,matchUpsMap:h,event:u});if(g.error)return ce({result:g,stack:c});let v=g.participantId,y=Bp({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:r,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:h,event:u});if(!y.success)return ce({result:y,stack:c});return b({appliedPolicies:d,removedParticipantId:v});function b({appliedPolicies:I,removedParticipantId:S}){let{structure:w}=li({drawDefinition:a,structureId:l});iW({drawPositions:[o],structure:w});let T={[e]:s,name:n,drawPosition:o,structureId:l};return IL({appliedPolicies:I,drawDefinition:a,positionAction:T}),ce({context:{removedParticipantId:S},result:{...le},stack:c})}}function $xe({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return _W({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function oce(t){return $xe(t)}function lce({params:t,modMap:e,structure:i}){let{tournamentRecord:n,drawDefinition:r,event:a}=t;for(let s of i.matchUps)e[s.matchUpId]&&(s.roundNumber=e[s.matchUpId],Zi({tournamentId:n?.tournamentId,eventId:a?.eventId,drawDefinition:r,matchUp:s}))}function uce(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let n=zt(t,i);if(n.error)return n;let r=li(t);if(r.error)return r;let a=r.structure;if(!Fo({structure:a}))return ce({result:{error:Ib,message:"structure must be adHoc"}});let{roundMatchUps:s=[],roundNumbers:o}=go({matchUps:a?.matchUps});return o?.length?{valid:!0,structure:a,roundMatchUps:s,roundNumbers:o}:{error:Vm}}function cce(t){let e=uce(t,[{targetRoundNumber:!0,roundNumber:!0,[Go]:F_e}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e,{targetRoundNumber:a,roundNumber:s}=t;if(!r?.includes(s)||!r?.includes(a))return ce({result:{error:Ee},info:"roundNumbers must be valid rounds"});let o=a>s,l=o?Dt(s+1,a+1):Dt(a,s),u={};return l.forEach(c=>(n?.[c]??[]).forEach(({matchUpId:d})=>{u[d]=c-(o?1:-1)})),n?.[s]?.forEach(({matchUpId:c})=>u[c]=a),lce({params:t,modMap:u,structure:i}),{...le}}function dce({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:n,event:r}){if(!n)return{error:Ot};if(!Array.isArray(t))return{error:Ee};let a="setPositionAssignments";for(let o of t){let{structureId:l,positionAssignments:u}=o;if(!u)continue;let c=li({drawDefinition:n,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:or};let p=Nn({structure:d}).positionAssignments?.map(({drawPosition:g})=>g),h=u?.map(({drawPosition:g})=>g);if(Dr(p,h).length!==p?.length)return ce({result:{error:Ee},info:"drawPositions do not match",stack:a});let f=us({drawDefinition:n}),{matchUps:m}=Kr({inContext:!0,drawDefinition:n,matchUpsMap:f});for(let g of u||[]){let{drawPosition:v,participantId:y,bye:b,qualifier:I}=g;if(b){let S=Su({tournamentRecord:i,drawDefinition:n,drawPosition:v,matchUpsMap:f,structureId:l,structure:d,event:r});if(S?.error)return S}else if(I)u.forEach(S=>{S.drawPosition===v&&(S.qualifier=!0,delete S.participantId,delete S.bye)});else if(y){let S=Bp({provisionalPositioning:e,inContextDrawMatchUps:m,tournamentRecord:i,drawDefinition:n,participantId:y,drawPosition:v,matchUpsMap:f,structureId:l,event:r});if(S?.error)return S}}Kg({tournamentId:i?.tournamentId,drawDefinition:n,structure:d,event:r})}let s=t.map(({structureId:o})=>o);return Ln({tournamentId:i?.tournamentId,eventId:r?.eventId,drawDefinition:n,structureIds:s}),{...le}}function pce(t){let e=uce(t,[{roundNumbers:!0,[Go]:xs,[gs]:s=>s.length===2&&s.every(br)}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e;if(!t.roundNumbers.every(s=>r?.includes(s)))return ce({result:{error:Ee,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((s,o)=>(n?.[s]??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-o]})),lce({params:t,modMap:a,structure:i}),{...le}}function hce({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r,event:a}){return _W({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r,event:a})}function fce({drawDefinition:t,structureId:e}){if(!t)return{error:Ot};let{structure:i}=li({drawDefinition:t,structureId:e}),n=(t?.links||[]).filter(r=>r.source?.structureId===e).map(r=>r.target?.structureId);return{playoffStructures:(t?.structures||[]).filter(r=>n.includes(r.structureId)),structure:i}}function LL({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:n,stages:r,event:a,stage:s}){if(!a)return{error:qn};let o={},l=[];for(let u of a.drawDefinitions||[]){let{structures:c,stageStructures:d}=rd({withStageGrouping:t,stageSequences:e,drawDefinition:u,stageSequence:i,roundTarget:n,stages:r,stage:s});if(l.push(...c),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function kW({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,stage:s}){if(!e)return{error:ot};let o={},l=[];for(let u of e.events||[]){let{structures:c,stageStructures:d}=LL({withStageGrouping:t,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,event:u,stage:s});if(c&&l.push(...c),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function ef(t){if(!t?.drawDefinition)return!1;let e=AL(t),i=e?.includesTeamMatchUps,{completedMatchUps:n,pendingMatchUps:r,upcomingMatchUps:a}=e||{};return i&&(n=n?.filter(({matchUpType:s})=>s===Hn),r=r?.filter(({matchUpType:s})=>s===Hn),a=a?.filter(({matchUpType:s})=>s===Hn)),!!(n?.length&&!r?.length&&!a?.length)}function xW(t){let{drawDefinition:e,structureId:i}=t;if(!e)return{error:Ot};let{playoffStructures:n}=fce({drawDefinition:e,structureId:i});if(!n?.length)return!1;let r=e?.entries?.filter(s=>s?.entryStatus&&fd.includes(s.entryStatus))?.length??0,a=0;return(n||[]).reduce((s,o)=>!!((Nn({structure:o}).positionAssignments??[])?.filter(l=>(l.participantId&&a++,l?.bye??l?.participantId)).length&&s),!!n.length)||a===r}function _G({significantCharacters:t,accessors:e=[],value:i}){let n=[],r=e[0];if(i?.[r]){let s=e.slice(1);if(Array.isArray(i[r]))i[r].forEach(o=>{let l=_G({accessors:s,significantCharacters:t,value:o});n.push(...l)});else if(i=i[r],s.length){let o=_G({accessors:s,significantCharacters:t,value:i});n.push(...o)}else a({value:i})}function a({value:s}){if(s&&["string","number"].includes(typeof s)){let o=t?s.slice(0,t):s;n.push(o)}}return n}function Bxe({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:n}){if(!Array.isArray(e))return{error:Bq};if(!Array.isArray(n))return{error:G1};let r={};return t.forEach(a=>{let s=n.find(l=>l.participantId===a),{values:o}=mce({policyAttributes:e,idCollections:i,participants:n,participant:s});o&&o.forEach(l=>{r[l]||(r[l]=[]),r[l].includes(a)||r[l].push(a)})}),r}function mce({policyAttributes:t,idCollections:e,participants:i,participant:n}){if(!Array.isArray(t))return{error:Bq};if(!n)return{error:Kw};let r=[];return t.forEach(a=>{let{directive:s,groupings:o,key:l,significantCharacters:u}=a||{};if(l){let c=l.split(".");r.push(..._G({significantCharacters:u,value:n,accessors:c}))}else if(s){let c=a?.includeIds,d=(e?.[s]||[]).filter(p=>!c||c.includes(p));d?.length&&i?.length&&d.forEach(p=>{let h=i.find(f=>f.participantId===p);if(h?.individualParticipantIds?.includes(n.participantId)){let f=h?.participantId;r.push(f)}})}else o&&Object.keys(o).forEach(c=>{o[c].includes(n.participantId)&&r.push(c)})}),{values:wi(r)}}function IX({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:n}){let r=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let s=r[a.participantId],{values:o}=mce({participants:e,policyAttributes:i,idCollections:n,participant:s});return{...a,values:o}})}function gce({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(n=>n?.participantId).map(n=>{let{drawPosition:r,participantId:a}=n,s=t?t[a]||[]:[],o=!!i.some(l=>s.includes(l));return{[r]:{participantGroups:s,includesGroupsToAvoid:o}}}))}function Vxe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=gce(t);return i.map(a=>{let s=e.filter(u=>a.includes(u)),o=r(s),l=s.filter(u=>!o.includes(u)).filter(u=>{let c=wX(u);return!n[c]?.includesGroupsToAvoid});return{unassigned:s,unpaired:o,pairedNoConflict:l}});function r(a){return a.filter(o=>!s(o));function s(o){let l=wX(o);return!a.includes(l)}}}function jxe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=gce(t);return i.map(r=>{let a=e.filter(l=>r.includes(l)),s=a.length===r.length?a:[],o=r.filter(l=>n[l]?.includesGroupsToAvoid).length;return{unassigned:a,unpaired:s,pairedNoConflict:o?[]:a,conflictsCount:o}})}function wX(t){return Number(t%2?t+1:t-1)}function Gxe({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function Hxe({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:n,unfilledPositions:r,isRoundRobin:a}){let s=n.map(o=>a?jxe({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}):Vxe({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}));if(a){let o=s.map(c=>c.map(d=>d.unassigned).filter(d=>d?.length)).filter(c=>c?.length).sort((c,d)=>(d.length||0)-(c.length||0)),l=s.map(c=>c.map(d=>d.unpaired).filter(d=>d?.length)).filter(c=>c?.length),u=s.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(c=>c?.length).sort((c,d)=>(d.length||0)-(c.length||0));return{unassigned:o,unpaired:l,pairedNoConflict:u}}else{let o=s.map(c=>c.map(d=>d.unassigned).filter(d=>d?.length)).filter(c=>c?.length),l=s.map(c=>c.map(d=>d.unpaired).filter(d=>d?.length)).filter(c=>c?.length),u=s.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(c=>c?.length);return{unassigned:o,unpaired:l,pairedNoConflict:u}}}function vce({positionAssignments:t,participantIds:e}){let i=t.map(n=>n.participantId);return e.filter(n=>!i.includes(n))}function zxe({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:n,groupKey:r}){let a=Object.assign({},...Object.keys(n).map(u=>[u,n[u].filter(c=>e.includes(c))]).filter(u=>u[1].length).map(([u,c])=>({[u]:c}))),s=Object.keys(a).reduce((u,c)=>a[c].length>u?a[c].length:u,0),o=Object.keys(a).filter(u=>a[u].length===s),l=yl(i?o:Object.keys(a));return r=t&&a[r]?.length?r:l,{participantId:r&&a[r]?yl(a[r]):yl(e),groupKey:r}}function qxe({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(n=>({[n.drawPosition]:n})));return t.map(n=>n.filter(Boolean).map(r=>i[r]).filter(Boolean).filter(r=>!r.participantId&&!r.bye).map(r=>r.drawPosition)).flat().filter(Boolean)}function Wxe({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:n,drawPositionGroups:r,pairedPriority:a,allGroups:s,groupKey:o}){let l=r.reduce((U,C)=>C.length>U?C.length:U,0)<=2,u=vce({positionAssignments:t,participantIds:e}),c=qxe({positionAssignments:t,drawPositionGroups:r}),{participantId:d,groupKey:p}=zxe({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:s,groupKey:o}),h=Gxe({participantId:d,allGroups:s}),f=Hxe({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:h,participantIdGroups:i,drawPositionChunks:n,unfilledPositions:c}),{unassigned:m,unpaired:g,pairedNoConflict:v}=f,y=v?.length&&v[0],b=g?.length&&g[0],I=a&&y?y:b,S=a?b:y,w=I?.length&&I||S?.length&&S,T;if(w?.length){let U=Il(w);T=Il(U)}else{let U=Il(m[0]);T=Il(U)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:T}}function Tk({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(n=>{let r=n.map(o=>o.drawPosition),a=EW({drawPositions:r}).uniqueMatchUpGroupings??[],s=Object.assign({},...n.map(o=>({[o.drawPosition]:o})));a.forEach(o=>{mo(s[o[0]].values||[],s[o[1]].values||[])&&(i.push(o),n.conflict=!0)})}):e.forEach(n=>{mo(n[0]?.values||[],n[1]?.values||[])&&(i.push(n),n.conflict=!0)}),i}function Yxe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:n,isRoundRobin:r}){return n.map(a=>{let s=a.map(o=>o.drawPosition);return a.filter(o=>e.includes(o.drawPosition)).map(o=>{let l=e.filter(u=>!s?.includes(u)).filter(u=>{let c=i.find(m=>m.includes(u)).find(m=>m!==u),d=t.find(m=>m.drawPosition===c),p=Tk({isRoundRobin:r,groupedParticipants:[[o,d]]}),h=[t.find(m=>m.drawPosition===u),d],f=Tk({isRoundRobin:r,groupedParticipants:[h]});return!p.length&&!f.length});if(l.length)return{drawPosition:o.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function SX(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:n,unseededByePositions:r,drawPositionGroups:a,policyAttributes:s,idCollections:o,allGroups:l}=t,u=[],c,d=Math.min(...(a||[]).map(b=>b?.length).filter(Boolean)),p=d>2,h=Ct(e,!1,!0).filter(b=>!b.qualifier),f=e.filter(b=>!b.participantId&&(!b.bye||r?.includes(b.drawPosition))).map(b=>b.drawPosition);Dt(0,n).forEach(()=>{let{newGroupKey:b,selectedParticipantId:I,targetDrawPosition:S}=Wxe({...t,candidatePositionAssignments:h,allGroups:l,groupKey:c});c=b,h.forEach(w=>{w.drawPosition===S&&(w.participantId=I)})});let m=IX({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=Aa(m,d),v=Tk({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let b=Yxe({positionedParticipants:m,potentialDrawPositions:f,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(b.length){let I=Kxe({candidatePositionAssignments:h,swapOptions:b});I.error&&console.log({result:I}),m=IX({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=Aa(m,d),v=Tk({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return h.forEach(b=>{if(b.bye&&b.participantId){let I=dG;u.push(I)}if(b.qualifier&&b.participantId){let I=dG;u.push(I)}}),{positionAssignments:h,conflicts:v.length,groupedParticipants:g,errors:u}}function Kxe({candidatePositionAssignments:t,swapOptions:e}){let i=Il(e);if(!i)return{error:{message:"No swap options"}};let n=i.drawPosition,r=Il(i.possibleDrawPositions),a=t.find(u=>u.drawPosition===n),s=t.find(u=>u.drawPosition===r)??{},o={participantId:s?.participantId,qualifier:s?.qualifier,bye:s?.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,o),Object.assign(s,l),{...le}}function Zxe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,avoidance:c,drawSize:d,event:p}){if(!c)return{error:Nse};let{candidatesCount:h=1,policyAttributes:f,targetDivisions:m}=c,{roundsToSeparate:g}=c,v="randomUnseededSeparation",{structure:y}=li({drawDefinition:a,structureId:u}),{matchUps:b}=cn({provisionalPositioning:t,matchUpsMap:l,structure:y,event:p});if(m&&$d(m)&&!g){let j=WNe(m)||0,H=b.reduce((G,W)=>W.roundNumber>G?W.roundNumber:G,0);g=H<j?1:H-j+1}let{positionAssignments:I}=ua({structure:y}),S=SL({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:o}).participantsWithGroupings,w=I?.filter(j=>!j.participantId),T=I?.map(j=>j.drawPosition),U=y?.structureType===To,C=U?{structure:y,matchUps:b,allDrawPositions:T,roundsToSeparate:g}:{matchUps:b,allDrawPositions:T,roundsToSeparate:g},{drawPositionGroups:E,drawPositionChunks:P}=U?Xxe(C):Jxe(C),M={groupParticipants:o.filter(j=>j.participantType===Iu).map(j=>j.participantId),teamParticipants:o.filter(j=>j.participantType===wn).map(j=>j.participantId),pairParticipants:o.filter(j=>j.participantType===Ni).map(j=>j.participantId)},R=Bxe({targetParticipantIds:e,policyAttributes:f,idCollections:M,participants:o});if(R.error)return ce({result:R,stack:v});let N=Object.assign({},...e.map(j=>{let H=Object.keys(R).filter(G=>(R[G]??[]).includes(j));return{[j]:H}})),A=vce({participantIds:e,positionAssignments:I});if(A.length>(w?.length||0))return{error:qq};let _,x=A.length,O=Dt(0,h).map(()=>SX({initialPositionAssignments:I,participantsWithGroupings:S,unseededParticipantIds:e,opponentsToPlaceCount:x,pairedPriority:!1,unseededByePositions:n,participantIdGroups:N,drawPositionChunks:P,drawPositionGroups:E,policyAttributes:f,idCollections:M,allGroups:R,drawSize:d}));if(_=O.reduce((j,H)=>!j||(H.conflicts||0)<(j.conflicts||0)?H:j,void 0),!_||_.conflicts){let j=Dt(0,h).map(()=>SX({initialPositionAssignments:I,participantsWithGroupings:S,unseededParticipantIds:e,opponentsToPlaceCount:x,pairedPriority:!0,unseededByePositions:n,participantIdGroups:N,drawPositionChunks:P,drawPositionGroups:E,policyAttributes:f,idCollections:M,allGroups:R,drawSize:d}));_=O.concat(...j).filter(H=>!H.errors?.length).reduce((H,G)=>!H||(G.conflicts||0)<(H.conflicts||0)?G:H,void 0)}if(!_)return{error:zO};let $=(Nn({structure:y})?.positionAssignments??[]).filter(j=>j.participantId).map(j=>j.participantId),F=_.positionAssignments.filter(j=>!$.includes(j.participantId));for(let j of F)if(j.bye){let H=Su({tournamentRecord:r,drawDefinition:a,structureId:u,matchUpsMap:l,event:p,...j});if(H.error)return ce({result:H,stack:v})}else if(j.participantId){let H=Bp({inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,structureId:u,matchUpsMap:l,event:p,...j});if(H.error)return ce({result:H,stack:v,context:{assignment:j}})}return{...le}}function Xxe(t){let{structure:{structures:e}}=t,i=e.map(n=>n.positionAssignments.map(r=>r.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function Jxe({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let n=i.filter(c=>c.roundNumber===1).map(c=>c.drawPositions),r=n.flat().sort(ia),a=Math.max(...r),s=t.filter(c=>c>a),o=r.length,l=Dt(o===2?1:2,o).filter(c=>c===Cq(c)),u=l.slice(0,e||l.length).reverse().map(c=>Aa(r,c));return s.length&&console.log({fedDrawPositions:s}),{drawPositionGroups:n,drawPositionChunks:u}}function Qxe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,structure:c,drawSize:d,event:p}){let h="positionUnseededParticipants";c||({structure:c}=li({drawDefinition:a,structureId:u})),u||({structureId:u}=c);let{positionAssignments:f}=ua({structure:c}),{seedAssignments:m}=Zu({provisionalPositioning:t,drawDefinition:a,structure:c}),g=m?.map(C=>C.participantId).filter(Boolean),{stage:v,stageSequence:y}=c,b=v===qt?_i({element:c,name:ih})?.extension?.value:void 0,I=r0({provisionalPositioning:t,drawDefinition:a,stageSequence:y,entryStatuses:Mb,structureId:u,roundTarget:b,stage:v}),S=I.filter(C=>!g?.includes(C.participantId)).map(C=>C.participantId),w=f?.filter(C=>!C.participantId&&!C.bye&&!C.qualifier).map(C=>C.drawPosition);if(!n&&S.length>(w?.length||0))return ce({result:{error:qq},context:{unseededParticipantsCount:S.length,unfilledDrawPositionsCount:w?.length},stack:h});let{appliedPolicies:T}=sn({tournamentRecord:r,drawDefinition:a,event:p}),U=T?.[dC];if(c.stage===Sr){let C=I.reduce((E,P)=>(E[P.groupingValue]||(E[P.groupingValue]=[]),E[P.groupingValue].push(P.participantId),E),{});Object.keys(C).length&&(U||(U={policyName:"Playoff Avoidance"}),U.policyAttributes||(U.policyAttributes=[]),U.policyAttributes.push({groupings:C}))}return U&&o?Zxe({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,avoidance:U,drawSize:d}):eOe({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unfilledDrawPositions:w,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,structureId:u,matchUpsMap:l,drawSize:d,event:p})}function eOe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:n,multipleStructures:r,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,matchUpsMap:l,structureId:u,drawSize:c,event:d}){let p=c>2?oo(n):n.reverse();for(let h of e){let f=p.pop();if(!r||f){let m=Bp({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,participantId:h,drawPosition:f,matchUpsMap:l,structureId:u,event:d});if(m?.error&&console.log("!!!!!",{result:m}),m?.error)return ce({result:m,stack:"randomUnseededDistribution"})}}return{...le}}function tOe(t){let e=t.structure??li(t).structure,i="positionQualifiers",n=[];if(e.stage===Ts)return ce({result:{error:Sb},stack:i});let{unplacedRoundQualifierCounts:r,positionAssignments:a,roundDrawPositions:s}=iOe(t);for(let o of Object.keys(r)){let l=a?.filter(u=>s[o].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(r[o]>(l||0))return ce({result:{error:zq},context:{unfilledDrawPositions:l},stack:i});Dt(0,r[o]).forEach(()=>{let u=Il(l);n.push(u),a?.forEach(c=>{c.drawPosition===u&&(c.qualifier=!0,delete c.participantId,delete c.bye)})})}return{...le,qualifierDrawPositions:n}}function iOe({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=li({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:n}=ua({structure:e}),{stage:r,stageSequence:a}=e,{qualifiersCount:s,roundQualifiersCounts:o}=oD({drawDefinition:t,stageSequence:a,structureId:i,stage:r}),l=(o?Object.keys(o):[]).map(m=>ri(m)),{matchUps:u}=cn({structure:e}),{roundProfile:c}=go({matchUps:u}),d=Object.assign({},...l.filter(m=>c?.[m]).map(m=>({[m]:c?.[m]?.drawPositions?.filter(Boolean)??[]}))),p=n?.filter(m=>m.qualifier).map(m=>m.drawPosition),h=s-(p?.length??0),f=p?.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let g=n?.filter(v=>v.qualifier&&d[m]?.drawPositions?.includes(v.drawPosition)).map(v=>v.drawPosition);return{[m]:(o?.[m]??0)-(g?.length??0)}})),unplacedQualifiersCount:h,placedQualifiersCount:f,roundQualifiersCounts:o,positionAssignments:n,roundDrawPositions:d,qualifiersCount:s}}function TX({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:n,validSeedBlocks:r,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,groupsCount:u,structureId:c,matchUpsMap:d,structure:p,event:h}){let f=[],m=[],g=0;if(p||({structure:p}=li({drawDefinition:a,structureId:c})),c||(c=p?.structureId),n||(n=sn({drawDefinition:a}).appliedPolicies),!r){let v=p&&f0({provisionalPositioning:t,appliedPolicies:n,drawDefinition:a,seedingProfile:s,structure:p});v?.error&&m.push(v.error),r=v?.validSeedBlocks}return u=u??r?.length??0,Dt(0,u).forEach(()=>{if(g<(u||0)){let v=nOe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,structureId:c,matchUpsMap:d,event:h});v?.success&&(g++,f.push(...v.seedPositions??[])),v.error&&m.push({seedPositionError:v.error})}}),m.length?{error:m}:{...le,seedPositions:f}}function nOe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,participants:s,structureId:o,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:c,unfilledPositions:d}=ice({provisionalPositioning:t,randomize:!0,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,structureId:o}),{appliedPolicies:p}=sn({drawDefinition:n}),{avoidance:h}=p??{};h&&s&&c?.length>2;let f=[];for(let m of c){let g=d.pop();if(!g)return{error:HU};f.push(g);let v=Bp({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,participantId:m,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:o,event:u});if(!v.success)return v}return{...le,seedPositions:f}}function rOe({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:n}=ua({structure:i}),{seedAssignments:r}=Zu({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(r||[]).filter(s=>s.participantId).map(s=>({[s.participantId]:s})));return n?.map(s=>a[s.participantId]?{...s,seedNumber:a[s.participantId].seedNumber,seedValue:a[s.participantId].seedValue}:"").filter(Boolean)}function aOe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let n=[];e.forEach(a=>sOe(a,i,n,t));let r=n.map(a=>Array.isArray(a)?oo(a):a).flat(1/0);return Xae(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:r}function sOe(t,e,i,n){if(e-i.length>t.drawPositions.length)i.push(...t.drawPositions);else{let r=kG(Aa(t.drawPositions,2));oOe(r,i,n)}}function oOe(t,e,i){let n,r=i[e.length];for(;n=d_(t,r);)e.push(n),r=i[e.length]}function d_(t,e){return Array.isArray(t)&&t.length!==2?t.pop():Array.isArray(t[0])?uOe(t,e):lOe(t,e)}function lOe(t,e){return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift()}function uOe(t,e){let i=t[0].flat(1/0).length,n=t[1].flat(1/0).length;if(i===n){let r=t[0].flat(1/0).includes(e)?t[0]:t[1];return d_(e?r:t[Math.round(Math.random())],e)}return i<n?d_(t[1],e):d_(t[0],e)}function kG(t){let e=Math.floor(t.length/2);return t.length>2?[kG(t.slice(0,e)),kG(t.slice(e))]:t}function cOe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,byesToPlace:s,structure:o}){a||(a=f0({provisionalPositioning:t,appliedPolicies:i,drawDefinition:n,seedingProfile:r,structure:o}));let{isFeedIn:l,isLuckyStructure:u,isContainer:c}=a,{validSeedBlocks:d}=a;i?.seeding?.containerByesIgnoreSeeding&&(d=[]);let p=rOe({provisionalPositioning:t,drawDefinition:n,structure:o})??[],h=wi([].concat(...e.map(I=>I.drawPositions))),f=p.filter(I=>h.includes(I.drawPosition)),m=(I,S)=>VT(I.seedValue)-VT(S.seedValue),g=d.reduce((I,S)=>{let w=f.filter(T=>S.drawPositions?.includes(T.drawPosition)).sort(m);return I.concat(...w)},[]).map(I=>I.drawPosition),v=aOe({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:s}),y=UX({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,s),b=UX({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,s);return{strictSeedOrderByePositions:y,blockSeedOrderByePositions:b,isLuckyStructure:u,positionedSeeds:p,isContainer:c,isFeedIn:l}}function UX({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(n=>n.drawPositions).map(n=>n?.sort((r,a)=>r-a)).filter(n=>n?.[0]+1===n?.[1]);return t.map(n=>i.find(r=>r?.includes(n))).filter(Boolean).map(n=>n?.reduce((r,a)=>t.includes(a)?r:a,void 0)).filter(Boolean)}function dOe({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:n,drawDefinition:r,seedLimit:a,structure:s,isFeedIn:o}){let l=n?.seeding?.seedingProfile,u=s.stage===qt,{positionAssignments:c}=ua({structure:s}),d=c?.filter(A=>A.participantId).map(A=>A.drawPosition),p={isCollectionMatchUp:!1},{matchUps:h,roundMatchUps:f}=cn({provisionalPositioning:t,matchUpFilters:p,structure:s}),m=f?.[1]||[],g=s.structureType===To?h:m,v=wi([].concat(...g.map(A=>A.drawPositions))),y=Math.min(...v)-1,b=d?.filter(A=>v.includes(A)),I=A=>{let _=Math.ceil(A.length/2),x=[A.slice(0,_),A.slice(_)],O=x.map(Z=>[].concat(...Z.flat(1/0)).length),$=Math.min(...O.flat(1/0)),F=Math.max(...O.flat(1/0)),j=O.indexOf(F),H=$!==F,G=oo(x),[W,q]=!$||H?[x[j],x[1-j]]:[G[0],G[1]];return{greaterHalf:W,lesserHalf:q}},S=A=>{let{greaterHalf:_,lesserHalf:x}=I(A),{greaterHalf:O,lesserHalf:$}=I(_),F=oo(O.flat(1/0)).pop(),j=O.flat().filter(H=>H!==F);return{newlyFilteredChunks:[...x,...$,j],drawPosition:F}},w=A=>!e.includes(A),T=A=>!b?.includes(A),U=A=>{let _=Aa(A.sort(ia),Math.ceil(A.length/4)).map($=>$.filter(T)),x=[].concat(..._.flat(1/0)).length,O=[];for(let $=0;$<x;$++){let{newlyFilteredChunks:F,drawPosition:j}=S(_);O.push(j),_=F}return O},{validSeedBlocks:C}=f0({provisionalPositioning:t,allPositions:!0,appliedPolicies:n,drawDefinition:r,structure:s}),E=C?.map(A=>A.drawPositions?.map(_=>_+y)),P;if(o){let A=v.length,{seedBlocks:_}=PW({cluster:ER(l)===tL,participantsCount:A});P=_.map(x=>x.map(O=>O+y)).map(U).filter(x=>x.length)}else u?P=E?.map(A=>A.filter(T)):P=E?.map(U).filter(A=>A.length);let M=g.map(A=>A.drawPositions).map(A=>A?.sort((_,x)=>_-x)).filter(A=>A?.[0]+1===A?.[1]),R=A=>M.reduce((_,x)=>x.includes(A)?x.reduce((O,$)=>$!==A?$:O,void 0):_,void 0),N=P.map(A=>A.map(R)).flat(1/0).filter(T).filter(w).filter(Boolean);if(u&&!s.structures){let A=a%4,_=N.slice(0,A),x=f[s.roundLimit]?.length,O=Aa(N.slice(A),x).map(oo).flat();N=_.concat(O)}return{unseededByePositions:N}}function pOe({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:n,event:r}){let a={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:o}=cn({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:n,event:r}),l=o?.[1]||[],u=n?.structureType===To,c=u?s:l,d=u?n?.structures?.length||0:s.length,{structureId:p,stage:h,stageSequence:f}=n,m=r0({entryStatuses:fd,provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:p,stage:h}),{qualifiersCount:g}=oD({provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:p,stage:h}),v=m.length+g,{positionAssignments:y,unassignedPositions:b}=ua({structure:n}),I=b?.map(E=>E.drawPosition),S=y?.filter(E=>E.bye).length,w=y?.filter(E=>E.bye).map(E=>E.drawPosition),T=c.map(E=>E.drawPositions).filter(E=>E?.reduce((P,M)=>!w?.includes(M)&&P,!0)).flat(1/0).filter(E=>I?.includes(E)),U=y?.length,C=U?U-v:0;return C>d&&n.stageSequence===1&&n.stage!==Ts&&(C=d),{placedByes:S,byesCount:C,relevantMatchUps:c,placedByePositions:w,roundMatchUps:o,positionsToAvoidDoubleBye:T}}function DX({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:n,seedBlockInfo:r,seedingProfile:a,matchUpsMap:s,structureId:o,structure:l,seedLimit:u,seedsOnly:c,event:d}){l||({structure:l}=li({drawDefinition:n,structureId:o})),o||(o=l?.structureId);let p=!(l?.structures??l?.stage===qt),{byesCount:h,placedByes:f,relevantMatchUps:m}=pOe({provisionalPositioning:t,drawDefinition:n,matchUpsMap:s,structure:l,event:d}),g=h-(f||0);if(g<=0)return{...le};let{strictSeedOrderByePositions:v,blockSeedOrderByePositions:y,isLuckyStructure:b,isFeedIn:I}=cOe({provisionalPositioning:t,relevantMatchUps:m,appliedPolicies:i,drawDefinition:n,seedingProfile:a,seedBlockInfo:r,byesToPlace:g,structure:l}),S=l?.structureType&&[To,iL].includes(l.structureType)&&i?.seeding?.containerByesIgnoreSeeding,w=p&&y?.length?y:v,{unseededByePositions:T}=dOe({provisionalPositioning:t,seedOrderByePositions:w,isLuckyStructure:b,appliedPolicies:i,drawDefinition:n,seedLimit:u,structure:l,isFeedIn:I}),U=M=>M%2,C=(M,R)=>(M||[]).every(N=>U(N)?R!==N+1:R!==N-1),E=[].concat(...w);if(!c)for(;T.length;){let M=T.find(R=>C(E,R));M?(E.push(M),T=T.filter(R=>R!==M)):(E.push(...T),T=[])}S&&(E=oo(E),du({ignoreSeededByes:S})&&console.log({byePositions:E}));let P=E.slice(0,g);for(let M of P){let R=Su({provisionalPositioning:t,tournamentRecord:e,drawDefinition:n,drawPosition:M,matchUpsMap:s,structureId:o,structure:l,event:d});if(R?.error)return R}return{...le,unseededByePositions:T,byeDrawPositions:P}}function PR(t){let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:n,multipleStructures:r,placeByes:a=!0,tournamentRecord:s,placementGroup:o,seedingProfile:l,structureId:u,seedLimit:c,seedsOnly:d,drawType:p,drawSize:h,event:f}=t,m=[];i||(woe(),e=Ct(e,!1,!0));let g=A=>(i||r_(),ce({result:A,stack:"automatedPositioning"})),v=A=>(i||r_(),A),y=li({drawDefinition:e,structureId:u});if(y.error)return g(y);let b=y.structure;if(!b)return{error:or};let I=t.appliedPolicies||sn({drawDefinition:e,structure:b,event:f})?.appliedPolicies,{qualifiersCount:S}=oD({stageSequence:b.stageSequence,provisionalPositioning:n,stage:b.stage,drawDefinition:e,structureId:u}),w=Mb;if(!r0({stageSequence:b.stageSequence,provisionalPositioning:n,stage:b.stage,placementGroup:o,drawDefinition:e,entryStatuses:w,structureId:u})?.length&&!S)return v({...le});let T=t.matchUpsMap??us({drawDefinition:e}),U=t.inContextDrawMatchUps??Kr({inContext:!0,drawDefinition:e,matchUpsMap:T})?.matchUps,C=[],E=f0({provisionalPositioning:n,appliedPolicies:I,drawDefinition:e,seedingProfile:l,structure:b});if(E.error)return E;let{validSeedBlocks:P}=E;m.push({validSeedBlocks:P});let M=t.participants||(s?dr({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:s})?.participants:[]);if(ER(b.seedingProfile||l)===Hy){let A=a?DX({provisionalPositioning:n,tournamentRecord:s,appliedPolicies:I,drawDefinition:e,seedBlockInfo:E,matchUpsMap:T,structure:b,seedLimit:c,seedsOnly:d,event:f}):void 0;if(A?.error)return g(A);C=A.unseededByePositions,m.push({action:"positionByes",unseededByePositions:C});let _=b.seedingProfile?{positioning:b.seedingProfile}:l;if(A=TX({seedingProfile:_,provisionalPositioning:n,inContextDrawMatchUps:U,tournamentRecord:s,appliedPolicies:I,validSeedBlocks:P,drawDefinition:e,seedBlockInfo:E,participants:M,matchUpsMap:T,structure:b,event:f}),A.error)return g(A);m.push({seedPositions:A.seedPositions,action:"positionSeedBlocks"})}else{if(p!==Tb){let _=b.seedingProfile?{positioning:b.seedingProfile}:l,x=TX({seedingProfile:_,provisionalPositioning:n,inContextDrawMatchUps:U,tournamentRecord:s,appliedPolicies:I,validSeedBlocks:P,drawDefinition:e,seedBlockInfo:E,participants:M,matchUpsMap:T,structure:b,event:f});if(x.error)return g(x);m.push({action:"positionSeedBlocks",seedPositions:x.seedPositions})}let A=a?DX({provisionalPositioning:n,tournamentRecord:s,appliedPolicies:I,drawDefinition:e,seedBlockInfo:E,matchUpsMap:T,structure:b,seedLimit:c,seedsOnly:d,event:f}):void 0;if(A?.error)return g(A);C=A?.unseededByePositions,m.push({action:"positionByes",byeDrawPositions:A?.byeDrawPositions,unseededByePositions:C})}let R={};if(!d){let A=tOe({inContextDrawMatchUps:U,tournamentRecord:s,appliedPolicies:I,validSeedBlocks:P,drawDefinition:e,seedBlockInfo:E,participants:M,matchUpsMap:T,structure:b});if(A.error||(A.conflicts&&(R.qualifierConflicts=A.conflicts),m.push({action:"positionQualifiers",qualifierDrawPositions:A.qualifierDrawPositions}),A=Qxe({provisionalPositioning:n,inContextDrawMatchUps:U,unseededByePositions:C,multipleStructures:r,tournamentRecord:s,drawDefinition:e,seedBlockInfo:E,participants:M,matchUpsMap:T,structureId:u,structure:b,drawSize:h,event:f}),A.error))return g(A);A.conflicts&&(R.unseededConflicts=A.conflicts),m.push({action:"positionUnseededParticipants"})}let{positionAssignments:N}=Nn({drawDefinition:e,structure:b});return Ln({drawDefinition:e,structureIds:[u]}),i||r_(),{positionAssignments:N,conflicts:R,...le,positioningReport:m}}function cD(t){let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:s,placeByes:o,seedsOnly:l}=t;if(!r)return{error:cu};if(!ef({drawDefinition:r,structureId:s})&&!i)return{error:Rq};let u=fce({drawDefinition:r,structureId:s}).playoffStructures?.sort((p,h)=>gk(p)-gk(h)),c=[],d=[];if(u)for(let p of u){let{structureId:h}=p,f=PR({structureId:h,provisionalPositioning:i,applyPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:a,placeByes:o,seedsOnly:l});if(f.error)return f;f.positionAssignments&&c.push({positionAssignments:f.positionAssignments,structureId:h}),f.positioningReport&&d.push(f.positioningReport)}return{...le,structurePositionAssignments:c,positioningReports:d}}function yce({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:n,structureId:r,seedValue:a,event:s}){if(!i)return{error:Ot};if(!r)return{error:yu};let o=(e?.participants??[]).find(p=>p.participantId===n);if(e&&!o)return{error:Bd};let{structure:l}=li({drawDefinition:i,structureId:r});if(!l)return{error:or};if(!(!t||br(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>br(p)&&ri(p)>0)))return{error:Ee};let{seedAssignments:u}=Zu({drawDefinition:i,structure:l}),c=u?.map(p=>p.seedNumber),d=u?.find(p=>p.participantId===n);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(h=>parseInt(h)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...c||[])+1,participantId:n};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return iue({tournamentId:e?.tournamentId,eventId:s?.eventId,drawDefinition:i,structure:l}),{...le}}function OW({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return _W({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function bC({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:n,linkType:r}){let{links:a}=aD({drawDefinition:i,structureId:n})||{},s=(a?.target||[]).filter(({linkType:o})=>o===r).filter(({target:o})=>!t||t===o.roundNumber).map(o=>{let l=o.source.structureId,{structure:u}=li({structureId:l,drawDefinition:i});if(!(e&&u?.finishingPosition!==e))return o}).filter(Boolean);return{sourceStructureIds:s.map(({source:o})=>o.structureId),relevantLinks:s}}var hOe=(t,e)=>{let i=[...new Set(e.slice(0,t.length))],n=[...i].sort((o,l)=>o-l),r=new Set,a=[];i.forEach(o=>{let l=t.indexOf(o);if(l!==-1&&!r.has(l))a.push(l),r.add(l);else{let u=n.indexOf(o),c=t.findIndex((d,p)=>!r.has(p));for(;r.has(c)&&c===-1&&r.size<t.length;)c=t.findIndex((d,p)=>!r.has(p)&&p>c);a.push(u),r.add(u)}});let s=t.filter((o,l)=>!r.has(l));return[...a,...s]};function bce({targetRoundNumber:t=1,tournamentRecord:e,drawDefinition:i,event:n,randomList:r}){let a=zt({drawDefinition:i,event:n,tournamentRecord:e},[{[zs]:!0,[Gm]:!0,[ha]:!0}]);if(a.error)return a;let s=[],o=[],l=i.structures?.find(g=>g.stage===Nt&&g.stageSequence===1);if(!l)return ce({result:{error:xq}});let u=(sn({tournamentRecord:e,drawDefinition:i,structure:l,event:n}).appliedPolicies??{})[Xh]?.requireCompletedStructures,{qualifierPositions:c,positionAssignments:d}=ua({structure:l});if(!c.length)return ce({result:{error:zq}});let p=Dt(0,c.length);r&&(p=hOe(p,r));let h=d.map(g=>g.participantId).filter(Boolean),{relevantLinks:f}=bC({structureId:l.structureId,targetRoundNumber:t,linkType:Wh,drawDefinition:i})||{},{relevantLinks:m}=bC({structureId:l.structureId,targetRoundNumber:t,linkType:qh,drawDefinition:i})||{};for(let g of f){let v=i.structures?.find(b=>b.structureId===g.source.structureId);if(v?.stage!==qt)continue;let y=ef({structureId:g.source.structureId,drawDefinition:i});if(!u||y){let b=v.qualifyingRoundNumber,{matchUps:I}=cn({matchUpFilters:{...b&&{roundNumbers:[b]},isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,inContext:!0,structure:v});for(let S of I){let w=S.matchUpStatus==="BYE"&&S.sides?.find(({participantId:U})=>U),T=S.sides.find(U=>U?.sideNumber===S.winningSide);if(T||w){let{participantId:U}=T||w||{};U&&!h.includes(U)&&o.push(U)}}}}for(let g of m){let v=i?.structures?.find(y=>y.structureId===g.source.structureId);if(v?.stage===qt&&ef({structureId:g.source.structureId,drawDefinition:i})){let{positionAssignments:y}=Nn({structure:v}),b=y?.map(I=>{let S=I.participantId,w=_i({element:I,name:gm}).extension?.value;return w?{participantId:S,groupOrder:w?.groupOrder}:{}}).filter(({groupOrder:I,participantId:S})=>I===1&&!h.includes(S)).map(({participantId:I})=>I)??[];b&&o.push(...b)}}return o.length?(p.forEach((g,v)=>{let y=o[v],b=c[g].drawPosition;y&&OW({qualifyingParticipantId:y,structureId:l.structureId,drawPosition:b,tournamentRecord:e,drawDefinition:i})?.success&&s.push({participantId:y,drawPosition:b})}),ce({result:Vt({...le,assignedParticipants:s})})):ce({result:{error:jse}})}function Ice({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>yi(i)))&&ce({result:{error:Ee},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let n=e[i.structureId];n&&(i.structureOrder=n)}),t.structures.sort((i,n)=>DT(i.structureOrder)-DT(n.structureOrder)),{...le}):{error:Ot}}function FL({drawDefinition:t}){let e=t.structures??[],i=t.links??[],n=new Map,r=g=>{let v=n.get(g)||n.set(g,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&n.get(g);if(v&&!v?.stage){let y=e.find(b=>b.structureId===g);v.stage=y?.stage}return v},a={},s={},o=i.map(g=>{let v=g.source.structureId,y=g.target.structureId,b=r(v),I=r(y);return[zy,kc,nL,Hy].includes(g.target.feedProfile)?(b?.targets.push(y),I?.sources.push(v)):g.target.feedProfile===Ac&&(I?.drawSources.push(v),b?.drawTargets.push(y)),s[y]=s[y]||g.target.feedProfile===Ac,a[y]=wi([...a[y]||[],v]).filter(Boolean),[g.source.structureId,g.target.structureId]});for(let g of n.keys()){let v=n.get(g);if(v){let y=v.targets??[];for(;y.length;){let b=y.pop(),I=b&&n[b];I?.targets?.length?y.push(...I.targets):I&&(v.rootStage=I.stage)}if(v.rootStage||(v.rootStage=v.stage),!v.targets?.length){let b=v.sources??[];for(;b.length;){let I=b.pop(),S=I&&n[I];if(S?.sources?.length){for(let w of S.sources)v.progeny?.includes(w)||v.progeny?.push(w);b.push(...S.sources)}}}}}let l=0;for(let g of n.keys()){let v=n.get(g);if(v&&v.rootStage===qt){let y=[v.drawTargets?.[0]],b=0;for(;y.length;){b+=1;let I=y.pop(),S=I?n.get(I):void 0;S?.drawTargets?.length&&y.push(S.drawTargets[0])}v.distanceFromMain=b,b>l&&(l=b)}}let u=o.length;Dt(0,Math.ceil(u/2)).forEach(()=>{o=Dt(0,u).map(g=>{let v=o[g],y=o.reduce((b,I)=>mo(v,I)?b.concat(...I):b,[])||[];return wi(v.concat(...y))})});let c=o[0],d=(g,v)=>Dr(g,v).length===g.length,p=o.slice(1).reduce((g,v)=>g&&d(v,c),!0),h=[c].filter(Boolean),f=[c].filter(Boolean);e.forEach(g=>{let{structureId:v,stage:y}=g;h.find(b=>b.includes(v))||(h.push([v]),y!==Ga&&f.push([v]))});let m=p&&f.length===1;return!i?.length&&e.length===1&&r(e[0].structureId),{structureProfiles:Object.fromEntries(n),allStructuresLinked:m,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:s,structureGroups:h}}function wce({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=FL({drawDefinition:t});for(let n of t.structures){let r=i[n.structureId];r.distanceFromMain&&(n.stageSequence=e+1-r.distanceFromMain)}return{...le}}function LW(t){let e=zt(t,[{[ha]:!0,[zs]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:n,structure:r,link:a}=t;return fOe({tournamentId:i.tournamentId,drawDefinition:n,structure:r,link:a})}function fOe(t){let e=zt(t,[{[zs]:!0,[lL]:!0},{link:!0,[Go]:Qo,[ase]:_q}]);if(e.error)return e;let{drawDefinition:i,tournamentId:n,structure:r,eventId:a,link:s}=t,o=s.target.structureId,l=li({drawDefinition:i,structureId:o});if(l.error)return ce({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:l});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(r),i.links.push(s),wce({drawDefinition:i});let u=cn({structure:r})?.matchUps||[];return Yg({drawDefinition:i,tournamentId:n,matchUps:u,eventId:a}),Ln({drawDefinition:i,structureIds:[r.structureId]}),{...le}}function Sce({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:Ee};if(!t)return{error:Ot};let i=Object.assign({},...e.map(n=>{if(!Ki(n))return;let{structureId:r,structureName:a}=n||{};if(!(!r||!a))return{[r]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Zt};for(let n of t.structures||[]){let r=i[n.structureId];if(r&&(n.structureName=r),n.structures)for(let a of n.structures){let s=i[a.structureId];s&&(a.structureName=s)}}return{...le}}function FW({drawDefinition:t,timeItem:e}){if(!t)return{error:cu};if(!e)return{error:Zq};let i=e&&Object.keys(e),n=["itemType","itemValue"];if(n.filter(a=>i.includes(a)).length!==n.length)return{error:Kq};t.timeItems||(t.timeItems=[]);let r=new Date().toISOString();return Object.assign(e,{createdAt:r}),t.timeItems.push(e),nR({drawDefinition:t}),{...le}}function Tce(t){let{tournamentRecord:e,drawDefinition:i,structureId:n,event:r}=t,a=zt(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let s=i.structures??[],o=s.find(v=>v.structureId===n);if(!o)return{error:or};let l=s.find(({stage:v,stageSequence:y})=>v===Nt&&y===1),u=n===l?.structureId,c=s.filter(({stage:v})=>v===qt).map(kl("structureId"));if(u&&!c.length)return{error:lse};let d=c.includes(n),p=mOe({isQualifyingStructure:d,structure:o,...t});if(p?.error)return p;let{structureIdsToRemove:h,relatedStructureIdsMap:f}=vOe({qualifyingStructureIds:c,isQualifyingStructure:d,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureId:n}),{removedMatchUpIds:m,removedStructureIds:g}=yOe({relatedStructureIdsMap:f,qualifyingStructureIds:c,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:h,structureId:n});if(gOe({removedMatchUpIds:m,drawDefinition:i}),u){let v=(l.matchUps??[])?.map(kl("matchUpId"));m.push(...v),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&wce({drawDefinition:i}),ff({tournamentId:e?.tournamentId,matchUpIds:m,action:"removeStructure",eventId:r?.eventId,drawDefinition:i}),Ln({drawDefinition:i,eventId:r?.eventId}),{...le,removedMatchUpIds:m,removedStructureIds:g}}function mOe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:n,structure:r,event:a,force:s}){let o=[n];if(t){let l=c=>i.links?.find(d=>d.target.structureId===c),u=l(n)?.source.structureId;for(;u;)o.push(u),u=l(u)?.source.structureId}if(Kr({matchUpFilters:{structureIds:o},drawDefinition:i}).matchUps?.some(({score:l})=>ca({score:l}))){let l=sn({tournamentRecord:e,drawDefinition:i,structure:r,event:a})?.appliedPolicies;if(!(s??l?.[Ku]?.allowDeletionWithScoresPresent?.structures))return{error:z1}}return{...le}}function gOe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=Kr({drawDefinition:e});i?.forEach(n=>{n.winnerMatchUpId&&t.includes(n.winnerMatchUpId)&&delete n.winnerMatchUpId,n.loserMatchUpId&&t.includes(n.loserMatchUpId)&&delete n.loserMatchUpId})}function vOe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureId:a}){let s=(r.structures??[]).map(kl("structureId")),o=c=>r.links?.map(d=>d.source.structureId===c&&d.target.structureId!==n?.structureId&&d.target.structureId).filter(Boolean)??[],l=c=>r.links?.map(d=>t.includes(d.source.structureId)&&d.target.structureId===c&&d.source.structureId).filter(Boolean)??[],u=new Map;return s.forEach(c=>u.set(c,e?l(c):o(c))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}function yOe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureIdsToRemove:a,structureId:s}){let o=[],l=[];for(;a?.length;){let u=a.pop();l.push(...wOe({idBeingRemoved:u,drawDefinition:r}));let c=IOe({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:r,structureId:s});o.push(...c.removedStructureIds);let d=bOe({relatedStructureIdsMap:t,mainStageSequence1:n,idBeingRemoved:u,structureId:s});d?.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:o}}function bOe({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:n}){return t&&e.get(t)?.filter(r=>r!==i?.structureId||n===i.structureId)}function IOe({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:n,structureId:r}){let a=[];return n.links=n.links?.filter(s=>s.source.structureId!==i&&s.target.structureId!==i)??[],(!e||e&&t.length||i!==r)&&(n.structures=(n.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function wOe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=li({structureId:t,drawDefinition:e}),n=cn({structure:i}).matchUps;return k3(n)}function Uk({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:n}){if(!e)return{error:Ot};if(!lW({drawDefinition:e,stage:n}))return{error:Sb};let r=wke({drawDefinition:e,stage:n}),{qualifiersCount:a}=oD({drawDefinition:e,stageSequence:t,stage:n}),s=r+a;if(i<s)return{error:pse};let{entryProfile:o}=oW({attributes:[{[n]:{drawSize:i}}],drawDefinition:e});return Ln({drawDefinition:e}),{...le,entryProfile:o}}function Uce({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?lW({drawDefinition:e,stage:i})?(oW({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),Ln({drawDefinition:e}),{...le}):{error:Sb}:{error:Ot}}function SOe({drawDefinition:t,drawSize:e}){if(!t)return{error:Ot};let i=Uk({stage:Ga,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(Ln({drawDefinition:t}),{...le})}function Dce(t){return SOe(t)}function Ece({tournamentRecord:t,drawDefinition:e,event:i,structureId:n}){if(!e)return{error:Ot};let r=e.structures?.find(s=>s.stage===qt&&s.structureId===n);if(!r)return{error:or};if(r.matchUps?.some(({matchUpStatus:s,score:o})=>ca({score:o})??Yr.includes(s)))return{error:z1};let a=r.matchUps?.map(({matchUpId:s})=>s)||[];return r.positionAssignments=[],r.seedAssignments=[],r.matchUps=[],ff({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),Ln({tournamentId:t?.tournamentId,eventId:i?.eventId,drawDefinition:e,structureIds:[r.structureId]}),{...le}}var TOe="qualifierDrawPositionAssignment",UOe="withdrawParticipantAtDrawPosition",DOe="alternateDrawPositionAssignment",EOe="luckyLoserDrawPositionAssignment",EX="removeDrawPositionAssignment",Pce="swapDrawPositionAssignments",POe="modifyPairAssignment",COe="adHocPositionSwap",ROe="modifyParticipantOtherName",PX="assignDrawPosition",MOe="removeSeededParticipant",NOe="assignDrawPositionBye",AOe="modifySeedAssignment",Cce="addPenalty",$W="MODIFY_PAIR",$L="QUALIFIER",BW="ALTERNATE",VW="WITHDRAW",hw="ASSIGN",xG="REMOVE",jW="LUCKY",mP="REMOVE_SEED",BL="SWAP",IC="NICKNAME",LI="SEED_VALUE",fw="PENALTY",g0={MODIFY_PAIR_ASSIGNMENT:$W,QUALIFYING_PARTICIPANT:$L,ALTERNATE_PARTICIPANT:BW,WITHDRAW_PARTICIPANT:VW,ASSIGN_PARTICIPANT:hw,LUCKY_PARTICIPANT:jW,REMOVE_ASSIGNMENT:xG,SWAP_PARTICIPANTS:BL,ADD_NICKNAME:IC,REMOVE_SEED:mP,ADD_PENALTY:fw,ASSIGN_BYE:"BYE",SEED_VALUE:LI};function Rce({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:n,event:r}){if(!e)return{error:Ot};if(!n)return{error:yu};if(i?.length!==2)return{error:Ee,drawPositions:i};let a=us({drawDefinition:e}),{matchUps:s}=Kr({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:o}=li({drawDefinition:e,structureId:n});if(!o)return{error:or};let l=sn({tournamentRecord:t,drawDefinition:e,event:r}).appliedPolicies??{},u;if(o.structureType===To?u=xOe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:r}):u=_Oe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:r}),u.error)return u;if(iW({structure:o,drawPositions:i}),IL({appliedPolicies:l,drawDefinition:e,positionAction:{name:Pce,drawPositions:i,structureId:n}}),Kg({tournamentId:t?.tournamentId,drawDefinition:e,structure:o,event:r}),r.eventType===Nl){let c=cn({matchUpFilters:{matchUpTypes:[uu]},inContext:!0,structure:o}).matchUps.filter(p=>p.drawPositions?.some(h=>i.includes(h))),d=cn({matchUpFilters:{matchUpTypes:[uu]},structure:o}).matchUps;c.forEach(p=>{(p.sides||[]).forEach(h=>{let f=h?.drawPosition;if(i.includes(f)){let m=h.participantId,g=d.find(({matchUpId:y})=>y===p.matchUpId),v=p?.sides?.reduce((y,b,I)=>b.drawPosition===f?I:y,void 0);MW({inContextTargetMatchUp:p,drawPositionSideIndex:v,teamParticipantId:m,tournamentRecord:t,drawDefinition:e,matchUp:g,event:r})}})})}return Ln({drawDefinition:e,structureIds:[n]}),{...le}}function _Oe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:s}){let o=a?.positionAssignments.filter(u=>n?.includes(u.drawPosition));if(!o)return{error:Ee,structure:a,info:"Missing positionAssignments"};if(o.filter(({bye:u})=>u).length===2)return{...le};if(o.filter(({qualifier:u})=>u).length===2)return{...le};let l=o.some(({qualifier:u})=>u);return o.some(({bye:u})=>u)&&!l?Mce({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:r,structure:a,event:s}):kOe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:r,structure:a,event:s})}function Mce({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:s}){let o=n.find(({bye:f})=>f),l=n.find(({participantId:f})=>f),u=o.drawPosition,{participantId:c,drawPosition:d}=l,{structureId:p}=a,h=yC({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r});return h.error||(h=yC({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r}),h.error)||(Su({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r,event:s}),h=Bp({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:c,matchUpsMap:r,event:s}),h.error)?h:{...le}}function kOe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:s}){let o=Object.assign({},...n.map((l,u)=>{let{drawPosition:c}=l,d={...n[1-u],drawPosition:c};return{[c]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>o[l.drawPosition]||l),AW({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:n,structure:a,event:s}),{...le}}function xOe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:s}){let o=a.structures?.reduce((u,c)=>{let d=c?.positionAssignments.filter(p=>n?.includes(p.drawPosition));return d&&u.push(...d),u},[]);if(o.filter(({bye:u})=>u).length===2)return{...le};if(o.filter(({qualifier:u})=>u).length===2)return{...le};AW({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:o,structure:a,event:s});let l=o.some(({qualifier:u})=>u);if(o.some(({bye:u})=>u)&&!l)Mce({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:r,structure:a,event:s});else{let u=Ct(o,!1,!0);o.forEach((c,d)=>{let p=u[1-d].participantId;c.qualifier=u[1-d].qualifier,c.participantId=p})}return{...le}}function Nce({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:n}){let r="removeSeededParticipant";if(!t)return{error:ot};if(!e)return{error:Ot};let a=(e.structures??[]).find(s=>s.structureId===n);return a?!a.stage||![Nt,qt].includes(a.stage)||a.stage===Nt&&a.stageSequence!==1?ce({result:{error:Ib},stack:r}):a.seedAssignments?.find(s=>s.participantId===i)?{...le}:ce({info:"participant not seeded",result:{error:Ya},context:{participantId:i}}):ce({result:{error:or},stack:r})}function CR({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:n,targetStructureId:r,linkType:a=Wh}){return!n||!r?{error:yu}:{link:Vt({linkType:a,source:{roundNumber:i,structureId:n,finishingPositions:e},target:{feedProfile:Ac,roundNumber:t,structureId:r}})}}function v0({matchUp:t,tieFormat:e,isMock:i,uuids:n}){let{collectionDefinitions:r}=e??{};return{tieMatchUps:(r??[]).map(a=>RR({matchUp:t,collectionDefinition:a,uuids:n,isMock:i})).filter(Boolean).flat()}}function RR({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:n,isMock:r,uuids:a}){let{matchUpCount:s,matchUpType:o,collectionId:l,processCodes:u}=e||{},c=i??s??0,d=p=>{if(!r&&!n?.isMock)return a?.pop()??mn();let h=e?.collectionId;return a?.pop()??`${n?.matchUpId}-${h}-TMU-${p+1}`};return Dt(0,c).map(p=>{let h=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Er,collectionPosition:h,collectionId:l,processCodes:u,matchUpType:o,isMock:r}})}function GW({roundPosition:t,roundNumber:e,idPrefix:i,uuids:n}){return i?`${i}-${e}-${t}`:n?.pop()||mn()}function Dk({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:n,idPrefix:r,isMock:a,uuids:s,nodes:o}){let l=0,u=[],c=1,d=i-1,p=o?.length;for(;l<(p||0);){let h=o?.[l],f=o?.[l+1];d&&(h.roundNumber=d),f&&d&&(f.roundNumber=d);let m=GW({roundPosition:c,roundNumber:i,idPrefix:r,uuids:s}),g={roundPosition:c,children:[h,f],matchUpId:m};u.push(g);let v={drawPositions:g.children.map(y=>y?.drawPosition).filter(Boolean),matchUpStatus:Er,matchUpId:g.matchUpId,roundPosition:c,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),n.push(v),c++,l+=2}return{roundNodes:u,matchUps:n}}function Vp({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:n,matchUpType:r,roundLimit:a,idPrefix:s,drawSize:o,isMock:l,uuids:u}){if(isNaN(o)||o<2||n&&o<=n)return{matchUps:[],roundsCount:0};if(n&&(!$d(o)||o%n)){let g=n;for(;g<o;)g=2*g;o=g}let c=n&&!(o%2)&&(!isNaN(n)||i&&!isNaN(i))&&(o/n===Math.round(o/n)||i&&o/i===Math.round(o/i));if(!$d(o)&&!c)return{matchUps:[],roundsCount:0};let d=Dt(1,o+1).map(g=>({drawPosition:g})),p,h=[],f=1;for({roundNodes:p,matchUps:h}=Dk({matchUpType:r,roundNumber:f,idPrefix:s,matchUps:h,isMock:l,nodes:d,uuids:u}),f++,a=a??i;p.length>1;)n&&p.length===n&&(a=f-1),{roundNodes:p,matchUps:h}=Dk({nodes:p,matchUpType:r,roundNumber:f,idPrefix:s,matchUps:h,isMock:l,uuids:u}),f++;let m=f-1;return h=vR({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:a,matchUps:h}),a?h=h.filter(g=>a&&(g.roundNumber??0)<=a):a=f-1,{drawSize:o,matchUps:h,roundsCount:m,roundLimit:a}}function HW(t){let e="generateQualifyingStructure";if(!t.drawDefinition)return ce({result:{error:Ot},stack:e});if(t.drawSize&&!yi(t.drawSize)||t.participantsCount&&!yi(t.participantsCount)||t.qualifyingPositions&&!yi(t.qualifyingPositions))return ce({result:{error:Ee},stack:e});let i=t.drawSize??Pq(t.participantsCount),{hasExistingDrawDefinition:n,qualifyingRoundNumber:r,qualifyingPositions:a,targetStructureId:s,structureOptions:o,appliedPolicies:l,qualifyingOnly:u,drawDefinition:c,matchUpFormat:d,structureName:p,structureId:h,roundTarget:f,tieFormat:m,drawType:g,idPrefix:v,isMock:y,uuids:b}=t;if(!t.drawSize)return ce({result:{error:B1},context:{drawSize:i},stack:e});if(a&&a>=t.drawSize)return ce({result:{error:Ee},context:{drawSize:i,qualifyingPositions:a},stack:e});let I,S,w,T,U=0,C,E=1,{structureProfiles:P}=FL({drawDefinition:c}),M=P[s];if(!M)return ce({result:{error:or},context:{targetStructureId:s},stack:e});let R=c.matchUpType,N=f?`${f}-`:"",A=M.stage===qt,_=l?.[hm]?.namingConventions?.pre??Dke[hm]?.namingConventions?.pre,x=A&&_?`${_}-`:"",O=p??(N?`${x}${Is(qt)} ${N}`:`${x}${Is(qt)}`);if(g===id){let{maxRoundNumber:j,structures:H,groupCount:G}=UR({structureName:p??O,structureId:h??b?.pop(),hasExistingDrawDefinition:n,stage:qt,structureOptions:o,appliedPolicies:l,qualifyingOnly:u,stageSequence:E,matchUpType:R,roundTarget:f,tieFormat:m,idPrefix:v,drawSize:i,isMock:y,uuids:b});U=G,I=j,w=H[0],C=[1]}else({drawSize:i,matchUps:T,roundLimit:I,roundsCount:S}=Vp({qualifyingRoundNumber:r,qualifyingPositions:a,matchUpType:R,idPrefix:v,drawSize:i,isMock:y,uuids:b})),I||(I=S),w=Vu({structureName:p??O,structureId:h??b?.pop(),qualifyingRoundNumber:I,stage:qt,matchUpFormat:d,stageSequence:E,matchUpType:R,roundLimit:I,matchUps:T}),f&&un({extension:{name:ih,value:f},element:w}),U=T?.filter(j=>j.roundNumber===I)?.length;let $=g===id?qh:Wh,F=w&&I&&CR({sourceStructureId:w.structureId,sourceRoundNumber:I,targetStructureId:s,finishingPositions:C,linkType:$})?.link;return m&&(T=cn({structure:w})?.matchUps||[],T?.forEach(j=>{let{tieMatchUps:H}=v0({tieFormat:m,matchUp:j,isMock:y});Object.assign(j,{tieMatchUps:H,matchUpType:R})})),{qualifyingDrawPositionsCount:i,qualifiersCount:U,...le,structure:w,link:F}}function Ace(t){if(!t.tournamentRecord)return{error:ot};let e=OOe(t);return e.error,e}function OOe(t){if(!t.drawDefinition)return{error:Ot};if(!t.targetStructureId)return{error:yu};let e=HW(t);if(e.error)return e;let{structure:i,link:n}=e;return!i||!n?{error:Ee}:LW({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:n})}function _ce(t){let e=zt(t,[{[zs]:!0,[aL]:!0,[th]:!0},{[A_e]:!0,[gs]:d=>Number.isInteger(d)&&d>0},{[gs]:d=>Array.isArray(d)&&d.length===2&&d.every(Xn),[pu]:Ul,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:n,tournamentRecord:r,event:a}=t,{structure:s}=li({drawDefinition:i,structureId:n});if(!s)return{error:or};if(!Fo({structure:s}))return{error:Ib};let o=d=>d.sides?.map(p=>p.participantId).some(p=>t.participantIds.includes(p)),l=d=>d.roundNumber===t.roundNumber,u=d=>!ca(d),c=(s?.matchUps??[]).filter(l).filter(u).filter(o);if(c.length!==2)return{error:Ul};for(let d of c){let p=d?.sides?.find(h=>t.participantIds.includes(h?.participantId));if(p){let h=t.participantIds.find(f=>f!==p?.participantId);p.participantId=h,Zi({tournamentId:r?.tournamentId,eventId:a?.eventId,drawDefinition:i,matchUp:d})}}return Ln({drawDefinition:i,structureIds:[n]}),{...le}}function LOe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:n,idPrefix:r,matchUps:a,isMock:s,uuids:o,nodes:l,fed:u}){let c=l.length,d=e?e-c:void 0,p=Dt(0,c).map(m=>d?d+m:void 0),h=[];for(let m=0;m<c;m++){let g=p.shift(),v={drawPosition:g,fed:u+1,feed:!0},y=l[m];y.roundNumber=i-1;let b=GW({roundPosition:y.roundPosition,roundNumber:i,idPrefix:r,uuids:o}),I={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:Er,roundNumber:i,matchUpId:b};t&&(I.matchUpType=n),s&&(I.isMock=!0),a.push(I);let S={children:[y,v]};h.push(S)}let f=e?e-c:void 0;return{roundNodes:h,matchUps:a,drawPosition:f}}function Jg(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:n=0,skipRounds:r=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:s,finishingPositionOffset:o,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:c,matchUpType:d,idPrefix:p,isMock:h,uuids:f,fmlc:m}=t;a=a??N(e);let g=FOe({drawSize:a}),v=g.length,y=0;if(i?.length)y=i.reduce((A,_)=>A+_,0);else if(e){let A=e-a;i=g.filter(_=>_<=A?(A-=_,!0):!1),y=i.reduce((_,x)=>_+x,0),n=i.length}else r>=v?n=0:u&&(n=v-u,r=0),i=g.filter((A,_)=>u&&!n||n&&_>=r+n||_<r?0:A),y=i.reduce((A,_)=>A+_,0),n=i.length;let b=[...g,...i].sort((A,_)=>_-A),I=b.length,S=[...(l??[]).map(A=>A-1),...(s??[]).map(A=>I-A)].map(A=>b[A]).reduce((A,_)=>A+_,0);y=y-S;let w=0,T=[],U,C=1,E=Dt(0,a).map((A,_)=>({drawPosition:_+1+y})),P=y+1;for(let A of g){if({roundNodes:U,matchUps:T}=Dk({matchUpType:d,roundNumber:C,idPrefix:p,matchUps:T,isMock:h,nodes:E,uuids:f}),C++,i.includes(A)){let _=Rl(i)[A],x=Dt(0,_),O=I+1-C,$=s?.includes(O)??l?.includes(C);x.forEach(()=>{({roundNodes:U,matchUps:T,drawPosition:P}=LOe({drawPosition:!$&&P||void 0,nodes:U,matchUpType:d,roundNumber:C,idPrefix:p,matchUps:T,isMock:h,uuids:f,fed:w})),C++,w+=1})}E=U}I!==C-1&&console.log("ERROR");let M=a-y;T=vR({finishingPositionOffset:c?M:o,positionsFed:y,roundsCount:I,matchUps:T,fmlc:m});let R=U?.length?U[0]:U;return R&&(R.roundNumber=C-1,R.matchUps=T),{draw:R,matchUps:T,roundsCount:I};function N(A){let _=Cq(A);return _>A?_/2:_}}function FOe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Dt(0,e).reverse().map(i=>Math.pow(2,i))}function hT(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:s,stageSequence:o=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:c,roundOffset:d=0,drawDefinition:p,staggeredEntry:h,sequenceLimit:f,stage:m=Nt,drawSize:g,idPrefix:v,isMock:y,uuids:b}=t;if(!(!s||!u||s?.[l])||g<2||f&&o>f)return{};let I=[],S=[],w=[],T=t.matchUpType??p?.matchUpType,U=e+1,C=e+g,E=`${U}-${C}`,P=s?.[l],M=n&&`${n} `||"",R=s?.[E]??r?.[E],N=t.structureName||R?.name||P?.name&&(i?`${M}${P?.name}`:P.name)||`${M}${E}`,A=R?.abbreviation??P?.abbreviation,_=t.structureId??P?.structureId??b?.pop(),x={idPrefix:v&&`${v}-${N}-RP`,finishingPositionOffset:e,matchUpType:T,drawSize:g,isMock:y,uuids:b},{matchUps:O}=h?Jg(x):Vp(x),$=Vu({structureAbbreviation:A,stageSequence:o,structureName:N,matchUpType:T,roundOffset:d,structureId:_,matchUps:O,stage:m});I.push(...O),S.push($);let F=Math.ceil(Math.log(g)/Math.log(2)),j=c?Math.min(c-d,F):(!a||U<a)&&F||0;return g>2&&Dt(1,j+1).forEach(G=>H(G)),{structureId:$.structureId,matchUps:I,structureName:N,structures:S,links:w,...le};function H(G){let W=g/Math.pow(2,G);if(W<2)return;let q=g/Math.pow(2,G)+e;if(a&&q+1>a)return;let{structures:Z,structureId:K,matchUps:Q,links:J}=hT({finishingPositionOffset:q,exitProfile:`${l}-${G}`,roundOffset:d+G,stageSequence:o+1,drawSize:W,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:s,exitProfileLimit:u,roundOffsetLimit:c,drawDefinition:p,sequenceLimit:f,matchUpType:T,idPrefix:v,uuids:b,stage:m});if($.structureId&&K){let ne={linkType:Yh,source:{roundNumber:G,structureId:$.structureId},target:{roundNumber:1,feedProfile:kc,structureId:K}};J&&$&&J.push(ne),J?.length&&w.push(...J)}return Z?.length&&S.push(...Z),Q?.length&&I.push(...Q),{structureId:K,childLinks:J,structures:S}}}function zW({drawDefinition:t,matchUpsMap:e,structureId:i}){let n=li({drawDefinition:t,structureId:i});if(n.error)return ce({result:n});let{matchUps:r}=cn({structure:n.structure,matchUpsMap:e});return{...go({matchUps:r}),matchUps:r,matchUpsMap:e}}function CX({finishingPositions:t,drawDefinition:e,structureId:i}){let{roundProfile:n}=zW({drawDefinition:e,structureId:i});return(n&&Object.keys(n))?.reduce((r,a)=>(kce(n?.[a]).forEach(s=>{t.forEach(o=>{$Oe({position:o,rangeDefinition:s})&&(r[o]={roundNumber:a})})}),r),{})}function $Oe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((r,a)=>r||isNaN(a),!1))return!1;let[i,n]=e;return Dt(i,(n||i)+1).includes(t)}function kce(t){return[wi(t?.finishingPositionRange?.loser||[]),wi(t?.finishingPositionRange?.winner||[])]}function BOe(t){return kce(t).map(e=>Dt(e[0],e[1]&&e[1]+1||e[0]+1))}function dD({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:Ee,context:{structureIds:e}};if(!t)return{error:Ot};e=e??(t.structures??[]).filter(a=>a.stage!==qt).map(({structureId:a})=>a);let n=e.map(a=>{let{roundProfile:s}=zW({drawDefinition:t,matchUpsMap:i,structureId:a});return(s&&Object.values(s))?.map(BOe).flat()}).flat(),r=n.filter(a=>a?.length===1).sort(ia).flat();return{positionsNotPlayedOff:wi(n.flat()).filter(a=>!r.includes(a)),positionsPlayedOff:r}}function xce({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:n}){if(!i)return{error:Ot};if(!n)return{error:yu};if(!e)return{error:Zt,info:"missing playoffPositions"};let r=dD({drawDefinition:i});if(r.error)return r;let a=r.positionsPlayedOff,s=e.filter(v=>!a.includes(v)),o=CX({finishingPositions:s,drawDefinition:i,structureId:n}),l=Object.values(o).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>ri(v)).filter(v=>!t.includes(v)),u=CX({finishingPositions:a,drawDefinition:i,structureId:n}),c=u?Object.values(u):[],d=u?c.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>ri(v)):[],p=l.filter(v=>!d.includes(v)).sort(ia),{roundProfile:h}=zW({drawDefinition:i,structureId:n}),f=p.map(v=>{let y=h?.[v].finishingPositionRange.loser,[b,I]=y??[0,0];return Dt(b,(I||b)+1)}).flat().sort(ia),{playoffRoundsRanges:m}=VOe({playoffSourceRounds:p,roundProfile:h}),g=[...p,...d];return{playoffPositionsReturned:f,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:g,roundProfile:h}}function VOe({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let n=e[i].finishingPositionRange.loser,[r,a]=n,s=Dt(r,(a||r)+1);return{finishingPositionRange:n.join("-"),finishingPositions:s,roundNumber:i}})}}function MR({drawDefinition:t,structureId:e}){if(!t)return{error:Ot};let{matchUps:i,matchUpsMap:n}=uo({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:r,positionsPlayedOff:a}=dD({drawDefinition:t,matchUpsMap:n}),{structures:s}=rd({drawDefinition:t}),o=s.filter(u=>!e&&u.stage!==Ga||u.structureId===e),l={};for(let u of o){let c=u?.structureId,d=jOe({playoffPositions:r,drawDefinition:t,structure:u,matchUps:i}),{error:p,...h}=d;if(p)return d;l[c]={structureId:c,...h}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function jOe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:n}){let r=i?.structureId,{links:a}=aD({drawDefinition:e,structureId:r});if(i.structureType===To||i.structures){let h=Nn({structure:i})?.positionAssignments?.length,f=i.structures.length,m=(h??0)/f,g=a.source?.flatMap(({source:E})=>E?.finishingPositions||[])||[],v=Dt(1,m+1).filter(E=>!g.includes(E)),y=n.find(E=>E.containerStructureId===r&&E.finishingPositionRange)?.finishingPositionRange?.winner||[0,1],b=a?.source.map(({target:E})=>E.structureId),{positionsPlayedOff:I=[],positionsNotPlayedOff:S=[]}=dD({structureIds:b,drawDefinition:e}),w=[...I,...S],T=Dt(y[0],y[1]+1).filter(E=>!w.includes(E)),U=Aa(T,T.length/v.length),C=v.map((E,P)=>{let M=U[P],R=[Math.min(...M||[]),Math.max(...M||[])].join("-");return{finishingPosition:E,finishingPositions:M,finishingPositionRange:R}});return{positionsNotPlayedOff:T,playoffFinishingPositionRanges:C,finishingPositionsAvailable:v,finishingPositionsPlayedOff:g,positionsPlayedOff:I,groupCount:f,groupSize:m}}let s=a?.source?.filter(h=>h.linkCondition!==Fp).map(h=>h.source?.roundNumber)||[],o=a?.source?.filter(h=>h.linkCondition===Fp).map(h=>h.source?.roundNumber)||[],l=xce({excludeRoundNumbers:s,playoffPositions:t,drawDefinition:e,structureId:r}),u=l?.playoffSourceRounds?[...l?.playoffSourceRounds||[]]:void 0,c=[...l?.playoffRoundsRanges||[]],{roundProfile:d,error:p}=l;for(let h of o){let f=a?.source.find(b=>b.source.roundNumber===h),m=f?.target.roundNumber,g=f?.target.structureId,v=n.filter(({roundNumber:b,structureId:I})=>I===g&&b===m),y=v.filter(({sides:b})=>b.find(I=>I.participantFed&&!I.participantId)).length;if(u&&y===v.length){u.push(h);let b=d?.[h]?.finishingPositionRange?.loser;if(b){let I=Math.min(...b),S=I+y,w=Dt(I,S),T={finishingPositionRange:[I,S-1].join("-"),finishingPositions:w,roundNumber:h};c.push(T)}}}return u&&u.sort(ia),c.sort((h,f)=>h.roundNumber-f.roundNumber),{playoffRounds:u,playoffRoundsRanges:c,error:p}}function GOe({playoffGroups:t,drawDefinition:e,structureId:i}){if(!e)return{error:Ot};if(!Xn(i)||!Array.isArray(t))return{error:Ee};let n=t.map(({finishingPositions:r})=>r).flat();return{positionRangeMap:MR({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges?.filter(r=>n.includes(r.finishingPosition))?.reduce((r,a)=>(r[a.finishingPosition]=a,r),{})}}function Oce(t){let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:n=1,staggeredEntry:r,structureName:a,stage:s=Nt,matchUpType:o,structureId:l,idPrefix:u,drawSize:c,isMock:d,uuids:p}=t,h={finishingPositionOffset:e,matchUpType:o,drawSize:c,idPrefix:u,isMock:d,uuids:p},{matchUps:f}=r?Jg(h):Vp(h),m=Vu({structureName:a||i?.["0"]?.name||Is(Nt),structureId:l||p?.pop(),stageSequence:n,matchUpType:o,matchUps:f,stage:s}),g=[m],v=[];if(c>2){let y=c/2,{matchUps:b}=Vp({finishingPositionOffset:e+y,idPrefix:u&&`${u}-c`,drawSize:y,matchUpType:o,isMock:d}),I=Is(Ts),S=i?.["0-1"]?.name??t.consolationStructureName??(a?`${a} ${I}`:I),w=Vu({structureName:S,matchUps:b,structureId:p?.pop(),stage:Ts,stageSequence:1,matchUpType:o});g.push(w);let T={linkType:Yh,source:{roundNumber:1,structureId:m.structureId},target:{roundNumber:1,feedProfile:kc,structureId:w.structureId}};v.push(T)}return{...le,structures:g,links:v}}function Lce({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:n,feedPolicy:r,fmlc:a}){let s=t.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),o=r?.roundGroupedOrder||[],l=r?.roundFeedProfiles;return Dt(1+e,n+1+e).map(u=>{let c=l?.[u-1]?l[u-1]:u%2&&kc||zy,d=u-e<=2?u-e:(u-e-2)*2+2,p={linkType:Yh,source:{roundNumber:u,structureId:i.structureId},target:{feedProfile:c,roundNumber:d,structureId:t.structureId}},h=o[u-1];return h&&(p.target.groupedOrder=h),du()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),u===2&&a&&(p.linkCondition=Fp,p.target.feedProfile=kc),s.includes(d)?p:void 0}).filter(Boolean)}function Fce(t){let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:n=1,playoffAttributes:r,structureNameMap:a,staggeredEntry:s,stage:o=Nt,matchUpType:l,structureId:u,drawSize:c,idPrefix:d,isMock:p,uuids:h}=t,f={finishingPositionOffset:i,matchUpType:l,drawSize:c,idPrefix:d,isMock:p,uuids:h},{matchUps:m,roundsCount:g}=s?Jg(f):Vp(f),v=t.structureName??r?.["0"]?.name??Is(Nt),y=Bg({structureId:u||h?.pop(),structureName:v,stageSequence:n,matchUpType:l,matchUps:m,stage:o}),b=[y],I=[];if(c>2){let S=[0,2].slice(0,c/16).map((w,T)=>{let U=T+1,{consolationStructure:C}=HOe({idPrefix:d&&`${d}-c${T}`,structureId:h?.pop(),playoffStructureNameBase:e,playoffAttributes:r,structureNameMap:a,stageSequence:U,roundOffset:w,matchUpType:l,drawSize:c,isMock:p,index:T,uuids:h});b.push(C);let E=Lce({consolationStructure:C,roundsCount:2,mainStructure:y,roundOffset:w});return{consolationStructure:C,links:E}}).map(w=>w.links).flat();if(I.push(...S),c>=4&&c<=16||c>32){let{matchUps:w}=Vp({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),T=r?.["3-4"]?.name??Is(Sr),U=a?.[T]||T,C=e?`${e} ${U}`:U,E=Bg({structureId:h?.pop(),matchUps:w,stageSequence:2,stage:Sr,structureName:C,matchUpType:l}),P={linkType:Yh,source:{roundNumber:g-1,structureId:y.structureId},target:{structureId:E.structureId,feedProfile:kc,roundNumber:1}};b.push(E),I.push(P)}}return{structures:b,links:I,...le}}function HOe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:n,roundOffset:r=0,matchUpType:a,structureId:s,idPrefix:o,drawSize:l,isMock:u,index:c,uuids:d}){let p=l/(2*Math.pow(2,r)),{matchUps:h,roundsCount:f}=Jg({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:o,isMock:u,uuids:d}),m=c===0&&i?.["0-1"]?.name||c===1&&i?.["0-3"]?.name||`${Is(Ts)} ${c+1}`,g=n?.[m]||m,v=t?`${t} ${g}`:g;return{consolationStructure:Bg({matchUps:h,stage:Ts,structureName:v,stageSequence:e,matchUpType:a,structureId:s}),consolationRoundsCount:f}}function yI(t){let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:n,feedsFromFinal:r,staggeredEntry:a,structureName:s,stage:o=Nt,structureId:l,matchUpType:u,skipRounds:c,feedRounds:d,idPrefix:p,drawSize:h,isMock:f,uuids:m,fmlc:g}=t,v=t.feedPolicy||t.policyDefinitions?.[LT]||t.appliedPolicies?.[LT],y={finishingPositionOffset:e,matchUpType:u,skipRounds:c,drawSize:h,idPrefix:p,isMock:f,uuids:m},{matchUps:b}=a?Jg(y):Vp(y),I=Vu({structureName:s||n?.["0"]?.name||Is(Nt),structureId:l||m?.pop(),stageSequence:i,matchUpType:u,matchUps:b,stage:o}),S=[I],w=[],T=h/2,{matchUps:U,roundsCount:C}=Jg({finishingPositionOffset:T,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:r,baseDrawSize:T,matchUpType:u,feedRounds:d,skipRounds:c,isMock:f,uuids:m,fmlc:g});if(h>2){let E=n?.["0-1"]?.name??Is(Ts),P=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${E}`:E,M=Vu({matchUps:U,structureId:m?.pop(),stage:Ts,stageSequence:1,structureName:P,matchUpType:u});S.push(M);let R=Lce({consolationStructure:M,mainStructure:I,roundsCount:C,feedPolicy:v,fmlc:g});w.push(...R)}return{...le,structures:S,links:w}}function $ce({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:n,policyDefinitions:r,stageSequence:a,drawDefinition:s,playoffGroups:o,matchUpType:l,feedPolicy:u,groupCount:c,idPrefix:d,isMock:p,uuids:h}){u=u||r?.[LT];let f="processPlayoffGroups",m=0,g=[],v=[],y=[],{error:b,positionRangeMap:I}=GOe({structureId:n,drawDefinition:s,playoffGroups:o});if(b)return ce({result:{error:b},stack:f});if(!(!I||o?.every(S=>{let{finishingPositions:w=[]}=S;if(!w.length)return!1;let T=[...w].sort(ia).map((U,C)=>(w[C+1]||U)-U).every(U=>U<2);return(!t||T)&&w.every(U=>I[U])})))return ce({context:{validFinishingPositions:Object.values(I)},result:{error:Ee},stack:f});for(let S of o){let w=S.finishingPositions,T=I&&w.map(A=>I[A]?.finishingPositions).flat(),U=c*w.length,C=jU(U),E=C===2&&Dp||S.drawType||Dp;T&&(m=Math.min(...T)-1);let P=T&&`${Math.min(...T)}-${Math.max(...T)}`,M=S.structureName||P&&S.playoffAttributes?.[P]?.name||S.playoffAttributes?.["0"]?.name,R={addNameBaseToAttributeName:S.addNameBaseToAttributeName,playoffStructureNameBase:S.playoffStructureNameBase,finishingPositionNaming:S.finishingPositionNaming,finishingPositionLimit:S.finishingPositionLimit,structureId:S.structureId??h?.pop(),playoffAttributes:S.playoffAttributes,structureNameMap:S.structureNameMap,sequenceLimit:S.sequenceLimit,structureName:M,idPrefix:d&&`${d}-po`,appliedPolicies:r,finishingPositionOffset:m,stage:Sr,stageSequence:a,matchUpType:l,drawSize:C,isMock:p,uuids:h},N=({playoffStructures:A,playoffLinks:_})=>{let[x]=A,O=nA({playoffStructureId:x.structureId,finishingPositions:w,sourceStructureId:n});y.push(O),y.push(..._),v.push(...A),g.push({structureId:x.structureId,finishingPositions:w}),m+=U};if(E===Dp){let{matchUps:A}=Vp({finishingPositionLimit:m+U,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,matchUpType:l,drawSize:C,isMock:p,uuids:h}),_=Vu({structureId:S.structureId??h?.pop(),matchUpFormat:e,stage:Sr,structureName:M,stageSequence:a,matchUps:A});v.push(_);let x=nA({playoffStructureId:_.structureId,finishingPositions:w,sourceStructureId:n});y.push(x),m+=U,g.push({structureId:_.structureId,finishingPositions:w})}else if([_T,kT,Sr].includes(E)){let A={playoffAttributes:S.playoffAttributes??i,playoffStructureNameBase:S.playoffStructureNameBase,structureId:S.structureId??h?.pop(),structureName:S.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:m,stage:Sr,roundOffset:0,stageSequence:a,drawSize:C,isMock:p,uuids:h};E===_T?Object.assign(A,{playoffAttributes:S?.playoffAttributes??i??v3,roundOffsetLimit:3}):E===kT&&Object.assign(A,{playoffAttributes:S?.playoffAttributes??i??y3,roundOffsetLimit:2});let _=hT(A);if(_.error)return _;if(_.links?.length&&y.push(..._.links),_.structures?.length&&v.push(..._.structures),v.sort(n0),_.structureId){let x=nA({playoffStructureId:_.structureId,finishingPositions:w,sourceStructureId:n});y.push(x),g.push({structureId:_.structureId,finishingPositions:w})}m+=U}else if([xT,J1,lC,oC,sC,uC].includes(E)){let A=[h?.pop(),h?.pop()],_={playoffStructureNameBase:S.playoffStructureNameBase,structureId:S.structureId??h?.pop(),playoffAttributes:S.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,uuids:A,stage:Sr,structureName:M,matchUpType:l,feedPolicy:u,drawSize:C,isMock:p},x={[xT]:{fmlc:!0,feedRounds:1},[uC]:{feedRounds:1},[lC]:{feedsFromFinal:3},[oC]:{feedsFromFinal:2},[sC]:{feedsFromFinal:1}};Object.assign(_,x[E]||{});let{structures:O,links:$}=yI(_),[F]=O,j=nA({playoffStructureId:F.structureId,finishingPositions:w,sourceStructureId:n});y.push(j),y.push(...$),v.push(...O),g.push({structureId:F.structureId,finishingPositions:w}),m+=U}else if([id].includes(E)){let{structures:A,links:_}=UR({...R,structureOptions:S.structureOptions||{groupSize:4}});N({playoffStructures:A,playoffLinks:_})}else if([X1].includes(E)){let{structures:A,links:_}=Oce(R);N({playoffStructures:A,playoffLinks:_})}else if([E_e].includes(E)){let{structures:A,links:_}=Fce(R);N({playoffStructures:A,playoffLinks:_})}else if([Al].includes(E)){let A=Vu({structureId:S.structureId??h?.pop(),structureName:S.structureName,finishingPosition:s_,stage:Sr,stageSequence:a,matchUps:[]});N({playoffStructures:[A],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:I,structures:v,links:y}}function nA({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:qh,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:Ac,roundNumber:1}}}function zOe(t){let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return ce({result:{error:Zt},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:n,tournamentRecord:r,drawDefinition:a,playoffGroups:s,groupCount:o,groupSize:l,event:u}=t,c=$ce({requireSequential:n,sourceStructureId:i,playoffGroups:s,groupCount:o,...t});if(c.error)return ce({result:c,stack:e});let{structures:d=[],links:p=[],finishingPositionTargets:h,positionRangeMap:f}=c,m=h?.map(({finishingPositions:U})=>U).flat().map(U=>f[U].finishingPositions).flat();a.structures.push(...d),a.links.push(...p);let{matchUps:g,matchUpsMap:v}=Kr({inContext:!0,drawDefinition:a}),y=d.map(({structureId:U})=>U),b=g?.filter(({structureId:U})=>y.includes(U)).map(Ma),I=v?.drawMatchUps?.filter(({matchUpId:U})=>b?.includes(U));if(I?.length){let U=Zs({drawDefinition:a,event:u})?.tieFormat;U&&I.forEach(C=>{let{tieMatchUps:E}=v0({isMock:t.isMock,tieFormat:U,matchUp:C});Object.assign(C,{tieMatchUps:E,matchUpType:uu})})}let{positionAssignments:S}=Nn({structureId:i,drawDefinition:a}),w={};S?.forEach(U=>{let C=_i({element:U,name:gm})?.extension?.value?.groupOrder;C&&(w[C]||(w[C]=[]),w[C].push(U.participantId))});let T=cD({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:r,drawDefinition:a});return T.error&&T.error?.code!==Rq.code?ce({result:T,stack:e}):{structures:d,links:p,positionsPlayedOff:m,drawDefinition:a,...le}}function JS({value:t,sourceRange:e,targetRange:i}){let n=Math.min(...e),r=Math.max(...e),a=Math.min(...i),s=Math.max(...i);return(t-n)*(s-a)/(r-n)+a}var Bce="NTRP",Vce={ELO:"ELO",NTRP:Bce,TRN:"TRN",UTR:"UTR",WTN:"WTN"},qOe={ELO:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[Bce]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},WTN:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},Ca=qOe;function WOe({sourceRatingType:t,sourceRating:e}){let i=Ca[t].range,n=i[0]>i[1],r=Ca.ELO.range;return JS({value:n?i[0]-e:e,sourceRange:i,targetRange:r})}function YOe({targetRatingType:t,sourceRating:e}){let i=Ca[t].decimalsCount||0,n=Ca[t].range,r=n[0]>n[1],a=Math.max(...n),s=Ca.ELO.range,o=JS({targetRange:n,sourceRange:s,value:e}),l=parseFloat(o.toFixed(i));return r?a-l:l}function RX(t){let e=zt(t,[{ratings:!0,[Go]:Qo}]);if(e.error)return e;let i=t.matchUpType&&[Rn,Dn].includes(t.matchUpType)?t.matchUpType:Rn,n=Object.keys(Ca),r=t.targetRatingType&&n.includes(t.targetRatingType)?t.targetRatingType:"ELO",a=t.ratings[i]?t.ratings[i].reduce((d,p)=>d.includes(p.scaleName)?d:d.concat(p.scaleName),[]):[];if(!a)return{error:Ya};let s=t.ratings[i]?.find(d=>d.scaleName===r)??t.ratings[i][0];if(a[0]===r)return s;let o=s.scaleName,l=Ca[s.scaleName].accessor,u=l?s.scaleValue[l]:s.scaleValue,c=WOe({sourceRatingType:o,sourceRating:u});return{convertedRating:YOe({targetRatingType:r,sourceRating:c}),sourceRating:u}}function KOe({participantResults:t,sides:e,score:i}){let n=e.find(({sideNumber:o})=>o===1),r=e.find(({sideNumber:o})=>o===2),a=n?.participant?.ratings,s=r?.participant?.ratings;if(a?.[Rn]&&s?.[Rn]){let o="ELO",{convertedRating:l}=RX({ratings:a,targetRatingType:o}),{convertedRating:u}=RX({ratings:s,targetRatingType:o}),{side1pressure:c,side2pressure:d}=ZOe({side1ConvertedRating:l,side2ConvertedRating:u,score:i});c&&t[n?.participantId].pressureScores.push(c),d&&t[r?.participantId].pressureScores.push(d);let p=Math.max(...Ca.ELO.range),h=ak((u-l)/p),f=ak((l-u)/p);t[n?.participantId].ratingVariation.push(h),t[r?.participantId].ratingVariation.push(f)}}function ZOe({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){let n=t>e?t:e,r=t>e?e:t,a=Math.abs(t-e),s=Ca.ELO.range,o=Math.max(...s),l=(o-n)*0,u=(n+l)/o*a,c=i?.sets?.reduce((y,b)=>y+(b?.side1Score??0),0),d=i?.sets?.reduce((y,b)=>y+(b.side2Score??0),0),p=t>e?2:1,h=(c||0)*(r+(p===1?u:0)),f=(d||0)*(r+(p===2?u:0)),m=h+f,g=m?ak(h/m):0,v=m?ak(f/m):0;return{side1pressure:g,side2pressure:v}}function qW({winningSide:t,matchUpFormat:e=jc,matchUpStatus:i,tallyPolicy:n,score:r}){let a=[0,0],s=r?.sets,o=typeof t=="number"&&t-1,l=So(e),u=WW(l?.bestOf??1);if(typeof o=="number"&&(i===On&&n?.setsCreditForDefaults||i===ir&&n?.setsCreditForWalkovers))a[o]=u;else for(let c of s||[]){let{winningSide:d}=c;d&&(a[d-1]+=1)}return typeof o=="number"&&i===_a&&(+a[1-o]===u&&(a[1-o]-=1),n?.setsCreditForRetirements&&(a[o]=u)),a}function jce({matchUpFormat:t=jc,winningSide:e,matchUpStatus:i,tallyPolicy:n,score:r}){let{sets:a}=r||{};if(!a)return[0,0];let s=typeof e=="number"&&e-1,o=So(t),l=o?.bestOf??1,u=WW(l),c=o?.setFormat?.tiebreakAt||0,d=[[],[]];if(typeof s=="number"&&(i===On&&n?.gamesCreditForDefaults||i===ir&&n?.gamesCreditForWalkovers)){let p=o?.setFormat?.setTo||0,h=u*p;d[s].push(h)}else a.forEach((p,h)=>{let f=(p.setNumber||h+1)>u&&o?.finalSetFormat?"finalSetFormat":"setFormat",m=o?.[f]?.based,g=o?.[f].tiebreakSet,{side1Score:v,side2Score:y}=p;MX(m)&&(d[0].push(ri(v||0)),d[1].push(ri(y||0))),g&&p.winningSide&&n?.gamesCreditForTiebreakSets!==!1&&d[p.winningSide-1].push(1)});if(i===_a&&typeof s=="number"){let p=a.length>u&&o?.finalSetFormat?"finalSetFormat":"setFormat",h=o?.[p];if(MX(h.based)){let f=h?.setTo||0,m=v=>{if(!(!o||v===""))return+v===c-1||+v===c?ri(c||0)+1:+v<c?f:c},g=qW({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:n});if(d.map(v=>v[s]<=v[1-s]).reduce((v,y)=>v+(y?1:0),0)>g[1-s]){let v=d[s].length,y=m(d[1-s][v-1]);y&&(d[s][v-1]=y)}u>d[s].length&&n?.gamesCreditForRetirements&&d[s].push(f)}}return[d[0].reduce((p,h)=>p+h,0),d[1].reduce((p,h)=>p+h,0)]}function Gce({matchUpFormat:t,score:e}){let i=t?So(t):void 0,n=i?.bestOf??1,r=WW(n),a=[0,0],s=[0,0];return e?.sets?.forEach((o,l)=>{let u=(o.setNumber||l+1)>r&&i?.finalSetFormat?"finalSetFormat":"setFormat",c=i?.[u]?.based;if(Hce(c)){let{side1Score:d,side2Score:p}=o;d&&(s[0]+=ri(d||0)),p&&(s[1]+=ri(p||0))}else o.side1TiebreakScore&&(s[0]+=ri(o.side1TiebreakScore||0)),o.side2TiebreakScore&&(s[1]+=ri(o.side2TiebreakScore||0)),(o.side1TiebreakScore||o.side2TiebreakScore)&&o.winningSide&&(a[o.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:a}}function WW(t){return t&&Math.ceil(t/2)||1}function Hce(t){return t==="P"}function MX(t){return!Hce(t)}function XOe({participantResults:t,groupingTotal:e,matchUpFormat:i,tallyPolicy:n,totalGames:r,perPlayer:a,totalSets:s}){let o=i&&So(i)||{},l=o.bestOf,u=l&&Math.ceil(l/2)||1,c=o.setFormat?.setTo,d=Math.pow(10,n?.precision||3);Object.keys(t).forEach(p=>{let h=t[p].setsWon,f=t[p].setsLost,m=n?.groupTotalSetsPlayed||e==="setsPct"?s:a*u||h+f,g=Math.round(h/m*d)/d;(g===1/0||isNaN(g))&&(g=m);let v=t[p].tieMatchUpsWon,y=t[p].tieMatchUpsLost,b=v+y,I=Math.round(v/b*d)/d;(I===1/0||isNaN(I))&&(I=v);let S=t[p].matchUpsWon,w=t[p].matchUpsLost,T=S+w,U=Math.round(S/T*d)/d;(U===1/0||isNaN(U))&&(U=S);let C=t[p].gamesWon||0,E=t[p].gamesLost||0,P=(a||0)*u*(c||0),M=n?.groupTotalGamesPlayed||e==="gamesPct"?r:Math.max(P,C+E),R=Math.round(C/M*d)/d;(R===1/0||isNaN(R))&&(R=0);let N=t[p].pointsWon+t[p].pointsLost,A=Math.round(t[p].pointsWon/N*d)/d;(A===1/0||isNaN(A))&&(A=0),t[p].setsWon=h,t[p].setsLost=f,t[p].setsPct=g,t[p].tieMatchUpsWon=v,t[p].tieMatchUpsPct=I,t[p].matchUpsPct=U,t[p].gamesWon=C,t[p].gamesLost=E,t[p].gamesPct=R,t[p].pointsPct=A,t[p].result=`${t[p].matchUpsWon}/${t[p].matchUpsLost}`})}function NR({participantIds:t,pressureRating:e,groupingTotal:i,matchUpFormat:n,tallyPolicy:r,perPlayer:a,matchUps:s}){let o={},l=r?.excludeMatchUpStatuses||[],u=s?.filter(h=>(h.tieMatchUps||!l.includes(h.matchUpStatus))&&(!t?.length||Dr(t,[QS(h,0),QS(h,1)]).length===2)),c=u?.flatMap(({score:h,tieMatchUps:f})=>f?f.filter(({matchUpStatus:m})=>!l.includes(m)).flatMap(({score:m})=>m?.sets?.length??0):h?.sets?.length??0)?.reduce((h,f)=>h+f,0),d=h=>h?.sets?.reduce((f,m)=>f+(m?.side1Score??0)+(m?.side2Score??0),0)??0,p=u?.flatMap(({score:h,tieMatchUps:f})=>f?f.filter(({matchUpStatus:m})=>!l.includes(m)).flatMap(({score:m})=>d(m)):d(h))?.reduce((h,f)=>h+f,0);for(let h of u??[]){let{matchUpStatus:f,tieMatchUps:m,tieFormat:g,score:v,winningSide:y,sides:b}=h,I=g&&h._disableAutoCalc&&g.collectionDefinitions.every(({scoreValue:T})=>T),S=y&&JOe(h),w=y&&QOe(h);if(!S&&!w)if(f&&Yr.includes(f)){let T=QS(h,0),U=QS(h,1);T&&(Ug(o,T),o[T].matchUpsCancelled+=1),U&&(Ug(o,U),o[U].matchUpsCancelled+=1)}else if(m?.length){a=0;for(let T of m){if(T.winningSide){let U=b?.find(({sideNumber:E})=>E===T.winningSide)?.participantId,C=b?.find(({sideNumber:E})=>E===T.winningSide)?.participantId;U&&C&&(Ug(o,U),Ug(o,C),o[U].tieMatchUpsWon+=1,o[C].tieMatchUpsLost+=1,_r(Rn)(T.matchUpType)?(o[U].tieSinglesWon+=1,o[C].tieSinglesLost+=1):_r(Dn)(T.matchUpType)&&(o[U].tieDoublesWon+=1,o[C].tieDoublesLost+=1))}NX({score:T.score,manualGamesOverride:I,participantResults:o,sides:b})}}else NX({manualGamesOverride:I,participantResults:o,score:v,sides:b});else if(Ug(o,S),Ug(o,w),m?.length){a=0;for(let T of m){let{matchUpType:U}=T,C=_r(Dn)(U),E=_r(Rn)(U);T.winningSide&&(T.winningSide===y?(S&&(o[S].tieMatchUpsWon+=1,E&&(o[S].tieSinglesWon+=1),C&&(o[S].tieDoublesWon+=1)),w&&(o[w].tieMatchUpsLost+=1,E&&(o[w].tieSinglesLost+=1),C&&(o[w].tieDoublesLost+=1))):T.winningSide!==y&&(w&&(o[w].tieMatchUpsWon+=1,E&&(o[w].tieSinglesWon+=1),C&&(o[w].tieDoublesWon+=1)),S&&(o[S].tieMatchUpsLost+=1,E&&(o[S].tieSinglesLost+=1),C&&(o[S].tieDoublesLost+=1)))),AX({matchUpFormat:T.matchUpFormat,matchUpStatus:T.matchUpStatus,matchUpType:T.matchUpType,score:T.score,sides:T.sides,winningParticipantId:S,losingParticipantId:w,manualGamesOverride:I,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:r,winningSide:y})}zce({winningParticipantId:S,losingParticipantId:w,participantResults:o,matchUpStatus:f})}else AX({matchUpFormat:h.matchUpFormat??n,matchUpType:h.matchUpType,isTieMatchUp:void 0,winningParticipantId:S,manualGamesOverride:I,losingParticipantId:w,participantResults:o,pressureRating:e,matchUpStatus:f,tallyPolicy:r,winningSide:y,score:v,sides:b});if(I){let T=v?.sets?.reduce((P,M)=>P+(M?.side1Score??0),0),U=v?.sets?.reduce((P,M)=>P+(M.side2Score??0),0),C=b?.find(({sideNumber:P})=>P===1)?.participantId,E=b?.find(({sideNumber:P})=>P===2)?.participantId;Ug(o,C),Ug(o,E),C&&(o[C].gamesWon+=T,o[C].gamesLost+=U),E&&(o[E].gamesWon+=U,o[E].gamesLost+=T)}}return XOe({participantResults:o,groupingTotal:i,matchUpFormat:n,tallyPolicy:r,totalGames:p,perPlayer:a,totalSets:c}),{participantResults:o}}function JOe(t){let e=t.winningSide-1;return QS(t,e)}function QOe(t){let e=1-(t.winningSide-1);return QS(t,e)}function QS(t,e){if(!t?.sides)return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Ug(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function NX({manualGamesOverride:t,participantResults:e,score:i,sides:n}){let{sets:r}=i||{},a=[[],[]],s=[0,0];for(let l of r||[]){let{winningSide:u,side1Score:c,side2Score:d}=l;u&&(s[u-1]+=1),a[0].push(ri(c||0)),a[1].push(ri(d||0))}let o=[a[0].reduce((l,u)=>l+u,0),a[1].reduce((l,u)=>l+u,0)];n.forEach((l,u)=>{let{participantId:c}=l;c&&(Ug(e,c),e[c].setsWon+=s[u],e[c].setsLost+=s[1-u],t||(e[c].gamesWon+=o[u],e[c].gamesLost+=o[1-u]))})}function AX({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:n,pressureRating:r,matchUpFormat:a,matchUpStatus:s,isTieMatchUp:o,matchUpType:l,tallyPolicy:u,winningSide:c,score:d,sides:p}){let h=c&&c-1,f=1-h;r&&l===Rn&&KOe({participantResults:n,sides:p,score:d}),o||zce({winningParticipantId:t,losingParticipantId:i,participantResults:n,matchUpStatus:s});let m=qW({matchUpStatus:s,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),g=jce({matchUpStatus:s,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),{pointsTally:v}=Gce({score:d,matchUpFormat:a});t&&(n[t].setsWon+=m[h],n[t].setsLost+=m[f],e||(n[t].gamesWon+=g[h],n[t].gamesLost+=g[f]),n[t].pointsWon+=v[h],n[t].pointsLost+=v[f]),i&&(n[i].setsWon+=m[f],n[i].setsLost+=m[h],e||(n[i].gamesWon+=g[f],n[i].gamesLost+=g[h]),n[i].pointsWon+=v[f],n[i].pointsLost+=v[h])}function zce({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:n}){e&&(n===ir&&(i[e].walkovers+=1),n===On&&(i[e].defaults+=1),n===_a&&(i[e].retirements+=1),$s(n)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function eLe({matchUps:t,order:e,report:i}){let n={};t.forEach(({sides:a})=>{a.forEach(s=>{s.participantId&&s.participant&&(n[s.participantId]=s.participant.participantName)})});let r=[];return Array.isArray(i)&&i.forEach((a,s)=>{if(a.excludedDirectives?.length){let o=a.excludedDirectives.map(({attribute:c})=>c).join(", "),l=`${o.length} directives were excluded due to participants limit}`;r.push(l);let u=`Excluded: ${o}`;r.push(u)}else{let o=(h,f)=>parseFloat(a.reversed?h:f)-parseFloat(a.reversed?f:h),l=a.groups?Object.values(a.groups).flat(1/0).length:a.participantIds?.length??0,u=h=>{h.groups&&Object.keys(h.groups).sort(o).forEach(f=>{let m=h.groups[f].map(v=>n[v]).join(", "),g=`${f} ${h.attribute}: ${m}`;r.push(g)})},c=a.reversed?" in reverse order":"",d=a.groups?"grouped":"separated",p=`Step ${s+1}: ${l} particiants were ${d}${c} by ${a.attribute}`;if(r.push(p),a.idsFilter){let h=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(h)}u(a)}r.push("----------------------")}),r.push("Final Order:"),e.forEach(a=>{let{participantId:s,resolved:o}=a,l=a.groupOrder||a.provisionalOrder;r.push(`${l}: ${n[s]} => resolved: ${!!o}`)}),r.join(`\r
`)}function qce({participantResults:t,participantIds:e,attribute:i}){return Wce({participantResults:t,participantIds:e}).reduce((n,r)=>{let{participantId:a,results:s}=r,o=s?.[i];return!isNaN(o)&&a&&(n[o]?n[o].push(a):n[o]=[a]),n},{})}function Wce(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,n)=>(e.push({participantId:i,i:n,results:t.participantResults[i]}),e),[])}var tLe=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],nV={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function _X(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:n,tallyPolicy:r}=t,a=[];if(e&&!iLe(t))return{};let s=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(r?.groupOrderKey)?r.groupOrderKey:"matchUpsWon",o=qce({participantResults:i,attribute:s});a.push({attribute:s,groups:o});let l=Object.keys(o).map(g=>parseFloat(g)).sort((g,v)=>v-g).map(g=>o[g]).map(g=>{let v=Yce({participantIds:g,...t});return a.push(...v.report??[]),v.order}).map((g,v)=>g.map(y=>y.resolved?y:{...y,subGroup:[v].concat(...y.subGroup??[])})).flat(),u,c=0,d=1,p;l.forEach((g,v)=>{v&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let y=parseInt(g.subGroup?.join("")||0);g.resolved?(g.position=v+1,d=g.position):(u&&y>u&&(d+=c,c=0),g.position=d,c+=1),u=y});let h=l.map(({position:g})=>g),f=Rl(h);return l.forEach(g=>{let{participantId:v,position:y}=g||{},b=i[v];g.GEMscore=m(b);let I=f[y];g?.position!==void 0&&(I>1&&(g.ties=I,n&&(g.subOrder=n[v])),g.rankOrder=y,g.groupOrder=y+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function m(g){return(Array.isArray(r?.GEMscore)?Object.keys(nV).filter(v=>r.GEMscore.includes(v)):Object.keys(nV)).map(v=>(g[v]||0)*Math.pow(10,nV[v].toFixed(3))).reduce((v,y)=>v+y,0)}}function iLe({participantResults:t,participantsCount:e}){let i=Wce({participantResults:t}).filter(n=>e-1===n.results.matchUpsWon+n.results.matchUpsLost+n.results.matchUpsCancelled);return e===i.length}function nLe({disableHeadToHead:t,participantIds:e,matchUpFormat:i,groupTotals:n,tallyPolicy:r,attribute:a,idsFilter:s,matchUps:o,reversed:l}){let{participantResults:u}=NR({participantIds:s&&e,groupingTotal:n&&a,matchUpFormat:i,tallyPolicy:r,matchUps:o}),c=qce({participantResults:u,participantIds:e,attribute:a}),d=[{attribute:a,reversed:l,groups:c,idsFilter:s,groupTotals:n}],p;return Object.keys(c).length>1&&e.length&&(p=Object.keys(c).map(h=>parseFloat(h)).sort((h,f)=>l?h-f:f-h).map(h=>c[h]).map(h=>{let f=Yce({participantResults:u,disableHeadToHead:t,participantIds:h,matchUpFormat:i,tallyPolicy:r,matchUps:o});return d.push(...f.report??[]),f.order}).map((h,f)=>h.map(m=>m.resolved?m:{...m,subGroup:[f].concat(...m.subGroup??[])})).flat()),{order:p,report:d}}function Yce({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:n,tallyPolicy:r,matchUps:a}){let s=[],o=[],l;if(i?.length===1)return{order:[{resolved:!0,participantId:i[0]}]};if(i?.length===2&&(!r?.headToHead||!r.headToHead.disabled&&!e)){let c=rLe({participantIds:i,participantResults:t});if(c){let d=c[0].participantId;return o.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:c,headToHeadWinner:d,report:o}}}let u=(r?.tallyDirectives||tLe).filter(c=>{let d=!(br(c.maxParticipants)&&i?.length>c.maxParticipants);return d||s.push(c),d});return s.length&&o.push({excludedDirectives:s,participantIds:i}),u.every(({attribute:c,reversed:d,idsFilter:p,groupTotals:h,disableHeadToHead:f})=>(l=nLe({disableHeadToHead:f,participantIds:i,matchUpFormat:n,groupTotals:h,tallyPolicy:r,attribute:c,idsFilter:p,matchUps:a,reversed:d}),o.push(l.report),!l.order)),l.order?{order:l.order,report:o}:{order:i?.map(c=>({participantId:c})),report:o}}function rLe({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function pD({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:n,matchUps:r=[],subOrderMap:a,perPlayer:s}){if(!r?.length||!ac(r))return{error:Vm};let o=wi(r.map(({structureId:I})=>I));if(o.length!==1)return ce({result:{error:Ee,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let l=r.filter(I=>I&&I.matchUpStatus!=="BYE"),u=l.length&&wi(l.map(({drawPositions:I})=>I).flat()).length,c=l.filter(I=>Py({matchUp:I})).length===l.length;c||(s=0);let d=r.every(({matchUpType:I,tieMatchUps:S})=>I===Hn&&S?.every(w=>Py({matchUp:w}))),p=t?.[C3],h=r.filter(I=>Py({matchUp:I})??I.matchUpType===Hn),{participantResults:f}=NR({matchUps:h,pressureRating:i,matchUpFormat:n,tallyPolicy:p,perPlayer:s}),m,g,{groupOrder:v,report:y}=_X({matchUps:h,participantResults:f,participantsCount:u,matchUpFormat:n,subOrderMap:a,tallyPolicy:p});if(i&&aLe({participantResults:f}),c&&v)m=y,g=v,v.forEach(I=>{let{participantId:S,groupOrder:w,rankOrder:T,subOrder:U,ties:C,GEMscore:E}=I,P=f[S];Object.assign(P,{groupOrder:w,rankOrder:T,GEMscore:E,subOrder:U,ties:C})});else{let{groupOrder:I,report:S}=_X({requireCompletion:!1,participantResults:f,participantsCount:u,matchUpFormat:n,tallyPolicy:p,subOrderMap:a,matchUps:r});m=S,g=I,I&&I.forEach(w=>{let{participantId:T,groupOrder:U,GEMscore:C}=w,E=f[T];Object.assign(E,{provisionalOrder:U,GEMscore:C})})}let b={completedTieMatchUps:d,readableReport:"",participantResults:f,bracketComplete:c,order:[],report:m};if((c||d)&&(b.order=g),e||du({tally:!0})){let I=eLe({matchUps:r,report:m,order:g});du({tally:!0})&&console.log(I),b.readableReport=I}return b}function aLe({participantResults:t}){let e=r=>r.reduce((a,s)=>a+parseFloat(s),0),i=r=>parseFloat((e(r)/r.length).toFixed(2)),n=Object.keys(t).map(r=>{let a=t[r],{pressureScores:s}=a,o=s?.length?i(s):0;return{participantId:r,averagePressure:o}}).sort((r,a)=>(a.averagePressure||0)-(r.averagePressure||0)).map((r,a)=>({...r,order:a+1}));for(let r of n)t[r.participantId].pressureOrder=r.order}function Kce({positionAssignments:t}){let e=(t||[]).filter(kl(Zh)).map(r=>{let{extension:a}=_i({element:r,name:FT}),s=ri(a?.value),o=!isNaN(s)&&s;return o&&{participantId:r.participantId,subOrder:o}}).filter(Boolean),i=e.map(({subOrder:r})=>r),n=Rl(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:r})=>n[r]===1).map(({participantId:r,subOrder:a})=>({[r]:a})))}}function YW({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:n,matchUps:r,event:a}){if(!ac(r))return{error:Ee};if(!t)return{error:Ee};let{policyDefinitions:s}=Hm({policyTypes:[C3],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:o}=Kce({positionAssignments:t}),l=r.length?pD({policyDefinitions:s,matchUpFormat:n,subOrderMap:o,matchUps:r}):void 0;if(l?.error)return l;let{participantResults:u={},bracketComplete:c,report:d}=l??{},p=Object.keys(u);return t.forEach(h=>{let{participantId:f}=h;if(p.includes(f)){let m={value:u[f],name:gm};un({element:h,extension:m}),u[f].ties||lo({element:h,name:FT})}else lo({element:h,name:gm}),lo({element:h,name:FT})}),Ln({drawDefinition:i}),{...le,participantResults:u,bracketComplete:c,report:d}}function Zce({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function Qn(t){let e=zt(t,[{[zs]:!0,[th]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:n,contextProfile:r,drawDefinition:a,matchUpsMap:s,matchUpId:o,inContext:l,context:u,event:c}=t,{structures:d=[]}=rd({drawDefinition:a}),p=t.contextContent||r&&zm({contextProfile:r,drawDefinition:a});for(let h of d){let{matchUps:f}=cn({tournamentParticipants:i,afterRecoveryTimes:n,contextContent:p,drawDefinition:a,contextProfile:r,matchUpsMap:s,inContext:l,structure:h,context:u,event:c}),{matchUp:m}=Zce({matchUps:f,matchUpId:o});if(m)return{matchUp:m,structure:h}}return{error:Vs}}function VL(t){return!Ki(t)||!t.notes?{error:Zt}:Ki(t.element)?!Xn(t.notes)&&!t.notes?.testing?{error:Ee}:(Object.assign(t.element,{notes:t.notes}),{...le}):{error:Ee}}function KW(t){return Ki(t)?Ki(t.element)?(t.element.notes&&delete t.element.notes,{...le}):{error:Ee}:{error:Zt}}var jL={matchUpStatus:Er,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function Pp(t){let e="modifyMatchUpScore",i=t.matchUpFormat,n=t.matchUp,r,{matchUpStatusCodes:a,tournamentRecord:s,drawDefinition:o,matchUpStatus:l,removeScore:u,winningSide:c,matchUpId:d,event:p,notes:h,score:f}=t,m=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:sn({policyTypes:[Ku],tournamentRecord:s,drawDefinition:o,structure:r,event:p})?.appliedPolicies,g=n.matchUpType===Hn;if(g&&o){if(d&&n.matchUpId!==d){let T=Qn({drawDefinition:o,matchUpId:d,event:p});if(!T.matchUp)return{error:Vs};({matchUp:n,structure:r}=T)}}else n.matchUpId!==d&&console.log("!!!!!");l&&[ir,cr].includes(l)||u?Object.assign(n,{...jL}):f&&(n.score=f);let v=l&&n?.matchUpStatus===On&&l!==On;l&&(n.matchUpStatus=l),i&&(n.matchUpFormat=i),a&&(n.matchUpStatusCodes=a),c&&(n.winningSide=c),t.removeWinningSide&&(n.winningSide=void 0),!r&&o&&({structure:r}=Qn({drawDefinition:o,matchUpId:d,event:p})),l&&!n.winningSide&&ca(n)&&!Yr.includes(l)&&![i0,Tv,_l].includes(l)&&(n.matchUpStatus=hd);let y;if((v&&n?.processCodes?.length||l===On)&&(y=m?.[Ku]?.processCodes?.incompleteAssignmentsOnDefault),!n.collectionId){let T=r?.structureType===To,U=Fo({structure:r});if(uW({drawDefinition:o,structure:r})||U||T){let C=M=>{i=g?"SET1-S:T100":i??n.matchUpFormat??M?.matchUpFormat??o?.matchUpFormat??p?.matchUpFormat;let R=g?{matchUpTypes:[Hn]}:void 0,{matchUps:N}=cn({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:R,drawDefinition:o,structure:M,event:p});return U&&(M.positionAssignments=wi(N.flatMap(A=>(A.sides??[]).map(_=>_.participantId)).filter(Boolean)).map(A=>({participantId:A}))),YW({positionAssignments:M.positionAssignments,tournamentRecord:s,drawDefinition:o,matchUpFormat:i,matchUps:N,event:p})},E=T&&r.structures.find(M=>M?.matchUps.find(R=>R.matchUpId===d)),P=C(E||r);if(P.error)return ce({result:P,stack:e})}}if(h){let T=VL({element:n,notes:h});if(T.error)return ce({result:T,stack:e})}let b=s?.tournamentId,I=bu().topics.includes(yL),S=(I||y)&&us({drawDefinition:o}),w=S&&Kr({matchUpFilters:{matchUpIds:[d]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:o,matchUpsMap:S}).matchUps?.[0];if(I&&w&&oke({tournamentId:b,inContextMatchUp:w}),Array.isArray(y)&&w&&!w.sides?.every(({participantId:T})=>T))if(l===On)n.processCodes=wi([...n.processCodes??[],...y]);else for(let T of y||[]){let U=T&&n?.processCodes?.lastIndexOf(T);n?.processCodes?.splice(U,1)}return Zi({eventId:p?.eventId,context:e,drawDefinition:o,tournamentId:b,matchUp:n}),{...le}}function ZW(t){let{propagateExitStatus:e,matchUpStatusCodes:i,autoCalcDisabled:n,inContextMatchUp:r,matchUpStatus:a,dualMatchUp:s,structure:o,matchUp:l}=t,u=yR({matchUpStatus:a})||[nh,al].includes(a)&&s||n,c=l?.sides?.map(m=>m.participantId).filter(Boolean).length||r?.sides?.map(m=>m.participantId).filter(Boolean).length,d="attemptToModifyScore";if(!(Fo({structure:o})&&c===1||a===On&&c||sLe({structure:o,matchUp:l,inContextMatchUp:r})||t.appliedPolicies?.[Ku]?.requireParticipantsForScoring===!1||$s(a)&&c===1&&e))return ce({result:{error:Oq},stack:d});let p=[ir].includes(a),h=u?a:t.winningSide&&Ur||_l,f=Pp({...t,winningSide:t.winningSide,matchUpStatusCodes:u&&i||[],matchUpStatus:h,removeScore:p});return ce({result:f,stack:d})}function sLe({structure:t,matchUp:e,inContextMatchUp:i}){let{drawPositions:n}=e,{positionAssignments:r}=ua({structure:t}),a=r?.filter(o=>n?.includes(o.drawPosition)&&o.participantId),s=i?.sides?.every(o=>o.participantId);return a?.length===2||s}function Xce({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(n=>yi(n?.groupValue)&&n?.groupNumber).map(n=>({[n.groupNumber]:{...n,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(n=>ri(n));return{groupValueGroups:e,groupValueNumbers:i}}function oLe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:n,tieMatchUps:r}){let a=r.filter(y=>y.collectionId===t.collectionId),s=[0,0],o=[0,0],l=a.every(y=>Yr.includes(y.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,matchUpValue:p,winCriteria:h,scoreValue:f,setValue:m}=t,g=c&&e.includes(c),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),yi(p)?a.forEach(y=>{y.winningSide&&(s[y.winningSide-1]+=p)}):yi(m)?a.forEach(y=>{y.score?.sets?.forEach(b=>{b.winningSide&&(s[b.winningSide-1]+=m)})}):yi(f)?a.forEach(y=>{y.score?.sets?.forEach(b=>{let{side1TiebreakScore:I=0,side2TiebreakScore:S=0,side1Score:w=0,side2Score:T=0}=b;(y.matchUpStatus===Ur||y.winningSide||b.winningSide)&&(w||T?(s[0]+=w,s[1]+=T):(I||S)&&b.winningSide&&(s[b.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(y=>{if(y.winningSide){let b=y.collectionPosition,I=lLe({collectionDefinition:t,collectionPosition:b});yi(I)&&(s[y.winningSide-1]+=I)}}),yi(d)){let y;if(h?.aggregateValue)l&&(yi(p||m||f)&&s[0]!==s[1]?y=s[0]>s[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(h?.valueGoal)y=s.reduce((b,I,S)=>I>=h.valueGoal?S+1:b,0);else{let b=Math.floor(t.matchUpCount/2)+1;y=v.reduce((I,S,w)=>S>=b?w+1:I,0)}y&&(g?i[c].values[y-1]+=d:o[y-1]+=d)}else g?(i[c].values[0]+=s[0]||0,i[c].values[1]+=s[1]||0):o=s;g?(i[c].sideWins[0]+=v[0]||0,i[c].sideWins[1]+=v[1]||0,i[c].allGroupMatchUpsCompleted=i[c].allGroupMatchUpsCompleted&&l,i[c].matchUpsCount+=a.length):o.forEach((y,b)=>n[b]+=y||0)}function lLe({collectionDefinition:t,collectionPosition:e}){return(t.collectionValueProfiles||[])?.find(i=>i.collectionPosition===e)?.matchUpValue}function AR(t){let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:n,matchUpsMap:r,structure:a,matchUp:s,event:o}=t;if(!Array.isArray(e)||e.length!==2||isNaN(e.reduce((I,S)=>I+S)))return{error:Ee};if(!s)return{error:Oo};let l=Zs({matchUp:s,drawDefinition:n,structure:a,event:o})?.tieFormat||t?.tieFormat;if(!l)return{error:qU};let u=Lo({tieFormat:l});if(u.error)return u;let c=l?.collectionDefinitions||[],d=s?.tieMatchUps??[],p=[0,0],{groupValueGroups:h,groupValueNumbers:f}=Xce(l);for(let I of c)oLe({collectionDefinition:I,groupValueNumbers:f,groupValueGroups:h,sideTieValues:p,tieMatchUps:d});for(let I of f){let S=h[I],{allGroupMatchUpsCompleted:w,matchUpCount:T,winCriteria:U,groupValue:C,sideWins:E,values:P}=S,M;if(U?.aggregateValue)w&&P[0]!==P[1]&&(M=P[0]>P[1]?1:2);else if(U?.valueGoal)M=P.reduce((R,N,A)=>N>=U.valueGoal?A+1:R,void 0);else{let R=Math.floor(T/2)+1;M=E.reduce((N,A,_)=>A>=R?_+1:N,void 0)}M&&(p[M-1]+=C||0)}let m=p.map((I,S)=>(I||0)+e[S]),g={side1Score:m[0],side2Score:m[1],winningSide:void 0},v=m.join(i),y=m.slice().reverse().join(i),b;if(l?.winCriteria){let{valueGoal:I,aggregateValue:S,tallyDirectives:w}=l.winCriteria;if(I?b=m.map((T,U)=>({sideNumber:U+1,points:T})).find(({points:T})=>T>=I)?.sideNumber:S&&d.every(T=>T.matchUpStatus&&Yr.includes(T.matchUpStatus)||T.winningSide)&&m[0]!==m[1]&&(b=m[0]>m[1]?1:2),!b&&w){let T=s.matchUpId,U=s.hasContext?s:r?.drawMatchUps?.[T]||n&&Qn({inContext:!0,drawDefinition:n,matchUpId:T})?.matchUp;if(U){let{completedTieMatchUps:C,order:E}=pD({matchUps:[U]});if(C&&E?.length){let P=E[0].participantId;b=U.sides.find(({participantId:M})=>M===P)?.sideNumber}}}}return b&&(g.winningSide=b),{scoreStringSide1:v,scoreStringSide2:y,winningSide:b,set:g}}function _R({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:n,eventId:r}){if(n){t||(t=Qn({matchUpId:n.matchUpId,inContext:!0,drawDefinition:e})?.matchUp);let{extension:a}=_i({element:e,name:fm}),s=Ct(a?.value||{},!1,!0),o=({displaySideNumber:l,drawPosition:u,sideNumber:c})=>({drawPosition:u,sideNumber:c,displaySideNumber:l});n.sides=t?.sides?.map(l=>{let u=l.participantId,c=u&&s[u]||void 0,{lineUp:d,...p}=n.sides?.find(({sideNumber:f})=>f===l.sideNumber)??{},h=d?.length?d:c;return{...o(l),...p,lineUp:h}}),Zi({context:"ensureSidLineUps",matchUp:n,drawDefinition:e,tournamentId:i,eventId:r})}}function hs(t){if(t)return Ct(t,!1,!0)}function XW(t){let e=zt(t,[{[js]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,n)=>{i.tournamentIdMap[n]=[];let r=t.tournamentRecords[n].events??[],a=r.map(({eventId:o})=>o),s=r.map(o=>(o.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[n].push(...a,...s),i.eventIds.push(...a),i.drawIds.push(...s),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function Jce({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:n}=XW({tournamentRecords:t});return(n?Object.keys(n):[]).find(r=>e&&n?.[r].includes(e)||i&&n?.[r].includes(i))}function qm(t){let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:n,removeScore:r,matchUpsMap:a,matchUpId:s,event:o}=t,l=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord?.tournamentId]:t.tournamentRecord}||{},u=t.tournamentId||t.tournamentRecord?.tournamentId;l&&Jce({tournamentRecords:l,...t});let c=u&&l[u];if(!c)return{error:ot};let d=Qn({drawDefinition:i,event:o,matchUpId:s});if(d.error)return d;if(!d.matchUp)return{error:Vs};let{matchUp:p,structure:h}=d;if(!p.tieMatchUps)return{error:rl};_R({tournamentId:c?.tournamentId,eventId:o?.eventId,dualMatchUp:p,drawDefinition:i});let{extension:f}=_i({name:cw,element:p});if(f?.value)if(r)lo({element:p,name:cw});else return{...le,score:p.score};let m=Zs({drawDefinition:i,structure:h,matchUp:p,event:o})?.tieFormat;p.tieFormat=hs(m);let g=AR({drawDefinition:i,matchUpsMap:a,structure:h,matchUp:p,event:o}),{winningSide:v,set:y,scoreStringSide1:b,scoreStringSide2:I}=g,S=y?.side1Score||y?.side2Score;if(e&&!p.score&&!S)return{...le};let w={scoreStringSide1:b,scoreStringSide2:I,sets:y?[y]:[]},T=v&&[1,2].includes(v),U=T&&Ur||gW({matchUpStatus:n??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:w})&&hd||Er,C=!!(p.winningSide&&!T),E=p.tieMatchUps.find(({score:M,winningSide:R,matchUpStatus:N})=>M?.sets?.length&&(M.sets[0].side1Score||M.sets[0].side2Score)||N&&Yr.includes(N)||R),P;if(p.tieFormat&&!T&&!E){let M=Zs({drawDefinition:i,structure:h,event:o})?.tieFormat;M&&JSON.stringify(m)===JSON.stringify(M)&&(p.tieFormatId=void 0,p.tieFormat=void 0,P=!0)}return Pp({appliedPolicies:t.appliedPolicies,matchUpStatus:U,score:w,removeWinningSide:C,tournamentRecord:c,drawDefinition:i,removeScore:r,winningSide:v,matchUpId:s,matchUp:p,event:o}),{...le,score:w,removeWinningSide:C,tieFormatRemoved:P,winningSide:v}}function uLe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:n,winningDrawPosition:r,tournamentRecord:a,winnerTargetLink:s,sourceMatchUpId:o,drawDefinition:l,winnerMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}){let h="directWinner";if(s){let f=u.drawPositions||[],m=f[t],g=s.source.structureId,v=li({structureId:g,drawDefinition:l});if(v.error)return v;let{structure:y}=v,{positionAssignments:b}=ua({structureId:g,drawDefinition:l}),I=b?.find(E=>E.drawPosition===r)?.participantId,S=s.target.structureId,{positionAssignments:w}=ua({structureId:S,drawDefinition:l}),T=w?.find(E=>E.participantId===I)?.drawPosition,U=w?.filter(E=>{let P=f.includes(E.drawPosition),M=!E.participantId&&!E.bye&&!E.qualifier;return P&&M}).map(E=>E.drawPosition),C=U?.includes(m);if(I&&s.target.roundNumber===1&&C)Bp({drawPosition:m,participantId:I,structureId:S,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(I&&U?.length){let E=U.pop();E&&Bp({participantId:I,structureId:S,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,drawPosition:E,matchUpsMap:d,event:p})}else if(T){let E=OI({drawPosition:T,matchUpId:u.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(E.error)return ce({result:E,stack:h})}else if(y?.stage!==qt){let E="winner target position unavaiallble";console.log(E),ce({stack:h,result:{error:E}})}if(y?.seedAssignments&&y.structureId!==S){let E=y.seedAssignments.find(({participantId:M})=>M===I),P=E?.participantId;E&&P&&uD({eventId:u?.eventId,structureId:S,...E,tournamentRecord:a,drawDefinition:l,participantId:P})}}else{let f=OI({matchUpId:u.matchUpId,drawPosition:r,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(f.error)return f}if(c&&i){let f=c.sides?.find(m=>m.sideNumber===i);if(f?.lineUp){let m=c.roundPosition,g=u.roundPosition,v=m===g&&m!==1||Math.floor(m/2)===g?2:1,y=d?.drawMatchUps?.find(({matchUpId:S})=>S===u.matchUpId),b=[1,2].map(S=>({...y.sides?.find(w=>w.sideNumber===S)||{},sideNumber:S}));y.sides=b;let I=y.sides.find(S=>S.sideNumber===v);if(I){let S=f.lineUp?.filter(w=>w?.participantId);I.lineUp=NW({lineUp:S}),Zi({tournamentId:a?.tournamentId,eventId:u?.eventId,matchUp:y,context:h,drawDefinition:l})}}}return{...le}}function cLe(t){let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:n,propagateExitStatus:r,sourceMatchUpStatus:a,loserDrawPosition:s,tournamentRecord:o,loserTargetLink:l,drawDefinition:u,loserMatchUp:c,dualMatchUp:d,matchUpsMap:p,event:h}=t,f="directLoser",m=l.linkCondition,g=c.drawPositions||[],v=m===Fp&&c.roundNumber===2&&Math.min(...g.filter(Boolean)),y=v||g[e],b=v||g[1-e],I=l.source.structureId,{structure:S}=li({structureId:I,drawDefinition:u}),{matchUps:w}=cn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:u,structure:S,event:h}),T=w.filter(W=>W.drawPositions?.includes(s)).filter(W=>{let q=W.sides.find(K=>K.drawPosition===s),Z=W.matchUpStatus===ir||W.matchUpStatus===On&&!ca(W);return q?.sideNumber===W.winningSide&&!Z}),U=m===Fp&&T.length===0,{positionAssignments:C}=ua({structureId:I,drawDefinition:u}),E=C?.find(W=>W.drawPosition===s)?.participantId,P={loserParticipantId:E},M=l.target.structureId,{positionAssignments:R}=ua({structureId:M,drawDefinition:u}),N=R?.filter(({drawPosition:W})=>g.includes(W)),A=N?.some(W=>W.participantId&&E&&W.participantId===E),_=r&&[_a,ir,On].includes(a||"");if(A)return{...le,stack:f};let x=N?.filter(W=>{let q=g.includes(W.drawPosition),Z=!W.participantId&&!W.bye&&!W.qualifier;return q&&Z}).map(W=>W.drawPosition),O=x?.includes(y),$=l.target.roundNumber>1&&x?.length,F=l.target.roundNumber===1&&O;if(v){let W=j();if(W.context&&Object.assign(P,W.context),W.error)return ce({result:W,stack:f})}else if(F){let W=G();if(W.context&&Object.assign(P,W.context),W.error)return ce({result:W,stack:f})}else if(E&&$){x.sort(ia);let W=x[0],q=Bp({participantId:E,structureId:M,drawPosition:W,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:u,matchUpsMap:p,event:h});if(q.error)return ce({result:q,stack:f});if(!q.error&&_&&r)return{stack:f,context:{progressExitStatus:!0,loserParticipantId:E}}}else return ce({context:{loserDrawPosition:s,loserTargetLink:l,targetDrawPositionIsUnfilled:O},result:{error:O?GU:oAe},stack:f});if(S?.seedAssignments&&S.structureId!==M){let W=S.seedAssignments.find(({participantId:Z})=>Z===E),q=W?.participantId;W&&q&&uD({eventId:c?.eventId,structureId:M,...W,tournamentRecord:o,drawDefinition:u,participantId:q})}if(d&&n){let W=d.sides?.find(q=>q.sideNumber===3-n);if(W?.lineUp){let{roundNumber:q,eventId:Z}=c,{roundPosition:K}=d,Q=q===1?2-K%2:1,J=p?.drawMatchUps?.find(({matchUpId:oe})=>oe===c.matchUpId),ne=[1,2].map(oe=>({...J.sides?.find(de=>de.sideNumber===oe)||{},sideNumber:oe}));J.sides=ne;let re=J.sides.find(oe=>oe.sideNumber===Q);re&&(re.lineUp=NW({lineUp:W.lineUp}),Zi({tournamentId:o?.tournamentId,matchUp:J,context:f,drawDefinition:u,eventId:Z}))}}return ce({result:{...le},stack:f,context:P});function j(){let W="loserLinkFedFMLC";return ce(U?{result:G(),stack:W}:{result:H(),stack:W})}function H(){let W=Su({drawPosition:b,structureId:M,tournamentRecord:o,drawDefinition:u,event:h});return ce({result:W,stack:"assignLoserPositionBye"})}function G(){let W=E?Bp({drawPosition:y,participantId:E,structureId:M,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:u,matchUpsMap:p,event:h}):{error:la};return!W.error&&_&&r?{stack:f,context:{progressExitStatus:!0}}:ce({result:W,stack:"assignLoserDrawPosition"})}}function Qce(t){let e="directParticipants",i=ZW(t);if(i.error)return ce({result:i,stack:e});let n=yR({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:r,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,matchUpStatusCodes:l,tournamentRecord:u,drawDefinition:c,matchUpStatus:d,dualMatchUp:p,matchUpsMap:h,winningSide:f,targetData:m,matchUpId:g,structure:v,matchUp:y,event:b}=t,I=!!y.collectionId,S=Fo({structure:v}),w=y.drawPositions,T;if(I){let{matchUpTieId:U,matchUpsMap:C}=t,E=qm({appliedPolicies:t.appliedPolicies,matchUpId:U,tournamentRecord:u,drawDefinition:c,matchUpsMap:C,event:b});if(T=E&&{tieMatchUpResult:E},w=a.find(({matchUpId:P})=>P===U)?.drawPositions,!r)return ce({result:{...le,...T},stack:e})}if(S)return ce({result:{...le,...T},stack:e});if(w){let U=s?s-1:f-1,C=1-U,E=w[U],P=w[C],M={},{targetLinks:{loserTargetLink:R,winnerTargetLink:N,byeTargetLink:A},targetMatchUps:{winnerMatchUpDrawPositionIndex:_,loserMatchUpDrawPositionIndex:x,winnerMatchUp:O,loserMatchUp:$,byeMatchUp:F}}=m;if(O){let j=uLe({sourceMatchUpStatus:n&&d||Ur,winnerMatchUpDrawPositionIndex:_,sourceMatchUpId:g,inContextDrawMatchUps:a,projectedWinningSide:s,winningDrawPosition:E,tournamentRecord:u,winnerTargetLink:N,drawDefinition:c,winnerMatchUp:O,dualMatchUp:p,matchUpsMap:h,event:b});if(j.error)return ce({result:j,stack:e})}if($){let j=cLe({sourceMatchUpStatus:n&&d||Ur,loserMatchUpDrawPositionIndex:x,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,loserDrawPosition:P,tournamentRecord:u,loserTargetLink:R,drawDefinition:c,loserMatchUp:$,matchUpsMap:h,dualMatchUp:p,event:b});if(j.context?.progressExitStatus&&Object.assign(M,j.context,{sourceMatchUpStatus:n&&d||Ur,sourceMatchUpStatusCodes:l||[],loserMatchUp:$,matchUpsMap:h}),j.error)return ce({result:j,stack:e})}if(F){let j=F.drawPositions||[],H=Math.min(...j.filter(Boolean)),G=A.target.structureId,W=Su({drawPosition:H,structureId:G,tournamentRecord:u,drawDefinition:c,event:b});if(W.error)return ce({result:W,stack:e})}return ce({result:{...le,...T},stack:e,context:M})}else return ce({result:{error:$1},stack:e})}function JW(t){let e="genPlayoffStructure";if(!t.drawDefinition)return ce({result:{error:Ot},stack:e});let i=MR(t);if(i.error)return ce({result:i,stack:e});let{structureId:n,addNameBaseToAttributeName:r,playoffStructureNameBase:a,finishingPositionNaming:s,finishingPositionLimit:o,playoffAttributes:l,playoffPositions:u,roundOffsetLimit:c,tournamentRecord:d,exitProfileLimit:p,roundProfiles:h,roundNumbers:f,idPrefix:m,isMock:g,event:v,uuids:y}=t,b=Ct(t.drawDefinition,!1,!0),{structure:I}=li({structureId:n,drawDefinition:b});if(!I)return ce({result:{error:or},stack:e});if(I.structureType===To||I.structures)return zOe({sourceStructureId:I.structureId,...t,...i,drawDefinition:b});let{playoffRoundsRanges:S,playoffRounds:w}=i,{playoffPositionsReturned:T,error:U,playoffSourceRounds:C,playoffRoundsRanges:E}=xce(t);if(U)return ce({result:{error:U},stack:e});let P=h?.length&&Object.assign({},...h),M=f||typeof h=="object"&&h.map(K=>Object.keys(K)).flat(),R=Array.isArray(M)&&M.map(K=>!isNaN(K)&&ri(K)).filter(Boolean);if(R){if(!Array.isArray(R))return ce({result:{error:Ee},context:{validRoundNumbers:R},stack:e});R.forEach(K=>{if(!w?.includes(K))return ce({result:{error:Ee},context:{roundNumber:K},stack:e})})}u&&u.forEach(K=>{if(!T?.includes(K))return ce({result:{error:Ee},context:{playoffPosition:K},stack:e})});let N=R||C,A=R?S:E,_=[],x=[];for(let K of N??[]){let Q=A?.find(ye=>ye.roundNumber===K);if(!Q)return ce({result:{error:Ee},context:{roundNumber:K},stack:e});let J=Q.finishingPositions.length,ne=Math.min(...Q.finishingPositions)-1,re=2,oe=K&&P?.[K]&&re+P[K]-1,de=hT({exitProfile:`0-${K}`,addNameBaseToAttributeName:r,playoffStructureNameBase:a,finishingPositionOffset:ne,playoffAttributes:l,exitProfileLimit:p,stage:Sr,roundOffset:0,drawDefinition:b,sequenceLimit:oe,stageSequence:re,drawSize:J,idPrefix:m,isMock:g,uuids:y,finishingPositionNaming:s,finishingPositionLimit:o,roundOffsetLimit:c});if(de.error)return ce({result:de,stack:e});let{structures:se,links:ge}=de;if(se?.length&&_.push(...se),ge?.length&&x.push(...ge),de.structureId&&K){let ye={linkType:Yh,source:{structureId:n,roundNumber:K},target:{structureId:de.structureId,feedProfile:kc,roundNumber:1}};x.push(ye)}}if(!_.length)return ce({result:{error:Ee},info:"No structures generated",stack:e});b.structures.push(..._),b.links.push(...x);let{matchUps:O,matchUpsMap:$}=Kr({inContext:!0,drawDefinition:b}),F=_.map(({structureId:K})=>K),j=O?.filter(({structureId:K})=>F.includes(K)).map(Ma),H=$?.drawMatchUps?.filter(({matchUpId:K})=>j?.includes(K));if(H?.length){let K=Zs({drawDefinition:b,event:v})?.tieFormat;K&&H.forEach(Q=>{let{tieMatchUps:J}=v0({matchUp:Q,tieFormat:K,isMock:g});Object.assign(Q,{tieMatchUps:J,matchUpType:Hn})})}O?.filter(K=>Py({matchUp:K})&&K.structureId===n)?.forEach(K=>{let{matchUpId:Q,score:J,winningSide:ne}=K,re=vo({inContextDrawMatchUps:O,drawDefinition:b,matchUpId:Q}),oe=Qce({inContextDrawMatchUps:O,tournamentRecord:d,drawDefinition:b,matchUpsMap:$,winningSide:ne,targetData:re,matchUpId:Q,structure:I,matchUp:K,score:J,event:v});oe.error&&console.log(oe.error)}),O?.filter(K=>K.matchUpStatus==="BYE"&&K.structureId===n)?.forEach(K=>{let{matchUpId:Q}=K,J=vo({inContextDrawMatchUps:O,drawDefinition:b,matchUpId:Q}),{targetLinks:{loserTargetLink:ne},targetMatchUps:{loserMatchUpDrawPositionIndex:re,loserMatchUp:oe}}=J;if(ne&&oe){let de=ne.target.structureId,se=oe.drawPositions[re],ge=Su({drawPosition:se,structureId:de,tournamentRecord:d,drawDefinition:b,event:v});ge.error&&console.log(ge.error)}});let G=[],W=Zy({inContextDrawMatchUps:O,drawDefinition:b,matchUpsMap:$}).goesToMap,{structure:q}=li({drawDefinition:t.drawDefinition,structureId:n}),{matchUps:Z}=cn({structure:q});return Z.forEach(K=>{let Q=W?.loserMatchUpIds[K.matchUpId];if(Q&&K.loserMatchUpId!==Q){K.loserMatchUpId=Q;let ne={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:K};G.push(ne)}let J=W?.winnerMatchUpIds[K.matchUpId];if(J&&K.winnerMatchUpId!==J){K.winnerMatchUpId=J;let ne={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:K};G.push(ne)}}),{structures:_,matchUpModifications:G,links:x,drawDefinition:b,...le}}function ede({element:t}){if(!t)return{error:Ee};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:Ee};let e=(i,n)=>(r,a)=>(a[i]&&(r[a[i]]=a[n]),r);return t.timeItems.reduce(e("itemType","itemValue"),{})}function rh(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:n,timeItem:r}=t;if(!r)return{error:Zq};let a=oue(t);if(a.error)return a;if(!(Ki(r)&&Xn(r.itemType)&&Object.keys(r).includes("itemValue")))return{error:Kq};if(!a.timeItems)a.timeItems=[];else if(dLe({element:a,duplicateValues:e,timeItem:r}))return{...le};if(r.itemSubTypes&&!r.itemSubTypes.length&&delete r.itemSubTypes,i){let s=new Date().toISOString();Object.assign(r,{createdAt:s})}return n&&(a.timeItems=a.timeItems.filter(({itemType:s})=>r.itemType!==s)),n&&!r.itemValue||a.timeItems.push(r),{...le}}function dLe({element:t,duplicateValues:e,timeItem:i}){let{itemType:n,itemSubTypes:r,itemValue:a}=i,s=n&&nc({itemSubTypes:r,itemType:n,element:t})?.timeItem;return s&&JSON.stringify(s?.itemValue)===JSON.stringify(a)&&!e}function QW({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:n,participantId:r,timeItem:a}){if(!i)return{error:ot};if(!r)return{error:la};let s=Uv({tournamentRecord:i,participantId:r});return s.error?s:rh({element:s.participant,removePriorValues:e,duplicateValues:n,creationTime:t,timeItem:a})}function kR(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:n,creationTime:r,timeItem:a}=t;if(!i)return{error:ot};let s=rh({element:i,removePriorValues:e,duplicateValues:n,creationTime:r,timeItem:a});if(s.error)return s;let o=ede({element:i});return Ti({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:o},topic:Db}),s}function y0(t){let{removePriorValues:e,duplicateValues:i,creationTime:n,timeItem:r,event:a}=t;return a?rh({removePriorValues:e,duplicateValues:i,element:a,creationTime:n,timeItem:r}):{error:Wu}}function tde(t){return GL({...t,itemType:"attachConsolationStructures"})}function e4(t){return GL({...t,itemType:"attachPlayoffStructures"})}function GL({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:n,structures:r,links:a=[],event:s}){let o="attachStructures";if(!n)return{error:Ot};if(!Array.isArray(r)||!Array.isArray(a))return ce({result:{error:Ee},stack:o});let l=g=>[g.source.structureId,g.source.roundNumber||g.source.finishingPositions?.join("|"),g.target.roundNumber].join("|"),u=n.links?.map(l);if(a.some(g=>{let v=l(g);return u?.includes(v)}))return ce({result:{error:t3},info:"playoff structure exists",stack:o});a.length&&n.links?.push(...a);let c=r.map(({structureId:g})=>g),d=n.structures?.map(({structureId:g})=>g);n.structures=(n.structures??[]).map(g=>c.includes(g.structureId)?r.find(({structureId:v})=>v===g.structureId):g);let p=r?.filter(({structureId:g})=>!d?.includes(g));p.length&&n.structures.push(...p),Zy({drawDefinition:n});let h=r.map(g=>cn({structure:g})?.matchUps||[]).flat();Yg({tournamentId:i?.tournamentId,eventId:s?.eventId,drawDefinition:n,matchUps:h});let f=r.map(({structureId:g})=>g);if(Ln({drawDefinition:n,structureIds:f}),e?.length){let g={};e.forEach(y=>{let b=y.matchUp?.matchUpId;b&&(g[b]=y)});let v=y=>{y.matchUps.forEach(b=>{if(g[b.matchUpId]){let{tieMatchUps:I,...S}=g[b.matchUpId].matchUp;if(Object.assign(b,S),I?.length){let w={};I.forEach(T=>g[T.matchUpId]=T),b.tieMatchUps.forEach(T=>Object.assign(T,w[T.matchUpId]))}g[b.matchUpId].matchUp=b,Zi(g[b.matchUpId])}})};n.structures.forEach(y=>{if(d?.includes(y.structureId))if(y.structures)for(let b of y.structures)v(b);else v(y)})}let m=p.map(kl("structureId"));if(i){let g={itemValue:{structureIds:f,drawId:n.drawId},itemType:t};rh({element:i,timeItem:g})}return{...le,addedStructureIds:m}}function HL(t){let{structures:e,links:i,matchUpModifications:n,error:r}=JW(t);if(r)return{error:r};let a=t.drawDefinition;return e4({tournamentId:t.tournamentRecord?.tournamentId,eventId:t.event?.eventId||t.eventId,matchUpModifications:n,drawDefinition:a,structures:e,links:i})}function Jy(t){let e=zt(t,[{_anyOf:{[js]:!1,[ha]:!1,[zs]:!1,[Gm]:!1},[b3]:!0}]);if(e.error)return e;let i=[],n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n){let r=kX(t,n);if(r.error)return r;i.push(...r?.applied??[]),t.drawDefinition&&Ln({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:ot};for(let a of r){let s=t.tournamentRecords[a],o=kX(t,s);if(o.error)return o;i.push(...o?.applied??[])}}else return{error:ot};return i.length?{...le,applied:i}:{error:Vq}}function kX(t,e){let i=sn(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let n=[],r=Object.keys(t.policyDefinitions);if(!r.length)return{error:FO};for(let a of r)if(!i[a]||t.allowReplacement){let s=t.policyDefinitions[a];if(!s)continue;if(!Ki(s))return{error:Ee};let{policyName:o,...l}=s;if(!l||!Object.keys(l).length||o&&!Xn(o))return{error:Ee};i[a]=t.policyDefinitions[a],n.push(a)}return n?.length?{...un({element:e,extension:{name:pC,value:i}}),applied:n}:{applied:n,error:Vq}}function t4({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:n,drawId:r,event:a}){if(!n||typeof n!="string")return ce({result:{error:Ee},context:{drawName:n}});i||(i=Cr({event:a}).flightProfile);let s=i?.flights?.find(o=>o.drawId===r);if(s){s.drawName=n;let o={name:nd,value:{...i,flights:i.flights}};Sv({event:a,extension:o})}return e&&(e.drawName=n,Ln({tournamentId:t?.tournamentId,drawDefinition:e})),!s&&!e?{error:Ot}:{...le,flight:s}}function ide({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:n,event:r}){if(!Ki(i))return{error:Ee};let a=Cr({event:r}).flightProfile,s=i.drawName&&t4({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:n,event:r});if(s?.error)return s?.error;let o=s?.flight||a?.flights?.find(l=>l.drawId===n);if(!o&&!e)return{error:Ot};if(o){let l={name:nd,value:{...a,flights:a.flights}};Sv({event:r,extension:l})}return e&&(i.policyDefinitions&&Jy({policyDefinitions:i.policyDefinitions,drawDefinition:e}),Ln({tournamentId:t?.tournamentId,drawDefinition:e})),{...le}}function nde({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){if(!i)return{error:Ot};let n=us({drawDefinition:i}),r=s=>n?.drawMatchUps?.find(o=>o.matchUpId===s);for(let s of i.structures||[]){let{positionAssignments:o,stage:l,stageSequence:u}=s;o&&(u!==1||![qt,Nt].includes(l))&&(s.positionAssignments=o.map(p=>(delete p.participantId,p)),s.seedAssignments=[]);let{matchUps:c,isRoundRobin:d}=cn({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:n,structure:s});for(let p of c){let{matchUpId:h,roundNumber:f}=p,m=p.sides||[],g=r(h);if(g){if(delete g.extensions,delete g.notes,g.matchUpStatus!=="BYE"&&Object.assign(g,jL),f&&f>1&&g.drawPositions?.length&&!d){let v=m?.map(({drawPosition:b,participantFed:I})=>!I&&b).filter(Boolean),y=g.drawPositions.map(b=>v.includes(b)?void 0:b);g.drawPositions=y}e?delete g.timeItems:g.timeItems?.length&&(g.timeItems=g.timeItems.filter(v=>v.itemType&&![Qh,Xg,a0,pW,s0,o0].includes(v.itemType))),Zi({tournamentId:t?.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:g})}}}i.extensions=i.extensions.filter(s=>s.name!==dT);let a=(i.structures||[]).map(({structureId:s})=>s);return Ln({drawDefinition:i,structureIds:a}),{...le}}function xR({tournamentRecord:t}){if(!t)return{error:ot};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return(t.events?.map(n=>{let r=n.eventId;return i[r]=n,(n?.drawDefinitions||[]).map(a=>({drawDefinition:a,eventId:r}))}).flat().filter(Boolean)).forEach(({drawDefinition:n,eventId:r})=>{let a=0,s=0,o=0,{allStructuresLinked:l}=FL({drawDefinition:n}),u=i[r],c=(n?.structures||[]).map(b=>{let{stage:I,stageSequence:S,structureId:w}=b,T=lw[I],{inContextStructureMatchUps:U}=bR({drawDefinition:n,structure:b,event:u}),C=U?.filter(({winningSide:H})=>H),E=C.filter(Boolean).length||0;s+=E,o+=U.length-s;let P=Math.max(C.filter(({roundNumber:H})=>H===1).map(({roundPosition:H})=>H)),{positionAssignments:M}=Nn({structure:b}),R=M?.filter(({participantId:H})=>H);a+=R?.length??0;let N=(M?.length??0)-(R?.length??0),{roundMatchUps:A,roundProfile:_,roundNumbers:x,maxMatchUpsCount:O}=go({matchUps:U}),$=_&&Object.keys(_).filter(H=>!_[H].inactiveRound).map(H=>parseInt(H)),F=_&&Object.keys(_).filter(H=>_[H].inactiveRound).map(H=>parseInt(H)),j=_&&Object.values(_).every(H=>H.inactiveRound);return{positionsAssignedCount:R?.length??0,maxWinningSideFirstRoundPosition:P,unassignedPositionsCount:N,inactiveStructure:j,maxMatchUpsCount:O,inactiveRounds:F,roundMatchUps:A,activeRounds:$,roundNumbers:x,roundProfile:_,structureId:w,stageSequence:S,orderNumber:T,stage:I}}),d=c.find(b=>b.orderNumber===2&&b.stageSequence===1),p=c.filter(({inactiveStructure:b})=>!b).length,{links:h}=aD({structureId:d.structureId,drawDefinition:n}),f=ri(d.activeRounds[0])===1&&d.activeRounds.length===1&&p===1,m=c?.every(({inactiveStructure:b})=>b),g=!h.length&&d.activeRounds.length&&(d.roundProfile[1].inactiveCount||d.inactiveRounds.length),v=n.drawId;a&&!s&&e.positionsNoOutcomes.push(v),m&&e.inactive.push(v),f&&e.matchPlay.push(v),g&&e.canBePruned.push(v);let y={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:o,positionsAssignedCount:a,allStructuresLinked:l,structuresData:c,inactiveDraw:m,isMatchPlay:f,drawId:v};e.drawAnalysis[v]=y}),{...le,drawsAnalysis:e}}function rde({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:n}){if(!e)return{error:ot};if(!i)return{error:Ot};let r=[],{drawsAnalysis:a}=xR({tournamentRecord:e});if(a.canBePruned.includes(n)){let s=a.matchPlay.includes(n),o=a.drawAnalysis[n],{structures:[l]}=rd({stageSequence:1,drawDefinition:i,stage:Nt}),u=o.structuresData.find(({structureId:h})=>l.structureId===h),c=(l.matchUps??[]).sort((h,f)=>h.roundPosition-f.roundPosition);r=c.filter(({roundNumber:h})=>!u.inactiveRounds.includes(h));let d=r.map(Ma),p=c.map(Ma).filter(h=>!d.includes(h));if(s){let h=r.filter(({roundNumber:y})=>!u.inactiveRounds.includes(y)).filter(({winningSide:y})=>y),f=h.map(Ma),m=d.filter(y=>!f.includes(y));p.push(...m);let g=h.flatMap(y=>y.drawPositions??[]).filter(Boolean).flat(),v=Object.assign({},...g.map((y,b)=>({[y]:b+1})));if(h.forEach(y=>{t?y.drawPositions=y.drawPositions.map(b=>v[b]):delete y.drawPositions}),t){let y=l?.positionAssignments?.filter(b=>g.includes(b.drawPosition)).map(b=>(b.drawPosition=v[b.drawPosition],b));l.positionAssignments=y}else l.positionAssignments=[];l.matchUps=h,r=h}ff({tournamentId:e?.tournamentId,matchUpIds:p,drawDefinition:i}),Ln({drawDefinition:i})}return{...le,matchUps:r}}function ade({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,qualifier:a,event:s,bye:o}){if(!e)return{error:Ot};if(!n)return{error:HU};if(!r)return{error:yu};if(o){let l=Su({tournamentRecord:t,drawDefinition:e,drawPosition:n,structureId:r,event:s});if(l.error)return l}else{if(a)return{error:WO};{let l=Bp({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,event:s});if(l.error)return l}}return{...le}}function sde(t){let e=t.matchUpIds??[],{drawDefinition:i}=t,n=t.structureId??i?.structures?.find(l=>l.matchUps?.some(({matchUpId:u})=>e.includes(u)))?.structureId??i?.structures?.[0]?.structureId;if(!n)return{error:or};let r=i.structures?.find(l=>l.structureId===n);if(!r)return{error:or};let a=r?.matchUps,s=a?.find(l=>!!l.roundPosition);if(r.structures||s||r.finishingPosition===t0)return{error:Ib};let o=a.filter(({roundNumber:l})=>t.roundNumbers?.includes(l)).map(Ma);return e=e.filter(l=>!o.includes(l)),t.roundNumbers&&!e.length&&(e=o),{existingMatchUps:a,matchUpIds:e,structureId:n,structure:r}}function ode(t){let e=zt(t,[{[zs]:!0},{[OT]:{[Q1]:!1,roundNumbers:!1},[pu]:Ee,[Go]:xs}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:n=!0,removeCompleted:r=!1,tournamentRecord:a,drawDefinition:s,event:o}=t,l=sde(t);if(l.error)return l;let{structure:u,structureId:c,existingMatchUps:d,matchUpIds:p}=l,h=[],f=d?.filter(({matchUpId:v,score:y,winningSide:b})=>{if(b&&!r)return!1;if(b||ca({score:y})){if(!b&&!i)return!1;h.push(v)}else if(!n)return!1;return p?.includes(v)})??[],m=f.map(Ma),g=f.map(({tieMatchUps:v})=>v?.map(Ma)).filter(Boolean).flat();if(m.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:b})=>!m.includes(b)),ff({tournamentId:a?.tournamentId,matchUpIds:[...g,...m],action:"deleteAdHocMatchUps",eventId:o?.eventId,drawDefinition:s});let v=wi(u.matchUps.map(kl("roundNumber"))),y=iAe(v);if(y.length){y.reverse();for(let b of y)u.matchUps.forEach(I=>{I.roundNumber&&I.roundNumber>b&&(I.roundNumber-=1,Zi({tournamentId:a?.tournamentId,context:["adHoc round deletion"],eventId:o?.eventId,drawDefinition:s,matchUp:I}))})}if(h.length){u.positionAssignments=wi(u.matchUps.flatMap(T=>(T.sides??[]).map(U=>U.participantId)).filter(Boolean)).map(T=>({participantId:T}));let b=u?.matchUpFormat??s?.matchUpFormat??o?.matchUpFormat,I=l.existingMatchUps.some(T=>T.matchUpType===uu)?{matchUpTypes:[uu]}:void 0,{matchUps:S}=cn({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:I,structure:u,event:o});Fo({structure:u})&&(u.positionAssignments=wi(S.flatMap(T=>(T.sides??[]).map(U=>U.participantId)).filter(Boolean)).map(T=>({participantId:T})));let w=YW({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:s,matchUpFormat:b,matchUps:S,event:o});w.error&&console.log(w)}Ln({structureIds:[c],eventId:o?.eventId,drawDefinition:s})}return!m.length&&p.length?{error:z1}:{...le,deletedMatchUpsCount:[...m,...g].length}}function lde({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:n,roundNumber:r,event:a}){if(!e)return{error:ot};if(!i)return{error:Ot};if(!r)return ce({result:{error:Zt},info:"roundNumber required"});let s=li({drawDefinition:i,structureId:n});if(s.error)return s;let o=s.structure;return o?.structures?{error:Ib}:Fo({structure:o})?pLe({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:r,structure:o}):(console.log("not implemented"),{...le})}function pLe({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:n,structure:r,eventId:a}){let s=r?.matchUps??[],o=[],l=[],u=!1;if(s.reduce((c,d)=>{let p=d?.roundNumber;return p?c.includes(p)?c:c.concat(p):c},[]).sort(ia).includes(n)){let c=s.filter(d=>{let p=d.roundNumber===n&&(!Yr.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&o.push(...d.tieMatchUps.map(Ma))),!p});l.length&&(ff({matchUpIds:[...o,...l],drawDefinition:e,tournamentId:i,eventId:a}),c.some(d=>d.roundNumber===n)||(c.forEach(d=>{d.roundNumber>n&&(d.roundNumber-=1,Zi({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),u=!0),r.matchUps=c)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...le}}function zL(t){let{suppressNotifications:e,tournamentRecord:i,drawDefinition:n,matchUps:r,event:a}=t;if(typeof n!="object")return{error:Ot};let s=t?.structureId;if(!s&&n.structures?.length===1&&(s=n.structures?.[0]?.structureId),typeof s!="string")return{error:yu};if(!ac(r))return{error:Ee,info:Xy("matchUps")};let o=n.structures?.find(p=>p.structureId===s);if(!o)return{error:or};let l=(o?.matchUps).find(p=>!!p.roundPosition);if(o.structures||l||o.finishingPosition===t0)return{error:Ib};let u=Za({tournamentRecord:i,inContext:!1})?.matchUps?.map(Ma)??[],c=r.map(Ma);if(mo(u,c))return{error:foe,info:"One or more matchUpIds already present in tournamentRecord"};o.matchUps.push(...r);let d=r.map(({tieMatchUps:p})=>p).filter(Boolean).flat();return e||(Yg({tournamentId:i?.tournamentId,matchUps:[...d,...r],eventId:a?.eventId,drawDefinition:n}),Ln({drawDefinition:n,structureIds:[s]})),{...le}}function ude({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:n,subOrder:r,event:a}){if(!e)return{error:Ot};if(!n)return{error:yu};if(!i)return{error:HU};let{structure:s}=li({drawDefinition:e,structureId:n});if(!s)return{error:or};let o=s;s.structures&&s.structureType===To&&(o=s.structures?.find(h=>h.positionAssignments?.find(f=>f.drawPosition===i)));let l=o?.positionAssignments,u=l?.find(h=>h.drawPosition===i);u&&un({element:u,extension:{name:FT,value:r}});let c=(a?.eventType===Hn||e.matchUpType===Hn||(a?.tieFormat??e?.tieFormat??s?.tieFormat))&&{matchUpTypes:[Hn]},{matchUps:d}=cn({structure:o,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:c,event:a}),p=s?.matchUpFormat??e.matchUpFormat;return YW({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),Ln({drawDefinition:e,structureIds:[n]}),{...le}}var cde={};Fi(cde,{addGoesTo:()=>Zy,allPlayoffPositionsFilled:()=>xW,checkValidEntries:()=>YL,findDrawDefinition:()=>a4,getAssignedParticipantIds:()=>Ab,getAvailableMatchUpsCount:()=>qL,getAvailablePlayoffProfiles:()=>MR,getDrawDefinitionTimeItem:()=>nW,getDrawParticipantRepresentativeIds:()=>n4,getDrawStructures:()=>rd,getDrawTypeCoercion:()=>OR,getEligibleVoluntaryConsolationParticipants:()=>i4,getMatchUpsMap:()=>us,getParticipantIdFinishingPositions:()=>r4,getPositionAssignments:()=>wC,getPositionsPlayedOff:()=>dD,getRandomQualifierList:()=>u4,getSeedingThresholds:()=>RW,getSeedsCount:()=>LR,getStructureSeedAssignments:()=>Zu,getTeamLineUp:()=>Ky,getValidGroupSizes:()=>DR,isAdHoc:()=>Fo,isCompletedStructure:()=>ef,isValidForQualifying:()=>c4,positionActions:()=>l4});function i4({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:n,policyDefinitions:r,roundNumberLimit:a,tournamentRecord:s,drawDefinition:o,matchUpsLimit:l,requirePlay:u,requireLoss:c,allEntries:d,winsLimit:p,event:h}){if(!o)return{error:Ot};let f=[Nt,Sr];i&&f.push(qt);let m=h?.eventType?{matchUpTypes:[h.eventType]}:void 0,g=o?.matchUpType?{matchUpTypes:[o.matchUpType]}:void 0,v=e&&h?gf({contextFilters:{stages:f},matchUpFilters:m,tournamentRecord:s,inContext:!0,event:h})?.matchUps??[]:uo({contextFilters:{stages:f},matchUpFilters:g,tournamentRecord:s,inContext:!0,drawDefinition:o})?.matchUps??[],y=r0({stage:Ga,drawDefinition:o}).map(({participantId:x})=>x),b={},I={},S={},w={};r||(r=Hm({policyTypes:[wG],tournamentRecord:s,drawDefinition:o,event:h}).policyDefinitions);let T=r?.[wG];t=t.length&&t||T?.excludedMatchUpStatuses||[],e=e??T?.includeEventParticipants,d=d??T?.allEntries,n=n??T?.finishingRoundLimit,a=a??T?.roundNumberLimit,l=l??T?.matchUpsLimit,u===void 0&&(u=T?.requirePlay!==void 0?T.requirePlay:!0),c===void 0&&(c=T?.requireLoss!==void 0?T.requireLoss:!0),p=p??T?.winsLimit;for(let x of v){if(u&&x.winningSide&&![1,2].includes(x.winningSide)&&x.matchUpStatus!==cr||x.finishingRound&&n&&x.finishingRound>=n||x.finishingRound&&a&&x.finishingRound<=a)continue;let O=x.sides?.find(({sideNumber:F})=>x.winningSide&&F===3-x.winningSide),$=x.sides?.find(({sideNumber:F})=>x.winningSide&&F===x.winningSide);if(x.sides?.forEach(F=>{let j=F?.participant?.participantId;j&&(S[j]=F.participant,x.matchUpStatus===cr&&!u&&(I[j]=F.participant,b[j]||(b[j]=0),(!x.matchUpStatus||!t.includes(x.matchUpStatus))&&(b[j]+=1)))}),O?.participant){let F=O.participant.participantId;I[F]=O.participant,b[F]||(b[F]=0),x.matchUpStatus&&!t.includes(x.matchUpStatus)&&(b[F]+=1)}if($?.participant){let F=$.participant.participantId;w[F]||(w[F]=0),w[F]+=1,b[F]||(b[F]=0),x.matchUpStatus&&!t.includes(x.matchUpStatus)&&(b[F]+=1)}}let U=s?.participants&&!u&&!c&&d,C=U?((e&&h?h.entries:o.entries)??[]).filter(x=>![Jh,rc].includes(x.entryStatus)).map(({participantId:x})=>x):[],E=Object.keys(I),P=U?(s?.participants??[]).filter(({participantId:x})=>C.includes(x)):c&&Object.values(I)||Object.values(S),M=x=>!c||E.includes(x),R=x=>!u||(b[x]||0)>=0,N=x=>!p||(w[x]||0)<=p,A=x=>!l||b[x]<=l,_=x=>!y.includes(x);return{eligibleParticipants:P.filter(x=>M(x.participantId)&&R(x.participantId)&&N(x.participantId)&&A(x.participantId)&&_(x.participantId)).map(x=>({...x,individualParticipants:x.individualParticipantIds?.map(O=>s?.participants?.find($=>$.participantId===O))})),losingParticipantIds:E,...le}}function qL(t){let e=zt(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:n}=t,r=t.structureId??(i.structures?.length===1&&i.structures?.[0]?.structureId);if(typeof r!="string")return{error:yu};let a=i.structures?.find(f=>f.structureId===r);if(!a)return{error:or};let s,o=(a.matchUps??[])?.reduce((f,m)=>(m.roundPosition&&(s=!0),(m?.roundNumber||0)>f?m.roundNumber:f),0);if(a.structures||s||a.finishingPosition===t0)return{error:Ib};let l=i?.entries?.filter(f=>{let m=f.entryStatus;return fd.includes(m)})??[],u=Math.floor(l?.length/2)||1,c=n??o??1,d=a.matchUps?.filter(f=>f.roundNumber===c)?.length??0,p=u-d,h=p>0?p:0;return{...le,availableMatchUpsCount:h,lastRoundNumber:o,roundMatchUpsCount:u}}function n4({drawDefinition:t}){let e=_i({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:e.extension?.value||[]}}function hLe({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:Ot};let n=Kr({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),r=Ct(n.matchUps,!1,!0),a=wi(r.reduce((o,l)=>o.concat(...l.sides.map(u=>u.participantId).filter(Boolean)),[])),s=Object.assign({},...a.map(o=>{let l=r.filter(u=>u.sides.map(c=>c.participantId).filter(Boolean).includes(o));return{[o]:l}}));return{participantIds:a,participantIdMatchUps:s}}function r4({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:Ot};let{participantIds:n,participantIdMatchUps:r}=hLe({tournamentParticipants:e?.participants,drawDefinition:i}),a=n?.map(s=>{let o=r[s].filter(d=>[Ur,"BYE"].includes(d.matchUpStatus)||d.winningSide),l=o.map(d=>{let p=d.sides.find(f=>f.bye),h=d.sides.find(f=>f.participantId===s).sideNumber;return(d.winningSide||t&&p&&h)===h?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),u=d=>Math.abs(d[0]-d[1]),c=l.reduce((d,p)=>d&&u(d)<u(p)?d:p,void 0);return{[s]:{relevantMatchUps:o,finishingPositionRanges:l,finishingPositionRange:c}}})||[];return Object.assign({},...a)}function Cv({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:n}){if(!e&&!t)return{error:ot};if(!n)return{error:Zd};if(!e&&t){if(typeof i!="string"&&(i=Jce({tournamentRecords:t,drawId:n}),!i))return{error:ET};if(e=t[i],!e)return{error:ot}}let r=e&&$o({tournamentRecord:e,drawId:n});return r?.drawDefinition?{drawDefinition:r.drawDefinition,event:r.event,tournamentRecord:e,...le}:ce({result:{error:cu},stack:"findDrawDefinition"})}function a4(t){let{drawDefinition:e,error:i}=Cv(t);return i?{error:i}:{drawDefinition:Ct(e)}}function fLe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:n,drawId:r,event:a}){let s=a?.entries?.filter(({entryStatus:o})=>[rc,Rb].includes(o)).map(({participantId:o})=>o)||[];if(s.length){let o=n.individualParticipantIds,l=e?t.filter(({participantId:c})=>s.includes(c)):void 0,u=e?t.filter(({participantId:c})=>o.includes(c)):void 0;return{validModifyAssignedPairAction:Vt({payload:{participantId:n.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:r},method:POe,availableIndividualParticipantIds:s,availableIndividualParticipants:l,existingIndividualParticipantIds:o,existingIndividualParticipants:u,type:$W},!1,!1,!0)}}return{}}function Qy(t){let{inContextDrawMatchUps:e,targetData:i,drawDefinition:n,relevantLink:r}=t;if(r?.linkCondition===Fp&&i?.matchUp?.matchUpStatus==="BYE")return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:s},targetLinks:o}=i,l=a&&vo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),u=l?.targetMatchUps?.loserMatchUp,c=l?.targetMatchUps?.loserMatchUpDrawPositionIndex,d=u?.sides[c]?.participant,p=$s(a?.matchUpStatus),h=p&&!d,f=a?.sides?.reduce((b,I)=>I?.participant?++b:b,0)??0,m=a?.winningSide&&p&&f===1,g=s?.drawPositions?.filter(Boolean).length||0;if(!m&&(a?.winningSide&&!h||s?.winningSide&&g===2&&(!s.feedRound||!$s(s?.matchUpStatus))))return!0;let v=s&&vo({matchUpId:s.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),y=l&&Qy({relevantLink:o?.loserTargetLink,targetData:l,inContextDrawMatchUps:e,drawDefinition:n});return!!(v&&Qy({targetData:v,inContextDrawMatchUps:e,drawDefinition:n})||y)}var dde={[Xh]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[qt,Nt],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[IC,fw,$L,LI],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},p_="positionAction",OG="matchUpAction";function pde({actionType:t=p_,appliedPolicies:e,drawDefinition:i,structure:n}){let r=t===p_&&Xh||t===OG&&Ha,a=t===p_&&dde||t===OG&&Gue,s=r&&(e?.[r]||a?.[r]),o=i.links?.filter(d=>d?.target?.structureId===n?.structureId)?.map(({target:d})=>d.feedProfile)??[],{enabledStructures:l,disabledStructures:u}=s||{},c=u?.find(d=>{let{stages:p,stageSequences:h,structureTypes:f,feedProfiles:m}=d;return(!m?.length||Array.isArray(m)&&m.some(g=>o.includes(g)))&&(!p?.length||Array.isArray(p)&&p?.includes(n?.stage))&&(!f?.length||Array.isArray(f)&&f?.includes(n?.structureType))&&(!h?.length||Array.isArray(h)&&h.includes(n?.stageSequence))});return{enabledStructures:l,actionsDisabled:c,actionsPolicy:s}}function xX({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function hde({enabledStructures:t,drawDefinition:e,structure:i}){if(t===!1)return{};if(!t?.length)return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:n,stageSequence:r,structureType:a}=i||{},s=e.links?.filter(o=>o?.target?.structureId===i?.structureId)?.map(({target:o})=>o.feedProfile)||[];return{policyActions:t.find(o=>{let{stages:l,stageSequences:u,structureTypes:c,feedProfiles:d}=o||{},p=!l?.length||Array.isArray(l)&&l.includes(n),h=!u?.length||Array.isArray(u)&&u.includes(r),f=!c?.length||Array.isArray(c)&&c.includes(a),m=!d?.length||Array.isArray(d)&&d.some(g=>s.includes(g));return h&&f&&m&&o&&p})}}function Xo({action:t,policyActions:e}){let i=!e?.enabledActions||e?.disabledActions?.length&&e.disabledActions.includes(t);return i?!1:(e?.enabledActions.length===0||e?.enabledActions.includes(t))&&!i}var fde="replaceTieMatchUpParticipantId",mde="assignTieMatchUpParticipantId",LG="removeTieMatchUpParticipantId",OX="assignMatchUpSideParticipant",mLe="removeMatchUpSideParticipant",gde="substituteParticipant",FG="REMOVE_SUBSTITUTION",vde="REPLACE_PARTICIPANT",s4="REMOVE_PARTICIPANT",$G="setMatchUpStatus",BG="SUBSTITUTION",yde="SCHEDULE",gLe="PENALTY",VG="REFEREE",bde="STATUS",jG="START",Ide="SCORE",o4={REPLACE_TEAM_POSITION_METHOD:fde,ASSIGN_TEAM_POSITION_METHOD:mde,REMOVE_TEAM_POSITION_METHOD:LG,REPLACE_PARTICIPANT:vde,SUBSTITUTION_METHOD:gde,REMOVE_SUBSTITUTION:FG,REMOVE_PARTICIPANT:s4,SCHEDULE_METHOD:$G,SUBSTITUTION:BG,SCHEDULE:yde,PENALTY:gLe,REFEREE:VG,STATUS:bde,SCORE:Ide,START:jG,END:"END"};function vLe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:n,inContextMatchUp:r,policyActions:a,enforceGender:s,participantId:o,sideNumber:l,matchUpId:u,matchUp:c,drawId:d,side:p}){let h=[],f=r.sides?.find(N=>N.participant),m=su(r.gender)&&r.sideNumber&&r.sides?.filter(N=>N.particiapntId).length===1&&f?.participant?.person?.sex,g=r.matchUpType,v=(s??n?.participants?.enforceGender)!==!1?r.gender:void 0,y=r.sides?.flatMap(N=>N.participant?.individualParticipants||N.participant).filter(Boolean)?.map(Vi),b=r.sides?.filter(N=>!l||N.sideNumber===l).flatMap(N=>N.participant?.individualParticipants||N.participant).filter(Boolean),I=b?.map(Vi),S=e?.find(N=>N.matchUpId===r.matchUpTieId)?.sides?.map(N=>N?.participant?.individualParticipants?.filter(({participantId:A,person:_})=>!I?.includes(A)&&(!v||Mh(v)||_.sex===v||su(v)&&!m||m&&_.sex!==m))),w=l?S?.[l-1]:S?.map((N,A)=>({participants:N,sideNumber:A+1})),T=l?S?.[l-1]?.map(Vi):S?.map((N,A)=>({participants:N?.map(Vi),sideNumber:A+1})),U=l&&(_r(AI)(g)&&!I?.length||_r(jy)(g)&&(I?.length??0)<2)||!l&&(_r(AI)(g)&&(I?.length??0)<2||_r(jy)(g)&&(I?.length??0)<4),C=T?.filter(N=>!y?.includes(N)),E=w?.filter(({participantId:N})=>C.includes(N));if(U&&C?.length&&h.push({availableParticipantIds:C,method:mde,availableParticipants:E,type:hw,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:d}}),I?.length&&(!ca(c)||p?.substitutions?.length)&&h.push({method:LG,type:s4,existingParticipantIds:I,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),E?.length&&(!l&&I?.length||l&&p?.participant)&&h.push({availableParticipantIds:C,method:fde,availableParticipants:E,type:vde,existingParticipantIds:I,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),Xo({policyActions:a,action:FG})&&p?.substitutions?.length){let N=p.participant?.participantType===ji&&[p.participantId]||p.participant?.participantType===Ni&&p.participant.individualParticipantIds||[],A=p.substitutions.map(_=>_.participantId).filter(_=>N.includes(_));(!o||A.includes(o))&&h.push({method:LG,type:FG,substitutedParticipantIds:A,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let P=t?.[Ha],M=P?.substituteWithoutScore,R=P?.substituteAfterCompleted;if(Xo({policyActions:a,action:BG})&&i.length===2&&(!l&&I?.length||l&&p?.participant)&&(M||ca(c))&&(R||c.matchUpStatus&&!Yr.includes(c.matchUpStatus))&&b?.length&&w.length){let N=b.map(Vi);h.push({info:"list of team players available for substitution",method:gde,availableParticipantIds:T,existingParticipantIds:N,availableParticipants:w,existingParticipants:b,type:BG,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:d}})}return h}function yLe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:n,returnParticipants:r,appliedPolicies:a,drawDefinition:s,drawPosition:o,validActions:l,structureId:u,structure:c,drawId:d,event:p}){if(i.includes(o))return{};let h=l.find(T=>T.type===hw)?.availableParticipantIds,f=a?.[Xh]?.otherFlightEntries,m=a?.[Xh]?.restrictQualifyingAlternates,g=(s.entries??[]).filter(({entryStage:T})=>!m||(c.stage===qt?T===qt:T!==qt)).sort((T,U)=>(T.entryPosition??1/0)-(U.entryPosition??1/0)).map(({participantId:T})=>T).filter(Boolean),{allPositionedParticipantIds:v}=Wle({drawDefinition:s}),y=n.map(T=>T.participantId).filter(Boolean),b=g.filter(T=>c.stage&&[qt,Nt,Sr].includes(c.stage)?!v?.includes(T):!y.includes(T)),I=(p?.entries??[]).filter(T=>T.entryStatus===Hc&&wde({restrictQualifyingAlternates:m,structure:c,entry:T})&&(c.stage&&[qt,Nt,Sr].includes(c.stage)?!v?.includes(T.participantId):!y.includes(T.participantId))).sort((T,U)=>(T.entryPosition??1/0)-(U.entryPosition??1/0)).map(T=>T.participantId),S=wi(b.concat(I));if(f){let T=(p?Cr({event:p}).flightProfile:void 0)?.flights?.filter(U=>U.drawId!==d).map(U=>U.drawEntries.filter(C=>C.participantId&&![Jh,rc,Rb].includes(C.entryStatus)&&!g.includes(C.participantId)).map(({participantId:C})=>C)).flat().filter(Boolean);T?.length&&S.push(...T)}h?.length&&(S=S.filter(T=>!h.includes(T)));let w=r?t?.filter(T=>S.includes(T.participantId)):void 0;return w?.forEach(T=>{let U=(s.entries??[]).find(C=>C.participantId===T.participantId);T.entryPosition=U?.entryPosition}),w?.sort((T,U)=>(T.entryPosition||1/0)-(U.entryPosition||1/0)),S.length?{validAlternatesAction:Vt({payload:{drawId:d,structureId:u,drawPosition:o},willDisableLinks:e,method:DOe,availableAlternatesParticipantIds:S,type:BW,availableAlternates:w})}:{}}function wde({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:n}=e;if(!i.entryStage||i.entryStage===n||n===qt&&!t||i.entryStage===Nt&&n===Ts)return!0}function bLe({eventEntries:t,structure:e}){let i=r=>r.entryStatus===Hc&&wde({structure:e,entry:r}),n=(r,a)=>(r.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(n).map(Vi)}function ILe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:n,drawDefinition:r,structureId:a,sideNumber:s,matchUpId:o,structure:l,matchUp:u,drawId:c,event:d}){let p=[],h=l?.matchUps??[],f=u.sides?.find(U=>U.sideNumber===s)?.participantId,m=h.filter(({roundNumber:U})=>U===u.roundNumber),g=r?.entries?.filter(({entryStatus:U})=>U&&Mb.includes(U)).map(Vi)??[],v=m.map(U=>(U.sides??[]).flatMap(Vi)).flat().filter(Boolean),y=g.filter(U=>!i.includes(U)&&(!t||!v.includes(U))),b=e?.filter(U=>y?.includes(U.participantId)).map(U=>Ct(U,void 0,!0));b?.forEach(U=>{let C=(r.entries??[]).find(E=>E.participantId===U.participantId);U.entryPosition=C?.entryPosition}),y.length&&p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},method:OX,type:hw,availableParticipantIds:y,participantsAvailable:b});let I=d?.entries??[],S=bLe({eventEntries:I,structure:l}),w=wi(g.concat(S));if(n){let U=(d?Cr({event:d}):void 0)?.flights?.filter(C=>C.drawId!==c).flatMap(C=>C.drawEntries.filter(E=>E.participantId&&![Jh,rc,Rb].includes(E.entryStatus)).map(({participantId:E})=>E)).filter(Boolean);U?.length&&w.push(...U)}w=w.filter(U=>!i.includes(U)&&!y.includes(U)&&(!t||!v.includes(U)));let T=e?.filter(U=>w.includes(U.participantId)).map(U=>Ct(U,void 0,!0));if(T?.forEach(U=>{let C=(r.entries??[]).find(E=>E.participantId===U.participantId);U.entryPosition=C?.entryPosition}),T?.sort((U,C)=>(U.entryPosition||1/0)-(C.entryPosition||1/0)),w.length&&p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},availableParticipantIds:w,participantsAvailable:T,method:OX,type:Hc}),!ca(u)&&s&&f){p.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},method:mLe,type:s4});let U=_=>_.sides.map(Vi),C=({matchUpId:_})=>_!==u.matchUpId,E=_=>!ca(_),P=u.sides?.find(_=>_.sideNumber!==s)?.participantId,M=h.filter(({roundNumber:_})=>_!==u.roundNumber).filter(C).map(U),R=[P,...M.filter(_=>_.includes(f)).flat()].filter(Boolean),N=_=>!R.flat().includes(_),A=m.filter(E).filter(C).map(U).flat().filter(N);if(A.length){let _=e?.filter(x=>A.includes(x.participantId)).map(x=>Ct(x,void 0,!0));p.push({payload:{participantIds:[f],roundNumber:u.roundNumber,structureId:a,sideNumber:s,matchUpId:o,drawId:c},swappableParticipantIds:A,method:COe,type:BL,swappableParticipants:_})}}return p}function WL(t){if(!t)return{error:Ee};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:n=!0,policyDefinitions:r,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l}=t,u=t.tournamentRecord??(t.tournamentId&&Xn(t.tournamentId)&&t.tournamentRecords?.[t.tournamentId]);if(!u)return{error:ot};if(!l||!Xn(l))return{error:eo};if(o&&![1,2].includes(o))return ce({result:{error:Ee},context:{sideNumber:o}});if(!e){let J=(Za({tournamentRecord:u}).matchUps??[]).find(re=>re.matchUpId===l);i=(u?.events??[]).find(re=>re.eventId===J?.eventId);let ne=(i?.drawDefinitions??[]).find(re=>re.drawId===J?.drawId);ne&&(e=ne)}if(!e)return{error:Ot};let c=dr({withIndividualParticipants:!0,tournamentRecord:u}).participants,{drawId:d}=e,{matchUp:p,structure:h}=Qn({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:Vs};let f=sn({tournamentRecord:u,drawDefinition:e,structure:h,event:i}).appliedPolicies??{};Object.assign(f,r??{});let m=f?.[Xh]?.otherFlightEntries,g=f?.[Ha]??lD[Ha],{enabledStructures:v}=pde({actionType:OG,appliedPolicies:f,drawDefinition:e,structure:h}),{policyActions:y}=hde({enabledStructures:v,drawDefinition:e,structure:h}),b=t.matchUpsMap??us({drawDefinition:e}),I=t.inContextDrawMatchUps??Kr({tournamentParticipants:c,inContext:!0,drawDefinition:e,matchUpsMap:b,event:i}).matchUps,S=I?.find(J=>J.matchUpId===l),w=o&&S?.sides?.find(J=>J.sideNumber===o),T=S?.sides?.map(J=>J.participantId||J.participant?.participantid).filter(Boolean)??[],{assignedPositions:U,allPositionsAssigned:C}=ua({structure:h}),{structureId:E}=h??{},P=[];if(!E)return{validActions:P};let M=Fo({structure:h}),R=!!p.collectionId;if(M&&!R){let J=ILe({restrictAdHocRoundParticipants:n,tournamentParticipants:c,matchUpParticipantIds:T,otherFlightEntries:m,drawDefinition:e,structureId:E,sideNumber:o,matchUpId:l,structure:h,matchUp:p,drawId:d,event:i});P.push(...J)}let N=ef({drawDefinition:e,structure:h}),A=U?.filter(J=>J.participantId).map(J=>J.drawPosition),_=U?.filter(J=>J.bye).map(J=>J.drawPosition),x=p.matchUpStatus==="BYE"||!R&&p.drawPositions?.reduce((J,ne)=>_?.includes(ne)||J,!1);if(x)return{validActions:P,isByeMatchUp:x};Xo({policyActions:y,action:VG})&&P.push({type:VG,payload:{matchUpId:l}});let O=!yR({matchUpStatus:p.matchUpStatus}),$=f?.scoring?.structures,F=h?.stage&&$?.stage&&$?.stage[h.stage],j=h?.stageSequence&&F?.stageSequence&&F.stageSequence[h.stageSequence],H=!(f?.scoring?.requireAllPositionsAssigned||F?.requireAllPositionsAssigned||j?.requireAllPositionsAssigned)||C,G=p.sides&&p.sides.filter(J=>J?.participantId).length===2,W=p.matchUpStatus&&[cr,sa].includes(p.matchUpStatus),q=vo({inContextDrawMatchUps:I,drawDefinition:e,matchUpId:l}),Z=Qy({inContextDrawMatchUps:I,drawDefinition:e,targetData:q}),K=(S?.drawPositions?.length===2&&S.drawPositions.every(J=>A?.includes(J))&&S?.sides?.length===2&&S.sides.every(({participantId:J})=>J)||G)&&!(W&&Z),Q={method:Cce,type:fw,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(O&&P.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:$G,type:yde}),Xo({policyActions:y,action:fw})&&(w?.participant||!o&&T?.length)&&P.push(Q),O&&K&&P.push({type:bde}),H&&K){let{matchUpId:J,matchUpFormat:ne}=p,re={drawId:d,matchUpId:J,matchUpFormat:ne,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};P.push({info:"set outcome and winningSide",method:$G,type:Ide,payload:re}),Xo({policyActions:y,action:jG})&&P.push({type:jG}),Xo({policyActions:y,action:"END"})&&P.push({type:"END"})}if(R&&S){let J=vLe({specifiedPolicyDefinitions:r,inContextDrawMatchUps:I,matchUpParticipantIds:T,matchUpActionsPolicy:g,inContextMatchUp:S,policyActions:y,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l,matchUp:p,drawId:d,side:w});P.push(...J)}return{structureIsComplete:N,validActions:P,isDoubleExit:W,...le}}function wLe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:n,activeDrawPositions:r,positionAssignments:a,drawDefinition:s,drawPosition:o,structureId:l,structure:u,drawId:c,event:d}){if(r.includes(o)||n&&!e)return{};let{sourceStructureIds:p,targetStructureIds:h}=s.links?.reduce((v,y)=>{let b=y.source?.structureId,I=y.target?.structureId;return v.sourceStructureIds.includes(b)||v.sourceStructureIds.push(b),v.targetStructureIds.includes(I)||v.targetStructureIds.push(I),v},{sourceStructureIds:[],targetStructureIds:[]})||{},f=[],m=s.links?.filter(v=>v.target?.structureId===u.structureId)??[];for(let v of m){let y=v?.source?.structureId,{structure:b}=li({structureId:y,drawDefinition:s}),I=b?.finishingPosition===t0&&(p?.length!==1||h?.length!==1),S={};if(I){let{matchUps:U}=cn({drawDefinition:s,structure:u,event:d}),{initialRoundNumber:C}=pw({drawPosition:o,matchUps:U}),E=s.links?.find(P=>P.target?.structureId===u?.structureId&&P.target.roundNumber===C)?.source?.roundNumber;S.roundNumbers=[E]}let{completedMatchUps:w}=AL({structureId:y,inContext:!0,matchUpFilters:S,drawDefinition:s}),T=a.map(U=>U.participantId).filter(Boolean);w?.filter(({matchUpType:U,winningSide:C})=>C&&(d?.eventType!==na||U===na)).map(({winningSide:U,sides:C})=>U&&C?.[1-(U-1)]).map(Vi).filter(U=>U&&!T.includes(U))?.forEach(U=>{f.includes(U)||f.push(U)})}let g=t?.filter(v=>f?.includes(v.participantId));return g?.forEach(v=>{let y=(s.entries??[]).find(b=>b.participantId===v.participantId);v.entryPosition=y?.entryPosition}),f?.length?{validLuckyLosersAction:{type:jW,method:EOe,availableLuckyLosers:g,availableLuckyLoserParticipantIds:f,willDisableLinks:i,payload:{drawId:c,structureId:l,drawPosition:o}}}:{}}function SLe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:n,tournamentParticipants:r,isWinRatioFedStructure:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,seedingProfile:c,isByePosition:d,drawPosition:p,structureId:h,event:f}){let{drawId:m}=u,g=[],v,y,b=[],I=l?.[Cc]?.validSeedPositions?.ignore;if(I||({unplacedSeedParticipantIds:v,unplacedSeedAssignments:y,unfilledPositions:b}=ice({provisionalPositioning:n,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:c,structureId:h})),b?.length||(b=s.filter(S=>!S.participantId&&!S.bye&&!S.qualifier).map(S=>S.drawPosition)),d||g.push({payload:{drawId:m,structureId:h,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:NOe,type:"BYE"}),a&&I){let S=s.map(E=>E.participantId).filter(Boolean),w={structureIds:t},{completedMatchUps:T}=sD({inContext:!0,matchUpFilters:w,drawDefinition:u}),U=wi((T??[]).filter(({matchUpType:E})=>f?.eventType!==na||E===na)?.map(({sides:E})=>E?.map(Vi)).flat().filter(E=>E&&!S.includes(E))),C=o?r?.filter(E=>U?.includes(E.participantId)).map(E=>Ct(E,void 0,!0)):void 0;return C?.forEach(E=>{let P=(u.entries??[]).find(M=>M.participantId===E.participantId);E.entryPosition=P?.entryPosition}),C?.length&&g.push(Vt({payload:{drawId:m,structureId:h,drawPosition:p},willDisableLinks:i,method:PX,type:hw,availableParticipantIds:U,participantsAvailable:C})),{validAssignmentActions:g}}if(b.includes(p)||d){let S;if(y?.length){let T=y.filter(U=>v?.includes(U.participantId));T.sort(TLe),S=T.map(U=>U.participantId)}else S=e;let w=o?r?.filter(T=>S.includes(T.participantId)).map(T=>Ct(T,void 0,!0)):void 0;w?.length&&g.push(Vt({payload:{drawId:m,structureId:h,drawPosition:p},willDisableLinks:i,method:PX,type:hw,availableParticipantIds:S,participantsAvailable:w}))}return{validAssignmentActions:g}}function TLe(t,e){return t.bye||VT(t.seedValue)<VT(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function ULe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:n,appliedPolicies:r,drawDefinition:a,drawPosition:s,structureId:o,drawId:l}){let u=[],c=[],d=[],p=[],h=i.map(S=>S.participantId).filter(Boolean),f=r?.[Xh],m=!f?.disableRoundRestrictions&&t[s],g=f?.requireCompletedStructures,{sourceStructureIds:v,relevantLinks:y}=bC({targetRoundNumber:m,linkType:Wh,drawDefinition:a,structureId:o})||{};v?.length&&p.push(...v);let{sourceStructureIds:b,relevantLinks:I}=bC({targetRoundNumber:m,linkType:qh,drawDefinition:a,structureId:o})||{};b?.length&&p.push(...b);for(let S of y){let w=a.structures?.find(U=>U.structureId===S.source.structureId);if(w?.stage!==qt)continue;let T=ef({structureId:S.source.structureId,drawDefinition:a});if(!g||T){let U=w.qualifyingRoundNumber,{matchUps:C}=cn({matchUpFilters:{roundNumbers:[U],isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:w});for(let E of C){let P=E.sides.find(R=>R?.sideNumber===E.winningSide),M=E.matchUpStatus==="BYE"&&E.sides?.find(({participantId:R})=>R);if(P||M){let{participantId:R,participant:N}=P||M||{};R&&!h.includes(R)&&(N&&n&&u.push(N),c.push(R))}}}}for(let S of I){let w=a.structures?.find(U=>U.structureId===S.source.structureId);if(w?.stage!==qt)continue;let T=ef({structureId:S.source.structureId,drawDefinition:a});if(!g||T){let{positionAssignments:U}=Nn({structure:w}),C=U?.map(E=>{let P=E.participantId,M=_i({element:E,name:gm}).extension?.value;return M?{participantId:P,groupOrder:M?.groupOrder}:{}}).filter(({groupOrder:E,participantId:P})=>E===1&&!h.includes(P)).map(({participantId:E})=>E)??[];if(C&&c.push(...C),n){let E=e.filter(({participantId:P})=>C.includes(P));u.push(...E)}}}return c.length&&d.push(Vt({qualifyingParticipants:n?u:void 0,method:TOe,type:$L,qualifyingParticipantIds:c,payload:{qualifyingParticipantId:void 0,drawPosition:s,structureId:o,drawId:l}})),{validAssignmentActions:d,sourceStructureIds:p}}function DLe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:n,activeDrawPositions:r,positionAssignments:a,returnParticipants:s,byeDrawPositions:o,drawDefinition:l,isByePosition:u,drawPosition:c,structureId:d,structure:p,drawId:h,event:f}){if(r.includes(c))return{};let m=E=>!t||E.participantId||E.qualifier||E.bye,g=n?.filter(E=>E!==c&&!(u&&o.includes(E))),v=a?.filter(E=>m(E)&&g?.includes(E.drawPosition))??[],y=v.map(({drawPosition:E})=>E),{matchUps:b}=cn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:f}),I=b.filter(({drawPositions:E})=>mo(E,y)),S=Object.assign({},...I.map(E=>E.sides?.filter(({sourceDrawPositionRange:P})=>P).map(({drawPosition:P,sourceDrawPositionRange:M})=>({[P]:M}))).flat()),w=v.map(E=>E.participantId).filter(Boolean),T=(i??[]).filter(E=>w.includes(E.participantId)),U=Object.assign({},...T.map(E=>({[E.participantId]:E}))),C=v.map(E=>{let P=U?.[E.participantId],M=S[E.drawPosition];return Vt({...E,participant:s?Ct(P,!1,!0):void 0,sourceDrawPositionRange:M})});return C.length?{validSwapAction:{payload:{drawId:h,structureId:d,drawPositions:[c]},willDisableLinks:e,method:Pce,type:BL,availableAssignments:C}}:{}}function l4(t){let e=zt(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:n=!0,provisionalPositioning:r,tournamentRecord:a,drawDefinition:s,drawPosition:o,event:l}=t,u=t.tournamentParticipants??(a&&dr({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],c=li({structureId:t.structureId,drawDefinition:s});if(c.error)return c;let d=c.containingStructure||c.structure;if(!d)return{error:or};let p=d.structureId;if(c=bR({drawDefinition:s,structureId:p}),o===void 0&&!c.isAdHoc)return{error:HU};if(c.isAdHoc)return WL(t);if(c.error)return c;let{drawPositionInitialRounds:h,inactiveDrawPositions:f,activeDrawPositions:m,byeDrawPositions:g}=c,v=sn({tournamentRecord:a,drawDefinition:s,structure:d,event:l}).appliedPolicies??{};Object.assign(v,i??{});let{actionsPolicy:y,enabledStructures:b,actionsDisabled:I}=pde({actionType:p_,appliedPolicies:v,drawDefinition:s,structure:d}),S=y?.activePositionOverrides||[],{sourceStructureIds:w}=bC({finishingPosition:qy,targetRoundNumber:1,linkType:qh,drawDefinition:s,structureId:p})||{},T;w?.length&&(T=w.every(Q=>ef({structureId:Q,drawDefinition:s})));let U=w.length,C=w.length&&!T,{policyActions:E}=hde({enabledStructures:b,drawDefinition:s,structure:d}),P=![qt,Nt].includes(d.stage)||d.stageSequence!==1,{drawId:M}=s,R=[],{assignedPositions:N,positionAssignments:A}=ua({structure:d}),_=N?.find(Q=>Q.drawPosition===o),x=!!_;if(!A?.map(Q=>Q.drawPosition)?.includes(o))return{error:GU};let{stage:O,stageSequence:$}=d,F=[O];O===Ts&&F.push(Nt),O===Nt&&F.push(Ts);let j=r0({entryStatuses:Mb,provisionalPositioning:r,drawDefinition:s,stageSequence:$,structureId:p,stages:F}),H=Ab({drawDefinition:s,stages:F}).assignedParticipantIds??[],G=j.filter(Q=>!H.includes(Q.participantId)).map(Q=>Q.participantId),W=g.includes(o),q=m.includes(o);if(I)return{info:"Actions Disabled for structure",isActiveDrawPosition:q,isDrawPosition:!0,hasPositionAssigned:x,validActions:[],isByePosition:W};if(Xo({policyActions:E,action:hw})&&!q&&A&&!C&&(!_||W)){let{validAssignmentActions:Q}=SLe({positionSourceStructureIds:w,unassignedParticipantIds:G,possiblyDisablingAction:P,isWinRatioFedStructure:U,tournamentParticipants:u,positionAssignments:A,returnParticipants:n,appliedPolicies:v,drawDefinition:s,isByePosition:W,drawPosition:o,structureId:p,event:l});Q?.forEach(J=>R.push(J))}if(Xo({policyActions:E,action:$L})&&!q){let{validAssignmentActions:Q}=ULe({drawPositionInitialRounds:h,tournamentParticipants:u,positionAssignments:A,returnParticipants:n,appliedPolicies:v,drawDefinition:s,drawPosition:o,structureId:p,drawId:M});Q?.forEach(J=>R.push(J))}let{participantId:Z}=_||{},K=Z&&u.find(Q=>Q.participantId===Z);if(_){Xo({policyActions:E,action:xG})&&!q&&(R.push({type:xG,method:EX,payload:{drawId:M,structureId:p,drawPosition:o},willDisableLinks:P}),W||R.push({type:VW,method:UOe,payload:{drawId:M,structureId:p,drawPosition:o},willDisableLinks:P}),Xo({policyActions:E,action:"BYE"})&&!W&&R.push({type:"BYE",method:EX,payload:{drawId:M,structureId:p,drawPosition:o,replaceWithBye:!0},willDisableLinks:P}));let Q=d.stage===qt||d.stage===Nt&&d.stageSequence===1;if(!W&&xX({activePositionOverrides:S,activeDrawPositions:m,action:LI})&&Xo({policyActions:E,action:LI})&&Sk({drawDefinition:s,structureId:p,drawPosition:o})&&Q){let{seedAssignments:J}=Zu({returnAllProxies:!0,drawDefinition:s,structure:d}),{seedNumber:ne,seedValue:re}=J?.find(oe=>oe.participantId===Z)??{};R.push({type:LI,method:AOe,participant:K,seedNumber:ne,payload:{drawId:M,structureId:p,participantId:Z,seedValue:re}})}if(!W&&xX({activePositionOverrides:S,activeDrawPositions:m,action:mP})&&Xo({policyActions:E,action:mP})&&Sk({drawDefinition:s,structureId:p,drawPosition:o})&&Q){let{seedAssignments:J}=Zu({returnAllProxies:!0,drawDefinition:s,structure:d}),{seedNumber:ne}=J?.find(re=>re.participantId===Z)??{};R.push({method:MOe,type:mP,participant:K,seedNumber:ne,payload:{participantId:Z,structureId:p,drawId:M}})}if(!W&&Z){if(Xo({policyActions:E,action:fw})){let J={type:fw,method:Cce,participant:K,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:M}};R.push(J)}if(Xo({policyActions:E,action:IC})){let J={type:IC,method:ROe,participant:K,payload:{participantId:Z,otherName:void 0}};R.push(J)}}if(Xo({policyActions:E,action:BL})){let{validSwapAction:J}=DLe({possiblyDisablingAction:P,tournamentParticipants:u,inactiveDrawPositions:f,activeDrawPositions:m,positionAssignments:A,returnParticipants:n,byeDrawPositions:g,drawDefinition:s,isByePosition:W,drawPosition:o,structureId:p,structure:d,drawId:M});J&&R.push(J)}}if(Xo({policyActions:E,action:BW})&&!C){let{validAlternatesAction:Q}=yLe({possiblyDisablingAction:P,tournamentParticipants:u,positionAssignments:A,activeDrawPositions:m,returnParticipants:n,appliedPolicies:v,drawDefinition:s,drawPosition:o,validActions:R,structureId:p,structure:d,drawId:M,event:l});Q&&R.push(Q)}if(Xo({policyActions:E,action:jW})&&!C&&!q&&A){let{validLuckyLosersAction:Q}=wLe({sourceStructuresComplete:T,possiblyDisablingAction:P,isWinRatioFedStructure:U,tournamentParticipants:u,activeDrawPositions:m,positionAssignments:A,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:M});Q&&R.push(Q)}if(K?.participantType===Ni&&Xo({policyActions:E,action:$W})){let{validModifyAssignedPairAction:Q}=fLe({tournamentParticipants:u,returnParticipants:n,drawPosition:o,participant:K,drawId:M,event:l});Q&&R.push(Q)}return{isActiveDrawPosition:q,isDrawPosition:!0,hasPositionAssigned:x,isByePosition:W,validActions:R,...le}}function OR({policyDefinitions:t,appliedPolicies:e,drawType:i}){let n=t?.[hk]?.drawTypeCoercion,r=e?.[hk]?.drawTypeCoercion;return(typeof n=="boolean"?n:void 0)??(i&&n?.[i])??(typeof r=="boolean"?r:void 0)??(i&&r?.[i])??!0}var u4=({drawDefinition:t})=>{let e=zt({drawDefinition:t},[{[zs]:!0}]);if(e.error)return e;let i=t.structures?.find(r=>r.stage===Nt&&r.stageSequence===1);if(!i)return ce({result:{error:xq}});let{qualifierPositions:n}=ua({structure:i});return Dt(0,n.length).sort(()=>Math.random()-.5)};function c4({structureId:t,drawDefinition:e}){if(!e)return{error:Ot};if(!Xn(t))return{error:Ee};let i=aD({drawDefinition:e,structureId:t});if(i.error)return i;let n=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),r=!Dr([zy,kc,nL,Hy],n).length;return{...le,valid:r}}function wC({tournamentRecord:t,drawDefinition:e,stage:i=Nt,structureId:n,structure:r}){if(!t)return{error:ot};if(!r&&!e)return{error:Ot};if(!r&&!n&&e?.structures?.filter(o=>o.stage===i).length===1&&(r=e.structures.find(o=>o.stage===i)),!r&&!n)return{error:yu};let{error:a,positionAssignments:s}=Nn({drawDefinition:e,structureId:n,structure:r});return{positionAssignments:s??[],structureId:r?.structureId,error:a}}function Sde({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:Ee};let i=jU(t);return i?{drawSize:i}:ce({result:{error:Ee},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function LR(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:n}=t||{},{requireParticipantCount:r=!0,tournamentRecord:a,drawDefinition:s,event:o}=t||{},l="getSeedsCount",u=t?.participantsCount??t?.participantCount;if(!i){let f=Hm({tournamentRecord:a,drawDefinition:s,event:o});if(f.error)return ce({result:f,stack:l});i=f.policyDefinitions}let c=yi(u);if(u&&!c)return ce({result:{error:Ee},context:{participantsCount:u},stack:l});if(r&&!c)return ce({result:{error:zse},stack:l});if(isNaN(n))if(u)({drawSize:n}=Sde({participantsCount:u}));else return ce({result:{error:B1},stack:l});let d=r&&u||n;if(d&&d>n)return{error:Hq};let p=i?.[Cc];if(!p)return{error:Ase};let h=p.seedsCountThresholds;return h?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:h.filter(f=>e?f.drawSize<=n:n===f.drawSize).reduce((f,m)=>u&&u>=m.minimumParticipantCount?m.seedsCount:f,0)}):{error:gse}}function YL({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:n,participantMap:r,enforceGender:a,participants:s,event:o}){if((!s||!r)&&i&&({participants:s,participantMap:r}=dr({tournamentRecord:i})),!s)return{error:G1};if(!Array.isArray(s))return{error:Ee};if(!o)return{error:qn};let l=e?.[Ha]??n?.[Ha]??lD[Ha],u=(a??l?.participants?.enforceGender)!==!1,{eventType:c,gender:d}=o,p=c===pm,h=c===Nl&&wn||p&&Ni||ji,f=Object.assign({},...(t??o.entries??[]).map(v=>({[v.participantId]:v.entryStatus}))),m=Object.keys(f),g=s.filter(v=>m.includes(v.participantId)).filter(v=>{let y=ELe({participant:v,participantType:h,eventType:c,entryStatusMap:f}),b=PLe({genderEnforced:u,participantMap:r,eventGender:d,participant:v,isDoubles:p,mismatch:y});return y||!b});if(g.length){let v=g.map(y=>y.participantId);return{error:Dse,invalidParticipantIds:v}}return{...le,valid:!0}}function ELe({participant:t,participantType:e,eventType:i,entryStatusMap:n}){let r=n[t.participantId],a=i&&[pm,Nl].includes(i)&&t.participantType===ji&&(cy(r)||r===Jh);return t.participantType!==e&&!a}function PLe(t){let{participant:e,participantMap:i,eventGender:n,mismatch:r,isDoubles:a,genderEnforced:s}=t,o=!r&&a&&wi(e?.individualParticipantIds?.map(d=>i?.[d]?.participant?.person?.sex).filter(Boolean)??[])||[],l=!n||!o?.length||Mh(n)||xp(n)&&Ls(o[0])===Ls(n)||su(n)&&(o.length===1&&e.individualParticipantIds?.length===1||o.length===2),u=e?.person?.sex,c=!e?.person||!n||su(n)||Mh(n)||xp(n)&&Ls(u)===Ls(n);return!s||l&&c}function Tde({hasExistingDrawDefinition:t,qualifyingProfiles:e,appliedPolicies:i,qualifyingOnly:n,tieFormat:r,idPrefix:a,isMock:s,uuids:o}){let l="generateQualifyingSTructures",u=[],c=[],d=[],p=(y,b)=>y.stageSequence-b.stageSequence,h=(y,b)=>y.roundTarget-b.roundTarget,f=0,m=0,g,v=1;for(let y of e.sort(h)){let b=y.structureProfiles||[];v=y.roundTarget||v;let I=1,S=0,w,T,U;for(let C of(b||[]).sort(p)){let E=Pq(C.drawSize||C.participantsCount),{qualifyingRoundNumber:P,structureOptions:M,matchUpFormat:R,structureName:N,structureId:A,drawType:_}=C,x=C.matchUpType,O=C.qualifyingPositions||CLe({drawSize:E,qualifyingRoundNumber:P}),$,F,j;if(!yi(E))return ce({result:{error:B1},stack:l});let H=e.length>1?`${v}-`:"",G=b.length>1||H?I:"",W=N||(H||G?`${Is(qt)} ${H}${G}`:Is(qt));if(_===id){let{structures:q,groupCount:Z,maxRoundNumber:K}=UR({structureName:C.structureName||W,structureId:A||o?.pop(),hasExistingDrawDefinition:t,stage:qt,structureOptions:M,appliedPolicies:i,qualifyingOnly:n,stageSequence:I,matchUpType:x,roundTarget:v,tieFormat:r,drawSize:E,idPrefix:a,isMock:s,uuids:o});S=Z,$=K,F=q[0],g=[1]}else({drawSize:E,matchUps:j,roundLimit:$}=Vp({qualifyingRoundNumber:P,qualifyingPositions:O,matchUpType:x,drawSize:E,idPrefix:a,isMock:s,uuids:o})),F=Vu({structureName:C.structureName||W,structureId:A||o?.pop(),qualifyingRoundNumber:$,hasExistingDrawDefinition:t,stage:qt,qualifyingOnly:n,matchUpFormat:R,stageSequence:I,matchUpType:x,roundLimit:$,tieFormat:r,matchUps:j}),v&&un({extension:{name:ih,value:v},element:F}),S=j?.filter(q=>q.roundNumber===$)?.length||0;if(I>1){let{link:q}=CR({sourceStructureId:T,sourceRoundNumber:w,targetStructureId:F.structureId,finishingPositions:U===qh?[1]:void 0,linkType:U});d.push(q),f+=(E||0)-S}else f+=E||0;U=_===id?qh:Wh,T=F.structureId,w=$,r&&(j=cn({structure:F})?.matchUps||[],j?.forEach(q=>{let{tieMatchUps:Z}=v0({tieFormat:r,matchUp:q,isMock:s});Object.assign(q,{tieMatchUps:Z,matchUpType:x})})),c.push(F),I+=1}m+=S,u.push({qualifiersCount:S,finalQualifyingRoundNumber:w,finalQualifyingStructureId:T,finishingPositions:g,roundTarget:v,linkType:U}),v+=1}return{qualifiersCount:m,qualifyingDrawPositionsCount:f,qualifyingDetails:u,structures:c,...le,links:d}}function CLe({drawSize:t,qualifyingRoundNumber:e}){let i=t,n=0;for(;n<e;)i=Math.floor(i/2),n+=1;return i}function Ude(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,n=ri(t.drawSize),r=e&&t.drawType!==Al&&(typeof e=="boolean"||e<=2)&&n===2&&Dp||t.drawType||Dp,a=Ele.includes(r);if(n&&a){if(e&&(typeof e=="boolean"&&n<4||n<=e))r=Dp;else if(n<4&&i)return{...ce({context:{enforceMinimumDrawSize:i,drawSize:n,drawType:r},result:{error:LO},stack:"getCoercedDrawType"}),drawType:r}}return{drawType:r}}function RLe(t){let{drawDefinition:e,structureOptions:i,requireSequential:n}=t,r={structureName:Is(Nt),...t,stage:Nt},{structures:a,groupCount:s}=UR(r);if(s<1)return{error:loe};let o=i?.playoffGroups||[{finishingPositions:[1],structureName:Is(Sr)}],[l]=a,{structures:u,links:c}=$ce({sourceStructureId:l.structureId,requireSequential:n,drawDefinition:e,playoffGroups:o,groupCount:s,...t});return u&&a.push(...u),{...le,structures:a,links:c}}function MLe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let n=e.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),r=t.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),a=e.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),s=n.map((u,c)=>{let d=n.indexOf(u)%2?kc:zy,p=1+c;return{linkType:Yh,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:u,structureId:e.structureId}}}),o={linkType:Wh,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:kc,roundNumber:r,structureId:t.structureId}},l=[{linkType:Wh,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:kc,roundNumber:1,structureId:i.structureId}},{linkType:Yh,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:kc,roundNumber:1,structureId:i.structureId}}];return[...s,o,...l]}function NLe({structureName:t,matchUpType:e,idPrefix:i,drawSize:n,isMock:r,uuids:a}){let s=[],{matchUps:o}=Jg({linkFedFinishingRoundNumbers:[1],drawSize:n+1,matchUpType:e,idPrefix:i,isMock:r}),l=Bg({structureName:t||Is(Nt),structureId:a?.pop(),stageSequence:1,stage:Nt,matchUpType:e,matchUps:o});s.push(l);let u=n/2,{matchUps:c}=Jg({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:n-1,isConsolation:!0,matchUpType:e,isMock:r,uuids:a}),d=Bg({structureName:Is(Dle),matchUps:c,structureId:a?.pop(),stage:Ts,stageSequence:2,matchUpType:e});s.push(d);let{matchUps:p}=Vp({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:r}),h=Bg({structureName:Is(Ule),matchUps:p,structureId:a?.pop(),stageSequence:3,stage:Sr,matchUpType:e});s.push(h);let f=MLe({mainStructure:l,consolationStructure:d,deciderStructure:h});return{structures:s,links:f,...le}}function ALe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:n,matchUpType:r,idPrefix:a,drawSize:s,isMock:o,uuids:l}=t;if(!yi(s)||s<2)return{matchUps:[],roundsCount:0};if($d(s))return Vp(t);let u=_Le(s),c=u.shift(),d=Dt(1,(c?.participantsCount||0)+1).map(g=>({drawPosition:g})),p=[],h=1;({matchUps:p}=Dk({roundNumber:h,matchUpType:r,idPrefix:a,matchUps:p,isMock:o,nodes:d,uuids:l})),h++;let f=t.roundLimit||e;for(let g of u){let v=g.participantsCount/2,y=Dt(1,v+1);n&&v===n&&(f=h-1);let b=y.map(I=>{let S=GW({roundPosition:I,roundNumber:h,idPrefix:a,uuids:l});return{roundPosition:I,roundNumber:h,matchUpId:S}});p.push(...b),h++}let m=h-1;return p=vR({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:f,matchUps:p}),f&&(p=p.filter(g=>g.roundNumber<=f)),{matchUps:p,roundsCount:m,roundLimit:f}}function _Le(t){let e=ri(t),i=e%2?e+1:e,n=!!(Math.ceil(i/2)%2),r=[{participantsCount:i,preFeedRound:n}];for(;i>2;){let a=Math.ceil(i/2),s=a===1,o=!!(!s&&a%2);i=!s&&o?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);r.push({participantsCount:i,preFeedRound:l,feedRound:o})}return r}function Dde(t){let{playoffAttributes:e,stageSequence:i=1,stage:n=Nt,tieFormat:r,matchUpType:a,drawSize:s,uuids:o}=t,l=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,u=t.structureId||l()||o?.pop(),c=t.appliedPolicies??sn(t),d=t.policyDefinitions?.[LT]||c?.[LT];t.skipRounds=t.skipRounds||s<=4&&(d?.feedFromMainFinal?0:1)||0;let p=t.structureName??e?.["0"]?.name??Is(Nt),h=()=>{let{matchUps:f}=Vp(t);return{structures:[Vu({stageSequence:i,structureName:p,matchUpType:a,structureId:u,tieFormat:r,matchUps:f,stage:n})],links:[],...le}};return{generators:{[Al]:()=>({structures:[Vu({finishingPosition:qy,stageSequence:i,structureName:p,matchUps:[],matchUpType:a,structureId:u,stage:n})],links:[],...le}),[Tb]:()=>{let{matchUps:f}=ALe(t);return{structures:[Vu({stageSequence:i,structureName:p,matchUpType:a,structureId:u,matchUps:f,stage:n})],links:[],...le}},[Dp]:()=>h(),[Z1]:()=>NLe(t),[_T]:()=>hT({...t,roundOffsetLimit:3,playoffAttributes:e??v3}),[kT]:()=>hT({...t,roundOffsetLimit:2,playoffAttributes:e??y3}),[Sr]:()=>hT(t),[XU]:()=>{let{matchUps:f}=Jg({drawSize:s,uuids:o,matchUpType:a});return{structures:[Vu({stageSequence:i,structureName:p,matchUpType:a,structureId:u,stage:Nt,tieFormat:r,matchUps:f})],links:[],...le}},[X1]:()=>Oce(t),[xT]:()=>yI({...t,feedRounds:1,fmlc:!0}),[Tle]:()=>yI({...t,feedRounds:1}),[f3]:()=>yI({...t,feedsFromFinal:1}),[m3]:()=>yI({...t,feedsFromFinal:2}),[g3]:()=>yI({...t,feedsFromFinal:3}),[J1]:()=>yI(t),[rL]:()=>Fce(t),[id]:()=>UR(t),[Kh]:()=>RLe(t)}}}function d4(t){let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:n,qualifyingOnly:r,staggeredEntry:a,drawDefinition:s,tieFormat:o,isMock:l,uuids:u}=t||{},c=ri(t.drawSize),d=t.drawTypeCoercion??OR({appliedPolicies:n,drawType:t.drawType}),p="generateDrawStructuresAndLinks",h=Ude({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:d,drawSize:c});if(h.error)return h;let f=h.drawType,m=[],g=[],v=t?.matchUpType??Rn,y=s?.structures?.filter(({stage:G})=>G===qt);y&&m.push(...y);let b=y?.map(({structureId:G})=>G),I=s?.structures?.find(({stage:G,stageSequence:W})=>G===Nt&&W===1),S=s?.links?.filter(G=>G.target.structureId===I?.structureId&&b?.includes(G.source.structureId)),w=(G,W)=>{if(G.linkType===qh&&W?.structures){let q=G.source.finishingPositions||[];return W.structures.length*q.length}else if(G.linkType===Wh&&W?.matchUps?.length){let q=G.source.roundNumber;return W.matchUps.filter(({roundNumber:Z})=>Z===q).length}},T=y?.map(G=>{let W=S?.find(J=>J.target.structureId===G.structureId),q=Nn({structure:G})?.positionAssignments?.length??0;if(!W)return q;let Z=W?.source.structureId,K=s.structures?.find(J=>J.structureId===Z),Q=w(W,K)||0;return q-Q}).filter(Boolean).reduce((G,W)=>G+W,0),U=S?.map(G=>{let W=G.source.structureId,q=y?.find(Z=>Z.structureId===W);return w(G,q)}).filter(Boolean).reduce((G,W)=>G+W,0),C=!!(I&&!I?.matchUps?.length);if(y?.length&&!C)return{error:vG};let E=!y?.length&&t.qualifyingProfiles,P=E?.length&&Tde({idPrefix:t.idPrefix,qualifyingProfiles:E,appliedPolicies:n,qualifyingOnly:r,tieFormat:o,isMock:l,uuids:u});if(P?.error)return P;let{qualifyingDrawPositionsCount:M,qualifyingDetails:R,qualifiersCount:N}=P||{qualifyingDrawPositionsCount:T,qualifiersCount:U};M&&(P?.structures&&m.push(...P.structures),P?.links&&g.push(...P.links)),Object.assign(t,Vt({drawSize:c,matchUpType:v,tieFormat:o}));let A=f!==Al&&(!c||c<2||!a&&![XU,Tb].includes(f)&&([Kh,id].includes(f)&&c<3||![id,Kh].includes(f)&&!$d(c)));if(A&&!M)return ce({context:{drawSize:c,invalidDrawSize:A},result:{error:LO},stack:p});let{generators:_,error:x}=Dde(t);if(x)return{error:x};let O=_[f];if(!O)return{error:Nq};let $=O?.();if($.error)return $;let{structures:F,links:j}=$;if(F?.length){let G=F.find(({stage:W,stageSequence:q})=>W===Nt&&q===1);if(I&&G){if(C){let W=G.structureId;if(G.structureId=I.structureId,j?.length)for(let q of j)q.source.structureId===W&&(q.source.structureId=I.structureId),q.target.structureId===W&&(q.target.structureId=I.structureId)}else if(!i)return{error:vG}}m.push(...F)}m.sort(n0),j?.length&&g.push(...j);let H=$.structures.find(({stage:G,stageSequence:W})=>G===Nt&&W===1);for(let G of R||[]){let{finalQualifyingRoundNumber:W,finalQualifyingStructureId:q,roundTarget:Z,finishingPositions:K,linkType:Q}=G,J=H&&CR({targetStructureId:H.structureId,sourceStructureId:q,sourceRoundNumber:W,finishingPositions:K,targetEntryRound:Z,linkType:Q})?.link;if(J?.error)return J;J&&g.push(J)}return S&&g.push(...S),{...le,qualifyingResult:{qualifyingDrawPositionsCount:M,qualifiersCount:N},structures:m,links:g}}function p4(t){let{modifyOriginal:e=!0,stageSequence:i=1,isMock:n}=t||{},r="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return ce({result:{error:Ot},stack:r});let a=e?t.drawDefinition:Ct(t.drawDefinition,!1,!0),{tieFormat:s,matchUpType:o}=t;if(s){let b=Lo({tieFormat:s});if(b.error)return b}s=hs(s??Zs({drawDefinition:a})?.tieFormat),o=o??(a.matchUpType||Rn),t.tieFormat=s,t.matchUpType=o;let l=wk({drawDefinition:a,stage:Nt});t.drawSize=t.drawSize??l,!l&&t.drawSize&&Uk({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:Nt});let u=us({drawDefinition:a}).drawMatchUps.map(Ma),c=d4(t);if(c.error)return ce({result:c,stack:r});let{structures:d,links:p,qualifyingResult:h}=c;a.structures=d,a.links=p;let f=Math.max(t.qualifiersCount??0,h?.qualifiersCount||0);if(h?.qualifyingDrawPositionsCount&&!wk({stage:qt,drawDefinition:a})){let b=Uk({drawSize:h.qualifyingDrawPositionsCount,stage:qt,drawDefinition:a});if(b.error)return b}if(f){let b=Uce({qualifiersCount:f,drawDefinition:a,stage:Nt});if(b.error)return b}let m=t.drawSize??l;Object.assign(t,Vt({drawSize:m,matchUpType:o,tieFormat:s}));let{matchUps:g,matchUpsMap:v}=Kr({drawDefinition:a});s&&g?.forEach(b=>{if(!u.includes(b.matchUpId)){let{tieMatchUps:I}=v0({tieFormat:s,matchUp:b,isMock:n});Object.assign(b,{tieMatchUps:I,matchUpType:o})}});let{inContextDrawMatchUps:y}=Zy({drawDefinition:a,matchUpsMap:v});return Ln({tournamentId:t.tournamentRecord?.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:y,drawDefinition:a,matchUpsMap:v,...le,structures:d,matchUps:g,links:p}}function FR(t){let{removePriorValues:e,tournamentRecord:i,participantId:n,scaleItem:r}=t,a,s;if(!Pde({scaleItem:r}))return{error:aw};if(n&&Array.isArray(i.participants)&&(s=i.participants.find(o=>o.participantId===n),s)){if(s.participantType===_o&&r?.eventType!==Nl)return{error:aw};let o=Cde({removePriorValues:e,participant:s,scaleItem:r});if(o.error)return o;a=!o.valueChanged;let{topics:l}=bu();l.includes(Us)&&Ti({topic:Us,payload:{tournamentId:i.tournamentId,participants:[s]}})}return a&&{...le,info:Qq,existingValue:r?.scaleValue}||s&&{...le,newValue:r?.scaleValue}||{error:Nr}}function Ede(t){let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:n,auditData:r,context:a}=t;if(!n)return{error:ot};if(!n.participants)return{error:G1};let s=0,o={},l=[];for(let d of e){let p=d?.participantId;if(Array.isArray(d?.scaleItems))for(let h of d.scaleItems)if(Pde({scaleItem:h}))Array.isArray(o[p])||(o[p]=[]),o[p].push(h);else return{error:aw}}for(let d of n.participants){let{participantId:p}=d||{};if(Array.isArray(o[p]))for(let h of o[p]){if(d.participantType===_o&&h?.eventType!==Nl)return ce({context:{participantId:p,scaleItem:h,participantType:d.participantType},info:"Invalid participantType for eventType",result:{error:aw}});Cde({participant:d,scaleItem:h,removePriorValues:i}),l.push(d),s++}}let u=s?void 0:KU,{topics:c}=bu();if(c.includes(Us)&&s&&Ti({topic:Us,payload:{tournamentId:n.tournamentId,participants:l}}),a){let{eventId:d,drawId:p,...h}=a,f=h.scaleAttributes?.scaleType&&[h.scaleAttributes.scaleType];if(Object.keys(h).length){let m={itemType:G3,itemValue:h};if(f&&(m.itemSubTypes=f),p||d){let{drawDefinition:g,event:v}=$o({tournamentRecord:n,eventId:d,drawId:p});p&&FW({drawDefinition:g,timeItem:m}),d&&y0({event:v,timeItem:m})}else kR({tournamentRecord:n,timeItem:m})}}return r&&c.includes(im)&&Ti({topic:im,payload:r}),Vt({...le,modificationsApplied:s,info:u})}function Pde({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(n=>e?.includes(n)).length===i.length}function Cde({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:Kw};let n=i&&Object.keys(i),r=["scaleType","eventType","scaleName"];if(r.filter(u=>n.includes(u)&&i[u]).length!==r.length)return{error:aw};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:s}=_h({scaleAttributes:i,participant:e}),o=u=>[void 0,null,""].includes(u),l=!(o(s?.scaleValue)&&o(i.scaleValue))&&JSON.stringify(s?.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:u,eventType:c,scaleName:d}=i,p=[Wy,u,c,d].join("."),h=Vt({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(h.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(f=>f.itemType!==p)),e.timeItems.push(h)}return{...le,valueChanged:l,newValue:i.scaleValue}}function h4(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:n}=t,r=zt(t,[{[ha]:!0},{modifiedScaleValues:!0,[Go]:Qo}]);if(r.error)return r;for(let a in i){let s=FR({scaleItem:i[a],removePriorValues:n,tournamentRecord:e,participantId:a});if(s.error)return s}return{...le}}function jT(t){let{tournamentRecord:e,scaleAttributes:i,participantId:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!n)return{error:la};let{participant:a,tournamentId:s}=Uv({tournamentRecords:r,tournamentRecord:e,participantId:n});return a?{..._h({participant:a,scaleAttributes:i}),tournamentId:s}:{error:Nr}}var kLe=(t=0)=>250/Math.pow(t+5,.4),xLe=()=>1;function OLe(t=3,e=2){let i=t/e;return isNaN(i)?FS.kDefault():i}var FS={nSpread:400,diffThreshold:.125,kCalc:kLe,kMultiplier:OLe,kDefault:xLe};function Rde(t){let{winnerRating:e,loserRating:i}=t,{ratings:n=Ca,winnerCountables:r=1,loserCountables:a=0,ratingType:s="ELO",maxCountables:o,countables:l}=t||{},u=n?.[s];if(!u)return{error:Zt};let c=u.range||t.ratingRange;e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=c[0]>c[1],p=u.decimalsCount||0,h=d?c.slice().reverse():c,f=(_,x)=>parseFloat(x)>=Math.min(..._)&&parseFloat(x)<=Math.max(..._);(!f(c,e)||!f(c,i))&&(f(c,e)||(e=u.defaultInitialization),f(c,i)||(i=u.defaultInitialization));let m=JS({targetRange:Ca.ELO.range,sourceRange:h,value:d?c[0]-e:e}),g=JS({targetRange:Ca.ELO.range,sourceRange:h,value:d?c[0]-i:i}),v=(_,x)=>1/(1+Math.pow(10,(x-_)/FS.nSpread)),y=v(m,g),b=v(g,m),I=FS.kCalc(r),S=FS.kCalc(a),w=FS.kMultiplier(o,l),T=m+w*I*(1-y),U=g+w*S*(0-b),C=JS({sourceRange:Ca.ELO.range,value:T,targetRange:h}),E=JS({sourceRange:Ca.ELO.range,value:U,targetRange:h}),P=d?c[0]-C:C,M=parseFloat(P.toFixed(p)),R=d?c[0]-E:E,N=parseFloat(R.toFixed(p)),A=Math.max(...c)?Math.abs(e-i)/Math.max(...c):0;return(C>E&&A>FS.diffThreshold||M<0||N<0)&&(M=e,N=i),{newWinnerRating:M,newLoserRating:N}}var LLe=t=>t?.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0])||[0,0];function Mde(t){let e=zt(t,[{[ha]:!0},{matchUpIds:!0,[Go]:xs,[Gc]:qw},{ratingType:!1,[gs]:y=>Ca[y]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:n=!0,tournamentRecord:r,ratingType:a="ELO",refreshDynamic:s,considerGames:o,drawDefinition:l,matchUpIds:u,asDynamic:c}=t,d=Ca[a],{accessor:p}=d,h={},f=(t.matchUps||s&&uo({drawDefinition:l,tournamentRecord:r,inContext:!0,matchUpFilters:{matchUpStatuses:Yr}}).matchUps||Za({matchUpFilters:{matchUpIds:u,matchUpStatuses:Yr},tournamentRecord:r,inContext:!0}).matchUps)??[],m=`${a}.${P3}`,g=c?m:a;f.sort(d0);for(let y of f){let{endDate:b,matchUpFormat:I,score:S,sides:w,winningSide:T}=y,U=y.matchUpType,C={eventType:U,scaleName:a,scaleType:Fg},E={scaleName:m,eventType:U,scaleType:Fg},P=Object.assign({},...(w??[]).map(F=>{let{sideNumber:j,participant:H}=F;return j&&{[j]:[H?.participantId,...H?.individualParticipantIds??[]].filter(Boolean).flat()}})),M=Object.assign({},...Object.values(P).flat().map(F=>{let j=h[F],H=!s||j?jT({scaleAttributes:E,tournamentRecord:r,participantId:F}).scaleItem:void 0,G=jT({tournamentRecord:r,scaleAttributes:C,participantId:F}).scaleItem,W=p?{[p]:void 0}:void 0;return F&&{[F]:H??G??{scaleName:g,eventType:U,scaleDate:b,scaleType:Fg,scaleValue:W}}})),R=I?So(I):{},N=R?.bestOf||1,A=R?.setsTo||1,_=o?N&A:N,x=S?.sets&&LLe(S.sets)||T===1&&[1,0]||[0,1],O=T?P[T]:[],$=T?P[3-T]:[];for(let F of O){let j=M[F]?.scaleValue,H=typeof j=="object"?j[p]:j;for(let G of $){let W=M[G]?.scaleValue,q=typeof W=="object"?W[p]:W,Z=T?x[T]:[0,0],K=T?x[3-T]:[0,0],{newWinnerRating:Q,newLoserRating:J}=Rde({winnerCountables:Z,loserCountables:K,maxCountables:_,winnerRating:H,loserRating:q,ratingType:a}),ne=p?{...j,[p]:Q}:Q,re=p?{...W,[p]:J}:J;M[F].scaleValue=ne,M[G].scaleValue=re,M[F].scaleName=g,M[G].scaleName=g}}Object.assign(h,M),i&&h4({tournamentRecord:r,modifiedScaleValues:h,removePriorValues:n})}let v=f.map(({matchUpId:y})=>y);return{...le,modifiedScaleValues:h,outputScaleName:g,processedMatchUpIds:v}}function KL(t){let{matchUpIds:e=[],drawDefinition:i,roundNumber:n,newRound:r,isMock:a,event:s}=t;if(typeof i!="object")return{error:Ot};let{participantIdPairings:o,matchUpsCount:l}=t,u=qL(t);if(u.error)return ce({result:u});let{lastRoundNumber:c,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=u;if(!l)r?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return ce({result:{error:Ee,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(o&&!Array.isArray(o)||l&&!yi(l)||e&&!Array.isArray(e)||!o&&!l)return{error:Ee,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:Ee,info:"matchUpsCount must be less than 33"};if(n&&!t.ignoreLastRoundNumber&&n-1>(c||0))return{error:Ee,info:"roundNumber error"};let h=n??(r&&(c??0)+1||c||1);o=o??Dt(0,l).map(()=>({participantIds:[void 0,void 0]}));let f=g=>{if(!t.idPrefix)return;let v=i.drawId,y=t.idPrefix??"ah";return`${v}-${y}-${h}-${g}`},m=o?.map((g,v)=>{let y=g?.participantIds??[void 0,void 0];y.push(void 0,void 0);let b=y.slice(0,2).map((S,w)=>Vt({sideNumber:w+1,participantId:S})),I=e[v]??f(v)??mn();return{roundNumber:h,matchUpStatus:Er,matchUpId:I,sides:b}});if(m?.length){let g=Zs({drawDefinition:i,event:s})?.tieFormat;g&&m.forEach(v=>{let{tieMatchUps:y}=v0({tieFormat:g,matchUp:v,isMock:a});Object.assign(v,{tieMatchUps:y,matchUpType:Hn})})}return{roundNumber:h,matchUpsCount:m?.length??0,matchUps:m,...le}}function FLe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:n,deltaObjects:r}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),s=Object.keys(i),o=[],l=LX({actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n}),u=[rV(l)];o.push(l);let c=l.value,d=l,p=1,h=0,f=s.length,m;do f-=1,m=s.length*i[s[0]].length;while(m>t&&f>5);let g=[];s.forEach(y=>{i[y].slice(0,f).forEach(b=>{h+=1;let I=FI(y,b.opponent);if(!g.includes(I)){let S=LX({stipulated:[[y,b.opponent]],actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n});if(!u.includes(rV(S))){u.push(rV(S)),o.push(S);let{maxDelta:w,value:T}=S;w<d.maxDelta&&(d=S),(T<c||T===c&&Math.round(Math.random()))&&(c=T),g.push(I),p+=1}}}),o=o.filter(b=>Math.abs(b.value-c)<5)}),o.sort((y,b)=>y.maxDiff-b.maxDiff);let v=Il(o);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:h,candidate:v}}function rV(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function LX({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:n,valueObjects:r,actorsCount:a}){let s=[].concat(...e),o=[],l=0;e.filter(Boolean).forEach(d=>{let[p,h]=d,f=FI(p,h),m=i[f];o.push({participantIds:d,value:m}),l+=i[f]}),Aa(t,a).map(d=>oo(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((h,f)=>s.includes(f)||h,!1)){s.push(...p);let h=d.value;l+=h,o.push({participantIds:p,value:h})}}),o.sort((d,p)=>d.value-p.value);let u=o.reduce((d,p)=>{let[h,f]=p.participantIds,m=FI(h,f),g=n[m];return g>d?g:d},0),c=o.reduce((d,p)=>{let[h,f]=p.participantIds,m=FI(h,f),g=r[m];return g>d?g:d},0);return{value:l,participantIdPairings:o,maxDelta:u,maxDiff:c}}function FI(t,e){return[t,e].sort(_L).join("|")}function Nde({participantIds:t}){let e={},i=[];t.forEach(r=>{e[r]=t.filter(a=>a!==r),e[r].forEach(a=>{let s=FI(a,r);i.includes(s)||i.push(s)})});let n=Object.assign({},...i.map(r=>({[r]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:n}}function $Le({matchUps:t}){let e=[];for(let i of t){let n=i.sides.map(Vi);if(n.length===2){let[r,a]=n,s=FI(r,a);e.includes(s)||e.push(s)}}return{encounters:e}}function BLe({possiblePairings:t,valueObjects:e}){let i={};for(let r of Object.keys(t)){let a=t[r].map(s=>n(r,s));i[r]=a.sort((s,o)=>s.value-o.value)}function n(r,a){let s=FI(r,a);return{opponent:a,value:e[s]}}return{pairingValues:i}}var VLe=0;function jLe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:n,pairing:r}){let a=Ca[n]?.defaultInitialization??VLe;return r.split("|").map(s=>{if(i===Yu){let o=t?.find(l=>l.participantId===s)?.individualParticipantIds;return o?o?.map(l=>e[l]||a):a*2}else return e[s]||a})}function GLe(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:n,uniquePairings:r,maxIterations:a,minimizeDelta:s,deltaObjects:o,valueObjects:l,eventType:u,scaleName:c,salted:d}=t;r.forEach(b=>{let I=jLe({tournamentParticipants:e,adHocRatings:i,scaleName:c,eventType:u,pairing:b}),S=typeof d=="number"&&d||.5,w=d&&(Math.round(Math.random())?S:S*-1)||0,T=Math.abs(I[0]-I[1])+w,U=Math.abs(I[0]-I[1]);o[b]=U,l[b]||(l[b]=0),l[b]+=T?Math.pow(T,2):0});let p=r.map(b=>({pairing:b,value:l[b]})).sort((b,I)=>b.value-I.value),{pairingValues:h}=BLe({possiblePairings:n,valueObjects:l}),{candidate:f,candidatesCount:m,deltaCandidate:g,iterations:v}=FLe({valueSortedPairings:p,maxIterations:a,pairingValues:h,deltaObjects:o,valueObjects:l}),{participantIdPairings:y}=s?g:f;return{participantIdPairings:y,candidatesCount:m,deltaCandidate:g,iterations:v,candidate:f}}var HLe=100,zLe=100,qLe=4e3;function f4(t){let{encounterValue:e=HLe,sameTeamValue:i=zLe,maxIterations:n=qLe,updateParticipantRatings:r,generateMatchUps:a=!0,ignoreLastRoundNumber:s,iterationMatchUps:o,tournamentRecord:l,dynamicRatings:u,refreshDynamic:c,participantIds:d,drawDefinition:p,roundNumber:h,structureId:f,matchUpIds:m,eventType:g,scaleName:v,idPrefix:y,isMock:b,salted:I,event:S}=t;if(!p)return{error:Ot};if(!t.structure&&!f)return{error:or};let w=t.structure||li({drawDefinition:p,structureId:f}).structure;if(!Ki(w))return{error:wb};if(!d?.length)return{error:yv};let T=[...o??[],...w?.matchUps??[]],{encounters:U}=$Le({matchUps:T}),C=l?.participants??[],E={};if(u){let Z=wi(w?.matchUps?w.matchUps.map(({roundNumber:Q})=>Q):[]),K=Math.max(...Z,0);if(K){let Q=w?.matchUps?.filter(({roundNumber:ne})=>ne===K).map(({matchUpId:ne})=>ne),J=Mde({ratingType:v??S?.category?.ratingType,updateParticipantRatings:r,tournamentRecord:l,asDynamic:!0,refreshDynamic:c,drawDefinition:p,matchUpIds:Q});if(J.error)return J;J.modifiedScaleValues&&(E=J.modifiedScaleValues)}}let{valueObjects:P}=WLe({tournamentParticipants:C,encounterValue:e,sameTeamValue:i,encounters:U}),{uniquePairings:M,possiblePairings:R,deltaObjects:N}=Nde({participantIds:d}),A=Object.values(E).length?E:t.adHocRatings,_={tournamentParticipants:C,possiblePairings:R,uniquePairings:M,maxIterations:n,adHocRatings:A,deltaObjects:N,valueObjects:P,eventType:g,scaleName:v,salted:I},{candidatesCount:x,participantIdPairings:O,deltaCandidate:$,iterations:F,candidate:j}=GLe(_);if(!x)return{error:zO};let H,G;if(a){let Z=KL({structureId:w?.structureId,ignoreLastRoundNumber:s,participantIdPairings:O,newRound:!0,drawDefinition:p,roundNumber:h,matchUpIds:m,idPrefix:y,isMock:b,event:S});if(Z.error)return Z;H=Z.roundNumber,G=Z.matchUps}let{maxDelta:W,maxDiff:q}=j;return{roundNumber:H,participantIdPairings:O,modifiedScaleValues:E,candidatesCount:x,deltaCandidate:$,...le,iterations:F,matchUps:G,maxDelta:W,maxDiff:q}}function WLe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:n}){let r={};for(let s of t)r[s]||(r[s]=0),r[s]+=i;let a=e?.filter(({participantType:s})=>s===wn);if(a)for(let s of a){let o=s.individualParticipantIds??[],{uniquePairings:l}=Nde({participantIds:o});for(let u of l)r[u]||(r[u]=0),r[u]+=n}return{valueObjects:r}}function Ade(t){let{drawType:e=Dp,attachConsolation:i=!0,applyPositioning:n=!0,tournamentRecord:r,staggeredEntry:a,automated:s,placeByes:o,isMock:l,event:u}=t,c=t?.drawDefinition;if(!c)return{error:Ot};let d=Ga,p=r0({stageSequence:1,drawDefinition:c,stage:d}),h=[id,Z1,Kh].includes(e)?p.length:jU(p.length);if(!a&&e===XU&&p.length<2||e===id&&p.length<3)return{error:LO};let{tieFormat:f,matchUpType:m}=t;if(f){let P=Lo({tieFormat:f});if(P.error)return P}f=hs(f??Zs({drawDefinition:c})?.tieFormat),m=m??c.matchUpType;let{structures:g}=rd({stageSequence:1,drawDefinition:c,stage:d});if(g.length>1)return{error:Pse};if(g?.[0]?.matchUps?.length)return{error:t3};let v=g?.[0]?.structureId;Object.assign(t,Vt({structureName:t.structureName??Is(Ga),structureId:v,matchUpType:m,tieFormat:f,drawSize:h,stage:d}));let y=Dde(t);if(y.error)return y;let b=y.generators[e];if(!b)return{error:Nq};let I=b?.();if(I.error)return I;let{structures:S,links:w}=I,T=S.map(P=>cn({structure:P}).matchUps).flat();f&&T.forEach(P=>{let{tieMatchUps:M}=v0({matchUp:P,tieFormat:f,isMock:l});Object.assign(P,{tieMatchUps:M,matchUpType:m})}),(!n||!i)&&(c=Ct(c,!1,!0)),c.links||(c.links=[]),w.length&&c.links.push(...w);let U=S.map(({structureId:P})=>P);c.structures||(c.structures=[]);let C=c.structures.map(({structureId:P})=>P);c.structures=c.structures.map(P=>U.includes(P.structureId)?S.find(({structureId:M})=>M===P.structureId):P);let E=S.filter(({structureId:P})=>!C.includes(P));return E.length&&c.structures.push(...E),s&&PR({seedingProfile:t.seedingProfile,applyPositioning:n,tournamentRecord:r,drawDefinition:c,structureId:v,placeByes:o,drawSize:h,event:u}),i&&Ln({drawDefinition:c}),{links:w,structures:S,...le}}var Cy={};Fi(Cy,{addGame:()=>Bde,addPoint:()=>$de,addSet:()=>jde,addShot:()=>Vde,analyzeScore:()=>w4,analyzeSet:()=>TC,calculateHistoryScore:()=>Ode,checkScoreHasValue:()=>ca,checkSetIsComplete:()=>JL,clearHistory:()=>Fde,generate:()=>_de,generateScoreString:()=>kh,generateTieMatchUpScore:()=>AR,getSetComplement:()=>T4,getTiebreakComplement:()=>iF,helpers:()=>qde,isValidMatchUpFormat:()=>Ml,keyValueScore:()=>ppe,mutate:()=>xde,parseMatchUpFormat:()=>So,parseScoreString:()=>Rk,query:()=>vpe,redo:()=>Gde,reverseScore:()=>kde,setServingSide:()=>Lde,stringifyMatchUpFormat:()=>QO,tidyScore:()=>gpe,umo:()=>zde,undo:()=>Hde,validateScore:()=>S4,validateTieFormat:()=>Lo});var _de={};Fi(_de,{generateScoreString:()=>kh,generateTieMatchUpScore:()=>AR,reverseScore:()=>kde});function kh(t){let{winnerFirst:e=!0,setTBlast:i=!0,addOutcomeString:n,reversed:r=!1,matchUpStatus:a,matchUpFormat:s,autoComplete:o,winningSide:l,sets:u}=t;if(!u)return{error:Zt,info:"missing sets"};let c=s&&So(s),{bestOf:d,finalSetFormat:p,setFormat:h}=c??{},f=r||!(!e||!l||l===1),m=n?YLe({matchUpStatus:a}):"",g=u?.sort(KLe).map(v).filter(Boolean).join(" ")||"";if(!m)return g;if(l===2)return`${m} ${g}`;return`${g} ${m}`;function v(y){let b=d&&y.setNumber===d&&p?p:h,I=G=>br(G?.side1Score)||br(G?.side2Score),S=(G=>br(G?.side1TiebreakScore)||br(G?.side2TiebreakScore))(y),w=b?.tiebreakSet||!I(y)&&S,{side1Score:T,side2Score:U,side1TiebreakScore:C,side2TiebreakScore:E}=y,P=C||(br(C)||S&&o?0:""),M=E||(br(E)||S&&o?0:"");if(w)return`[${(f?[M,P]:[P,M]).join("-")}]`;let R=S?Math.min(P,M):"",N=R===P?1:2,A=br(R)?`(${R})`:"",_=T||(br(T)||o?0:""),x=U||(br(U)||o?0:""),O=G=>!i&&N===G?A:"",$=`${_}${O(1)}`,F=`${x}${O(2)}`,j=i&&S?`(${R})`:"",H=f?`${[F,$].join("-")}${j}`:`${[$,F].join("-")}${j}`;return["-"," "].includes(H)&&(H=""),H}}function YLe({matchUpStatus:t}){let e={[_a]:"RET",[ir]:"WO",[sa]:"DF/DF",[cr]:"WO/WO",[Tv]:"SUS",[al]:"ABN",[On]:"DEF",[nD]:"DR"};return t&&e[t]||""}function KLe(t,e){return t.setNumber-e.setNumber}function kde(t){if(!t?.score)return{error:Zt};let{sets:e}=t.score,i=e.map(s=>{let{side1TiebreakScore:o,side2TiebreakScore:l,winningSide:u,side1Score:c,side2Score:d,setNumber:p}=s;return Vt({winningSide:u?3-u:void 0,side1TiebreakScore:l,side2TiebreakScore:o,side1Score:d,side2Score:c,setNumber:p})}),n=t?.setTBlast,r=kh({setTBlast:n,sets:i}),a=kh({sets:i,reversed:!0,setTBlast:n});return{reversedScore:{sets:i,scoreStringSide1:r,scoreStringSide2:a},...le}}var xde={};Fi(xde,{addGame:()=>Bde,addPoint:()=>$de,addSet:()=>jde,addShot:()=>Vde,calculateHistoryScore:()=>Ode,clearHistory:()=>Fde,redo:()=>Gde,setServingSide:()=>Lde,umo:()=>zde,undo:()=>Hde});function _b({matchUp:t}){let{extension:e}=_i({name:mL,element:t});if(!e)return{error:Ya};let{history:i=[],undoHistory:n=[]}=e.value;return{history:i,undoHistory:n,...le}}function Ode(t){if(!t)return{error:Zt};let{matchUp:e,updateScore:i}=t;if(!e)return{error:Oo};let n=_b({matchUp:e})?.history||[];if(!Array.isArray(n))return{error:Ee,info:"history is not an array"};let{matchUpFormat:r}=e;if(!r)return{error:Fq};if(!Ml({matchUpFormat:r}))return{error:Lq};let a=So(r),{bestOf:s,finalSetFormat:o,setFormat:l}=a,u=["0","15","30","40","A","G"],c={sets:[]},d=[],p,h=[0,0],f=1,m=0,g,v=0,y=E=>[1,2].includes(E),b=()=>(m+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:m,games:[]}),I=()=>({winningSide:void 0,points:[]}),S=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),w=S(),T=I(),U=b(),C=0;for(let E of n){C+=1,g=c.sets.length+1===s;let P=g&&o?o:l,{tiebreakAt:M,setTo:R,NoAD:N,tiebbreakFormat:A}=P,_=U.side1Score===M&&U.side1Score===U.side2Score,x=!!P.tiebreakSet,O=x?P.tiebreakSet:A,{tiebreakTo:$,NoAD:F}=O||{},j=()=>{p=void 0,h=[0,0],f=3-f,U.side1TiebreakScore="",U.side2TiebreakScore="",U.side1PointScore="",U.side2PointScore="",v=0},H=q=>{U.winningSide=q;let{s:Z,...K}=U;c.sets.push(K),w=S(),T=I(),U=b(),j()},G=q=>{T.winningSide=q;let{g:Z,...K}=T;U.games.push(K),w=S(),T=I(),j();let Q=`side${q}Score`;U[Q]+=1},W=q=>{w.winningSide=q;let{p:Z,...K}=w;T.points.push(K),w=S(),v=0;let Q=()=>h.reduce((ne,re)=>ne+re)%4/4>.5?f:3-f,J=q-1;if(_||x){h[J]+=1,p=Q(),U[`side${q}TiebreakScore`]=h[J],U[`side${3-q}TiebreakScore`]=h[1-J];let ne=F?1:2;if(h[J]>=$&&h[J]>=h[1-J]+ne)return G(q),{gameCompleted:!0}}else if(h[1-J]===4&&h[J]===3?h[1-J]-=1:h[J]+=1,U.side1PointScore=u[h[0]],U.side2PointScore=u[h[1]],h[J]===5||h[J]===4&&h[1-J]<3||N&&h[J]===4)return G(q),{gameCompleted:!0}};if(y(E.srv)&&(f=E.srv),["p","s","g","o"].includes(E.u)&&d.push(E.u),E.shotOutcome&&(w.shots.push(E),E.shotType==="SERVE"&&["OUT","NET"].includes(E.shotOutcome)&&(v+=1),v===2)){let q=3-f;W(q)}if(y(E.p)||yi(E.pointNumber)){let q=E.winningSide||E.p;if(W(q)?.gameCompleted)continue}if(y(E.g)||yi(E.gameNumber)){let q=E.winningSide||E.g;T.winningSide=q;let Z=`side${q}Score`,K=`side${3-q}Score`;if(d.length&&(d.includes("p"),d=[]),G(q),U[Z]===R&&U[Z]-U[K]>=(N?1:2)&&(H(q),g))break}if(y(E.s)||yi(E.setNumber)){let q=E.winningSide||E.s;if(H(q),d.length&&(d.includes("p"),d.includes("g"),d=[]),g)break}}return C!==n.length&&console.log({error:"Match completed with excess history"}),(U.side1Score||U.side2Score||U.games.length||U.side1TiebreakScore||U.side2TiebreakScore)&&c.sets.push(U),c.scoreStringSide1=kh({...c,matchUpFormat:r}),c.scoreStringSide2=kh({...c,matchUpFormat:r,reversed:!0}),f=p||f,i&&(e.score=c),{...le,servingSide:f,score:c}}function kb({undoHistory:t,history:e,matchUp:i}){return un({element:i,extension:{value:{history:e,undoHistory:t},name:mL}})}function Lde({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:jq};let{history:i=[]}=_b({matchUp:t});return i.push({srv:e}),kb({matchUp:t,history:i})}function Fde({matchUp:t}){return kb({matchUp:t})}function $de({matchUp:t,point:e}){if(!e||!t)return{error:Zt};if(typeof e!="object")return{error:Ee,context:{point:e}};let{history:i=[]}=_b({matchUp:t});return i.push(e),kb({matchUp:t,history:i})}function Bde({matchUp:t,game:e}){if(typeof e!="object")return{error:Ee,context:{game:e}};let{history:i=[]}=_b({matchUp:t});return i.push(e),kb({matchUp:t,history:i})}function Vde({matchUp:t,shot:e}){if(typeof e!="object")return{error:Zt};let{history:i=[]}=_b({matchUp:t});return i.push(e),kb({matchUp:t,history:i})}function jde({matchUp:t,set:e}){if(typeof e!="object")return{error:Zt};let{history:i=[]}=_b({matchUp:t});return i.push(e),kb({matchUp:t,history:i})}function Gde({matchUp:t}){let{history:e=[],undoHistory:i=[]}=_b({matchUp:t});return i.length&&e.push(i.pop()),kb({matchUp:t,history:e,undoHistory:i})}function Hde({matchUp:t}){let{history:e=[],undoHistory:i=[]}=_b({matchUp:t});return i.push(e.pop()),kb({matchUp:t,history:e,undoHistory:i})}var zde={},qde={};Fi(qde,{keyValueScore:()=>ppe,parseMatchUpFormat:()=>So,stringifyMatchUpFormat:()=>QO,tidyScore:()=>gpe});var ZLe="COMPLETED",XLe="WO/WO",Wde=["RET","DEF","WO",XLe,"ABN","SUS","INT"],GG="DEFAULTED",Yde="WALKOVER",Kde="ABANDONED",Zde="SUSPENDED",Xde="RETIRED",Jde="INTERRUPTED",JLe=[Xde,GG,Yde],QLe="Enter Score",mw="()",eb="[]",m4=["up","left","shift+tab"],g4=["enter","down","tab","right"],Ek="backspace",Qde="r",epe="s",tpe="a",ipe="d",npe="w",rpe="i",ZL=[Qde,ipe,npe,tpe,epe,rpe],XL="space",aV=["[","("],Pk=[...m4,...g4,XL,"]"],ape="-",eFe="/",$I=ape,xh=ape,spe=[eFe],tFe=0,iFe=["=","+","num_1","num_2","shift+=","shift+-"],gh=["0","1","2","3","4","5","6","7","8","9"].concat(ZL),ope=gh.map(t=>`shift+${t}`),v4=[$I,Ek].concat(Pk,spe),lpe=[gh,ope,v4].join(","),nFe=[lpe,m4,g4,iFe].join(",");[].concat(...gh,...gh,...v4,...gh,...gh,...gh,...gh,...gh,...gh);var y4={OUTCOMEKEYS:ZL,SIDE1KEYS:gh,SIDE2KEYS:ope,MODIFIERS:v4,PROMPT:QLe,MOVEUP:m4,MOVEDOWN:g4,HOTKEYS:nFe};function mS({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=upe({scoreString:t}),e===2){let n=(t&&t[t.length-1])!==" "?" ":"";return t+n+i}else return i+" "+t}function upe({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of Wde){let n=t?.indexOf(i);n===0?t=t.slice(i.length+1).trim()+" ":n>0&&(t=t.slice(0,n)),n>=0&&(e=!0)}return t?.trim()||(t=""),{scoreString:t,removed:e}}function HG({analysis:t,scoreString:e,sets:i,lowSide:n}){let r,a;if(!e)return{scoreString:e,sets:i};let{scoreString:s,removed:o}=upe({scoreString:e});if(e=s,o)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},u=Object.values(l).filter(m=>m!==void 0).length;l.setNumber&&u===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:c}=t.setFormat,{tiebreakTo:d,NoAD:p}=c||{},{isTiebreakEntry:h}=fT({brackets:eb,scoreString:e}),f=aFe(e);if(f>=0){r=e.slice(0,f);let{isTiebreakEntry:m}=fT({brackets:mw,scoreString:r}),{lastOpenBracketIndex:g,isTiebreakEntry:v}=fT({brackets:eb,scoreString:r}),y=r&&r[r.length-1].trim(),b=r&&!isNaN(y),I=t.isIncompleteSetScore;if(h&&v){let S=r.slice(g+1).split(xh),w=S?.length>0&&S[0]!==void 0&&!isNaN(parseInt(S[0]))&&parseInt(S[0])||void 0,T=S?.length>1&&S[1]!==void 0&&parseInt(S[1])||void 0,U=[w,T];if(T){let C=n===1?1:0;U[C]=(U?.[1-C]||0)+(p?1:2),(U[C]||0)<d&&(U[C]=d),r=e.slice(0,g+1),r+=U.join(xh)}else w!==void 0?(r=e.slice(0,g+1),r+=w):(r=e.slice(0,g),I=!0);l.side1TiebreakScore=U[0]||0,l.side2TiebreakScore=U[1]||0}if(r.length||(r=void 0),I){let S=l.side1Score?.toString();if(S){let w=S?.slice(0,S.length-1);l.side1Score=!isNaN(w)&&parseInt(w)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:i?.slice(0,i.length-1)||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]}else if(b){let S=l.side2Score?.toString(),w=l.side1Score?.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let T=S?.slice(0,S.length-1);l.side2Score=!isNaN(T)&&parseInt(T)||void 0}else{let T=w?.slice(0,w.length-1);l.side1Score=!isNaN(T)&&parseInt(T)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else m?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(h&&!v?a=i?.slice(0,i.length-1)||[]:(a=i,a[i.length-1]=l),h||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:r,sets:a}}return{scoreString:e,sets:i}}function fT({brackets:t=mw,scoreString:e}){if(!e)return{};let[i,n]=t.split(""),r=e.split(""),a=Math.max(...Up(i,r)),s=Math.max(...Up(n,r));return{isTiebreakEntry:a>s,lastOpenBracketIndex:a}}function rFe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[n,r]=eb.split(""),a=t.split(""),s=Math.max(...Up(n,a)),o=Math.max(...Up(r,a)),l=Math.max(...Up(xh,a));return i&&s>o&&l>s}function aFe(t){return t.split("").reduce((e,i,n)=>(i.match(/\d+/g)&&e.push(n),e),[]).pop()}function cpe(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:n}=t||{},r=i?1:2;return e+1>=n?e+r:parseInt(n)}function FX({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:n}){let r=So(t),{bestOf:a}=r,s=Math.ceil(a/2),o=n?.reduce((l,u)=>{let{winningSide:c}=u;return c&&l[c-1]++,l},[0,0])?.indexOf(s)+1||void 0;return JLe.includes(e)&&i&&(o=i),{matchUpWinningSide:o}}function JL({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,isTimedSet:a,set:s}){if(!s)return{error:Zt,info:"missing set"};e=e||i&&So(i);let o=r&&e.finalSetFormat||e?.setFormat||{},{side1Score:l,side2Score:u}=s,{setTo:c,tiebreakAt:d}=o,p=l||u,h=QL({set:s}),f=Math.abs(l-u),m=l>=c||u>=c,g=n||l>=c&&u>=c||d&&d<c&&(l===d||u===d),v=t||g&&(h===1&&s.side1TiebreakScore>s.side2TiebreakScore||h===2&&s.side2TiebreakScore>s.side1TiebreakScore),y=!g&&o.NoAD||g||n&&o.tiebreakFormat?.NoAD?1:2,b=f>=y;return!!((a&&p||m&&(b||g)||n)&&(!g||v))}function QL({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function b4({analysis:t,set:e}){let i=QL({set:e}),{isDecidingSet:n,isTiebreakSet:r,matchUpScoringFormat:a}=t;return JL({matchUpScoringFormat:a,isDecidingSet:n,isTiebreakSet:r,set:e})&&i}function sFe({analysis:t,scoreString:e,sets:i,value:n}){let r;if(!i?.length)return{sets:[]};let a=i[i.length-1];n=ri(n);let{validSide2Score:s,requiresTiebreak:o}=oFe({analysis:t,set:a,value:n});if(s){r=!0,e=(e||"")+n,a.side2Score=n;let l=b4({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,o){let u=mw.split("")[0];e+=u}else t.isDecidingSet||(e+=" ")}return{sets:i,scoreString:e,updated:r}}function oFe({analysis:t,set:e={},value:i}){let n=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:r,setTo:a,NoAD:s}=n,{side1Score:o}=e,l,u;return r&&r<a?o===r?l=i<=a:l=i<=r:o===a?s?l=i<a:l=i<=a+1:o===a-1?s?l=i<=a:l=i<=a+1:o===a+1?l=i===a||i===a-1:l=i<=a,l&&(r&&r<a?u=o===a&&i===r||o===r&&i===a:u=o>=a&&i>=a&&o!==i),{validSide2Score:l,requiresTiebreak:u}}function dpe({lowSide:t,value:e,sets:i,scoreString:n,winningSide:r,matchUpStatus:a}){let s;return e===Qde?n?(s=!0,n=mS({scoreString:n,lowSide:t,outcome:"RET"}),r=t===2?1:2,a=Xde):(s=!0,n=mS({scoreString:n,lowSide:t,outcome:"DEF"}),r=t===2?1:2,a=GG):e===ipe?(s=!0,n=mS({scoreString:n,lowSide:t,outcome:"DEF"}),r=t===2?1:2,a=GG):e===npe?(s=!0,i=[],n="WO",r=t===2?1:2,a=Yde):e===epe&&n?(s=!0,n=mS({scoreString:n,lowSide:t,outcome:"SUS"}),a=Zde,r=void 0):e===tpe?(s=!0,n=mS({scoreString:n,lowSide:t,outcome:"ABN"}),a=Kde,r=void 0):e===rpe&&n&&(s=!0,n=mS({scoreString:n,lowSide:t,outcome:"INT"}),a=Jde,r=void 0),{updated:s,sets:i,scoreString:n,matchUpStatus:a,winningSide:r}}function lFe(t){let{sets:e,info:i,scoreString:n,winningSide:r,matchUpStatus:a}=t,{analysis:s,lowSide:o,value:l}=t,u,c;!e?.length&&l!==Ek&&(e=[{setNumber:1}]);let d=e.length-1;if(ZL.includes(l)){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;h&&!f?i="missing side2Score":s.finalSetIsComplete||r?i="final set is already complete":s.isIncompleteSetScore?i="incomplete set scoreString":s.isIncompleteSetScore||({sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:u}=dpe({lowSide:o,value:l,sets:e,scoreString:n,matchUpStatus:a,winningSide:r}))}else if(l===Ek){if({scoreString:n,sets:e,outcomeRemoved:c}=HG({analysis:s,scoreString:n,sets:e}),n?.trim()===""&&(n=n.trim()),n||(e=[]),c){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;if(h&&f){let m=h>f&&1||f>h&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}a=void 0,r=void 0,u=!0}else if(s.hasOutcome)i="has outcome";else{if(r)return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===XL){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p,m=h>f&&1||f>h&&2||void 0;m&&!r&&!s.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),n+=" ",u=!0)}else if(l===$I&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&n&&s.isNumericEnding)n+="-",e[d].side2Score=0,a=void 0,r=void 0,u=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let h=ri((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=ri(h),p=e[d].side1Score.toString(),u=!0}else{let h=ri((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=ri(h),p=[e[d].side1Score,e[d].side2Score].join("-"),u=!0}if(u){let h=(e.slice(0,d)||[]).filter(f=>f).map(f=>{let{side1Score:m,side2Score:g}=f;return[m,g].join("-")}).join(" ");h?n=h+" "+p:n=p}}}return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,info:i,updated:u}}function uFe({analysis:t,auto:e,lowSide:i,scoreString:n="",sets:r,value:a}){let s,o,{tiebreakSet:{tiebreakTo:l,NoAD:u}}=t.setFormat,[c]=eb.split("");if(t.isMatchTiebreakEntry||(n+=c),r[t.setNumber-1]){let{lastOpenBracketIndex:d}=fT({brackets:eb,scoreString:n}),p=(n.slice((d??0)+1)+(e?"":a)).split(xh);if((p[i-1]?.length||0)>=2)o="tiebreak digit limit";else if(e){i===1&&(p[0]=(p[0]||"")+a),i===2&&(p[1]=(p[1]||"")+a);let h=[p[0]||0,p[1]||0].map(g=>ri(g)),f=i===1?1:0;h[f]=h[1-f]+(u?1:2),h[f]<l&&(h[f]=l);let m=r[r.length-1];m.side1TiebreakScore=h[0],m.side2TiebreakScore=h[1],n=n.slice(0,(d??0)+1),n+=h.join(xh),s=!0}else{let h=[p[0]||0,p[1]||0].map(m=>ri(m)),f=r[r.length-1];f.side1TiebreakScore=h[0],f.side2TiebreakScore=h[1],n+=a,s=!0}}else{let d=cpe({lowValue:ri(a||0),tiebreakTo:l,NoAD:u}),p=[ri(a),d];i===2&&p.reverse();let h={side1TiebreakScore:p[0],side2TiebreakScore:p[1],setNumber:r?.length+1||1};r.push(h),n+=p.join(xh),s=!0}return{info:o,scoreString:n,sets:r,updated:s}}function cFe({analysis:t,lowSide:e,scoreString:i,value:n}){let{setTo:r,tiebreakAt:a,NoAD:s}=t?.setFormat||{},o=n===parseInt(a||r);if(a&&a<r&&n>a)return{scoreString:i};if(s&&n===r||n>r)return{scoreString:i};let l=f(),u=[n,l];e===2&&u.reverse();let c=mw.split("")[0],d=u.join($I)+(o?c:" ");i=(i||"")+d;let p={side1Score:u[0],side2Score:u[1]},h=b4({analysis:t,set:p});return p.winningSide=h||void 0,{scoreString:i,set:p};function f(){return o?n+1:n+1===r?n+(s?1:2):r}}function dFe({matchUpFormat:t,scoreString:e,winningSide:i,value:n,sets:r}){let a=(r?.filter($=>$?.winningSide)?.length||0)+(i?0:1),s=So(t),o=a===s?.bestOf,l=o&&s?.finalSetFormat||s?.setFormat||{},u=l?.timed,c=o&&r[s?.bestOf-1],d=c?.winningSide,{isTiebreakEntry:p}=fT({brackets:mw,scoreString:e}),{isTiebreakEntry:h}=fT({brackets:eb,scoreString:e}),f=p||h,m=!!l.tiebreakSet,g=e?.[e.length-1]?.trim(),v=e&&!isNaN(g),y=!f&&g===$I,b=p&&aV.includes(g),I=h&&aV.includes(g),S=h&&g===xh,w=e?.split(""),[T]=eb.split(""),U=w&&Math.max(...Up(T,w)),C=w&&Math.max(...Up(xh,w)),E=w&&C>U,P=r[r.length-1]?.winningSide,M=r?.length&&!P,R=Wde.find($=>e?.indexOf($)>=0),N=!isNaN(n),A=n===XL,_=Pk.includes(n),x=e?.split("").find($=>aV.includes($)),O=_&&h&&!I&&(S||!rFe({scoreString:e}));return{isTiebreakSetValue:m&&N,matchUpScoringFormat:s,setNumber:a,setFormat:l,matchTiebreakHasJoiner:E,isGameScoreEntry:M,isSpace:A,isCloser:_,isTiebreakCloser:_&&x&&f&&v,isDecidingSet:o,isTiebreakSet:m,isTimedSet:u,isNumericEnding:v,isNumericValue:N,hasOpener:x,hasOutcome:R,finalSet:c,finalSetIsComplete:d,lastSetIsComplete:P,isInvalidSetTiebreakValue:A&&f&&b,isInvalidMatchTiebreakValue:O,isTiebreakEntry:f,isSetTiebreakEntry:p,isMatchTiebreakEntry:h,isIncompleteSetScore:y,isIncompleteSetTiebreak:b,isIncompleteMatchTiebreak:I,isPartialMatchTiebreakValue:S}}function ppe(t){let{lowSide:e=1,value:i}=t,{scoreString:n,sets:r,winningSide:a,matchUpStatus:s}=t,{matchUpFormat:o,shiftFirst:l,auto:u=!0}=t,c,d,p=l&&e===2||!l&&e===1;if(!lpe.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:h}=FX({sets:r,winningSide:a,matchUpStatus:s,matchUpFormat:o});a=h;let f=dFe({value:i,winningSide:a,scoreString:n,sets:r,matchUpFormat:o});if(spe.includes(i)&&(i=$I),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&ri(i)===0&&(f.isTiebreakCloser=!0),Pk.includes(i)&&f.hasOpener&&(i=""),Pk.includes(i)&&(i=XL),f.lastSetIsComplete){let m=n?.length&&n[n.length-1];n&&m!==" "&&(n+=" ")}if(f.isTimedSet)({info:d,sets:r,scoreString:n,updated:c,matchUpStatus:s,winningSide:a}=lFe({analysis:f,lowSide:e,scoreString:n,sets:r,matchUpStatus:s,winningSide:a,value:i}));else if(ZL.includes(i))f.finalSetIsComplete||a?d="final set is already complete":!f.isTiebreakEntry&&!f.isIncompleteSetScore?{sets:r,scoreString:n,matchUpStatus:s,winningSide:a,updated:c}=dpe({lowSide:e,sets:r,scoreString:n,matchUpStatus:s,winningSide:a,value:i}):f.isTiebreakEntry||f.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===Ek)c=!0,{scoreString:n,sets:r}=HG({analysis:f,scoreString:n,sets:r,lowSide:e}),n||(r=[]),s=void 0,a=void 0;else if(f.hasOutcome)d="has outcome";else if(i===$I&&!f.isMatchTiebreakEntry)(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(c=!0,{scoreString:n,sets:r}=HG({analysis:f,scoreString:n,sets:r,lowSide:e}),s=void 0);else if(i===xh&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?d="existing joiner":f.isNumericEnding&&(c=!0,n+=xh);else if([$I,xh].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:r,scoreString:n,updated:c}=sFe({analysis:f,scoreString:n,sets:r,value:i}));else if(f.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(f.isTiebreakCloser){let m=f.isSetTiebreakEntry?mw:eb,g=m.split("").reverse()[0],v=m.split("")[0],y=r[r.length-1],{tiebreakFormat:b}=f.setFormat,{tiebreakTo:I,NoAD:S}=b||{},w=QL({set:y});if(!f.isTiebreakSet){let U=parseInt(n.split(v).reverse()[0]),C=cpe({lowValue:U,tiebreakTo:I,NoAD:S});w===1?(y.side1TiebreakScore=C,y.side2TiebreakScore=U):(y.side1TiebreakScore=U,y.side2TiebreakScore=C)}n=(n||"")+g,f.isDecidingSet||(n+=" ");let T=b4({analysis:f,set:y});y.winningSide=T||void 0,c=!0}else if(f.isTiebreakSetValue)({info:d,scoreString:n,sets:r,updated:c}=uFe({analysis:f,auto:u,lowSide:e,scoreString:n,sets:r,value:i}));else if(f.isSetTiebreakEntry){let[m]=mw.split(""),g=Math.max(...Up(m,n.split(""))),v=n.slice(g+1),y=v&&ri(v)===tFe,b=ri(v?v+i:i),{tiebreakFormat:I}=f.setFormat,{tiebreakTo:S,NoAD:w}=I||{};!y&&v.length<2?w&&b>S-1?d="invalid low value for NoAD tiebreak":(c=!0,n=(n||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)d=`invalid key: ${i}`;else if(f.isGameScoreEntry)d="game scoreString entry";else if(f.lastSetIsComplete||!r.length){c=!0;let{scoreString:m,set:g}=cFe({analysis:f,lowSide:e,scoreString:n,value:ri(i)});g&&(g.setNumber=r?.length+1||1),r=r?.concat(g).filter(Boolean)||[g],n=m||void 0}else console.log("error: unknown outcome")}if(c){r=r?.filter(Boolean);let{matchUpWinningSide:m}=FX({sets:r,winningSide:a,matchUpStatus:s,matchUpFormat:o});return a=m,m&&(!s||[Er,_l].includes(s))?(s=ZLe,r=r.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:b,side2TiebreakScore:I}=g;return v||y||b||I})):n&&!a&&![Zde,Kde,Jde].includes(s)&&(s=void 0),{updated:c,scoreString:n,sets:r,winningSide:a,matchUpStatus:s,info:d}}return{updated:c,scoreString:n,sets:r,winningSide:a,matchUpStatus:s,info:d}}var eF="\\d+-\\d+",SC="\\d+-\\d+\\(\\d+\\)",I4="\\[\\d+-\\d+\\]",pFe="\\d+-\\d+\\(\\d+-\\d+\\)",hFe=new RegExp(`(${eF}),`,"g"),fFe=new RegExp(`(${SC}),`,"g"),mFe=[eF,SC,I4,pFe],gFe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],vFe=gFe.map(t=>{let e=t.split("").map(i=>mFe[i]).join(" ");return new RegExp(`^${e}$`)});function $X(t){return!t||vFe.some(e=>e.test(t))}function yFe(t){let e="[];()",i=["[","("],n=Object.assign({},...e.split("").map(s=>({[s]:0}))),r="",a=t.split("").map(s=>{let o=e.includes(s)&&s,l=i.includes(o);if(l&&o)return n[o]+=1,r=o,s;if(!l&&o&&r&&o!==r){n[r]-=1;let u="[];".includes(r)&&"[];"||"()".includes(r)&&"()"||"",c=u.split("").find(d=>d!==r);if(u.includes(o))n[r]||(r="");else return n[o]||(r=""),c}return s}).join("");return t!==a?a:t}function h_(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function bFe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function GT(t){let e=(i=>i?.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((n,r)=>+n-+r))===1}return!1}function Ck(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(r=>parseInt(r.join("")));e&&i.reverse();let n=i;if(Math.abs(n.reduce((r,a)=>+r-+a))>=2)return n.join("-")}function BX(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function IFe(t){return t.startsWith("(")&&t.endsWith(")")}function wFe({score:t,applied:e}){t=yFe(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let T=w.replace(")",") ");t=t.replace(w,T)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let n=/\(([\d- ]+)\)/g,r=/\(([\d- ]+)\)/,a=t.match(n);for(let w of a||[]){let[T]=w.match(r).slice(1),U=T.replace(/ /g,"");t=t.replace(w,`(${U})`)}let s=/\(\(\d-\d\)\)/g;if(s.test(t)){let w=t.match(s);w.length&&w.forEach(T=>{let U=T.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(T,U)})}if(s=/\(\((\d)\)\)/g,s.test(t)){let w=t.match(s);w.length&&w.forEach(T=>{let U=T.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(T,U)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);t=t.replace(o,"-"),["- "," -"].forEach(w=>{let T=new RegExp(`(\\d+)${w}(\\d+)`,"g"),U=t.match(T);U&&U.forEach(C=>t=t.replace(C,C.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[T]=w.match(/\((\d+), \)/).slice(1);T.length===2?t=t.replace(w,`(${T})`):T.length===1&&T==="6"&&(t=t.replace(w,"(6-0)"))});let u=/\((\d+)\/\)/g;u.test(t)&&t.match(u).forEach(w=>{let[T]=w.match(/\((\d+)\/\)/).slice(1);T.length===2?t=t.replace(w,`(${T})`):T.length===1&&T==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${T})`)});let c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(w=>{let[T]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${T},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[T]=w.match(/\(\/(\d+)\)/).slice(1);T.length===2?t=t.replace(w,`(${T})`):T.length===1&&parseInt(T)<6?t=t.replace(w,`(6-${T})`):t=t.replace(w,`(${T})`)});let p,h,f,m,g,v=()=>{g=Rl(t.split("")),h=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],f=g["["]===g["]"]+1,m=h&&!f};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[w]=t.match(y).slice(1);t=t.replace(y,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(IFe)?t=w.map(T=>{let U=T.slice(1,T.length-1);return U.length>2?U:T}).join(" "):t=w.join(" ")}v();let b=/[A-Za-z]+/.test(t),I=/\d+/.test(t);if(!b&&!I)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],T=0;for(let U of t.split("").reverse())U===")"&&(T?w.push("("):T+=1),U==="("&&(T-=1),w.push(U);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),m){let w="",T=0;for(let U of t.split(""))U==="("&&(T?w+=")":T+=1),U===")"&&(T-=1),w+=U;t=w}v(),f&&!h&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let S=w=>{let T=w.indexOf("("),U=w.indexOf(")");return T>=0&&U>=0&&T<U};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);S(w)&&(t=w,v())}return{score:t,applied:e}}function tF(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=Up("-",t.split(""));if(!e.length)return t;let i=t.split("-"),n=!(i.length%2),r=!!(e.length%2);return n&&r&&e.length>i.length/2&&e.filter((a,s)=>s%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function SFe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[hFe,fFe].forEach(i=>{let n=t.match(i);n?.length&&(n.forEach(r=>{t=t.replace(r,r.slice(0,r.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(tF).join(" "),{score:t,applied:e}}function TFe({score:t}){if(typeof t!="string")return{score:t};let e=p=>p?.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let n=t.split(" ");t=n.map(p=>{let h=/^-(\d+)$/;if(h.test(p)){let[f]=p.match(h).slice(1);if(f.length===2)return f.split("").join("-")}return p}).join(" "),n=t.split(" ");let r=n.filter(h_),a=0,s="";for(let p of r){let h=Up(p,n).filter(v=>!a||v>a)[0],f=n.slice(a,h-1),m=n[h-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((b,I)=>+b-+I));if(y===1){let b=[f.join(" "),[m,p].join("")].join(" ");s+=b,a=h+1}else if(y===0){let b=Math.max(...v);if([4,5,6,7,8,9].includes(b)){let I=[6,4].includes(b)?b+1:b-1,S=[b,I].sort().reverse().join("-"),w=[f.join(" "),[S,p].join("")].join(" ");s+=w,a=h+1}}}}if(r.length&&s.length){let p=n.slice(a).join(" ");return s=[s,p].join(" "),{score:s.trim()}}if(n.length===2&&["(","["].some(p=>n[1].includes(p))){let p=e(n[0]).split("");if(Math.abs(p.reduce((h,f)=>+h-+f,0))===1)return n[1]=i(n[1]),{score:n.join("")}}let o=n.map(p=>bFe(p)&&"bracket"||GT(p)&&"set");if(o.includes("set")&&o.includes("bracket")){let p,h="";return n.forEach((f,m)=>{o[m]==="bracket"&&p==="set"?(f=i(f),h+=f):h+=` ${f}`,p=o[m]}),{score:h.trim()}}n=t.split(" ");let l,u=n.map(p=>{let h=new RegExp(/^(\d+)-(\d+)$/);if(h.test(p)){let[f,m]=p.match(h).slice(1),g=Math.abs([f,m].reduce((y,b)=>+y-+b)),v=Math.max(f,m);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),c=Up("tiebreak",u);if(c.length){let p="";n.forEach((h,f)=>{c.includes(f)?p+=`(${h}) `:c.includes(f+1)?p+=`${h}`:p+=`${h} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,h,f]=t.match(d).slice(1),m=Math.max(h,f)>=10;!GT(p)&&m&&(t=t.replace(d,`${p} [${h}-${f}]`))}return u=[],t=t.split(" ").map(p=>{let h=/^\((.*)\)$/,f=h.test(p),m=new RegExp(I4).test(p)&&"super"||new RegExp(SC).test(p)&&"tiebreak"||new RegExp(eF).test(p)&&"standard"||"unknown";return u.push(m),m==="standard"&&f?p.match(h)[1]:p}).join(" "),{score:t}}function UFe({score:t,applied:e}){for(let U of[".",","," ","/"]){let C=new RegExp(`^(\\d+)\\${U}(\\d+)$`);if(C.test(t)){let E=t.match(C).slice(1).map(M=>parseInt(M)),P=Math.abs(E[0]-E[1]);P<=10&&P>=2&&(t=t.split(U).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[U,C,E,P,M,R]=t.match(i).slice(1);t=t.replace(i,`${U}${C}-${E} ${P}-${M}${R}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let n=/\(6,\)/g;n.test(t)&&(t=t.replace(n,"(6, 0)"),e.push("missingZeroPattern1"));let r=/^\d{3,}\(/,a=/\(\d+\)\d+/;[r,a].forEach(()=>{t=t.split(" ").map(U=>(r.test(U)&&(U=U.replace("("," (")),a.test(U)&&(U=U.replace(")",") ")),U)).join(" "),e.push("spaceConsiderationPatterns")});let s=tF(t);s!==t&&(t=s,e.push("deDashMash"));let o=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(o.test(t)){let[U,C,E]=t.match(o).slice(1),[P,M]=C.split("");t=`${U}-${P} ${M}-${E}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(t)){let[U,C]=t.match(u).slice(1),E=U.trim(),P=C.trim();if(l.test(E)&&l.test(P)){let M=E.match(l).slice(1,3).join("-"),R=P.match(l).slice(1,3).join("-");t=`${M} ${R}`,e.push("slashSeparationPattern")}}let c=/^([\d -]+),([\d -]+)$/;if(c.test(t)){let[U,C]=t.match(c).slice(1),E=U.trim(),P=C.trim();if(l.test(E)&&l.test(P)){let M=E.match(l).slice(1,3).join("-"),R=P.match(l).slice(1,3).join("-");t=`${M} ${R}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let U=t.match(d)[0],C=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,C),e.push("singleSetCommaSeparationPattern")}let p=0,h=/(\d+)-(\d{2})-(\d+)/;for(;h.test(t)&&p<3;){let[U,C,E]=t.match(h).slice(1),P=C.split(""),M=`${U}-${P[0]} ${P[1]}-${E}`;t=t.replace(h,M),e.push("noSetSeparationPattern"),p+=1}let f=/(^|\s)7-6\s(\d+)\s/g,m=t.match(f);if(m?.length){let U=/(^|\s)7-6\s(\d+)\s/;m.forEach(C=>{let E=C.match(U).slice(2)[0];t=t.replace(C,`7-6(${E}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g?.forEach(U=>{let C=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,C),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g?.forEach(U=>{let C=" "+U.slice(1).split(" ").join("-");t=t.replace(U,C),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let U=t.match(v)[0],C=U.split("/").map(E=>`(${E})`).join(" ")+" ";t=t.replace(U,C),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let b=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(b.test(t)){let U=t.match(b),C=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),E=t;U.forEach(P=>{let[M,R]=P.match(C).slice(1),N=`${M}-${R}`;E=E.replace(P,N)}),t=E,e.push("slashSetPattern")}let I=/(.*)\s(1\d)\s(\d+)$/;if(I.test(t)){let[U,C,E]=t.match(I).slice(1);U.replace(/\D/g,"").length>=4&&(t=U+` ${C}${E}`,e.push("spaceSeparatedSuperPattern"))}let S=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let U of t.match(S)||[]){let[C,E,P,M]=U.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[R,N]=E.split("-").map(A=>parseInt(A));Math.abs(R-N)===1&&(t=t.replace(U,`${C}${E}(${P})${M}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let U of t.match(w)||[]){let C=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[E,P,M]=U.match(C).slice(1),[R,N]=E.split("-").map(A=>parseInt(A));Math.abs(R-N)===1&&(t=t.replace(U,`${E}(${P})${M}`),e.push("floatingTiebreakPattern2"))}let T=/(^|\s)(\d \d)\(/g;for(let U of t.match(T)||[]){let C=/(^|\s)(\d \d)\(/,[E,P]=U.match(C).slice(1);t=t.replace(U,`${E}${P.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function DFe({score:t,matchUpStatus:e}){let i=t?.split(" ");t=i.map(o=>{if(o.endsWith("]")){let l=o.split("[");if(GT(l[0]))return l[0]+`(${l[1].slice(0,l[1].length-1)})`}return o}).join(" ");let n=new RegExp(/(\([\d ]+\))/g);if(n.test(t))for(let o of t.match(n)){let l=o.replace(" ","-").match(/\((.*)\)/)?.[1];if(br(l)&&l?.[0]>2){if([2,4].includes(l.length))l=l.split("").join("-");else if(l.length===3){let u=l.indexOf("1");l=Ck(l.split(""),u)}}t=t.replace(o,`(${l})`)}i=t?.split(" ");let r=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((o,l)=>{let u=[void 0,"","COMPLETED"].includes(e)||l!==a;if(r.test(o)&&u){let[c,d,p]=Array.from(o.match(r)).slice(1),h=Math.min(d,p);return`${c}(${h})`}return o}).join(" "),i=t?.split(" "),r=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(o=>{if(r.test(o)){let[l,u]=Array.from(o.match(r)).slice(1),c=l.split("");return`${c[0]}-${c[1]}(${u})`}return o}).join(" "),i=t?.split(" "),r=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(o=>{if(r.test(o)){let[l,u]=Array.from(o.match(r)).slice(1);return GT(l)?`${l}(${u})`:l}return o}).join(" "),i=t?.split(" "),r=new RegExp(/^1-0\((\d+)\)$/),t=i.map(o=>{if(r.test(o)){let[l]=o.match(r).slice(1);return`[${l<9?10:parseInt(l)+2}-${l}]`}return o}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let o=t.match(s)[1];t=t.replace(s,`(${o}) `)}return{score:t}}function EFe({score:t,attributes:e,identifier:i}){if(typeof t!="string")return{score:t,identifier:i};let n=new RegExp(/\([\d,/ ]+\)/g),r=t.match(n);for(let c of r||[]){let d=c.match(/^\((.*)\)$/)?.slice(1)?.[0],p=t.split(c)[0].split(")").reverse()[0].replace(/\D/g,"");if(d?.length===2&&p?.length>=2){let m=p.slice(p.length-2).split("").map(g=>parseInt(g));if(Math.abs(m[0]-m[1])===1)continue}let h=BX(d),f=tF(h);t=t.replace(c,`(${f})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);t.match(a)?.forEach(c=>{let d=BX(c.match(/^\[(.*)\]$/)[1]);t=t.replace(c,`(${d}) `).trim()});let s=[")","]"],o=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&s.some(c=>t.endsWith(c))&&o.some(c=>t.includes(c))){let c="",d=t.split(/[)\]]/).filter(Boolean).map(g=>(g.startsWith(",")&&(g=g.slice(1)),g.trim())),p=d.every(g=>g.includes(",")||h_(g)),h=d.every(g=>g.includes("/")||h_(g)),f=d.every(g=>g.includes("-")||h_(g)),m=p&&","||f&&"-"||h&&"/";if(m){let g;d.forEach(v=>{if(v.startsWith("("))if(g==="set"&&(c+=" "),v.includes(m))c+=v.slice(1).split(m).map(y=>y.trim()).join("-"),g="set";else{let y=v.slice(1);c+=`(${y}) `,g="tiebreak"}else if(v.startsWith("[")){let y=v.slice(1).split(m).map(I=>parseInt(I.trim())),b=Math.min(...y);g==="set"?c+=`(${b}) `:c+=`[${y.join("-")}] `,g="tiebreak"}}),t=c.trim()}}let l=Rl(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&GT(t)&&br(e?.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let u=/\(\)/g;return u.test(t)&&(t=t.replace(u,"").trim()),{score:t}}function hpe({score:t}){let e=t.split(""),i=[],n,r=()=>n=[void 0,void 0,void 0],a=()=>{let o=`${n[0]}-${n[1]}`;return n[2]&&(o+=` (${n[2]})`),r(),n.push(n),o};r();let s=()=>n[0]!==void 0&&n[1]!==void 0&&Math.abs(parseInt(n[0])-parseInt(n[1]));for(;e.length;){let o=e.shift(),l=br(o)&&parseInt(o),u=n[0]!==void 0&&n[1]!==void 0;if(br(l)){if(n[0]===void 0){n[0]=l;continue}if(n[1]===void 0&&(n[1]=l,s())){i.push(a()),n=[void 0,void 0];continue}if(u&&e.length===1&&br(e[0])){let c=e.pop();n[0]=n[0].toString()+n[1].toString(),n[1]=c,i.push(a()),n=[void 0,void 0]}u&&s()}}return{sets:i}}function zG(t){let e=t.indexOf("1"),i=t.split(""),n=i.every(r=>!isNaN(r));if(n&&t.length===3&&e===0){let r=Ck(i,e);if(r)return r}if(n&&t.length===7&&e>3){let r=i.slice(4),a=Ck(r,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function fpe(t){let{score:e}=t,{applied:i,matchUpStatus:n}=t,r=e?.toString().split(""),a=r?.every(o=>br(o)),s=o=>Math.abs(o[0]-o[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=r.join(""));let o=a?r.map(u=>parseInt(u)):e.split("").map(u=>parseInt(u)),{sets:l}=hpe({score:e});if(o.length,e.length===3&&s(o.slice(0,2))===1){let[u,c,d]=o;e=`${u}-${c}(${d})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&o[0]===1){let[u,c,d]=o;e=`[${u}${c}-${d}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&s(o.slice(0,2))===1&&"987654".split("").includes(o[0].toString())){let[u,c,d,p]=o,h=Math.min(d,p);e=`${u}-${c}(${h})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&o[0]===1&&o[2]===1){let[u,c,d,p]=o;e=`[${u}${c}-${d}${p}]`,i.push("bigSuper")}else if(e.length===4){let[u,c,d,p]=o;e=`${u}${c} ${d}${p}`,i.push("split4")}else if(e.length===5&&s(o.slice(0,2))===1){let[u,c,d,p,h]=o;e=`${u}-${c}(${d}) ${p}-${h}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&s(o.slice(3))===1){let[u,c,d,p,h]=o;e=`${u}-${c} ${d}-${p}(${h})`,i.push("numericTiebreakPattern5")}else if(o.length===7)if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&o[4]===1){let[u,c,d,p,h,f,m]=o;e=`${u}-${c} ${d}-${p} [${h}${f}-${m}]`,i.push("numericTiebreakPattern6")}else if(s(o.slice(0,2))===1&&s(o.slice(3,5))>1&&s(o.slice(5,7))>1){let[u,c,d,p,h,f,m]=o;e=`${u}-${c}(${d}) ${p}-${h} ${f}-${m}`,i.push("numericTiebreakPattern7")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))===1&&s(o.slice(5,7))>1){let[u,c,d,p,h,f,m]=o;e=`${u}-${c} ${d}-${p}(${h}) ${f}-${m}`,i.push("numericTiebreakPattern8")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&s(o.slice(4,6))===1){let[u,c,d,p,h,f,m]=o;e=`${u}-${c} ${d}-${p} ${h}-${f}(${m})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let u=zG(e);u&&e!==u&&i.push("parsedSuperPattern"),e=u??e}else{let u=Aa(e.split(""),2).map(v=>v.join("")),c=u.map(v=>{let[y,b]=v.split("").map(w=>parseInt(w)),I=Math.abs(y-b),S=y>b?1:2;return I>1&&S||S*-1}),d=c.reduce((v,y)=>v>0&&y>0,1),p=Rl(c),h=c.map(v=>Math.abs(v)),f=Rl(h),m=c[0]<0,g=!m&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[u.slice(0,2).join(" "),u.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(d)e=u.join(" "),i.push("chunkSplit");else if(o.length===6){if(p[1]===2||p[2]===2)if(!Object.values(f).includes(3))e=u.join(" "),i.push("chunkSplit");else{let[v,y,b,I,S,w]=o,T=c.reduce((U,C,E)=>C<0?E:U,void 0);if(T===0){let U=Math.min(b,I);e=`${v}-${y}(${U}) ${S}-${w}`,i.push("chunkSplitTiebreak1")}else if(T===1){let U=Math.min(S,w);e=`${v}-${y} ${b}-${I}(${U})`,i.push("chunkSplitTiebreak2")}else e=`${v}-${y} ${b}-${I}`,i.push("chunkSplitTrimExtraneous")}}else if(o.length===8){let[v,y,b,I,S,w,T,U]=o;m||g?o[5]===1&&(m?e=`${v}-${y}(${b}) ${I}-${S} [${w}${T}-${U}]`:e=`${v}-${y} ${b}-${I}(${S}) [${w}${T}-${U}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:n}}function mpe(t){let e=[0,0],i=[],n=t.split(" "),r=/(\d+)-(\d+)/;n.forEach(l=>{if(r.test(l)){let u=l.match(r).slice(1).map(d=>parseInt(d)),c=u[0]>u[1]&&1||u[1]>u[0]&&2;c&&(e[c-1]+=1,i.push(c))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,s=e[0]>0&&e[0]===e[1],o=e.reduce((l,u)=>l+u,0);return{setsWon:e,setsTied:s,setWinners:i,totalSets:o,winningSide:a}}function PFe({score:t,matchUpStatus:e,attributes:i}){let n=[],r,a=t.split(" "),s=a.length;t=a.map((c,d)=>{if(new RegExp(SC).test(c)){let h=c.slice(3),f=c.slice(0,3),m=f.split("-");if(!GT(f)&&!e){let g=Math.max(...m),v=f.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+h}}else if(c.length===2&&br(c))return c.split("").join("-");c=tF(c);let p=new RegExp(`^${I4}$`).test(c)&&"super"||new RegExp(`^${SC}$`).test(c)&&"tiebreak"||new RegExp(`^${eF}$`).test(c)&&"standard"||"unknown";if(n.push(p),s>1&&p==="standard"&&d<2){let[h,f]=c.split("-"),m=Math.abs(parseInt(h)-parseInt(f)),g=Math.max(h,f),v=Math.min(h,f),y=[parseInt(h),parseInt(f)].indexOf(v);if(g>9&&m>2){let b=g.toString().split(""),I=b.find(S=>parseInt(S)>v||d&&parseInt(S)<=r)??b[0];I&&(c=y?[I,v].join("-"):[v,I].join("-"))}g>(r||0)&&(r=g)}if(p==="standard"){let[h,f]=c.split("-");if(!Math.abs(parseInt(h)-parseInt(f))&&e!=="RETIRED")return""}return c}).filter(Boolean).join(" ");let{setsWon:o,setWinners:l,totalSets:u}=mpe(t);if(u===1&&i?.removed==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...o)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...o)>2){let c=[0,0];t=t.split(" ").map((d,p)=>(c[l[p]]+=1,Math.max(...c)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:n}}function CFe({score:t}){let{setsTied:e,winningSide:i}=mpe(t),n=/\s\((\d+)\)$/;if(!i&&e&&n.test(t)){let o=t.match(n).slice(1)[0],l=o<=8?10:o+2;t=t.replace(n,` [${l}-${o}]`)}let r=t.split(" "),a=r[r.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let s=a.split("(").join("").split(")").join("").split("-");if(!s.every(o=>br(o)))return{score:t};if(s[0]==="76"){let o=s[1].length===2?Math.min(...s[1].split("").map(l=>parseInt(l))):s[1];t=[...r.slice(0,r.length-1),`7-6(${o})`].join(" ")}else{s=s.map(u=>parseInt(u));let o=Math.max(...s),l=Math.abs(s[0]-s[1]);if(o>=10){if(l>2&&s.every(u=>+u>=10)){let u=s.map(c=>c===o?c-10:10).sort();l=Math.abs(u[0]-u[1]),l>2&&(s=u)}t=[...r.slice(0,r.length-1),`[${s.join("-")}]`].join(" ")}else r.length===3&&o>=7&&l>2&&(t=[...r.slice(0,r.length-1),`[${s.join("-")}]`].join(" "))}return{score:t}}function RFe({score:t}){return t=t?.toString().toLowerCase()||"",{score:t}}function MFe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function NFe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let n=i.indexOf("1");if(i.length%2){if(i.length===3&&n===0){let r=Ck(i.split(""),n);return e.push("getSuper"),r}}else{let{score:r,applied:a}=fpe({score:i,applied:[]});r!==i&&(i=r,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function AFe({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&zG(t)?{score:zG(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function _Fe({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t?.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function kFe({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let n=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(n.test(t)){let[s]=t.match(n).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let r=e?.matchUpStatuses?.retired,a=["rtd",...Array.isArray(r)?r:[r].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function xFe({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(r=>t.endsWith(r))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(r=>t.includes(r));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let n=/(.*)[A-Za-z]+$/;return n.test(t)&&(t=t.match(n).slice(1)[0].trim()),{score:t,attributes:e}}function OFe({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function LFe({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(r=>e.test(r))&&(t=i.map(r=>e.test(r)?r.replace("/","-"):r).join(" "));let n=/^(\d+), *(\d+)$/;if(n.test(t)){let[r,a]=t.match(n).slice(1);t=[r,a].join("-")}return{score:t}}function FFe({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let n of i||[]){let r=n.replace("/","-");t=t.replace(n,r)}return{score:t}}function $Fe({score:t}){if(t.includes(",")){let e=t.split(",").map(n=>n.trim()),i=n=>/\d \d/.test(n);e.every(i)&&(t=e.map(n=>{let r=/\d+ \d+/g;for(let a of n.match(r)){let[s,o]=a.match(/(\d+) (\d+)/).slice(1);n=n.replace(a,`${s}-${o}`)}return n}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>br(i))&&e.length===4&&(t=e)}return{score:t}}function BFe({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var VFe={handleTiebreakSlashSeparation:FFe,handleSetSlashSeparation:OFe,punctuationAdjustments:wFe,handleGameSeparation:LFe,joinFloatingTiebreak:TFe,handleBracketSpacing:SFe,handleSpaceSeparator:$Fe,separateScoreBlocks:NFe,matchKnownPatterns:UFe,removeDanglingBits:xFe,removeErroneous:AFe,handleWalkover:_Fe,properTiebreak:DFe,handleNumeric:fpe,handleRetired:kFe,containedSets:EFe,sensibleSets:PFe,stringScore:RFe,superSquare:CFe,setBuilder:hpe,excisions:BFe,replaceOh:MFe},sV={},jFe=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],GFe=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function gpe(t){if(!t.score)return{error:Ee};let{score:e,sheetName:i,identifier:n,fileName:r,stepLog:a,fullLog:s,profile:o}=t,l=[],u,c=[],d,p,h=e,f=g=>{g.forEach(v=>{p=VFe[v]({profile:o,identifier:n,matchUpStatus:u,attributes:d,applied:c,score:h});let y=p.score!==h;y&&l.push({method:v,score:p.score}),a&&(s||y||p.matchUpStatus!==u)&&console.log(u?{score:p.score,matchUpStatus:u}:{score:p.score},v),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(c=p.applied),h=p.score})};f(jFe);let m=$X(h);return m||(h=e.toString().replace(/\D/g,""),d?.removed&&(d.removed=void 0),f(GFe),m=$X(h),m||(h="")),c.forEach(g=>{sV[g]||(sV[g]=0),sV[g]+=1}),{matchUpStatus:u?.toUpperCase(),modifications:l,attributes:d,isValid:m,score:h}}var vpe={};Fi(vpe,{analyzeScore:()=>w4,analyzeSet:()=>TC,checkScoreHasValue:()=>ca,checkSetIsComplete:()=>JL,getSetComplement:()=>T4,getTiebreakComplement:()=>iF,isValidMatchUpFormat:()=>Ml,parseScoreString:()=>Rk,validateScore:()=>S4,validateTieFormat:()=>Lo});function w4({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){let a=r?.sets??[],s=(a?.filter(S=>S?.winningSide)||[]).reduce((S,w)=>{let{winningSide:T}=w;if(!T)return S;let U=T-1;return S[U]++,S},[0,0]),o=n?n-1:void 0,l=o!==void 0?1-o:void 0,u=o!==void 0&&s[o],c=l!==void 0&&s[l],d=e?So(e):void 0,p=Math.max(...s),h=Rl(s)[p],f=d?.setFormat?.timed||d?.finalSetFormat?.timed,m=d?.bestOf,g=m&&Math.ceil(m/2)||1,v=i??t,y=v&&[On,_a,ir].includes(v),b=!d||!a.length||a.every((S,w)=>{let T=w+1,U=T===m,C=T===a.length,{side1Score:E,side2Score:P,side1TiebreakScore:M,side2TiebreakScore:R,winningSide:N}=S,A=Math.max(E??0,P??0),_=M??R,{finalSetFormat:x,setFormat:O}=d,$=U&&x||O;if(_){let{tiebreakTo:F,NoAD:j}=$?.tiebreakFormat||{},H=Math.max(M??0,R??0);if(j&&H>F||H<F&&N&&(C&&!y||!C))return!1}return $.setTo?!(!$.noTiebreak&&A>$.setTo+1):!0}),I=(!e||p===g)&&h===1&&s.indexOf(p)+1||void 0;return{valid:!!(b&&(n&&u>c&&n===I||n&&y||!n&&!I&&(![Ur,On,_a,ir].includes(v)||f&&v===Ur)))}}function S4({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){if(typeof r!="object")return{error:Ee};let{sets:a,scoreStringSide1:s,scoreStringSide2:o}=r,l="scoreString must be a string!";if(s!==void 0&&typeof s!="string")return{error:Ee,info:l};if(o!==void 0&&typeof o!="string")return{error:Ee,info:l};if(a!==void 0&&!Array.isArray(a))return{error:Ee,info:Xy("sets")};if(a?.length){let u=a.map(d=>d?.setNumber).filter(Boolean);if(u.length!==wi(u).length)return{error:Ee,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:h,side1TiebreakScore:f,side2TiebreakScore:m,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:b}=d;if(![[p,h],[f,m],[g,v]].filter(I=>I.some(S=>![void 0,null].includes(S))).every(I=>I.every(S=>yi(S))))return{error:Ee,info:"non-numeric values"};if(![b,y].filter(I=>![void 0,null].includes(I)).every(I=>yi(I)))return{error:Ee,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:Ee,info:"winningSide must be 1 or 2"}}let{valid:c}=w4({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:n,score:r});if(!c)return{error:Fse,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var T4=t=>{let{isSide1:e,lowValue:i,setTo:n,tiebreakAt:r,NoAD:a}=t;if(i===void 0)return!1;let s=ri(i);s?.toString().length>2&&(s=parseInt(s.toString().slice(0,2))),r&&r<n&&s>r&&(s=r);let o;return a&&!r?(s>n&&(o=n),o=s<n?n:n-1):o=s+1<n&&n||r&&r<n&&s===r&&n||!r&&s+2||n+1,[e?s:o,e?o:s]},iF=t=>{let{isSide1:e,lowValue:i,tiebreakTo:n,tiebreakNoAd:r}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;a?.toString().length>2&&(a=parseInt(a.toString().slice(0,2))),r&&a>n-1&&(a=n-1);let s=HFe({lowValue:a,NoAD:r,tiebreakTo:n});return[e?a:s,e?s:a]};function HFe(t){let{lowValue:e,NoAD:i,tiebreakTo:n}=t,r=i?1:2;return e+1>=n?e+r:n}function Rk({tiebreakTo:t=7,scoreString:e=""}){return e?.split(" ").filter(Boolean).map((n,r)=>i({set:n,setNumber:r+1}));function i({set:n,setNumber:r}){let a=/\(([^)]+)\)/,s=/\[([^)]+)\]/,o=a.exec(n),l=s.exec(n),u=n?.startsWith("[")&&l&&l[1].split("-").map(b=>parseInt(b)),c=o&&n.replace(o[0],"")||l&&n.replace(l[0],"")||n,d=!u&&c.split("-").map(b=>parseInt(b)),p=u?u[0]>u[1]&&1||u[0]<u[1]&&2||void 0:d[0]>d[1]&&1||d[0]<d[1]&&2||void 0,h=o?o[1]:void 0,f=(h&&iF({lowValue:h,isSide1:p===2,tiebreakTo:t}))??[],[m,g]=d||[],[v,y]=u||f||[];return{side1Score:m,side2Score:g,side1TiebreakScore:v,side2TiebreakScore:y,winningSide:p,setNumber:r}}}function zFe({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:n,setObject:r}){if(!r)return;let a=QL({set:r});return JL({matchUpScoringFormat:t,set:r,isDecidingSet:e,isTiebreakSet:i,isTimedSet:n})&&a||void 0}function TC(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:$O};let{setNumber:n}=e||{},{bestOf:r,exactly:a}=i||{},s=r||a,o=!!(n&&s&&n===s),l=o&&i?.finalSetFormat||i?.setFormat,u=!!l?.tiebreakSet,c=!!l?.timed,d=!u&&!c,p=!!(n&&s&&n<=s),h=[e?.side1Score,e?.side2Score],f=[e?.side1PointScore,e?.side2PointScore],m=[e?.side1TiebreakScore,e?.side2TiebreakScore],g=h.filter(O=>O!==void 0).length,v=f.filter(O=>O!==void 0).length,y=m.filter(O=>O!==void 0).length,b=h?.filter(O=>!isNaN(O)).length,I=m?.filter(O=>!isNaN(O)).length,{tiebreakAt:S}=l||{},w=S&&h.filter(O=>O>=S).length===2,T=w&&(h[0]>h[1]&&1||h[1]>h[0]&&2||void 0),U=!!(I&&!b),C=!!e?.winningSide,{error:E,result:P}=qFe({sideTiebreakScores:m,sideGameScores:h,setFormat:l,setObject:e}),{error:M,result:R}=WFe({sideTiebreakScores:m,setObject:e,setFormat:l}),N=d&&!U&&P||u&&U&&R||c,A=p&&!(u&&!U)&&!(d&&U)&&(!C||N),_=zFe({isTimedSet:c,matchUpScoringFormat:i,isDecidingSet:o,isTiebreakSet:U,setObject:e}),x={expectTiebreakSet:u,expectTimedSet:c,hasTiebreakCondition:w,isCompletedSet:C,isDecidingSet:o,isTiebreakSet:U,isValidSet:A,isValidSetNumber:p,isValidSetOutcome:N,leadingSide:T,setFormat:l,sideGameScores:h,sideGameScoresCount:g,sidePointScores:f,sidePointScoresCount:v,sideTiebreakScores:m,sideTiebreakScoresCount:y,winningSide:_};return e?.winningSide!==void 0&&(U?(x.isValidTiebreakSetOutcome=R,R||(x.tiebreakSetError=M)):(x.isValidStandardSetOutcome=P,P||(x.standardSetError=E))),x}function qFe({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:n}){if(!t)return{result:!1,error:$O};let r=!!e?.tiebreakSet,a=!!e?.timed;if(!e||r||a)return{result:!1,error:Ee};if(i?.filter(T=>!isNaN(T)).length!==2)return{result:!1,error:hG};let{setTo:s,tiebreakAt:o,tiebreakFormat:l,NoAD:u}=e||{};if(!(s&&i?.find(T=>T>=s)))return{result:!1,error:hG};let c=[1,2].includes(t?.winningSide);if(!t||!c)return{result:!1,error:BO};let d=t?.winningSide-1,p=1-d,h=i[d],f=i[p],m=h-f;if(!(h>f))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=o&&l,v=n?.filter(T=>!isNaN(T)).length===2,y=n?.[d],b=n?.[p],I=o&&i.filter(T=>T>=o).length===2;if(g){let{NoAD:T,tiebreakTo:U}=l;if(I){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(U))return{result:!1,error:{message:"tiebreakTo error"}};if(!(U&&n?.find(R=>R>=U)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let C=o<s?s:s+1;if(h>C)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!b||y<b)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let E=T?1:2,P=y-b,M=b>=U-1;if(P&&M&&P<E)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(h>s&&!I)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let S=u?1:2,w=f>=s-1;return m&&w&&!I&&m<S?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>S&&h>s?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function WFe({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:$O};let n=!!e?.tiebreakSet,r=!!e?.timed;if(!e||!n||r)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t?.winningSide);if(!t||!a)return{result:!1,error:BO};let{tiebreakSet:s}=e||{},{NoAD:o,tiebreakTo:l}=s||{};if(i?.filter(g=>!isNaN(g)).length!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!i?.find(g=>g>=l))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=t?.winningSide-1,c=1-u,d=i[u],p=i[c];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let h=o?1:2,f=d-p,m=p>=l-1;return f&&m&&f<h?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}function YFe(t){let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:n,tieFormatName:r,matchUpType:a,eventType:s,isMock:o,event:l}=t,{tieFormat:u,matchUpFormat:c}=t;if(a===na&&s===na){let d=e?.structures?.find(({stage:p})=>p===Nt)?.tieFormat;u=u||d||r&&l?.tieFormat?.tieFormatName===r&&l.tieFormat||r&&dm({namedFormat:r,hydrateCollections:i,isMock:o,event:l})||l?.tieFormat||dm({event:l,isMock:o,hydrateCollections:i}),c=void 0}else c||(u=void 0,l?.matchUpFormat||(c=jc));if(u){let d=Lo({gender:l?.gender,enforceGender:n,tieFormat:u});if(d.error)return d}return{tieFormat:u,matchUpFormat:c}}function KFe(t){let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:n,qualifyingOnly:r,drawEntries:a,structureId:s,tieFormat:o,idPrefix:l,isMock:u,event:c}=t,d=t.qualifyingProfiles,p=d?.length?Tde({hasExistingDrawDefinition:!0,uuids:t.uuids,qualifyingProfiles:d,appliedPolicies:n,qualifyingOnly:r,tieFormat:o,idPrefix:l,isMock:u}):void 0;if(p?.error)return p;e.structures=e.structures?.filter(({structureId:S})=>S!==i),e.links=e.links?.filter(({source:S})=>S.structureId!==i);let{qualifiersCount:h,qualifyingDrawPositionsCount:f,qualifyingDetails:m}=p??{};f&&(p?.structures&&e.structures?.push(...p.structures),p?.links&&e.links?.push(...p.links));let g=e.structures?.find(({stage:S,stageSequence:w})=>S===Nt&&w===1),{qualifiersCount:v}=oD({stageSequence:1,drawDefinition:e,structureId:s,stage:Nt}),y=Math.max(h??0,v??0),b=Uce({qualifiersCount:y,drawDefinition:e,stage:Nt});if(b.error||(b=Uk({drawSize:f,stage:qt,drawDefinition:e}),b.error))return b;ZFe({drawDefinition:e,drawEntries:a,event:c});let I=XFe({mainStructure:g,qualifyingDetails:m,drawDefinition:e});return I.error?I:{drawDefinition:e,structureId:s}}function ZFe({drawDefinition:t,drawEntries:e,event:i}){for(let n of(e??[]).filter(({entryStage:r})=>r===qt)){let r={...n,entryStage:n.entryStage??Nt,drawDefinition:t,event:i};IW(r)}}function XFe({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){for(let n of e||[]){let{finalQualifyingRoundNumber:r,finalQualifyingStructureId:a,roundTarget:s,finishingPositions:o,linkType:l}=n,u=t&&CR({targetStructureId:t.structureId,sourceStructureId:a,sourceRoundNumber:r,finishingPositions:o,targetEntryRound:s,linkType:l})?.link;if(u?.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}function ype(t){let{participantIds:e}=t,i=t.drawDefinition?.entries?.filter(n=>{let r=n.entryStatus;return!t.restrictEntryStatus||fd.includes(r)}).map(Vi)??[];if(e){let n=e.filter(r=>!i?.includes(r));if(n?.length)return ce({result:{error:Bd},info:{invalidParticipantIds:n}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:Ee,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:Ee,info:"roundsCount must be less than 32"}:{participantIds:e}}function U4(t){let e=[],{roundsCount:i=1,drawDefinition:n,matchUpsCount:r,structureId:a,idPrefix:s,isMock:o,event:l}=t,u,c=ype(t);if(c.error)return c;for(let d of Dt(1,i+1)){let p=KL({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!u,newRound:!u,drawDefinition:n,matchUpsCount:r,structureId:a,roundNumber:u,idPrefix:s,isMock:o,event:l});if(p.error)return ce({result:p,info:{iteration:d}});p.matchUps?.length&&e.push(...p.matchUps),u=(p?.roundNumber??1)+1}return{matchUps:e}}function JFe(t){let{tournamentRecord:e,participantIds:i,scaleName:n,eventType:r,adHocRatings:a={}}=t,s=t.scaleAccessor??Ca[n]?.accessor,o=e.participants??[];for(let l of i??[]){let u=o?.find(d=>d.participantId===l),c=VX({scaleName:`${n}.${P3}`,participant:u,eventType:r});!c&&n&&(c=VX({scaleAccessor:s,participant:u,scaleName:n,eventType:r})),c&&!a[l]&&(a[l]=c)}return a}function VX({scaleType:t=Fg,scaleAccessor:e,participant:i,scaleName:n,eventType:r}){let a=(i&&_h({scaleAttributes:{eventType:r??ow,scaleType:t,scaleName:n},participant:i}))?.scaleItem?.scaleValue;return e&&Ki(a)?a[e]:a}function D4(t){let e=e$e(t);if(e?.error)return e;let i=ype(t);if(i.error)return i;let n=QFe(t);if(n.error)return n;let r=JFe(t),a=t.tournamentRecord?.isMock??t.isMock,s=t.eventType??t.event?.eventType,o=[],l=[],u;for(let c of Dt(1,(t.roundsCount??1)+1)){let d=f4({...t,participantIds:i.participantIds,structure:n.structure,ignoreLastRoundNumber:!0,iterationMatchUps:o,adHocRatings:r,roundNumber:u,eventType:s,isMock:a});if(d.error)return d;let{matchUps:p,...h}=d;h.modifiedScaleValues&&(r=h.modifiedScaleValues),l.push({...h,iteration:c,matchUpsCount:p?.length}),u=(h?.roundNumber??1)+1,p?.length&&o.push(...p)}return{...le,matchUps:o,roundResults:l}}function QFe(t){if(t.structureId)return t.structureId;let e=t.drawDefinition,i=e?.structures?.filter(r=>r.stageSequence===1)?.reduce((r,a)=>{let s=a.stage&&lw[a.stage];return Fo({structure:a})&&s>(lw[r?.stage]||1)?a:r},void 0),n=e?.structures?.find(r=>r.structureId===i?.structureId);return n?Fo({structure:n})?{structure:n}:{error:_I}:{error:or}}function e$e(t){return t.roundsCount&&typeof t.roundsCount!="number"?{error:Ee,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==Al?{error:_I}:!Array.isArray(t.drawDefinition?.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:Ee,info:"Missing Entries"}:{error:void 0}}function t$e(t){let{tournamentRecord:e,drawDefinition:i,structureId:n,idPrefix:r,isMock:a,event:s}=t,o=s?.entries?.filter(({entryStage:c,entryStatus:d})=>(!c||c===Nt)&&d&&fd.includes(d)),l=o?.map(Vi),u=o?Math.floor(o.length/2):0;if(t.automated)return i$e({...t,participantIds:l});{let c=U4({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:u,idPrefix:r,isMock:a,event:s});if(c.error)return c;c.matchUps?.length&&zL({matchUps:c.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:n,event:s})}return{...le}}function i$e(t){let{restrictEntryStatus:e,generateMatchUps:i,structureId:n,matchUpIds:r,scaleName:a,scaleAccessor:s}=t.drawMatic??{},o=D4({...t,eventType:t.drawMatic?.eventType??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:s??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:n,matchUpIds:r});return o.error?o:(o?.matchUps?.length&&zL({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:o.matchUps,event:t.event,structureId:n}),{...le})}function n$e({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:n,participantCount:r,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,seedsCount:u}){n=n??r;let c=li({drawDefinition:s,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:or};let{positionAssignments:p}=ua({structure:d}),h=p?.length||0;if(u>h)return{error:mse};let f=d.structures?.length,m=yi(o?.groupSeedingThreshold)&&o?.groupSeedingThreshold,g=CW({roundRobinGroupsCount:f,drawSize:h})?.seedGroups,{seedsCount:v}=LR({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:n,drawSize:h});return v&&a?.[Cc]&&u>v&&e&&(u=v),d.seedLimit=u,d.seedAssignments=Dt(1,u+1).map(y=>{let b=g?.find(w=>w.includes(y)),I=b&&Math.min(...b),S=m&&y>=m?I:y;return{participantId:void 0,seedNumber:y,seedValue:S}}),Ln({drawDefinition:s,structureIds:[l]}),{...le,seedLimit:u}}function b0({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:n,stageSequence:r,entries:a,event:s,stage:o}){if(!e)return{error:ot};return a=a??s?.entries??[],{scaledEntries:a.filter(c=>(!o||!c.entryStage||c.entryStage===o)&&(!r||!c.entryStageSequence||c.entryStageSequence===r)&&fd.includes(c.entryStatus)).map(c=>{let{participantId:d}=c,{scaleItem:p}=jT({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...c,...p}}).filter(c=>{let d=c.scaleValue;return!n&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(n||l)};function l(c,d){return t?u(d)-u(c):u(c)-u(d)}function u(c){return parseFloat(c.scaleValue||(t?-1:1e5))}}function bpe(t){let e="prepareStage",{drawDefinition:i}=t,{structures:n}=rd({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),r=t.preparedStructureIds||[],a=n?.find(({structureId:h})=>!r.includes(h));if(!a)return ce({result:{error:or},stack:e});let s=a?.structureId,{seedsCount:o,stageEntries:l,seedLimit:u}=d$e({...t,structureId:s});(t.seededParticipants||t.event||t.seedingScaleName)&&s$e({...t,seedsCount:o,structure:a,structureId:s});let c=t.automated!==!1&&t.drawType!==Al&&!(t.qualifyingOnly&&t.stage!==qt),d=(n?.length||0)>1,p=c?a$e({...t,multipleStructures:d,seedLimit:u,structureId:s}):{};return p?.error?ce({result:p,stack:e}):{...p,stageEntries:l,structureId:s,seedsCount:o}}function r$e({entries:t,stage:e,stageSequence:i,roundTarget:n}){return t.filter(r=>{let a=_i({name:ih,element:r})?.extension?.value;return(!r.entryStage||r.entryStage===e)&&(!i||!r.entryStageSequence||r.entryStageSequence===i)&&(!n||!a||a===n)&&Mb.includes(r.entryStatus)})}function a$e(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=PR({...t,seedsOnly:e});if(i.error)return i;let n=i?.positionAssignments,r=i?.positioningReport;return{conflicts:i.conflicts,positionAssignments:n,positioningReport:r}}function s$e(t){let{seededParticipants:e,seedingScaleName:i,entries:n,event:r}=t,a=n.map(Vi);e?o$e({...t,enteredParticipantIds:a}):(r||i)&&l$e({...t,enteredParticipantIds:a})}function o$e(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:n,tournamentRecord:r,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,structure:u,event:c}=t,d=u?f0({provisionalPositioning:e,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structure:u}):void 0;n.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=n.length).sort((p,h)=>p.seedNumber<h.seedNumber?-1:p.seedNumber<h.seedNumber?1:0).forEach(p=>{let{participantId:h,seedNumber:f,seedValue:m}=p;uD({provisionalPositioning:e,tournamentRecord:r,drawDefinition:s,seedingProfile:o,participantId:h,seedBlockInfo:d,structureId:l,seedNumber:f,seedValue:m,event:c})})}function l$e(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:n,seedAssignmentProfile:r,assignSeedsCount:a,tournamentRecord:s,drawDefinition:o,seedByRanking:l,seedingProfile:u,structureId:c,event:d}=t,{categoryName:p,ageCategoryCode:h}=d?.category||{};d?.eventType;let f=u$e({...t})||l&&c$e({...t}),m=f?.length??0;m<e&&(e=m),f?.filter(({participantId:g})=>n.includes(g)).slice(0,a||e).forEach((g,v)=>{let y=v+1,{participantId:b,scaleValue:I}=g,S=r?.[y]||I||y;uD({provisionalPositioning:i,tournamentRecord:s,drawDefinition:o,seedingProfile:u,participantId:b,structureId:c,seedNumber:y,seedValue:S,event:d})})}function u$e(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:n,entries:r,stage:a,event:s}=t,{categoryName:o,ageCategoryCode:l}=s?.category||{},u=s?.eventType,c={scaleName:i||o||l||s.eventId,scaleType:Nh,eventType:u};return b0({scaleAttributes:c,tournamentRecord:e,stageSequence:n,entries:r,stage:a}).scaledEntries}function c$e(t){let{tournamentRecord:e,stageSequence:i,event:n,entries:r,stage:a}=t,{categoryName:s,ageCategoryCode:o}=n?.category||{},l=n?.eventType;return b0({scaleAttributes:{scaleName:s||o,scaleType:zg,eventType:l},tournamentRecord:e,stageSequence:i,entries:r,stage:a}).scaledEntries}function d$e(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=r$e(t);e>i.length&&(e=i.length);let{seedLimit:n}=n$e({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return n&&n<e&&(e=n),{seedsCount:e,stageEntries:i,seedLimit:n}}function p$e(t){let e=p4({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:n=!0,ignoreStageSpace:r,appliedPolicies:a,qualifyingOnly:s,seedingProfile:o,participants:l,drawEntries:u,placeByes:c,drawSize:d,drawType:p,entries:h}=t,f=[],m=[],g=h$e({ignoreStageSpace:r,drawDefinition:i,drawEntries:u,drawType:p,entries:h});if(g.error)return g;let v=p===Tb?0:ri(t.seedsCount??0),y=bpe({...t,qualifyingOnly:!d||s,appliedPolicies:a,drawDefinition:i,seedingProfile:o,participants:l,stage:Nt,seedsCount:v,placeByes:c,drawSize:d,entries:h});if(y.error&&!y.conflicts)return y;y.positioningReport?.length&&f.push({[Nt]:y.positioningReport});let b=y.structureId;return y.conflicts&&(m=y.conflicts),p===Al&&t.roundsCount&&t$e({...t,drawDefinition:i,structureId:b}),{drawDefinition:i,positioningReports:f,conflicts:m,structureId:b}}function h$e(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:n,drawType:r,entries:a}=t;for(let s of a){if(n&&s.entryStage&&s.entryStage!==Nt)continue;let o={...s,ignoreStageSpace:e??r===Al,entryStage:s.entryStage??Nt,event:t.event,drawDefinition:i,drawType:r},l=IW(o);if(n&&l.error)return l}return{error:void 0}}var f$e=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),m$e=f$e;function g$e(t){let{drawId:e=mn(),processCodes:i,matchUpType:n,drawType:r}=t??{},a=m$e();return Object.assign(a,{processCodes:i,matchUpType:n,drawType:r,drawId:e})}function E4(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:n,matchUpFormat:r,structureId:a,matchUpId:s,event:o}=t,l=zt(t,[{[zs]:!0,[w3]:!0}]);if(l.error)return l;if(!Ml({matchUpFormat:r}))return{error:V1};let u="setMatchUpFormat";if(s){let c=Qn({drawDefinition:n,matchUpId:s,event:o});if(c.error)return c;let d=c.matchUp;if(d?.matchUpType===na)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:rl};d&&(d.matchUpFormat=r,Zi({tournamentId:i?.tournamentId,eventId:o?.eventId,context:u,drawDefinition:n,matchUp:d}))}else if(Array.isArray(e)){if(o?.eventType===na)return{error:Hh};for(let c of e){let d=li({drawDefinition:n,structureId:c});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=r)}}else if(a){if(o?.eventType===na)return{error:Hh};let c=li({drawDefinition:n,structureId:a});if(c.error)return c;c.structure&&(c.structure.matchUpFormat=r)}else n&&(n.matchUpFormat=r);return e=e??(a?[a]:void 0),Ln({drawDefinition:n,structureIds:e}),{...le}}function v$e({tieFormat:t}){let e=Lo({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=mn());return{tieFormat:t}}function y$e({existingQualifyingStructures:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:n,matchUpType:r,tieFormat:a,event:s}){if((n||a)&&!(n&&s?.matchUpFormat===n||s?.tieFormat&&a&&JSON.stringify(s.tieFormat)===JSON.stringify(a))){if(a){let o=v$e({tieFormat:a});if(o.error)return o;let l=t?.every(u=>u.tieFormat);(!t?.length||l)&&(i.tieFormat=o.tieFormat??a)}else if(n){let o=E4({tournamentRecord:e,drawDefinition:i,matchUpFormat:n,event:s});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}r&&(i.matchUpType=r)}return{error:void 0}}var P4={};Fi(P4,{attachPolicies:()=>Jy,findPolicy:()=>Cb,getAppliedPolicies:()=>sn,getPolicyDefinitions:()=>Hm,mutate:()=>Ipe,query:()=>Spe,removePolicy:()=>wpe});var Ipe={};Fi(Ipe,{attachPolicies:()=>Jy,removePolicy:()=>wpe});function wpe(t){let e=zt(t,[{[__e]:!0,_anyOf:{[js]:!1,[ha]:!1,[zs]:!1,[Gm]:!1}}]);if(e.error)return e;let i,n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n)return jX(t,n);if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:ot};for(let a of r){let s=t.tournamentRecords[a],o=jX(t,s);if(o.error)return o;i=!0}}else return{error:ot};return i?{...le}:{error:j1}}function jX(t,e){let i=sn(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?un({element:e,extension:{name:pC,value:i}}):lo({element:e,name:pC}),{...le}):{error:j1}}var Spe={};Fi(Spe,{findPolicy:()=>Cb,getAppliedPolicies:()=>sn,getPolicyDefinitions:()=>Hm});var Tpe={[Cc]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Kh]:{positioning:Hy},[id]:{positioning:Hy}},positioning:T_e},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},qG=Tpe;function b$e({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:n}){if(e&&typeof e!="object")return ce({info:"policyDefinitions must be an object",result:{error:Ee},stack:n});let r={[dC]:t?.[dC]};return e?I$e({policyDefinitions:e,appliedPolicies:t,policiesToAttach:r,drawDefinition:i}):r.avoidance&&Jy({drawDefinition:i,policyDefinitions:r}),!t?.[Cc]&&!e?.[Cc]&&(Jy({policyDefinitions:qG,drawDefinition:i}),t&&Object.assign(t,qG)),{error:void 0}}function I$e({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:n}){for(let r of Object.keys(t))JSON.stringify(e?.[r])!==JSON.stringify(t[r])&&(i[r]=t[r]);Object.keys(i).length&&(Jy({policyDefinitions:i,drawDefinition:n}),e&&Object.assign(e,i))}function w$e(t){let{tournamentRecord:e,policyDefinitions:i,appliedPolicies:n,matchUpFormat:r,matchUpType:a,tieFormat:s,drawType:o,stack:l,event:u}=t,c=t.drawId?u?.drawDefinitions?.find(v=>v.drawId===t.drawId):void 0,d=c?.structures?.find(v=>v.stage===Nt&&v.stageSequence===1)?.structureId,p=c?c.structures?.filter(v=>v.stage===qt):[],h=p?.length===1&&!p[0].matchUps?.length&&p[0].structureId;c&&o!==c.drawType&&(c.drawType=o);let f=c??g$e({processCodes:t.processCodes,drawId:t.drawId,drawType:o}),m=y$e({existingQualifyingStructures:p,tournamentRecord:e,drawDefinition:f,matchUpFormat:r,matchUpType:a,tieFormat:s,event:u});if(m.error)return ce({result:m,stack:l});let g=b$e({appliedPolicies:n,policyDefinitions:i,drawDefinition:f,stack:l});return g.error?g:{drawDefinition:f,structureId:d,existingDrawDefinition:c,existingQualifyingPlaceholderStructureId:h}}function S$e(t){let e="generateOrGetExisting",i=[],n=[],r=w$e(t);if(r.error)return ce({result:r,stack:e});let a=r.existingDrawDefinition,s=r.drawDefinition??{},o=r.structureId,l=t.drawEntries??t.eventEntries??[],u=r.existingQualifyingPlaceholderStructureId&&KFe({...t,...r})||p$e({...t,...r,entries:l});return u.error?ce({result:u,stack:e}):(u.positioningReports?.length&&i.push(...u.positioningReports??[]),u.conflicts?.length&&n.push(...u.conflicts??[]),s=u.drawDefinition,o=u.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:s,structureId:o,conflicts:n,entries:l})}function T$e(t){let{qualifyingPlaceholder:e,existingDrawDefinition:i,positioningReports:n,qualifyingProfiles:r,appliedPolicies:a,qualifyingOnly:s,drawDefinition:o,seedingProfile:l,participants:u,structureId:c,tieFormat:d,entries:p,stack:h}=t,f=e&&!r?.length&&!i,m=[];if(r){let g=(I,S)=>I.stageSequence-S.stageSequence,v=(I,S)=>I.roundTarget-S.roundTarget,y=[],b=1;r.sort(v);for(let I of r){if(!Array.isArray(I.structureProfiles))return ce({info:Xy("structureProfiles"),result:{error:Zt},stack:h});b=I.roundTarget||b;let S=I.structureProfiles?.sort(g)||[],w=1;for(let T of S){let{qualifyingRoundNumber:U,qualifyingPositions:C,seededParticipants:E,seedingScaleName:P,seedsCount:M=0,seedByRanking:R,placeByes:N,drawSize:A}=T,_=bpe({...t,seedingProfile:T.seedingProfile??l,stageSequence:w,qualifyingRoundNumber:U,preparedStructureIds:y,qualifyingPositions:C,seededParticipants:E,stage:qt,seedingScaleName:P,appliedPolicies:a,drawDefinition:o,qualifyingOnly:s,seedByRanking:R,participants:u,roundTarget:b,seedsCount:M,placeByes:N,drawSize:A,entries:p});if(_.error)return _;_.structureId&&y.push(_.structureId),w+=1,_.conflicts?.length&&m.push(..._.conflicts),_.positioningReport?.length&&n.push({[qt]:_.positioningReport})}b+=1}}else if(c&&f){let g=Vu({structureName:Is(qt),stage:qt,qualifyingOnly:s,tieFormat:d}),{link:v}=CR({sourceStructureId:g.structureId,targetStructureId:c,sourceRoundNumber:0,linkType:qh});o.structures||(o.structures=[]),o.structures.push(g),o.links||(o.links=[]),o.links.push(v)}return{qualifyingConflicts:m,error:void 0}}var $R={};Fi($R,{addGoesTo:()=>Zy,allCompetitionMatchUps:()=>jd,allDrawMatchUps:()=>uo,allEventMatchUps:()=>gf,allPlayoffPositionsFilled:()=>xW,allTournamentMatchUps:()=>Za,analyzeDraws:()=>xR,analyzeMatchUp:()=>DC,analyzeTournament:()=>L4,bulkUpdatePublishedEventIds:()=>$4,calculateWinCriteria:()=>w0,categoryCanContain:()=>Y1,checkMatchUpIsComplete:()=>Py,checkValidEntries:()=>YL,compareTieFormats:()=>bm,competitionScheduleMatchUps:()=>HR,courtGridRows:()=>fF,credits:()=>U$e,drawMatchUps:()=>Q4,eventMatchUps:()=>vF,filterMatchUps:()=>qf,filterParticipants:()=>SR,findDrawDefinition:()=>a4,findExtension:()=>_i,findVenue:()=>mf,getAggregateTeamResults:()=>O4,getAllDrawMatchUps:()=>Kr,getAllEventData:()=>B4,getAllStructureMatchUps:()=>cn,getAllowedDrawTypes:()=>nF,getAllowedMatchUpFormats:()=>_4,getAppliedPolicies:()=>sn,getAssignedParticipantIds:()=>Ab,getAvailableMatchUpsCount:()=>qL,getAvailablePlayoffProfiles:()=>MR,getCategoryAgeDetails:()=>sw,getCheckedInParticipantIds:()=>l0,getCompetitionDateRange:()=>aF,getCompetitionMatchUps:()=>UC,getCompetitionParticipants:()=>C4,getCompetitionPenalties:()=>k4,getCompetitionVenues:()=>BR,getCourtInfo:()=>RL,getCourts:()=>e5,getDrawData:()=>lF,getDrawDefinitionTimeItem:()=>nW,getDrawParticipantRepresentativeIds:()=>n4,getDrawStructures:()=>rd,getDrawTypeCoercion:()=>OR,getEligibleVoluntaryConsolationParticipants:()=>i4,getEntriesAndSeedsCount:()=>mF,getEvent:()=>n5,getEventData:()=>uF,getEventMatchUpFormatTiming:()=>H4,getEventProperties:()=>t5,getEventPublishStatus:()=>sc,getEventStructures:()=>LL,getEventTimeItem:()=>aR,getEvents:()=>i5,getFlightProfile:()=>Cr,getHomeParticipantId:()=>Y4,getLinkedTournamentIds:()=>iR,getMatchUpCompetitiveProfile:()=>fR,getMatchUpContextIds:()=>K4,getMatchUpDailyLimits:()=>bF,getMatchUpDailyLimitsUpdate:()=>z4,getMatchUpDependencies:()=>gd,getMatchUpFormat:()=>Z4,getMatchUpFormatTiming:()=>mR,getMatchUpFormatTimingUpdate:()=>G4,getMatchUpScheduleDetails:()=>ML,getMatchUpType:()=>NL,getMatchUpsMap:()=>us,getMatchUpsStats:()=>X4,getMatchUpsToSchedule:()=>cF,getMaxEntryPosition:()=>j4,getModifiedMatchUpFormatTiming:()=>gF,getPairedParticipant:()=>ad,getParticipantEventDetails:()=>R4,getParticipantIdFinishingPositions:()=>r4,getParticipantMembership:()=>M4,getParticipantResults:()=>NR,getParticipantScaleItem:()=>jT,getParticipantSchedules:()=>N4,getParticipantSignInStatus:()=>A4,getParticipantTimeItem:()=>rW,getParticipants:()=>dr,getPersonRequests:()=>xb,getPolicyDefinitions:()=>Hm,getPositionAssignments:()=>wC,getPositionsPlayedOff:()=>dD,getPredictiveAccuracy:()=>W4,getProfileRounds:()=>hF,getPublishState:()=>p0,getRandomQualifierList:()=>u4,getRoundMatchUps:()=>go,getRounds:()=>J4,getScaleValues:()=>eD,getScaledEntries:()=>b0,getScheduledRoundsDetails:()=>VR,getSchedulingProfile:()=>Ym,getSchedulingProfileIssues:()=>V4,getSeedingThresholds:()=>RW,getSeedsCount:()=>LR,getStructureSeedAssignments:()=>Zu,getTeamLineUp:()=>Ky,getTieFormat:()=>oF,getTimeItem:()=>nc,getTournamentIds:()=>eR,getTournamentInfo:()=>I0,getTournamentPenalties:()=>rF,getTournamentPersons:()=>x4,getTournamentPoints:()=>sF,getTournamentPublishStatus:()=>wR,getTournamentStructures:()=>kW,getTournamentTimeItem:()=>TL,getValidGroupSizes:()=>DR,getVenueData:()=>BT,getVenuesAndCourts:()=>Wm,isAdHoc:()=>Fo,isCompletedStructure:()=>ef,isValidForQualifying:()=>c4,isValidMatchUpFormat:()=>Ml,matchUpActions:()=>WL,participantScaleItem:()=>_h,participantScheduledMatchUps:()=>q4,positionActions:()=>l4,publicFindCourt:()=>mW,publicFindVenue:()=>fW,tallyParticipantResults:()=>pD,tieFormatGenderValidityCheck:()=>JO,tournamentMatchUps:()=>yF,validMatchUp:()=>UL,validMatchUps:()=>ac,validateCollectionDefinition:()=>K1,validateLineUp:()=>OL});function U$e(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Miro, Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var Upe={};Fi(Upe,{filterParticipants:()=>SR,getCompetitionParticipants:()=>C4,getPairedParticipant:()=>ad,getParticipantEventDetails:()=>R4,getParticipantMembership:()=>M4,getParticipantScaleItem:()=>jT,getParticipantSchedules:()=>N4,getParticipantSignInStatus:()=>A4,getParticipantTimeItem:()=>rW,getParticipants:()=>dr,getScaleValues:()=>eD,participantScaleItem:()=>_h,validateLineUp:()=>OL});function C4(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:fr};let i=[],n={},r={},a={},s=[],o={},l=[];for(let u of Object.values(e)){let{participantIdsWithConflicts:c,mappedMatchUps:d,participantMap:p,participants:h,matchUps:f,derivedEventInfo:m,derivedDrawInfo:g}=dr({...t,tournamentRecord:u});Object.assign(o,d),Object.assign(n,p),Object.assign(r,m),Object.assign(a,g),i.push(...h??[]),s.push(...f??[]),c?.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:r,derivedDrawInfo:a,participantMap:n,mappedMatchUps:o,participants:i,...le,matchUps:s}}function R4({tournamentRecord:t,participantId:e}){if(!t)return{error:ot};if(!e)return{error:la};let i=[e].concat((t.participants??[]).filter(n=>n?.participantType&&[wn,Ni].includes(n.participantType)&&n.individualParticipantIds?.includes(e)).map(n=>n.participantId));return{eventDetails:(t.events??[]).filter(n=>{let r=(n?.entries??[]).map(a=>a.participantId);return mo(r,i)}).map(n=>({eventName:n.eventName,eventId:n.eventId}))}}function M4({tournamentRecord:t,participantId:e}){if(!t)return{error:ot};if(!e)return{error:la};let{participants:i}=dr({participantFilters:{participantTypes:[wn,Ni,Iu]},tournamentRecord:t});return(i??[]).filter(n=>n.individualParticipantIds?.includes(e)).reduce((n,r)=>{let a=r.participantType;return a&&(n[a]||(n[a]=[]),n[a].push(r)),n},{})}function N4({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:ot};if(typeof t!="object")return{error:jm,context:{participantFilters:t}};let i={eventIds:t.eventIds},n=Za({tournamentRecord:e,contextFilters:i}).matchUps??[],r=Object.assign({},...n.map(l=>({[l.matchUpId]:l}))),a=n.filter(({schedule:l})=>l&&Object.keys(l).length),s=gd({tournamentRecord:e,matchUps:n}).sourceMatchUpIds??[],o={};for(let l of a){let{sides:u}=l,c,d=u?.map(h=>{if(h.participant)return[h.participant].concat(...h.participant.individualParticipants||[]);s[l.matchUpId]&&!c&&(c=(s[l.matchUpId]||[]).map(f=>r[f]).filter(({winningSide:f,bye:m})=>!f&&!m))}).filter(Boolean).flat()??[];for(let h of d){let{participantId:f}=h;o[f]||(o[f]={potentialMatchUps:[],participant:h,matchUps:[]}),o[f].matchUps.push(l)}let p=c?.map(({sides:h})=>h).flat().map(({participant:h})=>h&&[h].concat(...h.individualParticipants||[])).filter(Boolean).flat()||[];for(let h of p){let{participantId:f}=h;o[f]||(o[f]={potentialMatchUps:[],participant:h,matchUps:[]}),o[f].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(o).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...le}}function A4({tournamentRecord:t,participantId:e}){if(!t)return{error:ot};if(!e)return{error:la};let{participant:i}=Uv({tournamentRecord:t,participantId:e});if(!i)return{error:Nr};let{timeItem:n}=nc({itemType:rR,element:i});return n&&n.itemValue===mC&&mC}var Dpe={};Fi(Dpe,{analyzeDraws:()=>xR,analyzeTournament:()=>L4,getAggregateTeamResults:()=>O4,getAllowedDrawTypes:()=>nF,getAllowedMatchUpFormats:()=>_4,getAppliedPolicies:()=>sn,getCompetitionDateRange:()=>aF,getCompetitionPenalties:()=>k4,getPolicyDefinitions:()=>Hm,getTournamentInfo:()=>I0,getTournamentPenalties:()=>rF,getTournamentPersons:()=>x4,getTournamentPoints:()=>sF,getTournamentStructures:()=>kW,getTournamentTimeItem:()=>TL});function _4({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:ot};let{appliedPolicies:n}=sn({tournamentRecord:t});return(n?.[Ku]?.matchUpFormats||[]).filter(({categoryNames:r,categoryTypes:a})=>!e&&!a||e&&r?.includes(e)||i&&a?.includes(i))}function nF({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:ot};let{appliedPolicies:n}=sn({tournamentRecord:t});return(n?.[hk]?.allowedDrawTypes||[]).filter(({categoryNames:r,categoryTypes:a})=>!e&&!a||e&&r?.includes(e)||i&&a?.includes(i))}function rF({tournamentRecord:t}){if(!t)return{error:ot};let e=(t?.participants??[]).reduce((i,n)=>{let{participantId:r}=n;return(n.penalties??[]).forEach(a=>{let{penaltyId:s}=a||{};i[s]?i[s].participants.push(r):i[s]={...a,participantIds:[r]}}),i},{});return{penalties:Object.values(e)}}function k4({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:fr};let e=[];for(let i of Object.values(t)){let{penalties:n}=rF({tournamentRecord:i});e.push(...n??[])}return{penalties:e}}function Epe({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:s,category:o,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:h,notes:f})=>({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:s,category:o,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:h,notes:f}))(t)}}var D$e={[tD]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},E$e=D$e;function I0(t){let{tournamentRecord:e}=t??{};if(!e)return{error:ot};let i=(({tournamentId:o,tournamentRank:l,tournamentStatus:u,formalName:c,tournamentName:d,promotionalName:p,onlineResources:h,localTimeZone:f,activeDates:m,startDate:g,endDate:v,hostCountryCode:y,venues:b,notes:I,updatedAt:S})=>({tournamentId:o,tournamentRank:l,tournamentStatus:u,formalName:c,tournamentName:d,promotionalName:p,onlineResources:h,localTimeZone:f,activeDates:m,startDate:g,endDate:v,hostCountryCode:y,venues:b,notes:I,updatedAt:S}))(e),n=dr({participantFilters:{participantRoles:[Hue,SW,zue,que,Yue]},policyDefinitions:E$e,tournamentRecord:e})?.participants??[];n&&(i.tournamentContacts=n);let r=p0({tournamentRecord:e})?.publishState,a=r?.tournament?.status?.publishedEventIds||[],s=[];for(let o of e.events??[])if(!t?.usePublishState||a.includes(o.eventId)){let l=Epe({event:o}).eventInfo;l&&s.push(l)}return i.timeItemValues=ede({element:e}),i.publishState=r?.tournament,i.eventInfo=s,{tournamentInfo:Ct(Vt(i),!1,!0),...le}}function aF({tournamentRecords:t}){if(!Ki(t))return{error:fr};let e=Object.keys(t??{}).reduce((r,a)=>{let s=t[a],{tournamentInfo:{startDate:o,endDate:l}}=I0({tournamentRecord:s}),u=o&&new Date(Pi(o));(!r.startDate||u&&u<r.startDate)&&(r.startDate=u);let c=l&&new Date(Pi(l));return(!r.endDate||c&&c>r.endDate)&&(r.endDate=c),r},{startDate:void 0,endDate:void 0}),i=e.startDate&&Pi(e.startDate.toISOString()),n=e.endDate&&Pi(e.endDate.toISOString());return!i||!n?{error:kse}:{startDate:i,endDate:n}}function x4({tournamentRecord:t,participantFilters:e}){if(!t)return{error:ot};let i=t.participants||[];e&&(i=SR({participants:i,participantFilters:e,tournamentRecord:t}));let n={},r=a=>{if(a.person){let{personId:s}=a.person;n[s]?n[s].participantIds.push(a.participantId):n[s]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&r(a)}),{tournamentPersons:Object.values(n)}}function O4(t){let e=zt(t,[{[ha]:!0}]);if(e.error)return e;let i=t.finishingPositionRangeBounsPoints||{},n={},r=d=>{let p=d?.individualParticipants?.map(h=>h.teams?.length===1&&h.teams[0]);return d?.teams?.length===1&&d?.teams?.[0]||p?.[0].participantId===p?.[1].participantId&&p?.[0]},{matchUps:a,participants:s}=dr({participantFilters:{participantTypes:[ji]},withRankingProfile:!0,withStatistics:!0,...t});for(let d of s??[]){if(d.participantType===_o)continue;d.draws?.[0]?.drawId==="draw-0-3"&&console.log(d.participantType,d.draws[0].finishingPositionRange);let p=r(d);if(p)for(let h of d?.draws??[]){let f=h?.finishingPositionRange?.join("-");if(f&&i?.[f]){let m=p?.participantId,g=h?.drawId,v=`${m}|${g}|${f}`;n[v]=i[f]}}}let o=d=>({teamName:d,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),l=(d,p,h)=>{d[p]===void 0&&(d[p]=0),d[p]+=h},u={},c={};for(let d of a??[]){let{sides:p,matchUpFormat:h}=d,f=h&&So(h);if(p?.length===2&&f.setFormat?.timed&&(!f.finalSetFormat||f.finalSetFormat?.timed))for(let m of p){let g=r(m.participant),v=g?.participantId,y=m.participant?.participantId,b=g?.participantName,I=m.sideNumber,S=m.participant?.individualParticipantIds||y&&[y]||[];if(S.forEach(w=>{w&&!u[w]&&(u[w]=o(b))}),v&&I){c[v]||(c[v]=o(b));let w=[...S.map(U=>u[U]),c[v]];d.winningSide&&(I===d.winningSide?w.forEach(U=>l(U,"win",1)):w.forEach(U=>l(U,"loss",1)));let T=d.score?.sets||[];for(let U of T){let C=U?.[`side${3-I}Score`]||0,E=U?.[`side${I}Score`]||0,P=E-C;w.forEach(M=>l(M,"pointsPlayed",E+C)),w.forEach(M=>l(M,"points",E)),w.forEach(M=>l(M,"diff",P))}}}}for(let d of Object.keys(n)){let[p]=d.split("|");c[p]&&(c[p].bonus+=n[d],c[p].pointsPct=parseFloat((c[p].points/c[p].pointsPlayed).toFixed(2)),c[p].standingPoints=c[p].win+c[p].bonus)}for(let d of Object.keys(u))u[d].pointsPct=parseFloat((u[d].points/u[d].pointsPlayed).toFixed(2));return{...le,individualResults:u,teamResults:c}}function P$e(t){let e=t.participants?.filter(({participantType:a})=>a===wn)?.length===2,i=t.events?.length===1&&t.events[0],n=i?.drawDefinitions?.length===1&&i.drawDefinitions[0],r=(n?.structures?.length===1&&n.structures[0])?.positionAssignments?.length===2;return!!(i.tieFormat&&e&&r)}function L4({tournamentRecord:t}){if(!t)return{error:ot};let{drawsAnalysis:e}=xR({tournamentRecord:t}),i={isDual:P$e(t),drawsAnalysis:e},n=dr({tournamentRecord:t});return n.missingParticipantIds?.length&&(i.missingParticipantIds=n.missingParticipantIds),{...le,analysis:i}}function Ppe(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function C$e(t){let{participation:e={},awardProfiles:i,startDate:n,eventType:r,drawSize:a,drawType:s,category:o,endDate:l,level:u}=t,{participationOrder:c,flightNumber:d,rankingStage:p}=e,h=f=>!n&&!l||!f.dateRanges?!0:f.dateRanges.some(m=>{let g=!n||!m.startDate||new Date(n)>new Date(m.startDate),v=!l||!m.endDate||new Date(l)<=new Date(m.endDate);return g&&v});return{awardProfile:i.find(f=>h(f)&&(!f.maxFlightNumber||d<=f.maxFlightNumber)&&(!f.drawTypes?.length||f.drawTypes?.includes(s))&&(!f.drawSizes?.length||f.drawSizes.includes(a))&&(!f.stages?.length||f.stages.includes(p))&&(!f.levels?.length||f.levels.includes(u))&&(!f.maxDrawSize||a<=f.maxDrawSize)&&(!f.drawSize||f.drawSize===a)&&(!f.maxLevel||u<=f.maxLevel)&&(!d||!f.flights?.flightNumbers?.length||f.flights.flightNumbers.includes(d))&&(!f.participationOrder||f.participationOrder===c)&&(!f.category?.ageCategoryCodes||f.category.ageCategoryCodes.includes(o?.ageCategoryCode))&&(!f.eventTypes?.length||f.eventTypes?.includes(r)))}}function GX({participantWon:t,flightNumber:e,valueObj:i,drawSize:n,flights:r,level:a}){let s=(f,m)=>{if(f){if(Array.isArray(m)){let g=m.find(v=>v.flight===f||v.f===f);return g.value||g.v}if(typeof m=="object"){let g=m.flights||m.f;if(Array.isArray(g))return g[f-1]}}},o=(f,m)=>{let g=f?.value||f?.v||(yi(f)?f:0),v=Ppe(a,f?.level);return{value:s(m,v)||yi(v)&&v||g}},l=0,u,c,d,p,h=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let f=i.find(v=>v.drawSize===n||v.drawSizes?.includes(n)),m=i.find(v=>v.drawSize&&v.threshold&&n>v.drawSize),g=i.find(v=>!v.drawSize&&!v.drawSizes?.length);h!==void 0&&(f=f?.[h],m=m?.[h],g=g?.[h]),c=o(f,e).value,d=o(m,e).value,p=o(g,e).value,l=c||d||p,u=c&&f.requireWin||d&&m.requireWin||g?.requireWin}else if(typeof i=="object"){let f=i?.drawSizes?.[n],m=i;h!==void 0&&(f=f?.[h],m=m?.[h]),c=o(f,e).value,p=o(m,e).value,l=c||p,u=c?f.requireWin:m?.requireWin}else yi(i)&&h===void 0&&(l=i);return e&&r?.pct?.[e]&&(l=Math.round(l*r.pct[e])),{awardPoints:l,requireWin:u}}function sF({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:n}){if(!i)return{error:ot};let{policyDefinitions:r}=Hm({policyTypes:[a_],tournamentRecord:i}),a=e?.[a_]??r?.[a_];if(!a)return{error:FO};let s=a.awardProfiles,o=a.requireWinFirstRound,l=a.requireWinForPoints,{participants:u,derivedEventInfo:c,derivedDrawInfo:d,mappedMatchUps:p}=dr({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),h=u?.filter(v=>v.draws?.length),f={},m={},g={};for(let v of h??[]){let{participantType:y,participantId:b,person:I,draws:S}=v;for(let w of S){let{drawId:T,structureParticipation:U,eventId:C}=w,E=c[C],P=d[T],M=P?.drawType,{category:R,eventType:N}=E||{},A=w.startDate||E.startDate||i.startDate,_=w.endDate||E.endDate||i.endDate;if(N===Nl&&b!==_o)continue;let x;if(s){let O=l,$=0,F=0,j=0,H;for(let G of U){let{finishingPositionRange:W,participationOrder:q,participantWon:Z,flightNumber:K,rankingStage:Q,winCount:J}=G;$+=J||0;let ne=P?.drawSize,{awardProfile:re}=C$e({awardProfiles:s,participation:G,eventType:N,startDate:A,category:R,drawSize:ne,drawType:M,endDate:_,level:n});if(re){if(!ne)continue;let oe=Array.isArray(W)&&Math.max(...W),de=wi(W||[]).join("-"),se=oe&&Q!==qt&&W?.includes(ne);re.requireWinForPoints!==void 0&&(O=re.requireWinForPoints),re.requireWinFirstRound!==void 0&&(o=re.requireWinFirstRound);let{finishingPositionPoints:ge={},finishingPositionRanges:ye,finishingRound:Te,pointsPerWin:De,flights:xe}=re,Me=Array.isArray(re.perWinPoints)?re.perWinPoints?.find(mt=>mt.participationOrders?.includes(q)):re.perWinPoints,Oe=ge.participationOrders,at=0,Fe;if((!Oe||Oe.includes(q))&&ye&&oe){let mt=ye[oe];mt&&({awardPoints:at,requireWin:Fe}=GX({flightNumber:K,valueObj:mt,drawSize:ne,flights:xe,level:n}))}if(!at&&Te&&q===1&&oe){let mt=Te[oe];mt&&({awardPoints:at,requireWin:Fe}=GX({participantWon:Z,flightNumber:K,valueObj:mt,drawSize:ne,flights:xe,level:n}))}if(se&&o!==void 0&&(O=o),Fe!==void 0&&(O=Fe),at>F&&(!O||J)&&(F=at,H=oe),!at&&De&&J&&(j+=J*De,H=de),!at&&J&&Me){let mt=Ppe(n,Me?.level);mt?j+=J*mt:Me.value&&(j+=J*Me.value)}}if(x=F+j,y===_o){let oe=(v.matchUps||[]).filter(({structureId:de})=>de===G.structureId);for(let{matchUpId:de}of oe){let se=p[de],ge=se.sides.find(ye=>ye.participantId===b).sideNumber;if(se.winningSice===ge)for(let ye of se.tieMatchUps)ye.winningSide}}}if(j||F){let G={winCount:$,positionPoints:F,rangeAccessor:H,perWinPoints:j,eventType:N,drawId:T,points:x},W=I?.personId;W?(f[W]||(f[W]=[]),f[W].push(G)):y===Ni?(g[b]||(g[b]=[]),g[b].push(G)):y===_o&&(m[b]||(m[b]=[]),m[b].push(G))}}}}return{participantsWithOutcomes:h,personPoints:f,pairPoints:g,teamPoints:m,...le}}var Cpe={};Fi(Cpe,{compareTieFormats:()=>bm,getTieFormat:()=>oF,tieFormatGenderValidityCheck:()=>JO,validateCollectionDefinition:()=>K1});function Mk(t){if(!t)return{};let e=[],i=t.tieFormatName,n=t.collectionDefinitions?.map(r=>{let{matchUpType:a,matchUpFormat:s,matchUpCount:o,category:l,gender:u}=r;e.includes(s)||e.push(s);let c=l?.ageCategoryCode;return[o,a===jy?"D":"S",c,s,u].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:n}}function bm({considerations:t={},descendant:e,ancestor:i}){let n={},r={},{matchUpFormats:a,tieFormatDesc:s}=Mk(e),{matchUpFormats:o,tieFormatDesc:l}=Mk(i),u=wi((a??[]).filter(S=>!(o??[]).includes(S)).concat((o??[]).filter(S=>!(a??[]).includes(S)))),c=!!(t?.collectionName&&e.collectionDefinitions.map(({collectionName:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionName:S})=>S).join("|")),d=!!(t?.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")),p=Object.assign({},...(e?.collectionDefinitions||[]).map(S=>({[S.collectionId]:S}))),h=Object.assign({},...(i?.collectionDefinitions||[]).map(S=>({[S.collectionId]:S})));n.collectionIds=oX(Object.keys(p),Object.keys(h)),r.collectionIds=oX(Object.keys(h),Object.keys(p)),n.collectionsValue=HX(p),r.collectionsValue=HX(h),n.groupsCount=i?.collectionGroups?.length??(0-(e?.collectionGroups?.length??0)||0),r.groupsCount=n.groupsCount?-1*n.groupsCount:0;let f=n.collectionsValue.totalValue-r.collectionsValue.totalValue,m=n.collectionsValue.totalMatchUps-r.collectionsValue.totalMatchUps,g=r.collectionsValue.assignmentValues.length!==n.collectionsValue.assignmentValues.length,v=r.collectionsValue.assignmentValues.some((S,w)=>{let T=n.collectionsValue.assignmentValues[w];return!T||S.valueKey!==T.valueKey||S.value!==T.value?!0:Array.isArray(S.value)?S.value.every((U,C)=>T.value[C]===U):!1}),y=c||d||l!==s||g||v||f!==0,b=[...r.collectionsValue.invalidValues,...n.collectionsValue.invalidValues],I=b.length&&b;return{matchUpFormatDifferences:u,matchUpCountDifference:m,descendantDifferences:n,ancestorDifferences:r,orderDifference:d,valueDifference:f,nameDifference:c,descendantDesc:s,ancestorDesc:l,...le,different:y,invalid:I}}function HX(t){let e=[],i=[],n=0;return{totalValue:Object.keys(t).sort(_L).reduce((r,a)=>{let s=t[a],{collectionValueProfiles:o,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=s,h={collectionValueProfiles:o,collectionValue:l,matchUpValue:c,scoreValue:d,setValue:p},f=Object.keys(h).filter(g=>![void 0,null].includes(h[g])&&(!Array.isArray(h[g])||h[g].length>0));f.length!==1&&e.push({collectionId:a});let m=f[0];if(m){let g=m==="collectionValueProfiles"?Object.values(o):h[m];i.push({valueKey:m,value:g})}return n+=u,o?.length?r+o.reduce((g,v)=>g+v.value,0):u?yi(c)?r+c*u:yi(d)?r+d*u:yi(p)?r+p*u:r+l:r},0),totalMatchUps:n,invalidValues:e,assignmentValues:i}}function F4(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=Rpe(t);return{matchUp:Ct(e,!0,!0),error:i}}function Rpe({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:s,matchUpId:o,inContext:l,eventId:u,drawId:c,event:d}){if(!i)return{error:ot};if(typeof o!="string")return{error:eo};if(!a||!d){let f=(Za({tournamentRecord:i,nextMatchUps:s}).matchUps??[]).find(m=>m.matchUpId===o);if(!f)return{error:Vs};({eventId:u,drawId:c}=f),{event:d,drawDefinition:a}=$o({tournamentRecord:i,eventId:u,drawId:c})}if(!a)return{error:cu};r&&!n&&(n=zm({tournamentRecord:i,contextProfile:r}));let p={surfaceCategory:d?.surfaceCategory??i.surfaceCategory,indoorOutDoor:d?.indoorOutdoor??i.indoorOutdoor,endDate:d?.endDate??i.endDate,tournamentId:i.tournamentId,eventId:u??d?.eventId,drawId:c},{participants:h=[]}=Pb({participantsProfile:t,tournamentRecord:i,contextProfile:r,inContext:l});if(s){let f=(uo({context:l?p:void 0,participants:h,afterRecoveryTimes:e,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:s,inContext:l,event:d}).matchUps??[]).find(g=>g.matchUpId===o);if(!f)return{error:Vs};let m=a?.structures?.find(g=>g.structureId===f.structureId);return{drawDefinition:a,structure:m,matchUp:f}}else{let{matchUp:f,structure:m}=Qn({context:l?p:void 0,tournamentParticipants:h,afterRecoveryTimes:e,contextContent:n,drawDefinition:a,contextProfile:r,matchUpId:o,inContext:l,event:d});return{matchUp:f,structure:m,drawDefinition:a}}}function oF({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,structure:r,eventId:a,drawId:s,event:o}){if(!t)return{error:ot};if(!s&&!o&&!i&&!n)return ce({result:{error:Zt},stack:"getTieFormat"});a&&!o&&(o=t.events?.find(h=>h.eventId===a));let l=F4({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:s,event:o});if(n&&l?.error)return l;if(!e&&l?.drawDefinition&&(e=l?.drawDefinition),r=r??l?.structure,!r&&i&&!n){if(!e)return{error:Zd};let h=li({drawDefinition:e,structureId:i});if(h.error)return h;r=h.structure}let u=(r?.tieFormat||r?.tieFormatId)&&Zs({structure:r,drawDefinition:e,event:o})?.tieFormat,c=(e?.tieFormat||e?.tieFormatId)&&Zs({drawDefinition:e,event:o})?.tieFormat,d=Zs({event:o})?.tieFormat,p=Zs({matchUp:l?.matchUp,drawDefinition:e,structure:r,event:o})?.tieFormat;return{...le,matchUp:l?.matchUp,structureDefaultTieFormat:hs(u),eventDefaultTieFormat:hs(d),drawDefaultTieFormat:hs(c),tieFormat:hs(p),structure:r}}var Mpe={};Fi(Mpe,{bulkUpdatePublishedEventIds:()=>$4,getAllEventData:()=>B4,getCourtInfo:()=>RL,getDrawData:()=>lF,getEventData:()=>uF,getEventPublishStatus:()=>sc,getPublishState:()=>p0,getTournamentPublishStatus:()=>wR,getVenueData:()=>BT});function $4({tournamentRecord:t,outcomes:e}){if(!t)return{error:ot};if(!e?.length)return{error:Zt,info:"Missing outcomes"};let i=e.reduce((r,a)=>{let{drawId:s,eventId:o}=a;return o&&s&&(r[o]?r[o].includes(s)||r[o].push(s):r[o]=[s]),r},{}),n=Object.keys(i);return{publishedEventIds:(t.events?.filter(r=>n.includes(r.eventId))).filter(r=>{let a=sc({event:r}),{drawDetails:s,drawIds:o}=a??{},{eventId:l}=r;return i[l].filter(u=>{let c=s?Object.keys(a.drawDetails).filter(d=>bW({drawId:d,drawDetails:s})):[];return o?.includes(u)||c.includes(u)}).length}).map(r=>r.eventId),eventIdPublishedDrawIdsMap:i}}function Npe({dates:t=[],extension:e}){if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=Ki(e.value)?e.value?.dates:void 0;if(Array.isArray(i))return i?.length?!!i.filter(n=>!t.length||t.includes(n)).length:!1}function Ape({convertExtensions:t,ignoreDisabled:e,venue:i,court:n}){let r={...Ct(n,t,!0),venueId:i.venueId},{extension:a}=_i({name:kd,element:n});if(e&&a){let s=Ki(a.value)?a.value?.dates:void 0,o=a?.value===!0?[]:r.dateAvailability.map(l=>{let u=l.date;if(!(!u||s.includes(u)))return l}).filter(Boolean);r.dateAvailability=o}return{inContextCourt:r}}function Wm(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:n=[],dates:r}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},s=[],o=[],l=[],u=[];return Object.keys(a).filter(c=>!t.tournamentId||c===t.tournamentId).forEach(c=>{let d=a[c];for(let p of d.venues??[])if(!(n.length&&!n.includes(p.venueId))){if(i){let{extension:h}=_i({name:kd,element:p});if(h?.value)continue}s.includes(p.venueId)||(u.push(Ct(p,e,!0)),s.push(p.venueId));for(let h of p.courts??[])if(!o.includes(h.courtId)){if(i){let{extension:m}=_i({name:kd,element:h});if(Npe({extension:m,dates:r}))continue}let{inContextCourt:f}=Ape({convertExtensions:e,ignoreDisabled:i,venue:p,court:h});l.push(f),o.push(h.courtId)}}}),{courts:l,venues:u,...le}}function R$e({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:n}){if(!e)return{error:fr};let r=Ct(e.venues??[],t).filter(s=>{if(!i)return s;let{extension:o}=_i({name:kd,element:s});return!o?.value&&s}).filter(Boolean),a=r.reduce((s,o)=>{let l=(o?.courts||[]).filter(u=>{if(!i&&!n?.length)return u;let{extension:c}=_i({name:kd,element:u});return Npe({extension:c,dates:n})}).filter(Boolean).map(u=>{let{inContextCourt:c}=Ape({convertExtensions:t,ignoreDisabled:i,venue:o,court:u});return c});return l.length?s.concat(l):s},[]);return{venues:r,courts:a}}function BR({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:fr}:Object.keys(t).reduce((n,r)=>{let a=t[r],{venues:s}=R$e({tournamentRecord:a,dates:i});return s?.forEach(o=>{let{venueId:l,courts:u}=o;(!e||u?.length)&&!n.venueIds.includes(l)&&(n.venues.push(o),n.venueIds.push(l))}),n},{venues:[],venueIds:[]})}function B4({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:ot};let i=t.events||[],n=t?.participants||[],{tournamentInfo:r}=I0({tournamentRecord:t}),{venues:a}=Wm({tournamentRecord:t}),s=i.map(o=>{let{eventId:l}=o,u=Epe({event:o}).eventInfo,c=sR({tournamentRecord:t,event:o}).scheduleTiming,d=(o.drawDefinitions||[]).map(h=>{let f=(({drawId:b,drawName:I,matchUpFormat:S,updatedAt:w})=>({matchUpFormat:S,updatedAt:w,drawName:I,drawId:b}))(h),{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=sD({requireParticipants:!0,tournamentParticipants:n,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:h,event:o});return{drawInfo:f,matchUps:{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=sc({event:o});return Object.assign(u,{drawsData:d,publish:p}),u});return{allEventData:{tournamentInfo:r,venuesData:a,eventsData:s}}}function _pe({publishStatus:t,drawId:e}){return t?.drawDetails?t.drawDetails?.[e]?.publishingDetail?.published:t?.drawIds?t.drawIds.includes(e):!0}var kpe="PUBLIC",M$e="ADMIN",xpe={PUBLIC_DISPLAY:kpe,ADMIN_DISPLAY:M$e};function lF(t){let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:n,tournamentRecord:r,inContext:a=!0,usePublishState:s,status:o=wu,pressureRating:l,refreshResults:u,contextProfile:c,drawDefinition:d,noDeepCopy:p,sortConfig:h,context:f,event:m}=t;if(!d)return{error:Ot};let g=(({matchUpFormat:_,updatedAt:x,drawType:O,drawName:$,drawId:F})=>({matchUpFormat:_,updatedAt:x,drawName:$,drawType:O,drawId:F}))(d);g.display=_i({element:d,name:fk}).extension?.value;let v={},y,b,{allStructuresLinked:I,sourceStructureIds:S,hasDrawFeedProfile:w,structureGroups:T}=FL({drawDefinition:d});if(!I)return{error:Sse};let U=t?.eventPublishState??p0({event:m}).publishState,C=t?.publishStatus??sc({event:m,status:o}),E=U?.status?.drawDetails?.[d.drawId],P=!!U?.status?.published,M=E?.structureDetails,R=!1,N=!1,A=T.map(_=>{let x={},O=_.map($=>{let{structure:F}=li({drawDefinition:d,structureId:$}),{seedAssignments:j}=Zu({drawDefinition:d,structure:F});return F?.stage===Nt&&F.stageSequence===1&&(y=j),F?.stage===qt&&(v[F.stageSequence??0]=j),F}).sort(($,F)=>n0($,F,h)).map($=>{if(!$)return;let F=$?.structureId,j=[];$.stage&&[Nt,Ts,Sr].includes($.stage)&&(j=y),$?.stage===qt&&(j=v[$.stageSequence??0]);let{matchUps:H,roundMatchUps:G,roundProfile:W}=cn({seedAssignments:$?.seedAssignments?.length?void 0:j,context:{drawId:g.drawId,...f},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:e,policyDefinitions:n,tournamentRecord:r,usePublishState:s,publishStatus:C,contextProfile:c,drawDefinition:d,inContext:a,structure:$,event:m}),{positionAssignments:q}=Nn({structure:$}),Z=q?.filter(kl(Zh)).map(ne=>{let re=_i({element:ne,name:gm})?.extension?.value,{drawPosition:oe,participantId:de}=ne;return N=!0,{participantResult:re,participantId:de,drawPosition:oe}});if(H.length&&(!Z?.length&&t.allParticipantResults||u&&!$.structures)){let{subOrderMap:ne}=Kce({positionAssignments:q}),re=H.some(de=>de.matchUpType===uu)?H.filter(de=>de.matchUpType===uu):H,oe=pD({matchUpFormat:$.matchUpFormat,matchUps:re,policyDefinitions:n,pressureRating:l,subOrderMap:ne});b=oe?.report,Z=q?.filter(kl(Zh)).map(de=>{let{drawPosition:se,participantId:ge}=de;return N=!0,{participantResult:ge&&oe?.participantResults?.[ge],participantId:ge,drawPosition:se}})}let K=$?(({stageSequence:ne,structureName:re,structureType:oe,matchUpFormat:de,stage:se})=>({stageSequence:ne,structureName:re,structureType:oe,matchUpFormat:de,stage:se}))($):{},Q=_i({element:$,name:fk}).extension?.value;K.display=Q?.[kpe]??Q,K.sourceStructureIds=S[F],K.hasDrawFeedProfile=w[F],K.positionAssignments=q,K.structureActive=H.reduce((ne,re)=>{let oe=[cr,sa,hd,Ur,nh,On,_a,ir].includes(re.matchUpStatus);return ne||oe||!!re.winningSide||!!re.score?.scoreStringSide1},!1);let J=H.reduce((ne,re)=>ne&&["BYE",Ur,_a,ir,On,al].includes(re.matchUpStatus),!!H.length);return K.structureCompleted=J,x[F]=J,K.structureActive&&(R=!0),{...K,participantResults:Z,seedAssignments:j,roundMatchUps:G,roundProfile:W,structureId:F,report:b}});return O.forEach($=>{i||delete $.positionAssignments,$.sourceStructuresComplete=$.sourceStructureIds?.every(F=>x[F])}),O}).flat().filter(_=>!s||M?.[_?.structureId]?.published||!0);return g.drawActive=R,g.participantPlacements=N,g.drawGenerated=A?.reduce((_,x)=>_||!!x?.roundMatchUps,!1),g.drawCompleted=A?.reduce((_,x)=>_&&x.structureCompleted,!0),g.drawPublished=s?P&&_pe({publishStatus:C,drawId:g.drawId}):void 0,{structures:!s||g.drawPublished?p&&A||Ct(A,!1,!0):void 0,drawInfo:p?g:Ct(g,!1,!0),...le}}function uF(t){let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:n,usePublishState:r,status:a=wu,contextProfile:s,sortConfig:o}=t,l=zt(t,[{tournamentRecord:!0},{[E3]:{event:!1,eventId:!1}}]);if(l.error)return l;let u=Ct(t.tournamentRecord,!1,!0),c=t.event?void 0:$o({tournamentRecord:u,eventId:t.eventId}).event,d=t.event?Ct(t.event,!1,!0):c&&Ct(c,!1,!0)||void 0;if(!d)return{error:Wu};let{eventId:p}=d,{tournamentId:h,endDate:f}=u,m=sc({event:d,status:a}),g=p0({event:d}).publishState??{},v=!!g?.status?.published,{participants:y}=dr({withEvents:!1,withDraws:!1,policyDefinitions:n,...i,tournamentRecord:u}),b=({stage:R,drawId:N})=>{if(!r)return!0;let A=m?.drawDetails?.[N]?.stageDetails;return!A||!Object.keys(A).length?!0:A[R]?.published},I=({structureId:R,drawId:N})=>{if(!r)return!0;let A=m?.drawDetails?.[N]?.structureDetails;return!A||!Object.keys(A).length?!0:A[R]?.published},S=({drawId:R})=>r?_pe({publishStatus:m,drawId:R}):!0,w=({drawId:R,structure:N})=>{if(!r)return N;let A=m?.drawDetails?.[R]?.structureDetails?.[N.structureId]?.roundLimit;if(yi(A)){let _=Dt(1,A+1),x={},O={};for(let $ of _)N.roundMatchUps[$]&&(x[$]=N.roundMatchUps[$],O[$]=N.roundProfile[$]);N.roundMatchUps=x,N.roundProfile=O}return N},T=d.drawDefinitions||[],U=!r||v?T.filter(S).map(R=>(({drawInfo:N,structures:A})=>({...N,structures:A}))(lF({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:p,tournamentId:h,endDate:f},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:y,eventPublishState:g,noDeepCopy:!0,policyDefinitions:n,tournamentRecord:u,usePublishState:r,contextProfile:s,drawDefinition:R,publishStatus:m,sortConfig:o,event:d}))).map(({structures:R,...N})=>{let A=R?.filter(({stage:_,structureId:x})=>I({structureId:x,drawId:N.drawId})&&b({stage:_,drawId:N.drawId})).map(_=>w({drawId:N.drawId,structure:_}));return{...N,structures:A}}).filter(R=>R.structures?.length):void 0,C=(Array.isArray(u.venues)?u.venues:[]).map(R=>(({venueData:N})=>({...N}))(BT({venueId:R.venueId,tournamentRecord:u}))),E=(({eventId:R,eventName:N,eventType:A,eventLevel:_,surfaceCategory:x,matchUpFormat:O,category:$,gender:F,startDate:j,endDate:H,ballType:G,discipline:W})=>({eventId:R,eventName:N,eventType:A,eventLevel:_,surfaceCategory:x,matchUpFormat:O,category:$,gender:F,startDate:j,endDate:H,ballType:G,discipline:W}))(d);E.display=_i({element:d,name:fk}).extension?.value;let{tournamentInfo:P}=I0({tournamentRecord:u}),M={tournamentInfo:P,venuesData:C,eventInfo:E,drawsData:U};return M.eventInfo.publishState=g,M.eventInfo.published=g?.status?.published,{...le,eventData:M,participants:y}}var Ope={};Fi(Ope,{courtGridRows:()=>fF,findVenue:()=>mf,getMatchUpsToSchedule:()=>cF,getPersonRequests:()=>xb,getProfileRounds:()=>hF,getScheduledRoundsDetails:()=>VR,getSchedulingProfile:()=>Ym,getSchedulingProfileIssues:()=>V4,publicFindCourt:()=>mW});function HT({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:n}){let{individualParticipantIds:r}=wL(n);i=i??n.schedule?.timeAfterRecovery;let a=u=>{t[u]||(t[u]=[]),t[u]=wi(t[u].concat(...r))},s=u=>{i&&(!e[u]||i>e[u])&&(e[u]=i)},o=n.winnerTo?.matchUpId||n.winnerMatchUpId;o&&(i&&s(o),a(o));let l=n.loserTo?.matchUpId||n.loserMatchUpId;l&&(i&&s(l),a(l)),n.sidesTo?.length&&n.sidesTo.forEach(({matchUpId:u})=>{u&&(i&&s(u),a(u))})}function cF(t){let e=zt(t,[{[U3]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:n=[],scheduleCompletedMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,orderedMatchUpIds:o,clearDate:l,matchUps:u}=t,c=s?Object.keys(s):[],d=(o??[]).map(h=>u.find(f=>f.matchUpId===h)).filter(Boolean).filter(h=>{let f=!l&&(n.includes(h.matchUpId)||c.includes(h.matchUpId)),m=["BYE",On,Ur,al,_a,ir,cr,sa].includes(h?.matchUpStatus);return r||!f&&!h.winningSide&&!m}),p=i&&a?d.reduce((h,f)=>{let{drawId:m,tournamentId:g}=f;return h.matchUpMap[g]||(h.matchUpMap[g]={}),h.matchUpMap[g][m]?h.matchUpMap[g][m].push(f):h.matchUpMap[g][m]=[f],HT({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:f}),h},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function dF({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:n,categoryName:r,categoryType:a,tournamentId:s,eventType:o,eventId:l}){if(!Ml({matchUpFormat:n}))return{error:V1};let u=Object.keys(i).filter(d=>!s||d===s),c;return u.forEach(d=>{if(c)return;let p=i[d],h=l?$o({tournamentRecord:p,eventId:l})?.event:void 0;return c=mR({tournamentRecord:p,matchUpFormat:n,categoryName:r,categoryType:a,eventType:o,event:h}),c?.averageMinutes||c?.recoveryMinutes}),{recoveryMinutes:c?.recoveryMinutes||t,averageMinutes:c?.averageMinutes||e,typeChangeRecoveryMinutes:c?.typeChangeRecoveryMinutes||c?.recoveryMinutes||t}}function VR(t){let e=zt(t,[{[E3]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[Go]:xs}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:n=30}=t,r=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof r!="object")return{error:fr};let a={},s=[],o=t.rounds.toSorted((f,m)=>(f.sortOrder??0)-(m.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(r).map(f=>rD({tournamentRecord:f}).containedStructures)),u=t.matchUps??jd({nextMatchUps:!0,tournamentRecords:r}).matchUps,c=0,d={},p={},h={};return{scheduledRoundsDetails:o.flatMap(f=>{let m=f.periodLength||n,g=[];l?.[f.structureId]?g.push(...l[f.structureId]):g.push(f.structureId);let v=u?qf({tournamentIds:[f.tournamentId],roundNumbers:[f.roundNumber],matchUpIds:f.matchUpIds,eventIds:[f.eventId],drawIds:[f.drawId],processContext:!0,structureIds:g,matchUps:u}).sort(d0):[],{segmentNumber:y,segmentsCount:b}=f.roundSegment||{};if(yi(y)&&$d(v?.length)&&$d(b)&&y>0&&y<=b&&b<v?.length&&!f.matchUpIds?.length){let T=v.length/b,U=T*(y-1);v=v.slice(U,U+T)}let I=r[f.tournamentId],S=$o({drawId:f.drawId,tournamentRecord:I}).event,w=[];for(let T of v){let U=T.matchUpFormat;U&&(a[U]||(a[U]=[],a[U].push(T)),w.push(U))}for(let T of w){let{eventType:U,category:C}=S??{},{categoryName:E,ageCategoryCode:P}=C??{},{typeChangeRecoveryMinutes:M,recoveryMinutes:R,averageMinutes:N,error:A}=dF({categoryName:E??P,categoryType:C?.categoryType,tournamentId:f.tournamentId,eventId:f.eventId,tournamentRecords:r,matchUpFormat:T,eventType:U});if(A)return{error:A,round:f};let _=v.filter(O=>(i||!Yr.includes(O.matchUpStatus))&&O.matchUpStatus!=="BYE").map(Ma);_.forEach(O=>{h[O]={typeChangeRecoveryMinutes:M,recoveryMinutes:R,averageMinutes:N},d[O]=R,p[O]=N}),s.push(..._),c=Math.max(N||0,c);let x=`${N}|${m}`;return{roundPeriodLength:m,recoveryMinutes:R,averageMinutes:N,matchUpIds:_,hash:x}}}),greatestAverageMinutes:c,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:s,minutesMap:h,...le}}function Lpe({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:n}){let r=[],a=t?.map(o=>{let l=Pi(o?.scheduleDate);if(!l){r.push(`Invalid date: ${o?.scheduledDate}`);return}let u=(o?.venues||[]).map(c=>{let{rounds:d,venueId:p}=c;if(!e?.includes(p)){r.push(`Missing venueId: ${p}`);return}let h=d.filter(f=>{let m=i.includes(f.eventId)&&n.includes(f.drawId);return m||r.push(`Invalid eventId: ${f.eventId} or drawId: ${f.drawId}`),m});if(h.length)return{venueId:p,rounds:h}}).filter(Boolean);return u.length&&l&&{...o,venues:u}}).filter(Boolean),s=r.length;return{updatedSchedulingProfile:a,modifications:s,issues:r}}function pF({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:Ee};let{venueIds:i,tournamentsMap:n}=A$e({tournamentRecords:t}),r,a,s=e.every(o=>{let{scheduleDate:l,venues:u}=o;return nl(l)?u.every(c=>{let{venueId:d,rounds:p}=c;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(h=>{if(!h)return a="empty round",!1;let{roundSegment:f,tournamentId:m,structureId:g,roundNumber:v,eventId:y,drawId:b}=h,I=n?.[m]?.[y]?.[b]?.[g]?.includes(v);I||(a="Invalid rounds");let{segmentNumber:S,segmentsCount:w}=f||{},T=!f||yi(S)&&$d(w)&&S<=w;return T||(a="Invalid segment"),I&&T}):(r=Zw,!1):(a="rounds should be an array",!1)}):!1});return!s&&!r&&(r=Ee),{valid:!!s,error:r,info:a}}function N$e(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:n}=t,r=[],a=[],s=[],o=[],l=(e?.venues||[]).map(({venueId:c,courts:d})=>(!n||d?.length)&&c),u=e?.tournamentId;if(u){r.push(u),i[u]={};let c=e?.events||[];for(let d of c){let p=d.eventId;s.push(p),i[u][p]={};let h=f=>parseInt(f);for(let f of d.drawDefinitions||[]){let m=f.drawId;o.push(m),i[u][p][m]={};let{structures:g}=rd({drawDefinition:f});for(let v of g||[]){let y=v.structureId,{matchUps:b}=cn({structure:v}),{roundMatchUps:I}=go({matchUps:b}),S=I&&Object.keys(I).map(h);if(i[u][p][m][y]=S,a.push(y),v.structures?.length)for(let w of v.structures)a.push(w.structureId),i[u][p][m][w.structureId]=S}}}}return{tournamentMap:i,tournamentIds:r,structureIds:a,venueIds:l,eventIds:s,drawIds:o}}function A$e(t){let e=t?.tournamentRecords&&Object.values(t?.tournamentRecords)||[],i={},{venueIds:n,eventIds:r,drawIds:a,structureIds:s,tournamentIds:o}=e.reduce((l,u)=>{let{tournamentIds:c,tournamentMap:d,structureIds:p,venueIds:h,eventIds:f,drawIds:m}=N$e({tournamentRecord:u});return h.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...c),l.structureIds.push(...p),l.eventIds.push(...f),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:o,structureIds:s,venueIds:n,eventIds:r,drawIds:a}}function Ym({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:fr};let{extension:i}=_i({element:e,name:dw,tournamentRecords:t,discover:!0}),n=i?.value||[];if(n.length){let{venueIds:r}=BR({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:s}=XW({tournamentRecords:t}),{updatedSchedulingProfile:o,modifications:l,issues:u}=Lpe({schedulingProfile:n,venueIds:r,eventIds:a,drawIds:s});if(l){n=o;let c=hD({tournamentRecords:t,tournamentRecord:e,schedulingProfile:n});return c.error?c:{schedulingProfile:n,modifications:l,issues:u}}}return{schedulingProfile:n,modifications:0}}function hD({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let n=pF({tournamentRecords:t,schedulingProfile:i});return n.error?n:i?un({tournamentRecords:t,discover:!0,extension:{name:dw,value:i}}):lo({element:e,name:dw,tournamentRecords:t,discover:!0})}function jR(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:u,issues:c}=Ym({tournamentRecords:i,tournamentRecord:e});return{success:!u,modifications:u,issues:c}}let{venueIds:n}=BR({tournamentRecords:i}),{eventIds:r,drawIds:a}=XW({tournamentRecords:i}),{updatedSchedulingProfile:s,modifications:o,issues:l}=Lpe({schedulingProfile:t.schedulingProfile,venueIds:n,eventIds:r,drawIds:a});return o?{...hD({schedulingProfile:s,tournamentRecords:i}),modifications:o,issues:l}:{...le,modifications:o,issues:l}}function V4(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:n=30}=t??{};if(typeof i!="object")return{error:F1};if(!Array.isArray(e))return{error:Ee};if(!e.every(nl))return{error:ja};let r=[],a=0,s={},{schedulingProfile:o}=Ym({tournamentRecords:i});if(!o)return{issues:r,...le};let{matchUps:l}=jd({nextMatchUps:!0,tournamentRecords:i});for(let c of o){let{scheduleDate:d,venues:p=[]}=c;if(!e?.length||e.includes(d)){for(let h of p||[])if(h){let{rounds:f}=h,m=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=VR({tournamentRecords:i,periodLength:n,matchUps:l,rounds:f}),{matchUpDependencies:y}=gd({tournamentRecords:i,matchUps:l}),b=I=>{let S;return v?.find((w,T)=>{let U=w.matchUpIds.includes(I);return U&&(S=T),U}),S};if(g?.forEach((I,S)=>{let w=g.slice(S+1),T=Dr(w,y?.[I]?.matchUpIds||[]);T.length&&m.push({matchUpId:I,shouldBeAfter:T})}),m.length){a+=m.length;let I=m.map(({matchUpId:S,shouldBeAfter:w})=>{let T=b(S),U=wi(w.map(b));return s[d]||(s[d]={}),s[d][T]||(s[d][T]=[]),U.forEach(C=>{s[d][T].includes(C)||s[d][T].push(C)}),{matchUpId:S,matchUpRoundIndex:T,earlierRoundIndices:U,shouldBeAfter:w}});r.push(...I)}}}}let u={matchUpIdShouldBeAfter:Object.assign({},...r.map(c=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:h}=c;return{[d]:{earlierRoundIndices:h,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:s,...le}}function xb(t){let{tournamentRecords:e,requestType:i}=t,n=zt(t,[{[js]:!0}]);if(n.error)return n;let r={};for(let a of Object.values(e)){let{extension:s}=_i({element:a,name:iD}),o=s?.value||[];for(let l of o){let{personId:u,requests:c}=l||{};r[u]||(r[u]=[]);for(let d of c)i&&d.requestType!==i||r[u].push(d)}}return{personRequests:r,...le}}function WG(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:n,tournamentId:r,roundNumber:a,structureId:s,eventId:o,drawId:l}=t,u=n?e:s,c=[r,o,l,u,a].join("|");return Vt({structureId:u,roundSegment:i,tournamentId:r,roundNumber:a,eventId:o,drawId:l,id:c})}function zX({round:t,matchUps:e,events:i,tournamentRecords:n}){let r=i.find(p=>p.eventId===t.eventId),{eventType:a,category:s,categoryType:o}=r||{},{categoryName:l,ageCategoryCode:u}=s||{},c=Rl(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(c).forEach(p=>{let h=c[p],f=dF({categoryName:l||u,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:n,matchUpFormat:p,categoryType:o,eventType:a});if(f.error)return f;let m=f.averageMinutes*h;isNaN(d)||(d+=m)}),{roundMinutes:d}}function _$e(t){return(t||[]).reduce((e,i)=>{let n=(i.finishingPositionRange?.winner||[]).reduce((a,s)=>a+s,0),r=(i.finishingPositionRange?.winner||[]).join("-")||"";return!e.minFinishingSum||n<e.minFinishingSum?{minFinishingSum:n,winnerFinishingPositionRange:r}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function qX(t){let e=t.length,i=t.filter(({sides:u})=>u?.some(({bye:c})=>c)).length||0,n=t.filter(({winningSide:u,matchUpStatus:c})=>u||Yr.includes(c)).length||0,r=t.filter(({schedule:u,matchUpStatus:c})=>u?.scheduledDate&&u?.scheduledTime&&c!=="BYE").length||0,a=e-i,s=a===n,o=a-r,l=a-r;return{unscheduledCount:o,incompleteCount:l,scheduledCount:r,completedCount:n,matchUpsCount:e,isScheduled:a===r,isComplete:s,byeCount:i}}function hF({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:n}){if(i&&!t){if(typeof i!="object")return{error:F1};t={[i.tournamentId]:i}}if(e){let a=pF({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=Ym({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:Ya};let r={};return{profileRounds:e.map(({venues:a,scheduleDate:s})=>a.map(({rounds:o})=>o.map(l=>{let u=WG(l);return u.roundSegment?.segmentsCount&&(r[u.id]=u.roundSegment.segmentsCount),Vt({id:n?u.id:void 0,scheduleDate:s,...u})}))).flat(1/0),segmentedRounds:r}}function fF({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:Ee};let n=i?.reduce((s,o)=>{let l=o.matchUps||[],u=Math.max(0,...l.map(c=>c.schedule.courtOrder||0));return u>s?u:s},1),r=e?Math.max(e,n):n,a=Dt(0,r).map(s=>({matchUps:Dt(0,i.length).map(o=>{let l=i[o],{courtId:u,venueId:c}=l;return{schedule:{courtOrder:s+1,venueId:c,courtId:u}}})}));return i.forEach((s,o)=>{for(let l of s.matchUps){let u=l.schedule?.courtOrder;u&&(a[u-1].matchUps[o]=l)}}),{courtPrefix:t,rows:a.map((s,o)=>Object.assign({rowId:`rowId-${o+1}`},...s.matchUps.map((l,u)=>({[`${t}${u}`]:l}))))}}var Fpe={};Fi(Fpe,{getEntriesAndSeedsCount:()=>mF,getMaxEntryPosition:()=>j4});function mF({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:n,event:r,stage:a}){if(!r)return{error:qn};let{entries:s,stageEntries:o}=Zue({drawDefinition:e,drawId:n,stage:a,event:r}),l=o.length,{drawSize:u}=Sde({participantsCount:l}),c=LR({drawSize:i??u,participantsCount:l,policyDefinitions:t});if(c.error)return ce({result:c,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=c;return{entries:s,seedsCount:d,stageEntries:o}}function j4(t){let{entries:e=[],entryStatus:i,stage:n}=t;return Math.max(...e.filter(r=>(!n||n===r.entryStage)&&(!i||r.entryStatus===i)&&!isNaN(r.entryPosition)).map(({entryPosition:r})=>ri(r||0)),0)}var $pe={};Fi($pe,{allCompetitionMatchUps:()=>jd,allDrawMatchUps:()=>uo,allEventMatchUps:()=>gf,allTournamentMatchUps:()=>Za,analyzeMatchUp:()=>DC,calculateWinCriteria:()=>w0,checkMatchUpIsComplete:()=>Py,competitionScheduleMatchUps:()=>HR,drawMatchUps:()=>Q4,eventMatchUps:()=>vF,filterMatchUps:()=>qf,getAllDrawMatchUps:()=>Kr,getAllStructureMatchUps:()=>cn,getCheckedInParticipantIds:()=>l0,getCompetitionMatchUps:()=>UC,getEventMatchUpFormatTiming:()=>H4,getHomeParticipantId:()=>Y4,getMatchUpCompetitiveProfile:()=>fR,getMatchUpContextIds:()=>K4,getMatchUpDailyLimits:()=>bF,getMatchUpDailyLimitsUpdate:()=>z4,getMatchUpDependencies:()=>gd,getMatchUpFormat:()=>Z4,getMatchUpFormatTiming:()=>mR,getMatchUpFormatTimingUpdate:()=>G4,getMatchUpScheduleDetails:()=>ML,getMatchUpType:()=>NL,getMatchUpsStats:()=>X4,getModifiedMatchUpFormatTiming:()=>gF,getParticipantResults:()=>NR,getPredictiveAccuracy:()=>W4,getRoundMatchUps:()=>go,getRounds:()=>J4,isValidMatchUpFormat:()=>Ml,matchUpActions:()=>WL,participantScheduledMatchUps:()=>q4,tallyParticipantResults:()=>pD,tournamentMatchUps:()=>yF,validMatchUp:()=>UL,validMatchUps:()=>ac});function Bpe({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:fr};let i=[],n;for(let r of Object.values(t)){let{extension:a}=_i({element:r,name:e});a&&!n&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),n=!0);let s=r.events??[];for(let o of s){let{eventId:l}=o,{extension:u}=_i({name:e,element:o});u&&i.push({params:{eventId:l,extension:u},method:"addEventExtension"})}}return{methods:i}}function G4({tournamentRecords:t}){return Bpe({extensionName:mm,tournamentRecords:t})}var oV="ADULT",lV="JUNIOR",rA="WHEELCHAIR",Vpe={[wv]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Dn]:30,default:60}}]},defaultDailyLimits:{[Rn]:2,[Dn]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[jc],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[rA],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[oV,rA],minutes:{default:60,[Dn]:30}},{categoryTypes:[lV],minutes:{default:60,[Dn]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[oV,rA],minutes:{default:30}},{categoryTypes:[lV],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[oV,lV],minutes:{default:30}},{categoryTypes:[rA],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},k$e=Vpe;function H4({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:n}){if(!n)return{error:qn};let r=[],a;if(e?.length){let d=[];r=e.map(p=>{let h=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(h?.matchUpFormat)&&Ml({matchUpFormat:h?.matchUpFormat}))return d.push(h.matchUpFormat),h}).filter(Boolean)}else{let{policy:d}=Cb({policyType:Ku,tournamentRecord:t,event:n});if(d?.matchUpFormats)r=d?.matchUpFormats;else{let{extension:p}=_i({name:mm,element:n}),h,f;p?.value?{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=p.value:{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=k$e[wv],r=wi([...(h||[]).map(m=>m.matchUpFormatCodes),...(f||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),a="default scheduling policy in use"}}let{eventType:s,eventId:o,category:l}=n,u=l?.categoryName??l?.ageCategoryCode??o;if(!o)return{error:qn};let c=r.map(({matchUpFormat:d,description:p})=>{let h=mR({tournamentRecord:t,matchUpFormat:d,categoryName:u,categoryType:i,eventType:s,event:n});return{matchUpFormat:d,description:p,...h}});return Vt({eventMatchUpFormatTiming:c,info:a})}function gF(t){let e=zt(t,[{[ha]:!0},{[gs]:m=>Ml({matchUpFormat:m}),[pu]:V1,[w3]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:n,event:r}=t,{extension:a}=_i({name:mm,element:r}),s=a?.value,{extension:o}=_i({element:i,name:mm}),l=o?.value,u=s?.matchUpAverageTimes&&hP({...s,matchUpFormat:n}),c=l?.matchUpAverageTimes&&hP({...l,matchUpFormat:n}),d=[u,c].find(m=>m),p=s?.matchUpRecoveryTimes&&fP({...s,matchUpFormat:n}),h=l?.matchUpRecoveryTimes&&fP({...l,matchUpFormat:n}),f=[p,h].find(m=>m);return{matchUpFormat:n,recoveryTimes:f,averageTimes:d}}function z4({tournamentRecords:t}){return Bpe({extensionName:tR,tournamentRecords:t})}var GR=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function q4({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!ac(e))return{error:Vm};if(!Array.isArray(t))return{error:Ee};let i=e.filter(Boolean).filter(({schedule:n})=>GR({schedule:n,scheduleAttributes:t})).reduce((n,r)=>{let{schedule:a}=r,s=Pi(a?.scheduledDate),o=Jn(a?.scheduledTime);return s&&o&&(n[s]?n[s].push(r):n[s]=[r]),n},{});return Object.keys(i).forEach(n=>{i[n].sort((r,a)=>_oe(Jn(r.schedule?.scheduledTime),Jn(a.schedule?.scheduledTime)))}),{...le,scheduledMatchUps:i}}function x$e({tournamentRecords:t}){let e={},i=[];for(let n of Object.values(t))for(let r of n.events??[]){let a=sc({event:r}),s=a?.drawDetails;Ki(s)?(Object.assign(e,s),i.push(...Object.keys(s).filter(o=>bW({drawId:o,drawDetails:s})))):a?.drawIds?.length&&i.push(...a.drawIds)}return{drawIds:i,detailsMap:e}}function Nk({schedulingProfile:t,matchUps:e=[]}){let i={},n=({eventId:o,drawId:l,structureId:u,roundNumber:c})=>`${o}|${l}|${u}${c}`;t?.length&&t.map(({venues:o})=>o.map(({rounds:l})=>l)).flat().forEach(o=>{o.sort((l,u)=>(l.sortOrder||0)-(u.sortOrder||0)).forEach(({eventId:l,drawId:u,structureId:c,roundNumber:d},p)=>{let h=n({eventId:l,drawId:u,structureId:c,roundNumber:d});i[h]=p})});let r=[],a={noScheduledDate:[]};for(let o of e){let l=o.schedule||{},u=l.scheduledDate&&Pi(l.scheduledDate)||l.scheduledTime&&Pi(l.scheduledTime)||"noScheduledDate";a[u]||(a[u]=[]),a[u].push(o)}let s=Object.keys(a).sort();for(let o of s){let l=a[o],u={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},h=p.scheduledTime&&Jn(p.scheduledTime)||"noScheduledTime";u[h]||(u[h]=[]),u[h].push(d)}for(let d of Object.keys(u)){let p=u[d].sort((h,f)=>(h.roundNumber||0)-(f.roundNumber||0));u[d]=p}let c=Object.keys(u).sort();for(let d of c){let p=u[d];p.sort((h,f)=>{let m=i[n(h)]||0,g=i[n(f)]||0;return m-g}),r.push(...p)}}return r}function vF(t){let{participants:e,contextContent:i,participantMap:n}=t,{tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,tournamentId:g,inContext:v,context:y,event:b}=t;if(!b)return{error:qn};let{eventId:I,eventName:S,endDate:w,eventType:T,category:U,gender:C}=b??{},E={...y,...Vt({surfaceCategory:b.surfaceCategory??c?.surfaceCategory,indoorOutDoor:b.indoorOutdoor??c?.indoorOutdoor,tournamentId:g??c?.tournamentId,endDate:w??c?.endDate,eventName:S,eventType:T,category:U,eventId:I,gender:C})},P;!e&&c&&({participants:e,participantMap:n,groupInfo:P}=Pb({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:f,inContext:v})),f&&!i&&(i=zm({policyDefinitions:l,tournamentRecord:c,contextProfile:f,event:b}));let M=sc({event:b});return{...(b.drawDefinitions??[]).reduce((R,N)=>{let A=sD({hydrateParticipants:t.hydrateParticipants,context:E,tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:h,participantMap:n,publishStatus:M,contextProfile:f,drawDefinition:N,nextMatchUps:m,inContext:v,event:b});return Object.keys(A)?.forEach(_=>{Array.isArray(A[_])&&(R[_]||(R[_]=[]),R[_]=R[_].concat(A[_]))}),R},{}),...le,groupInfo:P}}function yF(t){if(!t?.tournamentRecord)return{error:ot};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,inContext:o=!0,usePublishState:l,contextFilters:u,matchUpFilters:c,contextProfile:d,nextMatchUps:p,context:h}=t,f=t.tournamentId??s.tournamentId,m=s?.events??[],{participants:g,participantMap:v,groupInfo:y}=Pb({participantsProfile:n,tournamentRecord:s,contextProfile:d,inContext:o});d&&!e&&(e=zm({policyDefinitions:a,tournamentRecord:s,contextProfile:d}));let{appliedPolicies:b}=sn({tournamentRecord:s}),I=u?.eventIds??[];return{...m.filter(S=>!I.includes(S.eventId)).map(S=>{let w={eventDrawsCount:Cr({event:S}).flightProfile?.flights?.length||S.drawDefinitions?.length||0,...h};return vF({hydrateParticipants:t.hydrateParticipants,context:w,tournamentAppliedPolicies:b,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:l,contextFilters:u,contextProfile:d,contextContent:e,matchUpFilters:c,participantMap:v,participants:g,tournamentId:f,nextMatchUps:p,inContext:o,event:S})}).reduce((S,w)=>((w&&Object.keys(w).filter(T=>!["success","matchUpsMap"].includes(T)))?.forEach(T=>{Array.isArray(w[T])&&(S[T]||(S[T]=[]),S[T]=S[T].concat(w[T]),S.matchUpsCount!==void 0?S.matchUpsCount+=w[T].length:S.matchUpsCount=w[T].length)}),S),{matchUpsCount:0}),groupInfo:y,participants:g}}function UC({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:n,useParticipantMap:r,policyDefinitions:a,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:u,inContext:c}){if(typeof n!="object"||!Object.keys(n).length)return{error:fr};let d=Object.keys(n).map(f=>{let m=n[f];return yF({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,policyDefinitions:a,tournamentRecord:m,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:u,inContext:c})}),p={},h={};return{...d.reduce((f,m)=>(Object.keys(m).forEach(g=>{if(g==="groupInfo")Object.assign(h,m[g]);else if(g==="participants")for(let v of m[g]??[])p[v.participantId]=v;else Array.isArray(m[g])&&(f[g]||(f[g]=[]),f[g]=f[g].concat(m[g]))}),f),{}),groupInfo:h,mappedParticipants:p}}function HR(t){if(typeof t?.tournamentRecords!="object"||!Object.keys(t?.tournamentRecords).length)return{error:fr};let{courts:e,venues:i}=Wm(t),n=Ym(t).schedulingProfile,{sortDateMatchUps:r=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:s,activeTournamentId:o,tournamentRecords:l,withCourtGridRows:u,minCourtGridRows:c,usePublishState:d,status:p=wu,sortCourtsData:h}=t,f=o??Jw()??Object.keys(l)[0],m=d?wR({tournamentRecord:l[f],status:p}):void 0,g=s?UC({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[Ur]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!m?.orderOfPlay?.published)return{completedMatchUps:g,dateMatchUps:[],courtsData:[],venues:i};let v,y;d&&({drawIds:v,detailsMap:y}=x$e({tournamentRecords:l})),v?.length&&(t.contextFilters||(t.contextFilters={}),t.contextFilters?.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(R=>v.includes(R)):t.contextFilters.drawIds=v),m?.eventIds?.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters?.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(R=>m.eventIds.includes(R)):t.matchUpFilters.eventIds=m.eventIds),m?.scheduledDates?.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(R=>m.scheduledDates.includes(R)):t.matchUpFilters.scheduledDates=m.scheduledDates),s&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters?.excludeMatchUpStatuses?.length?t.matchUpFilters.excludeMatchUpStatuses.includes(Ur)||t.matchUpFilters.excludeMatchUpStatuses.push(Ur):t.matchUpFilters.excludeMatchUpStatuses=[Ur]);let{completedMatchUps:b,upcomingMatchUps:I,pendingMatchUps:S,groupInfo:w,mappedParticipants:T}=UC({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),U=[...I??[],...S??[]];y&&(!v?.length||Object.keys(y).length)&&(U=U.filter(R=>{let{drawId:N,structureId:A,stage:_}=R;if(!y?.[N]?.publishingDetail?.published)return!1;let x=Object.keys(y[N].stageDetails??{});if(x.length){let $=x.filter(j=>!y[N].stageDetails[j].published),F=x.filter(j=>y[N].stageDetails[j].published);return $.length&&$.includes(_)?!1:F.length&&F.includes(_)?!0:$.length&&!$.includes(_)&&!F.length}let O=Object.keys(y[N].structureDetails??{});if(O.length){let $=O.filter(j=>!y[N].structureDetails[j].published),F=O.filter(j=>y[N].structureDetails[j].published);return $.length&&$.includes(A)?!1:F.length&&F.includes(A)?!0:$.length&&!$.includes(A)&&!F.length}return!0}));let C=r?Nk({matchUps:U,schedulingProfile:n}):U,E=e?.map(R=>{let N=M(R);return{surfaceCategory:R?.surfaceCategory??"",matchUps:N,...R}}),P={completedMatchUps:s?g:b,mappedParticipants:t.hydrateParticipants?void 0:T,dateMatchUps:C,courtsData:E,groupInfo:w,venues:i};if(u){let{rows:R,courtPrefix:N}=fF({minRowsCount:c,courtsData:E});P.courtPrefix=N,P.rows=R}return{...P,...le};function M({courtId:R}){let N=(a?C.concat(b??[]):C).filter(A=>A.schedule?.courtId===R||A.schedule?.allocatedCourts?.map(({courtId:_})=>_).includes(R));return h?Nk({matchUps:N,schedulingProfile:n}):N}}function bF({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:fr};let i=Object.keys(t).filter(r=>!e||r===e),n;return i.forEach(r=>{let a=t[r],{matchUpDailyLimits:s}=O$e({tournamentRecord:a});n=s}),{matchUpDailyLimits:n}}function O$e(t){let e=zt(t,[{[ha]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:n}=Cb({policyType:wv,tournamentRecord:i}),{extension:r}=_i({element:i,name:tR}),a=r?.value?.dailyLimits,s=n?.defaultDailyLimits;return{matchUpDailyLimits:a||s}}function W4(t){let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:n,drawDefinition:r,excludeMargin:a,exclusionRule:s,zoneDoubling:o,matchUpType:l,scaleName:u,eventId:c,zonePct:d,drawId:p,event:h}=t;if(!n&&!e)return{error:ot};if(l&&![Rn,Dn].includes(l))return{error:Ee,info:{matchUpType:l}};if(e&&!ac(e))return{error:Ee,context:{matchUps:e}};let f=Ca[u],m=f?.ascending??t.ascending??!1,g=f?.accessor??t.valueAccessor,v=Array.isArray(f?.range)?Math.abs(f.range[0]-f.range[1]):0,y=yi(d)&&v?(d??0/100)*v:t.zoneMargin??v,b={withScaleValues:!0,withCompetitiveness:!0},I={matchUpTypes:l?[l]:[Rn,Dn]},S=n?.participants;e?.[0]?.hasContext?p?e=e.filter(N=>N.drawId===p):c&&(e=e.filter(N=>N.eventId===c)):e===void 0&&(e=p&&!r&&[]||!p&&c&&!h&&[]||p&&uo({inContext:!0,drawDefinition:r,contextFilters:I,contextProfile:b,participants:S})?.matchUps||!p&&c&&gf({inContext:!0,contextFilters:I,contextProfile:b,participants:S,event:h})?.matchUps||Za({tournamentRecord:n,contextFilters:I,contextProfile:b})?.matchUps||[]),l&&(e=e.filter(N=>N.matchUpType===l));let w=e.filter(({winningSide:N,score:A,sides:_,matchUpStatus:x})=>![_a,On,ir,nD,al].includes(x??"")&&ca({score:A})&&_?.length===2&&N),T=F$e({matchUps:w,excludeMargin:a,exclusionRule:s,valueAccessor:g,ascending:m,scaleName:u}),U=!o||_r(Rn)(l)?y:(y||0)*2,C=y?w.map(({competitiveProfile:N,matchUpType:A,score:_,sides:x})=>{let O=jpe({singlesForDoubles:i,valueAccessor:g,matchUpType:A,scaleName:u,sides:x}),$=Math.abs(O[0].value-O[1].value);return{competitiveness:N?.competitiveness,valuesGap:$,score:_}}).filter(({valuesGap:N})=>N<=U):[],E=L$e({zoneData:C}),P=E&&[].concat(Object.values(E)).flat().length,M=P&&Object.assign({},...Object.keys(E).map(N=>({[N]:Math.round(1e4*E[N].length/P)/100}))),R=w.length-(C?.length||0);return{...le,relevantMatchUps:w,zoneDistribution:M,zoneData:C,accuracy:T,nonZone:R}}function L$e({zoneData:t}){let e={[aW]:[],[gC]:[],[vC]:[]};for(let i of t){let{competitiveness:n,score:r,valuesGap:a}=i;e[n]&&e[n].push({score:r,valuesGap:a})}return e}function jpe({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:n,scaleName:r,sides:a}){let s=e?.range.sort(),o=l=>{let u=l?.[e?.valueAccessor];return{exclude:e&&u>=s[0]&&u<=s[1],exclusionValue:u}};return a.sort((l,u)=>l.sideNumber-u.sideNumber).map(({participant:l})=>{let u=[],c=l?.individualParticipants;if(c?.length){let d=[],p=0;for(let h of c){let{scaleValue:f,value:m}=WX({singlesForDoubles:t,valueAccessor:i,participant:h,matchUpType:n,scaleName:r}),{exclude:g,exclusionValue:v}=o(f);g&&u.push(v),d.push(f),m&&!isNaN(p)?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:u,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=WX({singlesForDoubles:t,valueAccessor:i,matchUpType:n,participant:l,scaleName:r}),{exclude:h,exclusionValue:f}=o(d);return h&&u.push(f),{participantName:l.participantName,exclusionValues:u,scaleValue:d,value:p}}else return{}})}function WX({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:n,scaleName:r}){let a=t?Rn:i,s=n?.rankings?.[a]?.find(u=>u.scaleName===r),o=(n?.ratings?.[a]?.find(u=>u.scaleName===r)||s)?.scaleValue,l=e?o?.[e]:o;return{scaleValue:o,value:l}}function F$e({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:n,scaleName:r,matchUps:a}){let s={affirmative:[],negative:[],excluded:[]};for(let u of a){let{matchUpType:c,sides:d,score:p,winningSide:h}=u;if(!h)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:Zt};let f=h-1,m=jpe({exclusionRule:e,valueAccessor:i,matchUpType:c,scaleName:r,sides:d});if(e){let S=m.map(({exclusionValues:w})=>w).flat();if(S.length){s.excluded.push({scoreString:p?.scoreStringSide1,exclusionValues:S,winningSide:h,sideValues:m});continue}}if(m.filter(S=>![void 0,"",null].includes(S.value)).length<2){s.excluded.push({scoreString:p?.scoreStringSide1,missingValues:!0,winningSide:h,sideValues:m});continue}let g=m[f].value-m[1-f].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){s.excluded.push({scoreString:p?.scoreStringSide1,excludeMargin:t,winningSide:h,excludeGap:y,sideValues:m,valuesGap:g});continue}let b=n?g:g*-1,I=h===1?p?.scoreStringSide1:p?.scoreStringSide2;b>0?s.affirmative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p}):s.negative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p})}let o=s.affirmative.length+s.negative.length,l=o&&s.affirmative.length/o*100;return s.percent=l?Math.round(100*l)/100:0,s}function w0({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:n}=Xce({collectionGroups:e}),r;for(let a of t||[]){let{collectionValueProfiles:s,collectionGroupNumber:o,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=a,h=o&&n.includes(o);if(yi(p||d))r=!0;else{if(h)continue;if(typeof l=="number"&&yi(l))i+=l;else if(Array.isArray(s)&&s?.length)for(let f of s)i+=f.matchUpValue;else typeof c=="number"&&yi(c)&&(i+=(u??0)*c)}}for(let a of e)i+=a.groupValue??0;return r||!i?{aggregateValue:!0,...le}:{valueGoal:Math.floor(i/2)+1,...le}}function Y4(t){let{timeStamp:e,schedule:i,matchUp:n}=t,r=zt(t,[{[hf]:!0}]);if(r.error)return r;let{itemValue:a,timeStamp:s}=Nb({timeItems:n?.timeItems||[],itemType:dW});return!i||s&&e&&new Date(s).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function K4({matchUps:t,matchUpId:e}){if(!ac(t))return{error:Ee};let i=t.find(o=>o.matchUpId===e),{drawId:n,eventId:r,structureId:a,tournamentId:s}=i||{};return{matchUpId:e,drawId:n,eventId:r,structureId:a,tournamentId:s}}function fD(t,e){if(!Ki(t))return{error:Ee};if(!Array.isArray(e))return{error:Ee};let i={};for(let{param:n,error:r,attr:a}of e){let s=$$e({params:t,param:n,attr:a,error:r});if(s?.error)return s;i[n]=s}return i}function $$e({params:t,param:e,attr:i,error:n}){if(e===lL&&Ki(t.drawDefinition)&&Xn(t.structureId)){let r=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!r.length&&n?{error:n}:{structure:r}}if(e===hf){let r=Rpe({...t,...i});return r.error&&n?{...r,error:n}:r}return{error:Ya,info:{param:e}}}function Z4(t){let{structureId:e,matchUpId:i,event:n}=t,r=t.drawDefinition,a=zt(t,[{[ha]:!0},{[E3]:{[aL]:!1,[th]:!1,[_le]:!1,[Gm]:!1}}]);if(a[Gc])return a;let s=fD(t,[{[JU]:hf,[Gc]:Zt}])?.matchUp;if(i&&s?.error)return s;!r&&s?.drawDefinition&&(r=s?.drawDefinition);let o=s?.structure;if(!o&&e&&!i){if(!r)return{error:Zd};let p=li({drawDefinition:r,structureId:e});if(p.error)return p;o=p.structure}let l=o?.matchUpFormat,u=r?.matchUpFormat,c=n?.matchUpFormat,d=s?.matchUp?.matchUpFormat||l||u||c;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:c,drawDefaultMatchUpFormat:u,matchUpFormat:d}}function X4({profileBands:t,tournamentRecord:e,matchUps:i}){if(!ac(i))return{error:Vm};let n=!t&&Cb({policyType:zf,tournamentRecord:e}).policy,r=t||n?.profileBands||sW[zf].profileBands,a=i.filter(({winningSide:p})=>p),s=a.map(gue),o=(p,h)=>{let f=mue(h,r);return p[f]+=1,p},l=vue(s).reduce((p,h)=>o(p,h),{[aW]:0,[gC]:0,[vC]:0,[uue]:0}),u=Object.keys(l).reduce((p,h)=>(l[h]||0)+p,0),c=Object.keys(l).map(p=>{let h=parseFloat((l[p]/u).toFixed(4));return{[p]:h*100}}),d=a.filter(({matchUpStatus:p})=>p===vX).length;return c.push({[vX]:parseFloat((d/u).toFixed(4))*100}),{competitiveBands:Object.assign({},...c),...le}}var{stageOrder:YX}=R_e;function B$e(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(YX[t?.stage]||0)-(YX[e?.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function J4({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:n,tournamentRecords:r,schedulingProfile:a,tournamentRecord:s,withSplitRounds:o,matchUpFilters:l,scheduleDate:u,withRoundId:c,venueId:d,context:p}){if(n&&!Array.isArray(n||typeof n[0]!="object"))return{error:Ee,inContextMatchUps:n};if(s&&!r){if(typeof s!="object")return{error:F1};r={[s.tournamentId]:s}}let h=typeof r!="object"||!Object.keys(r).length;if((d||u||!n||!a&&(t||i||a||o))&&h)return{error:fr};let f=Object.assign({},...Object.values(r??{}).map(({venues:w=[],tournamentId:T})=>({[T]:w?.map(({venueId:U})=>U)}))),m=Object.values(r??{}).map(({events:w=[],tournamentId:T,startDate:U,endDate:C})=>w.map(E=>({...E,validVenueIds:f[T],startDate:E.startDate??U,endDate:E.endDate??C}))).flat(),{segmentedRounds:g,profileRounds:v}=r&&(t||i||a||o)&&hF({tournamentRecords:r,schedulingProfile:a})||{},y=t&&Object.assign({},...v.map(w=>({[w.id]:w}))),b=n||r&&jd({tournamentRecords:r,matchUpFilters:l})?.matchUps||[],I=[],S=b&&Object.values(b.reduce((w,T)=>{let U=WG(T).id,C=g?.[U],E=[...w[U]?.matchUps??[],T],{containerStructureId:P,stageSequence:M,structureName:R,tournamentId:N,isRoundRobin:A,matchUpType:_,roundNumber:x,roundOffset:O,structureId:$,eventName:F,roundName:j,drawName:H,eventId:G,drawId:W}=T,q=A?P:$;return{...w,[U]:{id:c?U:void 0,structureId:q,stageSequence:M,segmentsCount:C,structureName:R,tournamentId:N,matchUpType:_,roundNumber:x,roundOffset:O,eventName:F,roundName:j,drawName:H,matchUps:E,eventId:G,drawId:W}}},{})).map(w=>{let{minFinishingSum:T,winnerFinishingPositionRange:U}=_$e(w.matchUps),C=w.segmentsCount;if(C){let x=w.matchUps.length/C;return Aa(w.matchUps.sort((O,$)=>O.roundPosition-$.roundPosition),x).map((O,$)=>{let{unscheduledCount:F,incompleteCount:j,matchUpsCount:H,isScheduled:G,isComplete:W,byeCount:q}=qX(O),Z=zX({matchUps:w.matchUps,tournamentRecords:r,events:m,round:w});return Vt({...w,...p,roundSegment:{segmentsCount:C,segmentNumber:$+1},winnerFinishingPositionRange:U,unscheduledCount:F,incompleteCount:j,minFinishingSum:T,matchUpsCount:H,isScheduled:G,roundTiming:Z,isComplete:W,byeCount:q,matchUps:O})})}let{unscheduledCount:E,incompleteCount:P,matchUpsCount:M,isScheduled:R,isComplete:N,byeCount:A}=qX(w.matchUps),_=zX({matchUps:w.matchUps,tournamentRecords:r,events:m,round:w});return Vt({...w,...p,winnerFinishingPositionRange:U,unscheduledCount:E,incompleteCount:P,minFinishingSum:T,matchUpsCount:M,isScheduled:R,roundTiming:_,isComplete:N,byeCount:A})}).flat().filter(w=>{if(t){let $=Pi(t),F=c?w.id:WG(w).id;if($&&y[F]&&Pi(y[F].scheduleDate)===$)return!1}let{isComplete:T,isScheduled:U}=w,C=!i||!T,E=!e||!U,P=d||u?m?.find(({eventId:$})=>$===w.eventId):void 0,M=P?.startDate??s?.startDate,R=P?.endDate??s?.endDate,N=!u||!M||new Date(u)>=new Date(M),A=!u||!R||new Date(u)<=new Date(R),_=N&&A,x=!d||P?.validVenueIds.includes(d),O=C&&E&&x&&_;return O||I.push(w),O}).sort(B$e)||[];return{...le,rounds:S,excludedRounds:I}}function DC(t){let{matchUp:e,sideNumber:i,setNumber:n,isTiebreakValue:r,isPointValue:a}=t||{},{matchUpFormat:s}=t||{};if(!e)return{error:Oo};s=s||e?.matchUpFormat;let o=So(s),l=!!e?.winningSide,u=e.score?.sets,c=u?.length,d=n&&n-1,p=!!u?.find((q,Z)=>q.setNumber===n&&Z===d),h=u?.filter(q=>q?.winningSide)||[],f=h?.length||0,m=n&&u?.slice(n)||[],g=!!(c&&n&&m?.reduce((q,Z)=>(!Z||!Z.side1Score&&!Z.side2Score&&!Z.side1TiebreakScore&&!Z.side2TiebreakScore&&!Z.side1PointScore&&!Z.side2PointScore)&&q,!0)),v=n<=c&&u.find(q=>q.setNumber===n),y=v&&TC({setObject:v,matchUpScoringFormat:o}),{isCompletedSet:b,sideGameScores:I,sideTiebreakScores:S}=y||{},w=!!(v&&!b&&g||n&&n===c+1&&!l),T=[1,2].includes(i),U=T?i-1:0,C=v&&T&&(!r&&!a&&I[U]!==void 0&&I[U]||r&&S[U]!==void 0&&S[U]),E=!!C,P=h?.map(q=>TC({setObject:q,matchUpScoringFormat:o}).isValidSetOutcome).reduce((q,Z)=>q&&Z,!0),M=h.reduce((q,Z)=>{let{winningSide:K}=Z,Q=K-1;return q[Q]++,q},[0,0]),R=e?.winningSide,N=R&&R-1,A=1-N,_=M[N],x=M[A],O=Math.max(...M),$=Rl(M)[O],{bestOf:F,exactly:j}=o??{},H=F&&Math.ceil(F/2)||j||1,G=O===H&&$===1&&M.indexOf(O)+1||void 0,W=_>x&&R===G;return{completedSetsHaveValidOutcomes:P,validMatchUpWinningSide:W,calculatedWinningSide:G,matchUpScoringFormat:o,validMatchUpOutcome:G&&P&&W,isLastSetWithValues:g,completedSetsCount:f,isCompletedMatchUp:l,isValidSideNumber:T,hasExistingValue:E,existingValue:C,isExistingSet:p,isActiveSet:w,...y}}function Q4({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:s,tournamentRecord:o,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,tournamentId:v,inContext:y,context:b,event:I}){let{eventId:S,eventName:w,endDate:T,eventType:U,category:C,gender:E}=I??{},P={...b,...Vt({surfaceCategory:I?.surfaceCategory??o?.surfaceCategory,indoorOutDoor:I?.indoorOutdoor??o?.indoorOutdoor,endDate:T??I?.endDate??o?.endDate,tournamentId:v??o?.tournamentId,eventName:w,eventType:U,category:C,eventId:S,gender:E})},M;return!t?.length&&o&&({participants:t,participantMap:p,groupInfo:M}=Pb({participantsProfile:n,useParticipantMap:s,tournamentRecord:o,contextProfile:f,inContext:y})),I&&f&&!c&&(c=zm({policyDefinitions:a,tournamentRecord:o,contextProfile:f,drawDefinition:m,event:I})),{...sD({context:P,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:l,participantMap:p,contextContent:c,contextFilters:u,matchUpFilters:d,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,inContext:y,event:I}),groupInfo:M}}var Gpe={};Fi(Gpe,{getCompetitionVenues:()=>BR,getCourts:()=>e5,getVenuesAndCourts:()=>Wm,publicFindVenue:()=>fW});function e5({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(n=>e?n.venueId===e:i?i.includes(n.venueId):!0).map(n=>{let{venueId:r}=n,a=Ct(n.courts||[]);return a.forEach(s=>Object.assign(s,{venueId:r})),a}).flat()}:{error:ot}}var Hpe={};Fi(Hpe,{categoryCanContain:()=>Y1,getCategoryAgeDetails:()=>sw,getEvent:()=>n5,getEventProperties:()=>t5,getEventStructures:()=>LL,getEventTimeItem:()=>aR,getEvents:()=>i5,getFlightProfile:()=>Cr,getScaledEntries:()=>b0});function t5({tournamentRecord:t,event:e}){if(!t)return{error:ot};if(!e)return{error:qn};let i=e.entries||[],n=t.participants||[],r=e.category?.categoryName||e.category?.ageCategoryCode,{eventType:a}=e,s=i.map(d=>d.participantId),o=n.filter(d=>s.includes(d.participantId)),l,u,c;return{entryScaleAttributes:o.map(d=>{let{participantId:p,participantName:h,name:f}=d,m={scaleType:hW,eventType:a,scaleName:r},g=_h({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;m={scaleType:Eue,eventType:a,scaleName:r};let v=_h({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;m={scaleType:Due,eventType:a,scaleName:r};let y=_h({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;return l=!!(l||g),u=!!(u||v),c=!!(c||y),{participantId:p,participantName:h||f,seed:g,ranking:v,rating:y}}),hasSeededParticipants:l,hasRankedParticipants:u,hasRatedParticipants:c}}function i5({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:n,eventIds:r,drawIds:a,context:s}){if(!t)return{error:ot};let{tournamentId:o}=t,l=(t.events??[]).filter(({eventId:c})=>!r||Array.isArray(r)&&r.includes(c)).map(c=>{let d=c.drawDefinitions?.map(hC);if(a?.length&&!Dr(a,d).length)return;let p=Ct(c);return n&&Object.assign(p,{tournamentId:o}),s&&Object.assign(p,s),p}).filter(Boolean),u={};if(e){let c=dr({withScaleValues:!0,tournamentRecord:t}).participantMap,d=p=>p.reduce((h,f)=>h+parseFloat(f),0);for(let p of l){let h=i??p.eventType,f=p.eventId;u[f]||(u[f]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let m=(p.entries??[]).filter(({entryStatus:w})=>fd.includes(w)).map(Vi),g=w=>{if(w?.ratings?.[h])for(let T of w?.ratings?.[h]??[]){let U=T.scaleName;u[f].ratings[U]||(u[f].ratings[U]=[]);let C=Ca[U]?.accessor;if(C){let E=parseFloat(T.scaleValue?.[C]);E&&u[f].ratings[U].push(E)}}if(w?.rankings?.[h])for(let T of w?.rankings?.[h]??[]){let U=T.scaleName;u[f].ranking[U]||(u[f].ranking[U]=[]),T.scaleValue&&u[f].ranking[U].push(T.scaleValue)}};for(let w of m){let T=c?.[w]?.participant;if(T?.participantType!==ji)for(let U of T?.individualParticipantIds??[]){let C=c?.[U]?.participant;g(C)}else g(T)}let v=u[f].ratings;for(let w of Object.keys(v)){let T=v[w];if(!T.length)continue;let U=sX(T)?.toFixed(2);u[f].ratingsStats[w]={avg:parseFloat((d(T)/T.length).toFixed(2)),median:U?parseFloat(U):void 0,max:Math.max(...T),min:Math.min(...T)}}let y=(w,T)=>{let U=C=>{if(u[f].draws?.[w]&&C?.ratings?.[h])for(let E of C?.ratings?.[h]??[]){let P=E.scaleName;u[f].draws[w]?.ratings[P]||(u[f].draws[w].ratings[P]=[]);let M=Ca[P]?.accessor;if(M){let R=parseFloat(E.scaleValue?.[M]);R&&u[f].draws[w].ratings[P].push(R)}}if(u[f].draws?.[w]&&C?.rankings?.[h])for(let E of C?.rankings?.[h]??[]){let P=E.scaleName;u[f].draws[w]?.ranking[P]||(u[f].draws[w].ranking[P]=[]);let M=E.scaleValue;M&&u[f].draws[w].ranking[P].push(M)}};for(let C of T.filter(Boolean)){let E=c?.[C]?.participant;if(E?.participantType!==ji)for(let P of E?.individualParticipantIds??[]){let M=c?.[P]?.participant;U(M)}else U(E)}},b=[],I=w=>a?.length&&a.includes(w)||b.includes(w);for(let w of p.drawDefinitions??[]){let T=w.drawId;if(I(T))continue;let U=Ab({drawDefinition:w}).assignedParticipantIds??[];u[f].draws[T]||(u[f].draws[T]={ratingsStats:{},ratings:{},ranking:{}}),b.push(T),y(T,U)}let S=Cr({event:p}).flightProfile;for(let w of S?.flights??[]){let T=w.drawId;if(I(T))continue;let U=w.drawEntries.map(Vi);y(T,U)}for(let w of b){let T=u[f].draws[w].ratings;for(let U of Object.keys(T)){let C=T[U];if(!C.length)continue;let E=sX(C)?.toFixed(2);u[f].draws[w].ratingsStats[U]={avg:parseFloat((d(C)/C.length).toFixed(2)),median:E?parseFloat(E):void 0,max:Math.max(...C),min:Math.min(...C)}}}}}return Vt({eventScaleValues:u,events:l,...le})}function n5({tournamentRecord:t,drawDefinition:e,context:i,event:n}){if(!t)return{error:ot};if(!n)return{error:qn};let r=Ct(n);i&&Object.assign(r,i);let a=e&&r.drawDefinitions?.find(({drawId:s})=>e.drawId===s);return Vt({drawDefinition:a,event:r})}function V$e(t){let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:n}=H$e(t),r=z$e({...t,policyDefinitions:n,appliedPolicies:i}),a=G$e(t),s=q$e({...t,consideredEntries:a,appliedPolicies:i});if(s?.error)return ce({result:s,stack:e});let o=W$e({...t,consideredEntries:a}),l=j$e({...t,appliedPolicies:i,policyDefinitions:n,drawSize:o});if(l.error)return ce({result:l,stack:e});let u=l.drawType;if(isNaN(o)&&u!==Al)return ce({result:{error:B1},stack:e});let c=n?.[Cc]??i?.[Cc],d=t.seedingProfile??c?.seedingProfile?.drawTypes?.[u??""]??c?.seedingProfile;t.seedingProfile&&(n[Cc]||(n[Cc]={...qG[Cc]}),n[Cc].seedingProfile=d);let p=Y$e({...t,drawType:u});return p?.error?ce({result:p,stack:e}):{drawSize:o,drawType:u,enforceGender:r,seedingProfile:d,appliedPolicies:i,policyDefinitions:n}}function j$e(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:n=!0,drawSize:r}=t,a=t.drawTypeCoercion??OR({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),s=Ude({drawType:t.drawType,enforceMinimumDrawSize:n,drawTypeCoercion:a,drawSize:r});return s.error?s:{drawType:s.drawType}}function zpe(t){return t?.filter(e=>e.entryStatus&&[...fd,pR].includes(e.entryStatus))}function G$e({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:n}){return(n&&[]||zpe(e)||(t?i:[])).filter(({entryStage:r})=>!r||r===Nt)}function H$e(t){let{tournamentRecord:e,event:i}=t,n={...t?.appliedPolicies,...sn({tournamentRecord:e,event:i}).appliedPolicies??{}},r=Ct(t.policyDefinitions??{},!1,!0);return{appliedPolicies:n,policyDefinitions:r}}function z$e({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){return t??e?.[Ha]?.participants?.enforceGender??i?.[Ha]?.participants?.enforceGender}function q$e(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:n,enforceGender:r,participantMap:a,participants:s,event:o}=t;return o&&s&&YL({consideredEntries:e,policyDefinitions:n,appliedPolicies:i,participantMap:a,enforceGender:r,participants:s,event:o})}function W$e(t){return!t.drawSize&&t.consideredEntries.length&&![Al,Z1,XU,id,Kh].includes(t.drawType??"")&&jU(t.consideredEntries.length)||t.drawSize&&ri(t.drawSize)||!1}function Y$e(t){let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:n,drawType:r}=t,a=!n&&e&&nF({tournamentRecord:e,categoryType:i?.category?.categoryType,categoryName:i?.category?.categoryName});return a?.length&&!a.includes(r)?{error:Aq}:{...le}}function qpe(t){let{drawDefinition:e,appliedPolicies:i}=t,n=i?.[hm],r=us({drawDefinition:e});return e.structures?.forEach(a=>{let s=Zg({structureId:a.structureId,matchUpsMap:r}),o=fue({roundNamingPolicy:n,drawDefinition:e,structure:a,matchUps:s}),{roundNamingProfile:l,roundProfile:u}=o;(a.structures||[a]).forEach(c=>{(c.matchUps??[]).forEach(d=>{let p=d?.roundNumber?.toString();if(p){let h=l?.[p]?.roundName,f=l?.[p]?.abbreviatedRoundName,m=u?.[p]?.feedRound;Object.assign(d,{abbreviatedRoundName:f,feedRound:m,roundName:h})}})})}),{drawDefinition:e}}function zR(t){let{voluntaryConsolation:e,tournamentRecord:i,event:n}=t,r="generateDrawDefinition",{participants:a,participantMap:s}=dr({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),o=zpe(n?.entries)??[],l=V$e({...t,participantMap:s,participants:a,eventEntries:o});if(l.error)return ce({result:l,stack:r});let{appliedPolicies:u,policyDefinitions:c,drawSize:d,drawType:p,enforceGender:h,seedingProfile:f}=l,m=n?.eventType,g=t.matchUpType??m,v=YFe({...t,enforceGender:h,eventType:m,matchUpType:g});if(v.error)return ce({result:v,stack:r});let{matchUpFormat:y,tieFormat:b}=v;if(t.drawId&&typeof t.drawId!="string")return ce({result:{error:Ee},stack:r});let I=S$e({...t,policyDefinitions:c,tournamentRecord:i,appliedPolicies:u,matchUpFormat:y,seedingProfile:f,participants:a,eventEntries:o,matchUpType:g,tieFormat:b,drawSize:d,drawType:p,event:n});if(I.error)return ce({result:I,stack:r});let{existingDrawDefinition:S,positioningReports:w,drawDefinition:T,structureId:U,conflicts:C,entries:E}=I;if(!T)return ce({result:{error:Ee},stack:r});let P=T$e({...t,existingDrawDefinition:S,positioningReports:w,appliedPolicies:u,drawDefinition:T,seedingProfile:f,participants:a,structureId:U,entries:E,params:t,stack:r});if(P.error)return P;let{qualifyingConflicts:M}=P;return T.drawName=t.drawName??(p&&Is(p)),d&&typeof e=="object"&&d>=4&&DW({...e,drawDefinition:T,matchUpType:g}),t.hydrateRoundNames&&u?.[hm]&&qpe({drawDefinition:T,appliedPolicies:u}),{existingDrawDefinition:!!S,qualifyingConflicts:M,positioningReports:w,drawDefinition:T,structureId:U,...le,conflicts:C}}function Wpe({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:n,scaleName:r}){if(!t)return{error:Zt,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,n).map(({participantId:o},l)=>({[o]:l+1})));r=r||t.scaleName;let s=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:o})=>({scaleItems:[{scaleValue:a[o],eventType:t.eventType,scaleType:Nh,scaleName:r,scaleDate:s}],participantId:o}))}}function K$e({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:n,scaleName:r,drawSize:a,drawId:s,event:o,stage:l,sortDescending:u,scaleSortMethod:c}){let d=mF({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:s,event:o,stage:l});if(d.error)return d;let{entries:p,seedsCount:h,stageEntries:f}=d;if(!f||!h)return{error:Ee};let m=b0({tournamentRecord:t,scaleAttributes:n,scaleSortMethod:c,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=Wpe({scaleAttributes:n,scaledEntries:m,stageEntries:f,seedsCount:h,scaleName:r});return{scaleItemsWithParticipantIds:g}}var r5={};Fi(r5,{addDrawEntries:()=>wW,addEventEntries:()=>Ep,addEventEntryPairs:()=>Jpe,destroyPairEntries:()=>Jue,destroyPairEntry:()=>UW,getEntriesAndSeedsCount:()=>mF,getMaxEntryPosition:()=>j4,modifyEntriesStatus:()=>Ik,modifyEventEntries:()=>Qpe,mutate:()=>Ype,promoteAlternate:()=>Zpe,promoteAlternates:()=>s5,query:()=>Fpe,removeDrawEntries:()=>Xpe,removeEventEntries:()=>TR,setEntryPosition:()=>a5,setEntryPositions:()=>Kpe});var Ype={};Fi(Ype,{addDrawEntries:()=>wW,addEventEntries:()=>Ep,addEventEntryPairs:()=>Jpe,destroyPairEntries:()=>Jue,destroyPairEntry:()=>UW,modifyEntriesStatus:()=>Ik,modifyEventEntries:()=>Qpe,promoteAlternate:()=>Zpe,promoteAlternates:()=>s5,removeDrawEntries:()=>Xpe,removeEventEntries:()=>TR,setEntryPosition:()=>a5,setEntryPositions:()=>Kpe});function a5({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:n,skipRefresh:r,event:a}){let s="setEntryPositions";if(!t)return{error:ot};if(!i)return ce({result:{error:la},stack:s});if(n!==void 0&&!Number.isSafeInteger(n))return{error:Ee,entryPosition:n};(a?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)}),(e?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)});let o=l=>{l.entries.forEach(u=>{u.entryPosition===n&&u.participantId!==i&&(u.entryPosition+=.1)})};return r||(a?.entries&&(o(a),a.entries=xd({entries:a.entries})),e?.entries&&(o(e),e.entries=xd({entries:e.entries}))),{...le}}function Kpe({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:n}){if(!t)return{error:ot};if(!Array.isArray(e))return{error:Ee};for(let r of e){let{participantId:a,entryPosition:s}=r,o=a5({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:s,event:n});if(o.error)return o}return n?.entries&&(n.entries=xd({entries:n.entries})),i?.entries&&(i.entries=xd({entries:i.entries})),{...le}}function Zpe(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:Ee,participantId:e}:s5({...t,participantIds:[e].filter(Boolean)})}function s5({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:n,stage:r=Nt,eventId:a,event:s}){if(!t)return{error:ot};if(!Array.isArray(i))return{error:Ee,participantIds:i};if(!s)return{error:qn};let o="promoteAlternates";if(s){let l=KX({element:s,participantIds:i,stageSequence:n,stage:r});if(l.error)return l}if(e){let l=KX({element:e,participantIds:i,stageSequence:n,stage:r});if(l.error)return a?ce({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...le},stack:o}):l}return{...le}}function KX({participantIds:t,stageSequence:e,element:i,stage:n}){let r=(i.entries||[]).filter(d=>d.entryStatus===Hc),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),s=r.reduce((d,p)=>{let{entryPosition:h}=p;return isNaN(h)&&d||(!d||h<d.entryPosition)&&p||d},void 0),o=a.length?a:[s].filter(Boolean);if(!o?.length)return{error:Yse};let l=o.filter(({entryStatus:d})=>d!==Hc);if(l.length)return{error:mG,invalidEntryStatus:l};let u=o.filter(({entryStage:d})=>d&&d!==n);if(u.length)return{error:yAe,invalidStage:u};let c=e&&o.filter(d=>d.stageSequence!==e);if(c?.length)return{error:bAe,invalidStageSequence:c};for(let d of o){d.entryStatus=sl;let p=d?.entryPosition;isNaN(p)||i.entries.forEach(f=>{f.entryStatus===Hc&&f.entryPosition>p&&(f.entryPosition=f.entryPosition-1)});let h=Math.max(...i.entries.filter(f=>f.entryStatus===sl&&!isNaN(f.entryPosition)).map(({entryPosition:f})=>ri(f||0)),0);d.entryPosition=h||0}return{...le}}function Xpe({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:n,stages:r,event:a}){if(!a)return{error:qn};if(!n)return{error:Zd};if(!e?.length)return{error:yv};let s=Ab({drawDefinition:i,stages:r}).assignedParticipantIds??[];if(mo(s,e))return{error:WU};let o=c=>{let d=c.participantId;return!e.includes(d)},{flightProfile:l}=Cr({event:a}),u=l?.flights?.find(c=>c.drawId===n);return u?.drawEntries&&(u.drawEntries=u.drawEntries.filter(o),t&&(u.drawEntries=xd({entries:u.drawEntries}))),i?.entries&&(i.entries=i.entries.filter(o),t&&(i.entries=xd({entries:i.entries}))),{...le}}function jp(t){let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:n,disableNotice:r,pairOverride:a,participant:s}=t,o=t.tournamentId?t.tournamentRecords?.[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&t.tournamentRecords?.[t.activeTournamentId]);if(!o)return{error:ot};if(!s)return ce({result:{error:Kw},stack:e});s.participantId||(s.participantId=mn()),o.participants||(o.participants=[]);let{participantId:l,individualParticipantIds:u}=s;if(o.participants.reduce((m,g)=>g.participantId===l||m,!1))return{error:Gse};let{participantType:c,participantRole:d}=s;if(!c||!Object.keys(pT).includes(c))return{error:Vd,participantType:c};if(!d)return{error:Vse};let p=o.participants||[],h=p.filter(m=>m.participantType===ji).map(m=>m.participantId);if(c!==ji&&s.person)return{error:Ee,person:s.person};if(u&&!Array.isArray(u))return{error:Ee,individualParticipantIds:u};if(c===Ni){if(s.person)return{error:Ee,person:s.person};if(s.individualParticipantIds){if(s.individualParticipantIds.length!==2&&!a)return ce({info:"PAIR must be 2 individualParticipantIds",result:{error:Ul},stack:e});{let v=p.filter(y=>y.participantType===ji).map(y=>y.participantId);if(!Array.isArray(s.individualParticipantIds))return ce({result:{error:Ul},stack:e});if(!s.individualParticipantIds.reduce((y,b)=>v.includes(b)&&y,!0))return ce({result:{error:Ul},stack:e})}}else return ce({result:{error:yv},stack:e});let m=p.filter(v=>v.participantType===Ni).map(v=>({individualParticipantIds:v.individualParticipantIds,participant:v})),g=s.participantType===Ni&&m.find(v=>Dr(v.individualParticipantIds,s.individualParticipantIds).length===2);if(g&&!i)return{...le,existingParticipant:!0,participant:n&&Ct(g.participant)};if(!s.participantName){let v=p.filter(b=>s.individualParticipantIds?.includes(b.participantId)),y=v.map(b=>b.person?.standardFamilyName).filter(Boolean).join("/");v.length===1&&(y+="/Unknown"),s.participantName=y}}else if(c===ji){if(!s.person?.standardFamilyName||!s.person?.standardGivenName)return{error:Wse};if(!s.participantName){let m=`${s.person.standardFamilyName.toUpperCase()}, ${s.person.standardGivenName}`;s.participantName=m}}else if(c&&[wn,Iu].includes(c)){if(u||(s.individualParticipantIds=[]),s.individualParticipantIds?.length)for(let m of s.individualParticipantIds){if(typeof m!="string")return ce({result:{participantId:m,error:Ee},stack:e});if(!h.includes(m))return ce({result:{participantId:m,error:Nr},stack:e})}}else return{error:Vd};o.participants.push(s),r||Ti({payload:{tournamentId:o.tournamentId,participants:[s]},topic:Wg});let f={participant:n&&Ct(s),...le};return Vt(f)}function sd({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:n=[]}){if(!i)return{error:ot};i.participants||(i.participants=[]);let r=i.participants.map(d=>d.participantId)||[];n.forEach(d=>{d.participantId||(d.participantId=mn())});let a=n.filter(d=>!r.includes(d.participantId)),s=n.filter(d=>r.includes(d.participantId)),o=a.filter(d=>d.participantType===ji),l=a.filter(d=>d.participantType!==ji),u=o.concat(...l),c=[];if(u.length){for(let p of u){let h=jp({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(h.error)return h;h.success&&!h.existingParticipant&&c.push(h.participant)}c.length&&Ti({topic:Wg,payload:{tournamentId:i.tournamentId,participants:c}});let d={participants:e&&Ct(c),addedCount:c.length,...le};return s.length&&Object.assign(d,{notAdded:s,info:GO}),Vt(d)}else return{info:"No new participants to add",addedCount:0,...le}}function Jpe(t){let e=zt(t,[{[ha]:!0,[Gm]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:n=Hc,participantIdPairs:r=[],entryStage:a=Nt,tournamentRecord:s,drawDefinition:o,event:l,uuids:u}=t;if(l.eventType!==Dn)return{error:Hh};let c=[],d=new Map;for(let I of s.participants??[]){let{participantType:S,participantId:w,person:T,individualParticipantIds:U}=I;S===ji&&T?.sex?d.set(w,T.sex):S===Ni&&U&&c.push(U)}let p=r.filter(I=>{if(I.length!==2)return!0;if(!l.gender||Mh(l.gender))return!1;if(!d.has(I[0])||!d.has(I[1]))return!0;let S=I.map(T=>d.get(T)),w=PI(l.gender)&&(!PI(S[0])||!PI(S[1]))||yy(l.gender)&&(!yy(S[0])||!yy(S[1]));return su(l.gender)&&(S.sort(_L),(!yy(S[0])||!PI(S[1]))&&(w=!0)),w});if(p.length)return{error:Ul,invalidParticipantIdPairs:p};let h=r.map(I=>({participantId:u?.pop()??mn(),participantRole:bs,individualParticipantIds:I,participantType:Ni})),f=i?h:h.filter(I=>!c.find(S=>Dr(S,I.individualParticipantIds).length===2)),m,g=[];if(f){let I=sd({allowDuplicateParticipantIdPairs:i,participants:f,returnParticipants:!0,tournamentRecord:s});if(I.error)return I;g=I.participants||[],m=I.info}let v=r.map(I=>{let S=g.find(T=>Dr(T.individualParticipantIds,I).length===2);if(S)return S;let{participant:w}=ad({tournamentRecord:s,participantIds:I});return w}).map(I=>I.participantId),y=Ep({participantIds:v,tournamentRecord:s,drawDefinition:o,entryStatus:n,entryStage:a,event:l});f.length&&Ti({payload:{participants:f},topic:Wg});let b=f.map(Vi);return{...y,info:m,newParticipantIds:b}}function Qpe({entryStatus:t=sl,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:n=Nt,tournamentRecord:r,event:a}){if(!r)return{error:ot};if(!a)return{error:qn};let s=r.participants??[],o=s.filter(m=>m.participantType===ji).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!o.includes(m));if(l.length)return{error:Ul,invalidParticipantIds:l};let u=i.filter(m=>m.length!==2);if(u.length)return{error:Ul,invalidParticipantIdPairs:u};let c=s.filter(m=>m.participantType===Ni).map(m=>m.individualParticipantIds),d=i.filter(m=>!c.find(g=>Dr(g,m).length===2)).map(m=>({participantType:Ni,participantRole:bs,individualParticipantIds:m})),p=sd({participants:d,tournamentRecord:r});if(p.error)return p;let h=i.map(m=>{let{participant:g}=ad({tournamentRecord:r,participantIds:m});return g}).map(m=>({participantId:m,entryStatus:t,entryStage:n})),f=e.map(m=>({entryStatus:rc,participantId:m,entryStage:n}));return a.entries=(a.entries??[]).filter(m=>m.entryStage===n),a.entries=a.entries.concat(...h,...f),{...le}}var o5={};Fi(o5,{addDrawDefinition:()=>qR,addEvent:()=>mD,addFlight:()=>TF,assignSeedPositions:()=>phe,attachFlightProfile:()=>m5,categoryCanContain:()=>Y1,deleteDrawDefinitions:()=>IF,deleteEvents:()=>fhe,deleteFlightAndFlightDraw:()=>che,deleteFlightProfileAndFlightDraws:()=>she,generate:()=>ehe,generateEventsFromTieFormat:()=>ihe,getCategoryAgeDetails:()=>sw,getEvent:()=>n5,getEventProperties:()=>t5,getEventStructures:()=>LL,getEventTimeItem:()=>aR,getEvents:()=>i5,getFlightProfile:()=>Cr,getScaledEntries:()=>b0,modifyEvent:()=>mhe,modifyEventMatchUpFormatTiming:()=>ohe,modifyPairAssignment:()=>dhe,mutate:()=>nhe,query:()=>Hpe,refreshEventDrawOrder:()=>f5,removeEventMatchUpFormatTiming:()=>wF,removeScaleValues:()=>g5,removeSeeding:()=>hhe,setEventDates:()=>p5,setEventDisplay:()=>SF,setEventEndDate:()=>d5,setEventStartDate:()=>c5,updateDrawIdsOrder:()=>h5,validateCategory:()=>aC});var ehe={};Fi(ehe,{generateEventsFromTieFormat:()=>ihe});function Z$e({tournamentId:t,event:e}){return e?(Ti({payload:{tournamentId:t,event:e},key:e.eventId,topic:Yle}),{...le}):{error:qn}}var X$e={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},J$e={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},Q$e={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},the={COLLEGE_D3:X$e,COLLEGE_DEFAULT:J$e,COLLEGE_JUCO:Q$e,DOMINANT_DUO:Yoe,DOMINANT_DUO_MIXED:Goe,LAVER_CUP:Qoe,TEAM_DOUBLES_3_AGGREGATION:Foe,TIME_TENNIS_DUAL:Hoe,TIME_TENNIS_PRO_CIRCUIT:joe,USTA_BREWER_CUP:zoe,USTA_OZAKI_CUP:qoe,USTA_COLLEGE:Koe,USTA_GOLD_TEAM_CHALLENGE:Loe,USTA_INTERSECTIONAL:Voe,USTA_LEVEL_1:Zoe,USTA_SECTION_BATTLE:Boe,USTA_SOUTHERN_LEVEL_5:$oe,USTA_TOC:ele,USTA_WTT_ITT:Xoe,USTA_ZONAL:Joe};function mD({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:n}){if(!e)return{error:ot};if(e.events||(e.events=[]),!n)return{error:qn};let{startDate:r,endDate:a}=e;if(!i&&(n.entries?.length||n.drawDefinitions?.length)){let o=Vt({drawDefinitions:!!n.drawDefinitions?.length,entries:!!n.entries?.length});return{info:"entries/drawDefinitions cannot exist",error:Ee,context:o}}let s={eventType:ow,drawDefinitions:[],entries:[],startDate:r,endDate:a,...n};if(n.eventType===Nl){if(n.tieFormat){let o=Lo({tieFormat:n.tieFormat});if(o.error)return o}else if(n.tieFormatName){if(!the[n.tieFormatName])return{context:{tieFormatName:n.tieFormatName},error:Ee};let o=dm({isMock:e?.isMock,namedFormat:n.tieFormatName,event:n});s.tieFormat=o}}if(s.eventId||(s.eventId=mn()),e.events.reduce((o,l)=>o||l.eventId===s.eventId,void 0))return{error:Tse};{let o=s;if(e.events.push(o),!t){let{topics:l}=bu();if(l.includes(vL)){let d=gf({event:n}).matchUps??[];Yg({tournamentId:e?.tournamentId,eventId:n.eventId,matchUps:d})}let{drawDefinitions:u,...c}=n;for(let d of u||[])nR({drawDefinition:d});Z$e({tournamentId:e?.tournamentId,event:c})}return{...le,event:s}}}function ihe(t){let e=zt(t,[{[OT]:{[sL]:!0,[Ple]:!0}},{[ha]:!0}]);if(e.error)return e;let i=t.tieFormat||dm({namedFormat:t.tieFormatName}),n=t.uuids||[Ooe(i.collectionDefinitions.length)],r={[ta]:[],[ms]:[]};if(t.addEntriesFromTeams){let s=t.tournamentRecord.participants?.filter(o=>o.participantType===_o)?.flatMap(o=>o.individualParticipantIds??[]);for(let o of t.tournamentRecord.participants??[])if(s?.includes(o.participantId)){let l=o.person?.sex;if(l&&xp(l)){let u=Ls(l);u&&r[u].push(o.participantId)}}}let a=[];for(let s of i.collectionDefinitions??[]){let o=n?.pop()?.toString()||mn(),l=s.matchUpType,u=s.gender,c={matchUpFormat:s.matchUpFormat,eventName:s.collectionName,category:s.category,gender:u,eventType:l,eventId:o};if(t.addEntriesFromTeams){let d=l===pm?rc:t.entryStatus||sl,p=su(u)?[...r[ta],...r[ms]]:r[Ls(u)||Hf]??[];if(p.length){let h=Ep({participantIds:p,entryStatus:d,event:c});if(h.error)return h}}if(a.push(c),t.addEvents!==!1){let d=mD({internalUse:!0,tournamentRecord:t.tournamentRecord,event:c});if(d.error)return d}}return{...le,events:a}}var nhe={};Fi(nhe,{addDrawDefinition:()=>qR,addEvent:()=>mD,addFlight:()=>TF,assignSeedPositions:()=>phe,attachFlightProfile:()=>m5,deleteDrawDefinitions:()=>IF,deleteEvents:()=>fhe,deleteFlightAndFlightDraw:()=>che,deleteFlightProfileAndFlightDraws:()=>she,modifyEvent:()=>mhe,modifyEventMatchUpFormatTiming:()=>ohe,modifyPairAssignment:()=>dhe,refreshEventDrawOrder:()=>f5,removeEventMatchUpFormatTiming:()=>wF,removeScaleValues:()=>g5,removeSeeding:()=>hhe,setEventDates:()=>p5,setEventDisplay:()=>SF,setEventEndDate:()=>d5,setEventStartDate:()=>c5,updateDrawIdsOrder:()=>h5,validateCategory:()=>aC});function gD({removePriorValues:t=!0,status:e=wu,statusObject:i,event:n}){if(!Ki(i))return{error:Ee};let r=sc({event:n,status:e}),a=`${Dv}.${Ev}`,s={itemValue:{[e]:{...r,...i}},itemType:a};return y0({timeItem:s,removePriorValues:t,event:n})}function vD(t){let e=zt(t,[{[ha]:!0,[Gm]:!0},{eventDataParams:!1,[Go]:Qo}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:n,tournamentRecord:r,status:a=wu,event:s,drawIdsToRemove:o,drawIdsToAdd:l}=t,{appliedPolicies:u}=sn({tournamentRecord:r,event:s}),c={...u,...t.policyDefinitions},d=s?.drawDefinitions?.map(({drawId:S})=>S)??[],p=t.drawDetails?Object.keys(t.drawDetails):[],h=p.length?[]:t.drawIds,f=(l??[]).concat(...o??[],...h??[],...p),m=f.filter(S=>!d.includes(S));if(m.length)return ce({result:{error:cu},context:{invalidDrawIds:m}});let g=sc({event:s,status:a}),v=Object.keys(g?.drawDetails||{}).filter(S=>d.includes(S)).reduce((S,w)=>(S[w]=g.drawDetails[w],S),{});for(let S of d)if((!f.length||f.includes(S))&&(o?.includes(S)||h?.length&&!h.includes(S)?v[S]={...v[S],publishingDetail:{published:!1}}:(l?.includes(S)||h?.includes(S)||!h?.length)&&(v[S]={...v[S],publishingDetail:{published:!0}})),t.drawDetails?.[S]){let w=t.drawDetails[S],T=w.structureDetails??v[S].structureDetails,U=w.stageDetails??v[S].stageDetails??{},{structureIdsToRemove:C=[],structureIdsToAdd:E=[],publishingDetail:P={},stagesToRemove:M=[],stagesToAdd:R=[]}=w;if((E||R)&&(P.published=!0),v[S]={publishingDetail:P,structureDetails:T,stageDetails:U},E.length||C.length){let A=(s?.drawDefinitions?.find(x=>x.drawId===S)?.structures??[]).map(({structureId:x})=>x),_=(E??[]).concat(C??[]).filter(x=>!A.includes(x));if(_.length)return ce({result:{error:or},context:{invalidStructureIds:_}});T=T??{};for(let x of A)C.includes(x)?T[x]={published:!1}:T[x]={published:!0};v[S].structureDetails=T}let N=(s?.drawDefinitions?.find(A=>A.drawId===S)?.structures??[]).map(({stage:A})=>A);if(R.length){for(let A of R)U[A]={published:!0};for(let A of N)U[A]||(U[A]={published:!1})}if(R.length||M.length){for(let A of M)U[A]={published:!1};for(let A of N)U[A]||(U[A]={published:!0})}(R.length||M.length)&&(v[S].stageDetails=U)}gD({statusObject:{drawDetails:v},removePriorValues:n,status:a,event:s});let{topics:y}=bu(),b=y.includes(UG),I=b||t.returnEventData?uF({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:r,policyDefinitions:c,event:s})?.eventData:void 0;return b&&Ti({payload:{eventData:I,tournamentId:r.tournamentId},topic:UG}),{...le,eventData:I}}var rhe="deleteDrawDefinitions",YG="autoSchedulingAudit",f_="deleteEvents",ahe={AUTO_SCHEDULING_AUDIT:YG,DELETE_EVENTS:f_,DELETE_DRAW_DEFINITIONS:rhe};function IF(t){if(!t.tournamentRecord)return{error:ot};let e="deleteDrawDefinitions",i=t.drawIds??[],n=t.event,{autoPublish:r=!0,tournamentRecord:a,auditData:s,eventId:o,force:l}=t,{appliedPolicies:u}=sn({tournamentRecord:a,event:n}),c={...u,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!n){let U=$o({tournamentRecord:a,eventId:o,drawId:d});if(U.error)return U;n=U.event}let p=[],h=[],f=[];if(!n?.drawDefinitions)return ce({info:"event has no drawDefinition",result:{...le},stack:e});let m=n.drawDefinitions.map(({drawId:U})=>U);if(i.length||(i=m),i=i.filter(U=>m.includes(U)),!i.length)return ce({info:"nothing to do; no matching drawIds in event.",result:{...le},stack:e});let g=Ct(Cr({event:n}).flightProfile,!1,!0),v=({participantId:U,drawPosition:C,qualifier:E,bye:P})=>({bye:P,qualifier:E,drawPosition:C,participantId:U}),y=l??u?.[Ku]?.allowDeletionWithScoresPresent?.drawDefinitions,b=sc({event:n})??{},I=b.drawIds??(b.drawDetails&&Object.keys(b.drawDetails))??[],S,w=[],T=n.drawDefinitions.filter(U=>{if(i.includes(U.drawId)){let C=uo({event:n,drawDefinition:U})?.matchUps??[];if(C.some(({score:$})=>ca({score:$}))&&!y)return w.push(U.drawId),!0;let{drawId:E,drawType:P,drawName:M}=U,R=g?.flights?.find($=>$.drawId===U.drawId);R&&(R.drawEntries=R.drawEntries?.filter($=>fd.includes($.entryStatus))),I.includes(E)&&(I=I.filter($=>$!==E),S=!0);let N=rd({stageSequence:1,drawDefinition:U,stage:Nt})?.structures?.[0],A=(N?wC({structureId:N.structureId,tournamentRecord:a,drawDefinition:U}):void 0)?.positionAssignments?.map(v),_=rd({stage:qt,drawDefinition:U})?.structures,x=_?.length?_.map($=>{let F=$.stageSequence;return{positionAssignments:wC({structureId:$.structureId,tournamentRecord:a,drawDefinition:U})?.positionAssignments.map(v),stageSequence:F}}):void 0,O={action:rhe,payload:{drawDefinitions:[U],eventId:o??n?.eventId,auditData:s}};f.push(O),p.push(Vt({tournamentId:a.tournamentId,eventId:o??n?.eventId,qualifyingPositionAssignments:x,positionAssignments:A,auditData:s,drawType:P,drawName:M,drawId:E})),C?.forEach(({matchUpId:$})=>h.push($))}return!i.includes(U.drawId)});if(w.length&&!l)return ce({context:{drawIdsWithScoresPresent:w},result:{error:z1},stack:e});if(n.drawDefinitions=T,g&&Sv({event:n,extension:{name:nd,value:g}}),jR({tournamentRecord:a}),S){let U={};for(let E of I)U[E]=b.drawDetails?.[E]??{published:!0};let C=gD({statusObject:{drawDetails:U},event:n});if(C.error)return{error:C.error}}if(f.length)if(KO(im)){let U=a.tournamentId;Ti({topic:im,payload:{tournamentId:U,detail:f}});let C=(nc({element:n,itemType:Dy})?.timeItem?.itemValue||0)+1;rh({element:n,timeItem:{itemType:Dy,itemValue:C},removePriorValues:!0})}else eBe({appliedPolicies:u,event:n,deletedDrawsDetail:p,auditData:s});if(h.length&&ff({tournamentId:a?.tournamentId,matchUpIds:h}),i.forEach(U=>lke({drawId:U})),r&&S){let U=vD({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:c,tournamentRecord:a,event:n});if(U.error)return{...le,info:U.error}}return{...le}}function eBe({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:n}){if(t?.audit?.[Dy]===!1)return;let{extension:r}=_i({name:Dy,element:e}),a={...n,deletedDrawsDetail:i},s={value:Array.isArray(r?.value)?r?.value.concat(a):[a],name:Dy};un({element:e,extension:s})}function she({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:n,force:r}){if(!e)return{error:ot};if(!n)return{error:qn};let{flightProfile:a}=Cr({event:n});if(a){let s=a.flights?.map(({drawId:l})=>l).filter(Boolean),o=IF({eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:n,force:r});return o.error?o:pL({event:n,name:nd})}return{...le}}function l5(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:n,tournamentId:r,eventId:a}=t,s=t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(s).length)return{error:fr};let o=Object.keys(s).filter(u=>!r||r===u);if(r&&!o.includes(r))return{error:Ee};let l;for(let u of o){let c=s[u],{event:d}=$o({tournamentRecord:c,eventId:a});a&&d&&(l=!0);let p=tBe({tournamentRecord:c,event:d,matchUpFormat:e,averageTimes:n,recoveryTimes:i});if(p.error)return p}return!a||l?{...le}:{error:Wu}}function tBe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:n,event:r}){if(!t)return{error:ot};if(n&&!Array.isArray(n))return{error:Ee};if(e&&!Array.isArray(e))return{error:Ee};let a=mm;if(r){let{extension:s}=_i({element:r,name:a}),o=s?.value||{},l=ZX({...o,matchUpFormat:i,averageTimes:n,recoveryTimes:e});un({element:r,extension:{name:a,value:l}})}else{let{extension:s}=_i({element:t,name:a}),o=s?.value||{},l=ZX({...o,matchUpFormat:i,averageTimes:n,recoveryTimes:e});un({extension:{name:a,value:l},element:t})}return{...le}}function ZX(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:n}=t,{averageTimes:r,recoveryTimes:a}=t;r=(r||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let s=r?.length&&i.map(l=>l?.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(u=>u!==n)}:l).filter(({matchUpFormatCodes:l})=>l?.length).concat({matchUpFormatCodes:[n],averageTimes:r});a=(a||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let o=a?.length&&e.map(l=>l?.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(u=>u!==n)}:l).filter(({matchUpFormatCodes:l,averageTimes:u})=>l?.length||u).concat({matchUpFormatCodes:[n],recoveryTimes:a});return{matchUpAverageTimes:s?.length&&s||i,matchUpRecoveryTimes:o?.length&&o||e}}function ohe(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:n,matchUpFormat:r,categoryType:a,eventId:s,event:o}=t;if(!e)return{error:ot};if(!Ml({matchUpFormat:r}))return{error:Ee};if(!o)return{error:qn};let{averageTimes:l=[],recoveryTimes:u=[]}=gF({tournamentRecord:e,matchUpFormat:r,event:o}),c=o.category,d=c?.categoryName||c?.ageCategoryCode||o?.eventId,p={categoryNames:[d],minutes:{}},h={categoryNames:[d],minutes:{}},f=b=>{if(b.categoryTypes?.includes(a)&&console.log("encountered:",{categoryType:a}),!(b.categoryNames?.includes(d)&&(b.categoryNames=b.categoryNames.filter(I=>I!==d),p={minutes:b.minutes,categoryNames:[d]},!b.categoryNames.length)))return b},m=n&&!isNaN(ri(n)),g=i&&!isNaN(ri(i)),v=l.map(f).filter(b=>b?.categoryNames?.length),y=u.map(f).filter(b=>b?.categoryNames?.length);return m&&(Object.assign(p.minutes,{[o?.eventType||Rn]:n}),v.push(p)),g&&(Object.assign(h.minutes,{[o?.eventType||Rn]:i}),y.push(h)),!m&&!g?{error:Ee}:l5({averageTimes:m&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:r,eventId:s})}function wF(t){if(t.event)return XX({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=zt(t,[{[js]:!0,[Ale]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:n}=t;for(let r of Object.values(i??{})){let{event:a}=$o({tournamentRecord:r,eventId:n});if(a)return XX({event:a})}}return{error:Wu}}function XX({event:t}){return pL({event:t,name:mm})}var u5={MON:"MON",TUE:"TUE",WED:"WED",THU:"THU",FRI:"FRI",SAT:"SAT",SUN:"SUN"};function lhe(t){return!Array.isArray(t)||wi(t).length!==t.length?!1:t.every(e=>Object.keys(u5).includes(e))}function c5({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:ot};if(!e)return{error:qn};if(!Op.test(i))return{error:ja};let n=uhe(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,s=new Date(Pi(i)).getTime();if(!r||!a||s<r||s>a)return{error:ja};let o=e.endDate&&new Date(Pi(e.endDate)).getTime();return o&&s>o&&(e.endDate=i),e.startDate=i,{...le}}function d5(t){let{tournamentRecord:e,event:i,endDate:n}=t;if(!e)return{error:ot};if(!i)return{error:qn};if(!Op.test(n))return{error:ja};let r=uhe(e);if(r.error)return r;let{tournamentStartDate:a,tournamentEndDate:s}=r,o=new Date(Pi(n)).getTime();if(!a||!s||o<a||o>s)return{error:ja};let l=i.startDate&&new Date(Pi(i.startDate)).getTime();return l&&o<l&&(i.startDate=n),i.endDate=n,{...le}}function p5(t){let e=zt(t,[{tournamentRecord:!0,event:!0},{[gs]:l=>Op.test(l),[pu]:ja,startDate:!1,endDate:!1},{[gs]:l=>l.filter(Boolean).every(u=>Op.test(u)),[pu]:ja,activeDates:!1},{[gs]:lhe,weekdays:!1}]);if(e.error)return e;let{tournamentRecord:i,weekdays:n,event:r,startDate:a,endDate:s}=t,o=t.activeDates?.filter(Boolean);if(a&&s){let l=new Date(Pi(a)).getTime(),u=new Date(Pi(s)).getTime();if(l>u)return{error:Ee}}if(o){let l=a||i.startDate,u=s||i.endDate,c=!l||o.every(p=>new Date(p)>=new Date(l)),d=!u||o.every(p=>new Date(p)<=new Date(u));if(!c||!d)return{error:ja}}if(a){let l=c5({tournamentRecord:i,event:r,startDate:a});if(l.error)return l}if(s){let l=d5({tournamentRecord:i,event:r,endDate:s});if(l.error)return l}return o&&(r.activeDates=o),n&&(r.weekdays=n),{...le}}function uhe(t){let{startDate:e,endDate:i}=t;return!Op.test(e)||!Op.test(i)?ce({result:{error:Lse},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Pi(e)).getTime(),tournamentEndDate:new Date(Pi(i)).getTime()}}function h5({event:t,orderedDrawIdsMap:e}){if(typeof t!="object")return{error:qn};if(!e)return{error:Zt,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:Ee,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(r=>!isNaN(r)))return{error:Ee,info:"drawOrder must be numeric"};if(wi(i).length!==i.length)return{error:Ee,info:"drawOrder values must be unique"};if(t.drawDefinitions?.length){let r=(t.drawDefinitions||[]).map(({drawId:s})=>s),a=Object.keys(e);if(a?.length&&Dr(r,a).length!==r.length)return{error:Ee,info:"Missing drawIds"};t.drawDefinitions.forEach(s=>{s.drawOrder=e[s.drawId]})}let{flightProfile:n}=Cr({event:t});return n?.flights?.forEach(r=>{r.flightNumber=e[r.drawId]}),{...le}}function f5({tournamentRecord:t,event:e}){if(!t)return{error:ot};if(!e)return{error:qn};let{flightProfile:i}=Cr({event:e}),n=i?.flights&&Object.assign({},...i.flights.sort((r,a)=>r.flightNumber-a.flightNumber).map((r,a)=>({[r.drawId]:a+1})))||e.drawDefinitions?.length&&Object.assign({},...e.drawDefinitions.sort((r,a)=>r.drawOrder-a.drawOrder).map((r,a)=>({[r.drawId]:a+1})))||void 0;return n?h5({event:e,orderedDrawIdsMap:n}):{...le}}function che({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:n,event:r,force:a}){if(!e)return{error:ot};if(!n)return{error:Zd};if(!r)return{error:qn};let{flightProfile:s}=Cr({event:r});if(s&&s.flights?.find(o=>o.drawId===n)){let o=s.flights.filter(u=>u.drawId!==n),l={name:nd,value:{...s,flights:o}};Sv({event:r,extension:l})}if(r.drawDefinitions?.find(o=>o.drawId===n)){let o=IF({drawIds:[n],eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:r,force:a});if(o.error)return o}return f5({tournamentRecord:e,event:r})}function dhe(t){let e=zt(t,[{[Gm]:!0,[ha]:!0,[D3]:!1},{replacementIndividualParticipantId:!0,[gs]:g=>Xn(g),existingIndividualParticipantId:!0,[Gc]:la,participantId:!0}]),{replacementIndividualParticipantId:i,existingIndividualParticipantId:n,tournamentRecord:r,drawDefinition:a,participantId:s,event:o,uuids:l}=t;if(e.error)return e;if(o?.eventType!==Yu)return{error:Hh};if(!(o?.entries?.filter(({entryStatus:g})=>[rc,Rb].includes(g)).map(({participantId:g})=>g)||[]).includes(i))return{error:Bd};let u=(r.participants||[]).find(g=>g.participantId===s);if(u?.participantType!==Ni)return{error:Yw,participant:u};let c=u.individualParticipantIds,d=[i,...c.filter(g=>g!==n)],{participant:p}=ad({participantIds:d,tournamentRecord:r}),h;if(p)h=p.participantId;else{let g={participantId:l?.pop(),participantRole:bs,individualParticipantIds:d,participantType:Ni},v=jp({participant:g,returnParticipant:!0,tournamentRecord:r});if(v.error)return v;h=v.participant.participantId}let{flightProfile:f}=Cr({event:o});if(a){let g=f?.flights?.find(({drawId:v})=>v===a.drawId);g&&(g.drawEntries=g.drawEntries.map(v=>v.participantId===s?{...v,participantId:h}:v)),a.entries=a.entries.map(v=>v.participantId===s?{...v,participantId:h}:v);for(let v of a.structures||[])if(v.structures){v.positionAssignments=void 0;for(let y of v.structures)y.positionAssignments=y.positionAssignments.map(b=>b.participantId===s?{...b,participantId:h}:b)}else v.positionAssignments&&(v.positionAssignments=v.positionAssignments.map(y=>y.participantId===s?{...y,participantId:h}:y))}o.entries=o.entries.map(g=>g.participantId===s&&{...g,participantId:h}||g.participantId===i&&{...g,participantId:n}||g);let m=r.events.some(({entries:g,eventId:v,drawDefinitions:y})=>o.eventId===v?y.some(({drawId:b,entries:I})=>b===a?.drawId?!1:I?.find(S=>S.participantId===s)):g?.find(b=>b.participantId===s));if(!m){let g=h0({addIndividualParticipantsToEvents:!1,participantIds:[s],tournamentRecord:r});if(g.error)return g}return{...le,participantOtherEntries:m,newPairParticipantId:h}}function qR(t){let{flight:e,suppressNotifications:i,modifyEventEntries:n,existingDrawCount:r,allowReplacement:a,checkEntryStatus:s,tournamentRecord:o,drawDefinition:l,event:u}=t;if(!l)return{error:Ot};if(!u)return{error:qn};u.drawDefinitions||(u.drawDefinitions=[]);let{drawId:c,drawName:d,entries:p}=l,{entries:h}=u,f=0;if(r!==void 0&&r!==u.drawDefinitions.length)return{error:Ee,info:"drawDefintions count mismatch"};let{flightProfile:m}=Cr({event:u}),g=e&&m?.flights?.find(M=>M.flightNumber===e.flightNumber),v=m?.links?.find(M=>M?.target?.drawId===c)?.source?.drawId;if(v&&!u.drawDefinitions.find(M=>M.drawId===v))return ce({result:{error:Ot},info:{sourceDrawId:v}});if(g&&g.drawId!==l.drawId)return ce({result:{error:_I},info:{relevantFlight:g}});let y=p?.every(({participantId:M,entryStatus:R})=>{let N=g?.drawEntries.find(A=>A.participantId===M);return!R||N?.entryStatus===R}),b=!s||h&&p?.every(({participantId:M,entryStatus:R,entryStage:N})=>h.find(A=>A.participantId===M&&(!A.entryStage||A.entryStage===N))?.entryStatus===R);if(g&&!y)return ce({result:{error:_I},context:{drawEntriesPresentInFlight:y,matchingEventEntries:b,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(n&&p?.filter(Boolean).forEach(M=>{if(M?.entryStatus&&fd.includes(M?.entryStatus)){let R=h?.filter(Boolean).find(N=>N.participantId===M.participantId);R&&M.entryStatus&&R?.entryStatus!==M.entryStatus&&(R.entryStatus=M.entryStatus,f+=1)}}),h&&!b)return ce({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:b,eventEntries:h},error:_I}});let I=m?.flights?.map(({flightNumber:M})=>!isNaN(M)&&ri(M))?.filter(Boolean)||[],S=u.drawDefinitions.map(({drawOrder:M})=>M&&ri(M))?.filter(Boolean)||[],w=Math.max(0,...S,...I)+1,T=m?.flights?.find(M=>M.drawId===c),U;if(T){T.drawName=l.drawName,U={name:nd,value:{...m,flights:m.flights}};let M=T.flightNumber;M&&!S.includes(M)?w=M:T.flightNumber=w}else{let M=m?.flights||[];M.push({manuallyAdded:!0,flightNumber:w,drawEntries:p,drawName:d,drawId:c}),U={name:nd,value:{...m||{},flights:M}}}Sv({event:u,extension:U}),Object.assign(l,{drawOrder:w});let C=u.drawDefinitions.find(M=>M.drawId===c),E=o?.tournamentId,P=u.eventId;if(C){if(!a)return{error:hse};let M=uo({drawDefinition:C})?.matchUps?.map(Ma)??[],R=uo({drawDefinition:l})?.matchUps;if(!i){M?.length&&ff({matchUpIds:M,action:"modifyDrawDefinition",tournamentId:E,eventId:P}),R?.length&&Yg({matchUps:R,tournamentId:E,eventId:P}),u.drawDefinitions=u.drawDefinitions.map(A=>A.drawId===c?l:A);let N=l.structures?.map(({structureId:A})=>A);Ln({drawDefinition:l,tournamentId:E,structureIds:N,eventId:P})}}else if(u.drawDefinitions.push(l),!i){let{matchUps:M}=uo({drawDefinition:l,event:u});M&&Yg({tournamentId:o?.tournamentId,matchUps:M}),nR({drawDefinition:l,tournamentId:E,eventId:P})}return{...le,modifiedEventEntryStatusCount:f}}function phe(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:s,assignments:o,drawId:l,event:u}=t,c=0;if(!o?.length)return{error:Oq};if(!n)return{error:ot};if(!l)return{error:Zd};let d=Zu({provisionalPositioning:e,drawDefinition:r,structureId:s});if(d.error)return d;let{seedAssignments:p,seedLimit:h}=d,f=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));o.forEach(v=>{let{seedNumber:y}=v;h&&y<=h&&(!i||f[y])&&(f[y]=v)});let m=Object.values(f),g=m.map(v=>v?.participantId).filter(Boolean);if(g.length!==ese(g).length)return{error:fse};for(let v of m){let y=uD({...v,provisionalPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:s,event:u});if(y?.error)return y;y?.success&&c++}return c?{...le,modifications:c}:{error:KU}}function m5({deleteExisting:t,event:e,flightProfile:i}){let n="attachFlightProfile";if(!i)return ce({result:{error:Zt},stack:n});if(!e)return ce({result:{error:qn},stack:n});let{flightProfile:r}=Cr({event:e});return r&&!t?ce({result:{error:e3},stack:n}):e.drawDefinitions?.length?ce({result:{error:use},stack:n}):(Sv({event:e,extension:{name:nd,value:i}}),{flightProfile:Ct(i,!1,!0),...le})}function iBe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){if(!t)return{error:ot};if(!i)return{error:yv};if(!e)return{error:Zt,info:"scaleAttributes required"};let{scaleType:n,eventType:r,scaleName:a}=e,s=[Uue,n,r,a].join(".");return t.participants?.forEach(o=>{i.includes(o.participantId)&&o.timeItems&&(o.timeItems=o.timeItems.filter(l=>l&&l?.itemType!==s))}),{...le}}function g5({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:n,drawId:r,event:a,stage:s}){if(!a)return{error:qn};if(n&&!Array.isArray(n))return ce({result:{error:Ee},info:Xy("entryStatus"),stack:"removeScaleValues"});let o=a.entries;if(r){let{flightProfile:u}=Cr({event:a}),c=u?.flights?.find(d=>d.drawId===r);c?o=c.drawEntries:o=i?.entries}let l=(o||[]).filter(u=>(!s||!u.entryStage||u.entryStage===s)&&(!n||n.includes(u.entryStatus))).map(Vi);return iBe({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function SF({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:n=wu,event:r}){if(!e)return ce({result:{error:ot}});if(!r)return ce({result:{error:qn}});if(!Ki(i))return ce({result:{error:Zt}});if(Ki(i.draws))for(let s of Object.keys(i.draws)){let o=i.draws[s].scheduleDetails??[];if(o.length){let l=[];for(let u of o){let c=l.find(d=>nAe(d.attributes,u.attributes));c?.dates&&u.dates?c.dates.push(...u.dates):l.push(u)}i.draws[s].scheduleDetails=l}}let a=gD({statusObject:{displaySettings:i},removePriorValues:t,status:n,event:r});return a.error?a:{...le}}function hhe({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:n,drawId:r,event:a,stage:s}){if(!t)return{error:ot};if(!a)return{error:qn};n=n||a.category?.categoryName||a.category?.ageCategoryCode;let o={eventType:a.eventType,scaleType:Nh,scaleName:n};return g5({tournamentRecord:t,scaleAttributes:o,drawDefinition:e,entryStatuses:i,drawId:r,event:a,stage:s})}function fhe(t){let e=zt(t,[{[ha]:!0},{eventIds:!0,[Go]:xs}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:n,eventIds:r}=t,a=[],s=[],o=[],l=[];if(n.events=(n.events||[]).filter(u=>{if(r.includes(u.eventId)){let p={action:f_,payload:{events:[u]}};a.push(p),s.push({tournamentId:n.tournamentId,eventName:u.eventName,eventType:u.eventType,category:u.category,eventId:u.eventId,gender:u.gender})}let c=u.eventType===Yu?(u.entries||[]).map(({entryStatus:p,participantId:h})=>p!==rc&&h).filter(Boolean):[],d=r.includes(u.eventId);return d?l.push(...c):o.push(...c),!d}),i){let u=l.filter(c=>!o.includes(c));n.participants=n.participants.filter(({participantId:c})=>!u.includes(c))}if(jR({tournamentRecord:n}),a.length)if(KO(im)){let u=n.tournamentId;Ti({topic:im,payload:{type:f_,tournamentId:u,detail:a}})}else kR({tournamentRecord:n,timeItem:{itemValue:s,itemType:f_}});return{...le}}function mhe(t){let e=zt(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:Qo}]);if(e.error)return e;let{eventUpdates:i,event:n}=t,r="modifyEvent",a=aBe(t),s=sBe({enteredParticipants:a}),{enteredParticipantGenders:o,enteredParticipantTypes:l}=s,u=Cr({event:n})?.flightProfile?.flights,c=!n.drawDefinitions?.length&&!u?.length,d=oBe({noFlightsNoDraws:c,enteredParticipantGenders:o,eventUpdates:i,stack:r});if(d.error)return d;let p=lBe({enteredParticipantTypes:l,eventUpdates:i,stack:r});if(p.error)return p;let h=nBe({...t,...s,enteredParticipants:a,stack:r});if(h.error)return h;let f=rBe({...t,stack:r});return f.error?f:(i.eventType&&(n.eventType=i.eventType),i.eventName&&(n.eventName=i.eventName),i.gender&&(n.gender=i.gender),{...le})}function nBe(t){let e=t.eventUpdates?.category;if(!e)return{...le};let i=aC({category:e});if(i.error)return i;if(t.event.eventType===na){let n=t.event?.drawDefinitions?.map(s=>hp(s))??[],r=hp(t.event),a=(gf(t)?.matchUps??[]).map(s=>hp(s))??[];if(![r,...n,...a].filter(Boolean).every(s=>s.collectionDefinitions.every(o=>!o.category||Y1({category:t.eventUpdates.category,childCategory:o.category}))))return ce({result:{error:JP},stack:t.stack})}if(t.enteredParticipants?.length){let n=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,r=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,a=t.enteredParticipants.map(l=>l.participantType===ji?l:l.individualParticpants??[]).flat(),s=sw({category:e,consideredDate:n}),o=sw({category:e,consideredDate:r});if(s?.ageMinDate||s?.ageMaxDate||o?.ageMinDate||o?.ageMaxDate)for(let l of a){let u=l.person?.birthDate;if(!u)return ce({result:{error:_se},stack:t.stack});let c=new Date(u).getTime();if(s.ageMinDate||s.ageMaxDate){let d=new Date(s.ageMinDate).getTime(),p=new Date(s.ageMaxDate).getTime();if(c<d||c>p)return ce({result:{error:fG},stack:t.stack})}if(o.ageMin||o.ageMax){let d=new Date(o.ageMinDate).getTime(),p=new Date(o.ageMaxDate).getTime();if(c<d||c>p)return ce({result:{error:fG},stack:t.stack})}}}return{...le}}function rBe(t){let{tournamentRecord:e,eventUpdates:i,event:n,stack:r}=t;if(i.startDate||i.endDate){let a=p5({startDate:i.startDate,endDate:i.endDate,tournamentRecord:e,event:n});if(a.error)return ce({result:a,stack:r})}return{...le}}function aBe(t){let{tournamentRecord:e,event:i}=t,n=i?.entries?.filter(({entryStatus:r})=>{let a=r;return[...fd,Hc].includes(a)}).map(({participantId:r})=>r)??[];return n?dr({participantFilters:{participantIds:n},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function sBe({enteredParticipants:t}){let e=[],i=t.reduce((r,a)=>{let s=a.person?.sex?[a.person.sex]:a.individualParticpants?.map(o=>o.person?.sex)||[];return e.push(...s),r.includes(a.participantType)?r:r.concat(a.participantType)},[]),n=wi(e);return{enteredParticipantTypes:i,enteredParticipantGenders:n}}function oBe({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:n}){let r=!e.length||!i.gender||Mh(i.gender)||e.length===1&&e[0]===i.gender||t&&su(i.gender);return i.gender&&!r?ce({context:{gender:i.gender,validGender:r},result:{error:cP},stack:n}):{...le}}function lBe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let n=(t.includes(na)&&[na]||t.includes(ji)&&[Lp]||t.includes(Ni)&&[Yu]||[Yu,Lp,na]).includes(e.eventType??"");return e.eventType&&!n?ce({context:{participantType:e.eventType,validEventType:n},result:{error:Hh},stack:i}):{...le}}function TF({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:n,event:r,stage:a}){let s="addFlight";if(!r)return ce({result:{error:qn},stack:s});if(!i)return ce({result:{error:Zt},stack:s});if(e?.length){let h=(r.entries??[]).map(Vi),f=e.map(Vi);if(Dr(f,h).length!==f.length)return ce({result:{error:Ee},stack:s})}let o=Cr({event:r})?.flightProfile,l=o?.flights?.map(({flightNumber:h})=>!isNaN(h)&&ri(h))?.filter(Boolean)||[],u=Math.max(0,...l)+1,c={drawId:n||mn(),flightNumber:u,drawEntries:e,drawName:i};if(a&&(c.stage=a),t&&(c.qualifyingPositions=t),(o?.flights||[]).find(({drawId:h})=>h===c.drawId))return ce({result:{error:poe},stack:s});let d=(o?.flights||[]).concat(c),p={name:nd,value:{...o||{},flights:d}};return Sv({event:r,extension:p})}var v5={};Fi(v5,{drawMatic:()=>D4,garman:()=>The,generateAdHocMatchUps:()=>KL,generateAdHocRounds:()=>U4,generateAndPopulatePlayoffStructures:()=>JW,generateCourts:()=>y5,generateDrawDefinition:()=>zR,generateDrawMaticRound:()=>f4,generateDrawStructuresAndLinks:()=>d4,generateDrawTypeAndModifyDrawDefinition:()=>p4,generateFlightProfile:()=>cBe,generateLineUps:()=>She,generateQualifyingStructure:()=>HW,generateSeedingScaleItems:()=>Wpe,generateStatCrew:()=>dBe,generateVoluntaryConsolation:()=>Ade,roundRobinGroups:()=>Cxe});var uBe="splitLevelBased",ghe="splitWaterfall",vhe="splitShuttle",yhe={SPLIT_LEVEL_BASED:uBe,SPLIT_WATERFALL:ghe,SPLIT_SHUTTLE:vhe};function cBe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,deleteExisting:s,sortDescending:o,drawNames:l=[],flightsCount:u,splitMethod:c,uuids:d=[],event:p,stage:h}=t;if(!p)return{error:qn};let f=p.entries??[],{flightProfile:m}=Cr({event:p});if(m&&i&&!s)return{error:e3};let g=t.scaledEntries??b0({tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,sortDescending:o,event:p,stage:h}).scaledEntries,v=g.map(Vi),y=oo(f.filter(({participantId:E})=>!v.includes(E)).filter(E=>(!h||!E.entryStage||E.entryStage===h)&&(!E.entryStatus||Mb.includes(E.entryStatus)))),b=g.concat(...y),I=b.length,S=Math.ceil(I/u),w=Aa(b,S);c===ghe?w=sG(b,u):c===vhe&&(w=sG(b,u,!0));function T(E){return(E||[]).map(({participantId:P,scaleValue:M})=>{let R=f.find(N=>N.participantId===P);return R?.scaleValue&&M&&(R.scaleValue=M),R}).sort((P,M)=>P.scaleValue-M.scaleValue).map((P,M)=>(P.scaleValue&&(P.seedNumber=M+1),P))}let U=Dt(0,u).map(E=>{let P=E+1;return{flightNumber:P,drawId:d?.pop()??mn(),drawEntries:T(w[E]),drawName:l?.length&&l[E]||`${e} ${P}`}}),C={scaleAttributes:r,splitMethod:c,flights:U};if(i){let E=m5({flightProfile:C,deleteExisting:s,event:p});return{splitEntries:du()&&w||void 0,...E}}else return{flightProfile:C,...le}}function bhe({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(s=>typeof s=="object"&&Object.keys(s).length===1)})),n=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),r=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return Ihe({tagName:e,attributes:r,childArrays:i,childObjects:n})}function Ihe(t){let{tagName:e,attributes:i=[],childArrays:n=[],childObjects:r}=t,a=`\r
`,s=h=>{let f=Object.keys(h)[0],m=h[f];return{key:f,value:m}},o=n?.map(({key:h,value:f})=>Ihe({tagName:h,childObjects:f.map(s)})).join(`\r
`),l=r?.map(({key:h,value:f})=>bhe({tagName:h,json:f??[]})).join(`\r
`),u=i?.map(({key:h,value:f})=>`${h}="${f}"`).join(" "),c=u?` ${u}`:"";if(e==="childArray")return l;let d=l?.length?`${a}${l}${a}`:"",p=o?.length?`${a}${o}${a}`:"";return`<${e}${c}>${d}${p}</${e}>`}function dBe(t){let e=zt(t,[{[ha]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{startDate:n,tournamentId:r,tournamentName:a}=i,{participantMap:s,matchUps:o,mappedMatchUps:l}=dr({withMatchUps:!0,withEvents:!0,tournamentRecord:i}),u=i.participants.filter(b=>b.participantType===wn),c=o?.filter(b=>b.matchUpType===wn)??[],d=c?.reduce((b,I)=>{let S=I?.tieMatchUps??[];return S&&[...b,...S]},[])??[],p=o?.filter(b=>b.matchUpType===Rn)??[],h=o?.filter(b=>b.matchUpType===Dn)??[],f=d.length===p.length+h.length,m=c.length===1&&f,g={mappedMatchUps:l,participantMap:s,tournamentName:a,tournamentId:r,tournament:f?"N":"Y",startDate:n},v=[],y=[];if(m){let b=c[0],{json:I,xml:S}=JX({teamParticipants:u,teamMatchUp:b,...g,doubles:h,singles:p});y.push(I),v.push(S)}else for(let b of c){let I=b?.sides?.map(({participant:U})=>U?.participantId).filter(Boolean);if(I?.length!==2)continue;let S=I.map(U=>U&&s?.[U]?.participant),{xml:w,json:T}=JX({doubles:b.tieMatchUps?.filter(U=>U.matchUpType===Dn),singles:b.tieMatchUps?.filter(U=>U.matchUpType===Rn),teamParticipants:S,teamMatchUp:b,...g});y.push(T),v.push(w)}return{json:y,xml:v,...le}}function JX({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:n,tournamentId:r,teamMatchUp:a,tournament:s,startDate:o,doubles:l,singles:u}){let c=t?.find(I=>I.participantRoleResponsibilities?.includes("Home")),d=t?.filter(I=>I.participantId!==c?.participantId),p=Vc(o,"/","MDY"),h=c?.participantName||d?.[1]?.participantName,f=c?.participantId||d?.[1]?.participantId,m=d?.[0]?.participantName,g=d?.[0]?.participantId,v={},y=t.map(I=>({team:{...fBe({teamParticipant:I,teamMatchUp:a,uniValues:v,participantMap:i,mappedMatchUps:e,homeid:f})}})),b=Vt({venue:{tournamentname:s?n:void 0,neutralgame:c?"N":"Y",gameid:r,officials:{},tournament:s,rules:{},homename:h,visname:m,homeid:f,visid:g,date:p},childArray:y,singles_matches:u?.map(I=>QX({matchUp:I,homeid:f,uniValues:v})),doubles_matches:l?.map(I=>QX({matchUp:I,homeid:f,uniValues:v}))});return{json:b,xml:bhe({json:b,tagName:"tngame"})}}function pBe({homeid:t,uniValues:e,participant:i}){if(!i)return{};let n=i.individualParticipants?.length===2,r=n?wi(i.individualParticipants?.map(m=>m.teams?.[0]?.participantId)):[],a=n?wi(i.individualParticipants?.map(m=>m.teams?.[0]?.teamId)):[],s=!n&&i.teams?.[0]?.participantId||r?.length===1&&r[0]||void 0,o=!n&&i.teams?.[0]?.teamId||a?.length===1&&a[0]||s,l=n?void 0:i.participantName,u=i.individualParticipants?.[0]?.participantName,c=i.individualParticipants?.[1]?.participantName,d=t&&(s===t?"H":"V")||"",p=n?void 0:e[s][i.participantId],h=e[s][i.individualParticipants?.[0]?.participantId],f=e[s][i.individualParticipants?.[1]?.participantId];return Vt({vh:d,uni:p,uni_1:h,uni_2:f,team:o,name:l,name_1:u,name_2:c})}function hBe({sets:t,sideNumber:e}){return Object.assign({},...t?.map(i=>{let{setNumber:n,side1Score:r,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o}=i,l=`set_${n}`,u=`tie_${n}`,c=e===1?r:a,d=e===1?s:o;return{[l]:c,[u]:d}})??[])}function fBe({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:n,homeid:r,uniValues:a}){let{participantId:s,participantName:o}=t,l=r&&(s===r?"H":"V")||"",u=i?.[s]?.matchUps,c=u&&Object.keys(u),d=e?.sides?.find(({participant:I})=>I.participantId===s)?.sideNumber,p=e?.score?.sets?.[0]?.[`side${d}Score`]??0;a[s]={};let h={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},f=[],m=[],g=0;for(let I of c??[]){let S=n?.[I],w=S.sides.find(({participant:U})=>U.participantId===s)?.sideNumber,T=S.score?.sets?.[0]?.[`side${w}Score`]??0;g+=T;for(let U of S.tieMatchUps??[]){let{matchUpType:C,winningSide:E}=U,P=E&&(E===w?"w":"l")||"";P&&(h[C][P]+=1);let M=P==="w"?"1":"0",R=P==="l"?"1":"0";if(C===Rn){let N=m.length+1;m.push({singles_pair:{pair:N,won:M,lost:R,tied:"0"}})}else if(C===Dn){let N=f.length+1;f.push({doubles_pair:{pair:N,won:M,lost:R,tied:"0"}})}}}let v=[{singles:{childArray:m,won:h.SINGLES.w,lost:h.SINGLES.l}},{doubles:{childArray:f,won:h.DOUBLES.w,lost:h.DOUBLES.l}}],y=[],b=1;for(let I of t.individualParticipantIds){let S=i?.[I];if(S){let{participant:w,counters:T}=S,U={won:T?.DOUBLES?.wins||0,lost:T?.DOUBLES?.losses||0},C={won:T?.SINGLES?.wins||0,lost:T?.SINGLES?.losses||0},{participantName:E,participantId:P}=w;a[s][P]=b,y.push({player:{name:E,uni:b,singles:C,doubles:U}})}b+=1}return{vh:l,id:s,name:o,score:p||g,totals:v,childArray:y}}function QX({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:n,orderOfFinish:r,matchUpType:a,sides:s}=t??{},o=s?.map(l=>{let{sideNumber:u,participant:c}=l,d=hBe({sets:t.score?.sets,sideNumber:u});return{[a===Rn?"singles_score":"doubles_score"]:{...pBe({homeid:e,uniValues:i,participant:c}),...d}}});return{[a===Rn?"singles_match":"doubles_match"]:{match:n,order:r,childArray:o}}}var mBe="DESC",KG="DESC",whe={ASC:"ASC",ASCENDING:"ASC",DESC:mBe,DESCENDING:KG};function She(t){let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:n,drawDefinition:r,scaleAccessor:a,singlesOnly:s,attach:o,event:l}=t;if(l?.eventType!==Nl)return{error:Hh};if(!n)return{error:ot};if(!e&&!r)return{error:cu};if(e=e??Zs({drawDefinition:r,event:l})?.tieFormat,Lo({tieFormat:e}).error)return{error:Rh};if(typeof a!="object"&&!i)return{error:Ee,context:{scaleAccessor:a}};let u={},c=(r?.entries??l?.entries??[]).filter(P=>P?.entryStatus===sl).map(Vi),{participants:d=[]}=dr({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:n}),p=d.filter(({participantId:P})=>c.includes(P)),h=P=>P===zg?"rankings":"ratings",f=l?.category?.categoryName??l?.category?.ageCategoryCode,{scaleName:m=f,scaleType:g=zg,sortOrder:v,accessor:y}=a||{},b=h(g),I=(P,M)=>{let R=P[b]?.[M];if(!R&&i&&(R=P[b]?.[AI]),Array.isArray(R)){let N=R.find(A=>A.scaleName===m)?.scaleValue;if(br(N))return N;if(y&&typeof N=="object")return N[y]}return 0},S=(P,M,R)=>{let N=v===KG?M:P,A=v===KG?P:M;return I(N,R)-I(A,R)},w=(P,M)=>S(P,M,AI),T=(P,M)=>S(P,M,jy),U=[],C=e?.collectionDefinitions??[];for(let P of p){let M=P.individualParticipants?.sort(w)??[],R=s?M:P.individualParticipants?.sort(T)??[],N={};for(let _ of C){let x=[],{collectionId:O,matchUpCount:$,matchUpType:F,gender:j}=_,H=_r(AI)(F);Dt(0,$).forEach(G=>{let W=H?M:R??[],q=G+1,Z=[];Dt(0,H?1:2).forEach(K=>{let Q=W?.find(J=>{let ne=Ls(j),re=ne&&(xp(j)&&ne||su(j)&&[ta,ms][K]);return(!re||re===J.person?.sex)&&!x.includes(J.participantId)})?.participantId;Q&&(Z.push(Q),x.push(Q),N[Q]||(N[Q]=[]),N[Q].push({collectionPosition:q,collectionId:O}))}),H||U.push(Z)})}let A=Object.keys(N).map(_=>({collectionAssignments:N[_],participantId:_}));u[P.participantId]=A}let E=[];for(let P of U){let{participant:M}=ad({tournamentParticipants:d,participantIds:P});if(!M){let R={individualParticipantIds:P,participantRole:bs,participantType:Ni};E.push(R)}}if(o){for(;E.length;)jp({participant:E.pop(),tournamentRecord:n});un({element:r,extension:{name:fm,value:u}})}return{...le,lineUps:u,participantsToAdd:E}}function y5(t){if(!t)return{error:Zt};let e=zt(t,[{dates:!1,[gs]:s=>Array.isArray(s)&&s.every(nl)},{uuids:!1,[gs]:s=>Array.isArray(s)&&s.every(Xn)},{startTime:!1,endTime:!1,[gs]:c3},{idPrefix:!1,namePrefix:!1,[gs]:Xn},{count:!0,[gs]:br}]);if(e.error)return e;let{startDate:i,endDate:n}=t.tournamentRecord??{},r=t.dates||i&&n&&RT(i,n)||[],a=Dt(1,t.count+1).map(s=>Vt({courtId:t.uuids?.pop()??(t.idPrefix&&`${t.idPrefix}-${s}`)??mn(),courtName:t.courtNames?.pop()??(t.namePrefix&&`${t.namePrefix} ${s}`),dateAvailability:r.map(o=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:o}))}));return{...le,courts:a}}var The={};Fi(The,{default:()=>yBe,garman:()=>Ehe});function WR({court:t,date:e}){let i=e&&t.dateAvailability.find(r=>zh(r.date,e)),n=t.dateAvailability.find(r=>!r.date);return i||n}function yD(t){let e=zt(t,[{courtDate:!0,_ofType:Qo}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:n}=t,r=[],a=zr(n.startTime);(n.bookings||[]).filter(o=>!o.bookingType||!i.includes(o.bookingType)).sort((o,l)=>ck(o.startTime).localeCompare(ck(l.startTime))).forEach(o=>{let l={startTime:Jn(a.toISOString()),endTime:o.startTime};zr(o.startTime)>a&&r.push(l),zr(o.endTime)>a&&(a=zr(o.endTime))});let s={startTime:Jn(a.toISOString()),endTime:n.endTime};return zr(n.endTime)>a&&r.push(s),{timeSlots:r}}function gBe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:n}){let r=s=>{let{timeSlots:o}=yD({includeBookingTypes:e,courtDate:s});return!!o?.filter(a)?.length};function a(s){let o=zr(s.startTime),l=zr(s.endTime);return o>i||l<n?!1:W1(i,l)>=t}return{enoughTime:r}}function Uhe(t){let e=zt(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:xs}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:n,periodStart:r,date:a}=t,s=t.courts,o=zr(r),l=p3(o,i),{enoughTime:u}=gBe({averageMatchUpMinutes:i,includeBookingTypes:n,periodStartTime:o,periodEndTime:l});return{availableToScheduleCount:(s?.filter(c=>{if(!Array.isArray(c.dateAvailability))return!1;let d=WR({date:a,court:c});return!!(d&&u(d))})||[]).length,...le}}function UF(t){let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:n=30,scheduleDate:r,courts:a=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(a)||!a.length)return{error:Ee,courts:a};if(!Array.isArray(s))return{error:sk};if(!nl(r))return{error:ja};i&&(Array.isArray(i)?i.includes(r)&&(s=[]):s=[]);let{courtBookings:o,unassignedBookings:l}=s.reduce((p,h)=>{let{courtId:f}=h;return f?p.courtBookings[f]?p.courtBookings[f].push(h):p.courtBookings[f]=[h]:p.unassignedBookings.push(h),p},{courtBookings:{},unassignedBookings:[]}),u=a.map((p,h)=>{let{courtId:f,courtName:m}=p,g=o[f]||[],v=WR({date:r,court:p})||{},{bookings:y=[],startTime:b,endTime:I,date:S}=v,w=[e[h]&&{startTime:b,endTime:e[h]},...Ct(y,!1,!0),...g].filter(Boolean);return{courtId:f,courtName:m,dateAvailability:{bookings:w,startTime:b,endTime:I,date:S}}});l.sort((p,h)=>rn(p.startTime)-rn(h.startTime));let c=()=>u.map(p=>{let h=p.dateAvailability,{timeSlots:f=[]}=yD({courtDate:h});return{courtName:p.courtName,courtId:p.courtId,timeSlots:f}}).flat(),d=[];for(let p of l){let{startTime:h,endTime:f,averageMinutes:m,recoveryMinutes:g,matchUpId:v}=p,y=rn(h),b=rn(f),I=c().reduce((S,{courtId:w,courtName:T,timeSlots:U})=>{let C;return U.find(({startTime:E,endTime:P})=>{C=rn(E)-y;let M=y>=rn(E);return b<=rn(P)&&S.startDifference!==0&&((C===0||C+n>=0)&&(S.startDifference===void 0||C<S.startDifference)||M)})?{courtName:T,courtId:w,startDifference:C}:S},{});if(I.courtId){let S={averageMinutes:m,recoveryMinutes:g,matchUpId:v,startTime:h,endTime:f};d.push(S),u.find(({courtId:w})=>w===I.courtId)?.dateAvailability.bookings.push(S)}else console.log({unassignedBooking:p})}return{virtualCourts:u.map(({courtId:p,courtName:h,dateAvailability:f})=>({dateAvailability:[f],courtName:h,courtId:p})),assignedBookings:d}}function DF({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let n=(t||90)+(i||0);return e>n?n:e||30}function Dhe(t){let{startTime:e="8:00",endTime:i="20:30",count:n=10,date:r}=t??{};return Dt(0,n).map(()=>({dateAvailability:[{date:r,startTime:e,endTime:i}]}))}function zT({scheduleDate:t,startTime:e,endTime:i,courts:n}){let r=e&&"startTime"||i&&"endTime"||void 0;return n.reduce((a,s)=>{let o=WR({date:t,court:s}),l=r&&(o?.[r]||s[r]);return l&&(!a||e&&rn(l)<rn(a)||i&&rn(l)>rn(a))?l:a},void 0)}function vBe({averageMinutes:t,startTime:e,endTime:i,courts:n,date:r}){e=e||zT({courts:n,scheduleDate:r,startTime:!0}),i=i||zT({courts:n,scheduleDate:r,endTime:!0});let a;if(e&&i){let s=zr(e),o=zr(i);for(let l of n||[]){if(!Array.isArray(l.dateAvailability))continue;let u=WR({court:l,date:r}),{timeSlots:c}=yD({courtDate:u});c?.forEach(d=>{let p=zr(d.startTime),h=zr(d.endTime);if(p>o||p<s||h<s)return!1;if(W1(p,h)>=t){let f=Jn(p.toISOString());(!a||f<a)&&(a=f)}})}}return{firstTimeSlotStartTime:a}}function b5(t){let e=zt(t,[{courts:!0,_ofType:xs}]);if(e.error)return e;let{date:i=u3(),startTime:n="08:00",endTime:r="19:00",periodLength:a,courts:s}=t,{calculateStartTimeFromCourts:o=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:c,courtsCount:d,bookings:p}=t;a=a||DF({averageMatchUpMinutes:u}),i=Pi(i),n=Jn(n),r=Jn(r);let h=0,f=0,m=0,g=0,v=0;!s&&d&&(s=Dhe({startTime:n,endTime:r,count:d,date:i}));let{virtualCourts:y}=UF({remainingScheduleTimes:l,clearScheduleDates:c,scheduleDate:i,periodLength:a,bookings:p,courts:s}),{firstTimeSlotStartTime:b}=vBe({averageMinutes:u,courts:y,startTime:n,endTime:r,date:i});o&&b&&(n=b??n);let I=rn(n),S=rn(r)-I,w=Math.floor(S/a),T=Dt(0,w+1).map(U=>{let C=I+U*a,E=n_e(C),P=Uhe({courts:y??[],averageMatchUpMinutes:u,periodStart:E,date:i});if(P.error)return{error:P.error};let{availableToScheduleCount:M=0}=P,R=M>f?M-f:0;v+=U?M:0;let N=U?v/U:M,A=a*N/u,_=U?A*(U-1)+N:N,x=M?f&&_-h||R:0;h=_,f=M,m+=x;let O=ri(m)-g;return g+=O,{periodStart:E,add:O,availableToScheduleCount:M,newCourts:R,totalMatchUps:g}});return{scheduleTimes:T.reduce((U,C)=>{let E=Dt(0,C.add).map(()=>({scheduleTime:C.periodStart}));return U.concat(...E)},[]).flat(),timingProfile:T,totalMatchUps:g}}var Ehe={getCourtsAvailableAtPeriodStart:Uhe,generateTimeSlots:yD,getScheduleTimes:b5,courtGenerator:Dhe},yBe=Ehe,Im={};Fi(Im,{isValid:()=>Ml,isValidMatchUpFormat:()=>Ml,parse:()=>So,stringify:()=>QO});var I5={};Fi(I5,{allCompetitionMatchUps:()=>jd,allDrawMatchUps:()=>uo,allEventMatchUps:()=>gf,allTournamentMatchUps:()=>Za,analyzeMatchUp:()=>DC,applyLineUps:()=>Khe,assignMatchUpSideParticipant:()=>Che,assignTieMatchUpParticipantId:()=>Ak,bulkMatchUpStatusUpdate:()=>zhe,calculateWinCriteria:()=>w0,checkInParticipant:()=>S5,checkMatchUpIsComplete:()=>Py,checkOutParticipant:()=>w5,competitionScheduleMatchUps:()=>HR,disableTieAutoCalc:()=>jhe,drawMatchUps:()=>Q4,enableTieAutoCalc:()=>$he,eventMatchUps:()=>vF,filterMatchUps:()=>qf,findMatchUp:()=>F4,getAllDrawMatchUps:()=>Kr,getAllStructureMatchUps:()=>cn,getCheckedInParticipantIds:()=>l0,getCompetitionMatchUps:()=>UC,getEventMatchUpFormatTiming:()=>H4,getHomeParticipantId:()=>Y4,getMatchUpCompetitiveProfile:()=>fR,getMatchUpContextIds:()=>K4,getMatchUpDailyLimits:()=>bF,getMatchUpDailyLimitsUpdate:()=>z4,getMatchUpDependencies:()=>gd,getMatchUpFormat:()=>Z4,getMatchUpFormatTiming:()=>mR,getMatchUpFormatTimingUpdate:()=>G4,getMatchUpScheduleDetails:()=>ML,getMatchUpType:()=>NL,getMatchUpsStats:()=>X4,getModifiedMatchUpFormatTiming:()=>gF,getParticipantResults:()=>NR,getPredictiveAccuracy:()=>W4,getRoundMatchUps:()=>go,getRounds:()=>J4,isValidMatchUpFormat:()=>Ml,matchUpActions:()=>WL,mutate:()=>Phe,participantScheduledMatchUps:()=>q4,query:()=>$pe,removeDelegatedOutcome:()=>Bhe,removeMatchUpSideParticipant:()=>D5,removeTieMatchUpParticipantId:()=>Mhe,replaceTieMatchUpParticipantId:()=>U5,resetAdHocMatchUps:()=>Whe,resetMatchUpLineUps:()=>A5,resetScorecard:()=>k5,resetTieFormat:()=>_5,setDelegatedOutcome:()=>qhe,setMatchUpFormat:()=>Ghe,setMatchUpStatus:()=>YR,setOrderOfFinish:()=>Yhe,substituteParticipant:()=>Vhe,tallyParticipantResults:()=>pD,toggleParticipantCheckInState:()=>EF,tournamentMatchUps:()=>yF,updateTieMatchUpScore:()=>qm,validMatchUp:()=>UL,validMatchUps:()=>ac});var Phe={};Fi(Phe,{applyLineUps:()=>Khe,assignMatchUpSideParticipant:()=>Che,assignTieMatchUpParticipantId:()=>Ak,bulkMatchUpStatusUpdate:()=>zhe,checkInParticipant:()=>S5,checkOutParticipant:()=>w5,disableTieAutoCalc:()=>jhe,enableTieAutoCalc:()=>$he,findMatchUp:()=>F4,removeDelegatedOutcome:()=>Bhe,removeMatchUpSideParticipant:()=>D5,removeTieMatchUpParticipantId:()=>Mhe,replaceTieMatchUpParticipantId:()=>U5,resetAdHocMatchUps:()=>Whe,resetMatchUpLineUps:()=>A5,resetScorecard:()=>k5,resetTieFormat:()=>_5,setDelegatedOutcome:()=>qhe,setMatchUpFormat:()=>Ghe,setMatchUpStatus:()=>YR,setOrderOfFinish:()=>Yhe,substituteParticipant:()=>Vhe,toggleParticipantCheckInState:()=>EF,updateTieMatchUpScore:()=>qm});function Che({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:n,matchUpId:r,event:a}){if(i&&typeof i!="string")return{error:Bd};if(!e)return{error:Ot};if(!r)return{error:eo};let s=n===void 0;if(s&&(n=1),![1,2].includes(n))return ce({result:{error:Ee,context:{sideNumber:n}}});let{matchUp:o,structure:l}=Qn({drawDefinition:e,matchUpId:r,event:a});if(!o)return{error:Vs};if(!(!l?.structures&&!(e.drawType&&e.drawType!==Al)&&!l?.matchUps?.find(({roundPosition:u})=>!!u)))return{error:Aq};if(!i&&(o?.score?.scoreStringSide1||Yr.includes(o?.matchUpstatus)||o?.matchUpStatus&&[cr,sa].includes(o.matchUpStatus)))return{error:VO,info:"matchUp has completed status or score"};if(o){if(o.sides=[1,2].map(u=>{let c=o.sides?.find(d=>d.sideNumber===u)??{sideNumber:u};return n===u?{...c,participantId:i}:c}),s)for(let u of o.sides)u.sideNumber&&(u.sideNumber=3-u.sideNumber);Zi({tournamentId:t?.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:o})}return{...le,sidesSwapped:s}}function xl({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:s,event:o}){let{matchUp:l}=Qn({drawDefinition:n,event:o,matchUpId:a});if(!l)return{error:Vs};let u=rh({removePriorValues:t,element:l,duplicateValues:i,timeItem:s});return r||Zi({tournamentId:e?.tournamentId,eventId:o?.eventId,context:"addTimeItem",drawDefinition:n,matchUp:l}),u}function w5(t){let e=[{[ha]:!0},{[zs]:!0},{[Zh]:!0},{[th]:!0}],i=zt(t,e);if(i.error)return i;let n=fD(t,[{[JU]:hf,attr:{[oL]:!0}}]);if(n.error)return n;let{tournamentRecord:r,drawDefinition:a,participantId:s,matchUpId:o}=t,l=n?.matchUp?.matchUp,{matchUpStatus:u,score:c}=l??{};if(u&&gL.includes(u)||u&&Yr.includes(u)||ca({score:c}))return{error:vse};let d=l0({matchUp:l});if(d?.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:h}=d??{};if(!h?.includes(s))return{error:Bd};if(!p?.includes(s))return{error:qse};let f=yue({matchUp:l});if(f?.error)return f;let{sideParticipantIds:m,nestedIndividualParticipantIds:g}=f??{},v=m?.indexOf(s);return v!==void 0&&[0,1].includes(v)&&(g?.[v]??[]).forEach(y=>{xl({drawDefinition:a,matchUpId:o,timeItem:{itemType:yk,itemValue:y}})}),xl({tournamentRecord:r,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:yk}}),{...le,checkedOut:!0}}function S5(t){let e=[{[ha]:!0},{[zs]:!0},{[Zh]:!0},{[th]:!0}],i=zt(t,e);if(i[Gc])return i;let n=fD(t,[{[JU]:hf,attr:{[oL]:!0}}]);if(n[Gc])return n;let{tournamentRecord:r,drawDefinition:a,participantId:s,matchUpId:o}=t,l=l0({matchUp:n?.matchUp?.matchUp});if(l?.error)return l;let{checkedInParticipantIds:u,allRelevantParticipantIds:c}=l??{};if(!c?.includes(s))return{[Gc]:Bd};let d={...le,checkedIn:!0};return u?.includes(s)||xl({tournamentRecord:r,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:vk}}),d}function EF(t){let e=zt(t,[{[Zh]:!0,[zs]:!0,[th]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,n=t.tournamentRecord??(i&&t.tournamentRecords?.[i]);if(!n)return{error:ot};let r=fD(t,[{[JU]:hf,attr:{[oL]:!0},[Gc]:Vs}]).matchUp?.matchUp;if(!r)return{error:Vs};let{checkedInParticipantIds:a=[]}=l0({matchUp:r}),{participantId:s,matchUpId:o,drawDefinition:l}=t;return s&&a.includes(s)?w5({tournamentRecord:n,drawDefinition:l,participantId:s,matchUpId:o,matchUp:r}):S5({tournamentRecord:n,drawDefinition:l,participantId:s,matchUpId:o,matchUp:r})}function T5({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:n}){if(!t)return{error:ot};if(!e)return{error:Zd};if(!n)return{error:Wu};let r=us({drawDefinition:e}),{matchUp:a}=Qn({matchUpId:i,drawDefinition:e,matchUpsMap:r});if(!a)return{error:Vs};let{matchUp:s,structure:o}=Qn({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:r,event:n});if(!s)return{error:Vs};let{collectionPosition:l,drawPositions:u,collectionId:c,matchUpTieId:d,matchUpType:p}=s;if(p&&!xO([Rn,Dn],p))return{error:rl};let{positionAssignments:h}=Nn({structure:o}),f=h?.filter(w=>u?.includes(w.drawPosition)),{matchUp:m}=Qn({matchUpId:d,drawDefinition:e,matchUpsMap:r}),g=m?.sides?.map(Vi)??[],v=f?.map(Vi)??[],y=[...g,...v],{participants:b}=dr({tournamentRecord:t,participantFilters:{participantTypes:[wn],participantIds:y}}),{matchUp:I}=Qn({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:r}),S=Zs({matchUp:m,drawDefinition:e,structure:o,event:n})?.tieFormat;return{inContextDualMatchUp:I,inContextTieMatchUp:s,relevantAssignments:f,collectionPosition:l,teamParticipants:b,collectionId:c,matchUpType:p,dualMatchUp:m,tieMatchUp:a,tieFormat:S,structure:o,...le}}function U5(t){let e=T5(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:n,tournamentRecord:r,newParticipantId:a,drawDefinition:s,substitution:o,event:l}=t;if(!n||!a)return ce({result:{error:la},stack:i});if(n===a)return{...le};let{inContextDualMatchUp:u,inContextTieMatchUp:c,collectionPosition:d,collectionId:p,dualMatchUp:h,tieMatchUp:f,tieFormat:m}=e,g=c?.matchUpType,v=c?.sides?.find(O=>O.participant?.participantId===n||O.participant?.individualParticipantIds?.includes(n));if(!v)return{error:Nr};let y=dr({tournamentRecord:r,participantFilters:{participantIds:[n,a]}})?.participants??[];if(y.length!==2)return ce({result:{error:la},stack:i});if(y[0].participantType!==y[1].participantType)return ce({result:{error:Vd},stack:i});let{appliedPolicies:b}=sn({tournamentRecord:r,drawDefinition:s,event:l}),I=t.policyDefinitions?.[Ha]??b?.[Ha]??lD[Ha],S=y.find(({participantId:O})=>O===a);if((t.enforceGender??I?.participants?.enforceGender)!==!1&&xp(c?.gender)&&Ls(c?.gender)!==Ls(S?.person?.sex))return{error:Yw,info:"Gender mismatch"};let w=I?.processCodes?.substitution;_R({tournamentId:r.tournamentId,eventId:l.eventId,inContextDualMatchUp:u,drawDefinition:s,dualMatchUp:h});let T=h?.sides?.find(({sideNumber:O})=>O===v.sideNumber);if(!T)return ce({result:{sideNumber:v.sideNumber,existingParticipantId:n,error:Ya},stack:i});if(c?.sides?.flatMap(O=>O.participant?.individualParticipantIds||O.participant?.participantId||[])?.includes(a))return ce({result:{error:GO},stack:i});let U=u?.sides?.find(({sideNumber:O})=>O===v.sideNumber)?.participantId,C=T.lineUp,E=C?.find(({participantId:O})=>a===O),P=C?.reduce((O,$)=>$.substitutionOrder>O?$.substitutionOrder:O,0),M=C?.map(O=>{let $=Ct(O,!1,!0);if(![n,a].includes($.participantId))return $;if(!o&&[n,a].includes($.participantId)&&($.collectionAssignments=$.collectionAssignments?.filter(F=>!(F.collectionPosition===d&&F.collectionId===p))),o&&n===$.participantId&&($.collectionAssignments=$.collectionAssignments.map(F=>F.collectionPosition===d&&F.collectionId===p&&F.substitutionOrder===void 0?{...F,substitutionOrder:P}:F)),$.participantId===a){$.collectionAssignments||($.collectionAssignments=[]);let F={collectionId:p,collectionPosition:d};o&&(F.previousParticipantId=n,F.substitutionOrder=(P??0)+1),$.collectionAssignments.push(F)}return $})??[];if(!E){let O={collectionId:p,collectionPosition:d};o&&(O.substitutionOrder=(P??0)+1,O.previousParticipantId=n);let $={collectionAssignments:[O],participantId:a};M.push($)}let R=g===Dn,{assignedParticipantIds:N}=bk({lineUp:C,collectionPosition:d,collectionId:p}),{assignedParticipantIds:A}=bk({lineUp:M,collectionPosition:d,collectionId:p});if(T.lineUp=M,U&&m){let O=m0({participantId:U,lineUp:M,drawDefinition:s,tieFormat:m});if(O.error)return ce({result:O,stack:i})}else console.log("team participantId not found");let _,x;if(R){let{tournamentRecord:O}=t,$=ad({participantIds:A,tournamentRecord:O});if(!$.participant){let j=jp({returnParticipant:!0,pairOverride:!0,tournamentRecord:O,participant:{participantRole:bs,individualParticipantIds:A,participantType:Ni}});if(j.error)return ce({result:j,stack:i});_=j.participant?.participantId}$=ad({participantIds:N,tournamentRecord:O});let F=$.participant?.participantId;F&&h0({participantIds:[F],tournamentRecord:O}).success&&(x=F)}if(o||v.substitutions?.length===1){if(o)w&&f&&(f.processCodes=wi([...f?.processCodes??[],...w]));else for(let O of w||[]){let $=f?.processCodes?.lastIndexOf(O);$!==void 0&&f?.processCodes?.splice($,1)}f&&Zi({tournamentId:r?.tournamentId,matchUp:f,context:i,drawDefinition:s})}return h&&Zi({tournamentId:r?.tournamentId,matchUp:h,context:i,drawDefinition:s}),{...le,modifiedLineUp:M,participantRemoved:x,participantAdded:_}}function Rhe({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:n,participantIds:r,collectionId:a}){if(!a||!t||!Array.isArray(r))return{modifiedLineUp:i?.lineUp||[],error:Ee};let s=i?.lineUp||Ky({participantId:e,drawDefinition:n})?.lineUp,o=[],l=[];return{modifiedLineUp:s?.map(u=>{if(!r.includes(u.participantId))return u;let c=u.collectionAssignments?.filter(d=>{let p=d.collectionId===a&&d.collectionPosition===t;return p&&(d.previousParticipantId&&o.push(d.previousParticipantId),l.push({participantId:u.participantId,...d})),!p});return{participantId:u.participantId,collectionAssignments:c}}).filter(Boolean)||[],assignmentsRemoved:l,previousParticipantIds:o}}function bBe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let n=(i.events||[]).filter(a=>a?.eventType===na&&a?.entries?.some(s=>s.participantId===e)),r=a=>!t.includes(a.participantId);for(let a of n){a.entries=(a.entries||[]).filter(r);let{flightProfile:s}=Cr({event:a});s?.flights?.forEach(o=>{o.drawEntries=(o.drawEntries||[]).filter(r)}),a?.drawDefinitions?.forEach(o=>{o.entries=(o.entries||[]).filter(r)})}return{...le}}function PF({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:n}){let r="addIndividualParticipantIds";if(!n)return ce({result:{error:ot},stack:r});if(!e||!t)return ce({result:{error:Zt},stack:r});let a=n.participants??[],s=a.find(d=>d.participantId===e);if(!s)return ce({result:{error:Nr},stack:r});if(s?.participantType&&![wn,Iu].includes(s.participantType))return ce({context:{participantType:s.participantType},result:{error:Vd},stack:r});let o=t.filter(d=>a.find(p=>p.participantId===d)?.participantType!==ji);if(o.length)return ce({result:{error:Ul,invalidParticipantIds:o},stack:r});s.individualParticipantIds||(s.individualParticipantIds=[]);let l=s.individualParticipantIds,u=t.filter(d=>!l.includes(d));u.length&&(i&&kL({individualParticipantIds:u,tournamentRecord:n}),s.individualParticipantIds=s.individualParticipantIds.concat(...u));let{topics:c}=bu();if(c.includes(Us)){let d=a.find(({participantId:p})=>p===e);Ti({topic:Us,payload:{participants:[d]}})}return bBe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:n}),{groupingParticipant:Ct(s,!1,!0),added:u.length,...le}}function CF(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r,pairOverride:a,participant:s}=t;if(!r)return{error:ot};if(!s)return{error:Kw};if(!s.participantId)return jp({tournamentRecord:r,participant:s});let{participant:o}=Uv({participantId:s.participantId,tournamentRecord:r});if(!o)return jp({tournamentRecord:r,participant:s});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:c,participantName:d,participantRole:p,participantType:h,onlineResources:f,contacts:m,person:g}=s;if(h&&o.participantType!==h)return{error:$se};let v={};if(m&&(v.contacts=m),f&&(v.onlineResources=f),c&&Xn(c)&&(v.participantOtherName=c),d&&Xn(d)&&(v.participantName=d),Array.isArray(u)){let{participants:y}=dr({participantFilters:{participantTypes:[ji]},tournamentRecord:r}),b=y?.map(Vi);if(b){let I=u.filter(S=>Xn(S)&&b.includes(S));([Iu,Hn].includes(h||o.participantType)||h===Ni&&(I.length===2||a))&&(v.individualParticipantIds=I),o.participantType===pT.PAIR&&e&&(v.participantName=IBe({individualParticipants:y,newValues:v}))}}return Object.keys(Pv).includes(p)&&(v.participantRole=p),Object.keys(pT).includes(h)&&(v.participantType=h),Array.isArray(l)&&(v.participantRoleResponsibilties=l),o.participantType===pT.INDIVIDUAL&&g&&wBe({updateParticipantName:e,existingParticipant:o,newValues:v,person:g}),Object.assign(o,Vt(v)),i&&PF({individualParticipantIds:[o.participantId],groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r}),Ti({topic:Us,payload:{tournamentId:r.tournamentId,participants:[o]}}),{participant:Ct(o),...le}}function IBe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,n=t.filter(({participantId:r})=>i.includes(r)).map(({person:r})=>r?.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(n+="/Unknown"),n}function wBe({updateParticipantName:t,existingParticipant:e,newValues:i,person:n}){let r={},{standardFamilyName:a,standardGivenName:s,nationalityCode:o,personId:l,birthdate:u,tennisId:c,sex:d}=n;d&&Object.keys(eh).includes(d)&&(r.sex=d);let p;if(Xn(l)&&(r.personId=l),o&&Xn(o)&&(SBe(o)||o==="")&&(r.nationalityCode=o),a&&typeof Xn(a)&&a.length>1&&(r.standardFamilyName=a,p=!0),s&&typeof Xn(s)&&s.length>1&&(r.standardGivenName=s,p=!0),p&&t){let h=`${r.standardGivenName} ${r.standardFamilyName}`;i.participantName=h}u&&nl(u)&&(r.birthdate=u),c&&Xn(c)&&(r.tennisId=c),Object.assign(e.person,r)}function SBe(t){return $g.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function Ak(t){let e=T5(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",n=t.teamParticipantId,{tournamentRecord:r,drawDefinition:a,participantId:s,event:o}=t;if(!s)return ce({result:{error:la},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return ce({result:{error:jq},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:u,relevantAssignments:c,collectionPosition:d,teamParticipants:p,collectionId:h,matchUpType:f,dualMatchUp:m,tieFormat:g}=e;if(u?.sides?.flatMap(F=>F.participant?.individualParticipantIds||F.participant?.participantId||[])?.includes(s))return ce({result:{...le},stack:i});n=n??(t.sideNumber?l?.sides?.find(F=>F.sideNumber===t.sideNumber)?.participantId:void 0);let v=dr({participantFilters:{participantIds:[s]},tournamentRecord:r})?.participants?.[0];if(!v)return ce({result:{error:Nr},stack:i});let{appliedPolicies:y}=sn({tournamentRecord:r,drawDefinition:a,event:o}),b=t.policyDefinitions?.[Ha]??y?.[Ha]??lD[Ha];if((t.enforceGender??b?.participants?.enforceGender)!==!1&&xp(u?.gender)&&Ls(u?.gender)!==Ls(v.person?.sex))return{error:Yw,info:"Gender mismatch"};let{individualParticipantIds:I,participantType:S}=v;if(_r(Rn)(f)&&S!==ji)return{error:Vd};let w=S===ji?[s]:I,T=n&&p?.find(({participantId:F})=>F===n)||p?.find(({individualParticipantIds:F})=>mo(w,F));if(!T)return{error:Jq};if(n||(n=T.participantId),!n)return{error:Nr};let U=c?.find(F=>F.participantId===T?.participantId)?.drawPosition,C=m?.sides?.find(F=>F.participantId===n)?.sideNumber,E=u?.sides?.find(F=>U&&F.drawPosition===U)?.sideNumber,P=C??E??t.sideNumber;if(!g)return{error:qU};if(!g.collectionDefinitions?.find(F=>F.collectionId===h))return{error:Mse};_R({tournamentId:r.tournamentId,eventId:o.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:m});let M=m?.sides?.find(F=>F.sideNumber===P),R=u?.sides?.find(F=>F.sideNumber===P),N=(M?.lineUp??Ky({participantId:n,drawDefinition:a})?.lineUp)?.filter(F=>F.collectionAssignments?.find(j=>j.collectionPosition===d&&j.collectionId===h&&!j.previousParticipantId))?.map(F=>F?.participantId),A=N?.length>1&&N||(S===Ni?v.individualParticipantIds:[s]),_=Rhe({collectionPosition:d,teamParticipantId:n,dualMatchUpSide:M,drawDefinition:a,participantIds:A,collectionId:h});if(_.error)return ce({result:_,stack:i});let{modifiedLineUp:x}=_,O;if(f===Dn){if(S!==Ni){let F=uV({collectionPosition:d,teamParticipantId:n,drawDefinition:a,modifiedLineUp:x,participantId:s,collectionId:h,tieFormat:g});if(F?.error)return ce({result:F,stack:i});if(F=$({side:R}),F.error)return F;O=F.deletedParticipantId,M&&(M.lineUp=x),m&&Zi({tournamentId:r?.tournamentId,matchUp:m,context:i,drawDefinition:a})}else if(S===Ni)for(let F of A)uV({collectionPosition:d,teamParticipantId:n,drawDefinition:a,modifiedLineUp:x,participantId:F,collectionId:h,tieFormat:g})}else{let F=uV({collectionPosition:d,teamParticipantId:n,drawDefinition:a,modifiedLineUp:x,participantId:s,collectionId:h,tieFormat:g});if(F?.error)return F}if(M&&(M.lineUp=x),m&&Zi({tournamentId:r?.tournamentId,matchUp:m,context:i,drawDefinition:a}),O){let{error:F}=h0({participantIds:[O],tournamentRecord:r});F&&console.log("cleanup")}return{...le,modifiedLineUp:x};function $({side:F}){let j;if(F.participant){let H=F.participant.individualParticipantIds||[];if(H.filter(Boolean).length===1){let{participant:G}=ad({participantIds:H,tournamentRecord:r});H.push(s);let{participant:W}=ad({participantIds:H,tournamentRecord:r});if(!W&&G){G.individualParticipantIds=H;let q=CF({pairOverride:!0,tournamentRecord:r,participant:G});if(q.error)return q}else j=G?.participantId}}else{let H=jp({participant:{individualParticipantIds:[s],participantRole:bs,participantType:Ni},pairOverride:!0,tournamentRecord:r});if(H.error)return H}return{...le,deletedParticipantId:j}}}function uV({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:n,participantId:r,collectionId:a,tieFormat:s}){let o=Ky({participantId:e,drawDefinition:i})?.lineUp,l=(n||o)?.find(c=>c?.participantId===r),u={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(u);else{let c={collectionAssignments:[u],participantId:r};n.push(c)}return m0({participantId:e,lineUp:n,drawDefinition:i,tieFormat:s})}function Mhe(t){let{tournamentRecord:e,drawDefinition:i,participantId:n,event:r}=t,a="removeTieMatchUpParticiapantId";if(!n)return ce({result:{error:la},stack:a});let s=T5(t);if(s.error)return s;let{appliedPolicies:o}=sn({tournamentRecord:e,drawDefinition:i,event:r}),l=(t.policyDefinitions?.[Ha]??o?.[Ha]??lD[Ha])?.processCodes?.substitution,{inContextDualMatchUp:u,inContextTieMatchUp:c,relevantAssignments:d,collectionPosition:p,teamParticipants:h,collectionId:f,matchUpType:m,dualMatchUp:g,tieMatchUp:v,tieFormat:y}=s;if(!g)return ce({result:{error:Oo},stack:a});let b=c?.sides?.find(P=>P.participant?.participantId===n||P.participant?.individualParticipantIds?.includes(n));if(!b)return ce({result:{error:Nr},stack:a});let I=t.policyDefinitions?.[Ku]??o?.[Ku];if(!b.substitutions?.length&&(ca({score:c?.score})||c?.winningSide)&&I?.requireParticipantsForScoring!==!1)return ce({result:{error:hoe},stack:a});let S=u?.sides?.find(({sideNumber:P})=>P===b.sideNumber)?.participantId;if(!S)return ce({result:{error:Nr},stack:a});let w=dr({participantFilters:{participantIds:[n]},tournamentRecord:e})?.participants?.[0];if(!w)return ce({result:{error:Nr},stack:a});if(m===Rn&&w.participantType===Ni)return ce({result:{error:Yw},stack:a});let T=w.participantType===ji?[n]:w.individualParticipantIds;_R({tournamentId:e.tournamentId,eventId:r.eventId,inContextDualMatchUp:u,drawDefinition:i,dualMatchUp:g});let U=g.sides?.find(({sideNumber:P})=>P===b.sideNumber);if(!U&&(g.sides?.filter(({lineUp:P})=>!P).length||0)<2){let P=h?.map(({participantId:M})=>({drawPosition:d?.find(R=>R.participantId===M)?.drawPosition,teamParticipantId:M}));U=g.sides?.find(M=>P?.find(({drawPosition:R})=>R===M.drawPosition)?.teamParticipantId===S)}if(!U)return ce({result:{error:Nr,context:{participantId:n}}});let{modifiedLineUp:C,previousParticipantIds:E}=Rhe({collectionPosition:p,teamParticipantId:S,dualMatchUpSide:U,participantIds:T,drawDefinition:i,collectionId:f});if(U.lineUp=C,S&&y&&m0({participantId:S,lineUp:C,drawDefinition:i,tieFormat:y}),m===Dn&&w.participantType===ji){let P=c?.sides?.find(N=>N.sideNumber===U?.sideNumber),{participantId:M}=P??{},R=M&&dr({participantFilters:{participantIds:[M]},tournamentRecord:e,withDraws:!0})?.participants?.[0];if(R){let N=R?.individualParticipantIds?.filter(A=>A!==n)??[];if(E&&N.push(...E),N.length>2)return ce({result:{error:Ul},stack:a});if(R.draws?.length){if(N.length===1){let{participant:A}=ad({participantIds:N,tournamentRecord:e});if(!A){let _=jp({participant:{participantRole:bs,individualParticipantIds:N,participantType:Ni},pairOverride:!0,tournamentRecord:e});if(_.error)return ce({result:_,stack:a})}}}else if(N.length){R.individualParticipantIds=N;let A=CF({participant:R,pairOverride:!0,tournamentRecord:e});if(A.error)return ce({result:A,stack:a})}else{let A=h0({participantIds:[M],tournamentRecord:e});A.error&&console.log("cleanup",{result:A})}}else return ce({result:{error:Nr},stack:a})}if(b.substitutions?.length===1&&!c?.sides?.find(P=>P.sideNumber!==b.sideNumber)?.substitutions?.length&&v?.processCodes?.length){for(let P of l||[]){let M=v.processCodes.lastIndexOf(P);v.processCodes.splice(M,1)}Zi({tournamentId:e?.tournamentId,matchUp:v,context:a,drawDefinition:i})}return Zi({tournamentId:e?.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...le,modifiedLineUp:C}}function D5(t){let e=zt(t,[{[ha]:!0,[zs]:!0,[th]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:n,matchUpId:r,event:a}=t;if(n&&![1,2].includes(n))return{error:Ee,sideNumber:n};let{matchUp:s,structure:o}=Qn({drawDefinition:i,matchUpId:r,event:a});return s?Fo({structure:o})?(s.sides?.forEach(l=>{(!n||l.sideNumber===n)&&delete l.participantId}),Zi({tournamentId:t.tournamentRecord?.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:s}),{...le}):{error:Aq}:{error:Vs}}function TBe({matchUpStatuses:t=["BYE",ir,On],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:n}){let r=e?.reduce((c,d)=>!c||d.roundNumber>c.roundNumber?d:c,void 0),a=r?.drawPositions?.find(c=>c!==i),s=n.filter(c=>c?.drawPositions?.includes(a)).map(c=>c.matchUpStatus),o=n.filter(c=>c?.drawPositions?.includes(i)).map(c=>c.matchUpStatus),l=mo(s||[],t),u=mo(o||[],t);return{sourceMatchUp:r,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:s,loserHadMatchUpStatus:u,loserMatchUpStatuses:o}}function UBe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,structureId:s,dualMatchUp:o,roundNumber:l,matchUpsMap:u,event:c}){let{structure:d}=li({drawDefinition:a,structureId:s});if(d?.structureType===To)return{...le};u=u??us({drawDefinition:a});let p=(u?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:h}=pw({drawPosition:i,matchUps:p}),f=p?.filter(g=>g.roundNumber>=l&&g.roundNumber!==h&&g.drawPositions?.includes(i)),{positionAssignments:m}=Nn({drawDefinition:a,structureId:s});for(let g of f??[])DBe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,dualMatchUp:o,matchUpsMap:u,matchUp:g,event:c});return{...le}}function DBe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:n,tournamentRecord:r,sourceMatchUpId:a,drawDefinition:s,dualMatchUp:o,matchUpsMap:l,matchUp:u,event:c}){let d="removeSubsequentDrawPosition";if(o){let h=t.find(({matchUpId:m})=>u.matchUpId===m).sides?.find(m=>m.drawPosition===n)?.sideNumber,f=u.sides?.find(m=>m.sideNumber===h);f&&delete f.lineUp}u.drawPositions=(u.drawPositions||[]).map(h=>h===n?void 0:h).filter(Boolean);let p=e.filter(({drawPosition:h})=>u.drawPositions?.includes(h)).filter(h=>h.bye).length;return u.matchUpStatus=p&&"BYE"||$s(u.matchUpStatus)&&u.matchUpStatus||Er,$s(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&ace({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),Zi({tournamentId:r?.tournamentId,eventId:c?.eventId,context:`${d}-${n}`,drawDefinition:s,matchUp:u}),{...le}}function bD(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:r,matchUpStatus:a,matchUpsMap:s,dualMatchUp:o,targetData:l,matchUpId:u,structure:c,event:d}=t,p=!!t.matchUp.collectionId,h=Fo({structure:c}),{drawPositions:f,winningSide:m}=l.matchUp||{};if(!h&&!f)return{error:$1};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:b,winnerMatchUp:I,byeMatchUp:S}}=l,w=Pp({...t,matchUpStatus:a||Er,removeWinningSide:!0});if(w.error)return w;let T;if(p){let{matchUpTieId:x,matchUpsMap:O}=t;if(T=qm({appliedPolicies:t.appliedPolicies,matchUpId:x,tournamentRecord:n,drawDefinition:r,matchUpsMap:O,event:d}),!e&&!T.removeWinningSide)return{...le}}if(h)return{...le};let{matchUps:U}=cn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:r,matchUpsMap:s,structure:c}),{positionAssignments:C}=ua({structure:c}),E=m-1,P=1-E,M=f[E],R=f[P],{winnerParticipantId:N,loserParticipantId:A}=C?.reduce((x,O)=>(O.drawPosition===R&&(x.loserParticipantId=O.participantId),O.drawPosition===M&&(x.winnerParticipantId=O.participantId),x),{winnerParticipantId:void 0,loserParticipantId:void 0})||{},_=U.filter(x=>x.drawPositions?.includes(R));if(I&&Nhe({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:M,winnerParticipantId:N,tournamentRecord:n,winnerTargetLink:v,drawDefinition:r,winnerMatchUp:I,dualMatchUp:o,matchUpsMap:s}),b){let{winnerHadMatchUpStatus:x}=TBe({drawPositionMatchUps:_,loserDrawPosition:R,sourceMatchUps:U}),O=g.linkCondition===Fp;if(x&&O){let F=Math.min(...b.drawPositions);ZG({targetLink:g,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:F,matchUpsMap:s,event:d})}let $=EBe({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:A,tournamentRecord:n,loserTargetLink:g,drawDefinition:r,loserMatchUp:b,dualMatchUp:o,matchUpsMap:s,event:d});if($.error)return $}if(S){let x=Math.min(...S.drawPositions);ZG({targetLink:y,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:x,matchUpsMap:s,event:d})}return{...le,...T&&{tieMatchUpResult:T}}}function Nhe({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:n,tournamentRecord:r,winnerTargetLink:a,sourceMatchUpId:s,drawDefinition:o,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:c,event:d}){let{structureId:p,roundNumber:h}=l,f="removeDirectedWinner";if(a){let m=a.target.structureId,{structure:g}=li({drawDefinition:o,structureId:m});if(!g)return{error:or};let{positionAssignments:v}=ua({structure:g});g.seedAssignments=(g.seedAssignments??[]).filter(T=>T.participantId!==n);let y=v?.find(T=>T.participantId===n)?.drawPosition,{matchUps:b}=cn({drawDefinition:o,structure:g,event:d}),I=b.map(T=>T.drawPositions).flat(1/0).filter(Boolean),S=Rl(I);if((y?S[y]:void 0)===1)v?.forEach(T=>{T.participantId===n&&delete T.participantId});else{let T=b.filter(({drawPositions:U})=>U.includes(y));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:T,winnerTargetLink:a})}let w=u?.drawMatchUps?.find(({matchUpId:T})=>T===l.matchUpId);w&&Zi({tournamentId:r?.tournamentId,eventId:d?.eventId,matchUp:w,context:f,drawDefinition:o})}return h&&UBe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:r,sourceMatchUpId:s,drawDefinition:o,dualMatchUp:c,matchUpsMap:u,roundNumber:h,structureId:p}),{...le}}function EBe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:n,sourceMatchUpId:r,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,dualMatchUp:l,event:u}){let c="removeDirectedLoser",d=n.target.structureId,{structure:p}=li({drawDefinition:a,structureId:d});if(!p)return{error:or};let{positionAssignments:h}=ua({structure:p}),f=h?.find(m=>m.participantId===e)?.drawPosition;if(h?.forEach(m=>{m.participantId===e&&delete m.participantId}),r&&t){let m=o?.drawMatchUps?.find(({matchUpId:g})=>g===s.matchUpId);m.matchUpStatusCodes=t===cr?["WO","WO"]:[]}if(p.seedAssignments=(p.seedAssignments??[]).filter(m=>m.participantId!==e),l){let m=s?.sides.reduce((y,b,I)=>b.drawPosition===f?I:y,void 0),g=o?.drawMatchUps?.find(({matchUpId:y})=>y===s.matchUpId),v=g?.sides?.[m];v&&(delete v.lineUp,Zi({tournamentId:i?.tournamentId,eventId:u?.eventId,matchUp:g,context:c,drawDefinition:a}))}return{...le}}function ZG({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,targetLink:a,event:s}){let o=a.target.structureId,l="removeDirectedBye";Dl({color:"brightyellow",method:l,drawPosition:n});let u=IR({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:o,event:s});return ce({result:u,stack:l})}function PBe(t){let{matchUpFormat:e,score:i}=t,n=i?.sets?.length,r=e&&So(e),{setFormat:a,finalSetFormat:s,bestOf:o}=r??{};return(o&&n===o&&s||a)?.timed||!1}function CBe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:n}){let r="attemptToSetMatchUpStatusBYE";if(n?.winningSide)return ce({result:{error:zU},context:{matchUpStatus:"BYE"},stack:r});let{positionAssignments:a}=ua({structure:i}),s=a?.filter(o=>o.bye).map(o=>o.drawPosition);return n.drawPositions?.some(o=>s?.includes(o))?(n.matchUpStatus="BYE",n.matchUpStatusCodes=[],Zi({tournamentId:t?.tournamentId,context:r,drawDefinition:e,matchUp:n}),{...le}):ce({result:{error:Rse},info:"matchUp does not include BYE",stack:r})}function gP(t){let{tournamentRecord:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:r,targetData:a,structure:s,event:o}=t,l="doubleExitAdvancement";if(s.structureType===To)return ce({result:{...le},stack:l});let{matchUp:u,targetMatchUps:c,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:h,loserTargetDrawPosition:f}=c,m=$s(p?.matchUpStatus)&&!p.sides?.map(v=>v.participantId??v.participant).filter(Boolean).length,g=p?.matchUpStatus===cr;if(p&&p.matchUpStatus!=="BYE"){let{loserTargetLink:v}=d;if(i?.progression?.doubleExitPropagateBye||p.feedRound&&p.sides?.[0]?.participantFed){let y=Ahe({loserTargetDrawPosition:f,tournamentRecord:e,loserTargetLink:v,drawDefinition:n,loserMatchUp:p,matchUpsMap:r,event:o});if(y.error)return ce({result:y,stack:l})}else if(!g){let{feedRound:y,drawPositions:b,matchUpId:I}=p,S=y?2:2-b.indexOf(f);S=m?p.winningSide:S;let w=eJ({...t,targetMatchUp:p,walkoverWinningSide:S,tournamentRecord:e,sourceMatchUp:u,matchUpId:I});if(w.error)return ce({result:w,stack:l})}}if(h){let v=eJ({...t,matchUpId:h.matchUpId,targetMatchUp:h,tournamentRecord:e,sourceMatchUp:u});if(v.error)return ce({result:v,stack:l})}return ce({result:{...le},stack:l})}function eJ(t){let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,sourceMatchUp:r,targetMatchUp:a,matchUpsMap:s}=t,o=n.structures.find(({structureId:q})=>q===a.structureId),l=t.matchUpStatus===sa?sa:cr,u=t.matchUpStatus===sa?On:ir,c="conditionallyAdvanceDrawPosition",d=s.drawMatchUps.find(q=>q.matchUpId===a.matchUpId);if(!d)return{error:Oo};let p=r?.drawPositions||[],h=d.drawPositions?.filter(Boolean),f=r?.structureId===a.structureId;if(f&&mo(p,h)&&(h=h.filter(q=>!p.includes(q))),f&&h.length>1)return ce({result:{error:PT},stack:c});let{pairedPreviousMatchUpIsDoubleExit:m,pairedPreviousMatchUp:g}=nce(t),v=vo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),{targetMatchUps:y,targetLinks:b}=v,{loserTargetDrawPosition:I,winnerMatchUp:S,loserMatchUp:w}=y;if(w){let{loserTargetLink:q}=b,Z=Ahe({loserTargetDrawPosition:I,loserMatchUp:w,tournamentRecord:i,loserTargetLink:q,drawDefinition:n,matchUpsMap:s});if(Z.error)return ce({result:Z,stack:c})}let T=d.drawPositions?.filter(Boolean)||[],U=T.length===1,C=t.walkoverWinningSide||U&&c_({drawPosition:T[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,E=$s(d.matchUpStatus)&&!T.length,P=d.finishingRound===1,M=E&&!P?l:u,R=e.find(q=>q.matchUpId===g.matchUpId),N=[],A;r&&(r?.structureId===R?.structureId?r.roundPosition<g?.roundPosition?A=1:A=2:a.feedRound?r.structureId===a.structureId?A=2:A=1:C&&(A=3-C));let _=t.matchUpStatus,x=g?.matchUpStatus;A===1?N=[{matchUpStatus:aA(_),previousMatchUpStatus:_,sideNumber:1},{matchUpStatus:aA(x),previousMatchUpStatus:x,sideNumber:2}]:A===2&&(N=[{matchUpStatus:aA(x),previousMatchUpStatus:x,sideNumber:1},{matchUpStatus:aA(_),previousMatchUpStatus:_,sideNumber:2}]),N.length&&(N=N.map(q=>Vt(q)));let O=Pp({...t,winningSide:C,matchUp:d,matchUpStatusCodes:N,matchUpStatus:M});if(O.error)return ce({result:O,stack:c});if(E)return gP({...t,matchUpStatus:M,targetData:v});if(!S)return ce({result:{...le},stack:c});let $=h.length===2?h[C-1]:h[0],{positionAssignments:F}=Nn({structure:o}),j=F?.find(q=>q.drawPosition===$),H=s.drawMatchUps.find(q=>q.matchUpId===S.matchUpId),G=H?.drawPositions?.filter(Boolean),W=G.length===1;if($){if(j?.bye){let q=vo({matchUpId:H.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(W){let Z=G.filter(Boolean)[0],K=c_({drawPosition:Z,matchUpId:H.matchUpId,inContextDrawMatchUps:e}),Q=Pp({appliedPolicies:t.appliedPolicies,matchUpId:H.matchUpId,matchUp:H,matchUpStatus:u,matchUpStatusCodes:[],removeScore:!0,drawDefinition:n,winningSide:K});return Q.error?ce({result:Q,stack:c}):yW({drawPositionToAdvance:Z,matchUpId:H.matchUpId,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:s})}else if($s(S.matchUpStatus)){let Z=gP({...t,matchUpId:H.matchUpId,matchUpStatus:M,targetData:q});if(Z.error)return ce({result:Z,stack:c})}return ce({result:{...le},stack:c})}return OI({matchUpId:S.matchUpId,drawPosition:$,inContextDrawMatchUps:e,drawDefinition:n})}else if(m){if(!H)return{error:Oo};if(W){let K=G[0],Q=c_({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:K});console.log("existing drawPosition is winningSide",{walkoverWinningSide:Q})}let q=$s(H.matchUpStatus)?u:l,Z=Pp({matchUpId:H.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:H,matchUpStatusCodes:[],removeScore:!0,drawDefinition:n,matchUpStatus:q});if(Z.error)return ce({result:Z,stack:c});if(q===l){let K=gP({...t,matchUpId:a.matchUpId,matchUpStatus:q,targetData:v});if(K.error)return K}}return ce({result:{...le},stack:c})}function Ahe(t){let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:n,drawDefinition:r,matchUpsMap:a,event:s,loserMatchUp:o}=t,l=n?.target?.structureId,{structure:u}=li({drawDefinition:r,structureId:l});return u?Su({drawPosition:e,tournamentRecord:i,drawDefinition:r,structureId:l,matchUpsMap:a,loserMatchUp:o,event:s}):{error:wb}}function aA(t){return t===cr?ir:t===sa?On:t}function RBe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:n,structure:r,matchUp:a}=t,s=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),o="attemptToSetMatchUpStatus",l=n==="BYE",u=a.winningSide,c=[cr,sa].includes(n),d=yR({matchUpStatus:n}),p=MG({matchUpStatus:n}),h=!d&&!p,f=t.matchUpTieId||u&&d&&!c,m=u&&c,g=()=>Pp({...t,removeScore:[nh,ir].includes(n),matchUpStatus:n||Er});return h&&{error:pG}||f&&m_(t)||m&&MBe(t)||u&&bD(t)||p&&g()||l&&CBe({tournamentRecord:e,drawDefinition:i,structure:r,matchUp:a})||!d&&{error:pG}||c&&NBe(t)||s&&m_(t)||t.propagateExitStatus&&m_(t)||ce({result:{error:zU,info:"matchUpStatus: "+n},stack:o})}function MBe(t){let e=bD(t);return e.error?e:gP(t)}function NBe(t){let e=m_({...t,removeScore:!0});return e.error?e:gP(t)}function m_(t){let e="scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide){let r=bD(t);if(r.error)return ce({result:r,stack:e})}let i=!!t.matchUp.collectionId,n=Pp({...t});if(i){let{matchUpTieId:r,drawDefinition:a,matchUpsMap:s}=t,o=qm({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,event:t.event,drawDefinition:a,matchUpsMap:s});if(o.error)return ce({result:o,stack:e});Object.assign(n,{tieMatchUpResult:o})}return ce({result:n,stack:e})}function ABe({drawDefinition:t,structure:e,matchUp:i}){let{drawPositions:n}=i,{positionAssignments:r}=Nn({drawDefinition:t,structure:e}),a=r?.filter(({drawPosition:l})=>n?.includes(l))?.map(l=>{let{extension:u}=_i({element:l,name:gm});return u?.value?.groupOrder}),{containerStructures:s}=rD({drawDefinition:t}),o=s[e.structureId];return{structureIds:aD({drawDefinition:t,structureId:o})?.links?.source?.filter(l=>mo(a,l.source?.finishingPositions||[])).map(l=>l.source.structureId)}}function _he({drawDefinition:t,structure:e,matchUp:i}){let n=[];if(e.finishingPosition===qy&&ef({drawDefinition:t,structure:e})){let{structureIds:r}=ABe({drawDefinition:t,structure:e,matchUp:i});r?.length&&n.push(...r)}return{connectedStructureIds:n}}function _Be(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===Ac){let o=n.sides.find(({sideNumber:u})=>u!==a).participantId,l=i.find(u=>u.structureId===s.target.structureId&&u.roundNumber===s.target.roundNumber&&u.sides.some(({participantId:c})=>c===o));if(l?.matchUpStatus===Er){let u=vo({matchUpId:l.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!Qy({inContextDrawMatchUps:i,drawDefinition:r,targetData:u})){let{structure:c}=li({structureId:l.structureId,drawDefinition:r}),d=Nn({structure:c}).positionAssignments;for(let p of d||[])if(p.participantId===o){let h=n.sides.find(({sideNumber:f})=>f===a).participantId;if(p.participantId=h,c?.positionAssignments)c.positionAssignments=d;else if(c?.structures){let f=Object.assign({},...(d||[]).map(m=>({[m.drawPosition]:m.participantId})));for(let m of c.structures)m.positionAssignments?.forEach(g=>g.participantId=f[g.drawPosition])}Kg({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:r,structure:c}),e=!0}}}}return{...le,qualifierReplaced:e}}function kBe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===Ac){let o=n.sides.find(({sideNumber:c})=>c===a)?.participantId,l=i.filter(c=>c.structureId===s.target.structureId&&c.roundNumber===s.target.roundNumber&&c.sides.some(({participantId:d,qualifier:p})=>p&&!d)),u=yl(l);if(u?.matchUpStatus===Er){let c=vo({matchUpId:u.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!Qy({inContextDrawMatchUps:i,drawDefinition:r,targetData:c})){let d=u.sides.find(f=>f.qualifier&&!f.participantId)?.drawPosition,{structure:p}=li({structureId:u.structureId,drawDefinition:r});if(!p)return{error:or};let h=Nn({structure:p}).positionAssignments;for(let f of h||[])if(f.drawPosition===d&&!f.participantId){if(f.participantId=o,p.positionAssignments)p.positionAssignments=h;else if(p.structures){let m=Object.assign({},...(h||[]).map(g=>({[g.drawPosition]:g.participantId})));for(let g of p.structures)g.positionAssignments?.forEach(v=>v.participantId=m[v.drawPosition])}Kg({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:r,structure:p}),e=!0}}}}return{...le,qualifierPlaced:e}}function xBe(t){let e="attemptToSetWinningSide",i,n={},{appliedPolicies:r,disableAutoCalc:a,drawDefinition:s,dualMatchUp:o,winningSide:l,structure:u,matchUp:c}=t;if(o?._disableAutoCalc&&a!==!1)return ZW(t);if(c.winningSide&&c.winningSide!==l){let{connectedStructureIds:f}=_he({drawDefinition:s,structure:u,matchUp:c});f.length&&(console.log({connectedStructureIds:f}),i=!0);let m=bD(t);if(m.error)return m}let d=Qce(t);if(d.context?.progressExitStatus&&Object.assign(n,d.context),d.error)return ce({result:d,stack:e});let p,h;return t.qualifierChanging&&r?.[cC]?.autoReplaceQualifiers&&(p=_Be(t).qualifierReplaced),t.qualifierAdvancing&&r?.[cC]?.autoPlaceQualifiers&&(h=kBe(t).qualifierPlaced),ce({result:Vt({...le,...d,connectedStructures:i,qualifierReplaced:p,qualifierPlaced:h,context:n}),stack:e})}var g_={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function khe(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:r,targetData:a,matchUp:s}=t,{matchUpId:o}=s,{iteration:l=0}=t;l+=1;let u="removeDoubleExit";Dl({color:"brightyellow",method:u,matchUpId:o,iteration:l,keyColors:g_});let{targetMatchUps:{loserMatchUp:c,winnerMatchUp:d,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:h}}=a;if(d&&d.matchUpStatus!=="BYE"){let{stage:g,roundNumber:v,roundPosition:y,structureName:b}=d;Dl({winner:"winner",roundPosition:y,structureName:b,roundNumber:v,keyColors:g_,stage:g}),tJ({...t,targetMatchUp:d,sourceMatchUp:s,iteration:l})}let f=c?.matchUpStatus==="BYE"&&(c?.feedRound||c?.roundNumber===1),m=a?.targetLinks?.loserTargetLink?.linkCondition===Fp;if(f&&m){let g=e.filter(({roundNumber:b,structureId:I})=>I===s.structureId&&b===1),v=g.map(({roundPosition:b})=>b),y=Aa(v.sort(),2).find(b=>b.includes(s.roundPosition));if((g.filter(({roundPosition:b})=>y.includes(b))?.map(({matchUpStatus:b})=>b)).every(b=>[sa,cr].includes(b)))return ce({result:{...le},stack:u})}if(c&&(c.matchUpStatus!=="BYE"||f)){let g=e.find(({matchUpId:T})=>T===c.matchUpId),{structure:v}=li({drawDefinition:n,structureId:g.structureId}),{stage:y,roundNumber:b,roundPosition:I,feedRound:S,structureName:w}=c;if(Dl({loser:"loser",roundPosition:I,structureName:w,roundNumber:b,keyColors:g_,feedRound:S,stage:y}),i?.progression?.doubleExitPropagateBye||f)ZG({drawPosition:p,targetLink:h,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:r});else{let T=tJ({...t,targetMatchUp:c,structure:v,iteration:l});if(T.error)return ce({result:T,stack:u})}}return ce({result:{...le},stack:u})}function tJ(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,sourceMatchUp:r,targetMatchUp:a,matchUpsMap:s,structure:o,iteration:l}=t,u="conditionallyRemoveDrawPosition";Dl({method:u,structureName:o?.structureName,iteration:l});let c=vo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),{targetMatchUps:{winnerMatchUp:d}}=c,p=s?.drawMatchUps.find(I=>I.matchUpId===a.matchUpId),h=[],f,m,g;if(a.feedRound)g=d?.drawPositions?.filter(Boolean)?.find(I=>a.drawPositions.includes(I));else if(!r)g=Dr(a?.drawPositions||[],d?.drawPositions||[])?.[0];else if(m=rce({structureId:o.structureId,matchUp:r,matchUpsMap:s})?.pairedPreviousMatchUp,f=[cr,sa].includes(m?.matchUpStatus),h=m?.drawPositions?.filter(Boolean)||[],[...Yr,"BYE"].includes(m?.matchUpStatus)||m?.winningSide){let I=r.drawPositions||[],S=a.drawPositions?.filter(Boolean);mo(I,S)&&(S=S?.filter(w=>!I.includes(w))),g=I.concat(h).find(w=>S?.includes(w))}if(d&&g){let{stage:I,roundNumber:S,roundPosition:w,structureName:T}=d;Dl({method:"removeDirectedWinner",drawPositionToRemove:g,color:"brightgreen",roundPosition:w,structureName:T,roundNumber:S,keyColors:g_,stage:I}),Nhe({winningDrawPosition:g,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:s})}let v=khe({targetData:c,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:s,structure:o,iteration:l});if(v.error)return ce({result:v,stack:u});let y=OBe({pairedPreviousDoubleExit:f,noContextTargetMatchUp:p}),b=!f;return v=Pp({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],matchUpStatus:y,removeScore:b,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),v.error?ce({result:v,stack:u}):{...le}}function OBe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus==="BYE"?"BYE":t?[sa,On].includes(e?.matchUpStatus)?On:ir:Er}function LBe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r}=t,a=t.targetData.targetLinks?.winnerTargetLink;if(a.target.feedProfile===Ac){let s=n.sides?.find(({sideNumber:l})=>l===n.winningSide)?.participantId,o=i.find(l=>l.structureId===a.target.structureId&&l.roundNumber===a.target.roundNumber&&l.sides?.some(({participantId:u})=>u===s));if(o&&o.matchUpStatus===Er){let l=vo({matchUpId:o.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!Qy({inContextDrawMatchUps:i,drawDefinition:r,targetData:l})){let{structure:u}=li({structureId:o.structureId,drawDefinition:r}),c=Nn({structure:u}).positionAssignments;for(let d of c||[])if(d.participantId===s){if(d.participantId=void 0,u?.positionAssignments)u.positionAssignments=c;else if(u?.structures){let p=Object.assign({},...(c||[]).map(h=>({[h.drawPosition]:h.participantId})));for(let h of u?.structures||[])h.positionAssignments?.forEach(f=>f.participantId=p[f.drawPosition])}Kg({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:r,structure:u}),e=!0}}}}return{qualifierRemoved:e}}function FBe(t){let{matchUp:e,matchUpStatus:i,score:n,winningSide:r}=t,a="noDownStreamDependencies";if([cr,sa].includes(e?.matchUpStatus)&&![cr,sa].includes(i)){let g=khe(t);if(g.error)return ce({result:g,stack:a})}let s=i===cr,o=ca({score:n})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!r),l=t?.inContextMatchUp?.collectionId&&PBe(t.inContextMatchUp),u=t.removeScore||!l&&![_l,al].includes(i||_l),c=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!r&&!ca({score:n}),d=g=>{let v,{structure:y,drawDefinition:b,dualMatchUp:I,disableAutoCalc:S}=t;if(I?._disableAutoCalc&&S!==!1)return ZW({...t,removeWinningSide:c});let{connectedStructureIds:w}=_he({drawDefinition:b,structure:y,matchUp:e});w.length&&(console.log({connectedStructureIds:w}),v=!0),Object.assign(t,{removeScore:g});let T=bD(t);if(T.error)return T;if(t.removingQualifier&&t.appliedPolicies?.[cC]?.autoRemoveQualifiers){let U=LBe(t);return{...le,connectedStructures:v,...U}}return{...le,connectedStructures:v}};if(c&&r&&t.isCollectionMatchUp)return iJ(t);let p=[nh,al].includes(i)&&t.dualWinningSideChange,h=i&&i!==Er,f=t.propagateExitStatus&&$s(i),m=(r||p||f)&&xBe(t)||o&&d(u)||h&&RBe(t)||c&&d(u)||e&&iJ({...t,removeScore:!0})||{...le};return ce({result:m,stack:a})}function iJ(t){let e="ndd:scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide&&!t.autoCalcDisabled){let n=bD(t);if(n.error)return n}let i=Pp({...t});if(t.isCollectionMatchUp){let{matchUpTieId:n,drawDefinition:r,event:a,matchUpsMap:s}=t,{removeWinningSide:o}=qm({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,drawDefinition:r,matchUpsMap:s,event:a});o&&console.log("REMOVE WINNING SIDE")}return ce({result:i,stack:e})}function E5(t){let e=zt(t,[{[ha]:!0,[zs]:!0,[th]:!0},{homeParticipantId:!0,[Gc]:la}]);if(e.error)return e;let i=fD(t,[{[JU]:hf,attr:{[oL]:!0}}]);if(i.error)return i;let n=i?.matchUp?.matchUp?.sides?.map(c=>c?.participantId);if(t.homeParticipantId&&!n?.includes(t.homeParticipantId))return{error:Bd};let{disableNotice:r,homeParticipantId:a,removePriorValues:s,tournamentRecord:o,drawDefinition:l,matchUpId:u}=t;return xl({duplicateValues:!1,removePriorValues:s,tournamentRecord:o,drawDefinition:l,disableNotice:r,matchUpId:u,timeItem:{itemType:dW,itemValue:a}})}function xhe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Nb({timeItems:i?.timeItems||[],itemType:EL});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{timeModifiers:n}:e}function Rv(t){let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:n,tournamentRecord:r,drawDefinition:a,disableNotice:s,scheduledTime:o,matchUpId:l}=t;if(!l)return ce({result:{error:eo},stack:e});if(!ZU(o))return ce({result:{error:Dc},stack:e});if(!i){let h=Qn({drawDefinition:a,matchUpId:l});if(h.error)return ce({result:h,stack:e});i=h.matchUp}let u=Pi(o),c=u0({matchUp:i}).scheduledDate,d=u&&!c;if((xhe({matchUp:i}).timeModifiers||[])?.length){let h=Ohe({disableNotice:!0,removePriorValues:n,tournamentRecord:r,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(h?.error)return ce({result:h,stack:e})}let p=e0(o,!0,d);return xl({duplicateValues:!1,removePriorValues:n,tournamentRecord:r,drawDefinition:a,disableNotice:s,matchUpId:l,timeItem:{itemType:o0,itemValue:p}})}function Ohe({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,timeModifiers:r,matchUpId:a,matchUp:s}){let o="addMatchUpTimeModifiers";if(!a)return ce({result:{error:eo},stack:o});if(r!==void 0&&!Array.isArray(r))return ce({info:Xy("timeModifiers"),result:{error:Ee},stack:o});if(!s){let d=Qn({drawDefinition:i,matchUpId:a});if(d.error)return ce({result:d,stack:o});s=d.matchUp}let l=xhe({matchUp:s}).timeModifiers||[],u=r.filter(d=>!l.includes(d));if(r.length&&!u.length)return{...le};if(u.some(d=>EG.includes(d))){l=l.filter(p=>!EG.includes(p));let d=Rv({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return ce({result:d,stack:o})}let c=r?.length?[...u,...l]:void 0;return xl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:EL,itemValue:c}})}function RF({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a}){if(!a)return{error:eo};let s=t&&Op.test(t);if(t&&!s)return{error:ja};let o={itemValue:Pi(t),itemType:s0};return xl({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:o})}function MF({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:s,courtIds:o}){if(!i&&!e)return{error:ot};if(!s)return{error:eo};let l=Qn({drawDefinition:n,matchUpId:s});if(l.error)return l;if(l?.matchUp?.matchUpType!==uu)return{error:rl};if(!(o===void 0||Array.isArray(o)&&o.length&&o.every(c=>typeof c=="string")))return{error:Ee,context:{courtIds:o}};let u;if(o){let c=e||i&&{[i.tournamentId]:i},d=Wm({tournamentRecords:c});if(d.error)return d;let p=d.courts?.filter(h=>o.includes(h.courtId));if(p?.length!==o.length)return{error:Ee,context:{courtIds:o}};u=p?.map(h=>({venueId:h.venueId,courtId:h.courtId}))}return xl({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:s,timeItem:{itemType:Qh,itemDate:a,itemValue:u}})}function ID({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,venueId:s}){if(!i)return{error:ot};if(!a)return{error:eo};if(s){let o=mf({tournamentRecords:e,tournamentRecord:i,venueId:s});if(o.error)return o}return xl({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:a0,itemValue:s}})}function S0({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:s,courtId:o}){if(!i&&!e)return{error:ot};if(!s)return{error:eo};if(o){let l=c0({tournamentRecords:e,tournamentRecord:i,courtId:o});if(l.error)return l;let u=l.venue?.venueId;ID({tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:s,venueId:u})}return xl({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:s,timeItem:{itemType:Xg,itemDate:a,itemValue:o}})}function wp(t,e){let i=Aoe.test(t)?t:Jn(t),n=Pi(t)||Pi(e)||Vc(new Date);return new Date(`${n}T${i}`).getTime()}function NF(t){let e="addMatchUpScheduleItems",i=zt(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[Go]:Qo}],e);if(i.error)return i;let{matchUpDependencies:n,inContextMatchUps:r}=t,{errorOnAnachronism:a=!1,checkChronology:s=!0,removePriorValues:o,tournamentRecords:l,tournamentRecord:u,drawDefinition:c,disableNotice:d,drawMatchUps:p,matchUpId:h,schedule:f,event:m}=t,g,v;if(p)g=p.find(A=>A.matchUpId===h);else{let A=Qn({drawDefinition:c,event:m,matchUpId:h});if(A.error)return A;g=A.matchUp}let{endTime:y,courtId:b,courtIds:I,courtOrder:S,resumeTime:w,homeParticipantId:T,scheduledDate:U,scheduledTime:C,startTime:E,stopTime:P,timeModifiers:M,venueId:R}=f;s&&(!n||!r)&&({matchUpDependencies:n,matchUps:r}=gd({drawDefinition:c}));let N=n?.[h]?.matchUpIds;if(f.scheduledDate&&s&&N){let A=r?.filter(_=>(_.schedule?.scheduledDate||Pi(_.schedule?.scheduledTime))&&N.includes(_.matchUpId)).map(({schedule:_})=>{let x=lk(_);return new Date(x).getTime()});if(A?.length){let _=lk(f),x=new Date(_).getTime();if(Math.max(...A)>=x){if(a)return ce({result:{error:uG},stack:e});v=uG}}}if(U!==void 0){let A=RF({disableNotice:!0,removePriorValues:o,tournamentRecord:u,drawDefinition:c,scheduledDate:U,matchUpId:h});if(A?.error)return ce({result:A,stack:e,context:{scheduledDate:U}})}if(C!==void 0){let A=Rv({disableNotice:!0,removePriorValues:o,tournamentRecord:u,drawDefinition:c,scheduledTime:C,matchUpId:h,matchUp:g});if(A?.error)return ce({result:A,stack:e,context:{scheduledTime:C}})}if(E!==void 0){let A=C5({disableNotice:!0,removePriorValues:o,tournamentRecord:u,drawDefinition:c,matchUpId:h,startTime:E,event:m});if(A?.error)return ce({result:A,stack:e,context:{startTime:E}})}if(P!==void 0){let A=M5({disableNotice:!0,removePriorValues:o,tournamentRecord:u,drawDefinition:c,matchUpId:h,stopTime:P,event:m});if(A?.error)return ce({result:A,stack:e,context:{stopTime:P}})}if(w!==void 0){let A=N5({disableNotice:!0,removePriorValues:o,tournamentRecord:u,drawDefinition:c,resumeTime:w,matchUpId:h,event:m});if(A?.error)return ce({result:A,stack:e,context:{resumeTime:w}})}if(y!==void 0){let A=R5({disableNotice:!0,removePriorValues:o,tournamentRecord:u,drawDefinition:c,matchUpId:h,endTime:y,event:m});if(A?.error)return ce({result:A,stack:e,context:{endTime:y}})}if(I!==void 0){let A=MF({disableNotice:!0,removePriorValues:o,tournamentRecord:u,drawDefinition:c,matchUpId:h,courtIds:I});if(A?.error)return ce({result:A,stack:e,context:{courtIds:I}})}if(b!==void 0&&U!==void 0){let A=S0({courtDayDate:U,disableNotice:!0,removePriorValues:o,tournamentRecords:l,tournamentRecord:u,drawDefinition:c,matchUpId:h,courtId:b});if(A?.error)return ce({result:A,stack:e,context:{courtId:b}})}if(R!==void 0){let A=ID({disableNotice:!0,removePriorValues:o,tournamentRecords:l,tournamentRecord:u,drawDefinition:c,matchUpId:h,venueId:R});if(A?.error)return ce({result:A,stack:e,context:{venueId:R}})}if(S!==void 0&&yi(S)){let A=P5({disableNotice:!0,removePriorValues:o,tournamentRecord:u,drawDefinition:c,courtOrder:S,matchUpId:h});if(A?.error)return ce({result:A,stack:e,context:{courtOrder:S}})}if(M!==void 0){let A=Ohe({disableNotice:!0,removePriorValues:o,tournamentRecord:u,drawDefinition:c,timeModifiers:M,matchUpId:h,matchUp:g});if(A?.error)return ce({result:A,stack:e,context:{timeModifiers:M}})}return Xn(T)&&E5({disableNotice:!0,homeParticipantId:T,removePriorValues:o,tournamentRecord:u,drawDefinition:c,matchUpId:h}),d||Zi({tournamentId:u?.tournamentId,eventId:m?.eventId,context:e,drawDefinition:c,matchUp:g}),v?{...le,warnings:[v]}:{...le}}function P5({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,courtOrder:r,matchUpId:a}){if(!a)return{error:eo};if(r&&!yi(r))return{error:Ee,info:"courtOrder must be numeric"};let s=r&&ri(r);return xl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:DL,itemValue:s}})}function Lhe({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,participantId:r,officialType:a,matchUpId:s}){if(!s)return{error:eo};if(!r)return{error:la};if(e){let l=dr({tournamentRecord:e,participantFilters:{participantTypes:[ji],participantRoles:[SW]}}).participants??[];if(!qg({tournamentParticipants:l,participantId:r}))return{error:Nr}}let o={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:r};return a&&(o.itemSubTypes=[a]),xl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:s,timeItem:o})}function C5({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,startTime:a,event:s}){if(!r)return{error:eo};if(!ZU(a))return{error:Dc};let{matchUp:o}=Qn({drawDefinition:i,event:s,matchUpId:r}),{scheduledDate:l}=u0({matchUp:o}),u=(o?.timeItems??[]).filter(c=>[nm,Ah,ym].includes(c?.itemType)).map(c=>wp(c.itemValue,l)).reduce((c,d)=>!c||d<c?d:c,void 0);if(!u||wp(a,l)<u){o?.timeItems&&(o.timeItems=o.timeItems.filter(d=>d.itemType!==Ed));let c=e0(a,!0,!0);return xl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemType:Ed,itemValue:c}})}else return{error:noe}}function R5({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,endTime:s,event:o}){if(!a)return{error:eo};if(!ZU(s))return{error:Dc};let{matchUp:l}=Qn({drawDefinition:n,event:o,matchUpId:a}),{scheduledDate:u}=u0({matchUp:l}),c=(l?.timeItems??[]).filter(d=>[Ed,Ah,nm].includes(d?.itemType)).map(d=>wp(d.itemValue,u)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!c||wp(s,u)>c){l?.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==ym));let d=e0(s,!0,!0);return xl({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:ym,itemValue:d}})}else return{error:toe}}function M5({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,stopTime:a,event:s}){if(!r)return{error:eo};if(!ZU(a))return{error:Dc};let{matchUp:o}=Qn({drawDefinition:i,event:s,matchUpId:r}),{scheduledDate:l}=u0({matchUp:o}),u=o?.timeItems??[];if(u.reduce((f,m)=>m.itemType===ym||f,void 0))return{error:Yq};let c=u.filter(f=>[Ed,Ah,nm].includes(f?.itemType)).sort((f,m)=>wp(f.itemValue,l)-wp(m.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===nm,h=c.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>wp(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(wp(a,l)>h){if(o?.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:e0(a,!0,!0),itemType:nm};return xl({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:f})}else return{error:ioe}}function N5({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,resumeTime:r,matchUpId:a,event:s}){if(!a)return{error:eo};if(!ZU(r))return{error:Dc};let{matchUp:o}=Qn({drawDefinition:i,event:s,matchUpId:a}),{scheduledDate:l}=u0({matchUp:o}),u=o?.timeItems??[];if(u.reduce((f,m)=>m.itemType===ym||f,void 0))return{error:Yq};let c=u.filter(f=>[Ed,Ah,nm].includes(f?.itemType)).sort((f,m)=>wp(f.itemValue,l)-wp(m.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===Ah,h=c.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>wp(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(wp(r,l)>h){if(o?.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:e0(r,!0,!0),itemType:Ah};return xl({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:f})}else return{error:IAe}}function $Be(t){let{targetData:e,matchUpsMap:i}=t,{targetMatchUps:{loserMatchUp:n}}=e,r=$s(n?.matchUpStatus),a=!!i?.drawMatchUps.find(s=>s.loserMatchUpId===n?.matchUpId&&$s(s.matchUpStatus));return a&&n?.matchUpStatus===cr||a&&r}function BBe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:n,dualMatchUp:r,tieFormat:a,structure:s,matchUp:o,event:l,score:u}){let c=Ct(r,void 0,!0);for(let p of c?.tieMatchUps||[])p.matchUpId===o.matchUpId&&(p.winningSide=n,p.score=u,!ca({score:u})&&!e?Object.assign(p,{...jL}):e&&(p.matchUpStatus=e));a=a??Zs({matchUp:o,structure:s,drawDefinition:t,event:l})?.tieFormat;let{winningSide:d}=AR({matchUp:c,drawDefinition:t,matchUpsMap:i,structure:s,tieFormat:a,event:l});return{projectedWinningSide:d}}function VBe(t){let{tournamentRecord:e,inContextMatchUp:i,structure:n,drawDefinition:r}=t,a=i.roundNumber,s=i.sides.find(S=>S.sideNumber===i.winningSide),o=i.sides.find(S=>S.sideNumber!==i.winningSide),{drawPosition:l,participantId:u}=s,{drawPosition:c,participantId:d}=o,p="swapWinnerLoser",{matchUps:h}=cn(t),f=h.filter(({drawPositions:S,roundNumber:w})=>S?.includes(l)&&w>a);du({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:f}),f.forEach(S=>{S.drawPositions=S.drawPositions?.map(w=>w===l?c:w)||[],Zi({tournamentId:e?.tournamentId,eventId:t.event?.eventId,context:p,drawDefinition:r,matchUp:S})});let{stage:m,stageSequence:g}=n,v=r.structures.filter(({stage:S,stageSequence:w})=>S===m&&w>g).map(({structureId:S})=>S),{targetLinks:{loserTargetLink:y,winnerTargetLink:b}}=t.targetData,I=[y?.target.structureId,b?.target?.structureId].filter(Boolean);return r.structures.filter(({stage:S,structureId:w})=>S!==m&&I.includes(w)).forEach(({stage:S,stageSequence:w,structureId:T})=>{v.includes(T)||v.push(T),r.structures.filter(({stage:U,stageSequence:C})=>U===S&&C>w).forEach(({structureId:U})=>{v.includes(U)||v.push(U)})}),r.structures.filter(({structureId:S})=>v.includes(S)).forEach(S=>{let{positionAssignments:w}=Nn({structure:S}),T=w?.find(({participantId:C})=>C===u),U=w?.find(({participantId:C})=>C===d);T&&(T.participantId=d),U&&(U.participantId=u)}),Pp({...t})}function wD(t){let e="setMatchUpStatus";t.matchUpStatus&&[ir,cr].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:n,propagateExitStatus:r,tournamentRecords:a,tournamentRecord:s,disableAutoCalc:o,enableAutoCalc:l,drawDefinition:u,matchUpStatus:c,winningSide:d,matchUpId:p,event:h,score:f}=t;if(!u)return{error:Ot};if(c&&[nh,_l,al,Er].includes(c)&&d)return{error:Ee,winningSide:d,matchUpStatus:c};if(![void 0,...L3].includes(c))return ce({result:{error:zU},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let m=us({drawDefinition:u}),{matchUps:g}=Kr({nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:m,event:h}),v=m.drawMatchUps.find(G=>G.matchUpId===p),y=g?.find(G=>G.matchUpId===p);if(!v||!g)return{error:Vs};if((v.winningSide||d)&&c==="BYE")return{context:"Cannot have Bye with winningSide",error:i_,matchUpStatus:c};let b=y?.structureId,{structure:I}=li({drawDefinition:u,structureId:b}),S=_r(Hn)(v.matchUpType),w=y?.drawPositions?.filter(Boolean),T=y?.matchUpTieId,U=vo({matchUpId:T||p,inContextDrawMatchUps:g,drawDefinition:u});Object.assign(t,{inContextDrawMatchUps:g,inContextMatchUp:y,matchUpTieId:T,matchUpsMap:m,targetData:U,structure:I,matchUp:v});let C=c===Er&&f?.scoreStringSide1===""&&f?.scoreStringSide2===""&&!d;if($Be(t)&&C)return{error:uAe};let E=Qy(t),P;if(S){if(o)un({extension:{name:cw,value:!0},element:v});else if(l){let G=v.winningSide,{winningSide:W,scoreStringSide1:q,scoreStringSide2:Z,set:K}=AR({drawDefinition:u,matchUpsMap:m,structure:I,matchUp:v,event:h}),Q={scoreStringSide1:q,scoreStringSide2:Z,sets:K?[K]:[]};if(P=W!==G,E&&P)return ce({stack:"winningSideWithDownstreamDependencies",result:{error:jO},context:{winningSide:d,matchUp:v}});lo({name:cw,element:v}),Object.assign(t,{winningSide:W,dualWinningSideChange:P,projectedWinningSide:W,score:Q})}_R({tournamentId:s?.tournamentId,inContextDualMatchUp:y,eventId:h?.eventId,dualMatchUp:v,drawDefinition:u})}if(S&&c&&[i0].includes(c))return{info:"Not supported for matchUpType: TEAM",error:Ee};if(f&&!S&&!n){let G=v.matchUpFormat??I?.matchUpFormat??u?.matchUpFormat??h?.matchUpFormat,W=S4({existingMatchUpStatus:v.matchUpStatus,matchUpFormat:G,matchUpStatus:c,winningSide:d,score:f});if(W.error)return W}let M=sn({policyTypes:[cC,Ku],tournamentRecord:s,drawDefinition:u,event:h})?.appliedPolicies??{};Ki(t.policyDefinitions)&&Object.assign(M,t.policyDefinitions);let R=GBe({assignedDrawPositions:w,propagateExitStatus:r,inContextMatchUp:y,appliedPolicies:M,drawDefinition:u,matchUpStatus:c,structure:I,matchUp:v});if(R?.error)return R;let N=y?.stage===qt&&y.finishingRound===1,A=N&&d,_=N&&v.winningSide&&!d&&(!t.matchUpStatus||t.matchUpStatus&&MG({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!ca({outcome:t.outcome})),x=A&&d!==v.winningSide&&v.winningSide;if(Object.assign(t,{qualifierAdvancing:A,qualifierChanging:x,removingQualifier:_,appliedPolicies:M}),T){let{matchUp:G}=Qn({matchUpId:T,inContext:!0,drawDefinition:u,matchUpsMap:m,event:h});if(G){let W=Zs({matchUp:G,drawDefinition:u,structure:I,event:h})?.tieFormat,{projectedWinningSide:q}=BBe({drawDefinition:u,matchUpStatus:c,dualMatchUp:G,matchUpsMap:m,winningSide:d,tieFormat:W,structure:I,matchUp:v,event:h,score:f}),Z=G.winningSide;P=q!==Z;let K=G._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:P,projectedWinningSide:q,autoCalcDisabled:K,matchUpTieId:T,dualMatchUp:G,tieFormat:W})}}let O=yR({matchUpStatus:c});if(!T){if(E&&!d&&(c&&MG({matchUpStatus:c})||c&&[cr,sa].includes(c)))return{error:i_,activeDownstream:E,winningSide:d};if(d&&d===v.winningSide&&c&&!O)return{context:"winningSide must include directing matchUpStatus",error:i_,directingMatchUpStatus:O,matchUpStatus:c}}let{schedule:$}=t;if($){let G=NF({disableNotice:!0,tournamentRecords:a,tournamentRecord:s,drawDefinition:u,matchUpId:p,schedule:$});if(G.error)return G}let F=!S&&!P&&d&&v.winningSide&&v.winningSide!==d;if(i&&F&&v.roundPosition)return VBe(t);let j=d&&!T||t.projectedWinningSide;Dl({activeDownstream:E,matchUpWinner:j,method:e,winningSide:d});let H=!E&&FBe(t)||j&&jBe(t)||(O||t.autoCalcDisabled)&&Fhe(t)||{error:doe};return ce({result:H,stack:e})}function jBe(t){let{matchUp:e,winningSide:i,matchUpTieId:n,dualWinningSideChange:r}=t;return i===e.winningSide||n&&!r?Fhe(t):ce({stack:"winningSideWithDownstreamDependencies",result:{error:jO},context:{winningSide:i,matchUp:e}})}function Fhe(t){let{tournamentRecord:e,matchUp:i,event:n}=t,r=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!ca({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||r&&Er||t.winningSide&&Ur||_l:t.matchUpStatus||Ur,s=t.removeScore||[nh,ir].includes(a)&&![_l,al].includes(a),o=Pp({...t,matchUpStatus:a,removeWinningSide:r,removeScore:s});if(o.error)return o;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:u,matchUpsMap:c}=t,d=qm({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:u,matchUpsMap:c,event:n});if(d.error)return d;Object.assign(o,{tieMatchUpResult:d})}return o}function GBe({assignedDrawPositions:t,propagateExitStatus:e,inContextMatchUp:i,appliedPolicies:n,drawDefinition:r,matchUpStatus:a,structure:s,matchUp:o}){if(n?.[Ku]?.requireParticipantsForScoring===!1)return{...le};let l=i?.sides?.map(d=>d.participantId).filter(Boolean).length,u=o?.sides?[]:Nn({structureId:s?.structureId,drawDefinition:r}).positionAssignments,c=l&&l===2||o.collectionId&&Fo({structure:s})&&l&&l>=1||t?.length===2&&u?.filter(d=>t.includes(d.drawPosition)).every(d=>d.participantId);return a&&[ir,On,cr].includes(a)&&l===1&&e?{...le}:a&&O3.includes(a)&&!c?ce({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:a,requiredParticipants:c},result:{error:zU}}):{...le}}function $he({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n}){if(!e)return{error:Ot};let{matchUp:r}=Qn({drawDefinition:e,matchUpId:i,event:n});return r?.matchUpType!==uu?{error:rl}:wD({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n})}function Bhe({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:Ot};if(!i)return{error:eo};let{matchUp:n}=Qn({drawDefinition:t,event:e,matchUpId:i});return n?lo({name:hL,element:n}):{error:Vs}}function HBe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:n,sideNumber:r,matchUpId:a,event:s}){let o="substituteParticipant";if(!n)return{error:Ot};if(!a)return{error:eo};if(!e||!t)return ce({result:{error:la},stack:o});let{matchUp:l}=Qn({drawDefinition:n,matchUpId:a,event:s});if(!l)return{error:Vs};if(!l.collectionId)return ce({result:{error:rl},stack:o});let u=us({drawDefinition:n}),{matchUps:c}=Kr({tournamentParticipants:i?.participants,inContext:!0,drawDefinition:n,matchUpsMap:u}),d=c?.find(h=>h.matchUpId===a),p=c?.find(h=>h.matchUpId===d?.matchUpTieId)?.sides?.find(h=>h.participant.individualParticipants.some(({participantId:f})=>f===e));return!p||r&&p.sideNumber!==r?{error:Bd}:p.participant?.individualParticipants?.map(Vi).filter(h=>h!==e)?.includes(t)?U5({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:n,event:s}):ce({result:{error:Bd},stack:o})}function Vhe(t){return HBe(t)}function jhe({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:Ot};let{matchUp:n}=Qn({drawDefinition:t,matchUpId:e,event:i});return un({extension:{name:cw,value:!0},element:n})}function Ghe(t){let e="setMatchUpFormat",i=zt(t,[{tournamentRecord:!0},{[gs]:S=>Ml({matchUpFormat:S}),[pu]:V1,matchUpFormat:!0}]);if(i.error)return ce({result:i,stack:e});let{tournamentRecord:n,drawDefinition:r,scheduledDates:a,stageSequences:s,matchUpFormat:o,structureId:l,eventType:u,matchUpId:c,eventId:d,stages:p,drawId:h,event:f,force:m}=t;if(a&&!Array.isArray(a))return ce({result:{error:Ee,scheduledDates:a},stack:e});if(u&&!xO([Lp,Yu],u))return ce({result:{error:Hh},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],b=t.drawIds||h&&[h].filter(Boolean)||[];if((l||v?.length)&&!r)return ce({result:{error:Ot},stack:e});if(h&&c&&r){let S=E4({tournamentRecord:n,drawDefinition:r,matchUpFormat:o,structureIds:v,structureId:l,matchUpId:c});if(S.error)return S;g+=1}let I=S=>{let w=[];for(let T of S.structures||[]){if(Array.isArray(p)&&!p.includes(T.stage)||Array.isArray(s)&&!s.includes(T.stageSequence)||v?.length&&!v.includes(T.structureId))continue;v?.length&&T.matchUpFormat!==o&&(T.matchUpFormat=o,w.push(T.structureId),g+=1);let U=((m||a)&&cn({matchUpFilters:{matchUpStatuses:[Er]},structure:T}).matchUps)??[],C=(a&&cn({matchUpFilters:{matchUpStatuses:[Er]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:T}).matchUps)??[];if(U?.length){let E=C?C.map(Ma):U.map(Ma);for(let P of U)E.includes(P.matchUpId)&&(P.matchUpFormat=a?.length?o:void 0,Zi({tournamentId:n?.tournamentId,eventId:f?.eventId,context:e,drawDefinition:S,matchUp:P}))}}return!w.length&&S.matchUpFormat!==o&&(S.matchUpFormat=o,g+=1),w};for(let S of n?.events||[])if(!(y?.length&&!y.includes(S.eventId)||u&&u!==S.eventType||u===na))if(Array.isArray(s)||Array.isArray(p)||v?.length||b?.length)for(let w of S.drawDefinitions||[]){if(Array.isArray(b)&&!b.includes(w.drawId))continue;let T=I(w);Ln({structureIds:T,drawDefinition:w})}else S.matchUpFormat!==o&&(S.matchUpFormat=o,g+=1);return g?{...le,modificationsCount:g}:{...le,info:KU}}function A5({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}){if(!i)return{error:Ot};let a=Qn({drawDefinition:i,matchUpId:n})?.matchUp;if(!a?.tieMatchUps)return{error:rl};let s=Qn({inContext:!0,drawDefinition:i,matchUpId:n,event:r})?.matchUp,o=0;return(a?.sides||[]).forEach(l=>{l.lineUp&&delete l.lineUp}),(s?.sides||[]).forEach(l=>{if(o+=1,t===!1){let u=s?.tieFormat,c=l.participantId;u&&c&&m0({drawDefinition:i,participantId:c,lineUp:[],tieFormat:u})}Zi({tournamentId:e?.tournamentId,context:"resetMatchUpLineUps",eventId:r?.eventId,drawDefinition:i,matchUp:a})}),{...le,modificationsCount:o}}function Hhe(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r,setTBlast:a}=t;if(!r)return{sets:[]};let s=r.sets||[],o=kh({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),l=kh({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),u=kh({matchUpFormat:e,matchUpStatus:i,winningSide:n,setTBlast:a,sets:s}),c=o===u?l:o;return n&&(o=n===1?u:c,l=n===2?u:c),{score:{sets:s,scoreStringSide1:o,scoreStringSide2:l}}}function zBe({sourceMatchUpStatusCodes:t,propagateExitStatus:e,sourceMatchUpStatus:i,loserParticipantId:n,tournamentRecord:r,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,event:l}){let u="progressExitStatus";Dl({matchUpId:s?.matchUpId,matchUpStatus:i,color:"magenta",method:u});let c=$s(i)&&i!==_a&&i||ir,d=Kr({inContext:!0,drawDefinition:a,matchUpsMap:o})?.matchUps,p=c,h=d?.find(f=>f.matchUpId===s?.matchUpId);if(h?.matchUpId&&p){let f,m=h.matchUpStatusCodes?.map(y=>typeof y=="string"?y:"WO")??[],g=h.sides?.find(y=>y.participantId===n);if(g?.sideNumber)if(h?.sides?.reduce((y,b)=>b?.participantId?y+1:y,0)===1&&m.length===0)f=g.sideNumber===1?2:1,m[0]=t[0];else if(!$s(s.matchUpStatus))f=g.sideNumber===1?2:1,m[0]=t[0];else{let y=m[0];m[g.sideNumber-1]=t[0];let b=g.sideNumber===1?2:1;m[b-1]=y,p=cr,f=void 0}let v=wD({matchUpStatus:p,matchUpId:s.matchUpId,matchUpStatusCodes:m,allowChangePropagation:!0,propagateExitStatus:e,tournamentRecord:r,drawDefinition:a,winningSide:f,event:l});return ce({result:v,stack:u,context:{progressExitStatus:!0}})}return ce({result:{error:Oo},stack:u})}function YR(t){let e=zt(t,[{[th]:!0,[zs]:!0}]);if(e.error)return e;let i="setMatchUpStatus",n=ic(t);if(!t.drawDefinition){let S=t.tournamentRecord??(t.tournamentId&&n[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=S);let w=$o({eventId:t.eventId,drawId:t.drawId,tournamentRecord:S});if(w.error)return w;w.drawDefinition&&(t.drawDefinition=w.drawDefinition),t.event=w.event}let{disableScoreValidation:r,propagateExitStatus:a,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpId:d,schedule:p,event:h,notes:f}=t,m=t.matchUpFormat||t.outcome?.matchUpFormat,{policy:g}=Cb({policyType:Ku,tournamentRecord:o,event:h}),v=t.allowChangePropagation!==void 0&&t.allowChangePropagation||g?.allowChangePropagation!==void 0&&g.allowChangePropagation||void 0,{outcome:y,setTBlast:b}=t;if(y?.winningSide&&![1,2].includes(y.winningSide))return{error:BO};if(m){let S=E4({tournamentRecord:o,drawDefinition:c,matchUpFormat:m,matchUpId:d,event:h});if(S.error)return S}if(y?.score?.sets&&!y.score.scoreStringSide1){let{score:S}=Hhe({...y,setTBlast:b});y.score=S,y.score.sets=y.score.sets.filter(w=>w.side1Score||w.side2Score||w.side1TiebreakScore||w.side2TiebreakScore)}let I=wD({matchUpStatusCodes:y?.matchUpStatusCodes,matchUpStatus:y?.matchUpStatus,winningSide:y?.winningSide,allowChangePropagation:v,disableScoreValidation:r,score:y?.score,propagateExitStatus:a,tournamentRecords:n,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpFormat:m,matchUpId:d,schedule:p,event:h,notes:f});if(I.context?.progressExitStatus){let S=!0,w=0;for(;S&&w<10;){S=!1,w+=1;let T=zBe({sourceMatchUpStatusCodes:I.context.sourceMatchUpStatusCodes,sourceMatchUpStatus:I.context.sourceMatchUpStatus,loserParticipantId:I.context.loserParticipantId,propagateExitStatus:t.propagateExitStatus,tournamentRecord:t.tournamentRecord,loserMatchUp:I.context.loserMatchUp,matchUpsMap:I.context.matchUpsMap,drawDefinition:t.drawDefinition,event:t.event});T.context?.loserMatchUp&&(Object.assign(I.context,T.context),S=!0)}}return ce({result:I,stack:i})}function zhe(t){if(!t?.outcomes)return{error:Zt};if(!Array.isArray(t.outcomes))return{error:Zt,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],n=i.reduce((r,a)=>r.includes(a.tournamentId)?r:r.concat(a.tournamentId),[]);for(let r of n){let a=e[r];if(!a)return{error:ot};let s=i.filter(o=>o.tournamentId===r);if(s.length){let o=qBe({outcomes:s,tournamentRecord:a});if(o.error)return o}}return{...le}}function qBe(t){let{tournamentRecords:e,tournamentRecord:i,outcomes:n,policyDefinitions:r}=t,a={};n.forEach(s=>{let{eventId:o}=s;a[o]||(a[o]=[]),a[o].push(s)});for(let s of Object.keys(a)){let{event:o}=$o({tournamentRecord:i,eventId:s});for(let l of a[s]){let{drawId:u}=l,c=o?.drawDefinitions?.find(d=>d.drawId===u);if(c&&u){let{matchUpFormat:d,matchUpId:p}=l,h=YR({schedule:l?.schedule,tournamentRecords:e,policyDefinitions:r,tournamentRecord:i,drawDefinition:c,matchUpFormat:d,matchUpId:p,outcome:l,drawId:u,event:o});if(h.error)return h}}}return{...le}}function WBe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:n}){if(!n&&!t)return{error:Ot};if(!i)return{error:Zt,info:"missing outcome"};if(!n&&!e)return{error:Oo};if(!n){let r=Qn({drawDefinition:t,matchUpId:e});if(r.error)return r;n=r.matchUp}return typeof i!="object"||!i.score?.scoreStringSide1||!i.score?.scoreStringSide2?{error:Ee}:un({element:n,extension:{name:hL,value:i}})}function qhe(t){return WBe(t)}function _5(t){let e="resetTieFormat",{drawDefinition:i,event:n,uuids:r}=t,a=zt(t,[{[ha]:!0,[th]:!0}],e);if(a.error)return a;let s=fD(t,[{[JU]:hf}]);if(s[Gc])return s;let o=t.tournamentRecord?.tournamentId,{matchUp:l,structure:u}=s?.matchUp??{};if(!l?.tieMatchUps)return ce({result:{error:rl},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...le};let c=Zs({structure:u,drawDefinition:i,event:n})?.tieFormat;if(!c)return ce({result:{error:Ya},info:"No inherited tieFormat",stack:e});let d=[],p=[],h=[],f=[];for(let m of c.collectionDefinitions){let{matchUpCount:g,collectionId:v}=m;p.push(v);let y=(l.tieMatchUps||[]).filter(b=>b.collectionId===v);if(y.length>g)y.sort((b,I)=>(b.matchUpStatus===Er?1:0)-(I.matchUpStatus===Er?1:0)),h.push(...y.slice(0,g)),d.push(...y.slice(3).map(Ma));else if(h.push(...y),y.length<g){let b=g-y.length,I=RR({collectionDefinition:m,matchUpsLimit:b,matchUp:l,uuids:r});f.push(...I)}}for(let m of l?.tieMatchUps||[])m.collectionId&&!p.includes(m.collectionId)&&d.push(m.matchUpId);return f.length&&(h.push(...f),Yg({eventId:n?.eventId,matchUps:f,drawDefinition:i,tournamentId:o})),d.length&&ff({matchUpIds:d,eventId:n?.eventId,drawDefinition:i,tournamentId:o}),l&&(l.tieMatchUps=h,l.tieFormatId=void 0,l.tieFormat=void 0,Zi({structureId:u?.structureId,eventId:n?.eventId,context:e,drawDefinition:i,tournamentId:o,matchUp:l})),{...le,newMatchUps:f,deletedMatchUpIds:d}}function k5(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}=t,a="resetScorecard";if(!i)return ce({result:{error:Ot},stack:a});if(!n)return ce({result:{error:eo},stack:a});if(!Xn(n))return ce({result:{error:Ee,matchUpId:n},stack:a});let s=us({drawDefinition:i}),{matchUps:o}=Kr({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:s}),l=s.drawMatchUps.find(m=>m.matchUpId===n),u=o?.find(m=>m.matchUpId===n);if(!l||!o)return{error:Vs};if(l.matchUpType!==Nl)return{error:rl};let c=vo({inContextDrawMatchUps:o,drawDefinition:i,matchUpId:n}),d=u?.structureId,{structure:p}=li({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:o,inContextMatchUp:u,matchUpsMap:s,targetData:c,structure:p,matchUp:l}),Qy(t))return{error:jO};if(l.tieMatchUps?.length)for(let m of l.tieMatchUps){let g=wD({matchUpId:m.matchUpId,matchUpTieId:n,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:r});if(g.error)return ce({result:g,stack:a})}let h=sn({tournamentRecord:e,drawDefinition:i,event:r})?.appliedPolicies,f=qm({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:h,drawDefinition:i,matchUpsMap:s,matchUpId:n});if(f.error)return ce({result:f,stack:a});if(t.tiebreakReset&&!f.tieFormatRemoved){let m=Zs({drawDefinition:i,structure:p,event:r})?.tieFormat;if(l.tieFormat&&m){let{matchUpCountDifference:g,descendantDifferences:v,ancestorDifferences:y,valueDifference:b}=bm({descendant:l.tieFormat,ancestor:m});if(v.collectionIds.length===1&&!y.collectionIds.length&&!y.groupsCount&&g===1&&b===1){let I=_5({tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r});if(I.error)return I}}}return{...le}}function Whe(t){let e=zt(t,[{[zs]:!0,[Gm]:!0},{[OT]:{[Q1]:!1,roundNumbers:!1},[kle]:"At least one must be provided",[Go]:xs}]);if(e.error)return e;let i=sde(t);if(i.error)return i;let{matchUpIds:n}=i,r=_r(Nl)(t.event.eventType),{tournamentRecord:a,drawDefinition:s,event:o}=t;for(let l of n){if(r){let c=k5({tiebreakReset:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(c.error||t.removeAssignments&&A5({inheritance:!1,drawDefinition:s,matchUpId:l}).error)return c}let u=wD({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(u.error)return u;if(t.removeAssignments){let c=D5({...t,matchUpId:l});if(c.error)return c}}return{...le}}function YBe({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){if(!e)return{error:Ot};let n="setOrderOfFinish";if(!Array.isArray(i))return ce({info:Xy("finishingOrder"),result:{error:Ee},stack:n});let{completedMatchUps:r,matchUpsMap:a}=sD({inContext:!0,drawDefinition:e}),s=r?.map(Ma)??[],o=i.map(Ma),{matchUpTypes:l,roundNumbers:u,structureIds:c,matchUpTieIds:d}=(r??[]).filter(({matchUpId:y})=>o.includes(y)).reduce((y,b)=>{let{matchUpTieId:I,matchUpType:S,roundNumber:w,structureId:T}=b;return y.matchUpTypes.includes(S)||y.matchUpTypes.push(S),y.roundNumbers.includes(w)||y.roundNumbers.push(w),y.structureIds.includes(T)||y.structureIds.push(T),y.matchUpTieIds.includes(I)||y.matchUpTieIds.push(I),y},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||u.length>1||c.length>1)return ce({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:Ee},stack:n});let p,h,f={},m=[],g=[];if(!i.every(({orderOfFinish:y,matchUpId:b})=>(m.push(b),y&&g.push(y),f[b]=y,p=s.includes(b),h=y===void 0||yi(y)&&Math.floor(y)>0,p&&h)))return ce({result:{error:p?Ee:zU},info:!p&&"matchUps must be completed"||!h&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:n});let v=r?.filter(y=>y.structureId===c[0]&&y.roundNumber===u[0]&&y.matchUpType===l[0]&&y.matchUpTieId===d[0]&&!m.includes(y.matchUpId));for(let y of v??[]){let{orderOfFinish:b}=y||{};if(b){if(!yi(b))return ce({context:{orderOfFinish:b,matchUp:y},result:{error:Ee},stack:n});g.push(b)}}if(ese(g).length!==g.length||Math.max(...g)>g.length)return ce({info:"Values not unique or greater than expected number of values",result:{error:Ee},stack:n});if(c.length){let y=AL({matchUpFilters:{matchUpIds:o},structureId:c[0],drawDefinition:e,matchUpsMap:a});if(y.error)return ce({result:y,stack:n});y.completedMatchUps?.forEach(b=>{b.orderOfFinish=f[b.matchUpId],Zi({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:b})})}return{...le}}function Yhe(t){return YBe(t)}function Khe(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:n,lineUps:r,event:a}=t,s="applyLineUps",o=zt(t,[{[ha]:!0,[zs]:!0,[th]:!0},{lineUps:!0,[Go]:xs}],s);if(o.error)return o;let l=e.participants||[],u=Qn({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:n});if(u.error)return u;if(!u.matchUp)return{error:Vs};let{matchUp:c,structure:d}=u,{drawPositions:p,matchUpType:h}=c;if(h!==Hn)return{error:rl};if(!p?.length)return{error:$1};let f=Zs({matchUp:c,drawDefinition:i,structure:d,event:a})?.tieFormat,m={};for(let v of r){if(!Array.isArray(v))return{error:Ee,lineUp:v};let y={},b=[];for(let U of v){if(typeof U!="object")return{error:Ee,lineUpAssignment:U};let{participantId:C,collectionAssignments:E=[]}=U;if(!Array.isArray(E))return{error:Ee,collectionAssignments:E};let P=l.find(R=>R.participantId===C);if(!P)return{error:Nr};if(P.participantType!==ji)return{error:Vd};let M=c.sides?.find(R=>R.participant?.individualParticipantIds?.includes(C))?.sideNumber;M&&b.push(M);for(let R of E){if(typeof R!="object")return{error:Ee,collectionAssignment:R};let{collectionId:N,collectionPosition:A}=R,_=f?.collectionDefinitions?.find($=>$.collectionId===N);if(!_)return{error:Ee,collectionId:N};let x=`${N}-${A}`;y[x]||(y[x]=[]);let O=y[x].length;if(_r(Rn)(_.matchUpType)&&O||_.matchUpType===Dn&&O>1)return{info:"Excessive collectionPosition assignments",error:Ee};y[x].push(C)}}let I=Object.values(y);for(let U of I)if(U.length===2){let{participant:C}=ad({tournamentParticipants:l,participantIds:U});if(!C){let E=jp({participant:{participantType:Ni,participantRole:bs,individualParticipantIds:U},pairOverride:!0,tournamentRecord:e});if(E.error)return E}}let S=Rl(b),w=(S[1]||0)>(S[2]||0)&&1||(S[2]||0)>(S[1]||0)&&2||void 0,T=Object.keys(m).map(U=>parseInt(U));w&&!T.includes(w)&&(m[w]=v)}if(!Object.keys(m).length)return{error:Qq};if(u=Qn({drawDefinition:i,matchUpId:n}),u.error)return u;if(!u.matchUp)return{error:Vs};let{matchUp:g}=u;g.sides||(g.sides=[]);for(let v of[1,2]){let y=g.sides.find(I=>I.sideNumber===v),b=m[v];if(b)y?y.lineUp=b:g.sides.push({lineUp:b,sideNumber:v});else continue}return Zi({tournamentId:e?.tournamentId,context:s,drawDefinition:i,matchUp:g}),{...le}}var AF={};Fi(AF,{anonymizeTournamentRecord:()=>yfe,generate:()=>Zhe,generateEventWithDraw:()=>LF,generateOutcome:()=>j5,generateOutcomeFromScoreString:()=>x5,generateParticipants:()=>SD,generateTournamentRecord:()=>gfe,modifyTournamentRecord:()=>bfe,mutate:()=>vfe});var Zhe={};Fi(Zhe,{generateEventWithDraw:()=>LF,generateOutcome:()=>j5,generateOutcomeFromScoreString:()=>x5,generateParticipants:()=>SD,generateTournamentRecord:()=>gfe});function x5(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,scoreString:r,setTBlast:a}=t;if(!r)return{outcome:{...jL,winningSide:n,matchUpStatus:i}};if(n&&![1,2,void 0].includes(n))return{error:Ee,winningSide:n};let s=r&&Rk({scoreString:r}),o={},l=kh({sets:s,matchUpFormat:e,setTBlast:a}),u=kh({sets:s,reversed:!0,matchUpFormat:e,setTBlast:a});return n===2?(o.scoreStringSide1=u,o.scoreStringSide2=l):(o.scoreStringSide1=l,o.scoreStringSide2=u),o.sets=Rk({scoreString:o.scoreStringSide1}),Vt({outcome:{matchUpStatus:i,winningSide:n,score:o}})}function O5({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:n}){let r=(e?.[n.matchUpId]?.matchUpIds||[]).filter(a=>i.includes(a)).filter(a=>!t[a]);return{dependenciesScheduled:!r?.length,remainingDependencies:r}}function KR({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function KBe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:n,drawId:r}){t[i].potentialRecovery[r]||(t[i].potentialRecovery[r]=[]),t[i].potentialRecovery[r].push(e),t[i].potentialBookings[r]||(t[i].potentialBookings[r]=[]),t[i].potentialBookings[r].push({timeAfterRecovery:e,scheduleTime:n})}function EC({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:n=0,matchUpNotBeforeTimes:r,matchUpDependencies:a,recoveryMinutes:s=0,scheduleTime:o,matchUp:l}){let u=Jn(l?.schedule?.endTime),c=u?tl(u,ri(s)):tl(o,ri(n)+ri(s)),d=i&&(u?tl(Jn(u),i):tl(o,ri(n)+ri(i))),p=a?.[l.matchUpId]?.participantIds||[],h=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(f=>{KR({individualParticipantProfiles:e,participantId:f});let m=e[f].priorMatchUpType!==l.matchUpType&&d||c;h.includes(f)?KBe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:m,participantId:f,scheduleTime:o}):(e[f].timeAfterRecovery=m,e[f].bookings.push({scheduleTime:o,timeAfterRecovery:m}))}),HT({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:r,timeAfterRecovery:c,matchUp:l})}function Xhe({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:n,details:r}){let a,s=r.minutesMap?.[n]?.recoveryMinutes,o=(r.minutesMap?.[n]?.averageMinutes||0)+(s||0),l=tl(i,o),u=e?.[n]?.dependentMatchUpIds||[];if(u.length){let c=u.reduce((d,p)=>{let h=t[p];if(!h)return d;let f={scheduleTime:h,matchUpId:p};return h&&!d.matchUpId||rn(h)<rn(d.scheduleTime)?f:d},{});c.scheduleTime&&rn(l)>rn(c.scheduleTime)&&(a=c)}return{scheduledDependent:a}}function ZBe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(n=>i===Dn&&(n?.participant?.individualParticipants||[])||n?.participant&&[n.participant]||[]).flat()}var ZR="DO_NOT_SCHEDULE",Jhe={DO_NOT_SCHEDULE:ZR};function L5({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:n,scheduleTime:r,scheduleDate:a,matchUp:s}){let o=ZBe(s).map(({person:h})=>h?.personId);if(i){let h=(s?.potentialParticipants||[]).flat().map(({person:f})=>f?.personId);o.push(...h)}let l=o.map(h=>n[h]?.map(f=>({...f,personId:h}))).filter(Boolean).flat().filter(h=>h.requestType===ZR&&zh(a,h.date)),u=[],c=s?.matchUpId,d=zr(Jn(r),Pi(a)),p=Jn(p3(d,t).toISOString());for(let h of l){let{requestId:f,startTime:m,endTime:g}=h;(r>m&&r<g||p>m&&p<g)&&(u.push({matchUpId:c,request:h,scheduleTime:r}),e[f]?(e[f].scheduleTimes.includes(r)||e[f].scheduleTimes.push(r),e[f].matchUpIds.includes(c)||e[f].matchUpIds.push(c)):e[f]={request:h,scheduleTimes:[r],matchUpIds:[c]})}return{conflicts:u}}function XG({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:n}){let{matchUpType:r}=i,{individualParticipantIds:a}=wL(i),s=(t[i.matchUpId]||[]).filter(o=>!mo(o,a)).flat();[...a,...s].forEach(o=>{if(KR({individualParticipantProfiles:e,participantId:o}),!e[o].potentialCounted[i.drawId]){let l=e[o].counters;l[r]?l[r]+=n:n>0&&(l[r]=n),l[zc]?l[zc]+=n:n>0&&(l[zc]=n),s.includes(o)&&(e[o].potentialCounted[i.drawId]=!0)}})}function XBe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:n,dateScheduledMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,matchUpDependencies:o,clearScheduleDates:l,scheduleDate:u,minutesMap:c,matchUps:d}){let p=[];i||(r=d?.filter(m=>{let g=m.schedule||{},v=m.matchUpStatus==="BYE";return v&&p.push({tournamentId:m.tournamentId,matchUpId:m.matchUpId}),!v&&GR({schedule:g})&&(!u||m.schedule.scheduledDate===u)}),i=r.map(Ma));let h=Array.isArray(l)?l.includes(u):l,f=h?[]:d.filter(({matchUpId:m})=>i.includes(m));for(let m of f){XG({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:m});let g=m.schedule?.scheduledTime;if(g){s[m.matchUpId]=g;let v=c?.[m.matchUpId]?.recoveryMinutes;EC({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:o,averageMatchUpMinutes:n,recoveryMinutes:v,scheduleTime:g,matchUp:m})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:r,clearDate:h}}function _F({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:n,venueIds:r=[],periodLength:a,scheduleDate:s,matchUps:o}){if(typeof n!="object")return{error:fr};if(!ac(o)&&!Array.isArray(i))return{error:Vm};a=a??DF({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(n).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:h}=sR({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:h}}})).flat()),u={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=o?.filter(d=>{let p=d.schedule;return GR({schedule:p})&&(!s||d.schedule.scheduledDate===s)}));let c=i?.filter(d=>(!r.length||r.includes(d.schedule.venueId))&&d.matchUpStatus!=="BYE");return{bookings:c?.map(({eventId:d,schedule:p,matchUpFormat:h})=>{let{event:f,scheduleTiming:m}=l[d],g=f?.eventType,v={...m,defaultTiming:u,matchUpFormat:h},{averageMinutes:y,recoveryMinutes:b}=CL({timingDetails:v,eventType:g}),{courtId:I,venueId:S}=p,w=Jn(p.scheduledTime),T=tl(w,y);return{recoveryMinutes:b,averageMinutes:y,periodLength:a,startTime:w,courtId:I,endTime:T,venueId:S}}).filter(Boolean),relevantMatchUps:c,dateScheduledMatchUps:i}}function JBe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:n,clearScheduleDates:r,tournamentRecords:a,tournamentRecord:s,periodLength:o,scheduleDate:l,startTime:u,venueIds:c,matchUps:d,endTime:p}){if(s&&!a&&(a={[s.tournamentId]:s}),typeof a!="object"||!Object.keys(a).length)return{error:fr};o=o??DF({recoveryMinutes:i,averageMatchUpMinutes:n});let{courts:h,venues:f}=Wm({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),m=h?.filter(S=>!c||c.includes(S.venueId))??[];u=u??zT({courts:m,scheduleDate:l,startTime:!0}),p=p??zT({courts:m,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=_F({defaultRecoveryMinutes:i,averageMatchUpMinutes:n,tournamentRecords:a,scheduleDate:l,periodLength:o,venueIds:c,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:n,clearScheduleDates:r,date:l,periodLength:o,startTime:u,bookings:g,endTime:p,courts:m},{scheduleTimes:b}=b5(y),I=c?.length===1&&c[0]||f?.length===1&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:v?.map(kl("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:b,venueId:I}}function QBe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let n=[],r=[],a,s,o,l;for(let u of t.filter(Boolean))l||(l=u.hash),(u.hash===l||i)&&(r=r.concat(u.matchUpIds)),u.hash,o=e,s=u.recoveryMinutes,a=u.roundPeriodLength;return r.length&&n.push({matchUpIds:r,roundPeriodLength:a,recoveryMinutes:s,averageMinutes:o}),{groupedRounds:n}}function Qhe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:n,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,tournamentRecords:l,periodLength:u,scheduleDate:c,useGarman:d,matchUps:p,courts:h,venues:f}){let m={},g=[],v=[],y=[];for(let b of f){let{rounds:I=[],venueId:S}=b,{scheduledRoundsDetails:w,greatestAverageMinutes:T,orderedMatchUpIds:U,minutesMap:C}=VR({scheduleCompletedMatchUps:i,containedStructureIds:n,tournamentRecords:l,periodLength:u,matchUps:p,rounds:I});y.push(...U??[]);let{groupedRounds:E}=QBe({scheduledRoundsDetails:w,greatestAverageMinutes:T,garmanSinglePass:!0}),P,M=[];d&&({scheduleTimes:M,dateScheduledMatchUpIds:P}=JBe({averageMatchUpMinutes:E[0]?.averageMinutes,scheduleDate:Pi(c),venueIds:[b.venueId],clearScheduleDates:o,tournamentRecords:l,periodLength:u,matchUps:p}));let R=XBe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:P,greatestAverageMinutes:T,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,scheduleDate:c,minutesMap:C,matchUps:p});({dateScheduledMatchUpIds:P}=R);let N=R,{byeScheduledMatchUpDetails:A,clearDate:_}=R;A?.length&&v.push(...A);let{matchUpsToSchedule:x,matchUpMap:O}=cF({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:P,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,orderedMatchUpIds:U,clearDate:_,matchUps:p}),$=h.filter(F=>F.venueId===S);m[S]={previousRemainingScheduleTimes:[],courtsCount:$.length,greatestAverageMinutes:T,scheduledRoundsDetails:w,dateScheduledMatchUps:N,matchUpsToSchedule:x,scheduleTimes:M,groupedRounds:E,venueCourts:$,minutesMap:C,matchUpMap:O},o||g.push(...P)}return{allDateScheduledByeMatchUpDetails:v,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:m,allDateMatchUpIds:y}}function e2e(t,e){let i=rn(t.scheduleTime),n=rn(t.timeAfterRecovery),r=rn(e.scheduleTime),a=rn(e.timeAfterRecovery),s=i===r||n===a,o=i>r&&i<a,l=r>i&&r<n,u=n>r&&n<a,c=a>i&&a<n;return Vt({hasOverlap:s||o||u||l||c,startAisContained:o,endAisContained:u,startBisContained:l,endBisContained:c},!0)}function F5({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:n,matchUp:r,details:a}){let s=(i?.[r.matchUpId]?.participantIds||[]).flat(),o=a?.minutesMap?.[r.matchUpId]?.averageMinutes||0,l=a?.minutesMap?.[r.matchUpId]?.recoveryMinutes||0,u=s.every(p=>{KR({individualParticipantProfiles:t,participantId:p});let h=t[p];if(!h.timeAfterRecovery)return!0;let f=Jn(r?.schedule?.endTime),m=f?tl(f,ri(l)):tl(n,ri(o)+ri(l));return![...Object.keys(h.potentialBookings).filter(g=>g!==r.drawId).map(g=>h.potentialBookings[g]).flat(),...h.bookings].find(g=>e2e({scheduleTime:n,timeAfterRecovery:m},g).hasOverlap)}),c=e[r.matchUpId],d=(c?W1(zr(c),zr(n),!1):0)>=0;return{enoughTime:u&&d}}function efe({autoSchedulingAudit:t,tournamentRecords:e}){Ti({topic:im,payload:t});let i=s=>s?Object.values(s).reduce((o,l)=>o+l.length||0,0):0,n=(t?.schedulingProfile||[]).reduce((s,o)=>s+o.venues.reduce((l,u)=>l+u.rounds.length,0),0),r={scheduledDatesCount:t.scheduledDates?.length,noTimeMatchUpIdsCount:i(t?.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t?.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t?.overLimitMatchUpIds),requestConflictsCount:i(t?.requestConflicts),profileRoundsCount:n},a={itemType:YG,itemValue:r};for(let s of Object.values(e)){let o=s.tournamentId;KO(im)?Ti({payload:{type:YG,tournamentId:o,detail:r},topic:im}):kR({tournamentRecord:s,timeItem:a})}}function $5({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:n}){let{enteredIndividualParticipantIds:r}=wL(n),{matchUpId:a,matchUpType:s}=n,o=(n.roundPosition&&t[a]||[]).flat(),l=wi(r.concat(...o));return l.forEach(u=>{KR({individualParticipantProfiles:e,participantId:u})}),{participantIdsAtLimit:l.filter(u=>{let c=e[u];if(c)return[s,zc].find(d=>{let p=c.counters?.[d]||0,h=i[d]||0;return p&&h&&p>=h})}),relevantParticipantIds:l}}function PC({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:n=!0,matchUpDependencies:r,removePriorValues:a,tournamentRecords:s,tournamentRecord:o,matchUpDetails:l,matchUpIds:u,schedule:c}){if(!o)return{error:ot};if(!l&&(!u||!Array.isArray(u)))return{error:qw};if(!l&&(!c||typeof c!="object"))return{error:aoe};let d,p=[],h=0;if(n&&!r){let g=gd({tournamentRecords:s,tournamentRecord:o});r=g.matchUpDependencies,d=g.matchUps}d||(d=Za({tournamentRecord:o})?.matchUps??[]);let f=d.reduce((g,v)=>{let{matchUpId:y,drawId:b,matchUpStatus:I}=v;return(e||I!=="BYE")&&(t||!Yr.includes(I))&&(g[b]?g[b].push(y):g[b]=[y]),g},{}),m=l?.map(g=>g.matchUpId);for(let g of Object.keys(f)){let{drawDefinition:v}=Cv({tournamentRecord:o,drawId:g});if(!v)continue;let y=f[g].filter(I=>u?.includes(I)??m?.includes(I)),b=uo({inContext:!1,drawDefinition:v}).matchUps;for(let I of y){let S=l?.find(T=>T.matchUpId===I)?.schedule||c,w=NF({schedule:S,matchUpDependencies:r,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:s,tournamentRecord:o,checkChronology:n,drawDefinition:v,drawMatchUps:b,matchUpId:I});if(w?.warnings?.length&&p.push(...w.warnings),w?.success&&(h+=1),w.error)return w}}return p.length?{...le,scheduled:h,warnings:p}:{...le,scheduled:h}}function XR(t){let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:n,matchUpContextIds:r,removePriorValues:a,tournamentRecords:s,checkChronology:o,matchUpDetails:l,schedule:u}=t;if(t.matchUpIds&&!r)return PC(t);let c=zt(t,[{[js]:!0},{[OT]:{matchUpContextIds:!1,matchUpDetails:!1},[pu]:Ee,[Go]:xs}]);if(c.error)return c;if((!l||r)&&!u)return{error:Zt,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:h}=gd({tournamentRecords:s});for(let f of Object.values(s)){let{tournamentId:m}=f,g=r?.filter(y=>y.tournamentId===m).map(Ma),v=l?.filter(y=>y?.tournamentId===m);if(g?.length||v?.length){let y=PC({matchUpDetails:v,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:h,errorOnAnachronism:n,removePriorValues:a,tournamentRecords:s,tournamentRecord:f,checkChronology:o,matchUpIds:g,schedule:u});if(y.warnings?.length&&d.push(...y.warnings),y.scheduled&&(p+=y.scheduled),y.error)return y}}return d.length?{...le,scheduled:p,warnings:d}:{...le,scheduled:p}}function t2e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:c,personRequests:d,periodLength:p,matchUps:h,courts:f,dryRun:m}){let g={},v={},y={},b={},I={},S={},w={},T={},U={},C={};for(let M of r){let R=Pi(M?.scheduleDate),N=M?.venues||[],A={},_={},x=(Z,K)=>{Z.forEach(Q=>{let J=_[Q].counters;J[K]?J[K]+=1:J[K]=1,J[zc]?J[zc]+=1:J[zc]=1})};y[R]={},b[R]={},g[R]={},v[R]={},w[R]=[],T[R]=[],U[R]=[],C[R]=[];let O={};h.forEach(Z=>{Z.schedule?.scheduledDate&&zh(R,Pi(Z.schedule.scheduledDate))&&HT({matchUpPotentialParticipantIds:A,matchUpNotBeforeTimes:O,matchUp:Z})});let{allDateScheduledByeMatchUpDetails:$,venueScheduledRoundDetails:F,allDateMatchUpIds:j}=Qhe({matchUpPotentialParticipantIds:A,individualParticipantProfiles:_,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:O,matchUpScheduleTimes:S,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:R,matchUps:h,courts:f,venues:N}),H=10,G=0,W,q=10;for(;!W;){for(let{venueId:Z}of N){let K=0,Q=F[Z];for(;Q.courtsCount&&Q.scheduleTimes?.length&&Q.matchUpsToSchedule?.length&&K<=Q.courtsCount;){let{scheduleTime:J,attempts:ne=0}=Q.scheduleTimes.shift(),re=Q.matchUpsToSchedule.find(oe=>{let{matchUpId:de,matchUpType:se}=oe,{participantIdsAtLimit:ge,relevantParticipantIds:ye}=$5({matchUpPotentialParticipantIds:A,individualParticipantProfiles:_,matchUpDailyLimits:o,matchUp:oe});if(ge.length)return T[R].includes(de)||T[R].push(de),!1;let{scheduledDependent:Te}=Xhe({matchUpScheduleTimes:S,matchUpDependencies:s,scheduleTime:J,matchUpId:de,details:Q});if(Te)return!1;let{dependenciesScheduled:De,remainingDependencies:xe}=O5({matchUpScheduleTimes:S,matchUpDependencies:s,allDateMatchUpIds:j,matchUp:oe});if(!De)return b[R][de]||(b[R][de]=[]),b[R][de].push({scheduleTime:J,remainingDependencies:xe}),!1;let{enoughTime:Me}=F5({individualParticipantProfiles:_,matchUpNotBeforeTimes:O,matchUpDependencies:s,scheduleTime:J,details:Q,matchUp:oe});if(!Me)return y[R][de]||(y[R][de]=[]),y[R][de].push({scheduleTime:J}),!1;let Oe=Q.greatestAverageMinutes,{conflicts:at}=L5({potentials:e,averageMatchUpMinutes:Oe,requestConflicts:C,personRequests:d,scheduleTime:J,scheduleDate:R,matchUp:oe});if(at?.length)return I[R]||(I[R]=[]),I[R].push(...at),!1;x(ye,se);let Fe=Q.minutesMap?.[de]?.recoveryMinutes;return EC({matchUpPotentialParticipantIds:A,individualParticipantProfiles:_,matchUpNotBeforeTimes:O,averageMatchUpMinutes:Oe,matchUpDependencies:s,recoveryMinutes:Fe,scheduleTime:J,matchUp:oe}),S[de]=J,!0});Q.matchUpsToSchedule=Q.matchUpsToSchedule.filter(({matchUpId:oe})=>oe!==re?.matchUpId),re?K+=1:(v[R][Z]||(v[R][Z]=[]),v[R][Z].push({scheduleTime:J,attempts:ne+1}))}Q.matchUpsToSchedule?.length&&(v[R][Z]=v[R][Z]?.filter(J=>{let ne=J.attempts<H;return ne&&Q.scheduleTimes.push(J),!ne})),(!Q.scheduleTimes?.length||!Q.matchUpsToSchedule?.length)&&(Q.complete=!0)}G+=1,W=N.every(({venueId:Z})=>F[Z].complete)||G===q}for(let{venueId:Z}of N){let K=F[Z].matchUpMap;Object.keys(K).forEach(Q=>{let J=u[Q];J&&Object.keys(K[Q]).forEach(ne=>{let{drawDefinition:re}=Cv({tournamentRecord:J,drawId:ne});re&&K[Q][ne].forEach(({matchUpId:oe})=>{let de=S[oe];if(de){let se=de.split(":").map(Bu).join(":"),ge=`${Pi(R)}T${se}`;m?w[R].push(oe):(Rv({drawDefinition:re,scheduledTime:ge,matchUpId:oe}).success&&w[R].push(oe),Z&&ID({tournamentRecord:J,drawDefinition:re,matchUpId:oe,venueId:Z}))}})})}),U[R]=F[Z].matchUpsToSchedule.map(Ma),g[R][Z]=F[Z].scheduleTimes.sort((Q,J)=>rn(Q.scheduleTime)-rn(J.scheduleTime))}!m&&$?.length&&XR({matchUpDetails:$,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let Z of M.venues)for(let K of Z.rounds){let Q=(K.matchUps?.map(({matchUpId:ne})=>ne)||[]).filter(ne=>w[R].includes(ne));K.canScheduledMatchUpIds=Q;let J=Math.round(Q.length/K.matchUpsCount*1e4)/100;(J===1/0||isNaN(J))&&(J=0),K.possibleToSchedulePct=J,K.matchUpsCount===Q.length&&(K.possibleToSchedule=!0)}}let E=r.map(({scheduleDate:M})=>M),P={timeStamp:Date.now(),overLimitMatchUpIds:T,scheduledMatchUpIds:w,schedulingProfile:c,noTimeMatchUpIds:U,requestConflicts:C,scheduledDates:E};return efe({tournamentRecords:u,autoSchedulingAudit:P}),{...le,schedulingProfileModifications:t,schedulingProfileIssues:n,scheduleTimesRemaining:g,dateSchedulingProfiles:r,skippedScheduleTimes:v,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:b,matchUpScheduleTimes:S,overLimitMatchUpIds:T,scheduledMatchUpIds:w,noTimeMatchUpIds:U,requestConflicts:C,scheduledDates:E}}function nJ({averageMinutes:t,startTime:e,endTime:i,court:n,date:r}){if(!Array.isArray(n.dateAvailability))return{error:Zt,stack:"getEarliestCourtTime"};let a=zT({scheduleDate:r,courts:[n],startTime:!0}),s=zT({scheduleDate:r,courts:[n],endTime:!0});e=e||a,i=i||s;let o=WR({court:n,date:r}),{timeSlots:l}=yD({courtDate:o}),u=zr(e),c=zr(i);return{earliestCourtTime:l?.reduce((d,p)=>{let h=zr(p.startTime),f=zr(p.endTime);if(h>c||f<u)return d;let m=u>h?u:h;if(W1(m,f)>=t){let g=Jn(m.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:s}}function i2e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:u,periodLength:c=30,schedulingProfile:d,personRequests:p,matchUps:h=[],courts:f,dryRun:m}){let g={},v={},y={},b={},I={},S={},w={},T={},U={};for(let P of r??[]){let M=Pi(P?.scheduleDate),R=P?.venues||[],N={},A={},_=(re,oe)=>{re.forEach(de=>{let se=A[de].counters;se[oe]?se[oe]+=1:se[oe]=1,se[zc]?se[zc]+=1:se[zc]=1})};g[M]={},v[M]={},S[M]=[],w[M]=[],T[M]=[],U[M]=[];let x={};h?.forEach(re=>{re.schedule?.scheduledDate&&zh(M,Pi(re.schedule.scheduledDate))&&HT({matchUpPotentialParticipantIds:N,matchUpNotBeforeTimes:x,matchUp:re})});let{allDateScheduledByeMatchUpDetails:O,allDateScheduledMatchUpIds:$,venueScheduledRoundDetails:F,allDateMatchUpIds:j}=Qhe({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:x,matchUpScheduleTimes:I,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:u,periodLength:c,scheduleDate:M,matchUps:h,courts:f,venues:R}),H=h?.filter(({matchUpId:re})=>$.includes(re)),{bookings:G}=_F({dateScheduledMatchUps:H,tournamentRecords:u,scheduleDate:M,periodLength:c}),{virtualCourts:W}=UF({scheduleDate:M,periodLength:c,bookings:G,courts:f}),q=W?.reduce((re,oe)=>{let{earliestCourtTime:de,courtEndTime:se}=nJ({date:M,averageMinutes:0,court:oe});return(!re.startTime||zr(de)<zr(re.startTime))&&(re.startTime=de),(!re.endTime||zr(se)>zr(re.endTime))&&(re.endTime=se),re},{}),Z=q.startTime,K=({courtId:re,booking:oe})=>W?.find(de=>de.courtId===re)?.dateAvailability[0].bookings.push(oe),Q=10,J=0,ne;for(;!ne;){for(let{venueId:re}of R){let oe=F[re],de=oe.matchUpsToSchedule.length,se=[],ge=[],ye,Te=0;for(;!ye;){for(let De of oe.matchUpsToSchedule){if(ge.length===oe.courtsCount||se.length===oe.courtsCount){ye=!0;break}let{matchUpId:xe,matchUpType:Me}=De,{participantIdsAtLimit:Oe,relevantParticipantIds:at}=$5({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,matchUpDailyLimits:o,matchUp:De});if(Oe.length){w[M].includes(xe)||w[M].push(xe);continue}let{dependenciesScheduled:Fe,remainingDependencies:mt}=O5({matchUpScheduleTimes:I,matchUpDependencies:s,allDateMatchUpIds:j,matchUp:De});if(!Fe){v[M][xe]||(v[M][xe]=[]),v[M][xe].push({remainingDependencies:mt});continue}let Xe=[],gt=W?.reduce((ht,_e)=>{if(ge.includes(_e.courtId))return ht;let{earliestCourtTime:Ye}=nJ({averageMinutes:oe.greatestAverageMinutes,startTime:Z,date:M,court:_e});if(ht.scheduleTime&&rn(Ye)>=rn(ht.scheduleTime))return ht;let{scheduledDependent:Je}=Xhe({matchUpScheduleTimes:I,matchUpDependencies:s,scheduleTime:Ye,matchUpId:xe,details:oe});if(Je)return ht;let{enoughTime:ct}=F5({individualParticipantProfiles:A,matchUpNotBeforeTimes:x,matchUpDependencies:s,scheduleTime:Ye,details:oe,matchUp:De});if(!ct)return g[M][xe]||(g[M][xe]=[]),g[M][xe].includes(Ye)||g[M][xe].push(Ye),ht;let pt=oe.minutesMap?.[xe]?.averageMinutes||oe.greatestAverageMinutes,{conflicts:Se}=L5({potentials:e,averageMatchUpMinutes:pt,requestConflicts:U,personRequests:p,scheduleTime:Ye,scheduleDate:M,matchUp:De});if(Se?.length)return Xe.push(...Se),!1;_(at,Me);let he=oe.minutesMap?.[xe]?.recoveryMinutes;return EC({matchUpPotentialParticipantIds:N,individualParticipantProfiles:A,matchUpNotBeforeTimes:x,averageMatchUpMinutes:pt,matchUpDependencies:s,recoveryMinutes:he,scheduleTime:Ye,matchUp:De}),(!ht.scheduleTime||rn(Ye)<rn(ht.scheduleTime))&&(ht.averageMatchUpMinutes=pt,ht.recoveryMinutes=he,ht.scheduleTime=Ye,ht.courtName=_e.courtName,ht.courtId=_e.courtId),ht},{});if(gt.scheduleTime){let{averageMatchUpMinutes:ht,recoveryMinutes:_e,scheduleTime:Ye,courtId:Je}=gt;I[xe]=Ye,b[xe]=Je,se.push(xe),ge.push(Je);let ct=Ye,pt=tl(ct,ht);K({courtId:Je,booking:{averageMatchUpMinutes:ht,recoveryMinutes:_e,periodLength:c,matchUpId:xe,startTime:ct,courtId:Je,endTime:pt,venueId:re}}),oe.matchUpsToSchedule=oe.matchUpsToSchedule.filter(Se=>Se.matchUpId!==xe)}else Xe?.length&&(y[M]||(y[M]=[]),y[M].push(...Xe))}(ge.length===oe.courtsCount||se.length===oe.courtsCount||!oe.matchUpsToSchedule.length)&&(ye=!0),oe.matchUpsToSchedule.length&&se<oe.courtsCount&&(zr(Z)<zr(q.endTime)?Z=tl(Z,c):(ye=!0,oe.complete=!0)),Te+=1,!ye&&Te>=de&&(ye=!0)}oe.matchUpsToSchedule?.length||(oe.complete=!0)}J+=1,ne=R.every(({venueId:re})=>F[re].complete)||J===Q}for(let{venueId:re}of R){let oe=F[re].matchUpMap;Object.keys(oe).forEach(de=>{let se=u[de];se&&Object.keys(oe[de]).forEach(ge=>{let{drawDefinition:ye}=Cv({tournamentRecord:se,drawId:ge});ye&&oe[de][ge].forEach(({matchUpId:Te})=>{let De=I[Te],xe=b[Te];if(De){let Me=De.split(":").map(Bu).join(":"),Oe=`${Pi(M)}T${Me}`;m||(Rv({drawDefinition:ye,scheduledTime:Oe,matchUpId:Te}),S0({courtDayDate:M,tournamentRecords:u,tournamentRecord:se,drawDefinition:ye,matchUpId:Te,courtId:xe})),S[M].push(Te)}})})}),T[M]=F[re].matchUpsToSchedule.map(Ma)}!m&&O?.length&&XR({matchUpDetails:O,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let re of P.venues)for(let oe of re.rounds){let de=(oe.matchUps??[]).map(({matchUpId:ge})=>ge)?.filter(ge=>S[M].includes(ge));oe.canScheduledMatchUpIds=de;let se=Math.round((de?.length||0)/oe.matchUpsCount*1e4)/100;(se===1/0||isNaN(se))&&(se=void 0),oe.possibleToSchedulePct=se,oe.matchUpsCount===de?.length&&(oe.possibleToSchedule=!0)}}let C=(r??[]).map(({scheduleDate:P})=>P),E={timeStamp:Date.now(),overLimitMatchUpIds:w,scheduledMatchUpIds:S,schedulingProfile:d,noTimeMatchUpIds:T,requestConflicts:U,scheduledDates:C};return efe({tournamentRecords:u,autoSchedulingAudit:E}),{...le,schedulingProfileModifications:t,schedulingProfileIssues:n,dateSchedulingProfiles:r,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:v,matchUpScheduleTimes:I,overLimitMatchUpIds:w,scheduledMatchUpIds:S,noTimeMatchUpIds:T,requestConflicts:U,scheduledDates:C}}function kF(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=Yr,scheduledDates:n,venueIds:r}=t,a=ic(t),s=Ki(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!s?.length)return{error:fr};let o=0;for(let l of s){let u=a[l],c=n2e({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:u,scheduledDates:n,venueIds:r});if(c.error)return c;o+=c.clearedScheduleCount??0}return{...le,clearedScheduleCount:o}}function n2e({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=Yr,tournamentRecord:i,scheduledDates:n,venueIds:r=[]}){if(typeof i!="object")return{error:ot};if(!Array.isArray(e)||!Array.isArray(r))return{error:Ee};r.length&&t.push("venueId");let a=Za({matchUpFilters:{scheduledDates:n},tournamentRecord:i}).matchUps??[],s={};a.forEach(({matchUpStatus:u,schedule:c,drawId:d,matchUpId:p})=>{(!u||!e.includes(u))&&GR({schedule:c,scheduleAttributes:t})&&(!r?.length||r.includes(c.venueId))&&(s[d]||(s[d]=[]),s[d].push(p))});let o=i.tournamentId,l=0;for(let u in s){let{event:c,drawDefinition:d}=$o({tournamentRecord:i,drawId:u}),p=uo({drawDefinition:d,matchUpFilters:{matchUpIds:s[u]}}).matchUps??[];for(let h of p){let f=!1;h.timeItems=(h.timeItems??[]).filter(m=>{let g=m?.itemType&&![Qh,Xg,a0,DL,s0,o0].includes(m?.itemType);return g||(f=!0),g}),f&&(Zi({context:"clear schedules",eventId:c?.eventId,drawDefinition:d,tournamentId:o,matchUp:h}),l+=1)}}return{...le,clearedScheduleCount:l}}function xF(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:n,scheduleDates:r=[],tournamentRecords:a,periodLength:s,useGarman:o,dryRun:l,pro:u}=t,c=zt(t,[{[js]:!0},{[gs]:C=>!C||Array.isArray(C)&&C.every(nl),[Cle]:!1,[Go]:xs}]);if(c.error)return c;let d=Ym({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...le};let{modifications:p,issues:h=[],schedulingProfile:f=[]}=d,m=Object.assign({},...Object.values(a).map(C=>rD({tournamentRecord:C}).containedStructures)),g=r.map(C=>{if(nl(C))return Pi(C)}).filter(Boolean),v=f.map(C=>C.scheduleDate).map(C=>nl(C)&&Pi(C)).filter(C=>C&&(!r.length||g.includes(C)));if(!v.length)return{error:xse};if(n&&!l){let C=Array.isArray(n)?n:[];kF({tournamentRecords:a,scheduledDates:C})}let y=Wm({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:b}=jd({matchUpFilters:{matchUpTypes:[Rn,Dn]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:I}=gd({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:b}),{matchUpDailyLimits:S}=bF({tournamentRecords:a}),{personRequests:w}=xb({requestType:ZR,tournamentRecords:a}),T=f.filter(C=>{let E=Pi(C?.scheduleDate);return v.includes(E)}).sort((C,E)=>new Date(C.scheduleDate).getTime()-new Date(E.scheduleDate).getTime()),U={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:h,dateSchedulingProfiles:T,containedStructureIds:m,matchUpDependencies:I,matchUpDailyLimits:S,clearScheduleDates:n,tournamentRecords:a,schedulingProfile:f,personRequests:w,periodLength:s,matchUps:b,dryRun:l,courts:y};return u?i2e(U):t2e(U)}function OF(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:n,...r}=t||{};return r.tournamentId||(r.tournamentId=mn()),r.startDate&&!Gy(r.startDate)&&!ok.test(r.startDate)?{error:ja}:r.endDate&&!Gy(r.endDate)&&!ok.test(r.endDate)?{error:ja}:(r.extensions&&(r.extensions=r.extensions.filter($p)),{...r})}function B5({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:n,teamNames:r,accessor:a,uuids:s}){if(!i)return{error:ot};let o={},l=(i.participants??[]).filter(({participantType:f,participantRole:m})=>f===ji&&m===bs),u=0;for(let f of l){let m=a&&kI({element:f,accessor:a})?.value||n&&f.person?.[n]||e&&f[e];if(m){if(!Object.keys(o).includes(m)){o[m]={participantName:r?.[u]??m,participantId:s?.pop()??mn(),individualParticipantIds:[],participantRole:bs,participantType:wn};let g={value:n??e,name:SG};un({element:o[m],extension:g}),u+=1}o[m].individualParticipantIds.push(f.participantId)}}let c=Object.keys(o),d=(i.participants??[]).map(f=>{if(f.participantType!==wn||f.participantRole!==bs)return;let{extension:m}=_i({name:SG,element:f}),g=m?.value;if(c.includes(g))return f.participantId}).filter(Boolean),p=0,h=[];return Object.keys(o).forEach(f=>{let m=o[f],{participantId:g}=m;d.includes(g)||(i.participants||(i.participants=[]),t&&i.participants.push(m),h.push(m),p++)}),t&&p?(Ti({payload:{tournamentId:i.tournamentId,participants:h},topic:Wg}),{...le,participantsAdded:p}):h.length?{...le,newParticipants:h}:{error:gAe}}var r2e=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],a2e=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function tfe({count:t=1,participantsCount:e=32}={}){let i=oo(a2e),n=i.slice(0,t);return{cities:Dt(0,e).map(r=>r<Math.min(t,i.length)?n[r]:yl(n))}}function ife({count:t=1,participantsCount:e=32}={}){let i=oo(r2e),n=i.slice(0,t).map(r=>Object.keys(r)).flat();return{states:Dt(0,e).map(r=>r<Math.min(t,i.length)?n[r]:yl(n))}}function nfe({count:t=1,participantsCount:e=32}={}){let i=Dt(0,t).map(()=>Dt(0,5).map(()=>xu(0,9)).join(""));return{postalCodes:Dt(0,e).map(n=>n<t?i[n]:yl(i))}}function _k({idPrefix:t,participantType:e,index:i,uuids:n}){let r=Xn(e)?e[0]:"X";return t?`${t}-${r}-${i}`:n?.pop()||mn()}function rfe(t){let{cities:e,states:i,postalCodes:n,nationalityCode:r,participantIndex:a}=t;return{postalCode:n?.[a],state:i?.[a],city:e?.[a],countryCode:r}}var s2e={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood","Zecic"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Miro","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function cV(t){let{count:e=100,sex:i}=t||{};if(!e||i&&!xp(i))return{personData:[],error:Ee};let n=Math.ceil(e*1.3),{lastNames:r,firstFemale:a,firstMale:s}=s2e,o=$g.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(n/r.length),u=Math.ceil(n/a.length),c=Math.ceil(n/s.length),d=Dt(0,l).flatMap(()=>{let m=Ct(r,!1,!0);return Dt(0,r.length).map(()=>Il(m))}),p=Dt(0,u).flatMap(()=>{let m=Ct(a,!1,!0);return Dt(0,a.length).map(()=>Il(m))}),h=Dt(0,c).flatMap(()=>{let m=Ct(s,!1,!0);return Dt(0,s.length).map(()=>Il(m))}),f={};for(let m=0;m<n;m++){let g=d.pop(),v=i||yl([ta,ms]),y=v===ta?h.pop():p.pop(),b=yl(o);f[`${y}${g}`]={nationalityCode:b,sex:v,firstName:y,lastName:g}}return{personData:Object.values(f).slice(0,e)}}function afe(t){let e=t?.count||1,{personExtensions:i,consideredDate:n,isMock:r=!0,gendersCount:a,personData:s,category:o,sex:l}=t||{};if(isNaN(e))return{error:Ee};let u=a?.[ta]||PI(l)&&e||0,c=a?.[ms]||yy(l)&&e||0;e=Math.max(e,u+c);let d=e-(u+c),p=u&&cV({count:u,sex:ta}).personData||[],h=c&&cV({count:c,sex:ms}).personData||[],f=[...p,...h,...d&&cV({count:d}).personData||[]],m=f.filter(U=>!l||u&&c||U.sex===l),g=[];if(Array.isArray(s)){let U=s.filter(C=>typeof C.firstName!="string"||typeof C.lastName!="string"||C.sex&&![ta,ms].includes(C.sex)||C.nationalityCode&&(typeof C.nationalityCode!="string"||C.nationalityCode.length>3||!$g.find(({iso:E,ioc:P})=>[E,P].includes(C.nationalityCode)))?!1:(C.nationalityCode&&g.push(C.nationalityCode),!0));if(U.length)m=U;else return{error:Ee}}let v=s?m:oo(m);if(v.length<e){let{maleFirstNames:U,maleLastNames:C,femaleFirstNames:E,femaleLastNames:P,nationalityCodes:M}=f.reduce((R,N)=>{let{firstName:A,lastName:_,nationalityCode:x}=N;return N.sex===ta?(R.maleFirstNames.includes(A)||R.maleFirstNames.push(A),R.maleLastNames.includes(_)||R.maleLastNames.push(_)):(R.femaleFirstNames.includes(A)||R.femaleFirstNames.push(A),R.femaleLastNames.includes(_)||R.femaleLastNames.push(_)),R.nationalityCodes.includes(x)||R.nationalityCodes.push(x),R},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Dt(0,e-v.length).forEach(()=>{let R=l||yl([ta,ms]),N=yl(M),A=yl(R===ta?U:E),_=yl(R===ta?C:P),x={firstName:A,lastName:_,sex:R,nationalityCode:N};v.push(x)})}let{ageMinDate:y,ageMaxDate:b}=sw({consideredDate:n,category:o}),I=ri(y?.slice(0,4)||0)||ri(b?.slice(0,4)||0)-3,S=ri(b?.slice(0,4)||0)||ri(y?.slice(0,4)||0)+3,w=(y||b)&&[I,S],T=v.slice(0,e).map((U,C)=>{let[E,P]=w||[],M=w&&Il(Dt(E,P)),R=Il(Dt(0,365)),N=M&&l_e(M,R);return Object.assign(Vt({extensions:i||[{name:"regionCode",value:C+1}],birthDate:N,isMock:r}),U)});return{persons:T.length&&T||v[0],nationalityCodes:g}}var o2e=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function kk({nameRoot:t="TEAM",count:e=1}={}){let i=oo(o2e).slice(0,e);return i.length<e&&Dt(0,e-i.length).forEach(n=>i.push(`${t} ${n+1}`)),{names:i}}function SD(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:n=Ca,valuesInstanceLimit:r,ratingsValues:a=[],consideredDate:s,categories:o,category:l,nationalityCodesCount:u,nationalityCodeType:c,nationalityCodes:d,participantsCount:p=32,participantType:h,teamSize:f=8,personIds:m,idPrefix:g,uuids:v,personExtensions:y,addressProps:b,gendersCount:I,matchUpType:S,personData:w,sex:T,inContext:U,withISO2:C,withIOC:E,scaleAllParticipants:P}=t,M=h===Ni||S===jy,R=h===wn||S===wn;i&&(!Array.isArray(i)||!i.every(Fe=>br(Fe))||i.length!==2)&&(i=void 0),e=P?p:e;let N=1e3,A=e&&e>N?e:N;i=i||[1,A],i[1]+=1;let _=p*(M&&2||R&&(f??8)||1),x=afe({count:_,personExtensions:y,consideredDate:s,gendersCount:I,personData:w,category:l,sex:T});if(x.error)return x;let{nationalityCodes:O,persons:$}=x,F={},j={},H={},G={},W=Fe=>{Object.assign(F,Fe.doublesRankings),Object.assign(j,Fe.singlesRankings),Object.assign(G,Fe.doublesRatings),Object.assign(H,Fe.singlesRatings)};if(Ki(l)){let Fe=rJ({scaledParticipantsCount:e,ratingsParameters:n,participantType:h,ratingsValues:a,rankingRange:i,category:l});W(Fe)}Array.isArray(o)&&o.forEach(Fe=>{let mt=rJ({scaledParticipantsCount:e,ratingsParameters:n,participantType:h,ratingsValues:a,rankingRange:i,category:Fe});W(mt)});let q=$g.filter(Fe=>c==="IOC"&&Fe.ioc||Fe.iso);function Z(Fe){let mt=Math.ceil(_/Fe);return r&&mt>r?Math.ceil(_/r):Fe}let{postalCodesProfile:K,postalCodesCount:Q,statesProfile:J,citiesProfile:ne,citiesCount:re,statesCount:oe}=b||{},de=Fe=>Object.keys(Fe).map(mt=>Dt(0,J[mt]).map(()=>mt)).flat(),se=ne&&de(ne)||b?.cities||tfe({count:re||_,participantsCount:_}).cities,ge=J&&de(J)||b?.states||ife({count:oe||_,participantsCount:_}).states,ye=K&&de(K)||b?.postalCodes||nfe({count:Q||_,participantsCount:_}).postalCodes,Te={cities:se,states:ge,postalCodes:ye},De=Z(u),xe=De?oo(q).slice(0,u):d&&q.filter(Fe=>d.includes(Fe.iso))||q,Me=oo(Dt(0,Math.ceil(_/(De||1))).map(()=>xe).flat(1/0)),Oe=kk({count:p}).names;return{participants:Dt(0,p).map(Fe=>{let mt=M&&2||R&&(f??8)||1,Xe=Dt(0,mt).map(Je=>{let ct=Fe*mt+Je;return at(ct)}),gt=Xe.map(Je=>Je.participantId),ht=Xe.map(Je=>Je.person.standardFamilyName).join("/"),_e=M?Ni:wn,Ye={participantId:_k({participantType:_e,index:Fe,idPrefix:g,uuids:v}),participantName:M?ht:Oe[Fe],participantRole:bs,individualParticipantIds:gt,participantType:_e};return U&&(Ye.individualParticipants=Xe),M||R?[Ye,...Xe]:Xe}).flat(),...le};function at(Fe){let mt=$[Fe],{nationalityCode:Xe,participantExtensions:gt,participantTimeItems:ht,extensions:_e,firstName:Ye,birthDate:Je,lastName:ct,personId:pt,sex:Se}=mt||{},he=Ye||"GivenName",we=ct||"FamilyName",be=`${he} ${we}`,Ae=Me[Fe],ze=O?.length&&Xe||Ae&&(c==="IOC"?Ae.ioc||Ae.iso:Ae.iso||Ae.ioc)||Xe;Me?.length&&!ze&&!Xe&&console.log("%c Invalid Nationality Code",{participantIndex:Fe,country:Ae});let We=rfe({...Te,participantIndex:Fe,nationalityCode:ze}),Le=Vt({participantId:_k({participantType:ji,index:Fe,idPrefix:g,uuids:v}),extensions:gt,timeItems:ht,participantRole:bs,participantType:ji,participantName:be,person:{personId:pt||m?.length&&m[Fe]||mn(),birthDate:nl(Je)?Je:void 0,addresses:[We],standardFamilyName:we,standardGivenName:he,nationalityCode:ze,extensions:_e,sex:Se}});if(E&&ze){let rt=$g.find(({iso:St})=>St===ze);rt?.ioc&&(Le.person.iocNationalityCode=rt.ioc),rt?.label&&(Le.person.countryName=rt.label)}if(C&&ze){let rt=$g.find(({iso:St})=>St===ze);rt?.iso2&&(Le.person.iso2NationalityCode=rt.iso2),rt?.label&&(Le.person.countryName=rt.label)}let ft=rt=>{let St=rt.categoryName||rt.ratingType||rt.ageCategoryCode,si=j[St]?.[Fe],Qe=F[St]?.[Fe];sA({scaleValue:si,eventType:ow,scaleType:zg,participant:Le,category:rt}),sA({scaleValue:Qe,eventType:pm,scaleType:zg,participant:Le,category:rt});let bt=H[St]?.[Fe],ci=G[St]?.[Fe];sA({scaleValue:bt,eventType:ow,scaleType:Fg,participant:Le,category:rt}),sA({scaleValue:ci,eventType:pm,scaleType:Fg,participant:Le,category:rt})};return Array.isArray(o)?o.forEach(rt=>ft(rt)):l&&ft(l),Le}}function sA({scaleValue:t,participant:e,eventType:i,scaleType:n,category:r}){let a=r.categoryName||r.ratingType||r.ageCategoryCode,s=[Wy,n,i,a].join("."),o={itemValue:t,itemType:s};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(o))}function rJ(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:n,participantType:r,ratingsValues:a=[]}=t,s=e.rankingRange||t.rankingRange||[1,1e3],o={},l={},u={},c={},{categoryName:d,ageCategoryCode:p,ratingType:h}=e,f=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!h){let[m,g]=s||[];if(l[f]=oo(Dt(m,g)).slice(0,i||xu(20,30)),[Ni,wn].includes(r)){let[v,y]=s||[];o[f]=oo(Dt(v,y)).slice(0,i||xu(20,30))}}if(h&&n[h]){let{ratingMax:m,ratingMin:g,ratingAttributes:v}=e,y={...n[h],...v||{}},{attributes:b={},decimalsCount:I,accessors:S,range:w,step:T}=y,U=R=>{let N={},A=Object.keys(R||{});for(let _ of A){let x=R[_];if(typeof x=="object"&&x.generator){let{range:O}=x,[$,F]=O.slice().sort();N[_]=xu($,F)}else N[_]=x}return N},C=w[0]>w[1]?2:.7,[E,P]=w.slice().sort(),M=Dt(0,2e3).map(()=>Jae(E,P,C,T,I)).filter(R=>(!m||R<=m)&&(!g||R>=g)).slice(0,i||xu(20,30)).map(R=>S?Object.assign({},...S.map(N=>({[N]:R})),U(b)):R);u[f]=[...a,...M],[Ni,wn].includes(r)&&(c[f]=[...a,...M])}return{singlesRankings:l,doublesRankings:o,singlesRatings:u,doublesRatings:c}}function V5(t){let{alternatesCount:e=0,tieFormatName:i,drawSize:n}=t,r=0,a=0,s=0,o=0,l={},u={[ta]:0,[ms]:0,[Qw]:0,[Hf]:0,ANY:0};(Ki(t.tieFormat)?t.tieFormat:dm({namedFormat:i}))?.collectionDefinitions?.filter(Boolean).forEach(h=>{let{category:f,collectionId:m,matchUpType:g,matchUpCount:v,gender:y}=h;if(xp(y)){let b=Ls(y),I=v*(g===Dn?2:1);b&&u[b]<I&&(u[b]=I)}else su(y)&&(u[ta]<v&&(u[ta]=v),u[ms]<v&&(u[ms]=v));if(f){let b=JSON.stringify(f);l[b]=f}if(m||(h.collectionId=mn()),_r(Dn)(g)){let b=v;o+=v,r=Math.max(r,b)}if(_r(Rn)(g)){let b=v;s+=v,a=Math.max(a,b)}});let c=Object.keys(l).length?Math.max(s,o*2):Math.max(a,r*2),d=r*(n+e),p=a*(n+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:c,genders:u}}function l2e({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:n,participantType:r=ji}=t||{},a=n||0,s={[ms]:0,[Qw]:0,[Hf]:0,[ta]:0,ANY:0},o=0,l=0,u=0,c=0,d=0,p=({alternatesCount:f=0,uniqueParticipants:m,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:b,category:I,gender:S,stage:w})=>{let T=y===Yu,U=y===na,C=!!(m||w===qt||I||S);if(U){c=Math.max(c,v+f),b=typeof b=="object"?b:dm({namedFormat:g});let{teamSize:E,maxDoublesDraw:P,maxSinglesDraw:M,genders:R}=V5({alternatesCount:f,tieFormatName:g,tieFormat:b,drawSize:v});u=Math.max(u,E),l=Math.max(l,M),C||(o=Math.max(o,P)),Object.keys(R).forEach(N=>s[N]+=R[N])}else if(T)if(C){let E=(v+f)*2;d+=E,S&&(s[S]+=E)}else v+f&&v+f>o&&(o=v+f);else if(C){let E=v+f;S&&(s[S]+=E),d+=E}else v&&v>l&&(l=v+f)};if(e?.forEach(f=>{let{tieFormatName:m,tieFormat:g,drawProfiles:v,eventType:y,category:b,gender:I}=f;if(v)for(let S of v){let{tieFormatName:w,tieFormat:T}=S;p({...S,tieFormatName:w||m,tieFormat:T||g,eventType:y,category:b,gender:I})}}),Array.isArray(i))for(let f of i)p(f);let h=Math.max(c*u,o*2,l);return o&&(r=Ni),(n||a)<h&&(n=h),n&&o&&[Ni,na].includes(r)&&(l&&Math.floor(l/2)>o?n=Math.floor(l/2):(!l||o*2>=l)&&(n=Math.ceil(n/2))),n===void 0&&(n=!e?.length&&!i?.length?32:0),n<a&&(n=a),{uniqueParticipantsCount:d,participantsCount:n,largestTeamDraw:c,largestTeamSize:u,participantType:r,gendersCount:s}}function sfe({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:n,startDate:r,uuids:a}){if(t?.participantsCount===0)return{addedCount:0,...le};let{participantsCount:s,participantType:o,largestTeamDraw:l,largestTeamSize:u,gendersCount:c}=l2e({participantsProfile:t,eventProfiles:i,drawProfiles:n}),d=t?.teamKey,p=SD({consideredDate:r,...t,participantsCount:s,participantType:o,gendersCount:c,uuids:a}).participants,h=0,f=sd({tournamentRecord:e,participants:p});if(f.error)return f;if(h+=f.addedCount,d){let y=B5({tournamentRecord:e,...d});if(y.error)return y}let m=p.filter(({participantType:y})=>y===ji).map(Vi),g=t?.idPrefix?`${wn}-${t.idPrefix}`:void 0,v=Dt(0,l).map(y=>{let b=m.slice(y*u,(y+1)*u),I=_k({index:y,participantType:o,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:bs,individualParticipantIds:b,participantType:wn,participantId:I}});return f=sd({participants:v,tournamentRecord:e}),f.error?f:(h+=f.addedCount,{addedCount:h,...le})}function ofe({drawProfiles:t,category:e,gender:i}){let n={},r=t?.reduce((s,o)=>{let{qualifyingPositions:l=0,participantsCount:u=0,uniqueParticipants:c,stage:d=Nt,drawSize:p=0}=o||{};Object.keys(s).includes(d)||(s[d]=0);let h=(u||p)-l;return c||i||e||d===qt?(Object.keys(n).includes(d)||(n[d]=0),n[d]+=h):s[d]=Math.max(s[d],h),s},{}),a=Object.keys(n);return a.forEach(s=>r[s]+=n[s]),{stageParticipantsCount:r,uniqueParticipantsCount:n,uniqueParticipantStages:a}}function lfe({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:n}){let r=e[Nt]||0,a=e[qt]||0;return{stageParticipants:{QUALIFYING:n?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(0,a),MAIN:n?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(a,a+r)}}}var u2e={[ir]:2,[cr]:1,[sa]:1,[_a]:1,[On]:4};function j5(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:n=u2e,matchUpFormat:r=jc,pointsPerMinute:a=1,sideWeight:s=4}=t;if(!Ml({matchUpFormat:r}))return{error:Lq};if(typeof n!="object")return{error:Ee};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(s))return{error:Ee};let o=Object.keys(n).filter(E=>Object.keys(V3).includes(E)&&E!==Ur);if(Object.keys(o).reduce((E,P)=>E+n[P],0)>100)return{error:Ee,matchUpStatusProfile:n};let l=o.reduce((E,P)=>(E.pointer=E.pointer+n[P],E.valueMap.push([E.pointer,P]),E),{pointer:0,valueMap:[]}),u=xu(1,100),c=(l.valueMap.find(E=>u<=E[0])??[100,Ur])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if($s(c)){i=i||xu(1,2);let E={score:d,matchUpStatus:c,winningSide:i};if(!(c===On&&xu(1,100)>100-e))return{outcome:E}}else if([cr,sa].includes(c))return{outcome:{score:d,matchUpStatus:c}};let p=So(r),{bestOf:h=1,exactly:f,setFormat:m,finalSetFormat:g}=p??{},v=[],y=xu(0,1),b=i?[i-1]:[...Dt(0,s).map(()=>y),1-y],I=[_a,On,_l,Tv].includes(c)&&(Il(Dt(1,f||h))||1),S,w=Dt(1,(f??h)+1);for(let E of w){let P=E===(f??h),{set:M,incomplete:R,winningSideNumber:N}=c2e({setFormat:P&&g||m,incomplete:I===E,pointsPerMinute:a,matchUpStatus:c,weightedRange:b,setNumber:E});if(v.push(M),R){S=N;break}if(DC({matchUp:{score:{sets:v},matchUpFormat:r}}).calculatedWinningSide)break}let T=DC({matchUp:{score:{sets:v},matchUpFormat:r,winningSide:i}}),U=S?i||S:T.calculatedWinningSide,{score:C}=Hhe({winningSide:U,score:{sets:v},matchUpStatus:c});return{outcome:{winningSide:U,matchUpStatus:c,score:C}}}function c2e({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:n,setFormat:r,setNumber:a}){let s={setNumber:a},{setTo:o,tiebreakFormat:l,tiebreakAt:u,tiebreakSet:c,timed:d,minutes:p}=r,h=xu(0,t.length-1),f=t[h],m;if(d){let g=p*e,v=Math.round(g*.2),y=g+Il([1,-1])*v,b=YNe(y,2),I=[b,y-b];f&&I.reverse(),m=t[h]+1;let S=I[0]>I[1]&&1||I[1]>I[0]&&2||0;if(n){let[U,C]=I;return Object.assign(s,{side1Score:U,side2Score:C}),Yr.includes(i)?{set:s,incomplete:n,winningSideNumber:m}:{set:s,incomplete:n}}S||(I[xu(0,1)]+=1),S=I[0]>I[1]?1:2,S!==m&&I.reverse();let[w,T]=I;return Object.assign(s,{side1Score:w,side2Score:T,winningSide:m}),{set:s}}else{if(n)return s.side1Score=xu(0,u),s.side2Score=xu(0,u),Yr.includes(i)&&(m=t[h]+1),{set:s,incomplete:n,winningSideNumber:m};{let g=Dt(1,o+1).map(T=>Dt(0,o+2-T).map(()=>T)).flat(),v=g[xu(0,g.length-1)],y=o&&T4({isSide1:!0,tiebreakAt:u,lowValue:v,setTo:o}),b=!y,I=t.length===1&&t[h]+1;if(!b){I?(y[0]>y[1]?1:2)!==I&&y.reverse():f&&y.reverse();let[T,U]=y;Object.assign(s,{side1Score:T,side2Score:U})}let S=TC({matchUpScoringFormat:{setFormat:r},setObject:s}),w;if(S.hasTiebreakCondition||b){let{NoAD:T,tiebreakTo:U}=l||c||{},C=Dt(1,U+1).map(M=>Dt(0,U+2-M).map(()=>M)).flat(),E=C[xu(0,C.length-1)],P=iF({isSide1:!0,tiebreakNoAd:T,tiebreakTo:U,lowValue:E});if(P)if(b){let M=P[0]>P[1]?1:2;I?M!==I&&P.reverse():f&&P.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=P,w=P[0]>P[1]&&1||P[1]>P[0]&&2||void 0}else S.leadingSide===2?[s.side1TiebreakScore,s.side2TiebreakScore]=P:[s.side2TiebreakScore,s.side1TiebreakScore]=P}s.winningSide=S.winningSide||S.leadingSide||I||w}}return{set:s}}function xk(t){let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:n,tournamentRecord:r,completionGoal:a,drawDefinition:s,event:o}=t;if(!s)return{error:Ot};let l=t.matchUpFormat||s.matchUpFormat||o?.matchUpFormat,u=s.structures.slice().sort(n0),c=0,{matchUps:d,matchUpsMap:p}=Kr({matchUpFilters:{matchUpTypes:[Hn],roundNumbers:[1]},contextFilters:{stages:[Nt,qt]},inContext:!0,drawDefinition:s});if(d?.length){let v=o?.category?.ageCategoryCode||o?.category?.categoryName;if(v){let y=She({singlesOnly:!0,tournamentRecord:r,drawDefinition:s,scaleAccessor:{scaleName:v,sortOrder:"ASC",scaleType:zg},event:o});if(y.error)return y;let{lineUps:b,participantsToAdd:I}=y;sd({tournamentRecord:r,participants:I}),un({element:s,extension:{name:fm,value:b}})}else{let y=d[0]?.structureId,{positionAssignments:b}=Nn({drawDefinition:s,structureId:y});if(b?.length){let{participants:I}=dr({participantFilters:{participantTypes:[Hn]},tournamentRecord:r}),S=w=>{let T=w.tieMatchUps.filter(_r(Rn)),U=w.tieMatchUps.filter(_r(Dn));T.forEach((C,E)=>{let P=C.matchUpId;C.sides.forEach(M=>{let{drawPosition:R}=M,N=I?.find(A=>{let{participantId:_}=A;return b.find(x=>x.participantId===_)?.drawPosition===R});if(N){let A=N.individualParticipantIds?.[E];A&&Ak({teamParticipantId:N.participantId,participantId:A,tournamentRecord:r,drawDefinition:s,tieMatchUpId:P,event:o})}})}),U.forEach((C,E)=>{let P=C.matchUpId;C.sides.forEach(M=>{let{drawPosition:R}=M,N=I?.find(A=>{let{participantId:_}=A;return b.find(x=>x.participantId===_)?.drawPosition===R});N&&N.individualParticipantIds?.slice(E*2,E*2+2)?.forEach(A=>{Ak({teamParticipantId:N.participantId,participantId:A,tournamentRecord:r,drawDefinition:s,tieMatchUpId:P,event:o})})})})};d.forEach(S)}}}let h=typeof i=="string"&&i,f=h&&Ur,m=u.length===2&&u[0].finishingPosition===qy&&Dr(u.map(({stage:v})=>v),[Nt,Sr]).length===2,g=u.map(({structureId:v})=>v);for(let v of g){if(c>=a)break;let y=s.structures.find(S=>S.structureId===v),b=cn({contextFilters:{matchUpTypes:[Dn,Rn]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:s,matchUpsMap:p,structure:y,event:o}).matchUps;b.length;let I=b.filter(({winningSide:S})=>!S).sort(d0).map(Ma);for(let S of I){if(!isNaN(a)&&c>=a)break;let{matchUps:w}=cn({matchUpFilters:{matchUpTypes:[Dn,Rn]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:s,matchUpsMap:p,structure:y,event:o}),T=w.find(C=>C.matchUpId===S),U=[cr,sa].includes(T.matchUpStatus);if(T?.readyToScore&&!U){let C=d2e({matchUpStatusProfile:e,tournamentRecord:r,drawDefinition:s,targetMatchUp:T,matchUpFormat:l,matchUpStatus:f,scoreString:h,winningSide:!n&&1,event:o});if(C?.error)return C;c+=1}}m&&y.finishingPosition===qy&&t.completeRoundRobinPlayoffs&&cD({structureId:y.structureId,applyPositioning:!0,drawDefinition:s})}return{...le,completedCount:c}}function ufe(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:n,drawDefinition:r,targetMatchUp:a,matchUpStatus:s,matchUpFormat:o,scoreString:l,winningSide:u,event:c}=t;if(!a||a.matchUpStatus==="BYE")return;let{matchUpId:d}=a||{},{outcome:p}=x5({matchUpFormat:o,matchUpStatus:s,scoreString:l,winningSide:u});return e&&(p.matchUpStatusCodes=e),YR({tournamentRecord:n,policyDefinitions:i,drawDefinition:r,matchUpFormat:o,matchUpId:d,outcome:p,event:c})}function d2e(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:n,drawDefinition:r,matchUpStatus:a,matchUpFormat:s,targetMatchUp:o,scoreString:l,winningSide:u,event:c}=t;if(l||a)return ufe(t);let{matchUpId:d}=o||{},{outcome:p}=j5({matchUpStatusProfile:e,matchUpFormat:s,winningSide:u});return YR({policyDefinitions:n,tournamentRecord:i,drawDefinition:r,matchUpFormat:s,matchUpId:d,outcome:p,event:c})}function cfe({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:n,drawProfiles:r,isMock:a,event:s}){let o=Cr({event:s}).flightProfile,{eventName:l,eventType:u,category:c}=s,{startDate:d}=n,p=[],h=c?.categoryName||c?.ageCategoryCode||c?.ratingType,f=s.drawDefinitions?.map(({drawId:m})=>m);if(Array.isArray(o?.flights))for(let[m,g]of o.flights.entries()){let{drawId:v,stage:y,drawName:b,drawEntries:I}=g;p.push(g.drawId);let S=r[m],{seedsCount:w,generate:T=!0}=S||{};if(T){let U=I.filter(kl(Zh)).map(kl(Zh)),C=h||l;if(n&&w&&w<=U.length&&Dt(1,w+1).forEach((N,A)=>{let _={scaleValue:N,scaleName:C,scaleType:Nh,eventType:u,scaleDate:d},x=U[A];FR({tournamentRecord:n,participantId:x,scaleItem:_})}),f?.includes(v))break;let E=zR({...S,matchUpType:u,seedingScaleName:C,tournamentRecord:n,drawEntries:I,drawName:b,drawId:v,isMock:a,event:s,stage:y});if(E.error)return{error:E.error,drawIds:[]};let{drawDefinition:P}=E;if(!P)return{error:cu};let M=r[m]?.drawExtensions;if(Array.isArray(M)&&M.filter($p).forEach(N=>un({element:P,extension:N})),E=qR({suppressNotifications:!0,tournamentRecord:n,drawDefinition:P,event:s}),E.error)return{error:E.error,drawIds:[]};if(S?.withPlayoffs){let N=P.structures?.[0].structureId,A=HL({idPrefix:S.idPrefix,...S.withPlayoffs,tournamentRecord:n,drawDefinition:P,structureId:N,isMock:a,event:s});if(A?.error)return A}let R=S?.completionGoal;if(S?.automated!==!1&&(e||R)){let N=S?.matchUpFormat,A=xk({completeAllMatchUps:!R&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,completionGoal:R,drawDefinition:P,matchUpFormat:N,event:s});if(A.error)return{error:A.error,drawIds:[]};let _=A.completedCount;if(S?.drawType===Kh){let x=P.structures?.find(F=>F.stage===Nt);if(!x)return{error:or};let O=cD({structureId:x.structureId,tournamentRecord:n,drawDefinition:P});if(O.error)return{error:O.error,drawIds:[]};let $=R?R-(_??0):void 0;if(O=xk({completeAllMatchUps:!R&&e,completionGoal:R?$:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,drawDefinition:P,matchUpFormat:N,event:s}),O.error)return{error:O.error,drawIds:[]}}}}}return{...le,drawIds:p}}function dfe(t){let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:n,tournamentRecord:r,eventProfile:a,eventIndex:s,event:o,uuids:l}=t,{category:u,gender:c,eventType:d}=o,p=_r(Lp)(d)&&ji||_r(Yu)(d)&&Ni||d,h=i[Nt]||0,f=i[qt]||0,m=a.drawProfiles?.length?h+f:a.participantsProfile?.participantsCount??0,g=xp(c)?c:void 0,v=e?.idPrefix?`E-${s}-${e?.idPrefix}`:void 0,{participants:y}=SD({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:r?.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:m,ratingsParameters:n,category:u,idPrefix:v,sex:g}),b=sd({tournamentRecord:r,participants:y});if(b.error)return b;let I=y?.filter(({participantType:w})=>w===p),S=y?.map(Vi);return{uniqueDrawParticipants:I,uniqueParticipantIds:S}}function p2e({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:n,event:r}){let{drawType:a=Dp,qualifyingPositions:s=0,stage:o=Nt,drawSize:l=0,drawName:u,drawId:c}=n,d=l-s,p=i.slice(0,d).map(Vi);if(p.length){let m=Ep({participantIds:p,autoEntryPositions:t,entryStage:o,tournamentRecord:e,event:r});if(m.error)return m}let h=p.map(m=>({entryStatus:sl,entryStage:o,participantId:m})),f=TF({drawName:u||a,qualifyingPositions:s,drawEntries:h,drawId:c,event:r,stage:o});return f.error?f:{...le}}function pfe({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:n,drawProfiles:r,category:a,gender:s,event:o}){let l=0;for(let u of r){let{qualifyingPositions:c=0,uniqueParticipants:d,stage:p=Nt,drawSize:h=0}=u,f=h-c,m=d||s||a||p===qt,g=m?t.slice(l,l+f):i[p||Nt]||[];m&&(l+=f);let v=p2e({autoEntryPositions:e,drawParticipants:g,tournamentRecord:n,drawProfile:u,event:o});if(v.error)return v}return{...le}}function hfe(t){let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:n,completeAllMatchUps:r,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,publish:p,isMock:h,uuids:f}=t,m=c.gender,g=c.eventName,{eventType:v=Lp,policyDefinitions:y,drawProfiles:b=[],eventExtensions:I,surfaceCategory:S,tieFormatName:w,processCodes:T,discipline:U,eventLevel:C,timeItems:E,ballType:P,category:M}=c,R=c.eventId||mn(),N=c.tieFormat||(v===na?dm({namedFormat:w,event:{eventId:R,category:M,gender:m},hydrateCollections:s,isMock:h}):void 0),A=u.participants;for(let J of b)!m&&J.gender&&(m=J?.gender);let{stageParticipantsCount:_,uniqueParticipantsCount:x,uniqueParticipantStages:O}=ofe({drawProfiles:b,category:M,gender:m}),$=_r(Lp)(v)&&ji||_r(Yu)(v)&&Ni||v,{uniqueDrawParticipants:F=[],uniqueParticipantIds:j=[]}=O?dfe({event:{eventType:v,category:M,gender:m},uniqueParticipantsCount:x,participantsProfile:n,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,uuids:f}):{},{eventAttributes:H}=c;typeof H!="object"&&(H={});let G=M?.categoryName||M?.ageCategoryCode||M?.ratingType;g=g||G||"Generated Event";let W={...H,surfaceCategory:S,processCodes:T,discipline:U,eventLevel:C,eventName:g,eventType:v,tieFormat:N,ballType:P,category:M,eventId:R,gender:m};if(I?.length&&Array.isArray(I)){let J=I.filter($p);J?.length&&Object.assign(W,{extensions:J})}if(Array.isArray(E)&&E.forEach(J=>y0({event:K,timeItem:J})),typeof y=="object")for(let J of Object.keys(y))Jy({policyDefinitions:{[J]:y[J]},event:W});W.category&&(W.category.categoryName=G);let q,Z=mD({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:W});if(Z.error)return Z;let K=Z?.event,{stageParticipants:Q}=lfe({allUniqueParticipantIds:e,stageParticipantsCount:_,eventParticipantType:$,targetParticipants:A});if(b?.length){let J=pfe({uniqueDrawParticipants:F,autoEntryPositions:a,stageParticipants:Q,tournamentRecord:u,drawProfiles:b,category:M,gender:m,event:K});if(J.error)return J;let ne=cfe({matchUpStatusProfile:i,completeAllMatchUps:r,randomWinningSide:o,tournamentRecord:u,drawProfiles:b,isMock:h,event:K});if(ne.error)return ne;q=ne.drawIds}else if(c?.participantsProfile?.participantsCount){let J=F.map(Vi);if(J.length){let ne=Ep({participantIds:J,autoEntryPositions:a,tournamentRecord:u,entryStage:Nt,event:K});if(ne.error)return ne}}return p&&vD({tournamentRecord:u,event:K}),{drawIds:q,eventId:R,uniqueParticipantIds:j}}function G5({tournamentRecords:t,scheduleDate:e,venueId:i,round:n}){if(!nl(e))return{error:ja};let r="addSchedulingProfileRound",{extension:a}=_i({name:dw,tournamentRecords:t,discover:!0}),s=a?.value||[],o=s.find(p=>zh(e,p.scheduleDate));if(!o){let{startDate:p,endDate:h}=aF({tournamentRecords:t}),f=new Date(e);if(p&&f<new Date(p)||h&&f>new Date(h))return{error:ja};o={scheduleDate:e,venues:[]},s.push(o)}let l=o.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},o.venues.push(l));let u=["notBeforeTime"],c=p=>Object.keys(p).filter(h=>!u.includes(h)).sort().map(h=>Ki(p[h])?c(p[h]):p[h]).flat().join("|");if(l.rounds.find(p=>c(p)===c(n)))return ce({result:{error:wse},stack:r});l.rounds.push(n);let d=hD({tournamentRecords:t,schedulingProfile:s});return d.error?d:{...le}}function h2e({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:Ee};let i=rD({tournamentRecord:e}).containedStructures,n=Za({tournamentRecord:e}).matchUps??[],{tournamentId:r}=e,a=[];for(let s of t){let{scheduleDate:o,venues:l=[]}=s;for(let u of l){let{rounds:c,venueId:d}=u;for(let p of c){let{drawId:h,winnerFinishingPositionRange:f,roundSegment:m}=p,g=n.filter(v=>{let y=f?.indexOf("-")>0&&f.split("-").map(I=>+I),b=v.finishingPositionRange?.winner;return v.drawId===h&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!b||!y||Dr(b,y).length===2||wi(b).length===wi(y).length&&Dr(b,y).length===wi(b).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:b,structureName:I,roundName:S}=g,w=g.structureId;y&&!f&&(w=Object.keys(i).find(C=>i[C].includes(w))??w);let T={tournamentId:r,structureId:w,roundNumber:y,roundSegment:m,eventId:v,drawId:h},U=G5({tournamentRecords:{[r]:e},round:T,scheduleDate:o,venueId:d});if(U.error)return U;a.push({structureName:I,roundName:S,drawName:b,...T})}}}}return{scheduledRounds:a}}function LF(t){let e=zt(t,[{drawProfile:!0,_ofType:Qo}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:n={},matchUpStatusProfile:r,completeAllMatchUps:a,autoEntryPositions:s,hydrateCollections:o,randomWinningSide:l,ratingsParameters:u,tournamentRecord:c,isMock:d=!0,drawProfile:p,startDate:h,drawIndex:f,uuids:m}=t,g=Ct(p,!1,!0),{excessParticipantAlternates:v=!0,matchUpFormat:y=jc,drawType:b=Dp,tournamentAlternates:I=0,alternatesCount:S=0,qualifyingPositions:w,qualifyingProfiles:T,generate:U=!0,eventExtensions:C,drawExtensions:E,completionGoal:P,tieFormatName:M,buildTeams:R,seedsCount:N,timeItems:A,drawName:_,category:x,idPrefix:O,publish:$,gender:F,stage:j}=g,H=g.drawSize||(g.ignoreDefaults?void 0:32),G=g.eventId||mn(),W=p.eventType||p.matchUpType||Lp,q=W===Yu?Ni:ji,Z=Ki(p.tieFormat)&&p.tieFormat||W===wn&&dm({event:{eventId:G,category:x,gender:F},namedFormat:M,hydrateCollections:o,isMock:d})||void 0,K=x?.categoryName||x?.ageCategoryCode||x?.ratingType,Q=p.eventName||K||`Generated ${W}`,J=c?.participants||[],ne=(T?.map(Xe=>Xe.structureProfiles||[]).flat().reduce((Xe,gt)=>{let ht=!gt.participantsCount||gt.participantsCount>gt.drawSize?gt.drawSize:gt.participantsCount||0;return Xe+ht},0)||0)*(q===Ni?2:1),re=(!p.participantsCount||p.participantsCount>H?H:p.participantsCount)||0,oe={eventName:Q,eventType:W,tieFormat:Z,category:x,eventId:G,gender:F};Array.isArray(A)&&A.forEach(Xe=>y0({event:oe,timeItem:Xe}));let{eventAttributes:de}=p;if(typeof de!="object"&&(de={}),Object.assign(oe,de),C?.length&&Array.isArray(C)){let Xe=C.filter($p);Xe?.length&&Object.assign(oe,{extensions:Xe})}let se=[];if(n?.participantsCount===0||p.uniqueParticipants||ne||!c||F||x){let Xe=(re||0)+S+ne,gt=Xe,ht={[ta]:0,[ms]:0},_e,Ye;W===wn&&({teamSize:_e,genders:Ye}=V5({alternatesCount:S,tieFormatName:M,tieFormat:Z,drawSize:H}),Object.keys(Ye).forEach(pt=>{let Se=Ls(pt);Se&&xp(pt)&&Ye[Se]&&(ht[Se]=H*Ye[Se])}),gt=_e*((H||0)+ne));let Je=n?.idPrefix?`D-${f}-${n?.idPrefix}`:void 0,ct=SD({...n,scaledParticipantsCount:p.scaledParticipantsCount||n.scaledParticipantsCount,participantsCount:gt,consideredDate:c?.startDate,sex:F||n?.sex,rankingRange:p.rankingRange,uuids:p.uuids||m,ratingsParameters:u,participantType:q,gendersCount:ht,idPrefix:Je,category:x}).participants;if(oe.category&&(oe.category.categoryName=K),c){let pt=sd({participants:ct,tournamentRecord:c});if(pt.error)return pt}if(ct.forEach(({participantId:pt})=>se.push(pt)),J=ct,W===wn){let pt=Ye[ta]?ct.filter(({participantType:rt,person:St})=>rt===ji&&St?.sex===ta).map(Vi):[],Se=Ye[ms]?ct.filter(({participantType:rt,person:St})=>rt===ji&&yy(St?.sex)).map(Vi):[],he=ct.filter(({participantType:rt})=>rt===ji).map(Vi).filter(rt=>!pt.includes(rt)&&!Se.includes(rt)),we=[...g.teamNames??[],...kk({count:Xe}).names],be=_e-(Ye[ta]+Ye[ms]),Ae=0,ze=0,We=0,Le=Dt(0,Xe).map(rt=>{let St=Se.slice(Ae,Ae+Ye[ms]),si=pt.slice(ze,ze+Ye[ta]),Qe=he.slice(We,We+be);Ae+=Ye[ms],ze+=Ye[ta],We+=be;let bt=R!==!1?[...St,...si,...Qe]:[];return{participantName:we[rt]||`Team ${rt+1}`,participantOtherName:`TM${rt+1}`,participantRole:bs,individualParticipantIds:bt,participantType:wn,participantId:mn()}}),ft=sd({participants:Le,tournamentRecord:c});if(!ft.success)return ft;J=Le}}let ge=Xe=>{let{participantType:gt}=Xe;return _r(Lp)(W)&&gt===ji||_r(Yu)(W)&&gt===Ni?!0:W===wn&&gt===wn},ye=Xe=>!p.gender||Xe.person?.sex===p.gender?!0:Xe.individualParticipantIds?.some(gt=>{let ht=J.find(_e=>_e.participantId===gt);return ht&&ye(ht)}),Te=J.filter(ge).filter(ye).filter(({participantId:Xe})=>!i.includes(Xe)),De=Te.slice(0,re).map(Xe=>Xe.participantId);if(d&&De?.length){let Xe=Ep({autoEntryPositions:s,entryStage:j,tournamentRecord:c,participantIds:De,event:oe});if(Xe.error)return Xe}let xe=ne?Te.slice(re,re+ne).map(Xe=>Xe.participantId):0;if(d&&xe?.length){let Xe=0,gt=1,ht=(Ye,Je)=>Ye.stageSequence-Je.stageSequence,_e=(Ye,Je)=>Ye.roundTarget-Je.roundTarget;for(let Ye of T.sort(_e)){gt=Ye.roundTarget||gt;let Je=1,ct;for(let pt of Ye.structureProfiles.sort(ht)){let Se=(pt.drawSize||Pq(pt.participantsCount))-(ct||0),he=xe.slice(Xe,Xe+Se),we=Ep({entryStage:qt,entryStageSequence:Je,autoEntryPositions:s,tournamentRecord:c,participantIds:he,roundTarget:gt,event:oe});if(we.error)return we;ct=pt.qualifyingPositions,Xe+=Se,Je+=1}gt+=1}}let Me=v&&c?.participants?.filter(({participantId:Xe})=>!De.includes(Xe)).filter(ge).filter(ye).slice(0,S||H-re||I).map(Xe=>Xe.participantId);if(d&&Me?.length){let Xe=Ep({participantIds:Me,autoEntryPositions:!1,entryStatus:Hc,tournamentRecord:c,event:oe});if(Xe.error)return Xe.error}let Oe=K||Q;c&&N&&N<=De.length&&Dt(1,N+1).forEach((Xe,gt)=>{let ht={scaleName:Oe,scaleDate:h,scaleType:hW,scaleValue:Xe,eventType:W},_e=De[gt];FR({tournamentRecord:c,participantId:_e,scaleItem:ht})});let at=zR({...Ct(p,!1,!0),tournamentRecord:c,seedingScaleName:Oe,matchUpFormat:y,eventId:G,isMock:d,event:oe});if(at.error)return at;if(!at.drawDefinition)return{error:cu};let{drawDefinition:Fe}=at,mt=Fe.drawId;if(Array.isArray(E)&&E.filter($p).forEach(Xe=>un({element:Fe,extension:Xe})),U){if(qR({drawDefinition:Fe,event:oe,suppressNotifications:!0}),p.withPlayoffs){let gt=Fe.structures?.[0].structureId,ht=HL({...p.withPlayoffs,tournamentRecord:c,drawDefinition:Fe,structureId:gt,idPrefix:O,isMock:d,event:oe});if(ht?.error)return ht}let Xe=p.automated===!1;if(d&&!Xe){let gt=ht=>{let _e=xk({completeAllMatchUps:ht.completeAllMatchUps,completionGoal:ht.completionGoal,matchUpStatusProfile:r,randomWinningSide:l,tournamentRecord:c,drawDefinition:Fe,matchUpFormat:y,event:oe});if(_e.error)return _e;let Ye=_e.completedCount;if(b===Kh){let Je=Fe.structures?.find(Se=>Se.stage===Nt);if(!Je)return{error:or};cD({structureId:Je.structureId,tournamentRecord:c,drawDefinition:Fe});let ct=P?P-(Ye??0):void 0,pt=xk({completionGoal:P?ct:void 0,matchUpStatusProfile:r,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:c,drawDefinition:Fe,matchUpFormat:y,event:oe});if(pt.error)return pt}};if(P&&gt({completionGoal:P}),p.outcomes){let{matchUps:ht}=uo({inContext:!0,drawDefinition:Fe,event:oe});for(let _e of p.outcomes){let{matchUpStatus:Ye=Ur,matchUpStatusCodes:Je,stageSequence:ct=1,matchUpIndex:pt=0,structureOrder:Se,matchUpFormat:he,drawPositions:we,roundPosition:be,stage:Ae=Nt,roundNumber:ze,winningSide:We,scoreString:Le}=_e,ft=ht?.reduce((Qe,bt)=>{let{structureId:ci,matchUpId:Tt}=bt;return Qe[ci]?Qe[ci].push(Tt):Qe[ci]=[Tt],Qe},{})??[],rt=Object.assign({},...Object.keys(ft).map((Qe,bt)=>({[Qe]:bt+1}))),St=ht?.filter(Qe=>(!Ae||Qe.stage===Ae)&&(!ct||Qe.stageSequence===ct)&&(!ze||Qe.roundNumber===ze)&&(!be||Qe.roundPosition===be)&&(!Se||rt[Qe.structureId]===Se)&&(!we||Dr(we,Qe.drawPositions).length===2))?.[pt],si=ufe({matchUpStatusCodes:Je,tournamentRecord:c,drawDefinition:Fe,targetMatchUp:St,matchUpFormat:he,matchUpStatus:Ye,scoreString:Le,winningSide:We});if(si?.error)return si}}a&&gt({completeAllMatchUps:a})}$&&vD({tournamentRecord:c,event:oe})}else{let Xe=TF({drawEntries:Fe.entries,drawName:_||b,qualifyingPositions:w,drawId:mt,event:oe,stage:j});if(Xe.error)return Xe}return{...le,event:Vt(oe),uniqueParticipantIds:se,targetParticipants:J,drawDefinition:Fe,eventId:G,drawId:mt}}var ffe=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),f2e=ffe;function Ok(t){return parseInt(t)}function aJ({startTime:t="",endTime:e=""}={}){if(!t||!e||!by.test(t)||!by.test(e))return!1;let[i,n]=t.split(":").map(Ok),[r,a]=e.split(":").map(Ok);return r<i?!1:!(i===r&&a<n)}function m2e(t,e){let[i,n]=t.startTime.split(":").map(Ok),[r,a]=e.startTime.split(":").map(Ok);return i<r?-1:i>r?1:n<a?-1:n>a?1:0}function mfe({dateAvailability:t}){if(!t)return{error:Ose};if(!Array.isArray(t))return{error:n_};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let n of t){if(typeof n!="object")return{error:n_};let{date:r,startTime:a,endTime:s,bookings:o=[]}=n;if(!a||!s)return{error:n_};if(r&&!Op.test(r))return{error:ja,dateAvailability:{date:r},info:e};if(!by.test(a))return{error:Dc,dateAvailability:{startTime:a},info:i};if(!by.test(s))return{error:Dc,dateAvailability:{endTime:s},info:i};if(a===s)return{error:Dc,dateAvailability:{startTime:a,endTime:s},info:"startTime and endTime are equivalent"};if(!aJ({startTime:a,endTime:s}))return{error:Dc,dateAvailability:{startTime:a,endTime:s},info:"endTime must be after startTime"};if(o){if(!Array.isArray(o))return{error:sk};for(let l of o){if(typeof l!="object")return{error:sk};let{startTime:u,endTime:c}=l;if(!by.test(u))return{error:Dc,booking:{startTime:u},info:i};if(!by.test(c))return{error:Dc,booking:{endTime:c},info:i};if(u===c)return{error:Dc,dateAvailability:{startTime:u,endTime:c},info:"startTime and endTime are equivalent"};if(!aJ({startTime:u,endTime:c}))return{error:Dc,dateAvailability:{startTime:u,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function FF({tournamentRecord:t,disableNotice:e,venueId:i,courtId:n,court:r}){let{venue:a}=mf({tournamentRecord:t,venueId:i});if(!a)return{error:Zw};a.courts||(a.courts=[]);let s={...ffe(),venueId:i,courtId:n};if(s.courtId||(s.courtId=mn()),a.courts.some(o=>o.courtId===s.courtId))return{error:Qse};{let o=(r?.dateAvailability||[]).map(c=>({...c,date:Pi(c.date),startTime:Jn(c.startTime),endTime:Jn(c.endTime),bookings:c.bookings?.map(({startTime:d,endTime:p,bookingType:h})=>({startTime:Jn(d),endTime:Jn(p),bookingType:h}))})),l=Object.keys(s);for(let c of l)if(r?.[c])if(c==="dateAvailability"){let d=mfe({dateAvailability:o});if(!d.valid&&d.error)return d;s.dateAvailability=o}else s[c]=r[c];let u=s;return a.courts.push(u),e||Ti({payload:{venue:a,tournamentId:t.tournamentId},topic:Eb,key:a.venueId}),{...le,court:Ct(s),venueId:i}}}function H5(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:bv};let n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r=[],a;for(let s of Object.values(n)){let{venue:o}=mf({tournamentRecord:s,venueId:i});if(o){let l=g2e({...t,tournamentRecord:s});for(let u of l?.courts??[])r.push(u?.courtId);if(l.error)return l;a=!0}}return a?{...le,courtIds:r}:{error:Zw}}function g2e({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:n,courtNames:r=[],courtTimings:a,courtsCount:s,startTime:o,courtIds:l,endTime:u,idPrefix:c,venueId:d,dates:p}){if(!d)return{error:bv};let h=mf({tournamentRecord:n,venueId:d});if(h.error)return h;let{venue:f}=h;if(!br(s)||!r)return{error:Jse};s=s??r.length;let m=Dt(0,s).map(g=>{let v=a?.[g],y=v?p.map(b=>({date:Vc(b),startTime:o,endTime:u,...v})):e;return v&&o&&u&&y.push({startTime:o,endTime:u}),{courtName:r[g]||i&&f?.venueAbbreviation&&`${f?.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=l?.pop()||c&&`${c}-${v+1}`;return FF({disableNotice:!0,tournamentRecord:n,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return m.length!==s?ce({info:"not all courts could be generated",result:{error:Ee}}):(f&&Ti({payload:{venue:f,tournamentId:n.tournamentId},topic:Eb,key:f.venueId}),{...le,courts:Ct(m)})}function z5({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:n}){let{startDate:r,endDate:a}=t,s=[];for(let[o,l]of i.entries()){let{venueAbbreviation:u,venueId:c=n?.pop()??mn(),dateAvailability:d,startTime:p="07:00",endTime:h="19:00",courtTimings:f,courtsCount:m,courtNames:g,venueName:v,idPrefix:y,courtIds:b}=l,I={venueName:v||`Venue ${o+1}`,venueAbbreviation:u,venueId:c},S=gR({tournamentRecord:t,venue:I});if(S.error){if(e)continue;return S}s.push(c);let w=RT(r,a),T=!Array.isArray(d)&&[{startTime:p,endTime:h}].concat(w.map(U=>({date:Vc(U),startTime:p,endTime:h})));if(m||g){let U=H5({dateAvailability:d||T,tournamentRecord:t,courtTimings:f,courtsCount:m,courtNames:g,startTime:p,idPrefix:y,courtIds:b,endTime:h,venueId:c,dates:w});if(U.error)return U}}return s}function v2e(t){let{tournamentRecord:e,leagueProfiles:i,eventIds:n,venueIds:r,drawIds:a,allUniqueParticipantIds:s,uuids:o}=t,l=0;for(let c of i){let d=[],{tieFormatName:p=pk,teamProfiles:h=[],teamsCount:f=0,category:m,idPrefix:g,gender:v}=c,y=c.leagueName??c.eventName??`League ${l+1}`,b=c.leagueId??c.eventId??o?.pop()??mn();n.push(b);let I=Ki(c.tieFormat)&&c.tieFormat||dm({event:{eventId:b,category:m,gender:v},namedFormat:p,isMock:t.isMock})||void 0;if(!I)return{error:qU};let S=Math.max(f,h.length),w=Dt(0,S),{genders:T,teamSize:U}=V5({tieFormat:I,drawSize:S}),C={[ms]:0,[Qw]:0,[Hf]:0,[ta]:0,ANY:0};Object.keys(T).forEach(P=>C[P]+=T[P]);for(let P of w){let M=h?.[P]?.teamName??`Team ${P+1}`,R=h?.[P]?.teamId||o?.pop()||mn(),N=c.startDate??t.startDate,A=SD({...c?.participantsProfile,participantsCount:U,consideredDate:N,gendersCount:C,category:m,uuids:o}).participants,_=A.map(H=>H.participantId),x=wn,O=R??_k({participantType:x,idPrefix:g,index:P,uuids:o});d.push({participantId:O,entryStatus:sl,entryStage:Nt});let $=h?.[P]?.venueIds??[],F={participantId:O,participantRole:bs,participantName:M,individualParticipantIds:_,participantType:x,homeVenueIds:$};$.forEach(H=>!r.includes(H)&&r.push(H)),s.push(..._),s.push(O);let j=sd({participants:[F,...A],tournamentRecord:e});if(j.error)return j}let E={eventName:y,entries:d,eventType:wn,tieFormat:I,category:m,eventId:b,gender:v};if(e.events||(e.events=[]),e.events.push(E),d.length){let P=(br(c.roundsCount)&&c.roundsCount)??c.roundsCount===P_e?(S-1)*2:S-1,M=zR({automated:c.automated,tournamentRecord:e,drawType:Al,roundsCount:P,drawSize:S,event:E});if(M.error)return M;let{drawDefinition:R}=M;if(R){let N=R?.drawId;qR({drawDefinition:R,event:E,suppressNotifications:!0}),a.push(N)}}l++}let u=r.map(c=>({venueId:c}));z5({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:u,uuids:o})}var y2e=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function gfe(t){let{startDate:e,endDate:i}=t??{},{tournamentName:n=Il(y2e),ratingsParameters:r=Ca,tournamentExtensions:a,policyDefinitions:s,schedulingProfile:o,venueProfiles:l,uuids:u}=t??{},c=t?.isMock===!1?void 0:!0;if(e&&!nl(e)||i&&!nl(i))return{error:ja};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:Ee};if(!e){let y=new Date;e=Vc(i??y),i=Vc(y.setDate(y.getDate()+7))}if(!i){let y=new Date(e);i=Vc(y.setDate(y.getDate()+7))}let d=OF({...t.tournamentAttributes??{},tournamentName:n,startDate:e,endDate:i,isMock:c}),p=l?.length?z5({tournamentRecord:d,venueProfiles:l,uuids:u}):[];if(a?.length&&Array.isArray(a)){let y=a.filter(b=>$p({extension:b}));y?.length&&Object.assign(d,{extensions:y,isMock:c})}if(typeof s=="object")for(let y of Object.keys(s))Jy({policyDefinitions:{[y]:s[y]},tournamentRecord:d});if(!t?.leagueProfiles?.length||t.eventProfiles?.length||t.drawProfiles?.length||t.participantsProfile){let y=sfe({tournamentRecord:d,...t});if(!y.success)return y}let h=[],f=[],m=[];if(t.leagueProfiles){let y=v2e({allUniqueParticipantIds:h,tournamentRecord:d,...t,eventIds:f,venueIds:p,drawIds:m});if(y?.error)return y}if(t.drawProfiles){let y=b2e({allUniqueParticipantIds:h,ratingsParameters:r,tournamentRecord:d,...t,eventIds:f,drawIds:m});if(y?.error)return y}if(t.eventProfiles){let y=I2e({allUniqueParticipantIds:h,ratingsParameters:r,tournamentRecord:d,...t,eventIds:f,drawIds:m});if(y?.error)return y}let{scheduledRounds:g=void 0,schedulerResult:v={}}=o?w2e({...t,tournamentRecord:d}):{};return n3(),Vt({...le,tournamentRecord:d,scheduledRounds:g,schedulerResult:v,eventIds:f,venueIds:p,drawIds:m})}function b2e(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:n,eventIds:r,drawIds:a}=t,s=0;for(let o of i){let l=LF({allUniqueParticipantIds:n,tournamentRecord:e,drawProfile:o,drawIndex:s,...t});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if(o?.addEvent!==!1){if(l=mD({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;u&&a.push(u),r.push(c)}p?.length&&n.push(...p),s+=1}}function I2e(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:n,drawIds:r}=t,a=0;for(let s of e){let o=hfe({...t,eventIndex:a,eventProfile:s});if(o.error)return o;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=o;u&&r.push(...u),n.push(l),c?.length&&i.push(...c),a+=1}}function w2e(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:n,periodLength:r,scheduleCompletedMatchUps:a}=t,s=h2e({schedulingProfile:e,tournamentRecord:i});if(s.error)return s;let o=s.scheduledRounds;if(n){let{tournamentId:l}=i,u={[l]:i};return{schedulerResult:xF({scheduleCompletedMatchUps:a,tournamentRecords:u,periodLength:r}),scheduledRounds:o}}return{scheduledRounds:o}}var vfe={};Fi(vfe,{anonymizeTournamentRecord:()=>yfe,modifyTournamentRecord:()=>bfe});function yfe({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:n,personIds:r=[],tournamentId:a}){if(!i)return{error:ot};let s=Array.isArray(t)?gX.concat(...t):gX,o=O=>Array.isArray(t)?O?.extensions?.filter($=>s.includes($.name)):O?.extensions,l={};i.extensions=o(i);let u=a||mn();l[i.tournamentId]=u,i.tournamentId=u,i.createdAt=new Date().toISOString(),i.tournamentName=n||`Anonymized: ${Vc(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let O of i.participants||[]){O.extensions=o(O),O.onlineResources=[];let $=mn();l[O.participantId]=$,O.participantId=$}for(let O of i.participants||[])Array.isArray(O.individualParticipantIds)&&(O.individualParticipantIds=O.individualParticipantIds.map($=>l[$]));let c=0;for(let O of i.venues||[]){O.venueAbbreviation=`V${c}`,O.extensions=o(O),O.venueName=`Venue #${c}`,O.onlineResources=[],O.addresses=[];let $=mn();l[O.venueId]=$,O.isMock=!0,c+=1;let F=0;for(let j of O.courts||[])j.courtName=`V${c}C${F}`,j.extensions=o(j),j.onlineResources=[],j.isMock=!0,F+=1}let d=1;for(let O of i.events||[]){O.extensions=o(O),O.onlineResources=[],O.isMock=!0;let $=mn();l[O.eventId]=$,O.eventId=$;let F=O.category?.categoryName||O.category?.ageCategoryCode||O.category?.ratingType||O.gender;if(O.eventName=`Event ${d} ${F}`,Array.isArray(O.entries))for(let H of O.entries)H.participantId=l[H.participantId];for(let H of O.drawDefinitions||[]){H.extensions=o(H);let G=mn();if(l[H.drawId]=G,H.drawId=G,H.isMock=!0,Array.isArray(H.entries))for(let q of H.entries)q.participantId=l[q.participantId];let W=q=>{q.extensions=o(q);let Z=mn();l[q.structureId]=Z,q.structureId=Z;for(let K of q.positionAssignments||[])K.participantId&&(K.participantId=l[K.participantId]);for(let K of q.seedAssignments||[])K.participantId&&(K.participantId=l[K.participantId]);for(let K of q.matchUps||[]){K.isMock=!0;for(let Q of K.sides||[])Q.lineUp&&(Q.lineUp=Q.lineUp.map(({participantId:J,collectionAssignments:ne})=>({participantId:l[J],collectionAssignments:ne})))}};for(let q of H.structures||[])if(W(q),Array.isArray(q.structures))for(let Z of q.structures)W(Z);for(let q of H.links||[])q.source.structureId=l[q.source.structureId],q.target.structureId=l[q.target.structureId]}let{extension:j}=_i({name:nd,element:O});Array.isArray(j?.value?.flights)&&j?.value.flights?.forEach(H=>{if(H.drawId=l[H.drawId],Array.isArray(H.drawEntries))for(let G of H.drawEntries)G.participantId=l[G.participantId]}),d+=1}let p=i.startDate||Vc(new Date),h=(i.participants||[]).filter(({participantType:O})=>O===ji),f=h.reduce((O,$)=>{let F=$.person?.sex,j=Ls(F);return j&&xp(F)?O[j]+=1:O[Hf]+=1,O},{[ta]:0,[ms]:0,[Hf]:0}),m=Object.assign({},...Object.keys(f).map(O=>({[O]:afe({category:{ageCategoryCode:"O18"},count:f[O],personExtensions:[],consideredDate:p,sex:O})?.persons||[]}))),g={[ta]:0,[ms]:0,[Hf]:0},v=h.length,y=h.reduce((O,$)=>{let F=$.person?.addresses?.[0]||{},{city:j,state:H,postalCode:G}=F;return O.cities.includes(j)||O.cities.push(j),O.states.includes(H)||O.states.push(H),O.postalCodes.includes(G)||O.postalCodes.push(G),O},{cities:[],postalCodes:[],states:[]}),b=y.postalCodes.length,I=y.cities.length,S=y.states.length,{cities:w}=tfe({count:I||v,participantsCount:v}),{states:T}=ife({count:S||v,participantsCount:v}),{postalCodes:U}=nfe({count:b||v,participantsCount:v}),C={cities:w,states:T,postalCodes:U};h.forEach((O,$)=>{let F=O?.person,j=F?.sex||Hf,H=Pi(F?.birthDate)?.split("-")[0],G=g[j],W=m[j][G];if(g[j]+=1,H){let[,q,Z]=W?.birthDate?.split("-")||[],K=[H,q,Z].join("-");W.birthDate=K}if(F?.addresses){let q=rfe({...C,participantIndex:$,nationalityCode:W.nationalityCode});W.addresses=[q]}W.personId=r?.[$]||mn(),e?(W.standardFamilyName=W.lastName,W.standardGivenName=W.firstName,O.participantName=`${W.standardGivenName} ${W.standardFamilyName}`):(W.standardFamilyName=F?.standardFamilyName,W.standardGivenName=F?.standardGivenName),delete W.firstName,delete W.lastName,W.extensions=o(F),O.person=W,l[F?.personId]=W.personId}),(i.participants||[]).filter(({participantType:O})=>O===Ni).forEach(O=>{let{individualParticipantIds:$}=O;O.participantName=S2e({individualParticipantIds:$,individualParticipants:h})});let E=(i.participants||[]).filter(({participantType:O})=>O===wn),P=E.length,M=kk({count:P}).names;E.forEach((O,$)=>{O.participantName=M[$]});let R=(i.participants||[]).filter(({participantType:O})=>O===Iu),N=R.length,A=kk({count:N,nameRoot:"Group"}).names;R.forEach((O,$)=>{O.participantName=A[$]});let{extension:_}=_i({element:i,name:dw});Array.isArray(_?.value)&&_?.value.forEach(O=>{O.tournamentId=l[O.tournamentId],O.structureId=l[O.structureId],O.eventId=l[O.eventId],O.drawId=l[O.drawId]});let{extension:x}=_i({element:i,name:iD});return Array.isArray(x?.value)&&x?.value.forEach(O=>{O.personId=l[O.personId]}),{...le}}function S2e({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:n})=>t.includes(n)).map(({person:n})=>n?.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function bfe(t){let{ratingsParameters:e=Ca,participantsProfile:i={},matchUpStatusProfile:n,completeAllMatchUps:r,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,schedulingProfile:l,tournamentRecord:u,autoSchedule:c,eventProfiles:d,periodLength:p,venueProfiles:h,drawProfiles:f,isMock:m,uuids:g}=t;if(!u)return{error:ot};let v=[],y=[],b=[];d?.forEach(C=>{let E=u.events?.find((P,M)=>C.eventIndex!==void 0&&M===C.eventIndex||C.eventName&&P.eventName===C.eventName||C.eventId&&P.eventId===C.eventId);E?.gender&&(C.gender=E.gender)});let I=u.participants?.length||void 0;I&&i?.idPrefix&&(i.idPrefix=`${i.idPrefix}-${I}`);let S=sfe({startDate:u.startDate,participantsProfile:i,tournamentRecord:u,eventProfiles:d,drawProfiles:f,uuids:g});if(!S.success)return S;if(d){let C=u.events?.length||0;for(let E of d){let{ratingsParameters:P}=E,M=u.events?.find((R,N)=>E.eventIndex!==void 0&&N===E.eventIndex||E.eventName&&R.eventName===E.eventName||E.eventId&&R.eventId===E.eventId);if(M){let{gender:R,category:N,eventType:A}=M,{drawProfiles:_,publish:x}=E,O=_r(Lp)(A)&&ji||_r(Yu)(A)&&Ni||A;if(_){let{stageParticipantsCount:$,uniqueParticipantsCount:F,uniqueParticipantStages:j}=ofe({drawProfiles:_,category:N,gender:R}),{uniqueDrawParticipants:H=[],uniqueParticipantIds:G=[]}=j?dfe({event:{eventType:A,category:N,gender:R},uniqueParticipantsCount:F,participantsProfile:i,ratingsParameters:P,tournamentRecord:u,eventProfile:E,uuids:g}):{};v.push(...G);let{stageParticipants:W}=lfe({targetParticipants:u.participants||[],allUniqueParticipantIds:v,stageParticipantsCount:$,eventParticipantType:O}),q=pfe({uniqueDrawParticipants:H,autoEntryPositions:a,stageParticipants:W,tournamentRecord:u,drawProfiles:_,category:N,gender:R,event:M});if(q.error||(q=cfe({matchUpStatusProfile:n,completeAllMatchUps:r,randomWinningSide:o,tournamentRecord:u,drawProfiles:_,isMock:m,event:M}),q.error))return q;b.push(...q.drawIds)}x&&vD({tournamentRecord:u,event:M})}else{let R=hfe({startDate:u.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:n,participantsProfile:i,completeAllMatchUps:r,autoEntryPositions:a,randomWinningSide:o,ratingsParameters:P,tournamentRecord:u,eventProfile:E,eventIndex:C,uuids:g});if(R.error)return R;let{eventId:N,drawIds:A,uniqueParticipantIds:_}=R;A&&b.push(...A),y.push(N),_?.length&&v.push(..._),C+=1}}}if(f){let C=(u.events||[]).map(E=>E.drawDefinitions?.map(()=>1)||[]).flat().reduce((E,P)=>E+P,0);for(let E of f){let P=LF({startDate:u.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:n,participantsProfile:i,completeAllMatchUps:r,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,ratingsParameters:e,tournamentRecord:u,drawProfile:E,drawIndex:C,uuids:g});if(P.error)return P;let{drawId:M,eventId:R,event:N,uniqueParticipantIds:A}=P;if(P=mD({tournamentRecord:u,event:N,internalUse:!0}),P.error)return P;M&&b.push(M),y.push(R),A?.length&&v.push(...A),C+=1}}let w=h?.length?z5({tournamentRecord:u,venueProfiles:h}):[],T,U={};if(l?.length){let C={[u.tournamentId]:u},E=hD({tournamentRecords:C,schedulingProfile:l});if(E.error)return E;if(c){let{tournamentId:P}=u,M={[P]:u};U=xF({tournamentRecords:M,periodLength:p})}}return{totalParticipantsCount:u.participants.length,scheduledRounds:T,schedulerResult:U,...le,eventIds:y,venueIds:w,drawIds:b}}var q5={};Fi(q5,{addDynamicRatings:()=>h4,addIndividualParticipantIds:()=>PF,addParticipant:()=>jp,addParticipants:()=>sd,addPenalty:()=>Bfe,addPersonRequests:()=>Dfe,addPersons:()=>Vfe,createGroupParticipant:()=>Nfe,createTeamsFromParticipantAttributes:()=>B5,deleteParticipants:()=>h0,filterParticipants:()=>SR,findParticipant:()=>Mfe,getCompetitionParticipants:()=>C4,getPairedParticipant:()=>ad,getParticipantEventDetails:()=>R4,getParticipantMembership:()=>M4,getParticipantScaleItem:()=>jT,getParticipantSchedules:()=>N4,getParticipantSignInStatus:()=>A4,getParticipantTimeItem:()=>rW,getParticipants:()=>dr,getScaleValues:()=>eD,mergeParticipants:()=>$fe,modifyIndividualParticipantIds:()=>Efe,modifyParticipant:()=>CF,modifyParticipantName:()=>Afe,modifyParticipantOtherName:()=>Cfe,modifyParticipantsSignInStatus:()=>Pfe,modifyPenalty:()=>Lfe,modifyPersonRequests:()=>Tfe,mutate:()=>Ife,participantScaleItem:()=>_h,query:()=>Upe,regenerateParticipantNames:()=>Rfe,removeIndividualParticipantIds:()=>TW,removeParticipantIdsFromAllTeams:()=>kL,removePenalty:()=>xfe,removePersonRequests:()=>Ufe,removeRatings:()=>kfe,scaledTeamAssignment:()=>_fe,setParticipantScaleItem:()=>FR,setParticipantScaleItems:()=>Ede,validateLineUp:()=>OL});var Ife={};Fi(Ife,{addDynamicRatings:()=>h4,addIndividualParticipantIds:()=>PF,addParticipant:()=>jp,addParticipants:()=>sd,addPenalty:()=>Bfe,addPersonRequests:()=>Dfe,addPersons:()=>Vfe,createGroupParticipant:()=>Nfe,createTeamsFromParticipantAttributes:()=>B5,deleteParticipants:()=>h0,findParticipant:()=>Mfe,mergeParticipants:()=>$fe,modifyIndividualParticipantIds:()=>Efe,modifyParticipant:()=>CF,modifyParticipantName:()=>Afe,modifyParticipantOtherName:()=>Cfe,modifyParticipantsSignInStatus:()=>Pfe,modifyPenalty:()=>Lfe,modifyPersonRequests:()=>Tfe,regenerateParticipantNames:()=>Rfe,removeIndividualParticipantIds:()=>TW,removeParticipantIdsFromAllTeams:()=>kL,removePenalty:()=>xfe,removePersonRequests:()=>Ufe,removeRatings:()=>kfe,scaledTeamAssignment:()=>_fe,setParticipantScaleItem:()=>FR,setParticipantScaleItems:()=>Ede});function wfe(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function Sfe({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let n=i.filter(({requestType:r})=>r).map(r=>{let{date:a,startTime:s,endTime:o}=r;return r.requestType===ZR&&(a=Pi(a),s=Jn(s),o=Jn(o),a&&s&&o)?{date:a,startTime:s,endTime:o,requestType:r.requestType}:r}).filter(Boolean);for(let r of n)r.requestId=wfe(),t[e].push(r);return{mergeCount:n.length}}function W5(t){let{tournamentRecords:e,personRequests:i}=t,n=zt(t,[{[js]:!0}]);if(n.error)return n;if(!i)return{...le};let r=Object.values(e);for(let a of r){let s=a.participants??[],o=[];for(let l of Object.keys(i))if(qg({tournamentParticipants:s,personId:l})){let u=i[l];u.length&&o.push({personId:l,requests:u})}Object.keys(o).length&&un({element:a,extension:{value:o,name:iD}})}return{...le}}function Tfe(t){let{tournamentRecords:e,requests:i,personId:n}=t,r=zt(t,[{[js]:!0},{requests:!0,[Go]:xs,[pu]:Ee}]);if(r.error)return r;let a=i.map(({requestId:u})=>u).filter(Boolean),{personRequests:s}=xb({tournamentRecords:e}),o=u=>{s&&(s[u]=s[u].map(c=>{if(!a.includes(c.requestId))return c;let d=i.find(p=>p.requestId===c.requestId);if(d.requestType)return Object.assign(c,d)}).filter(Boolean))};if(n&&s?.[n])o(n);else if(s)for(let u of Object.keys(s))o(u);let l=i.filter(u=>!u.requestId);return l.length&&Sfe({personRequests:s,personId:n,requests:l}),W5({tournamentRecords:e,personRequests:s})}function Ufe(t){let{tournamentRecords:e,requestType:i,requestId:n,personId:r,date:a}=t,s=zt(t,[{[js]:!0}]);if(s.error)return s;let{personRequests:o}=xb({tournamentRecords:e}),l=c=>{o&&(o[c]=o[c].filter(d=>(!i||d.requestType!==i)&&(!n||d.requestId!==n)&&(!a||d.date!==a)),o?.[c]?.length||delete o[c])},u=!i&&!n&&!r&&!a;if(!u){if(r&&o?.[r])l(r);else if(o)for(let c of Object.keys(o))l(c)}return u||!o||!Object.keys(o).length?lo({name:iD,tournamentRecords:e,discover:!0}):W5({tournamentRecords:e,personRequests:o})}function Dfe(t){let{tournamentRecords:e,personId:i,requests:n}=t,r=zt(t,[{[js]:!0,[k_e]:!0},{requests:!0,[Go]:xs,[pu]:Ee}]);if(r.error)return r;let{personRequests:a}=xb({tournamentRecords:e}),{mergeCount:s}=Sfe({personRequests:a,personId:i,requests:n});return s&&a?W5({tournamentRecords:e,personRequests:a}):{error:Ee}}function Efe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let n="modifyIndividualParticipantIds";if(!i)return ce({result:{error:ot},stack:n});if(!e||!t)return ce({result:{error:Zt},stack:n});let r=i.participants||[],a=r.find(h=>h.participantId===e);if(!a)return ce({result:{error:Nr},stack:n});if(![wn,Iu].includes(a.participantType))return ce({result:{error:Vd},context:{participantType:a.participantType},stack:n});let s=t.filter(h=>r.find(f=>f.participantId===h)?.participantType!==ji);if(s.length)return ce({result:{error:Ul,invalidParticipantIds:s},stack:n});let o=a.individualParticipantIds||[],l=t.filter(h=>!o.includes(h)),u=o.filter(h=>!t.includes(h)),c=PF({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(c.error)return ce({result:c,stack:n});let d=TW({individualParticipantIds:u,groupingParticipantId:e,tournamentRecord:i});if(d.error)return ce({result:d,stack:n});let{topics:p}=bu();if(p.includes(Us)){let h=r.find(({participantId:f})=>f===e);Ti({topic:Us,payload:{tournamentId:i.tournamentId,participants:[h]}})}return{...c,...d}}function Pfe({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:ot};if(!Array.isArray(e))return{error:Zt};if(![mC,rue].includes(i))return{error:Ee,signInState:i};let n=t.participants||[];if(!n.length)return{error:G1};let r=n.map(Vi),a=e.filter(u=>!r.includes(u));if(a.length)return{error:Ee,context:{invalidParticipantIds:a}};let s=[],o=new Date().toISOString();for(let u of n){let{participantId:c}=u;if(e.includes(c)){let d=QW({duplicateValues:!1,tournamentRecord:t,participantId:c,timeItem:{itemType:rR,itemValue:i,createdAt:o}});if(d.error)return d;s.push(u)}}let{topics:l}=bu();return s.length&&l.includes(Us)&&Ti({topic:Us,payload:{tournamentId:t.tournamentId,participants:s}}),{...le}}function Cfe({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:ot};if(!e)return{error:la};let{participant:n}=Uv({tournamentRecord:t,participantId:e});if(!n)return{error:Nr};n.participantOtherName=i;let{topics:r}=bu();return r.includes(Us)&&Ti({topic:Us,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...le}}function sJ({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),n=m=>/^[a-z]*$/.test(i(m)),r=m=>/^[A-Z]*$/.test(i(m)),a=m=>/^[LAST]{4}/.test(i(m)),s=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),o=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,u=m=>m.toLowerCase().indexOf("f")<0,c=m=>m.indexOf(" ")>0;if(!e)return;let d=c(t)?" ":"",p=AG(e?.standardGivenName??""),h=AG(e?.standardFamilyName??"");if(!t)return`${p}${d}${h}`;l(t)&&!o(t)&&!s(t)&&(p=`${p[0]}.`),n(t)?(p=p.toLowerCase(),h=h.toLowerCase()):r(t)?(p=p.toUpperCase(),h=h.toUpperCase()):a(t)&&(h=h.toUpperCase());let f=`${p}${d}${h}`;return u(t)?f=h:s(t)&&(o(t)?f=`${h},${d}${p}`:f=`${h}${d}${p}`),f}function T2e({participantMap:t,participant:e,formats:i}){let{participantType:n,individualParticipantIds:r,person:a}=e,s=n&&i[n];if(n!==_o&&s){let{personFormat:o,doublesJoiner:l}=s;n===ji&&(e.participantName=sJ({person:a,personFormat:o})),n===Ni&&(e.participantName=r?.map(u=>{let c=t[u]?.person;return sJ({person:c,personFormat:o})}).filter(Boolean).join(l??"/"))}}function Rfe({tournamentRecord:t,formats:e}){if(!t)return{error:ot};if(!Ki(e))return{error:Zt};let i=t.participants??[],n=rse(i,"participantId");for(let r of i)T2e({participant:r,participantMap:n,formats:e});return{...le}}function Mfe(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}=t,s=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="string"&&typeof a!="string")return{error:Zt,stack:"publicFindParticipant"};let o,l;for(let u of Object.values(s)){l=u.tournamentId;let c=u.participants||[];if(o=qg({tournamentParticipants:c,internalUse:!0,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}),o)break}return{participant:o,tournamentId:l,...le}}function Nfe({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=Wue,tournamentRecord:n,participantId:r,groupName:a}){if(!n)return{error:ot};if(!a)return{error:Zt,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:Ee};let s=(dr({participantFilters:{participantTypes:[ji]},tournamentRecord:n}).participants??[]).map(c=>c.participantId);for(let c of t)if(!s.includes(c))return{error:Vd,participantId:c};let o=Vt({participantId:r||mn(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:Iu,participantRole:i}),l=jp({participant:o,tournamentRecord:n});if(l.error)return l;let{topics:u}=bu();return u.includes(Wg)&&Ti({topic:Wg,payload:{tournamentId:n.tournamentId,participants:[o]}}),{...le,participant:Ct(o)}}function Afe({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:ot};if(!i)return{error:la};if(!e)return{error:Zt,info:"Missing participantName"};let{participant:n}=Uv({tournamentRecord:t,participantId:i});if(!n)return{error:Nr};n.participantName=e;let{topics:r}=bu();return r.includes(Us)&&Ti({topic:Us,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...le}}function _fe({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:n=0,scaledParticipants:r=[],teamParticipantIds:a,tournamentRecord:s,scaleAttributes:o,teamNameBase:l,teamsCount:u,eventId:c,event:d}){if(!s)return{error:ot};if(!Array.isArray(a)&&!yi(u)&&!c||!yi(n)||r&&!Array.isArray(r)||o&&(typeof o!="object"||!Object.keys(o).length))return{error:Ee};if(!o&&!r.length||!r&&!(e&&o))return{error:Zt,info:"Missing scaling details"};if(c&&!a){if(d?.eventType!==Nl)return{error:Hh};a=d?.entries?.filter(({entryStatus:v})=>v===sl).map(Vi)}if(!a?.length&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:Zt};let p=e??r.map(({participantId:v})=>v);i&&(a?.reverse(),n+=1),n>(a?.length||0)-1&&(n=0);let h=a?.slice(n).concat(...a.slice(0,n))??[],f=[];for(let v of s.participants??[]){let{participantId:y,participantType:b}=v;if(h.includes(y)){if(b!==_o)return{error:Vd,participant:v};f.push(v)}}if(u&&f.length<u){let v=u-(f?.length||0),y=l??"Team",b=Dt(0,v).map(T=>({participantName:`${y} ${T+1}`,participantType:_o,participantRole:bs})),{participants:I=[]}=sd({participants:b,returnParticipants:!0,tournamentRecord:s}),S=I.map(Vi),w=s.participants?.filter(({participantId:T})=>S.includes(T))??[];f.push(...w)}if(!f.length)return{error:Jq};if(t)for(let v of f)v.individualParticipantIds=[];else{let v=f.map(y=>y).flat();e?.length?p=p.filter(y=>!v.includes(y)):r=r?.filter(({participantId:y})=>!v.includes(y))}if(!e?.length&&!r?.length)return{error:zO,info:"Nothing to be done"};if(!r.length){for(let v of s.participants??[]){let{participantId:y,participantType:b}=v;if(!p.includes(y))continue;if(b!==ji)return{error:Vd,participant:v};let I=_h({scaleAttributes:o,participant:v})?.scaleItem,S=o?.accessor?I?.scaleValue?.[o?.accessor]:I?.scaleValue,w={participantId:y,scaleValue:S};r.push(w)}if(!r.length)return{error:Nr}}r.sort((v,y)=>o?.sortOrder?(y?.scaleValue||0)-(v?.scaleValue||0):(v?.scaleValue||1/0)-(y?.scaleValue||1/0));for(let v of r)if(!v.participantId)return{error:Ee,scaledParticipant:v};let m=0;for(;m<r.length;){for(let v of f){if(m+1>r.length)break;let y=r[m];v.individualParticipantIds.push(y.participantId),m++}f.reverse()}let g=f.map(Vi);for(let v of s.events??[]){if(v.eventType!==Nl)continue;let y=(v.entries??[]).filter(b=>g.includes(b.participantId));for(let b of y){let I=b.participantId,S=f.find(T=>T.participantId===I)?.individualParticipantIds;v.entries=(v.entries??[]).filter(T=>!S.includes(T.participantId)),(v.drawDefinitions??[]).forEach(T=>{T.entries=(T.entries??[]).filter(U=>!S.includes(U.participantId))});let{flightProfile:w}=Cr({event:v});(w?.flights||[]).forEach(T=>{T.drawEntries=(T.drawEntries||[]).filter(U=>!S.includes(U.participantId))})}}return{...le,scaledParticipants:r}}function kfe(t){let e=zt(t,[{[ha]:!0,[T3]:!0},{ratingType:!1,[gs]:s=>Ca[s]}]);if(e.error)return e;let i=`${t.ratingType}.${P3}`,n=t.asDynamic?i:t.ratingType,r=[Wy,Fg,t.eventType,n].join("."),a=t.tournamentRecord.participants??[];for(let s of a)s.timeItems&&(s.timeItems=s.timeItems.filter(o=>o.itemType!==r));return{...le}}function xfe(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:fr};for(let i of Object.values(e)){let n=U2e({...t,tournamentRecord:i});if(n.error&&n.error!==CT)return n}return{...le}}function U2e({tournamentRecord:t,penaltyId:e}){if(!t)return{error:ot};if(!e)return{error:Wq};let i=t?.participants??[],n=[],r=!1,a;return i.forEach(s=>{let o=!1;s.penalties=(s.penalties??[]).filter(l=>(l.penaltyId===e&&(o=!0,r||(a=l,r=!0)),o&&n.push(s),l.penaltyId!==e))}),a&&Ti({topic:Us,payload:{tournamentId:t.tournamentId,participants:n}}),a?{...le,penalty:a}:{error:CT}}var D2e=({penaltyId:t=mn()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),Ofe=D2e;function Lfe(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:fr};for(let i of Object.values(e)){let n=E2e({...t,tournamentRecord:i});if(n.error&&n.error!==CT||n.success)return n}return{error:CT}}function E2e({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:ot};if(!e)return{error:Ee,modifications:e};if(!i)return{error:Wq};let n=t?.participants??[],r=Object.keys(Ofe()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>r.includes(l));if(!a.length)return{error:qO};let s,o=[];return n.forEach(l=>{let u=!1;l.penalties=(l.penalties??[]).map(c=>(c.penaltyId===i&&(u=!0,a.forEach(d=>Object.assign(c,{[d]:e[d]})),s||(s=c)),c)),u&&o.push(l)}),s&&Ti({topic:Us,payload:{tournamentId:t.tournamentId,participants:o}}),s?{...le,penalty:s}:{error:CT}}function Ffe(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:wi(Object.keys(t).concat(Object.keys(e))).reduce((n,r)=>{if(!e[r])n[r]=t[r];else if(!t[r])n[r]=e[r];else if(typeof t[r]!=typeof e[r])n[r]=e[r];else if(Array.isArray(t[r]))if(i===!0||Array.isArray(i)&&i.includes(r)){let a=wi(t[r].map(s=>JSON.stringify(s)).concat(e[r].map(s=>JSON.stringify(s)))).map(s=>JSON.parse(s));n[r]=a}else n[r]=e[r];else typeof t[r]=="object"?n[r]=Ffe(t[r],e[r],i):n[r]=e[r];return n},{})}function $fe({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:ot};e.participants||(e.participants=[]);let n=t.filter(kl(Zh)).map(u=>({[u.participantId]:u})),r=Object.assign({},...n),a=[];e.participants=e.participants.map(u=>{if(r[u.participantId]){let c=Ffe(u,r[u.participantId],i);return a.push(c),c}return u});let s=e.participants.map(kl(Zh))||[],o=t.filter(({participantId:u})=>!s.includes(u)),{topics:l}=bu();return o.length&&(e.participants=e.participants.concat(...o),l.includes(Wg)&&Ti({topic:Wg,payload:{participants:o}})),a.length&&l.includes(Us)&&Ti({topic:Us,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:o.length,...le}}function Bfe(t){let{tournamentRecord:e,participantIds:i}=t,n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r;for(let a of Object.values(n)){let s=(dr({tournamentRecord:a}).participants??[])?.map(Vi).filter(o=>i.includes(o));s.length&&(r=P2e({...t,penaltyId:t.penaltyId??r,tournamentRecord:a,participantIds:s}).penaltyId)}return r?{...le,penaltyId:r}:{error:Nr}}function P2e({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:n,penaltyType:r,extensions:a,penaltyId:s,matchUpId:o,issuedAt:l,notes:u}){if(!e)return{error:ot};if(!i)return{error:la};if(!r)return{error:Xse};let c=(e?.participants??[]).filter(h=>i.includes(h.participantId));if(!c.length)return{error:Nr};let d=new Date().toISOString(),p=Object.assign(Ofe({penaltyId:s}),{refereeParticipantId:t,penaltyCode:n,penaltyType:r,matchUpId:o,createdAt:d,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach(h=>un({element:p,extension:h})),c.forEach(h=>{h.penalties||(h.penalties=[]),h.penalties.push(p)}),Ti({topic:Us,payload:{tournamentId:e.tournamentId,participants:c}}),{...le,penaltyId:p.penaltyId}}function Vfe({participantRole:t=bs,tournamentRecord:e,persons:i}){if(!e)return{error:ot};if(!Array.isArray(i))return{error:Ee};if(!Object.keys(Pv).includes(t))return{error:Bse};let n=(e.participants||[]).map(({person:f})=>f?.personId).filter(Boolean),r=[],a=i.filter(f=>f&&(!f.personId||!n.includes(f.personId))).map(f=>(f.personId||(f.personId=mn()),r.push(f.personId),f)),s=(f,m)=>Object.assign({},...Object.keys(f).filter(g=>!m.includes(g)).map(g=>({[g]:f[g]}))),o=a.map(f=>Vt({extensions:f.participantExtensions,timeItems:f.participantTimeItems,participantType:ji,participantRole:t,person:s(f,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,u=0,c=sd({participants:o,tournamentRecord:e});if(c.error)return c;u=c.addedCount||0;let d=[],p=dr({participantFilters:{participantTypes:[ji]},tournamentRecord:e})?.participants??[];if(t===bs&&i.filter(({pairedPersons:f})=>f).forEach(({personId:f,pairedPersons:m})=>{Array.isArray(m)&&m.forEach(g=>{let v=[f,g.personId].map(y=>qg({tournamentParticipants:p,personId:y})).filter(Boolean);if(v.length===2){let y=v.map(Vi);d.push(Vt({extensions:g.participantExtensions,timeItems:g.timeItems,participantRole:bs,individualParticipantIds:y,participantType:Ni}))}})}),d.length){if(c=sd({participants:d,tournamentRecord:e}),c.error)return c;l=c.addedCount||0}let h=u+l;return{...le,addedCount:h,newPersonIds:r}}var $F={};Fi($F,{bulkUpdatePublishedEventIds:()=>$4,getAllEventData:()=>B4,getCourtInfo:()=>RL,getDrawData:()=>lF,getEventData:()=>uF,getEventPublishStatus:()=>sc,getPublishState:()=>p0,getTournamentPublishStatus:()=>wR,getVenueData:()=>BT,mutate:()=>jfe,publishEvent:()=>vD,publishEventSeeding:()=>Gfe,publishOrderOfPlay:()=>Yfe,publishParticipants:()=>Wfe,query:()=>Mpe,setEventDisplay:()=>SF,unPublishEvent:()=>Kfe,unPublishEventSeeding:()=>Hfe,unPublishOrderOfPlay:()=>qfe,unPublishParticipants:()=>zfe});var jfe={};Fi(jfe,{publishEvent:()=>vD,publishEventSeeding:()=>Gfe,publishOrderOfPlay:()=>Yfe,publishParticipants:()=>Wfe,setEventDisplay:()=>SF,unPublishEvent:()=>Kfe,unPublishEventSeeding:()=>Hfe,unPublishOrderOfPlay:()=>qfe,unPublishParticipants:()=>zfe});function Gfe({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:n,status:r=wu,drawIds:a=[],event:s}){if(!n)return{error:ot};if(!s)return{error:qn};let o=sc({event:s,status:r}),l=(o?.seeding?.seedingScaleNames||i)&&{...o?.seeding?.seedingScaleNames,...i},u=(o?.seeding?.stageSeedingScaleNames||e)&&{...o?.seeding?.stageSeedingScaleNames,...e},c=Vt({stageSeedingScaleNames:u,seedingScaleNames:l,published:!0,drawIds:a});return gD({statusObject:{seeding:c},removePriorValues:t,status:r,event:s}),Ti({topic:Jle,payload:{tournamentId:n.tournamentId,eventId:s.eventId,drawIds:a}}),{...le}}function Hfe({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:n=wu,drawIds:r,stages:a,event:s}){if(!i)return{error:ot};if(!s)return{error:qn};let o=sc({event:s});if(o){let l=o.seeding;if(Array.isArray(a)&&l.stageSeedingScaleNames)for(let u of a)l.stageSeedingScaleNames[u]&&delete l.stageSeedingScaleNames[u];Array.isArray(e)&&l?.seedingScaleNames&&(l.seedingScaleNames=l.seedingScaleNames.filter(u=>!e.includes(u))),Array.isArray(r)&&l?.drawIds&&(l.drawIds=l.drawIds.filter(u=>!r.includes(u))),(!Object.values(l.stageSeedingScaleNames??{}).length&&!l.seedingScaleNames?.length&&!l.drawIds?.length||!a&&!e&&!r?.length)&&(delete l.stageSeedingScaleNames,delete l.seedingScaleNames,delete l.drawIds,l.published=!1),gD({statusObject:{seeding:l},removePriorValues:t,status:n,event:s})}return Ti({topic:eW,payload:{tournamentId:i.tournamentId,eventId:s.eventId}}),{...le}}function zfe(t){let e=ic(t);if(!Object.keys(e).length)return{error:fr};for(let i of Object.values(e)){let n=C2e({tournamentRecord:i,...t});if(n.error)return n}return{...le}}function C2e({removePriorValues:t=!0,tournamentRecord:e,status:i=wu}){if(!e)return{error:ot};let n=`${Dv}.${Ev}`,{timeItem:r}=nc({element:e,itemType:n}),a=r?.itemValue||{[i]:{}};return a[i]&&delete a[i].participants,rh({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),Ti({payload:{tournamentId:e.tournamentId},topic:ske}),{...le}}function qfe(t){let e=ic(t);if(!Object.keys(e).length)return{error:fr};for(let i of Object.values(e)){let n=R2e({tournamentRecord:i,...t});if(n.error)return n}return{...le}}function R2e({removePriorValues:t=!0,tournamentRecord:e,status:i=wu}){if(!e)return{error:ot};let n=`${Dv}.${Ev}`,{timeItem:r}=nc({element:e,itemType:n}),a=r?.itemValue||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,rh({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),Ti({topic:tW,payload:{tournamentId:e.tournamentId}}),{...le}}function Wfe(t){let e=ic(t);if(!Object.keys(e).length)return{error:fr};for(let i of Object.values(e)){let n=M2e({tournamentRecord:i,...t});if(n.error)return n}return{...le}}function M2e({removePriorValues:t,tournamentRecord:e,status:i=wu}){if(!e)return{error:ot};let n=`${Dv}.${Ev}`,{timeItem:r}=nc({element:e,itemType:n}),a=r?.itemValue||{[i]:{}};return a[i].participants={published:!0},rh({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),Ti({payload:{tournamentId:e.tournamentId},topic:eue}),{...le}}function Yfe(t){let e=ic(t);if(!Object.keys(e).length)return{error:fr};for(let i of Object.values(e)){let n=N2e({tournamentRecord:i,...t});if(n.error)return n}return{...le}}function N2e({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:n=wu,eventIds:r=[]}){if(!i)return{error:ot};let a=`${Dv}.${Ev}`,{timeItem:s}=nc({element:i,itemType:a}),o=s?.itemValue||{[n]:{}};return o[n].orderOfPlay={published:!0,scheduledDates:t,eventIds:r},rh({timeItem:{itemValue:o,itemType:a},element:i,removePriorValues:e}),Ti({topic:Qle,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:r}}),{...le}}function Kfe({removePriorValues:t=!0,tournamentRecord:e,status:i=wu,event:n}){if(!e)return{error:ot};if(!n)return{error:qn};let r=`${Dv}.${Ev}`,{timeItem:a}=aR({itemType:r,event:n}),s=a?.itemValue||{[i]:{}};return delete s[i].structureIds,delete s[i].drawDetails,delete s[i].drawIds,y0({event:n,timeItem:{itemValue:s,itemType:r},removePriorValues:t}),gD({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:n}),Ti({topic:Q3,payload:{tournamentId:e.tournamentId,eventId:n.eventId}}),{eventId:n.eventId,...le}}var Y5={};Fi(Y5,{getEntryStatusReports:()=>_2e,getParticipantStats:()=>A2e,getStructureReports:()=>x2e,getVenuesReport:()=>L2e});function A2e({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:n,tournamentRecord:r,withScaleValues:a,tallyPolicy:s,matchUps:o}){if(!r)return{error:ot};if(o&&!Array.isArray(o))return{error:rl};if(o=o??Za({tournamentRecord:r,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!o?.length)return{error:Vm};let l=[];e&&l.push(e),n&&l.push(n);let u=l.length?{participantIds:l}:{participantTypes:[_o]},c=dr({participantFilters:u,tournamentRecord:r}).participants??[];if(!c.every(({participantType:T})=>T===_o))return{error:Ul};l.length||l.push(...c.map(Vi));let d=new Map,p=new Map,h=new Map,f=new Map,m=(T,U="")=>p.get(T)||p.set(T,{participantName:U,participantId:T,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(T);for(let T of c){let{participantId:U,individualParticipantIds:C}=T;f.set(U,C??[]),m(U,T.participantName)}if(n&&!f.get(n))return ce({result:{error:Nr},context:{teamParticipantId:n}});if(e&&!f.get(e))return ce({result:{error:Nr},context:{opponentParticipantId:e}});let g=[],v=T=>{let U=[[],[]];for(let E of T){let P=E.participant;if(P?.participantName){d.set(P.participantId,{participantName:P.participantName,ratings:P.ratings});let M=p.get(P.participantId);M&&(M.participantName=P.participantName)}}let C=({side:E,individualParticipantIds:P})=>E.participantId&&(!P?.length||P.includes(E.participantId))&&[E.participantId]||E.participant?.individualParticipantIds?.length&&(!P?.length||Dr(P,E.participant?.individualParticipantIds).length===E.participant?.individualParticipantIds?.length)&&E.participant.individualParticipantIds;if(f.size){let E=(P,M)=>{for(let R of T){if(!R.participant)continue;let N=C({individualParticipantIds:M,side:R});if(N?.length){let A=R.sideNumber;if(!A)continue;let _=[P];i&&_.push(...N),U[A-1]=_;let x=p.get(P);for(let O of N.filter(Boolean))x&&!x.competitorIds.includes(O)&&x.competitorIds.push(O)}}};if(n)(!e||T.every(P=>P.participant&&(C({individualParticipantIds:f.get(n),side:P})||C({individualParticipantIds:f.get(e),side:P}))))&&E(n,f.get(n));else for(let[P,M]of f)E(P,M)}else if(i)for(let E of T){if(!E.participant)continue;let P=C({individualParticipantIds:[],side:E}),M=E.sideNumber;M&&(U[M-1]=P)}return U};for(let T of o){if(!Ki(T))return{error:rl};let{matchUpStatus:U,matchUpFormat:C,matchUpType:E,winningSide:P,score:M,sides:R}=T;if(!R||!M||E===uu||U==="BYE")continue;let N=v(R);if(!N.filter(Boolean).length)continue;let A=t&&P&&fR({matchUp:T})?.competitiveness;g.push(T);let _=qW({matchUpStatus:U,matchUpFormat:C,tallyPolicy:s,winningSide:P,score:M}),x=jce({matchUpStatus:U,matchUpFormat:C,tallyPolicy:s,winningSide:P,score:M}),{pointsTally:O,tiebreaksTally:$}=Gce({matchUpFormat:C,score:M});N.forEach((F,j)=>{for(let H of F){let G=d.get(H)?.participantName,W=m(H,G);if(W){let q=(ne,re)=>re.forEach((oe,de)=>W[ne][de]+=oe),Z=j?[...$].reverse():$,K=j?[...O].reverse():O,Q=j?[...x].reverse():x,J=j?[..._].reverse():_;if(q("tiebreaks",Z),q("points",K),q("games",Q),q("sets",J),P){let ne=P-1===j?0:1;W.matchUps[ne]+=1}if(A){let ne=A.toLowerCase();W.competitiveness[ne]||(W.competitiveness[ne]=[0,0]),W.competitiveness[ne][j]+=1}if(U){let ne=U.toLowerCase();W.matchUpStatuses[ne]||(W.matchUpStatuses[ne]=0),W.matchUpStatuses[ne]+=1}}}})}let y=["tiebreaks","matchUps","points","games","sets"],b=["competitive","routine","decisive"],I=new Map,S=(T,U)=>(T??0)+(U??0);for(let[T,U]of p.entries()){for(let C of y){let E=U[C].reduce(S);if(E){let P=U[C][0]/E,M=`${C}Ratio`,R=parseFloat(P.toFixed(2));U[M]=R,h.set(T,!0),I.has(M)||I.set(M,[]),I.get(M)?.push(R)}}for(let C of b){let E=U.competitiveness?.[C]?.reduce(S);if(E){let P=U.competitiveness[C][0]/E,M=`${C}Ratio`,R=parseFloat(P.toFixed(2));U[M]=R}}}if(!n){let T=(U,C)=>C-U;for(let U of p.values())for(let C of y){let E=`${C}Ratio`;if(typeof U[E]=="number"){let P=I.get(E)?.sort(T).indexOf(U[E]);if(typeof P=="number"&&P>=0){let M=`${C}Rank`;U[M]=P+1}}}}let w={relevantMatchUps:g,...le};return n?(w.teamStats=p.get(n),e&&(w.opponentStats=p.get(e))):w.participatingTeamsCount=h.size,w.allParticipantStats=[...p.values()],w}function Lk({participant:t,eventType:e}){let i=t?.person?.personId,n=t?.person?.personOtherIds?.[0],r=t?.person?.tennisId,a=t?.ratings?.[e]?.find(({scaleName:u})=>u==="WTN"),s=a?.scaleValue,{wtnRating:o,confidence:l}=s||{};return{timeStamp:a?.scaleDate,personOtherId:n,confidence:l,wtnRating:o,personId:i,tennisId:r}}function _2e({tournamentRecord:t}){if(!t)return{error:ot};let e=t.tournamentId,{participantMap:i}=dr({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),n=(Za({matchUpFilters:{matchUpTypes:[AI,jy]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:h,matchUpType:f})=>h?.flatMap(m=>f===jy?m?.participant?.individualParticipantIds:m?.participant?.participantId||m.participantId).filter(Boolean)).filter(Boolean),r=[],a={},s={},o={},l=0,u=({id:h,entry:f,eventId:m,eventType:g})=>{let{qualifyingSeeding:v,mainSeeding:y,entryStatus:b,entryStage:I,drawId:S}=f;a[h]||(a[h]=[]);let{participant:w,events:T}=i?.[h]??{},U=Lk({participant:w,eventType:g}),C=T?.[m]?.ranking;b===VW&&r.push(h),a[h].push({participantType:w?.participantType,participantId:h,tournamentId:e,eventType:g,eventId:m,drawId:S,entryStatus:b,entryStage:I,...U,ranking:C,mainSeeding:y,qualifyingSeeding:v})};for(let h of t.events??[]){let f={},m=T=>{f[T]||(f[T]={count:0}),f[T].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=h,b=g.flatMap(T=>{let{drawId:U,entries:C}=T;l+=1;let E=({stage:N,stageSequence:A})=>N===Nt&&A===1||N===qt,P=(T.structures??[]).filter(E).flatMap(({positionAssignments:N})=>N).filter(Boolean).map(({participantId:N})=>N),M=({participantId:N})=>P.includes(N),R=N=>{let{participantId:A,entryStatus:_,entryStage:x}=N;m(_);let O=i?.[A]?.draws?.[U]?.seedAssignments?.[Nt];return{qualifyingSeeding:i?.[A]?.draws?.[U]?.seedAssignments?.[qt],participantId:A,mainSeeding:O,entryStatus:_,entryStage:x,drawId:U}};return C?.filter(M).map(R)}),I=T=>{let U=T.participantId,C=i?.[U].participant.individualParticipantIds?.filter(E=>n.includes(E));return U&&{[U]:{individualParticipantIds:C}}};v===pm?(()=>{let T=Object.assign({},...b.map(I).filter(Boolean)),U=C=>{T[C.participantId].individualParticipantIds.forEach(E=>{u({id:E,eventType:v,eventId:y,entry:C})})};b.forEach(U)})():b.forEach(T=>{u({id:T?.participantId,eventType:v,eventId:y,entry:T})});let S=Object.values(f).reduce((T,U)=>T+U.count,0);Object.keys(f).forEach(T=>{f[T].pct=f[T].count/S*100}),o[y]={tournamentId:e,eventId:y,entries:b,entryStatuses:f};let w=Object.assign({},...fd.flatMap(T=>[{[T+"_count"]:f[T]?.count},{[T+"_pct"]:f[T]?.pct}]));s[y]={tournamentId:e,eventId:y,...w}}let c=Object.values(i??{}).filter(({participant:{participantType:h,participantRole:f}})=>h===ji&&f===bs),d=c.filter(({participant:h})=>!n.includes(h.participantId)).map(({participant:h})=>h.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:c.length,eventsCount:Object.values(o).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(s).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(o).flat(),withDrawnParticipantIds:r,tournamentEntryReport:p}}function k2e({eventType:t,matchUps:e,eventId:i,drawId:n}){let r={},a=f=>{let m=f?.matchUpFormat;m&&(r[m]||(r[m]=0),r[m]+=1)},s=e.filter(f=>i?f.eventId===i:f.drawId===n).reduce((f,m)=>(a(m),(m.sides??[]).flatMap(g=>(g?.participant?.individualParticipants||[g?.participant]).filter(Boolean)).forEach(g=>f[g.participantId]=g),f),{}),o=Object.values(s),l=o.map(f=>Lk({participant:f,eventType:t})).filter(({wtnRating:f})=>f),u=(o.length-l.length)/o.length*100,c=l.reduce((f,m)=>{let{wtnRating:g,confidence:v}=m;return f.totalWTN+=g,f.totalConfidence+=v,f},{totalWTN:0,totalConfidence:0}),d=l?.length?c.totalWTN/l.length:0,p=l?.length?c.totalConfidence/l.length:0,h=Object.values(r).reduce((f,m)=>f+(m||0),0);return{matchUpFormatCounts:r,matchUpsCount:h,avgConfidence:p,pctNoRating:u,avgWTN:d}}function x2e(t){let{tournamentRecord:e,extensionProfiles:i,firstFlightOnly:n,firstStageSequenceOnly:r=!0}=t;if(!e)return{error:ET};let a=[],s={},o={},l=[],u=Object.assign({},...(i??[]).map(({name:m,label:g,accessor:v})=>{let y=_i({element:e,name:m})?.extension?.value,b=v?kI({element:y,accessor:v})?.value:y;return{[g??m]:b}})),c=e?.tournamentId,d=Za({participantsProfile:{withScaleValues:!0},tournamentRecord:e}).matchUps??[],p=m=>nc({itemType:G3,itemSubTypes:[Nh],element:{timeItems:m}})?.timeItem?.itemValue?.scaleBasis,h=({positionManipulations:m})=>{m?.forEach(g=>{let{structureId:v,name:y}=g,b=g.drawPositions??[g.drawPosition];s[v]??=[],s[v].push(`${y}: ${b.join("/")}`)})},f=e?.events?.flatMap(({timeItems:m,drawDefinitions:g=[],extensions:v,eventType:y,eventName:b,eventId:I,category:S})=>{let w=v?.find(N=>N.name===nd)?.value?.flights?.map(N=>({[N.drawId]:N.flightNumber})),T=w&&Object.assign({},...w),U=v?.find(N=>N.name===Dy),C=m?.find(N=>N.itemType===Dy),E=U?.value?.length??C?.itemValue??0,P=Object.values(T??{}),M=T&&Math.min(...P),R=p(m);return o[I]={seedingBasis:R?JSON.stringify(R):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:E,tournamentId:c,eventId:I},g.filter(N=>!n||!w||T[N.drawId]===M).flatMap(N=>{let{matchUpFormat:A,tieFormat:_,timeItems:x,extensions:O,structures:$,drawName:F,drawType:j,drawId:H}=N,{matchUpFormatCounts:G,matchUpsCount:W,avgConfidence:q,pctNoRating:Z,avgWTN:K}=k2e({eventType:y,matchUps:d,drawId:H}),Q=p(x)??R,J=O2e({extensions:O}),ne=J?.length??0;return h({positionManipulations:J}),o[I].totalPositionManipulations+=ne,o[I].generatedDrawsCount+=1,ne>o[I].maxPositionManipulations&&(o[I].maxPositionManipulations=ne),$?.filter(re=>(re.stageSequence===1||!r)&&[qt,Nt,Ts,Sr].includes(re.stage)).map(re=>{let oe=[Nt,Sr].includes(re.stage)?d.find(ft=>ft.structureId===re.structureId&&ft.finishingRound===1&&ft.winningSide):void 0;re.stage===Nt&&a.push({eventName:b,drawName:F,structureId:re.structureId});let de=oe?.sides?.find(ft=>ft.sideNumber===oe.winningSide)?.participant,se=de?.participantType===_o&&de.participantId,ge=de?.participantType===Ni?de.individualParticipants:[],ye=Lk({participant:ge?.[0]??de,eventType:y}),{personId:Te,personOtherId:De,tennisId:xe,confidence:Me,wtnRating:Oe}=ye||{},at=Lk({participant:ge?.[1],eventType:y}),{personId:Fe,personOtherId:mt,tennisId:Xe,confidence:gt,wtnRating:ht}=at||{},{ageCategoryCode:_e,categoryName:Ye,subType:Je}=S??{},ct=re.matchUpFormat??A,pt=(G[ct]??0)/W*100,{tieFormatName:Se,tieFormatDesc:he}=Mk(_),{tieFormatName:we,tieFormatDesc:be}=Mk(re.tieFormat),Ae=he===be,ze=!Ae&&we,We=re.tieFormat&&!Ae&&be,Le=J?.filter(ft=>ft.structureId===re.structureId)?.length??0;return{...u,tournamentId:c,eventId:I,structureId:re.structureId,drawId:H,eventType:y,category:Je,categoryName:Ye,ageCategoryCode:_e,flightNumber:T?.[H],drawType:j,stage:re.stage,seedingBasis:Q?JSON.stringify(Q):void 0,winningPersonId:Te,winningPersonOtherId:De,winningPersonTennisId:xe,winningPersonWTNrating:Oe,winningPersonWTNconfidence:Me,winningPerson2Id:Fe,winningPerson2OtherId:mt,winningPerson2TennisId:Xe,winningPerson2WTNrating:ht,winningPerson2WTNconfidence:gt,winningTeamId:se,positionManipulations:Le,pctNoRating:Z,matchUpFormat:ct,pctInitialMatchUpFormat:pt,matchUpsCount:W,drawTieFormatName:Se,drawTieFormatDesc:he,tieFormatName:ze,tieFormatDesc:We,avgConfidence:q,avgWTN:K}})})});return a.forEach(({eventName:m,drawName:g,structureId:v})=>{s[v]?.length&&l.push({eventName:m,drawName:g,actions:s[v]})}),{eventStructureReports:Object.values(o),structureReports:f,flightReports:l}}function O2e({extensions:t}){return t?.find(({name:e})=>e===dT)?.value?.slice(1)}function L2e({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:n=[],dates:r=[]}){if(!Array.isArray(r))return{error:Ee,dates:r};if(!Array.isArray(n))return{error:Ee,venueIds:n};if(!(e&&Object.keys(e).filter(c=>!i||c===i)||[]).length)return{error:fr};if(!r.every(nl))return{error:ja};let a=Wm({tournamentRecords:e,ignoreDisabled:t,dates:r});if(a.error)return a;let s=a?.venues?.filter(({venueId:c})=>!n?.length||n.includes(c)),o=a.courts?.reduce((c,d)=>(d.dateAvailability?.forEach(p=>{let h=p.date;c.includes(h)||c.push(h)}),c),[]).filter(c=>!r.length||r.includes(c)),l={venueIds:s?.map(({venueId:c})=>c)},{matchUps:u}=jd({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:s?.map(c=>F2e(o,c,u))}}function F2e(t,e,i){let{venueId:n,courts:r,venueName:a}=e,s={};return t.forEach(o=>{let l=0,u=0,c=0;for(let h of r){let f=h.dateAvailability.find(g=>g.date===o),m=(f&&yD({courtDate:f}).timeSlots)?.reduce((g,v)=>{let{startTime:y,endTime:b}=v,I=rn(b)-rn(y);return g+I},0);m&&(c+=1),l+=m}let d=i.filter(({schedule:h})=>h.venueId===n&&zh(o,h.scheduledDate));d.forEach(({schedule:h})=>{let f=Jn(h.scheduledTime),m=tl(f,h.averageMinutes),g=rn(m)-rn(f);u+=g});let p=l?(u/l*100).toFixed(2):"100";s[o]={scheduledMatchUpsCount:d.length,availableCourts:c,availableMinutes:l,scheduledMinutes:u,percentUtilization:p}}),{venueId:n,venueName:a,venueReport:s}}var K5={};Fi(K5,{addMatchUpCourtOrder:()=>P5,addMatchUpEndTime:()=>R5,addMatchUpOfficial:()=>Lhe,addMatchUpResumeTime:()=>N5,addMatchUpScheduleItems:()=>NF,addMatchUpScheduledDate:()=>RF,addMatchUpScheduledTime:()=>Rv,addMatchUpStartTime:()=>C5,addMatchUpStopTime:()=>M5,addSchedulingProfileRound:()=>G5,allocateTeamMatchUpCourts:()=>MF,assignMatchUpCourt:()=>S0,assignMatchUpVenue:()=>ID,bulkRescheduleMatchUps:()=>nme,bulkScheduleMatchUps:()=>XR,bulkScheduleTournamentMatchUps:()=>PC,bulkUpdateCourtAssignments:()=>Qfe,calculateScheduleTimes:()=>Z5,clearMatchUpSchedule:()=>ame,clearScheduledMatchUps:()=>kF,courtGridRows:()=>fF,findMatchUpFormatTiming:()=>dF,findVenue:()=>mf,generateBookings:()=>_F,generateVirtualCourts:()=>UF,getMatchUpsToSchedule:()=>cF,getPersonRequests:()=>xb,getProfileRounds:()=>hF,getScheduledRoundsDetails:()=>VR,getSchedulingProfile:()=>Ym,getSchedulingProfileIssues:()=>V4,matchUpScheduleChange:()=>rme,modifyMatchUpFormatTiming:()=>l5,mutate:()=>Zfe,proAutoSchedule:()=>Jfe,proConflicts:()=>tme,publicFindCourt:()=>mW,query:()=>Ope,removeEventMatchUpFormatTiming:()=>wF,removeMatchUpCourtAssignment:()=>Xfe,reorderUpcomingMatchUps:()=>ime,scheduleMatchUps:()=>eme,scheduleProfileRounds:()=>xF,setMatchUpDailyLimits:()=>sme,setMatchUpHomeParticipantId:()=>E5,setSchedulingProfile:()=>hD,toggleParticipantCheckInState:()=>EF,validateSchedulingProfile:()=>pF});var Zfe={};Fi(Zfe,{addMatchUpCourtOrder:()=>P5,addMatchUpEndTime:()=>R5,addMatchUpOfficial:()=>Lhe,addMatchUpResumeTime:()=>N5,addMatchUpScheduleItems:()=>NF,addMatchUpScheduledDate:()=>RF,addMatchUpScheduledTime:()=>Rv,addMatchUpStartTime:()=>C5,addMatchUpStopTime:()=>M5,addSchedulingProfileRound:()=>G5,allocateTeamMatchUpCourts:()=>MF,assignMatchUpCourt:()=>S0,assignMatchUpVenue:()=>ID,bulkRescheduleMatchUps:()=>nme,bulkScheduleMatchUps:()=>XR,bulkScheduleTournamentMatchUps:()=>PC,bulkUpdateCourtAssignments:()=>Qfe,calculateScheduleTimes:()=>Z5,clearMatchUpSchedule:()=>ame,clearScheduledMatchUps:()=>kF,findMatchUpFormatTiming:()=>dF,generateBookings:()=>_F,generateVirtualCourts:()=>UF,matchUpScheduleChange:()=>rme,modifyMatchUpFormatTiming:()=>l5,proAutoSchedule:()=>Jfe,proConflicts:()=>tme,removeEventMatchUpFormatTiming:()=>wF,removeMatchUpCourtAssignment:()=>Xfe,reorderUpcomingMatchUps:()=>ime,scheduleMatchUps:()=>eme,scheduleProfileRounds:()=>xF,setMatchUpDailyLimits:()=>sme,setMatchUpHomeParticipantId:()=>E5,setSchedulingProfile:()=>hD,toggleParticipantCheckInState:()=>EF,validateSchedulingProfile:()=>pF});function Z5({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,tournamentRecords:a,periodLength:s,scheduleDate:o,startTime:l,venueIds:u,endTime:c}){if(typeof a!="object"||!Object.keys(a).length)return{error:fr};s=s??DF({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=Wm({dates:[o],ignoreDisabled:!0,tournamentRecords:a}),h=d?.filter(E=>!u||u.includes(E.venueId));l||(l=h?.reduce((E,P)=>{let M=P.dateAvailability?.find(R=>!R.date||zh(o,R.date))?.startTime??P.startTime;return M&&(!E||rn(M)<rn(E))?M:E},void 0)),c||(c=h?.reduce((E,P)=>{let M=P.dateAvailability?.find(R=>!R.date||zh(o,R.date))?.endTime??P.endTime;return M&&(!E||rn(M)>rn(E))?M:E},void 0));let f=Object.values(a),m=Object.assign({},...f.map(E=>(E.events??[]).map(P=>{let{scheduleTiming:M}=sR({tournamentRecord:E,event:P});return{[P.eventId]:{event:P,scheduleTiming:M}}})).flat()),g=HR({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:o,venueIds:u}}),v=g?.dateMatchUps??[],y=g?.completedMatchUps??[],b=[];b.push(...v),b.push(...y);let I={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},S=b?.map(({eventId:E,schedule:P,matchUpFormat:M})=>{let{event:R,scheduleTiming:N}=m[E],A=R?.eventType,_={...N,defaultTiming:I,matchUpFormat:M},{averageMinutes:x,recoveryMinutes:O}=CL({eventType:A,timingDetails:_}),{courtId:$,venueId:F}=P,j=Jn(P.scheduledTime),H=tl(j,x);return{recoveryMinutes:O,averageMinutes:x,periodLength:s,startTime:j,endTime:H,courtId:$,venueId:F}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:i,date:o,clearScheduleDates:r,periodLength:s,startTime:l,endTime:c,bookings:S,courts:h},{scheduleTimes:T}=b5(w),U=u?.length===1&&u[0]||p?.length===1&&p[0].venueId||void 0,C=b.map(Ma);return{venueId:U,scheduleTimes:T,dateScheduledMatchUpIds:C}}function Xfe(t){let e=zt(t,[{[js]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:n,tournamentId:r,courtDayDate:a,matchUpId:s,courtId:o,drawId:l}=t,u=n[r];if(!u)return{error:ot};let{drawDefinition:c,event:d}=Cv({tournamentRecord:u,drawId:l});if(!c)return{error:Ot};let p=Qn({drawDefinition:c,event:d,matchUpId:s});if(p.error)return p;if(p?.matchUp?.matchUpType===uu){let{itemValue:h}=Nb({timeItems:p.matchUp.timeItems??[],itemType:Qh}),f=o&&h.filter(m=>m.courtId!==o);return xl({duplicateValues:!1,removePriorValues:i,tournamentRecord:u,drawDefinition:c,matchUpId:s,timeItem:{itemType:Qh,itemValue:f}})}else return S0({tournamentRecord:u,drawDefinition:c,courtDayDate:a,courtId:"",matchUpId:s})}function Jfe({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:n}){if(!ac(n))return{error:Ee};if(n.some(({hasContext:h})=>!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:HO};let r=HR({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(r.error)return r;let{rows:a}=r,s=[],o=h=>[(h.sides||[]).map(f=>[f.participantId,f.participant?.individualParticipantIds]),(h.potentialParticipants||[]).flat().map(f=>[f.participantId,f.individualParticipantIds])].flat(1/0).filter(Boolean),l=a?.reduce((h,f)=>{let m=[],g=[];Object.values(f).forEach(y=>{if(Ki(y)&&(y.matchUpId&&(m.push(y.matchUpId),s.push(y)),y.sides)){let b=o(y);g.push(...b)}});let v=Object.values(f).filter(y=>Ki(y)&&!y.matchUpId);return h.concat({matchUpIds:m,availableCourts:v,rowId:f.rowId,participantIds:g})},[]);n.filter(({matchUpStatus:h})=>h&&h!=="BYE"&&(t||!Yr.includes(h))).sort(d0);let u=gd({matchUps:n.concat(s),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,c=[],d=[];for(;n.length&&l.length;){let h=l.shift(),f=[];for(;n.length&&h.availableCourts.length;){let m=n.concat(f).map(U=>U.matchUpId),g=n.shift(),v=g?.matchUpId,y=v&&u[v].matchUpIds.concat(u[v].dependentMatchUpIds),b=v&&m.some(U=>u[v].matchUpIds.includes(U)),I=v&&d.some(U=>u[v].dependentMatchUpIds.includes(U)),S=h.matchUpIds.some(U=>y.includes(U)),w=o(g),T=h.participantIds.some(U=>w.includes(U));if(g&&!S&&!b&&!T&&!I){let U=h.availableCourts.shift();Object.assign(g.schedule,U.schedule),Object.assign(U,g),c.push(g),h.participantIds.push(...w),h.matchUpIds.push(v)}else g&&f.push(g)}n.push(...f),d.push(...h.matchUpIds)}let p=c.map(({matchUpId:h,tournamentId:f,schedule:m,drawId:g})=>({tournamentId:f,matchUpId:h,drawId:g,schedule:{...m,scheduledDate:i}}));return r=XR({tournamentRecords:e,matchUpDetails:p}),{...r,scheduled:c,notScheduled:n}}function Qfe(t){let{courtDayDate:e}=t,i=zt(t,[{courtAssignments:!0,[Go]:xs,[pu]:Zt},{[js]:!0}]);if(i.error)return i;let n=t.courtAssignments.reduce((a,s)=>{let{tournamentId:o}=s;return a[o]||(a[o]=[]),a[o].push(s),a},{}),r;return Object.keys(n).every(a=>{let s=t[js][a];if(!s)return r={error:ot},!1;let o=n[a].reduce((l,u)=>{let{drawId:c}=u;return l[c]||(l[c]=[]),l[c].push(u),l},{});Object.keys(o).every(l=>{let{drawDefinition:u}=$o({tournamentRecord:s,drawId:l});return u?(o[l].every(c=>{let{matchUpId:d,courtId:p}=c,h=S0({tournamentRecord:s,drawDefinition:u,courtDayDate:e,matchUpId:d,courtId:p});if(h.success)return h?.success;r={error:ooe}}),!0):(r={error:Ot},!1)})}),r||le}function eme(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:n=90,recoveryMinutes:r=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:o={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:c=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:h=30,scheduleDate:f,matchUpIds:m,venueIds:g,startTime:v,endTime:y,dryRun:b}=t,I=zt(t,[{[js]:!0,[Q1]:!0},{[gs]:nl,[pu]:ja,[N_e]:!0},{[gs]:q=>!q||!isNaN(q),[x_e]:!1,[pu]:Ee,[O_e]:!1,[L_e]:!1}]);if(I.error)return I;let S=t.competitionMatchUps??jd({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??gd({includeParticipantDependencies:!0,matchUps:S,tournamentRecords:e}).matchUpDependencies;S.forEach(q=>{q.schedule?.scheduledDate&&zh(f,Pi(q.schedule.scheduledDate))&&HT({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:q})});let T=m.map(q=>S.find(Z=>Z.matchUpId===q)).filter(Boolean),{venueId:U,scheduleTimes:C,dateScheduledMatchUpIds:E}=Z5({tournamentRecords:e,remainingScheduleTimes:d,startTime:Jn(v),endTime:Jn(y),scheduleDate:Pi(f),averageMatchUpMinutes:n,clearScheduleDates:p,periodLength:h,venueIds:g}),P={},M=[],R={},N={},A={};S.filter(({matchUpId:q})=>E?.includes(q)).forEach(q=>{XG({matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUp:q,value:1});let Z=q.schedule?.scheduledTime;if(Z){R[q.matchUpId]=Z;let K=a?.[q.matchUpId];EC({recoveryMinutes:K||r,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:Z,matchUp:q})}});let _=T.filter(q=>{let Z=E?.includes(q.matchUpId),K=["BYE",On,Ur,al,_a,ir].includes(q?.matchUpStatus);return!Z&&!q.winningSide&&!K}),{matchUpMap:x,overLimitMatchUpIds:O,participantIdsAtLimit:$}=_.reduce((q,Z)=>{let{drawId:K,tournamentId:Q,matchUpType:J}=Z,{participantIdsAtLimit:ne,relevantParticipantIds:re}=$5({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,matchUpDailyLimits:u,matchUp:Z});return ne?.length?(q.overLimitMatchUpIds.push(Z.matchUpId),q.participantIdsAtLimit.push(...ne),q):(re.forEach(oe=>{KR({individualParticipantProfiles:o,participantId:oe});let de=o[oe].counters;de[J]?de[J]+=1:de[J]=1,de[zc]?de[zc]+=1:de[zc]=1}),q.matchUpMap[Q]||(q.matchUpMap[Q]={}),q.matchUpMap[Q][K]?q.matchUpMap[Q][K].push(Z):q.matchUpMap[Q][K]=[Z],HT({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:Z}),q)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});_=_.filter(({matchUpId:q})=>!O.includes(q));let F=0,j=C?.length??0,{personRequests:H}=xb({tournamentRecords:e,requestType:ZR});for(;C?.length&&_.length&&F<=j;){F++;let{scheduleTime:q}=C.shift(),Z=_.find(K=>{let{matchUpId:Q}=K,{dependenciesScheduled:J,remainingDependencies:ne}=O5({matchUpScheduleTimes:R,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:K});if(!J)return A[Q]||(A[Q]=[]),A[Q].push({scheduleTime:q,remainingDependencies:ne}),!1;let{enoughTime:re}=F5({individualParticipantProfiles:o,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:q,matchUp:K});if(!re)return N[Q]||(N[Q]=[]),N[Q].push({scheduleTime:q}),!1;let{conflicts:oe}=L5({potentials:c,averageMatchUpMinutes:n,requestConflicts:P,personRequests:H,scheduleTime:q,scheduleDate:f,matchUp:K});if(oe?.length)return!1;let de=a?.[K.matchUpId];return EC({recoveryMinutes:de||r,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:q,matchUp:K}),R[K.matchUpId]=q,!0});_=_.filter(({matchUpId:K})=>K!==Z?.matchUpId),Z||M.push(q)}_.forEach(q=>{XG({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,value:-1,matchUp:q})});let G=[];Object.keys(x).forEach(q=>{let Z=e[q];Z&&Object.keys(x[q]).forEach(K=>{let{drawDefinition:Q}=Cv({tournamentRecord:Z,drawId:K});Q&&x[q][K].forEach(({matchUpId:J})=>{let ne=R[J];if(ne){let re=ne.split(":").map(Bu).join(":"),oe=`${Pi(f)}T${re}`;b?G.push(J):(Rv({drawDefinition:Q,matchUpId:J,scheduledTime:oe}).success&&G.push(J),U&&ID({tournamentRecords:e,tournamentRecord:Z,drawDefinition:Q,matchUpId:J,venueId:U}))}})})});let W=k3(_);return{...le,requestConflicts:Object.values(P),remainingScheduleTimes:C?.map(({scheduleTime:q})=>q),individualParticipantProfiles:o,matchUpNotBeforeTimes:l,participantIdsAtLimit:$,skippedScheduleTimes:M,overLimitMatchUpIds:O,scheduledMatchUpIds:G,noTimeMatchUpIds:W,recoveryTimeDeferred:N,dependencyDeferred:A}}function tme({tournamentRecords:t,matchUps:e}){if(!ac(e))return{error:Vm};if(e.some(({matchUpId:h,hasContext:f})=>h&&!f))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:HO};let i=Math.max(...e.map(({schedule:h})=>h?.courtOrder||1).map(h=>ri(h))),n=Dt(1,i+1).map(h=>e.filter(f=>ri(f.schedule?.courtOrder)===h)),r={},a={},s={};n.flat().filter(Boolean).sort(d0).forEach(({schedule:h})=>delete h[u_]);let o=wi(e.map(({drawId:h})=>h)),l=gd({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:o}).matchUpDependencies,u=n.map((h,f)=>h.reduce((m,g)=>{if(!g.matchUpId)return m;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:b,schedule:I,sides:S,potentialParticipants:w}=g,T=I?.courtId;r[v]=f,a[T]=[],m.matchUpIds.push(v),s[v]=g;let U=l[v].matchUpIds;U.length&&m.sourceMatchUpIds.push(...U);let C=S?.map(P=>[P.participant?.individualParticipantIds,P.participantId]).flat().filter(Boolean)??[],E=w?.flat().map(({individualParticipantIds:P,participantId:M})=>[P,M]).flat().filter(Boolean)||[];return m.participantIds.push(...E,...C),y&&m.targetMatchUpIds.push(y),b&&m.targetMatchUpIds.push(b),m},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),c=(h,f)=>l[h].sources.reduce((m,g,v)=>g.includes(f)&&v+1||m,0),d=u.map(()=>[]),p=(h,f,m,g)=>{if(!s[h].schedule[u_]){s[h].schedule[u_]=f,s[h].schedule[Mue]=g,d[r[h]].push({matchUpId:h,issueType:m,issueIds:g,issue:f});let v=s[h].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:h,issue:f,issueType:m,issueIds:g})}};return u.forEach((h,f)=>{let m=f?u[f-1]:void 0,g=u.slice(f+1),v={},y=Rl(h.participantIds),b=Object.keys(y).filter(w=>y[w]>1),I=h.matchUpIds.filter(w=>l[w].participantIds.some(T=>b.includes(T)));I.forEach(w=>{v[w]||(v[w]={}),v[w][ay]||(v[w][ay]=I.filter(T=>T!==w))});let S=m&&h.participantIds.filter(w=>m.participantIds.includes(w));S&&S.forEach(w=>{let T=h.matchUpIds.concat(m.matchUpIds).filter(U=>l[U].participantIds.includes(w));T.forEach(U=>{v[U]||(v[U]={}),v[U][sy]||(v[U][sy]=T.filter(C=>C!==U))})}),h.matchUpIds.forEach(w=>{let T=l[w].matchUpIds;for(let C of g){let E=C.matchUpIds.filter(P=>T.includes(P));E?.length&&(E.forEach(P=>p(P,CG,Tg,[w])),p(w,CG,Tg,E))}if(v[w]?.[ay]&&p(w,ay,PG,v[w][ay]),h.sourceMatchUpIds.includes(w)){let C=h.matchUpIds.filter(E=>l[E].matchUpIds.includes(w));p(w,ay,Tg,C),h.matchUpIds.filter(E=>l[E].matchUpIds.includes(w)).forEach(E=>p(E,ay,Tg,[w]))}let U=m?.matchUpIds?.filter(C=>c(w,C)>1);if(U?.length&&(p(w,RG,Tg,U),U.forEach(C=>p(C,RG,Tg,[w]))),v[w]?.[sy]&&p(w,sy,PG,v[w][sy]),m?.targetMatchUpIds?.includes(w)){let C=s[w].schedule.courtId,E=T.filter(P=>m.matchUpIds.includes(P));E.some(P=>s[P].schedule.courtId===C)||(E.forEach(P=>p(P,sy,Tg,[w])),p(w,sy,Tg,E))}})}),{courtIssues:a,rowIssues:d}}function ime(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return ce({result:{error:fr},stack:e});let{matchUpsContextIds:n,firstToLast:r}=t;if(!n)return ce({result:{error:Zt},stack:e});let a=n?.length;if(!a)return{...le};let s=0;return n.forEach((l,u)=>{let{tournamentId:c,drawId:d,matchUpId:p}=l,h=u+(r?-1:1);h<0&&(h=a-1),h===a&&(h=0);let f=n[h].schedule.scheduledTime,m=o({tournamentId:c,scheduledTime:f,matchUpId:p,drawId:d});if(m.success)s++;else return m}),s===a?le:ce({result:{error:soe},stack:e});function o({tournamentId:l,scheduledTime:u,matchUpId:c,drawId:d}){let p=i[l],{drawDefinition:h}=Cv({tournamentRecord:p,drawId:d});return h?Rv({drawDefinition:h,scheduledTime:u,matchUpId:c}):{error:cu}}}function nme(t){let{scheduleChange:e,matchUpIds:i,dryRun:n}=t;if(!i||!Array.isArray(i))return{error:qw};if(typeof e!="object")return{error:Ee};let r=ic(t),a=[],s=[];for(let l of Object.values(r)){let u=$2e({tournamentRecord:l,scheduleChange:e,matchUpIds:i,dryRun:n});if(u.error)return u;Array.isArray(u.notRescheduled)&&s.push(...u.notRescheduled);let c=k3(u.notRescheduled),d=[];u.rescheduled?.forEach(p=>{let{matchUpId:h}=p;c.includes(h)&&d.push(h),a.push(p)}),d.length&&(s=u?.notRescheduled?.filter(({matchUpId:p})=>!d.includes(p))||[])}let o=!!(a.length&&!s.length);return{...le,rescheduled:a,notRescheduled:s,allRescheduled:o}}function $2e({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:n}){if(!t)return{error:ot};if(!i||!Array.isArray(i))return{error:qw};if(typeof e!="object")return{error:Ee};let r=[],a=[],{minutesChange:s,daysChange:o}=e;if(!s&&!o)return{...le};if(s&&isNaN(s))return{error:Ee};if(o&&isNaN(o))return{error:Ee};let{matchUps:l}=Za({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),u=({matchUpStatus:I})=>!Yr.includes(I),c=l?.filter(I=>GR({schedule:I.schedule})).filter(I=>u({matchUpStatus:I.matchUpStatus}));if(!c?.length)return{...le};let{tournamentInfo:d}=I0({tournamentRecord:t}),{startDate:p,endDate:h}=d,f=c?.reduce((I,S)=>{let{matchUpId:w,drawId:T}=S;return I[T]?I[T].push(w):I[T]=[w],I},{}),m=1440;for(let I of Object.keys(f)){let S=Cv({tournamentRecord:t,drawId:I});if(S.error)return S;let w=S.drawDefinition,T=f[I].filter(U=>i.includes(U));for(let U of T)if(U&&w){let C=c.find(A=>A.matchUpId===U)?.schedule,{scheduledTime:E,scheduledDate:P}=C,M,R,N;if(!M&&o&&P){let A=Pi(P);N=GE(A,o),M=new Date(N)<new Date(p)||new Date(N)>new Date(h)}if(s&&E){let A=Pi(E),_=rn(Jn(E))+s;if(M=_<0||_>m,!M){let x=tl(E,s),O=A&&N||P===A&&A;R=O?`${O}T${x}`:x}}if(M)a.push(U);else{if(!n){if(R){let A=Rv({scheduledTime:R,drawDefinition:w,matchUpId:U});if(A.error)return A}if(N){let A=RF({scheduledDate:N,drawDefinition:w,matchUpId:U});if(A.error)return A}}(R||N)&&r.push(U)}}}let g=Za({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],v=g.filter(({matchUpId:I})=>r.includes(I)),y=g.filter(({matchUpId:I})=>a.includes(I)),b=v.length&&!y.length;return{...le,rescheduled:v,notRescheduled:y,allRescheduled:b}}function rme(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:fr};let{sourceMatchUpContextIds:n,targetMatchUpContextIds:r,sourceCourtId:a,targetCourtId:s,courtDayDate:o}=t||{},{drawId:l,matchUpId:u,tournamentId:c}=n||{},{drawId:d,matchUpId:p,tournamentId:h}=r||{};if(!u&&!p)return ce({result:{error:Zt},stack:e});let{matchUps:f}=jd({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=f?.find(({matchUpId:I})=>I===u),g=f?.find(({matchUpId:I})=>I===p),v=0;if(s&&u&&!p){let I=y({tournamentId:c,matchUpId:u,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(I?.success&&v++,I.error)return ce({result:I,stack:e})}else if(a&&s&&u&&p){let I=y({tournamentId:c,matchUpId:u,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(I.success&&v++,I.error)return ce({result:I,stack:e,info:"source"});let S=y({tournamentId:h,sourceCourtId:s,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:o});if(S.success&&v++,S.error)return ce({result:S,stack:e,info:"target"})}else return{error:Zt};return v?le:ce({result:{error:KU},stack:e});function y(I){let{tournamentRecords:S,tournamentId:w,matchUp:T,drawId:U}=I,C=S[w],{drawDefinition:E}=Cv({tournamentRecord:C,drawId:U});return T.matchUpType===Hn?b({...I,tournamentRecord:C,drawDefinition:E}):S0({...I,tournamentRecord:C,drawDefinition:E})}function b({removePriorValues:I,tournamentRecords:S,tournamentRecord:w,drawDefinition:T,sourceCourtId:U,courtDayDate:C,matchUpId:E,matchUp:P,courtId:M}){let R=[M].concat(P.schedule.allocatedCourts.map(({courtId:N})=>N).filter(N=>N!==U));return MF({removePriorValues:I,tournamentRecords:S,tournamentRecord:w,drawDefinition:T,courtDayDate:C,matchUpId:E,courtIds:R})}}function ame({scheduleAttributes:t=[Qh,Xg,a0,s0,o0,Ed,ym,Ah,nm],tournamentRecord:e,drawDefinition:i,matchUpId:n}){let r="clearMatchUpSchedule",a=i?uo({matchUpFilters:{matchUpIds:[n]},inContext:!1,drawDefinition:i}).matchUps?.[0]:Za({matchUpFilters:{matchUpIds:[n]},tournamentRecord:e,inContext:!1}).matchUps?.[0];if(!a)return{error:Vs};let s=(a.timeItems??[]).filter(o=>o?.itemType&&!t.includes(o?.itemType));return a.timeItems=s,Zi({tournamentId:e.tournamentId,context:r,drawDefinition:i,matchUp:a}),{...le}}function sme(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="object"||!Object.keys(r).length)return{error:fr};if(typeof n!="object")return{error:jm};let a=Object.keys(r).filter(s=>!i||i===s);if(i&&!a.includes(i))return{error:Ee};for(let s of a){let o=r[s],l=un({extension:{name:tR,value:{dailyLimits:n}},element:o});if(l.error)return l}return{...le}}var X5={};Fi(X5,{addCollectionDefinition:()=>e6,addCollectionGroup:()=>pme,aggregateTieFormats:()=>fme,compareTieFormats:()=>bm,getTieFormat:()=>oF,modifyCollectionDefinition:()=>J5,modifyTieFormat:()=>hme,mutate:()=>ome,orderCollectionDefinitions:()=>cme,query:()=>Cpe,removeCollectionDefinition:()=>Q5,removeCollectionGroup:()=>ume,tieFormatGenderValidityCheck:()=>JO,validateCollectionDefinition:()=>K1});var ome={};Fi(ome,{addCollectionDefinition:()=>e6,addCollectionGroup:()=>pme,aggregateTieFormats:()=>fme,modifyCollectionDefinition:()=>J5,modifyTieFormat:()=>hme,orderCollectionDefinitions:()=>cme,removeCollectionDefinition:()=>Q5,removeCollectionGroup:()=>ume});function tb({drawDefinition:t,structureId:e,matchUpId:i,structure:n,matchUp:r,eventId:a,event:s}){let o="getTieFormat",l;if(e=n?.structureId??e,i=r?.matchUpId??i,(i||e)&&!t)return{error:Ot};if(a&&s)l=hp(s);else if(i){if(t&&(!r||!n)){let u=Qn({drawDefinition:t,matchUpId:i});if(u.error)return u;if(u.matchUp?.matchUpType!==uu)return ce({result:{error:rl},stack:o});n||(n=u.structure),r||(r=u.matchUp)}l=pP({item:r,drawDefinition:t,structure:n,event:s})||pP({item:n,drawDefinition:t,structure:n,event:s})||hp(t)||hp(s)}else if(t&&e){if(!n){let u=li({drawDefinition:t,structureId:e});if(u.error)return u;n=u?.structure}l=pP({item:n,drawDefinition:t,structure:n,event:s})||hp(t)||hp(s)}else l=hp(t)||hp(s);return l?{...le,structure:n,tieFormat:l,matchUp:r}:ce({result:{error:qU},stack:o})}function Fk({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![Yr].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==hd&&!ca(t))}function dV({from:t,to:e}){let i=Object.keys(t),n=Dr(i,Object.keys(e)).length===i.length,r=i.filter(s=>t[s]!==e[s]).map(s=>({countChange:e[s]-t[s],collectionId:s})),a=i.every(s=>t[s]===e[s]);return{equivalent:n&&a,matchUpsCountChanges:r}}function B2e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:n,tieFormat:r,eventId:a,matchUp:s,event:o,uuids:l}){let u="updateTieFormat",c=e?.tournamentId,d=0,p=0,h=0,f=0,m=r?.collectionDefinitions.reduce((w,T)=>(w[T.collectionId]=(w[T.collectionId]||0)+T.matchUpCount,w),{}),g=({tieFormat:w})=>{let T=w?.collectionDefinitions.reduce((U,C)=>(U[C.collectionId]=(U[C.collectionId]||0)+C.matchUpCount,U),{});return dV({from:T,to:m}).equivalent},v=tb({drawDefinition:i})?.tieFormat,y=tb({event:o})?.tieFormat;if(o&&a){for(let w of o.drawDefinitions??[])b({drawDefinition:w});o.tieFormat=hs(r),f+=1}else if(s){if(!s.tieMatchUps)return ce({result:{error:rl},stack:u});let w=Rl(s.tieMatchUps?.map(({collectionId:P})=>P)),T=dV({to:m,from:w}),{changes:U,changesArePossible:C,cannotChangeReaon:E}=oJ({matchUp:s,check:T});if(T.equivalent)if(Fk({matchUp:s,updateInProgressMatchUps:t}))s.tieFormat=hs(r),f+=1;else return ce({result:{error:Gq},info:"matchUp is IN_PROGRESS or COMPLETE",stack:u});else if(C)S({tieFormat:r,matchUp:s,changes:U,uuids:l});else return ce({context:{collectionMap:m,matchUpMap:w},result:{error:Rh},info:E||"specified changes not possible",stack:u});p+=1,Zi({eventId:o?.eventId,context:u,drawDefinition:i,tournamentId:c,matchUp:s})}else if(n){let w=I({inheritedTieFormat:v??y,structure:n})?.modifiedMatchUpsCount;w&&(p+=w,d+=1,f+=1);let T=!n.tieFormat||bm({ancestor:n.tieFormat,descendant:r}).different;T&&(n.tieFormat=hs(r),d+=1,f+=1),(w||T)&&i&&Ln({structureIds:[n.structureId],eventId:o?.eventId,drawDefinition:i})}else if(i)b({drawDefinition:i}),i.tieFormat=hs(r),f+=1;else return{error:Ot};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:h,modifiedCount:f,...le,tieFormat:r};function b({drawDefinition:w}){let T=w.structures||[],U=[];for(let C of T){if(C.tieFormat)continue;let E=I({inheritedTieFormat:y,structure:C})?.modifiedMatchUpsCount;if(E){d+=1,p+=E;let P=C.structureId;U.push(P)}}return Ln({structureIds:U,eventId:o?.eventId,drawDefinition:w}),U.length}function I({inheritedTieFormat:w,structure:T}){let U=0,C=cn({matchUpFilters:{matchUpTypes:[Hn]},structure:T})?.matchUps||[];for(let E of C){let P=Fk({matchUp:E,updateInProgressMatchUps:t}),M=!1,R=Rl(E.tieMatchUps?.map(({collectionId:A})=>A)),N=dV({from:R,to:m});if(N.equivalent)E.tieFormat&&g(E)&&P&&(E.tieFormat=hs(r),M=!0);else{let{changes:A,changesArePossible:_}=oJ({matchUp:E,check:N});if(_&&!E.tieFormat)S({changes:A,matchUp:E,tieFormat:r,uuids:l});else if(w)(!E.tieFormat||bm({ancestor:w,descendant:E.tieFormat}).different)&&(E.tieFormat=w,M=!0);else return ce({result:{error:qU},stack:u})}M&&(U+=1,Zi({tournamentId:e?.tournamentId,drawDefinition:i,context:u,eventId:a,matchUp:E}))}return{modifiedMatchUpsCount:U}}function S({uuids:w,matchUp:T,tieFormat:U,changes:C}){T.tieFormat=hs(U);let E=[],P=[];return C.forEach(M=>{if(M.countChange>0){let R=Math.max(0,...T.tieMatchUps.filter(_=>_.collectionId===M.collectionId).map(kl("collectionPosition"))),N=U.collectionDefinitions.find(_=>_.collectionId===M.collectionId),A=RR({matchUpsLimit:M.countChange,collectionPositionOffset:R,collectionDefinition:N,matchUp:T,uuids:w});P.push(...Ct(A,!1,!0)),h+=P.length,T.tieMatchUps.push(...A)}else{let R=M.toBePlayedTieMatchUpIds.slice(0,Math.abs(M.countChange));console.log("remove",R.length),E.push(...R),T.tieMatchUps=T.tieMatchUps.filter(({matchUpId:N})=>!R.includes(N))}}),P.length&&Yg({matchUps:P,drawDefinition:i,tournamentId:c,eventId:a}),E.length&&ff({matchUpIds:E,action:"updateTieFormat",drawDefinition:i,tournamentId:c,eventId:a}),{matchUpIdsRemoved:E,matchUpsAdded:P}}}function oJ({check:t,matchUp:e}){let i="",n=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:r,countChange:a})=>{let s=e.tieMatchUps.filter(l=>l.collectionId===r&&l.matchUpStatus===Er).map(kl("matchUpId")),o=s.length+a>=0||a>0;return!o&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),n.push({toBePlayedTieMatchUpIds:s,collectionId:r,countChange:a}),o}),changes:n,cannotChangeReaon:i}}function BF({appliedPolicies:t,drawDefinition:e,auditData:i}){if(!t?.audit?.[dP])return;let{extension:n}=_i({name:dP,element:e}),r={value:Array.isArray(n?.value)?n?.value.concat(i):[i],name:dP};un({element:e,extension:r})}function J5({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:n,tieFormatName:r,drawDefinition:a,matchUpFormat:s,matchUpCount:o,collectionId:l,matchUpType:u,structureId:c,matchUpId:d,category:p,eventId:h,gender:f,event:m,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I}){let S="modifyCollectionDefinition";if(s&&!Ml({matchUpFormat:s}))return ce({result:{error:Ee},context:{matchUpFormat:s},stack:S});if(n&&typeof n!="string")return ce({result:{error:Ee},context:{collectionName:n},stack:S});if(f&&!Object.values(eh).includes(f))return ce({result:{error:Ee},context:{gender:f},stack:S});if(p&&typeof p!="object")return ce({result:{error:Ee},context:{category:p},stack:S});let w={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I};if(!Object.values(w).filter(Boolean).length&&!i&&!n&&!s&&!o&&!u)return ce({result:{error:Zt},stack:S});if(Object.values(w).filter(Boolean).length>1)return ce({info:"Only one value assignment allowed per collectionDefinition",result:{error:Ee},stack:S});let T=tb({drawDefinition:a,structureId:c,matchUpId:d,eventId:h,event:m});if(T.error)return ce({result:T,stack:S});let{matchUp:U,structure:C,tieFormat:E}=T,P=hs(E),M=E?.collectionDefinitions.find(G=>G.collectionId===l),R=P?.collectionDefinitions.find(G=>G.collectionId===l);if(!M)return ce({info:"source collectionDefinition",result:{error:Ya},context:{collectionId:l},stack:S});let N=v??y??b??I;if(g?.length){let G=ose({matchUpCount:o??M?.matchUpCount??0,collectionValueProfiles:g});if(G.errors)return ce({result:{error:Ee},info:G.errors,stack:S})}else if(N&&!yi(N))return ce({result:{error:Ee},info:"value is not an integer",context:{value:N},stack:S});let A=(G,W)=>Dr(Object.keys(G),Object.keys(W)).length===Object.keys(G).length&&Dr(Object.values(G),Object.values(W)).length===Object.values(G).length,_=g&&(!M.collectionValueProfiles||!A(M.collectionValueProfiles,g)),x=yi(v)&&M.collectionValue!==v||yi(y)&&M.matchUpValue!==y||yi(b)&&M.scoreValue!==b||yi(I)&&M.setValue!==I||_,O=[];if(x&&(R.collectionValueProfiles=void 0,R.collectionValue=void 0,R.matchUpValue=void 0,R.scoreValue=void 0,R.setValue=void 0,Object.assign(R,w),O.push({collectionId:l,...Vt(w)})),(yi(b)||yi(I))&&R.collectionGroupNumber){let G=R.collectionGroupNumber;P.collectionDefinitions=P.collectionDefinitions.map(W=>{let{collectionGroupNumber:q,...Z}=W;return q===G?Z:W}),P.collectionGroups=P.collectionGroups.filter(({groupNumber:W})=>W!==G),O.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:$,valueGoal:F}=w0(P),j=Vt({aggregateValue:$,valueGoal:F});if((j.aggregateValue!==E?.winCriteria.aggregateValue||j.valueGoal!==E?.winCriteria.valueGoal)&&(P.winCriteria=j,O.push({collectionId:l,winCriteria:j})),yi(i)&&M.collectionOrder!==i&&(R.collectionOrder=i,O.push({collectionId:l,collectionOrder:i})),n&&M.collectionName!==n&&(R.collectionName=n,O.push({collectionId:l,collectionName:n})),s&&M.matchUpFormat!==s&&(R.matchUpFormat=s,O.push({collectionId:l,matchUpFormat:s})),yi(o)&&M.matchUpCount!==o&&(R.matchUpCount=o,O.push({collectionId:l,matchUpCount:o})),u&&M.matchUpType!==u)return ce({result:{error:WO},context:{matchUpType:u},stack:S});p&&M.category!==p&&(R.category=p,O.push({collectionId:l,category:p})),f&&M.gender!==f&&(R.gender=f,O.push({collectionId:l,gender:f}));let H=Vt(P);if(T=Lo({tieFormat:H}),T.error)return ce({result:T,stack:S});if(!O.length)return ce({result:{...le,modifications:O}});if(E?.tieFormatName!==r?(H.tieFormatName=r,O.push({tieFormatName:r})):O.length&&(delete H.tieFormatName,O.push("tieFormatName removed: modifications without new tieFormatName")),T=B2e({tieFormat:H,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:C,eventId:h,matchUp:U,event:m}),!T.error){let{appliedPolicies:G}=sn({tournamentRecord:e}),W=Vt({collectionDefinition:R,drawId:a?.drawId,action:S,structureId:c,matchUpId:d,eventId:h});BF({appliedPolicies:G,drawDefinition:a,auditData:W})}return ce({result:{...T,modifications:O},stack:S})}function V2e({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:n,matchUpId:r,matchUp:a}){let s=[];return r&&a?s=[a]:i&&n?s=cn({matchUpFilters:{matchUpTypes:[Hn]},structure:n})?.matchUps??[]:e&&(s=uo({matchUpFilters:{matchUpTypes:[Hn]},drawDefinition:e})?.matchUps??[]),{targetMatchUps:s.filter(o=>!o.winningSide&&o.matchUpStatus!==Ur&&(t||o.matchUpStatus!==hd&&!ca(o)))}}function j2e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:n,tieFormat:r,event:a}){for(let s of n){let o=!!s.tieFormat;o&&(s.tieFormat=hs(r));let l;if(t){let u=sn({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,c=qm({matchUpId:s.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:u,drawDefinition:i,event:a});if(c.error)return c;l=c.score}o&&!l&&Zi({tournamentId:e?.tournamentId,context:"updateTargetTeamMatchUps",eventId:a?.eventId,matchUp:s,drawDefinition:i})}return{...le}}function lme({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:n,tieFormatName:r,drawDefinition:a,structureId:s,structure:o,tieFormat:l,matchUpId:u,matchUp:c,eventId:d,event:p}){let{aggregateValue:h,valueGoal:f}=w0(l);l.winCriteria=Vt({aggregateValue:h,valueGoal:f}),(e&&e!==f||h&&!n)&&(r?l.tieFormatName=r:delete l.tieFormatName);let{targetMatchUps:m}=V2e({updateInProgressMatchUps:t,drawDefinition:a,structureId:s,structure:o,matchUpId:u,matchUp:c});j2e({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:a,tieFormat:l,event:p});let g=Vt(l),v=Lo({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(u&&c)c.tieFormat=l;else if(o)o.tieFormat=g;else if(a)a.tieFormat=g;else if(!c||!a)return{error:Ot};return Ln({drawDefinition:a,eventId:p?.eventId}),{...le}}function ume({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,matchUpId:s,matchUp:o,eventId:l,event:u}){if(!e)return{error:Zt};if(isNaN(e))return{error:Ee};let c="removeCollectionGroup",d=o?void 0:tb({drawDefinition:n,structureId:a,matchUpId:s,eventId:l,event:u});if(d?.error)return ce({result:d,stack:c});let p=d?.structure;o=o??d?.matchUp;let h=d?.tieFormat,f=h?.winCriteria.valueGoal,m=h?.winCriteria.aggregateValue,g=hs(h);if(d=Lo({tieFormat:g}),d.error)return ce({result:d,stack:c});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(y=>{let{collectionGroupNumber:b,...I}=y;return b!==e?y:(v.push(y.collectionId),I)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:y})=>y!==e),d=lme({updateInProgressMatchUps:t,originalValueGoal:f,wasAggregateValue:m,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,structure:p,tieFormat:g,matchUpId:s,matchUp:o,eventId:l,event:u}),!d.error){let{appliedPolicies:y}=sn({tournamentRecord:i}),b=Vt({drawId:n?.drawId,collectionGroupNumber:e,action:c,structureId:a,matchUpId:s,eventId:l});BF({appliedPolicies:y,drawDefinition:n,auditData:b})}return ce({result:{...d,modifiedCollectionIds:v},stack:c})}function qT({tieFormat:t,orderMap:e}){let i=hs(t);return i.collectionDefinitions?.forEach(n=>{let r=e[n.collectionId];r&&(n.collectionOrder=r)}),i.collectionDefinitions?.sort((n,r)=>DT(n.collectionOrder)-DT(r.collectionOrder)),i}function cme({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,orderMap:r,eventId:a,matchUp:s,event:o}){if(typeof r!="object"||!Object.values(r).every(c=>yi(c)))return ce({result:{error:Ee},context:{orderMap:r}});let l=i?li({drawDefinition:e,structureId:i}):void 0;if(l?.error)return l;let u=l?.structure;if(a&&o?.tieFormat)lJ({tournamentRecord:t,event:o,orderMap:r});else if(n){let c=e&&Qn({drawDefinition:e,matchUpId:n});if(c?.error)return c;if(s=c.matchUp,!s)return{error:Oo};let d=oF({tournamentRecord:t,matchUpId:n,structure:u,drawDefinition:e,event:o})?.tieFormat;s.tieFormat=qT({tieFormat:d,orderMap:r}),Zi({tournamentId:t?.tournamentId,eventId:o?.eventId,drawDefinition:e,matchUp:s})}else if(i)if(u?.tieFormat)u.tieFormat=qT({tieFormat:u.tieFormat,orderMap:r}),dme({eventId:o?.eventId,tournamentRecord:t,drawDefinition:e,structure:u,orderMap:r}),Ln({drawDefinition:e,structureIds:[u.structureId]});else if(e.tieFormat)JG({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:r,event:o});else if(o?.tieFormat)lJ({structureIds:[i],tournamentRecord:t,orderMap:r,event:o});else return{error:Ya};else if(e?.tieFormat)JG({tournamentRecord:t,drawDefinition:e,orderMap:r,event:o});else return{error:Ya};return{...le}}function lJ({tournamentRecord:t,structureIds:e,orderMap:i,event:n}){let r=qT({tieFormat:n.tieFormat,orderMap:i});e?.length||(n.tieFormat=r);for(let a of n.drawDefinitions??[])JG({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:n})}function JG({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:n,event:r}){let a=e.tieFormat??r?.tieFormat,s=qT({tieFormat:a,orderMap:n});i?.length||(e.tieFormat=s);let o=[];for(let l of e.structures??[])i?.length&&!i.includes(l.structureId)||((l.tieFormat||i?.includes(l.structureId))&&(l.tieFormat=qT({tieFormat:l.tieFormat??e.tieFormat??r?.tieFormat,orderMap:n})),dme({eventId:r?.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:n}),o.push(l.structureId));Ln({drawDefinition:e,structureIds:o})}function dme({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:n,eventId:r}){let a=cn({matchUpFilters:{matchUpTypes:[Hn]},structure:i})?.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=qT({tieFormat:s.tieFormat,orderMap:n}),Zi({tournamentId:t?.tournamentId,drawDefinition:e,eventId:r,matchUp:s}))}function Q5({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,collectionId:a,structureId:s,matchUpId:o,eventId:l,matchUp:u,event:c}){let d="removeCollectionDefinition",p=u?void 0:tb({drawDefinition:n,structureId:s,matchUpId:o,eventId:l,event:c});if(p?.error)return ce({result:p,stack:d});let h=p?.structure;u=u??p?.matchUp;let f=p?.tieFormat,m=hs(f);if(p=Lo({tieFormat:m}),p.error)return ce({result:p,stack:d});let g=m?.collectionDefinitions?.find(P=>P.collectionId===a);if(!g)return ce({result:{error:Ya,collectionId:a}});m.collectionDefinitions=m.collectionDefinitions.filter(P=>P.collectionId!==a),g.collectionGroupNumber&&(m.collectionDefinitions=m.collectionDefinitions.map(P=>{let{collectionGroupNumber:M,...R}=P;return R}),m.collectionGroups=m.collectionGroups.filter(({groupNumber:P})=>P!==g.collectionGroupNumber));let{aggregateValue:v,valueGoal:y}=w0(m);m.winCriteria=Vt({aggregateValue:v,valueGoal:y});let b=f?.winCriteria.valueGoal,I=f?.winCriteria.aggregateValue;(b&&b!==y||v&&!I)&&(r?m.tieFormatName=r:delete m.tieFormatName);let S=[];o&&u?S=[u]:s&&h?S=cn({matchUpFilters:{matchUpTypes:[Hn]},structure:h})?.matchUps??[]:n?S=uo({matchUpFilters:{matchUpTypes:[Hn]},drawDefinition:n})?.matchUps??[]:c&&(S=gf({matchUpFilters:{matchUpTypes:[Hn]}})?.matchUps??[]);let w=(S||[]).filter(P=>{let M=P.tieMatchUps?.filter(N=>N.collectionId===a)?.some(ca),R=e&&P.tieFormat?bm({descendant:P.tieFormat,ancestor:m})?.different:!1;return t&&!M||!P.winningSide&&P.matchUpStatus!==Ur&&(t||P.matchUpStatus!==hd&&!ca(P)&&!R)});if(!w.length)return{error:KU};let{appliedPolicies:T}=sn({tournamentRecord:i});if(o&&u&&t){let P=u.tieMatchUps?.filter(M=>M.collectionId===a);for(let M of P??[]){let R=wD({matchUpId:M.matchUpId,tieMatchUpId:u?.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:T,drawDefinition:n,event:c});if(R.error||(R=Qn({drawDefinition:n,matchUpId:o}),R.error))return R;u=R?.matchUp}}let U=[];for(let P of w){for(let M of P?.sides??[])M.lineUp=(M.lineUp??[]).map(R=>({participantId:R.participantId,collectionAssignments:(R?.collectionAssignments??[]).filter(N=>N.collectionId!==a)}));if(P.tieMatchUps=(P.tieMatchUps??[]).filter(M=>{let R=M.collectionId===a;return R&&U.push(M.matchUpId),!R}),P.tieFormat&&(P.tieFormat=hs(m)),t){let M=qm({matchUpId:P.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:T,drawDefinition:n,event:c});if(M.error)return M}Zi({tournamentId:i?.tournamentId,eventId:c?.eventId,drawDefinition:n,context:d,matchUp:P})}U.length&&ff({tournamentId:i?.tournamentId,matchUpIds:U,eventId:c?.eventId,drawDefinition:n});let C=Vt(m);if(p=Lo({tieFormat:C}),p.error)return ce({result:p,stack:d});if(l&&c)c.tieFormat=C;else if(o&&u)u.tieFormat=C;else if(h)h.tieFormat=C;else if(n)n.tieFormat=C;else if(!u||!n)return{error:Ot};Ln({drawDefinition:n,eventId:c?.eventId});let E=Vt({drawId:n?.drawId,action:d,collectionId:a,structureId:s,matchUpId:o,eventId:l});return BF({appliedPolicies:T,drawDefinition:n,auditData:E}),{tieFormat:C,deletedMatchUpIds:U,targetMatchUps:w,...le}}function pme({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:n,collectionIds:r,tieFormatName:a,structureId:s,matchUpId:o,matchUp:l,eventId:u,event:c}){let d="addCollectionGroup";if(!Array.isArray(r))return ce({result:{error:Zt},stack:d});let p=l?void 0:tb({drawDefinition:n,structureId:s,matchUpId:o,eventId:u,event:c});if(p?.error)return ce({result:p,stack:d});let h=p?.structure;l=l||p?.matchUp;let f=p?.tieFormat,m=f?.winCriteria.valueGoal,g=hs(f);if(p=Lo({tieFormat:g}),p.error)return ce({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:b,collectionGroupNumber:I}=y;if(I&&r.includes(b))return ce({info:"collectionIds cannot be part of other collectionGroups",result:{error:Ee},stack:d})}let v=(g.collectionGroups||[]).reduce((y,b)=>b.groupNumber>y?b.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>r.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],lme({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:n,tieFormatName:a,structureId:s,structure:h,tieFormat:g,matchUpId:o,matchUp:l,eventId:u,event:c})}function e6({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:n,policyDefinitions:r,enforceCategory:a,referenceGender:s,drawDefinition:o,tieFormatName:l,enforceGender:u,structureId:c,matchUpId:d,matchUp:p,eventId:h,uuids:f,event:m}){let g="addCollectionDefinition",v=sn({tournamentRecord:n,drawDefinition:o,event:m}).appliedPolicies??{},y=r?.[Ha]??v?.[Ha];a=a??y?.participants?.enforceCategory;let b=(u??y?.participants?.enforceGender)!==!1,I=!!((i??m?.category)&&a!==!1),S=!!((s??m?.gender)&&b),w=K1({referenceCategory:i??m?.category,collectionDefinition:e,referenceGender:s,checkCategory:I,checkGender:S,event:m});if(w.error)return ce({result:w,stack:g});let T=p?.tieFormat?void 0:tb({drawDefinition:o,structureId:c,matchUpId:d,eventId:h,event:m});if(T?.error)return ce({result:{error:T.error},stack:g});let U=T?.structure;p=p??T?.matchUp;let C=p?.tieFormat??T?.tieFormat,E=hs(C);if(T=Lo({tieFormat:E}),T?.error)return ce({result:{error:T.error},stack:g});if(!e.collectionId)e.collectionId=mn();else if(E.collectionDefinitions.map(({collectionId:F})=>F).includes(e.collectionId))return ce({context:{collectionId:e.collectionId},result:{error:coe}});E.collectionDefinitions.push(e),E.collectionDefinitions.sort((F,j)=>(F.collectionOrder||0)-(j.collectionOrder||0)).forEach((F,j)=>F.collectionOrder=j+1);let{aggregateValue:P,valueGoal:M}=w0(E);E.winCriteria=Vt({aggregateValue:P,valueGoal:M});let R=C?.winCriteria.valueGoal,N=C?.winCriteria.aggregateValue;(R&&R!==M||P&&!N)&&(l?E.tieFormatName=l:delete E.tieFormatName);let A=[],_=[],x=[],O=Vt(E);if(T=Lo({tieFormat:O}),T?.error)return ce({result:{error:T.error},stack:g});if(h&&m){m.tieFormat=O;for(let F of m.drawDefinitions??[])if(!F.tieFormat)for(let j of F.structures??[]){if(j.tieFormat)continue;let H=pV({updateInProgressMatchUps:t,collectionDefinition:e,structure:j,uuids:f});_.push(...H.newMatchUps),x.push(...H.targetMatchUps),A.push(j.structureId)}oA({modifiedMatchUps:x,eventId:m?.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:o,addedMatchUps:_,stack:g})}else if(c&&U){U.tieFormat=O;let F=pV({updateInProgressMatchUps:t,collectionDefinition:e,structure:U,uuids:f});_.push(...F.newMatchUps),x=F.targetMatchUps,oA({modifiedMatchUps:x,eventId:m?.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:o,addedMatchUps:_,stack:g})}else if(d&&p){if(!Fk({matchUp:p,updateInProgressMatchUps:t}))return ce({result:{error:Gq},stack:g});p.tieFormat=O;let F=RR({collectionDefinition:e,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...F),_.push(...F),oA({modifiedMatchUps:[p],eventId:m?.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:o,addedMatchUps:_,stack:g})}else if(o){o.tieFormat=O;for(let F of o.structures??[]){let j=pV({updateInProgressMatchUps:t,collectionDefinition:e,structure:F,uuids:f});A.push(F.structureId),_.push(...j.newMatchUps),x.push(...j.targetMatchUps)}oA({modifiedMatchUps:x,eventId:m?.eventId,tournamentRecord:n,drawDefinition:o,addedMatchUps:_,stack:g})}else return{error:Ot};let $=Vt({drawId:o?.drawId,collectionDefinition:e,action:g,structureId:c,matchUpId:d,eventId:h});return BF({appliedPolicies:v,drawDefinition:o,auditData:$}),{tieFormat:O,targetMatchUps:x,addedMatchUps:_,...le}}function pV({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:n}){let r=[],a=(cn({matchUpFilters:{matchUpTypes:[Hn]},structure:i})?.matchUps).filter(s=>Fk({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let o=RR({collectionDefinition:e,matchUp:s,uuids:n});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...o),r.push(...o)}return{newMatchUps:r,targetMatchUps:a}}function oA({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:n,addedMatchUps:r,eventId:a,stack:s}){Yg({tournamentId:e?.tournamentId,matchUps:r,drawDefinition:n,eventId:a}),i?.forEach(o=>{Zi({tournamentId:e?.tournamentId,drawDefinition:n,context:s,matchUp:o,eventId:a})}),Ln({structureIds:t,drawDefinition:n,eventId:a})}function hme({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:n,considerations:r,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,uuids:u,event:c}){let d="modifyTieFormat";if(!Lo({tieFormat:i}).valid)return ce({result:{error:Rh},info:"falied validation",stack:d});let p=tb({drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:c});if(p.error)return ce({result:p,stack:d});let{matchUp:h,tieFormat:f}=p,m=hs(f),g=bm({descendant:i,ancestor:m,considerations:r});if(g.invalid)return ce({context:{invalid:g.invalid},result:{error:Rh},stack:d});if(!g?.different)return ce({result:{...le},info:"Nothing to do",stack:d});let v=m.collectionDefinitions.map(({collectionId:C})=>C),y=i.collectionDefinitions.map(({collectionId:C})=>C),b=v.filter(C=>!y.includes(C)),I=i.collectionDefinitions.filter(({collectionId:C})=>!v.includes(C)),S=I.map(kl("collectionId")),w=[],T,U=i.tieFormatName;for(let C of i.collectionDefinitions){if(S.includes(C.collectionId))continue;let E=J5({updateInProgressMatchUps:t,...C,tournamentRecord:n,tieFormatName:U,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:c});if(E.modifications&&w.push(...E.modifications),E.error)return ce({result:E,stack:d});E.tieFormat&&(T=E.tieFormat)}for(let C of I){let E=e6({updateInProgressMatchUps:t,collectionDefinition:C,tournamentRecord:n,drawDefinition:a,tieFormatName:U,structureId:s,matchUpId:o,matchUp:h,eventId:l,uuids:u,event:c});if(E.error)return ce({result:E,stack:d});E.tieFormat&&(T=E.tieFormat)}for(let C of b){let E=Q5({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:n,drawDefinition:a,tieFormatName:U,collectionId:C,structureId:s,matchUpId:o,eventId:l,matchUp:h,event:c});if(E.error)return ce({result:E,stack:d});E.tieFormat&&(T=E.tieFormat)}return f?.tieFormatName!==U?(T.tieFormatName=U,w.push({tieFormatName:U})):(w.length||S.length||b.length)&&(delete T.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),T.collectionDefinitions=T.collectionDefinitions.sort((C,E)=>DT(C.collectionOrder)-DT(E.collectionOrder)).map((C,E)=>({...C,collectionOrder:E+1})),{processedTieFormat:hs(T),modifications:w,...le}}function fme({tournamentRecord:t}){if(!t)return{error:ot};let e=0;for(let i of t.events??[]){let n=i.tieFormats??[],r=u=>{if(!u.tieFormat)return;let c;for(let d of n)bm({descendant:u.tieFormat,ancestor:d}).different||(c=d.tieFormatId);if(c)u.tieFormatId=c,delete u.tieFormat;else{let d=Ct(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=mn()),u.tieFormatId=d.tieFormatId,delete u.tieFormat,n.push(d),e+=1}};i.eventType,r({tieFormat:i.tieFormat});for(let u of i.drawDefinitions??[]){r({tieFormat:u.tieFormat});for(let c of u.structures??[])r({tieFormat:c.tieFormat})}let a=(u,c)=>{let d=o.matchUps?.find(p=>p.matchUpId===u);d&&(d.tieFormatId=c,delete d.tieFormat,Zi({tournamentId:t?.tournamentId,eventId:i.eventId,matchUp:d}))},s=u=>{let c=Ct(u.tieFormat,void 0,!0);c.tieFormatId||(c.tieFormatId=mn()),n.push(c),e+=1,a(u.matchUpId,c.tieFormatId)},o=gf({matchUpFilters:{matchUpTypes:[uu]},event:i}),l=o.matchUps??[];for(let u of l){let c;for(let d of n)u.tieFormat&&bm({descendant:u.tieFormat,ancestor:d}).different||(c=d.tieFormatId);c?a(u.matchUpId,c):s(u)}n.length&&(i.tieFormats=n)}return{...le,addedCount:e}}var t6={};Fi(t6,{addDrawDefinitionExtension:()=>dL,addEventExtension:()=>Sv,addEventTimeItem:()=>y0,addExtension:()=>un,addNotes:()=>VL,addOnlineResource:()=>wme,addParticipantExtension:()=>Ole,addParticipantTimeItem:()=>QW,addTimeItem:()=>rh,addTournamentExtension:()=>R3,addTournamentTimeItem:()=>kR,analyzeDraws:()=>xR,analyzeTournament:()=>L4,copyTournamentRecord:()=>gme,createTournamentRecord:()=>OF,generate:()=>mme,getAggregateTeamResults:()=>O4,getAllowedDrawTypes:()=>nF,getAllowedMatchUpFormats:()=>_4,getAppliedPolicies:()=>sn,getCompetitionDateRange:()=>aF,getCompetitionPenalties:()=>k4,getPolicyDefinitions:()=>Hm,getTournamentInfo:()=>I0,getTournamentPenalties:()=>rF,getTournamentPersons:()=>x4,getTournamentPoints:()=>sF,getTournamentStructures:()=>kW,getTournamentTimeItem:()=>TL,hydrateTournamentRecord:()=>yme,mutate:()=>vme,query:()=>Dpe,removeDrawDefinitionExtension:()=>Lle,removeEventExtension:()=>pL,removeExtension:()=>lo,removeNotes:()=>KW,removeOnlineResource:()=>Ime,removeParticipantExtension:()=>Fle,removeTournamentExtension:()=>M3,setTournamentCategories:()=>Ume,setTournamentDates:()=>VF,setTournamentEndDate:()=>Eme,setTournamentName:()=>Sme,setTournamentNotes:()=>Tme,setTournamentStartDate:()=>Dme,setTournamentStatus:()=>bme});var mme={};Fi(mme,{copyTournamentRecord:()=>gme,createTournamentRecord:()=>OF});function gme(t){let e=zt(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(e.error)return e;let{startDate:i,endDate:n}=t.tournamentRecord,r=1440*60*1e3,a=(i&&n?new Date(Pi(n)).getTime()-new Date(Pi(i)).getTime():0)/r,s=t.endDate||d3(t.startDate,a),o=p=>p?.filter(({itemType:h})=>t.itemTypeList?.includes(h)),l=p=>p?.filter(({name:h})=>t.extensionList?.includes(h)),u=p=>{let{timeItems:h,extensions:f,...m}=p;return Ct({...m,timeItems:o(h),extensions:l(f)},!1,!0)},c=p=>{let{drawDefinitions:h,timeItems:f,extensions:m,startDate:g,endDate:v,...y}=p;return Ct({extensions:l(m),timeItems:o(f),startDate:t.startDate,endDate:s,...y},!1,!0)},d={participants:t.copyParticipants?t.tournamentRecord.participants?.map(u)??[]:[],parentOrganisation:Ct({...t.tournamentRecord.parentOrganisation},!1,!0),venues:Ct(t.tournamentRecord.venues??[],!1,!0),extensions:l(t.tournamentRecord.extensions),timeItems:o(t.tournamentRecord.timeItems),events:t.tournamentRecord.events?.map(c)??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:mn(),endDate:s};return{...le,tournamentRecord:d}}var vme={};Fi(vme,{addDrawDefinitionExtension:()=>dL,addEventExtension:()=>Sv,addEventTimeItem:()=>y0,addExtension:()=>un,addNotes:()=>VL,addOnlineResource:()=>wme,addParticipantExtension:()=>Ole,addParticipantTimeItem:()=>QW,addTimeItem:()=>rh,addTournamentExtension:()=>R3,addTournamentTimeItem:()=>kR,hydrateTournamentRecord:()=>yme,removeDrawDefinitionExtension:()=>Lle,removeEventExtension:()=>pL,removeExtension:()=>lo,removeNotes:()=>KW,removeOnlineResource:()=>Ime,removeParticipantExtension:()=>Fle,removeTournamentExtension:()=>M3,setTournamentCategories:()=>Ume,setTournamentDates:()=>VF,setTournamentEndDate:()=>Eme,setTournamentName:()=>Sme,setTournamentNotes:()=>Tme,setTournamentStartDate:()=>Dme,setTournamentStatus:()=>bme});function yme(t){let{tournamentRecord:e,eventProfiles:i=[],directives:n,policyDefinitions:r}=t;return e?((e.events||[]).forEach(a=>{let s=i.find(o=>o.eventId&&o.eventId===a.eventId);(s?.directives?.hydrateRoundNames||n?.hydrateRoundNames)&&a.drawDefinitions?.forEach(o=>{(s?.policyDefinitions?.[hm]||r?.[hm])&&qpe({drawDefinition:o,appliedPolicies:r})})}),{tournamentRecord:e}):{error:ot}}var G2e="ABANDONED",H2e="ACTIVE",z2e="CANCELLED",q2e="COMPLETED",W2e="IN_PROGRESS",i6={ABANDONED:G2e,ACTIVE:H2e,CANCELLED:z2e,COMPLETED:q2e,IN_PROGRESS:W2e};function bme({tournamentRecord:t,status:e}){return t?e&&!Object.keys(i6).includes(e)?{error:Ee,info:"Unknown status"}:(t.tournamentStatus=e,{...le}):{error:ot}}function Ime(t){let e=zt(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:n,organisationId:r,participantId:a,personId:s,courtId:o,venueId:l}=t;if(r){if(i.parentOrganisation?.parentOrganisationId!==r)return ce({result:{error:Ya}});gS({element:i.parentOrganisation,onlineResource:n})}else if(a||s){let u=(i.participants??[]).find(c=>s&&c.person?.personId===s||c.participantId===a);if(!u)return ce(s?{result:{error:Ya}}:{result:{error:Nr}});if(s){if(u.person?.personId!==s)return ce({result:{error:Yw}});gS({element:u.person,onlineResource:n})}else gS({element:u,onlineResource:n})}else if(o){let u=(i.venues??[]).filter(c=>!l||c.venueId===l).flatMap(c=>(c.courts??[]).filter(d=>d.courtId===o))?.[0];if(!u)return ce({result:{error:YU}});gS({element:u,onlineResource:n})}else if(l){let u=(i.venues??[]).find(c=>c.venueId===l);if(!u)return ce({result:{error:Zw}});gS({element:u,onlineResource:n})}else gS({element:i,onlineResource:n}),Ti({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:Db});return{...le}}function gS({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(n=>!(n?.[MT]===e[MT]&&n?.[NT]===e[NT]&&n?.[AT]===e[AT]));t.onlineResources=i}function wme(t){let e=zt(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:n,organisationId:r,participantId:a,personId:s,courtId:o,venueId:l}=t;if(r){if(i.parentOrganisation?.parentOrganisationId!==r)return ce({result:{error:Ya}});vS({element:i.parentOrganisation,onlineResource:n})}else if(a||s){let u=(i.participants??[]).find(c=>s&&c.person?.personId===s||c.participantId===a);if(!u)return ce(s?{result:{error:Ya}}:{result:{error:Nr}});if(s){if(u.person?.personId!==s)return ce({result:{error:Yw}});vS({element:u.person,onlineResource:n})}else vS({element:u,onlineResource:n})}else if(o){let u=(i.venues??[]).filter(c=>!l||c.venueId===l).flatMap(c=>(c.courts??[]).filter(d=>d.courtId===o))?.[0];if(!u)return ce({result:{error:YU}});vS({element:u,onlineResource:n})}else if(l){let u=(i.venues??[]).find(c=>c.venueId===l);if(!u)return ce({result:{error:Zw}});vS({element:u,onlineResource:n})}else vS({element:i,onlineResource:n}),Ti({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:Db});return{...le}}function vS({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(n=>n?.[MT]!==e[MT]&&n?.[NT]!==e[NT]&&n?.[AT]!==e[AT]);return i.push(e),t.onlineResources=i,{...le}}function Sme({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:n}){if(!t)return{error:ot};let r=t.tournamentId,a={tournamentId:r};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),n&&n!==t.formalName&&(t.formalName=n,a.formalName=n),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&Ti({topic:Db,payload:{parentOrganisation:t.parentOrganisation,tournamentId:r,...a}}),{...le}}function Tme({tournamentRecord:t,notes:e}){if(!t)return{error:ot};let i=e?VL({element:t,notes:e}):KW({element:t});return i.error?i:(Ti({topic:Db,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...le})}function Ume({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,Ti({topic:Db,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...le}):{error:ot}}function Y2e({tournamentRecord:t}){if(!t)return{error:ot};let{startDate:e,endDate:i}=t,n=RT(e,i),r=[];for(let a of t.venues||[])a?.courts?.length&&r.push(...a.courts);for(let a of r){let{startTime:s,endTime:o}=(a.dateAvailability??[]).reduce((c,d)=>{let p=rn(c.startTime),h=rn(c.endTime);return d.startTime&&rn(d.startTime)<p&&(c.startTime=d.startTime),d.endTime&&rn(d.endTime)>h&&(c.endTime=d.endTime),c},{startTime:"08:00",endTime:"18:00"}),l=n.map(c=>a.dateAvailability?.find(d=>d.date===c)??{date:c,startTime:s,endTime:o}),u=a.dateAvailability?.find(c=>!c.date);u&&l.unshift(u),a.dateAvailability=l}return{...le}}function VF(t){let{tournamentRecord:e,startDate:i,endDate:n,weekdays:r}=t,a=t.activeDates?.filter(Boolean),s=zt(t,[{tournamentRecord:!0},{[gs]:h=>Op.test(h),[pu]:ja,startDate:!1,endDate:!1},{[gs]:h=>h.filter(Boolean).every(f=>Op.test(f)),[pu]:ja,activeDates:!1},{[gs]:lhe,weekdays:!1}]);if(s.error)return s;if(n&&i&&new Date(n)<new Date(i))return{error:Ee};if(n&&i&&new Date(i)>new Date(n))return{error:Ee};if(a?.length){let h=i||e.startDate,f=n||e.endDate,m=!h||a.every(v=>new Date(v)>=new Date(h)),g=!f||a.every(v=>new Date(v)<=new Date(f));if(!m||!g)return{error:ja}}let o;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||n&&e.endDate&&new Date(n)<new Date(e.endDate))&&(o=!0);let l=RT(e.startDate,e.endDate);i&&(e.startDate=i),n&&(e.endDate=n);let u=RT(e.startDate,e.endDate),c=l.filter(h=>!u.includes(h)),d=u.filter(h=>!l.includes(h));for(let h of e.events??[])i&&h.startDate&&new Date(h.startDate)<new Date(i)&&(h.startDate=i),n&&h.startDate&&new Date(h.startDate)>new Date(n)&&(h.startDate=i??n),n&&h.endDate&&new Date(h.endDate)>new Date(n)&&(h.endDate=n),i&&h.endDate&&new Date(h.endDate)<new Date(i)&&(h.endDate=n??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),n&&e.startDate&&new Date(n)<new Date(e.startDate)&&(e.startDate=n),a&&(e.activeDates=a),r&&(e.weekdays=r);let p=o&&K2e({tournamentRecord:e})?.unscheduledMatchUpIds;return Y2e({tournamentRecord:e}),Ti({payload:Vt({parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,activeDates:a,startDate:i,weekdays:r,endDate:n}),topic:Db}),{...le,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:c}}function Dme({tournamentRecord:t,startDate:e}){return e?VF({tournamentRecord:t,startDate:e}):{error:ja}}function Eme({tournamentRecord:t,endDate:e}){return e?VF({tournamentRecord:t,endDate:e}):{error:ja}}function K2e({tournamentRecord:t}){let e=Za({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),n=t.endDate&&new Date(t.endDate),r=[],a=[];for(let s of e){let{schedule:o,matchUpId:l}=s;if(o&&o.scheduledDate){let u=new Date(o.scheduledDate);(i&&u<i||n&&u>n)&&(a.push(l),r.includes(o.scheduledDate)||r.push(o.scheduledDate))}}return r.length&&!kF({scheduledDates:r,tournamentRecord:t}).clearedScheduleCount?{error:cse}:{unscheduledMatchUpIds:a}}var n6={};Fi(n6,{addCourt:()=>FF,addCourts:()=>H5,addVenue:()=>gR,deleteCourt:()=>xme,deleteVenue:()=>o6,deleteVenues:()=>Mme,disableCourts:()=>Nme,disableVenues:()=>Ame,enableCourts:()=>_me,enableVenues:()=>kme,generate:()=>Pme,generateCourts:()=>y5,getCompetitionVenues:()=>BR,getCourts:()=>e5,getVenuesAndCourts:()=>Wm,modifyCourt:()=>l6,modifyCourtAvailability:()=>a6,modifyVenue:()=>Ome,mutate:()=>Cme,publicFindVenue:()=>fW,query:()=>Gpe});var Pme={};Fi(Pme,{generateCourts:()=>y5});var Cme={};Fi(Cme,{addCourt:()=>FF,addCourts:()=>H5,addVenue:()=>gR,deleteCourt:()=>xme,deleteVenue:()=>o6,deleteVenues:()=>Mme,disableCourts:()=>Nme,disableVenues:()=>Ame,enableCourts:()=>_me,enableVenues:()=>kme,modifyCourt:()=>l6,modifyCourtAvailability:()=>a6,modifyVenue:()=>Ome});function r6(t){if(!t?.tournamentRecord&&!Array.isArray(t?.venueMatchUps))return{error:ot};if(!t?.courtId)return{error:Ww};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n,venueMatchUps:r,courtId:a}=t,{schedulingProfile:s}=Ym({tournamentRecord:i});if(Array.isArray(r))return{matchUps:l({matchUps:r,courtId:a})};let{matchUps:o}=Za({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n});return{matchUps:l({matchUps:o,courtId:a})};function l({matchUps:u,courtId:c}){let d=u.filter(p=>{let h=p.schedule?.allocatedCourts?.map(({courtId:f})=>f);return p.schedule?.courtId===c||h?.includes(c)});return Nk({matchUps:d,schedulingProfile:s})}}function Z2e({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:n}){if(!e)return{error:ot};if(!n)return{error:bv};let{schedulingProfile:r}=Ym({tournamentRecord:e}),{matchUps:a}=Za({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:s({matchUps:a,venueId:n})};function s({matchUps:o,venueId:l}){let u=o.filter(c=>{let d=c.schedule?.allocatedCourts?.map(({venueId:p})=>p);return c.schedule?.venueId===l||d?.includes(l)});return Nk({matchUps:u,schedulingProfile:r})}}function a6({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:n,courtId:r,force:a}){if(!t)return{error:ot};if(!r)return{error:Ww};let s=mfe({dateAvailability:e});if(s.error)return s;let{updatedDateAvailability:o,totalMergeCount:l}=X2e(e);e=o;let u=c0({tournamentRecord:t,courtId:r});if(u.error)return u;let{court:c,venue:d}=u,{matchUps:p}=r6({tournamentRecord:t,venueMatchUps:n,courtId:r});if(p?.length){let h=sn({tournamentRecord:t})?.appliedPolicies,f=a??h?.[wv]?.allowDeletionWithScoresPresent?.courts,m=[];m.length&&(f||console.log("throw error: scheduled court matchUps",m.length))}return c&&(c.dateAvailability=e,!i&&d&&Ti({payload:{venue:d,tournamentId:t.tournamentId},topic:Eb,key:d.venueId})),{...le,totalMergeCount:l}}function X2e(t){let e=0,i=t.reduce((r,a)=>{let{date:s,startTime:o,endTime:l,bookings:u}=a;return r[s]||(r[s]=[]),r[s].push({startTime:o,endTime:l,bookings:u}),r},{}),n=[];return Object.keys(i).forEach(r=>{i[r].sort(m2e);let{mergedAvailability:a,mergeCount:s}=J2e(i[r]);n.push(...a.map(o=>({date:r,...o}))),e+=s}),{updatedDateAvailability:n,totalMergeCount:e}}function J2e(t){let e,i,n,r=t.length,a=0,s=[];for(;t.length&&r;){let l=t.shift(),{startTime:u,endTime:c,bookings:d}=l;if(r-=1,!e)e=u,n=d,i=c;else if(W1(zr(i),zr(u),!1)>0){let p={startTime:e,endTime:i};n?.length&&(p.bookings=n),s.push(p),e=u,n=d,i=c}else d&&(n?n.push(d):n=d),i=c,a+=1}let o={startTime:e,endTime:i};return n?.length&&(o.bookings=n),s.push(o),{mergedAvailability:s,mergeCount:a}}function s6({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:moe,info:e}}function Rme({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:n}){let r="removeCourtAssignment";if(!i)return{error:eo};if(!e&&!n)return{error:Zd};let a;if(!e){if(!t)return{error:ot};({drawDefinition:e}=$o({tournamentRecord:t,drawId:n}))}if(e)({matchUp:a}=Qn({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:ot};let s=Za({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=Zce({matchUps:s,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(s=>[Xg,Qh].includes(s.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:s})=>![Xg,Qh].includes(s)),Zi({tournamentId:t?.tournamentId,context:r,drawDefinition:e,matchUp:a})),{...le}):{error:Vs}}function o6(t){if(typeof t?.venueId!="string")return{error:bv};let{tournamentRecord:e,venueId:i,force:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(r).length)return{error:ot};let a=jd({tournamentRecords:r,contextFilters:{venueIds:[i]}}).matchUps??[],s=sn({tournamentRecord:e})?.appliedPolicies,o=n??s?.[wv]?.allowDeletionWithScoresPresent?.venues;if(!a.length||o)for(let l of Object.values(r)){for(let c of a){let d=Rme({matchUpId:c.matchUpId,drawId:c.drawId,tournamentRecord:l});if(d.error)return d}let u;l.venues=(l.venues??[]).filter(c=>c?.venueId!==i?!0:(u=!0,!1)),u&&Ti({payload:{venueId:i,tournamentId:l.tournamentId},topic:q3,key:i})}else return s6({matchUpsCount:a.length});return jR({tournamentRecords:r}),{...le}}function Mme({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:ot};if(!Array.isArray(e))return{error:Ee};for(let n of t.venues||[]){let{venueId:r}=n;if(e.includes(r)){let{venueId:a}=n,s=o6({tournamentRecord:t,venueId:a,force:i});if(s.error)return s}}return{...le}}function Nme(t){let{courtIds:e,dates:i}=t,n=ic(t),r=[{[js]:!0,[uL]:!0}],a=zt(t,r);if(a.error)return a;for(let s of Object.values(n))Q2e({tournamentRecord:s,courtIds:e,dates:i});return{...le}}function Q2e({tournamentRecord:t,courtIds:e,dates:i}){let n=Array.isArray(i)&&i.length?{dates:i}:!0,r=a=>un({extension:{value:n,name:kd},creationTime:!1,element:a});for(let a of t.venues||[])for(let s of a.courts||[])if(e?.includes(s.courtId)){let o=r(s);if(o.error)return o}return{...le}}function Ame(t){let{tournamentRecords:e,tournamentId:i,venueIds:n}=t,r=[{[js]:!0,[cL]:!0}],a=zt(t,r);if(a.error)return a;let s=Object.keys(e).filter(o=>!i||o===i);for(let o of s){let l=e[o];eVe({tournamentRecord:l,venueIds:n})}return{...le}}function eVe({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e?.includes(i.venueId)){let n=un({creationTime:!1,element:i,extension:{name:kd,value:!0}});if(n.error)return n}return{...le}}function _me(t){let e=ic(t),i=[{[js]:!0}];!t.enableAll&&i.push({[uL]:!0});let n=zt(t,i);if(n.error)return n;let{enableAll:r,courtIds:a,dates:s}=t;for(let o of Object.values(e))tVe({tournamentRecord:o,courtIds:a,enableAll:r,dates:s});return{...le}}function tVe({tournamentRecord:t,courtIds:e,enableAll:i,dates:n}){for(let r of t.venues||[])for(let a of r.courts||[])if(i||e?.includes(a.courtId))if(Array.isArray(n)){let{extension:s}=_i({element:a,name:kd});if(s){let o=s.value;Array.isArray(o.dates)&&(o.dates=o.dates.filter(l=>!n.includes(l))),un({extension:{name:kd,value:o},creationTime:!1,element:a})}}else lo({element:a,name:kd});return{...le}}function kme(t){let e=ic(t),i=[{[js]:!0}];!t.enableAll&&i.push({[cL]:!0});let n=zt(t,i);if(n.error)return n;let{venueIds:r,enableAll:a}=t;for(let s of Object.values(e))for(let o of s.venues||[])(a||r?.includes(o.venueId))&&lo({element:o,name:kd});return{...le}}function xme(t){let{courtId:e,disableNotice:i,force:n}=t,r=ic(t),a=zt(t,[{[js]:!0,[Nle]:!0}]);if(a.error)return a;let s,o;for(let l of Object.values(r)){if(o=iVe({tournamentRecord:l,disableNotice:i,courtId:e,force:n}),o.error&&o.error!==YU)return o;o.success&&(s=!0)}return s?{...le}:o}function iVe({tournamentRecord:t,disableNotice:e,courtId:i,force:n}){let r=c0({tournamentRecord:t,courtId:i});if(r.error)return r;let a=r.venue,{matchUps:s}=r6({tournamentRecord:t,courtId:i}),o=sn({tournamentRecord:t})?.appliedPolicies,l=n??o?.[wv]?.allowDeletionWithScoresPresent?.courts;if(!s?.length||l){for(let u of s??[]){let c=Rme({matchUpId:u.matchUpId,drawId:u.drawId,tournamentRecord:t});if(c.error)return c}a&&(a.courts=(a.courts??[]).filter(u=>u.courtId!==i),e||Ti({payload:{venue:a,tournamentId:t.tournamentId},topic:Eb,key:a.venueId}))}else return s6({matchUpsCount:s.length});return{...le}}function l6(t){let{disableNotice:e,modifications:i,courtId:n,force:r,venueMatchUps:a}=t,s=ic(t);if(!Object.keys(s).length)return{error:fr};let o,l;for(let u of Object.values(s)){let c=nVe({tournamentRecord:u,disableNotice:e,venueMatchUps:a,modifications:i,courtId:n,force:r});if(c?.error)return c;o=!0}return o?{...le}:l}function nVe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:n,courtId:r,force:a}){if(!t)return{error:ot};if(!r)return{error:Ww};if(!n||typeof n!="object")return{error:jm};let s=c0({tournamentRecord:t,courtId:r});if(s.error)return s;let{venue:o,court:l}=s,u=Object.keys(f2e()).filter(p=>p!=="courtId");if(!Object.keys(n).filter(p=>u.includes(p)).length)return{error:qO};let c=u.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(n).filter(p=>c.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:n[p]})),n.dateAvailability){let p=a6({dateAvailability:n.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:r,force:a});if(p.error)return p}return e||Ti({payload:{venue:o,tournamentId:t.tournamentId},topic:Eb,key:o?.venueId}),{...le,court:Ct(l)}}var rVe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),aVe=rVe;function Ome(t){let{modifications:e,venueId:i,force:n}=t,r=ic(t);if(!Object.keys(r).length)return{error:fr};if(typeof i!="string")return{error:bv};let a,s;for(let o of Object.values(r)){let l=sVe({tournamentRecord:o,modifications:e,venueId:i,force:n});if(l.success&&(s=!0),l.error&&(a=l.error),l.error&&l.error!==Zw)return l}return jR({tournamentRecords:r}),s?{...le}:{error:a}}function sVe({tournamentRecord:t,modifications:e,venueId:i,force:n}){if(!t)return{error:ot};if(!e||typeof e!="object")return{error:jm};if(!i)return{error:bv};let r=sn({tournamentRecord:t})?.appliedPolicies,a=n??r?.[wv]?.allowDeletionWithScoresPresent?.venues,{matchUps:s}=Z2e({tournamentRecord:t,venueId:i}),o=mf({tournamentRecord:t,venueId:i});if(o.error)return o;let l=o.venue,u=Object.keys(aVe()).filter(g=>g!=="venueId");if(!Object.keys(e).filter(g=>u.includes(g)).length)return{error:qO};let c=u.filter(g=>!["courts","onlineResources"].includes(g)),d=Object.keys(e).filter(g=>c.includes(g));l&&d.forEach(g=>Object.assign(l,{[g]:e[g]}));let p=l?.courts?.map(g=>g.courtId)??[],h=e.courts?.map(g=>g.courtId)||[],f=h.length?p.filter(g=>!h.includes(g)):e?.courts&&p,m=[];if(f?.length){let g=l?.courts?.filter(v=>f.includes(v.courtId))?.map(v=>{let y=r6({courtId:v.courtId,tournamentRecord:t,venueMatchUps:s});for(let b of y.matchUps??[])m.push({matchUpId:b.matchUpId,drawId:b.drawId});return y.matchUps?.length??0}).reduce((v,y)=>v+y);if(l&&(!g||a))l.courts=l.courts?.filter(v=>h.includes(v.courtId)),PC({schedule:{courtId:"",scheduledDate:""},matchUpDetails:m,removePriorValues:!0,tournamentRecord:t});else return s6({matchUpsCount:g})}if(e.courts)for(let g of e.courts){let{courtId:v}=g||{},y=l6({modifications:g,disableNotice:!0,tournamentRecord:t,venueMatchUps:s,courtId:v,force:n});if(y.error===YU&&(y=FF({disableNotice:!0,tournamentRecord:t,venueId:i,court:g})),y.error)return y}return jR({tournamentRecord:t}),l&&Ti({payload:{venue:l,tournamentId:t.tournamentId},topic:Eb,key:l?.venueId}),{...le,venue:Ct(l)}}var Mi={};Fi(Mi,{JSON2CSV:()=>hVe,UUID:()=>mn,UUIDS:()=>Ooe,allNumeric:()=>ise,attributeFilter:()=>uw,chunkArray:()=>Aa,chunkByNth:()=>sG,chunkSizeProfile:()=>tse,constantToString:()=>Is,countValues:()=>XNe,createMap:()=>rse,dateTime:()=>koe,definedAttributes:()=>Vt,dehydrateMatchUps:()=>uVe,extractAttributes:()=>xue,flattenJSON:()=>u6,generateDateRange:()=>RT,generateHashCode:()=>aAe,generateRange:()=>Dt,generateTimeCode:()=>wfe,groupValues:()=>Qae,hasAttributeValues:()=>rAe,instanceCount:()=>Rl,intersection:()=>Dr,isConvertableInteger:()=>yi,isNumeric:()=>br,isOdd:()=>Xae,isPowerOf2:()=>$d,makeDeepCopy:()=>Ct,matchUpScheduleSort:()=>lVe,matchUpSort:()=>d0,nearestPowerOf2:()=>Cq,nextPowerOf2:()=>jU,noNulls:()=>ZNe,noNumeric:()=>nse,numericSort:()=>ia,occurrences:()=>QNe,overlap:()=>mo,randomMember:()=>yl,randomPop:()=>Il,shuffleArray:()=>oo,structureSort:()=>n0,subSort:()=>eAe,undefinedToNull:()=>oG,unique:()=>wi,visualizeScheduledMatchUps:()=>oVe});function oVe({scheduledMatchUps:t,showGlobalLog:e}){cxe();let i=t?.reduce((r,{structureId:a})=>r.includes(a)?r:r.concat(a),[]),n=Array.isArray(i)&&{...i.map(r=>{let{structureName:a,matchUpType:s}=t.find(o=>o.structureId===r);return{[r]:`${a} ${s}`}})};i?.forEach(r=>{Dl({color:"blue",method:"draw",structure:n[r],keyColors:{structure:"magenta"}},!0);let a=t.filter(o=>o.structureId===r),s=go({matchUps:a})?.roundMatchUps||[];Object.keys(s).forEach(o=>{Dl({roundNumber:o,keyColors:{roundNumber:"brightcyan"}},!0),s[o].forEach(({matchUpId:l,schedule:u})=>{let c=Jn(u.scheduledTime);Dl({matchUpId:l,time:c,date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&uxe()}var{extractTime:uJ,timeStringMinutes:cJ}=koe;function lVe(t,e){let i=t.schedule??{},n=e.schedule??{};if(i.scheduledDate&&!n.scheduledDate)return 1;if(n.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&n.scheduledDate){if(i.scheduledDate===n.scheduledDate){if(i.scheduledTime&&!n.scheduledTime)return 1;if(n.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&n.scheduledTime){let r=cJ(uJ(i.scheduledTime)),a=cJ(uJ(n.scheduledTime));return r-a}}return new Date(i.scheduledDate).getTime()-new Date(n.scheduledDate).getTime()}return 0}function uVe({tournamentRecord:t}){if(!t)return{error:ot};if(typeof t!="object"||!t.tournamentId)return{error:Ee};let{matchUps:e}=Za({tournamentRecord:t,inContext:!1});if(e?.length){let i=cVe({tournamentRecord:t});pVe(e,i)}return{...le}}function cVe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let n of i.drawDefinitions||[]){n.matchUpFormat&&(e[n.drawId]=n.matchUpFormat);for(let r of n.structures||[]){r.matchUpFormat&&(e[r.structureId]=r.matchUpFormat);for(let a of r.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var dVe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function pVe(t,e={}){for(let i of t){let{structureId:n,drawId:r,eventId:a}=i,s=e[n]||e[r]||e[a],o=i.matchUpFormat===s?void 0:i.matchUpFormat;for(let l of Object.keys(i))dVe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}function hVe(t,e){if(e&&typeof e!="object")return{error:Ee};let{columnTransform:i={}}=e||{},{includeTransformAccessors:n,includeHeaderRow:r=!0,returnTransformedJSON:a,removeEmptyColumns:s,onlyHeaderRow:o,columnAccessors:l=[],functionMap:u={},columnMap:c={},valuesMap:d={},context:p={},delimiter:h='"',columnJoiner:f=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof c!="object"||typeof i!="object"||typeof u!="object"||typeof d!="object"||typeof f!="string"||typeof m!="string"||typeof g!="string"||typeof h!="string")return{error:Ee};i=Object.assign({},...Object.keys(i).reverse().map(N=>({[N]:Array.isArray(i[N])?i[N]:[typeof i[N]=="string"&&i[N]].filter(Boolean)})));let v=t.filter(Boolean).map(N=>u6(N,g)),y=Object.values(i).flat();n&&l.push(...y);let b=v.reduce((N,A)=>Object.keys(A).every(_=>!N.includes(_)&&N.push(_)||!0)&&N,[]).filter(N=>!l?.length||l.includes(N)),I=Object.assign({},...Object.keys(i).reverse().map(N=>i[N].map(A=>({[A]:N})).flat()).flat()),S=(N,A)=>e?.sortOrder?e.sortOrder.includes(N)&&e.sortOrder.includes(A)&&e.sortOrder.indexOf(N)-e.sortOrder.indexOf(A)||!e.sortOrder.includes(A)&&-1:0,w=b.reduce((N,A)=>{let _=I[A];return _?N.includes(_)||N.push(_):N.push(A),N},[]).sort(S);Object.keys(c).forEach(N=>!w.includes(N)&&w.unshift(N)),Object.keys(i).forEach(N=>!w.includes(N)&&w.unshift(N)),typeof p=="object"&&Object.keys(p).forEach(N=>!w.includes(N)&&w.unshift(N));let T=w.map(N=>c[N]||N);if(o)return[T];let U=N=>`${h}${N}${h}`,C=[],E=N=>Object.values(w.reduce((A,_,x)=>{let O=i[_],$=(O?.length?N[O.find(H=>N[H])]:N[_])||p?.[_]||"",F=d[_]?.[$]||$,j=Ao(u[_])?u[_](F):F;return A[_]=U(j),j&&(C[x]=(C[x]||0)+1),A},{})),P=v.map(E),M=s&&[...C].map((N,A)=>!N&&A).filter(br).reverse();if(M){let N=A=>A.filter((_,x)=>!M.includes(x));P=P.map(N),T=N(T)}let R=P.map(N=>N.join(f));return a?R.map(N=>{let A=N.split(f);return Object.assign({},...A.map((_,x)=>({[T[x]]:_})))}):r?[T.map(U).join(f),...R].join(m):R.join(m)}function u6(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((n,r)=>typeof t[r]!="object"?(n[i.concat(r).join(e)]=t[r],n):Object.assign(n,u6(t[r],e,i.concat(r))),{})}var fVe={},{FACTORY:dJ}=Ey;function mVe({tournamentRecord:t,value:e}){let{extension:i}=_i({element:t,name:dJ}),n={name:dJ,value:{...i?.value,...e}};un({element:t,extension:n})}function jF({timeStamp:t}){let e=Iv(),i=n3();return i&&Object.values(e).forEach(n=>{mVe({tournamentRecord:n,value:{version:VU(),timeStamp:t}})}),i}function Lme({engineType:t,methodName:e,elapsed:i,params:n,result:r}){let a=du();if(typeof a!="object")return;let s={method:e},o=r?.error&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&a.params?.includes(e),u=a.params&&!Array.isArray(a.params)||l,c=Array.isArray(a.exclude)&&a.exclude.includes(e);!c&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(s.elapsed=i),!c&&(o||u)&&(s.params=n),!c&&(o||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&a.result?.includes(e))&&(s.result=r),Object.keys(s).length>1&&Eoe(s,t)}function JR({methodName:t,params:e,start:i}){let n={error:H1,methodName:t},r=i?Date.now()-i:0;return Lme({result:n,methodName:t,elapsed:r,params:e,engineType:"sync"}),n}function gVe(t,e){if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:ot};let i=e.drawId||e.matchUp?.drawId;if(i){let{event:a,drawDefinition:s,tournamentId:o}=$o({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),o&&(e.tournamentId=o),a&&(e.event=a)}if(e.eventId&&!e.event){let{event:a,tournamentId:s}=$o({eventId:e.eventId,tournamentRecords:t});if(!a)return{error:Wu};e.tournamentId=s,e.event=a}let n=e.tournamentId??Jw();if(!n&&e)return e;let r=t[n];return n&&!r?{error:ot}:(r&&(e.tournamentRecord=r),e)}function QR(t,e,i,n,r){delete t.success,delete t.error;let a=Date.now(),s=Jw();i&&(i.activeTournamentId=s);let o=i?.tournamentRecord||o3(s),l=typeof i?.tournamentRecord=="object"&&{[i?.tournamentRecord.tournamentId]:i.tournamentRecord}||Iv(),u=i?Ct(i,void 0,!0):void 0,c=i?gVe(l,i):void 0;if(c?.error)return c;let d=vVe({params:c,tournamentRecords:l,tournamentRecord:o,methodName:n,method:e}),p=Date.now()-a;return Lme({result:d,methodName:n,elapsed:p,params:u,engineType:r}),d}function vVe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:n,method:r}){if(du())return r({tournamentRecords:t,tournamentRecord:e,...i});try{return r({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return XO({engineName:"engine",methodName:n,params:i,err:a})}}function GF(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:a}=bu();for(let s of[...a].sort($me)){let o=a3({topic:s});o?.length&&tC({topic:s,notices:o})}e&&r&&a.includes(fC)&&tC({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:fC})}async function Fme(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:a}=bu();for(let s of[...a].sort($me)){let o=a3({topic:s});o&&await tC({topic:s,notices:o})}e&&r&&a.includes(fC)&&tC({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:fC})}var pJ={[eW]:5,[Q3]:5,[tW]:5,[J3]:5,[X3]:5,[K3]:5,[Zle]:5,[Xle]:5,[Z3]:1,[yL]:1,[Us]:5,[Eb]:5,[Y3]:4,[z3]:4,[q3]:4,[W3]:4,[vL]:3,[j3]:2};function $me(t,e){return(pJ[e]||0)-(pJ[t]||0)}function yVe({convertExtensions:t,removeExtensions:e}){let i=Iv();return{tournamentId:Jw(),tournamentRecords:Ct(i,t,!1,e)}}function bVe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},n=t?.tournamentId??Jw();if(typeof n!="string")return{};let r=o3(n);return{tournamentRecord:Ct(r,e,!1,i)}}function IVe(){let t=Iv(),{extension:e}=_i({name:Yy,tournamentRecords:t,discover:!0}),i=e?.value?.tournamentIds||[];return Object.keys(t).forEach(n=>{i.includes(n)||delete t[n]}),ZO(t)}function hJ(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:jm}:t?.tournamentId?Uoe(e?Ct(t):t):{error:Ee}}function gw(t,e=!0){if(typeof t!="object")return{error:jm};if(iC(),Array.isArray(t)){if(t.filter(i=>i?.tournamentId).length!==t.length)return{error:cG};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t?.tournamentId)t={[t.tournamentId]:t},iC(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:cG};return ZO(e?Ct(t):t)}async function wVe(t,e,i){if(!Array.isArray(e))return{error:Ee,message:"directives must be an array"};let n=r3(),r=Date.now(),a=i&&Ct(Iv(),!1,!0),s=[];for(let u of e){if(typeof u!="object")return{error:Ee,message:"directive must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!n[c])return JR({methodName:c,start:r,params:p});if(d){let f=s[s.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=QR(t,n[c],p,c,"async");if(h?.error)return a&&gw(a),{...h,rolledBack:!!a};s.push({...h,methodName:c})}let o=Date.now(),l=jF({timeStamp:o});return await Fme({directives:e,mutationStatus:l,timeStamp:o}),Xw(),{success:s.every(u=>u.success),results:s}}async function fJ(t,e){if(!Ki(e))return{error:Ee,message:"args must be an object"};let i=Object.values(e).filter(Ao).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Ee};let n=i?Object.keys(e).find(h=>Ao(e[h])):Xn(e.method)&&e.method;if(!n)return{error:H1};let{[n]:r,...a}=e,s=e?.params?{...e.params}:{...a},o=s.rollbackOnError&&Ct(Iv(),!1,!0),l=r||t[n]||YO()[n];if(!l)return JR({methodName:n,params:s});let u=await QR(t,l,s,n,"async")??{};u?.error&&o&&gw(o);let c=Date.now(),d=jF({timeStamp:c}),p=u?.success&&s?.delayNotify!==!0&&s?.doNotNotify!==!0;return p&&await Fme({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:c}),(p||!u?.success||s?.doNotNotify)&&Xw(),u}function SVe(t,e,i,n,r,a){let s=Poe(i,n,r,a);if(s.error)return s;let o=s.methods??[];return Object.keys(o).filter(l=>Ao(o[l])).forEach(l=>{t[l]=u=>{let c=()=>e(t,{[l]:o[l],...u});if(du())return c();try{return c()}catch(d){XO({engineName:"engine",methodName:l,params:u,err:d})}}}),{...le,...t}}function yS(t,e){return e?.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function c6(t,e){t.importMethods=(i,n,r,a)=>SVe(t,e,i,n,r,a),t.getTournament=i=>bVe(i),t.getState=i=>yVe({convertExtensions:i?.convertExtensions,removeExtensions:i?.removeExtensions}),t.version=()=>VU(),t.reset=()=>(ZO({}),yS(t)),t.devContext=i=>(QP(i),yS(t)),t.getDevContext=i=>du(i),t.newTournamentRecord=(i={})=>{let n=OF(i),r=n.tournamentId;return n.error?n:(hJ(n),iC(r),{...le,tournamentId:r})},t.setState=(i,n,r)=>{eC(n,r);let a=gw(i,n);return yS(t,a)},t.setTournamentId=i=>iC(i),t.getTournamentId=()=>Jw(),t.setTournamentRecord=(i,n,r)=>{eC(n,r);let a=hJ(i,n);return yS(t,a)},t.removeTournamentRecord=i=>{let n=Doe(i);return yS(t,n)},t.removeUnlinkedTournamentRecords=()=>{let i=IVe();return yS(t,i)}}function TVe(t){let e=boe();if(e.error&&!t)return e;let i={executionQueue:(n,r)=>wVe(i,n,r),execute:n=>fJ(i,n)};return c6(i,fJ),i}function UVe(t,e,i){if(!Array.isArray(e))return{error:Ee,message:"directives must be an array"};let n=r3(),r=Date.now(),a=i&&Ct(Iv(),!1,!0),s=[];for(let u of e){if(typeof u!="object")return{error:Ee,message:"directive must be an object"};if(u.params&&typeof u.params!="object")return{error:Ee,message:"params must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!n[c])return JR({methodName:c,start:r,params:p});if(d){let f=s[s.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=QR(t,n[c],p,c,"sync");if(h?.error)return a&&gw(a),{...h,rolledBack:!!a};s.push({...h,methodName:c})}let o=Date.now(),l=jF({timeStamp:o});return GF({directives:e,mutationStatus:l,timeStamp:o}),Xw(),{success:s.every(u=>u.success),results:s}}function mJ(t,e){if(!Ki(e))return{error:Ee,message:"args must be an object"};let i=Object.values(e).filter(Ao).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Ee};let n=i?Object.keys(e).find(h=>Ao(e[h])):Xn(e.method)&&e.method;if(!n)return{error:H1};let{[n]:r,...a}=e,s=e?.params?{...e.params}:{...a},o=s.rollbackOnError&&Ct(Iv(),!1,!0),l=r||t[n]||YO()[n];if(!l)return JR({methodName:n,params:s});let u=QR(t,l,s,n,"sync")??{};u?.error&&o&&gw(o);let c=Date.now(),d=jF({timeStamp:c}),p=u?.success&&s?.delayNotify!==!0&&s?.doNotNotify!==!0;return p&&GF({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:c}),(p||!u?.success||s?.doNotNotify)&&Xw(),u}var Bme=(()=>{let t={executionQueue:(e,i)=>UVe(t,e,i),execute:e=>mJ(t,e)};return c6(t,mJ),t})(),eM=Bme;function gJ(t,e){if(!Ki(e))return{error:Ee,message:"args must be an object"};let i=Object.values(e).filter(Ao).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Ee};let n=i?Object.keys(e).find(l=>Ao(e[l])):Xn(e.method)&&e.method;if(!n)return{error:H1};let{[n]:r,...a}=e,s=e?.params?{...e.params}:{...a},o=r||t[n]||YO()[n];return o?QR(t,o,s,n,"ask"):JR({methodName:n,params:s})}var DVe=(()=>{let t={execute:e=>gJ(t,e)};return c6(t,gJ),t})(),BI={},Mg;function Vme(t,e=!0){if(!t)return{error:Zt};if(typeof t!="object")return{error:jm};if(t.matchUpId)Mg=t.matchUpId,BI[Mg]=e?Ct(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(BI[i.matchUpId]=e?Ct(i):i,Mg||(Mg=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(BI[i.matchUpId]=e?Ct(i):i,Mg||(Mg=i.matchUpId));return e?Ct(t):t}function EVe(){return BI[Mg]}function PVe(){return Object.values(BI)}function CVe(){Mg=void 0,BI={}}function RVe(t){return Ct(BI[Mg],t?.convertExtensions,!1,t?.removeExtensions)}var MVe=(()=>{let t={getState:i=>RVe(i),version:()=>VU(),reset:()=>(CVe(),{...le}),drawId:void 0,error:void 0,success:!1,devContext:i=>(QP(i),t),setState:(i,n,r)=>{eC(n,r);let a=Vme(i);return e(a)}};function e(i){return i?.error?(t.error=i.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=i.drawId),t}return NVe(t,[Cy]),t})();function NVe(t,e){e.forEach(i=>{Object.keys(i).forEach(n=>{t[n]=r=>{if(du())return vJ(t,{params:r,governor:i,methodName:n});try{return vJ(t,{params:r,governor:i,methodName:n})}catch(a){XO({engineName:"matchUpEngine",methodName:n,params:r,err:a})}}})})}function vJ(t,{params:e,governor:i,methodName:n}){t.error=void 0,t.success=!1;let r=e?.matchUp||EVe(),a=e?.matchUps||PVe(),s=e?.rollbackOnError&&Ct(r,!1,!0);e={...e,matchUpId:r?.matchUpId,matchUps:a,matchUp:r};let o=i[n](e);if(o?.error)return s&&Vme(s),{...o,rolledBack:!!s};let l=o?.success&&e?.delayNotify!==!0&&e?.doNotNotify!==!0;return l&&GF(),(l||!o?.success||e?.doNotNotify)&&Xw(),o}var hV=!1,tM=(()=>{let t={version:()=>VU(),setDeepCopy:(n,r)=>(eC(n,r),t),devContext:n=>(QP(n),hV=!0,t)};return i([AF]),t;function e(n,r){let a=n({...r});return a?.error||GF(),Xw(),hV&&(QP(!1),hV=!1),a}function i(n){n.forEach(r=>{Object.keys(r).forEach(a=>{t[a]=s=>{if(du()){let o=e(r[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&gw(o.tournamentRecord),o}else try{let o=e(r[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&gw(o.tournamentRecord),o}catch(o){let l;typeof o=="string"?l=o.toUpperCase():o instanceof Error&&(l=o.message),console.log("ERROR",{params:JSON.stringify(s),method:a,error:l})}}})})}})();eM.importMethods(kO,!0,1);var wm=eM,nt=eM,AVe={getTournamentPoints:sF},_Ve=AVe,kVe={calculateNewRatings:Rde,generateDynamicRatings:Mde},xVe=kVe,OVe={..._Ve,...xVe};eM.importMethods(OVe);var LVe=eM,FVe={[dC]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},$Ve={[Xh]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[LI,mP]}},BVe={[Xh]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[LI,IC,fw],disabledActions:[]}]}},VVe={[Xh]:{policyName:"positionActionsDisabled",enabledStructures:!1}},jVe={[tD]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},GVe={[Ku]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:jc,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[Nt]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[al]:[],[nh]:[],[On]:[],[_l]:[],[_a]:[],[ir]:[]}}},fV="Personal circumstance",HVe={[Ku]:{requireAllPositionsAssigned:!1,stage:{[Nt]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:jc,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:jc,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[al]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[nh]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[_l]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[On]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[ir]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:fV,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[_a]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:fV,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[Jh]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:fV,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},zVe={[Cc]:{seedingProfile:{positioning:tL},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},qVe={POLICY_AVOIDANCE_COUNTRY:FVe,POLICY_POSITION_ACTIONS_DEFAULT:dde,POLICY_POSITION_ACTIONS_DISABLED:VVe,POLICY_POSITION_ACTIONS_NO_MOVEMENT:BVe,POLICY_POSITION_ACTIONS_UNRESTRICTED:$Ve,POLICY_PRIVACY_DEFAULT:jVe,POLICY_ROUND_NAMING_DEFAULT:cW,POLICY_SCHEDULING_DEFAULT:Vpe,POLICY_SCORING_DEFAULT:GVe,POLICY_SCORING_USTA:HVe,POLICY_SEEDING_ITF:zVe,POLICY_SEEDING_DEFAULT:Tpe},Sm={ratingsParameters:Ca,matchUpFormats:y_e,countryToFlag:aue,tieFormats:the,countries:$g,policies:qVe,flagIOC:uke},Uo={};Fi(Uo,{activeMatchUpStatuses:()=>gL,auditConstants:()=>ahe,completedMatchUpStatuses:()=>Yr,directingMatchUpStatuses:()=>F3,displayConstants:()=>xpe,drawDefinitionConstants:()=>Zr,entryStatusConstants:()=>md,errorConditionConstants:()=>goe,eventConstants:()=>dl,extensionConstants:()=>Ey,flightConstants:()=>yhe,genderConstants:()=>eh,keyValueConstants:()=>y4,matchUpActionConstants:()=>o4,matchUpStatusConstants:()=>V3,matchUpTypes:()=>Kae,nonDirectingMatchUpStatuses:()=>$3,particicipantsRequiredMatchUpStatuses:()=>O3,participantConstants:()=>qs,participantRoles:()=>Pv,participantTypes:()=>pT,penaltyConstants:()=>jme,policyConstants:()=>Ub,positionActionConstants:()=>g0,ratingConstants:()=>Vce,recoveryTimeRequiredMatchUpStatuses:()=>qle,requestConstants:()=>Jhe,resourceContants:()=>xoe,resultConstants:()=>sse,scaleConstants:()=>QU,scheduleConstants:()=>Nue,sortingConstants:()=>whe,surfaceConstants:()=>Gme,tieFormatConstants:()=>yle,timeItemConstants:()=>PL,topicConstants:()=>tue,tournamentConstants:()=>i6,upcomingMatchUpStatuses:()=>B3,validMatchUpStatuses:()=>L3,venueConstants:()=>Hme,weekdayConstants:()=>u5});var WVe="Coaching",YVe="Ball Abuse",KVe="Racket Abuse",ZVe="Verbal Abuse",XVe="INELIGIBILITY",JVe="Physical Abuse",QVe="Unsportmanlike Conduct",eje="Dress Code Violation",tje="Equipment Violation",ije="Leaving the court",nje="Failure to complete",rje="No Show",aje="Other",sje="REFUSAL_TO_PLAY",oje="PROHIBITED_SUBSTANCE",lje="Puncuality",uje="Failure to sign in",jme={COACHING:WVe,BALL_ABUSE:YVe,RACKET_ABUSE:KVe,VERBAL_ABUSE:ZVe,PHYSICAL_ABUSE:JVe,INELIGIBILITY:XVe,UNSPORTSMANLIKE_CONDUCT:QVe,PROHIBITED_SUBSTANCE:oje,DRESS_CODE_VIOLATION:eje,EQUIMENT_VIOLATION:tje,LEAVING_THE_COURT:ije,REFUSAL_TO_PLAY:sje,FAILURE_TO_COMPLETE:nje,NO_SHOW:rje,OTHER:aje,PUNCTUALITY:lje,FAILUIRE_TO_SIGN_IN:uje},cje="CLAY",dje="HARD",pje="GRASS",hje="CARPET",fje="ARTIFICIAL",Gme={CLAY:cje,HARD:dje,GRASS:pje,CARPET:hje,ARTIFICIAL:fje},mje="INDOOR",gje="OUTDOOR",Hme={INDOOR:mje,OUTDOOR:gje};const QG=Object.freeze(Object.defineProperty({__proto__:null,activeMatchUpStatuses:gL,askEngine:DVe,asyncEngine:TVe,auditConstants:ahe,competitionEngine:wm,competitionGovernor:Eq,completedMatchUpStatuses:Yr,directingMatchUpStatuses:F3,displayConstants:xpe,drawDefinitionConstants:Zr,drawsGovernor:A3,entriesGovernor:r5,entryStatusConstants:md,errorConditionConstants:goe,eventConstants:dl,eventGovernor:o5,extensionConstants:Ey,factoryConstants:Uo,fixtures:Sm,flightConstants:yhe,forge:fVe,genderConstants:eh,generationGovernor:v5,globalState:cT,governors:kO,keyValueConstants:y4,matchUpActionConstants:o4,matchUpEngine:MVe,matchUpFormatCode:Im,matchUpFormatGovernor:Im,matchUpGovernor:I5,matchUpStatusConstants:V3,matchUpTypes:Kae,mocksEngine:tM,mocksGovernor:AF,nonDirectingMatchUpStatuses:$3,particicipantsRequiredMatchUpStatuses:O3,participantConstants:qs,participantGovernor:q5,participantRoles:Pv,participantTypes:pT,penaltyConstants:jme,policyConstants:Ub,policyGovernor:P4,positionActionConstants:g0,publishingGovernor:$F,queryGovernor:$R,ratingConstants:Vce,recoveryTimeRequiredMatchUpStatuses:qle,reportGovernor:Y5,requestConstants:Jhe,resourceContants:xoe,resultConstants:sse,scaleConstants:QU,scaleEngine:LVe,scheduleConstants:Nue,scheduleGovernor:K5,scoreGovernor:Cy,sortingConstants:whe,surfaceConstants:Gme,syncEngine:Bme,tieFormatConstants:yle,tieFormatGovernor:X5,timeItemConstants:PL,tools:Mi,topicConstants:tue,tournamentConstants:i6,tournamentEngine:nt,tournamentGovernor:t6,upcomingMatchUpStatuses:B3,utilities:Mi,validMatchUpStatuses:L3,venueConstants:Hme,venueGovernor:n6,version:VU,weekdayConstants:u5},Symbol.toStringTag,{value:"Module"})),{AFTER_REST:zme,FOLLOWED_BY:qme,NEXT_AVAILABLE:Wme,NOT_BEFORE:Yme,TO_BE_ANNOUNCED:Kme}=Uo.timeItemConstants,{SCHEDULE_ERROR:vje,SCHEDULE_CONFLICT:yje,SCHEDULE_WARNING:bje}=Uo.scheduleConstants,{ORGANISER_ACCEPTANCE:Ije,DIRECT_ACCEPTANCE:wje,SPECIAL_EXEMPT:Sje,JUNIOR_EXEMPT:Tje,ALTERNATE:Uje,WILDCARD:Dje}=md,Zme="All statuses",Eje="All genders",CC="All flights",yJ="All rounds",Qg="All events",Pje="No events",Xme="All teams",Jme="All Types",Cje="Any team",Qme="registration",Rje="timepicker",Mje="timevalue",vP="tmxContent",ege="tmxDrawer",RC="splash",HF="superadmin",tge="admin",d6="competitionEngine",Nje="tournamentEngine",tf="tournaments",ige="drawEntries",As="tournament",eH="structure",nge="invite",bI="event",HE="draw",tH="view",MC="tournamentEvents",TD="overview",Tm="participants",ib="schedule",p6="matchUps",wh="events",h6="venues",Aje="unscheduled",iM={success:!0},_je=10,rge="ISSUE",Ou="Automated",f6="Manual",age={[vje]:"matchup-error",[yje]:"matchup-conflict",[rge]:"matchup-issue",[bje]:"matchup-warning"},$k="tournamentParticipants",kje="scheduledDateFilter",VI="unscheduledMatchUps",zF="tournamentsCalendar",Bk="tournamentMatchUps",Vk="tournamentSchedule",iH="tournamentsTable",jk="tournamentTeams",Gk="venuesTable",sge="entriesCount",oge="eventsTable",NC="tmxOverlay",m6="teamStats",g6="drawControl",xje="drawFrame",lge="drawRight",uge="drawLeft",cge="entriesView",nf="drawsView",nM="QUALIFYING",Ud="ACCEPTED",dge="eventInfo",v6="acceptedPanel",y6="alternatesPanel",b6="qualifyingPanel",I6="ungroupedPanel",w6="withdrawaPanel",pge="unscheduledVisibility",hge="tournamentsControl",S6="participantControl",T6="unscheduledControl",U6="scheduleControl",D6="matchUpsControl",E6="venuesControl",P6="eventsControl",rM="eventControl",C6="teamsControl",Oje="controlBar",fge="buttonBar",TI="tmxPanel",mge="tmxTable",gge="tcContainer",ba="overlay",di="center",Hk="header",ti="right",hi="left",Gp="bottom",bJ="top",qF="subTable",WT="",lA="flex",Rt="none",vge="isOpen",R6="Collection value",M6="Match value",N6="Score value",A6="Set value",SE={[zme]:"After rest",[qme]:"Followed by",[Kme]:"To be announced",[Wme]:"Next available",[Yme]:"Not before"},Lje={[zme]:"After rest",[qme]:"Followed by",[Kme]:"TBA",[Wme]:"Next available",[Yme]:"NB"},yge={[Ije]:"OA",[wje]:"DA",[Sje]:"SE",[Tje]:"JE",[nM]:"QUAL",[Uje]:"ALT",[Dje]:"WC"},zk="Playoff",dy="drawSize",qk="CUSTOM",$S="advancePerGroup",Wk="qualifiersCount",Yk="groupRemaining",_6="matchUpFormat",AC="structureName",yP="playoffType",Wf="groupSize",bge="positions",vw="drawName",Ph="drawType",bP="top",Fje="winners",nH="roundsColumns",YT="roundsStats",KT="roundsTable",yw="utr",_C="wtn",IP={},$je={position:"top-right",clickClose:!0,duration:2e3,offsetBottom:0,offsetRight:0,offsetLeft:0,offsetTop:0,opacity:1},Bje=(t,e,i,n,r)=>{const a=t.split("-"),s=a.includes(hi)&&`left:${n}`,o=a.includes(ti)&&`right:${r}`,l=a.includes("top")&&`top:${e}`,u=a.includes("bottom")&&`bottom:${i}`,c="align-items: "+(a.includes("left")&&"flex-start"||a.includes("right")&&"flex-end"||di),d="text-align: "+(a.includes("left")&&"left"||a.includes("right")&&"right"||di);return[s,o,l,u,c,d].filter(Boolean).join(";")};function Vje(t){if(IP.position)return IP.position;const e=document.createElement("div");return e.style.cssText="position: fixed; display: flex; flex-direction: column; width:100%; z-index: 9999; pointer-events: none;padding:15px;"+Bje(t.position,t.offsetTop,t.offsetBottom,t.offsetLeft,t.offsetRight),(t.appendTo||document.body).appendChild(e),IP.position=e,e}function jje(t){if(!t.message)return{error:"Missing message"};const e={...$je,...t},i=Vje(e),n=Gje(e);if(e.onlyOne){let r=i.lastElementChild;for(;r;)i.removeChild(r),r=i.lastElementChild}i.appendChild(n.element)}function Gje(t){const e=document.createElement("div");t.clickClose&&e.addEventListener("click",()=>a(t.onClose));const i=t.duration&&zNe(()=>a(t.onClose),t.duration);i&&t.pauseOnHover&&(e.addEventListener("mouseover",i.pause),e.addEventListener("mouseout",i.resume)),e.style.cssText=`display:inline-flex;width:auto;pointer-events:auto;white-space:pre-wrap;opacity:${t.opacity};${t.dismissible?"":"padding: 1.25rem, 1.5rem;"}`;const n=["notification"];if(typeof t.classList=="string"&&n.push(t.classList),t.type&&n.push(t.type),t?.animate?.in){const l=t.animate.speed?`animate__${t.animate.speed}`:"animate__faster",u=`animate__${t.animate.in}`;n.push(`animate__animated ${u} ${l}`),o(()=>e.classList.remove(u))}if(e.className=n.join(" "),t.dismissible){const l=document.createElement("button");l.className="delete",l.addEventListener("click",()=>a(t.onClose)),e.insertAdjacentElement("afterbegin",l)}const r=document.createElement("div");if(r.style.cssText="display: flex; flex-direction: row; align-items: center; justify-content: center;",typeof t.message=="string"?r.insertAdjacentHTML("beforeend",t.message):t.message&&console.log(" MESSAGE ",t.message,typeof t.message),Mt(t.action?.onClick)){const l=document.createElement("button");l.style.cssText="margin-left: 1em;",l.className="button",l.innerHTML=t.action.text||"OK",l.addEventListener("click",t.action.onClick),r.appendChild(l)}return e.appendChild(r),{element:e};function a(l){Mt(l)&&l(),t?.animate?.out?(e.classList.add(`animate__${t.animate.out}`),o(()=>{s(e.parentNode),delete IP.position,e.remove()})):(s(e.parentNode),delete IP.position,e.remove())}function s(l){l&&l.children.length<=1&&l.remove()}function o(l=()=>{}){const u={WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",animation:"animationend"};for(const c in u)if(e.style[c]!==void 0){e.addEventListener(u[c],()=>l());break}}}function Ht(t){const{position:e="top-center",intent:i="is-success",pauseOnHover:n=!1,dismissible:r=!0,clickClose:a=!0,duration:s=2500,single:o=!0,onClose:l,offsetBottom:u=0,offsetRight:c=0,offsetLeft:d=0,offsetTop:p=0,opacity:h=1,message:f,action:m}=t??{};jje({animate:{in:"fadeIn",out:"fadeOut"},pauseOnHover:n,offsetBottom:u,type:i,offsetRight:c,dismissible:r,offsetLeft:d,clickClose:a,offsetTop:p,duration:s,position:e,message:f,onClose:l,opacity:h,action:m,single:o})}function Hje(){Ht({intent:"is-success",message:"New Version Cached: Close Tab or Browser and Re-open to Update"})}function zje(){const t=`${_s.tr("phrases.blocked")}. ${_s.tr("phrases.enablepopups")}`;Ht({intent:"is-danger",message:t})}function qje(){const t=document.createElement("div");return t.className="is-marginless",t.style.width="inherit",t.id="o-tab",t.innerHTML=`
    <div class="tab_section events_tab">
        <div class="section">
            <div id=${TD} class="box tournament-information">
            </div>
        </div>
    </div>
  `,t}function Wje(){const t=document.getElementById("dnav");if(!t)return;const e=window.pageXOffset!=null,i=(document.compatMode||"")==="CSS1Compat";let n=0;const r=()=>{let u;e?u=window.pageYOffset:u=i?document.documentElement.scrollTop:document.body.scrollTop;let c;return u>n?c=!0:c=!1,n=u,c},a=()=>{r()&&!t.contains(document.activeElement)?(t.classList.add("scroll-down"),t.classList.remove("scroll-up")):(t.classList.add("scroll-up"),t.classList.remove("scroll-down"))};let s;const o=(u,c)=>{s||(s=!0,setTimeout(()=>{u(),s=!1},c))},l=window.matchMedia("(prefers-reduced-motion: reduce)");window.addEventListener("scroll",()=>{l&&!l.matches&&o(a,250)})}function Yje(){const t=document.createElement("div");return t.className="is-marginless",t.style.width="inherit",t.id="e-tab",t.innerHTML=`
  <div class="tab_section events_tab">
    <div class="section">
      <div class='tabHeader foreground'></div>
      <div id=${dge} class="block" style='display: none; width: 100%;'>
        <div id=${rM} class="controlBar" style='min-height: 3em; border-radius: 6px;'}></div>
      </div>
      <div id=${oge}>
        <div id=${P6} class="controlBar"></div>
        <div id=${MC} class="tableClass flexcol flexcenter">
          {' '}
        </div>
      </div>
      <div id=${cge} style='display: none;'>
        <div id=${v6} class='tableClass block ${TI}'>
          {' '}
        </div>
        <div id=${b6} class='tableClass block ${TI}'>
          {' '}
        </div>
        <div id=${y6} class='tableClass block ${TI}'>
          {' '}
        </div>
        <div id=${I6} class='tableClass block ${TI}'>
          {' '}
        </div>
        <div id=${w6} class='tableClass block ${TI}'>
          {' '}
        </div>
      </div>
      <div style="width: 100%; margin: 0">
        <div id=${g6}></div>
        <div id=${xje} class="flexrow flexjustifystart" style="width: 100%">
          <div id=${uge} ></div>
          <div
            id=${nf}
            style="overflow-x: scroll; width: 100%; display: none;"
          >
          </div>
          <div id=${lge} ></div>
        </div>
      </div>
    </div>
  </div>
  `,t}const Kje=""+new URL("orgLogo-DsK9KK2k.png",import.meta.url).href;function Zje(){const t=document.createElement("img");return t.style.maxWidth="800px",t.style.width="100%",t.alt="tmxLogo",t.src=Kje,t}function Xje(){const t=document.getElementById("root");t.appendChild(Jje());const e=document.createElement("div");e.className="flexrow flexcenter",e.id=RC,e.style.cssText="margin-top: 2em; padding-top: 5em; display: none;",e.appendChild(Zje()),t.appendChild(e);const i=document.createElement("div");i.style.display=Rt,i.id=Rje;const n=document.createElement("input");n.className="timepicker-ui-input",n.id=Mje,n.type="text",i.appendChild(n),t.appendChild(i);const r=document.createElement("section");r.className="drawer drawer--left",r.setAttribute("data-drawer-target",""),r.id=ege,r.innerHTML=`
      <div class="drawer__overlay" data-drawer-close tabIndex="-1"></div>
      <div class="drawer__wrapper">
        <div class="drawer__header">
          <div class="drawer__title"></div>
          <button
            class="drawer__close"
            style='display: none;'}
            data-drawer-close
            aria-label="Close Drawer"
          ></button>
        </div>
        <div class="drawer__content"></div>
        <div class="drawer__footer"></div>
      </div>
  `,t.appendChild(r);const a=document.getElementById("navMain"),s=document.createElement("div");s.id=vP,s.className="springboard flexrow flexcenter",s.style.display=Rt;const o=document.createElement("div");o.id="navText",o.className="navText",o.style.display=Rt,s.appendChild(o);const l=document.createElement("div");l.id=gge,l.className="flexcol flexcenter tournament_container",l.appendChild(qje()),l.appendChild(Yje()),s.appendChild(l),a.appendChild(s);const u=document.createElement("div");u.className="flexcol flexgrow",u.style.display=Rt,u.id=tf;const c=document.createElement("div");c.className="controlBar flexcol flexgrow flexcenter",c.id=hge,u.appendChild(c);const d=document.createElement("div");d.className="flexcol flexgrow flexcenter box",d.id=iH,u.appendChild(d),a.appendChild(u);const p=document.createElement("div");return p.className="flexcol flexgrow",p.style.paddingTop="3em",p.style.display=Rt,p.style.height="90%",p.style.width="100%",p.id=zF,a.appendChild(p),Wje(),t}function Jje(){const t=document.createElement("div");return t.innerHTML=`<div id='dnav'>
    <div class="navbar-item" style="display: flex; flex-wrap: nowrap">
      <div id="provider" style="display: flex; flex-direction: column">
        <div style="font-size: .6em">TMX</div>
      </div>
      <div style="padding-left: 1em" id="pageTitle"> </div>
    </div>
    <div id='trnynav' class="navbar-item" style="display: flex; flex-direction: row;">
      <i id='o-route' class="nav-icon fa-solid fa-trophy"></i>
      <i id='p-route' class="nav-icon fa-solid fa-user-group" style="color: blue"></i>
      <i id='e-route' class="nav-icon fa-solid fa-diagram-project"></i>
      <i id='m-route' class="nav-icon fa-solid fa-table-tennis-paddle-ball"></i>
      <i id='s-route' class="nav-icon fa-solid fa-clock"></i>
      <i id='v-route' class="nav-icon fa-solid fa-location-dot"></i>
    </div>
    <div class="navbar-item" style="font-size: 1em">
      <i id="config" class="fa-solid fa-sliders"></i>
      <i id="login" style="padding-left: .5em" class="fa-solid fa-circle-user"></i>
    </div>
  </div>
  <main id="navMain"></main>`,t}function Qje(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(t=>{t.unregister()})}function Js(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const v_={[TD]:"o-tab",[Tm]:"p-tab",[wh]:"e-tab",[p6]:"m-tab",[ib]:"s-tab",[h6]:"v-tab"};function eGe(){const t=`
        <div id='individuals' class='tab_section participants_tab'>
          <div class='section'>
            <div class='tabHeader foreground'>Participants</div>
            <div id='${S6}' class='controlBar'></div>
            <div id='${$k}' class='tableClass flexcol flexcenter'> </div>
          </div>
        </div>
        <div id='participantGroupings' class='tab_section participants_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${C6}' class='controlBar'></div>
              <div id='${jk}' class='tableClass flexcol flexcenter'> </div>
            </div>
        </div>
        `,e=`
        <div class='tab_section sch_tab'>
            <div class='section block'>
              <div id='${pge}' style='width: 100%; display: none;'>
                  <div id='${T6}' class='controlBar flexcol flexcenter'></div>
                  <div id='${VI}' class='tableClass flexcol flexcenter'></div>
              </div>
              <div>
                  <div id='${U6}' class='controlBar flexcol flexcenter'></div>
                  <div id='${Vk}' class='tableClass flexcol flexcenter'></div>
              </div>
            </div>
        </div>
        `,i=`
        <div class='tab_section venues_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${E6}' class='controlBar'></div>
              <div id='${Gk}' class='tableClass flexcol flexcenter'></div>
            </div>
        </div>
        `,n=`
        <div class='tab_section matchUps_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${D6}' class='controlBar'></div>
              <div id='${m6}' class='controlBar'></div>
              <div id='${Bk}' class='tableClass flexcol flexcenter'> </div>
            </div>
        </div>
        `,r={"p-tab":t,"s-tab":e,"v-tab":i,"m-tab":n},a=document.getElementById(gge);Object.keys(r).forEach(s=>{const o=document.createElement("div");o.className="is-marginless",o.style.cssText="width: inherit",o.id=s,o.innerHTML=r[s],a.appendChild(o)}),Ige(Tm)}function Ige(t){return Object.keys(v_).includes(t)?(Object.keys(v_).forEach(e=>{const i=v_[e],n=document.getElementById(i);n?n.style.display=t===e?"":Rt:console.log({key:e,id:i,element:n})}),{...iM}):!1}function tGe(){[nf,P6,D6,S6,T6,rM,C6,U6,E6,m6,v6,y6,b6,I6,w6,MC,Bk,$k,Vk,jk,VI,Gk].forEach(e=>{const i=v_[e],n=document.getElementById(i);n&&Js(n)})}function wge(){return"tmxToken"}function Sge(t,e){return function(){return t.apply(e,arguments)}}const{toString:iGe}=Object.prototype,{getPrototypeOf:k6}=Object,{iterator:WF,toStringTag:Tge}=Symbol,YF=(t=>e=>{const i=iGe.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),vf=t=>(t=t.toLowerCase(),e=>YF(e)===t),KF=t=>e=>typeof e===t,{isArray:UD}=Array,ZT=KF("undefined");function aM(t){return t!==null&&!ZT(t)&&t.constructor!==null&&!ZT(t.constructor)&&qc(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Uge=vf("ArrayBuffer");function nGe(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Uge(t.buffer),e}const rGe=KF("string"),qc=KF("function"),Dge=KF("number"),sM=t=>t!==null&&typeof t=="object",aGe=t=>t===!0||t===!1,y_=t=>{if(YF(t)!=="object")return!1;const e=k6(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Tge in t)&&!(WF in t)},sGe=t=>{if(!sM(t)||aM(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},oGe=vf("Date"),lGe=vf("File"),uGe=vf("Blob"),cGe=vf("FileList"),dGe=t=>sM(t)&&qc(t.pipe),pGe=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||qc(t.append)&&((e=YF(t))==="formdata"||e==="object"&&qc(t.toString)&&t.toString()==="[object FormData]"))},hGe=vf("URLSearchParams"),[fGe,mGe,gGe,vGe]=["ReadableStream","Request","Response","Headers"].map(vf),yGe=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function oM(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let n,r;if(typeof t!="object"&&(t=[t]),UD(t))for(n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else{if(aM(t))return;const a=i?Object.getOwnPropertyNames(t):Object.keys(t),s=a.length;let o;for(n=0;n<s;n++)o=a[n],e.call(null,t[o],o,t)}}function Ege(t,e){if(aM(t))return null;e=e.toLowerCase();const i=Object.keys(t);let n=i.length,r;for(;n-- >0;)if(r=i[n],e===r.toLowerCase())return r;return null}const CI=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Pge=t=>!ZT(t)&&t!==CI;function rH(){const{caseless:t,skipUndefined:e}=Pge(this)&&this||{},i={},n=(r,a)=>{const s=t&&Ege(i,a)||a;y_(i[s])&&y_(r)?i[s]=rH(i[s],r):y_(r)?i[s]=rH({},r):UD(r)?i[s]=r.slice():(!e||!ZT(r))&&(i[s]=r)};for(let r=0,a=arguments.length;r<a;r++)arguments[r]&&oM(arguments[r],n);return i}const bGe=(t,e,i,{allOwnKeys:n}={})=>(oM(e,(r,a)=>{i&&qc(r)?t[a]=Sge(r,i):t[a]=r},{allOwnKeys:n}),t),IGe=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),wGe=(t,e,i,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},SGe=(t,e,i,n)=>{let r,a,s;const o={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),a=r.length;a-- >0;)s=r[a],(!n||n(s,t,e))&&!o[s]&&(e[s]=t[s],o[s]=!0);t=i!==!1&&k6(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},TGe=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const n=t.indexOf(e,i);return n!==-1&&n===i},UGe=t=>{if(!t)return null;if(UD(t))return t;let e=t.length;if(!Dge(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},DGe=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&k6(Uint8Array)),EGe=(t,e)=>{const n=(t&&t[WF]).call(t);let r;for(;(r=n.next())&&!r.done;){const a=r.value;e.call(t,a[0],a[1])}},PGe=(t,e)=>{let i;const n=[];for(;(i=t.exec(e))!==null;)n.push(i);return n},CGe=vf("HTMLFormElement"),RGe=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,n,r){return n.toUpperCase()+r}),IJ=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),MGe=vf("RegExp"),Cge=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),n={};oM(i,(r,a)=>{let s;(s=e(r,a,t))!==!1&&(n[a]=s||r)}),Object.defineProperties(t,n)},NGe=t=>{Cge(t,(e,i)=>{if(qc(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const n=t[i];if(qc(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},AGe=(t,e)=>{const i={},n=r=>{r.forEach(a=>{i[a]=!0})};return UD(t)?n(t):n(String(t).split(e)),i},_Ge=()=>{},kGe=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function xGe(t){return!!(t&&qc(t.append)&&t[Tge]==="FormData"&&t[WF])}const OGe=t=>{const e=new Array(10),i=(n,r)=>{if(sM(n)){if(e.indexOf(n)>=0)return;if(aM(n))return n;if(!("toJSON"in n)){e[r]=n;const a=UD(n)?[]:{};return oM(n,(s,o)=>{const l=i(s,r+1);!ZT(l)&&(a[o]=l)}),e[r]=void 0,a}}return n};return i(t,0)},LGe=vf("AsyncFunction"),FGe=t=>t&&(sM(t)||qc(t))&&qc(t.then)&&qc(t.catch),Rge=((t,e)=>t?setImmediate:e?((i,n)=>(CI.addEventListener("message",({source:r,data:a})=>{r===CI&&a===i&&n.length&&n.shift()()},!1),r=>{n.push(r),CI.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",qc(CI.postMessage)),$Ge=typeof queueMicrotask<"u"?queueMicrotask.bind(CI):typeof process<"u"&&process.nextTick||Rge,BGe=t=>t!=null&&qc(t[WF]),it={isArray:UD,isArrayBuffer:Uge,isBuffer:aM,isFormData:pGe,isArrayBufferView:nGe,isString:rGe,isNumber:Dge,isBoolean:aGe,isObject:sM,isPlainObject:y_,isEmptyObject:sGe,isReadableStream:fGe,isRequest:mGe,isResponse:gGe,isHeaders:vGe,isUndefined:ZT,isDate:oGe,isFile:lGe,isBlob:uGe,isRegExp:MGe,isFunction:qc,isStream:dGe,isURLSearchParams:hGe,isTypedArray:DGe,isFileList:cGe,forEach:oM,merge:rH,extend:bGe,trim:yGe,stripBOM:IGe,inherits:wGe,toFlatObject:SGe,kindOf:YF,kindOfTest:vf,endsWith:TGe,toArray:UGe,forEachEntry:EGe,matchAll:PGe,isHTMLForm:CGe,hasOwnProperty:IJ,hasOwnProp:IJ,reduceDescriptors:Cge,freezeMethods:NGe,toObjectSet:AGe,toCamelCase:RGe,noop:_Ge,toFiniteNumber:kGe,findKey:Ege,global:CI,isContextDefined:Pge,isSpecCompliantForm:xGe,toJSONObject:OGe,isAsyncFn:LGe,isThenable:FGe,setImmediate:Rge,asap:$Ge,isIterable:BGe};function Cn(t,e,i,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),n&&(this.request=n),r&&(this.response=r,this.status=r.status?r.status:null)}it.inherits(Cn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:it.toJSONObject(this.config),code:this.code,status:this.status}}});const Mge=Cn.prototype,Nge={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Nge[t]={value:t}});Object.defineProperties(Cn,Nge);Object.defineProperty(Mge,"isAxiosError",{value:!0});Cn.from=(t,e,i,n,r,a)=>{const s=Object.create(Mge);it.toFlatObject(t,s,function(c){return c!==Error.prototype},u=>u!=="isAxiosError");const o=t&&t.message?t.message:"Error",l=e==null&&t?t.code:e;return Cn.call(s,o,l,i,n,r),t&&s.cause==null&&Object.defineProperty(s,"cause",{value:t,configurable:!0}),s.name=t&&t.name||"Error",a&&Object.assign(s,a),s};const VGe=null;function aH(t){return it.isPlainObject(t)||it.isArray(t)}function Age(t){return it.endsWith(t,"[]")?t.slice(0,-2):t}function wJ(t,e,i){return t?t.concat(e).map(function(r,a){return r=Age(r),!i&&a?"["+r+"]":r}).join(i?".":""):e}function jGe(t){return it.isArray(t)&&!t.some(aH)}const GGe=it.toFlatObject(it,{},null,function(e){return/^is[A-Z]/.test(e)});function ZF(t,e,i){if(!it.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=it.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,g){return!it.isUndefined(g[m])});const n=i.metaTokens,r=i.visitor||c,a=i.dots,s=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&it.isSpecCompliantForm(e);if(!it.isFunction(r))throw new TypeError("visitor must be a function");function u(f){if(f===null)return"";if(it.isDate(f))return f.toISOString();if(it.isBoolean(f))return f.toString();if(!l&&it.isBlob(f))throw new Cn("Blob is not supported. Use a Buffer instead.");return it.isArrayBuffer(f)||it.isTypedArray(f)?l&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function c(f,m,g){let v=f;if(f&&!g&&typeof f=="object"){if(it.endsWith(m,"{}"))m=n?m:m.slice(0,-2),f=JSON.stringify(f);else if(it.isArray(f)&&jGe(f)||(it.isFileList(f)||it.endsWith(m,"[]"))&&(v=it.toArray(f)))return m=Age(m),v.forEach(function(b,I){!(it.isUndefined(b)||b===null)&&e.append(s===!0?wJ([m],I,a):s===null?m:m+"[]",u(b))}),!1}return aH(f)?!0:(e.append(wJ(g,m,a),u(f)),!1)}const d=[],p=Object.assign(GGe,{defaultVisitor:c,convertValue:u,isVisitable:aH});function h(f,m){if(!it.isUndefined(f)){if(d.indexOf(f)!==-1)throw Error("Circular reference detected in "+m.join("."));d.push(f),it.forEach(f,function(v,y){(!(it.isUndefined(v)||v===null)&&r.call(e,v,it.isString(y)?y.trim():y,m,p))===!0&&h(v,m?m.concat(y):[y])}),d.pop()}}if(!it.isObject(t))throw new TypeError("data must be an object");return h(t),e}function SJ(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function x6(t,e){this._pairs=[],t&&ZF(t,this,e)}const _ge=x6.prototype;_ge.append=function(e,i){this._pairs.push([e,i])};_ge.toString=function(e){const i=e?function(n){return e.call(this,n,SJ)}:SJ;return this._pairs.map(function(r){return i(r[0])+"="+i(r[1])},"").join("&")};function HGe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function kge(t,e,i){if(!e)return t;const n=i&&i.encode||HGe;it.isFunction(i)&&(i={serialize:i});const r=i&&i.serialize;let a;if(r?a=r(e,i):a=it.isURLSearchParams(e)?e.toString():new x6(e,i).toString(n),a){const s=t.indexOf("#");s!==-1&&(t=t.slice(0,s)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class TJ{constructor(){this.handlers=[]}use(e,i,n){return this.handlers.push({fulfilled:e,rejected:i,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){it.forEach(this.handlers,function(n){n!==null&&e(n)})}}const xge={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},zGe=typeof URLSearchParams<"u"?URLSearchParams:x6,qGe=typeof FormData<"u"?FormData:null,WGe=typeof Blob<"u"?Blob:null,YGe={isBrowser:!0,classes:{URLSearchParams:zGe,FormData:qGe,Blob:WGe},protocols:["http","https","file","blob","url","data"]},O6=typeof window<"u"&&typeof document<"u",sH=typeof navigator=="object"&&navigator||void 0,KGe=O6&&(!sH||["ReactNative","NativeScript","NS"].indexOf(sH.product)<0),ZGe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",XGe=O6&&window.location.href||"http://localhost",JGe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:O6,hasStandardBrowserEnv:KGe,hasStandardBrowserWebWorkerEnv:ZGe,navigator:sH,origin:XGe},Symbol.toStringTag,{value:"Module"})),iu={...JGe,...YGe};function QGe(t,e){return ZF(t,new iu.classes.URLSearchParams,{visitor:function(i,n,r,a){return iu.isNode&&it.isBuffer(i)?(this.append(n,i.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)},...e})}function eHe(t){return it.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function tHe(t){const e={},i=Object.keys(t);let n;const r=i.length;let a;for(n=0;n<r;n++)a=i[n],e[a]=t[a];return e}function Oge(t){function e(i,n,r,a){let s=i[a++];if(s==="__proto__")return!0;const o=Number.isFinite(+s),l=a>=i.length;return s=!s&&it.isArray(r)?r.length:s,l?(it.hasOwnProp(r,s)?r[s]=[r[s],n]:r[s]=n,!o):((!r[s]||!it.isObject(r[s]))&&(r[s]=[]),e(i,n,r[s],a)&&it.isArray(r[s])&&(r[s]=tHe(r[s])),!o)}if(it.isFormData(t)&&it.isFunction(t.entries)){const i={};return it.forEachEntry(t,(n,r)=>{e(eHe(n),r,i,0)}),i}return null}function iHe(t,e,i){if(it.isString(t))try{return(e||JSON.parse)(t),it.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(i||JSON.stringify)(t)}const lM={transitional:xge,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const n=i.getContentType()||"",r=n.indexOf("application/json")>-1,a=it.isObject(e);if(a&&it.isHTMLForm(e)&&(e=new FormData(e)),it.isFormData(e))return r?JSON.stringify(Oge(e)):e;if(it.isArrayBuffer(e)||it.isBuffer(e)||it.isStream(e)||it.isFile(e)||it.isBlob(e)||it.isReadableStream(e))return e;if(it.isArrayBufferView(e))return e.buffer;if(it.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return QGe(e,this.formSerializer).toString();if((o=it.isFileList(e))||n.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return ZF(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return a||r?(i.setContentType("application/json",!1),iHe(e)):e}],transformResponse:[function(e){const i=this.transitional||lM.transitional,n=i&&i.forcedJSONParsing,r=this.responseType==="json";if(it.isResponse(e)||it.isReadableStream(e))return e;if(e&&it.isString(e)&&(n&&!this.responseType||r)){const s=!(i&&i.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(o){if(s)throw o.name==="SyntaxError"?Cn.from(o,Cn.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:iu.classes.FormData,Blob:iu.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};it.forEach(["delete","get","head","post","put","patch"],t=>{lM.headers[t]={}});const nHe=it.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),rHe=t=>{const e={};let i,n,r;return t&&t.split(`
`).forEach(function(s){r=s.indexOf(":"),i=s.substring(0,r).trim().toLowerCase(),n=s.substring(r+1).trim(),!(!i||e[i]&&nHe[i])&&(i==="set-cookie"?e[i]?e[i].push(n):e[i]=[n]:e[i]=e[i]?e[i]+", "+n:n)}),e},UJ=Symbol("internals");function TE(t){return t&&String(t).trim().toLowerCase()}function b_(t){return t===!1||t==null?t:it.isArray(t)?t.map(b_):String(t)}function aHe(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(t);)e[n[1]]=n[2];return e}const sHe=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function mV(t,e,i,n,r){if(it.isFunction(n))return n.call(this,e,i);if(r&&(e=i),!!it.isString(e)){if(it.isString(n))return e.indexOf(n)!==-1;if(it.isRegExp(n))return n.test(e)}}function oHe(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,n)=>i.toUpperCase()+n)}function lHe(t,e){const i=it.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(t,n+i,{value:function(r,a,s){return this[n].call(this,e,r,a,s)},configurable:!0})})}let Wc=class{constructor(e){e&&this.set(e)}set(e,i,n){const r=this;function a(o,l,u){const c=TE(l);if(!c)throw new Error("header name must be a non-empty string");const d=it.findKey(r,c);(!d||r[d]===void 0||u===!0||u===void 0&&r[d]!==!1)&&(r[d||l]=b_(o))}const s=(o,l)=>it.forEach(o,(u,c)=>a(u,c,l));if(it.isPlainObject(e)||e instanceof this.constructor)s(e,i);else if(it.isString(e)&&(e=e.trim())&&!sHe(e))s(rHe(e),i);else if(it.isObject(e)&&it.isIterable(e)){let o={},l,u;for(const c of e){if(!it.isArray(c))throw TypeError("Object iterator must return a key-value pair");o[u=c[0]]=(l=o[u])?it.isArray(l)?[...l,c[1]]:[l,c[1]]:c[1]}s(o,i)}else e!=null&&a(i,e,n);return this}get(e,i){if(e=TE(e),e){const n=it.findKey(this,e);if(n){const r=this[n];if(!i)return r;if(i===!0)return aHe(r);if(it.isFunction(i))return i.call(this,r,n);if(it.isRegExp(i))return i.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=TE(e),e){const n=it.findKey(this,e);return!!(n&&this[n]!==void 0&&(!i||mV(this,this[n],n,i)))}return!1}delete(e,i){const n=this;let r=!1;function a(s){if(s=TE(s),s){const o=it.findKey(n,s);o&&(!i||mV(n,n[o],o,i))&&(delete n[o],r=!0)}}return it.isArray(e)?e.forEach(a):a(e),r}clear(e){const i=Object.keys(this);let n=i.length,r=!1;for(;n--;){const a=i[n];(!e||mV(this,this[a],a,e,!0))&&(delete this[a],r=!0)}return r}normalize(e){const i=this,n={};return it.forEach(this,(r,a)=>{const s=it.findKey(n,a);if(s){i[s]=b_(r),delete i[a];return}const o=e?oHe(a):String(a).trim();o!==a&&delete i[a],i[o]=b_(r),n[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return it.forEach(this,(n,r)=>{n!=null&&n!==!1&&(i[r]=e&&it.isArray(n)?n.join(", "):n)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const n=new this(e);return i.forEach(r=>n.set(r)),n}static accessor(e){const n=(this[UJ]=this[UJ]={accessors:{}}).accessors,r=this.prototype;function a(s){const o=TE(s);n[o]||(lHe(r,s),n[o]=!0)}return it.isArray(e)?e.forEach(a):a(e),this}};Wc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);it.reduceDescriptors(Wc.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(n){this[i]=n}}});it.freezeMethods(Wc);function gV(t,e){const i=this||lM,n=e||i,r=Wc.from(n.headers);let a=n.data;return it.forEach(t,function(o){a=o.call(i,a,r.normalize(),e?e.status:void 0)}),r.normalize(),a}function Lge(t){return!!(t&&t.__CANCEL__)}function DD(t,e,i){Cn.call(this,t??"canceled",Cn.ERR_CANCELED,e,i),this.name="CanceledError"}it.inherits(DD,Cn,{__CANCEL__:!0});function Fge(t,e,i){const n=i.config.validateStatus;!i.status||!n||n(i.status)?t(i):e(new Cn("Request failed with status code "+i.status,[Cn.ERR_BAD_REQUEST,Cn.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function uHe(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function cHe(t,e){t=t||10;const i=new Array(t),n=new Array(t);let r=0,a=0,s;return e=e!==void 0?e:1e3,function(l){const u=Date.now(),c=n[a];s||(s=u),i[r]=l,n[r]=u;let d=a,p=0;for(;d!==r;)p+=i[d++],d=d%t;if(r=(r+1)%t,r===a&&(a=(a+1)%t),u-s<e)return;const h=c&&u-c;return h?Math.round(p*1e3/h):void 0}}function dHe(t,e){let i=0,n=1e3/e,r,a;const s=(u,c=Date.now())=>{i=c,r=null,a&&(clearTimeout(a),a=null),t(...u)};return[(...u)=>{const c=Date.now(),d=c-i;d>=n?s(u,c):(r=u,a||(a=setTimeout(()=>{a=null,s(r)},n-d)))},()=>r&&s(r)]}const Kk=(t,e,i=3)=>{let n=0;const r=cHe(50,250);return dHe(a=>{const s=a.loaded,o=a.lengthComputable?a.total:void 0,l=s-n,u=r(l),c=s<=o;n=s;const d={loaded:s,total:o,progress:o?s/o:void 0,bytes:l,rate:u||void 0,estimated:u&&o&&c?(o-s)/u:void 0,event:a,lengthComputable:o!=null,[e?"download":"upload"]:!0};t(d)},i)},DJ=(t,e)=>{const i=t!=null;return[n=>e[0]({lengthComputable:i,total:t,loaded:n}),e[1]]},EJ=t=>(...e)=>it.asap(()=>t(...e)),pHe=iu.hasStandardBrowserEnv?((t,e)=>i=>(i=new URL(i,iu.origin),t.protocol===i.protocol&&t.host===i.host&&(e||t.port===i.port)))(new URL(iu.origin),iu.navigator&&/(msie|trident)/i.test(iu.navigator.userAgent)):()=>!0,hHe=iu.hasStandardBrowserEnv?{write(t,e,i,n,r,a,s){if(typeof document>"u")return;const o=[`${t}=${encodeURIComponent(e)}`];it.isNumber(i)&&o.push(`expires=${new Date(i).toUTCString()}`),it.isString(n)&&o.push(`path=${n}`),it.isString(r)&&o.push(`domain=${r}`),a===!0&&o.push("secure"),it.isString(s)&&o.push(`SameSite=${s}`),document.cookie=o.join("; ")},read(t){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function fHe(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function mHe(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function $ge(t,e,i){let n=!fHe(e);return t&&(n||i==!1)?mHe(t,e):e}const PJ=t=>t instanceof Wc?{...t}:t;function bw(t,e){e=e||{};const i={};function n(u,c,d,p){return it.isPlainObject(u)&&it.isPlainObject(c)?it.merge.call({caseless:p},u,c):it.isPlainObject(c)?it.merge({},c):it.isArray(c)?c.slice():c}function r(u,c,d,p){if(it.isUndefined(c)){if(!it.isUndefined(u))return n(void 0,u,d,p)}else return n(u,c,d,p)}function a(u,c){if(!it.isUndefined(c))return n(void 0,c)}function s(u,c){if(it.isUndefined(c)){if(!it.isUndefined(u))return n(void 0,u)}else return n(void 0,c)}function o(u,c,d){if(d in e)return n(u,c);if(d in t)return n(void 0,u)}const l={url:a,method:a,data:a,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:o,headers:(u,c,d)=>r(PJ(u),PJ(c),d,!0)};return it.forEach(Object.keys({...t,...e}),function(c){const d=l[c]||r,p=d(t[c],e[c],c);it.isUndefined(p)&&d!==o||(i[c]=p)}),i}const Bge=t=>{const e=bw({},t);let{data:i,withXSRFToken:n,xsrfHeaderName:r,xsrfCookieName:a,headers:s,auth:o}=e;if(e.headers=s=Wc.from(s),e.url=kge($ge(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),o&&s.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),it.isFormData(i)){if(iu.hasStandardBrowserEnv||iu.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(it.isFunction(i.getHeaders)){const l=i.getHeaders(),u=["content-type","content-length"];Object.entries(l).forEach(([c,d])=>{u.includes(c.toLowerCase())&&s.set(c,d)})}}if(iu.hasStandardBrowserEnv&&(n&&it.isFunction(n)&&(n=n(e)),n||n!==!1&&pHe(e.url))){const l=r&&a&&hHe.read(a);l&&s.set(r,l)}return e},gHe=typeof XMLHttpRequest<"u",vHe=gHe&&function(t){return new Promise(function(i,n){const r=Bge(t);let a=r.data;const s=Wc.from(r.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:u}=r,c,d,p,h,f;function m(){h&&h(),f&&f(),r.cancelToken&&r.cancelToken.unsubscribe(c),r.signal&&r.signal.removeEventListener("abort",c)}let g=new XMLHttpRequest;g.open(r.method.toUpperCase(),r.url,!0),g.timeout=r.timeout;function v(){if(!g)return;const b=Wc.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),S={data:!o||o==="text"||o==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:b,config:t,request:g};Fge(function(T){i(T),m()},function(T){n(T),m()},S),g=null}"onloadend"in g?g.onloadend=v:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(v)},g.onabort=function(){g&&(n(new Cn("Request aborted",Cn.ECONNABORTED,t,g)),g=null)},g.onerror=function(I){const S=I&&I.message?I.message:"Network Error",w=new Cn(S,Cn.ERR_NETWORK,t,g);w.event=I||null,n(w),g=null},g.ontimeout=function(){let I=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const S=r.transitional||xge;r.timeoutErrorMessage&&(I=r.timeoutErrorMessage),n(new Cn(I,S.clarifyTimeoutError?Cn.ETIMEDOUT:Cn.ECONNABORTED,t,g)),g=null},a===void 0&&s.setContentType(null),"setRequestHeader"in g&&it.forEach(s.toJSON(),function(I,S){g.setRequestHeader(S,I)}),it.isUndefined(r.withCredentials)||(g.withCredentials=!!r.withCredentials),o&&o!=="json"&&(g.responseType=r.responseType),u&&([p,f]=Kk(u,!0),g.addEventListener("progress",p)),l&&g.upload&&([d,h]=Kk(l),g.upload.addEventListener("progress",d),g.upload.addEventListener("loadend",h)),(r.cancelToken||r.signal)&&(c=b=>{g&&(n(!b||b.type?new DD(null,t,g):b),g.abort(),g=null)},r.cancelToken&&r.cancelToken.subscribe(c),r.signal&&(r.signal.aborted?c():r.signal.addEventListener("abort",c)));const y=uHe(r.url);if(y&&iu.protocols.indexOf(y)===-1){n(new Cn("Unsupported protocol "+y+":",Cn.ERR_BAD_REQUEST,t));return}g.send(a||null)})},yHe=(t,e)=>{const{length:i}=t=t?t.filter(Boolean):[];if(e||i){let n=new AbortController,r;const a=function(u){if(!r){r=!0,o();const c=u instanceof Error?u:this.reason;n.abort(c instanceof Cn?c:new DD(c instanceof Error?c.message:c))}};let s=e&&setTimeout(()=>{s=null,a(new Cn(`timeout ${e} of ms exceeded`,Cn.ETIMEDOUT))},e);const o=()=>{t&&(s&&clearTimeout(s),s=null,t.forEach(u=>{u.unsubscribe?u.unsubscribe(a):u.removeEventListener("abort",a)}),t=null)};t.forEach(u=>u.addEventListener("abort",a));const{signal:l}=n;return l.unsubscribe=()=>it.asap(o),l}},bHe=function*(t,e){let i=t.byteLength;if(i<e){yield t;return}let n=0,r;for(;n<i;)r=n+e,yield t.slice(n,r),n=r},IHe=async function*(t,e){for await(const i of wHe(t))yield*bHe(i,e)},wHe=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:i,value:n}=await e.read();if(i)break;yield n}}finally{await e.cancel()}},CJ=(t,e,i,n)=>{const r=IHe(t,e);let a=0,s,o=l=>{s||(s=!0,n&&n(l))};return new ReadableStream({async pull(l){try{const{done:u,value:c}=await r.next();if(u){o(),l.close();return}let d=c.byteLength;if(i){let p=a+=d;i(p)}l.enqueue(new Uint8Array(c))}catch(u){throw o(u),u}},cancel(l){return o(l),r.return()}},{highWaterMark:2})},RJ=64*1024,{isFunction:uA}=it,SHe=(({Request:t,Response:e})=>({Request:t,Response:e}))(it.global),{ReadableStream:MJ,TextEncoder:NJ}=it.global,AJ=(t,...e)=>{try{return!!t(...e)}catch{return!1}},THe=t=>{t=it.merge.call({skipUndefined:!0},SHe,t);const{fetch:e,Request:i,Response:n}=t,r=e?uA(e):typeof fetch=="function",a=uA(i),s=uA(n);if(!r)return!1;const o=r&&uA(MJ),l=r&&(typeof NJ=="function"?(f=>m=>f.encode(m))(new NJ):async f=>new Uint8Array(await new i(f).arrayBuffer())),u=a&&o&&AJ(()=>{let f=!1;const m=new i(iu.origin,{body:new MJ,method:"POST",get duplex(){return f=!0,"half"}}).headers.has("Content-Type");return f&&!m}),c=s&&o&&AJ(()=>it.isReadableStream(new n("").body)),d={stream:c&&(f=>f.body)};r&&["text","arrayBuffer","blob","formData","stream"].forEach(f=>{!d[f]&&(d[f]=(m,g)=>{let v=m&&m[f];if(v)return v.call(m);throw new Cn(`Response type '${f}' is not supported`,Cn.ERR_NOT_SUPPORT,g)})});const p=async f=>{if(f==null)return 0;if(it.isBlob(f))return f.size;if(it.isSpecCompliantForm(f))return(await new i(iu.origin,{method:"POST",body:f}).arrayBuffer()).byteLength;if(it.isArrayBufferView(f)||it.isArrayBuffer(f))return f.byteLength;if(it.isURLSearchParams(f)&&(f=f+""),it.isString(f))return(await l(f)).byteLength},h=async(f,m)=>{const g=it.toFiniteNumber(f.getContentLength());return g??p(m)};return async f=>{let{url:m,method:g,data:v,signal:y,cancelToken:b,timeout:I,onDownloadProgress:S,onUploadProgress:w,responseType:T,headers:U,withCredentials:C="same-origin",fetchOptions:E}=Bge(f),P=e||fetch;T=T?(T+"").toLowerCase():"text";let M=yHe([y,b&&b.toAbortSignal()],I),R=null;const N=M&&M.unsubscribe&&(()=>{M.unsubscribe()});let A;try{if(w&&u&&g!=="get"&&g!=="head"&&(A=await h(U,v))!==0){let j=new i(m,{method:"POST",body:v,duplex:"half"}),H;if(it.isFormData(v)&&(H=j.headers.get("content-type"))&&U.setContentType(H),j.body){const[G,W]=DJ(A,Kk(EJ(w)));v=CJ(j.body,RJ,G,W)}}it.isString(C)||(C=C?"include":"omit");const _=a&&"credentials"in i.prototype,x={...E,signal:M,method:g.toUpperCase(),headers:U.normalize().toJSON(),body:v,duplex:"half",credentials:_?C:void 0};R=a&&new i(m,x);let O=await(a?P(R,E):P(m,x));const $=c&&(T==="stream"||T==="response");if(c&&(S||$&&N)){const j={};["status","statusText","headers"].forEach(q=>{j[q]=O[q]});const H=it.toFiniteNumber(O.headers.get("content-length")),[G,W]=S&&DJ(H,Kk(EJ(S),!0))||[];O=new n(CJ(O.body,RJ,G,()=>{W&&W(),N&&N()}),j)}T=T||"text";let F=await d[it.findKey(d,T)||"text"](O,f);return!$&&N&&N(),await new Promise((j,H)=>{Fge(j,H,{data:F,headers:Wc.from(O.headers),status:O.status,statusText:O.statusText,config:f,request:R})})}catch(_){throw N&&N(),_&&_.name==="TypeError"&&/Load failed|fetch/i.test(_.message)?Object.assign(new Cn("Network Error",Cn.ERR_NETWORK,f,R),{cause:_.cause||_}):Cn.from(_,_&&_.code,f,R)}}},UHe=new Map,Vge=t=>{let e=t&&t.env||{};const{fetch:i,Request:n,Response:r}=e,a=[n,r,i];let s=a.length,o=s,l,u,c=UHe;for(;o--;)l=a[o],u=c.get(l),u===void 0&&c.set(l,u=o?new Map:THe(e)),c=u;return u};Vge();const L6={http:VGe,xhr:vHe,fetch:{get:Vge}};it.forEach(L6,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const _J=t=>`- ${t}`,DHe=t=>it.isFunction(t)||t===null||t===!1;function EHe(t,e){t=it.isArray(t)?t:[t];const{length:i}=t;let n,r;const a={};for(let s=0;s<i;s++){n=t[s];let o;if(r=n,!DHe(n)&&(r=L6[(o=String(n)).toLowerCase()],r===void 0))throw new Cn(`Unknown adapter '${o}'`);if(r&&(it.isFunction(r)||(r=r.get(e))))break;a[o||"#"+s]=r}if(!r){const s=Object.entries(a).map(([l,u])=>`adapter ${l} `+(u===!1?"is not supported by the environment":"is not available in the build"));let o=i?s.length>1?`since :
`+s.map(_J).join(`
`):" "+_J(s[0]):"as no adapter specified";throw new Cn("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return r}const jge={getAdapter:EHe,adapters:L6};function vV(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new DD(null,t)}function kJ(t){return vV(t),t.headers=Wc.from(t.headers),t.data=gV.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),jge.getAdapter(t.adapter||lM.adapter,t)(t).then(function(n){return vV(t),n.data=gV.call(t,t.transformResponse,n),n.headers=Wc.from(n.headers),n},function(n){return Lge(n)||(vV(t),n&&n.response&&(n.response.data=gV.call(t,t.transformResponse,n.response),n.response.headers=Wc.from(n.response.headers))),Promise.reject(n)})}const Gge="1.13.2",XF={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{XF[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const xJ={};XF.transitional=function(e,i,n){function r(a,s){return"[Axios v"+Gge+"] Transitional option '"+a+"'"+s+(n?". "+n:"")}return(a,s,o)=>{if(e===!1)throw new Cn(r(s," has been removed"+(i?" in "+i:"")),Cn.ERR_DEPRECATED);return i&&!xJ[s]&&(xJ[s]=!0,console.warn(r(s," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(a,s,o):!0}};XF.spelling=function(e){return(i,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function PHe(t,e,i){if(typeof t!="object")throw new Cn("options must be an object",Cn.ERR_BAD_OPTION_VALUE);const n=Object.keys(t);let r=n.length;for(;r-- >0;){const a=n[r],s=e[a];if(s){const o=t[a],l=o===void 0||s(o,a,t);if(l!==!0)throw new Cn("option "+a+" must be "+l,Cn.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new Cn("Unknown option "+a,Cn.ERR_BAD_OPTION)}}const I_={assertOptions:PHe,validators:XF},Of=I_.validators;let jI=class{constructor(e){this.defaults=e||{},this.interceptors={request:new TJ,response:new TJ}}async request(e,i){try{return await this._request(e,i)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const a=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?a&&!String(n.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+a):n.stack=a}catch{}}throw n}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=bw(this.defaults,i);const{transitional:n,paramsSerializer:r,headers:a}=i;n!==void 0&&I_.assertOptions(n,{silentJSONParsing:Of.transitional(Of.boolean),forcedJSONParsing:Of.transitional(Of.boolean),clarifyTimeoutError:Of.transitional(Of.boolean)},!1),r!=null&&(it.isFunction(r)?i.paramsSerializer={serialize:r}:I_.assertOptions(r,{encode:Of.function,serialize:Of.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),I_.assertOptions(i,{baseUrl:Of.spelling("baseURL"),withXsrfToken:Of.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let s=a&&it.merge(a.common,a[i.method]);a&&it.forEach(["delete","get","head","post","put","patch","common"],f=>{delete a[f]}),i.headers=Wc.concat(s,a);const o=[];let l=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(i)===!1||(l=l&&m.synchronous,o.unshift(m.fulfilled,m.rejected))});const u=[];this.interceptors.response.forEach(function(m){u.push(m.fulfilled,m.rejected)});let c,d=0,p;if(!l){const f=[kJ.bind(this),void 0];for(f.unshift(...o),f.push(...u),p=f.length,c=Promise.resolve(i);d<p;)c=c.then(f[d++],f[d++]);return c}p=o.length;let h=i;for(;d<p;){const f=o[d++],m=o[d++];try{h=f(h)}catch(g){m.call(this,g);break}}try{c=kJ.call(this,h)}catch(f){return Promise.reject(f)}for(d=0,p=u.length;d<p;)c=c.then(u[d++],u[d++]);return c}getUri(e){e=bw(this.defaults,e);const i=$ge(e.baseURL,e.url,e.allowAbsoluteUrls);return kge(i,e.params,e.paramsSerializer)}};it.forEach(["delete","get","head","options"],function(e){jI.prototype[e]=function(i,n){return this.request(bw(n||{},{method:e,url:i,data:(n||{}).data}))}});it.forEach(["post","put","patch"],function(e){function i(n){return function(a,s,o){return this.request(bw(o||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:a,data:s}))}}jI.prototype[e]=i(),jI.prototype[e+"Form"]=i(!0)});let CHe=class Hge{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(a){i=a});const n=this;this.promise.then(r=>{if(!n._listeners)return;let a=n._listeners.length;for(;a-- >0;)n._listeners[a](r);n._listeners=null}),this.promise.then=r=>{let a;const s=new Promise(o=>{n.subscribe(o),a=o}).then(r);return s.cancel=function(){n.unsubscribe(a)},s},e(function(a,s,o){n.reason||(n.reason=new DD(a,s,o),i(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=n=>{e.abort(n)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new Hge(function(r){e=r}),cancel:e}}};function RHe(t){return function(i){return t.apply(null,i)}}function MHe(t){return it.isObject(t)&&t.isAxiosError===!0}const oH={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(oH).forEach(([t,e])=>{oH[e]=t});function zge(t){const e=new jI(t),i=Sge(jI.prototype.request,e);return it.extend(i,jI.prototype,e,{allOwnKeys:!0}),it.extend(i,e,null,{allOwnKeys:!0}),i.create=function(r){return zge(bw(t,r))},i}const Qs=zge(lM);Qs.Axios=jI;Qs.CanceledError=DD;Qs.CancelToken=CHe;Qs.isCancel=Lge;Qs.VERSION=Gge;Qs.toFormData=ZF;Qs.AxiosError=Cn;Qs.Cancel=Qs.CanceledError;Qs.all=function(e){return Promise.all(e)};Qs.spread=RHe;Qs.isAxiosError=MHe;Qs.mergeConfig=bw;Qs.AxiosHeaders=Wc;Qs.formToJSON=t=>Oge(it.isHTMLForm(t)?new FormData(t):t);Qs.getAdapter=jge.getAdapter;Qs.HttpStatusCode=oH;Qs.default=Qs;const{Axios:zEt,AxiosError:qEt,CanceledError:WEt,isCancel:YEt,CancelToken:KEt,VERSION:ZEt,all:XEt,Cancel:JEt,isAxiosError:QEt,spread:ePt,toFormData:tPt,AxiosHeaders:iPt,HttpStatusCode:nPt,formToJSON:rPt,getAdapter:aPt,mergeConfig:sPt}=Qs,qge=wge(),NHe="https://courthive.net",uM=Qs.create({baseURL:NHe});uM.interceptors.request.use(t=>{const e=localStorage.getItem(qge);return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));uM.interceptors.response.use(t=>(t.data?.error&&Ht({message:t.data.error?.message,intent:"is-danger"}),t),t=>{if(t.message==="Network Error"&&Ht({message:t.message,intent:"is-danger"}),t.response){t.response?.status===401&&Wge();const e=t.response.data.message||t.response.data.error||t.response.data;Ht({message:e,intent:"is-danger"})}});const AHe=()=>{const t=localStorage.getItem(qge);uM.defaults.headers.common.Authorization=`Bearer ${t}`},Wge=()=>{uM.defaults.headers.common.Authorization=void 0},oc={...uM,addAuthorization:AHe,removeAuthorization:Wge};async function _He({identifier:t}){return await oc.post("/service/tournamentdetails",{identifier:t})}async function JF({tournamentId:t}){return await oc.post("/factory/fetch",{tournamentId:t})}async function kHe({provider:t}){return await oc.post("/provider/add",t)}async function xHe({provider:t}){return await oc.post("/provider/modify",t)}async function OHe({providerId:t}){return await oc.post("/provider/detail",{providerId:t})}async function LHe({providerAbbr:t}){return await oc.post("/provider/calendar",{providerAbbr:t})}async function kC(){return await oc.post("/provider/allProviders",{})}async function Yge(){return await oc.post("/auth/allusers",{})}async function FHe({email:t}){return await oc.post("/auth/remove",{email:t})}async function wP({tournamentRecord:t}){return await oc.post("/factory/save",{tournamentRecord:t})}async function $He({providerId:t,tournamentId:e}){return await oc.post("/factory/remove",{providerId:t,tournamentId:e})}function F6(t){return t[t.length-1]}function cM(t,...e){return e.forEach(i=>{t.includes(i)||t.push(i)}),t}function OJ(t,e){return t?t.split(e):[]}function $6(t,e,i){const n=e===void 0||t>=e,r=i===void 0||t<=i;return n&&r}function Kge(t,e,i){return t<e?e:t>i?i:t}function XT(t,e,i={},n=0,r=""){const a=Object.keys(i).reduce((o,l)=>{let u=i[l];return typeof u=="function"&&(u=u(n)),`${o} ${l}="${u}"`},t);r+=`<${a}></${t}>`;const s=n+1;return s<e?XT(t,e,i,s,r):r}function B6(t){return t.replace(/>\s+/g,">").replace(/\s+</,"<")}function lH(t){return new Date(t).setHours(0,0,0,0)}function T0(){return new Date().setHours(0,0,0,0)}function JT(...t){switch(t.length){case 0:return T0();case 1:return lH(t[0])}const e=new Date(0);return e.setFullYear(...t),e.setHours(0,0,0,0)}function xC(t,e){const i=new Date(t);return i.setDate(i.getDate()+e)}function BHe(t,e){return xC(t,e*7)}function Zk(t,e){const i=new Date(t),n=i.getMonth()+e;let r=n%12;r<0&&(r+=12);const a=i.setMonth(n);return i.getMonth()!==r?i.setDate(0):a}function OC(t,e){const i=new Date(t),n=i.getMonth(),r=i.setFullYear(i.getFullYear()+e);return n===1&&i.getMonth()===2?i.setDate(0):r}function LJ(t,e){return(t-e+7)%7}function GI(t,e,i=0){const n=new Date(t).getDay();return xC(t,LJ(e,i)-LJ(n,i))}function Zge(t,e){return Math.round((t-e)/6048e5)+1}function VHe(t){const e=GI(t,4,1),i=GI(new Date(e).setMonth(0,4),4,1);return Zge(e,i)}function Xge(t,e){const i=GI(new Date(t).setMonth(0,1),e,e),n=GI(t,e,e),r=Zge(n,i);if(r<53)return r;const a=GI(new Date(t).setDate(32),e,e);return n===a?1:r}function jHe(t){return Xge(t,0)}function GHe(t){return Xge(t,6)}function bS(t,e){const i=new Date(t).getFullYear();return Math.floor(i/e)*e}function Ry(t,e,i){if(e!==1&&e!==2)return t;const n=new Date(t);return e===1?i?n.setMonth(n.getMonth()+1,0):n.setDate(1):i?n.setFullYear(n.getFullYear()+1,0,0):n.setMonth(0,1),n.setHours(0,0,0,0)}const uH=/dd?|DD?|mm?|MM?|yy?(?:yy)?/,HHe=/[\s!-/:-@[-`{-~]+/;let yV={};const FJ={y(t,e){return new Date(t).setFullYear(parseInt(e,10))},m(t,e,i){const n=new Date(t);let r=parseInt(e,10)-1;if(isNaN(r)){if(!e)return NaN;const a=e.toLowerCase(),s=o=>o.toLowerCase().startsWith(a);if(r=i.monthsShort.findIndex(s),r<0&&(r=i.months.findIndex(s)),r<0)return NaN}return n.setMonth(r),n.getMonth()!==Jge(r)?n.setDate(0):n.getTime()},d(t,e){return new Date(t).setDate(parseInt(e,10))}},zHe={d(t){return t.getDate()},dd(t){return cA(t.getDate(),2)},D(t,e){return e.daysShort[t.getDay()]},DD(t,e){return e.days[t.getDay()]},m(t){return t.getMonth()+1},mm(t){return cA(t.getMonth()+1,2)},M(t,e){return e.monthsShort[t.getMonth()]},MM(t,e){return e.months[t.getMonth()]},y(t){return t.getFullYear()},yy(t){return cA(t.getFullYear(),2).slice(-2)},yyyy(t){return cA(t.getFullYear(),4)}};function Jge(t){return t>-1?t%12:Jge(t+12)}function cA(t,e){return t.toString().padStart(e,"0")}function Qge(t){if(typeof t!="string")throw new Error("Invalid date format.");if(t in yV)return yV[t];const e=t.split(uH),i=t.match(new RegExp(uH,"g"));if(e.length===0||!i)throw new Error("Invalid date format.");const n=i.map(a=>zHe[a]),r=Object.keys(FJ).reduce((a,s)=>(i.find(l=>l[0]!=="D"&&l[0].toLowerCase()===s)&&a.push(s),a),[]);return yV[t]={parser(a,s){const o=a.split(HHe).reduce((l,u,c)=>{if(u.length>0&&i[c]){const d=i[c][0];d==="M"?l.m=u:d!=="D"&&(l[d]=u)}return l},{});return r.reduce((l,u)=>{const c=FJ[u](l,o[u],s);return isNaN(c)?l:c},T0())},formatter(a,s){let o=n.reduce((l,u,c)=>l+=`${e[c]}${u(a,s)}`,"");return o+=F6(e)}}}function Iw(t,e,i){if(t instanceof Date||typeof t=="number"){const n=lH(t);return isNaN(n)?void 0:n}if(t){if(t==="today")return T0();if(e&&e.toValue){const n=e.toValue(t,e,i);return isNaN(n)?void 0:lH(n)}return Qge(e).parser(t,i)}}function dM(t,e,i){if(isNaN(t)||!t&&t!==0)return"";const n=typeof t=="number"?new Date(t):t;return e.toDisplay?e.toDisplay(n,e,i):Qge(e).formatter(n,i)}const qHe=document.createRange();function ev(t){return qHe.createContextualFragment(t)}function eve(t){return t.parentElement||(t.parentNode instanceof ShadowRoot?t.parentNode.host:void 0)}function QF(t){return t.getRootNode().activeElement===t}function SP(t){t.style.display!=="none"&&(t.style.display&&(t.dataset.styleDisplay=t.style.display),t.style.display="none")}function TP(t){t.style.display==="none"&&(t.dataset.styleDisplay?(t.style.display=t.dataset.styleDisplay,delete t.dataset.styleDisplay):t.style.display="")}function Xk(t){t.firstChild&&(t.removeChild(t.firstChild),Xk(t))}function WHe(t,e){Xk(t),e instanceof DocumentFragment?t.appendChild(e):typeof e=="string"?t.appendChild(ev(e)):typeof e.forEach=="function"&&e.forEach(i=>{t.appendChild(i)})}const Jk=new WeakMap,{addEventListener:YHe,removeEventListener:KHe}=EventTarget.prototype;function Qk(t,e){let i=Jk.get(t);i||(i=[],Jk.set(t,i)),e.forEach(n=>{YHe.call(...n),i.push(n)})}function tve(t){let e=Jk.get(t);e&&(e.forEach(i=>{KHe.call(...i)}),Jk.delete(t))}if(!Event.prototype.composedPath){const t=(e,i=[])=>{i.push(e);let n;return e.parentNode?n=e.parentNode:e.host?n=e.host:e.defaultView&&(n=e.defaultView),n?t(n,i):i};Event.prototype.composedPath=function(){return t(this.target)}}function ive(t,e,i){const[n,...r]=t;if(e(n))return n;if(!(n===i||n.tagName==="HTML"||r.length===0))return ive(r,e,i)}function nve(t,e){const i=typeof e=="function"?e:n=>n instanceof Element&&n.matches(e);return ive(t.composedPath(),i,t.currentTarget)}const UE={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM y"}},V6={autohide:!1,beforeShowDay:null,beforeShowDecade:null,beforeShowMonth:null,beforeShowYear:null,clearButton:!1,dateDelimiter:",",datesDisabled:[],daysOfWeekDisabled:[],daysOfWeekHighlighted:[],defaultViewDate:void 0,disableTouchKeyboard:!1,enableOnReadonly:!0,format:"mm/dd/yyyy",language:"en",maxDate:null,maxNumberOfDates:1,maxView:3,minDate:null,nextArrow:"",orientation:"auto",pickLevel:0,prevArrow:"",showDaysOfWeek:!0,showOnClick:!0,showOnFocus:!0,startView:0,title:"",todayButton:!1,todayButtonMode:0,todayHighlight:!1,updateOnBlur:!0,weekNumbers:0,weekStart:0},{language:bV,format:ZHe,weekStart:XHe}=V6;function $J(t,e){return t.length<6&&e>=0&&e<7?cM(t,e):t}function rve(t,e){switch(t===4?e===6?3:!e+1:t){case 1:return VHe;case 2:return jHe;case 3:return GHe}}function BJ(t,e,i){return e.weekStart=t,e.weekEnd=(t+6)%7,i===4&&(e.getWeekNumber=rve(4,t)),t}function VJ(t,e,i,n){const r=Iw(t,e,i);return r!==void 0?r:n}function IV(t,e,i=3){const n=parseInt(t,10);return n>=0&&n<=i?n:e}function dA(t,e,i,n=void 0){e in t&&(i in t||(t[i]=n?n(t[e]):t[e]),delete t[e])}function wV(t,e){const i=Object.assign({},t),n={},r=e.constructor.locales,a=!!e.rangeSideIndex;let{datesDisabled:s,format:o,language:l,locale:u,maxDate:c,maxView:d,minDate:p,pickLevel:h,startView:f,weekNumbers:m,weekStart:g}=e.config||{};if(dA(i,"calendarWeeks","weekNumbers",w=>w?1:0),dA(i,"clearBtn","clearButton"),dA(i,"todayBtn","todayButton"),dA(i,"todayBtnMode","todayButtonMode"),i.language){let w;if(i.language!==l&&(r[i.language]?w=i.language:(w=i.language.split("-")[0],r[w]||(w=!1))),delete i.language,w){l=n.language=w;const T=u||r[bV];u=Object.assign({format:ZHe,weekStart:XHe},r[bV]),l!==bV&&Object.assign(u,r[l]),n.locale=u,o===T.format&&(o=n.format=u.format),g===T.weekStart&&(g=BJ(u.weekStart,n,m))}}if(i.format){const w=typeof i.format.toDisplay=="function",T=typeof i.format.toValue=="function",U=uH.test(i.format);(w&&T||U)&&(o=n.format=i.format),delete i.format}let v=h;"pickLevel"in i&&(v=IV(i.pickLevel,h,2),delete i.pickLevel),v!==h&&(v>h&&("minDate"in i||(i.minDate=p),"maxDate"in i||(i.maxDate=c)),s&&!i.datesDisabled&&(i.datesDisabled=[]),h=n.pickLevel=v);let y=p,b=c;if("minDate"in i){const w=JT(0,0,1);y=i.minDate===null?w:VJ(i.minDate,o,u,y),y!==w&&(y=Ry(y,h,!1)),delete i.minDate}if("maxDate"in i&&(b=i.maxDate===null?void 0:VJ(i.maxDate,o,u,b),b!==void 0&&(b=Ry(b,h,!0)),delete i.maxDate),b<y?(p=n.minDate=b,c=n.maxDate=y):(p!==y&&(p=n.minDate=y),c!==b&&(c=n.maxDate=b)),i.datesDisabled){const w=i.datesDisabled;if(typeof w=="function")n.datesDisabled=null,n.checkDisabled=(T,U)=>w(new Date(T),U,a);else{const T=n.datesDisabled=w.reduce((U,C)=>{const E=Iw(C,o,u);return E!==void 0?cM(U,Ry(E,h,a)):U},[]);n.checkDisabled=U=>T.includes(U)}delete i.datesDisabled}if("defaultViewDate"in i){const w=Iw(i.defaultViewDate,o,u);w!==void 0&&(n.defaultViewDate=w),delete i.defaultViewDate}if("weekStart"in i){const w=Number(i.weekStart)%7;isNaN(w)||(g=BJ(w,n,m)),delete i.weekStart}if(i.daysOfWeekDisabled&&(n.daysOfWeekDisabled=i.daysOfWeekDisabled.reduce($J,[]),delete i.daysOfWeekDisabled),i.daysOfWeekHighlighted&&(n.daysOfWeekHighlighted=i.daysOfWeekHighlighted.reduce($J,[]),delete i.daysOfWeekHighlighted),"weekNumbers"in i){let w=i.weekNumbers;if(w){const T=typeof w=="function"?(U,C)=>w(new Date(U),C):rve(w=parseInt(w,10),g);T&&(m=n.weekNumbers=w,n.getWeekNumber=T)}else m=n.weekNumbers=0,n.getWeekNumber=null;delete i.weekNumbers}if("maxNumberOfDates"in i){const w=parseInt(i.maxNumberOfDates,10);w>=0&&(n.maxNumberOfDates=w,n.multidate=w!==1),delete i.maxNumberOfDates}i.dateDelimiter&&(n.dateDelimiter=String(i.dateDelimiter),delete i.dateDelimiter);let I=d;"maxView"in i&&(I=IV(i.maxView,d),delete i.maxView),I=h>I?h:I,I!==d&&(d=n.maxView=I);let S=f;if("startView"in i&&(S=IV(i.startView,S),delete i.startView),S<h?S=h:S>d&&(S=d),S!==f&&(n.startView=S),i.prevArrow){const w=ev(i.prevArrow);w.childNodes.length>0&&(n.prevArrow=w.childNodes),delete i.prevArrow}if(i.nextArrow){const w=ev(i.nextArrow);w.childNodes.length>0&&(n.nextArrow=w.childNodes),delete i.nextArrow}if("disableTouchKeyboard"in i&&(n.disableTouchKeyboard="ontouchstart"in document&&!!i.disableTouchKeyboard,delete i.disableTouchKeyboard),i.orientation){const w=i.orientation.toLowerCase().split(/\s+/g);n.orientation={x:w.find(T=>T==="left"||T==="right")||"auto",y:w.find(T=>T==="top"||T==="bottom")||"auto"},delete i.orientation}if("todayButtonMode"in i){switch(i.todayButtonMode){case 0:case 1:n.todayButtonMode=i.todayButtonMode}delete i.todayButtonMode}return Object.entries(i).forEach(([w,T])=>{T!==void 0&&w in V6&&(n[w]=T)}),n}const jJ={show:{key:"ArrowDown"},hide:null,toggle:{key:"Escape"},prevButton:{key:"ArrowLeft",ctrlOrMetaKey:!0},nextButton:{key:"ArrowRight",ctrlOrMetaKey:!0},viewSwitch:{key:"ArrowUp",ctrlOrMetaKey:!0},clearButton:{key:"Backspace",ctrlOrMetaKey:!0},todayButton:{key:".",ctrlOrMetaKey:!0},exitEditMode:{key:"ArrowDown",ctrlOrMetaKey:!0}};function JHe(t){return Object.keys(jJ).reduce((e,i)=>{const n=t[i]===void 0?jJ[i]:t[i],r=n&&n.key;if(!r||typeof r!="string")return e;const a={key:r,ctrlOrMetaKey:!!(n.ctrlOrMetaKey||n.ctrlKey||n.metaKey)};return r.length>1&&(a.altKey=!!n.altKey,a.shiftKey=!!n.shiftKey),e[i]=a,e},{})}const GJ=t=>t.map(e=>`<button type="button" class="%buttonClass% ${e}" tabindex="-1"></button>`).join(""),QHe=B6(`<div class="datepicker">
  <div class="datepicker-picker">
    <div class="datepicker-header">
      <div class="datepicker-title"></div>
      <div class="datepicker-controls">
        ${GJ(["prev-button prev-btn","view-switch","next-button next-btn"])}
      </div>
    </div>
    <div class="datepicker-main"></div>
    <div class="datepicker-footer">
      <div class="datepicker-controls">
        ${GJ(["today-button today-btn","clear-button clear-btn"])}
      </div>
    </div>
  </div>
</div>`),eze=B6(`<div class="days">
  <div class="days-of-week">${XT("span",7,{class:"dow"})}</div>
  <div class="datepicker-grid">${XT("span",42)}</div>
</div>`),tze=B6(`<div class="week-numbers calendar-weeks">
  <div class="days-of-week"><span class="dow"></span></div>
  <div class="weeks">${XT("span",6,{class:"week"})}</div>
</div>`);let j6=class{constructor(e,i){Object.assign(this,i,{picker:e,element:ev('<div class="datepicker-view"></div>').firstChild,selected:[],isRangeEnd:!!e.datepicker.rangeSideIndex}),this.init(this.picker.datepicker.config)}init(e){"pickLevel"in e&&(this.isMinView=this.id===e.pickLevel),this.setOptions(e),this.updateFocus(),this.updateSelection()}prepareForRender(e,i,n){this.disabled=[];const r=this.picker;r.setViewSwitchLabel(e),r.setPrevButtonDisabled(i),r.setNextButtonDisabled(n)}setDisabled(e,i){i.add("disabled"),cM(this.disabled,e)}performBeforeHook(e,i){let n=this.beforeShow(new Date(i));switch(typeof n){case"boolean":n={enabled:n};break;case"string":n={classes:n}}if(n){const r=e.classList;if(n.enabled===!1&&this.setDisabled(i,r),n.classes){const a=n.classes.split(/\s+/);r.add(...a),a.includes("disabled")&&this.setDisabled(i,r)}n.content&&WHe(e,n.content)}}renderCell(e,i,n,r,{selected:a,range:s},o,l=[]){e.textContent=i,this.isMinView&&(e.dataset.date=r);const u=e.classList;if(e.className=`datepicker-cell ${this.cellClass}`,n<this.first?u.add("prev"):n>this.last&&u.add("next"),u.add(...l),(o||this.checkDisabled(r,this.id))&&this.setDisabled(r,u),s){const[c,d]=s;n>c&&n<d&&u.add("range"),n===c&&u.add("range-start"),n===d&&u.add("range-end")}a.includes(n)&&u.add("selected"),n===this.focused&&u.add("focused"),this.beforeShow&&this.performBeforeHook(e,r)}refreshCell(e,i,n,[r,a]){const s=e.classList;s.remove("range","range-start","range-end","selected","focused"),i>r&&i<a&&s.add("range"),i===r&&s.add("range-start"),i===a&&s.add("range-end"),n.includes(i)&&s.add("selected"),i===this.focused&&s.add("focused")}changeFocusedCell(e){this.grid.querySelectorAll(".focused").forEach(i=>{i.classList.remove("focused")}),this.grid.children[e].classList.add("focused")}};class ize extends j6{constructor(e){super(e,{id:0,name:"days",cellClass:"day"})}init(e,i=!0){if(i){const n=ev(eze).firstChild;this.dow=n.firstChild,this.grid=n.lastChild,this.element.appendChild(n)}super.init(e)}setOptions(e){let i;if("minDate"in e&&(this.minDate=e.minDate),"maxDate"in e&&(this.maxDate=e.maxDate),e.checkDisabled&&(this.checkDisabled=e.checkDisabled),e.daysOfWeekDisabled&&(this.daysOfWeekDisabled=e.daysOfWeekDisabled,i=!0),e.daysOfWeekHighlighted&&(this.daysOfWeekHighlighted=e.daysOfWeekHighlighted),"todayHighlight"in e&&(this.todayHighlight=e.todayHighlight),"weekStart"in e&&(this.weekStart=e.weekStart,this.weekEnd=e.weekEnd,i=!0),e.locale){const n=this.locale=e.locale;this.dayNames=n.daysMin,this.switchLabelFormat=n.titleFormat,i=!0}if("beforeShowDay"in e&&(this.beforeShow=typeof e.beforeShowDay=="function"?e.beforeShowDay:void 0),"weekNumbers"in e)if(e.weekNumbers&&!this.weekNumbers){const n=ev(tze).firstChild;this.weekNumbers={element:n,dow:n.firstChild,weeks:n.lastChild},this.element.insertBefore(n,this.element.firstChild)}else this.weekNumbers&&!e.weekNumbers&&(this.element.removeChild(this.weekNumbers.element),this.weekNumbers=null);"getWeekNumber"in e&&(this.getWeekNumber=e.getWeekNumber),"showDaysOfWeek"in e&&(e.showDaysOfWeek?(TP(this.dow),this.weekNumbers&&TP(this.weekNumbers.dow)):(SP(this.dow),this.weekNumbers&&SP(this.weekNumbers.dow))),i&&Array.from(this.dow.children).forEach((n,r)=>{const a=(this.weekStart+r)%7;n.textContent=this.dayNames[a],n.className=this.daysOfWeekDisabled.includes(a)?"dow disabled":"dow"})}updateFocus(){const e=new Date(this.picker.viewDate),i=e.getFullYear(),n=e.getMonth(),r=JT(i,n,1),a=GI(r,this.weekStart,this.weekStart);this.first=r,this.last=JT(i,n+1,0),this.start=a,this.focused=this.picker.viewDate}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e,i&&(this.range=i.dates)}render(){if(this.today=this.todayHighlight?T0():void 0,this.prepareForRender(dM(this.focused,this.switchLabelFormat,this.locale),this.first<=this.minDate,this.last>=this.maxDate),this.weekNumbers){const e=this.weekStart,i=GI(this.first,e,e);Array.from(this.weekNumbers.weeks.children).forEach((n,r)=>{const a=BHe(i,r);n.textContent=this.getWeekNumber(a,e),r>3&&n.classList[a>this.last?"add":"remove"]("next")})}Array.from(this.grid.children).forEach((e,i)=>{const n=xC(this.start,i),r=new Date(n),a=r.getDay(),s=[];this.today===n&&s.push("today"),this.daysOfWeekHighlighted.includes(a)&&s.push("highlighted"),this.renderCell(e,r.getDate(),n,n,this,n<this.minDate||n>this.maxDate||this.daysOfWeekDisabled.includes(a),s)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.dataset.date),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/864e5))}}function HJ(t,e){if(!t||!t[0]||!t[1])return;const[[i,n],[r,a]]=t;if(!(i>e||r<e))return[i===e?n:-1,r===e?a:12]}class nze extends j6{constructor(e){super(e,{id:1,name:"months",cellClass:"month"})}init(e,i=!0){i&&(this.grid=this.element,this.element.classList.add("months","datepicker-grid"),this.grid.appendChild(ev(XT("span",12,{"data-month":n=>n}))),this.first=0,this.last=11),super.init(e)}setOptions(e){if(e.locale&&(this.monthNames=e.locale.monthsShort),"minDate"in e)if(e.minDate===void 0)this.minYear=this.minMonth=this.minDate=void 0;else{const i=new Date(e.minDate);this.minYear=i.getFullYear(),this.minMonth=i.getMonth(),this.minDate=i.setDate(1)}if("maxDate"in e)if(e.maxDate===void 0)this.maxYear=this.maxMonth=this.maxDate=void 0;else{const i=new Date(e.maxDate);this.maxYear=i.getFullYear(),this.maxMonth=i.getMonth(),this.maxDate=JT(this.maxYear,this.maxMonth+1,0)}e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),"beforeShowMonth"in e&&(this.beforeShow=typeof e.beforeShowMonth=="function"?e.beforeShowMonth:void 0)}updateFocus(){const e=new Date(this.picker.viewDate);this.year=e.getFullYear(),this.focused=e.getMonth()}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((n,r)=>{const a=new Date(r),s=a.getFullYear(),o=a.getMonth();return n[s]===void 0?n[s]=[o]:cM(n[s],o),n},{}),i&&i.dates&&(this.range=i.dates.map(n=>{const r=new Date(n);return isNaN(r)?void 0:[r.getFullYear(),r.getMonth()]}))}render(){this.prepareForRender(this.year,this.year<=this.minYear,this.year>=this.maxYear);const e=this.selected[this.year]||[],i=this.year<this.minYear||this.year>this.maxYear,n=this.year===this.minYear,r=this.year===this.maxYear,a=HJ(this.range,this.year);Array.from(this.grid.children).forEach((s,o)=>{const l=Ry(new Date(this.year,o,1),1,this.isRangeEnd);this.renderCell(s,this.monthNames[o],o,l,{selected:e,range:a},i||n&&o<this.minMonth||r&&o>this.maxMonth)})}refresh(){const e=this.selected[this.year]||[],i=HJ(this.range,this.year)||[];Array.from(this.grid.children).forEach((n,r)=>{this.refreshCell(n,r,e,i)})}refreshFocus(){this.changeFocusedCell(this.focused)}}function rze(t){return[...t].reduce((e,i,n)=>e+=n?i:i.toUpperCase(),"")}class zJ extends j6{constructor(e,i){super(e,i)}init(e,i=!0){i&&(this.navStep=this.step*10,this.beforeShowOption=`beforeShow${rze(this.cellClass)}`,this.grid=this.element,this.element.classList.add(this.name,"datepicker-grid"),this.grid.appendChild(ev(XT("span",12)))),super.init(e)}setOptions(e){if("minDate"in e&&(e.minDate===void 0?this.minYear=this.minDate=void 0:(this.minYear=bS(e.minDate,this.step),this.minDate=JT(this.minYear,0,1))),"maxDate"in e&&(e.maxDate===void 0?this.maxYear=this.maxDate=void 0:(this.maxYear=bS(e.maxDate,this.step),this.maxDate=JT(this.maxYear,11,31))),e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),this.beforeShowOption in e){const i=e[this.beforeShowOption];this.beforeShow=typeof i=="function"?i:void 0}}updateFocus(){const e=new Date(this.picker.viewDate),i=bS(e,this.navStep),n=i+9*this.step;this.first=i,this.last=n,this.start=i-this.step,this.focused=bS(e,this.step)}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((n,r)=>cM(n,bS(r,this.step)),[]),i&&i.dates&&(this.range=i.dates.map(n=>{if(n!==void 0)return bS(n,this.step)}))}render(){this.prepareForRender(`${this.first}-${this.last}`,this.first<=this.minYear,this.last>=this.maxYear),Array.from(this.grid.children).forEach((e,i)=>{const n=this.start+i*this.step,r=Ry(new Date(n,0,1),2,this.isRangeEnd);e.dataset.year=n,this.renderCell(e,n,n,r,this,n<this.minYear||n>this.maxYear)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.textContent),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/this.step))}}function BS(t,e){const i={bubbles:!0,cancelable:!0,detail:{date:t.getDate(),viewDate:new Date(t.picker.viewDate),viewId:t.picker.currentView.id,datepicker:t}};t.element.dispatchEvent(new CustomEvent(e,i))}function ex(t,e){const{config:i,picker:n}=t,{currentView:r,viewDate:a}=n;let s;switch(r.id){case 0:s=Zk(a,e);break;case 1:s=OC(a,e);break;default:s=OC(a,e*r.navStep)}s=Kge(s,i.minDate,i.maxDate),n.changeFocus(s).render()}function ave(t){const e=t.picker.currentView.id;e!==t.config.maxView&&t.picker.changeView(e+1).render()}function sve(t){t.setDate({clear:!0})}function ove(t){const e=T0();t.config.todayButtonMode===1?t.setDate(e,{forceRefresh:!0,viewDate:e}):t.setFocusedDate(e,!0)}function lve(t){const e=()=>{t.config.updateOnBlur?t.update({revert:!0}):t.refresh("input"),t.hide()},i=t.element;QF(i)?i.addEventListener("blur",e,{once:!0}):e()}function qJ(t,e){const i=t.picker,n=new Date(i.viewDate),r=i.currentView.id,a=r===1?Zk(n,e-n.getMonth()):OC(n,e-n.getFullYear());i.changeFocus(a).changeView(r-1).render()}function aze(t){ave(t)}function sze(t){ex(t,-1)}function oze(t){ex(t,1)}function lze(t,e){const i=nve(e,".datepicker-cell");if(!i||i.classList.contains("disabled"))return;const{id:n,isMinView:r}=t.picker.currentView,a=i.dataset;r?t.setDate(Number(a.date)):n===1?qJ(t,Number(a.month)):qJ(t,Number(a.year))}function uze(t){t.preventDefault()}const SV=["left","top","right","bottom"].reduce((t,e)=>(t[e]=`datepicker-orient-${e}`,t),{}),WJ=t=>t&&`${t}px`;function YJ(t,e){if("title"in e&&(e.title?(t.controls.title.textContent=e.title,TP(t.controls.title)):(t.controls.title.textContent="",SP(t.controls.title))),e.prevArrow){const i=t.controls.prevButton;Xk(i),e.prevArrow.forEach(n=>{i.appendChild(n.cloneNode(!0))})}if(e.nextArrow){const i=t.controls.nextButton;Xk(i),e.nextArrow.forEach(n=>{i.appendChild(n.cloneNode(!0))})}if(e.locale&&(t.controls.todayButton.textContent=e.locale.today,t.controls.clearButton.textContent=e.locale.clear),"todayButton"in e&&(e.todayButton?TP(t.controls.todayButton):SP(t.controls.todayButton)),"minDate"in e||"maxDate"in e){const{minDate:i,maxDate:n}=t.datepicker.config;t.controls.todayButton.disabled=!$6(T0(),i,n)}"clearButton"in e&&(e.clearButton?TP(t.controls.clearButton):SP(t.controls.clearButton))}function KJ(t){const{dates:e,config:i,rangeSideIndex:n}=t,r=e.length>0?F6(e):Ry(i.defaultViewDate,i.pickLevel,n);return Kge(r,i.minDate,i.maxDate)}function ZJ(t,e){!("_oldViewDate"in t)&&e!==t.viewDate&&(t._oldViewDate=t.viewDate),t.viewDate=e;const{id:i,year:n,first:r,last:a}=t.currentView,s=new Date(e).getFullYear();switch(i){case 0:return e<r||e>a;case 1:return s!==n;default:return s<r||s>a}}function TV(t){return window.getComputedStyle(t).direction}function uve(t){const e=eve(t);if(!(e===document.body||!e))return window.getComputedStyle(e).overflow!=="visible"?e:uve(e)}let cze=class{constructor(e){const{config:i,inputField:n}=this.datepicker=e,r=QHe.replace(/%buttonClass%/g,i.buttonClass),a=this.element=ev(r).firstChild,[s,o,l]=a.firstChild.children,u=s.firstElementChild,[c,d,p]=s.lastElementChild.children,[h,f]=l.firstChild.children,m={title:u,prevButton:c,viewSwitch:d,nextButton:p,todayButton:h,clearButton:f};this.main=o,this.controls=m;const g=n?"dropdown":"inline";a.classList.add(`datepicker-${g}`),YJ(this,i),this.viewDate=KJ(e),Qk(e,[[a,"mousedown",uze],[o,"click",lze.bind(null,e)],[m.viewSwitch,"click",aze.bind(null,e)],[m.prevButton,"click",sze.bind(null,e)],[m.nextButton,"click",oze.bind(null,e)],[m.todayButton,"click",ove.bind(null,e)],[m.clearButton,"click",sve.bind(null,e)]]),this.views=[new ize(this),new nze(this),new zJ(this,{id:2,name:"years",cellClass:"year",step:1}),new zJ(this,{id:3,name:"decades",cellClass:"decade",step:10})],this.currentView=this.views[i.startView],this.currentView.render(),this.main.appendChild(this.currentView.element),i.container?i.container.appendChild(this.element):n.after(this.element)}setOptions(e){YJ(this,e),this.views.forEach(i=>{i.init(e,!1)}),this.currentView.render()}detach(){this.element.remove()}show(){if(this.active)return;const{datepicker:e,element:i}=this,n=e.inputField;if(n){const r=TV(n);r!==TV(eve(i))?i.dir=r:i.dir&&i.removeAttribute("dir"),this.place(),i.classList.add("active"),e.config.disableTouchKeyboard&&n.blur()}else i.classList.add("active");this.active=!0,BS(e,"show")}hide(){this.active&&(this.datepicker.exitEditMode(),this.element.classList.remove("active"),this.active=!1,BS(this.datepicker,"hide"))}place(){const{classList:e,style:i}=this.element;i.display="block";const{width:n,height:r}=this.element.getBoundingClientRect(),a=this.element.offsetParent;i.display="";const{config:s,inputField:o}=this.datepicker,{left:l,top:u,right:c,bottom:d,width:p,height:h}=o.getBoundingClientRect();let{x:f,y:m}=s.orientation,g=l,v=u;if(a===document.body||!a)g+=window.scrollX,v+=window.scrollY;else{const U=a.getBoundingClientRect();g-=U.left-a.scrollLeft,v-=U.top-a.scrollTop}const y=uve(o);let b=0,I=0,{clientWidth:S,clientHeight:w}=document.documentElement;if(y){const U=y.getBoundingClientRect();U.top>0&&(I=U.top),U.left>0&&(b=U.left),U.right<S&&(S=U.right),U.bottom<w&&(w=U.bottom)}let T=0;f==="auto"&&(l<b?(f="left",T=b-l):l+n>S?(f="right",S<c&&(T=S-c)):TV(o)==="rtl"?f=c-n<b?"left":"right":f="left"),f==="right"&&(g+=p-n),g+=T,m==="auto"&&(u-r>I?m=d+r>w?"top":"bottom":m="bottom"),m==="top"?v-=r:v+=h,e.remove(...Object.values(SV)),e.add(SV[f],SV[m]),i.left=WJ(g),i.top=WJ(v)}setViewSwitchLabel(e){this.controls.viewSwitch.textContent=e}setPrevButtonDisabled(e){this.controls.prevButton.disabled=e}setNextButtonDisabled(e){this.controls.nextButton.disabled=e}changeView(e){const i=this.currentView;return e!==i.id&&(this._oldView||(this._oldView=i),this.currentView=this.views[e],this._renderMethod="render"),this}changeFocus(e){return this._renderMethod=ZJ(this,e)?"render":"refreshFocus",this.views.forEach(i=>{i.updateFocus()}),this}update(e=void 0){const i=e===void 0?KJ(this.datepicker):e;return this._renderMethod=ZJ(this,i)?"render":"refresh",this.views.forEach(n=>{n.updateFocus(),n.updateSelection()}),this}render(e=!0){const{currentView:i,datepicker:n,_oldView:r}=this,a=new Date(this._oldViewDate),s=e&&this._renderMethod||"render";if(delete this._oldView,delete this._oldViewDate,delete this._renderMethod,i[s](),r&&(this.main.replaceChild(i.element,r.element),BS(n,"changeView")),!isNaN(a)){const o=new Date(this.viewDate);o.getFullYear()!==a.getFullYear()&&BS(n,"changeYear"),o.getMonth()!==a.getMonth()&&BS(n,"changeMonth")}}};function cve(t,e,i,n,r,a){if($6(t,r,a)){if(n(t)){const s=e(t,i);return cve(s,e,i,n,r,a)}return t}}function dze(t,e,i){const n=t.picker,r=n.currentView,a=r.step||1;let s=n.viewDate,o;switch(r.id){case 0:s=xC(s,i?e*7:e),o=xC;break;case 1:s=Zk(s,i?e*4:e),o=Zk;break;default:s=OC(s,e*(i?4:1)*a),o=OC}s=cve(s,o,e<0?-a:a,l=>r.disabled.includes(l),r.minDate,r.maxDate),s!==void 0&&n.changeFocus(s).render()}function pze(t,e){const{config:i,picker:n,editMode:r}=t,a=n.active,{key:s,altKey:o,shiftKey:l}=e,u=e.ctrlKey||e.metaKey,c=()=>{e.preventDefault(),e.stopPropagation()};if(s==="Tab"){lve(t);return}if(s==="Enter"){if(!a)t.update();else if(r)t.exitEditMode({update:!0,autohide:i.autohide});else{const m=n.currentView;m.isMinView?t.setDate(n.viewDate):(n.changeView(m.id-1).render(),c())}return}const d=i.shortcutKeys,p={key:s,ctrlOrMetaKey:u,altKey:o,shiftKey:l},h=Object.keys(d).find(m=>{const g=d[m];return!Object.keys(g).find(v=>g[v]!==p[v])});if(h){let m;if(h==="toggle"?m=h:r?h==="exitEditMode"&&(m=h):a?h==="hide"?m=h:h==="prevButton"?m=[ex,[t,-1]]:h==="nextButton"?m=[ex,[t,1]]:h==="viewSwitch"?m=[ave,[t]]:i.clearButton&&h==="clearButton"?m=[sve,[t]]:i.todayButton&&h==="todayButton"&&(m=[ove,[t]]):h==="show"&&(m=h),m){Array.isArray(m)?m[0].apply(null,m[1]):t[m](),c();return}}if(!a||r)return;const f=(m,g)=>{l||u||o?t.enterEditMode():(dze(t,m,g),e.preventDefault())};s==="ArrowLeft"?f(-1,!1):s==="ArrowRight"?f(1,!1):s==="ArrowUp"?f(-1,!0):s==="ArrowDown"?f(1,!0):(s==="Backspace"||s==="Delete"||s&&s.length===1&&!u)&&t.enterEditMode()}function hze(t){t.config.showOnFocus&&!t._showing&&t.show()}function fze(t,e){const i=e.target;(t.picker.active||t.config.showOnClick)&&(i._active=QF(i),i._clicking=setTimeout(()=>{delete i._active,delete i._clicking},2e3))}function mze(t,e){const i=e.target;i._clicking&&(clearTimeout(i._clicking),delete i._clicking,i._active&&t.enterEditMode(),delete i._active,t.config.showOnClick&&t.show())}function gze(t,e){e.clipboardData.types.includes("text/plain")&&t.enterEditMode()}function vze(t,e){const{element:i,picker:n}=t;if(!n.active&&!QF(i))return;const r=n.element;nve(e,a=>a===i||a===r)||lve(t)}function dve(t,e){return t.map(i=>dM(i,e.format,e.locale)).join(e.dateDelimiter)}function pve(t,e,i=!1){if(e.length===0)return i?[]:void 0;const{config:n,dates:r,rangeSideIndex:a}=t,{pickLevel:s,maxNumberOfDates:o}=n;let l=e.reduce((u,c)=>{let d=Iw(c,n.format,n.locale);return d===void 0||(d=Ry(d,s,a),$6(d,n.minDate,n.maxDate)&&!u.includes(d)&&!n.checkDisabled(d,s)&&(s>0||!n.daysOfWeekDisabled.includes(new Date(d).getDay()))&&u.push(d)),u},[]);if(l.length!==0)return n.multidate&&!i&&(l=l.reduce((u,c)=>(r.includes(c)||u.push(c),u),r.filter(u=>!l.includes(u)))),o&&l.length>o?l.slice(o*-1):l}function tx(t,e=3,i=!0,n=void 0){const{config:r,picker:a,inputField:s}=t;if(e&2){const o=a.active?r.pickLevel:r.startView;a.update(n).changeView(o).render(i)}e&1&&s&&(s.value=dve(t.dates,r))}function XJ(t,e,i){const n=t.config;let{clear:r,render:a,autohide:s,revert:o,forceRefresh:l,viewDate:u}=i;a===void 0&&(a=!0),a?s===void 0&&(s=n.autohide):s=l=!1,u=Iw(u,n.format,n.locale);const c=pve(t,e,r);!c&&!o||(c&&c.toString()!==t.dates.toString()?(t.dates=c,tx(t,a?3:1,!0,u),BS(t,"changeDate")):tx(t,l?3:1,!0,u),s&&t.hide())}function JJ(t,e){return e?i=>dM(i,e,t.config.locale):i=>new Date(i)}class hve{constructor(e,i={},n=void 0){e.datepicker=this,this.element=e,this.dates=[];const r=this.config=Object.assign({buttonClass:i.buttonClass&&String(i.buttonClass)||"button",container:null,defaultViewDate:T0(),maxDate:void 0,minDate:void 0},wV(V6,this));let a;if(e.tagName==="INPUT"?(a=this.inputField=e,a.classList.add("datepicker-input"),i.container&&(r.container=i.container instanceof HTMLElement?i.container:document.querySelector(i.container))):r.container=e,n){const c=n.inputs.indexOf(a),d=n.datepickers;if(c<0||c>1||!Array.isArray(d))throw Error("Invalid rangepicker object.");d[c]=this,this.rangepicker=n,this.rangeSideIndex=c}this._options=i,Object.assign(r,wV(i,this)),r.shortcutKeys=JHe(i.shortcutKeys||{});const s=OJ(e.value||e.dataset.date,r.dateDelimiter);delete e.dataset.date;const o=pve(this,s);o&&o.length>0&&(this.dates=o),a&&(a.value=dve(this.dates,r));const l=this.picker=new cze(this),u=[e,"keydown",pze.bind(null,this)];a?Qk(this,[u,[a,"focus",hze.bind(null,this)],[a,"mousedown",fze.bind(null,this)],[a,"click",mze.bind(null,this)],[a,"paste",gze.bind(null,this)],[document,"mousedown",vze.bind(null,this)],[window,"resize",l.place.bind(l)]]):(Qk(this,[u]),this.show())}static formatDate(e,i,n){return dM(e,i,n&&UE[n]||UE.en)}static parseDate(e,i,n){return Iw(e,i,n&&UE[n]||UE.en)}static get locales(){return UE}get active(){return!!(this.picker&&this.picker.active)}get pickerElement(){return this.picker?this.picker.element:void 0}setOptions(e){const i=wV(e,this);Object.assign(this._options,e),Object.assign(this.config,i),this.picker.setOptions(i),tx(this,3)}show(){if(this.inputField){const{config:e,inputField:i}=this;if(i.disabled||i.readOnly&&!e.enableOnReadonly)return;!QF(i)&&!e.disableTouchKeyboard&&(this._showing=!0,i.focus(),delete this._showing)}this.picker.show()}hide(){this.inputField&&(this.picker.hide(),this.picker.update().changeView(this.config.startView).render())}toggle(){this.picker.active?this.inputField&&this.picker.hide():this.show()}destroy(){this.hide(),tve(this),this.picker.detach();const e=this.element;return e.classList.remove("datepicker-input"),delete e.datepicker,this}getDate(e=void 0){const i=JJ(this,e);if(this.config.multidate)return this.dates.map(i);if(this.dates.length>0)return i(this.dates[0])}setDate(...e){const i=[...e],n={},r=F6(e);r&&typeof r=="object"&&!Array.isArray(r)&&!(r instanceof Date)&&Object.assign(n,i.pop());const a=Array.isArray(i[0])?i[0]:i;XJ(this,a,n)}update(e=void 0){if(!this.inputField)return;const i=Object.assign(e||{},{clear:!0,render:!0,viewDate:void 0}),n=OJ(this.inputField.value,this.config.dateDelimiter);XJ(this,n,i)}getFocusedDate(e=void 0){return JJ(this,e)(this.picker.viewDate)}setFocusedDate(e,i=!1){const{config:n,picker:r,active:a,rangeSideIndex:s}=this,o=n.pickLevel,l=Iw(e,n.format,n.locale);l!==void 0&&(r.changeFocus(Ry(l,o,s)),a&&i&&r.changeView(o),r.render())}refresh(e=void 0,i=!1){e&&typeof e!="string"&&(i=e,e=void 0);let n;e==="picker"?n=2:e==="input"?n=1:n=3,tx(this,n,!i)}enterEditMode(){const e=this.inputField;!e||e.readOnly||!this.picker.active||this.editMode||(this.editMode=!0,e.classList.add("in-edit"))}exitEditMode(e=void 0){if(!this.inputField||!this.editMode)return;const i=Object.assign({update:!1},e);delete this.editMode,this.inputField.classList.remove("in-edit"),i.update&&this.update(i)}}function QJ(t){const e=Object.assign({},t);return delete e.inputs,delete e.allowOneSidedRange,delete e.maxNumberOfDates,e}function yze(t,e,i,n){Qk(t,[[i,"changeDate",e]]),new hve(i,n,t)}function DE(t,e){if(t._updating)return;t._updating=!0;const i=e.target;if(i.datepicker===void 0)return;const n=t.datepickers,[r,a]=n,s={render:!1},o=t.inputs.indexOf(i),l=o===0?1:0,u=n[o].dates[0],c=n[l].dates[0];u!==void 0&&c!==void 0?o===0&&u>c?(r.setDate(c,s),a.setDate(u,s)):o===1&&u<c&&(r.setDate(u,s),a.setDate(c,s)):t.allowOneSidedRange||(u!==void 0||c!==void 0)&&(s.clear=!0,n[l].setDate(n[o].dates,s)),n.forEach(d=>{d.picker.update().render()}),delete t._updating}class bze{constructor(e,i={}){let n=Array.isArray(i.inputs)?i.inputs:Array.from(e.querySelectorAll("input"));if(n.length<2)return;e.rangepicker=this,this.element=e,this.inputs=n=n.slice(0,2),Object.freeze(n),this.allowOneSidedRange=!!i.allowOneSidedRange;const r=DE.bind(null,this),a=QJ(i),s=this.datepickers=[];n.forEach(o=>{yze(this,r,o,a)}),Object.freeze(s),Object.defineProperty(this,"dates",{get(){return s.map(o=>o.dates[0])}}),s[0].dates.length>0?DE(this,{target:n[0]}):s[1].dates.length>0&&DE(this,{target:n[1]})}setOptions(e){this.allowOneSidedRange=!!e.allowOneSidedRange;const i=QJ(e);this.datepickers.forEach(n=>{n.setOptions(i)})}destroy(){this.datepickers.forEach(e=>{e.destroy()}),tve(this),delete this.element.rangepicker}getDates(e=void 0){const i=e?n=>dM(n,e,this.datepickers[0].config.locale):n=>new Date(n);return this.dates.map(n=>n===void 0?n:i(n))}setDates(e,i){const{datepickers:[n,r],inputs:[a,s],dates:[o,l]}=this;this._updating=!0,n.setDate(e),r.setDate(i),delete this._updating,r.dates[0]!==l?DE(this,{target:s}):n.dates[0]!==o&&DE(this,{target:a})}}var xg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pM(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var UV={exports:{}},eQ;function Ize(){return eQ||(eQ=1,(function(t){(function(){var e=function(l,u){var c=this;e.count=(e.count||0)+1,this.count=e.count,this.isOpened=!1,this.input=a(l),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-controls","awesomplete_list_"+this.count),this.input.setAttribute("aria-owns","awesomplete_list_"+this.count),this.input.setAttribute("role","combobox"),this.options=u=u||{},n(this,{minChars:2,maxItems:10,autoFirst:!1,data:e.DATA,filter:e.FILTER_CONTAINS,sort:u.sort===!1?!1:e.SORT_BYLENGTH,container:e.CONTAINER,item:e.ITEM,replace:e.REPLACE,tabSelect:!1,listLabel:"Results List",statusNoResults:"No results found",statusXResults:"{0} results found",statusTypeXChar:"Type {0} or more characters for results"},u),this.index=-1,this.container=this.container(l),this.ul=a.create("ul",{hidden:"hidden",role:"listbox",id:"awesomplete_list_"+this.count,inside:this.container,"aria-label":this.listLabel}),this.status=a.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-atomic":!0,inside:this.container,textContent:""}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(d){var p=d.keyCode;c.opened&&(p===13&&c.selected||p===9&&c.selected&&c.tabSelect?(d.preventDefault(),c.select(void 0,void 0,d)):p===27?c.close({reason:"esc"}):(p===38||p===40)&&(d.preventDefault(),c[p===38?"previous":"next"]()))}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(d){d.preventDefault()},click:function(d){var p=d.target;if(p!==this){for(;p&&!/li/i.test(p.nodeName);)p=p.parentNode;p&&d.button===0&&(d.preventDefault(),c.select(p,d.target,d))}}}},a.bind(this.input,this._events.input),a.bind(this.input.form,this._events.form),a.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||u.list||[],e.all.push(this)};e.prototype={set list(l){if(Array.isArray(l))this._list=l;else if(typeof l=="string"&&l.indexOf(",")>-1)this._list=l.split(/\s*,\s*/);else if(l=a(l),l&&l.children){var u=[];r.apply(l.children).forEach(function(c){if(!c.disabled){var d=c.textContent.trim(),p=c.value||d,h=c.label||d;p!==""&&u.push({label:h,value:p})}}),this._list=u}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(l){this.opened&&(this.input.setAttribute("aria-expanded","false"),this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,this.status.setAttribute("hidden",""),this.input.setAttribute("aria-activedescendant",""),a.fire(this.input,"awesomplete-close",l||{}))},open:function(){this.input.setAttribute("aria-expanded","true"),this.ul.removeAttribute("hidden"),this.isOpened=!0,this.status.removeAttribute("hidden"),this.autoFirst&&this.index===-1&&this.goto(0),a.fire(this.input,"awesomplete-open")},destroy:function(){if(a.unbind(this.input,this._events.input),a.unbind(this.input.form,this._events.form),!this.options.container){var l=this.container.parentNode;l.insertBefore(this.input,this.container),l.removeChild(this.container)}this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete"),this.input.removeAttribute("aria-expanded"),this.input.removeAttribute("aria-controls"),this.input.removeAttribute("aria-owns"),this.input.removeAttribute("role");var u=e.all.indexOf(this);u!==-1&&e.all.splice(u,1)},next:function(){var l=this.ul.children.length;this.goto(this.index<l-1?this.index+1:l?0:-1)},previous:function(){var l=this.ul.children.length,u=this.index-1;this.goto(this.selected&&u!==-1?u:l-1)},goto:function(l){var u=this.ul.children;this.selected&&u[this.index].setAttribute("aria-selected","false"),this.index=l,l>-1&&u.length>0&&(u[l].setAttribute("aria-selected","true"),this.input.setAttribute("aria-activedescendant",this.ul.id+"_item_"+this.index),this.ul.scrollTop=u[l].offsetTop-this.ul.clientHeight+u[l].clientHeight,a.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(l,u,c){if(l?this.index=a.siblingIndex(l):l=this.ul.children[this.index],l){var d=this.suggestions[this.index],p=a.fire(this.input,"awesomplete-select",{text:d,origin:u||l,originalEvent:c});p&&(this.replace(d),this.close({reason:"select"}),a.fire(this.input,"awesomplete-selectcomplete",{text:d,originalEvent:c}))}},evaluate:function(){var l=this,u=this.input.value;u.length>=this.minChars&&this._list&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map(function(c){return new i(l.data(c,u))}).filter(function(c){return l.filter(c,u)}),this.sort!==!1&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach(function(c,d){l.ul.appendChild(l.item(c,u,d))}),this.ul.children.length===0?(this.status.textContent=this.statusNoResults,this.close({reason:"nomatches"})):(this.input.setAttribute("aria-activedescendant",""),this.open(),this.status.textContent=this.statusXResults.replaceAll("{0}",this.ul.children.length))):(this.close({reason:"nomatches"}),this.minChar<=1||u.length>=this.minChars?this.status.textContent=this.statusNoResults:this.status.textContent=this.statusTypeXChar.replaceAll("{0}",this.minChars))}},e.all=[],e.FILTER_CONTAINS=function(l,u){return RegExp(a.regExpEscape(u.trim()),"i").test(l)},e.FILTER_STARTSWITH=function(l,u){return RegExp("^"+a.regExpEscape(u.trim()),"i").test(l)},e.SORT_BYLENGTH=function(l,u){return l.length!==u.length?l.length-u.length:l<u?-1:1},e.CONTAINER=function(l){return a.create("div",{className:"awesomplete",around:l})},e.ITEM=function(l,u,c){var d=u.trim()===""?l:l.replace(RegExp(a.regExpEscape(u.trim()),"gi"),"<mark>$&</mark>");return a.create("li",{innerHTML:d,role:"option","aria-selected":"false",tabindex:"-1",id:"awesomplete_list_"+this.count+"_item_"+c})},e.REPLACE=function(l){this.input.value=l.value},e.DATA=function(l){return l};function i(l){var u=Array.isArray(l)?{label:l[0],value:l[1]}:typeof l=="object"&&"label"in l&&"value"in l?l:{label:l,value:l};this.label=u.label||u.value,this.value=u.value}Object.defineProperty(i.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),i.prototype.toString=i.prototype.valueOf=function(){return""+this.label};function n(l,u,c){for(var d in u){var p=u[d],h=l.input.getAttribute("data-"+d.toLowerCase());typeof p=="number"?l[d]=parseInt(h):p===!1?l[d]=h!==null:p instanceof Function?l[d]=null:l[d]=h,!l[d]&&l[d]!==0&&(l[d]=d in c?c[d]:p)}}var r=Array.prototype.slice;function a(l,u){return typeof l=="string"?(u||document).querySelector(l):l||null}function s(l,u){return r.call((u||document).querySelectorAll(l))}a.create=function(l,u){var c=document.createElement(l);for(var d in u){var p=u[d];if(d==="inside")a(p).appendChild(c);else if(d==="around"){var h=a(p);h.parentNode.insertBefore(c,h),c.appendChild(h),h.getAttribute("autofocus")!=null&&h.focus()}else d in c?c[d]=p:c.setAttribute(d,p)}return c},a.bind=function(l,u){if(l)for(var c in u){var d=u[c];c.split(/\s+/).forEach(function(p){l.addEventListener(p,d)})}},a.unbind=function(l,u){if(l)for(var c in u){var d=u[c];c.split(/\s+/).forEach(function(p){l.removeEventListener(p,d)})}},a.fire=function(l,u,c){var d=document.createEvent("HTMLEvents");d.initEvent(u,!0,!0);for(var p in c)d[p]=c[p];return l.dispatchEvent(d)},a.regExpEscape=function(l){return l.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},a.siblingIndex=function(l){for(var u=0;l=l.previousElementSibling;u++);return u};function o(){s("input.awesomplete").forEach(function(l){new e(l)})}return typeof self<"u"&&(self.Awesomplete=e),typeof Document<"u"&&(document.readyState!=="loading"?o():document.addEventListener("DOMContentLoaded",o)),e.$=a,e.$$=s,t.exports&&(t.exports=e),e})()})(UV)),UV.exports}var wze=Ize();const Sze=pM(wze);function Tze({list:t,element:e,callback:i,currentValue:n,withCatchTab:r,onChange:a}){const s=new Sze(e,{list:t});e.parentElement&&(e.parentElement.style.width="100%");let o=!1;const l=u=>{o=!0,Mt(i)&&i(u.text.value),e.value=u.text.label,s.suggestions=[]};if(r){const u=c=>c.key==="Tab"&&c.preventDefault();e.addEventListener("keydown",u,!1),e.addEventListener("keyup",u,!1)}if(typeof a=="function"&&e.addEventListener("change",a),e.setAttribute("autocomplete","off"),e.addEventListener("awesomplete-selectcomplete",u=>l(u),!1),e.addEventListener("keyup",function(u){(u.key==="Enter"||u.key==="Tab")&&!o&&s.suggestions?.length&&(s.next(),s.select(0)),o=!1}),n){const u=t.find(c=>c.value===n)?.label;u&&(e.value=u)}return{typeAhead:s}}function fve(t,e,i,n,r){if(r){const a=e.target.value;r(a)?(n.innerHTML="",n.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(n.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),n.classList.add("is-danger"))}}function G6(t,e){for(const i of e.options){if(i.hide)continue;const n=document.createElement("option");n.className="font-medium",i.value&&n.setAttribute("value",i.value),(i.selected||e.value===i.value)&&n.setAttribute("selected","true"),i.disabled&&n.setAttribute("disabled","true"),n.innerHTML=i.label,t.appendChild(n)}}function UP(t){const e=document.createElement("div");if(e.className="field font-medium",t.class&&e.classList.add(t.class),t.width?e.style.cssText=`width: ${t.width}`:e.style.cssText="flex-grow: 1",t.label&&!t.checkbox){const s=document.createElement("label");s.style.cssText=t.labelStyle||"font-weight: bold; font-size: larger;",s.innerHTML=t.label,e.appendChild(s)}let i,n,r=[];const a=document.createElement("div");if(a.className="control font-medium",t.controlVisible===!1&&(a.style.display=Rt),t.controlId&&(a.id=t.controlId),t.text){const s=document.createElement("div");t.id&&(s.id=t.id),s.className="content",s.innerHTML=t.text,a.appendChild(s)}else if(t.radio){const s=document.createElement("div");s.id=t.id,s.className="control";for(const o of t.options??[]){const l=document.createElement("label");l.className="radio";const u=document.createElement("input");o.field&&r.push({input:u,field:o.field}),o.id&&(u.id=o.id),u.name=t.id,u.type="radio",u.value=o.text,o.checked&&(u.checked=!0),l.appendChild(u),s.appendChild(l);const c=document.createElement("span");c.style.marginLeft=".25em",c.style.marginRight="1em",c.innerHTML=o.text,s.appendChild(c)}a.appendChild(s),i=s}else if(t.options){const s=document.createElement("div");s.className="select font-medium",s.style.cssText="width: 100%",t.zIndex&&(s.style.zIndex=t.zIndex);const o=document.createElement("select");if(t.dataPlaceholder&&o.setAttribute("data-placeholder",t.dataPlaceholder),t.dataType&&o.setAttribute("data-type",t.dataType),t.multiple&&o.setAttribute("multiple","true"),t.disabled&&(o.disabled=!0),t.id&&(s.id=t.id),o.style.cssText="width: 100%",G6(o,t),s.appendChild(o),a.appendChild(s),t.help){const l=document.createElement("p");l.className="help font-medium is-info",l.innerHTML=t.help?.text,l.style.display=t.help?.visible?"":Rt,a.appendChild(l)}i=o,Mt(t.onChange)&&o.addEventListener("change",l=>t.onChange(l,t))}else if(t.checkbox){const s=document.createElement("div");s.className="flexrow nowrap",s.style.display="inline-block";const o=document.createElement("input");Mt(t.onChange)&&o.addEventListener("change",c=>t.onChange(c,t)),i=o;const l=t.intent??"is-success";o.className=`is-checkradio ${l}`,o.type="checkbox",o.id=t.id,t.checked&&(o.checked=!0),s.appendChild(o);const u=document.createElement("label");u.setAttribute("for",t.id),t.color&&(u.style.color=t.color),u.innerHTML=t.label,s.appendChild(u),a.appendChild(s)}else{const s=document.createElement("input");if(s.className="input font-medium",t.class&&s.classList.add(t.class),s.setAttribute("type",t.type||"text"),s.setAttribute("autocomplete",t.autocomplete||"off"),s.setAttribute("placeholder",t.placeholder||""),t.disabled&&s.setAttribute("disabled","true"),t.id&&s.setAttribute("id",t.id),a.appendChild(s),t.iconLeft){a.classList.add("has-icons-left");const l=document.createElement("span");l.className="icon is-small is-left font-medium";const u=document.createElement("i");u.className=t.iconLeft,l.appendChild(u),a.appendChild(l)}if(t.type==="password"){a.classList.add("has-icons-right");const l=document.createElement("span");l.className="icon is-small is-right font-medium";const u=document.createElement("i");u.className=t.iconRight,l.appendChild(u),a.appendChild(l)}i=s;const o=document.createElement("p");if(o.className="help font-medium",a.appendChild(o),t.validator&&s.addEventListener("input",l=>fve(t,l,s,o,t.validator)),t.date){const l=t.maxNumberOfDates||1,u=!t.maxNumberOfDates||l===1;n=new hve(s,{maxDate:t.maxDate,minDate:t.minDate,format:"yyyy-mm-dd",maxNumberOfDates:l,autohide:u})}else t.typeAhead&&Tze({...t.typeAhead,element:s});Mt(t.onKeyDown)&&s.addEventListener("keydown",l=>t.onKeyDown(l,t)),Mt(t.onChange)&&s.addEventListener("change",l=>t.onChange(l,t)),Mt(t.onInput)&&s.addEventListener("input",l=>t.onInput(l,t)),Mt(t.onKeyUp)&&s.addEventListener("keyup",l=>t.onKeyUp(l,t)),t.value!==void 0&&(s.value=t.value),t.selectOnFocus&&s.addEventListener("focus",()=>s.select())}return e.appendChild(a),t.visible===!1&&(e.style.display=Rt),{field:e,inputElement:i,datepicker:n,subFields:r}}function mr(t,e,i){const n=document.createElement("div");n.style.cssText="display: flex; width: 100%;",n.classList.add("flexcol");const r={},a={};let s;for(const o of e){if((o.text||o.html)&&!o.field){const l=o.fieldPair&&document.createElement("div");l&&(l.className="flexrow");const u=document.createElement("div");u.className="flexaligncenter",u.style.cssText=o.style||o.header&&"font-weight: bold; font-size: larger;"||"height: 2.5em; padding-right: 1em;";const c=document.createElement("div");if(o.id&&(c.id=o.id),c.className="content",c.innerHTML=o.text,u.appendChild(c),l){l.appendChild(u);const{field:d,inputElement:p,datepicker:h}=UP(o.fieldPair);h&&(r[`${o.field}.date`]=h),p&&(r[o.fieldPair.field]=p,o.fieldPair.focus&&(s=p)),a[o.fieldPair.field]=d,l.appendChild(d),n.appendChild(l)}else n.appendChild(u);continue}if(o.divider){const l=document.createElement("hr");l.classList.add("dropdown-divider"),n.appendChild(l);continue}if(o.spacer){const l=document.createElement("div"),u=typeof o.spacer=="number"&&`${o.spacer}em`||typeof o.spacer=="string"&&o.spacer||"1em";l.style.marginBlockEnd=u,n.appendChild(l);continue}if(!(!o.label&&!o.field||o.hide)&&o.field){const l=o.fieldPair&&document.createElement("div");l&&(l.className="flexrow");const{field:u,inputElement:c,datepicker:d,subFields:p}=UP(o);if(p&&p.forEach(h=>r[h.field]=h.input),d&&(r[`${o.field}.date`]=d),o.focus&&(s=c),r[o.field]=c,a[o.field]=u,l){l.appendChild(u);const{field:h,inputElement:f,datepicker:m}=UP(o.fieldPair);m&&(r[`${o.field}.date`]=m),f&&(r[o.fieldPair.field]=f,o.fieldPair.focus&&(s=f)),a[o.fieldPair.field]=h,l.appendChild(h),n.appendChild(l)}else n.appendChild(u)}}if(s&&setTimeout(()=>s.focus(),200),t.appendChild(n),i?.length)for(const o of i){if(o.dateRange&&Array.isArray(o.fields)){const[l,u]=o.fields;if(r[l]&&r[u]){const c=new bze(r[l],{inputs:[r[l],r[u]],minDate:o.minDate,maxDate:o.maxDate,format:"yyyy-mm-dd",autohide:!0});r[`${l}.date`]=c}}o.control&&(Mt(o.onChange)&&r[o.control].addEventListener("change",l=>o.onChange({e:l,inputs:r,fields:a})),Mt(o.onInput)&&r[o.control]&&r[o.control].addEventListener("input",l=>o.onInput({e:l,inputs:r,fields:a})),Mt(o.onFocusOut)&&r[o.control]&&r[o.control].addEventListener("focusout",l=>o.onFocusOut({e:l,inputs:r,fields:a})))}return r}var tQ,ea="colors",_u="sizes",gi="space",Uze={gap:gi,gridGap:gi,columnGap:gi,gridColumnGap:gi,rowGap:gi,gridRowGap:gi,inset:gi,insetBlock:gi,insetBlockEnd:gi,insetBlockStart:gi,insetInline:gi,insetInlineEnd:gi,insetInlineStart:gi,margin:gi,marginTop:gi,marginRight:gi,marginBottom:gi,marginLeft:gi,marginBlock:gi,marginBlockEnd:gi,marginBlockStart:gi,marginInline:gi,marginInlineEnd:gi,marginInlineStart:gi,padding:gi,paddingTop:gi,paddingRight:gi,paddingBottom:gi,paddingLeft:gi,paddingBlock:gi,paddingBlockEnd:gi,paddingBlockStart:gi,paddingInline:gi,paddingInlineEnd:gi,paddingInlineStart:gi,top:gi,right:gi,bottom:gi,left:gi,scrollMargin:gi,scrollMarginTop:gi,scrollMarginRight:gi,scrollMarginBottom:gi,scrollMarginLeft:gi,scrollMarginX:gi,scrollMarginY:gi,scrollMarginBlock:gi,scrollMarginBlockEnd:gi,scrollMarginBlockStart:gi,scrollMarginInline:gi,scrollMarginInlineEnd:gi,scrollMarginInlineStart:gi,scrollPadding:gi,scrollPaddingTop:gi,scrollPaddingRight:gi,scrollPaddingBottom:gi,scrollPaddingLeft:gi,scrollPaddingX:gi,scrollPaddingY:gi,scrollPaddingBlock:gi,scrollPaddingBlockEnd:gi,scrollPaddingBlockStart:gi,scrollPaddingInline:gi,scrollPaddingInlineEnd:gi,scrollPaddingInlineStart:gi,fontSize:"fontSizes",background:ea,backgroundColor:ea,backgroundImage:ea,borderImage:ea,border:ea,borderBlock:ea,borderBlockEnd:ea,borderBlockStart:ea,borderBottom:ea,borderBottomColor:ea,borderColor:ea,borderInline:ea,borderInlineEnd:ea,borderInlineStart:ea,borderLeft:ea,borderLeftColor:ea,borderRight:ea,borderRightColor:ea,borderTop:ea,borderTopColor:ea,caretColor:ea,color:ea,columnRuleColor:ea,fill:ea,outline:ea,outlineColor:ea,stroke:ea,textDecorationColor:ea,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:_u,minBlockSize:_u,maxBlockSize:_u,inlineSize:_u,minInlineSize:_u,maxInlineSize:_u,width:_u,minWidth:_u,maxWidth:_u,height:_u,minHeight:_u,maxHeight:_u,flexBasis:_u,gridTemplateColumns:_u,gridTemplateRows:_u,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},Dze=(t,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,hM=()=>{const t=Object.create(null);return(e,i,...n)=>{const r=(a=>JSON.stringify(a,Dze))(e);return r in t?t[r]:t[r]=i(e,...n)}},w_=Symbol.for("sxs.internal"),H6=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),iQ=t=>{for(const e in t)return!0;return!1},{hasOwnProperty:Eze}=Object.prototype,cH=t=>t.includes("-")?t:t.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),Pze=/\s+(?![^()]*\))/,IS=t=>e=>t(...typeof e=="string"?String(e).split(Pze):[e]),nQ={appearance:t=>({WebkitAppearance:t,appearance:t}),backfaceVisibility:t=>({WebkitBackfaceVisibility:t,backfaceVisibility:t}),backdropFilter:t=>({WebkitBackdropFilter:t,backdropFilter:t}),backgroundClip:t=>({WebkitBackgroundClip:t,backgroundClip:t}),boxDecorationBreak:t=>({WebkitBoxDecorationBreak:t,boxDecorationBreak:t}),clipPath:t=>({WebkitClipPath:t,clipPath:t}),content:t=>({content:t.includes('"')||t.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(t)?t:`"${t}"`}),hyphens:t=>({WebkitHyphens:t,hyphens:t}),maskImage:t=>({WebkitMaskImage:t,maskImage:t}),maskSize:t=>({WebkitMaskSize:t,maskSize:t}),tabSize:t=>({MozTabSize:t,tabSize:t}),textSizeAdjust:t=>({WebkitTextSizeAdjust:t,textSizeAdjust:t}),userSelect:t=>({WebkitUserSelect:t,userSelect:t}),marginBlock:IS((t,e)=>({marginBlockStart:t,marginBlockEnd:e||t})),marginInline:IS((t,e)=>({marginInlineStart:t,marginInlineEnd:e||t})),maxSize:IS((t,e)=>({maxBlockSize:t,maxInlineSize:e||t})),minSize:IS((t,e)=>({minBlockSize:t,minInlineSize:e||t})),paddingBlock:IS((t,e)=>({paddingBlockStart:t,paddingBlockEnd:e||t})),paddingInline:IS((t,e)=>({paddingInlineStart:t,paddingInlineEnd:e||t}))},DV=/([\d.]+)([^]*)/,Cze=(t,e)=>t.length?t.reduce((i,n)=>(i.push(...e.map(r=>r.includes("&")?r.replace(/&/g,/[ +>|~]/.test(n)&&/&.*&/.test(r)?`:is(${n})`:n):n+" "+r)),i),[]):e,Rze=(t,e)=>t in Mze&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(i,n,r,a)=>n+(r==="stretch"?`-moz-available${a};${cH(t)}:${n}-webkit-fill-available`:`-moz-fit-content${a};${cH(t)}:${n}fit-content`)+a):String(e),Mze={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},tv=t=>t?t+"-":"",mve=(t,e,i)=>t.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(n,r,a,s,o)=>s=="$"==!!a?n:(r||s=="--"?"calc(":"")+"var(--"+(s==="$"?tv(e)+(o.includes("$")?"":tv(i))+o.replace(/\$/g,"-"):o)+")"+(r||s=="--"?"*"+(r||"")+(a||"1")+")":"")),Nze=/\s*,\s*(?![^()]*\))/,Aze=Object.prototype.toString,eT=(t,e,i,n,r)=>{let a,s,o;const l=(u,c,d)=>{let p,h;const f=m=>{for(p in m){const y=p.charCodeAt(0)===64,b=y&&Array.isArray(m[p])?m[p]:[m[p]];for(h of b){const I=/[A-Z]/.test(v=p)?v:v.replace(/-[^]/g,w=>w[1].toUpperCase()),S=typeof h=="object"&&h&&h.toString===Aze&&(!n.utils[I]||!c.length);if(I in n.utils&&!S){const w=n.utils[I];if(w!==s){s=w,f(w(h)),s=null;continue}}else if(I in nQ){const w=nQ[I];if(w!==o){o=w,f(w(h)),o=null;continue}}if(y&&(g=p.slice(1)in n.media?"@media "+n.media[p.slice(1)]:p,p=g.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(w,T,U,C,E,P)=>{const M=DV.test(T),R=.0625*(M?-1:1),[N,A]=M?[C,T]:[T,C];return"("+(U[0]==="="?"":U[0]===">"===M?"max-":"min-")+N+":"+(U[0]!=="="&&U.length===1?A.replace(DV,(_,x,O)=>Number(x)+R*(U===">"?1:-1)+O):A)+(E?") and ("+(E[0]===">"?"min-":"max-")+N+":"+(E.length===1?P.replace(DV,(_,x,O)=>Number(x)+R*(E===">"?-1:1)+O):P):"")+")"})),S){const w=y?d.concat(p):[...d],T=y?[...c]:Cze(c,p.split(Nze));a!==void 0&&r(rQ(...a)),a=void 0,l(h,T,w)}else a===void 0&&(a=[[],c,d]),p=y||p.charCodeAt(0)!==36?p:`--${tv(n.prefix)}${p.slice(1).replace(/\$/g,"-")}`,h=S?h:typeof h=="number"?h&&I in _ze?String(h)+"px":String(h):mve(Rze(I,h??""),n.prefix,n.themeMap[I]),a[0].push(`${y?`${p} `:`${cH(p)}:`}${h}`)}}var g,v};f(u),a!==void 0&&r(rQ(...a)),a=void 0};l(t,e,i)},rQ=(t,e,i)=>`${i.map(n=>`${n}{`).join("")}${e.length?`${e.join(",")}{`:""}${t.join(";")}${e.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,_ze={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},aQ=t=>String.fromCharCode(t+(t>25?39:97)),HI=t=>(e=>{let i,n="";for(i=Math.abs(e);i>52;i=i/52|0)n=aQ(i%52)+n;return aQ(i%52)+n})(((e,i)=>{let n=i.length;for(;n;)e=33*e^i.charCodeAt(--n);return e})(5381,JSON.stringify(t))>>>0),zE=["themed","global","styled","onevar","resonevar","allvar","inline"],kze=t=>{if(t.href&&!t.href.startsWith(location.origin))return!1;try{return!!t.cssRules}catch{return!1}},xze=t=>{let e;const i=()=>{const{cssRules:r}=e.sheet;return[].map.call(r,(a,s)=>{const{cssText:o}=a;let l="";if(o.startsWith("--sxs"))return"";if(r[s-1]&&(l=r[s-1].cssText).startsWith("--sxs")){if(!a.cssRules.length)return"";for(const u in e.rules)if(e.rules[u].group===a)return`--sxs{--sxs:${[...e.rules[u].cache].join(" ")}}${o}`;return a.cssRules.length?`${l}${o}`:""}return o}).join("")},n=()=>{if(e){const{rules:o,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const u in o)delete o[u]}const r=Object(t).styleSheets||[];for(const o of r)if(kze(o)){for(let l=0,u=o.cssRules;u[l];++l){const c=Object(u[l]);if(c.type!==1)continue;const d=Object(u[l+1]);if(d.type!==4)continue;++l;const{cssText:p}=c;if(!p.startsWith("--sxs"))continue;const h=p.slice(14,-3).trim().split(/\s+/),f=zE[h[0]];f&&(e||(e={sheet:o,reset:n,rules:{},toString:i}),e.rules[f]={group:d,index:l,cache:new Set(h)})}if(e)break}if(!e){const o=(l,u)=>({type:u,cssRules:[],insertRule(c,d){this.cssRules.splice(d,0,o(c,{import:3,undefined:1}[(c.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,c=>c.cssText).join("")}}`:l}});e={sheet:t?(t.head||t).appendChild(document.createElement("style")).sheet:o("","text/css"),rules:{},reset:n,toString:i}}const{sheet:a,rules:s}=e;for(let o=zE.length-1;o>=0;--o){const l=zE[o];if(!s[l]){const u=zE[o+1],c=s[u]?s[u].index:a.cssRules.length;a.insertRule("@media{}",c),a.insertRule(`--sxs{--sxs:${o}}`,c),s[l]={group:a.cssRules[c+1],index:c,cache:new Set([o])}}Oze(s[l])}};return n(),e},Oze=t=>{const e=t.group;let i=e.cssRules.length;t.apply=n=>{try{e.insertRule(n,i),++i}catch{}}},EE=Symbol(),Lze=hM(),Fze=(t,e)=>Lze(t,()=>(...i)=>{let n={type:null,composers:new Set};for(const r of i)if(r!=null)if(r[w_]){n.type==null&&(n.type=r[w_].type);for(const a of r[w_].composers)n.composers.add(a)}else r.constructor!==Object||r.$$typeof?n.type==null&&(n.type=r):n.composers.add($ze(r,t));return n.type==null&&(n.type="span"),n.composers.size||n.composers.add(["PJLV",{},[],[],{},[]]),Bze(t,n,e)}),$ze=({variants:t,compoundVariants:e,defaultVariants:i,...n},r)=>{const a=`${tv(r.prefix)}c-${HI(n)}`,s=[],o=[],l=Object.create(null),u=[];for(const p in i)l[p]=String(i[p]);if(typeof t=="object"&&t)for(const p in t){c=l,d=p,Eze.call(c,d)||(l[p]="undefined");const h=t[p];for(const f in h){const m={[p]:String(f)};String(f)==="undefined"&&u.push(p);const g=h[f],v=[m,g,!iQ(g)];s.push(v)}}var c,d;if(typeof e=="object"&&e)for(const p of e){let{css:h,...f}=p;h=typeof h=="object"&&h||{};for(const g in f)f[g]=String(f[g]);const m=[f,h,!iQ(h)];o.push(m)}return[a,n,s,o,l,u]},Bze=(t,e,i)=>{const[n,r,a,s]=Vze(e.composers),o=typeof e.type=="function"||e.type.$$typeof?(d=>{function p(){for(let h=0;h<p[EE].length;h++){const[f,m]=p[EE][h];d.rules[f].apply(m)}return p[EE]=[],null}return p[EE]=[],p.rules={},zE.forEach(h=>p.rules[h]={apply:f=>p[EE].push([h,f])}),p})(i):null,l=(o||i).rules,u=`.${n}${r.length>1?`:where(.${r.slice(1).join(".")})`:""}`,c=d=>{d=typeof d=="object"&&d||jze;const{css:p,...h}=d,f={};for(const v in a)if(delete h[v],v in d){let y=d[v];typeof y=="object"&&y?f[v]={"@initial":a[v],...y}:(y=String(y),f[v]=y!=="undefined"||s.has(v)?y:a[v])}else f[v]=a[v];const m=new Set([...r]);for(const[v,y,b,I]of e.composers){i.rules.styled.cache.has(v)||(i.rules.styled.cache.add(v),eT(y,[`.${v}`],[],t,T=>{l.styled.apply(T)}));const S=sQ(b,f,t.media),w=sQ(I,f,t.media,!0);for(const T of S)if(T!==void 0)for(const[U,C,E]of T){const P=`${v}-${HI(C)}-${U}`;m.add(P);const M=(E?i.rules.resonevar:i.rules.onevar).cache,R=E?l.resonevar:l.onevar;M.has(P)||(M.add(P),eT(C,[`.${P}`],[],t,N=>{R.apply(N)}))}for(const T of w)if(T!==void 0)for(const[U,C]of T){const E=`${v}-${HI(C)}-${U}`;m.add(E),i.rules.allvar.cache.has(E)||(i.rules.allvar.cache.add(E),eT(C,[`.${E}`],[],t,P=>{l.allvar.apply(P)}))}}if(typeof p=="object"&&p){const v=`${n}-i${HI(p)}-css`;m.add(v),i.rules.inline.cache.has(v)||(i.rules.inline.cache.add(v),eT(p,[`.${v}`],[],t,y=>{l.inline.apply(y)}))}for(const v of String(d.className||"").trim().split(/\s+/))v&&m.add(v);const g=h.className=[...m].join(" ");return{type:e.type,className:g,selector:u,props:h,toString:()=>g,deferredInjector:o}};return H6(c,{className:n,selector:u,[w_]:e,toString:()=>(i.rules.styled.cache.has(n)||c(),n)})},Vze=t=>{let e="";const i=[],n={},r=[];for(const[a,,,,s,o]of t){e===""&&(e=a),i.push(a),r.push(...o);for(const l in s){const u=s[l];(n[l]===void 0||u!=="undefined"||o.includes(u))&&(n[l]=u)}}return[e,i,n,new Set(r)]},sQ=(t,e,i,n)=>{const r=[];e:for(let[a,s,o]of t){if(o)continue;let l,u=0,c=!1;for(l in a){const d=a[l];let p=e[l];if(p!==d){if(typeof p!="object"||!p)continue e;{let h,f,m=0;for(const g in p){if(d===String(p[g])){if(g!=="@initial"){const v=g.slice(1);(f=f||[]).push(v in i?i[v]:g.replace(/^@media ?/,"")),c=!0}u+=m,h=!0}++m}if(f&&f.length&&(s={["@media "+f.join(", ")]:s}),!h)continue e}}}(r[u]=r[u]||[]).push([n?"cv":`${l}-${a[l]}`,s,c])}return r},jze={},Gze=hM(),Hze=(t,e)=>Gze(t,()=>(...i)=>{const n=()=>{for(let r of i){r=typeof r=="object"&&r||{};let a=HI(r);if(!e.rules.global.cache.has(a)){if(e.rules.global.cache.add(a),"@import"in r){let s=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let o of[].concat(r["@import"]))o=o.includes('"')||o.includes("'")?o:`"${o}"`,e.sheet.insertRule(`@import ${o};`,s++);delete r["@import"]}eT(r,[],[],t,s=>{e.rules.global.apply(s)})}}return""};return H6(n,{toString:n})}),zze=hM(),qze=(t,e)=>zze(t,()=>i=>{const n=`${tv(t.prefix)}k-${HI(i)}`,r=()=>{if(!e.rules.global.cache.has(n)){e.rules.global.cache.add(n);const a=[];eT(i,[],[],t,o=>a.push(o));const s=`@keyframes ${n}{${a.join("")}}`;e.rules.global.apply(s)}return n};return H6(r,{get name(){return r()},toString:r})}),Wze=class{constructor(t,e,i,n){this.token=t==null?"":String(t),this.value=e==null?"":String(e),this.scale=i==null?"":String(i),this.prefix=n==null?"":String(n)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+tv(this.prefix)+tv(this.scale)+this.token}toString(){return this.computedValue}},Yze=hM(),Kze=(t,e)=>Yze(t,()=>(i,n)=>{n=typeof i=="object"&&i||Object(n);const r=`.${i=(i=typeof i=="string"?i:"")||`${tv(t.prefix)}t-${HI(n)}`}`,a={},s=[];for(const l in n){a[l]={};for(const u in n[l]){const c=`--${tv(t.prefix)}${l}-${u}`,d=mve(String(n[l][u]),t.prefix,l);a[l][u]=new Wze(u,d,l,t.prefix),s.push(`${c}:${d}`)}}const o=()=>{if(s.length&&!e.rules.themed.cache.has(i)){e.rules.themed.cache.add(i);const l=`${n===t.theme?":root,":""}.${i}{${s.join(";")}}`;e.rules.themed.apply(l)}return i};return{...a,get className(){return o()},selector:r,toString:o}}),Zze=hM(),gve=t=>{let e=!1;const i=Zze(t,n=>{e=!0;const r="prefix"in(n=typeof n=="object"&&n||{})?String(n.prefix):"",a=typeof n.media=="object"&&n.media||{},s=typeof n.root=="object"?n.root||null:globalThis.document||null,o=typeof n.theme=="object"&&n.theme||{},l={prefix:r,media:a,theme:o,themeMap:typeof n.themeMap=="object"&&n.themeMap||{...Uze},utils:typeof n.utils=="object"&&n.utils||{}},u=xze(s),c={css:Fze(l,u),globalCss:Hze(l,u),keyframes:qze(l,u),createTheme:Kze(l,u),reset(){u.reset(),c.theme.toString()},theme:{},sheet:u,config:l,prefix:r,getCssText:u.toString,toString:u.toString};return String(c.theme=c.createTheme(o)),c});return e||i.reset(),i},Xze=()=>tQ||(tQ=gve()),yn=(...t)=>Xze().css(...t);function Jze({variant:t}){return yn({margin:"2.5px 0",variants:{variant:{showAddress:{lineHeight:"2.3em"}}}})({variant:t})}const Qze=yn({justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap",fontWeight:500,display:"flex"}),eqe=yn({textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),tqe=yn({"&::WebkitScrollbar":{display:"none"},justifyContent:"space-between",flexDirection:"column",marginInlineEnd:"0rem",scrollbarWidth:"none",overflowX:"scroll",fontWeight:500,display:"flex",width:"100%",variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}});function iqe({drawPosition:t,sideNumber:e}){return yn({minHeight:"$participant$minHeight",justifyContent:"space-between",paddingInlineStart:"0.75rem",backgroundColor:"$matchUp",paddingInlineEnd:"0rem",boxSizing:"border-box",paddingBottom:".2rem",position:"relative",alignItems:"center",paddingTop:".2rem",minWidth:"15rem",cursor:"pointer",display:"flex",flexGrow:1,"& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}})({sideNumber:e,css:t&&{"&:before":{backgroundColor:"$backgroundColor",content:`${t}`,justifyContent:"center",alignContent:"center",insetInlineStart:-10,position:"absolute",color:"#55AFFE",display:"flex",width:20}}})}function nqe({winnerChevron:t,isDoubles:e}){const i=(e?.4:.3)*2;return yn({variants:{variant:{winner:{"&::before":{borderTop:`${i}rem solid transparent`,borderBottom:`${i}rem solid transparent`,borderInlineStart:"8px solid #008f70",position:"absolute",insetInlineStart:0,display:"block",content:""}}}}})({variant:t?"winner":void 0})}const z6=yn({fontSize:"smaller",color:"gray"});var rqe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vve(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var yve={exports:{}};(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var a="",s=0;s<arguments.length;s++){var o=arguments[s];o&&(a=r(a,n(o)))}return a}function n(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return i.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var s="";for(var o in a)e.call(a,o)&&a[o]&&(s=r(s,o));return s}function r(a,s){return s?a?a+" "+s:a+s:a}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})(yve);var aqe=yve.exports;const Ob=vve(aqe);function sqe({individualParticipant:t,className:e}){var i,n;const{city:r,state:a,countryCode:s}=((n=(i=t?.person)==null?void 0:i.addresses)==null?void 0:n[0])||{},o=[r,a,s].filter(Boolean).join(", ")||" ",l=document.createElement("div");return l.className=Ob(z6(),e),l.innerHTML=o,l}const oqe=yn({willChange:"opacity",position:"fixed",zIndex:9998,bottom:0,right:0,left:0,top:0}),lqe=yn({display:"block"}),uqe=yn({position:"fixed",right:0,left:0}),cqe=yn({paddingRight:"15px",alignItems:"center",margin:"30px auto",paddingLeft:"15px",position:"fixed",height:"100vh",display:"flex",width:"100%",zIndex:9999,bottom:0,right:0,left:0,top:0}),dqe=yn({boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",backgroundColor:"white",position:"relative",borderRadius:"3px",minHeight:"auto",width:"100%"}),pqe=yn({borderBottom:"1px solid rgba(0, 0, 0, 0.1)",alignItems:"center",position:"relative",display:"flex"}),hqe=yn({fontWeight:"600",fontSize:"20px"}),oQ=yn({borderTop:"1px solid rgba(0, 0, 0, 0.1)",justifyContent:"right",alignItems:"center",position:"relative",display:"flex"}),lQ="Nothing to see here";function Md(t){return typeof t=="function"}function S_(t){return typeof t=="string"}function uQ(t){return Array.isArray(t)}function EV(t){return typeof t=="object"&&!Array.isArray(t)}function fqe(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const ix=(()=>{const t=uqe(),e={},i=".5";let n=[],r,a=[],s=[],o;const l=m=>{{const g=s.pop();g&&document.body.removeChild(g)}},u=()=>{o&&(o.style.opacity=0,o.style.display="none")},c=m=>{const g=s.length;if(m&&e[g]===!1)return;const v=a.pop(),y=n.pop();Md(v)&&v({content:y}),document.body.classList.remove(t),document.body.style.top=null,window.scrollTo({top:r,behavior:"instant"}),u(),l()},d=()=>{o=document.createElement("div"),o.className=oqe(),o.id="cmdl-backdrop",o.onclick=()=>c(!0),document.body.appendChild(o)},p=({config:m})=>{r=window.scrollY,document.body.classList.add(t),document.body.style.top=`-${r}px`,o||d(),o.style.display="",m?.backdrop!==!1&&(o.style.backgroundColor="rgba(0, 0, 0, 0.2)",o.style.transition="opacity 0.15s linear",o.style.opacity=1)},h=({config:m,attr:g,attrs:v,unit:y="em",value:b})=>{var I;let S;return S_(g)?S=dH({element:m,attr:g}):uQ(v)&&(S=(I=v.map(w=>dH({element:m,attr:w})).filter(Boolean))==null?void 0:I[0]),S!==void 0&&(b=S),isNaN(b)?b:`${b}${y}`},f=({buttons:m,config:g,modalNumber:v})=>{var y,b;const I=document.createElement("div");I.className=oQ(),I.style.padding=h({config:g,attrs:["footer.padding","padding"],value:i});const S={label:((y=g?.dictionary)==null?void 0:y.close)||"Close",onClick:ix.close,intent:"is-info"};for(const w of m){if(w.hide)continue;const T={...S};EV(w)&&Object.assign(T,w);const U=document.createElement("button");T.disabled!==void 0&&(U.disabled=T.disabled),T.id&&(U.id=T.id),U.className=((b=T?.footer)==null?void 0:b.className)||"button font-medium",U.classList.add(T.intent),U.style="margin-right: .5em;",U.innerHTML=T.label||T.text,U.onclick=C=>{C.stopPropagation(),Md(T.onClick)&&T.onClick({e:C,content:n[v]}),T.close!==!1&&(Md(T.close)&&T.close(),ix.close())},I.appendChild(U)}return I};return{close:c,open:({title:m="",content:g,buttons:v,footer:y,config:b,onClose:I}={})=>{p({config:b}),a.push(I);const S=s.length+1;e[S]=b?.clickAway;const w=document.createElement("section"),T=`cmdl-${S}`;w.className=lqe(),w.role="dialog",w.tabIndex=-1,w.id=T;const U=document.createElement("div");U.className=cqe(),U.style.maxWidth=`${b?.maxWidth||450}px`,U.onclick=()=>c(!0);const C=document.createElement("div");C.className=dqe(),C.onclick=O=>O.stopPropagation();const E=document.createElement("div"),P=document.createElement("div");E.appendChild(P),C.appendChild(E);const M=({title:O,config:$})=>{E.className=O?pqe():"",E.style.padding=h({config:$,attrs:["title.padding","padding"],value:i}),P.className=O?hqe():"",P.innerHTML=O};m&&M({title:m});const R=document.createElement("div");C.appendChild(R);const N=({content:O,config:$})=>{R.style.fontSize=h({config:$,attr:"fontSize",value:"15px"}),R.style.position="relative",R.style.padding=h({config:$,attrs:["content.padding","padding"],value:i}),Md(O)?n[S]=O(R):EV(O)?R.appendChild(O):S_(O)?R.innerHTML=O:R.innerHTML=lQ};if(N({content:g,config:b}),uQ(v))y=f({buttons:v,config:b,modalNumber:S}),C.appendChild(y);else if(y){const O=document.createElement("div");O.className=oQ(),O.style.padding=h({config:b,attrs:["footer.padding","padding"]}),EV(y)?O.appendChild(y):S_(y)?O.innerHTML=y:O.innerHTML=lQ,C.appendChild(O)}U.appendChild(C),w.appendChild(U),document.body.appendChild(w),s.push(w);const A=({content:O,config:$})=>{n[S]=void 0,fqe(R),N({content:O,config:$})},_=({buttons:O,config:$})=>{C.removeChild(y),y=f({buttons:O,config:$,modalNumber:S}),C.appendChild(y)},x=({onClose:O})=>{a.length=0,a.push(O)};return{setContent:A,setButtons:_,update:({content:O,buttons:$,title:F,config:j,onClose:H})=>{b=j||b,O&&A({content:O,config:b}),$&&_({buttons:$,config:b}),H&&x({onClose:H}),F&&M({title:F,config:b})}}}}})();function dH({element:t,attr:e}){if(!S_(e))return;const i=e.split(".");for(const n of i)if(t=t?.[n],!t)return;return t}function mqe({individualParticipant:t,attribute:e,className:i}){const n=t?.person,r=dH({element:n,attr:e});if(!r)return;const a=document.createElement("div");return a.className=Ob(z6(),i),a.innerHTML=r,a}function gqe({individualParticipant:t,className:e}){var i;const n=(i=t?.teams)==null?void 0:i[0],r=n?.participantName||" ",a=document.createElement("div");return a.className=Ob(z6(),e),a.classList.add("tmx-tm"),a.setAttribute("id",n?.participantId),a.innerHTML=r,a}function vqe(t){var e,i,n,r;const a=(i=(e=t?.composition)==null?void 0:e.configuration)==null?void 0:i.participantDetail;if(a==="TEAM")return gqe(t);if(((r=(n=t?.composition)==null?void 0:n.configuration)==null?void 0:r.showAddress)??a==="ADDRESS")return sqe(t);if(a){const s=mqe({...t,attribute:a});if(s)return s}return document.createElement("div")}const yqe=yn({color:"$participant$seed",marginInlineStart:".5rem",textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem"});function bqe({className:t,composition:e,side:i}){const n=i?.seedValue==="~"?"":i?.seedValue!==void 0&&i.seedValue||i?.seedNumber;if(!n)return"";const r=e?.configuration||{},{bracketedSeeds:a}=r,s=typeof a=="boolean"&&["(",")"]||a==="square"&&["[","]"]||["",""],o=`${s[0]}${n}${s[1]}`,l=r.seedingElement==="sup"?"sup":"span",u=document.createElement(l);return u.className=t,u.innerHTML=o,u}const Iqe=yn({WebkitBoxSizing:"border-box",marginInlineEnd:".5em",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"smaller",fontWeight:"bold",borderRadius:2,color:"blue",variants:{color:{green:{color:"green"},red:{color:"red"}}}});function wqe({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r}){var a,s,o,l,u,c,d;const p=e?.configuration,h=((a=p?.scaleAttributes)==null?void 0:a.eventType)||n?.matchUpType||"SINGLES",f=t?.rankings,m=t?.ratings,g=p?.scaleAttributes,v=g?.scaleType,y=g?.scaleName,b=g?.accessor,I=v==="RATING"?m:f,S=(o=(s=I?.SINGLES)==null?void 0:s.find(R=>R?.scaleName===y))==null?void 0:o.scaleValue,w=(u=(l=I?.DOUBLES)==null?void 0:l.find(R=>R?.scaleName===y))==null?void 0:u.scaleValue,T=S&&b?S[b]:S||"",U=w&&b?w[b]:w||"",C=h==="SINGLES"?T:U,E=(c=p?.scaleAttributes)==null?void 0:c.fallback,P=!r&&(C||E&&(T||U)),M=document.createElement("span");return P&&(M.className=Ob(i,Iqe({color:(d=p?.scaleAttributes)==null?void 0:d.scaleColor}))),M.innerHTML=P||"",M}var Sqe=Object.defineProperty,$i=(t,e)=>{for(var i in e)Sqe(t,i,{get:e[i],enumerable:!0})};function e$(){return"2.2.9"}var bve={};$i(bve,{competitionGovernor:()=>Ive,drawsGovernor:()=>mIe,entriesGovernor:()=>PTe,eventGovernor:()=>kTe,generationGovernor:()=>XTe,matchUpFormatGovernor:()=>lUe,matchUpGovernor:()=>uUe,mocksGovernor:()=>BY,participantGovernor:()=>iDe,policyGovernor:()=>QSe,publishingGovernor:()=>DDe,queryGovernor:()=>rTe,reportGovernor:()=>kDe,scheduleGovernor:()=>xDe,scoreGovernor:()=>D9,tieFormatGovernor:()=>WDe,tournamentGovernor:()=>iEe,venueGovernor:()=>mEe});var Ive={};$i(Ive,{getLinkedTournamentIds:()=>MM,getTournamentIds:()=>CM,linkTournaments:()=>dIe,mutate:()=>wve,query:()=>fIe,unlinkTournament:()=>hIe,unlinkTournaments:()=>pIe});var wve={};$i(wve,{linkTournaments:()=>dIe,unlinkTournament:()=>hIe,unlinkTournaments:()=>pIe});var zI="SINGLES",Mn="SINGLES",nb="DOUBLES",En="DOUBLES",hu="TEAM",zn="TEAM",Tqe={SINGLES_MATCHUP:zI,SINGLES:Mn,DOUBLES_MATCHUP:nb,DOUBLES:En,TEAM_MATCHUP:hu,TEAM:zn},Sve={[Mn]:[Mn,"S"],[En]:[En,"D"],[zn]:[zn,"T"],S:[Mn,"S"],D:[En,"D"],T:[zn,"T"]};function ra(t,e){return(t??0)-(e??0)}function ai(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function Gd(t){return isNaN(t)?!1:t&&(t&t-1)===0}function cQ(t){if(!t.length)return;let e=[...t].sort(ra),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function Uqe(t){if(!Gd(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function q6(t){return isNaN(t)?0:t%2&&t+1||t}function W6(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Ir(t){return!isNaN(parseFloat(t))}function Tve(t){let e=ai(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function ED(t){if(isNaN(t))return!1;for(;!Gd(t);)t++;return t}function Lu(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function bi(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function Dqe(t=1,e=3,i=!0){let n=0;for(let r=0;r<e;r++)n+=Math.random()*(t/e);return i&&t>1?Math.round(n):n}function Eqe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function Uve(t,e,i,n,r=2){let a=1-Math.random(),s=1-Math.random(),o=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*s);return o=o/10+.5,o>1||o<0?o=Uve(t,e,i):(o=Math.pow(o,i),o*=e-t,o+=t),n&&(o=Eqe(o,n)),parseFloat(o.toFixed(r))}function nx(t,e=2){return parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function Si(t){return Array.isArray(t)?t?.filter((e,i,n)=>n.lastIndexOf(e)===i):[]}function Pqe(t){return Array.isArray(t)?t?.map(e=>e===null?void 0:e):t}function co(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function QT(t){return bi(t)?t:1/0}function Ol(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function Cqe(t){return Dve(Ol(t))}function Dve(t){return Object.keys(t).reduce((e,i)=>{let n=t[i];return e[n]?e[n].push(i):e[n]=[i],e},{})}function Rqe(t,e,i){return i.indexOf(t)===e}function Eve(t){return t.filter(Rqe)}function wl(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function xc(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Et(t,e){return Array.from({length:e-t},(i,n)=>n+t)}function Cp(t,e){return e.reduce((i,n,r)=>(n===t&&i.push(r),i),[])}function Pr(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,n,r)=>r.indexOf(i)===n)}function dQ(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function yo(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function Mqe(t,e){return Array.isArray(e)&&e.reduce((i,n)=>(i[n]=1+i[n]||1,i),{})[t]||0}function Nqe(t,e,i,n){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(n),...t.slice(e+i,t.length)):[]}function ka(t,e){return Array.isArray(t)?t.reduce((i,n,r)=>{let a=Math.floor(r/e);return i[a]=[].concat(i[a]||[],n),i},[]):[]}function Pve(t,[e,...i]){return t.length?[t.slice(0,e),...Pve(t.slice(e),[...i,e])]:[]}function Aqe(t){return t.reduce((e,i)=>{let n=e[e.length-1];return(!n||n[n.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function Cve(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function Rve(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function pH(t,e,i){return Array.isArray(t)?t.reduce((n,r,a)=>{let s=i?!!(Math.floor(a/e)%2):!1,o=a%e,l=s?e-1-o:o;return n[l]||(n[l]=[]),n[l].push(r),n},[]):[]}function _qe(t,e=1){if(!Array.isArray(t)||!t.every(bi))return[];let i=Math.min(...t,e),n=Math.max(...t);return Et(i,n+1).filter(r=>!t.includes(r))}function bl(t){return typeof t=="function"}function nr(t){return typeof t=="string"}function Qi(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function kqe(t,e){if(!Qi(t)||!Qi(e))return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let r of i)if(t[r]!==e[r])return!1;return!0}function Mve(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(Qi).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var xqe=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function hH(t,e){if(t===void 0)return null;if(!Qi(t)||t===null)return t;let i=Object.keys(t),n=r=>r===void 0?null:r;return Object.assign({},...i.map(r=>Array.isArray(t[r])?{[r]:e?t[r]:t[r].map(a=>hH(a))}:{[r]:e?n(t[r]):hH(t[r])}))}function fH(t){return Array.isArray(t)?t.length+t.map(fH).reduce((e,i)=>e+i,0):Qi(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>fH(t[e])).reduce((e,i)=>e+i,0):0}function Oqe(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=fH(t),n=e.split("").reduce((r,a)=>r+a.charCodeAt(0),0);return[e.length,i,n].map(r=>r.toString(36)).join("")}function t$(t,e){return!Array.isArray(t)||!nr(e)?!1:Pr(t,Sve[e]).length}var ue={success:!0},Nve="error",Lqe={SUCCESS:ue,ERROR:Nve};function Ave({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let r of t){if(typeof r!="object")return i.push(`valueProfile is not type object: ${r}`),{errors:i};let{matchUpValue:a,collectionPosition:s}=r;if(typeof a!="number"||typeof s!="number"||s>e||s<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let n=t.map(r=>r.collectionPosition);return n.length!==Si(n).length?(i.push("collectionPositions are not unique"),{errors:i}):{...ue}}var Fqe={};$i(Fqe,{addNotice:()=>Ui,callListener:()=>UH,createInstanceState:()=>b3e,cycleMutationStatus:()=>w7,deepCopyEnabled:()=>I7,deleteNotice:()=>S7,deleteNotices:()=>bM,disableNotifications:()=>Hye,enableNotifications:()=>D_,getDevContext:()=>mu,getMethods:()=>Wye,getNotices:()=>Yye,getProvider:()=>DH,getTopics:()=>lc,getTournamentId:()=>R0,getTournamentRecord:()=>T7,getTournamentRecords:()=>M0,globalLog:()=>Xye,handleCaughtError:()=>y$,hasTopic:()=>g$,removeTournamentRecord:()=>Zye,setDeepCopy:()=>BC,setDevContext:()=>$C,setGlobalLog:()=>Gye,setGlobalMethods:()=>zye,setGlobalSubscriptions:()=>w3e,setMethods:()=>qye,setStateMethods:()=>Jye,setStateProvider:()=>y3e,setSubscriptions:()=>S3e,setTournamentId:()=>VC,setTournamentRecord:()=>Kye,setTournamentRecords:()=>v$,timeKeeper:()=>I3e});var mH={message:"Chronological error; time violation.",code:"ANACHRONISM"},LC={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},_ve={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},gH={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},gr={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},lt={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},fM={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},eU={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},qI={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},Lt={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},kve={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},fu={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Lb={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},Y6={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},K6={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},tU={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},xve={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},Ove={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},$qe={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},Z6={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},mM={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},i$={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},Bqe={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},PD={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},CD={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},X6={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},n$={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},Lve={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},gM={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Xd={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},Fve={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},$ve={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},Bve={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},Vve={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},jve={message:"Invalid action",code:"ERR_INVALID_ACTION"},vH={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},Gve={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},Hve={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},zve={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},J6={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},qve={message:"Existing round",code:"ERR_EXISTING_ROUND"},Vqe={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},Tu={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},pr={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},Q6={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Fb={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},Wve={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},rf={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Wn={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},Xu={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},Yve={message:"Event exists",code:"ERR_EXISTING_EVENT"},Kve={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},Zve={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},e7={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},Xve={message:"Missing stage",code:"ERR_MISSING_STAGE"},$b={message:"Invalid stage",code:"ERR_INVALID_STAGE"},Jve={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},Qve={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},eye={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},yH={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},vM={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},T_={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},RD={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Oh={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},t7={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},i7={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},tye={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},MD={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},to={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},U0={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},Gs={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Km={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},ol={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},ll={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},n7={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},r$={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},jqe={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},iye={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},r7={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},nye={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},a7={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},Gqe={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},iU={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},Hqe={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},s7={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},zqe={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},a$={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},qqe={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},Wqe={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},D0={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Xt={message:"Missing value",code:"ERR_MISSING_VALUE"},rye={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},aye={message:"Missing date",code:"ERR_MISSING_DATE"},sye={message:"No valid dates",code:"ERR_NO_VALID_DATES"},rx={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},U_={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},oye={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},za={message:"Invalid Date",code:"ERR_INVALID_DATE"},Ec={message:"Invalid time",code:"ERR_INVALID_TIME"},lye={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},bH={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},uye={message:"Invalid score",code:"ERR_INVALID_SCORE"},s$={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},Yqe={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},o7={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},cye={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},o$={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},IH={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},l$={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},E0={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Hd={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},El={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},dye={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},zd={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},pye={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},P0={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},yM={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},da={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Ar={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},hye={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},Kqe={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},fye={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Mv={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},mye={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},gye={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},vye={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},ND={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},u$={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},l7={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},wH={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},yye={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},Zqe={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},Xqe={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},bye={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},Iye={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},SH={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},wye={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},u7={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},Sye={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},c7={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},nU={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},Tye={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},AD={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},Uye={message:"Court exists",code:"ERR_EXISTING_COURT"},Dye={message:"Venue exists",code:"ERR_EXISTING_VENUE"},C0={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},Nv={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},Eye={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},d7={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},Pye={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},Cye={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},Jqe={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},p7={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},Rye={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},h7={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},f7={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},c$={message:"Missing context",code:"ERR_MISSING_CONTEXT"},Mye={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},ww={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},Nye={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},_D={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},Aye={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},d$={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},_ye={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},kye={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Zm={message:"Invalid object",code:"ERR_INVALID_OBJECT"},DP={message:"Invalid gender",code:"ERR_INVALID_GENDER"},FC={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},Ce={message:"Invalid values",code:"ERR_INVALID_VALUES"},xye={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},m7={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},Oye={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},p$={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},g7={message:"Value unchanged",code:"ABORT_UNCHANGED"},Xa={message:"Not found",code:"ERR_NOT_FOUND"},h$={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},Lye={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},v7={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},Fye={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},$ye={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},TH={message:"Existing stage",code:"ERR_EXISTING_STAGE"},y7={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},f$={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},Bye={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},m$={message:"Scores present",code:"ERR_SCORES_PRESENT"},Qqe={ANACHRONISM:mH,CANNOT_CHANGE_WINNING_SIDE:l$,CANNOT_MODIFY_TIEFORMAT:o7,CANNOT_MODIFY_PARTICIPANT_TYPE:cye,CANNOT_REMOVE_MAIN_STRUCTURE:_ve,CANNOT_REMOVE_PARTICIPANTS:o$,CATEGORY_MISMATCH:IH,COURT_EXISTS:Uye,COURT_NOT_FOUND:AD,DRAW_DEFINITION_NOT_FOUND:fu,DRAW_ID_EXISTS:Fve,DRAW_POSITION_ACTIVE:i$,DRAW_POSITION_ASSIGNED:tU,DRAW_POSITION_NOT_CLEARED:Ove,DRAW_POSITION_NOT_FOUND:$qe,DRAW_SIZE_MISMATCH:Lve,DUPLICATE_ENTRY:LC,DUPLICATE_VALUE:xye,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:Iye,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:bye,EVENT_EXISTS:Yve,EVENT_NOT_FOUND:Xu,EXISTING_DRAW_DEFINITIONS:kve,EXISTING_END_TIME:d7,EXISTING_FLIGHT:Lye,EXISTING_MATCHUP_ID:$ye,EXISTING_OUTCOME:Fye,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:ND,EXISTING_PARTICIPANT:u$,EXISTING_POLICY_TYPE:a7,EXISTING_PROFILE:v7,EXISTING_ROUND:qve,EXISTING_STAGE:TH,EXISTING_STRUCTURE:y7,INCOMPATIBLE_MATCHUP_STATUS:T_,INCOMPLETE_SOURCE_STRUCTURE:Y6,INSUFFICIENT_DRAW_POSITIONS:u7,INVALID_ACTION:jve,INVALID_ASSIGNMENT:vH,INVALID_BOOKINGS:rx,INVALID_CATEGORY:FC,INVALID_COLLECTION_DEFINITION:kye,INVALID_CONFIGURATION:_ye,INVALID_DATE_AVAILABILITY:U_,INVALID_DATE:za,INVALID_DRAW_DEFINITION:qI,INVALID_DRAW_POSITION_FOR_SEEDING:K6,INVALID_DRAW_POSITION:PD,INVALID_DRAW_SIZE:n$,INVALID_END_TIME:Eye,INVALID_ENTRIES:Zve,INVALID_EVENT_TYPE:rf,INVALID_GAME_SCORES:bH,INVALID_GENDER:DP,INVALID_MATCHUP_FORMAT:t7,INVALID_MATCHUP_STATUS:RD,INVALID_MATCHUP_STATUS_BYE:eye,INVALID_MATCHUP:ll,INVALID_OBJECT:Zm,INVALID_PARTICIPANT_ID:Hd,INVALID_PARTICIPANT_IDS:El,INVALID_PARTICIPANT_ROLE:dye,INVALID_PARTICIPANT_SEEDING:$ve,INVALID_PARTICIPANT_TYPE:zd,INVALID_PARTICIPANT:E0,INVALID_POLICY_DEFINITION:nye,INVALID_RECORDS:gH,INVALID_SCALE_ITEM:ww,INVALID_SEED_NUMBER:Hve,INVALID_SEED_POSITION:zve,INVALID_SET_NUMBER:zqe,INVALID_SIDE_NUMBER:s7,INVALID_SCORE:uye,INVALID_STAGE:$b,INVALID_START_TIME:Cye,INVALID_STRUCTURE:Lb,INVALID_STOP_TIME:Pye,INVALID_TIE_FORMAT:Oh,INVALID_TIME:Ec,INVALID_TIME_ITEM:p7,INVALID_TOURNAMENT_DATES:lye,INVALID_TOURNAMENT_RECORD:fM,INVALID_VALUES:Ce,INVALID_WINNING_SIDE:s$,MATCHUP_NOT_FOUND:Gs,METHOD_NOT_FOUND:f$,MISSING_ASSIGNMENTS:e7,MISSING_ASYNC_STATE_PROVIDER:Rye,MISSING_AVOIDANCE_POLICY:iye,MISSING_BIRTH_DATE:rye,MISSING_COLLECTION_DEFINITION:tye,MISSING_COURT_ID:D0,MISSING_COURTS_INFO:Tye,MISSING_DATE_AVAILABILITY:oye,MISSING_DATE:aye,MISSING_DRAW_DEFINITION:Lt,MISSING_DRAW_ID:Xd,MISSING_DRAW_POSITION:CD,MISSING_DRAW_POSITIONS:mM,MISSING_DRAW_SIZE:gM,MISSING_ENTRIES:Kve,MISSING_EVENT:Wn,MISSING_MATCHUP_FORMAT:i7,MISSING_MATCHUP_ID:to,MISSING_MATCHUP_IDS:U0,MISSING_MATCHUP:ol,MISSING_MATCHUPS:Km,MISSING_PARTICIPANT_COUNT:mye,MISSING_PARTICIPANT_ID:da,MISSING_PARTICIPANT_IDS:Mv,MISSING_PARTICIPANT_ROLE:pye,MISSING_PARTICIPANT:P0,MISSING_PARTICIPANTS:yM,MISSING_PENALTY_ID:c7,MISSING_PENALTY_TYPE:Sye,MISSING_PERSON_DETAILS:vye,MISSING_POLICY_ATTRIBUTES:r7,MISSING_POLICY_DEFINITION:r$,MISSING_POLICY_TYPE:n7,MISSING_POSITION_ASSIGNMENTS:Qve,MISSING_ROUND_NUMBER:Vqe,MISSING_SCHEDULE:Mye,MISSING_SCORING_POLICY:Hqe,MISSING_SEED_ASSIGNMENTS:Gve,MISSING_SEEDCOUNT_THRESHOLDS:Vve,MISSING_SEEDING_POLICY:jqe,MISSING_SET_NUMBER:qqe,MISSING_SET_OBJECT:a$,MISSING_SIDE_NUMBER:Wqe,MISSING_STAGE:Xve,MISSING_STRUCTURE_ID:Tu,MISSING_STRUCTURE:Fb,MISSING_STRUCTURES:Q6,MISSING_TARGET_LINK:J6,MISSING_TIE_FORMAT:MD,MISSING_TIME_ITEM:h7,MISSING_TIME_ITEMS:f7,MISSING_TOURNAMENT_ID:eU,MISSING_TOURNAMENT_RECORD:lt,MISSING_TOURNAMENT_RECORDS:gr,MISSING_VALUE:Xt,MISSING_VENUE_ID:Nv,MODIFICATIONS_FAILED:Nye,NO_CANDIDATES:d$,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:wye,NO_MODIFICATIONS_APPLIED:_D,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:SH,NO_PARTICIPANT_REMOVED:fye,NO_VALID_ACTIONS:Oye,NO_VALID_ATTRIBUTES:p$,NO_VALID_DATES:sye,NOT_FOUND:Xa,NOT_IMPLEMENTED:h$,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:l7,PARTICIPANT_ID_EXISTS:hye,PARTICIPANT_NOT_CHECKED_IN:gye,PARTICIPANT_NOT_FOUND:Ar,PARTICIPANT_PAIR_EXISTS:Kqe,PENALTY_NOT_FOUND:nU,POLICY_NOT_ATTACHED:Gqe,POLICY_NOT_FOUND:iU,SCHEDULE_NOT_CLEARED:xve,SCHEDULED_MATCHUPS:Bye,SCORES_PRESENT:m$,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:Bve,STAGE_SEQUENCE_LIMIT:Jve,STRUCTURE_NOT_FOUND:pr,TEAM_NOT_FOUND:m7,UNABLE_TO_ASSIGN_COURT:Aye,UNLINKED_STRUCTURES:Wve,UNRECOGNIZED_DRAW_TYPE:Z6,UNRECOGNIZED_MATCHUP_FORMAT:vM,UNRECOGNIZED_MATCHUP_STATUS:yH,VALUE_UNCHANGED:g7,VENUE_EXISTS:Dye},sr={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},Vye={addNotice:d3e,callListener:g3e,cycleMutationStatus:c3e,deleteNotice:f3e,deleteNotices:h3e,disableNotifications:e3e,enableNotifications:t3e,getMethods:b7,getNotices:p3e,getTopics:m3e,getTournamentId:jye,getTournamentRecord:i3e,getTournamentRecords:n3e,removeTournamentRecord:o3e,setMethods:u3e,setSubscriptions:l3e,setTournamentId:a3e,setTournamentRecord:r3e,setTournamentRecords:s3e,handleCaughtError:v3e};function e3e(){sr.disableNotifications=!0}function t3e(){sr.disableNotifications=!1}function jye(){return sr.tournamentId}function i3e(t){return sr.tournamentRecords[t]}function n3e(){return sr.tournamentRecords}function r3e(t){let e=t?.tournamentId;return e?(sr.tournamentRecords[e]=t,{success:!0}):{error:fM}}function a3e(t){return t?sr.tournamentRecords[t]?(sr.tournamentId=t,{success:!0}):{error:lt}:(sr.tournamentId=void 0,{success:!0})}function s3e(t){sr.tournamentRecords=t;let e=Object.keys(t);e.length===1?sr.tournamentId=e[0]:e.length||(sr.tournamentId=void 0)}function o3e(t){if(typeof t!="string")return{error:Ce};if(!sr.tournamentRecords[t])return{error:Xa};delete sr.tournamentRecords[t];let e=Object.keys(sr.tournamentRecords);return e.length===1?sr.tournamentId=e[0]:e.length||(sr.tournamentId=void 0),{success:!0}}function l3e(t){return typeof t.subscriptions!="object"?{error:Ce}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?sr.subscriptions[e]=t.subscriptions[e]:delete sr.subscriptions[e]}),{...ue})}function u3e(t){return typeof t!="object"?{error:Ce}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(sr.methods[e]=t[e])}),{...ue})}function c3e(){let t=sr.modified;return sr.modified=!1,t}function d3e({topic:t,payload:e,key:i},n){if(!(typeof t!="string"||typeof e!="object")&&(sr.disableNotifications||(sr.modified=!0),!(sr.disableNotifications||!sr.subscriptions[t]&&!n)))return i&&(sr.notices=sr.notices.filter(r=>!(r.topic===t&&r.key===i))),sr.notices.push({topic:t,payload:e,key:i}),{...ue}}function b7(){return sr.methods??{}}function p3e({topic:t}){return sr.notices.filter(e=>e.topic===t).map(e=>e.payload)}function h3e(){sr.notices=[]}function f3e({topic:t,key:e}){sr.notices=sr.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function m3e(){return{topics:Object.keys(sr.subscriptions)}}function g3e({topic:t,notices:e},i){let n=sr.subscriptions[t];n&&typeof n=="function"&&n(e);let r=i?.[t];r&&typeof r=="function"&&r(e)}function v3e({engineName:t,methodName:e,params:i,err:n}){let r;return typeof n=="string"?r=n.toUpperCase():n instanceof Error&&(r=n.message),console.log("ERROR",{tournamentId:jye(),params:JSON.stringify(i),engine:t,methodName:e,error:r}),{error:r}}var xn={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Ja=Vye,pQ=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function y3e(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Pr(Object.keys(t),pQ).length!==pQ.length)throw new Error("Global state provider is missing required methods");return Ja=t,{success:!0}}function b3e(){if(Ja.createInstanceState){try{Ja.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:Rye}}function mu(t){return!t||typeof t!="object"?xn.devContext??!1:typeof xn.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=xn.devContext)==null?void 0:i[e])===t[e]})&&xn.devContext}function I3e(t="reset",e="default"){var i,n;let r=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(xn.timers).filter(a=>a!=="default"||xn.timers[a].startTime).map(a=>{let s=xn.timers[a],o=s.state==="stopped"?0:(r-(s?.startTime??0))/1e3,l=s.elapsedTime+o;return{state:xn.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=xn.timers[e].state==="stopped"?0:(r-(((i=xn.timers[e])==null?void 0:i.startTime)??0))/1e3,s=xn.timers[e].elapsedTime+a;return{state:xn.timers[e].state,elapsedTime:s.toFixed(2),timer:e}}}if(!xn.timers[e]||t==="reset"){if(e==="allTimers")return xn.timers={default:{elapsedTime:0}},!0;xn.timers[e]={startTime:r,state:"active",elapsedTime:0}}return xn.timers[e].elapsedTime||(xn.timers[e].elapsedTime=0),t==="stop"&&xn.timers[e].state!=="stopped"&&(xn.timers[e].state="stopped")&&(xn.timers[e].elapsedTime+=(r-(((n=xn.timers[e])==null?void 0:n.startTime)??0))/1e3),t==="start"&&(xn.timers[e].startTime=r)&&(xn.timers[e].state="active"),xn.timers[e]}function Gye(t){bl(t)?xn.globalLog=t:delete xn.globalLog}function $C(t){xn.devContext=t}function Hye(){Ja.disableNotifications()}function D_(){Ja.enableNotifications()}function BC(t,e){typeof t=="boolean"&&(xn.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(xn.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(xn.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(xn.deepCopyAttributes.stringify=e.stringify),e.threshold&&(xn.deepCopyAttributes.threshold=e.threshold))}function I7(){return{enabled:xn.deepCopy,...xn.deepCopyAttributes}}function w3e(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{xn.globalSubscriptions[e]=t.subscriptions[e]}),{...ue}):{error:Xt,info:"missing subscriptions"}}function S3e(t){return t!=null&&t.subscriptions?Ja.setSubscriptions({subscriptions:t.subscriptions}):{error:Xt,info:"missing subscriptions"}}function zye(t){return t?typeof t!="object"?{error:Ce}:(Object.keys(t).forEach(e=>{bl(t[e])&&(xn.globalMethods[e]=t[e])}),{...ue}):{error:Xt,info:"missing method declarations"}}function qye(t){return t?typeof t!="object"?{error:Ce}:Ja.setMethods(t):{error:Xt,info:"missing method declarations"}}function w7(){return Ja.cycleMutationStatus()}function Ui(t){if(typeof t?.topic!="string")return;let e=xn.globalSubscriptions[t.topic];return Ja.addNotice(t,e)}function Wye(){return{...xn.globalMethods,...Ja.getMethods()}}function Yye(t){return Ja.getNotices(t)}function S7({key:t,topic:e}){return Ja.deleteNotice({key:t,topic:e})}function bM(){return Ja.deleteNotices()}function lc(){return Ja.getTopics()}function g$(t){var e,i;return(i=(e=lc())==null?void 0:e.topics)==null?void 0:i.includes(t)}async function UH(t){return Ja.callListener(t,xn.globalSubscriptions)}function R0(){return Ja.getTournamentId()}function T7(t){return Ja.getTournamentRecord(t)}function M0(){return Ja.getTournamentRecords()}function Kye(t){return Ja.setTournamentRecord(t)}function v$(t){return Ja.setTournamentRecords(t)}function VC(t){return Ja.setTournamentId(t)}function Zye(t){return Ja.removeTournamentRecord(t)}function DH(){return Ja}function y$({engineName:t,methodName:e,params:i,err:n}){let r=bl(Ja.handleCaughtError)&&Ja.handleCaughtError||Vye.handleCaughtError,{tournamentRecord:a,...s}=i;return r({params:s,engineName:t,methodName:e,err:n})}function Xye(t,e){if(xn.globalLog)try{xn.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),Gye()}else console.log(e,t)}function Jye(t,e,i,n){if(!Qi(t))return{error:Ce};Ir||(i=1);let r=Array.isArray(e)?e:[],a={},s=(o,l=0)=>{Object.keys(o).forEach(u=>{bl(o[u])?a[u]=o[u]:Qi(o[u])&&(e===!0||r!=null&&r.includes(u))&&(i===void 0||l<i)&&s(o[u],l+1)})};return s(t),n?zye(a):qye(a),{methods:a}}function T3e(t,e,i){return Object.keys(t).filter(n=>!e.includes(t[n])&&(!i||(Array.isArray(t[n])?t[n].length:!0)))}function Gt(t,e,i,n){var r;if(typeof t!="object"||t===null)return t;(r=I7())!=null&&r.enabled||(n=!0);let a=["",void 0,null];e&&a.push(!1);let s=T3e(t,a,i);return Object.assign({},...s.map(o=>Array.isArray(t[o])?{[o]:n?t[o]:t[o].map(l=>Gt(l))}:{[o]:n?t[o]:Gt(t[o])}))}function pe({context:t,result:e,stack:i,info:n}){return e&&!Array.isArray(e?.stack)&&(e.stack=[]),e&&Array.isArray(e?.stack)&&typeof i=="string"&&e.stack.push(i),e&&n&&(e.info=n),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,Gt(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...ue}),e??{success:!0}}var qd="ANY",Un="MALE",ko="MIXED",Iy="OTHER",Gn="FEMALE",U7={ANY:qd,MALE:Un,FEMALE:Gn,MIXED:ko,OTHER:Iy},U3e="MIXED events can not contain mixed singles or { gender: ANY } collections",D3e="events with { gender: ANY } can not contain MIXED singles collections";function b$(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:n,gender:r}=t;return i&&r&&[Un,Gn].includes(i)&&i!==r?pe({result:{valid:!1,error:DP},context:{gender:r},stack:e}):i===ko&&(r===qd||r===ko&&n!==En)?pe({result:{error:DP,valid:!1},info:U3e,stack:e}):i===qd&&r===ko&&n!==En?pe({result:{error:DP,valid:!1},info:D3e,stack:e}):{valid:!0}}var E3e="normal",hQ="timed",P3e="final",D7="NOAD",E_="SET",C3e={S:E3e,F:P3e};function I$(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&t!=null&&t.setFormat)return R3e(t,e)}function jC(t){return!isNaN(Number(t))&&Number(t)}function Qye(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function R3e(t,e){var i;let n=jC(t.bestOf)||void 0,r=jC(t.exactly)||void 0,a=n||r;if((i=t.setFormat)!=null&&i.timed&&t.simplified&&a===1)return Qye(t.setFormat);let s=a&&`${E_}${a}`||"",o=fQ(t.setFormat,e),l=o&&`S:${o}`||"",u=fQ(t.finalSetFormat,e),c=a&&a>1&&u&&o!==u&&`F:${u}`||"";if(s&&o)return[s,l,c].filter(d=>d).join("-")}function fQ(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return Qye(t);if(t.tiebreakSet)return mQ(t.tiebreakSet);let i=jC(t.setTo);if(i){let n=t.NoAD&&D7||"",r=mQ(t.tiebreakFormat),a=r&&`/${r}`||"",s=jC(t.tiebreakAt),o=s&&(s!==i||e)&&`@${s}`||"";if(r!==!1)return`${i}${n}${a}${o}`}}}function mQ(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&jC(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?D7:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function Do(t){if(nr(t)){let e=t.startsWith("T")&&hQ||t.startsWith(E_)&&E_||"";if(e===hQ){let i=tbe(t),n={simplified:!0,setFormat:i,bestOf:1};if(i)return n}if(e===E_)return M3e(t)}}function M3e(t){let e=t.split("-"),i=IM(e[0].slice(3)),n=i===1||i%2!==0?i:void 0,r=i!==1&&i%2===0?i:void 0,a=e&&gQ(e[1]),s=e&&gQ(e[2]),o=a&&a.timed||s&&s.timed,l=n&&n<6||o&&r,u=!e[2]||s,c=a,d=Gt({setFormat:a,exactly:r,bestOf:n});if(s&&(d.finalSetFormat=s),l&&c&&u)return d}function gQ(t){if(t?.[1]===":"){let e=t.split(":"),i=C3e[e[0]],n=e[1];if(i&&n){if(n.startsWith("TB")){let f=vQ(n);return f===!1?!1:typeof f=="object"?{tiebreakSet:f}:void 0}if(n.startsWith("T"))return tbe(n);let r=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=r&&ibe(r[2])||!1,s=!(r!=null&&r[2])||a,o=r?IM(r[1]):void 0,l=ebe(n),u=l!==!1,c=u&&l||o,d=vQ(n.split("/")[1]),p=d!==!1,h={setTo:o};return a&&(h.NoAD=!0),d?(h.tiebreakFormat=d,h.tiebreakAt=c):h.noTiebreak=!0,o&&s&&p&&u&&h||!1}}}function ebe(t,e=!0){let i=t?.indexOf("@")>0&&t.split("@");if(i)return(e?IM(i[1]):i[1])||!1}function vQ(t){if(t)if(t.startsWith("TB")){let e=ebe(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),n=i?.[1],r=i&&ibe(i[2]),a=!(i!=null&&i[2])||r,s=IM(n);if(s&&a){let o={tiebreakTo:s};return e&&typeof e=="string"&&!bi(e)&&(o.modifier=e),r&&(o.NoAD=!0),o}else return!1}else return!1}function tbe(t){var e;let i=t.slice(1),n=i.match(/^(\d+)(@?[A-Za-z]*)/),r=IM(n?.[1]);if(!r)return;let a={timed:!0,minutes:r},s=n?.[2],o=[void 0,"P","G"].includes(s);if(s&&!o){let l=(e=i.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:e[3];return l?(a.modifier=l,a):void 0}return s&&(a.based=n[2]),a}function ibe(t){return t&&t.indexOf(D7)>=0}function IM(t){return isNaN(Number(t))?0:Number(t)}function Ll({matchUpFormat:t}){if(!nr(t)||t==="")return!1;let e=Do(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),n=i?.[1],r=i?.[2],a=i?.[3],s=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),o=s?.[1],l=s?.[2],u=s?.[3];return I$(e,!!(i&&r&&n===a||s&&l&&o===u))===t}var ax=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,nbe=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,Hp=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,wy=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function sx(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Ci(t.scheduledTime)),!e)return;let i=er(t.scheduledTime),n=Ci(e);return n&&i&&(n+=`T${i}`),n}function N3e(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function kD(t){let e=typeof t=="string"?t?.split(" "):[];return t&&e?.length>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||wy.test(N0(t,!0,!0)))}function Pl(t){return rb(t)||ax.test(t)}function A3e(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+3600*e.getHours();return _3e(i,{displaySeconds:!1})}function _3e(t,e){let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),a=i-n*3600-r*60;return(!e||e!=null&&e.displaySeconds?n+":"+r+":"+a:n+":"+r).split(":").map(ju).join(":")}var E7=t=>{let e=GC(t)||rb(t)?new Date(t):new Date,i=e.getUTCMonth()+1,n=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${ju(n)}-${ju(e.getUTCDate())}`};function k3e(t){let e=GC(t)||rb(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Yc(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let n=new Date(t),r=""+(n.getMonth()+1),a=""+n.getDate(),s=n.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),i==="DMY"?[a,r,s].join(e):i==="MDY"?[r,a,s].join(e):i==="YDM"?[s,a,r].join(e):i==="DYM"?[a,s,r].join(e):i==="MYD"?[r,s,a].join(e):[s,r,a].join(e)}function ox(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function x3e(t){return ox(t).getTime()}function GC(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function rU(t,e){if(!Pl(t)||!Pl(e))return[];let i=Ci(t)+"T00:00",n=Ci(e)+"T00:00",r=new Date(i),a=new Date(n),s=GC(a)&&GC(r)&&u(r,a),o=[],l=0;if(s){let c=r,d=c.getTime();for(;d<=a.getTime()&&l<300;)l+=1,o.push(new Date(c)),d=c.setDate(c.getDate()+1)}return o.map(c=>Yc(c));function u(c,d){return c<=d}}var O3e=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function rb(t){return typeof t!="string"?!1:O3e.test(t)}function P7(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(n=>!isNaN(parseInt(n)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function an(t){let e=er(t);if(!e)return 0;let[i,n]=e.split(":").map(r=>parseInt(r));return i*60+n}function L3e(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[ju(e),ju(i)].join(":")}function lx(t){return P7(t)?t.split(":").slice(0,2).map(ju).join(":"):void 0}function er(t){return rb(t)&&t.indexOf("T")>0?lx(t.split("T").reverse()[0]):lx(t)}function Ci(t){return rb(t)||Hp.test(t)?t.split("T")[0]:void 0}function qE(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Ci(i.toISOString())}function ux(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function F3e(t){let e=ux(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(ju).join(":")}function $3e(t){var e;let i=ux(t);if(!(typeof i=="object"&&!Object.keys(i).length))return i.ampm?t:(i.hours>12?(i.hours-=12,i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),((e=i.hours)==null?void 0:e[0])==="0"&&(i.hours=i.hours.slice(1)),`${i.hours||"12"}:${i.minutes||"00"} ${i.ampm}`)}function N0(t,e,i){let n=Ci(t),r=er(t),a=n?r:t;return t?e&&(n&&i&&t||F3e(a))||$3e(a):void 0}function rbe(t,e){let i=ux(t),n=ux(e);if(parseInt(i.hours)<parseInt(n.hours))return-1;if(parseInt(i.hours)>parseInt(n.hours))return 1;if(i.hours===n.hours){if(parseInt(i.minutes)<parseInt(n.minutes))return-1;if(parseInt(i.minutes)>parseInt(n.minutes))return 1}return 0}function C7(t,e=7){let i=Ci(t)+"T00:00",n=new Date(i),r=new Date(n.setDate(n.getDate()+e));return Yc(r)}function B3e(t){return C7(t)}function V3e(t,e,i,n=!1){let r=new Date(e,0,1+(t-1)*7),a=n?0:1;return r.setDate(r.getDate()+(a-r.getDay())),Yc(r,i)}function j3e(t,e,i){let n=new Date(t,0);return Yc(new Date(n.setDate(e)),i)}function qr(t,e=void 0){let[i,n]=(t||"00:00").split(":").map(ju),r=ox(e).setHours(i,n,0,0);return ox(r)}function wM(t,e,i=!0){let n=new Date(t),r=(new Date(e).getTime()-n.getTime())/1e3/60;return i?Math.abs(Math.round(r)):Math.round(r)}function il(t,e){let i=er(t);if(!i)return"00:00";let n=isNaN(e)?0:e;return er(R7(qr(i),n).toISOString())}function R7(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function ju(t){return t.toString()[1]?t:"0"+t}function af(t,e){let i=new Date(t),n=new Date(e);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate()}var abe={addDays:C7,addWeek:B3e,addMinutesToTimeString:il,convertTime:N0,getIsoDateString:sx,getUTCdateString:E7,DateHHMM:A3e,extractDate:Ci,extractTime:er,formatDate:Yc,getDateByWeek:V3e,isISODateString:rb,isDate:GC,isTimeString:P7,offsetDate:ox,offsetTime:x3e,sameDay:af,timeStringMinutes:an,timeToDate:qr,timeUTC:k3e,validTimeValue:kD,validDateString:ax,timeValidation:wy,dateValidation:Hp},G3e=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),H3e=t=>t.filter(Boolean).every(Ir);function Sw(t){let e=t.category;if(typeof e!="object")return{error:FC};let{ageCategoryCode:i,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:s}=e,o=e.categoryName,l;if(!G3e([i,n,r,o],"string")||!H3e([a,s]))return{error:FC};let u=t.consideredDate??Ci(new Date().toLocaleDateString("sv"));if(!Pl(u))return{error:za};let[c]=u.split("-").slice(0,3).map($=>parseInt($)),d=qE(u,-1),[p,h]=d.split("-").slice(1,3).map($=>parseInt($)),f=`${ju(p)}-${ju(h)}`,m=qE(u,1),[g,v]=m.split("-").slice(1,3).map($=>parseInt($)),y=`${ju(g)}-${ju(v)}`,b=s&&qE(u,-1*365*s),I=a&&qE(u,-1*365*a),S=[],w=$=>!S.includes($)&&S.push($);i=i??o;let T=/^([UO]?)(\d{1,2})([UO]?)$/,U=/^C(\d{1,2})-(\d{1,2})$/,C=i?.includes("-"),E=C&&i?.match(U),P=i?.match(T),M=($,F)=>`${$}-${F}`,R=$=>{let F=c-$,j=M(F,y);e.ageMinDate&&e.ageMinDate!==j&&w(`Invalid submitted ageMinDate: ${r}`),r=j,i&&(e.ageMax&&e.ageMax!==$-1&&(w(`Invalid submitted ageMax: ${a}`),I=void 0),a=$-1)},N=$=>{let F=c-$-1,j=M(F,y);e.ageMin&&e.ageMin>$&&w(`Invalid submitted ageMin: ${s}`),e.ageMax&&e.ageMax>$&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==j&&w(`Invalid submitted ageMinDate: ${r}`),r=j,i&&(e.ageMax&&e.ageMax!==$&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=$)},A=$=>{let F=c-$,j=M(F,f);e.ageMaxDate&&e.ageMaxDate!==j&&w(`Invalid submitted ageMaxDate: ${n}`),n=j,i&&(e.ageMin&&e.ageMin!==$+1&&(w(`Invalid submitted ageMin: ${s}`),b=void 0),s=$+1)},_=$=>{let F=c-$-1,j=M(F,f);e.ageMaxDate&&e.ageMaxDate!==j&&w(`Invalid submitted ageMaxDate: ${n}`),n=j,i&&(e.ageMin&&e.ageMin!==$&&(w(`Invalid submitted ageMin: ${s}`),b=void 0),s=$)},x=$=>{let[F,j,H]=($.match(T)||[]).slice(1),G=parseInt(j);F==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),R(G)):F==="O"&&A(G),H==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N(G)):H==="O"&&_(G),n=n??b,r=r??I};if(E){if(n=void 0,r=void 0,a=void 0,s=void 0,e.ageMin){let j=c-e.ageMin;n=M(j,f)}if(e.ageMax){let j=c-e.ageMax-1;r=M(j,y)}let[$,F]=(i?.match(U)??[]).slice(1).map(j=>parseInt(j));$<=F?(s=$,a=F,l=!0):w(`Invalid combined age range ${i}`)}else C?i?.split("-").forEach(x):P?x(i):(s&&A(s),a&&N(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),s=void 0);let O=Gt({consideredDate:u,combinedAge:l,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:s});return S.length&&(O.errors=S),O}function HC({category:t}){if(!Qi(t))return{error:Ce};let e=Sw({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:n}=t;return i&&!Ir(i)?pe({result:{error:Ce},context:{ratingMax:i}}):n&&!Ir(n)?pe({result:{error:Ce},context:{ratingMin:n}}):{...e}}function SM({childCategory:t,withDetails:e,category:i}){let n=HC({category:i}),r=HC({category:t}),a=r.ageMin&&(n.ageMin&&r.ageMin<n.ageMin||n.ageMax&&r.ageMin>n.ageMax),s=r.ageMax&&(n.ageMax&&r.ageMax>n.ageMax||n.ageMin&&r.ageMax<n.ageMin),o=r.ageMinDate&&n.ageMaxDate&&new Date(r.ageMinDate)>new Date(n.ageMaxDate),l=r.ageMaxDate&&n.ageMinDate&&new Date(r.ageMaxDate)<new Date(n.ageMinDate),u=i?.ratingType&&t?.ratingType&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),c=i?.ballType&&t?.ballType&&i.ballType!==t.ballType,d=Gt({invalidRatingRange:u,invalidAgeMinDate:o,invalidAgeMaxDate:l,invalidBallType:c,invalidAgeMax:s,invalidAgeMin:a,valid:!u&&!o&&!l&&!c&&!s&&!a},!0);return e&&Object.assign(d,{categoryDetails:n,childCategoryDetails:r}),d}function TM({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:n=!0,referenceCategory:r,referenceGender:a,event:s}){a=a??s?.gender;let o="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),pe({result:{errors:l,error:Zm},stack:o});let{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,collectionId:p,matchUpCount:h,matchUpFormat:f,matchUpValue:m,matchUpType:g,scoreValue:v,setValue:y,category:b,gender:I}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof h!="number"&&l.push(`matchUpCount is not type number: ${h}`),g&&!t$([Mn,En],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(u!=null&&u.length)].concat([m,d,v,y].map(bi)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),u&&h){let S=Ave({collectionValueProfiles:u,matchUpCount:h});S.errors&&l.push(...S.errors)}if(c&&typeof c!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),f&&!Ll({matchUpFormat:f})&&l.push(`Invalid matchUpFormat: ${f}`),n){let S=b$({referenceGender:a,matchUpType:g,gender:I});if(S.error)return pe({context:{referenceGender:a,gender:I},result:S,stack:o})}if(t&&r&&b){let S=SM({category:r,childCategory:b});if(!S.valid)return pe({result:{error:FC},context:S,stack:o})}return l.length?pe({result:{errors:l,error:kye},stack:o}):{valid:!0}}function Bo(t){var e,i,n,r;let a=!!(t?.enforceCategory!==!1&&t!=null&&t.category),s=!!(t?.enforceGender!==!1&&t!=null&&t.gender),o=t?.checkCollectionIds,l=t?.tieFormat,u=t?.event,c="validateTieFormat",d=[],p=z3e({...t,stack:c});if(p!=null&&p.error)return p;let h,f=l.collectionDefinitions.every(b=>{let{setValue:I,scoreValue:S,collectionValue:w}=b;(I||S)&&!w&&(h=!0);let{valid:T,errors:U}=TM({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:b,checkCollectionIds:o,checkCategory:a,checkGender:s,event:u});return T?!0:(Array.isArray(U)&&d.push(...U),!1)}),m=typeof((e=l.winCriteria)==null?void 0:e.valueGoal)=="number"&&((i=l.winCriteria)==null?void 0:i.valueGoal)>0&&!h||((n=l.winCriteria)==null?void 0:n.aggregateValue);if(!(m||(r=l.winCriteria)!=null&&r.aggregateValue))return h?d.push("aggregateValue is required"):d.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),pe({context:{tieFormat:l,errors:d,aggregateValueImperative:h},result:{error:Oh},stack:c});let g=l.collectionDefinitions.map(({collectionId:b})=>b),v=!o||g.length===Si(g).length,y=f&&m&&v;return y?{valid:y,errors:d}:pe({result:{error:Oh},context:{tieFormat:l,errors:d},stack:c})}function z3e(t){let{tieFormat:e,stack:i}=t;return!t||!e||!Qi(e)?pe({result:{error:Oh},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):Qi(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...ue}:pe({result:{error:Oh},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):pe({result:{error:Oh},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var aU="resourceSubType",sU="resourceType",oU="identifier",q3e={RESOURCE_SUB_TYPE:aU,RESOURCE_TYPE:sU,IDENTIFIER:oU};function At(t,e,i,n,r=0){if(DH().makeDeepCopy)return DH().makeDeepCopy(t,e,i,n);let a=I7(),{stringify:s,toJSON:o,ignore:l,modulate:u}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||bl(t)||t===null||typeof a?.threshold=="number"&&r>=a.threshold)return t;let c=Array.isArray(t)?[]:{},d=Object.keys(t).filter(h=>!i||!l||Array.isArray(l)&&!l.includes(h)||bl(l)&&!l(h)),p=(h,f)=>{c[h]=bl(f?.toString)?f.toString():JSON.stringify(f)};for(let h of d){let f=t[h],m=bl(u)?u(f):void 0;if(m!==void 0)c[h]=m;else if(e&&h==="extensions"&&Array.isArray(f)){let g=M7(f);Object.assign(c,...g)}else n&&h==="extensions"?c[h]=[]:Array.isArray(s)&&s.includes(h)?p(h,f):Array.isArray(o)&&o.includes(h)&&bl(f?.toJSON)?c[h]=f.toJSON():f===null?c[h]=void 0:N3e(f)?c[h]=new Date(f).toISOString():c[h]=At(f,e,i,n,r+1)}return c}function M7(t){return t?.map(e=>{let{name:i,value:n}=e;return i&&n&&{[`_${i}`]:n}}).filter(Boolean)}function sbe(t=1,e){return Et(0,t).map(()=>gn(e))}function gn(t){let e=[];for(let o=0;o<256;o++)e[o]=(o<16?"0":"")+o.toString(16);let i=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0,a=Math.random()*4294967295|0,s=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[n&255]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[r&63|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${s.replace(/-/g,"")}`:s}var obe={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},lbe={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},ube={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},cbe={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},dbe={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},pbe={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},hbe={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},fbe={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},mbe={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},gbe={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Kc="SET3-S:6/TB7",W3e="SET3-S:6NOAD",vbe="SET3-S:6/TB7-F:TB10",Y3e="SET3-S:4/TB7",K3e="SET3-S:4/TB5@3",Z3e="SET1-S:T20",X3e="SET1-S:8/TB7",J3e="SET1-S:8/TB7@7",Q3e={FORMAT_STANDARD:Kc,FORMAT_STANDARD_NOAD:W3e,FORMAT_ATP_DOUBLES:vbe,FORMAT_SHORT_SETS:Y3e,FORMAT_FAST4:K3e,FORMAT_PRO_SET:X3e,FORMAT_COLLEGE_PRO_SET:J3e,TIMED20:Z3e},ybe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},bbe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},Ibe={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},wbe={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},Sbe={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},Tbe={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},Ube={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},cx="COLLEGE_DEFAULT",EH="COLLEGE_JUCO",PH="COLLEGE_D3",Dbe="DOMINANT_DUO",Ebe="DOMINANT_DUO_MIXED",Pbe="LAVER_CUP",Cbe="TEAM_DOUBLES_3_AGGREGATION",Rbe="TIME_TENNIS_DUAL",Mbe="TIME_TENNIS_PRO_CIRCUIT",Nbe="USTA_BREWER_CUP",Abe="USTA_OZAKI_CUP",_be="USTA_COLLEGE",kbe="USTA_GOLD_TEAM_CHALLENGE",xbe="USTA_LEVEL_1",Obe="USTA_INTERSECTIONAL",Lbe="USTA_SECTION_BATTLE",Fbe="USTA_SOUTHERN_LEVEL_5",$be="USTA_TOC",Bbe="USTA_WTT_ITT",Vbe="USTA_ZONAL",eWe={COLLEGE_D3:PH,COLLEGE_DEFAULT:cx,COLLEGE_JUCO:EH,DOMINANT_DUO:Dbe,DOMINANT_DUO_MIXED:Ebe,LAVER_CUP:Pbe,TEAM_DOUBLES_3_AGGREGATION:Cbe,TIME_TENNIS_DUAL:Rbe,TIME_TENNIS_PRO_CIRCUIT:Mbe,USTA_BREWER_CUP:Nbe,USTA_OZAKI_CUP:Abe,USTA_COLLEGE:_be,USTA_GOLD_TEAM_CHALLENGE:kbe,USTA_INTERSECTIONAL:Obe,USTA_LEVEL_1:xbe,USTA_SECTION_BATTLE:Lbe,USTA_SOUTHERN_LEVEL_5:Fbe,USTA_TOC:$be,USTA_WTT_ITT:Bbe,USTA_ZONAL:Vbe},jbe="STANDARD",yQ={[jbe]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[PH]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Kc,matchUpCount:6,matchUpValue:1},tieFormatName:PH,valueGoal:5},[cx]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:Kc,matchUpCount:6,matchUpValue:1},tieFormatName:cx,valueGoal:4},[EH]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Kc,matchUpCount:6,matchUpValue:1},tieFormatName:EH,valueGoal:5},[Pbe]:Tbe,[Dbe]:ybe,[Ebe]:hbe,[Cbe]:lbe,[Rbe]:fbe,[Mbe]:pbe,[Nbe]:mbe,[Abe]:gbe,[_be]:bbe,[kbe]:obe,[Obe]:dbe,[xbe]:Ibe,[Lbe]:cbe,[Fbe]:ube,[Bbe]:wbe,[$be]:Ube,[Vbe]:Sbe},tWe=t=>{let e=t!=null&&t.namedFormat&&Object.keys(yQ).includes(t.namedFormat)?t.namedFormat:jbe,i=Array.isArray(t?.uuids)?t?.uuids:[],n,{category:r,gender:a}=t?.event??{},s=At(yQ[e],!1,!0),o=l=>{var u,c;if(!(t!=null&&t.isMock)&&!((u=t?.event)!=null&&u.isMock)||!t.event)return i?.pop()??gn();let d=(c=t?.event)==null?void 0:c.eventId;return i.pop()??`${d}-COL-${l+1}`};return s.hydrate?(n={winCriteria:{valueGoal:s.valueGoal},collectionDefinitions:[{collectionId:o(0),matchUpFormat:vbe,collectionName:"Doubles",matchUpType:En,...s.doubles},{collectionId:o(1),matchUpFormat:Kc,collectionName:"Singles",matchUpType:Mn,...s.singles}]},s.tieFormatName&&(n.tieFormatName=s.tieFormatName)):(s.collectionDefinitions.forEach((l,u)=>l.collectionId=o(u)),n=s),t!=null&&t.hydrateCollections&&n.collectionDefinitions.forEach(l=>{r&&!l.category&&(l.category=r),a&&!l.gender&&(l.gender=a)}),n},Um=tWe,zp="SINGLES",Tw="SINGLES",Ju="DOUBLES",Dm="DOUBLES",aa="TEAM",Fl="TEAM",iWe="AGE",nWe="RATING",rWe="BOTH",aWe={AGE:iWe,BOTH:rWe,DOUBLES:Ju,DOUBLES_EVENT:Dm,RATING:nWe,SINGLES:zp,SINGLES_EVENT:Tw,TEAM_EVENT:Fl,TEAM:aa},_t="MAIN",Kt="QUALIFYING",Ds="CONSOLATION",qa="VOLUNTARY_CONSOLATION",Tr="PLAY_OFF",w$=[_t,Kt,Ds,Tr,qa],Uw={[Kt]:1,[_t]:2,[Tr]:3,[Ds]:3,[qa]:4},Gbe="finishingPositions",Hbe="aggregateEventStructures",zbe={[_t]:1,[Tr]:2,[Ds]:3,[Kt]:4,[qa]:5},sWe={[Tr]:1,[_t]:2,[Ds]:3,[Kt]:4,[qa]:5},S$="CLUSTER",oWe="SEPARATE",ab="WATERFALL",T$="ITEM",Eo="CONTAINER",Pd="DRAW",U$="RANDOM",Oc="TOP_DOWN",sb="BOTTOM_UP",Em="POSITION",Pm="WINNER",sf="LOSER",qp="FIRST_MATCHUP",gu="AD_HOC",lWe="AD_HOC",xD="FEED_IN",lU="COMPASS",uU="OLYMPIC",uWe="SINGLE_ELIMINATION",Rp="SINGLE_ELIMINATION",UM="DOUBLE_ELIMINATION",cU="FIRST_MATCH_LOSER_CONSOLATION",DM="FIRST_ROUND_LOSER_CONSOLATION",Bb="LUCKY_DRAW",D$="CURTIS_CONSOLATION",cWe="CURTIS_CONSOLATION",N7="FEED_IN_CHAMPIONSHIP_TO_SF",zC="FEED_IN_CHAMPIONSHIP_TO_SF",A7="FEED_IN_CHAMPIONSHIP_TO_QF",qC="FEED_IN_CHAMPIONSHIP_TO_QF",_7="FEED_IN_CHAMPIONSHIP_TO_R16",WC="FEED_IN_CHAMPIONSHIP_TO_R16",qbe="MODIFIED_FEED_IN_CHAMPIONSHIP",YC="MODIFIED_FEED_IN_CHAMPIONSHIP",EM="FEED_IN_CHAMPIONSHIP",dWe="DOUBLE_ROUND_ROBIN",od="ROUND_ROBIN",of="ROUND_ROBIN_WITH_PLAYOFF",Wbe="DECIDER",Ybe="BACKDRAW",k7={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},x7={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},ob="WIN_RATIO",A0="ROUND_OUTCOME",Kbe=[lU,D$,qC,WC,zC,EM,A7,_7,N7,cU,DM,Bb,YC,uU,Tr,of],pWe=[gu,lU,D$,UM,qC,WC,zC,EM,xD,cU,DM,Bb,YC,uU,Tr,od,of,Rp],Zbe={MAIN:_t,QUALIFYING:Kt,CONSOLATION:Ds,ITEM:T$,CONTAINER:Eo,FIRST_MATCHUP:qp,WINNER:Pm,LOSER:sf,AD_HOC:gu,FEED_IN:xD,FLEX_ROUNDS:lWe,COMPASS:lU,PLAY_OFF:Tr,OLYMPIC:uU,KNOCKOUT:uWe,SINGLE_ELIMINATION:Rp,DOUBLE_ELIMINATION:UM,CURTIS:D$,FICSF:N7,FICQF:A7,FICR16:_7,MFIC:qbe,VOLUNTARY_CONSOLATION:qa,FIRST_MATCH_LOSER_CONSOLATION:cU,FIRST_ROUND_LOSER_CONSOLATION:DM,MODIFIED_FEED_IN_CHAMPIONSHIP:YC,FEED_IN_CHAMPIONSHIP_TO_R16:WC,FEED_IN_CHAMPIONSHIP_TO_QF:qC,FEED_IN_CHAMPIONSHIP_TO_SF:zC,FEED_IN_CHAMPIONSHIP:EM,LUCKY_DRAW:Bb,ROUND_ROBIN_WITH_PLAYOFF:of,ROUND_ROBIN:od,DECIDER:Wbe,BACKDRAW:Ybe,COMPASS_ATTRIBUTES:k7,OLYMPIC_ATTRIBUTES:x7,DRAW:Pd,RANDOM:U$,TOP_DOWN:Oc,BOTTOM_UP:sb,WATERFALL:ab,WIN_RATIO:ob,ROUND_OUTCOME:A0,MULTI_STRUCTURE_DRAWS:Kbe,generatedDrawTypes:pWe,stageOrder:Uw,finishOrder:zbe,AGGREGATE_EVENT_STRUCTURES:Hbe,FINISHING_POSITIONS:Gbe},hWe=Zbe,Hs="tournamentRecords",O7="policyDefinitions",Ta="tournamentRecord",L7="onlineResource",Po="drawDefinition",Xbe="tieFormatName",F7="matchUpFormat",lf="participantId",Jbe="scheduleDates",fWe="tournamentId",mWe="scheduleDate",gWe="roundNumber",E$="structureId",$7="participant",PM="matchUpIds",Qbe="entryStage",vWe="policyType",eIe="structures",B7="eventType",ah="matchUpId",P$="tieFormat",C$="inContext",R$="structure",M$="courtIds",yWe="personId",N$="venueIds",V7="matchUps",tIe="courtId",iIe="eventId",yf="matchUp",nIe="drawId",Zc="error",Av="event",OD="param",j7="uuids",bWe="averageMatchUpMinutes",IWe="recoveryMinutes",wWe="periodLength",SWe="number",el="object",Os="array",vs="_validate",rIe="_message",vu="_invalid",Ho="_ofType",G7="_anyOf",dU="_oneOf",bQ={[L7]:t=>Pr(Object.keys(t),[aU,sU,oU]).length===3,[Xbe]:t=>t&&Um({namedFormat:t}),[j7]:t=>!t||Array.isArray(t)&&t.every(nr),[P$]:t=>!Bo({tieFormat:t}).error,[B7]:t=>[zp,Ju,aa].includes(t),[Qbe]:t=>w$.includes(t)},TWe={[Hs]:gr,[Ta]:lt,[O7]:r$,[Po]:Lt,[lf]:da,[F7]:i7,[fWe]:eU,[E$]:Tu,[PM]:U0,[$7]:P0,[L7]:Zm,[B7]:rf,[eIe]:Q6,[ah]:to,[P$]:Oh,[R$]:Fb,[tIe]:D0,[V7]:Km,[iIe]:Xu,[yf]:ol,[M$]:Xt,[N$]:Xt,[nIe]:Xd,[Av]:Wn},UWe={[Hs]:el,[O7]:el,[Ta]:el,[Po]:el,[L7]:el,[Jbe]:Os,[$7]:el,[PM]:Os,[eIe]:Os,[P$]:el,[R$]:el,[M$]:Os,[N$]:Os,[V7]:Os,[yf]:el,[Av]:el,[j7]:Os};function Yt(t,e,i){if(!t&&!Qi(t))return{error:Ce};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:Ce};let{paramError:n,errorParam:r}=PWe(t,e);if(!n)return{valid:!0};let a=n[vs]&&(n[Zc]||n[vu])||t?.[r]===void 0&&(n[Zc]||n[vu]||TWe[r]||Ce)||Ce,s=r??(n[dU]&&Object.keys(n[dU]).join(", "));return pe({info:{param:s,message:n[rIe]},result:{error:a},stack:i})}function aIe(t,e){let i=Object.keys(t),n=Object.keys(e);return Pr(i,n)}function DWe(t,e){if(!e)return;let i=aIe(t,e);return i.length!==1?{error:Ce}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function EWe(t,e){if(!e)return;let i=aIe(t,e).filter(n=>t[n]);return i.length<1?{error:Ce}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function PWe(t,e){let i,n;return{paramError:e.find(({_ofType:r,_oneOf:a,_anyOf:s,_validate:o,_info:l,...u})=>{let c=a&&DWe(t,a);if(c!=null&&c.error)return c.error;c&&Object.assign(u,c);let d=s&&EWe(t,s);if(d!=null&&d.error)return d.error;d&&Object.assign(u,d);let p=Object.keys(u).filter(f=>typeof u[f]=="boolean"),h=p.find(f=>{let m=o&&!bl(o),g=t[f]!==void 0&&!o&&CWe(t,f,r),v=u[f]&&[void 0,null].includes(t[f]),y=m||g||v||o&&t[f]!==void 0&&!RWe(t[f],o)||bQ[f]&&!bQ[f](t[f]);return y&&(i=f,n=l),y});return!p.length||h}),errorParam:i,paramInfo:n}}function CWe(t,e,i){return i=i||UWe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function RWe(t,e){return bl(e)?e(t):!0}var H7="DYNAMIC",iv="RANKING",Vg="RATING",lb="SCALE",Lh="SEEDING",MWe={RANKING:iv,RATING:Vg,SCALE:lb,SEEDING:Lh};function LD(t){var e;let i=Yt(t,[{[$7]:!0}]);if(i.error)return i;let n=(e=t.participant.timeItems)==null?void 0:e.filter(({itemType:a})=>a?.startsWith(lb)&&[iv,Vg,Lh].includes(a.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(n!=null&&n.length){let a=o=>n.filter(l=>l?.itemType===o).sort((l,u)=>new Date(l.createdAt||void 0).getTime()-new Date(u.createdAt||void 0).getTime()).pop(),s=Si(n.map(({itemType:o})=>o));for(let o of s){let l=a(o);if(l){let[,u,c,d,p]=l.itemType.split("."),h=p?`${d}.${p}`:d,f=u===Lh&&"seedings"||u===iv&&"rankings"||"ratings";r[f][c]||(r[f][c]=[]),r[f][c].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:h})}}}return{...ue,...r}}function Dw(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let n={};return r(e,i,n),n;function r(a,s,o){if(!a||!s)return;let l=Object.keys(a),u=Object.keys(s),c=Object.assign({},...u.filter(h=>h.indexOf("||")).map(h=>h.split("||").map(f=>({[f]:h}))).flat()),d=u.concat(...Object.keys(c)),p=d.includes("*");for(let h of l)if(d.indexOf(h)>=0||p){let f=c[h]||h,m=s[f]||p,g=a[h];if(typeof m=="object"&&typeof g!="function"&&!Array.isArray(m))if(Array.isArray(g)){let v=g.map(y=>{let b={};return r(y,m,b)!==!1?b:void 0}).filter(Boolean);o[h]=v}else g&&(o[h]={},r(g,m,o[h]));else{let v=a[h];if(Array.isArray(m)&&!m.includes(v))return!1;(s[h]||p&&s[h]!==!1)&&(o[h]=v)}}}}var CH="voluntaryConsolation",Yf="competitiveBands",z7="roundRobinTally",Cm="positionActions",Wa="matchUpActions",P_="rankingPoints",pU="roundNaming",FD="participant",KC="progression",_v="scheduling",ZC="avoidance",NWe="participant",AWe="display",Qu="scoring",Rc="seeding",hU="feedIn",_We="audit",dx="draws",kWe={POLICY_TYPE_VOLUNTARY_CONSOLATION:CH,POLICY_TYPE_COMPETITIVE_BANDS:Yf,POLICY_TYPE_ROUND_ROBIN_TALLY:z7,POLICY_TYPE_POSITION_ACTIONS:Cm,POLICY_TYPE_MATCHUP_ACTIONS:Wa,POLICY_TYPE_RANKING_POINTS:P_,POLICY_TYPE_ROUND_NAMING:pU,POLICY_TYPE_PARTICIPANT:FD,POLICY_TYPE_PROGRESSION:KC,POLICY_TYPE_SCHEDULING:_v,POLICY_TYPE_AVOIDANCE:ZC,POLICY_TYPE_DISPLAY:AWe,POLICY_TYPE_PRIVACY:NWe,POLICY_TYPE_FEED_IN:hU,POLICY_TYPE_SCORING:Qu,POLICY_TYPE_SEEDING:Rc,POLICY_TYPE_AUDIT:_We,POLICY_TYPE_DRAWS:dx};function nv({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:n,internalUse:r,personId:a}){let s=t.find(l=>n&&l.participantId===n||a&&l.person&&l.person.personId===a),o=At(s,!1,r);if(o){let l=e?.[FD];if(i!=null&&i.withScaleValues){let{ratings:u,rankings:c}=LD({participant:o});o.rankings=c,o.ratings=u}if(l!=null&&l.participant)return Dw({template:l.participant,source:o})}return o}var xWe="element required",OWe="missing name";function po(t){if(!t||typeof t!="object")return{error:Xt};if(t.element&&typeof t?.element!="object")return{error:Ce};if(!(t!=null&&t.name))return{error:Xt,info:OWe};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],n=po({element:i,name:t.name});if(n.error)return pe({result:n,stack:"removeExtension"})}return{...ue}}return{error:Xt,info:xWe}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>e?.name!==t.name),{...ue}):{...ue,info:Xa}}function Wp({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(n=>i.includes(n)).length===t.length}function dn(t){if(typeof t!="object")return{error:Xt};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return pe({result:{error:Ce},stack:e});if(!Wp({extension:t.extension}))return pe({result:{error:Ce,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let n of Object.values(t.tournamentRecords)){let r=dn({extension:t.extension,element:n});if(r.error)return pe({result:r,stack:e})}return{...ue}}else return pe({result:{error:Xt},stack:e});if(t.element.extensions||(t.element.extensions=[]),t?.creationTime??!0){let n=new Date().toISOString();Object.assign(t.extension,{createdAt:n})}let i=t.element.extensions.find(({name:n})=>n===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...ue}}function q7(t){return!t||typeof t!="object"?{error:Xt}:t.tournamentRecord?dn({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:lt}}function A$(t){return!t||typeof t!="object"?{error:Xt}:t.drawDefinition?dn({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:fu}}function kv(t){return!t||typeof t!="object"?{error:Xt}:t.event?dn({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:Xu}}function sIe(t){var e;if(!t||typeof t!="object")return{error:Xt};if(!t.participantId)return{error:da};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],n=nv({participantId:t.participantId,tournamentParticipants:i});return n?dn({creationTime:t.creationTime,extension:t.extension,element:n}):{error:Ar}}function W7(t){return!t||typeof t!="object"?{error:Xt}:t.tournamentRecord?po({element:t.tournamentRecord,name:t.name}):{error:lt}}function oIe(t){return!t||typeof t!="object"?{error:Xt}:t.drawDefinition?po({element:t.drawDefinition,name:t.name}):{error:fu}}function _$(t){return!t||typeof t!="object"?{error:Xt}:t!=null&&t.event?po({element:t.event,name:t.name}):{error:Xu}}function lIe(t){var e;if(!t||typeof t!="object")return{error:Xt};if(!t.participantId)return{error:da};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],n=nv({participantId:t.participantId,tournamentParticipants:i});return n?po({element:n,name:t.name}):{error:Ar}}function CM({tournamentRecords:t}){return{tournamentIds:Qi(t)?Object.keys(t):[],...ue}}var LWe="extensionQueries";function ki({discover:t,element:e,name:i,...n}){var r;if(!e||!i){if(t&&n){let s=Object.keys(n).filter(u=>typeof t=="boolean"||Array.isArray(t)&&t.includes(u)).find(u=>{var c;return Array.isArray((c=n[u])==null?void 0:c.extensions)?n[u].extensions.find(d=>d?.name===i):!1}),o=s&&n[s];!o&&n.tournamentRecords&&(o=Object.values(n.tournamentRecords).find(u=>{var c;return(c=u.extensions)==null?void 0:c.length}));let l=(r=o?.extensions)==null?void 0:r.find(u=>u?.name===i);return{extension:l,info:l?void 0:Xa}}return pe({result:{error:Xt},stack:LWe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let a=e.extensions.find(s=>s?.name===i);return{extension:a,info:a?void 0:Xa}}var FWe="activeSuspension",XC="appliedPolicies",uIe="context",k$="delegatedOutcome",Od="disabled",Ew="disableAutoCalc",x$="disableLinks",px="display",My="drawDeletions",$We="drawProfile",hx="entryProfile",BWe="eventProfile",VWe="eventWithdrawalRequests",jWe="factory",ld="flightProfile",RH="groupingAttribute",Rm="lineUps",ub="linkedTournamentsIds",O$="matchUpHistory",Y7="participantRepresentatives",$D="personRequests",mT="positionActions",GWe="rankingPoints",HWe="registration",sh="roundTarget",RM="scheduleLimits",Mm="scheduleTiming",Pw="schedulingProfile",zWe="statusDetail",fU="subOrder",rv="tally",EP="tieFormatModification",cIe={ACTIVE_SUSPENSION:FWe,APPLIED_POLICIES:XC,CONTEXT:uIe,DELEGATED_OUTCOME:k$,DISABLED:Od,DISABLE_LINKS:x$,DISABLE_AUTO_CALC:Ew,DISPLAY:px,DRAW_DELETIONS:My,DRAW_PROFILE:$We,ENTRY_PROFILE:hx,EVENT_PROFILE:BWe,EVENT_WITHDRAWAL_REQUESTS:VWe,FLIGHT_PROFILE:ld,GROUPING_ATTRIBUTE:RH,LINEUPS:Rm,LINKED_TOURNAMENTS:ub,MATCHUP_HISTORY:O$,PARTICIPANT_REPRESENTATIVES:Y7,PERSON_REQUESTS:$D,POSITION_ACTIONS:mT,RANKING_POINTS:GWe,REGISTRATION:HWe,ROUND_TARGET:sh,SCHEDULE_LIMITS:RM,SCHEDULE_TIMING:Mm,SCHEDULING_PROFILE:Pw,STATUS_DETAIL:zWe,SUB_ORDER:fU,TALLY:rv,TIE_FORMAT_MODIFICATIONS:EP,FACTORY:jWe},IQ=[k$,Od,Ew,x$,ld,Rm,ub,O$,Y7,$D,sh,RM,Mm,Pw,fU,rv,EP];function dIe({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:gr};let e=CM({tournamentRecords:t}),{tournamentIds:i}=e;return i?.length>1?dn({tournamentRecords:t,discover:!0,extension:{name:ub,value:{tournamentIds:i}}}):{...ue}}function pIe({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:gr};let e=po({name:ub,tournamentRecords:t,discover:!0});return pe({result:e,stack:"unlinkTournaments"})}function hIe({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:Ce};if(!e)return{error:eU};let i=CM({tournamentRecords:t}),{tournamentIds:n}=i;if(!n.includes(e))return{error:eU};let r;return n.every(a=>{var s;let o=t[a],{extension:l}=ki({element:o,name:ub});if(!l)return!0;let u=((s=l?.value)==null?void 0:s.tournamentIds)||[];if(!(u!=null&&u.length)||u.length===1&&u.includes(e)||a===e){let p=W7({name:ub,tournamentRecord:o});return p.error&&(r=p.error),p.success}let c=u.filter(p=>p!==e);l.value={tournamentIds:c};let d=q7({tournamentRecord:o,extension:l});return d.error&&(r=d.error),d.success}),r?{error:r}:{...ue}}var fIe={};$i(fIe,{getLinkedTournamentIds:()=>MM,getTournamentIds:()=>CM});function MM({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:gr}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var i;let n=t[e],r=n?.tournamentId,{extension:a}=ki({element:n,name:ub}),s=(((i=a?.value)==null?void 0:i.tournamentIds)||[]).filter(o=>o!==r);return{[e]:s}}))}}var mIe={};$i(mIe,{adHocPositionSwap:()=>s0e,addAdHocMatchUps:()=>cB,addDrawDefinitionTimeItem:()=>K8,addFinishingRounds:()=>zM,addGoesTo:()=>pb,addPlayoffStructures:()=>uB,addQualifyingStructure:()=>a0e,addVoluntaryConsolationStage:()=>Qwe,addVoluntaryConsolationStructure:()=>L8,allPlayoffPositionsFilled:()=>W8,alternateDrawPositionAssignment:()=>jwe,assignDrawPosition:()=>A0e,assignDrawPositionBye:()=>Eu,attachConsolationStructures:()=>C0e,attachPlayoffStructures:()=>p9,attachQualifyingStructure:()=>Y8,attachStructures:()=>lB,autoSeeding:()=>H9e,automatedPlayoffPositioning:()=>WD,automatedPositioning:()=>tN,checkValidEntries:()=>hB,deleteAdHocMatchUps:()=>k0e,drawMatic:()=>x9,findDrawDefinition:()=>v9,generateAdHocMatchUps:()=>fB,generateAdHocRounds:()=>k9,generateAndPopulatePlayoffStructures:()=>c9,generateDrawDefinition:()=>bN,generateDrawMaticRound:()=>U9,generateDrawStructuresAndLinks:()=>w9,generateDrawTypeAndModifyDrawDefinition:()=>S9,generateQualifyingStructure:()=>t9,generateVoluntaryConsolation:()=>aSe,getAssignedParticipantIds:()=>Yb,getAvailableMatchUpsCount:()=>dB,getAvailablePlayoffProfiles:()=>nN,getDrawDefinitionTimeItem:()=>f8,getDrawParticipantRepresentativeIds:()=>m9,getDrawStructures:()=>ud,getDrawTypeCoercion:()=>dN,getEligibleVoluntaryConsolationParticipants:()=>f9,getMatchUpsMap:()=>Cs,getParticipantIdFinishingPositions:()=>g9,getPositionAssignments:()=>r1,getPositionsPlayedOff:()=>YD,getSeedingThresholds:()=>V8,getSeedsCount:()=>pN,getStructureSeedAssignments:()=>ec,getTeamLineUp:()=>db,getValidGroupSizes:()=>QM,isAdHoc:()=>Vo,isCompletedStructure:()=>uv,isValidForQualifying:()=>I9,luckyLoserDrawPositionAssignment:()=>xwe,modifyDrawDefinition:()=>R0e,modifyDrawName:()=>h9,modifySeedAssignment:()=>Gwe,mutate:()=>gIe,positionActions:()=>b9,pruneDrawDefinition:()=>N0e,qualifierDrawPositionAssignment:()=>Vwe,query:()=>L0e,removeDrawPositionAssignment:()=>i1,removeRoundMatchUps:()=>x0e,removeSeededParticipant:()=>r0e,removeStructure:()=>Xwe,renameStructures:()=>Zwe,resetDrawDefinition:()=>M0e,resetVoluntaryConsolationStructure:()=>_Ie,setDrawParticipantRepresentativeIds:()=>vIe,setPositionAssignments:()=>$we,setStructureOrder:()=>Ywe,setSubOrder:()=>O0e,shiftAdHocRounds:()=>Fwe,swapAdHocRounds:()=>Bwe,swapDrawPositionAssignments:()=>i0e,updateTeamLineUp:()=>q0,withdrawParticipantAtDrawPosition:()=>Pwe});var gIe={};$i(gIe,{adHocPositionSwap:()=>s0e,addAdHocMatchUps:()=>cB,addDrawDefinitionTimeItem:()=>K8,addPlayoffStructures:()=>uB,addQualifyingStructure:()=>a0e,addVoluntaryConsolationStage:()=>Qwe,addVoluntaryConsolationStructure:()=>L8,alternateDrawPositionAssignment:()=>jwe,assignDrawPosition:()=>A0e,assignDrawPositionBye:()=>Eu,attachConsolationStructures:()=>C0e,attachPlayoffStructures:()=>p9,attachQualifyingStructure:()=>Y8,attachStructures:()=>lB,automatedPlayoffPositioning:()=>WD,automatedPositioning:()=>tN,deleteAdHocMatchUps:()=>k0e,luckyLoserDrawPositionAssignment:()=>xwe,modifyDrawDefinition:()=>R0e,modifyDrawName:()=>h9,modifySeedAssignment:()=>Gwe,pruneDrawDefinition:()=>N0e,qualifierDrawPositionAssignment:()=>Vwe,removeDrawPositionAssignment:()=>i1,removeRoundMatchUps:()=>x0e,removeSeededParticipant:()=>r0e,removeStructure:()=>Xwe,renameStructures:()=>Zwe,resetDrawDefinition:()=>M0e,resetVoluntaryConsolationStructure:()=>_Ie,setDrawParticipantRepresentativeIds:()=>vIe,setPositionAssignments:()=>$we,setStructureOrder:()=>Ywe,setSubOrder:()=>O0e,shiftAdHocRounds:()=>Fwe,swapAdHocRounds:()=>Bwe,swapDrawPositionAssignments:()=>i0e,updateTeamLineUp:()=>q0,withdrawParticipantAtDrawPosition:()=>Pwe});var K7=t=>e=>t[e],Z7=(t=[])=>t.map(Na).filter(Boolean),MH=(t=[])=>t.map(Gi).filter(Boolean),Gi=(t={})=>K7(t)("participantId"),Na=(t={})=>K7(t)("matchUpId"),JC=(t={})=>K7(t)("drawId");function vIe({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:fu};if(!Array.isArray(t))return{error:Ce};let i=MH(e?.entries||[]);return t.length&&Pr(t,i).length<t.length?{error:Ce}:A$({drawDefinition:e,extension:{name:Y7,value:t}})}var ul="ABANDONED",_0="AWAITING_RESULT",fn="BYE",oh="CANCELLED",kr="COMPLETED",BD="DEAD_RUBBER",Wi="DEFAULTED",oa="DOUBLE_DEFAULT",jr="DOUBLE_WALKOVER",vd="IN_PROGRESS",$l="INCOMPLETE",X7="NOT_PLAYED",os="RETIRED",xv="SUSPENDED",Or="TO_BE_PLAYED",ln="WALKOVER",qWe=[_0,kr,Wi,vd,$l,os,xv],yIe=[_0,kr,Wi,jr,oa,vd,$l,os,xv,ln],bIe=[ul,_0,fn,oh,kr,BD,Wi,jr,oa,vd,$l,X7,os,xv,Or,ln],IIe=[fn,jr,oa,kr,Wi,os,ln],wIe=[ul,_0,oh,BD,vd,$l,X7,xv,Or,void 0],wa=[oh,ul,kr,BD,Wi,jr,oa,os,ln],J7=[ul,kr,Wi,jr,oa,vd,os,ln],SIe=[vd,$l,xv,Or],TIe={ABANDONED:ul,AWAITING_RESULT:_0,BYE:fn,CANCELLED:oh,COMPLETED:kr,DEAD_RUBBER:BD,DEFAULTED:Wi,DOUBLE_WALKOVER:jr,DOUBLE_DEFAULT:oa,IN_PROGRESS:vd,INCOMPLETE:$l,NOT_PLAYED:X7,RETIRED:os,SUSPENDED:xv,TO_BE_PLAYED:Or,WALKOVER:ln};function k0(t,e,i){var n,r;let a=h=>{var f,m;return(m=(f=ki({element:h,name:sh}))==null?void 0:f.extension)==null?void 0:m.value},s=i?.deprioritizeCompleted,o=i?.mode===Hbe&&sWe,l=i?.mode===Gbe&&zbe,u=l||o||Uw,c=h=>h?.stage===_t&&h?.stageSequence===1,d=h=>c(h)?-1:u[h?.stage],p=h=>h?.matchUps.every(({matchUpStatus:f})=>wa.includes(f)?1:-1);return s&&p(t)-p(e)||o&&d(t)-d(e)||(t?.stage&&u[t.stage]||0)-(e?.stage&&u[e.stage]||0)||(a(t)||0)-(a(e)||0)||!l&&!o&&(((n=e?.positionAssignments)==null?void 0:n.length)??1/0)-(((r=t?.positionAssignments)==null?void 0:r.length)??1/0)||(t?.stageSequence??0)-(e?.stageSequence??0)||(fx(t)||0)-(fx(e)||0)}function fx(t){return(t?.matchUps||[]).reduce((e,i)=>{var n;let r=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((a,s)=>a+s,0);return!e||r<e?r:e},void 0)}function ui(t){let e=Yt(t,[{[Po]:!0,[E$]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:n}=t,{structures:r}=ud({drawDefinition:i}),a=r?.map(l=>l.structures?[...l.structures].concat(l):l).flat(),s=a?.find(l=>l.structureId===n);if(!s)return{error:pr};let o=s.structureType===T$?a?.find(l=>{var u;return(u=l.structures)==null?void 0:u.some(c=>c.structureId===n)}):void 0;return{structure:s,containingStructure:o}}function ud({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:n,roundTarget:r,sortConfig:a,stages:s,stage:o}){var l;let u=!e&&Lt||!(e!=null&&e.structures)&&Q6||void 0;if(u)return{error:u,structures:[],stageStructures:{}};let c=m=>{var g,v;let y=(v=(g=ki({element:m,name:sh}))==null?void 0:g.extension)==null?void 0:v.value;return!r||r===y},d=((l=e?.structures)==null?void 0:l.filter(h).filter(f).filter(c).sort((m,g)=>k0(m,g,a)))??[],p=t?Object.assign({},...w$.map(m=>{let g=d?.filter(v=>v.stage===m);return g?.length&&{[m]:g}}).filter(Boolean)):{};return{structures:d,stageStructures:p};function h(m){return!o&&!Array.isArray(s)||o&&m.stage===o||Array.isArray(s)&&s.includes(m.stage)}function f(m){return!n&&!Array.isArray(i)||n&&m.stageSequence===n||Array.isArray(i)&&i.includes(m.stageSequence)}}function UIe({drawDefinition:t}){if(!t)return{error:Lt};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let n=i.stage;e[n]||(e[n]=[]);let{positionAssignments:r}=Fn({structure:i}),a=r?.map(Gi).filter(Boolean)??[];return e[n].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Fn({drawDefinition:t,structureId:e,structure:i}){let n,r=[];if(!i){if(!t)return{positionAssignments:r,error:Lt};if({structure:i,error:n}=ui({drawDefinition:t,structureId:e}),n)return{positionAssignments:r,error:n}}return i.structures?r=[].concat(...i.structures.map(a=>Fn({structure:a}).positionAssignments)):i.positionAssignments?r=i.positionAssignments:n=Qve,{positionAssignments:r,error:n}}function xa({drawDefinition:t,structureId:e,structure:i}){var n;let r=((n=Fn({drawDefinition:t,structureId:e,structure:i}))==null?void 0:n.positionAssignments)||[],a=r?.filter(c=>c.participantId??c.bye??c.qualifier),s=r&&r?.length===a?.length,o=r?.filter(c=>!c.participantId&&!c.bye&&!c.qualifier),l=r?.filter(c=>!c.participantId&&c.bye),u=r?.filter(c=>!c.participantId&&c.qualifier);return{allPositionsAssigned:s,positionAssignments:r,unassignedPositions:o,assignedPositions:a,qualifierPositions:u,byePositions:l}}var Q7="addDrawDefinition",L$="addMatchUps",av="addParticipants",e8="addScaleItems",DIe="addEvent",EIe="addVenue",rm="audit",t8="dataIssue",i8="deleteParticipants",n8="deleteVenue",r8="deletedDrawIds",a8="deletedMatchUpIds",s8="modifyDrawDefinition",PIe="modifyDrawEntries",CIe="modifyEventEntries",o8="modifyMatchUp",Es="modifyParticipants",l8="modifyPositionAssignments",u8="modifySeedAssignments",Vb="modifyTournamentDetail",jb="modifyVenue",NH="mutations",AH="publishEvent",RIe="publishEventSeeding",MIe="publishOrderOfPlay",NIe="publishParticipants",c8="unPublishEvent",d8="unPublishEventSeeding",p8="unPublishOrderOfPlay",WWe="unPublishParticipants",F$="updateInContextMatchUp",YWe={ADD_DRAW_DEFINITION:Q7,ADD_MATCHUPS:L$,ADD_PARTICIPANTS:av,ADD_SCALE_ITEMS:e8,ADD_EVENT:DIe,ADD_VENUE:EIe,AUDIT:rm,DATA_ISSUE:t8,DELETE_PARTICIPANTS:i8,DELETE_VENUE:n8,DELETED_DRAW_IDS:r8,DELETED_MATCHUP_IDS:a8,MODIFY_DRAW_DEFINITION:s8,MODIFY_DRAW_ENTRIES:PIe,MODIFY_EVENT_ENTRIES:CIe,MODIFY_MATCHUP:o8,MODIFY_PARTICIPANTS:Es,MODIFY_POSITION_ASSIGNMENTS:l8,MODIFY_SEED_ASSIGNMENTS:u8,MODIFY_TOURNAMENT_DETAIL:Vb,MODIFY_VENUE:jb,MUTATIONS:NH,PUBLISH_EVENT_SEEDING:RIe,PUBLISH_EVENT:AH,PUBLISH_ORDER_OF_PLAY:MIe,PUBLISH_PARTICIPANTS:NIe,UNPUBLISH_EVENT_SEEDING:d8,UNPUBLISH_EVENT:c8,UNPUBLISH_ORDER_OF_PLAY:p8,UPDATE_INCONTEXT_MATCHUP:F$};function $$(t,e){var i;if(!t)return{error:Lt};let n=Date.now();t.updatedAt&&n===new Date(t.updatedAt).getTime()&&(n+=1);let r=new Date(n).toISOString(),a=e?.filter(Boolean);return t.updatedAt=r,(i=t.structures)==null||i.filter(Boolean).forEach(s=>{(!(a!=null&&a.length)||a!=null&&a.includes(s.structureId))&&(s.updatedAt=r)}),{...ue}}function sv({drawDefinition:t,tournamentId:e,matchUps:i,eventId:n}){return t&&$$(t),Ui({payload:{matchUps:i,tournamentId:e,eventId:n},topic:L$}),{...ue}}function Xm({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:n,action:r}){t&&$$(t),Ui({topic:a8,payload:{tournamentId:e,matchUpIds:i,eventId:n,action:r}});for(let a of i)S7({key:a});return{...ue}}function Xi({drawDefinition:t,tournamentId:e,structureId:i,context:n,eventId:r,matchUp:a}){return a?(t&&Bn({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:r}),Ui({topic:o8,payload:{matchUp:a,tournamentId:e,context:n},key:a.matchUpId}),{...ue}):(console.log(ol),{error:ol})}function KWe({tournamentId:t,inContextMatchUp:e}){return e?(Ui({payload:{inContextMatchUp:e,tournamentId:t},topic:F$,key:e.matchUpId}),{...ue}):{error:ol}}function NM({tournamentId:t,eventId:e,drawDefinition:i}){return i?($$(i),Ui({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:Q7,key:i.drawId}),{...ue}):(console.log(Lt),{error:Lt})}function ZWe({tournamentId:t,eventId:e,drawId:i}){return Ui({payload:{drawId:i,tournamentId:t,eventId:e},topic:r8,key:i}),S7({key:i}),{...ue}}function Bn({drawDefinition:t,tournamentId:e,structureIds:i,eventId:n}){return t?($$(t,i),Ui({payload:{tournamentId:e,eventId:n,drawDefinition:t},topic:s8,key:t.drawId}),{...ue}):{error:Lt}}function AIe({drawDefinition:t,tournamentId:e,structure:i,eventId:n}){if(!t)return{error:Lt};if(!i)return{error:Fb};let r=i.seedAssignments,a=i.structureId,s=t.drawId;return Ui({payload:{tournamentId:e,eventId:n,drawId:s,structureId:a,seedAssignments:r},topic:u8,key:t.drawId}),Bn({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:n}),{...ue}}function ov({drawDefinition:t,tournamentId:e,structure:i,event:n}){if(!t)return{error:Lt};if(!i)return{error:Fb};let r=Fn({structure:i}),a=i.structureId,s=t.drawId,o=n?.eventId;return Ui({topic:l8,payload:{positionAssignments:r,tournamentId:e,structureId:a,eventId:o,drawId:s},key:a}),Bn({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:o}),{...ue}}function _Ie({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:n}){var r,a;if(!e)return{error:Lt};let s=(r=e.structures)==null?void 0:r.find(l=>l.stage===qa);if(!s)return{error:pr};let o=((a=s.matchUps)==null?void 0:a.map(({matchUpId:l})=>l))||[];return s.positionAssignments=[],s.seedAssignments=[],s.matchUps=[],Xm({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:o,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==qa)),Bn({tournamentId:t?.tournamentId,eventId:n?.eventId,drawDefinition:e,structureIds:[s.structureId]}),{...ue}}function h8({drawPositions:t,structure:e}){var i;if([Kt,_t].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:n}=Fn({structure:e});(i=n?.filter(({drawPosition:r})=>t?.includes(r)))==null||i.forEach(r=>{dn({element:r,extension:{name:x$,value:!0}})})}function B$(t){var e,i;let{appliedPolicies:n,positionAction:r,drawDefinition:a}=t;if(((e=n?.audit)==null?void 0:e[mT])===!1)return;let{extension:s}=ki({name:mT,element:a}),o=Array.isArray(s?.value)?s?.value??[]:[];if(!(o!=null&&o.length)){let u=a.structures.find(c=>c.stage===_t);if(u){let c=(i=Fn({structure:u}).positionAssignments)==null?void 0:i.map(({drawPosition:d,participantId:p,bye:h,qualifier:f})=>({drawPosition:d,participantId:p,qualifier:f,bye:h}));o.push({name:"initialMainAssignments",initialAssignments:c})}}let l={value:o.concat(r),name:mT};dn({element:a,extension:l})}function VD({tournamentRecord:t,drawDefinition:e,event:i}){var n;let r=((n=t?.events||i&&[i])==null?void 0:n.map(l=>l?.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],a={},s={},o=r.map(l=>{var u;return(u=l?.structures)==null?void 0:u.filter(c=>c?.structures)}).flat().filter(Boolean);for(let l of o){let{structures:u,structureId:c}=l??{};u&&c&&(a[c]=u?.map(d=>d.structureId))&&u.forEach(d=>s[d.structureId]=l?.structureId)}return{containedStructures:a,containerStructures:s}}function V$(t){var e;let{sides:i,matchUpType:n}=t||{},r=(e=t.potentialParticipants)!=null&&e.length?t.potentialParticipants.flat().map(s=>n===En?s?.individualParticipantIds||[]:s.participantId).flat():[],a=(i||[]).map(s=>{var o;return n===En&&(((o=s?.participant)==null?void 0:o.individualParticipantIds)||[])||s?.participantId&&[s.participantId]||[]}).flat();return{individualParticipantIds:a.concat(r).flat(),enteredIndividualParticipantIds:a,potentialIndividualParticipantIds:r}}function uc(t){return t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var AM="SIGN_IN_STATUS",kIe="SIGNED_OUT",QC="SIGNED_IN",xo="TEAM",Hi="INDIVIDUAL",Uu="GROUP",Ai="PAIR",Sn="TEAM",PP={TEAM_PARTICIPANT:xo,INDIVIDUAL:Hi,GROUP:Uu,TEAM:Sn,PAIR:Ai},XWe={INDIVIDUAL:Hi,GROUP:Uu,PAIR:Ai,TEAM:Sn,SIGN_IN_STATUS:AM,SIGNED_OUT:kIe,SIGNED_IN:QC};function j$({participantsProfile:t,participants:e=[],deepCopy:i}){let n=new Map,r=i!==!1?At(e,t?.convertExtensions,!0):e,a=r.filter(l=>l.participantType===Sn),s=r.filter(l=>l.participantType===Uu),o=r.filter(l=>l.participantType===Ai);return r.forEach(l=>{if(l.participantType===Hi){let{participantId:u}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{var p;d===u&&!((p=l.teamParticipantIds)!=null&&p.includes(c.participantId))&&(l.teamParticipantIds.push(c.participantId),n.get(c.participantId)||n.set(c.participantId,{participantName:c.participantName,participantId:c.participantId}),l.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),o.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.pairParticipantIds.includes(c.participantId)&&l.pairParticipantIds.push(c.participantId)})}),s.forEach(c=>{(c?.individualParticipantIds||[]).forEach(d=>{d===u&&!l.groupParticipantIds.includes(c.participantId)&&(l.groupParticipantIds.push(c.participantId),l.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),{participantsWithGroupings:r,groupInfo:Object.fromEntries(n)}}function xIe(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function JWe(t){let e=Object.assign({},...jg.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return xIe(e[t])}var jg=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function OIe({participant:t,withISO2:e,withIOC:i}){let{person:n,individualParticipants:r}=t,a=[n,r?.map(({person:o})=>o)].flat().filter(Boolean);function s(o){let{nationalityCode:l}=o||{};if(l){let u=jg.find(({iso:c})=>c===l);i&&u!=null&&u.ioc&&!o.iocNationalityCode&&(o.iocNationalityCode=u.ioc),e&&u!=null&&u.iso2&&!o.iso2NationalityCode&&(o.iso2NationalityCode=u.iso2),u!=null&&u.label&&!o.countryName&&(o.countryName=u.label)}}a.forEach(s)}function QWe({participantMap:t,template:e}){var i;let n=Object.values(t);for(let r of n){let a=r.participant;if((i=a.individualParticipantIds)!=null&&i.length){a.individualParticipants=[];for(let s of a.individualParticipantIds){let o=t[s].participant;a.individualParticipants.push(e?Dw({template:e,source:o}):o)}}}}function Ov(t){var e;let{tournamentRecord:i,participantId:n}=t,r=t.tournamentRecords||i&&{[i.tournamentId]:i}||{};for(let a of Object.values(r)){let s=(e=a.participants)==null?void 0:e.find(o=>o.participantId===n);if(s)return{participant:s,tournamentId:a.tournamentId}}return{error:Ar}}function LIe(t){let{tournamentRecord:e,participantId:i}=t;if(i){let n=Ov({tournamentRecord:e,participantId:i});return n.participant??n}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Xt}}function cc(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:n}=t,r=LIe(t);if(r.error)return r;if(i&&!Array.isArray(i))return{error:Ce,context:{itemSubTypes:i}};if(!Array.isArray(r.timeItems))return{error:f7};let a=r.timeItems.filter(o=>o?.itemType===n).filter(o=>!(i!=null&&i.length)||i.some(l=>{var u;return(u=o?.itemSubTypes)==null?void 0:u.includes(l)})).sort((o,l)=>{let u=new Date(o.createdAt||void 0).getTime(),c=new Date(l.createdAt||void 0).getTime();return u-c}),s=At(a.pop(),!1,!0);if(s){let o={timeItem:s,...ue};return e&&Object.assign(o,{previousItems:a}),o}else return{info:Xa}}function f8({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:n}){if(!e)return{error:Xd};if(!e.timeItems)return{info:Xa};let{timeItem:r,previousItems:a,info:s}=cc({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:s}}function _M({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:n}){if(!n)return{error:Wn};if(!n.timeItems)return{info:Xa};let{timeItem:r,previousItems:a,info:s}=cc({returnPreviousValues:t,element:n,itemSubTypes:e,itemType:i});return r&&{timeItem:r,previousItems:a}||{info:s}}function G$({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:n}){if(!e)return{error:lt};if(!e.timeItems)return{info:Xa};let{timeItem:r,previousItems:a,info:s}=cc({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:s}}function m8({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:n,itemType:r}){if(!e)return{error:lt};if(!i)return{error:da};let a=Ov({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:s}=a;if(!(s!=null&&s.timeItems))return{info:Xa};let{timeItem:o,previousItems:l,info:u}=cc({element:a.participant,returnPreviousValues:t,itemSubTypes:n,itemType:r});return o&&{timeItem:o,previousItems:l}||{info:u}}var e4e={[Uu]:"groupParticipantIds",[Ai]:"pairParticipantIds",[Sn]:"teamParticipantIds"},t4e={[Uu]:"groups",[Sn]:"teams"};function FIe({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:n,withScaleValues:r,withGroupings:a,internalUse:s,withISO2:o,withIOC:l}){let u=[],c={};for(let p of i.participants??[]){let h=p?.participantId;h&&r4e({participantMap:c,participantId:h})}for(let p of i.participants??[]){let h=At(p,e,s),{participantId:f,individualParticipantIds:m,participantType:g}=h;if(!c[f]){u.push(f);continue}if(Object.assign(c[f].participant,h),m){let v=n4e({individualParticipantIds:m,participantCopy:h,participantMap:c,participantType:g,participantId:f});v.missingParticipantIds.length&&u.push(...v.missingParticipantIds)}if(n&&(c[f].participant.signedIn=i4e(h)),r){let{ratings:v,rankings:y,seedings:b}=LD({participant:h});c[f].participant.seedings=b,c[f].participant.rankings=y,c[f].participant.ratings=v}(l||o)&&OIe({participant:c[f].participant,withISO2:o,withIOC:l})}if(t){let p=Qi(t)?t:void 0;QWe({participantMap:c,template:p})}let d;return a&&(d=j$({participants:Object.values(c).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:u,participantMap:c,groupInfo:d}}function i4e(t){let{timeItem:e}=cc({itemType:AM,element:t});return e?.itemValue===QC}function n4e({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:n,participantId:r}){var a;let s=[];for(let o of t){let l=(a=i[o])==null?void 0:a.participant;if(!l){s.push(o);continue}if(l[e4e[n]].push(r),[Sn,Uu].includes(n)){let{participantRoleResponsibilities:u,participantOtherName:c,participantName:d,participantId:p,teamId:h}=e,f=t4e[n];l[f].push({participantRoleResponsibilities:u,participantOtherName:c,participantName:d,participantId:p,teamId:h})}if(n===Ai){let u=t.find(c=>c!==o);i[o].pairIdMap[r]=u,i[o].pairIdMap[u]=r}}return{missingParticipantIds:s}}function r4e({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[Mn]:{...i},[En]:{...i},[Sn]:{...i},...i}}}function Gb({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:n,inContext:r}){if(e)return FIe({...t,...n,tournamentRecord:i});let a=At(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&a.forEach(o=>OIe({participant:o,...t}));let s;if((r||t!=null&&t.withGroupings)&&a!=null&&a.length&&({participantsWithGroupings:a,groupInfo:s}=j$({participantsProfile:t,deepCopy:!1,participants:a})),t?.withScaleValues&&a?.length)for(let o of a){let{ratings:l,rankings:u}=LD({participant:o});o.rankings=u,o.ratings=l}return{participants:a,groupInfo:s}}function pn({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:n,structure:r,event:a}){if(!Array.isArray(e))return{error:n7};let s={};return i&&o(i),a&&o(a),n&&o(n),r&&o(r),{appliedPolicies:s,...ue};function o(l){var u,c;let d=(c=(u=l?.extensions)==null?void 0:u.find(p=>p.name===XC))==null?void 0:c.value;if(d)for(let p of Object.keys(d))(t?e.includes(p):!e.length||e.includes(p))&&(s[p]=At(d[p],!1,!0))}}function Jm({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:n,event:r}){if(!Array.isArray(t))return{error:n7};let{appliedPolicies:a}=pn({tournamentRecord:e,drawDefinition:i,structure:n,event:r}),s={};for(let o of t){let l=a?.[o];l&&(s[o]=l)}return Object.keys(s).length?{policyDefinitions:s}:{info:iU.message}}var $Ie="WALKOVER",wQ="RETIRED",g8="COMPETITIVE",e1="ROUTINE",t1="DECISIVE",C_="winRatio",a4e={[Yf]:{policyName:"Competitive Bands Default",profileBands:{[t1]:20,[e1]:50}}},v8=a4e;function Qm({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:n,event:r}){let a={policies:{}};if(!i)return a;let s=Jm({tournamentRecord:e,drawDefinition:n,event:r}).policyDefinitions;if(i.withCompetitiveness){let o=t?.[Yf]??s?.[Yf]??v8[Yf];a.policies[Yf]=o}return a}function Hb({tournamentRecord:t,drawDefinition:e,policyType:i,structure:n,event:r}){if(!t)return{error:lt};let{appliedPolicies:a}=pn({tournamentRecord:t,drawDefinition:e,structure:n,event:r});return a!=null&&a[i]?{policy:a[i]}:{info:iU?.message}}function kM({tournamentRecord:t,categoryName:e,categoryType:i,event:n}){var r,a,s,o,l,u;e=e??((r=n?.category)==null?void 0:r.categoryName)??((a=n?.category)==null?void 0:a.ageCategoryCode),i=i??((s=n?.category)==null?void 0:s.categoryType)??((o=n?.category)==null?void 0:o.subType);let{policy:c}=Hb({policyType:_v,tournamentRecord:t,event:n}),d=(l=t?ki({element:t,name:Mm}).extension:void 0)==null?void 0:l.value,p=(u=n&&ki({name:Mm,element:n}).extension)==null?void 0:u.value;return{scheduleTiming:{tournamentScheduling:d,eventScheduling:p,categoryName:e,categoryType:i,policy:c}}}function y8({drawDefinition:t,attributes:e}){let{extension:i}=ki({element:t,name:hx}),n=i?.value||{};return e.forEach(r=>{Object.keys(r).forEach(a=>{n[a]?Object.assign(n[a],r[a]):n[a]=r[a]})}),i={name:hx,value:n},A$({drawDefinition:t,extension:i}),{entryProfile:n}}function xM({drawDefinition:t}){let{extension:e}=ki({element:t,name:hx});return{entryProfile:e?.value||{}}}var Xc="ALTERNATE",OM="CONFIRMED",cl="DIRECT_ACCEPTANCE",LM="FEED_IN",FM="JUNIOR_EXEMPT",Nm="LUCKY_LOSER",$M="ORGANISER_ACCEPTANCE",BM="QUALIFIER",s4e="REGISTERED",VM="SPECIAL_EXEMPT",dc="UNGROUPED",zb="UNPAIRED",mU="WILDCARD",uf="WITHDRAWN",R_=[OM,cl,FM,$M,VM],BIe=[LM,Nm,BM],qb=[OM,cl,LM,FM,$M,VM,mU],yd=[OM,cl,FM,Nm,BM,$M,VM,mU],VIe=[Xc,OM,cl,LM,FM,Nm,$M,BM,s4e,VM,dc,zb,mU,uf],o4e={ALTERNATE:Xc,CONFIRMED:OM,DIRECT_ACCEPTANCE:cl,DIRECT_ENTRY_STATUSES:qb,DRAW_SPECIFIC_STATUSES:BIe,EQUIVALENT_ACCEPTANCE_STATUSES:R_,FEED_IN:LM,JUNIOR_EXEMPT:FM,LUCKY_LOSER:Nm,ORGANISER_ACCEPTANCE:$M,QUALIFIER:BM,SPECIAL_EXEMPT:VM,STRUCTURE_SELECTED_STATUSES:yd,UNGROUPED:dc,UNPAIRED:zb,VALID_ENTRY_STATUSES:VIe,WILDCARD:mU,WITHDRAWN:uf};function b8({stage:t,drawDefinition:e}){let{entryProfile:i}=xM({drawDefinition:e}),n=Object.keys(i).includes(t);if(!n&&w$.includes(t)){let r=[{[t]:{drawSize:void 0,alternates:!0}}];return y8({drawDefinition:e,attributes:r}),!0}return n}function l4e({stage:t,drawDefinition:e}){var i;let{entryProfile:n}=xM({drawDefinition:e});return((i=n[t])==null?void 0:i.alternates)||0}function u4e({stage:t,drawDefinition:e}){var i;let{entryProfile:n}=xM({drawDefinition:e});return((i=n[t])==null?void 0:i.wildcardsCount)||0}function _H({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((n,r)=>r.entryStage===t&&r.entryStatus===i?n+1:n,0)}function x0({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:n,entryStatuses:r,structureId:a,roundTarget:s,stages:o,stage:l}){var u;let c=((u=i.entries)==null?void 0:u.reduce((d,p)=>{var h,f;let m=(f=(h=ki({name:sh,element:p}))==null?void 0:h.extension)==null?void 0:f.value,g=l&&p.entryStage===l||o?.length&&p.entryStage&&o.includes(p.entryStage),v=!r||p.entryStatus&&r.includes(p.entryStatus),y=p.entryStageSequence??1;return g&&(!n||y===n)&&v&&(!s||!m||s===m)?d.concat(p):d},[]))??[];if(a&&l===Tr){let{playoffEntries:d,error:p}=c4e({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:c).filter(h=>!e||h.placementGroup===e)}return c}function c4e({provisionalPositioning:t,drawDefinition:e,structureId:i}){let n=[],r=(e.links??[]).find(a=>a.linkType===Em&&a.target.structureId===i);if(r){let{finishingPositions:a,structureId:s}=r.source,{structure:o}=ui({drawDefinition:e,structureId:s});o?.structureType===Eo&&(o.structures??[]).forEach(l=>{let u=l.positionAssignments??[],{structureId:c}=l,d=c,p=Object.assign({},...u.map(m=>{var g;let{participantId:v}=m,y=(g=ki({element:m,name:rv}).extension)==null?void 0:g.value;return y&&v?{[v]:y}:void 0}).filter(Boolean)),h=Object.keys(p).reduce((m,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return m.includes(y)||m.push(y),m},[]).length===Object.keys(p).length,f=Object.keys(p).filter(m=>{let g=p[m],v=g.groupOrder||t&&g.provisionalOrder;return a?.includes(v)});(!t||h)&&f.forEach(m=>{let g=p[m],{groupOrder:v,provisionalOrder:y,GEMscore:b}=g,I=v||t&&y,S=[...a??[]].sort(ra).indexOf(I)+1;n.push({entryStage:Tr,entryStatus:LM,placementGroup:S,groupingValue:d,participantId:m,GEMscore:b})})})}return{playoffEntries:n}}function d4e({stage:t,drawDefinition:e}){return qb.reduce((i,n)=>(_H({drawDefinition:e,entryStatus:n,stage:t})||0)+i,0)}function ec({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:n,structure:r}){var a;let s,o=[];r||({structure:r,error:s}=ui({drawDefinition:i,structureId:n}));let l=Fn({structure:r}).positionAssignments;if(s||!r)return{seedAssignments:[],error:pr};n||(n=r.structureId);let{stage:u,stageSequence:c}=r,d=u===Tr&&i&&x0({provisionalPositioning:t,drawDefinition:i,stageSequence:c,structureId:n,stage:u}),p=d?d.filter(m=>m.placementGroup===1).sort((m,g)=>m.GEMscore<g.GEMscore&&1||m.GEMscore>g.GEMscore&&-1||0).map((m,g)=>{let v=g+1;return{participantId:m.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],h=p?.slice(0,e?p.length:l.length/2);h.length?o=h:r.seedAssignments?o=r.seedAssignments:s=Gve;let f=r.seedLimit??((a=r?.positionAssignments)==null?void 0:a.length);return{seedAssignments:o,stageSequence:c,seedLimit:f,stage:u,error:s}}function fp(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(n=>n.tieFormatId===e)}function CP({item:t,drawDefinition:e,structure:i,event:n}){var r,a,s;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((r=e.tieFormats)==null?void 0:r.find(o=>t.tieFormatId===o.tieFormatId))||(n.tieFormat?n.tieFormat:(a=n.tieFormats)==null?void 0:a.find(o=>t.tieFormatId===o.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let o=(s=e.tieFormats)==null?void 0:s.find(l=>i.tieFormatId===l.tieFormatId);if(o)return o}}}function Xs({drawDefinition:t,structure:e,matchUp:i,event:n}){return{tieFormat:CP({item:i,drawDefinition:t,structure:e,event:n})||CP({item:e,drawDefinition:t,structure:e,event:n})||fp(t)||fp(n)}}function p4e({matchUps:t}){let e=t.reduce((i,n)=>!n.collectionPosition||i.includes(n.collectionPosition)?i:i.concat(n.collectionPosition),[]).map(i=>({[i]:t.filter(n=>n.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function Cs({drawDefinition:t,structure:e}){let i={},n=[];return(t?.structures??[e]).filter(r=>r&&typeof r=="object").forEach(r=>{if(!r)return;let{structureId:a,matchUps:s,structures:o}=r,l=Array.isArray(o);if(l)l&&o.forEach(u=>{let{structureName:c}=u,d=u.matchUps;i[u.structureId]={matchUps:d,itemStructureIds:[],structureName:c},d&&(n.push(...d),d.forEach(p=>{p.tieMatchUps&&n.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(u.structureId)});else{let u=s;i[a]={matchUps:u,itemStructureIds:[]},u?.forEach(c=>{n.push(c),c.tieMatchUps&&n.push(...c.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:n}}function cb({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:n}){t=e?.mappedMatchUps??t;let r=t[i],a=(r?.itemStructureIds||[]).map(s=>{let{matchUps:o,structureName:l}=t[s];return n?o.map(u=>Object.assign(At(u,!0,!0),{containerStructureId:i,structureId:s,structureName:l})):o}).flat();return(r?.matchUps||[]).concat(...a)}function jIe({groupedOrder:t,roundPositionsCount:e}){if(!t||t?.length<=e)return t;let i=ka(t,t.length/e).map(r=>r.reduce((a,s)=>a+s)),n=i.slice().sort(ra);return i.map(r=>n.indexOf(r)+1)}function H$(t){if(!Qi(t))return!1;let{matchUpId:e,drawPositions:i}=t,n=typeof e=="string",r=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>bi(a)||a===void 0||a===null);return n&&r}function pc(t){return Array.isArray(t)?t.every(H$):!1}function bo({matchUps:t=[],interpolate:e}){var i;if(!pc(t))return{roundMatchUps:[],error:Ce};let n=t.reduce((p,h)=>{let f=typeof h.roundNumber=="string"?ai(h.roundNumber):h.roundNumber;return!h.roundNumber||p.includes(f)?p:p.concat(f)},[]).sort(ra).map(p=>{let h=t.filter(g=>g.roundNumber===p),f=h.find(({matchUpType:g})=>g===zn)?h.filter(({matchUpType:g})=>g===zn):h,m=g=>g.sort((v,y)=>ra(v.roundPosition,y.roundPosition));return{[p]:m(f)}}),r=t.reduce((p,h)=>{let f=typeof h.roundNumber=="string"?ai(h.roundNumber):h.roundNumber;return p[f]||(p[f]=Gt({abbreviatedRoundName:h.abbreviatedRoundName,finishingRound:h.finishingRound,roundName:h.roundName})),p},{}),a=Object.assign({},...n);if(e){let p=Math.max(...Object.keys(a).map(f=>ai(f)).filter(f=>!isNaN(f))),h=(i=a[p])==null?void 0:i.length;if(h>1&&Gd(h)){let f=p+1,m=f+h/2;Et(f,m).forEach((g,v)=>{a[g]=Et(0,h/(2+v*2)).map(()=>({}))})}}let s=0,o=Object.assign({},...Object.keys(a).map(p=>{var h,f,m;let g=(h=a[p])==null?void 0:h.length,v=(m=(f=a[p])==null?void 0:f.filter(b=>{var I;return!wa.includes(b.matchUpStatus)&&!((I=b.score)!=null&&I.scoreStringSide1)}))==null?void 0:m.length,y=g&&g===v;return s=Math.max(s,g),{[p]:{matchUpsCount:g,inactiveCount:v,inactiveRound:y}}})),l=0,u=0,c=Object.keys(a).map(p=>ai(p)).filter(p=>!isNaN(p));c.forEach(p=>{var h,f,m,g,v;let y=a[p].sort((I,S)=>I.roundPosition-S.roundPosition),b=y.map(I=>I?.drawPositions||[]).flat();if(o[p].roundNumber=p,o[p].roundFactor=o[p].matchUpsCount?s/o[p].matchUpsCount:1,o[p].finishingRound=(h=r[p])==null?void 0:h.finishingRound,o[p].roundName=(f=r[p])==null?void 0:f.roundName,o[p].abbreviatedRoundName=(m=r[p])==null?void 0:m.abbreviatedRoundName,o[p].finishingPositionRange=(v=(g=a[p])==null?void 0:g[0])==null?void 0:v.finishingPositionRange,p===1||!o[p-1]){let I=b.sort(ra),S=ka(I,2);o[p].drawPositions=I,o[p].pairedDrawPositions=S}else{let I=o[p-1],S=I.drawPositions,w=I.matchUpsCount/o[p].matchUpsCount,T=ka(S,w),U=y.map(C=>{let{roundPosition:E}=C,P=[...C.drawPositions||[],void 0,void 0].slice(0,2);if(!E)return P;let M=P?.filter(Boolean)||[];if(!(M!=null&&M.length))return[void 0,void 0];if(p<3&&M?.length===2)return P?.slice().sort(ra);let R=Pr(S,M).length!==M?.length;if(M!=null&&M.length&&R)return M?.length===1?[M[0],void 0]:P?.slice().sort(ra);let N=(E-1)*2;return T.slice(N,N+2).map(A=>M?.find(_=>A.includes(_)))});o[p].drawPositions=U?.flat(),o[p].pairedDrawPositions=U}o[p+1]&&o[p+1].matchUpsCount===o[p].matchUpsCount&&(o[p+1].feedRound=!0,o[p+1].feedRoundIndex=u,o[p].preFeedRound=!0,u+=1),o[p]&&!o[p].feedRound&&(o[p].roundIndex=l,l+=1)});let d=!!Object.values(o).find(({matchUpsCount:p})=>!Gd(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:d,maxMatchUpsCount:s,roundMatchUps:a,roundNumbers:c,roundProfile:o,...ue}}function M_(t){if(!Array.isArray(t))return"";let e=t.filter(Ir);return e.length?Si([Math.min(...e),Math.max(...e)]).join("-"):""}function h4e({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:Lt};if(!e)return{error:Tu};let{structure:n}=ui({drawDefinition:t,structureId:e});if(n?.stage!==Ds)return{error:$b,info:"Structure is not CONSOLATION stage"};let{links:r}=t,a=r?.filter(d=>d.target.structureId===e)||[],s=a?.reduce((d,p)=>{let{structureId:h}=p.source;return d.includes(h)?d:d.concat(h)},[])||[],o=Object.assign({},...s.map(d=>{let p=cb({structureId:d,matchUpsMap:i}),h=bo({matchUps:p}).roundProfile;return{[d]:h}})),l=cb({matchUpsMap:i,structureId:e}),{roundProfile:u}=bo({matchUps:l}),c={};return a?.forEach(d=>{var p,h,f;let{structureId:m,roundNumber:g}=d.source,{feedProfile:v,groupedOrder:y,positionInterleave:b,roundNumber:I}=d.target,S=o[m],w=(p=S[1])==null?void 0:p.drawPositions,T=(h=S[g])==null?void 0:h.matchUpsCount;if(!T)return;let U=T?w.length/T:0,C=w.length/U,E=w.slice(),P=jIe({roundPositionsCount:C,groupedOrder:y}),M=P?.length||1;if(M<=C){let A=w.length/M,_=ka(E,A);v===sb&&_.forEach(x=>x.reverse()),E=P?.length&&P?.map(x=>_[x-1]).flat()||E}let R=ka(E,U);if(b){let A=Et(0,b.interleave).map(()=>{}),_=Et(0,b.offset).map(()=>{});R=R.map(O=>[O,...A]),R.unshift(_),R=R.flat(1);let x=R.length-b.offset;R=R.slice(0,x)}c[I]||(c[I]={});let N=(f=u?.[I])!=null&&f.feedRound?2:1;R.forEach((A,_)=>{let x=1+_*N;c[I][x]||(c[I][x]=M_(A))})}),{sourceDrawPositionRanges:c}}function GIe({drawDefinition:t}){if(typeof t!="object")return{error:qI};let e={},{structures:i=[],links:n=[]}=t||{},r=i.reduce((s,o)=>{let{stage:l}=o;return s[l]?s[l].push(o):s[l]=[o],s},{});for(let s of Object.keys(r)){let o=r[s].find(({stageSequence:u})=>u===1);if(!o)continue;let{structureId:l}=o;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:s})}return{exitProfiles:e};function a({exitProfiles:s,exitProfile:o,structureId:l,targetRound:u,aggregator:c,stage:d}){s[l]||(s[l]=[]),o==="0"&&[Ds,Tr].includes(d)||s[l].push(o);let p=n.filter(h=>h.source.structureId===l&&h.source.roundNumber>=u);for(let h of p){let f=h.source.roundNumber,m=h.target.roundNumber,g=h.target.structureId,v=i.find(b=>b.structureId===g).stage,y=[v,g,m,f].join("|");if(c[y])return;c[y]=!0,a({exitProfile:`${o}-${f}`,structureId:g,exitProfiles:s,targetRound:m,aggregator:c,stage:v})}}}function f4e({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:n}){var r;if(!t)return{error:Lt};if(!i)return{error:Tu};if(!e){let o=cb({matchUpsMap:n,structureId:i});if({roundProfile:e}=bo({matchUps:o}),!e)return{error:Xt}}let a=(Math.min(...((r=e?.[1])==null?void 0:r.drawPositions)??[])||1)-1,s=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(s||[]).map(o=>{var l,u;let c=(l=e?.[o])==null?void 0:l.matchUpsCount,d=((u=e?.[1])==null?void 0:u.drawPositions)??[],p=ka(d,d.length/c),h=p.map(M_),f=p.map(b=>b.map(I=>I-a)).map(M_),m=s.map(b=>{var I;if(b>o)return;let S=((I=e?.[b])==null?void 0:I.drawPositions)??[];return ka(S,S.length/c)}).filter(Boolean),g=Et(0,c).map(b=>m.map(I=>I[b]).flat().filter(Boolean).sort(ra)).map(b=>Si(b)),v=g.map(b=>Aqe(b).map(M_).join(", ")),y=Object.assign({},...Et(0,c).map(b=>({[b+1]:{firstRoundDrawPositionsRange:h[b],firstRoundOffsetDrawPositionsRange:f[b],possibleDrawPositions:g[b],drawPositionsRange:v[b]}})));return{[o]:y}}))}}function I8({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:n}){var r;if(!i)return!1;n=n??i.matchUps??[],t=t??bo({matchUps:n}).roundsNotPowerOf2;let a=!!((r=i.positionAssignments)!=null&&r.find(({drawPosition:s})=>s))||!!(n!=null&&n.find(({drawPositions:s})=>s?.length));return(!(e!=null&&e.drawType)||e.drawType!==Bb)&&!(i!=null&&i.structures)&&t&&a}function Vo({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(r=>r?.roundPosition)),n=!!(e!=null&&e.find(r=>{var a;return(a=r?.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&t?.stage!==qa&&(!e.length||!i&&!n)}var w8={[pU]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[_t]:"",[Tr]:"P",[Kt]:"Q",[Ds]:"C"}}},m4e=w8;function g4e({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:n}){var r,a,s;let{roundProfile:o,roundMatchUps:l}=bo({matchUps:n}),{structureAbbreviation:u,stage:c}=i,d=Vo({structure:i}),p=I8({structure:i}),h=i.structures,f={},m=w8[pU],g=i.stage===Kt,v=g?Math.max(...(e?.structures??[]).filter(A=>A.stage===Kt).map(({stageSequence:A})=>A??1),0):0,y=(i.stageSequence??1)<v?i.stageSequence??1:"",b=y&&(((r=t?.affixes)==null?void 0:r.preQualifying)||m.affixes.preQualifying)||"",I=t?.roundNamingMap||m.roundNamingMap||{},S=t?.abbreviatedRoundNamingMap||m.abbreviatedRoundNamingMap||{},w=((a=t?.affixes)==null?void 0:a.preFeedRound)||m.affixes.preFeedRound,T=((s=t?.affixes)==null?void 0:s.roundNumber)||m.affixes.roundNumber,U=(t?.namingConventions||m.namingConventions).round,C=c&&c!==_t?c[0]:"",E=t?.stageConstants||m.stageConstants,P=c&&E?.[c]||C,M=`${b}${P}${y}`,R=o?Object.keys(o):[],N=g&&E!=null&&E[Kt]?`${E?.[Kt]}-`:"";if(h||d||p)Object.assign(f,...R.map(A=>{let _=`${N}${U} ${A}`,x=`${T}${A}`;return{[A]:{roundName:_,abbreviatedRoundName:x}}}));else{let A=g&&(t?.qualifyingFinishMap||m?.qualifyingFinishMap||{});Object.assign(f,...R.map(_=>{if(!(o!=null&&o[_]))return;let{matchUpsCount:x,preFeedRound:O}=o[_],$=x*2,F=A?.[o?.[_].finishingRound]||A&&`${T}${$}`||I[x]||`${T}${$}`,j=O?`-${w}`:"",H=`${F}${j}`,G=[M,u,H].filter(Boolean).join("-"),W=`${S[x]||`${T}${$}`}${j}`,q=[M,u,W].filter(Boolean).join("-");return{[_]:{abbreviatedRoundName:q,roundName:G}}}))}return{roundNamingProfile:f,roundProfile:o,roundMatchUps:l}}var v4e=(t,e)=>(t||0)+(e||0);function HIe(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&$Ie||i<=e[t1]&&t1||i<=e[e1]&&e1||g8}function zIe({score:t}){let e=t?.sets||[],i=e.reduce((r,a)=>(r[0]+=a.side1Score||0,r[1]+=a.side2Score||0,r),[0,0]),n=e.reduce((r,a)=>(r[0]+=a.side1TiebreakScore||0,r[1]+=a.side2TiebreakScore||0,r),[0,0]);return n.reduce(v4e)&&(i[n[0]>n[1]?0:1]+=1),{sets:e,games:i,score:t}}function y4e(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function qIe(t){return t.map(y4e).sort().map(e=>parseFloat(e.toFixed(2)))}function jM({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:ol};let{score:n,winningSide:r}=i;if(!r)return{error:Ce};let a=!e&&t&&Hb({policyType:Yf,tournamentRecord:t}).policy,s=e||a?.profileBands||v8[Yf].profileBands,o=zIe({score:n}),l=qIe([o]),u=HIe(l,s),c=Array.isArray(l)?l[0]:l;return{...ue,competitiveness:u,pctSpread:c}}function WIe({matchUp:t}){var e,i,n;if(!t)return{error:ol};if(t&&!t.sides)return{error:ll};if(t&&!t.hasContext)return{error:c$};let r=(e=t.sides??[])==null?void 0:e.map(u=>u?.participantId).filter(Boolean),a=((i=t.sides)==null?void 0:i.filter(u=>{var c;return((c=u.participant)==null?void 0:c.participantType)===Hi}).map(u=>u.participantId).filter(Boolean))??[],s=(((n=t.sides??[])==null?void 0:n.map(u=>{var c;return(c=u.participant)==null?void 0:c.individualParticipants}).filter(Boolean))??[]).map(u=>(u??[]).map(c=>c?.participantId).filter(Boolean)),o=[...a,...s.flat()].filter(Boolean)??[],l=Si(o.concat(r)).filter(Boolean)??[];return{nestedIndividualParticipantIds:s,allRelevantParticipantIds:l,individualParticipantIds:o,sideParticipantIds:r,...ue}}var mx="CHECK_IN",gx="CHECK_OUT",b4e="SCHEDULE",O0="SCHEDULE.ASSIGNMENT.VENUE",cf="SCHEDULE.ALLOCATION.COURTS",lv="SCHEDULE.ASSIGNMENT.COURT",z$="SCHEDULE.COURT.ORDER",L0="SCHEDULE.DATE",I4e="COMPLETED.DATE",S8="HOME_PARTICIPANT_ID",T8="SCHEDULE.ASSIGN.OFFICIAL",F0="SCHEDULE.TIME.SCHEDULED",Cd="SCHEDULE.TIME.START",am="SCHEDULE.TIME.STOP",Fh="SCHEDULE.TIME.RESUME",Am="SCHEDULE.TIME.END",q$="SCHEDULE.TIME.MODIFIERS",YIe="TO_BE_ANNOUNCED",KIe="NEXT_AVAILABLE",ZIe="FOLLOWED_BY",XIe="AFTER_REST",JIe="RAIN_DELAY",w4e="NOT_BEFORE",kH=[YIe,KIe,ZIe,XIe,JIe],S4e="ELIGIBILITY",T4e="REGISTRATION",U4e="SUSPENSION",D4e="MEDICAL",E4e="PENALTY",QIe="SCALE",ewe="RATING",twe="RANKING",U8="SEEDING",Lv="PUBLISH",Du="PUBLIC",Fv="STATUS",P4e="MODIFICATION",C4e="RETRIEVAL",R4e="other",M4e={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:kH,AFTER_REST:XIe,ALLOCATE_COURTS:cf,ASSIGN_COURT:lv,ASSIGN_OFFICIAL:T8,ASSIGN_VENUE:O0,CHECK_IN:mx,CHECK_OUT:gx,COMPLETED_DATE:I4e,COURT_ORDER:z$,ELIGIBILITY:S4e,END_TIME:Am,FOLLOWED_BY:ZIe,MEDICAL:D4e,MODIFICATION:P4e,NEXT_AVAILABLE:KIe,NOT_BEFORE:w4e,OTHER:R4e,PENALTY:E4e,PUBLIC:Du,PUBLISH:Lv,RANKING:twe,RATING:ewe,RAIN_DELAY:JIe,REGISTRATION:T4e,RESUME_TIME:Fh,RETRIEVAL:C4e,SCALE:QIe,SCHEDULE:b4e,SCHEDULED_DATE:L0,SCHEDULED_TIME:F0,SEEDING:U8,START_TIME:Cd,STATUS:Fv,STOP_TIME:am,SUSPENSION:U4e,TIME_MODIFIERS:q$,TO_BE_ANNOUNCED:YIe};function $0({matchUp:t}){if(!t)return{error:ol};if(!t.hasContext)return{error:c$};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:ll};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:n}=WIe({matchUp:t}),r=(t.timeItems??[]).filter(o=>o?.itemType&&[mx,gx].includes(o.itemType)).sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=r.map(o=>o.itemValue).filter(o=>r.filter(l=>l?.itemValue===o).reverse()[0].itemType===mx);e?.forEach((o,l)=>{let u=n?.[l],c=o?.length&&o.every(d=>a.includes(d));u&&c&&!a.includes(u)&&a.push(u)}),n?.forEach((o,l)=>{a.includes(o)&&(e?.[l]??[]).forEach(u=>{u&&!a.includes(u)&&a.push(u)})});let s=n?.reduce((o,l)=>a.includes(l)&&o,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:s,checkedInParticipantIds:a,...ue}}var xr=t=>e=>{let i=Qi(e)&&e?.matchUpType||nr(e)&&e;return i&&Sve[t].includes(i)};function RP(t){var e;let{matchUpAverageTimes:i,matchUpFormat:n}=t||{},r=i?.map(({matchUpFormatCodes:s})=>s?.filter(o=>o===n)).flat().filter(Boolean).sort((s,o)=>(s?.length||0)-(o?.length||0))||[],a=r.includes(n)?n:r[0];return(e=i?.find(({matchUpFormatCodes:s,averageTimes:o})=>s?.find(l=>a===l)&&o))==null?void 0:e.averageTimes}function MP(t){var e;let{matchUpRecoveryTimes:i,averageMinutes:n,matchUpFormat:r}=t||{};return(e=i?.find(({matchUpFormatCodes:a,averageTimes:s,recoveryTimes:o})=>{if(s&&n){let{greaterThan:l=0,lessThan:u=360}=s;if(n>l&&n<u)return!0}return a?.find(l=>l===r)&&o}))==null?void 0:e.recoveryTimes}function iwe({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(n=>Array.isArray(n)).map(n=>n.sort((r,a)=>{var s,o;return(((s=a.categoryNames)==null?void 0:s.length)||0)-(((o=r.categoryNames)==null?void 0:o.length)||0)}).find(({categoryTypes:r,categoryNames:a})=>!(a!=null&&a.length)&&!(r!=null&&r.length)||a?.includes(e)||r?.includes(i))).find(Boolean)}function N4e({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:n,matchUpFormat:r,categoryName:a,categoryType:s,policy:o}){var l;let u=e?.matchUpRecoveryTimes&&MP({...e,averageMinutes:i,matchUpFormat:r}),c=t?.matchUpRecoveryTimes&&MP({...t,averageMinutes:i,matchUpFormat:r}),d=o?.matchUpRecoveryTimes&&MP({...o,averageMinutes:i,matchUpFormat:r}),p=[u,c,d,(l=o?.defaultTimes)==null?void 0:l.recoveryTimes,n?.recoveryTimes];return iwe({categoryName:a,categoryType:s,timesBlockArray:p})}function A4e({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:n,tournamentScheduling:r,eventScheduling:a,policy:s}){var o;let l=a?.matchUpAverageTimes&&RP({...a,matchUpFormat:t}),u=r?.matchUpAverageTimes&&RP({...r,matchUpFormat:t}),c=s?.matchUpAverageTimes&&RP({...s,matchUpFormat:t}),d=[l,u,c,(o=s?.defaultTimes)==null?void 0:o.averageTimes,n?.averageTimes];return iwe({categoryName:e,categoryType:i,timesBlockArray:d})}var nwe="DOUBLES_SINGLES",rwe="SINGLES_DOUBLES",Jc="total",xH="participantConflict",Dg="matchUpConflict",awe="ISSUE_IDS",oy="CONFLICT",ly="WARNING",OH="ERROR",LH="ISSUE",N_="STATE",_4e={SINGLES_DOUBLES:rwe,DOUBLES_SINGLES:nwe,TOTAL:Jc,CONFLICT_MATCHUP_ORDER:Dg,CONFLICT_PARTICIPANTS:xH,SCHEDULE_ISSUE_IDS:awe,SCHEDULE_CONFLICT:oy,SCHEDULE_WARNING:ly,SCHEDULE_ERROR:OH,SCHEDULE_ISSUE:LH,SCHEDULE_STATE:N_};function GM({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:n,categoryName:r,categoryType:a,eventType:s,event:o}){if(!i)return{error:lt};s=s??o?.eventType??Tw;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=kM({tournamentRecord:i,categoryName:r,categoryType:a,event:o}),c={...u,matchUpFormat:n,categoryType:a,defaultTiming:l};return W$({eventType:s,timingDetails:c})}function W$({timingDetails:t,eventType:e}){let i=A4e(t),n=Object.keys(i?.minutes||{}),r=i?.minutes&&(n?.includes(e)&&i.minutes[e]||i.minutes.default),a=N4e({...t,averageMinutes:r}),s=Object.keys(a?.minutes||{}),o=a?.minutes&&(s?.includes(e)&&a.minutes[e]||a.minutes.default),l=xr(Tw)(e)?rwe:nwe,u=a?.minutes&&(s?.includes(l)&&a.minutes[l]||o);return{averageMinutes:r,recoveryMinutes:o,typeChangeRecoveryMinutes:u}}function PV(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Wb({timeItems:t,itemType:e}){let i=t.filter(r=>r&&r.itemType===e).sort((r,a)=>PV(r)-PV(a)).pop(),n=i&&PV(i);return{itemValue:i?.itemValue,timeStamp:n}}function swe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Wb({timeItems:i?.timeItems||[],itemType:F0});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{scheduledTime:n}:e}function B0({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Wb({timeItems:i?.timeItems||[],itemType:L0});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{scheduledDate:n}:e}function dI(t){if(nbe.test(t)){let e=E7();return new Date(`${e}T${t}`)}else return new Date(t)}function k4e({matchUp:t}){if(!t)return{error:ol};if(!t.timeItems)return{error:f7};let e=t.timeItems.filter(n=>[Cd,am,Fh,Am].includes(n?.itemType)).sort((n,r)=>dI(n.itemValue).getTime()-dI(r.itemValue).getTime()),i=e.reduce((n,r)=>{var a,s;let o,l=(a=r?.itemType)==null?void 0:a.split("."),u=`SCHEDULE.TIME.${((s=r?.itemType)==null?void 0:s.startsWith("SCHEDULE.TIME"))&&l[2]}`;switch(u){case Cd:o=0;break;case Am:if(n.lastValue&&[Cd,Fh].includes(n.lastType)){let c=dI(r.itemValue).getTime()-dI(n.lastValue).getTime();o=n.milliseconds+c}else o=n.milliseconds;break;case am:if([Cd,"SCHECULE.TIME.RESUME"].includes(n.lastType)){let c=dI(r.itemValue).getTime()-dI(n.lastValue).getTime();o=n.milliseconds+c}else o=n.milliseconds;break;default:o=n.milliseconds;break}return{milliseconds:o,lastType:u,lastValue:r.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([Cd,Fh].includes(i.lastType)){let n=new Date().getTime()-dI(i.lastValue).getTime();i.milliseconds+=n}return{milliseconds:i.milliseconds,time:x4e(i.milliseconds),relevantTimeItems:e}}function x4e(t){let e=(i,n=2)=>("00"+i).slice(-n);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function O4e({matchUp:t}){var e;let i=t?.timeItems||[],n=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:(e=i.reduce((r,a)=>{let s=a.itemType===Cd&&a;return s&&(!r||n(s)<n(r))?s:r},void 0))==null?void 0:e.itemValue}}function HM(t){let{disableNotice:e,venue:i,context:n}=t;if(typeof i!="object")return{error:Ce};let r=uc(t);i.venueId||(i.venueId=gn());let a;for(let s of Object.values(r)){let o=L4e({disableNotice:!0,tournamentRecord:s,context:n,venue:i});if(o!=null&&o.error)return o;a=o.venue}return e||Ui({topic:EIe,payload:{venue:i}}),Gt({...ue,venue:a})}function L4e({tournamentRecord:t,disableNotice:e,context:i,venue:n}){return t?n?(t.venues||(t.venues=[]),n.venueId||(n.venueId=gn()),t.venues.reduce((r,a)=>r||a.venueId===n.venueId,void 0)?{error:Dye}:(i&&dn({element:n,extension:{value:i,name:uIe}}),t.venues.push(n),{...ue,venue:At(n)})):{error:Xt,info:"missing venue"}:{error:lt}}function bf({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:lt};if(!i)return{error:Nv};let n=(e.venues??[]).reduce((r,a)=>a.venueId===i?a:r,void 0);if(!n&&t){let r=(MM({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of r){let s=t[a],o=bf({tournamentRecord:s,venueId:i});if(o.success&&o.venue)return HM({tournamentRecord:e,venue:o.venue}),{...ue,venue:n}}}return n?{...ue,venue:n}:{error:C0}}function D8({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:n,venueId:r}=e,a=bf({tournamentRecords:i,tournamentRecord:n,venueId:r});return At(a,t,!0)}function V0({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:lt};if(!i)return{error:D0};let n="findCourt",r,a;if((e.venues??[]).forEach(s=>{(s.courts??[]).forEach(o=>{o.courtId===i&&(r=o,a=s)})}),r)return{...ue,court:r,venue:a};if(t){let s=(MM({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let o of s){let l=t[o],u=V0({tournamentRecord:l,courtId:i});if(u.success)return u.venue&&HM({tournamentRecord:e,venue:u.venue}),{...ue,court:r,venue:a}}}return pe({result:{error:AD},stack:n})}function E8(t){return At(V0(t),!1,!0)}function Y$({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:lt};if(!i)return{error:D0};let n=V0({tournamentRecord:t,courtId:i});if(n.error)return n;let r=n.court&&(({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m})=>({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m}))(n.court);return{...ue,courtInfo:At(r,!1,e)}}function gU(t){var e;let i=Yt(t,[{[Ta]:!0},{venueId:!0,[Zc]:Nv}]);if(i.error)return i;let{tournamentRecord:n,venueId:r}=t,a=bf({tournamentRecord:n,venueId:r});if(a.error)return a;let s=(((e=a.venue)==null?void 0:e.courts)??[]).map(u=>(({courtInfo:c})=>({...c}))(Y$({courtId:u.courtId,internalUse:!0,tournamentRecord:n}))),o=a.venue&&(({venueId:u,venueName:c,venueAbbreviation:d})=>({venueAbbreviation:d,venueName:c,venueId:u}))(a.venue),l=o&&{...o,courtsInfo:s};return{...ue,venueData:At(l,!1,!0)}}function F4e({matchUp:t}){var e;let i=t?.timeItems||[],n=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:(e=i.reduce((r,a)=>{let s=a.itemType===Am&&a;return s&&(!r||n(s)>n(r))?s:r},void 0))==null?void 0:e.itemValue}}function Rr({event:t,eventId:e}){var i,n;if(!t)return{error:Wn};let r=(i=ki({name:ld,element:t}))==null?void 0:i.extension,a=e?At(r?.value,!1,!0):r?.value;return e&&((n=t.drawDefinitions)==null||n.forEach(s=>{var o;(o=a?.flights)==null||o.forEach(l=>{l.drawId===s.drawId&&Object.assign(l,{drawDefinition:s})})})),{flightProfile:a}}function jo(t){let{tournamentRecord:e,eventId:i,drawId:n}=t,r="findEvent",a={},s=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},o=Object.values(s).map(({events:u,tournamentId:c})=>(u&&u.forEach(d=>{a[d.eventId]={tournamentId:c}}),u??[])).flat(),l;if(n){let u,c=o.find(d=>{var p,h,f;let m=(d?.drawDefinitions??[]).find(g=>g.drawId===n);if(m)u=m,l=a[d.eventId].tournamentId;else{let g=(f=(h=d&&((p=Rr({event:d}))==null?void 0:p.flightProfile))==null?void 0:h.flights)==null?void 0:f.find(v=>v.drawId===n);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:n}}return m});if(c)return{event:c,drawDefinition:u,tournamentId:l}}if(i){let u=o.find(c=>c?.eventId===i);if(u)l=a[u.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...pe({result:{error:Xu},stack:r})};return{event:u,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...pe({result:{error:fu},context:{drawId:n,eventId:i},stack:r})}}function K$(t){var e,i,n,r,a,s,o,l,u,c;let d=t.event,p=t.matchUpType,{scheduleVisibilityFilters:h,afterRecoveryTimes:f,tournamentRecord:m,usePublishState:g,scheduleTiming:v,matchUpFormat:y,publishStatus:b,matchUp:I}=t;if(!I)return{error:ol};if(f&&!I.matchUpType&&!t.matchUpType&&(d||m)&&I.drawId){let A=t.drawDefinition||((e=d?.drawDefinitions)==null?void 0:e.find(x=>x.drawId===I.drawId));!A&&m&&({drawDefinition:A,event:d}=jo({drawId:I.drawId,tournamentRecord:m}));let _=I.structureId&&((i=A?.structures)==null?void 0:i.find(({structureId:x})=>x===I.structureId));p=t.matchUpType||_?.matchUpType||A?.matchUpType||d?.eventType!==aa&&d?.eventType}let{milliseconds:S,time:w}=k4e({matchUp:I}),{startTime:T}=O4e({matchUp:I}),{endTime:U}=F4e({matchUp:I}),C,{eventIds:E,drawIds:P}=h??{};if((!E||E.includes(I.eventId))&&(!P||P.includes(I.drawId))){let A=Me=>Me.createdAt?new Date(Me.createdAt).getTime():0,_=new Map,x=((n=I.timeItems)==null?void 0:n.toSorted((Me,Oe)=>A(Me)-A(Oe)))??[];for(let Me of x)_.set(Me.itemType,Me.itemValue);let O=_.get(S8),$=_.get(cf),F=_.get(F0),j=_.get(q$),H=_.get(L0),G=_.get(T8),W=_.get(z$),q=_.get(O0),Z=_.get(lv),K,Q,J,ne,re,oe=I.matchUpType??p;if(v&&F&&f&&oe){let Me={matchUpFormat:I.matchUpFormat??y,...v};({averageMinutes:Q=0,recoveryMinutes:J=0,typeChangeRecoveryMinutes:ne=0}=W$({timingDetails:Me,eventType:oe})),(Q||J)&&(K=U?il(er(U),J):il(F,Q+J)),ne&&(re=U?il(er(U),ne):il(F,Q+ne))}!H&&F&&(H=Ci(F));let de=sx({scheduledDate:H,scheduledTime:F}),se={},ge=((r=m&&q&&gU({tournamentRecord:m,venueId:q}))==null?void 0:r.venueData)||{};q&&(se[q]=ge);let{venueName:ye,venueAbbreviation:Te,courtsInfo:De}=ge,xe=(a=Z&&De?.find(Me=>Me.courtId===Z))==null?void 0:a.courtName;for(let Me of $||[]){if(!m)break;Me.venueId&&!se[Me.venueid]&&(se[Me.venueId]=(s=gU({venueId:Me.venueId,tournamentRecord:m}))==null?void 0:s.venueData);let Oe=se[Me.venueId];Me.venueName=Oe?.venueName;let at=(o=Oe?.courtsInfo)==null?void 0:o.find(Fe=>Fe.courtId===Me.courtId);Me.courtName=at?.courtName}C=Gt({typeChangeTimeAfterRecovery:re,timeAfterRecovery:K,scheduledDate:H,scheduledTime:F,isoDateString:de,homeParticipantId:O,venueAbbreviation:Te,allocatedCourts:$,timeModifiers:j,venueName:ye,venueId:q,courtOrder:W,courtName:xe,courtId:Z,official:G,typeChangeRecoveryMinutes:ne,recoveryMinutes:J,averageMinutes:Q,milliseconds:S,startTime:T,endTime:U,time:w})}else C=Gt({milliseconds:S,startTime:T,endTime:U,time:w});let{scheduledDate:M}=B0({matchUp:I}),{scheduledTime:R}=swe({matchUp:I});if(g&&(l=b?.displaySettings)!=null&&l.draws){let A=b.displaySettings.draws,_=(u=A?.[I.drawId]??A?.default)==null?void 0:u.scheduleDetails;if(_){let x=(c=_.find(O=>{var $;return M&&(($=O.dates)==null?void 0:$.includes(M))})??_.find(O=>{var $;return!(($=O.dates)!=null&&$.length)}))==null?void 0:c.attributes;if(x){let O=Object.assign({},...Object.keys(C).map($=>({[$]:!0})),x);C=Dw({source:C,template:O})}}}let N=I.matchUpStatus&&wa.includes(I.matchUpStatus)&&(Ci(U)||Ci(M)||Ci(R))||void 0;return{schedule:C,endDate:N}}function $4e({drawPositions:t,roundProfile:e,roundNumber:i}){var n;let r=[void 0,void 0];if(Rve(t))return{orderedDrawPositions:r,displayOrder:r};let a=e?.[i],s=((n=a?.pairedDrawPositions)==null?void 0:n.find(l=>yo(l||[],t.filter(Boolean))))??r,o=a?.feedRound;if(Cve(t)){let l=[...t].sort(ra);return{orderedDrawPositions:l.length===2?l:s,displayOrder:o?l:s}}if(o){let l=[t.find(u=>!isNaN(ai(u))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:s,displayOrder:s}}function vx({collectionPosition:t,collectionId:e,lineUp:i}){let n=[],r=[];if(i){let a=o=>o===void 0?-1:o,s=i.map(o=>{let{collectionAssignments:l,participantId:u}=o,c=l?.find(d=>d.collectionPosition===t&&d.collectionId===e);return c&&{participantId:u,...c}}).filter(Boolean).sort((o,l)=>a(o.substitutionOrder)-a(l.substitutionOrder));for(let o of s){let{participantId:l,previousParticipantId:u,substitutionOrder:c}=o;n.includes(l)||(u&&r.push({previousParticipantId:u,substitutionOrder:c,participantId:l}),n=n.filter(d=>d!==u),n.push(l))}}return{assignedParticipantIds:n,substitutions:r}}function cd({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let n="getPairedParticipant";if(!t&&!e)return{error:lt};if(!Array.isArray(i)||i.length>2)return{error:El};if(!i.length)return pe({result:{error:Mv},stack:n});t=t??e?.participants??[];let r=t.filter(o=>o.participantType===Ai&&Pr(i,o.individualParticipantIds).length===i.length&&o.individualParticipantIds.length===i.length),a=r[0];if(!a)return pe({result:{error:Ar},stack:n});let s=At(r.slice(1),!1,!0);return{participant:At(a),duplicatedPairParticipants:s,...ue}}function db({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:Lt};if(typeof e!="string")return{error:da};let{extension:i}=ki({element:t,name:Rm});return{lineUp:(i?.value||{})[e]}}function B4e({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:n=[],participantMap:r,drawDefinition:a,collectionId:s,sideLineUps:o,matchUpType:l}){if(!s||!i)return{};let u=({attribute:d,lineUp:p,teamParticipant:h})=>{var f,m,g,v;let{assignedParticipantIds:y,substitutions:b}=vx({collectionPosition:i,collectionId:s,lineUp:p});if(l===En){if(y?.length<=2){let I=(m=(f=r?.[y[0]])==null?void 0:f.pairIdMap)==null?void 0:m[y[1]],S=(v=I&&((g=r[I])==null?void 0:g.participant)||cd({participantIds:y,tournamentParticipants:t}).participant)==null?void 0:v.participantId;return{[d]:{participantId:S,teamParticipant:h,substitutions:b}}}else if(y?.length>2)return{[d]:{teamParticipant:h,substitutions:b}}}else{let I=y?.[0];return I&&{[d]:{participantId:I,teamParticipant:h,substitutions:b}}}};if(!(n!=null&&n.length)){let d=o?.map(p=>{var h;let{teamParticipant:f,sideNumber:m}=p,g=p.lineUp||((h=db({participantId:f.teamParticipantId,drawDefinition:a}))==null?void 0:h.lineUp);return u({attribute:m,lineUp:g,teamParticipant:f})}).filter(Boolean)||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let c=n?.map(d=>{var p,h,f;let m=(p=e.find(b=>b.drawPosition===d))==null?void 0:p.participantId,g=o?.find(b=>b?.drawPosition===d),v=g?.teamParticipant||m&&((h=r?.[m])==null?void 0:h.participant)||t?.find(({participantId:b})=>b===m),y=g?.lineUp||((f=db({participantId:m,drawDefinition:a}))==null?void 0:f.lineUp);return u({attribute:d,lineUp:y,teamParticipant:v})}).filter(Boolean)||{};return{drawPositionCollectionAssignment:Object.assign({},...c)}}function Z$(t){var e,i,n;let r=Yt(t,[{[yf]:!0}]);if(r.error)return r;let a=t?.matchUp,s=a?.matchUpType;if(!s&&(e=a?.sides)!=null&&e.length){let o=(n=(i=a.sides.find(({participant:l})=>l))==null?void 0:i.participant)==null?void 0:n.participantType;s=o===Hi&&Mn||o===Ai&&En||o===Sn&&Sn||void 0}return{matchUpType:s}}function V4e({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:n,seedAssignments:r,drawPosition:a,isFeedRound:s,sideNumber:o}){var l,u,c,d;let p=i.find(v=>v.drawPosition&&v.drawPosition===a),h=a&&t,f=o&&e,m=h?(l=h[a])==null?void 0:l.participantId:p?.participantId,g=p?j4e({displaySideNumber:n,seedAssignments:r,participantId:m,assignment:p,sideNumber:o}):{...f?.[o]};if(s&&(o===1?Object.assign(g,{participantFed:!0}):Object.assign(g,{participantAdvanced:!0})),a&&h){let v=(u=h[a])==null?void 0:u.teamParticipant,y=(c=h[a])==null?void 0:c.participant,b=(d=h[a])==null?void 0:d.substitutions;y&&(g.participant=y),b&&(g.substitutions=b),v&&(g.teamParticipant=v)}return g}function j4e({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:n,sideNumber:r}){let a={drawPosition:n.drawPosition,displaySideNumber:t,sideNumber:r};if(i){let s=G4e({seedAssignments:e,participantId:i});Object.assign(a,s,{participantId:i}),s!=null&&s.seedNumber&&s?.seedValue===""&&(a.seedValue="~")}else n.bye&&Object.assign(a,{bye:!0});return n.qualifier&&Object.assign(a,{qualifier:!0}),a}function G4e({seedAssignments:t,participantId:e}){return t?.find(i=>!i.seedProxy&&i.participantId===e)}function owe({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:n,drawPositionsRanges:r,hydrateParticipants:a,afterRecoveryTimes:s,initialRoundOfPlay:o,additionalContext:l,roundNamingProfile:u,tournamentRecord:c,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:h,seedAssignments:f,usePublishState:m,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:b,drawDefinition:I,publishStatus:S,scoringActive:w,matchUpTieId:T,isRoundRobin:U,roundProfile:C,sideLineUps:E,structure:P,context:M,matchUp:R,event:N}){var A,_,x,O,$,F,j,H,G,W,q,Z,K,Q,J;l=l??{};let ne=(A=Xs({drawDefinition:I,structure:P,matchUp:R,event:N}))==null?void 0:A.tieFormat,{roundOffset:re,structureId:oe,structureName:de,stage:se,stageSequence:ge}=P,{drawId:ye,drawName:Te,drawType:De}=I??{},xe=ne?.collectionDefinitions,Me=R.collectionId&&xe?.find(Tt=>Tt.collectionId===R.collectionId),Oe=R.collectionId?Me?.matchUpFormat:R.matchUpFormat??P?.matchUpFormat??I?.matchUpFormat??N?.matchUpFormat,at=R.matchUpType||Me?.matchUpType||P?.matchUpType||I?.matchUpType||!xr(aa)(N?.eventType)&&N?.eventType,Fe=h?fn:R.matchUpStatus,{schedule:mt,endDate:Xe}=K$({scheduleVisibilityFilters:t,afterRecoveryTimes:s,tournamentRecord:c,usePublishState:m,scheduleTiming:y,drawDefinition:I,matchUpFormat:Oe,publishStatus:S,matchUpType:at,matchUp:R,event:N}),gt=d??R.drawPositions??[],{collectionPosition:ht,collectionId:_e,roundPosition:Ye}=R,Je=R.roundNumber??l.roundNumber,ct=_e?B4e({tournamentParticipants:i,positionAssignments:n,collectionPosition:ht,participantMap:g,drawDefinition:I,drawPositions:gt,collectionId:_e,sideLineUps:E,matchUpType:at}):void 0,pt=((_=u?.[Je])==null?void 0:_.roundName)||l.roundName,Se=((x=u?.[Je])==null?void 0:x.abbreviatedRoundName)||l.abbreviatedRoundName,he=(O=C?.[Je])==null?void 0:O.feedRound,we=($=C?.[Je])==null?void 0:$.preFeedRound,be=(F=C?.[Je])==null?void 0:F.roundFactor,Ae=r?.[Je],ze=Ye?Ae?.[Ye]:void 0,We=e?.[Je],Le=Me!=null&&Me.category?{...M?.category||{},...Me.category}:M?.category??N?.category,ft=((j=R.processCodes)==null?void 0:j.length)&&R.processCodes||((H=Me?.processCodes)==null?void 0:H.length)&&Me?.processCodes||((G=P?.processCodes)==null?void 0:G.length)&&P?.processCodes||((W=I?.processCodes)==null?void 0:W.length)&&I?.processCodes||((q=N?.processCodes)==null?void 0:q.length)&&N?.processCodes||c?.processCodes,rt=b?.withCompetitiveness&&jM({...v,matchUp:R}),St=R.finishingPositionRange??l.finishingPositionRange,si=Tt=>Gt(Tt,void 0,!0),Qe={...si(M),...si({matchUpFormat:R.matchUpType===aa?void 0:Oe,tieFormat:R.matchUpType!==aa?void 0:ne,gender:Me?.gender??N?.gender,roundOfPlay:se!==Kt&&bi(o)&&o+(Je||0),endDate:R.endDate??Xe,discipline:N?.discipline,category:Le,finishingPositionRange:St,abbreviatedRoundName:Se,drawPositionsRange:ze,competitiveProfile:rt,structureName:de,stageSequence:ge,drawPositions:gt,matchUpStatus:Fe,processCodes:ft,isRoundRobin:U,matchUpTieId:T,preFeedRound:we,matchUpType:at,roundFactor:be,roundOffset:re,structureId:oe,roundNumber:Je,feedRound:he,roundName:pt,drawName:Te,drawType:De,schedule:mt,drawId:ye,stage:se}),...At(si(R),!0,!0)};if(Oe&&(Z=R.score)!=null&&Z.scoreStringSide1){let Tt=Do(Oe),{bestOf:Li,finalSetFormat:Jt,setFormat:Yi}=Tt??{};(Jt!=null&&Jt.tiebreakSet||Yi!=null&&Yi.tiebreakSet||Yi!=null&&Yi.timed)&&(Qe.score.sets=Qe.score.sets.sort((Ri,qi)=>Ri.setNumber-qi.setNumber).map((Ri,qi)=>(qi+1===Li?(Jt!=null&&Jt.tiebreakSet||Jt!=null&&Jt.timed)&&(Ri.tiebreakSet=!0):(Yi!=null&&Yi.tiebreakSet||Yi!=null&&Yi.timed)&&(Ri.tiebreakSet=!0),Ri)))}if(Array.isArray(gt)){let{orderedDrawPositions:Tt,displayOrder:Li}=$4e({drawPositions:gt,roundProfile:C,roundNumber:Je}),Jt=(K=C?.[Je])==null?void 0:K.feedRound,Yi=Li[0]!==Tt[0],Ri=Tt.concat(void 0,void 0).slice(0,2).map((qi,hn)=>{var kt;let fi=hn+1,Xr=Yi?3-fi:fi,Jr=V4e({...ct,positionAssignments:n,displaySideNumber:Xr,seedAssignments:f,drawPosition:qi,isFeedRound:Jt,sideNumber:fi}),Qr=(kt=R.sides)==null?void 0:kt.find(lr=>lr.sideNumber===fi),Lr=Ye?(Ye-1)*2+hn+1:void 0,Ua=Lr?We?.[Lr]:void 0;return si({sourceDrawPositionRange:Ua,...Qr,...Jr})});Object.assign(Qe,At({sides:Ri},!0,!0))}if(i&&Qe.sides){let Tt=p?.[FD],Li=Jt=>{var Yi;let Ri=(Yi=g?.[Jt])==null?void 0:Yi.participant;return Ri&&Dw({template:Tt?.participant,source:Ri})};if(Qe.sides.filter(Boolean).forEach(Jt=>{var Yi,Ri,qi,hn;if(Jt.participantId){let kt=At(Li(Jt.participantId)||(i?nv({policyDefinitions:p,participantId:Jt.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:b}):void 0),void 0,!0);if(kt){let fi,Xr;if(I!=null&&I.entries){let Jr=I.entries.find(Lr=>Lr.participantId===Jt.participantId),Qr=(Yi=N?.entries)==null?void 0:Yi.find(Lr=>Lr.participantId===Jt.participantId);fi=Jr?.entryStatus||Qr?.entryStatus,kt.entryStatus=fi,Jr!=null&&Jr.entryStage&&(Xr=Jr.entryStage,kt.entryStage=Xr)}a!==!1?Object.assign(Jt,{participant:kt}):Object.assign(Jt,{participant:{entryStage:Xr,entryStatus:fi}})}}if((qi=(Ri=Jt?.participant)==null?void 0:Ri.individualParticipantIds)!=null&&qi.length&&!((hn=Jt.participant.individualParticipants)!=null&&hn.length)){let kt=Jt.participant.individualParticipantIds.map(fi=>Li(fi)||(i?nv({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:b,participantId:fi}):void 0));a!==!1&&Object.assign(Jt.participant,{individualParticipants:kt})}}),!Qe.matchUpType){let{matchUpType:Jt}=Z$({matchUp:Qe});Jt&&Object.assign(Qe,{matchUpType:Jt})}if(b!=null&&b.inferGender&&(!Qe.gender||Qe.gender===ko)&&((Q=Qe.sides)==null?void 0:Q.length)===2&&Qe.matchUpType!==aa){let Jt=Qe.sides.map(Yi=>{var Ri,qi,hn,kt;if(xr(Mn)(Qe.matchUpType))return(qi=(Ri=Yi.participant)==null?void 0:Ri.person)==null?void 0:qi.sex;if(((kt=(hn=Yi.participant)==null?void 0:hn.individualParticipants)==null?void 0:kt.length)===2){let fi=Si(Yi.participant.individualParticipants.map(Xr=>{var Jr;return(Jr=Xr.person)==null?void 0:Jr.sex})).filter(Boolean);if(fi.length===1)return fi[0]}});if(Jt.filter(Boolean).length===2&&Si(Jt).length===1){let Yi=Jt[0];Qe.inferredGender=Yi}}}if(Qe.tieMatchUps){let Tt=Qe.matchUpStatus===fn,Li=(J=Qe.sides)==null?void 0:J.map(({participant:Jt,drawPosition:Yi,sideNumber:Ri,lineUp:qi})=>{let hn=Jt?.participantType===aa&&Jt;return{teamParticipant:hn&&Gt({participantRoleResponsibilities:hn.participantRoleResponsibilities,participantOtherName:hn.participanOthertName,participantName:hn.participantName,participantId:hn.participantId,teamId:hn.teamId}),drawPosition:Yi,sideNumber:Ri,lineUp:qi}});Qe.tieMatchUps=Qe.tieMatchUps.map(Jt=>{let Yi=Qe.matchUpId,Ri={finishingPositionRange:Qe.finishingPositionRange,abbreviatedRoundName:Se,roundNumber:Je,roundName:pt};return owe({tieDrawPositions:gt,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:Li,drawPositionsRanges:r,initialRoundOfPlay:o,roundNamingProfile:u,additionalContext:Ri,appliedPolicies:p,isCollectionBye:Tt,usePublishState:m,publishStatus:S,matchUpTieId:Yi,isRoundRobin:U,roundProfile:C,matchUp:Jt,event:N,tournamentParticipants:i,positionAssignments:n,tournamentRecord:c,seedAssignments:f,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:b,drawDefinition:I,scoringActive:w,structure:P,context:M})})}let bt=Qe.sides&&Qe.sides.filter(Tt=>Tt?.participantId).length===2,ci=!Qe.winningSide;if(Object.assign(Qe,{readyToScore:w&&bt&&ci,hasContext:!0}),bt){let{allParticipantsCheckedIn:Tt,checkedInParticipantIds:Li}=$0({matchUp:Qe});Object.assign(Qe,{allParticipantsCheckedIn:Tt,checkedInParticipantIds:Li})}return Array.isArray(b?.exclude)&&b?.exclude.forEach(Tt=>delete Qe[Tt]),Qe}function H4e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Wb({timeItems:i?.timeItems||[],itemType:cf});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{allocatedCourts:At(n,!1,!0)}:e}function z4e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Wb({timeItems:i?.timeItems||[],itemType:lv});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{courtId:n}:e}function q4e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Wb({timeItems:i?.timeItems||[],itemType:O0});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{venueId:n}:e}function Kf(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:n,isCollectionMatchUp:r,matchUpStatuses:a,hasWinningSide:s,matchUpFormats:o,roundPositions:l,matchUpFormat:u,collectionIds:c,isMatchUpTie:d,roundNumbers:p,matchUpIds:h,roundNames:f,filterMatchUpTypes:m=!0,filterMatchUpIds:g=!0,stageSequences:v,scheduledDates:y,scheduledDate:b,participantIds:I,processContext:S,tournamentIds:w,matchUpTypes:T,structureIds:U,readyToScore:C,courtIds:E,eventIds:P,venueIds:M,drawIds:R,stages:N}=t,A=Array.isArray(I)?I.filter(Boolean):[],_=Array.isArray(a)?a.filter(Boolean):[],x=Array.isArray(i)?i.filter(Boolean):[],O=Array.isArray(N)?N.filter(Boolean):[],$=Array.isArray(v)?v.filter(Boolean):[],F=Array.isArray(c)?c.filter(Boolean):[],j=Array.isArray(f)?f.filter(Boolean):[],H=Array.isArray(p)?p.filter(Boolean):[],G=Array.isArray(l)?l.filter(Boolean):[],W=Array.isArray(h)&&g?h.filter(Boolean):[],q=Array.isArray(T)&&m?T.filter(Boolean):[],Z=Array.isArray(E)?E.filter(Boolean):[],K=Array.isArray(M)?M.filter(Boolean):[],Q=Array.isArray(o)&&o.filter(Boolean)||typeof u=="string"&&[u]||[],J=Array.isArray(y)&&y.filter(Boolean)||typeof b=="string"&&b.length&&[b]||[],ne=Array.isArray(w)?w.filter(Boolean):[],re=Array.isArray(P)?P.filter(Boolean):[],oe=Array.isArray(R)?R.filter(Boolean):[],de=Array.isArray(U)?U.filter(Boolean):[];return e.filter(se=>{var ge;if(C&&!xr(hu)(se)&&!se.readyToScore||se.winningSide&&s&&![1,2].includes(se.winningSide)||d!==void 0&&(d&&!se.tieMatchUps||!d&&se.tieMatchUps)||r!==void 0&&(r&&!se.collectionId||!r&&se.collectionId)||O.length&&!O.includes(se.stage)||$.length&&!$.includes(se.stageSequence)||F.length&&(!se.collectionId||!F.includes(se.collectionId))||j.length&&(!se.roundName||!j.includes(se.roundName))||H.length&&(!se.roundNumber||!H.includes(se.roundNumber))||G.length&&(!se.roundPosition||!G.includes(se.roundPosition))||_.length&&(!se.matchUpStatus||!_.includes(se.matchUpStatus))||x.length&&se.matchUpStatus&&x.includes(se.matchUpStatus)||W.length&&!W.includes(se.matchUpId)||q.length&&(!se.matchUpType||!t$(q,se.matchUpType))||Q.length&&(!se.matchUpFormat||!Q.includes(se.matchUpFormat)))return!1;if(J!=null&&J.length){let{scheduledTime:ye}=swe({matchUp:se}),{scheduledDate:Te}=B0({matchUp:se}),De=Ci(ye)||Te;if(!J.find(xe=>af(xe,De)))return!1}if(Z.length){let{courtId:ye}=z4e({matchUp:se}),{allocatedCourts:Te}=H4e({matchUp:se}),De=Te?.map(({courtId:xe})=>xe);if(!Z.filter(Boolean).includes(ye)||De!=null&&De.includes(ye))return!1}if(K.length){let{venueId:ye}=q4e({matchUp:se});if(!K.filter(Boolean).includes(ye))return!1}if(S){if(ne.length&&!ne.includes(se.tournamentId)||re.length&&!re.includes(se.eventId)||oe.length&&!oe.includes(se.drawId)||de.length&&!de.includes(se.structureId))return!1;let ye=((ge=se.sides)==null?void 0:ge.map(({participantId:Te})=>Te).filter(Boolean))??[];if(n&&ye.length<n||A.length&&!A.some(Te=>ye.includes(Te)))return!1}return!0})}function vn(t){var e,i,n,r,a,s,o;let{provisionalPositioning:l,tournamentRecord:u,contextFilters:c,matchUpFilters:d,contextProfile:p,drawDefinition:h,context:f={},structure:m,inContext:g,event:v}=t,{seedAssignments:y,contextContent:b,exitProfiles:I,matchUpsMap:S}=t,w={},T={};if(!m)return{collectionPositionMatchUps:w,error:Fb,roundMatchUps:T,matchUps:[]};let U=Array.isArray(d?.eventIds)?d?.eventIds.filter(Boolean):[],C=Array.isArray(d?.structureIds)?d?.structureIds.filter(Boolean):[],E=Array.isArray(d?.drawIds)?d?.drawIds.filter(Boolean):[],P=!(f!=null&&f.eventId)||!(U!=null&&U.length)&&!((e=c?.eventIds)!=null&&e.filter(Boolean).length)||U?.includes(f.eventId)||((i=c?.eventIds)==null?void 0:i.includes(f.eventId)),M=!(C!=null&&C.length)||C.includes(m.structureId),R=!h||!(E!=null&&E.length)||E.includes(h.drawId);if(!P||!M||!R)return{collectionPositionMatchUps:w,roundMatchUps:T,matchUps:[]};p&&!b&&(b=Qm({tournamentRecord:u,contextProfile:p,drawDefinition:h}));let{appliedPolicies:N}=pn({drawDefinition:h}),A={...t.tournamentAppliedPolicies,...N,...t.policyDefinitions},_=(n=A?.scoring)==null?void 0:n.structures,x=m.stage&&((r=_?.stage)==null?void 0:r[m.stage]),O=m.stageSequence&&((a=x?.stageSequence)==null?void 0:a[m.stageSequence]),$=((s=A?.scoring)==null?void 0:s.requireAllPositionsAssigned)||x?.requireAllPositionsAssigned||O?.requireAllPositionsAssigned;S||(S=Cs({drawDefinition:h,structure:m}));let{positionAssignments:F,allPositionsAssigned:j}=xa({structure:m}),H=!$||j,{seedAssignments:G}=ec({provisionalPositioning:l,drawDefinition:h,structure:m});y=y??G;let{structureId:W}=m;I=I||h&&GIe({drawDefinition:h}).exitProfiles;let q=I?.[W],Z=q?.length&&(q[0].split("-").map(de=>parseInt(de)).reduce((de,se)=>de+se)||0),K=!!m.structures,Q=cb({matchUpsMap:S,structureId:W,inContext:g}),J=A?.[pU],ne=g4e({roundNamingPolicy:J,drawDefinition:h,structure:m,matchUps:Q}),{roundNamingProfile:re,roundProfile:oe}=ne;if(T=ne?.roundMatchUps??[],d&&(Q=Kf({matchUps:Q,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),g){let{sourceDrawPositionRanges:de}=h4e({drawDefinition:h,matchUpsMap:S,structureId:W}),se=h?f4e({drawDefinition:h,roundProfile:oe,matchUpsMap:S,structureId:W}).drawPositionsRanges:void 0,ge=t.tournamentParticipants,ye=t.participantMap;!(ge!=null&&ge.length)&&!ye&&u&&({participants:ge=[],participantMap:ye}=Gb({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:u,contextProfile:p,inContext:g})),Q=Q.map(Te=>owe({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:de,tournamentParticipants:ge,positionAssignments:F,drawPositionsRanges:se,initialRoundOfPlay:Z,roundNamingProfile:re,tournamentRecord:u,appliedPolicies:A,seedAssignments:y,contextContent:b,participantMap:ye,contextProfile:p,drawDefinition:h,scoringActive:H,isRoundRobin:K,roundProfile:oe,structure:m,context:f,matchUp:Te,event:v})),(Q?.filter(Te=>Array.isArray(Te.tieMatchUps))).forEach(Te=>{let De=Te.tieMatchUps;Q=Q.concat(...De)}),c&&(Q=Kf({processContext:!0,...c,matchUps:Q}))}else(Q?.filter(de=>Array.isArray(de.tieMatchUps))).forEach(de=>{let se=de.tieMatchUps;Q=Q.concat(...se)});return d&&(Q=Kf({matchUps:Q,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds)&&(Q=Kf({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:Q})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds||g)&&(T=bo({matchUps:Q}).roundMatchUps??[]),(o=Xs({drawDefinition:h,structure:m,event:v}))!=null&&o.tieFormat&&({collectionPositionMatchUps:w}=p4e({matchUps:Q})),{collectionPositionMatchUps:w,roundMatchUps:T,isRoundRobin:K,roundProfile:oe,matchUpsMap:S,matchUps:Q}}function Ny({matchUp:t}){return t?wa.includes(t?.matchUpStatus)||t?.winningSide:!1}function X$({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:n,hydrateParticipants:r,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:h,publishStatus:f,contextProfile:m,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structureId:b,inContext:I,structure:S,context:w,event:T}){!S&&b&&({structure:S}=ui({drawDefinition:g,structureId:b}));let U=vn({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:n,hydrateParticipants:r,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:u,contextFilters:c,contextContent:d,participantMap:p,scheduleTiming:h,publishStatus:f,contextProfile:m,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structure:S,inContext:I,context:w,event:T}),C=[],E=[],P=[],M=[],R=[];if(U.error)return U;let{matchUps:N}=U,{assignedPositions:A}=xa({structure:S}),_=A?.filter(O=>O.participantId).map(O=>O.drawPosition),x;return N.filter(O=>{var $;let F=(($=u?.matchUpTypes)==null?void 0:$.length)===1&&u.matchUpTypes[0]===zn;return!(O.matchUpType!==zn&&F)}).forEach(O=>{var $,F,j,H;if(O.matchUpStatus===ul){C.push(O);return}O.matchUpType===zn&&(x=!0);let G=O.collectionId,W=G&&(($=O.sides)==null?void 0:$.every(ne=>ne.participantId)),q=!G&&((F=O.drawPositions)==null?void 0:F.filter(Boolean).length)===2,Z=!G&&((j=O.drawPositions)==null?void 0:j.every(ne=>_?.includes(ne))),K=A?.filter(ne=>ne.bye).map(ne=>ne.drawPosition),Q=!G&&((H=O.drawPositions)==null?void 0:H.find(ne=>K?.includes(ne))),J=SIe.includes(O.matchUpStatus)&&(W||q&&(!t||Z));return Q?R.push(O):Ny({matchUp:O})?E.push(O):J?P.push(O):M.push(O)}),{includesTeamMatchUps:x,abandonedMatchUps:C,completedMatchUps:E,upcomingMatchUps:P,pendingMatchUps:M,byeMatchUps:R,structure:S}}function W4e({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:Lt};if(!i)return{error:Tu};let{links:n}=jD({drawDefinition:t,structureId:i}),r=n.source.reduce((s,o)=>!o.source.roundNumber||o.source.roundNumber===e?s.concat(o):s,[]),a=n.target.reduce((s,o)=>!o.target.roundNumber||o.target.roundNumber===e?s.concat(o):s,[]);return{links:{source:r,target:a}}}function CV({finishingPositions:t,linkCondition:e,linkType:i,source:n}){var r;let a=n.find(s=>{var o,l;let u=!((o=s.source)!=null&&o.finishingPositions)||!t||yo(t,(l=s.source)==null?void 0:l.finishingPositions);return e===s.linkCondition&&u&&s.linkType===i});return[Pm,sf].includes(a?.linkType)&&!((r=a?.source)!=null&&r.roundNumber)?pe({result:{error:Ce},stack:"getTargetLink",context:a}):a}function jD({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((n,r)=>{var a,s;return((a=r.source)==null?void 0:a.structureId)===e&&(!i||r.source.roundNumber===i)&&(n.source=n.source.concat(r)),((s=r.target)==null?void 0:s.structureId)===e&&(!i||r.target.roundNumber===i)&&(n.target=n.target.concat(r)),n},{source:[],target:[]})}:{error:Tu}:{error:Lt}}function Y4e({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:n}=e,r=t.filter(s=>s.roundNumber===i&&!s.matchUpTieId),a=t.filter(s=>s.roundNumber===i+1&&!s.matchUpTieId);if(a.length){let s;return a.length===r.length?s=a.find(o=>o.roundPosition===n):a.length===r.length/2&&(s=a.find(o=>o.roundPosition===Math.ceil(n/2))),{matchUp:s}}return{message:"no progression found"}}function RV({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:n,targetLink:r}){var a;if(!r)return{error:J6};let{target:{structureId:s,feedProfile:o,groupedOrder:l,roundNumber:u,positionInterleave:c}}=r,{structure:d}=ui({drawDefinition:n,structureId:s}),{positionAssignments:p}=Fn({structure:d}),h=(e?.filter(E=>E.structureId===d?.structureId)).filter(E=>E.roundNumber===u&&!E.matchUpTieId),f=h.length,m=Et(1,f+1),g=f/t,v=Math.ceil(g*i),y=1-i%2;if(c!=null&&c.interleave&&g!==.5){let E=c.offset+(i-1)*c.interleave,P=i+E;v=Math.ceil(P/2),y=1-P%2}let b=m,I=m[v-1],S=jIe({roundPositionsCount:m.length,groupedOrder:l}),w=S?.length||1;if(w<=m.length){let E=f/w,P=ka(m,E);o===sb&&P.forEach(M=>M.reverse()),b=S?.length&&S?.map(M=>P[M-1]).flat()||b}o===Oc?I=b[v-1]:o===sb?((!(S!=null&&S.length)||w>m.length)&&(v=h.length+1-v),I=b[v-1]):o===U$&&mu()&&console.log(h$,{feedProfile:o});let T=I&&h.reduce((E,P)=>P.roundPosition===I?P:E,void 0),U;T!=null&&T.feedRound?(y=0,U=Math.min(...(T.drawPositions||[]).filter(Boolean))):U=((a=T?.drawPositions)==null?void 0:a.length)===2&&T?.drawPositions[y];let C=p?.find(({drawPosition:E})=>E===U);if(C){let{extension:E}=ki({element:C,name:x$});if(E!=null&&E.value)return{disabledDrawPosition:U}}return{matchUp:T,targetDrawPosition:U,matchUpDrawPositionIndex:y}}function Io({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:n,matchUpId:r}){let a=i;t.length&&!a&&(a=t.find(o=>o.matchUpId===r));let{structure:s}=ui({structureId:a?.structureId,drawDefinition:n});return s?.finishingPosition===A0?K4e({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:n,structure:s,matchUp:a}):Z4e({matchUp:a})}function K4e({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:n,matchUp:r}){var a,s,o;let{winnerMatchUpId:l,loserMatchUpId:u}=r,{links:c}=W4e({roundNumber:r.roundNumber,structureId:n.structureId,drawDefinition:i}),d=c?.source,p=CV({source:d,linkType:Pm}),h=CV({linkCondition:qp,linkType:sf,source:d}),f=CV({source:d,linkType:sf}),m=h&&f;f||(f=h);let g=(a=p?.target)==null?void 0:a.feedProfile,v=(s=f?.target)==null?void 0:s.feedProfile,y=(o=h?.target)==null?void 0:o.feedProfile,b,I,S,w,T,U,C,E,P,M;if(e&&(l||u)&&(C=l&&g!==Pd&&t.find(({matchUpId:A})=>A===l),w=u&&v!==Pd&&t.find(({matchUpId:A})=>A===u),C||w))return{matchUp:r,targetLinks:{loserTargetLink:f,winnerTargetLink:p},targetMatchUps:{loserMatchUp:w,winnerMatchUp:C}};let{roundPosition:R}=r;M=M||t.filter(A=>A.structureId===n.structureId);let N=M.reduce((A,_)=>_.roundNumber===r.roundNumber&&!_.matchUpTieId?A+1:A,0);return f&&!w&&v!==Pd&&({matchUpDrawPositionIndex:U,targetDrawPosition:T,matchUp:w}=RV({targetLink:f,sourceRoundMatchUpCount:N,inContextDrawMatchUps:t,sourceRoundPosition:R,drawDefinition:i})),m&&y!==Pd&&({matchUpDrawPositionIndex:S,targetDrawPosition:I,matchUp:b}=RV({targetLink:h,sourceRoundMatchUpCount:N,inContextDrawMatchUps:t,sourceRoundPosition:R,drawDefinition:i})),p&&!C&&g!==Pd&&({matchUpDrawPositionIndex:P,targetDrawPosition:E,matchUp:C}=RV({targetLink:p,sourceRoundMatchUpCount:N,inContextDrawMatchUps:t,sourceRoundPosition:R,drawDefinition:i})),C||(M=M||t.filter(A=>A.structureId===n.structureId),{matchUp:C}=Y4e({structureMatchUps:M,matchUp:r})),Gt({matchUp:r,targetLinks:{loserTargetLink:f,winnerTargetLink:p,byeTargetLink:h},targetMatchUps:{winnerMatchUpDrawPositionIndex:P,loserMatchUpDrawPositionIndex:U,byeMatchUpDrawPositionIndex:S,winnerTargetDrawPosition:E,loserTargetDrawPosition:T,byeTargetDrawPosition:I,winnerMatchUp:C,loserMatchUp:w,byeMatchUp:b},targetMatchUpIds:!!(l||u)})}function Z4e({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function X4e({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(n=>{var r,a,s,o,l,u;let{matchUpId:c,structureId:d,drawPositions:p=[]}=n,{structure:h}=ui({drawDefinition:t,structureId:d});if(h?.finishingPosition===ob){let{roundNumber:f}=n,m=f&&ai(f)+1,g=h.matchUps??[],{roundMatchUps:v}=bo({matchUps:g});if(m&&v!=null&&v[m]){let y=[...p].sort(ra).map((b,I)=>{let S=v[m].find(w=>{var T;return(T=w.drawPositions)==null?void 0:T.includes(b)});return{matchUpId:S?.matchUpId,roundNumber:m,schedule:S?.schedule,sideNumber:I+1,structureName:h.structureName}});Object.assign(n,{sidesTo:y})}}else{let f=Io({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:n,drawDefinition:t,matchUpId:c}),{winnerMatchUp:m}=f.targetMatchUps,{loserMatchUp:g}=f.targetMatchUps;!n.winnerMatchUpId&&m&&(n.winnerMatchUpId=m.matchUpId),!n.loserMatchUpId&&g&&(n.loserMatchUpId=g.matchUpId);let v=MV({upcomingMatchUp:m}),y=MV({upcomingMatchUp:g});if(n.matchUpStatus!==fn&&g?.matchUpStatus===fn){let{matchUp:I}=lwe({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};y=I&&MV({upcomingMatchUp:I})||y}let b=(r=n.schedule)==null?void 0:r.timeAfterRecovery;if(b&&((a=v?.schedule)!=null&&a.scheduledTime&&an(v.schedule.scheduledTime)<an(b)&&(i[v.matchUpId]=n.matchUpId,v.schedule.scheduleConflict=n.matchUpId),(s=y?.schedule)!=null&&s.scheduledTime&&an(y.schedule.scheduledTime)<an(b)&&(i[y.matchUpId]=n.matchUpId,y.schedule.scheduleConflict=n.matchUpId)),Object.assign(n,{winnerTo:v,loserTo:y}),(o=n.drawPositions)==null?void 0:o.filter(Boolean).length){let I=((u=(l=f.targetLinks)==null?void 0:l.loserTargetLink)==null?void 0:u.linkCondition)===qp,S=J4e(n);if(S.length){let w=MH(m?.sides),T=MH(g?.sides),U=S.find(({participantId:E})=>w.includes(E))?[]:S,C=S.find(({participantId:E})=>T.includes(E))?[]:S;g&&I&&C.length<2&&C.push({bye:!0,tbd:!0}),U!=null&&U.length&&m&&(!f.targetMatchUpIds&&m&&(m=e.find(({matchUpId:E})=>E===m.matchUpId)),m.potentialParticipants||(m.potentialParticipants=[]),m.potentialParticipants.push(U)),C!=null&&C.length&&g&&(f.targetMatchUpIds||(m=e.find(({matchUpId:E})=>E===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(C))}}}}),Object.keys(i).length&&e.forEach(n=>{Object.keys(i).includes(n.matchUpId)&&(n.schedule.scheduleConflict=i[n.matchUpId])}),{scheduleConflictMatchUpIds:i}}function J4e(t){var e;return((e=t?.sides)==null?void 0:e.map(({participant:i,participantId:n,qualifier:r})=>i||n&&{participantId:n}||r&&{qualifier:r}).filter(Boolean))||[]}function lwe({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var n;let{matchUpId:r,matchUpStatus:a,structureId:s}=t||{};if(!t||!s||t?.matchUpStatus===Or)return{matchUp:t};if(a===fn){let o;return t.winnerMatchUpId?o=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:o}=((n=Io({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r}))==null?void 0:n.targetMatchUps)||{},lwe({matchUp:o,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function MV(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:s})=>({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:s}))(t.upcomingMatchUp)}function pa(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=GD(t);if(i.error)return pe({result:i,stack:e});let{abandonedMatchUps:n,completedMatchUps:r,upcomingMatchUps:a,pendingMatchUps:s,byeMatchUps:o,matchUpsMap:l}=i;return{matchUps:(n??[]).concat(...r??[],...a??[],...s??[],...o??[]),matchUpsMap:l}}function GD(t){if(!(t!=null&&t.drawDefinition))return{error:Lt};let{tournamentParticipants:e,contextContent:i,matchUpsMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,requireParticipants:s,participantsProfile:o,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:h,scheduleTiming:f,participantMap:m,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:b,inContext:I,context:S,event:w}=t,T=[],U=[],C=[],E=[],P=[];v&&!i&&(i=Qm({policyDefinitions:u,tournamentRecord:c,contextProfile:v,event:w}));let M;!(e!=null&&e.length)&&c&&(e=c?.participants,(I||o!=null&&o.withGroupings)&&e!=null&&e.length&&({participantsWithGroupings:e,groupInfo:M}=j$({participants:e,participantsProfile:o})));let{structures:R}=ud({drawDefinition:y});if(!R)return{error:pr};n||(n=Cs({drawDefinition:y}));let N=y&&GIe({drawDefinition:y}).exitProfiles;R.forEach(x=>{let{byeMatchUps:O=[],pendingMatchUps:$=[],upcomingMatchUps:F=[],completedMatchUps:j=[],abandonedMatchUps:H=[]}=X$({matchUpFilters:b?void 0:h,contextFilters:b?void 0:p,inContext:I||b||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,requireParticipants:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:f,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:N,matchUpsMap:n,structure:x,context:S,event:w});T=T.concat(...H),U=U.concat(...j),C=C.concat(...F),E=E.concat(...$),P=P.concat(...O)});let A=x=>(!h&&!b&&!p||(h&&(x=Kf({matchUps:x,...h})),p&&(x=Kf({matchUps:x,...p,processContext:!0}))),x),_={abandonedMatchUps:A(T),completedMatchUps:A(U),upcomingMatchUps:A(C),pendingMatchUps:A(E),byeMatchUps:A(P),matchUpsMap:n,...ue,groupInfo:M};if(b){let x=typeof b=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:O,completed:$,upcoming:F,pending:j,bye:H}=x,G=[].concat(...O&&T||[],...$&&U||[],...F&&C||[],...j&&E||[],...H&&P||[]);X4e({inContextDrawMatchUps:G,drawDefinition:y})}return _}function If(t){let{participants:e=[],contextContent:i,participantMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,inContext:g,context:v,event:y}=t;if(!y)return{error:Wn};let{eventId:b,eventName:I,endDate:S,eventType:w,category:T,gender:U,matchUpFormat:C}=y??{},E={...v,...Gt({indoorOutDoor:y.indoorOutdoor??c?.indoorOutdoor,surfaceCategory:y.surfaceCategory??c?.surfaceCategory,endDate:y.endDate??c?.endDate,tournamentId:c?.tournamentId,matchUpFormat:C,eventName:I,eventType:w,category:T,eventId:b,gender:U})};S&&(E.endDate=S),f&&!i&&(i=Qm({policyDefinitions:l,tournamentRecord:c,contextProfile:f,event:y}));let P;if(!(e!=null&&e.length)&&!n&&c){let N=Gb({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:f,inContext:g});n=N.participantMap,e=N.participants??[],P=N.groupInfo}let M=y.drawDefinitions??[],R=kM({tournamentRecord:c,event:y}).scheduleTiming;return{matchUps:M.flatMap(N=>{let{matchUps:A}=pa({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,context:E,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextFilters:p,contextProfile:f,drawDefinition:N,contextContent:i,matchUpFilters:h,participantMap:n,scheduleTiming:R,nextMatchUps:m,inContext:g,event:y});return A??[]}),groupInfo:P}}function Qa(t){let e=Yt(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:lt};let{participantMap:i,participants:n}=t,{scheduleVisibilityFilters:r,participantsProfile:a,afterRecoveryTimes:s,useParticipantMap:o,policyDefinitions:l,tournamentRecord:u,inContext:c=!0,usePublishState:d,contextProfile:p,matchUpFilters:h,contextFilters:f,nextMatchUps:m,context:g}=t,v=t.tournamentId??u.tournamentId,y=u?.events??[];n||({participants:n,participantMap:i}=Gb({participantsProfile:a,useParticipantMap:o,tournamentRecord:u,contextProfile:p,inContext:c}));let{appliedPolicies:b}=pn({tournamentRecord:u}),I={...g,tournamentId:v,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},S=Qm({policyDefinitions:l,tournamentRecord:u,contextProfile:p});return{matchUps:y.flatMap(w=>{var T;return I.eventDrawsCount=((T=w.drawDefinitions)==null?void 0:T.length)??0,If({context:I,scheduleVisibilityFilters:r,tournamentAppliedPolicies:b,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:S,contextFilters:f,contextProfile:p,matchUpFilters:h,participantMap:i,nextMatchUps:m,participants:n,inContext:c,event:w}).matchUps??[]}).concat(...u.matchUps??[])}}function Wd({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:n,policyDefinitions:r,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:u}){if(typeof n!="object"||!Object.keys(n).length)return{error:gr};let c=Object.keys(n).map(d=>{let p=n[d];return Qa({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:r,tournamentRecord:p,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:u}).matchUps??[]}).flat();return{...ue,matchUps:c}}function j0(t,e){return Q4e(t,e)||(t?.stageSequence||0)-(e?.stageSequence||0)||t?.roundNumber&&e.roundNumber&&t?.roundNumber-e?.roundNumber||(t?.roundPosition??0)-(e?.roundPosition??0)}function Q4e(t,e){return(Uw[t?.stage]||0)-(Uw[e?.stage]||0)}function ho(t){let{participants:e,participantMap:i,contextContent:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,matchUpFilters:d,contextFilters:p,contextProfile:h,drawDefinition:f,nextMatchUps:m,inContext:g,context:v,event:y}=t,{eventId:b,eventName:I,endDate:S,eventType:w,category:T,gender:U,matchUpFormat:C}=y??{},E={...v,surfaceCategory:y?.surfaceCategory??c?.surfaceCategory,indoorOutDoor:y?.indoorOutdoor??c?.indoorOutdoor,matchUpFormat:C,eventType:w,eventName:I,category:T,eventId:b,endDate:S,gender:U},P;return!(e!=null&&e.length)&&!i&&c&&({participants:e=[],participantMap:i,groupInfo:P}=Gb({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:h,inContext:g})),h&&!n&&(n=Qm({policyDefinitions:l,tournamentRecord:c,contextProfile:h,drawDefinition:f,event:y})),{...pa({context:E,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,drawDefinition:f,contextContent:n,contextFilters:p,contextProfile:h,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:g,event:y}),groupInfo:P}}function WI({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=At(t),n=e.split("."),r=[],a;o({targetElement:i,attributes:n});let s={value:a};return r.length&&(s.values=r),s;function o({targetElement:l,attributes:u=[],significantCharacters:c}){for(let[p,h]of u.entries())if(l!=null&&l[h]){let f=u.slice(p+1);f.length?Array.isArray(l[h])?l[h].forEach(m=>o({targetElement:m,attributes:f})):(l=l[h],d({targetElement:l,index:p})):(a||(a=l[h]),r.includes(l[h])||r.push(l[h]))}function d({targetElement:p,index:h}){if(p&&h===u.length-1&&["string","number"].includes(typeof p)){let f=c?p.slice(0,c):p;a?r.includes(f)||r.push(f):(a=f,r.push(f))}}}}var uwe=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(n=>{var r;return{[n]:(r=WI({element:e,accessor:n}))==null?void 0:r.value}})||typeof t=="object"&&Object.keys(t).map(n=>{var r;return{[n]:(r=WI({element:e,accessor:n}))==null?void 0:r.value}})||((i=typeof t=="string"&&WI({element:e,accessor:t}))==null?void 0:i.value)},Bl=uwe;function zM({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:n,roundLimit:r,matchUps:a,lucky:s,fmlc:o}){var l;if(!pc(a))return[];let{roundProfile:u,roundNumbers:c=[]}=bo({interpolate:!0,matchUps:a});n=n??Math.max(...c,0);let d=r?n-r:0,p=d&&((l=u?.[n-d])==null?void 0:l.matchUpsCount),h=u&&Object.values(u).map(Bl("matchUpsCount")),f=(v,y)=>{let b=Math.min(...v);p&&y&&b===1&&(b=p);let I=Math.max(...v);return e&&I>e&&(I=e),[b,I]},m=u&&Object.assign({},...c.map(v=>{let y=(n??0)+1-v-d,b=u[v].matchUpsCount,I={finishingPositionRange:{},finishingRound:y},S=h?.slice(v-1).reduce((R,N)=>R+(N||0),0),w=o&&v!==1,T=1+t+(w?i??0:0),U=1,C=Et(T,s?T+b*2:S+T+U),E=S+U-b,P=f(C.slice(E)),M=f(C.slice(0,E),!0);return I.finishingPositionRange={loser:P,winner:M},{[v]:I}})),g=mu({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let y=v.roundNumber&&m[v.roundNumber];g&&!y&&console.log({roundFinishingData:m,matchUp:v}),v.finishingRound=y?.finishingRound,v.finishingPositionRange=y?.finishingPositionRange}),a}function pb({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var n;if(!e)return{error:Lt};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=pa({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((n=e?.structures)==null?void 0:n.length)===1&&!(e!=null&&e.structures[0].structures)){let a=i?.drawMatchUps??[];zM({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:s,structureId:o}=a,l=Io({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:s}),{winnerMatchUp:u,loserMatchUp:c}=l.targetMatchUps,d=u?.matchUpId,p=c?.matchUpId,h=cb({matchUpsMap:i,structureId:o}).find(f=>f.matchUpId===s);if(h&&(d&&(r.winnerMatchUpIds[h.matchUpId]=d,Object.assign(h,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(r.loserMatchUpIds[h.matchUpId]=p,a.loserMatchUpId=p,h.loserMatchUpId=p,a.finishingPositionRange))){let f=c.finishingPositionRange&&[...a.finishingPositionRange.loser,...c.finishingPositionRange.loser],m=f&&[Math.min(...f),Math.max(...f)];a.finishingPositionRange.loser=m,h.finishingPositionRange.loser=m}}),{inContextDrawMatchUps:t,goesToMap:r}}function bd(t){var e;let i=uc(t),n=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:a,tournamentRecord:s,drawDefinition:o}=t;if(!Array.isArray(n))return{error:Km};if(!Array.isArray(r))return{error:Xd};let l=(e=t.matchUpIds)!=null&&e.length?t.matchUpIds:n.map(b=>b.matchUpId);if(!Array.isArray(l))return{error:U0};let u={},c={},d={},p={};s&&!Object.keys(i).length&&(i={[s.tournamentId]:s});let h=Object.values(i),f=h.reduce((b,I)=>b.concat(I.events??[]).map(S=>(S.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:b})=>b===Em),m=n;if(f.length){m=Wd({nextMatchUps:!0,tournamentRecords:i}).matchUps;let b=f.reduce((I,S)=>{var w,T;let U=(w=S.source)==null?void 0:w.structureId,C=(T=S.target)==null?void 0:T.structureId;return U&&C&&(d[C]=U),U&&!I.includes(U)&&I.push(U),I},[]);for(let I of b)u[I]=[];for(let I of m??[]){let S=I.containerStructureId||I.structureId;b.includes(S)&&u[S].push(I.matchUpId)}}let g=b=>{c[b]||(c[b]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},p[b]=[])},v=(b,I)=>{c[b].matchUpIds.forEach(S=>{c[I].matchUpIds.push(S)}),c[I].matchUpIds.push(b),c[b].dependentMatchUpIds.push(I),a&&c[b].participantIds.forEach(S=>c[I].participantIds.push(S))},y=b=>{let I=Object.keys(u).length;for(let S of b||[]){let{matchUpId:w,winnerMatchUpId:T,loserMatchUpId:U}=S;if(!l.length||l.includes(w)){if(g(w),a){let{individualParticipantIds:P}=V$(S);c[w].participantIds=P}T&&(g(T),v(w,T),p[T].push(w)),U&&(g(U),v(w,U),p[U].push(w)),c[w].sources.push(p[w]);let C=p[w].map(P=>c[P].sources[0]).flat(),E=p[w].map(P=>c[P].sources[1]).flat();if(c[w].sources.push(C,E),I){let P=S.containerStructureId||S.structureId,M=d[P];if(u[M])for(let R of u[M])g(R),v(R,w),p[R].push(w)}}}};if(o)pb({drawDefinition:o}),m!=null&&m.length||(m=ho({drawDefinition:o}).matchUps),y(m);else{if(m!=null&&m.length||(m=Wd({nextMatchUps:!0,tournamentRecords:i}).matchUps),!r.length){let b=h!=null&&h.length?h.map(({events:I=[]})=>I.map(({drawDefinitions:S=[]})=>S.map(({drawId:w})=>w))).flat(1/0):[];b&&(r=b)}for(let b of r){let I=m?.filter(S=>S.drawId===b).sort(j0);if(!(I!=null&&I.find(({roundPosition:S})=>!S))){let S=I?.find(({tournamentId:T})=>T),{drawDefinition:w}=jo({tournamentRecord:i[S?.tournamentId],drawId:b});w&&pb({drawDefinition:w})}y(I)}}return{positionDependencies:u,matchUpDependencies:c,sourceMatchUpIds:p,matchUps:m,...ue}}function Sa(t){var e,i;let n=t?.matchUp,r=t?.score||n?.score,a=(e=r?.sets)==null?void 0:e[0],{side1Score:s,side2Score:o,side1TiebreakScore:l,side2TiebreakScore:u,side1PointScore:c,side2PointScore:d}=a||{},p=s||o||l||u||c||d;return!!(((i=r?.sets)==null?void 0:i.length)>1||p)}function qM({matchUpStatus:t}){return IIe.includes(t)}function e5e({matchUpStatus:t}){return J7.includes(t)}function FH({matchUpStatus:t}){return wIe.includes(t)}function P8({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:n,score:r}){var a;let s=n?.find(({participantId:l})=>l),o=(a=i?.filter(P8))==null?void 0:a.length;return Sa({score:r})||o||e&&s||t&&e5e({matchUpStatus:t})&&![Wi,ln,vd].includes(t)}function WM(t){var e;let{drawDefinition:i,findContainer:n,structureId:r,event:a}=t,s=t.structure,o={isCollectionMatchUp:!1},{containedStructures:l}=VD({drawDefinition:i}),u=r?l[r]||[]:[];if(!s){let U=ui({drawDefinition:i,structureId:r});if(U.error)return U;s=n?U.containingStructure??U.structure:U.structure}if(Vo({structure:s}))return{structure:s,isAdHoc:!0,error:PD};let{matchUps:c}=pa({inContext:!0,matchUpFilters:o,drawDefinition:i,event:a}),d=c?.filter(U=>U.structureId===r||u.includes(U.structureId)),{matchUpDependencies:p}=bd({drawIds:[i.drawId],matchUps:c,drawDefinition:i}),h=[],f=[],m={},g=[];for(let U of c??[]){if(U.structureId===r||u.includes(U.structureId)){f.push(...U.drawPositions??[]);let C=U.roundNumber;for(let E of(U.drawPositions??[]).filter(Boolean))(!m[E]||C&&m[E]>C)&&(m[E]=C)}P8(U)&&(g.push(U),h.push(U.matchUpId,...((e=p?.[U?.matchUpId])==null?void 0:e.matchUpIds)||[]))}let v=Si(f.filter(Boolean)).sort(ra),y=Si(h),b=Si(d?.map(({matchUpId:U,drawPositions:C})=>y.includes(U)?C:[]).flat().filter(Boolean)).sort(ra),{positionAssignments:I}=Fn({drawDefinition:i,structure:s}),S=I?.filter(U=>U.bye).map(U=>U.drawPosition),w=I?.filter(U=>U.qualifier).map(U=>U.drawPosition),T=v?.filter(U=>!b.includes(U))||[];return{allDrawPositions:v,inContextStructureMatchUps:d,drawPositionInitialRounds:m,activeDependentMatchUpIds:y,qualifyingDrawPositions:w,inactiveDrawPositions:T,positionAssignments:I,activeDrawPositions:b,byeDrawPositions:S,activeMatchUps:g,structure:s}}function Cw({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&i?.includes(t)).map(({roundNumber:i})=>i).sort(ra)[0]}}var bg={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},C8=[];function ou(t,e){nr(t)&&(t={method:t}),(e||mu())&&C8.push(t)}function t5e(t){return C8.slice()}function i5e(t){let e=t5e().map(i=>{let{color:n,keyColors:r,method:a,newline:s}=i,o=Object.keys(bg).includes(n)?bg[n]:bg.cyan,l=Object.keys(i).filter(c=>!["color","keyColors","method","newline"].includes(c)).map(c=>{let d=r&&Object.keys(r).includes(c)&&bg[r[c]]?bg[r[c]]:bg.brightwhite;return`${bg.white}${c}: ${d}${i[c]}`}).join(", "),u=a?.length<15?"		":"	";return[s?`
`:"",o,a,u,bg.white,l,bg.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function n5e(){C8.length=0}function Eu({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUpsMap:a,structureId:s,structure:o,event:l}){var u,c,d;if(!n)return{error:Lt};if(o||({structure:o}=ui({drawDefinition:n,structureId:s})),!o)return{error:pr};s||({structureId:s}=o);let p="assignDrawPositionBye";ou({method:p,color:"cyan",drawPosition:r}),a||(a=Cs({drawDefinition:n}));let{positionAssignments:h}=Fn({structure:o}),{activeDrawPositions:f}=WM({drawDefinition:n,structureId:s});if((u=h?.find(M=>M.drawPosition===r))!=null&&u.bye)return{...ue};if(f!=null&&f.includes(r))return{error:i$};let m=h?.find(M=>M.drawPosition===r);if(!m)return{error:PD};let{filled:g,containsBye:v,assignedParticipantId:y}=r5e(m);if(v)return{...ue};if(g&&!v)return pe({result:{error:tU},stack:p});let b=pn({tournamentRecord:i,drawDefinition:n,event:l}).appliedPolicies??{},I=pa({inContext:!0,drawDefinition:n,matchUpsMap:a}).matchUps??[],S={isCollectionMatchUp:!1},{matchUps:w}=vn({provisionalPositioning:t,drawDefinition:n,matchUpFilters:S,matchUpsMap:a,structure:o});if(h?.forEach(M=>{M.drawPosition===r&&(M.bye=!0)}),o.structureType===Eo)return a5e({tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUps:w}),ov({tournamentId:i?.tournamentId,drawDefinition:n,structure:o,event:l}),SQ({assignedParticipantId:y,isPositionAction:e,appliedPolicies:b,drawDefinition:n,drawPosition:r,structureId:s,stack:p});let{roundProfile:T,roundMatchUps:U}=bo({matchUps:w}),C=(c=T&&Object.keys(T).map(M=>parseInt(M)).reverse())==null?void 0:c.find(M=>{var R;return(R=T?.[M].drawPositions)==null?void 0:R.includes(r)}),E=C?U?.[C].find(({drawPositions:M})=>M?.includes(r)):void 0;E&&cwe({tournamentRecord:i,drawDefinition:n,matchUp:E,event:l});let P=(d=E?.drawPositions)==null?void 0:d.find(M=>M!==r);if(E&&P){let M=R8({sourceDrawPositions:E.drawPositions,matchUpId:E.matchUpId,inContextDrawMatchUps:I,drawPositionToAdvance:P,tournamentRecord:i,drawDefinition:n,matchUpsMap:a});if(M.error)return M}return ov({tournamentId:i?.tournamentId,drawDefinition:n,structure:o,event:l}),SQ({assignedParticipantId:y,isPositionAction:e,appliedPolicies:b,drawDefinition:n,drawPosition:r,structureId:s,stack:p})}function SQ({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:n,drawPosition:r,structureId:a,stack:s}){return e&&B$({appliedPolicies:i,drawDefinition:n,positionAction:{removedParticipantId:t,drawPosition:r,structureId:a,name:s}}),pe({result:{...ue},stack:s})}function r5e(t){let e=t.bye,i=t.qualifier,n=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:n,filled:e||i||n}}function cwe({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:n,event:r}){Object.assign(n,{matchUpStatus:fn,score:void 0,winningSide:void 0}),Xi({tournamentId:t?.tournamentId,eventId:i??r?.eventId,context:"setMatchUpStatusBye",drawDefinition:e,matchUp:n})}function a5e({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:n,event:r}){n.forEach(a=>{var s;(s=a.drawPositions)!=null&&s.includes(i)&&cwe({eventId:r?.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function R8({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,matchUpsMap:a,matchUpId:s,event:o}){var l,u;ou({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let c=a.drawMatchUps.find(S=>S.matchUpId===s),d=(l=e.find(S=>S.matchUpId===s))==null?void 0:l.structureId,{structure:p}=ui({drawDefinition:r,structureId:d}),{positionAssignments:h}=Fn({structure:p}),f=h?.filter(S=>S.bye).map(S=>S.drawPosition),m=(u=c?.drawPositions)==null?void 0:u.find(S=>S!==t),g=m&&f?.includes(m),{targetLinks:{loserTargetLink:v},targetMatchUps:{loserMatchUp:y,winnerMatchUp:b,loserTargetDrawPosition:I}}=Io({inContextDrawMatchUps:e,drawDefinition:r,matchUpId:s});if(b&&b.structureId===p?.structureId&&s5e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:b,matchUpsMap:a,event:o}),y&&g&&y.structureId!==p?.structureId){let{roundNumber:S}=y;if(S===1){let w=Eu({structureId:v.target.structureId,drawPosition:I,tournamentRecord:n,drawDefinition:r,event:o});if(w.error)return w}else dwe({loserTargetDrawPosition:I,tournamentRecord:n,loserTargetLink:v,drawDefinition:r,loserMatchUp:y,matchUpsMap:a,event:o})}return{...ue}}function s5e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:a,matchUpsMap:s,event:o}){var l,u,c,d,p,h;let f="advanceWinner",m=s.drawMatchUps.find(F=>F.matchUpId===a.matchUpId),g=(l=e.find(F=>F.matchUpId===a.matchUpId))==null?void 0:l.structureId,{structure:v}=ui({drawDefinition:r,structureId:g}),{positionAssignments:y}=Fn({structure:v}),b=(u=y?.find(({drawPosition:F})=>F===t))==null?void 0:u.bye,I=(c=m.drawPositions)==null?void 0:c.filter(Boolean),S=y?.filter(F=>I?.includes(F.drawPosition)),w=y?.find(({drawPosition:F})=>F===t),T=i?.find(F=>F!==t),U=(d=T&&S?.find(({drawPosition:F})=>F===T))==null?void 0:d.bye,C=b&&U;if(C&&console.log({isByeAdvancedBye:C}),I?.length>1&&b&&!U)return pe({result:{error:tU},stack:f});let E=I?.find(F=>F!==t),P=C,M=[...(m.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),R=M.map(F=>!F&&!P||F===t?(P=!0,t):F).sort(ra);if(!P)return console.log("@@@@@@@",{advancingAssignmentIsBye:w,drawPositionToAdvance:t,existingAssignments:S}),pe({result:{error:tU},stack:f});let N=(p=y?.find(({drawPosition:F})=>F===E))==null?void 0:p.bye,A=(h=y?.find(({drawPosition:F})=>F===t))==null?void 0:h.bye;Object.assign(m,{matchUpStatus:A||N?fn:Or,score:void 0,winningSide:void 0,drawPositions:R});let _=m.drawPositions.find(F=>!M.includes(F));ou({method:f,color:"brightyellow",changedDrawPosition:_,pairedDrawPositionIsBye:N,drawPositionIsBye:A}),Xi({tournamentId:n?.tournamentId,matchUp:m,eventId:o?.eventId,context:f,drawDefinition:r});let{targetLinks:{loserTargetLink:x},targetMatchUps:{loserMatchUp:O,loserTargetDrawPosition:$}}=Io({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(N||A){let F=N?t:E;if(F)R8({drawPositionToAdvance:F,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,matchUpsMap:s});else if(A&&x&&O)if(O.feedRound)dwe({loserTargetDrawPosition:$,tournamentRecord:n,loserTargetLink:x,drawDefinition:r,loserMatchUp:O,matchUpsMap:s});else{let j=1-a.roundPosition%2,H=O.drawPositions[j],G=Eu({structureId:x.target.structureId,drawPosition:H,tournamentRecord:n,drawDefinition:r,event:o});if(G.error)return G}}}function dwe({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:s}){let{roundNumber:o}=r;ou({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=(a?.mappedMatchUps||{})[r.structureId].matchUps,{initialRoundNumber:u}=Cw({drawPosition:t,matchUps:l});if(u===o){let c=Eu({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:n,event:s});if(c.error)return c}}function pwe({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:r,event:a}){let{matchUps:s}=vn({drawDefinition:i,matchUpsMap:n,structure:r,event:a});s.forEach(o=>{let l=t.filter(({drawPosition:u})=>{var c;return(c=o.drawPositions)==null?void 0:c.includes(u)}).filter(u=>u.bye).length;o.winningSide||(Object.assign(o,{matchUpStatus:l?fn:Or}),Xi({tournamentId:e?.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a?.eventId,drawDefinition:i,matchUp:o}))})}function YM(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:n}=t,{tournamentRecord:r,drawDefinition:a,structureId:s,matchUpsMap:o,event:l}=t,{structure:u}=ui({drawDefinition:a,structureId:s}),c=(xa({drawDefinition:a,structure:u}).positionAssignments||[]).find(p=>i&&p.participantId===i||n&&p.drawPosition===n);if(c&&i&&!n&&(n=c?.drawPosition),!n)return{error:CD};i||(i=c?.participantId);let{activeDrawPositions:d}=WM({drawDefinition:a,structureId:s});return d.includes(n)?{error:i$}:(e||({matchUps:e}=pa({inContext:!0,drawDefinition:a,matchUpsMap:o})),$H({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,structureId:s,drawPosition:n,matchUpsMap:o,event:l}).drawPositionCleared?(ov({tournamentId:r?.tournamentId,drawDefinition:a,structure:u,event:l}),{...ue,participantId:i}):{error:Ove})}function $H({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:a,event:s}){var o,l;let{structure:u}=ui({drawDefinition:i,structureId:a});if(!u)return{error:pr};let c=xa({drawDefinition:i,structure:u}).positionAssignments||[],d=c.some(b=>{if(b.drawPosition===n)return delete b.participantId,delete b.qualifier,delete b.bye,!0});if(u.structureType===Eo)return pwe({positionAssignments:c,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:u}),{drawPositionCleared:d,...ue};let p={isCollectionMatchUp:!1},{matchUps:h}=vn({drawDefinition:i,matchUpFilters:p,matchUpsMap:r,structure:u,event:s}),{roundProfile:f,roundMatchUps:m}=bo({matchUps:h}),g=(o=f&&Object.keys(f))==null?void 0:o.map(b=>ai(b)),v=n,y=(l=g?.map(b=>{var I,S,w,T;let U=(S=(I=f?.[b])==null?void 0:I.pairedDrawPositions)==null?void 0:S.find(_=>_.includes(v)),C=U?.find(_=>_!==v),E=c.find(_=>_.drawPosition===C),P=f?.[b+1],M=E?.bye,R=(w=P?.pairedDrawPositions)==null?void 0:w.find(_=>_.includes(C)),N=M&&R&&P&&((T=P.drawPositions)==null?void 0:T.includes(C)),A=U&&{pairedDrawPositionByeAdvancedPair:!N&&R,pairedDrawPosition:C,targetDrawPosition:v,relevantPair:U,roundNumber:b};return N&&(v=C),A}).filter(b=>b?.targetDrawPosition))==null?void 0:l.reduce((b,I)=>{let{roundNumber:S,relevantPair:w,targetDrawPosition:T,pairedDrawPosition:U,pairedDrawPositionByeAdvancedPair:C}=I,E={roundNumber:S,targetDrawPosition:T,relevantPair:w},P=C&&{roundNumber:S+1,targetDrawPosition:U,relevantPair:C,subsequentRoundRemoval:!0},M=[E,P].filter(Boolean);return b.concat(...M)},[]);return y?.forEach(({roundNumber:b,targetDrawPosition:I,relevantPair:S})=>{let w=m?.[b].find(T=>{var U;return yo((U=T.drawPositions)==null?void 0:U.filter(Boolean),S.filter(Boolean))});w&&(o5e({inContextDrawMatchUps:t,targetDrawPosition:I,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:b,matchUpsMap:r}),hwe({inContextDrawMatchUps:t,positionAssignments:c,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:n,matchUpsMap:r,structure:u,event:s}))}),{tasks:y,drawPositionCleared:d,positionAssignments:c}}function o5e({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,roundNumber:a,structureId:s}){let{structure:o}=ui({drawDefinition:n,structureId:s});if(!o)return{error:pr};if(o.structureType===Eo)return;r=r||Cs({drawDefinition:n});let l=(r?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:u}=Cw({drawPosition:e,matchUps:l}),c=l?.filter(p=>{var h;return p.roundNumber>=a&&p.roundNumber!==u&&((h=p.drawPositions)==null?void 0:h.includes(e))}),d=Fn({drawDefinition:n,structureId:s}).positionAssignments??[];return c?.forEach(p=>hwe({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,structure:o})),{...ue}}function hwe({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:n,targetMatchUp:r,drawPosition:a,matchUpsMap:s,structure:o,event:l}){var u,c,d,p,h;let f="removeDrawPosition",m=(u=r.drawPositions)==null?void 0:u.slice(),g=r.matchUpStatus,v=r.winningSide;s=s??Cs({drawDefinition:n});let y=s.mappedMatchUps[o.structureId].matchUps,{initialRoundNumber:b}=Cw({drawPosition:a,matchUps:y});if(r.roundNumber&&b&&r.roundNumber>b){let M=(r.drawPositions??[]).map(R=>R===a?void 0:R);r.drawPositions=M}if(r.matchUpType===zn){let M=(((c=t?.find(R=>R.matchUpId===r.matchUpId))==null?void 0:c.sides)??[]).reduce((R,N,A)=>N.drawPosition===a?A:R,void 0);M!==void 0&&(p=(d=r.sides)==null?void 0:d[M])!=null&&p.lineUp&&((h=r.sides)==null||delete h[M].lineUp,Xi({tournamentId:i?.tournamentId,context:`${f}-TEAM`,eventId:l?.eventId,matchUp:r,drawDefinition:n}))}let I=Io({matchUpId:r.matchUpId,inContextDrawMatchUps:t,drawDefinition:n}),{targetLinks:{winnerTargetLink:S},targetMatchUps:{loserMatchUp:w,winnerMatchUp:T,loserMatchUpDrawPositionIndex:U}}=I,C=e.filter(({drawPosition:M})=>{var R;return(R=r.drawPositions)==null?void 0:R.includes(M)}).filter(M=>M.bye).length,E=C&&fn||r.matchUpStatus&&[Wi,ln].includes(r.matchUpStatus)&&r.matcHUpStatus||Or;r.matchUpStatus=E,r.matchUpStatus&&[ln,Wi].includes(r.matchUpStatus)&&(r.winningSide=void 0);let P=m?.find(M=>{var R;return!((R=r.drawPositions)!=null&&R.includes(M))});if(m!=null&&m.includes(a)&&g===r.matchUpStatus&&v===r.winningSide||(P&&ou({method:f,color:"brightyellow",removedDrawPosition:P}),Xi({tournamentId:i?.tournamentId,context:`${f}-${a}`,eventId:l?.eventId,matchUp:r,drawDefinition:n})),w&&w.structureId!==I.matchUp.structureId&&!C){let{drawPositions:M,roundNumber:R}=w;if(R===1){let N=M[U];$H({structureId:w.structureId,drawPosition:N,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:s})}else{let N=Math.min(...M.filter(Boolean)),A=l5e({loserMatchUpDrawPosition:N,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,loserMatchUp:w,matchUpsMap:s,event:l});if(A.error)return pe({result:A,stack:f});let _=(s?.mappedMatchUps||{})[w.structureId].matchUps,{initialRoundNumber:x}=Cw({drawPosition:N,matchUps:_});x===1&&(ou({method:f,color:"brightyellow",loserMatchUpDrawPosition:N}),$H({structureId:w.structureId,drawPosition:N,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:s}))}}return T&&T.structureId!==I.matchUp.structureId&&S.target.feedProfile,{...ue}}function l5e({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:s}){var o;let{structure:l}=ui({structureId:r.structureId,drawDefinition:n}),{positionAssignments:u}=Fn({structure:l});if((o=u?.find(c=>c.drawPosition===t))!=null&&o.bye){let c=YM({drawPosition:t,structureId:r.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:a,event:s});if(c.error)return c}return{...ue}}function Yb({drawDefinition:t,stages:e}){if(!t)return{error:Lt};let i=(t?.structures??[]).filter(r=>!(e!=null&&e.length)||r.stage&&e.includes(r.stage)),n=Si(i.map(r=>{let{positionAssignments:a}=Fn({structure:r});return a?a.map(Gi):[]}).flat().filter(Boolean));return{...ue,assignedParticipantIds:n}}function Ld(t){let e=(t?.entries??[]).filter(Boolean).reduce((n,r)=>{let{entryStage:a,entryStatus:s}=r,o=`_${a||_t}${s||""}`;return n[o]||(n[o]=[]),n[o].push(r),n},{}),i=n=>isNaN(n)?1/0:n;return Object.keys(e).map(n=>e[n].sort((r,a)=>i(r.entryPosition)-i(a.entryPosition)).map((r,a)=>{let s=a+1;return{...r,entryPosition:s}})).flat()}function py(t){return[zb,dc].includes(t)}function yx({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:n,participantIds:r,entryStatus:a,entryStage:s,extension:o,eventSync:l,drawId:u,stage:c,event:d}){var p,h,f,m,g,v,y,b,I,S,w,T;if(!r||!Array.isArray(r))return{error:Hd,method:"modifyEntriesStatus",participantIds:r};if(!n&&!d)return{error:Wn};if(a&&!VIe.includes(a))return{error:wH};if(s&&!w$.includes(s))return{error:$b};let U="modifyEntriesStatus",C=[];if(!a&&!o)return pe({result:{error:Xt},info:"Missing entryStatus",stack:U});if(o&&!Wp({extension:o,requiredAttributes:["name"]}))return pe({result:{error:Ce},info:"Invalid extension",context:{extension:o},stack:U});let E=[];(p=d?.drawDefinitions)==null||p.forEach(j=>{let H=Yb({stages:c&&[c],drawDefinition:j}).assignedParticipantIds??[];E.push(...H)});let P=i?.participants??[];if(!r.every(j=>{var H;let G=(H=nv({tournamentParticipants:P,participantId:j}))==null?void 0:H.participantType;return!(G&&[Ai,xo].includes(G)&&py(a))&&!(a&&d!=null&&d.eventType&&G===Hi&&[Ju,Fl].includes(d.eventType)&&[Xc,...R_].includes(a))}))return{error:wH};let M=d&&Rr({event:d}).flightProfile,R=(h=M?.flights)==null?void 0:h.find(j=>j.drawId===u),N=j=>{let H=(j||[]).filter(W=>!c||!W.entryStage||c===W.entryStage).filter(({participantId:W})=>r.includes(W)),G=W=>a&&E.includes(W.participantId)&&!(R_.includes(W.entryStatus)&&R_.includes(a));return H.every(W=>G(W)&&!e?!1:(a&&(W.entryStatus=a,delete W.entryPosition),s&&(W.entryStage=s,delete W.entryPosition),o&&(o.value?dn({element:W,extension:o}):po({element:W,name:o.name})),!0))?{...ue}:{error:ND}},A=({flight:j,drawDefinition:H})=>{d&&(d.entries=Ld({entries:d.entries??[]})),j&&(j.drawEntries=Ld({entries:j.drawEntries})),H&&(H.entries=Ld({entries:H.entries}))},_=j=>{let{flight:H,drawDefinition:G}=j,W="updateDrawEntries";if(H){let q=N(H.drawEntries);if(q.error)return pe({result:q,stack:W})}if(G){let q=N(G.entries);if(q.error)return pe({result:q,stack:W});C.includes(G.drawId)||C.push(G.drawId)}return{...ue}},x=((f=d?.entries)==null?void 0:f.find(({entryPosition:j})=>j))??(((m=R?.drawEntries)==null?void 0:m.find(({entryPosition:j})=>j))||((g=n?.entries)==null?void 0:g.find(({entryPosition:j})=>j)));if(t&&!x&&A({flight:R,drawDefinition:n}),R||n){let j=_({flight:R,drawDefinition:n});if(j.error)return pe({result:j,stack:U})}let O=((v=d?.drawDefinitions)==null?void 0:v.map(({drawId:j})=>j))??[],$=((y=M?.flights)==null?void 0:y.filter(j=>!O.includes(j.drawId)))||[];for(let j of $){let H=j&&_({flight:j});if(H!=null&&H.error)return pe({result:H,stack:U})}let F=((b=M?.flights)==null?void 0:b.length)===1&&(((I=d?.drawDefinitions)==null?void 0:I.length)??0)<=((S=M?.flights)==null?void 0:S.length);if(!R&&!n&&a&&BIe.includes(a))return{error:Iye};if(!R&&!n||a===uf||l&&F){let j=N(d?.entries);if(j!=null&&j.error)return pe({result:j,stack:U});let H;if(a===uf&&((w=M?.flights)==null||w.every(G=>{let W=N(G.drawEntries);return W.error?(H=W.error,!1):(G.drawEntries=G.drawEntries.filter(({participantId:q})=>!r.includes(q)),!0)}),(T=d?.drawDefinitions)==null||T.every(G=>{var W;let q=N(G.entries);return q.error?(H=q.error,!1):(G.entries=(W=G.entries)==null?void 0:W.filter(({participantId:Z})=>!r.includes(Z)),!0)})),H)return pe({result:{error:H},stack:U})}t&&A({flight:R,drawDefinition:n});for(let j of d?.drawDefinitions??[])C.length&&!C.includes(j.drawId)||Bn({tournamentId:i.tournamentId,eventId:d?.eventId,drawDefinition:j});return{...ue}}function $h({requireTimeStamp:t,scaleAttributes:e,participant:i}){var n,r;if(!i)return{error:P0};if(!Qi(e))return{error:Ce};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:s,eventType:o,scaleName:l}=e,u=[lb,s,o,l].join("."),c=i.timeItems.filter(d=>d?.itemType===u).filter(d=>!t||d?.itemDate).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(c){let[d,p,h,f]=((n=c.itemType)==null?void 0:n.split("."))??[];if(d!==lb)return{error:ww};let m=((r=a&&WI({element:c.itemValue,accessor:a}))==null?void 0:r.value)||c.itemValue,g={eventType:h,scaleDate:c.itemDate,scaleValue:m,scaleName:f,scaleType:p};return{...ue,scaleItem:g}}}return{...ue,scaleItem:void 0}}function u5e({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:n,event:r}){var a,s,o;let l={},u=h=>[lb,Lh,r.eventType,h].join("."),c=Object.assign({},...(n.timeItems||[]).filter(({itemType:h})=>h.split(".")[1]===Lh).map(({itemType:h,itemValue:f})=>({[h]:f}))),d=(t?.stageSeedingScaleNames&&Object.values(t?.stageSeedingScaleNames)||Array.isArray(t?.seedingScaleNames)&&t.seedingScaleNames||[]).map(u),p=Pr(Object.keys(c),d);if((!e||!Object.keys(c).length&&!((a=t?.drawIds)!=null&&a.length)||p.length)&&p.length){if(t!=null&&t.stageSeedingScaleNames){let h=Object.keys(t.stageSeedingScaleNames).map(m=>{let g=u(t.stageSeedingScaleNames[m]),v=c[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);l.seedAssignments=f}else if(p){let h=p.map(f=>c[f]);l.seedValue=h.pop()}}else if(!e&&typeof i=="object"){let h=Object.keys(i).map(m=>{let g=u(i[m]),v=c[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);l.seedAssignments=f}else{let{categoryName:h,ageCategoryCode:f}=r.category||{},m=[f,r.eventId,h].filter(Boolean),g;for(let v of m){let y={eventType:r.eventType,scaleType:Lh,scaleName:v},b=$h({scaleAttributes:y,participant:n});if(b.scaleItem){g=b.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((o=(s=t?.published)==null?void 0:s.drawIds)!=null&&o.length))){let v=g.scaleValue;l.seedValue=v}}return l}function c5e({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:n,seedValue:r,eventId:a,ranking:s,entry:o}){let{entryStatus:l,entryStage:u,entryPosition:c,extensions:d}=o,p=d!=null&&d.length&&t?Object.assign({},...M7(d??[])):{},h=Object.assign(p,{entryPosition:c,entryStatus:l,entryStage:u,ranking:s,eventId:a});i.events[a]=Gt(h,!1,!1,!0),n&&(e&&(i.events[a].seedAssignments=e),r&&(i.events[a].seedValue=r))}function fwe(t){let{participantMap:e,participantId:i,matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:u,schedule:c,drawId:d,score:p}=t;!c||!Object.keys(c).length||n===fn||e[i].scheduleItems.push({...c,scheduledDate:Ci(c?.scheduledDate),scheduledTime:er(c?.scheduledTime),checkScoreHasValue:Sa({score:p}),matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:u,drawId:d})}function KM(t){var e,i,n;let r=Yt(t,[{[Ta]:!0}]);if(r.error)return r;let{tournamentRecord:a,status:s=Du}=t,o=`${Lv}.${Fv}`;return At((n=(i=(e=G$({tournamentRecord:a,itemType:o}))==null?void 0:e.timeItem)==null?void 0:i.itemValue)==null?void 0:n[s],!1,!0)}function d5e(t){let{tournamentId:e}=t??{};return!!e}function hc({event:t,status:e=Du}){var i,n,r;let a=`${Lv}.${Fv}`;return(r=(n=(i=_M({itemType:a,event:t}))==null?void 0:i.timeItem)==null?void 0:n.itemValue)==null?void 0:r[e]}function M8({drawDetails:t,drawId:e}){var i,n;return(n=(i=t?.[e])==null?void 0:i.publishingDetail)==null?void 0:n.published}function G0(t){var e,i,n,r,a,s,o,l,u;let{tournamentRecord:c,drawDefinition:d,eventIds:p,eventId:h,drawIds:f,drawId:m,event:g}=t??{};if(c&&!d5e(c))return{error:Ce};if(h&&!g)return{error:Xu};if(Array.isArray(p)&&p!=null&&p.length){let I={};for(let S of p){if(!nr(S))return{error:Ce};let w=(e=jo({tournamentRecord:c,eventId:S}))==null?void 0:e.event;if(!w)return{error:Xu};let T=NV({event:w});I[S]=T}return{...ue,publishState:I}}if(g){let I=NV({event:g}),S={};if(m)return d?{publishState:{status:{published:!!((i=I.status.publishedDrawIds)!=null&&i.includes(m)),drawDetail:(n=I.status.drawDetails)==null?void 0:n[m]},...ue}}:{error:fu};if(Array.isArray(f)&&f!=null&&f.length){let w=((r=g.drawDefinitions)==null?void 0:r.map(JC))??[];for(let T of f){if(!nr(T))return{error:Ce};if(!w.includes(T))return{error:fu};S[T]={status:{published:!!I.status.publishedDrawIds.includes(T),drawDetail:(a=I.status.drawDetails)==null?void 0:a[T]}}}}else S=I;return{...ue,publishState:S}}let v=[],y=!1,b={};for(let I of c?.events??[]){let S=NV({event:I});b[I.eventId]=S,S.status.published&&(v.push(I.eventId),y=!0);for(let{drawId:w}of I.drawDefinitions??[]){let T=(o=(s=S.status)==null?void 0:s.publishedDrawIds)==null?void 0:o.includes(w);T&&(b[w]={status:{published:T}})}}if(c){let I=KM({tournamentRecord:c});b.tournament=I??{},((l=I?.orderOfPlay)!=null&&l.published||(u=I?.participants)!=null&&u.published)&&(y=!0),b.tournament.status={published:y,publishedEventIds:v}}return{...ue,publishState:b}}function NV({event:t}){var e;let i=hc({event:t});if(!i)return{status:{published:!1}};let n={published:void 0,seedingScaleNames:[],drawIds:[]};i.seeding&&Object.assign(n,i.seeding);let r=i.drawDetails??{};for(let l of((e=t.drawDefinitions)==null?void 0:e.map(JC))||[])r[l]||(r[l]={publishingDetail:{published:!1}});let a=r&&Object.keys(r).length&&Object.keys(r).filter(l=>M8({drawDetails:r,drawId:l})),s=a!=null&&a.length?a:i.drawIds??[];if(s!=null&&s.length&&!(a!=null&&a.length))for(let l of s)r[l]={publishingDetail:{published:!0}};let o=s?.length>0;return{status:{publishedDrawIds:s,publishedSeeding:n,drawDetails:r,published:o}}}function J$(t,e){return(t||"").localeCompare(e||"")}function p5e({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:n,matchUpStatus:r,participantId:a,stageSequence:s,roundNumber:o,structureId:l,matchUpId:u,drawId:c,stage:d}){let p=e[a],h=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:s,winCount:0,structureId:l,drawId:c});let f=p.structureParticipation[l],{winner:m,loser:g}=t,v=n?m:g;n&&(f.winCount+=1,r===ln&&(f.walkoverWinCount+=1),r===Wi&&(f.defaultWinCount+=1)),v&&(!f.finishingPositionRange||h(v)<h(f.finishingPositionRange))&&(f.finishingPositionRange=v),i&&((!f.finishingRound||i<f.finishingRound)&&(f.finishingMatchUpId=u,f.finishingRound=i,f.roundNumber=o),i===1&&(f.participantWon=n))}function TQ(t){var e,i,n,r,a,s,o,l,u,c;let{withScheduleItems:d,scheduleAnalysis:p,withTeamMatchUps:h,participantMap:f,withOpponents:m,withMatchUps:g,withEvents:v,withDraws:y,finishingPositionRange:b,finishingRound:I,matchUpStatus:S,stageSequence:w,roundNumber:T,structureId:U,score:C,stage:E,withRankingProfile:P,tieWinningSide:M,roundPosition:R,matchUpTieId:N,matchUpSides:A,collectionId:_,matchUpType:x,winningSide:O,matchUpId:$,schedule:F,eventId:j,drawId:H,sides:G}=t,W=m&&G?.length===2&&Object.assign({},...G.map(({sideNumber:q},Z)=>{let K=G[1-Z].participantId;return q&&{[q]:K}}).filter(Boolean));for(let q of G){let{participantId:Z,sideNumber:K,bye:Q}=q;if(Q)continue;let J=O===K,ne=de=>{var se,ge;let ye=(se=f[de])==null?void 0:se.participant,Te=ye?.participantType,De=[{participantId:de,participantType:Te}];if(Te!==xo)for(let xe of ye?.individualParticipantIds||[]){let Me=(ge=f[xe])==null?void 0:ge.participant;De.push({participantType:Me?.participantType,participantId:xe})}return De},re=(de,se)=>{if(g){if(f[de].matchUps[$]={participantWon:J,matchUpType:x,structureId:U,sideNumber:K,matchUpId:$,eventId:j,drawId:H,stage:E},m){let ge=ne(se);f[de].matchUps[$].opponentParticipantInfo=ge}_&&(f[de].matchUps[$].collectionId=_)}m&&se&&(f[de].opponents[se]={participantId:se,matchUpId:$,eventId:j,drawId:H}),P&&p5e({finishingPositionRange:b,participantMap:f,participantWon:J,finishingRound:I,matchUpStatus:S,participantId:de,stageSequence:w,roundNumber:T,structureId:U,matchUpId:$,drawId:H,stage:E}),(p||d)&&fwe({participantMap:f,participantId:de,matchUpStatus:S,roundPosition:R,matchUpType:x,roundNumber:T,structureId:U,matchUpId:$,schedule:F,drawId:H,score:C})},oe=({participant:de,partnerParticipantId:se})=>{var ge,ye,Te;let De=(xe,Me)=>{xe&&(xe.partnerParticipantIds||(xe.partnerParticipantIds=[]),xe.partnerParticipantIds.includes(Me)||xe.partnerParticipantIds.push(Me))};y&&De((ge=de?.draws)==null?void 0:ge[H],se),v&&De((ye=de?.events)==null?void 0:ye[j],se),g&&De((Te=de?.matchUps)==null?void 0:Te[$],se)};if(Z&&f[Z]){let de=W?.[K];re(Z,de);let se=((e=f[Z])==null?void 0:e.participant.participantType)===Ai,ge=((i=f[Z])==null?void 0:i.participant.individualParticipantIds)||[];if(N){if(h){let ye=Te=>f[Te].matchUps[N]={participantWon:M===K,matchUpId:N,matchUpType:zn,sideNumber:K};ye(Z),ge.forEach(ye)}if(y&&!f[Z].draws[H]){let ye=(r=(n=A.find(xe=>xe.sideNumber===K))==null?void 0:n.participant)==null?void 0:r.participantId,Te=(o=(s=(a=f[ye])==null?void 0:a.draws)==null?void 0:s[H])==null?void 0:o.entryStatus,De=xe=>f[xe].draws[H]={entryStatus:Te,eventId:j,drawId:H};De(Z),ge.forEach(De)}}if(se&&(ge.forEach(ye=>f[ye]&&re(ye,de)),ge.forEach((ye,Te)=>{let De=ge[1-Te],xe=f[ye];xe&&oe({participant:xe,partnerParticipantId:De})}),v&&A)){let ye=(u=(l=A.find(Te=>Te.sideNumber===K))==null?void 0:l.participant)==null?void 0:u.participantId;if(ye){let Te=(c=f[ye])==null?void 0:c.events[j];Te?(f[Z].events[j]={...Te},ge.forEach(De=>f[De].events[j]={...Te})):console.log("Missing teamEntry",{eventId:j,teamParticipantId:ye})}}if(O){let ye=Te=>{J?(f[Te].counters[x].wins+=1,f[Te].counters.wins+=1,S===ln&&(f[Te].counters[x].walkoverWins+=1,f[Te].counters.walkoverWins+=1),S===Wi&&(f[Te].counters[x].defaultWins+=1,f[Te].counters.defaultWins+=1)):(f[Te].counters[x].losses+=1,f[Te].counters.losses+=1,S===ln&&(f[Te].counters[x].walkovers+=1,f[Te].counters.walkovers+=1),S===Wi&&(f[Te].counters[x].defaults+=1,f[Te].counters.defaults+=1))};ye(Z),ge.forEach(ye)}}}}function h5e(t){var e,i,n,r,a,s,o;let{participantFilters:l,convertExtensions:u,policyDefinitions:c,tournamentRecord:d,usePublishState:p,contextFilters:h,matchUpFilters:f,participantMap:m,contextProfile:g,withPotentialMatchUps:v,withRankingProfile:y,withScheduleItems:b,scheduleAnalysis:I,withTeamMatchUps:S,withStatistics:w,withOpponents:T,withMatchUps:U,withSeeding:C,withEvents:E,withDraws:P}=t,M=l?.participantIds,R=H=>{var G,W;let q=[H];return(W=(G=m[H])==null?void 0:G.participant.individualParticipantIds)==null||W.forEach(Z=>q.push(Z)),q.some(Z=>!(M!=null&&M.length)||M.includes(Z))?q:[]},N={withMatchUps:U||y,withEvents:E||y,withDraws:P||y,withPotentialMatchUps:v,withRankingProfile:y,withScheduleItems:b,scheduleAnalysis:I,withTeamMatchUps:S,withStatistics:w,participantMap:m,withOpponents:T,withSeeding:C},A=[],_={},x=[],O={},$={},F={},j=({eventType:H,scaleNames:G,participantId:W})=>{var q,Z,K,Q,J;return(J=(Q=(K=(Z=(q=m[W])==null?void 0:q.participant)==null?void 0:Z.rankings)==null?void 0:K[H])==null?void 0:Q.find(ne=>G.includes(ne.scaleName)))==null?void 0:J.scaleValue};for(let H of d?.events||[]){if(l!=null&&l.eventIds&&!l.eventIds.includes(H.eventId))continue;let{drawDefinitions:G=[],extensions:W=[],eventType:q,eventName:Z,category:K,entries:Q,eventId:J,gender:ne}=H,{flightProfile:re}=Rr({event:H}),oe=re?.flights??[],de=G0({event:H}).publishState;de&&(O[J]=de);let se=(e=de?.status)==null?void 0:e.publishedSeeding;if(E||C||y){let ye=u?Object.assign({},...M7(W??[])):{};$[J]={...ye,eventName:Z,eventType:q,category:K,eventId:J,gender:ne};let Te=[K?.categoryName,K?.ageCategoryCode].filter(Boolean);for(let De of Q){let{participantId:xe}=De;if(!xe||!m[xe])continue;let Me=j({eventType:q,scaleNames:Te,participantId:xe}),Oe,at;if(C){let mt=m[xe].participant;({seedAssignments:Oe,seedValue:at}=u5e({publishedSeeding:se,usePublishState:p,withSeeding:C,participant:mt,event:H}))}let Fe=mt=>{var Xe,gt;if((gt=(Xe=m[mt])==null?void 0:Xe.events)!=null&&gt[J])return;let ht=m[mt];c5e({convertExtensions:u,seedAssignments:Oe,participant:ht,withSeeding:C,seedValue:at,eventId:J,ranking:Me,entry:De})};Fe(xe),(m[xe].participant.individualParticipantIds||[]).forEach(Fe)}}let ge=(i=O?.[J])==null?void 0:i.publishedSeeding;if(P||y||C){let ye=De=>De?Object.assign({},...De.map(({participantId:xe,seedValue:Me,seedNumber:Oe})=>({[xe]:{seedValue:Me,seedNumber:Oe}}))):void 0,Te=Si([...G.map(JC),...oe.map(JC)]);for(let De of Te){let xe=G.find(ft=>ft.drawId===De),Me=[K?.categoryName,K?.ageCategoryCode].filter(Boolean),{structures:Oe=[],drawOrder:at,drawName:Fe,drawType:mt}=xe??{},Xe=oe?.find(ft=>ft.drawId===De),gt=xe?.entries||Xe?.drawEntries,ht=Xe?.flightNumber,_e=(xe?.structures||[]).sort((ft,rt)=>k0(ft,rt)).map(({structureId:ft,structures:rt})=>[ft,...(rt||[]).map(({structureId:St})=>St)]).flat(1/0),Ye,Je,ct,pt,Se=0,he=Oe.filter(({stage:ft,stageSequence:rt})=>ft===_t&&rt===1||ft===Kt).flatMap(ft=>{let{positionAssignments:rt}=Fn({structure:ft}),{seedAssignments:St,stageSequence:si,stage:Qe}=ft;return Qe===_t?(Se=rt?.length??0,ct=rt,pt=St):si===1&&(Ye=rt,Je=St),rt}).map(({participantId:ft})=>ft).filter(Boolean),we=ye(pt),be=ye(Je),Ae=xe?gt.filter(({participantId:ft})=>he.includes(ft)):gt,ze=!p||ge?.published&&(((n=ge?.drawIds)==null?void 0:n.length)===0||((r=ge?.drawIds)==null?void 0:r.includes(De)));for(let ft of Ae){if(!m[ft.participantId])continue;let{entryStatus:rt,entryStage:St,entryPosition:si,participantId:Qe}=ft,bt=j({participantId:Qe,scaleNames:Me,eventType:q}),ci=Tt=>{var Li,Jt,Yi,Ri,qi;if(!m[Tt]||(Li=m[Tt].draws)!=null&&Li[De])return;let hn=C&&ze,kt=hn?{}:void 0,fi=hn?((Jt=we?.[Qe])==null?void 0:Jt.seedValue)||((Yi=we?.[Qe])==null?void 0:Yi.seedNumber):void 0,Xr=fi?we?.[Qe]:void 0,Jr=hn?((Ri=be?.[Qe])==null?void 0:Ri.seedValue)||((qi=be?.[Qe])==null?void 0:qi.seedNumber):void 0,Qr=Jr?be?.[Qe]:void 0;kt&&fi&&(kt[_t]=Xr),kt&&Jr&&(kt[Kt]=Qr);let Lr=fi||Jr;Lr&&(m[Tt].participant.seedings[q]||(m[Tt].participant.seedings[q]=[]),Xr&&m[Tt].participant.seedings[q].push({...Xr,scaleName:De}),Qr&&m[Tt].participant.seedings[q].push({...Qr,scaleName:De}),kt&&(m[Tt].events[J].seedAssignments||(m[Tt].events[J].seedAssignments={}),Object.keys(kt).forEach(Ua=>m[Tt].events[J].seedAssignments[Ua]=kt[Ua]))),(P||y)&&(m[Tt].draws[De]=Gt({seedAssignments:kt,entryPosition:si,entryStatus:rt,entryStage:St,seedValue:Lr,eventId:J,ranking:bt,drawId:De},!1,!1,!0))};[dc,zb].includes(rt)||(ci(Qe),(a=m[Qe].participant.individualParticipantIds||[])==null||a.forEach(ci))}let We=(xe?.structures??[]).reduce((ft,rt)=>(ft.includes(rt.stage)||ft.push(rt.stage),ft),[]),Le=(xe?.links??[]).length;F[De]={qualifyingPositionAssignments:Ye,qualifyingSeedAssignments:Je,mainPositionAssignments:ct,qualifyingSeedingMap:be,mainSeedAssignments:pt,orderedStructureIds:_e,mainSeedingMap:we,flightNumber:ht,linksCount:Le,drawOrder:at,drawName:Fe,drawType:mt,drawSize:Se,drawId:De,stages:We}}}if(y||I||S||w||T||U||P){let ye=!!I||v,Te=((s=If({afterRecoveryTimes:!!I,policyDefinitions:c,tournamentRecord:d,inContext:!0,participantMap:m,contextFilters:h,matchUpFilters:f,contextProfile:g,nextMatchUps:ye,event:H}))==null?void 0:s.matchUps)??[];for(let De of Te){let{finishingPositionRange:xe,potentialParticipants:Me,tieMatchUps:Oe=[],sides:at=[],winningSide:Fe,matchUpType:mt,matchUpId:Xe,eventId:gt,drawId:ht,collectionId:_e,stageSequence:Ye,finishingRound:Je,matchUpStatus:ct,roundPosition:pt,roundNumber:Se,structureId:he,schedule:we,score:be,stage:Ae}=De;_[Xe]=De;let ze={finishingPositionRange:xe,finishingRound:Je,stageSequence:Ye,roundPosition:pt,collectionId:_e,roundNumber:Se,structureId:he,schedule:we,eventId:gt,drawId:ht,score:be,stage:Ae};TQ({...ze,...N,matchUpStatus:ct,winningSide:Fe,matchUpType:mt,matchUpId:Xe,sides:at});for(let We of Oe){let{winningSide:Le,sides:ft=[],matchUpId:rt,matchUpStatus:St,matchUpType:si}=We;TQ({...ze,...N,winningSide:Le,tieWinningSide:Fe,matchUpTieId:Xe,matchUpId:rt,sides:ft,matchUpSides:at,matchUpStatus:St,matchUpType:si})}Array.isArray(Me)&&(ye||I||b)&&((o=Me.flat().map(Gi).filter(Boolean))==null||o.forEach(We=>{var Le;(Le=R(We))==null||Le.forEach(ft=>{m[ft]&&(m[ft].potentialMatchUps[Xe]=Gt({tournamentId:d?.tournamentId,matchUpId:Xe,eventId:gt,drawId:ht}))}),(I||b)&&fwe({potential:!0,participantMap:m,participantId:We,matchUpStatus:ct,roundPosition:pt,structureId:he,matchUpType:mt,roundNumber:Se,matchUpId:Xe,schedule:we,drawId:ht,score:be})}))}x.push(...Te)}}if(w||y||I){let H=Object.values(m);for(let G of H){let{wins:W,losses:q,[Mn]:{wins:Z,losses:K},[En]:{wins:Q,losses:J}}=G.counters,ne=(re,oe,de)=>{let se=oe+de,ge=oe,ye=se&&ge/se;G.statistics[re]={denominator:se,numerator:ge,statValue:ye,statCode:re}};if(w&&(ne(C_,W,q),ne(`${C_}.${Mn}`,Z,K),ne(`${C_}.${En}`,Q,J)),y){let re=(oe=[])=>Math.abs(oe[0]-oe[1]);for(let oe of Object.keys(G.draws)){let{orderedStructureIds:de=[],flightNumber:se}=F[oe]||{};if(G.structureParticipation&&de.length){let ge,ye=0,Te=de.map(De=>{let xe=G.structureParticipation[De];if(!xe)return;ge||(ge=xe?.finishingPositionRange),re(ge)>re(xe?.finishingPositionRange)&&(ge=xe?.finishingPositionRange);let Me=xe.stage!==Kt;return Me&&(ye+=1),Gt({...xe,participationOrder:Me?ye:void 0,flightNumber:se})}).filter(Boolean);G.draws[oe]&&(G.draws[oe].finishingPositionRange=ge,G.draws[oe].structureParticipation=Te)}}}if(I){let re=Qi(I)?I.scheduledMinutesDifference:0,oe=G.scheduleItems||[],de=G.potentialMatchUps||{},se=oe.reduce((ye,Te)=>{let{scheduledDate:De,scheduledTime:xe}=Te;return ye[De]||(ye[De]=[]),xe&&ye[De].push(Te),ye},{});Object.values(se).forEach(ye=>ye.sort(rbe));for(let ye of oe){let{typeChangeTimeAfterRecovery:Te,timeAfterRecovery:De,scheduledDate:xe,scheduledTime:Me}=ye,Oe=se[xe],at=an(Me);for(let Fe of Oe){if(Fe.matchUpId===ye.matchUpId||[ln,Wi].includes(Fe.matchUpStatus)&&!Fe.checkScoreHasValue)continue;let mt=ye.matchUpType!==Fe.matchUpType&&Te||De,Xe=ye.drawId===Fe.drawId,gt=de[ye.matchUpId]&&de[Fe.matchUpId],ht=an(Fe.scheduledTime),_e=Math.abs(ht-at),Ye=ht>=at;if((re&&!isNaN(re)?_e<=re:Ye&&an(Fe.scheduledTime)<an(mt))&&!(gt&&Xe)&&Ye){let Je=[ye.matchUpId,Fe.matchUpId].sort(J$).join("|");G.scheduleConflicts[Je]={priorScheduledMatchUpId:ye.matchUpId,matchUpIdWithConflict:Fe.matchUpId}}}}let ge=G.participant.participantId;Object.keys(G.scheduleConflicts).length&&A.push(ge),m[ge].scheduleConflicts=G.scheduleConflicts}}}return{participantIdsWithConflicts:A,eventsPublishStatuses:O,derivedEventInfo:$,derivedDrawInfo:F,mappedMatchUps:_,participantMap:m,matchUps:x}}function ZM({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var n;if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:a,positionedParticipants:s,eventEntryStatuses:o,participantRoles:l,participantRoleResponsibilities:u,participantTypes:c,participantIds:d,signInStatus:p,enableOrFiltering:h,eventIds:f,genders:m}=t,g=fh(f)&&((n=e?.events)==null?void 0:n.filter(S=>f?.includes(S.eventId)))||e?.events||[],v=a&&f5e({drawEntryStatuses:a,tournamentEvents:g}),y=o&&m5e({eventEntryStatuses:o,tournamentEvents:g}),b=s!==void 0&&[!0,!1].includes(s)&&g.reduce((S,w)=>S.concat(...(w.drawDefinitions||[]).map(T=>UIe({drawDefinition:T}).allPositionedParticipantIds).filter(Boolean)),[]),I=S=>r?.reduce((w,T)=>{let{accessor:U,value:C}=T,{values:E}=WI({element:S,accessor:U});return w&&E?.includes(C)},!0);if(i=i?.filter(S=>{var w,T;let U=(T=(w=cc({element:S,itemType:AM}))==null?void 0:w.timeItem)==null?void 0:T.itemValue,{participantRoleResponsibilities:C,participantType:E,participantRole:P,participantId:M,person:R}=S,N=Array.isArray(m)&&m?.length&&R?.sex&&m.includes(R.sex);return h?m&&N||s&&b.includes(M)||s===!1&&!b.includes(M)||v?.includes(M)||y?.includes(M)||d?.includes(M)||p&&U===p||c&&E&&fh(c)&&c.includes(E)||l&&P&&fh(l)&&l.includes(P)||u&&fh(C)&&fh(u)&&u.find(A=>C?.includes(A))||r?.length&&fh(r)&&I(S):(!m||N)&&(s===void 0||s&&b.includes(M)||s===!1&&!b.includes(M))&&(!v||v.includes(M))&&(!y||y.includes(M))&&(!d||d.includes(M))&&(!p||U===p)&&(!c||E&&fh(c)&&c.includes(E))&&(!l||P&&fh(l)&&l.includes(P))&&(!u||fh(C)&&fh(u)&&u.find(A=>C?.includes(A)))&&(!(r!=null&&r.length)||fh(r)&&I(S))}),g.length&&f){let S=g.filter(w=>f.includes(w.eventId)).map(w=>{let T=(w.entries||[]).map(C=>C.participantId);if(xr(zp)(w.eventType))return T;let U=(e?.participants??[]).filter(C=>T.includes(C.participantId)).map(C=>C.individualParticipantIds).flat(1);return T.concat(...U)}).flat(1);i=i?.filter(w=>S.includes(w.participantId))}return i}function fh(t){return t&&Array.isArray(t)&&t.length}function f5e({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:n})=>Array.isArray(t)?t.includes(n):!0;return Si(e.reduce((n,r)=>{var a,s;let{flightProfile:o}=Rr({event:r}),l=((a=o?.flights)==null?void 0:a.map(({drawEntries:c})=>Array.isArray(c)?c.filter(i).map(Gi):[]).flat())||[],u=((s=r.drawDefinitions)==null?void 0:s.map(({entries:c})=>c?c.filter(i).map(Gi):[]))||[];return n.concat(...l,...u)},[]))}function m5e({eventEntryStatuses:t,tournamentEvents:e}){return Si(e.reduce((i,n)=>{let r=(n.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(Gi);return i.concat(...r)},[]))}function hr(t){var e;let{withIndividualParticipants:i,participantFilters:n={},withPotentialMatchUps:r,withRankingProfile:a,convertExtensions:s,policyDefinitions:o,withScheduleItems:l,tournamentRecord:u,scheduleAnalysis:c,withSignInStatus:d,withTeamMatchUps:p,withScaleValues:h,usePublishState:f,withStatistics:m,contextFilters:g,matchUpFilters:v,contextProfile:y,withOpponents:b,withMatchUps:I,internalUse:S,withSeeding:w,withEvents:T,withDraws:U,withISO2:C,withIOC:E}=t;if(!u)return{error:lt};(I||a)&&bd({tournamentRecord:u});let P=FIe({convertExtensions:s,tournamentRecord:u,withSignInStatus:d,withScaleValues:h,internalUse:S,withISO2:C,withIOC:E}),{participantMap:M}=P,R=h5e({withMatchUps:I??a,withEvents:T??a,withDraws:U??a,withPotentialMatchUps:r,participantFilters:n,withRankingProfile:a,convertExtensions:s,withScheduleItems:l,policyDefinitions:o,tournamentRecord:u,scheduleAnalysis:c,withTeamMatchUps:p,usePublishState:f,withStatistics:m,contextFilters:g,matchUpFilters:v,participantMap:M,withOpponents:b,contextProfile:y,withSeeding:w}),{participantIdsWithConflicts:N,eventsPublishStatuses:A,derivedEventInfo:_,derivedDrawInfo:x,mappedMatchUps:O}=R,$=R.matchUps;M=R.participantMap;let F=c??r,j=({potentialMatchUps:K,scheduleConflicts:Q,scheduleItems:J,participant:ne,statistics:re,opponents:oe,matchUps:de,events:se,draws:ge})=>{let ye=Object.values(ge),Te=Object.values(oe);return b&&ye?.forEach(De=>{De.opponents=Te.filter(xe=>xe.drawId===De.drawId)}),Gt({...ne,scheduleConflicts:c?Object.values(Q):void 0,draws:U||a?ye:void 0,events:T||a?Object.values(se):void 0,matchUps:I||a?Object.values(de):void 0,opponents:b?Te:void 0,potentialMatchUps:F?Object.values(K):void 0,statistics:m?Object.values(re):void 0,scheduleItems:l?J:void 0},!1,!1,!0)},H=new Map;for(let K of Object.keys(M))H.set(K,j(M[K]));let G=[...H.values()],W=(e=o?.[FD])==null?void 0:e.participant,q=ZM({participants:G,participantFilters:n,tournamentRecord:u});if(i){let K=Qi(i)?i:void 0;for(let Q of q)for(let J of Q.individualParticipantIds??[]){Q.individualParticipants||(Q.individualParticipants=[]);let ne=H.get(J),re=K?Dw({template:K,source:ne}):ne;Q.individualParticipants.push(re)}}let Z=W?q.map(K=>Dw({source:K,template:W})):q;return{participantMap:t.returnParticipantMap!==!1?M:void 0,mappedMatchUps:t.returnMatchUps!==!1?O:void 0,matchUps:t.returnMatchUps!==!1?$:void 0,missingParticipantIds:P.missingParticipantIds,participantIdsWithConflicts:N,eventsPublishStatuses:A,derivedEventInfo:_,derivedDrawInfo:x,participants:Z,...ue}}function YI({participantId:t,drawDefinition:e,entryStatus:i,entryStage:n}){var r;if(!e)return{error:Lt};let a=(r=e.entries)==null?void 0:r.find(s=>s.participantId===t&&(!i||i===s.entryStatus)&&(!n||n===s.entryStage));return t&&a}function HD(t){var e,i,n,r,a,s,o,l,u;let{provisionalPositioning:c,drawDefinition:d,stageSequence:p,structureId:h,stage:f}=t;if(!d)return{error:Lt};let{entryProfile:m}=xM({drawDefinition:d}),g=f&&p&&((n=(i=(e=m?.[f])==null?void 0:e.stageSequence)==null?void 0:i[p])==null?void 0:n.qualifiersCount)||f&&((r=m?.[f])==null?void 0:r.qualifiersCount)||0,v={};if(!h)return{qualifiersCount:g,roundQualifiersCounts:v};let{structure:y}=ui({drawDefinition:d,structureId:h}),b=(a=d.links)==null?void 0:a.filter(w=>{var T;return((T=w?.target)==null?void 0:T.structureId)===y?.structureId}),I=0;if(b!=null&&b.length)for(let w of b){let T=(s=ui({structureId:w.source.structureId,drawDefinition:d}))==null?void 0:s.structure;if(T?.stage===Kt){let U=w.source.roundNumber,C=w.target.roundNumber,E=0;if(T.structureType===Eo){let P=((o=T.structures)==null?void 0:o.length)??0,M=((l=w.source.finishingPositions)==null?void 0:l.length)??0;E=P*M}else E=((u=vn({matchUpFilters:{roundNumbers:[U]},structure:T,afterRecoveryTimes:!1,provisionalPositioning:c,inContext:!1}).matchUps)==null?void 0:u.length)||0;v[C]||(v[C]=0),v[C]+=E,I+=E}}let S=Object.keys(v);if(S.length<=1){let w=S[0]||1;v[w]=Math.max(v[w]||0,g)}return I=Math.max(I,g),{qualifiersCount:I,roundQualifiersCounts:v}}function bx({stage:t,drawDefinition:e}){var i;let{entryProfile:n}=xM({drawDefinition:e});return((i=n?.[t])==null?void 0:i.drawSize)||0}function g5e(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r}=t,a=bx({stage:r,drawDefinition:i}),{qualifiersCount:s}=HD({provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r});return a&&a-s}function mwe({stage:t,drawDefinition:e}){return!!(t===qa||b8({stage:t,drawDefinition:e})&&bx({stage:t,drawDefinition:e}))}function gwe({entryStatus:t=cl,drawDefinition:e,stageSequence:i,stage:n}){if(t===Xc)return l4e({stage:n,drawDefinition:e})?{positionsAvailable:1/0,...ue}:{error:bye};let r=g5e({drawDefinition:e,stageSequence:i,stage:n}),a=u4e({drawDefinition:e,stage:n}),s=_H({entryStatus:mU,drawDefinition:e,stage:n}),o=_H({entryStatus:cl,drawDefinition:e,stage:n}),l=s+o,u=l>=r,c=r-l;return n!==qa&&u?{error:SH}:t===mU?s<a?{...ue}:{error:SH}:{positionsAvailable:c,...ue}}function N8(t){let e=Yt(t,[{[Po]:!0,[Qbe]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:n=cl,entryStageSequence:r,entryStage:a=_t,ignoreStageSpace:s,drawDefinition:o,entryPosition:l,participant:u,roundTarget:c,extensions:d,extension:p,drawType:h,event:f}=t,m="addDrawEntry";if(h!==gu&&!mwe({stage:a,drawDefinition:o}))return pe({result:{error:$b},stack:m});let g=gwe({stageSequence:r,stage:a,drawDefinition:o,entryStatus:n});if(!s&&!g.success&&(!h||h!==gu))return{error:g.error};if(p&&!Wp({extension:p}))return pe({result:{error:Ce},info:"Invalid extension",context:{extension:p},stack:m});let v=t.participantId||u?.participantId;if(!v)return pe({result:{error:da},stack:m});let y=n===Nm&&YI({participantId:v,drawDefinition:o,entryStatus:n}),b=a===qa&&YI({participantId:v,drawDefinition:o,entryStage:a}),I=YI({participantId:v,drawDefinition:o}),S=n!==Nm&&a!==qa&&I;if(S)return i?(Ui({payload:{drawId:o.drawId,eventId:f?.eventId,error:LC,participantId:v},topic:t8}),{...ue}):pe({result:{error:LC},context:{participantId:v},stack:m});if(y||b)return pe({context:{invalidEntry:S,invalidLuckyLoser:y,invalidVoluntaryConsolation:b},result:{error:u$},stack:m});let w=Gt({entryStageSequence:r,participantId:v,entryPosition:l,entryStatus:n,entryStage:a,extensions:d});return p&&dn({element:w,extension:p}),c&&dn({extension:{name:"roundEntry",value:c},element:w}),o.entries||(o.entries=[]),o.entries.push(w),Bn({drawDefinition:o}),{...ue}}function v5e(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:n=cl,autoEntryPositions:r=!0,ignoreStageSpace:a,participantIds:s,drawDefinition:o,stageSequence:l,stage:u=_t,roundTarget:c,extension:d,event:p}=t;if(!u)return{error:Xve};if(!o)return{error:Lt};if(!Array.isArray(s))return{error:El};if(!mwe({stage:u,drawDefinition:o}))return{error:$b};if(d&&!Wp({extension:d}))return pe({result:{error:Ce},info:"Invalid extension",context:{extension:d},stack:e});let h=gwe({drawDefinition:o,stageSequence:l,entryStatus:n,stage:u});if(!a&&!h.success)return{error:h.error};let f=h.positionsAvailable??0;if(!a&&u!==qa&&f<s.length)return{error:l7};let m=[],g=o.drawId,v=p?.eventId,y=s.reduce((b,I)=>{let S=n===Nm&&YI({participantId:I,drawDefinition:o,entryStatus:n}),w=u===qa&&YI({entryStage:u,drawDefinition:o,participantId:I}),T=YI({participantId:I,drawDefinition:o});return n!==Nm&&u!==qa&&T&&(m.push(I),i&&Ui({payload:{error:LC,participantId:I,eventId:v,drawId:g},topic:t8})),S||w?b.concat(I):b},[]);return m.length&&!i?pe({context:{eventId:v,drawId:g,duplicateEntries:m},result:{error:LC},stack:e}):(s.filter(b=>b&&!y.includes(b)).forEach(b=>{let I={entryStageSequence:l,entryStage:u,participantId:b,entryStatus:n};d&&dn({element:I,extension:d}),c&&dn({extension:{name:sh,value:c},element:I}),o.entries||(o.entries=[]),o.entries.push(I)}),r&&(o.entries=Ld({entries:o.entries})),Bn({drawDefinition:o}),y!=null&&y.length||m!=null&&m.length?{info:"some participantIds could not be added",participantIdsNotAdded:y,duplicateEntries:m,...ue}:{...ue})}function A8({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:n,participantIds:r,drawDefinition:a,entryStatus:s,roundTarget:o,entryStage:l,extension:u,drawId:c,event:d}){if(!(r!=null&&r.length))return{error:Mv};if(!d)return{error:Xu};if(!c)return{error:Xd};let p=(d.entries||[]).map(Gi);if(r.filter(m=>!p.includes(m)).length)return{error:Kve};if(a){let m=v5e({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:n,participantIds:r,drawDefinition:a,entryStatus:s,roundTarget:o,extension:u});if(m.error)return m}let{flightProfile:h}=Rr({event:d}),f=h?.flights.find(m=>m.drawId===c);return f!=null&&f.drawEntries&&(r.forEach(m=>{let g=s===Nm&&AV({participantId:m,entryStatus:s,flight:f}),v=l===qa&&AV({participantId:m,entryStage:l,flight:f});!(s!==Nm&&l!==qa&&AV({flight:f,participantId:m}))&&!g&&!v&&f.drawEntries.push({participantId:m,entryStatus:s,entryStage:l})}),e&&(f.drawEntries=Ld({entries:f.drawEntries}))),{...ue}}function AV({participantId:t,entryStatus:e,entryStage:i,flight:n}){var r;let a=(r=n.drawEntries)==null?void 0:r.find(s=>s.participantId===t&&(!e||e===s.entryStatus)&&(!i||i===s.entryStage));return t&&a}function XM({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:n,event:r}){var a,s,o,l;let u="removeEventEntries";if(!(r!=null&&r.eventId))return{error:Wn};if(!Array.isArray(e)||e.some(m=>!nr(m)))return pe({result:{error:Hd},stack:u});let c=(r.drawDefinitions??[]).flatMap(m=>Yb({drawDefinition:m}).assignedParticipantIds??[]),d=(i?.length&&((a=r.entries)==null?void 0:a.filter(m=>m.entryStatus&&i.includes(m.entryStatus)))||[]).map(Gi).filter(m=>!c.includes(m)),p=(n&&((s=r.entries)==null?void 0:s.filter(m=>m.entryStage&&m.entryStage===n))||[]).map(Gi).filter(m=>!c.includes(m));if(e.length?e=e.filter(m=>(!(i!=null&&i.length)||d.includes(m))&&(!n||p.includes(m))):d.length&&p.length?e=Pr(d,p):d.length?e=d:p.length&&(e=p),e?.length&&c.some(m=>e.includes(m)))return pe({result:{error:ND},stack:u});if(!(e!=null&&e.length))return{...ue,participantIdsRemoved:[]};let h=[];r.entries=(r.entries??[]).filter(m=>{let g=!e.includes(m?.participantId);return g||h.push(m.participantId),g}),t&&(r.entries=Ld({entries:r.entries}));let{flightProfile:f}=Rr({event:r});return(o=f?.flights)==null||o.forEach(m=>{m.drawEntries=(m.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(l=r.drawDefinitions)==null||l.forEach(m=>{m.entries=(m.entries??[]).filter(g=>!e.includes(g.participantId))}),{...ue,participantIdsRemoved:h}}var vwe={[Wa]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},zD=vwe;function Mp(t){var e,i;let{suppressDuplicateEntries:n=!0,entryStatus:r=cl,autoEntryPositions:a=!0,enforceGender:s=!0,entryStageSequence:o,policyDefinitions:l,entryStage:u=_t,tournamentRecord:c,ignoreStageSpace:d,drawDefinition:p,roundTarget:h,extensions:f,extension:m,drawId:g,event:v}=t,y="addEventEntries";if(!Array.isArray(t.participantIds))return pe({result:{error:El},stack:y});let b=Si(t.participantIds??[]);if(!v)return{error:Wn};if(!(b!=null&&b.length))return pe({result:{error:Mv},stack:y});if(!(v!=null&&v.eventId))return{error:Xu};let I=pn({tournamentRecord:c,event:v}).appliedPolicies??{},S=l?.[Wa]??I?.[Wa]??zD[Wa],w=(s??((e=S?.participants)==null?void 0:e.enforceGender))!==!1,T=[],U=[];if(f&&(!Array.isArray(f)||!f.every(x=>Wp({extension:x})))||m&&!Wp({extension:m}))return pe({context:Gt({extension:m,extensions:f}),result:{error:Ce},info:"Invalid extension(s)",stack:y});let C=!!c,E=[],P,M=((i=c?.participants)==null?void 0:i.filter(x=>{var O,$,F;if(!b.includes(x.participantId))return!1;let j=xr(Mn)(v.eventType)&&x.participantType===Hi&&!py(r),H=v.eventType===En&&x.participantType===Ai;return j&&(!v.gender||!w||[ko,qd].includes(v.gender)||v.gender===((O=x.person)==null?void 0:O.sex))||H&&!py(r)||v.eventType===En&&x.participantType===Hi&&py(r)?!0:j&&v.gender&&w&&![ko,qd].includes(v.gender)&&v.gender!==(($=x.person)==null?void 0:$.sex)?(E.push({participantId:x.participantId,sex:(F=x.person)==null?void 0:F.sex}),!1):v.eventType===Sn&&(x.participantType===Sn||py(r)&&x.participantType===Hi)}).map(x=>x.participantId))??[],R=b.filter(x=>!C||M.includes(x));v.entries||(v.entries=[]);let N=v.entries.map(x=>{var O;return x.participantId||((O=x.participant)==null?void 0:O.participantId)});if(R.forEach(x=>{var O;if(!N.includes(x)){let $=Gt({participantId:x,entryStatus:r,entryStage:u,extensions:f});m&&dn({element:$,extension:m}),h&&dn({extension:{name:sh,value:h},element:$}),o&&($.entryStageSequence=o),T.push($.participantId),(O=v.entries)==null||O.push($)}}),g&&!py(u)){let x=A8({participantIds:R,suppressDuplicateEntries:n,autoEntryPositions:a,entryStageSequence:o,ignoreStageSpace:d,drawDefinition:p,entryStatus:r,roundTarget:h,entryStage:u,extension:m,drawId:g,event:v});x.error&&(P=x.error)}if(v.eventType&&[Dm,Fl].includes(v.eventType)){let x=(v.entries||[]).map(j=>j.participantId),O=(v.entries||[]).filter(j=>py(j.entryStatus)).map(j=>j.participantId),$=(c?.participants??[]).filter(j=>x.includes(j.participantId)&&j.participantType&&[Ai,Sn].includes(j.participantType)).map(j=>j.individualParticipantIds).flat(1/0),F=O.filter(j=>$.includes(j));F.length&&(U.push(...F),XM({participantIds:F,autoEntryPositions:!1,event:v}))}if(R.length!==b.length)return pe({context:{mismatchedGender:E,gender:v.gender},result:{error:El},stack:y});a&&(v.entries=Ld({entries:v.entries||[]}));let A=T.length,_=U.length;return pe({result:{...ue,addedEntriesCount:A,removedEntriesCount:_},stack:y,info:P})}var ywe="ADMINISTRATION",y5e="CAPTAIN",b5e="COACH",ws="COMPETITOR",bwe="MEDIA",Iwe="MEDICAL",_8="OFFICIAL",wwe="OTHER",Swe="SECURITY",k8={ADMINISTRATION:ywe,CAPTAIN:y5e,COACH:b5e,COMPETITOR:ws,MEDIA:bwe,MEDICAL:Iwe,OFFICIAL:_8,OTHER:wwe,SECURITY:Swe};function x8({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:n,suppressErrors:r}){let a="removeIndividualParticipantIds";if(!n)return pe({result:{error:lt},stack:a});if(!i||!e)return pe({result:{error:Xt},stack:a});let s=(n.participants??[]).find(c=>c.participantId===i);if(!s)return pe({result:{error:Ar},stack:a});if(![Sn,Uu].includes(s.participantType))return pe({result:{participantType:s.participantType,error:zd},stack:a});let o=Twe({individualParticipantIds:e,groupingParticipant:s,tournamentRecord:n,suppressErrors:r}),{removed:l,error:u}=o;if(u)return pe({result:o,stack:a});if(t)for(let c of n.events??[]){let d=(c.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l?.filter(h=>!d.includes(h));Mp({participantIds:p,entryStatus:dc,tournamentRecord:n,event:c})}}return l&&Ui({topic:Es,payload:{tournamentId:n.tournamentId,participants:[s]}}),{...ue,...o}}function Twe({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:n,mappedMatchUps:r,participants:a}){var s,o;let l=[];if(!e)return{removed:l};let u=[],c=[];a||({participants:a,mappedMatchUps:r}=hr({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let d=(o=(s=a?.find(({participantId:f})=>f===e.participantId))==null?void 0:s.events)==null?void 0:o.map(({eventId:f})=>f),p=(e.individualParticipantIds??[]).filter(f=>{var m;let g=t?.includes(f),v=g&&((m=a?.find(b=>b.participantId===f))==null?void 0:m.matchUps.filter(({eventId:b})=>d.includes(b)).map(({matchUpId:b})=>r?.[b]).filter(({winningSide:b,score:I})=>b||Sa({score:I}))),y=g&&!(v!=null&&v.length);if(g&&!y&&c.push(f),y){l.push(f);for(let b of i.events??[])for(let I of b.drawDefinitions??[]){let{extension:S}=ki({element:I,name:Rm}),w=S?.value[e.participantId];S&&w&&(S.value[e.participantId]=w.filter(U=>U.participantId!==f),dn({element:I,extension:S}),NM({drawDefinition:I}));let T=ho({drawDefinition:I,inContext:!1}).matchUps??[];for(let U of T){let C=U.sides??[];for(let E of C){let P=E.lineUp??[];P.find(M=>M.participantId===f)&&(E.lineUp=P.filter(M=>M.participantId!==f),Xi({tournamentId:i?.tournamentId,drawDefinition:I,matchUp:U}))}}}}else u.push(f);return!y});e.individualParticipantIds=p;let h={groupingParticipantId:e.participantId,cannotRemove:c,notRemoved:u,removed:l};return c.length&&!n&&{...h,cannotRemove:c,error:o$}||h}function Q$({participantRole:t=ws,individualParticipantIds:e=[],groupingTypes:i=[xo,Uu],tournamentRecord:n}){if(!n)return{error:lt};let r=n.participants??[],{participants:a,mappedMatchUps:s}=hr({withMatchUps:!0,tournamentRecord:n,withEvents:!0}),o=0;return r.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:u}=Twe({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:n,mappedMatchUps:s,participants:a});u&&o++}),o?ue:{error:fye}}function H0(t){var e,i;let n=Yt(t,[{[Ta]:!0},{participantIds:!0,[Ho]:Os,[Zc]:Mv}]);if(n.error)return n;let{addIndividualParticipantsToEvents:r,tournamentRecord:a,participantIds:s}=t,o=((e=a.participants)==null?void 0:e.length)||0;if(!o)return{...ue};let l=(i=a.events||[])==null?void 0:i.filter(({eventType:g})=>g===aa).map(g=>{var v;return(v=g?.drawDefinitions)==null?void 0:v.map(({drawId:y})=>y)}).flat(1/0),u=hr({participantFilters:{participantIds:s},tournamentRecord:a,withDraws:!0}).participants??[],c=g=>{let v=(Qa({matchUpFilters:{drawIds:g,matchUpTypes:[En]},tournamentRecord:a}).matchUps??[]).flatMap(({sides:y})=>y?.map(({participantId:b})=>b||[])).filter(Boolean);return Pr(v,s)},d=l!=null&&l.length?c(l):[],p=u.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(y=>(!(l!=null&&l.length)||!(l!=null&&l.includes(y.drawId)))&&y.positionAssignments).length});if(d!=null&&d.length||p.length)return{error:ND};let h={},f={};for(let g of a.events||[]){let v=XM({participantIds:s,event:g});if(v.error)return v;h[g.eventId]=v.participantIdsRemoved}a.participants=(a.participants??[]).filter(g=>{var v,y;let b=s.includes(g.participantId)||g.participantType===Ai&&((v=g.individualParticipantIds)==null?void 0:v.some(I=>s.includes(I)));if(!b&&g.participantType===aa&&(y=g.individualParticipantIds)!=null&&y.some(I=>s.includes(I))&&(g.individualParticipantIds=g.individualParticipantIds.filter(I=>!s.includes(I))),b&&r&&g.participantType&&[Ai,Sn].includes(g.participantType))for(let I of g.individualParticipantIds||[])s.includes(I)||(f[g.participantId]||(f[g.participantId]=[]),f[g.participantId].push(I));return!b});let m=o-a.participants.length;if(Q$({individualParticipantIds:s,tournamentRecord:a}),r)for(let g of a.events||[]){let v=h[g.eventId].map(y=>f[y]||[]).flat();Mp({participantIds:v,entryStatus:dc,tournamentRecord:a,event:g})}return m&&Ui({payload:{participantIds:s,tournamentId:a.tournamentId},topic:i8}),m?{...ue,participantsRemovedCount:m}:{error:o$}}function Uwe({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:n,event:r,stage:a}){var s;let o=r.entries??[];if(n){let{flightProfile:u}=Rr({event:r}),c=(s=u?.flights)==null?void 0:s.find(d=>d.drawId===n);c?o=c.drawEntries:e.entries&&(o=e?.entries)}let l=o.filter(u=>(!(i!=null&&i.length)||!u.entryStatus||i.includes(u.entryStatus))&&(!a||!u.entryStage||u.entryStage===a)&&(!t||u.entryStatus&&yd.includes(u.entryStatus)));return{entries:o,stageEntries:l}}function Dwe({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,stage:a,event:s}){var o;let l="destroyGroupEntry";if(!e)return{error:lt};if(!n)return pe({result:{error:da},stack:l});if(!s)return{error:Wn};if(!s.eventType||![Dm,Fl].includes(s.eventType))return pe({result:{error:rf},stack:l});let u=e.participants??[],c=u.find(y=>y.participantId===n);if(!c)return pe({result:{error:Ar},stack:l});if(!c.participantType||![Ai,xo].includes(c.participantType)||c.participantType===xo&&s.eventType!==Fl||c.participantType===Ai&&s.eventType!==Dm)return{error:zd};let d=(s.entries??[]).find(y=>y.participantId===n);if(!d)return{error:yye};let{stageEntries:p}=Uwe({selected:!1,drawDefinition:i,drawId:r,event:s,stage:a}),h=p.map(Gi),f=u.filter(({participantId:y})=>h.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),m=(o=c.individualParticipantIds)==null?void 0:o.filter(y=>Cp(y,f).length===1),g=XM({participantIds:[n],event:s});if(g.error||m!=null&&m.length&&(g=Mp({participantIds:m,entryStatus:dc,entryStage:d.entryStage,tournamentRecord:e,drawDefinition:i,drawId:r,event:s}),g.error))return g;let v;return t&&H0({participantIds:[n],tournamentRecord:e}).success&&(v=!0),{...ue,participantRemoved:v}}function O8({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a}){return Dwe({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a})}function Ewe(t){if(!t.tournamentRecord)return{error:lt};let{participantIds:e,...i}=t,n=0,r=[];for(let a of e){let s=Dwe({participantId:a,...i});s.success&&(n+=1),s.error&&r.push(s.error)}return n?{destroyedCount:n,...ue}:{error:r}}function i1(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:n,destroyPair:r,entryStatus:a,matchUpsMap:s,drawId:o}=t,l="removeDrawPositionAssignment",u=YM(t);if(u.error)return pe({result:u,stack:l});let{participantId:c}=u,{drawPosition:d,event:p,structureId:h}=t,f=pn({tournamentRecord:e,drawDefinition:n,event:p}).appliedPolicies??{};if([Xc,uf].includes(a)&&c){let{tournamentRecord:g}=t,{participant:v}=Ov({tournamentRecord:g,participantId:c}),{participantType:y,individualParticipantIds:b}=v??{};if(r&&y===Ai){let I=O8({tournamentRecord:g,drawDefinition:n,participantId:c,event:p});if(I.error)return pe({result:I,stack:l});b&&yx({participantIds:b,tournamentRecord:g,drawDefinition:n,entryStatus:a,drawId:o,event:p})}else yx({participantIds:[c],tournamentRecord:g,drawDefinition:n,entryStatus:a,drawId:o,event:p})}if(i){let g=Eu({tournamentRecord:e,drawDefinition:n,drawPosition:d,structureId:h,matchUpsMap:s,event:p});if(g.error)return pe({result:g,stack:l})}let{structure:m}=ui({drawDefinition:n,structureId:h});return h8({structure:m,drawPositions:[d]}),B$({appliedPolicies:f,drawDefinition:n,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:h}}),u}function Pwe(t){return Object.assign(t,{entryStatus:uf}),i1(t)}function BH(t){return nr(t)?t.split(" ").map(e=>e.split("").map((i,n)=>n?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function Ss(t){return nr(t)?BH(t.replace(/_/g," ")):""}var Gg=({finishingPosition:t=A0,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:n=[],stageSequence:r=1,structureOrder:a,seedingProfile:s,matchUpFormat:o,structureType:l,structureName:u,matchUpType:c,matchUps:d=[],structureId:p,roundOffset:h,roundLimit:f,stageOrder:m,structures:g,stage:v})=>{let y={structureId:p??gn(),structureAbbreviation:i,finishingPosition:t,seedAssignments:n,matchUpFormat:o,stageSequence:r,structureName:u};a&&(y.structureOrder=a),l&&(y.structureType=l),s&&(typeof s=="string"?y.seedingProfile=s:typeof s=="object"&&typeof s.positioning=="string"&&(y.seedingProfile=s.positioning)),c&&(y.matchUpType=c),h&&(y.roundOffset=h),m&&(y.stageOrder=m),f&&(y.roundLimit=f),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);let b=d.flatMap(({drawPositions:I})=>I).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=Si(b).sort((I,S)=>I-S).map(I=>({drawPosition:I}))),y},Gu=Gg;function L8({structureName:t=Ss(qa),structureAbbreviation:e,drawDefinition:i,matchUpType:n,structureId:r}){if(!i)return{error:Lt};let a=Gu({stage:qa,structureAbbreviation:e,structureName:t,matchUps:[],structureId:r,matchUpType:n});return i.structures||(i.structures=[]),i.structures.push(a),Bn({drawDefinition:i,structureIds:[a.structureId]}),{...ue}}function F8({drawPositions:t}){if(!(t!=null&&t.length))return{error:mM};let e=r=>t.filter(a=>a!==r).map(a=>[r,a]),i=[].concat(...(t??[]).map(e)),n=Si(i.map(eB)).map(r=>r.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:n}}function eB(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(ra).join("|")}function Cwe({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,h)=>h),n=i(2*Math.round(t/2)+1).slice(1),r=i(n.length-1).map(()=>[]),a=n.slice(0,n.length/2),s=n.slice(n.length/2);n.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{r[p].push([a[v],s[v]])});let h=a.shift(),f=a.pop(),m=s.shift();a=[h,m,...a].filter(Boolean),s=[...s,f].filter(Boolean)});let o=a.shift(),l=a.pop(),u=s.shift();a=[o,u,...a].filter(Boolean),s=[...s,l].filter(Boolean);let c=d=>d[0].reduce((p,h)=>p+h);return[...r].reverse().sort((d,p)=>c(d)-c(p)).map(d=>d.filter(p=>p.every(h=>h<=t)).map(p=>{let h=p.map(f=>f+e);return eB(h)}))}function I5e({rounds:t,hash:e}){return t!=null&&t.length?t?.reduce((i,n,r)=>n.includes(e)?r+1:i,void 0):{error:Xt}}var w5e={getRoundRobinGroupMatchUps:F8,determineRoundNumber:I5e,drawPositionsHash:eB,groupRounds:Cwe};function JM(t){var e;let{groupNameBase:i="Group",playoffAttributes:n,stageSequence:r=1,structureOptions:a,appliedPolicies:s,seedingProfile:o,stage:l=_t,matchUpType:u,roundTarget:c,structureId:d,groupNames:p,drawSize:h,idPrefix:f,isMock:m,uuids:g}=t,v=t.structureName??((e=n?.[0])==null?void 0:e.name)??Ss(_t),{groupCount:y,groupSize:b}=S5e({structureOptions:a,appliedPolicies:s,drawSize:h}),I=ob,S,w=Et(1,y+1).map(U=>{let C=T5e({groupSize:b,structureOrder:U,matchUpType:u,drawSize:h,idPrefix:f,isMock:m});S=Array.isArray(C)?Math.max(...C.map(({roundNumber:P})=>P??0)):0;let E=p?.[U-1]??`${i} ${U}`;return Gg({structureId:g?.pop(),structureType:T$,finishingPosition:I,structureOrder:U,structureName:E,matchUps:C})}),T=Gg({structureId:d??g?.pop(),structureType:Eo,finishingPosition:I,seedingProfile:o,structureName:v,stageSequence:r,structures:w,stage:l});return c&&dn({extension:{name:sh,value:c},element:T}),{structures:[T],maxRoundNumber:S,groupCount:y,links:[],groupSize:b,...ue}}function S5e({appliedPolicies:t,structureOptions:e,drawSize:i}){let n=e?.groupSize,r=e?.groupSizeLimit||8,{validGroupSizes:a}=QM({groupSizeLimit:r,drawSize:i}),s=a&&Math.max(...a);n&&a!=null&&a.includes(n)||(n&&n>4||!(a!=null&&a.includes(4))?n=s:n=4);let o=Math.ceil(i/n);return{groupSize:n,groupCount:o}}function QM(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},n=Et(3,e+1).filter(r=>{let a=Math.ceil(i/r),s=a*r-i,o=Math.ceil(i/a),l=Math.ceil(s/a);return(!s||s<r)&&o===r&&o>=3&&l<2});return{...ue,validGroupSizes:n}}function T5e({structureOrder:t,matchUpType:e,groupSize:i,drawSize:n,idPrefix:r,isMock:a,uuids:s}){let o=(t-1)*i,l=Et(1+o,i+1+o),u=F8({drawPositions:l}).uniqueMatchUpGroupings??[],c=Cwe({groupSize:i,drawPositionOffset:o});return u.map(p).sort((h,f)=>(h.roundNumber??1/0)-(f.roundNumber??1/0));function d(h){return c.reduce((f,m,g)=>m.includes(h)?g+1:f,void 0)}function p(h){let f=eB(h),m=d(f),g=[1,n],v=U5e({structureOrder:t,drawPositions:h,roundNumber:m,idPrefix:r,uuids:s}),y={matchUpStatus:m?Or:fn,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:h,roundNumber:m,matchUpId:v};return a&&(y.isMock=!0),y}}function U5e({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:n,uuids:r}){return n?`${n}-${t}-${i}-DP-${e.join("-")}`:r?.pop()||gn()}function $8(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:n}=t;if(!bi(i))return{seedBlocks:void 0,...pe({result:{error:Ce},context:{participantsCount:i},stack:"getSeedBlocks"})};let r=ED(i);if(e){let h=Math.min(e,r),f=[],m=1;for(Et(0,h).forEach(()=>{f.push([m]),m++});m<r;){let g=Et(m,m+h);m+=h,f.push(g)}return{...ue,seedBlocks:f}}let a=Et(1,r+1),s=[],o=r/2;for(;o>1;){let h=ka(a,o),f=h.length;h.forEach((m,g)=>{let v,y=g<f/2,b=g%2===0,I=m[0],S=m[m.length-1];n&&f>4?f===8?v=y?S:I:v=b?I:S:v=y?I:S,yo(m,s)||s.push(v)}),o=o/2}let l=a.filter(h=>!s.includes(h));for(;l.length;)l.length%2===0?s.push(l.pop()):s.push(l.shift());let u=Et(0,20).map(h=>Math.pow(2,h));u.unshift(1);let c=u.indexOf(r),d=0,p=[];return Et(0,c).forEach(h=>{p.push(s.slice(d,d+u[h])),d+=u[h]}),{...ue,seedBlocks:p}}function B8({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!bi(e))return{seedGroups:void 0,...pe({result:{error:Ce},context:{drawSize:e},stack:i})};if(t){if(!bi(t))return{seedGroups:void 0,...pe({context:{roundRobinGroupsCount:t},result:{error:Ce},stack:i})};let n=1,r=Math.floor(e/t);return{seedGroups:Et(0,r).map(()=>{let a=Et(n,n+t);return n+=t,a})}}else{let{seedBlocks:n}=$8({participantsCount:e,roundRobinGroupsCount:t}),r=0;return{seedGroups:(n||[]).map(a=>(a||[]).map(()=>(r+=1,r)))}}}function V8({roundRobinGroupsCount:t,participantsCount:e}){var i;if(t){let{validGroupSizes:a}=QM({drawSize:e});if(!((i=a?.map(s=>Math.ceil(e/s)))!=null&&i.includes(t)))return pe({context:{roundRobinGroupsCount:t},result:{error:Ce}})}let{seedGroups:n}=B8({drawSize:e,roundRobinGroupsCount:t}),r=n?.map(a=>Math.min(...a))||[];return{...ue,seedingThresholds:r}}function vU(t){if(!t)return 1/0;if(bi(t))return ai(t);let e=t.split("-")[0];return bi(e)?ai(e):1/0}function D5e({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(ra),e.reverse(),e}function E5e({blockPattern:t,index:e}){let i=0;for(let n of t){if(i===e)return n;let r=0;for(;r<n.length;){if(i===e)return n;i+=1,r++}}}function P5e({positioning:t,size:e}){let i=D5e({size:e}),n=[],r=[],a=p=>p[0],s=p=>p[p.length-1],o=(p,h)=>(t&&[S$,ab].includes(t)&&h%2?s(p):a(p))||a(p),l=(p,h)=>{if(p.every(f=>!r.includes(f))){let f=o(p,h);return r.push(f),f}},u=p=>{let h=p.filter(f=>!r.includes(f));if(h.length)return r.push(...h),h},c=(p,h)=>{let f=o(p,h);if(!r.includes(f))return r.push(f),f},d=Et(1,e+1);for(let p of i)if(p===1){let h=ka(d,2),f=h.map(l).filter(Boolean);f.length&&n.push(f);let m=h.flatMap(u).filter(Boolean);m.length&&n.push(m)}else{let h=ka(d,p).map(c).filter(Boolean);h.length&&n.push(h)}return{divisions:i,divisionGroupings:n}}function z0({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:n,drawDefinition:r,allPositions:a,structure:s}){var o;let l=[];if(!s)return{error:Fb};let{matchUps:u,roundMatchUps:c}=vn({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:s}),{seedAssignments:d}=ec({provisionalPositioning:t,returnAllProxies:e,drawDefinition:r,structure:s}),{positionAssignments:p}=xa({structure:s}),h=p?.length,f=d?.length??0,m=[],g=Object.keys(c).map(x=>parseInt(x)).sort((x,O)=>x-O).map(x=>{let O=c[x].map(F=>F.drawPositions).flat(1/0).filter(Boolean),$=O.filter(F=>!m.includes(F));return m=m.concat(...O),$}).filter(x=>x.length).reverse(),v=g.pop()??[],y=v&&Math.min(...v)-1||0;n=n??((o=i?.seeding)==null?void 0:o.seedingProfile);let b=v?.length||0,I=g.filter(x=>x.filter(O=>O<=f).length),{stage:S,structureType:w,roundLimit:T}=s,U=w===Eo,C=!U&&g?.length,E=!U&&S===Kt&&T,P=I.flat(1/0),M=C?P?.length:0,R=a?h:f,N=I8({drawDefinition:r,structure:s,matchUps:u}),A=N?0:!C&&R||R&&P.length<R&&R-P.length||0;if(E){let x=s!=null&&s.matchUps?s.matchUps.filter(({roundNumber:$})=>$===s.roundLimit).length:0,O=v.length/x;if(!C){let $=eN(n),F=ka(v,O),j=1,H=Et(0,F[0].length).map(()=>{let G=Et(j,j+F.length);return j+=F.length,G});({validSeedBlocks:l}=Rwe({drawPositionBlocks:F,nonRandom:n?.nonRandom,positioning:$,seedGroups:H}))}}else U?{validSeedBlocks:l}=C5e({nonRandom:n?.nonRandom,seedingProfile:n,structure:s}):C?l=I.map(x=>({seedNumbers:x,drawPositions:x})):N&&ka(v,2).map((x,O)=>({drawPositions:[x[0]],seedNumbers:[O+1]})).forEach(x=>l.push(x));if(!U&&!N&&!E){let{blocks:x}=R5e({drawPositionOffset:y,seedNumberOffset:M,seedCountGoal:A,seedingProfile:n,baseDrawSize:b});x.forEach(O=>l.push(O))}let _=l.flatMap(x=>x.drawPositions).reduce((x,O)=>v?.includes(O)&&x,!0);return!N&&!C&&!U&&!_?{error:zve,validSeedBlocks:[],isContainer:U,isFeedIn:C}:{isLuckyStructure:N,validSeedBlocks:l,isContainer:U,isFeedIn:C}}function C5e({seedingProfile:t,structure:e,nonRandom:i}){var n;let r=e.structures||[],a=r.length,s=(n=Fn({structure:e}))==null?void 0:n.positionAssignments,o=eN(t),l=s?.length??0,{seedGroups:u}=B8({roundRobinGroupsCount:a,drawSize:l}),c=r.map(d=>{var p;return(p=Fn({structure:d}).positionAssignments)==null?void 0:p.map(h=>h.drawPosition)});return Rwe({drawPositionBlocks:c,positioning:o,seedGroups:u,nonRandom:i})}function Rwe({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:n}){let r=[],{divisionGroupings:a}=P5e({size:i.length,positioning:e}),s=[];return i.forEach((o,l)=>{let u=E5e({blockPattern:a,index:l});o.forEach((c,d)=>{let p=l%2?t.length-d-1:d,h=t[p].slice().filter((m,g)=>u.includes(g+1)&&m);e!==ab?h=n?h:co(h):l%2&&h.reverse();let f=h.find(m=>!s.includes(m));f&&(s.push(f),r.push({drawPositions:[f],seedNumbers:[c]}))})}),{validSeedBlocks:r}}function R5e(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:n=0,seedingProfile:r,seedCountGoal:a,baseDrawSize:s}=t,o=1,l=[],{seedBlocks:u}=$8({cluster:eN(r)===S$,participantsCount:s,roundRobinGroupsCount:i});o=0;for(let d of u){if(o+1>a)break;let p=d.map(f=>f+e),h=c(o+1,d.length).map(f=>+f+n);o+=d.length,l.push({drawPositions:p,seedNumbers:h})}return{blocks:l};function c(d,p){return Array.from(new Array(p),(h,f)=>f+d)}}function Ix({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:n,structureId:r,seedNumber:a}){var s,o,l,u,c,d;let{structure:p}=ui({drawDefinition:e,structureId:r});t||(t=pn({drawDefinition:e}).appliedPolicies);let h=i?.validSeedBlocks;return!h&&p&&(h=(s=z0({appliedPolicies:t,drawDefinition:e,structure:p}))==null?void 0:s.validSeedBlocks),(l=(o=t?.seeding)==null?void 0:o.validSeedPositions)!=null&&l.ignore?!0:(c=(u=t?.seeding)==null?void 0:u.validSeedPositions)!=null&&c.strict?(((d=h.find(f=>f.seedNumbers.includes(a)))==null?void 0:d.drawPositions)||[]).includes(n):[].concat(...h.map(f=>f.drawPositions)).includes(n)}function Mwe(t){var e,i,n;let{provisionalPositioning:r,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,structureId:l,randomize:u}=t,{structure:c}=ui({drawDefinition:a,structureId:l}),{seedAssignments:d}=ec({returnAllProxies:t.returnAllProxies,provisionalPositioning:r,drawDefinition:a,structure:c}),{positionAssignments:p}=xa({structure:c}),h=(e=p?.filter(A=>A.participantId??A.bye??A.qualifier))==null?void 0:e.map(A=>A.drawPosition).filter(Boolean),{appliedPolicies:f}=pn({drawDefinition:a}),m=(o?.validSeedBlocks||c&&((i=z0({returnAllProxies:t.returnAllProxies,provisionalPositioning:r,appliedPolicies:f,drawDefinition:a,seedingProfile:s,structure:c}))==null?void 0:i.validSeedBlocks)||[]).filter(A=>A.drawPositions.filter(_=>!(h!=null&&h.includes(_))).length)[0],g=d?.map(A=>A.participantId).filter(Boolean),v=p?.map(A=>A.participantId).filter(Boolean),y=g?.filter(A=>v?.includes(A)),b=g?.filter(A=>!(v!=null&&v.includes(A))),I=d?.filter(A=>b?.includes(A.participantId)),S=d?.filter(A=>!A.participantId),w=(I!=null&&I.length&&I.length>0?I.length:S?.length??0)&&m?.drawPositions.filter(A=>!(h!=null&&h.includes(A)))||[],T=u?co(w):w,U=[],C=T.map(()=>{var A;let _=(A=N(I,U))==null?void 0:A.participantId;return _&&U.push(_),_}).filter(Boolean),E=d?.filter(A=>y?.includes(A.participantId)).map(A=>A.seedNumber),P=(m?.seedNumbers||[]).filter(A=>!(E!=null&&E.includes(A))),M=d?.filter(A=>P.includes(A.seedNumber)).map(A=>A.participantId),R=(n=f?.seeding)==null?void 0:n.duplicateSeedNumbers;return{nextSeedBlock:m,unplacedSeedParticipantIds:R===void 0||R?C:M,unplacedSeedNumbers:P,unfilledPositions:T,unplacedSeedAssignments:I};function N(A,_){let x=A.filter(F=>!_.includes(F.participantId)),O=Math.min(...x.map(F=>vU(F.seedValue))),$=x.filter(F=>vU(F.seedValue)===O);return co($).pop()}}function eN(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function qD({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:n,participantId:r,seedBlockInfo:a,structureId:s,seedNumber:o,seedValue:l,eventId:u,event:c}){var d,p,h;let f="assignSeed",{structure:m}=ui({drawDefinition:i,structureId:s}),{positionAssignments:g}=xa({structure:m}),v=ec({provisionalPositioning:t,drawDefinition:i,structure:m}).seedAssignments,y=v.map(U=>U.seedNumber),b=YI({drawDefinition:i,participantId:r});if(r&&!b)return pe({result:{error:Hd},context:{participantId:r},stack:f});let I=c?(p=(d=Rr({event:c}).flightProfile)==null?void 0:d.flights)==null?void 0:p.length:0,S=I&&I>1,w=(h=g?.find(U=>U.participantId===r))==null?void 0:h.drawPosition;if(w&&!Ix({drawPosition:w,drawDefinition:i,seedBlockInfo:a,structureId:s,seedNumber:o}))return pe({result:{error:K6},context:{assignedDrawPosition:w},info:"invalid seed position",stack:f});y.includes(o)||v.push({seedNumber:o,seedValue:l});let T;return v.forEach(U=>{U.participantId===r&&U.seedNumber!==o&&(U.participantId=void 0),U.seedNumber===o&&(U.participantId=r,!(n!=null&&n.groupSeedingThreshold)&&!S&&(U.seedValue=l??o),T=!0)}),T?(AIe({tournamentId:e?.tournamentId,drawDefinition:i,structure:m,eventId:u}),{...ue}):pe({result:{error:Hve},stack:f})}function j8({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:n,drawDefinition:r,matchUp:a,event:s}){var o,l,u,c;let d=(l=(o=t?.sides)==null?void 0:o[e])==null?void 0:l.sideNumber,p=d&&((u=a.sides)==null?void 0:u.find(g=>g.sideNumber===d)),{extension:h}=ki({element:r,name:Rm}),f=h?.value||{},m=At(f[i],!1,!0);if(p)(c=a?.sides)==null||c.forEach(g=>{g.sideNumber===d&&(g.lineUp=m)});else{a.sides=[1,2].map(v=>{var y;return{...((y=a.sides)==null?void 0:y.find(b=>b.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===d);g&&(g.lineUp=m)}Xi({tournamentId:n?.tournamentId,context:"updateSidLineUp",eventId:s?.eventId,drawDefinition:r,matchUp:a})}function Nwe(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:n,matchUpsMap:r,drawPosition:a}=t,s=i.roundNumber>1&&i.roundNumber-1,o=cb({structureId:n.structureId,matchUpsMap:r});!e&&a&&(e=o.find(({drawPositions:f,roundNumber:m})=>m===s&&f?.includes(a)));let l=e?.roundPosition,u=l%2?1:-1,c=l+u,d=s&&o.find(({roundNumber:f,roundPosition:m})=>f===s&&m===c),p=d?.matchUpStatus,h=[jr,oa].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:h}}function M5e({drawPosition:t,drawPositions:e}){let i=!1,n=!!(e!=null&&e.includes(t));return{updatedDrawPositions:n?e||[]:[...e,void 0,void 0].slice(0,2).map(r=>!r&&!n?(n=!0,i=!0,t):r).sort(ra).filter(Boolean),positionAdded:i,positionAssigned:n}}function Awe({structureId:t,matchUpsMap:e,matchUp:i}){let n=i?.roundPosition,r=n%2?1:-1,a=n+r;return{pairedPreviousMatchUp:cb({matchUpsMap:e,structureId:t}).find(({roundNumber:s,roundPosition:o})=>s===i?.roundNumber&&o===a)}}function _we({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:n,matchUp:r}){let a=t.find(o=>o.matchUpId===i),{pairedPreviousMatchUp:s}=Awe({structureId:a?.structureId,matchUp:a,matchUpsMap:n});if(a&&s){let o=s?.matchUpId,l=t.find(c=>c.matchUpId===o),u=a?.structureId===l?.structureId?a?.roundPosition<l?.roundPosition&&1||2:a.structureId===l?.structureId&&2||1;r.matchUpStatusCodes=(r.matchUpStatusCodes??[]).map(c=>{let d=nr(c)||!isNaN(c)?{code:c}:c;return d.sideNumber===u?{...d,previousMatchUpStatus:e}:d})}}function A_({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let n=t.filter(({winnerMatchUpId:r,loserMatchUpId:a})=>a===i||r===i).sort((r,a)=>r.roundPosition-a.roundPosition);return t.find(r=>r.matchUpId===i).feedRound?1:n.reduce((r,a,s)=>{var o;return(o=a.drawPositions)!=null&&o.includes(e)?s+1:r},void 0)}function yU({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:r,matchUpStatus:a,drawPosition:s,matchUpsMap:o,matchUpId:l,event:u}){var c,d,p,h;let f="assignMatchUpDrawPosition";o||(o=Cs({drawDefinition:r})),t||(t=pa({inContext:!0,drawDefinition:r,matchUpsMap:o}).matchUps??[]);let m=t.find(_=>_.matchUpId===l),g=m?.structureId,v=(c=r?.structures)==null?void 0:c.find(_=>_.structureId===g);if(!v)return{error:pr};let y=(d=o?.drawMatchUps)==null?void 0:d.find(_=>_.matchUpId===l),b=y?.drawPositions??[],{positionAdded:I,positionAssigned:S,updatedDrawPositions:w}=M5e({drawPositions:b,drawPosition:s}),{positionAssignments:T}=Fn({drawDefinition:r,structure:v}),U=(p=T?.filter(_=>w.includes(_.drawPosition)))==null?void 0:p.find(({bye:_})=>_),C=y?.matchUpStatus&&[ln,Wi].includes(y.matchUpStatus)&&w.filter(Boolean).length<2;if(a=U&&fn||a||C&&y.matchUpStatus||y?.matchUpStatus&&[jr,oa].includes(y.matchUpStatus)&&y.matchUpStatus||Or,y&&I){t=pa({inContext:!0,drawDefinition:r,matchUpsMap:o}).matchUps??[];let _=C&&A_({inContextDrawMatchUps:t,drawPosition:s,matchUpId:l})||void 0;y!=null&&y.matchUpStatusCodes&&_we({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:n,matchUpsMap:o,matchUp:y}),Object.assign(y,{drawPositions:w,winningSide:_,matchUpStatus:a}),Xi({tournamentId:i?.tournamentId,eventId:m?.eventId,context:f,drawDefinition:r,matchUp:y})}let E=Io({inContextDrawMatchUps:t,inContextMatchUp:m,drawDefinition:r,matchUpId:l}),{targetMatchUps:{winnerMatchUp:P,loserMatchUp:M,loserTargetDrawPosition:R},targetLinks:{loserTargetLink:N}}=E,A=cb({structureId:v.structureId,matchUpsMap:o});if(S&&U){if(P)if([fn,jr,oa].includes(a)){let _=yU({matchUpId:P.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:s,matchUpsMap:o});if(_.error)return _}else{let{structureId:_}=P;_!==v.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(P&&m&&!m.feedRound){let{pairedPreviousMatchUpIsDoubleExit:_}=Nwe({targetMatchUp:y,drawPosition:s,matchUpsMap:o,structure:v});if(_){let x=yU({matchUpId:P.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:s,matchUpsMap:o});if(x.error)return x}}if(y?.matchUpType===zn){let _=t?.find(({matchUpId:$})=>$===y.matchUpId),x=(_?.sides??[]).reduce(($,F,j)=>F.drawPosition===s?j:$,void 0),O=(h=T?.find($=>$.drawPosition===s))==null?void 0:h.participantId;O&&x!==void 0&&j8({inContextTargetMatchUp:_,drawPositionSideIndex:x,teamParticipantId:O,tournamentRecord:i,drawDefinition:r,matchUp:y})}if(N?.linkCondition===qp&&w.filter(Boolean).length===2&&!U&&A.filter(({drawPositions:_,roundNumber:x})=>x===1&&yo(_,w)).every(({matchUpStatus:_})=>[kr,os].includes(_))&&M){let{structureId:_}=M,x=Eu({drawPosition:R,tournamentRecord:i,drawDefinition:r,structureId:_,matchUpsMap:o,event:u});if(x.error)return x}return S?{...ue}:pe({result:{error:tU},context:{drawPosition:s},stack:f})}function kwe({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:n,structure:r}){var a,s,o,l;let u=((o=(s=(a=VD({drawDefinition:e}))==null?void 0:a.containedStructures)==null?void 0:s[r.structureId])==null?void 0:o.map(({structureId:f})=>f))||[];u.push(r?.structureId);let c=i?.map(({drawPosition:f})=>f)||[],d=t?.filter(f=>u.includes(f.structureId)&&Pr(f.drawPositions??[],c).length)??[],p=d.map(({matchUpId:f})=>f),h=((l=n?.drawMatchUps)==null?void 0:l.filter(f=>p.includes(f.matchUpId)))??[];return{drawPositions:c,matchUps:h,targetMatchUps:d}}function G8({lineUp:t}){if(!Array.isArray(t))return;let e={};return Si(t.flatMap(({collectionAssignments:i})=>i?.map(({collectionId:n,collectionPosition:r})=>[n,r].join("|"))).filter(Boolean)).forEach(i=>{let[n,r]=i.split("|"),a=parseInt(r),{assignedParticipantIds:s}=vx({collectionPosition:a,collectionId:n,lineUp:t});s.forEach(o=>{e[o]||(e[o]=[]),e[o].push({collectionId:n,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function hb(t){return`${t} must be an array`}function tB({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(hb("lineUp")),{valid:!1,errors:i,error:Ce};let n=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:s,collectionAssignments:o}=a;return s?typeof s!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(o)?o.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:u}=l;return typeof u!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(hb("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),r=Si(t.map(Gi)).length===t.length;return r||i.push("Duplicated participantId(s)"),{valid:n&&r,errors:i,error:i.length?Ce:void 0}}function q0({drawDefinition:t,participantId:e,tieFormat:i,lineUp:n}){if(typeof t!="object")return{error:Lt};if(typeof e!="string")return{error:da};let r=tB({lineUp:n,tieFormat:i});if(!r.valid)return r;let{extension:a}=ki({element:t,name:Rm}),s=a?.value||{};return s[e]=G8({lineUp:n}),dn({element:t,extension:{name:Rm,value:s}}),NM({drawDefinition:t}),{...ue}}function H8({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,assignments:a,structure:s,event:o}){if(!n)return{error:Lt};let{drawPositions:l,matchUps:u,targetMatchUps:c}=kwe({inContextDrawMatchUps:t,matchUpsMap:r,assignments:a,structure:s});for(let d of c)d.matchUpType===hu&&(d.sides??[]).forEach((p,h)=>{var f;if(p!=null&&p.drawPosition&&l!=null&&l.includes(p.drawPosition)){let m=u.find(({matchUpId:g})=>g===d.matchUpId);if((f=m?.sides)!=null&&f[h]){if(delete m.sides[h].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&q0({drawDefinition:n,participantId:v,lineUp:[],tieFormat:g})}Xi({tournamentId:i?.tournamentId,context:"resetLineUps",eventId:o?.eventId,drawDefinition:n,matchUp:m})}}});return{...ue}}function Yp({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,seedingProfile:s,participantId:o,seedBlockInfo:l,drawPosition:u,matchUpsMap:c,structureId:d,event:p}){var h,f,m,g,v;let y="assignDrawPosition";if(!o&&!i)return pe({result:{error:da},stack:y});c=c??Cs({drawDefinition:a}),e||({matchUps:e}=pa({inContext:!0,drawDefinition:a,matchUpsMap:c}));let b=ui({drawDefinition:a,structureId:d});if(b.error)return pe({result:b,stack:y});let{structure:I}=b;if(!I)return{error:pr};if(Vo({structure:I}))return pe({result:{error:ll},stack:y});let{seedAssignments:S}=ec({provisionalPositioning:t,drawDefinition:a,structure:I}),w=(h=S?.find(A=>A.participantId===o))==null?void 0:h.seedNumber,{appliedPolicies:T}=pn({tournamentRecord:r,drawDefinition:a,structure:I,event:p});if(w&&!Ix({seedNumber:w,appliedPolicies:T,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:d}))return pe({result:{error:K6},context:{drawPosition:u},stack:y});let U=xa({structure:I}).positionAssignments||[],C=U?.find(A=>A.drawPosition===u);if(!C)return pe({result:{error:PD},context:{drawPosition:u},stack:y});if(U!=null&&U.map(Gi).includes(o))return pe({result:{error:ND},context:{drawPosition:u},stack:y});let{containsParticipant:E,containsBye:P}=N(C);if(P){let A=YM({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:c,event:p});if(A.error)return pe({result:A,stack:y})}if(E&&C.participantId!==o){let{activeDrawPositions:A}=WM({drawDefinition:a,structureId:d});if(A.includes(u))return pe({result:{error:i$},stack:y});H8({assignments:[C],inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,matchUpsMap:c,structure:I})}if(C.participantId=o,i&&(C.qualifier=!0),I.stage===_t&&(!I.stageSequence||I.stageSequence>1)||I.stage&&[Ds,Tr].includes(I.stage)){let A=I.stage===Kt?Kt:_t,_=(((m=(f=a.structures)==null?void 0:f.find(x=>x?.stage===A&&x?.stageSequence===1))==null?void 0:m.seedAssignments)??[]).find(x=>x.participantId===o);if(_!=null&&_.participantId){let{participantId:x,seedNumber:O,seedValue:$}=_;qD({eventId:p?.eventId,provisionalPositioning:t,tournamentRecord:r,drawDefinition:a,seedingProfile:s,participantId:x,seedNumber:O,seedValue:$,structureId:d,event:p})}}if(I.structureType!==Eo)N5e({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,drawPosition:u,matchUpsMap:c,structure:I,event:p});else{pwe({positionAssignments:U,tournamentRecord:r,drawDefinition:a,matchUpsMap:c,structure:I});let{drawPositions:A,matchUps:_,targetMatchUps:x}=kwe({assignments:[C],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c,structure:I});if(A&&_?.length===1&&_[0].matchUpType===zn){let O=(x?.[0].sides??[]).reduce(($,F,j)=>A!=null&&A.includes(F.drawPosition)?j:$,void 0);j8({inContextTargetMatchUp:x[0],teamParticipantId:o,matchUp:_[0],drawPositionSideIndex:O,tournamentRecord:r,drawDefinition:a})}}let M=(g=a.entries)==null?void 0:g.find(A=>A.participantId===o),R=(v=p?.entries)==null?void 0:v.find(A=>A.participantId===o);return!M&&R&&N8({entryStatus:R.entryStatus,entryStage:I.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:o,event:p}),ov({tournamentId:r?.tournamentId,drawDefinition:a,structure:I,event:p}),{positionAssignments:U,...ue};function N(A){let _=A.bye,x=A.qualifier,O=A.participantId;return{containsBye:_,containsQualifier:x,containsParticipant:O,filled:_||x||O}}}function N5e({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let u={isCollectionMatchUp:!1},{matchUps:c}=vn({provisionalPositioning:t,matchUpFilters:u,drawDefinition:r,matchUpsMap:s,structure:o,event:l}),{roundMatchUps:d}=bo({matchUps:c}),{initialRoundNumber:p}=Cw({drawPosition:a,matchUps:c}),h=p&&d?.[p].find(f=>{var m;return(m=f.drawPositions)==null?void 0:m.includes(a)});if(h){let f=yU({matchUpId:h.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:s});if(f.error)return pe({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:f})}return{...ue}}function z8(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:n,tournamentRecord:r,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,event:u}=t,c="positionParticipantAction";if(!a)return{error:Lt};let d=pn({tournamentRecord:r,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:h}=t;h||(h=Cs({drawDefinition:a}),Object.assign(t,{matchUpsMap:h})),p||({matchUps:p}=pa({inContext:!0,drawDefinition:a,matchUpsMap:h}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:f}=Fn({drawDefinition:a,structureId:l}),m=f?.find(I=>I.drawPosition===o);if(m!=null&&m.participantId){let I=m.participantId,S=Yp({inContextDrawMatchUps:p,tournamentRecord:r,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:h,event:u});return S.success?b({appliedPolicies:d,removedParticipantId:I}):pe({result:S,stack:c})}let g=YM({inContextDrawMatchUps:p,tournamentRecord:r,drawDefinition:a,drawPosition:o,structureId:l,matchUpsMap:h,event:u});if(g.error)return pe({result:g,stack:c});let v=g.participantId,y=Yp({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:r,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:h,event:u});if(!y.success)return pe({result:y,stack:c});return b({appliedPolicies:d,removedParticipantId:v});function b({appliedPolicies:I,removedParticipantId:S}){let{structure:w}=ui({drawDefinition:a,structureId:l});h8({drawPositions:[o],structure:w});let T={[e]:s,name:n,drawPosition:o,structureId:l};return B$({appliedPolicies:I,drawDefinition:a,positionAction:T}),pe({context:{removedParticipantId:S},result:{...ue},stack:c})}}function A5e({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return z8({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function xwe(t){return A5e(t)}function Owe({params:t,modMap:e,structure:i}){let{tournamentRecord:n,drawDefinition:r,event:a}=t;for(let s of i.matchUps)e[s.matchUpId]&&(s.roundNumber=e[s.matchUpId],Xi({tournamentId:n?.tournamentId,eventId:a?.eventId,drawDefinition:r,matchUp:s}))}function Lwe(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let n=Yt(t,i);if(n.error)return n;let r=ui(t);if(r.error)return r;let a=r.structure;if(!Vo({structure:a}))return pe({result:{error:Lb,message:"structure must be adHoc"}});let{roundMatchUps:s=[],roundNumbers:o}=bo({matchUps:a?.matchUps});return o!=null&&o.length?{valid:!0,structure:a,roundMatchUps:s,roundNumbers:o}:{error:Km}}function Fwe(t){var e;let i=Lwe(t,[{targetRoundNumber:!0,roundNumber:!0,[Ho]:SWe}]);if(i.error)return i;let{structure:n,roundMatchUps:r,roundNumbers:a}=i,{targetRoundNumber:s,roundNumber:o}=t;if(!(a!=null&&a.includes(o))||!(a!=null&&a.includes(s)))return pe({result:{error:Ce},info:"roundNumbers must be valid rounds"});let l=s>o,u=l?Et(o+1,s+1):Et(s,o),c={};return u.forEach(d=>(r?.[d]??[]).forEach(({matchUpId:p})=>{c[p]=d-(l?1:-1)})),(e=r?.[o])==null||e.forEach(({matchUpId:d})=>c[d]=s),Owe({params:t,modMap:c,structure:n}),{...ue}}function $we({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:n,event:r}){var a;if(!n)return{error:Lt};if(!Array.isArray(t))return{error:Ce};let s="setPositionAssignments";for(let l of t){let{structureId:u,positionAssignments:c}=l;if(!c)continue;let d=ui({drawDefinition:n,structureId:u});if(d.error)return d;let p=d.structure;if(!p)return{error:pr};let h=(a=Fn({structure:p}).positionAssignments)==null?void 0:a.map(({drawPosition:v})=>v),f=c?.map(({drawPosition:v})=>v);if(Pr(h,f).length!==h?.length)return pe({result:{error:Ce},info:"drawPositions do not match",stack:s});let m=Cs({drawDefinition:n}),{matchUps:g}=pa({inContext:!0,drawDefinition:n,matchUpsMap:m});for(let v of c||[]){let{drawPosition:y,participantId:b,bye:I,qualifier:S}=v;if(I){let w=Eu({tournamentRecord:i,drawDefinition:n,drawPosition:y,matchUpsMap:m,structureId:u,structure:p,event:r});if(w!=null&&w.error)return w}else if(S)c.forEach(w=>{w.drawPosition===y&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(b){let w=Yp({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:n,participantId:b,drawPosition:y,matchUpsMap:m,structureId:u,event:r});if(w!=null&&w.error)return w}}ov({tournamentId:i?.tournamentId,drawDefinition:n,structure:p,event:r})}let o=t.map(({structureId:l})=>l);return Bn({tournamentId:i?.tournamentId,eventId:r?.eventId,drawDefinition:n,structureIds:o}),{...ue}}function Bwe(t){let e=Lwe(t,[{roundNumbers:!0,[Ho]:Os,[vs]:s=>s.length===2&&s.every(Ir)}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e;if(!t.roundNumbers.every(s=>r?.includes(s)))return pe({result:{error:Ce,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((s,o)=>(n?.[s]??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-o]})),Owe({params:t,modMap:a,structure:i}),{...ue}}function _5e({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return z8({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function Vwe(t){return _5e(t)}function jwe({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r,event:a}){return z8({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r,event:a})}function Gwe({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:n,structureId:r,seedValue:a,event:s}){if(!i)return{error:Lt};if(!r)return{error:Tu};let o=(e?.participants??[]).find(p=>p.participantId===n);if(e&&!o)return{error:Hd};let{structure:l}=ui({drawDefinition:i,structureId:r});if(!l)return{error:pr};if(!(!t||Ir(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Ir(p)&&ai(p)>0)))return{error:Ce};let{seedAssignments:u}=ec({drawDefinition:i,structure:l}),c=u?.map(p=>p.seedNumber),d=u?.find(p=>p.participantId===n);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(h=>parseInt(h)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...c||[])+1,participantId:n};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return AIe({tournamentId:e?.tournamentId,eventId:s?.eventId,drawDefinition:i,structure:l}),{...ue}}function Hwe({drawDefinition:t,structureId:e}){if(!t)return{error:Lt};let{structure:i}=ui({drawDefinition:t,structureId:e}),n=(t?.links||[]).filter(r=>{var a;return((a=r.source)==null?void 0:a.structureId)===e}).map(r=>{var a;return(a=r.target)==null?void 0:a.structureId});return{playoffStructures:(t?.structures||[]).filter(r=>n.includes(r.structureId)),structure:i}}function iB({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:n,stages:r,event:a,stage:s}){if(!a)return{error:Wn};let o={},l=[];for(let u of a.drawDefinitions||[]){let{structures:c,stageStructures:d}=ud({withStageGrouping:t,stageSequences:e,drawDefinition:u,stageSequence:i,roundTarget:n,stages:r,stage:s});if(l.push(...c),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function q8({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,stage:s}){if(!e)return{error:lt};let o={},l=[];for(let u of e.events||[]){let{structures:c,stageStructures:d}=iB({withStageGrouping:t,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,event:u,stage:s});if(c&&l.push(...c),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function uv(t){if(!(t!=null&&t.drawDefinition))return!1;let e=X$(t),i=e?.includesTeamMatchUps,{completedMatchUps:n,pendingMatchUps:r,upcomingMatchUps:a}=e||{};return i&&(n=n?.filter(({matchUpType:s})=>s===zn),r=r?.filter(({matchUpType:s})=>s===zn),a=a?.filter(({matchUpType:s})=>s===zn)),!!(n!=null&&n.length&&!(r!=null&&r.length)&&!(a!=null&&a.length))}function W8(t){var e,i;let{drawDefinition:n,structureId:r}=t;if(!n)return{error:Lt};let{playoffStructures:a}=Hwe({drawDefinition:n,structureId:r});if(!(a!=null&&a.length))return!1;let s=((i=(e=n?.entries)==null?void 0:e.filter(l=>l?.entryStatus&&yd.includes(l.entryStatus)))==null?void 0:i.length)??0,o=0;return(a||[]).reduce((l,u)=>{var c;return!!((c=Fn({structure:u}).positionAssignments??[])!=null&&c.filter(d=>(d.participantId&&o++,d?.bye??d?.participantId)).length&&l)},!!a.length)||o===s}function VH({significantCharacters:t,accessors:e=[],value:i}){let n=[],r=e[0];if(i!=null&&i[r]){let s=e.slice(1);if(Array.isArray(i[r]))i[r].forEach(o=>{let l=VH({accessors:s,significantCharacters:t,value:o});n.push(...l)});else if(i=i[r],s.length){let o=VH({accessors:s,significantCharacters:t,value:i});n.push(...o)}else a({value:i})}function a({value:s}){if(s&&["string","number"].includes(typeof s)){let o=t?s.slice(0,t):s;n.push(o)}}return n}function k5e({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:n}){if(!Array.isArray(e))return{error:r7};if(!Array.isArray(n))return{error:yM};let r={};return t.forEach(a=>{let s=n.find(l=>l.participantId===a),{values:o}=zwe({policyAttributes:e,idCollections:i,participants:n,participant:s});o&&o.forEach(l=>{r[l]||(r[l]=[]),r[l].includes(a)||r[l].push(a)})}),r}function zwe({policyAttributes:t,idCollections:e,participants:i,participant:n}){if(!Array.isArray(t))return{error:r7};if(!n)return{error:P0};let r=[];return t.forEach(a=>{let{directive:s,groupings:o,key:l,significantCharacters:u}=a||{};if(l){let c=l.split(".");r.push(...VH({significantCharacters:u,value:n,accessors:c}))}else if(s){let c=a?.includeIds,d=(e?.[s]||[]).filter(p=>!c||c.includes(p));d!=null&&d.length&&i!=null&&i.length&&d.forEach(p=>{var h;let f=i.find(m=>m.participantId===p);if((h=f?.individualParticipantIds)!=null&&h.includes(n.participantId)){let m=f?.participantId;r.push(m)}})}else o&&Object.keys(o).forEach(c=>{o[c].includes(n.participantId)&&r.push(c)})}),{values:Si(r)}}function UQ({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:n}){let r=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let s=r[a.participantId],{values:o}=zwe({participants:e,policyAttributes:i,idCollections:n,participant:s});return{...a,values:o}})}function qwe({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(n=>n?.participantId).map(n=>{let{drawPosition:r,participantId:a}=n,s=t?t[a]||[]:[],o=!!i.some(l=>s.includes(l));return{[r]:{participantGroups:s,includesGroupsToAvoid:o}}}))}function x5e(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=qwe(t);return i.map(a=>{let s=e.filter(u=>a.includes(u)),o=r(s),l=s.filter(u=>!o.includes(u)).filter(u=>{var c;let d=DQ(u);return!((c=n[d])!=null&&c.includesGroupsToAvoid)});return{unassigned:s,unpaired:o,pairedNoConflict:l}});function r(a){return a.filter(o=>!s(o));function s(o){let l=DQ(o);return!a.includes(l)}}}function O5e(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=qwe(t);return i.map(r=>{let a=e.filter(l=>r.includes(l)),s=a.length===r.length?a:[],o=r.filter(l=>{var u;return(u=n[l])==null?void 0:u.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:s,pairedNoConflict:o?[]:a,conflictsCount:o}})}function DQ(t){return Number(t%2?t+1:t-1)}function L5e({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function F5e({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:n,unfilledPositions:r,isRoundRobin:a}){let s=n.map(o=>a?O5e({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}):x5e({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}));if(a){let o=s.map(c=>c.map(d=>d.unassigned).filter(d=>d?.length)).filter(c=>c?.length).sort((c,d)=>(d.length||0)-(c.length||0)),l=s.map(c=>c.map(d=>d.unpaired).filter(d=>d?.length)).filter(c=>c?.length),u=s.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(c=>c?.length).sort((c,d)=>(d.length||0)-(c.length||0));return{unassigned:o,unpaired:l,pairedNoConflict:u}}else{let o=s.map(c=>c.map(d=>d.unassigned).filter(d=>d?.length)).filter(c=>c?.length),l=s.map(c=>c.map(d=>d.unpaired).filter(d=>d?.length)).filter(c=>c?.length),u=s.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(c=>c?.length);return{unassigned:o,unpaired:l,pairedNoConflict:u}}}function Wwe({positionAssignments:t,participantIds:e}){let i=t.map(n=>n.participantId);return e.filter(n=>!i.includes(n))}function $5e({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:n,groupKey:r}){var a;let s=Object.assign({},...Object.keys(n).map(c=>[c,n[c].filter(d=>e.includes(d))]).filter(c=>c[1].length).map(([c,d])=>({[c]:d}))),o=Object.keys(s).reduce((c,d)=>s[d].length>c?s[d].length:c,0),l=Object.keys(s).filter(c=>s[c].length===o),u=xc(i?l:Object.keys(s));return r=t&&(a=s[r])!=null&&a.length?r:u,{participantId:r&&s[r]?xc(s[r]):xc(e),groupKey:r}}function B5e({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(n=>({[n.drawPosition]:n})));return t.map(n=>n.filter(Boolean).map(r=>i[r]).filter(Boolean).filter(r=>!r.participantId&&!r.bye).map(r=>r.drawPosition)).flat().filter(Boolean)}function V5e({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:n,drawPositionGroups:r,pairedPriority:a,allGroups:s,groupKey:o}){let l=r.reduce((U,C)=>C.length>U?C.length:U,0)<=2,u=Wwe({positionAssignments:t,participantIds:e}),c=B5e({positionAssignments:t,drawPositionGroups:r}),{participantId:d,groupKey:p}=$5e({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:s,groupKey:o}),h=L5e({participantId:d,allGroups:s}),f=F5e({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:h,participantIdGroups:i,drawPositionChunks:n,unfilledPositions:c}),{unassigned:m,unpaired:g,pairedNoConflict:v}=f,y=v?.length&&v[0],b=g?.length&&g[0],I=a&&y?y:b,S=a?b:y,w=I?.length&&I||S?.length&&S,T;if(w!=null&&w.length){let U=wl(w);T=wl(U)}else{let U=wl(m[0]);T=wl(U)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:T}}function wx({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(n=>{let r=n.map(o=>o.drawPosition),a=F8({drawPositions:r}).uniqueMatchUpGroupings??[],s=Object.assign({},...n.map(o=>({[o.drawPosition]:o})));a.forEach(o=>{yo(s[o[0]].values||[],s[o[1]].values||[])&&(i.push(o),n.conflict=!0)})}):e.forEach(n=>{var r,a;yo(((r=n[0])==null?void 0:r.values)||[],((a=n[1])==null?void 0:a.values)||[])&&(i.push(n),n.conflict=!0)}),i}function j5e({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:n,isRoundRobin:r}){return n.map(a=>{let s=a.map(o=>o.drawPosition);return a.filter(o=>e.includes(o.drawPosition)).map(o=>{let l=e.filter(u=>!(s!=null&&s.includes(u))).filter(u=>{let c=i.find(m=>m.includes(u)).find(m=>m!==u),d=t.find(m=>m.drawPosition===c),p=wx({isRoundRobin:r,groupedParticipants:[[o,d]]}),h=[t.find(m=>m.drawPosition===u),d],f=wx({isRoundRobin:r,groupedParticipants:[h]});return!p.length&&!f.length});if(l.length)return{drawPosition:o.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function EQ(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:n,unseededByePositions:r,drawPositionGroups:a,policyAttributes:s,idCollections:o,allGroups:l}=t,u=[],c,d=Math.min(...(a||[]).map(b=>b?.length).filter(Boolean)),p=d>2,h=At(e,!1,!0).filter(b=>!b.qualifier),f=e.filter(b=>!b.participantId&&(!b.bye||r?.includes(b.drawPosition))).map(b=>b.drawPosition);Et(0,n).forEach(()=>{let{newGroupKey:b,selectedParticipantId:I,targetDrawPosition:S}=V5e({...t,candidatePositionAssignments:h,allGroups:l,groupKey:c});c=b,h.forEach(w=>{w.drawPosition===S&&(w.participantId=I)})});let m=UQ({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=ka(m,d),v=wx({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let b=j5e({positionedParticipants:m,potentialDrawPositions:f,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(b.length){let I=G5e({candidatePositionAssignments:h,swapOptions:b});I.error&&console.log({result:I}),m=UQ({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=ka(m,d),v=wx({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return h.forEach(b=>{if(b.bye&&b.participantId){let I=vH;u.push(I)}if(b.qualifier&&b.participantId){let I=vH;u.push(I)}}),{positionAssignments:h,conflicts:v.length,groupedParticipants:g,errors:u}}function G5e({candidatePositionAssignments:t,swapOptions:e}){let i=wl(e);if(!i)return{error:{message:"No swap options"}};let n=i.drawPosition,r=wl(i.possibleDrawPositions),a=t.find(u=>u.drawPosition===n),s=t.find(u=>u.drawPosition===r)??{},o={participantId:s?.participantId,qualifier:s?.qualifier,bye:s?.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,o),Object.assign(s,l),{...ue}}function H5e({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,avoidance:c,drawSize:d,event:p}){var h;if(!c)return{error:iye};let{candidatesCount:f=1,policyAttributes:m,targetDivisions:g}=c,{roundsToSeparate:v}=c,y="randomUnseededSeparation",{structure:b}=ui({drawDefinition:a,structureId:u}),{matchUps:I}=vn({provisionalPositioning:t,matchUpsMap:l,structure:b,event:p});if(g&&Gd(g)&&!v){let H=Uqe(g)||0,G=I.reduce((W,q)=>q.roundNumber>W?q.roundNumber:W,0);v=G<H?1:G-H+1}let{positionAssignments:S}=xa({structure:b}),w=j$({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:o}).participantsWithGroupings,T=S?.filter(H=>!H.participantId),U=S?.map(H=>H.drawPosition),C=b?.structureType===Eo,E=C?{structure:b,matchUps:I,allDrawPositions:U,roundsToSeparate:v}:{matchUps:I,allDrawPositions:U,roundsToSeparate:v},{drawPositionGroups:P,drawPositionChunks:M}=C?z5e(E):q5e(E),R={groupParticipants:o.filter(H=>H.participantType===Uu).map(H=>H.participantId),teamParticipants:o.filter(H=>H.participantType===Sn).map(H=>H.participantId),pairParticipants:o.filter(H=>H.participantType===Ai).map(H=>H.participantId)},N=k5e({targetParticipantIds:e,policyAttributes:m,idCollections:R,participants:o});if(N.error)return pe({result:N,stack:y});let A=Object.assign({},...e.map(H=>{let G=Object.keys(N).filter(W=>(N[W]??[]).includes(H));return{[H]:G}})),_=Wwe({participantIds:e,positionAssignments:S});if(_.length>(T?.length||0))return{error:u7};let x,O=_.length,$=Et(0,f).map(()=>EQ({initialPositionAssignments:S,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:n,participantIdGroups:A,drawPositionChunks:M,drawPositionGroups:P,policyAttributes:m,idCollections:R,allGroups:N,drawSize:d}));if(x=$.reduce((H,G)=>!H||(G.conflicts||0)<(H.conflicts||0)?G:H,void 0),!x||x.conflicts){let H=Et(0,f).map(()=>EQ({initialPositionAssignments:S,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:n,participantIdGroups:A,drawPositionChunks:M,drawPositionGroups:P,policyAttributes:m,idCollections:R,allGroups:N,drawSize:d}));x=$.concat(...H).filter(G=>{var W;return!((W=G.errors)!=null&&W.length)}).reduce((G,W)=>!G||(W.conflicts||0)<(G.conflicts||0)?W:G,void 0)}if(!x)return{error:d$};let F=(((h=Fn({structure:b}))==null?void 0:h.positionAssignments)??[]).filter(H=>H.participantId).map(H=>H.participantId),j=x.positionAssignments.filter(H=>!F.includes(H.participantId));for(let H of j)if(H.bye){let G=Eu({tournamentRecord:r,drawDefinition:a,structureId:u,matchUpsMap:l,event:p,...H});if(G.error)return pe({result:G,stack:y})}else if(H.participantId){let G=Yp({inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,structureId:u,matchUpsMap:l,event:p,...H});if(G.error)return pe({result:G,stack:y,context:{assignment:H}})}return{...ue}}function z5e(t){let{structure:{structures:e}}=t,i=e.map(n=>n.positionAssignments.map(r=>r.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function q5e({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let n=i.filter(c=>c.roundNumber===1).map(c=>c.drawPositions),r=n.flat().sort(ra),a=Math.max(...r),s=t.filter(c=>c>a),o=r.length,l=Et(o===2?1:2,o).filter(c=>c===W6(c)),u=l.slice(0,e||l.length).reverse().map(c=>ka(r,c));return s.length&&console.log({fedDrawPositions:s}),{drawPositionGroups:n,drawPositionChunks:u}}function W5e({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,structure:c,drawSize:d,event:p}){var h,f;let m="positionUnseededParticipants";c||({structure:c}=ui({drawDefinition:a,structureId:u})),u||({structureId:u}=c);let{positionAssignments:g}=xa({structure:c}),{seedAssignments:v}=ec({provisionalPositioning:t,drawDefinition:a,structure:c}),y=v?.map(P=>P.participantId).filter(Boolean),{stage:b,stageSequence:I}=c,S=b===Kt?(f=(h=ki({element:c,name:sh}))==null?void 0:h.extension)==null?void 0:f.value:void 0,w=x0({provisionalPositioning:t,drawDefinition:a,stageSequence:I,entryStatuses:qb,structureId:u,roundTarget:S,stage:b}),T=w.filter(P=>!(y!=null&&y.includes(P.participantId))).map(P=>P.participantId),U=g?.filter(P=>!P.participantId&&!P.bye&&!P.qualifier).map(P=>P.drawPosition);if(!n&&T.length>(U?.length||0))return pe({result:{error:u7},context:{unseededParticipantsCount:T.length,unfilledDrawPositionsCount:U?.length},stack:m});let{appliedPolicies:C}=pn({tournamentRecord:r,drawDefinition:a,event:p}),E=C?.[ZC];if(c.stage===Tr){let P=w.reduce((M,R)=>(M[R.groupingValue]||(M[R.groupingValue]=[]),M[R.groupingValue].push(R.participantId),M),{});Object.keys(P).length&&(E||(E={policyName:"Playoff Avoidance"}),E.policyAttributes||(E.policyAttributes=[]),E.policyAttributes.push({groupings:P}))}return E&&o?H5e({provisionalPositioning:t,unseededParticipantIds:T,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:u,avoidance:E,drawSize:d}):Y5e({provisionalPositioning:t,unseededParticipantIds:T,inContextDrawMatchUps:e,unfilledDrawPositions:U,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,structureId:u,matchUpsMap:l,drawSize:d,event:p})}function Y5e({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:n,multipleStructures:r,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,matchUpsMap:l,structureId:u,drawSize:c,event:d}){let p=c>2?co(n):n.reverse();for(let h of e){let f=p.pop();if(!r||f){let m=Yp({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,participantId:h,drawPosition:f,matchUpsMap:l,structureId:u,event:d});if(m!=null&&m.error&&console.log("!!!!!",{result:m}),m?.error)return pe({result:m,stack:"randomUnseededDistribution"})}}return{...ue}}function K5e(t){let e=t.structure??ui(t).structure,i="positionQualifiers",n=[];if(e.stage===Ds)return pe({result:{error:$b},stack:i});let{unplacedRoundQualifierCounts:r,positionAssignments:a,roundDrawPositions:s}=Z5e(t);for(let o of Object.keys(r)){let l=a?.filter(u=>s[o].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(r[o]>(l||0))return pe({result:{error:wye},context:{unfilledDrawPositions:l},stack:i});Et(0,r[o]).forEach(()=>{let u=wl(l);n.push(u),a?.forEach(c=>{c.drawPosition===u&&(c.qualifier=!0,delete c.participantId,delete c.bye)})})}return{...ue,qualifierDrawPositions:n}}function Z5e({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=ui({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:n}=xa({structure:e}),{stage:r,stageSequence:a}=e,{qualifiersCount:s,roundQualifiersCounts:o}=HD({drawDefinition:t,stageSequence:a,structureId:i,stage:r}),l=(o?Object.keys(o):[]).map(m=>ai(m)),{matchUps:u}=vn({structure:e}),{roundProfile:c}=bo({matchUps:u}),d=Object.assign({},...l.filter(m=>c?.[m]).map(m=>{var g,v;return{[m]:((v=(g=c?.[m])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=n?.filter(m=>m.qualifier).map(m=>m.drawPosition),h=s-(p?.length??0),f=p?.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let g=n?.filter(v=>{var y,b;return v.qualifier&&((b=(y=d[m])==null?void 0:y.drawPositions)==null?void 0:b.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[m]:(o?.[m]??0)-(g?.length??0)}})),unplacedQualifiersCount:h,placedQualifiersCount:f,roundQualifiersCounts:o,positionAssignments:n,roundDrawPositions:d,qualifiersCount:s}}function PQ({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:n,validSeedBlocks:r,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,groupsCount:u,structureId:c,matchUpsMap:d,structure:p,event:h}){let f=[],m=[],g=0;if(p||({structure:p}=ui({drawDefinition:a,structureId:c})),c||(c=p?.structureId),n||(n=pn({drawDefinition:a}).appliedPolicies),!r){let v=p&&z0({provisionalPositioning:t,appliedPolicies:n,drawDefinition:a,seedingProfile:s,structure:p});v!=null&&v.error&&m.push(v.error),r=v?.validSeedBlocks}return u=u??r?.length??0,Et(0,u).forEach(()=>{if(g<(u||0)){let v=X5e({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,structureId:c,matchUpsMap:d,event:h});v!=null&&v.success&&(g++,f.push(...v.seedPositions??[])),v.error&&m.push({seedPositionError:v.error})}}),m.length?{error:m}:{...ue,seedPositions:f}}function X5e({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,participants:s,structureId:o,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:c,unfilledPositions:d}=Mwe({provisionalPositioning:t,randomize:!0,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,structureId:o}),{appliedPolicies:p}=pn({drawDefinition:n}),{avoidance:h}=p??{};h&&s&&c?.length>2;let f=[];for(let m of c){let g=d.pop();if(!g)return{error:CD};f.push(g);let v=Yp({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,participantId:m,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:o,event:u});if(!v.success)return v}return{...ue,seedPositions:f}}function J5e({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:n}=xa({structure:i}),{seedAssignments:r}=ec({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(r||[]).filter(s=>s.participantId).map(s=>({[s.participantId]:s})));return n?.map(s=>a[s.participantId]?{...s,seedNumber:a[s.participantId].seedNumber,seedValue:a[s.participantId].seedValue}:"").filter(Boolean)}function Q5e({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let n=[];e.forEach(a=>{if(i-n.length>a.drawPositions.length)n.push(...a.drawPositions);else{let s=jH(ka(a.drawPositions,2)),o,l=t[n.length];for(;o=__(s,l);)n.push(o),l=t[n.length]}});let r=n.map(a=>Array.isArray(a)?co(a):a).flat(1/0);return Tve(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:r}function __(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,n=t[1].flat(1/0).length;if(i===n){let r=t[0].flat(1/0).includes(e)?t[0]:t[1];return __(e?r:t[Math.round(Math.random())],e)}return i<n?__(t[1],e):__(t[0],e)}function jH(t){let e=Math.floor(t.length/2);return t.length>2?[jH(t.slice(0,e)),jH(t.slice(e))]:t}function e6e({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,byesToPlace:s,structure:o}){var l;a||(a=z0({provisionalPositioning:t,appliedPolicies:i,drawDefinition:n,seedingProfile:r,structure:o}));let{isFeedIn:u,isLuckyStructure:c,isContainer:d}=a,{validSeedBlocks:p}=a;(l=i?.seeding)!=null&&l.containerByesIgnoreSeeding&&(p=[]);let h=J5e({provisionalPositioning:t,drawDefinition:n,structure:o})??[],f=Si([].concat(...e.map(S=>S.drawPositions))),m=h.filter(S=>f.includes(S.drawPosition)),g=(S,w)=>vU(S.seedValue)-vU(w.seedValue),v=p.reduce((S,w)=>{let T=m.filter(U=>{var C;return(C=w.drawPositions)==null?void 0:C.includes(U.drawPosition)}).sort(g);return S.concat(...T)},[]).map(S=>S.drawPosition),y=Q5e({orderedSortedFirstRoundSeededDrawPositions:v,validSeedBlocks:p,byesToPlace:s}),b=CQ({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,s),I=CQ({orderedSeedDrawPositions:y,relevantMatchUps:e}).slice(0,s);return{strictSeedOrderByePositions:b,blockSeedOrderByePositions:I,isLuckyStructure:c,positionedSeeds:h,isContainer:d,isFeedIn:u}}function CQ({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(n=>n.drawPositions).map(n=>n?.sort((r,a)=>r-a)).filter(n=>n?.[0]+1===n?.[1]);return t.map(n=>i.find(r=>r?.includes(n))).filter(Boolean).map(n=>n?.reduce((r,a)=>t.includes(a)?r:a,void 0)).filter(Boolean)}function t6e({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:n,drawDefinition:r,seedLimit:a,structure:s,isFeedIn:o}){var l,u;let c=(l=n?.seeding)==null?void 0:l.seedingProfile,d=s.stage===Kt,{positionAssignments:p}=xa({structure:s}),h=p?.filter(x=>x.participantId).map(x=>x.drawPosition),f={isCollectionMatchUp:!1},{matchUps:m,roundMatchUps:g}=vn({provisionalPositioning:t,matchUpFilters:f,structure:s}),v=g?.[1]||[],y=s.structureType===Eo?m:v,b=Si([].concat(...y.map(x=>x.drawPositions))),I=Math.min(...b)-1,S=h?.filter(x=>b.includes(x)),w=x=>{let O=Math.ceil(x.length/2),$=[x.slice(0,O),x.slice(O)],F=$.map(Q=>[].concat(...Q.flat(1/0)).length),j=Math.min(...F.flat(1/0)),H=Math.max(...F.flat(1/0)),G=F.indexOf(H),W=j!==H,q=co($),[Z,K]=!j||W?[$[G],$[1-G]]:[q[0],q[1]];return{greaterHalf:Z,lesserHalf:K}},T=x=>{let{greaterHalf:O,lesserHalf:$}=w(x),{greaterHalf:F,lesserHalf:j}=w(O),H=co(F.flat(1/0)).pop(),G=F.flat().filter(W=>W!==H);return{newlyFilteredChunks:[...$,...j,G],drawPosition:H}},U=x=>!e.includes(x),C=x=>!(S!=null&&S.includes(x)),E=x=>{let O=ka(x.sort(ra),Math.ceil(x.length/4)).map(j=>j.filter(C)),$=[].concat(...O.flat(1/0)).length,F=[];for(let j=0;j<$;j++){let{newlyFilteredChunks:H,drawPosition:G}=T(O);F.push(G),O=H}return F},{validSeedBlocks:P}=z0({provisionalPositioning:t,allPositions:!0,appliedPolicies:n,drawDefinition:r,structure:s}),M=P?.map(x=>{var O;return(O=x.drawPositions)==null?void 0:O.map($=>$+I)}),R;if(o){let x=b.length,{seedBlocks:O}=$8({cluster:eN(c)===S$,participantsCount:x});R=O.map($=>$.map(F=>F+I)).map(E).filter($=>$.length)}else d?R=M?.map(x=>x.filter(C)):R=M?.map(E).filter(x=>x.length);let N=y.map(x=>x.drawPositions).map(x=>x?.sort((O,$)=>O-$)).filter(x=>x?.[0]+1===x?.[1]),A=x=>N.reduce((O,$)=>$.includes(x)?$.reduce((F,j)=>j!==x?j:F,void 0):O,void 0),_=R.map(x=>x.map(A)).flat(1/0).filter(C).filter(U).filter(Boolean);if(d&&!s.structures){let x=a%4,O=_.slice(0,x),$=(u=g[s.roundLimit])==null?void 0:u.length,F=ka(_.slice(x),$).map(co).flat();_=O.concat(F)}return{unseededByePositions:_}}function i6e({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:n,event:r}){var a;let s={isCollectionMatchUp:!1},{matchUps:o,roundMatchUps:l}=vn({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:s,matchUpsMap:i,structure:n,event:r}),u=l?.[1]||[],c=n?.structureType===Eo,d=c?o:u,p=c?((a=n?.structures)==null?void 0:a.length)||0:o.length,{structureId:h,stage:f,stageSequence:m}=n,g=x0({entryStatuses:yd,provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:h,stage:f}),{qualifiersCount:v}=HD({provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:h,stage:f}),y=g.length+v,{positionAssignments:b,unassignedPositions:I}=xa({structure:n}),S=I?.map(P=>P.drawPosition),w=b?.filter(P=>P.bye).length,T=b?.filter(P=>P.bye).map(P=>P.drawPosition),U=d.map(P=>P.drawPositions).filter(P=>P?.reduce((M,R)=>!(T!=null&&T.includes(R))&&M,!0)).flat(1/0).filter(P=>S?.includes(P)),C=b?.length,E=C?C-y:0;return E>p&&n.stageSequence===1&&n.stage!==Ds&&(E=p),{placedByes:w,byesCount:E,relevantMatchUps:d,placedByePositions:T,roundMatchUps:l,positionsToAvoidDoubleBye:U}}function RQ({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:n,seedBlockInfo:r,seedingProfile:a,matchUpsMap:s,structureId:o,structure:l,seedLimit:u,seedsOnly:c,event:d}){var p;l||({structure:l}=ui({drawDefinition:n,structureId:o})),o||(o=l?.structureId);let h=!(l?.structures??l?.stage===Kt),{byesCount:f,placedByes:m,relevantMatchUps:g}=i6e({provisionalPositioning:t,drawDefinition:n,matchUpsMap:s,structure:l,event:d}),v=f-(m||0);if(v<=0)return{...ue};let{strictSeedOrderByePositions:y,blockSeedOrderByePositions:b,isLuckyStructure:I,isFeedIn:S}=e6e({provisionalPositioning:t,relevantMatchUps:g,appliedPolicies:i,drawDefinition:n,seedingProfile:a,seedBlockInfo:r,byesToPlace:v,structure:l}),w=l?.structureType&&[Eo,T$].includes(l.structureType)&&((p=i?.seeding)==null?void 0:p.containerByesIgnoreSeeding),T=h&&b!=null&&b.length?b:y,{unseededByePositions:U}=t6e({provisionalPositioning:t,seedOrderByePositions:T,isLuckyStructure:I,appliedPolicies:i,drawDefinition:n,seedLimit:u,structure:l,isFeedIn:S}),C=R=>R%2,E=(R,N)=>(R||[]).every(A=>C(A)?N!==A+1:N!==A-1),P=[].concat(...T);if(!c)for(;U.length;){let R=U.find(N=>E(P,N));R?(P.push(R),U=U.filter(N=>N!==R)):(P.push(...U),U=[])}w&&(P=co(P),mu({ignoreSeededByes:w})&&console.log({byePositions:P}));let M=P.slice(0,v);for(let R of M){let N=Eu({provisionalPositioning:t,tournamentRecord:e,drawDefinition:n,drawPosition:R,matchUpsMap:s,structureId:o,structure:l,event:d});if(N!=null&&N.error)return N}return{...ue,unseededByePositions:U,byeDrawPositions:M}}function tN(t){var e,i,n,r;let{drawDefinition:a}=t,{applyPositioning:s=!0,provisionalPositioning:o,multipleStructures:l,placeByes:u=!0,tournamentRecord:c,placementGroup:d,seedingProfile:p,structureId:h,seedLimit:f,seedsOnly:m,drawType:g,drawSize:v,event:y}=t,b=[];s||(Hye(),a=At(a,!1,!0));let I=$=>(s||D_(),pe({result:$,stack:"automatedPositioning"})),S=$=>(s||D_(),$),w=ui({drawDefinition:a,structureId:h});if(w.error)return I(w);let T=w.structure;if(!T)return{error:pr};let U=t.appliedPolicies||((e=pn({drawDefinition:a,structure:T,event:y}))==null?void 0:e.appliedPolicies),{qualifiersCount:C}=HD({stageSequence:T.stageSequence,provisionalPositioning:o,stage:T.stage,drawDefinition:a,structureId:h}),E=qb;if(!((i=x0({stageSequence:T.stageSequence,provisionalPositioning:o,stage:T.stage,placementGroup:d,drawDefinition:a,entryStatuses:E,structureId:h}))!=null&&i.length)&&!C)return S({...ue});let P=t.matchUpsMap??Cs({drawDefinition:a}),M=t.inContextDrawMatchUps??((n=pa({inContext:!0,drawDefinition:a,matchUpsMap:P}))==null?void 0:n.matchUps),R=[],N=z0({provisionalPositioning:o,appliedPolicies:U,drawDefinition:a,seedingProfile:p,structure:T});if(N.error)return N;let{validSeedBlocks:A}=N;b.push({validSeedBlocks:A});let _=t.participants||(c?(r=hr({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:c}))==null?void 0:r.participants:[]);if(eN(T.seedingProfile||p)===ab){let $=u?RQ({provisionalPositioning:o,tournamentRecord:c,appliedPolicies:U,drawDefinition:a,seedBlockInfo:N,matchUpsMap:P,structure:T,seedLimit:f,seedsOnly:m,event:y}):void 0;if($!=null&&$.error)return I($);R=$.unseededByePositions,b.push({action:"positionByes",unseededByePositions:R});let F=T.seedingProfile?{positioning:T.seedingProfile}:p;if($=PQ({seedingProfile:F,provisionalPositioning:o,inContextDrawMatchUps:M,tournamentRecord:c,appliedPolicies:U,validSeedBlocks:A,drawDefinition:a,seedBlockInfo:N,participants:_,matchUpsMap:P,structure:T,event:y}),$.error)return I($);b.push({seedPositions:$.seedPositions,action:"positionSeedBlocks"})}else{if(g!==Bb){let F=T.seedingProfile?{positioning:T.seedingProfile}:p,j=PQ({seedingProfile:F,provisionalPositioning:o,inContextDrawMatchUps:M,tournamentRecord:c,appliedPolicies:U,validSeedBlocks:A,drawDefinition:a,seedBlockInfo:N,participants:_,matchUpsMap:P,structure:T,event:y});if(j.error)return I(j);b.push({action:"positionSeedBlocks",seedPositions:j.seedPositions})}let $=u?RQ({provisionalPositioning:o,tournamentRecord:c,appliedPolicies:U,drawDefinition:a,seedBlockInfo:N,matchUpsMap:P,structure:T,seedLimit:f,seedsOnly:m,event:y}):void 0;if($!=null&&$.error)return I($);R=$?.unseededByePositions,b.push({action:"positionByes",byeDrawPositions:$?.byeDrawPositions,unseededByePositions:R})}let x={};if(!m){let $=K5e({inContextDrawMatchUps:M,tournamentRecord:c,appliedPolicies:U,validSeedBlocks:A,drawDefinition:a,seedBlockInfo:N,participants:_,matchUpsMap:P,structure:T});if($.error||($.conflicts&&(x.qualifierConflicts=$.conflicts),b.push({action:"positionQualifiers",qualifierDrawPositions:$.qualifierDrawPositions}),$=W5e({provisionalPositioning:o,inContextDrawMatchUps:M,unseededByePositions:R,multipleStructures:l,tournamentRecord:c,drawDefinition:a,seedBlockInfo:N,participants:_,matchUpsMap:P,structureId:h,structure:T,drawSize:v,event:y}),$.error))return I($);$.conflicts&&(x.unseededConflicts=$.conflicts),b.push({action:"positionUnseededParticipants"})}let{positionAssignments:O}=Fn({drawDefinition:a,structure:T});return Bn({drawDefinition:a,structureIds:[h]}),s||D_(),{positionAssignments:O,conflicts:x,...ue,positioningReport:b}}function WD(t){var e;let{applyPositioning:i=!0,provisionalPositioning:n,tournamentRecord:r,drawDefinition:a,seedingProfile:s,structureId:o,placeByes:l,seedsOnly:u}=t;if(!a)return{error:fu};if(!uv({drawDefinition:a,structureId:o})&&!n)return{error:Y6};let c=(e=Hwe({drawDefinition:a,structureId:o}).playoffStructures)==null?void 0:e.sort((h,f)=>fx(h)-fx(f)),d=[],p=[];if(c)for(let h of c){let{structureId:f}=h,m=tN({structureId:f,provisionalPositioning:n,applyPositioning:i,tournamentRecord:r,drawDefinition:a,seedingProfile:s,placeByes:l,seedsOnly:u});if(m.error)return m;m.positionAssignments&&d.push({positionAssignments:m.positionAssignments,structureId:f}),m.positioningReport&&p.push(m.positioningReport)}return{...ue,structurePositionAssignments:d,positioningReports:p}}function Ywe({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>bi(i)))&&pe({result:{error:Ce},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let n=e[i.structureId];n&&(i.structureOrder=n)}),t.structures.sort((i,n)=>QT(i.structureOrder)-QT(n.structureOrder)),{...ue}):{error:Lt}}function nB({drawDefinition:t}){var e,i,n,r,a,s,o;let l=t.structures??[],u=t.links??[],c=new Map,d=T=>{let U=c.get(T)||c.set(T,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&c.get(T);if(U&&!(U!=null&&U.stage)){let C=l.find(E=>E.structureId===T);U.stage=C?.stage}return U},p={},h={},f=u.map(T=>{let U=T.source.structureId,C=T.target.structureId,E=d(U),P=d(C);return[sb,Oc,U$,ab].includes(T.target.feedProfile)?(E?.targets.push(C),P?.sources.push(U)):T.target.feedProfile===Pd&&(P?.drawSources.push(U),E?.drawTargets.push(C)),h[C]=h[C]||T.target.feedProfile===Pd,p[C]=Si([...p[C]||[],U]).filter(Boolean),[T.source.structureId,T.target.structureId]});for(let T of c.keys()){let U=c.get(T);if(U){let C=U.targets??[];for(;C.length;){let E=C.pop(),P=E&&c[E];(e=P?.targets)!=null&&e.length?C.push(...P.targets):P&&(U.rootStage=P.stage)}if(U.rootStage||(U.rootStage=U.stage),!((i=U.targets)!=null&&i.length)){let E=U.sources??[];for(;E.length;){let P=E.pop(),M=P&&c[P];if((n=M?.sources)!=null&&n.length){for(let R of M.sources)(r=U.progeny)!=null&&r.includes(R)||(a=U.progeny)==null||a.push(R);E.push(...M.sources)}}}}}let m=0;for(let T of c.keys()){let U=c.get(T);if(U&&U.rootStage===Kt){let C=[(s=U.drawTargets)==null?void 0:s[0]],E=0;for(;C.length;){E+=1;let P=C.pop(),M=P?c.get(P):void 0;(o=M?.drawTargets)!=null&&o.length&&C.push(M.drawTargets[0])}U.distanceFromMain=E,E>m&&(m=E)}}let g=f.length;Et(0,Math.ceil(g/2)).forEach(()=>{f=Et(0,g).map(T=>{let U=f[T],C=f.reduce((E,P)=>yo(U,P)?E.concat(...P):E,[])||[];return Si(U.concat(...C))})});let v=f[0],y=(T,U)=>Pr(T,U).length===T.length,b=f.slice(1).reduce((T,U)=>T&&y(U,v),!0),I=[v].filter(Boolean),S=[v].filter(Boolean);l.forEach(T=>{let{structureId:U,stage:C}=T;I.find(E=>E.includes(U))||(I.push([U]),C!==qa&&S.push([U]))});let w=b&&S.length===1;return!(u!=null&&u.length)&&l.length===1&&d(l[0].structureId),{structureProfiles:Object.fromEntries(c),allStructuresLinked:w,maxQualifyingDepth:m,sourceStructureIds:p,hasDrawFeedProfile:h,structureGroups:I}}function Kwe({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=nB({drawDefinition:t});for(let n of t.structures){let r=i[n.structureId];r.distanceFromMain&&(n.stageSequence=e+1-r.distanceFromMain)}return{...ue}}function Y8(t){let e=Yt(t,[{[Ta]:!0,[Po]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:n,structure:r,link:a}=t;return n6e({tournamentId:i.tournamentId,drawDefinition:n,structure:r,link:a})}function n6e(t){var e;let i=Yt(t,[{[Po]:!0,[R$]:!0},{link:!0,[Ho]:el,[Nve]:J6}]);if(i.error)return i;let{drawDefinition:n,tournamentId:r,structure:a,eventId:s,link:o}=t,l=o.target.structureId,u=ui({drawDefinition:n,structureId:l});if(u.error)return pe({stack:"attachQualifyingStructure",context:{targetStructureId:l},result:u});n.structures||(n.structures=[]),n.links||(n.links=[]),n.structures.push(a),n.links.push(o),Kwe({drawDefinition:n});let c=((e=vn({structure:a}))==null?void 0:e.matchUps)||[];return sv({drawDefinition:n,tournamentId:r,matchUps:c,eventId:s}),Bn({drawDefinition:n,structureIds:[a.structureId]}),{...ue}}function Zwe({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:Ce};if(!t)return{error:Lt};let i=Object.assign({},...e.map(n=>{if(!Qi(n))return;let{structureId:r,structureName:a}=n||{};if(!(!r||!a))return{[r]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Xt};for(let n of t.structures||[]){let r=i[n.structureId];if(r&&(n.structureName=r),n.structures)for(let a of n.structures){let s=i[a.structureId];s&&(a.structureName=s)}}return{...ue}}function K8({drawDefinition:t,timeItem:e}){if(!t)return{error:fu};if(!e)return{error:h7};let i=e&&Object.keys(e),n=["itemType","itemValue"];if(n.filter(a=>i.includes(a)).length!==n.length)return{error:p7};t.timeItems||(t.timeItems=[]);let r=new Date().toISOString();return Object.assign(e,{createdAt:r}),t.timeItems.push(e),NM({drawDefinition:t}),{...ue}}function Xwe(t){var e;let{tournamentRecord:i,drawDefinition:n,structureId:r,event:a}=t,s=Yt(t,[{drawDefinition:!0,structureId:!0}]);if(s.error)return s;let o=n.structures??[],l=o.find(y=>y.structureId===r);if(!l)return{error:pr};let u=o.find(({stage:y,stageSequence:b})=>y===_t&&b===1),c=r===u?.structureId,d=o.filter(({stage:y})=>y===Kt).map(Bl("structureId"));if(c&&!d.length)return{error:_ve};let p=d.includes(r),h=r6e({isQualifyingStructure:p,structure:l,...t});if(h!=null&&h.error)return h;let{structureIdsToRemove:f,relatedStructureIdsMap:m}=s6e({qualifyingStructureIds:d,isQualifyingStructure:p,isMainStageSequence1:c,mainStageSequence1:u,drawDefinition:n,structureId:r}),{removedMatchUpIds:g,removedStructureIds:v}=o6e({relatedStructureIdsMap:m,qualifyingStructureIds:d,isMainStageSequence1:c,mainStageSequence1:u,drawDefinition:n,structureIdsToRemove:f,structureId:r});if(a6e({removedMatchUpIds:g,drawDefinition:n}),c){let y=(e=u.matchUps??[])==null?void 0:e.map(Bl("matchUpId"));g.push(...y),u.positionAssignments=[],u.seedAssignments=[],u.matchUps=[],u.extensions&&(u.extensions=[])}return p&&Kwe({drawDefinition:n}),Xm({tournamentId:i?.tournamentId,matchUpIds:g,action:"removeStructure",eventId:a?.eventId,drawDefinition:n}),Bn({drawDefinition:n,eventId:a?.eventId}),{...ue,removedMatchUpIds:g,removedStructureIds:v}}function r6e({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:n,structure:r,event:a,force:s}){var o,l,u,c,d,p;let h=[n];if(t){let f=g=>{var v;return(v=i.links)==null?void 0:v.find(y=>y.target.structureId===g)},m=(o=f(n))==null?void 0:o.source.structureId;for(;m;)h.push(m),m=(l=f(m))==null?void 0:l.source.structureId}if((u=pa({matchUpFilters:{structureIds:h},drawDefinition:i}).matchUps)!=null&&u.some(({score:f})=>Sa({score:f}))){let f=(c=pn({tournamentRecord:e,drawDefinition:i,structure:r,event:a}))==null?void 0:c.appliedPolicies;if(!(s??((p=(d=f?.[Qu])==null?void 0:d.allowDeletionWithScoresPresent)==null?void 0:p.structures)))return{error:m$}}return{...ue}}function a6e({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=pa({drawDefinition:e});i?.forEach(n=>{n.winnerMatchUpId&&t.includes(n.winnerMatchUpId)&&delete n.winnerMatchUpId,n.loserMatchUpId&&t.includes(n.loserMatchUpId)&&delete n.loserMatchUpId})}function s6e({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureId:a}){let s=(r.structures??[]).map(Bl("structureId")),o=c=>{var d;return((d=r.links)==null?void 0:d.map(p=>p.source.structureId===c&&p.target.structureId!==n?.structureId&&p.target.structureId).filter(Boolean))??[]},l=c=>{var d;return((d=r.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===c&&p.source.structureId).filter(Boolean))??[]},u=new Map;return s.forEach(c=>u.set(c,e?l(c):o(c))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}function o6e({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureIdsToRemove:a,structureId:s}){let o=[],l=[];for(;a!=null&&a.length;){let u=a.pop();l.push(...c6e({idBeingRemoved:u,drawDefinition:r}));let c=u6e({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:r,structureId:s});o.push(...c.removedStructureIds);let d=l6e({relatedStructureIdsMap:t,mainStageSequence1:n,idBeingRemoved:u,structureId:s});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:o}}function l6e({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:n}){var r;return t&&((r=e.get(t))==null?void 0:r.filter(a=>a!==i?.structureId||n===i.structureId))}function u6e({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:n,structureId:r}){var a;let s=[];return n.links=((a=n.links)==null?void 0:a.filter(o=>o.source.structureId!==i&&o.target.structureId!==i))??[],(!e||e&&t.length||i!==r)&&(n.structures=(n.structures??[]).filter(o=>(i&&i===o.structureId&&s.push(i),o.structureId!==i))),{removedStructureIds:s}}function c6e({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=ui({structureId:t,drawDefinition:e}),n=vn({structure:i}).matchUps;return Z7(n)}function Sx({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:n}){if(!e)return{error:Lt};if(!b8({drawDefinition:e,stage:n}))return{error:$b};let r=d4e({drawDefinition:e,stage:n}),{qualifiersCount:a}=HD({drawDefinition:e,stageSequence:t,stage:n}),s=r+a;if(i<s)return{error:Lve};let{entryProfile:o}=y8({attributes:[{[n]:{drawSize:i}}],drawDefinition:e});return Bn({drawDefinition:e}),{...ue,entryProfile:o}}function Jwe({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?b8({drawDefinition:e,stage:i})?(y8({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),Bn({drawDefinition:e}),{...ue}):{error:$b}:{error:Lt}}function d6e({drawDefinition:t,drawSize:e}){if(!t)return{error:Lt};let i=Sx({stage:qa,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(Bn({drawDefinition:t}),{...ue})}function Qwe(t){return d6e(t)}var p6e="qualifierDrawPositionAssignment",h6e="withdrawParticipantAtDrawPosition",f6e="alternateDrawPositionAssignment",m6e="luckyLoserDrawPositionAssignment",MQ="removeDrawPositionAssignment",e0e="swapDrawPositionAssignments",g6e="modifyPairAssignment",v6e="adHocPositionSwap",y6e="modifyParticipantOtherName",NQ="assignDrawPosition",b6e="removeSeededParticipant",I6e="assignDrawPositionBye",w6e="modifySeedAssignment",t0e="addPenalty",Z8="MODIFY_PAIR",rB="QUALIFIER",X8="ALTERNATE",J8="WITHDRAW",Rw="ASSIGN",GH="REMOVE",Q8="LUCKY",NP="REMOVE_SEED",aB="SWAP",n1="NICKNAME",KI="SEED_VALUE",Mw="PENALTY",Tx="BYE",S6e={MODIFY_PAIR_ASSIGNMENT:Z8,QUALIFYING_PARTICIPANT:rB,ALTERNATE_PARTICIPANT:X8,WITHDRAW_PARTICIPANT:J8,ASSIGN_PARTICIPANT:Rw,LUCKY_PARTICIPANT:Q8,REMOVE_ASSIGNMENT:GH,SWAP_PARTICIPANTS:aB,ADD_NICKNAME:n1,REMOVE_SEED:NP,ADD_PENALTY:Mw,ASSIGN_BYE:Tx,SEED_VALUE:KI};function i0e({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:n,event:r}){if(!e)return{error:Lt};if(!n)return{error:Tu};if(i?.length!==2)return{error:Ce,drawPositions:i};let a=Cs({drawDefinition:e}),{matchUps:s}=pa({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:o}=ui({drawDefinition:e,structureId:n});if(!o)return{error:pr};let l=pn({tournamentRecord:t,drawDefinition:e,event:r}).appliedPolicies??{},u;if(o.structureType===Eo?u=D6e({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:r}):u=T6e({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:r}),u.error)return u;if(h8({structure:o,drawPositions:i}),B$({appliedPolicies:l,drawDefinition:e,positionAction:{name:e0e,drawPositions:i,structureId:n}}),ov({tournamentId:t?.tournamentId,drawDefinition:e,structure:o,event:r}),r.eventType===Fl){let c=vn({matchUpFilters:{matchUpTypes:[hu]},inContext:!0,structure:o}).matchUps.filter(p=>{var h;return(h=p.drawPositions)==null?void 0:h.some(f=>i.includes(f))}),d=vn({matchUpFilters:{matchUpTypes:[hu]},structure:o}).matchUps;c.forEach(p=>{(p.sides||[]).forEach(h=>{var f;let m=h?.drawPosition;if(i.includes(m)){let g=h.participantId,v=d.find(({matchUpId:b})=>b===p.matchUpId),y=(f=p?.sides)==null?void 0:f.reduce((b,I,S)=>I.drawPosition===m?S:b,void 0);j8({inContextTargetMatchUp:p,drawPositionSideIndex:y,teamParticipantId:g,tournamentRecord:t,drawDefinition:e,matchUp:v,event:r})}})})}return Bn({drawDefinition:e,structureIds:[n]}),{...ue}}function T6e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:s}){let o=a?.positionAssignments.filter(u=>n?.includes(u.drawPosition));if(!o)return{error:Ce,structure:a,info:"Missing positionAssignments"};if(o.filter(({bye:u})=>u).length===2)return{...ue};if(o.filter(({qualifier:u})=>u).length===2)return{...ue};let l=o.some(({qualifier:u})=>u);return o.some(({bye:u})=>u)&&!l?n0e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:r,structure:a,event:s}):U6e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:r,structure:a,event:s})}function n0e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:s}){let o=n.find(({bye:f})=>f),l=n.find(({participantId:f})=>f),u=o.drawPosition,{participantId:c,drawPosition:d}=l,{structureId:p}=a,h=i1({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r});return h.error||(h=i1({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r}),h.error)||(Eu({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r,event:s}),h=Yp({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:c,matchUpsMap:r,event:s}),h.error)?h:{...ue}}function U6e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:s}){let o=Object.assign({},...n.map((l,u)=>{let{drawPosition:c}=l,d={...n[1-u],drawPosition:c};return{[c]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>o[l.drawPosition]||l),H8({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:n,structure:a,event:s}),{...ue}}function D6e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:s}){var o;let l=(o=a.structures)==null?void 0:o.reduce((c,d)=>{let p=d?.positionAssignments.filter(h=>n?.includes(h.drawPosition));return p&&c.push(...p),c},[]);if(l.filter(({bye:c})=>c).length===2)return{...ue};if(l.filter(({qualifier:c})=>c).length===2)return{...ue};H8({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:l,structure:a,event:s});let u=l.some(({qualifier:c})=>c);if(l.some(({bye:c})=>c)&&!u)n0e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:l,matchUpsMap:r,structure:a,event:s});else{let c=At(l,!1,!0);l.forEach((d,p)=>{let h=c[1-p].participantId;d.qualifier=c[1-p].qualifier,d.participantId=h})}return{...ue}}function r0e({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:n}){var r;let a="removeSeededParticipant";if(!t)return{error:lt};if(!e)return{error:Lt};let s=(e.structures??[]).find(o=>o.structureId===n);return s?!s.stage||![_t,Kt].includes(s.stage)||s.stage===_t&&s.stageSequence!==1?pe({result:{error:Lb},stack:a}):(r=s.seedAssignments)!=null&&r.find(o=>o.participantId===i)?{...ue}:pe({info:"participant not seeded",result:{error:Xa},context:{participantId:i}}):pe({result:{error:pr},stack:a})}function iN({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:n,targetStructureId:r,linkType:a=Pm}){return!n||!r?{error:Tu}:{link:Gt({linkType:a,source:{roundNumber:i,structureId:n,finishingPositions:e},target:{feedProfile:Pd,roundNumber:t,structureId:r}})}}function e9({roundPosition:t,roundNumber:e,idPrefix:i,uuids:n}){return i?`${i}-${e}-${t}`:n?.pop()||gn()}function Ux({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:n,idPrefix:r,isMock:a,uuids:s,nodes:o}){let l=0,u=[],c=1,d=i-1,p=o?.length;for(;l<(p||0);){let h=o?.[l],f=o?.[l+1];d&&(h.roundNumber=d),f&&d&&(f.roundNumber=d);let m=e9({roundPosition:c,roundNumber:i,idPrefix:r,uuids:s}),g={roundPosition:c,children:[h,f],matchUpId:m};u.push(g);let v={drawPositions:g.children.map(y=>y?.drawPosition).filter(Boolean),matchUpStatus:Or,matchUpId:g.matchUpId,roundPosition:c,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),n.push(v),c++,l+=2}return{roundNodes:u,matchUps:n}}function Kp({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:n,matchUpType:r,roundLimit:a,idPrefix:s,drawSize:o,isMock:l,uuids:u}){if(isNaN(o)||o<2||n&&o<=n)return{matchUps:[],roundsCount:0};if(n&&(!Gd(o)||o%n)){let g=n;for(;g<o;)g=2*g;o=g}let c=n&&!(o%2)&&(!isNaN(n)||i&&!isNaN(i))&&(o/n===Math.round(o/n)||i&&o/i===Math.round(o/i));if(!Gd(o)&&!c)return{matchUps:[],roundsCount:0};let d=Et(1,o+1).map(g=>({drawPosition:g})),p,h=[],f=1;for({roundNodes:p,matchUps:h}=Ux({matchUpType:r,roundNumber:f,idPrefix:s,matchUps:h,isMock:l,nodes:d,uuids:u}),f++,a=a??i;p.length>1;)n&&p.length===n&&(a=f-1),{roundNodes:p,matchUps:h}=Ux({nodes:p,matchUpType:r,roundNumber:f,idPrefix:s,matchUps:h,isMock:l,uuids:u}),f++;let m=f-1;return h=zM({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:a,matchUps:h}),a?h=h.filter(g=>a&&(g.roundNumber??0)<=a):a=f-1,{drawSize:o,matchUps:h,roundsCount:m,roundLimit:a}}function t9(t){var e,i,n,r,a,s;let o="generateQualifyingStructure";if(!t.drawDefinition)return pe({result:{error:Lt},stack:o});if(t.drawSize&&!bi(t.drawSize)||t.participantsCount&&!bi(t.participantsCount)||t.qualifyingPositions&&!bi(t.qualifyingPositions))return pe({result:{error:Ce},stack:o});let l=t.drawSize??q6(t.participantsCount),{qualifyingRoundNumber:u,qualifyingPositions:c,targetStructureId:d,structureOptions:p,appliedPolicies:h,drawDefinition:f,matchUpFormat:m,structureName:g,structureId:v,roundTarget:y,drawType:b,idPrefix:I,isMock:S,uuids:w}=t;if(!t.drawSize)return pe({result:{error:gM},context:{drawSize:l},stack:o});if(c&&c>=t.drawSize)return pe({result:{error:Ce},context:{drawSize:l,qualifyingPositions:c},stack:o});let T,U,C,E,P=0,M,R=1,{structureProfiles:N}=nB({drawDefinition:f}),A=N[d];if(!A)return pe({result:{error:pr},context:{targetStructureId:d},stack:o});let _=f.matchUpType,x=y?`${y}-`:"",O=A.stage===Kt,$=((i=(e=h?.[pU])==null?void 0:e.namingConventions)==null?void 0:i.pre)??((r=(n=m4e[pU])==null?void 0:n.namingConventions)==null?void 0:r.pre),F=O&&$?`${$}-`:"",j=g??(x?`${F}${Ss(Kt)} ${x}`:`${F}${Ss(Kt)}`);if(b===od){let{maxRoundNumber:W,structures:q,groupCount:Z}=JM({structureName:g??j,structureId:v??w?.pop(),stage:Kt,structureOptions:p,appliedPolicies:h,stageSequence:R,matchUpType:_,roundTarget:y,idPrefix:I,drawSize:l,isMock:S,uuids:w});P=Z,T=W,C=q[0],M=[1]}else({drawSize:l,matchUps:E,roundLimit:T,roundsCount:U}=Kp({qualifyingRoundNumber:u,qualifyingPositions:c,matchUpType:_,idPrefix:I,drawSize:l,isMock:S,uuids:w})),T||(T=U),C=Gu({structureName:g??j,structureId:v??w?.pop(),qualifyingRoundNumber:T,stage:Kt,matchUpFormat:m,stageSequence:R,matchUpType:_,roundLimit:T,matchUps:E}),y&&dn({extension:{name:sh,value:y},element:C}),P=(a=E?.filter(W=>W.roundNumber===T))==null?void 0:a.length;let H=b===od?Em:Pm,G=C&&T&&((s=iN({sourceStructureId:C.structureId,sourceRoundNumber:T,targetStructureId:d,finishingPositions:M,linkType:H}))==null?void 0:s.link);return{qualifyingDrawPositionsCount:l,qualifiersCount:P,...ue,structure:C,link:G}}function a0e(t){if(!t.tournamentRecord)return{error:lt};let e=E6e(t);return e.error,e}function E6e(t){if(!t.drawDefinition)return{error:Lt};if(!t.targetStructureId)return{error:Tu};let e=t9(t);if(e.error)return e;let{structure:i,link:n}=e;return!i||!n?{error:Ce}:Y8({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:n})}function s0e(t){var e;let i=Yt(t,[{[Po]:!0,[E$]:!0,[ah]:!0},{[gWe]:!0,[vs]:p=>Number.isInteger(p)&&p>0},{[vs]:p=>Array.isArray(p)&&p.length===2&&p.every(nr),[vu]:El,participantIds:!0}]);if(i.error)return i;let{drawDefinition:n,structureId:r,tournamentRecord:a,event:s}=t,{structure:o}=ui({drawDefinition:n,structureId:r});if(!o)return{error:pr};if(!Vo({structure:o}))return{error:Lb};let l=p=>{var h;return(h=p.sides)==null?void 0:h.map(f=>f.participantId).some(f=>t.participantIds.includes(f))},u=p=>p.roundNumber===t.roundNumber,c=p=>!Sa(p),d=(o?.matchUps??[]).filter(u).filter(c).filter(l);if(d.length!==2)return{error:El};for(let p of d){let h=(e=p?.sides)==null?void 0:e.find(f=>t.participantIds.includes(f?.participantId));if(h){let f=t.participantIds.find(m=>m!==h?.participantId);h.participantId=f,Xi({tournamentId:a?.tournamentId,eventId:s?.eventId,drawDefinition:n,matchUp:p})}}return Bn({drawDefinition:n,structureIds:[r]}),{...ue}}function P6e({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:n,idPrefix:r,matchUps:a,isMock:s,uuids:o,nodes:l,fed:u}){let c=l.length,d=e?e-c:void 0,p=Et(0,c).map(m=>d?d+m:void 0),h=[];for(let m=0;m<c;m++){let g=p.shift(),v={drawPosition:g,fed:u+1,feed:!0},y=l[m];y.roundNumber=i-1;let b=e9({roundPosition:y.roundPosition,roundNumber:i,idPrefix:r,uuids:o}),I={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:Or,roundNumber:i,matchUpId:b};t&&(I.matchUpType=n),s&&(I.isMock=!0),a.push(I);let S={children:[y,v]};h.push(S)}let f=e?e-c:void 0;return{roundNodes:h,matchUps:a,drawPosition:f}}function cv(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:n=0,skipRounds:r=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:s,finishingPositionOffset:o,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:c,matchUpType:d,idPrefix:p,isMock:h,uuids:f,fmlc:m}=t;a=a??N(e);let g=C6e({drawSize:a}),v=g.length,y=0;if(i!=null&&i.length)y=i.reduce((A,_)=>A+_,0);else if(e){let A=e-a;i=g.filter(_=>_<=A?(A-=_,!0):!1),y=i.reduce((_,x)=>_+x,0),n=i.length}else r>=v?n=0:u&&(n=v-u,r=0),i=g.filter((A,_)=>u&&!n||n&&_>=r+n||_<r?0:A),y=i.reduce((A,_)=>A+_,0),n=i.length;let b=[...g,...i].sort((A,_)=>_-A),I=b.length,S=[...(l??[]).map(A=>A-1),...(s??[]).map(A=>I-A)].map(A=>b[A]).reduce((A,_)=>A+_,0);y=y-S;let w=0,T=[],U,C=1,E=Et(0,a).map((A,_)=>({drawPosition:_+1+y})),P=y+1;for(let A of g){if({roundNodes:U,matchUps:T}=Ux({matchUpType:d,roundNumber:C,idPrefix:p,matchUps:T,isMock:h,nodes:E,uuids:f}),C++,i.includes(A)){let _=Ol(i)[A],x=Et(0,_),O=I+1-C,$=s?.includes(O)??l?.includes(C);x.forEach(()=>{({roundNodes:U,matchUps:T,drawPosition:P}=P6e({drawPosition:!$&&P||void 0,nodes:U,matchUpType:d,roundNumber:C,idPrefix:p,matchUps:T,isMock:h,uuids:f,fed:w})),C++,w+=1})}E=U}I!==C-1&&console.log("ERROR");let M=a-y;T=zM({finishingPositionOffset:c?M:o,positionsFed:y,roundsCount:I,matchUps:T,fmlc:m});let R=U!=null&&U.length?U[0]:U;return R&&(R.roundNumber=C-1,R.matchUps=T),{draw:R,matchUps:T,roundsCount:I};function N(A){let _=W6(A);return _>A?_/2:_}}function C6e({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Et(0,e).reverse().map(i=>Math.pow(2,i))}function gT(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:s,stageSequence:o=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:c,roundOffset:d=0,drawDefinition:p,staggeredEntry:h,sequenceLimit:f,stage:m=_t,drawSize:g,idPrefix:v,isMock:y,uuids:b}=t;if(!(!s||!u||s!=null&&s[l])||g<2||f&&o>f)return{};let I=[],S=[],w=[],T=t.matchUpType??p?.matchUpType,U=e+1,C=e+g,E=`${U}-${C}`,P=s?.[l],M=n&&`${n} `||"",R=s?.[E]??r?.[E],N=t.structureName||R?.name||P?.name&&(i?`${M}${P?.name}`:P.name)||`${M}${E}`,A=R?.abbreviation??P?.abbreviation,_=t.structureId??P?.structureId??b?.pop(),x={idPrefix:v&&`${v}-${N}-RP`,finishingPositionOffset:e,matchUpType:T,drawSize:g,isMock:y,uuids:b},{matchUps:O}=h?cv(x):Kp(x),$=Gu({structureAbbreviation:A,stageSequence:o,structureName:N,matchUpType:T,roundOffset:d,structureId:_,matchUps:O,stage:m});I.push(...O),S.push($);let F=Math.ceil(Math.log(g)/Math.log(2)),j=c?Math.min(c-d,F):(!a||U<a)&&F||0;return g>2&&Et(1,j+1).forEach(G=>H(G)),{structureId:$.structureId,matchUps:I,structureName:N,structures:S,links:w,...ue};function H(G){let W=g/Math.pow(2,G);if(W<2)return;let q=g/Math.pow(2,G)+e;if(a&&q+1>a)return;let{structures:Z,structureId:K,matchUps:Q,links:J}=gT({finishingPositionOffset:q,exitProfile:`${l}-${G}`,roundOffset:d+G,stageSequence:o+1,drawSize:W,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:s,exitProfileLimit:u,roundOffsetLimit:c,drawDefinition:p,sequenceLimit:f,matchUpType:T,idPrefix:v,uuids:b,stage:m});if($.structureId&&K){let ne={linkType:sf,source:{roundNumber:G,structureId:$.structureId},target:{roundNumber:1,feedProfile:Oc,structureId:K}};J&&$&&J.push(ne),J!=null&&J.length&&w.push(...J)}return Z!=null&&Z.length&&S.push(...Z),Q!=null&&Q.length&&I.push(...Q),{structureId:K,childLinks:J,structures:S}}}function i9({drawDefinition:t,matchUpsMap:e,structureId:i}){let n=ui({drawDefinition:t,structureId:i});if(n.error)return pe({result:n});let{matchUps:r}=vn({structure:n.structure,matchUpsMap:e});return{...bo({matchUps:r}),matchUps:r,matchUpsMap:e}}function AQ({finishingPositions:t,drawDefinition:e,structureId:i}){var n;let{roundProfile:r}=i9({drawDefinition:e,structureId:i});return(n=r&&Object.keys(r))==null?void 0:n.reduce((a,s)=>(o0e(r?.[s]).forEach(o=>{t.forEach(l=>{R6e({position:l,rangeDefinition:o})&&(a[l]={roundNumber:s})})}),a),{})}function R6e({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((r,a)=>r||isNaN(a),!1))return!1;let[i,n]=e;return Et(i,(n||i)+1).includes(t)}function o0e(t){var e,i;return[Si(((e=t?.finishingPositionRange)==null?void 0:e.loser)||[]),Si(((i=t?.finishingPositionRange)==null?void 0:i.winner)||[])]}function M6e(t){return o0e(t).map(e=>Et(e[0],e[1]&&e[1]+1||e[0]+1))}function YD({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:Ce,context:{structureIds:e}};if(!t)return{error:Lt};e=e??(t.structures??[]).filter(a=>a.stage!==Kt).map(({structureId:a})=>a);let n=e.map(a=>{var s;let{roundProfile:o}=i9({drawDefinition:t,matchUpsMap:i,structureId:a});return(s=o&&Object.values(o))==null?void 0:s.map(M6e).flat()}).flat(),r=n.filter(a=>a?.length===1).sort(ra).flat();return{positionsNotPlayedOff:Si(n.flat()).filter(a=>!r.includes(a)),positionsPlayedOff:r}}function l0e({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:n}){if(!i)return{error:Lt};if(!n)return{error:Tu};if(!e)return{error:Xt,info:"missing playoffPositions"};let r=YD({drawDefinition:i});if(r.error)return r;let a=r.positionsPlayedOff,s=e.filter(v=>!a.includes(v)),o=AQ({finishingPositions:s,drawDefinition:i,structureId:n}),l=Object.values(o).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>ai(v)).filter(v=>!t.includes(v)),u=AQ({finishingPositions:a,drawDefinition:i,structureId:n}),c=u?Object.values(u):[],d=u?c.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>ai(v)):[],p=l.filter(v=>!d.includes(v)).sort(ra),{roundProfile:h}=i9({drawDefinition:i,structureId:n}),f=p.map(v=>{let y=h?.[v].finishingPositionRange.loser,[b,I]=y??[0,0];return Et(b,(I||b)+1)}).flat().sort(ra),{playoffRoundsRanges:m}=N6e({playoffSourceRounds:p,roundProfile:h}),g=[...p,...d];return{playoffPositionsReturned:f,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:g,roundProfile:h}}function N6e({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let n=e[i].finishingPositionRange.loser,[r,a]=n,s=Et(r,(a||r)+1);return{finishingPositionRange:n.join("-"),finishingPositions:s,roundNumber:i}})}}function nN({drawDefinition:t,structureId:e}){if(!t)return{error:Lt};let{matchUps:i,matchUpsMap:n}=ho({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:r,positionsPlayedOff:a}=YD({drawDefinition:t,matchUpsMap:n}),{structures:s}=ud({drawDefinition:t}),o=s.filter(u=>!e&&u.stage!==qa||u.structureId===e),l={};for(let u of o){let c=u?.structureId,d=A6e({playoffPositions:r,drawDefinition:t,structure:u,matchUps:i}),{error:p,...h}=d;if(p)return d;l[c]={structureId:c,...h}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function A6e({playoffPositions:t,drawDefinition:e,structure:i,matchUps:n}){var r,a,s,o,l,u,c,d,p;let h=i?.structureId,{links:f}=jD({drawDefinition:e,structureId:h});if(i.structureType===Eo||i.structures){let w=(a=(r=Fn({structure:i}))==null?void 0:r.positionAssignments)==null?void 0:a.length,T=i.structures.length,U=(w??0)/T,C=((s=f.source)==null?void 0:s.flatMap(({source:$})=>$?.finishingPositions||[]))||[],E=Et(1,U+1).filter($=>!C.includes($)),P=((l=(o=n.find($=>$.containerStructureId===h&&$.finishingPositionRange))==null?void 0:o.finishingPositionRange)==null?void 0:l.winner)||[0,1],M=f?.source.map(({target:$})=>$.structureId),{positionsPlayedOff:R=[],positionsNotPlayedOff:N=[]}=YD({structureIds:M,drawDefinition:e}),A=[...R,...N],_=Et(P[0],P[1]+1).filter($=>!A.includes($)),x=ka(_,_.length/E.length),O=E.map(($,F)=>{let j=x[F],H=[Math.min(...j||[]),Math.max(...j||[])].join("-");return{finishingPosition:$,finishingPositions:j,finishingPositionRange:H}});return{positionsNotPlayedOff:_,playoffFinishingPositionRanges:O,finishingPositionsAvailable:E,finishingPositionsPlayedOff:C,positionsPlayedOff:R,groupCount:T,groupSize:U}}let m=((u=f?.source)==null?void 0:u.filter(w=>w.linkCondition!==qp).map(w=>{var T;return(T=w.source)==null?void 0:T.roundNumber}))||[],g=((c=f?.source)==null?void 0:c.filter(w=>w.linkCondition===qp).map(w=>{var T;return(T=w.source)==null?void 0:T.roundNumber}))||[],v=l0e({excludeRoundNumbers:m,playoffPositions:t,drawDefinition:e,structureId:h}),y=v!=null&&v.playoffSourceRounds?[...v?.playoffSourceRounds||[]]:void 0,b=[...v?.playoffRoundsRanges||[]],{roundProfile:I,error:S}=v;for(let w of g){let T=f?.source.find(M=>M.source.roundNumber===w),U=T?.target.roundNumber,C=T?.target.structureId,E=n.filter(({roundNumber:M,structureId:R})=>R===C&&M===U),P=E.filter(({sides:M})=>M.find(R=>R.participantFed&&!R.participantId)).length;if(y&&P===E.length){y.push(w);let M=(p=(d=I?.[w])==null?void 0:d.finishingPositionRange)==null?void 0:p.loser;if(M){let R=Math.min(...M),N=R+P,A=Et(R,N),_={finishingPositionRange:[R,N-1].join("-"),finishingPositions:A,roundNumber:w};b.push(_)}}}return y&&y.sort(ra),b.sort((w,T)=>w.roundNumber-T.roundNumber),{playoffRounds:y,playoffRoundsRanges:b,error:S}}function _6e({playoffGroups:t,drawDefinition:e,structureId:i}){var n,r;if(!e)return{error:Lt};if(!nr(i)||!Array.isArray(t))return{error:Ce};let a=t.map(({finishingPositions:s})=>s).flat();return{positionRangeMap:(r=(n=nN({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:n.filter(s=>a.includes(s.finishingPosition)))==null?void 0:r.reduce((s,o)=>(s[o.finishingPosition]=o,s),{})}}function u0e(t){var e,i;let{finishingPositionOffset:n=0,playoffAttributes:r,stageSequence:a=1,staggeredEntry:s,structureName:o,stage:l=_t,matchUpType:u,structureId:c,idPrefix:d,drawSize:p,isMock:h,uuids:f}=t,m={finishingPositionOffset:n,matchUpType:u,drawSize:p,idPrefix:d,isMock:h,uuids:f},{matchUps:g}=s?cv(m):Kp(m),v=Gu({structureName:o||((e=r?.[0])==null?void 0:e.name)||Ss(_t),structureId:c||f?.pop(),stageSequence:a,matchUpType:u,matchUps:g,stage:l}),y=[v],b=[];if(p>2){let I=p/2,{matchUps:S}=Kp({finishingPositionOffset:n+I,idPrefix:d&&`${d}-c`,drawSize:I,matchUpType:u,isMock:h}),w=Ss(Ds),T=((i=r?.["0-1"])==null?void 0:i.name)??t.consolationStructureName??(o?`${o} ${w}`:w),U=Gu({structureName:T,matchUps:S,structureId:f?.pop(),stage:Ds,stageSequence:1,matchUpType:u});y.push(U);let C={linkType:sf,source:{roundNumber:1,structureId:v.structureId},target:{roundNumber:1,feedProfile:Oc,structureId:U.structureId}};b.push(C)}return{...ue,structures:y,links:b}}function c0e({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:n,feedPolicy:r,fmlc:a}){let s=t.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),o=r?.roundGroupedOrder||[],l=r?.roundFeedProfiles;return Et(1+e,n+1+e).map(u=>{let c=l!=null&&l[u-1]?l[u-1]:u%2&&Oc||sb,d=u-e<=2?u-e:(u-e-2)*2+2,p={linkType:sf,source:{roundNumber:u,structureId:i.structureId},target:{feedProfile:c,roundNumber:d,structureId:t.structureId}},h=o[u-1];return h&&(p.target.groupedOrder=h),mu()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),u===2&&a&&(p.linkCondition=qp,p.target.feedProfile=Oc),s.includes(d)?p:void 0}).filter(Boolean)}function d0e(t){var e,i;let{playoffStructureNameBase:n,finishingPositionOffset:r,stageSequence:a=1,playoffAttributes:s,structureNameMap:o,staggeredEntry:l,stage:u=_t,matchUpType:c,structureId:d,drawSize:p,idPrefix:h,isMock:f,uuids:m}=t,g={finishingPositionOffset:r,matchUpType:c,drawSize:p,idPrefix:h,isMock:f,uuids:m},{matchUps:v,roundsCount:y}=l?cv(g):Kp(g),b=t.structureName??((e=s?.[0])==null?void 0:e.name)??Ss(_t),I=Gg({structureId:d||m?.pop(),structureName:b,stageSequence:a,matchUpType:c,matchUps:v,stage:u}),S=[I],w=[];if(p>2){let T=[0,2].slice(0,p/16).map((U,C)=>{let E=C+1,{consolationStructure:P}=k6e({idPrefix:h&&`${h}-c${C}`,structureId:m?.pop(),playoffStructureNameBase:n,playoffAttributes:s,structureNameMap:o,stageSequence:E,roundOffset:U,matchUpType:c,drawSize:p,isMock:f,index:C,uuids:m});S.push(P);let M=c0e({consolationStructure:P,roundsCount:2,mainStructure:I,roundOffset:U});return{consolationStructure:P,links:M}}).map(U=>U.links).flat();if(w.push(...T),p>=4&&p<=16||p>32){let{matchUps:U}=Kp({idPrefix:h&&`${h}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:c,isMock:f}),C=((i=s?.["3-4"])==null?void 0:i.name)??Ss(Tr),E=o?.[C]||C,P=n?`${n} ${E}`:E,M=Gg({structureId:m?.pop(),matchUps:U,stageSequence:2,stage:Tr,structureName:P,matchUpType:c}),R={linkType:sf,source:{roundNumber:y-1,structureId:I.structureId},target:{structureId:M.structureId,feedProfile:Oc,roundNumber:1}};S.push(M),w.push(R)}}return{structures:S,links:w,...ue}}function k6e({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:n,roundOffset:r=0,matchUpType:a,structureId:s,idPrefix:o,drawSize:l,isMock:u,index:c,uuids:d}){var p,h;let f=l/(2*Math.pow(2,r)),{matchUps:m,roundsCount:g}=cv({finishingPositionOffset:f,baseDrawSize:f,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:o,isMock:u,uuids:d}),v=c===0&&((p=i?.["0-1"])==null?void 0:p.name)||c===1&&((h=i?.["0-3"])==null?void 0:h.name)||`${Ss(Ds)} ${c+1}`,y=n?.[v]||v,b=t?`${t} ${y}`:y;return{consolationStructure:Gg({matchUps:m,stage:Ds,structureName:b,stageSequence:e,matchUpType:a,structureId:s}),consolationRoundsCount:g}}function II(t){var e,i,n,r;let{finishingPositionOffset:a,stageSequence:s=1,playoffAttributes:o,feedsFromFinal:l,staggeredEntry:u,structureName:c,stage:d=_t,structureId:p,matchUpType:h,skipRounds:f,feedRounds:m,idPrefix:g,drawSize:v,isMock:y,uuids:b,fmlc:I}=t,S=t.feedPolicy||((e=t.policyDefinitions)==null?void 0:e[hU])||((i=t.appliedPolicies)==null?void 0:i[hU]),w={finishingPositionOffset:a,matchUpType:h,skipRounds:f,drawSize:v,idPrefix:g,isMock:y,uuids:b},{matchUps:T}=u?cv(w):Kp(w),U=Gu({structureName:c||((n=o?.[0])==null?void 0:n.name)||Ss(_t),structureId:p||b?.pop(),stageSequence:s,matchUpType:h,matchUps:T,stage:d}),C=[U],E=[],P=v/2,{matchUps:M,roundsCount:R}=cv({finishingPositionOffset:P,idPrefix:g&&`${g}-c`,isConsolation:!0,feedsFromFinal:l,baseDrawSize:P,matchUpType:h,feedRounds:m,skipRounds:f,isMock:y,uuids:b,fmlc:I});if(v>2){let N=((r=o?.["0-1"])==null?void 0:r.name)??Ss(Ds),A=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${N}`:N,_=Gu({matchUps:M,structureId:b?.pop(),stage:Ds,stageSequence:1,structureName:A,matchUpType:h});C.push(_);let x=c0e({consolationStructure:_,mainStructure:U,roundsCount:R,feedPolicy:S,fmlc:I});E.push(...x)}return{...ue,structures:C,links:E}}function p0e({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:n,policyDefinitions:r,stageSequence:a,drawDefinition:s,playoffGroups:o,matchUpType:l,feedPolicy:u,groupCount:c,idPrefix:d,isMock:p,uuids:h}){var f,m,g,v,y,b;u=u||r?.[hU];let I="processPlayoffGroups",S=0,w=[],T=[],U=[],{error:C,positionRangeMap:E}=_6e({structureId:n,drawDefinition:s,playoffGroups:o});if(C)return pe({result:{error:C},stack:I});if(!(!E||o!=null&&o.every(P=>{let{finishingPositions:M=[]}=P;if(!M.length)return!1;let R=[...M].sort(ra).map((N,A)=>(M[A+1]||N)-N).every(N=>N<2);return(!t||R)&&M.every(N=>E[N])})))return pe({context:{validFinishingPositions:Object.values(E)},result:{error:Ce},stack:I});for(let P of o){let M=P.finishingPositions,R=E&&M.map(j=>{var H;return(H=E[j])==null?void 0:H.finishingPositions}).flat(),N=c*M.length,A=ED(N),_=A===2&&Rp||P.drawType||Rp;R&&(S=Math.min(...R)-1);let x=R&&`${Math.min(...R)}-${Math.max(...R)}`,O=P.structureName||x&&((m=(f=P.playoffAttributes)==null?void 0:f[x])==null?void 0:m.name)||((v=(g=P.playoffAttributes)==null?void 0:g[0])==null?void 0:v.name),$={addNameBaseToAttributeName:P.addNameBaseToAttributeName,playoffStructureNameBase:P.playoffStructureNameBase,finishingPositionNaming:P.finishingPositionNaming,finishingPositionLimit:P.finishingPositionLimit,structureId:P.structureId??h?.pop(),playoffAttributes:P.playoffAttributes,structureNameMap:P.structureNameMap,sequenceLimit:P.sequenceLimit,structureName:O,idPrefix:d&&`${d}-po`,appliedPolicies:r,finishingPositionOffset:S,stage:Tr,stageSequence:a,matchUpType:l,drawSize:A,isMock:p,uuids:h},F=({playoffStructures:j,playoffLinks:H})=>{let[G]=j,W=pA({playoffStructureId:G.structureId,finishingPositions:M,sourceStructureId:n});U.push(W),U.push(...H),T.push(...j),w.push({structureId:G.structureId,finishingPositions:M}),S+=N};if(_===Rp){let{matchUps:j}=Kp({finishingPositionLimit:S+N,idPrefix:d&&`${d}-po`,finishingPositionOffset:S,matchUpType:l,drawSize:A,isMock:p,uuids:h}),H=Gu({structureId:P.structureId??h?.pop(),matchUpFormat:e,stage:Tr,structureName:O,stageSequence:a,matchUps:j});T.push(H);let G=pA({playoffStructureId:H.structureId,finishingPositions:M,sourceStructureId:n});U.push(G),S+=N,w.push({structureId:H.structureId,finishingPositions:M})}else if([lU,uU,Tr].includes(_)){let j={playoffAttributes:P.playoffAttributes??i,playoffStructureNameBase:P.playoffStructureNameBase,structureId:P.structureId??h?.pop(),structureName:P.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:S,stage:Tr,roundOffset:0,stageSequence:a,drawSize:A,isMock:p,uuids:h};_===lU?Object.assign(j,{playoffAttributes:P?.playoffAttributes??i??k7,roundOffsetLimit:3}):_===uU&&Object.assign(j,{playoffAttributes:P?.playoffAttributes??i??x7,roundOffsetLimit:2});let H=gT(j);if(H.error)return H;if((y=H.links)!=null&&y.length&&U.push(...H.links),(b=H.structures)!=null&&b.length&&T.push(...H.structures),T.sort(k0),H.structureId){let G=pA({playoffStructureId:H.structureId,finishingPositions:M,sourceStructureId:n});U.push(G),w.push({structureId:H.structureId,finishingPositions:M})}S+=N}else if([cU,EM,WC,qC,zC,YC].includes(_)){let j=[h?.pop(),h?.pop()],H={playoffStructureNameBase:P.playoffStructureNameBase,structureId:P.structureId??h?.pop(),playoffAttributes:P.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:S,uuids:j,stage:Tr,structureName:O,matchUpType:l,feedPolicy:u,drawSize:A,isMock:p},G={[cU]:{fmlc:!0,feedRounds:1},[YC]:{feedRounds:1},[WC]:{feedsFromFinal:3},[qC]:{feedsFromFinal:2},[zC]:{feedsFromFinal:1}};Object.assign(H,G[_]||{});let{structures:W,links:q}=II(H),[Z]=W,K=pA({playoffStructureId:Z.structureId,finishingPositions:M,sourceStructureId:n});U.push(K),U.push(...q),T.push(...W),w.push({structureId:Z.structureId,finishingPositions:M}),S+=N}else if([od].includes(_)){let{structures:j,links:H}=JM({...$,structureOptions:P.structureOptions||{groupSize:4}});F({playoffStructures:j,playoffLinks:H})}else if([DM].includes(_)){let{structures:j,links:H}=u0e($);F({playoffStructures:j,playoffLinks:H})}else if([cWe].includes(_)){let{structures:j,links:H}=d0e($);F({playoffStructures:j,playoffLinks:H})}else if([gu].includes(_)){let j=Gu({structureId:P.structureId??h?.pop(),structureName:P.structureName,finishingPosition:C_,stage:Tr,stageSequence:a,matchUps:[]});F({playoffStructures:[j],playoffLinks:[]})}}return{finishingPositionTargets:w,positionRangeMap:E,structures:T,links:U}}function pA({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:Em,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:Pd,roundNumber:1}}}function rN({matchUp:t,tieFormat:e,isMock:i,uuids:n}){let{collectionDefinitions:r}=e??{};return{tieMatchUps:(r??[]).map(a=>aN({matchUp:t,collectionDefinition:a,uuids:n,isMock:i})).filter(Boolean).flat()}}function aN({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:n,isMock:r,uuids:a}){let{matchUpCount:s,matchUpType:o,collectionId:l,processCodes:u}=e||{},c=i??s??0,d=p=>{if(!r&&!(n!=null&&n.isMock))return a?.pop()??gn();let h=e?.collectionId;return a?.pop()??`${n?.matchUpId}-${h}-TMU-${p+1}`};return Et(0,c).map(p=>{let h=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Or,collectionPosition:h,collectionId:l,processCodes:u,matchUpType:o,isMock:r}})}function x6e(t){var e,i,n;let r="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return pe({result:{error:Xt},info:"playoffGroups required",stack:r});let{sourceStructureId:a,requireSequential:s,tournamentRecord:o,drawDefinition:l,playoffGroups:u,groupCount:c,groupSize:d,event:p}=t,h=p0e({requireSequential:s,sourceStructureId:a,playoffGroups:u,groupCount:c,...t});if(h.error)return pe({result:h,stack:r});let{structures:f=[],links:m=[],finishingPositionTargets:g,positionRangeMap:v}=h,y=g?.map(({finishingPositions:P})=>P).flat().map(P=>v[P].finishingPositions).flat();l.structures.push(...f),l.links.push(...m);let{matchUps:b,matchUpsMap:I}=pa({inContext:!0,drawDefinition:l}),S=f.map(({structureId:P})=>P),w=b?.filter(({structureId:P})=>S.includes(P)).map(Na),T=(e=I?.drawMatchUps)==null?void 0:e.filter(({matchUpId:P})=>w?.includes(P));if(T!=null&&T.length){let P=(i=Xs({drawDefinition:l,event:p}))==null?void 0:i.tieFormat;P&&T.forEach(M=>{let{tieMatchUps:R}=rN({isMock:t.isMock,tieFormat:P,matchUp:M});Object.assign(M,{tieMatchUps:R,matchUpType:hu})})}let{positionAssignments:U}=Fn({structureId:a,drawDefinition:l}),C={};U?.forEach(P=>{var M,R,N;let A=(N=(R=(M=ki({element:P,name:rv}))==null?void 0:M.extension)==null?void 0:R.value)==null?void 0:N.groupOrder;A&&(C[A]||(C[A]=[]),C[A].push(P.participantId))});let E=WD({provisionalPositioning:t.provisionalPositioning,structureId:a,applyPositioning:!0,event:t.event,tournamentRecord:o,drawDefinition:l});return E.error&&((n=E.error)==null?void 0:n.code)!==Y6.code?pe({result:E,stack:r}):{structures:f,links:m,positionsPlayedOff:y,drawDefinition:l,...ue}}function tT({value:t,sourceRange:e,targetRange:i}){let n=Math.min(...e),r=Math.max(...e),a=Math.min(...i),s=Math.max(...i);return(t-n)*(s-a)/(r-n)+a}var _c="ELO",h0e="NTRP",O6e="TRN",f0e="UTR",n9="WTN",L6e={ELO:_c,NTRP:h0e,TRN:O6e,UTR:f0e,WTN:n9},F6e={[_c]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[h0e]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[f0e]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[n9]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},Ra=F6e;function $6e({sourceRatingType:t,sourceRating:e}){let i=Ra[t].range,n=i[0]>i[1],r=Ra[_c].range;return tT({value:n?i[0]-e:e,sourceRange:i,targetRange:r})}function B6e({targetRatingType:t,sourceRating:e}){let i=Ra[t].decimalsCount||0,n=Ra[t].range,r=n[0]>n[1],a=Math.max(...n),s=Ra[_c].range,o=tT({targetRange:n,sourceRange:s,value:e}),l=parseFloat(o.toFixed(i));return r?a-l:l}function _Q(t){var e;let i=Yt(t,[{ratings:!0,[Ho]:el}]);if(i.error)return i;let n=t.matchUpType&&[Mn,En].includes(t.matchUpType)?t.matchUpType:Mn,r=Object.keys(Ra),a=t.targetRatingType&&r.includes(t.targetRatingType)?t.targetRatingType:_c,s=t.ratings[n]?t.ratings[n].reduce((p,h)=>p.includes(h.scaleName)?p:p.concat(h.scaleName),[]):[];if(!s)return{error:Xa};let o=((e=t.ratings[n])==null?void 0:e.find(p=>p.scaleName===a))??t.ratings[n][0];if(s[0]===a)return o;let l=o.scaleName,u=Ra[o.scaleName].accessor,c=u?o.scaleValue[u]:o.scaleValue,d=$6e({sourceRatingType:l,sourceRating:c});return{convertedRating:B6e({targetRatingType:a,sourceRating:d}),sourceRating:c}}function V6e({participantResults:t,sides:e,score:i}){var n,r;let a=e.find(({sideNumber:u})=>u===1),s=e.find(({sideNumber:u})=>u===2),o=(n=a?.participant)==null?void 0:n.ratings,l=(r=s?.participant)==null?void 0:r.ratings;if(o!=null&&o[Mn]&&l!=null&&l[Mn]){let u=_c,{convertedRating:c}=_Q({ratings:o,targetRatingType:u}),{convertedRating:d}=_Q({ratings:l,targetRatingType:u}),{side1pressure:p,side2pressure:h}=j6e({side1ConvertedRating:c,side2ConvertedRating:d,score:i});p&&t[a?.participantId].pressureScores.push(p),h&&t[s?.participantId].pressureScores.push(h);let f=Math.max(...Ra[_c].range),m=nx((d-c)/f),g=nx((c-d)/f);t[a?.participantId].ratingVariation.push(m),t[s?.participantId].ratingVariation.push(g)}}function j6e({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){var n,r;let a=t>e?t:e,s=t>e?e:t,o=Math.abs(t-e),l=Ra[_c].range,u=Math.max(...l),c=(u-a)*0,d=(a+c)/u*o,p=(n=i?.sets)==null?void 0:n.reduce((I,S)=>I+(S?.side1Score??0),0),h=(r=i?.sets)==null?void 0:r.reduce((I,S)=>I+(S.side2Score??0),0),f=t>e?2:1,m=(p||0)*(s+(f===1?d:0)),g=(h||0)*(s+(f===2?d:0)),v=m+g,y=v?nx(m/v):0,b=v?nx(g/v):0;return{side1pressure:y,side2pressure:b}}function r9({winningSide:t,matchUpFormat:e=Kc,matchUpStatus:i,tallyPolicy:n,score:r}){let a=[0,0],s=r?.sets,o=typeof t=="number"&&t-1,l=Do(e),u=a9(l?.bestOf??1);if(typeof o=="number"&&(i===Wi&&n!=null&&n.setsCreditForDefaults||i===ln&&n!=null&&n.setsCreditForWalkovers))a[o]=u;else for(let c of s||[]){let{winningSide:d}=c;d&&(a[d-1]+=1)}return typeof o=="number"&&i===os&&(+a[1-o]===u&&(a[1-o]-=1),n!=null&&n.setsCreditForRetirements&&(a[o]=u)),a}function m0e({matchUpFormat:t=Kc,winningSide:e,matchUpStatus:i,tallyPolicy:n,score:r}){var a,s;let{sets:o}=r||{};if(!o)return[0,0];let l=typeof e=="number"&&e-1,u=Do(t),c=u?.bestOf??1,d=a9(c),p=((a=u?.setFormat)==null?void 0:a.tiebreakAt)||0,h=[[],[]];if(typeof l=="number"&&(i===Wi&&n!=null&&n.gamesCreditForDefaults||i===ln&&n!=null&&n.gamesCreditForWalkovers)){let f=((s=u?.setFormat)==null?void 0:s.setTo)||0,m=d*f;h[l].push(m)}else o.forEach((f,m)=>{var g;let v=(f.setNumber||m+1)>d&&u!=null&&u.finalSetFormat?"finalSetFormat":"setFormat",y=(g=u?.[v])==null?void 0:g.based,b=u?.[v].tiebreakSet,{side1Score:I,side2Score:S}=f;kQ(y)&&(h[0].push(ai(I||0)),h[1].push(ai(S||0))),b&&f.winningSide&&n?.gamesCreditForTiebreakSets!==!1&&h[f.winningSide-1].push(1)});if(i===os&&typeof l=="number"){let f=o.length>d&&u!=null&&u.finalSetFormat?"finalSetFormat":"setFormat",m=u?.[f];if(kQ(m.based)){let g=m?.setTo||0,v=b=>{if(!(!u||b===""))return+b===p-1||+b===p?ai(p||0)+1:+b<p?g:p},y=r9({winningSide:e,score:{sets:o},matchUpStatus:i,matchUpFormat:t,tallyPolicy:n});if(h.map(b=>b[l]<=b[1-l]).reduce((b,I)=>b+(I?1:0),0)>y[1-l]){let b=h[l].length,I=v(h[1-l][b-1]);I&&(h[l][b-1]=I)}d>h[l].length&&n!=null&&n.gamesCreditForRetirements&&h[l].push(g)}}return[h[0].reduce((f,m)=>f+m,0),h[1].reduce((f,m)=>f+m,0)]}function g0e({matchUpFormat:t,score:e}){var i;let n=t?Do(t):void 0,r=n?.bestOf??1,a=a9(r),s=[0,0],o=[0,0];return(i=e?.sets)==null||i.forEach((l,u)=>{var c;let d=(l.setNumber||u+1)>a&&n!=null&&n.finalSetFormat?"finalSetFormat":"setFormat",p=(c=n?.[d])==null?void 0:c.based;if(v0e(p)){let{side1Score:h,side2Score:f}=l;h&&(o[0]+=ai(h||0)),f&&(o[1]+=ai(f||0))}else l.side1TiebreakScore&&(o[0]+=ai(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(o[1]+=ai(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(s[l.winningSide-1]+=1)}),{pointsTally:o,tiebreaksTally:s}}function a9(t){return t&&Math.ceil(t/2)||1}function v0e(t){return t==="P"}function kQ(t){return!v0e(t)}function G6e({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,totalSets:r}){var a;let s=e&&Do(e)||{},o=s.bestOf,l=o&&Math.ceil(o/2)||1,u=(a=s.setFormat)==null?void 0:a.setTo;Object.keys(t).forEach(c=>{let d=t[c].setsWon,p=t[c].setsLost,h=i!=null&&i.groupTotalSetsPlayed?r:n*l||d+p,f=Math.round(d/h*1e3)/1e3;(f===1/0||isNaN(f))&&(f=h);let m=t[c].tieMatchUpsWon,g=t[c].tieMatchUpsLost,v=m+g,y=Math.round(m/v*1e3)/1e3;(y===1/0||isNaN(y))&&(y=m);let b=t[c].matchUpsWon,I=t[c].matchUpsLost,S=b+I,w=Math.round(b/S*1e3)/1e3;(w===1/0||isNaN(w))&&(w=b);let T=t[c].gamesWon||0,U=t[c].gamesLost||0,C=(n||0)*l*(u||0),E=Math.max(C,T+U),P=Math.round(T/E*1e3)/1e3;(P===1/0||isNaN(P))&&(P=0);let M=t[c].pointsWon+t[c].pointsLost,R=Math.round(t[c].pointsWon/M*1e3)/1e3;(R===1/0||isNaN(R))&&(R=0),t[c].setsWon=d,t[c].setsLost=p,t[c].setsPct=f,t[c].tieMatchUpsWon=m,t[c].tieMatchUpsPct=y,t[c].matchUpsPct=w,t[c].gamesWon=T,t[c].gamesLost=U,t[c].gamesPct=P,t[c].pointsPct=R,t[c].result=`${t[c].matchUpsWon}/${t[c].matchUpsLost}`})}function sN({participantIds:t,pressureRating:e,matchUpFormat:i,tallyPolicy:n,perPlayer:r,matchUps:a}){var s,o,l,u,c,d,p;let h={},f=n?.excludeMatchUpStatuses||[],m=a?.filter(v=>(v.tieMatchUps||!f.includes(v.matchUpStatus))&&(!(t!=null&&t.length)||Pr(t,[iT(v,0),iT(v,1)]).length===2)),g=(s=m?.flatMap(({score:v,tieMatchUps:y})=>{var b;return y?y.filter(({matchUpStatus:I})=>!f.includes(I)).flatMap(({score:I})=>{var S;return((S=I?.sets)==null?void 0:S.length)??0}):((b=v?.sets)==null?void 0:b.length)??0}))==null?void 0:s.reduce((v,y)=>v+y,0);for(let v of m??[]){let{matchUpStatus:y,tieMatchUps:b,tieFormat:I,score:S,winningSide:w,sides:T}=v,U=I&&v._disableAutoCalc&&I.collectionDefinitions.every(({scoreValue:R})=>R),C=w&&H6e(v),E=w&&z6e(v);if(!C&&!E)if(y&&wa.includes(y)){let R=iT(v,0),N=iT(v,1);R&&(Eg(h,R),h[R].matchUpsCancelled+=1),N&&(Eg(h,N),h[N].matchUpsCancelled+=1)}else if(b!=null&&b.length){r=0;for(let R of b){if(R.winningSide){let N=(o=T?.find(({sideNumber:_})=>_===R.winningSide))==null?void 0:o.participantId,A=(l=T?.find(({sideNumber:_})=>_===R.winningSide))==null?void 0:l.participantId;N&&A&&(Eg(h,N),Eg(h,A),h[N].tieMatchUpsWon+=1,h[A].tieMatchUpsLost+=1,xr(Mn)(R.matchUpType)?(h[N].tieSinglesWon+=1,h[A].tieSinglesLost+=1):xr(En)(R.matchUpType)&&(h[N].tieDoublesWon+=1,h[A].tieDoublesLost+=1))}xQ({score:R.score,manualGamesOverride:U,participantResults:h,sides:T})}}else xQ({manualGamesOverride:U,participantResults:h,score:S,sides:T});else if(Eg(h,C),Eg(h,E),b?.length){r=0;for(let R of b){let{matchUpType:N}=R,A=xr(En)(N),_=xr(Mn)(N);R.winningSide&&(R.winningSide===w?(C&&(h[C].tieMatchUpsWon+=1,_&&(h[C].tieSinglesWon+=1),A&&(h[C].tieDoublesWon+=1)),E&&(h[E].tieMatchUpsLost+=1,_&&(h[E].tieSinglesLost+=1),A&&(h[E].tieDoublesLost+=1))):R.winningSide!==w&&(E&&(h[E].tieMatchUpsWon+=1,_&&(h[E].tieSinglesWon+=1),A&&(h[E].tieDoublesWon+=1)),C&&(h[C].tieMatchUpsLost+=1,_&&(h[C].tieSinglesLost+=1),A&&(h[C].tieDoublesLost+=1)))),OQ({matchUpFormat:R.matchUpFormat,matchUpStatus:R.matchUpStatus,matchUpType:R.matchUpType,score:R.score,sides:R.sides,winningParticipantId:C,losingParticipantId:E,manualGamesOverride:U,participantResults:h,isTieMatchUp:!0,pressureRating:e,tallyPolicy:n,winningSide:w})}y0e({winningParticipantId:C,losingParticipantId:E,participantResults:h,matchUpStatus:y})}else OQ({matchUpFormat:v.matchUpFormat??i,matchUpType:v.matchUpType,isTieMatchUp:void 0,winningParticipantId:C,manualGamesOverride:U,losingParticipantId:E,participantResults:h,pressureRating:e,matchUpStatus:y,tallyPolicy:n,winningSide:w,score:S,sides:T});let P=(u=S?.sets)==null?void 0:u.reduce((R,N)=>R+(N?.side1Score??0),0),M=(c=S?.sets)==null?void 0:c.reduce((R,N)=>R+(N.side2Score??0),0);if(U){let R=(d=T?.find(({sideNumber:A})=>A===1))==null?void 0:d.participantId,N=(p=T?.find(({sideNumber:A})=>A===2))==null?void 0:p.participantId;Eg(h,R),Eg(h,N),R&&(h[R].gamesWon+=P,h[R].gamesLost+=M),N&&(h[N].gamesWon+=M,h[N].gamesLost+=P)}}return G6e({participantResults:h,matchUpFormat:i,tallyPolicy:n,perPlayer:r,totalSets:g}),{participantResults:h}}function H6e(t){let e=t.winningSide-1;return iT(t,e)}function z6e(t){let e=1-(t.winningSide-1);return iT(t,e)}function iT(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Eg(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function xQ({manualGamesOverride:t,participantResults:e,score:i,sides:n}){let{sets:r}=i||{},a=[[],[]],s=[0,0];for(let l of r||[]){let{winningSide:u,side1Score:c,side2Score:d}=l;u&&(s[u-1]+=1),a[0].push(ai(c||0)),a[1].push(ai(d||0))}let o=[a[0].reduce((l,u)=>l+u,0),a[1].reduce((l,u)=>l+u,0)];n.forEach((l,u)=>{let{participantId:c}=l;c&&(Eg(e,c),e[c].setsWon+=s[u],e[c].setsLost+=s[1-u],t||(e[c].gamesWon+=o[u],e[c].gamesLost+=o[1-u]))})}function OQ({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:n,pressureRating:r,matchUpFormat:a,matchUpStatus:s,isTieMatchUp:o,matchUpType:l,tallyPolicy:u,winningSide:c,score:d,sides:p}){let h=c&&c-1,f=1-h;r&&l===Mn&&V6e({participantResults:n,sides:p,score:d}),o||y0e({winningParticipantId:t,losingParticipantId:i,participantResults:n,matchUpStatus:s});let m=r9({matchUpStatus:s,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),g=m0e({matchUpStatus:s,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),{pointsTally:v}=g0e({score:d,matchUpFormat:a});t&&(n[t].setsWon+=m[h],n[t].setsLost+=m[f],e||(n[t].gamesWon+=g[h],n[t].gamesLost+=g[f]),n[t].pointsWon+=v[h],n[t].pointsLost+=v[f]),i&&(n[i].setsWon+=m[f],n[i].setsLost+=m[h],e||(n[i].gamesWon+=g[f],n[i].gamesLost+=g[h]),n[i].pointsWon+=v[f],n[i].pointsLost+=v[h])}function y0e({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:n}){e&&(n===ln&&(i[e].walkovers+=1),n===Wi&&(i[e].defaults+=1),n===os&&(i[e].retirements+=1),[Wi,os,ln].includes(n)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function q6e({matchUps:t,order:e,report:i}){let n={};t.forEach(({sides:a})=>{a.forEach(s=>{s.participantId&&s.participant&&(n[s.participantId]=s.participant.participantName)})});let r=[];return Array.isArray(i)&&i.forEach((a,s)=>{var o,l;if((o=a.excludedDirectives)!=null&&o.length){let u=a.excludedDirectives.map(({attribute:p})=>p).join(", "),c=`${u.length} directives were excluded due to participants limit}`;r.push(c);let d=`Excluded: ${u}`;r.push(d)}else{let u=(m,g)=>parseFloat(a.reversed?m:g)-parseFloat(a.reversed?g:m),c=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=m=>{m.groups&&Object.keys(m.groups).sort(u).forEach(g=>{let v=m.groups[g].map(b=>n[b]).join(", "),y=`${g} ${m.attribute}: ${v}`;r.push(y)})},p=a.reversed?" in reverse order":"",h=a.groups?"grouped":"separated",f=`Step ${s+1}: ${c} particiants were ${h}${p} by ${a.attribute}`;if(r.push(f),a.idsFilter){let m=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(m)}d(a)}r.push("----------------------")}),r.push("Final Order:"),e.forEach(a=>{let{participantId:s,resolved:o}=a,l=a.groupOrder||a.provisionalOrder;r.push(`${l}: ${n[s]} => resolved: ${!!o}`)}),r.join(`\r
`)}function b0e({participantResults:t,participantIds:e,attribute:i}){return I0e({participantResults:t,participantIds:e}).reduce((n,r)=>{let{participantId:a,results:s}=r,o=s?.[i];return!isNaN(o)&&a&&(n[o]?n[o].push(a):n[o]=[a]),n},{})}function I0e(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,n)=>(e.push({participantId:i,i:n,results:t.participantResults[i]}),e),[])}var W6e=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],_V={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function LQ(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:n,tallyPolicy:r}=t,a=[];if(e&&!Y6e(t))return{};let s=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(r?.groupOrderKey)?r.groupOrderKey:"matchUpsWon",o=b0e({participantResults:i,attribute:s});a.push({attribute:s,groups:o});let l=Object.keys(o).map(g=>parseFloat(g)).sort((g,v)=>v-g).map(g=>o[g]).map(g=>{let v=w0e({participantIds:g,...t});return a.push(...v.report??[]),v.order}).map((g,v)=>g.map(y=>y.resolved?y:{...y,subGroup:[v].concat(...y.subGroup??[])})).flat(),u,c=0,d=1,p;l.forEach((g,v)=>{var y;v&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let b=parseInt(((y=g.subGroup)==null?void 0:y.join(""))||0);g.resolved?(g.position=v+1,d=g.position):(u&&b>u&&(d+=c,c=0),g.position=d,c+=1),u=b});let h=l.map(({position:g})=>g),f=Ol(h);return l.forEach(g=>{let{participantId:v,position:y}=g||{},b=i[v];g.GEMscore=m(b);let I=f[y];g?.position!==void 0&&(I>1&&(g.ties=I,n&&(g.subOrder=n[v])),g.rankOrder=y,g.groupOrder=y+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function m(g){return(Array.isArray(r?.GEMscore)?Object.keys(_V).filter(v=>r.GEMscore.includes(v)):Object.keys(_V)).map(v=>(g[v]||0)*Math.pow(10,_V[v].toFixed(3))).reduce((v,y)=>v+y,0)}}function Y6e({participantResults:t,participantsCount:e}){let i=I0e({participantResults:t}).filter(n=>e-1===n.results.matchUpsWon+n.results.matchUpsLost+n.results.matchUpsCancelled);return e===i.length}function K6e({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:n,attribute:r,idsFilter:a,matchUps:s,reversed:o}){let{participantResults:l}=sN({participantIds:a&&e,matchUpFormat:i,tallyPolicy:n,matchUps:s}),u=b0e({participantResults:l,participantIds:e,attribute:r}),c=[{attribute:r,reversed:o,groups:u,idsFilter:a}],d;return Object.keys(u).length>1&&e.length&&(d=Object.keys(u).map(p=>parseFloat(p)).sort((p,h)=>o?p-h:h-p).map(p=>u[p]).map(p=>{let h=w0e({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:n,matchUps:s});return c.push(...h.report??[]),h.order}).map((p,h)=>p.map(f=>f.resolved?f:{...f,subGroup:[h].concat(...f.subGroup??[])})).flat()),{order:d,report:c}}function w0e({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:n,tallyPolicy:r,matchUps:a}){let s=[],o=[],l;if(i?.length===1)return{order:[{resolved:!0,participantId:i[0]}]};if(i?.length===2&&(!(r!=null&&r.headToHead)||!r.headToHead.disabled&&!e)){let c=Z6e({participantIds:i,participantResults:t});if(c){let d=c[0].participantId;return o.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:c,headToHeadWinner:d,report:o}}}let u=(r?.tallyDirectives||W6e).filter(c=>{let d=!(Ir(c.maxParticipants)&&i?.length>c.maxParticipants);return d||s.push(c),d});return s.length&&o.push({excludedDirectives:s,participantIds:i}),u.every(({attribute:c,reversed:d,idsFilter:p,disableHeadToHead:h})=>(l=K6e({disableHeadToHead:h,participantIds:i,matchUpFormat:n,tallyPolicy:r,attribute:c,idsFilter:p,matchUps:a,reversed:d}),o.push(l.report),!l.order)),l.order?{order:l.order,report:o}:{order:i?.map(c=>({participantId:c})),report:o}}function Z6e({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function KD({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:n,matchUps:r=[],subOrderMap:a,perPlayer:s}){if(!(r!=null&&r.length)||!pc(r))return{error:Km};let o=Si(r.map(({structureId:I})=>I));if(o.length!==1)return pe({result:{error:Ce,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let l=r.filter(I=>I&&I.matchUpStatus!==fn),u=l.length&&Si(l.map(({drawPositions:I})=>I).flat()).length,c=l.filter(I=>Ny({matchUp:I})).length===l.length;c||(s=0);let d=r.every(({matchUpType:I,tieMatchUps:S})=>I===zn&&S?.every(w=>Ny({matchUp:w}))),p=t?.[z7],h=r.filter(I=>Ny({matchUp:I})||I.matchUpType===zn),{participantResults:f}=sN({matchUps:h,pressureRating:i,matchUpFormat:n,tallyPolicy:p,perPlayer:s}),m,g,{groupOrder:v,report:y}=LQ({matchUps:h,participantResults:f,participantsCount:u,matchUpFormat:n,tallyPolicy:p,subOrderMap:a});if(i&&X6e({participantResults:f}),c&&v)m=y,g=v,v.forEach(I=>{let{participantId:S,groupOrder:w,rankOrder:T,subOrder:U,ties:C,GEMscore:E}=I,P=f[S];Object.assign(P,{groupOrder:w,rankOrder:T,GEMscore:E,subOrder:U,ties:C})});else{let{groupOrder:I,report:S}=LQ({requireCompletion:!1,participantResults:f,participantsCount:u,matchUpFormat:n,tallyPolicy:p,subOrderMap:a,matchUps:r});m=S,g=I,I&&I.forEach(w=>{let{participantId:T,groupOrder:U,GEMscore:C}=w,E=f[T];Object.assign(E,{provisionalOrder:U,GEMscore:C})})}let b={completedTieMatchUps:d,readableReport:"",participantResults:f,bracketComplete:c,order:[],report:m};if((c||d)&&(b.order=g),e||mu({tally:!0})){let I=q6e({matchUps:r,report:m,order:g});mu({tally:!0})&&console.log(I),b.readableReport=I}return b}function X6e({participantResults:t}){let e=r=>r.reduce((a,s)=>a+parseFloat(s),0),i=r=>parseFloat((e(r)/r.length).toFixed(2)),n=Object.keys(t).map(r=>{let a=t[r],{pressureScores:s}=a,o=s!=null&&s.length?i(s):0;return{participantId:r,averagePressure:o}}).sort((r,a)=>(a.averagePressure||0)-(r.averagePressure||0)).map((r,a)=>({...r,order:a+1}));for(let r of n)t[r.participantId].pressureOrder=r.order}function S0e({positionAssignments:t}){let e=(t||[]).filter(Bl(lf)).map(r=>{let{extension:a}=ki({element:r,name:fU}),s=ai(a?.value),o=!isNaN(s)&&s;return o&&{participantId:r.participantId,subOrder:o}}).filter(Boolean),i=e.map(({subOrder:r})=>r),n=Ol(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:r})=>n[r]===1).map(({participantId:r,subOrder:a})=>({[r]:a})))}}function s9({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:n,matchUps:r,event:a}){if(!pc(r))return{error:Ce};if(!t)return{error:Ce};let{policyDefinitions:s}=Jm({policyTypes:[z7],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:o}=S0e({positionAssignments:t}),l=r.length?KD({policyDefinitions:s,matchUpFormat:n,subOrderMap:o,matchUps:r}):void 0;if(l!=null&&l.error)return l;let{participantResults:u={},bracketComplete:c,report:d}=l??{},p=Object.keys(u);return t.forEach(h=>{let{participantId:f}=h;if(p.includes(f)){let m={value:u[f],name:rv};dn({element:h,extension:m}),u[f].ties||po({element:h,name:fU})}else po({element:h,name:rv}),po({element:h,name:fU})}),Bn({drawDefinition:i}),{...ue,participantResults:u,bracketComplete:c,report:d}}function T0e({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function tr(t){let e=Yt(t,[{[Po]:!0,[ah]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:n,contextProfile:r,drawDefinition:a,matchUpsMap:s,matchUpId:o,inContext:l,context:u,event:c}=t,{structures:d=[]}=ud({drawDefinition:a}),p=t.contextContent||r&&Qm({contextProfile:r,drawDefinition:a});for(let h of d){let{matchUps:f}=vn({tournamentParticipants:i,afterRecoveryTimes:n,contextContent:p,drawDefinition:a,contextProfile:r,matchUpsMap:s,inContext:l,structure:h,context:u,event:c}),{matchUp:m}=T0e({matchUps:f,matchUpId:o});if(m)return{matchUp:m,structure:h}}return{error:Gs}}function sB(t){var e;return!Qi(t)||!t.notes?{error:Xt}:Qi(t.element)?!nr(t.notes)&&!((e=t.notes)!=null&&e.testing)?{error:Ce}:(Object.assign(t.element,{notes:t.notes}),{...ue}):{error:Ce}}function o9(t){return Qi(t)?Qi(t.element)?(t.element.notes&&delete t.element.notes,{...ue}):{error:Ce}:{error:Xt}}var oB={matchUpStatus:Or,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function Np(t){var e,i,n,r,a,s,o,l;let u="modifyMatchUpScore",c=t.matchUpFormat,d=t.matchUp,p,{matchUpStatusCodes:h,tournamentRecord:f,drawDefinition:m,matchUpStatus:g,removeScore:v,winningSide:y,matchUpId:b,event:I,notes:S,score:w}=t,T=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(e=pn({policyTypes:[Qu],tournamentRecord:f,drawDefinition:m,structure:p,event:I}))==null?void 0:e.appliedPolicies,U=d.matchUpType===zn;if(U&&m){if(b&&d.matchUpId!==b){let A=tr({drawDefinition:m,matchUpId:b,event:I});if(!A.matchUp)return{error:Gs};({matchUp:d,structure:p}=A)}}else d.matchUpId!==b&&console.log("!!!!!");g&&[ln,jr].includes(g)||v?Object.assign(d,{...oB}):w&&(d.score=w);let C=g&&d?.matchUpStatus===Wi&&g!==Wi;g&&(d.matchUpStatus=g),c&&(d.matchUpFormat=c),h&&(d.matchUpStatusCodes=h),y&&(d.winningSide=y),t.removeWinningSide&&(d.winningSide=void 0),!p&&m&&({structure:p}=tr({drawDefinition:m,matchUpId:b,event:I})),g&&!d.winningSide&&Sa(d)&&!wa.includes(g)&&![_0,xv,$l].includes(g)&&(d.matchUpStatus=vd);let E;if((C&&(i=d?.processCodes)!=null&&i.length||g===Wi)&&(E=(r=(n=T?.[Qu])==null?void 0:n.processCodes)==null?void 0:r.incompleteAssignmentsOnDefault),!d.collectionId){let A=p?.structureType===Eo,_=Vo({structure:p});if(I8({drawDefinition:m,structure:p})||_||A){let x=F=>{c=U?"SET1-S:T100":c??d.matchUpFormat??F?.matchUpFormat??m?.matchUpFormat??I?.matchUpFormat;let j=U?{matchUpTypes:[zn]}:void 0,{matchUps:H}=vn({afterRecoveryTimes:!1,tournamentRecord:f,inContext:!0,matchUpFilters:j,drawDefinition:m,structure:F,event:I});return _&&(F.positionAssignments=Si(H.flatMap(G=>(G.sides??[]).map(W=>W.participantId)).filter(Boolean)).map(G=>({participantId:G}))),s9({positionAssignments:F.positionAssignments,tournamentRecord:f,drawDefinition:m,matchUpFormat:c,matchUps:H,event:I})},O=A&&p.structures.find(F=>F?.matchUps.find(j=>j.matchUpId===b)),$=x(O||p);if($.error)return pe({result:$,stack:u})}}if(S){let A=sB({element:d,notes:S});if(A.error)return pe({result:A,stack:u})}let P=f?.tournamentId,M=lc().topics.includes(F$),R=(M||E)&&Cs({drawDefinition:m}),N=R&&((a=pa({matchUpFilters:{matchUpIds:[b]},nextMatchUps:!0,tournamentRecord:f,inContext:!0,drawDefinition:m,matchUpsMap:R}).matchUps)==null?void 0:a[0]);if(M&&N&&KWe({tournamentId:P,inContextMatchUp:N}),Array.isArray(E)&&N&&!((s=N.sides)!=null&&s.every(({participantId:A})=>A)))if(g===Wi)d.processCodes=Si([...d.processCodes??[],...E]);else for(let A of E||[]){let _=A&&((o=d?.processCodes)==null?void 0:o.lastIndexOf(A));(l=d?.processCodes)==null||l.splice(_,1)}return Xi({eventId:I?.eventId,context:u,drawDefinition:m,tournamentId:P,matchUp:d}),{...ue}}function l9(t){var e,i,n,r;let{matchUpStatusCodes:a,matchUpStatus:s,structure:o,matchUp:l,dualMatchUp:u,inContextMatchUp:c,autoCalcDisabled:d}=t,p=qM({matchUpStatus:s})||[oh,ul].includes(s)&&u||d,h=((e=l?.sides)==null?void 0:e.map(y=>y.participantId).filter(Boolean).length)||((i=c?.sides)==null?void 0:i.map(y=>y.participantId).filter(Boolean).length),f="attemptToModifyScore";if(!(Vo({structure:o})&&h===1||s===Wi&&h||J6e({structure:o,matchUp:l,inContextMatchUp:c})||((r=(n=t.appliedPolicies)==null?void 0:n[Qu])==null?void 0:r.requireParticipantsForScoring)===!1))return pe({result:{error:e7},stack:f});let m=[ln].includes(s),g=p?s:t.winningSide&&kr||$l,v=Np({...t,matchUpStatusCodes:p&&a||[],matchUpStatus:g,removeScore:m});return pe({result:v,stack:f})}function J6e({structure:t,matchUp:e,inContextMatchUp:i}){var n;let{drawPositions:r}=e,{positionAssignments:a}=xa({structure:t}),s=a?.filter(l=>r?.includes(l.drawPosition)&&l.participantId),o=(n=i?.sides)==null?void 0:n.every(l=>l.participantId);return s?.length===2||o}function U0e({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(n=>bi(n?.groupValue)&&n?.groupNumber).map(n=>({[n.groupNumber]:{...n,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(n=>ai(n));return{groupValueGroups:e,groupValueNumbers:i}}function Q6e({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:n,tieMatchUps:r}){let a=r.filter(y=>y.collectionId===t.collectionId),s=[0,0],o=[0,0],l=a.every(y=>wa.includes(y.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,matchUpValue:p,winCriteria:h,scoreValue:f,setValue:m}=t,g=c&&e.includes(c),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),bi(p)?a.forEach(y=>{y.winningSide&&(s[y.winningSide-1]+=p)}):bi(m)?a.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(S=>{S.winningSide&&(s[S.winningSide-1]+=m)})}):bi(f)?a.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(S=>{let{side1TiebreakScore:w=0,side2TiebreakScore:T=0,side1Score:U=0,side2Score:C=0}=S;(y.matchUpStatus===kr||y.winningSide||S.winningSide)&&(U||C?(s[0]+=U,s[1]+=C):(w||T)&&S.winningSide&&(s[S.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(y=>{if(y.winningSide){let b=y.collectionPosition,I=e7e({collectionDefinition:t,collectionPosition:b});bi(I)&&(s[y.winningSide-1]+=I)}}),bi(d)){let y;if(h!=null&&h.aggregateValue)l&&(bi(p||m||f)&&s[0]!==s[1]?y=s[0]>s[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(h!=null&&h.valueGoal)y=s.reduce((b,I,S)=>I>=h.valueGoal?S+1:b,0);else{let b=Math.floor(t.matchUpCount/2)+1;y=v.reduce((I,S,w)=>S>=b?w+1:I,0)}y&&(g?i[c].values[y-1]+=d:o[y-1]+=d)}else g?(i[c].values[0]+=s[0]||0,i[c].values[1]+=s[1]||0):o=s;g?(i[c].sideWins[0]+=v[0]||0,i[c].sideWins[1]+=v[1]||0,i[c].allGroupMatchUpsCompleted=i[c].allGroupMatchUpsCompleted&&l,i[c].matchUpsCount+=a.length):o.forEach((y,b)=>n[b]+=y||0)}function e7e({collectionDefinition:t,collectionPosition:e}){var i,n;return(n=(i=t.collectionValueProfiles||[])==null?void 0:i.find(r=>r.collectionPosition===e))==null?void 0:n.matchUpValue}function oN(t){var e,i,n,r,a;let{sideAdjustments:s=[0,0],separator:o="-",drawDefinition:l,matchUpsMap:u,structure:c,matchUp:d,event:p}=t;if(!Array.isArray(s)||s.length!==2||isNaN(s.reduce((C,E)=>C+E)))return{error:Ce};if(!d)return{error:ol};let h=((e=Xs({matchUp:d,drawDefinition:l,structure:c,event:p}))==null?void 0:e.tieFormat)||t?.tieFormat;if(!h)return{error:MD};let f=Bo({tieFormat:h});if(f.error)return f;let m=h?.collectionDefinitions||[],g=d?.tieMatchUps??[],v=[0,0],{groupValueGroups:y,groupValueNumbers:b}=U0e(h);for(let C of m)Q6e({collectionDefinition:C,groupValueNumbers:b,groupValueGroups:y,sideTieValues:v,tieMatchUps:g});for(let C of b){let E=y[C],{allGroupMatchUpsCompleted:P,matchUpCount:M,winCriteria:R,groupValue:N,sideWins:A,values:_}=E,x;if(R!=null&&R.aggregateValue)P&&_[0]!==_[1]&&(x=_[0]>_[1]?1:2);else if(R!=null&&R.valueGoal)x=_.reduce((O,$,F)=>$>=R.valueGoal?F+1:O,void 0);else{let O=Math.floor(M/2)+1;x=A.reduce(($,F,j)=>F>=O?j+1:$,void 0)}x&&(v[x-1]+=N||0)}let I=v.map((C,E)=>(C||0)+s[E]),S={side1Score:I[0],side2Score:I[1],winningSide:void 0},w=I.join(o),T=I.slice().reverse().join(o),U;if(h!=null&&h.winCriteria){let{valueGoal:C,aggregateValue:E,tallyDirectives:P}=h.winCriteria;if(C?U=(i=I.map((M,R)=>({sideNumber:R+1,points:M})).find(({points:M})=>M>=C))==null?void 0:i.sideNumber:E&&g.every(M=>M.matchUpStatus&&wa.includes(M.matchUpStatus)||M.winningSide)&&I[0]!==I[1]&&(U=I[0]>I[1]?1:2),!U&&P){let M=d.matchUpId,R=d.hasContext?d:((n=u?.drawMatchUps)==null?void 0:n[M])||l&&((r=tr({inContext:!0,drawDefinition:l,matchUpId:M}))==null?void 0:r.matchUp);if(R){let{completedTieMatchUps:N,order:A}=KD({matchUps:[R]});if(N&&A!=null&&A.length){let _=A[0].participantId;U=(a=R.sides.find(({participantId:x})=>x===_))==null?void 0:a.sideNumber}}}}return U&&(S.winningSide=U),{scoreStringSide1:w,scoreStringSide2:T,winningSide:U,set:S}}function lN({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:n,eventId:r}){var a,s;if(n){t||(t=(a=tr({matchUpId:n.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:o}=ki({element:e,name:Rm}),l=At(o?.value||{},!1,!0),u=({displaySideNumber:c,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:c});n.sides=(s=t?.sides)==null?void 0:s.map(c=>{var d;let p=c.participantId,h=p&&l[p]||void 0,{lineUp:f,...m}=((d=n.sides)==null?void 0:d.find(({sideNumber:v})=>v===c.sideNumber))??{},g=f!=null&&f.length?f:h;return{...u(c),...m,lineUp:g}}),Xi({context:"ensureSidLineUps",matchUp:n,drawDefinition:e,tournamentId:i,eventId:r})}}function fs(t){if(t)return At(t,!1,!0)}function u9(t){let e=Yt(t,[{[Hs]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,n)=>{i.tournamentIdMap[n]=[];let r=t.tournamentRecords[n].events??[],a=r.map(({eventId:o})=>o),s=r.map(o=>(o.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[n].push(...a,...s),i.eventIds.push(...a),i.drawIds.push(...s),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function D0e({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:n}=u9({tournamentRecords:t});return(n?Object.keys(n):[]).find(r=>e&&n?.[r].includes(e)||i&&n?.[r].includes(i))}function eg(t){var e,i,n,r;let{exitWhenNoValues:a,drawDefinition:s,matchUpStatus:o,removeScore:l,matchUpsMap:u,matchUpId:c,event:d}=t,p=t.tournamentRecords||t.tournamentRecord&&{[(e=t.tournamentRecord)==null?void 0:e.tournamentId]:t.tournamentRecord}||{},h=t.tournamentId||((i=t.tournamentRecord)==null?void 0:i.tournamentId);p&&D0e({tournamentRecords:p,...t});let f=h&&p[h];if(!f)return{error:lt};let m=tr({drawDefinition:s,event:d,matchUpId:c});if(m.error)return m;if(!m.matchUp)return{error:Gs};let{matchUp:g,structure:v}=m;if(!g.tieMatchUps)return{error:ll};lN({tournamentId:f?.tournamentId,eventId:d?.eventId,dualMatchUp:g,drawDefinition:s});let{extension:y}=ki({name:Ew,element:g});if(y!=null&&y.value)if(l)po({element:g,name:Ew});else return{...ue,score:g.score};let b=(n=Xs({drawDefinition:s,structure:v,matchUp:g,event:d}))==null?void 0:n.tieFormat;g.tieFormat=fs(b);let I=oN({drawDefinition:s,matchUpsMap:u,structure:v,matchUp:g,event:d}),{winningSide:S,set:w,scoreStringSide1:T,scoreStringSide2:U}=I,C=w?.side1Score||w?.side2Score;if(a&&!g.score&&!C)return{...ue};let E={scoreStringSide1:T,scoreStringSide2:U,sets:w?[w]:[]},P=S&&[1,2].includes(S),M=P&&kr||P8({matchUpStatus:o??g.matchUpStatus,tieMatchUps:g.tieMatchUps,winningSide:g.winningSide,score:E})&&vd||Or,R=!!(g.winningSide&&!P),N=g.tieMatchUps.find(({score:_,winningSide:x,matchUpStatus:O})=>{var $;return(($=_?.sets)==null?void 0:$.length)&&(_.sets[0].side1Score||_.sets[0].side2Score)||O&&wa.includes(O)||x}),A;if(g.tieFormat&&!P&&!N){let _=(r=Xs({drawDefinition:s,structure:v,event:d}))==null?void 0:r.tieFormat;_&&JSON.stringify(b)===JSON.stringify(_)&&(g.tieFormatId=void 0,g.tieFormat=void 0,A=!0)}return Np({appliedPolicies:t.appliedPolicies,matchUpStatus:M,score:E,removeWinningSide:R,tournamentRecord:f,drawDefinition:s,removeScore:l,winningSide:S,matchUpId:c,matchUp:g,event:d}),{...ue,score:E,removeWinningSide:R,tieFormatRemoved:A,winningSide:S}}function t7e({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:n,winningDrawPosition:r,tournamentRecord:a,winnerTargetLink:s,sourceMatchUpId:o,drawDefinition:l,winnerMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}){var h,f,m,g,v;let y="directWinner";if(s){let b=u.drawPositions||[],I=b[t],S=s.source.structureId,w=ui({structureId:S,drawDefinition:l});if(w.error)return w;let{structure:T}=w,{positionAssignments:U}=xa({structureId:S,drawDefinition:l}),C=(h=U?.find(A=>A.drawPosition===r))==null?void 0:h.participantId,E=s.target.structureId,{positionAssignments:P}=xa({structureId:E,drawDefinition:l}),M=(f=P?.find(A=>A.participantId===C))==null?void 0:f.drawPosition,R=P?.filter(A=>{let _=b.includes(A.drawPosition),x=!A.participantId&&!A.bye&&!A.qualifier;return _&&x}).map(A=>A.drawPosition),N=R?.includes(I);if(C&&s.target.roundNumber===1&&N)Yp({drawPosition:I,participantId:C,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(C&&R!=null&&R.length){let A=R.pop();A&&Yp({participantId:C,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,drawPosition:A,matchUpsMap:d,event:p})}else if(M){let A=yU({drawPosition:M,matchUpId:u.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(A.error)return pe({result:A,stack:y})}else if(T?.stage!==Kt){let A="winner target position unavaiallble";return console.log(A),{error:A}}if(T!=null&&T.seedAssignments&&T.structureId!==E){let A=T.seedAssignments.find(({participantId:x})=>x===C),_=A?.participantId;A&&_&&qD({eventId:u?.eventId,structureId:E,...A,tournamentRecord:a,drawDefinition:l,participantId:_})}}else{let b=yU({matchUpId:u.matchUpId,drawPosition:r,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(b.error)return b}if(c&&i){let b=(m=c.sides)==null?void 0:m.find(I=>I.sideNumber===i);if(b!=null&&b.lineUp){let I=c.roundPosition,S=u.roundPosition,w=I===S&&I!==1||Math.floor(I/2)===S?2:1,T=(g=d?.drawMatchUps)==null?void 0:g.find(({matchUpId:E})=>E===u.matchUpId),U=[1,2].map(E=>{var P;return{...((P=T.sides)==null?void 0:P.find(M=>M.sideNumber===E))||{},sideNumber:E}});T.sides=U;let C=T.sides.find(E=>E.sideNumber===w);if(C){let E=(v=b.lineUp)==null?void 0:v.filter(P=>P?.participantId);C.lineUp=G8({lineUp:E}),Xi({tournamentId:a?.tournamentId,eventId:u?.eventId,matchUp:T,context:y,drawDefinition:l})}}}return{...ue}}function i7e(t){var e,i,n;let{loserMatchUpDrawPositionIndex:r,inContextDrawMatchUps:a,projectedWinningSide:s,sourceMatchUpStatus:o,loserDrawPosition:l,tournamentRecord:u,loserTargetLink:c,drawDefinition:d,loserMatchUp:p,dualMatchUp:h,matchUpsMap:f,event:m}=t,g="directLoser",v=c.linkCondition,y=p.drawPositions||[],b=v===qp&&p.roundNumber===2&&Math.min(...y.filter(Boolean)),I=b||y[r],S=b||y[1-r],w=c.source.structureId,{structure:T}=ui({structureId:w,drawDefinition:d}),{matchUps:U}=vn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:d,structure:T,event:m}),C=U.filter(G=>{var W;return(W=G.drawPositions)==null?void 0:W.includes(l)}).filter(G=>{let W=G.sides.find(Z=>Z.drawPosition===l),q=G.matchUpStatus===ln||G.matchUpStatus===Wi&&!Sa(G);return W?.sideNumber===G.winningSide&&!q}),E=v===qp&&C.length===0,{positionAssignments:P}=xa({structureId:w,drawDefinition:d}),M=(e=P?.find(G=>G.drawPosition===l))==null?void 0:e.participantId,R=c.target.structureId,{positionAssignments:N}=xa({structureId:R,drawDefinition:d}),A=N?.filter(({drawPosition:G})=>y.includes(G));if(A!=null&&A.some(G=>G.participantId===M))return{...ue};let _=A?.filter(G=>{let W=y.includes(G.drawPosition),q=!G.participantId&&!G.bye&&!G.qualifier;return W&&q}).map(G=>G.drawPosition),x=_?.includes(I),O=c.target.roundNumber>1&&_?.length,$=c.target.roundNumber===1&&x;if(b){let G=F();if(G.error)return pe({result:G,stack:g})}else if($){let G=H();if(G.error)return pe({result:G,stack:g})}else if(M&&O){_.sort(ra);let G=_[0],W=Yp({participantId:M,structureId:R,drawPosition:G,inContextDrawMatchUps:a,sourceMatchUpStatus:o,tournamentRecord:u,drawDefinition:d,matchUpsMap:f,event:m});if(W.error)return pe({result:W,stack:g})}else return pe({context:{loserDrawPosition:l,loserTargetLink:c,targetDrawPositionIsUnfilled:x},result:{error:x?PD:Bqe},stack:g});if(T!=null&&T.seedAssignments&&T.structureId!==R){let G=T.seedAssignments.find(({participantId:q})=>q===M),W=G?.participantId;G&&W&&qD({eventId:p?.eventId,structureId:R,...G,tournamentRecord:u,drawDefinition:d,participantId:W})}if(h&&s){let G=(i=h.sides)==null?void 0:i.find(W=>W.sideNumber===3-s);if(G!=null&&G.lineUp){let{roundNumber:W,eventId:q}=p,{roundPosition:Z}=h,K=W===1?2-Z%2:1,Q=(n=f?.drawMatchUps)==null?void 0:n.find(({matchUpId:re})=>re===p.matchUpId),J=[1,2].map(re=>{var oe;return{...((oe=Q.sides)==null?void 0:oe.find(de=>de.sideNumber===re))||{},sideNumber:re}});Q.sides=J;let ne=Q.sides.find(re=>re.sideNumber===K);ne&&(ne.lineUp=G8({lineUp:G.lineUp}),Xi({tournamentId:u?.tournamentId,matchUp:Q,context:g,drawDefinition:d,eventId:q}))}}return{...ue};function F(){let G="loserLinkFedFMLC";return pe(E?{result:H(),stack:G}:{result:j(),stack:G})}function j(){let G=Eu({drawPosition:S,structureId:R,tournamentRecord:u,drawDefinition:d,event:m});return pe({result:G,stack:"assignLoserPositionBye"})}function H(){let G=M?Yp({drawPosition:I,participantId:M,structureId:R,inContextDrawMatchUps:a,sourceMatchUpStatus:o,tournamentRecord:u,drawDefinition:d,matchUpsMap:f,event:m}):{error:da};return pe({result:G,stack:"assignLoserDrawPosition"})}}function E0e(t){var e;let i="directParticipants",n=l9(t);if(n.error)return pe({result:n,stack:i});let r=qM({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:a,projectedWinningSide:s,inContextDrawMatchUps:o,tournamentRecord:l,drawDefinition:u,matchUpStatus:c,dualMatchUp:d,matchUpsMap:p,winningSide:h,targetData:f,matchUpId:m,structure:g,matchUp:v,event:y}=t,b=!!v.collectionId,I=Vo({structure:g}),S=v.drawPositions,w;if(b){let{matchUpTieId:T,matchUpsMap:U}=t,C=eg({appliedPolicies:t.appliedPolicies,matchUpId:T,tournamentRecord:l,drawDefinition:u,matchUpsMap:U,event:y});if(w=C&&{tieMatchUpResult:C},S=(e=o.find(({matchUpId:E})=>E===T))==null?void 0:e.drawPositions,!a)return pe({result:{...ue,...w},stack:i})}if(I)return pe({result:{...ue,...w},stack:i});if(S){let T=s?s-1:h-1,U=1-T,C=S[T],E=S[U],{targetLinks:{loserTargetLink:P,winnerTargetLink:M,byeTargetLink:R},targetMatchUps:{winnerMatchUpDrawPositionIndex:N,loserMatchUpDrawPositionIndex:A,winnerMatchUp:_,loserMatchUp:x,byeMatchUp:O}}=f;if(_){let $=t7e({sourceMatchUpStatus:r&&c||kr,winnerMatchUpDrawPositionIndex:N,sourceMatchUpId:m,inContextDrawMatchUps:o,projectedWinningSide:s,winningDrawPosition:C,tournamentRecord:l,winnerTargetLink:M,drawDefinition:u,winnerMatchUp:_,dualMatchUp:d,matchUpsMap:p,event:y});if($.error)return pe({result:$,stack:i})}if(x){let $=i7e({sourceMatchUpStatus:r&&c||kr,loserMatchUpDrawPositionIndex:A,inContextDrawMatchUps:o,projectedWinningSide:s,loserDrawPosition:E,tournamentRecord:l,loserTargetLink:P,drawDefinition:u,loserMatchUp:x,matchUpsMap:p,dualMatchUp:d,event:y});if($.error)return pe({result:$,stack:i})}if(O){let $=O.drawPositions||[],F=Math.min(...$.filter(Boolean)),j=R.target.structureId,H=Eu({drawPosition:F,structureId:j,tournamentRecord:l,drawDefinition:u,event:y});if(H.error)return pe({result:H,stack:i})}}else return pe({result:{error:mM},stack:i});return pe({result:{...ue,...w},stack:i})}function c9(t){var e,i,n,r;let a="genPlayoffStructure";if(!t.drawDefinition)return pe({result:{error:Lt},stack:a});let s=nN(t);if(s.error)return pe({result:s,stack:a});let{structureId:o,addNameBaseToAttributeName:l,playoffStructureNameBase:u,finishingPositionNaming:c,finishingPositionLimit:d,playoffAttributes:p,playoffPositions:h,roundOffsetLimit:f,tournamentRecord:m,exitProfileLimit:g,roundProfiles:v,roundNumbers:y,idPrefix:b,isMock:I,event:S,uuids:w}=t,T=At(t.drawDefinition,!1,!0),{structure:U}=ui({structureId:o,drawDefinition:T});if(!U)return pe({result:{error:pr},stack:a});if(U.structureType===Eo||U.structures)return x6e({sourceStructureId:U.structureId,...t,...s,drawDefinition:T});let{playoffRoundsRanges:C,playoffRounds:E}=s,{playoffPositionsReturned:P,error:M,playoffSourceRounds:R,playoffRoundsRanges:N}=l0e(t);if(M)return pe({result:{error:M},stack:a});let A=v?.length&&Object.assign({},...v),_=y||typeof v=="object"&&v.map(re=>Object.keys(re)).flat(),x=Array.isArray(_)&&_.map(re=>!isNaN(re)&&ai(re)).filter(Boolean);if(x){if(!Array.isArray(x))return pe({result:{error:Ce},context:{validRoundNumbers:x},stack:a});x.forEach(re=>{if(!(E!=null&&E.includes(re)))return pe({result:{error:Ce},context:{roundNumber:re},stack:a})})}h&&h.forEach(re=>{if(!(P!=null&&P.includes(re)))return pe({result:{error:Ce},context:{playoffPosition:re},stack:a})});let O=x||R,$=x?C:N,F=[],j=[];for(let re of O??[]){let oe=$?.find(Me=>Me.roundNumber===re);if(!oe)return pe({result:{error:Ce},context:{roundNumber:re},stack:a});let de=oe.finishingPositions.length,se=Math.min(...oe.finishingPositions)-1,ge=2,ye=re&&A?.[re]&&ge+A[re]-1,Te=gT({exitProfile:`0-${re}`,addNameBaseToAttributeName:l,playoffStructureNameBase:u,finishingPositionOffset:se,playoffAttributes:p,exitProfileLimit:g,stage:Tr,roundOffset:0,drawDefinition:T,sequenceLimit:ye,stageSequence:ge,drawSize:de,idPrefix:b,isMock:I,uuids:w,finishingPositionNaming:c,finishingPositionLimit:d,roundOffsetLimit:f});if(Te.error)return pe({result:Te,stack:a});let{structures:De,links:xe}=Te;if(De!=null&&De.length&&F.push(...De),xe!=null&&xe.length&&j.push(...xe),Te.structureId&&re){let Me={linkType:sf,source:{structureId:o,roundNumber:re},target:{structureId:Te.structureId,feedProfile:Oc,roundNumber:1}};j.push(Me)}}if(!F.length)return pe({result:{error:Ce},info:"No structures generated",stack:a});T.structures.push(...F),T.links.push(...j);let{matchUps:H,matchUpsMap:G}=pa({inContext:!0,drawDefinition:T}),W=F.map(({structureId:re})=>re),q=H?.filter(({structureId:re})=>W.includes(re)).map(Na),Z=(e=G?.drawMatchUps)==null?void 0:e.filter(({matchUpId:re})=>q?.includes(re));if(Z!=null&&Z.length){let re=(i=Xs({drawDefinition:T,event:S}))==null?void 0:i.tieFormat;re&&Z.forEach(oe=>{let{tieMatchUps:de}=rN({matchUp:oe,tieFormat:re,isMock:I});Object.assign(oe,{tieMatchUps:de,matchUpType:zn})})}(n=H?.filter(re=>Ny({matchUp:re})&&re.structureId===o))==null||n.forEach(re=>{let{matchUpId:oe,score:de,winningSide:se}=re,ge=Io({inContextDrawMatchUps:H,drawDefinition:T,matchUpId:oe}),ye=E0e({inContextDrawMatchUps:H,tournamentRecord:m,drawDefinition:T,matchUpsMap:G,winningSide:se,targetData:ge,matchUpId:oe,structure:U,matchUp:re,score:de,event:S});ye.error&&console.log(ye.error)}),(r=H?.filter(re=>re.matchUpStatus===fn&&re.structureId===o))==null||r.forEach(re=>{let{matchUpId:oe}=re,de=Io({inContextDrawMatchUps:H,drawDefinition:T,matchUpId:oe}),{targetLinks:{loserTargetLink:se},targetMatchUps:{loserMatchUpDrawPositionIndex:ge,loserMatchUp:ye}}=de;if(se&&ye){let Te=se.target.structureId,De=ye.drawPositions[ge],xe=Eu({drawPosition:De,structureId:Te,tournamentRecord:m,drawDefinition:T,event:S});xe.error&&console.log(xe.error)}});let K=[],Q=pb({inContextDrawMatchUps:H,drawDefinition:T,matchUpsMap:G}).goesToMap,{structure:J}=ui({drawDefinition:t.drawDefinition,structureId:o}),{matchUps:ne}=vn({structure:J});return ne.forEach(re=>{var oe,de;let se=Q?.loserMatchUpIds[re.matchUpId];if(se&&re.loserMatchUpId!==se){re.loserMatchUpId=se;let ye={tournamentId:m?.tournamentId,eventId:(oe=t.event)==null?void 0:oe.eventId,context:a,matchUp:re};K.push(ye)}let ge=Q?.winnerMatchUpIds[re.matchUpId];if(ge&&re.winnerMatchUpId!==ge){re.winnerMatchUpId=ge;let ye={tournamentId:m?.tournamentId,eventId:(de=t.event)==null?void 0:de.eventId,context:a,matchUp:re};K.push(ye)}}),{structures:F,matchUpModifications:K,links:j,drawDefinition:T,...ue}}function P0e({element:t}){if(!t)return{error:Ce};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:Ce};let e=(i,n)=>(r,a)=>(a[i]&&(r[a[i]]=a[n]),r);return t.timeItems.reduce(e("itemType","itemValue"),{})}function lh(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:n,timeItem:r}=t;if(!r)return{error:h7};let a=LIe(t);if(a.error)return a;if(!(Qi(r)&&nr(r.itemType)&&Object.keys(r).includes("itemValue")))return{error:p7};if(!a.timeItems)a.timeItems=[];else if(n7e({element:a,duplicateValues:e,timeItem:r}))return{...ue};if(r.itemSubTypes&&!r.itemSubTypes.length&&delete r.itemSubTypes,i){let s=new Date().toISOString();Object.assign(r,{createdAt:s})}return n&&(a.timeItems=a.timeItems.filter(({itemType:s})=>r.itemType!==s)),n&&!r.itemValue||a.timeItems.push(r),{...ue}}function n7e({element:t,duplicateValues:e,timeItem:i}){var n;let{itemType:r,itemSubTypes:a,itemValue:s}=i,o=r&&((n=cc({itemSubTypes:a,itemType:r,element:t}))==null?void 0:n.timeItem);return o&&JSON.stringify(o?.itemValue)===JSON.stringify(s)&&!e}function d9({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:n,participantId:r,timeItem:a}){if(!i)return{error:lt};if(!r)return{error:da};let s=Ov({tournamentRecord:i,participantId:r});return s.error?s:lh({element:s.participant,removePriorValues:e,duplicateValues:n,creationTime:t,timeItem:a})}function uN(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:n,creationTime:r,timeItem:a}=t;if(!i)return{error:lt};let s=lh({element:i,removePriorValues:e,duplicateValues:n,creationTime:r,timeItem:a});if(s.error)return s;let o=P0e({element:i});return Ui({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:o},topic:Vb}),s}function W0(t){let{removePriorValues:e,duplicateValues:i,creationTime:n,timeItem:r,event:a}=t;return a?lh({removePriorValues:e,duplicateValues:i,element:a,creationTime:n,timeItem:r}):{error:Xu}}function C0e(t){return lB({...t,itemType:"attachConsolationStructures"})}function p9(t){return lB({...t,itemType:"attachPlayoffStructures"})}function lB({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:n,structures:r,links:a=[],event:s}){var o,l,u;let c="attachStructures";if(!n)return{error:Lt};if(!Array.isArray(r)||!Array.isArray(a))return pe({result:{error:Ce},stack:c});let d=b=>{var I;return[b.source.structureId,b.source.roundNumber||((I=b.source.finishingPositions)==null?void 0:I.join("|")),b.target.roundNumber].join("|")},p=(o=n.links)==null?void 0:o.map(d);if(a.some(b=>{let I=d(b);return p?.includes(I)}))return pe({result:{error:y7},info:"playoff structure exists",stack:c});a.length&&((l=n.links)==null||l.push(...a));let h=r.map(({structureId:b})=>b),f=(u=n.structures)==null?void 0:u.map(({structureId:b})=>b);n.structures=(n.structures??[]).map(b=>h.includes(b.structureId)?r.find(({structureId:I})=>I===b.structureId):b);let m=r?.filter(({structureId:b})=>!(f!=null&&f.includes(b)));m.length&&n.structures.push(...m),pb({drawDefinition:n});let g=r.map(b=>{var I;return((I=vn({structure:b}))==null?void 0:I.matchUps)||[]}).flat();sv({tournamentId:i?.tournamentId,eventId:s?.eventId,drawDefinition:n,matchUps:g});let v=r.map(({structureId:b})=>b);if(Bn({drawDefinition:n,structureIds:v}),e?.length){let b={};e.forEach(S=>{var w;let T=(w=S.matchUp)==null?void 0:w.matchUpId;T&&(b[T]=S)});let I=S=>{S.matchUps.forEach(w=>{if(b[w.matchUpId]){let{tieMatchUps:T,...U}=b[w.matchUpId].matchUp;if(Object.assign(w,U),T?.length){let C={};T.forEach(E=>b[E.matchUpId]=E),w.tieMatchUps.forEach(E=>Object.assign(E,C[E.matchUpId]))}b[w.matchUpId].matchUp=w,Xi(b[w.matchUpId])}})};n.structures.forEach(S=>{if(f!=null&&f.includes(S.structureId))if(S.structures)for(let w of S.structures)I(w);else I(S)})}let y=m.map(Bl("structureId"));if(i){let b={itemValue:{structureIds:v,drawId:n.drawId},itemType:t};lh({element:i,timeItem:b})}return{...ue,addedStructureIds:y}}function uB(t){var e,i;let{structures:n,links:r,matchUpModifications:a,error:s}=c9(t);if(s)return{error:s};let o=t.drawDefinition;return p9({tournamentId:(e=t.tournamentRecord)==null?void 0:e.tournamentId,eventId:((i=t.event)==null?void 0:i.eventId)||t.eventId,matchUpModifications:a,drawDefinition:o,structures:n,links:r})}function fb(t){let e=Yt(t,[{_anyOf:{[Hs]:!1,[Ta]:!1,[Po]:!1,[Av]:!1},[O7]:!0}]);if(e.error)return e;let i=[],n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n){let r=FQ(t,n);if(r.error)return r;i.push(...r?.applied??[]),t.drawDefinition&&Bn({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:lt};for(let a of r){let s=t.tournamentRecords[a],o=FQ(t,s);if(o.error)return o;i.push(...o?.applied??[])}}else return{error:lt};return i.length?{...ue,applied:i}:{error:a7}}function FQ(t,e){let i=pn(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let n=[],r=Object.keys(t.policyDefinitions);if(!r.length)return{error:r$};for(let a of r)if(!i[a]||t.allowReplacement){let s=t.policyDefinitions[a];if(!s)continue;if(!Qi(s))return{error:Ce};let{policyName:o,...l}=s;if(!l||!Object.keys(l).length||o&&!nr(o))return{error:Ce};i[a]=t.policyDefinitions[a],n.push(a)}return n!=null&&n.length?{...dn({element:e,extension:{name:XC,value:i}}),applied:n}:{applied:n,error:a7}}function h9({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:n,drawId:r,event:a}){var s;if(!n||typeof n!="string")return pe({result:{error:Ce},context:{drawName:n}});i||(i=Rr({event:a}).flightProfile);let o=(s=i?.flights)==null?void 0:s.find(l=>l.drawId===r);if(o){o.drawName=n;let l={name:ld,value:{...i,flights:i.flights}};kv({event:a,extension:l})}return e&&(e.drawName=n,Bn({tournamentId:t?.tournamentId,drawDefinition:e})),!o&&!e?{error:Lt}:{...ue,flight:o}}function R0e({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:n,event:r}){var a;if(!Qi(i))return{error:Ce};let s=Rr({event:r}).flightProfile,o=i.drawName&&h9({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:s,drawId:n,event:r});if(o!=null&&o.error)return o?.error;let l=o?.flight||((a=s?.flights)==null?void 0:a.find(u=>u.drawId===n));if(!l&&!e)return{error:Lt};if(l){let u={name:ld,value:{...s,flights:s.flights}};kv({event:r,extension:u})}return e&&(i.policyDefinitions&&fb({policyDefinitions:i.policyDefinitions,drawDefinition:e}),Bn({tournamentId:t?.tournamentId,drawDefinition:e})),{...ue}}function M0e({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var n,r;if(!i)return{error:Lt};let a=Cs({drawDefinition:i}),s=l=>{var u;return(u=a?.drawMatchUps)==null?void 0:u.find(c=>c.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:u,stage:c,stageSequence:d}=l;u&&(d!==1||![Kt,_t].includes(c))&&(l.positionAssignments=u.map(f=>(delete f.participantId,f)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:h}=vn({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:a,structure:l});for(let f of p){let{matchUpId:m,roundNumber:g}=f,v=f.sides||[],y=s(m);if(y){if(delete y.extensions,delete y.notes,y.matchUpStatus!==fn&&Object.assign(y,oB),g&&g>1&&((n=y.drawPositions)==null?void 0:n.length)&&!h){let b=v?.map(({drawPosition:S,participantFed:w})=>!w&&S).filter(Boolean),I=y.drawPositions.map(S=>b.includes(S)?void 0:S);y.drawPositions=I}e?delete y.timeItems:(r=y.timeItems)!=null&&r.length&&(y.timeItems=y.timeItems.filter(b=>b.itemType&&![cf,lv,O0,T8,L0,F0].includes(b.itemType))),Xi({tournamentId:t?.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:y})}}}i.extensions=i.extensions.filter(l=>l.name!==mT);let o=(i.structures||[]).map(({structureId:l})=>l);return Bn({drawDefinition:i,structureIds:o}),{...ue}}function cN({tournamentRecord:t}){var e;if(!t)return{error:lt};let i={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},n={};return((e=t.events)==null?void 0:e.map(r=>{let a=r.eventId;return n[a]=r,(r?.drawDefinitions||[]).map(s=>({drawDefinition:s,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:r,eventId:a})=>{let s=0,o=0,l=0,{allStructuresLinked:u}=nB({drawDefinition:r}),c=n[a],d=(r?.structures||[]).map(I=>{let{stage:S,stageSequence:w,structureId:T}=I,U=Uw[S],{inContextStructureMatchUps:C}=WM({drawDefinition:r,structure:I,event:c}),E=C?.filter(({winningSide:G})=>G),P=E.filter(Boolean).length||0;o+=P,l+=C.length-o;let M=Math.max(E.filter(({roundNumber:G})=>G===1).map(({roundPosition:G})=>G)),{positionAssignments:R}=Fn({structure:I}),N=R?.filter(({participantId:G})=>G);s+=N?.length??0;let A=(R?.length??0)-(N?.length??0),{roundMatchUps:_,roundProfile:x,roundNumbers:O,maxMatchUpsCount:$}=bo({matchUps:C}),F=x&&Object.keys(x).filter(G=>!x[G].inactiveRound).map(G=>parseInt(G)),j=x&&Object.keys(x).filter(G=>x[G].inactiveRound).map(G=>parseInt(G)),H=x&&Object.values(x).every(G=>G.inactiveRound);return{positionsAssignedCount:N?.length??0,maxWinningSideFirstRoundPosition:M,unassignedPositionsCount:A,inactiveStructure:H,maxMatchUpsCount:$,inactiveRounds:j,roundMatchUps:_,activeRounds:F,roundNumbers:O,roundProfile:x,structureId:T,stageSequence:w,orderNumber:U,stage:S}}),p=d.find(I=>I.orderNumber===2&&I.stageSequence===1),h=d.filter(({inactiveStructure:I})=>!I).length,{links:f}=jD({structureId:p.structureId,drawDefinition:r}),m=ai(p.activeRounds[0])===1&&p.activeRounds.length===1&&h===1,g=d?.every(({inactiveStructure:I})=>I),v=!f.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=r.drawId;s&&!o&&i.positionsNoOutcomes.push(y),g&&i.inactive.push(y),m&&i.matchPlay.push(y),v&&i.canBePruned.push(y);let b={matchUpsWithWinningSideCount:o,matchUpsNoOutcomeCount:l,positionsAssignedCount:s,allStructuresLinked:u,structuresData:d,inactiveDraw:g,isMatchPlay:m,drawId:y};i.drawAnalysis[y]=b}),{...ue,drawsAnalysis:i}}function N0e({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:n}){var r;if(!e)return{error:lt};if(!i)return{error:Lt};let a=[],{drawsAnalysis:s}=cN({tournamentRecord:e});if(s.canBePruned.includes(n)){let o=s.matchPlay.includes(n),l=s.drawAnalysis[n],{structures:[u]}=ud({stageSequence:1,drawDefinition:i,stage:_t}),c=l.structuresData.find(({structureId:f})=>u.structureId===f),d=(u.matchUps??[]).sort((f,m)=>f.roundPosition-m.roundPosition);a=d.filter(({roundNumber:f})=>!c.inactiveRounds.includes(f));let p=a.map(Na),h=d.map(Na).filter(f=>!p.includes(f));if(o){let f=a.filter(({roundNumber:b})=>!c.inactiveRounds.includes(b)).filter(({winningSide:b})=>b),m=f.map(Na),g=p.filter(b=>!m.includes(b));h.push(...g);let v=f.flatMap(b=>b.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((b,I)=>({[b]:I+1})));if(f.forEach(b=>{t?b.drawPositions=b.drawPositions.map(I=>y[I]):delete b.drawPositions}),t){let b=(r=u?.positionAssignments)==null?void 0:r.filter(I=>v.includes(I.drawPosition)).map(I=>(I.drawPosition=y[I.drawPosition],I));u.positionAssignments=b}else u.positionAssignments=[];u.matchUps=f,a=f}Xm({tournamentId:e?.tournamentId,matchUpIds:h,drawDefinition:i}),Bn({drawDefinition:i})}return{...ue,matchUps:a}}function A0e({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,qualifier:a,event:s,bye:o}){if(!e)return{error:Lt};if(!n)return{error:CD};if(!r)return{error:Tu};if(o){let l=Eu({tournamentRecord:t,drawDefinition:e,drawPosition:n,structureId:r,event:s});if(l.error)return l}else{if(a)return{error:h$};{let l=Yp({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,event:s});if(l.error)return l}}return{...ue}}function _0e(t){var e,i,n,r,a;let s=t.matchUpIds??[],{drawDefinition:o}=t,l=t.structureId??((i=(e=o?.structures)==null?void 0:e.find(h=>{var f;return(f=h.matchUps)==null?void 0:f.some(({matchUpId:m})=>s.includes(m))}))==null?void 0:i.structureId)??((r=(n=o?.structures)==null?void 0:n[0])==null?void 0:r.structureId);if(!l)return{error:pr};let u=(a=o.structures)==null?void 0:a.find(h=>h.structureId===l);if(!u)return{error:pr};let c=u?.matchUps,d=c?.find(h=>!!h.roundPosition);if(u.structures||d||u.finishingPosition===A0)return{error:Lb};let p=c.filter(({roundNumber:h})=>{var f;return(f=t.roundNumbers)==null?void 0:f.includes(h)}).map(Na);return s=s.filter(h=>!p.includes(h)),t.roundNumbers&&!s.length&&(s=p),{existingMatchUps:c,matchUpIds:s,structureId:l,structure:u}}function k0e(t){let e=Yt(t,[{[Po]:!0},{[dU]:{[PM]:!1,roundNumbers:!1},[vu]:Ce,[Ho]:Os}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:n=!0,removeCompleted:r=!1,tournamentRecord:a,drawDefinition:s,event:o}=t,l=_0e(t);if(l.error)return l;let{structure:u,structureId:c,existingMatchUps:d,matchUpIds:p}=l,h=[],f=d?.filter(({matchUpId:v,score:y,winningSide:b})=>{if(b&&!r)return!1;if(b||Sa({score:y})){if(!b&&!i)return!1;h.push(v)}else if(!n)return!1;return p?.includes(v)})??[],m=f.map(Na),g=f.map(({tieMatchUps:v})=>v?.map(Na)).filter(Boolean).flat();if(m.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:b})=>!m.includes(b)),Xm({tournamentId:a?.tournamentId,matchUpIds:[...g,...m],action:"deleteAdHocMatchUps",eventId:o?.eventId,drawDefinition:s});let v=Si(u.matchUps.map(Bl("roundNumber"))),y=_qe(v);if(y.length){y.reverse();for(let b of y)u.matchUps.forEach(I=>{I.roundNumber&&I.roundNumber>b&&(I.roundNumber-=1,Xi({tournamentId:a?.tournamentId,context:["adHoc round deletion"],eventId:o?.eventId,drawDefinition:s,matchUp:I}))})}if(h.length){u.positionAssignments=Si(u.matchUps.flatMap(T=>(T.sides??[]).map(U=>U.participantId)).filter(Boolean)).map(T=>({participantId:T}));let b=u?.matchUpFormat??s?.matchUpFormat??o?.matchUpFormat,I=l.existingMatchUps.some(T=>T.matchUpType===hu)?{matchUpTypes:[hu]}:void 0,{matchUps:S}=vn({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:I,structure:u,event:o});Vo({structure:u})&&(u.positionAssignments=Si(S.flatMap(T=>(T.sides??[]).map(U=>U.participantId)).filter(Boolean)).map(T=>({participantId:T})));let w=s9({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:s,matchUpFormat:b,matchUps:S,event:o});w.error&&console.log(w)}Bn({structureIds:[c],eventId:o?.eventId,drawDefinition:s})}return!m.length&&p.length?{error:m$}:{...ue,deletedMatchUpsCount:[...m,...g].length}}function x0e({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:n,roundNumber:r,event:a}){if(!e)return{error:lt};if(!i)return{error:Lt};if(!r)return pe({result:{error:Xt},info:"roundNumber required"});let s=ui({drawDefinition:i,structureId:n});if(s.error)return s;let o=s.structure;return o!=null&&o.structures?{error:Lb}:Vo({structure:o})?r7e({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:r,structure:o}):(console.log("not implemented"),{...ue})}function r7e({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:n,structure:r,eventId:a}){let s=r?.matchUps??[],o=[],l=[],u=!1;if(s.reduce((c,d)=>{let p=d?.roundNumber;return p?c.includes(p)?c:c.concat(p):c},[]).sort(ra).includes(n)){let c=s.filter(d=>{let p=d.roundNumber===n&&(!wa.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&o.push(...d.tieMatchUps.map(Na))),!p});l.length&&(Xm({matchUpIds:[...o,...l],drawDefinition:e,tournamentId:i,eventId:a}),c.some(d=>d.roundNumber===n)||(c.forEach(d=>{d.roundNumber>n&&(d.roundNumber-=1,Xi({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),u=!0),r.matchUps=c)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...ue}}function cB(t){var e,i,n,r,a,s;let{suppressNotifications:o,tournamentRecord:l,drawDefinition:u,matchUps:c,event:d}=t;if(typeof u!="object")return{error:Lt};let p=t?.structureId;if(!p&&((e=u.structures)==null?void 0:e.length)===1&&(p=(n=(i=u.structures)==null?void 0:i[0])==null?void 0:n.structureId),typeof p!="string")return{error:Tu};if(!pc(c))return{error:Ce,info:hb("matchUps")};let h=(r=u.structures)==null?void 0:r.find(y=>y.structureId===p);if(!h)return{error:pr};let f=(h?.matchUps).find(y=>!!y.roundPosition);if(h.structures||f||h.finishingPosition===A0)return{error:Lb};let m=((s=(a=Qa({tournamentRecord:l,inContext:!1}))==null?void 0:a.matchUps)==null?void 0:s.map(Na))??[],g=c.map(Na);if(yo(m,g))return{error:$ye,info:"One or more matchUpIds already present in tournamentRecord"};h.matchUps.push(...c);let v=c.map(({tieMatchUps:y})=>y).filter(Boolean).flat();return o||(sv({tournamentId:l?.tournamentId,matchUps:[...v,...c],eventId:d?.eventId,drawDefinition:u}),Bn({drawDefinition:u,structureIds:[p]})),{...ue}}function O0e({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:n,subOrder:r,event:a}){var s;if(!e)return{error:Lt};if(!n)return{error:Tu};if(!i)return{error:CD};let{structure:o}=ui({drawDefinition:e,structureId:n});if(!o)return{error:pr};let l=o;o.structures&&o.structureType===Eo&&(l=(s=o.structures)==null?void 0:s.find(f=>{var m;return(m=f.positionAssignments)==null?void 0:m.find(g=>g.drawPosition===i)}));let u=l?.positionAssignments,c=u?.find(f=>f.drawPosition===i);c&&dn({element:c,extension:{name:fU,value:r}});let d=(a?.eventType===zn||e.matchUpType===zn||(a?.tieFormat??e?.tieFormat??o?.tieFormat))&&{matchUpTypes:[zn]},{matchUps:p}=vn({structure:l,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:d,event:a}),h=o?.matchUpFormat??e.matchUpFormat;return s9({positionAssignments:u,tournamentRecord:t,drawDefinition:e,matchUpFormat:h,matchUps:p,event:a}),Bn({drawDefinition:e,structureIds:[n]}),{...ue}}var L0e={};$i(L0e,{addGoesTo:()=>pb,allPlayoffPositionsFilled:()=>W8,checkValidEntries:()=>hB,findDrawDefinition:()=>v9,getAssignedParticipantIds:()=>Yb,getAvailableMatchUpsCount:()=>dB,getAvailablePlayoffProfiles:()=>nN,getDrawDefinitionTimeItem:()=>f8,getDrawParticipantRepresentativeIds:()=>m9,getDrawStructures:()=>ud,getDrawTypeCoercion:()=>dN,getEligibleVoluntaryConsolationParticipants:()=>f9,getMatchUpsMap:()=>Cs,getParticipantIdFinishingPositions:()=>g9,getPositionAssignments:()=>r1,getPositionsPlayedOff:()=>YD,getSeedingThresholds:()=>V8,getSeedsCount:()=>pN,getStructureSeedAssignments:()=>ec,getTeamLineUp:()=>db,getValidGroupSizes:()=>QM,isAdHoc:()=>Vo,isCompletedStructure:()=>uv,isValidForQualifying:()=>I9,positionActions:()=>b9});function f9({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:n,policyDefinitions:r,roundNumberLimit:a,tournamentRecord:s,drawDefinition:o,matchUpsLimit:l,requirePlay:u,requireLoss:c,allEntries:d,winsLimit:p,event:h}){var f,m,g,v,y;if(!o)return{error:Lt};let b=[_t,Tr];i&&b.push(Kt);let I=h!=null&&h.eventType?{matchUpTypes:[h.eventType]}:void 0,S=o!=null&&o.matchUpType?{matchUpTypes:[o.matchUpType]}:void 0,w=e&&h?((f=If({contextFilters:{stages:b},matchUpFilters:I,tournamentRecord:s,inContext:!0,event:h}))==null?void 0:f.matchUps)??[]:((m=ho({contextFilters:{stages:b},matchUpFilters:S,tournamentRecord:s,inContext:!0,drawDefinition:o}))==null?void 0:m.matchUps)??[],T=x0({stage:qa,drawDefinition:o}).map(({participantId:H})=>H),U={},C={},E={},P={};r||(r=Jm({policyTypes:[CH],tournamentRecord:s,drawDefinition:o,event:h}).policyDefinitions);let M=r?.[CH];t=t.length&&t||M?.excludedMatchUpStatuses||[],e=e??M?.includeEventParticipants,d=d??M?.allEntries,n=n??M?.finishingRoundLimit,a=a??M?.roundNumberLimit,l=l??M?.matchUpsLimit,u===void 0&&(u=M?.requirePlay!==void 0?M.requirePlay:!0),c===void 0&&(c=M?.requireLoss!==void 0?M.requireLoss:!0),p=p??M?.winsLimit;for(let H of w){if(u&&H.winningSide&&![1,2].includes(H.winningSide)&&H.matchUpStatus!==jr||H.finishingRound&&n&&H.finishingRound>=n||H.finishingRound&&a&&H.finishingRound<=a)continue;let G=(g=H.sides)==null?void 0:g.find(({sideNumber:q})=>H.winningSide&&q===3-H.winningSide),W=(v=H.sides)==null?void 0:v.find(({sideNumber:q})=>H.winningSide&&q===H.winningSide);if((y=H.sides)==null||y.forEach(q=>{var Z;let K=(Z=q?.participant)==null?void 0:Z.participantId;K&&(E[K]=q.participant,H.matchUpStatus===jr&&!u&&(C[K]=q.participant,U[K]||(U[K]=0),(!H.matchUpStatus||!t.includes(H.matchUpStatus))&&(U[K]+=1)))}),G?.participant){let q=G.participant.participantId;C[q]=G.participant,U[q]||(U[q]=0),H.matchUpStatus&&!t.includes(H.matchUpStatus)&&(U[q]+=1)}if(W!=null&&W.participant){let q=W.participant.participantId;P[q]||(P[q]=0),P[q]+=1,U[q]||(U[q]=0),H.matchUpStatus&&!t.includes(H.matchUpStatus)&&(U[q]+=1)}}let R=s?.participants&&!u&&!c&&d,N=R?((e&&h?h.entries:o.entries)??[]).filter(H=>![uf,dc].includes(H.entryStatus)).map(({participantId:H})=>H):[],A=Object.keys(C),_=R?(s?.participants??[]).filter(({participantId:H})=>N.includes(H)):c&&Object.values(C)||Object.values(E),x=H=>!c||A.includes(H),O=H=>!u||(U[H]||0)>=0,$=H=>!p||(P[H]||0)<=p,F=H=>!l||U[H]<=l,j=H=>!T.includes(H);return{eligibleParticipants:_.filter(H=>x(H.participantId)&&O(H.participantId)&&$(H.participantId)&&F(H.participantId)&&j(H.participantId)).map(H=>{var G;return{...H,individualParticipants:(G=H.individualParticipantIds)==null?void 0:G.map(W=>{var q;return(q=s?.participants)==null?void 0:q.find(Z=>Z.participantId===W)})}}),losingParticipantIds:A,...ue}}function dB(t){var e,i,n,r,a,s,o,l;let u=Yt(t,[{drawDefinition:!0}]);if(u.error)return u;let{drawDefinition:c,roundNumber:d}=t,p=t.structureId??(((e=c.structures)==null?void 0:e.length)===1&&((n=(i=c.structures)==null?void 0:i[0])==null?void 0:n.structureId));if(typeof p!="string")return{error:Tu};let h=(r=c.structures)==null?void 0:r.find(w=>w.structureId===p);if(!h)return{error:pr};let f,m=(a=h.matchUps??[])==null?void 0:a.reduce((w,T)=>(T.roundPosition&&(f=!0),(T?.roundNumber||0)>w?T.roundNumber:w),0);if(h.structures||f||h.finishingPosition===A0)return{error:Lb};let g=((s=c?.entries)==null?void 0:s.filter(w=>{let T=w.entryStatus;return yd.includes(T)}))??[],v=Math.floor(g?.length/2)||1,y=d??m??1,b=((l=(o=h.matchUps)==null?void 0:o.filter(w=>w.roundNumber===y))==null?void 0:l.length)??0,I=v-b,S=I>0?I:0;return{...ue,availableMatchUpsCount:S,lastRoundNumber:m,roundMatchUpsCount:v}}function m9({drawDefinition:t}){var e;let i=ki({name:"participantRepresentatives",element:t});return i.error?i:{representativeParticipantIds:((e=i.extension)==null?void 0:e.value)||[]}}function a7e({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:Lt};let n=pa({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),r=At(n.matchUps,!1,!0),a=Si(r.reduce((o,l)=>o.concat(...l.sides.map(u=>u.participantId).filter(Boolean)),[])),s=Object.assign({},...a.map(o=>{let l=r.filter(u=>u.sides.map(c=>c.participantId).filter(Boolean).includes(o));return{[o]:l}}));return{participantIds:a,participantIdMatchUps:s}}function g9({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:Lt};let{participantIds:n,participantIdMatchUps:r}=a7e({tournamentParticipants:e?.participants,drawDefinition:i}),a=n?.map(s=>{let o=r[s].filter(d=>[kr,fn].includes(d.matchUpStatus)||d.winningSide),l=o.map(d=>{let p=d.sides.find(f=>f.bye),h=d.sides.find(f=>f.participantId===s).sideNumber;return(d.winningSide||t&&p&&h)===h?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),u=d=>Math.abs(d[0]-d[1]),c=l.reduce((d,p)=>d&&u(d)<u(p)?d:p,void 0);return{[s]:{relevantMatchUps:o,finishingPositionRanges:l,finishingPositionRange:c}}})||[];return Object.assign({},...a)}function $v({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:n}){if(!e&&!t)return{error:lt};if(!n)return{error:Xd};if(!e&&t){if(typeof i!="string"&&(i=D0e({tournamentRecords:t,drawId:n}),!i))return{error:eU};if(e=t[i],!e)return{error:lt}}let r=e&&jo({tournamentRecord:e,drawId:n});return r!=null&&r.drawDefinition?{drawDefinition:r.drawDefinition,event:r.event,tournamentRecord:e,...ue}:pe({result:{error:fu},stack:"findDrawDefinition"})}function v9(t){let{drawDefinition:e,error:i}=$v(t);return i?{error:i}:{drawDefinition:At(e)}}function HH({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:n,linkType:r}){let{links:a}=jD({drawDefinition:i,structureId:n})||{},s=(a?.target||[]).filter(({linkType:o})=>o===r).filter(({target:o})=>!t||t===o.roundNumber).map(o=>{let l=o.source.structureId,{structure:u}=ui({structureId:l,drawDefinition:i});if(!(e&&u?.finishingPosition!==e))return o}).filter(Boolean);return{sourceStructureIds:s.map(({source:o})=>o.structureId),relevantLinks:s}}function s7e({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:n,drawId:r,event:a}){var s;let o=((s=a?.entries)==null?void 0:s.filter(({entryStatus:l})=>[dc,zb].includes(l)).map(({participantId:l})=>l))||[];if(o.length){let l=n.individualParticipantIds,u=e?t.filter(({participantId:d})=>o.includes(d)):void 0,c=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:Gt({payload:{participantId:n.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:r},method:g6e,availableIndividualParticipantIds:o,availableIndividualParticipants:u,existingIndividualParticipantIds:l,existingIndividualParticipants:c,type:Z8},!1,!1,!0)}}return{}}function mb(t){var e,i,n,r,a;let{inContextDrawMatchUps:s,targetData:o,drawDefinition:l,relevantLink:u}=t;if(u?.linkCondition===qp&&((e=o?.matchUp)==null?void 0:e.matchUpStatus)===fn)return!1;let{targetMatchUps:{loserMatchUp:c,winnerMatchUp:d},targetLinks:p}=o,h=c&&Io({matchUpId:c.matchUpId,inContextDrawMatchUps:s,drawDefinition:l}),f=(i=h?.targetMatchUps)==null?void 0:i.loserMatchUp,m=(n=h?.targetMatchUps)==null?void 0:n.loserMatchUpDrawPositionIndex,g=(r=f?.sides[m])==null?void 0:r.participant,v=[Wi,ln].includes(c?.matchUpStatus)&&!g,y=((a=d?.drawPositions)==null?void 0:a.filter(Boolean).length)||0;if(c!=null&&c.winningSide&&!v||d!=null&&d.winningSide&&y===2&&(!d.feedRound||![ln,Wi].includes(d?.matchUpStatus)))return!0;let b=d&&Io({matchUpId:d.matchUpId,inContextDrawMatchUps:s,drawDefinition:l}),I=h&&mb({relevantLink:p?.loserTargetLink,targetData:h,inContextDrawMatchUps:s,drawDefinition:l});return!!(b&&mb({targetData:b,inContextDrawMatchUps:s,drawDefinition:l})||I)}var F0e={[Cm]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Kt,_t],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[n1,Mw,rB,KI],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},k_="positionAction",zH="matchUpAction";function $0e({actionType:t=k_,appliedPolicies:e,drawDefinition:i,structure:n}){var r,a;let s=t===k_&&Cm||t===zH&&Wa,o=t===k_&&F0e||t===zH&&vwe,l=s&&(e?.[s]||o?.[s]),u=((a=(r=i.links)==null?void 0:r.filter(h=>{var f;return((f=h?.target)==null?void 0:f.structureId)===n?.structureId}))==null?void 0:a.map(({target:h})=>h.feedProfile))??[],{enabledStructures:c,disabledStructures:d}=l||{},p=d?.find(h=>{let{stages:f,stageSequences:m,structureTypes:g,feedProfiles:v}=h;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>u.includes(y)))&&(!(f!=null&&f.length)||Array.isArray(f)&&f?.includes(n?.stage))&&(!(g!=null&&g.length)||Array.isArray(g)&&g?.includes(n?.structureType))&&(!(m!=null&&m.length)||Array.isArray(m)&&m.includes(n?.stageSequence))});return{enabledStructures:c,actionsDisabled:p,actionsPolicy:l}}function $Q({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function B0e({enabledStructures:t,drawDefinition:e,structure:i}){var n,r;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:a,stageSequence:s,structureType:o}=i||{},l=((r=(n=e.links)==null?void 0:n.filter(u=>{var c;return((c=u?.target)==null?void 0:c.structureId)===i?.structureId}))==null?void 0:r.map(({target:u})=>u.feedProfile))||[];return{policyActions:t.find(u=>{let{stages:c,stageSequences:d,structureTypes:p,feedProfiles:h}=u||{},f=!(c!=null&&c.length)||Array.isArray(c)&&c.includes(a),m=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(s),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(o),v=!(h!=null&&h.length)||Array.isArray(h)&&h.some(y=>l.includes(y));return m&&g&&v&&u&&f})}}function Jo({action:t,policyActions:e}){var i;let n=!(e!=null&&e.enabledActions)||((i=e?.disabledActions)==null?void 0:i.length)&&e.disabledActions.includes(t);return n?!1:(e?.enabledActions.length===0||e?.enabledActions.includes(t))&&!n}var V0e="replaceTieMatchUpParticipantId",j0e="assignTieMatchUpParticipantId",qH="removeTieMatchUpParticipantId",BQ="assignMatchUpSideParticipant",o7e="removeMatchUpSideParticipant",G0e="substituteParticipant",WH="REMOVE_SUBSTITUTION",H0e="REPLACE_PARTICIPANT",y9="REMOVE_PARTICIPANT",YH="setMatchUpStatus",KH="SUBSTITUTION",z0e="SCHEDULE",l7e="PENALTY",ZH="REFEREE",q0e="STATUS",XH="START",W0e="SCORE",JH="END",u7e={REPLACE_TEAM_POSITION_METHOD:V0e,ASSIGN_TEAM_POSITION_METHOD:j0e,REMOVE_TEAM_POSITION_METHOD:qH,REPLACE_PARTICIPANT:H0e,SUBSTITUTION_METHOD:G0e,REMOVE_SUBSTITUTION:WH,REMOVE_PARTICIPANT:y9,SCHEDULE_METHOD:YH,SUBSTITUTION:KH,SCHEDULE:z0e,PENALTY:l7e,REFEREE:ZH,STATUS:q0e,SCORE:W0e,START:XH,END:JH};function c7e({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:n,inContextMatchUp:r,policyActions:a,enforceGender:s,participantId:o,sideNumber:l,matchUpId:u,matchUp:c,drawId:d,side:p}){var h,f,m,g,v,y,b,I,S,w,T,U,C,E,P;let M=[],R=(h=r.sides)==null?void 0:h.find(J=>J.participant),N=r.gender===ko&&r.sideNumber&&((f=r.sides)==null?void 0:f.filter(J=>J.particiapntId).length)===1&&((g=(m=R?.participant)==null?void 0:m.person)==null?void 0:g.sex),A=r.matchUpType,_=(s??((v=n?.participants)==null?void 0:v.enforceGender))!==!1?r.gender:void 0,x=(b=(y=r.sides)==null?void 0:y.flatMap(J=>{var ne;return((ne=J.participant)==null?void 0:ne.individualParticipants)||J.participant}).filter(Boolean))==null?void 0:b.map(Gi),O=(I=r.sides)==null?void 0:I.filter(J=>!l||J.sideNumber===l).flatMap(J=>{var ne;return((ne=J.participant)==null?void 0:ne.individualParticipants)||J.participant}).filter(Boolean),$=O?.map(Gi),F=(w=(S=e?.find(J=>J.matchUpId===r.matchUpTieId))==null?void 0:S.sides)==null?void 0:w.map(J=>{var ne,re;return(re=(ne=J?.participant)==null?void 0:ne.individualParticipants)==null?void 0:re.filter(({participantId:oe,person:de})=>!($!=null&&$.includes(oe))&&(!_||_===qd||de.sex===_||_===ko&&!N||N&&de.sex!==N))}),j=l?F?.[l-1]:F?.map((J,ne)=>({participants:J,sideNumber:ne+1})),H=l?(T=F?.[l-1])==null?void 0:T.map(Gi):F?.map((J,ne)=>({participants:J?.map(Gi),sideNumber:ne+1})),G=l&&(xr(zI)(A)&&!($!=null&&$.length)||xr(nb)(A)&&($?.length??0)<2)||!l&&(xr(zI)(A)&&($?.length??0)<2||xr(nb)(A)&&($?.length??0)<4),W=H?.filter(J=>!(x!=null&&x.includes(J))),q=j?.filter(({participantId:J})=>W.includes(J));if(G&&W!=null&&W.length&&M.push({availableParticipantIds:W,method:j0e,availableParticipants:q,type:Rw,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:d}}),$!=null&&$.length&&(!Sa(c)||(U=p?.substitutions)!=null&&U.length)&&M.push({method:qH,type:y9,existingParticipantIds:$,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),q!=null&&q.length&&(!l&&$!=null&&$.length||l&&p!=null&&p.participant)&&M.push({availableParticipantIds:W,method:V0e,availableParticipants:q,type:H0e,existingParticipantIds:$,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),Jo({policyActions:a,action:WH})&&((C=p?.substitutions)==null?void 0:C.length)){let J=((E=p.participant)==null?void 0:E.participantType)===Hi&&[p.participantId]||((P=p.participant)==null?void 0:P.participantType)===Ai&&p.participant.individualParticipantIds||[],ne=p.substitutions.map(re=>re.participantId).filter(re=>J.includes(re));(!o||ne.includes(o))&&M.push({method:qH,type:WH,substitutedParticipantIds:ne,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let Z=t?.[Wa],K=Z?.substituteWithoutScore,Q=Z?.substituteAfterCompleted;if(Jo({policyActions:a,action:KH})&&i.length===2&&(!l&&$!=null&&$.length||l&&p!=null&&p.participant)&&(K||Sa(c))&&(Q||c.matchUpStatus&&!wa.includes(c.matchUpStatus))&&O!=null&&O.length&&j.length){let J=O.map(Gi);M.push({info:"list of team players available for substitution",method:G0e,availableParticipantIds:H,existingParticipantIds:J,availableParticipants:j,existingParticipants:O,type:KH,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:d}})}return M}function d7e({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:n,returnParticipants:r,appliedPolicies:a,drawDefinition:s,drawPosition:o,validActions:l,structureId:u,structure:c,drawId:d,event:p}){var h,f,m,g,v;if(i.includes(o))return{};let y=(h=l.find(M=>M.type===Rw))==null?void 0:h.availableParticipantIds,b=(f=a?.[Cm])==null?void 0:f.otherFlightEntries,I=(m=a?.[Cm])==null?void 0:m.restrictQualifyingAlternates,S=(s.entries??[]).filter(({entryStage:M})=>!I||(c.stage===Kt?M===Kt:M!==Kt)).sort((M,R)=>(M.entryPosition??1/0)-(R.entryPosition??1/0)).map(({participantId:M})=>M).filter(Boolean),{allPositionedParticipantIds:w}=UIe({drawDefinition:s}),T=n.map(M=>M.participantId).filter(Boolean),U=S.filter(M=>c.stage&&[Kt,_t,Tr].includes(c.stage)?!(w!=null&&w.includes(M)):!T.includes(M)),C=(p?.entries??[]).filter(M=>M.entryStatus===Xc&&Y0e({restrictQualifyingAlternates:I,structure:c,entry:M})&&(c.stage&&[Kt,_t,Tr].includes(c.stage)?!(w!=null&&w.includes(M.participantId)):!T.includes(M.participantId))).sort((M,R)=>(M.entryPosition??1/0)-(R.entryPosition??1/0)).map(M=>M.participantId),E=Si(U.concat(C));if(b){let M=(v=(g=p?Rr({event:p}).flightProfile:void 0)==null?void 0:g.flights)==null?void 0:v.filter(R=>R.drawId!==d).map(R=>R.drawEntries.filter(N=>N.participantId&&![uf,dc,zb].includes(N.entryStatus)&&!S.includes(N.participantId)).map(({participantId:N})=>N)).flat().filter(Boolean);M!=null&&M.length&&E.push(...M)}y!=null&&y.length&&(E=E.filter(M=>!y.includes(M)));let P=r?t?.filter(M=>E.includes(M.participantId)):void 0;return P?.forEach(M=>{let R=(s.entries??[]).find(N=>N.participantId===M.participantId);M.entryPosition=R?.entryPosition}),P?.sort((M,R)=>(M.entryPosition||1/0)-(R.entryPosition||1/0)),E.length?{validAlternatesAction:Gt({payload:{drawId:d,structureId:u,drawPosition:o},willDisableLinks:e,method:f6e,availableAlternatesParticipantIds:E,type:X8,availableAlternates:P})}:{}}function Y0e({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:n}=e;if(!i.entryStage||i.entryStage===n||n===Kt&&!t||i.entryStage===_t&&n===Ds)return!0}function p7e({eventEntries:t,structure:e}){let i=r=>r.entryStatus===Xc&&Y0e({structure:e,entry:r}),n=(r,a)=>(r.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(n).map(Gi)}function h7e({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:n,drawDefinition:r,structureId:a,sideNumber:s,matchUpId:o,structure:l,matchUp:u,drawId:c,event:d}){var p,h,f,m,g,v,y;let b=[],I=l?.matchUps??[],S=(h=(p=u.sides)==null?void 0:p.find(A=>A.sideNumber===s))==null?void 0:h.participantId,w=I.filter(({roundNumber:A})=>A===u.roundNumber),T=((f=r?.entries)==null?void 0:f.filter(({entryStatus:A})=>A&&qb.includes(A)).map(Gi))??[],U=w.map(A=>(A.sides??[]).flatMap(Gi)).flat().filter(Boolean),C=T.filter(A=>!i.includes(A)&&(!t||!U.includes(A))),E=e?.filter(A=>C?.includes(A.participantId)).map(A=>At(A,void 0,!0));E?.forEach(A=>{let _=(r.entries??[]).find(x=>x.participantId===A.participantId);A.entryPosition=_?.entryPosition}),C.length&&b.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},method:BQ,type:Rw,availableParticipantIds:C,participantsAvailable:E});let P=d?.entries??[],M=p7e({eventEntries:P,structure:l}),R=Si(T.concat(M));if(n){let A=(g=(m=d?Rr({event:d}):void 0)==null?void 0:m.flights)==null?void 0:g.filter(_=>_.drawId!==c).flatMap(_=>_.drawEntries.filter(x=>x.participantId&&![uf,dc,zb].includes(x.entryStatus)).map(({participantId:x})=>x)).filter(Boolean);A!=null&&A.length&&R.push(...A)}R=R.filter(A=>!i.includes(A)&&!C.includes(A)&&(!t||!U.includes(A)));let N=e?.filter(A=>R.includes(A.participantId)).map(A=>At(A,void 0,!0));if(N?.forEach(A=>{let _=(r.entries??[]).find(x=>x.participantId===A.participantId);A.entryPosition=_?.entryPosition}),N?.sort((A,_)=>(A.entryPosition||1/0)-(_.entryPosition||1/0)),R.length&&b.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},availableParticipantIds:R,participantsAvailable:N,method:BQ,type:Xc}),!Sa(u)&&s&&S){b.push({payload:{drawId:c,matchUpId:o,structureId:a,sideNumber:s},method:o7e,type:y9});let A=G=>G.sides.map(Gi),_=({matchUpId:G})=>G!==u.matchUpId,x=G=>!Sa(G),O=(y=(v=u.sides)==null?void 0:v.find(G=>G.sideNumber!==s))==null?void 0:y.participantId,$=I.filter(({roundNumber:G})=>G!==u.roundNumber).filter(_).map(A),F=[O,...$.filter(G=>G.includes(S)).flat()].filter(Boolean),j=G=>!F.flat().includes(G),H=w.filter(x).filter(_).map(A).flat().filter(j);if(H.length){let G=e?.filter(W=>H.includes(W.participantId)).map(W=>At(W,void 0,!0));b.push({payload:{participantIds:[S],roundNumber:u.roundNumber,structureId:a,sideNumber:s,matchUpId:o,drawId:c},swappableParticipantIds:H,method:v6e,type:aB,swappableParticipants:G})}}return b}function pB(t){var e,i,n,r,a,s,o,l,u;if(!t)return{error:Ce};let{drawDefinition:c,event:d}=t,{restrictAdHocRoundParticipants:p=!0,policyDefinitions:h,enforceGender:f,participantId:m,sideNumber:g,matchUpId:v}=t,y=t.tournamentRecord??(t.tournamentId&&nr(t.tournamentId)&&((e=t.tournamentRecords)==null?void 0:e[t.tournamentId]));if(!y)return{error:lt};if(!v||!nr(v))return{error:to};if(g&&![1,2].includes(g))return pe({result:{error:Ce},context:{sideNumber:g}});if(!c){let De=(Qa({tournamentRecord:y}).matchUps??[]).find(Me=>Me.matchUpId===v);d=(y?.events??[]).find(Me=>Me.eventId===De?.eventId);let xe=(d?.drawDefinitions??[]).find(Me=>Me.drawId===De?.drawId);xe&&(c=xe)}if(!c)return{error:Lt};let b=hr({withIndividualParticipants:!0,tournamentRecord:y}).participants,{drawId:I}=c,{matchUp:S,structure:w}=tr({drawDefinition:c,matchUpId:v,event:d});if(!S)return{error:Gs};let T=pn({tournamentRecord:y,drawDefinition:c,structure:w,event:d}).appliedPolicies??{};Object.assign(T,h??{});let U=(i=T?.[Cm])==null?void 0:i.otherFlightEntries,C=T?.[Wa]??zD[Wa],{enabledStructures:E}=$0e({actionType:zH,appliedPolicies:T,drawDefinition:c,structure:w}),{policyActions:P}=B0e({enabledStructures:E,drawDefinition:c,structure:w}),M=t.matchUpsMap??Cs({drawDefinition:c}),R=t.inContextDrawMatchUps??pa({tournamentParticipants:b,inContext:!0,drawDefinition:c,matchUpsMap:M,event:d}).matchUps,N=R?.find(De=>De.matchUpId===v),A=g&&((n=N?.sides)==null?void 0:n.find(De=>De.sideNumber===g)),_=((r=N?.sides)==null?void 0:r.map(De=>{var xe;return De.participantId||((xe=De.participant)==null?void 0:xe.participantid)}).filter(Boolean))??[],{assignedPositions:x,allPositionsAssigned:O}=xa({structure:w}),{structureId:$}=w??{},F=[];if(!$)return{validActions:F};let j=Vo({structure:w}),H=S.collectionId;if(j&&!H){let De=h7e({restrictAdHocRoundParticipants:p,tournamentParticipants:b,matchUpParticipantIds:_,otherFlightEntries:U,drawDefinition:c,structureId:$,sideNumber:g,matchUpId:v,structure:w,matchUp:S,drawId:I,event:d});F.push(...De)}let G=uv({drawDefinition:c,structure:w}),W=x?.filter(De=>De.participantId).map(De=>De.drawPosition),q=x?.filter(De=>De.bye).map(De=>De.drawPosition),Z=S.matchUpStatus===fn||!H&&((a=S.drawPositions)==null?void 0:a.reduce((De,xe)=>q?.includes(xe)||De,!1));if(Z)return{validActions:F,isByeMatchUp:Z};Jo({policyActions:P,action:ZH})&&F.push({type:ZH,payload:{matchUpId:v}});let K=!qM({matchUpStatus:S.matchUpStatus}),Q=(s=T?.scoring)==null?void 0:s.structures,J=w?.stage&&Q?.stage&&Q?.stage[w.stage],ne=w?.stageSequence&&J?.stageSequence&&J.stageSequence[w.stageSequence],re=!((o=T?.scoring)!=null&&o.requireAllPositionsAssigned||J!=null&&J.requireAllPositionsAssigned||ne!=null&&ne.requireAllPositionsAssigned)||O,oe=S.sides&&S.sides.filter(De=>De?.participantId).length===2,de=S.matchUpStatus&&[jr,oa].includes(S.matchUpStatus),se=Io({inContextDrawMatchUps:R,drawDefinition:c,matchUpId:v}),ge=mb({inContextDrawMatchUps:R,drawDefinition:c,targetData:se}),ye=(((l=N?.drawPositions)==null?void 0:l.length)===2&&N.drawPositions.every(De=>W?.includes(De))&&((u=N?.sides)==null?void 0:u.length)===2&&N.sides.every(({participantId:De})=>De)||oe)&&!(de&&ge),Te={method:t0e,type:Mw,payload:{drawId:I,matchUpId:v,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(K&&F.push({payload:{drawId:I,matchUpId:v,schedule:{}},method:YH,type:z0e}),Jo({policyActions:P,action:Mw})&&(A!=null&&A.participant||!g&&_!=null&&_.length)&&F.push(Te),K&&ye&&F.push({type:q0e}),re&&ye){let{matchUpId:De,matchUpFormat:xe}=S,Me={drawId:I,matchUpId:De,matchUpFormat:xe,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};F.push({info:"set outcome and winningSide",method:YH,type:W0e,payload:Me}),Jo({policyActions:P,action:XH})&&F.push({type:XH}),Jo({policyActions:P,action:JH})&&F.push({type:JH})}if(H&&N){let De=c7e({specifiedPolicyDefinitions:h,inContextDrawMatchUps:R,matchUpParticipantIds:_,matchUpActionsPolicy:C,inContextMatchUp:N,policyActions:P,enforceGender:f,participantId:m,sideNumber:g,matchUpId:v,matchUp:S,drawId:I,side:A});F.push(...De)}return{structureIsComplete:G,validActions:F,isDoubleExit:de,...ue}}function f7e({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:n,activeDrawPositions:r,positionAssignments:a,drawDefinition:s,drawPosition:o,structureId:l,structure:u,drawId:c,event:d}){var p,h,f,m,g,v,y;if(r.includes(o)||n&&!e)return{};let{sourceStructureIds:b,targetStructureIds:I}=((p=s.links)==null?void 0:p.reduce((U,C)=>{var E,P;let M=(E=C.source)==null?void 0:E.structureId,R=(P=C.target)==null?void 0:P.structureId;return U.sourceStructureIds.includes(M)||U.sourceStructureIds.push(M),U.targetStructureIds.includes(R)||U.targetStructureIds.push(R),U},{sourceStructureIds:[],targetStructureIds:[]}))||{},S=[],w=((h=s.links)==null?void 0:h.filter(U=>{var C;return((C=U.target)==null?void 0:C.structureId)===u.structureId}))??[];for(let U of w){let C=(f=U?.source)==null?void 0:f.structureId,{structure:E}=ui({structureId:C,drawDefinition:s}),P=E?.finishingPosition===A0&&(b?.length!==1||I?.length!==1),M={};if(P){let{matchUps:A}=vn({drawDefinition:s,structure:u,event:d}),{initialRoundNumber:_}=Cw({drawPosition:o,matchUps:A}),x=(v=(g=(m=s.links)==null?void 0:m.find(O=>{var $;return(($=O.target)==null?void 0:$.structureId)===u?.structureId&&O.target.roundNumber===_}))==null?void 0:g.source)==null?void 0:v.roundNumber;M.roundNumbers=[x]}let{completedMatchUps:R}=X$({structureId:C,inContext:!0,matchUpFilters:M,drawDefinition:s}),N=a.map(A=>A.participantId).filter(Boolean);(y=R?.filter(({matchUpType:A,winningSide:_})=>_&&(d?.eventType!==aa||A===aa)).map(({winningSide:A,sides:_})=>A&&_?.[1-(A-1)]).map(Gi).filter(A=>A&&!N.includes(A)))==null||y.forEach(A=>{S.includes(A)||S.push(A)})}let T=t?.filter(U=>S?.includes(U.participantId));return T?.forEach(U=>{let C=(s.entries??[]).find(E=>E.participantId===U.participantId);U.entryPosition=C?.entryPosition}),S!=null&&S.length?{validLuckyLosersAction:{type:Q8,method:m6e,availableLuckyLosers:T,availableLuckyLoserParticipantIds:S,willDisableLinks:i,payload:{drawId:c,structureId:l,drawPosition:o}}}:{}}function m7e({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:n,tournamentParticipants:r,isWinRatioFedStructure:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:u,seedingProfile:c,isByePosition:d,drawPosition:p,structureId:h,event:f}){var m,g,v;let{drawId:y}=u,b=[],I,S,w=[],T=(g=(m=l?.[Rc])==null?void 0:m.validSeedPositions)==null?void 0:g.ignore;if(T||({unplacedSeedParticipantIds:I,unplacedSeedAssignments:S,unfilledPositions:w}=Mwe({provisionalPositioning:n,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:c,structureId:h})),w!=null&&w.length||(w=s.filter(U=>!U.participantId&&!U.bye&&!U.qualifier).map(U=>U.drawPosition)),d||b.push({payload:{drawId:y,structureId:h,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:I6e,type:Tx}),a&&T){let U=s.map(R=>R.participantId).filter(Boolean),C={structureIds:t},{completedMatchUps:E}=GD({inContext:!0,matchUpFilters:C,drawDefinition:u}),P=Si((v=(E??[]).filter(({matchUpType:R})=>f?.eventType!==aa||R===aa))==null?void 0:v.map(({sides:R})=>R?.map(Gi)).flat().filter(R=>R&&!U.includes(R))),M=o?r?.filter(R=>P?.includes(R.participantId)).map(R=>At(R,void 0,!0)):void 0;return M?.forEach(R=>{let N=(u.entries??[]).find(A=>A.participantId===R.participantId);R.entryPosition=N?.entryPosition}),M!=null&&M.length&&b.push(Gt({payload:{drawId:y,structureId:h,drawPosition:p},willDisableLinks:i,method:NQ,type:Rw,availableParticipantIds:P,participantsAvailable:M})),{validAssignmentActions:b}}if(w.includes(p)||d){let U;if(S!=null&&S.length){let E=S.filter(P=>I?.includes(P.participantId));E.sort(g7e),U=E.map(P=>P.participantId)}else U=e;let C=o?r?.filter(E=>U.includes(E.participantId)).map(E=>At(E,void 0,!0)):void 0;C!=null&&C.length&&b.push(Gt({payload:{drawId:y,structureId:h,drawPosition:p},willDisableLinks:i,method:NQ,type:Rw,availableParticipantIds:U,participantsAvailable:C}))}return{validAssignmentActions:b}}function g7e(t,e){return t.bye||vU(t.seedValue)<vU(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function v7e({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:n,appliedPolicies:r,drawDefinition:a,drawPosition:s,structureId:o,drawId:l}){var u,c,d;let p=[],h=[],f=[],m=[],g=i.map(U=>U.participantId).filter(Boolean),v=r?.[Cm],y=!(v!=null&&v.disableRoundRestrictions)&&t[s],b=v?.requireCompletedStructures,{sourceStructureIds:I,relevantLinks:S}=HH({targetRoundNumber:y,linkType:Pm,drawDefinition:a,structureId:o})||{};I!=null&&I.length&&m.push(...I);let{sourceStructureIds:w,relevantLinks:T}=HH({targetRoundNumber:y,linkType:Em,drawDefinition:a,structureId:o})||{};w!=null&&w.length&&m.push(...w);for(let U of S){let C=(u=a.structures)==null?void 0:u.find(P=>P.structureId===U.source.structureId);if(C?.stage!==Kt)continue;let E=uv({structureId:U.source.structureId,drawDefinition:a});if(!b||E){let P=C.qualifyingRoundNumber,{matchUps:M}=vn({matchUpFilters:{roundNumbers:[P],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:C});for(let R of M){let N=R.sides.find(_=>_?.sideNumber===R.winningSide),A=R.matchUpStatus===fn&&((c=R.sides)==null?void 0:c.find(({participantId:_})=>_));if(N||A){let{participantId:_,participant:x}=N||A||{};_&&!g.includes(_)&&(x&&n&&p.push(x),h.push(_))}}}}for(let U of T){let C=(d=a.structures)==null?void 0:d.find(P=>P.structureId===U.source.structureId);if(C?.stage!==Kt)continue;let E=uv({structureId:U.source.structureId,drawDefinition:a});if(!b||E){let{positionAssignments:P}=Fn({structure:C}),M=P?.map(R=>{var N;let A=R.participantId,_=(N=ki({element:R,name:rv}).extension)==null?void 0:N.value;return _?{participantId:A,groupOrder:_?.groupOrder}:{}}).filter(({groupOrder:R,participantId:N})=>R===1&&!g.includes(N)).map(({participantId:R})=>R)??[];if(M&&h.push(...M),n){let R=e.filter(({participantId:N})=>M.includes(N));p.push(...R)}}}return h.length&&f.push(Gt({qualifyingParticipants:n?p:void 0,method:p6e,type:rB,qualifyingParticipantIds:h,payload:{qualifyingParticipantId:void 0,drawPosition:s,structureId:o,drawId:l}})),{validAssignmentActions:f,sourceStructureIds:m}}function y7e({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:n,activeDrawPositions:r,positionAssignments:a,returnParticipants:s,byeDrawPositions:o,drawDefinition:l,isByePosition:u,drawPosition:c,structureId:d,structure:p,drawId:h,event:f}){if(r.includes(c))return{};let m=E=>!t||E.participantId||E.qualifier||E.bye,g=n?.filter(E=>E!==c&&!(u&&o.includes(E))),v=a?.filter(E=>m(E)&&g?.includes(E.drawPosition))??[],y=v.map(({drawPosition:E})=>E),{matchUps:b}=vn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:f}),I=b.filter(({drawPositions:E})=>yo(E,y)),S=Object.assign({},...I.map(E=>{var P;return(P=E.sides)==null?void 0:P.filter(({sourceDrawPositionRange:M})=>M).map(({drawPosition:M,sourceDrawPositionRange:R})=>({[M]:R}))}).flat()),w=v.map(E=>E.participantId).filter(Boolean),T=(i??[]).filter(E=>w.includes(E.participantId)),U=Object.assign({},...T.map(E=>({[E.participantId]:E}))),C=v.map(E=>{let P=U?.[E.participantId],M=S[E.drawPosition];return Gt({...E,participant:s?At(P,!1,!0):void 0,sourceDrawPositionRange:M})});return C.length?{validSwapAction:{payload:{drawId:h,structureId:d,drawPositions:[c]},willDisableLinks:e,method:e0e,type:aB,availableAssignments:C}}:{}}function b9(t){var e;let i=Yt(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(i.error)return i;let{policyDefinitions:n,returnParticipants:r=!0,provisionalPositioning:a,tournamentRecord:s,drawDefinition:o,drawPosition:l,event:u}=t,c=t.tournamentParticipants??(s&&hr({withIndividualParticipants:!0,tournamentRecord:s}).participants)??[],d=ui({structureId:t.structureId,drawDefinition:o});if(d.error)return d;let p=d.containingStructure||d.structure;if(!p)return{error:pr};let h=p.structureId;if(d=WM({drawDefinition:o,structureId:h}),l===void 0&&!d.isAdHoc)return{error:CD};if(d.isAdHoc)return pB(t);if(d.error)return d;let{drawPositionInitialRounds:f,inactiveDrawPositions:m,activeDrawPositions:g,byeDrawPositions:v}=d,y=pn({tournamentRecord:s,drawDefinition:o,structure:p,event:u}).appliedPolicies??{};Object.assign(y,n??{});let{actionsPolicy:b,enabledStructures:I,actionsDisabled:S}=$0e({actionType:k_,appliedPolicies:y,drawDefinition:o,structure:p}),w=b?.activePositionOverrides||[],{sourceStructureIds:T}=HH({finishingPosition:ob,targetRoundNumber:1,linkType:Em,drawDefinition:o,structureId:h})||{},U;T!=null&&T.length&&(U=T.every(J=>uv({structureId:J,drawDefinition:o})));let C=T.length,E=T.length&&!U,{policyActions:P}=B0e({enabledStructures:I,drawDefinition:o,structure:p}),M=![Kt,_t].includes(p.stage)||p.stageSequence!==1,{drawId:R}=o,N=[],{assignedPositions:A,positionAssignments:_}=xa({structure:p}),x=A?.find(J=>J.drawPosition===l),O=!!x;if(!((e=_?.map(J=>J.drawPosition))!=null&&e.includes(l)))return{error:PD};let{stage:$,stageSequence:F}=p,j=[$];$===Ds&&j.push(_t),$===_t&&j.push(Ds);let H=x0({entryStatuses:qb,provisionalPositioning:a,drawDefinition:o,stageSequence:F,structureId:h,stages:j}),G=Yb({drawDefinition:o,stages:j}).assignedParticipantIds??[],W=H.filter(J=>!G.includes(J.participantId)).map(J=>J.participantId),q=v.includes(l),Z=g.includes(l);if(S)return{info:"Actions Disabled for structure",isActiveDrawPosition:Z,isDrawPosition:!0,hasPositionAssigned:O,validActions:[],isByePosition:q};if(Jo({policyActions:P,action:Rw})&&!Z&&_&&!E&&(!x||q)){let{validAssignmentActions:J}=m7e({positionSourceStructureIds:T,unassignedParticipantIds:W,possiblyDisablingAction:M,isWinRatioFedStructure:C,tournamentParticipants:c,positionAssignments:_,returnParticipants:r,appliedPolicies:y,drawDefinition:o,isByePosition:q,drawPosition:l,structureId:h,event:u});J?.forEach(ne=>N.push(ne))}if(Jo({policyActions:P,action:rB})&&!Z){let{validAssignmentActions:J}=v7e({drawPositionInitialRounds:f,tournamentParticipants:c,positionAssignments:_,returnParticipants:r,appliedPolicies:y,drawDefinition:o,drawPosition:l,structureId:h,drawId:R});J?.forEach(ne=>N.push(ne))}let{participantId:K}=x||{},Q=K&&c.find(J=>J.participantId===K);if(x){Jo({policyActions:P,action:GH})&&!Z&&(N.push({type:GH,method:MQ,payload:{drawId:R,structureId:h,drawPosition:l},willDisableLinks:M}),q||N.push({type:J8,method:h6e,payload:{drawId:R,structureId:h,drawPosition:l},willDisableLinks:M}),Jo({policyActions:P,action:Tx})&&!q&&N.push({type:Tx,method:MQ,payload:{drawId:R,structureId:h,drawPosition:l,replaceWithBye:!0},willDisableLinks:M}));let J=p.stage===Kt||p.stage===_t&&p.stageSequence===1;if(!q&&$Q({activePositionOverrides:w,activeDrawPositions:g,action:KI})&&Jo({policyActions:P,action:KI})&&Ix({drawDefinition:o,structureId:h,drawPosition:l})&&J){let{seedAssignments:ne}=ec({returnAllProxies:!0,drawDefinition:o,structure:p}),{seedNumber:re,seedValue:oe}=ne?.find(de=>de.participantId===K)??{};N.push({type:KI,method:w6e,participant:Q,seedNumber:re,payload:{drawId:R,structureId:h,participantId:K,seedValue:oe}})}if(!q&&$Q({activePositionOverrides:w,activeDrawPositions:g,action:NP})&&Jo({policyActions:P,action:NP})&&Ix({drawDefinition:o,structureId:h,drawPosition:l})&&J){let{seedAssignments:ne}=ec({returnAllProxies:!0,drawDefinition:o,structure:p}),{seedNumber:re}=ne?.find(oe=>oe.participantId===K)??{};N.push({method:b6e,type:NP,participant:Q,seedNumber:re,payload:{participantId:K,structureId:h,drawId:R}})}if(!q&&K){if(Jo({policyActions:P,action:Mw})){let ne={type:Mw,method:t0e,participant:Q,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:R}};N.push(ne)}if(Jo({policyActions:P,action:n1})){let ne={type:n1,method:y6e,participant:Q,payload:{participantId:K,otherName:void 0}};N.push(ne)}}if(Jo({policyActions:P,action:aB})){let{validSwapAction:ne}=y7e({possiblyDisablingAction:M,tournamentParticipants:c,inactiveDrawPositions:m,activeDrawPositions:g,positionAssignments:_,returnParticipants:r,byeDrawPositions:v,drawDefinition:o,isByePosition:q,drawPosition:l,structureId:h,structure:p,drawId:R});ne&&N.push(ne)}}if(Jo({policyActions:P,action:X8})&&!E){let{validAlternatesAction:J}=d7e({possiblyDisablingAction:M,tournamentParticipants:c,positionAssignments:_,activeDrawPositions:g,returnParticipants:r,appliedPolicies:y,drawDefinition:o,drawPosition:l,validActions:N,structureId:h,structure:p,drawId:R,event:u});J&&N.push(J)}if(Jo({policyActions:P,action:Q8})&&!E&&!Z&&_){let{validLuckyLosersAction:J}=f7e({sourceStructuresComplete:U,possiblyDisablingAction:M,isWinRatioFedStructure:C,tournamentParticipants:c,activeDrawPositions:g,positionAssignments:_,drawDefinition:o,drawPosition:l,structureId:h,structure:p,drawId:R});J&&N.push(J)}if(Q?.participantType===Ai&&Jo({policyActions:P,action:Z8})){let{validModifyAssignedPairAction:J}=s7e({tournamentParticipants:c,returnParticipants:r,drawPosition:l,participant:Q,drawId:R,event:u});J&&N.push(J)}return{isActiveDrawPosition:Z,isDrawPosition:!0,hasPositionAssigned:O,isByePosition:q,validActions:N,...ue}}function dN({policyDefinitions:t,appliedPolicies:e,drawType:i}){var n,r;let a=(n=t?.[dx])==null?void 0:n.drawTypeCoercion,s=(r=e?.[dx])==null?void 0:r.drawTypeCoercion;return(typeof a=="boolean"?a:void 0)??(i&&a?.[i])??(typeof s=="boolean"?s:void 0)??(i&&s?.[i])??!0}function r1({tournamentRecord:t,drawDefinition:e,stage:i=_t,structureId:n,structure:r}){var a;if(!t)return{error:lt};if(!r&&!e)return{error:Lt};if(!r&&!n&&((a=e?.structures)==null?void 0:a.filter(l=>l.stage===i).length)===1&&(r=e.structures.find(l=>l.stage===i)),!r&&!n)return{error:Tu};let{error:s,positionAssignments:o}=Fn({drawDefinition:e,structureId:n,structure:r});return{positionAssignments:o??[],structureId:r?.structureId,error:s}}function I9({structureId:t,drawDefinition:e}){if(!e)return{error:Lt};if(!nr(t))return{error:Ce};let i=jD({drawDefinition:e,structureId:t});if(i.error)return i;let n=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),r=!Pr([sb,Oc,U$,ab],n).length;return{...ue,valid:r}}function K0e({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:Ce};let i=ED(t);return i?{drawSize:i}:pe({result:{error:Ce},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function pN(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:n}=t||{},{requireParticipantCount:r=!0,tournamentRecord:a,drawDefinition:s,event:o}=t||{},l="getSeedsCount",u=t?.participantsCount??t?.participantCount;if(!i){let f=Jm({tournamentRecord:a,drawDefinition:s,event:o});if(f.error)return pe({result:f,stack:l});i=f.policyDefinitions}let c=bi(u);if(u&&!c)return pe({result:{error:Ce},context:{participantsCount:u},stack:l});if(r&&!c)return pe({result:{error:mye},stack:l});if(isNaN(n))if(u)({drawSize:n}=K0e({participantsCount:u}));else return pe({result:{error:gM},stack:l});let d=r&&u||n;if(d&&d>n)return{error:l7};let p=i?.[Rc];if(!p)return{error:nye};let h=p.seedsCountThresholds;return h?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:h.filter(f=>e?f.drawSize<=n:n===f.drawSize).reduce((f,m)=>u&&u>=m.minimumParticipantCount?m.seedsCount:f,0)}):{error:Vve}}function hB({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:n,participantMap:r,enforceGender:a,participants:s,event:o}){var l;if((!s||!r)&&i&&({participants:s,participantMap:r}=hr({tournamentRecord:i})),!s)return{error:yM};if(!Array.isArray(s))return{error:Ce};if(!o)return{error:Wn};let u=e?.[Wa]??n?.[Wa]??zD[Wa],c=(a??((l=u?.participants)==null?void 0:l.enforceGender))!==!1,{eventType:d,gender:p}=o,h=d===Dm,f=d===Fl&&Sn||h&&Ai||Hi,m=Object.assign({},...(t??o.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),g=Object.keys(m),v=s.filter(y=>g.includes(y.participantId)).filter(y=>{let b=b7e({participant:y,participantType:f,eventType:d,entryStatusMap:m}),I=I7e({genderEnforced:c,participantMap:r,eventGender:p,participant:y,isDoubles:h,mismatch:b});return b||!I});if(v.length){let y=v.map(b=>b.participantId);return{error:Zve,invalidParticipantIds:y}}return{...ue,valid:!0}}function b7e({participant:t,participantType:e,eventType:i,entryStatusMap:n}){let r=n[t.participantId],a=i&&[Dm,Fl].includes(i)&&t.participantType===Hi&&(py(r)||r===uf);return t.participantType!==e&&!a}function I7e(t){var e,i,n;let{participant:r,participantMap:a,eventGender:s,mismatch:o,isDoubles:l,genderEnforced:u}=t,c=!o&&l&&Si(((e=r?.individualParticipantIds)==null?void 0:e.map(f=>{var m,g,v;return(v=(g=(m=a?.[f])==null?void 0:m.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],d=!s||!(c!=null&&c.length)||qd===s||[Un,Gn].includes(s)&&c[0]===s||ko===s&&(c.length===1&&((i=r.individualParticipantIds)==null?void 0:i.length)===1||c.length===2),p=(n=r?.person)==null?void 0:n.sex,h=!(r!=null&&r.person)||!s||[qd,ko].includes(s)||[Un,Gn].includes(s)&&p===s;return!u||d&&h}function Z0e({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:n,uuids:r}){var a;let s="generateQualifyingSTructures",o=[],l=[],u=[],c=(g,v)=>g.stageSequence-v.stageSequence,d=(g,v)=>g.roundTarget-v.roundTarget,p=0,h=0,f,m=1;for(let g of t.sort(d)){let v=g.structureProfiles||[];m=g.roundTarget||m;let y=1,b=0,I,S,w;for(let T of(v||[]).sort(c)){let U=q6(T.drawSize||T.participantsCount),{qualifyingRoundNumber:C,structureOptions:E,matchUpFormat:P,structureName:M,structureId:R,drawType:N}=T,A=T.matchUpType,_=T.qualifyingPositions||w7e({drawSize:U,qualifyingRoundNumber:C}),x,O,$;if(!bi(U))return pe({result:{error:gM},stack:s});let F=t.length>1?`${m}-`:"",j=v.length>1||F?y:"",H=M||(F||j?`${Ss(Kt)} ${F}${j}`:Ss(Kt));if(N===od){let{structures:G,groupCount:W,maxRoundNumber:q}=JM({structureName:T.structureName||H,structureId:R||r?.pop(),stage:Kt,structureOptions:E,appliedPolicies:e,stageSequence:y,matchUpType:A,roundTarget:m,drawSize:U,idPrefix:i,isMock:n,uuids:r});b=W,x=q,O=G[0],f=[1]}else({drawSize:U,matchUps:$,roundLimit:x}=Kp({qualifyingRoundNumber:C,qualifyingPositions:_,matchUpType:A,drawSize:U,idPrefix:i,isMock:n,uuids:r})),O=Gu({structureName:T.structureName||H,structureId:R||r?.pop(),qualifyingRoundNumber:x,stage:Kt,matchUpFormat:P,stageSequence:y,matchUpType:A,roundLimit:x,matchUps:$}),m&&dn({extension:{name:sh,value:m},element:O}),b=((a=$?.filter(G=>G.roundNumber===x))==null?void 0:a.length)||0;if(y>1){let{link:G}=iN({sourceStructureId:S,sourceRoundNumber:I,targetStructureId:O.structureId,finishingPositions:w===Em?[1]:void 0,linkType:w});u.push(G),p+=(U||0)-b}else p+=U||0;w=N===od?Em:Pm,S=O.structureId,I=x,l.push(O),y+=1}h+=b,o.push({qualifiersCount:b,finalQualifyingRoundNumber:I,finalQualifyingStructureId:S,finishingPositions:f,roundTarget:m,linkType:w}),m+=1}return{qualifiersCount:h,qualifyingDrawPositionsCount:p,qualifyingDetails:o,structures:l,...ue,links:u}}function w7e({drawSize:t,qualifyingRoundNumber:e}){let i=t,n=0;for(;n<e;)i=Math.floor(i/2),n+=1;return i}function X0e(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,n=ai(t.drawSize),r=e&&t.drawType!==gu&&(typeof e=="boolean"||e<=2)&&n===2&&Rp||t.drawType||Rp,a=Kbe.includes(r);if(n&&a){if(e&&(typeof e=="boolean"&&n<4||n<=e))r=Rp;else if(n<4&&i)return{...pe({context:{enforceMinimumDrawSize:i,drawSize:n,drawType:r},result:{error:n$},stack:"getCoercedDrawType"}),drawType:r}}return{drawType:r}}function S7e(t){let{drawDefinition:e,structureOptions:i,requireSequential:n}=t,r={structureName:Ss(_t),...t,stage:_t},{structures:a,groupCount:s}=JM(r);if(s<1)return{error:_ye};let o=i?.playoffGroups||[{finishingPositions:[1],structureName:Ss(Tr)}],[l]=a,{structures:u,links:c}=p0e({sourceStructureId:l.structureId,requireSequential:n,drawDefinition:e,playoffGroups:o,groupCount:s,...t});return u&&a.push(...u),{...ue,structures:a,links:c}}function T7e({mainStructure:t,consolationStructure:e,deciderStructure:i}){let n=e.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),r=t.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),a=e.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),s=n.map((u,c)=>{let d=n.indexOf(u)%2?Oc:sb,p=1+c;return{linkType:sf,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:u,structureId:e.structureId}}}),o={linkType:Pm,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Oc,roundNumber:r,structureId:t.structureId}},l=[{linkType:Pm,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Oc,roundNumber:1,structureId:i.structureId}},{linkType:sf,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Oc,roundNumber:1,structureId:i.structureId}}];return[...s,o,...l]}function U7e({structureName:t,matchUpType:e,idPrefix:i,drawSize:n,isMock:r,uuids:a}){let s=[],{matchUps:o}=cv({linkFedFinishingRoundNumbers:[1],drawSize:n+1,matchUpType:e,idPrefix:i,isMock:r}),l=Gg({structureName:t||Ss(_t),structureId:a?.pop(),stageSequence:1,stage:_t,matchUpType:e,matchUps:o});s.push(l);let u=n/2,{matchUps:c}=cv({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:n-1,isConsolation:!0,matchUpType:e,isMock:r,uuids:a}),d=Gg({structureName:Ss(Ybe),matchUps:c,structureId:a?.pop(),stage:Ds,stageSequence:2,matchUpType:e});s.push(d);let{matchUps:p}=Kp({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:r}),h=Gg({structureName:Ss(Wbe),matchUps:p,structureId:a?.pop(),stageSequence:3,stage:Tr,matchUpType:e});s.push(h);let f=T7e({mainStructure:l,consolationStructure:d,deciderStructure:h});return{structures:s,links:f,...ue}}function D7e(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:n,matchUpType:r,idPrefix:a,drawSize:s,isMock:o,uuids:l}=t;if(!bi(s)||s<2)return{matchUps:[],roundsCount:0};if(Gd(s))return Kp(t);let u=E7e(s),c=u.shift(),d=Et(1,(c?.participantsCount||0)+1).map(g=>({drawPosition:g})),p=[],h=1;({matchUps:p}=Ux({roundNumber:h,matchUpType:r,idPrefix:a,matchUps:p,isMock:o,nodes:d,uuids:l})),h++;let f=t.roundLimit||e;for(let g of u){let v=g.participantsCount/2,y=Et(1,v+1);n&&v===n&&(f=h-1);let b=y.map(I=>{let S=e9({roundPosition:I,roundNumber:h,idPrefix:a,uuids:l});return{roundPosition:I,roundNumber:h,matchUpId:S}});p.push(...b),h++}let m=h-1;return p=zM({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:f,matchUps:p}),f&&(p=p.filter(g=>g.roundNumber<=f)),{matchUps:p,roundsCount:m,roundLimit:f}}function E7e(t){let e=ai(t),i=e%2?e+1:e,n=!!(Math.ceil(i/2)%2),r=[{participantsCount:i,preFeedRound:n}];for(;i>2;){let a=Math.ceil(i/2),s=a===1,o=!!(!s&&a%2);i=!s&&o?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);r.push({participantsCount:i,preFeedRound:l,feedRound:o})}return r}function J0e(t){var e,i;let{playoffAttributes:n,stageSequence:r=1,stage:a=_t,matchUpType:s,drawSize:o,uuids:l}=t,u=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,c=t.structureId||u()||l?.pop(),d=t.appliedPolicies??pn(t),p=((e=t.policyDefinitions)==null?void 0:e[hU])||d?.[hU];t.skipRounds=t.skipRounds||o<=4&&(p!=null&&p.feedFromMainFinal?0:1)||0;let h=t.structureName??((i=n?.[0])==null?void 0:i.name)??Ss(_t),f=()=>{let{matchUps:m}=Kp(t);return{structures:[Gu({stageSequence:r,structureName:h,matchUpType:s,structureId:c,matchUps:m,stage:a})],links:[],...ue}};return{generators:{[gu]:()=>({structures:[Gu({finishingPosition:ob,stageSequence:r,structureName:h,matchUps:[],matchUpType:s,structureId:c,stage:a})],links:[],...ue}),[Bb]:()=>{let{matchUps:m}=D7e(t);return{structures:[Gu({stageSequence:r,structureName:h,matchUpType:s,structureId:c,matchUps:m,stage:a})],links:[],...ue}},[Rp]:()=>f(),[UM]:()=>U7e(t),[lU]:()=>gT({...t,roundOffsetLimit:3,playoffAttributes:n??k7}),[uU]:()=>gT({...t,roundOffsetLimit:2,playoffAttributes:n??x7}),[Tr]:()=>gT(t),[xD]:()=>{let{matchUps:m}=cv({drawSize:o,uuids:l,matchUpType:s});return{structures:[Gu({stageSequence:r,structureName:h,matchUpType:s,structureId:c,stage:_t,matchUps:m})],links:[],...ue}},[DM]:()=>u0e(t),[cU]:()=>II({...t,feedRounds:1,fmlc:!0}),[qbe]:()=>II({...t,feedRounds:1}),[N7]:()=>II({...t,feedsFromFinal:1}),[A7]:()=>II({...t,feedsFromFinal:2}),[_7]:()=>II({...t,feedsFromFinal:3}),[EM]:()=>II(t),[D$]:()=>d0e(t),[od]:()=>JM(t),[of]:()=>S7e(t)}}}function w9(t){var e,i,n,r,a;let{enforceMinimumDrawSize:s=!0,overwriteExisting:o,appliedPolicies:l,staggeredEntry:u,drawDefinition:c,tieFormat:d,isMock:p,uuids:h}=t||{},f=ai(t.drawSize),m=t.drawTypeCoercion??dN({appliedPolicies:l,drawType:t.drawType}),g="generateDrawStructuresAndLinks",v=X0e({drawType:t.drawType,enforceMinimumDrawSize:s,drawTypeCoercion:m,drawSize:f});if(v.error)return v;let y=v.drawType,b=[],I=[],S=t?.matchUpType??Mn,w=(e=c?.structures)==null?void 0:e.filter(({stage:K})=>K===Kt);w&&b.push(...w);let T=w?.map(({structureId:K})=>K),U=(i=c?.structures)==null?void 0:i.find(({stage:K,stageSequence:Q})=>K===_t&&Q===1),C=(n=c?.links)==null?void 0:n.filter(K=>K.target.structureId===U?.structureId&&T?.includes(K.source.structureId)),E=(K,Q)=>{var J;if(K.linkType===Em&&Q!=null&&Q.structures){let ne=K.source.finishingPositions||[];return Q.structures.length*ne.length}else if(K.linkType===Pm&&(J=Q?.matchUps)!=null&&J.length){let ne=K.source.roundNumber;return Q.matchUps.filter(({roundNumber:re})=>re===ne).length}},P=w?.map(K=>{var Q,J,ne;let re=C?.find(ye=>ye.target.structureId===K.structureId),oe=((J=(Q=Fn({structure:K}))==null?void 0:Q.positionAssignments)==null?void 0:J.length)??0;if(!re)return oe;let de=re?.source.structureId,se=(ne=c.structures)==null?void 0:ne.find(ye=>ye.structureId===de),ge=E(re,se)||0;return oe-ge}).filter(Boolean).reduce((K,Q)=>K+Q,0),M=C?.map(K=>{let Q=K.source.structureId,J=w?.find(ne=>ne.structureId===Q);return E(K,J)}).filter(Boolean).reduce((K,Q)=>K+Q,0),R=!!(U&&!((r=U?.matchUps)!=null&&r.length));if(w!=null&&w.length&&!R)return{error:TH};let N=!(w!=null&&w.length)&&t.qualifyingProfiles,A=N?.length&&Z0e({idPrefix:t.idPrefix,qualifyingProfiles:N,appliedPolicies:l,isMock:p,uuids:h});if(A!=null&&A.error)return A;let{qualifyingDrawPositionsCount:_,qualifyingDetails:x,qualifiersCount:O}=A||{qualifyingDrawPositionsCount:P,qualifiersCount:M};_&&(A!=null&&A.structures&&b.push(...A.structures),A!=null&&A.links&&I.push(...A.links)),Object.assign(t,Gt({drawSize:f,matchUpType:S,tieFormat:d}));let $=y!==gu&&(!f||f<2||!u&&![xD,Bb].includes(y)&&([of,od].includes(y)&&f<3||![od,of].includes(y)&&!Gd(f)));if($&&!_)return pe({context:{drawSize:f,invalidDrawSize:$},result:{error:n$},stack:g});let{generators:F,error:j}=J0e(t);if(j)return{error:j};let H=F[y];if(!H)return{error:Z6};let G=H?.();if(G.error)return G;let{structures:W,links:q}=G;if(W!=null&&W.length){let K=W.find(({stage:Q,stageSequence:J})=>Q===_t&&J===1);if(U&&K){if(R){let Q=K.structureId;if(K.structureId=U.structureId,q?.length)for(let J of q)J.source.structureId===Q&&(J.source.structureId=U.structureId),J.target.structureId===Q&&(J.target.structureId=U.structureId)}else if(!o)return{error:TH}}b.push(...W)}b.sort(k0),q!=null&&q.length&&I.push(...q);let Z=G.structures.find(({stage:K,stageSequence:Q})=>K===_t&&Q===1);for(let K of x||[]){let{finalQualifyingRoundNumber:Q,finalQualifyingStructureId:J,roundTarget:ne,finishingPositions:re,linkType:oe}=K,de=Z&&((a=iN({targetStructureId:Z.structureId,sourceStructureId:J,sourceRoundNumber:Q,finishingPositions:re,targetEntryRound:ne,linkType:oe}))==null?void 0:a.link);if(de!=null&&de.error)return de;de&&I.push(de)}return C&&I.push(...C),{...ue,qualifyingResult:{qualifyingDrawPositionsCount:_,qualifiersCount:O},structures:b,links:I}}function S9(t){var e,i;let{modifyOriginal:n=!0,stageSequence:r=1,isMock:a}=t||{},s="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return pe({result:{error:Lt},stack:s});let o=n?t.drawDefinition:At(t.drawDefinition,!1,!0),{tieFormat:l,matchUpType:u}=t;if(l){let S=Bo({tieFormat:l});if(S.error)return S}l=fs(l??((e=Xs({drawDefinition:o}))==null?void 0:e.tieFormat)),u=u??(o.matchUpType||Mn),t.tieFormat=l,t.matchUpType=u;let c=bx({drawDefinition:o,stage:_t});t.drawSize=t.drawSize??c,!c&&t.drawSize&&Sx({drawSize:t.drawSize,drawDefinition:o,stageSequence:r,stage:_t});let d=Cs({drawDefinition:o}).drawMatchUps.map(Na),p=w9(t);if(p.error)return pe({result:p,stack:s});let{structures:h,links:f,qualifyingResult:m}=p;o.structures=h,o.links=f;let g=Math.max(t.qualifiersCount??0,m?.qualifiersCount||0);if(m!=null&&m.qualifyingDrawPositionsCount&&!bx({stage:Kt,drawDefinition:o})){let S=Sx({drawSize:m.qualifyingDrawPositionsCount,stage:Kt,drawDefinition:o});if(S.error)return S}if(g){let S=Jwe({qualifiersCount:g,drawDefinition:o,stage:_t});if(S.error)return S}let v=t.drawSize??c;Object.assign(t,Gt({drawSize:v,matchUpType:u,tieFormat:l}));let{matchUps:y,matchUpsMap:b}=pa({drawDefinition:o});l&&y?.forEach(S=>{if(!d.includes(S.matchUpId)){let{tieMatchUps:w}=rN({tieFormat:l,matchUp:S,isMock:a});Object.assign(S,{tieMatchUps:w,matchUpType:u})}});let{inContextDrawMatchUps:I}=pb({drawDefinition:o,matchUpsMap:b});return Bn({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,drawDefinition:o}),{inContextDrawMatchUps:I,drawDefinition:o,matchUpsMap:b,...ue,structures:h,matchUps:y,links:f}}function hN(t){let{removePriorValues:e,tournamentRecord:i,participantId:n,scaleItem:r}=t,a,s;if(!eSe({scaleItem:r}))return{error:ww};if(n&&Array.isArray(i.participants)&&(s=i.participants.find(o=>o.participantId===n),s)){if(s.participantType===xo&&r?.eventType!==Fl)return{error:ww};let o=tSe({removePriorValues:e,participant:s,scaleItem:r});if(o.error)return o;a=!o.valueChanged;let{topics:l}=lc();l.includes(Es)&&Ui({topic:Es,payload:{tournamentId:i.tournamentId,participants:[s]}})}return a&&{...ue,info:g7,existingValue:r?.scaleValue}||s&&{...ue,newValue:r?.scaleValue}||{error:Ar}}function Q0e(t){var e;let{scaleItemsWithParticipantIds:i=[],removePriorValues:n,tournamentRecord:r,auditData:a,context:s}=t;if(!r)return{error:lt};if(!r.participants)return{error:yM};let o=0,l={},u=[];for(let p of i){let h=p?.participantId;if(Array.isArray(p?.scaleItems))for(let f of p.scaleItems)if(eSe({scaleItem:f}))Array.isArray(l[h])||(l[h]=[]),l[h].push(f);else return{error:ww}}for(let p of r.participants){let{participantId:h}=p||{};if(Array.isArray(l[h]))for(let f of l[h]){if(p.participantType===xo&&f?.eventType!==Fl)return pe({context:{participantId:h,scaleItem:f,participantType:p.participantType},info:"Invalid participantType for eventType",result:{error:ww}});tSe({participant:p,scaleItem:f,removePriorValues:n}),u.push(p),o++}}let c=o?void 0:_D,{topics:d}=lc();if(d.includes(Es)&&o&&Ui({topic:Es,payload:{tournamentId:r.tournamentId,participants:u}}),s){let{eventId:p,drawId:h,...f}=s,m=((e=f.scaleAttributes)==null?void 0:e.scaleType)&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){let g={itemType:e8,itemValue:f};if(m&&(g.itemSubTypes=m),h||p){let{drawDefinition:v,event:y}=jo({tournamentRecord:r,eventId:p,drawId:h});h&&K8({drawDefinition:v,timeItem:g}),p&&W0({event:y,timeItem:g})}else uN({tournamentRecord:r,timeItem:g})}}return a&&d.includes(rm)&&Ui({topic:rm,payload:a}),Gt({...ue,modificationsApplied:o,info:c})}function eSe({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(n=>e?.includes(n)).length===i.length}function tSe({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:P0};let n=i&&Object.keys(i),r=["scaleType","eventType","scaleName"];if(r.filter(u=>n.includes(u)&&i[u]).length!==r.length)return{error:ww};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:s}=$h({scaleAttributes:i,participant:e}),o=u=>[void 0,null,""].includes(u),l=!(o(s?.scaleValue)&&o(i.scaleValue))&&JSON.stringify(s?.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:u,eventType:c,scaleName:d}=i,p=[lb,u,c,d].join("."),h=Gt({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(h.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(f=>f.itemType!==p)),e.timeItems.push(h)}return{...ue,valueChanged:l,newValue:i.scaleValue}}function T9(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:n}=t,r=Yt(t,[{[Ta]:!0},{modifiedScaleValues:!0,[Ho]:el}]);if(r.error)return r;for(let a in i){let s=hN({scaleItem:i[a],removePriorValues:n,tournamentRecord:e,participantId:a});if(s.error)return s}return{...ue}}function bU(t){let{tournamentRecord:e,scaleAttributes:i,participantId:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!n)return{error:da};let{participant:a,tournamentId:s}=Ov({tournamentRecords:r,tournamentRecord:e,participantId:n});return a?{...$h({participant:a,scaleAttributes:i}),tournamentId:s}:{error:Ar}}var P7e=(t=0)=>250/Math.pow(t+5,.4),C7e=()=>1;function R7e(t=3,e=2){let i=t/e;return isNaN(i)?VS.kDefault():i}var VS={nSpread:400,diffThreshold:.125,kCalc:P7e,kMultiplier:R7e,kDefault:C7e};function iSe(t){let{winnerRating:e,loserRating:i}=t,{ratings:n=Ra,winnerCountables:r=1,loserCountables:a=0,ratingType:s=_c,maxCountables:o,countables:l}=t||{},u=n?.[s];if(!u)return{error:Xt};let c=u.range||t.ratingRange;e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=c[0]>c[1],p=u.decimalsCount||0,h=d?c.slice().reverse():c,f=(_,x)=>parseFloat(x)>=Math.min(..._)&&parseFloat(x)<=Math.max(..._);(!f(c,e)||!f(c,i))&&(f(c,e)||(e=u.defaultInitialization),f(c,i)||(i=u.defaultInitialization));let m=tT({targetRange:Ra[_c].range,sourceRange:h,value:d?c[0]-e:e}),g=tT({targetRange:Ra[_c].range,sourceRange:h,value:d?c[0]-i:i}),v=(_,x)=>1/(1+Math.pow(10,(x-_)/VS.nSpread)),y=v(m,g),b=v(g,m),I=VS.kCalc(r),S=VS.kCalc(a),w=VS.kMultiplier(o,l),T=m+w*I*(1-y),U=g+w*S*(0-b),C=tT({sourceRange:Ra[_c].range,value:T,targetRange:h}),E=tT({sourceRange:Ra[_c].range,value:U,targetRange:h}),P=d?c[0]-C:C,M=parseFloat(P.toFixed(p)),R=d?c[0]-E:E,N=parseFloat(R.toFixed(p)),A=Math.max(...c)?Math.abs(e-i)/Math.max(...c):0;return(C>E&&A>VS.diffThreshold||M<0||N<0)&&(M=e,N=i),{newWinnerRating:M,newLoserRating:N}}var M7e=t=>t?.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0])||[0,0];function nSe(t){var e,i;let n=Yt(t,[{[Ta]:!0},{matchUpIds:!0,[Ho]:Os,[Zc]:U0},{ratingType:!1,[vs]:I=>Ra[I]}]);if(n.error)return n;let{updateParticipantRatings:r,removePriorValues:a=!0,tournamentRecord:s,ratingType:o=_c,refreshDynamic:l,considerGames:u,drawDefinition:c,matchUpIds:d,asDynamic:p}=t,h=Ra[o],{accessor:f}=h,m={},g=(t.matchUps||l&&ho({drawDefinition:c,tournamentRecord:s,inContext:!0,matchUpFilters:{matchUpStatuses:wa}}).matchUps||Qa({matchUpFilters:{matchUpIds:d,matchUpStatuses:wa},tournamentRecord:s,inContext:!0}).matchUps)??[],v=`${o}.${H7}`,y=p?v:o;g.sort(j0);for(let I of g){let{endDate:S,matchUpFormat:w,score:T,sides:U,winningSide:C}=I,E=I.matchUpType,P={eventType:E,scaleName:o,scaleType:Vg},M={scaleName:v,eventType:E,scaleType:Vg},R=Object.assign({},...(U??[]).map(H=>{let{sideNumber:G,participant:W}=H;return G&&{[G]:[W?.participantId,...W?.individualParticipantIds??[]].filter(Boolean).flat()}})),N=Object.assign({},...Object.values(R).flat().map(H=>{let G=m[H],W=!l||G?bU({scaleAttributes:M,tournamentRecord:s,participantId:H}).scaleItem:void 0,q=bU({tournamentRecord:s,scaleAttributes:P,participantId:H}).scaleItem,Z=f?{[f]:void 0}:void 0;return H&&{[H]:W??q??{scaleName:y,eventType:E,scaleDate:S,scaleType:Vg,scaleValue:Z}}})),A=w?Do(w):{},_=A?.bestOf||1,x=A?.setsTo||1,O=u?_&x:_,$=T?.sets&&M7e(T.sets)||C===1&&[1,0]||[0,1],F=C?R[C]:[],j=C?R[3-C]:[];for(let H of F){let G=(e=N[H])==null?void 0:e.scaleValue,W=typeof G=="object"?G[f]:G;for(let q of j){let Z=(i=N[q])==null?void 0:i.scaleValue,K=typeof Z=="object"?Z[f]:Z,Q=C?$[C]:[0,0],J=C?$[3-C]:[0,0],{newWinnerRating:ne,newLoserRating:re}=iSe({winnerCountables:Q,loserCountables:J,maxCountables:O,winnerRating:W,loserRating:K,ratingType:o}),oe=f?{...G,[f]:ne}:ne,de=f?{...Z,[f]:re}:re;N[H].scaleValue=oe,N[q].scaleValue=de,N[H].scaleName=y,N[q].scaleName=y}}Object.assign(m,N),r&&T9({tournamentRecord:s,modifiedScaleValues:m,removePriorValues:a})}let b=g.map(({matchUpId:I})=>I);return{...ue,modifiedScaleValues:m,outputScaleName:y,processedMatchUpIds:b}}function fB(t){var e;let{matchUpIds:i=[],drawDefinition:n,roundNumber:r,newRound:a,isMock:s,event:o}=t;if(typeof n!="object")return{error:Lt};let{participantIdPairings:l,matchUpsCount:u}=t,c=dB(t);if(c.error)return pe({result:c});let{lastRoundNumber:d,availableMatchUpsCount:p=0,roundMatchUpsCount:h=0}=c;if(!u)a?u=h:p>0&&(u=p);else if(u>h&&t.restrictMatchUpsCount!==!1)return pe({result:{error:Ce,info:"matchUpsCount error",context:{roundMatchUpsCount:h}}});if(l&&!Array.isArray(l)||u&&!bi(u)||i&&!Array.isArray(i)||!l&&!u)return{error:Ce,info:"matchUpsCount or pairings error"};if(u&&t.restrictMatchUpsCount!==!1&&u>32)return{error:Ce,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(d||0))return{error:Ce,info:"roundNumber error"};let f=r??(a&&(d??0)+1||d||1);l=l??Et(0,u).map(()=>({participantIds:[void 0,void 0]}));let m=v=>{if(!t.idPrefix)return;let y=n.drawId,b=t.idPrefix??"ah";return`${y}-${b}-${f}-${v}`},g=l?.map((v,y)=>{let b=v?.participantIds??[void 0,void 0];b.push(void 0,void 0);let I=b.slice(0,2).map((w,T)=>Gt({sideNumber:T+1,participantId:w})),S=i[y]??m(y)??gn();return{roundNumber:f,matchUpStatus:Or,matchUpId:S,sides:I}});if(g!=null&&g.length){let v=(e=Xs({drawDefinition:n,event:o}))==null?void 0:e.tieFormat;v&&g.forEach(y=>{let{tieMatchUps:b}=rN({tieFormat:v,matchUp:y,isMock:s});Object.assign(y,{tieMatchUps:b,matchUpType:zn})})}return{roundNumber:f,matchUpsCount:g?.length??0,matchUps:g,...ue}}function N7e({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:n,deltaObjects:r}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),s=Object.keys(i),o=[],l=VQ({actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n}),u=[kV(l)];o.push(l);let c=l.value,d=l,p=1,h=0,f=s.length,m;do f-=1,m=s.length*i[s[0]].length;while(m>t&&f>5);let g=[];s.forEach(y=>{i[y].slice(0,f).forEach(b=>{h+=1;let I=ZI(y,b.opponent);if(!g.includes(I)){let S=VQ({stipulated:[[y,b.opponent]],actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n});if(!u.includes(kV(S))){u.push(kV(S)),o.push(S);let{maxDelta:w,value:T}=S;w<d.maxDelta&&(d=S),(T<c||T===c&&Math.round(Math.random()))&&(c=T),g.push(I),p+=1}}}),o=o.filter(b=>Math.abs(b.value-c)<5)}),o.sort((y,b)=>y.maxDiff-b.maxDiff);let v=wl(o);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:h,candidate:v}}function kV(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function VQ({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:n,valueObjects:r,actorsCount:a}){let s=[].concat(...e),o=[],l=0;e.filter(Boolean).forEach(d=>{let[p,h]=d,f=ZI(p,h),m=i[f];o.push({participantIds:d,value:m}),l+=i[f]}),ka(t,a).map(d=>co(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((h,f)=>s.includes(f)||h,!1)){s.push(...p);let h=d.value;l+=h,o.push({participantIds:p,value:h})}}),o.sort((d,p)=>d.value-p.value);let u=o.reduce((d,p)=>{let[h,f]=p.participantIds,m=ZI(h,f),g=n[m];return g>d?g:d},0),c=o.reduce((d,p)=>{let[h,f]=p.participantIds,m=ZI(h,f),g=r[m];return g>d?g:d},0);return{value:l,participantIdPairings:o,maxDelta:u,maxDiff:c}}function ZI(t,e){return[t,e].sort(J$).join("|")}function rSe({participantIds:t}){let e={},i=[];t.forEach(r=>{e[r]=t.filter(a=>a!==r),e[r].forEach(a=>{let s=ZI(a,r);i.includes(s)||i.push(s)})});let n=Object.assign({},...i.map(r=>({[r]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:n}}function A7e({matchUps:t}){let e=[];for(let i of t){let n=i.sides.map(Gi);if(n.length===2){let[r,a]=n,s=ZI(r,a);e.includes(s)||e.push(s)}}return{encounters:e}}function _7e({possiblePairings:t,valueObjects:e}){let i={};for(let r of Object.keys(t)){let a=t[r].map(s=>n(r,s));i[r]=a.sort((s,o)=>s.value-o.value)}function n(r,a){let s=ZI(r,a);return{opponent:a,value:e[s]}}return{pairingValues:i}}var k7e=0;function x7e({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:n,pairing:r}){var a;let s=((a=Ra[n])==null?void 0:a.defaultInitialization)??k7e;return r.split("|").map(o=>{var l;if(i===Ju){let u=(l=t?.find(c=>c.participantId===o))==null?void 0:l.individualParticipantIds;return u?u?.map(c=>e[c]||s):s*2}else return e[o]||s})}function O7e(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:n,uniquePairings:r,maxIterations:a,minimizeDelta:s,deltaObjects:o,valueObjects:l,eventType:u,scaleName:c,salted:d}=t;r.forEach(b=>{let I=x7e({tournamentParticipants:e,adHocRatings:i,scaleName:c,eventType:u,pairing:b}),S=typeof d=="number"&&d||.5,w=d&&(Math.round(Math.random())?S:S*-1)||0,T=Math.abs(I[0]-I[1])+w,U=Math.abs(I[0]-I[1]);o[b]=U,l[b]||(l[b]=0),l[b]+=T?Math.pow(T,2):0});let p=r.map(b=>({pairing:b,value:l[b]})).sort((b,I)=>b.value-I.value),{pairingValues:h}=_7e({possiblePairings:n,valueObjects:l}),{candidate:f,candidatesCount:m,deltaCandidate:g,iterations:v}=N7e({valueSortedPairings:p,maxIterations:a,pairingValues:h,deltaObjects:o,valueObjects:l}),{participantIdPairings:y}=s?g:f;return{participantIdPairings:y,candidatesCount:m,deltaCandidate:g,iterations:v,candidate:f}}var L7e=100,F7e=100,$7e=4e3;function U9(t){var e,i;let{encounterValue:n=L7e,sameTeamValue:r=F7e,maxIterations:a=$7e,updateParticipantRatings:s,generateMatchUps:o=!0,ignoreLastRoundNumber:l,iterationMatchUps:u,tournamentRecord:c,dynamicRatings:d,refreshDynamic:p,participantIds:h,drawDefinition:f,roundNumber:m,structureId:g,matchUpIds:v,eventType:y,scaleName:b,idPrefix:I,isMock:S,salted:w,event:T}=t;if(!f)return{error:Lt};if(!t.structure&&!g)return{error:pr};let U=t.structure||ui({drawDefinition:f,structureId:g}).structure;if(!Qi(U))return{error:Fb};if(!(h!=null&&h.length))return{error:Mv};let C=[...u??[],...U?.matchUps??[]],{encounters:E}=A7e({matchUps:C}),P=c?.participants??[],M={};if(d){let Q=Si(U!=null&&U.matchUps?U.matchUps.map(({roundNumber:ne})=>ne):[]),J=Math.max(...Q,0);if(J){let ne=(e=U?.matchUps)==null?void 0:e.filter(({roundNumber:oe})=>oe===J).map(({matchUpId:oe})=>oe),re=nSe({ratingType:b??((i=T?.category)==null?void 0:i.ratingType),updateParticipantRatings:s,tournamentRecord:c,asDynamic:!0,refreshDynamic:p,drawDefinition:f,matchUpIds:ne});if(re.error)return re;re.modifiedScaleValues&&(M=re.modifiedScaleValues)}}let{valueObjects:R}=B7e({tournamentParticipants:P,encounterValue:n,sameTeamValue:r,encounters:E}),{uniquePairings:N,possiblePairings:A,deltaObjects:_}=rSe({participantIds:h}),x=Object.values(M).length?M:t.adHocRatings,O={tournamentParticipants:P,possiblePairings:A,uniquePairings:N,maxIterations:a,adHocRatings:x,deltaObjects:_,valueObjects:R,eventType:y,scaleName:b,salted:w},{candidatesCount:$,participantIdPairings:F,deltaCandidate:j,iterations:H,candidate:G}=O7e(O);if(!$)return{error:d$};let W,q;if(o){let Q=fB({structureId:U?.structureId,ignoreLastRoundNumber:l,participantIdPairings:F,newRound:!0,drawDefinition:f,roundNumber:m,matchUpIds:v,idPrefix:I,isMock:S,event:T});if(Q.error)return Q;W=Q.roundNumber,q=Q.matchUps}let{maxDelta:Z,maxDiff:K}=G;return{roundNumber:W,participantIdPairings:F,modifiedScaleValues:M,candidatesCount:$,deltaCandidate:j,...ue,iterations:H,matchUps:q,maxDelta:Z,maxDiff:K}}function B7e({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:n}){let r={};for(let s of t)r[s]||(r[s]=0),r[s]+=i;let a=e?.filter(({participantType:s})=>s===Sn);if(a)for(let s of a){let o=s.individualParticipantIds??[],{uniquePairings:l}=rSe({participantIds:o});for(let u of l)r[u]||(r[u]=0),r[u]+=n}return{valueObjects:r}}function aSe(t){var e,i,n,r;let{drawType:a=Rp,attachConsolation:s=!0,applyPositioning:o=!0,tournamentRecord:l,staggeredEntry:u,automated:c,placeByes:d,isMock:p,event:h}=t,f=t?.drawDefinition;if(!f)return{error:Lt};let m=qa,g=x0({stageSequence:1,drawDefinition:f,stage:m}),v=[od,UM,of].includes(a)?g.length:ED(g.length);if(!u&&a===xD&&g.length<2||a===od&&g.length<3)return{error:n$};let{tieFormat:y,matchUpType:b}=t;if(y){let A=Bo({tieFormat:y});if(A.error)return A}y=fs(y??((e=Xs({drawDefinition:f}))==null?void 0:e.tieFormat)),b=b??f.matchUpType;let{structures:I}=ud({stageSequence:1,drawDefinition:f,stage:m});if(I.length>1)return{error:Jve};if((n=(i=I?.[0])==null?void 0:i.matchUps)!=null&&n.length)return{error:y7};let S=(r=I?.[0])==null?void 0:r.structureId;Object.assign(t,Gt({structureName:t.structureName??Ss(qa),structureId:S,matchUpType:b,tieFormat:y,drawSize:v,stage:m}));let w=J0e(t);if(w.error)return w;let T=w.generators[a];if(!T)return{error:Z6};let U=T?.();if(U.error)return U;let{structures:C,links:E}=U,P=C.map(A=>vn({structure:A}).matchUps).flat();y&&P.forEach(A=>{let{tieMatchUps:_}=rN({matchUp:A,tieFormat:y,isMock:p});Object.assign(A,{tieMatchUps:_,matchUpType:b})}),(!o||!s)&&(f=At(f,!1,!0)),f.links||(f.links=[]),E.length&&f.links.push(...E);let M=C.map(({structureId:A})=>A);f.structures||(f.structures=[]);let R=f.structures.map(({structureId:A})=>A);f.structures=f.structures.map(A=>M.includes(A.structureId)?C.find(({structureId:_})=>_===A.structureId):A);let N=C.filter(({structureId:A})=>!R.includes(A));return N.length&&f.structures.push(...N),c&&tN({seedingProfile:t.seedingProfile,applyPositioning:o,tournamentRecord:l,drawDefinition:f,structureId:S,placeByes:d,drawSize:v,event:h}),s&&Bn({drawDefinition:f}),{links:E,structures:C,...ue}}var D9={};$i(D9,{addGame:()=>hSe,addPoint:()=>pSe,addSet:()=>mSe,addShot:()=>fSe,analyzeScore:()=>N9,analyzeSet:()=>s1,calculateHistoryScore:()=>uSe,checkScoreHasValue:()=>Sa,checkSetIsComplete:()=>vB,clearHistory:()=>dSe,generate:()=>sSe,generateScoreString:()=>Bh,generateTieMatchUpScore:()=>oN,getSetComplement:()=>_9,getTiebreakComplement:()=>wB,helpers:()=>bSe,isValidMatchUpFormat:()=>Ll,keyValueScore:()=>zSe,mutate:()=>lSe,parseMatchUpFormat:()=>Do,parseScoreString:()=>Cx,query:()=>ZSe,redo:()=>gSe,reverseScore:()=>oSe,setServingSide:()=>cSe,stringifyMatchUpFormat:()=>I$,tidyScore:()=>KSe,umo:()=>ySe,undo:()=>vSe,validateScore:()=>A9,validateTieFormat:()=>Bo});var sSe={};$i(sSe,{generateScoreString:()=>Bh,generateTieMatchUpScore:()=>oN,reverseScore:()=>oSe});function Bh(t){let{winnerFirst:e=!0,setTBlast:i=!0,addOutcomeString:n,reversed:r=!1,matchUpStatus:a,matchUpFormat:s,autoComplete:o,winningSide:l,sets:u}=t;if(!u)return{error:Xt,info:"missing sets"};let c=s&&Do(s),{bestOf:d,finalSetFormat:p,setFormat:h}=c??{},f=r||!(!e||!l||l===1),m=n?V7e({matchUpStatus:a}):"",g=u?.sort(j7e).map(v).filter(Boolean).join(" ")||"";if(!m)return g;if(l===2)return`${m} ${g}`;return`${g} ${m}`;function v(y){let b=d&&y.setNumber===d&&p?p:h,I=G=>Ir(G?.side1Score)||Ir(G?.side2Score),S=(G=>Ir(G?.side1TiebreakScore)||Ir(G?.side2TiebreakScore))(y),w=b?.tiebreakSet||!I(y)&&S,{side1Score:T,side2Score:U,side1TiebreakScore:C,side2TiebreakScore:E}=y,P=C||(Ir(C)||S&&o?0:""),M=E||(Ir(E)||S&&o?0:"");if(w)return`[${(f?[M,P]:[P,M]).join("-")}]`;let R=S?Math.min(P,M):"",N=R===P?1:2,A=Ir(R)?`(${R})`:"",_=T||(Ir(T)||o?0:""),x=U||(Ir(U)||o?0:""),O=G=>!i&&N===G?A:"",$=`${_}${O(1)}`,F=`${x}${O(2)}`,j=i&&S?`(${R})`:"",H=f?`${[F,$].join("-")}${j}`:`${[$,F].join("-")}${j}`;return["-"," "].includes(H)&&(H=""),H}}function V7e({matchUpStatus:t}){let e={[os]:"RET",[ln]:"WO",[oa]:"DF/DF",[jr]:"WO/WO",[xv]:"SUS",[ul]:"ABN",[Wi]:"DEF",[BD]:"DR"};return t&&e[t]||""}function j7e(t,e){return t.setNumber-e.setNumber}function oSe(t){if(!(t!=null&&t.score))return{error:Xt};let{sets:e}=t.score,i=e.map(s=>{let{side1TiebreakScore:o,side2TiebreakScore:l,winningSide:u,side1Score:c,side2Score:d,setNumber:p}=s;return Gt({winningSide:u?3-u:void 0,side1TiebreakScore:l,side2TiebreakScore:o,side1Score:d,side2Score:c,setNumber:p})}),n=t?.setTBlast,r=Bh({setTBlast:n,sets:i}),a=Bh({sets:i,reversed:!0,setTBlast:n});return{reversedScore:{sets:i,scoreStringSide1:r,scoreStringSide2:a},...ue}}var lSe={};$i(lSe,{addGame:()=>hSe,addPoint:()=>pSe,addSet:()=>mSe,addShot:()=>fSe,calculateHistoryScore:()=>uSe,clearHistory:()=>dSe,redo:()=>gSe,setServingSide:()=>cSe,umo:()=>ySe,undo:()=>vSe});function Kb({matchUp:t}){let{extension:e}=ki({name:O$,element:t});if(!e)return{error:Xa};let{history:i=[],undoHistory:n=[]}=e.value;return{history:i,undoHistory:n,...ue}}function uSe(t){var e,i;if(!t)return{error:Xt};let{matchUp:n,updateScore:r}=t;if(!n)return{error:ol};let a=((e=Kb({matchUp:n}))==null?void 0:e.history)||[];if(!Array.isArray(a))return{error:Ce,info:"history is not an array"};let{matchUpFormat:s}=n;if(!s)return{error:i7};if(!Ll({matchUpFormat:s}))return{error:t7};let o=Do(s),{bestOf:l,finalSetFormat:u,setFormat:c}=o,d=["0","15","30","40","A","G"],p={sets:[]},h=[],f,m=[0,0],g=1,v=0,y,b=0,I=M=>[1,2].includes(M),S=()=>(v+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:v,games:[]}),w=()=>({winningSide:void 0,points:[]}),T=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),U=T(),C=w(),E=S(),P=0;for(let M of a){P+=1,y=p.sets.length+1===l;let R=y&&u?u:c,{tiebreakAt:N,setTo:A,NoAD:_,tiebbreakFormat:x}=R,O=E.side1Score===N&&E.side1Score===E.side2Score,$=!!R.tiebreakSet,F=$?R.tiebreakSet:x,{tiebreakTo:j,NoAD:H}=F||{},G=()=>{f=void 0,m=[0,0],g=3-g,E.side1TiebreakScore="",E.side2TiebreakScore="",E.side1PointScore="",E.side2PointScore="",b=0},W=K=>{E.winningSide=K;let{s:Q,...J}=E;p.sets.push(J),U=T(),C=w(),E=S(),G()},q=K=>{C.winningSide=K;let{g:Q,...J}=C;E.games.push(J),U=T(),C=w(),G();let ne=`side${K}Score`;E[ne]+=1},Z=K=>{U.winningSide=K;let{p:Q,...J}=U;C.points.push(J),U=T(),b=0;let ne=()=>m.reduce((oe,de)=>oe+de)%4/4>.5?g:3-g,re=K-1;if(O||$){m[re]+=1,f=ne(),E[`side${K}TiebreakScore`]=m[re],E[`side${3-K}TiebreakScore`]=m[1-re];let oe=H?1:2;if(m[re]>=j&&m[re]>=m[1-re]+oe)return q(K),{gameCompleted:!0}}else if(m[1-re]===4&&m[re]===3?m[1-re]-=1:m[re]+=1,E.side1PointScore=d[m[0]],E.side2PointScore=d[m[1]],m[re]===5||m[re]===4&&m[1-re]<3||_&&m[re]===4)return q(K),{gameCompleted:!0}};if(I(M.srv)&&(g=M.srv),["p","s","g","o"].includes(M.u)&&h.push(M.u),M.shotOutcome&&(U.shots.push(M),M.shotType==="SERVE"&&["OUT","NET"].includes(M.shotOutcome)&&(b+=1),b===2)){let K=3-g;Z(K)}if(I(M.p)||bi(M.pointNumber)){let K=M.winningSide||M.p;if((i=Z(K))!=null&&i.gameCompleted)continue}if(I(M.g)||bi(M.gameNumber)){let K=M.winningSide||M.g;C.winningSide=K;let Q=`side${K}Score`,J=`side${3-K}Score`;if(h.length&&(h.includes("p"),h=[]),q(K),E[Q]===A&&E[Q]-E[J]>=(_?1:2)&&(W(K),y))break}if(I(M.s)||bi(M.setNumber)){let K=M.winningSide||M.s;if(W(K),h.length&&(h.includes("p"),h.includes("g"),h=[]),y)break}}return P!==a.length&&console.log({error:"Match completed with excess history"}),(E.side1Score||E.side2Score||E.games.length||E.side1TiebreakScore||E.side2TiebreakScore)&&p.sets.push(E),p.scoreStringSide1=Bh({...p,matchUpFormat:s}),p.scoreStringSide2=Bh({...p,matchUpFormat:s,reversed:!0}),g=f||g,r&&(n.score=p),{...ue,servingSide:g,score:p}}function Zb({undoHistory:t,history:e,matchUp:i}){return dn({element:i,extension:{value:{history:e,undoHistory:t},name:O$}})}function cSe({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:s7};let{history:i=[]}=Kb({matchUp:t});return i.push({srv:e}),Zb({matchUp:t,history:i})}function dSe({matchUp:t}){return Zb({matchUp:t})}function pSe({matchUp:t,point:e}){if(!e||!t)return{error:Xt};if(typeof e!="object")return{error:Ce,context:{point:e}};let{history:i=[]}=Kb({matchUp:t});return i.push(e),Zb({matchUp:t,history:i})}function hSe({matchUp:t,game:e}){if(typeof e!="object")return{error:Ce,context:{game:e}};let{history:i=[]}=Kb({matchUp:t});return i.push(e),Zb({matchUp:t,history:i})}function fSe({matchUp:t,shot:e}){if(typeof e!="object")return{error:Xt};let{history:i=[]}=Kb({matchUp:t});return i.push(e),Zb({matchUp:t,history:i})}function mSe({matchUp:t,set:e}){if(typeof e!="object")return{error:Xt};let{history:i=[]}=Kb({matchUp:t});return i.push(e),Zb({matchUp:t,history:i})}function gSe({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Kb({matchUp:t});return i.length&&e.push(i.pop()),Zb({matchUp:t,history:e,undoHistory:i})}function vSe({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Kb({matchUp:t});return i.push(e.pop()),Zb({matchUp:t,history:e,undoHistory:i})}var ySe={},bSe={};$i(bSe,{keyValueScore:()=>zSe,parseMatchUpFormat:()=>Do,stringifyMatchUpFormat:()=>I$,tidyScore:()=>KSe});var XI=" ",QH="DEF",G7e="COMPLETED",ISe="WO",H7e="WO/WO",wSe="ABN",SSe="SUS",TSe="RET",USe="INT",DSe=[TSe,QH,ISe,H7e,wSe,SSe,USe],ez="DEFAULTED",ESe="WALKOVER",PSe="ABANDONED",CSe="SUSPENDED",RSe="RETIRED",MSe="INTERRUPTED",z7e=[RSe,ez,ESe],q7e="Enter Score",Nw="()",gb="[]",E9=["up","left","shift+tab"],P9=["enter","down","tab","right"],Dx="backspace",NSe="r",ASe="s",_Se="a",kSe="d",xSe="w",OSe="i",mB=[NSe,kSe,xSe,_Se,ASe,OSe],gB="space",xV=["[","("],Ex=[...E9,...P9,gB,"]"],LSe="-",W7e="/",JI=LSe,Vh=LSe,FSe=[W7e],Y7e=0,K7e=["=","+","num_1","num_2","shift+=","shift+-"],C9=["0","1","2","3","4","5","6","7","8","9"].concat(mB),$Se=C9.map(t=>`shift+${t}`),BSe=[JI,Dx].concat(Ex,FSe),VSe=[C9,$Se,BSe].join(","),Z7e=[VSe,E9,P9,K7e].join(","),X7e={OUTCOMEKEYS:mB,SIDE1KEYS:C9,SIDE2KEYS:$Se,MODIFIERS:BSe,PROMPT:q7e,MOVEUP:E9,MOVEDOWN:P9,HOTKEYS:Z7e};function wS({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=jSe({scoreString:t}),e===2){let n=(t&&t[t.length-1])!==XI?XI:"";return t+n+i}else return i+XI+t}function jSe({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of DSe){let n=t?.indexOf(i);n===0?t=t.slice(i.length+1).trim()+XI:n>0&&(t=t.slice(0,n)),n>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function tz({analysis:t,scoreString:e,sets:i,lowSide:n}){var r,a,s;let o,l;if(!e)return{scoreString:e,sets:i};let{scoreString:u,removed:c}=jSe({scoreString:e});if(e=u,c)return{scoreString:e,sets:i,outcomeRemoved:!0};let d=i[i.length-1]||{},p=Object.values(d).filter(y=>y!==void 0).length;d.setNumber&&p===1&&(i=i.slice(0,i.length-1),d=i[i.length-1]||{});let{tiebreakSet:h}=t.setFormat,{tiebreakTo:f,NoAD:m}=h||{},{isTiebreakEntry:g}=vT({brackets:gb,scoreString:e}),v=Q7e(e);if(v>=0){o=e.slice(0,v);let{isTiebreakEntry:y}=vT({brackets:Nw,scoreString:o}),{lastOpenBracketIndex:b,isTiebreakEntry:I}=vT({brackets:gb,scoreString:o}),S=o&&o[o.length-1].trim(),w=o&&!isNaN(S),T=t.isIncompleteSetScore;if(g&&I){let U=o.slice(b+1).split(Vh),C=U?.length>0&&U[0]!==void 0&&!isNaN(parseInt(U[0]))&&parseInt(U[0])||void 0,E=U?.length>1&&U[1]!==void 0&&parseInt(U[1])||void 0,P=[C,E];if(E){let M=n===1?1:0;P[M]=(P?.[1-M]||0)+(m?1:2),(P[M]||0)<f&&(P[M]=f),o=e.slice(0,b+1),o+=P.join(Vh)}else C!==void 0?(o=e.slice(0,b+1),o+=C):(o=e.slice(0,b),T=!0);d.side1TiebreakScore=P[0]||0,d.side2TiebreakScore=P[1]||0}if(o.length||(o=void 0),T){let U=(r=d.side1Score)==null?void 0:r.toString();if(U){let C=U?.slice(0,U.length-1);d.side1Score=!isNaN(C)&&parseInt(C)||void 0,d.side1Score===void 0&&(d.side2Score=void 0)}t.isTimedSet?(l=d.side1Score?i:i?.slice(0,i.length-1)||[],l[i.length-1]=d):l=i?.slice(0,i.length-1)||[]}else if(w){let U=(a=d.side2Score)==null?void 0:a.toString(),C=(s=d.side1Score)==null?void 0:s.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(d.side2Score){let E=U?.slice(0,U.length-1);d.side2Score=!isNaN(E)&&parseInt(E)||void 0}else{let E=C?.slice(0,C.length-1);d.side1Score=!isNaN(E)&&parseInt(E)||void 0}t.isTimedSet?d.side1Score?(l=i||[],l[i.length-1]=d):l=i?.slice(0,i.length-1)||[]:(l=i||[],l[i.length-1]=d),l[l.length-1]&&Object.assign(l[l.length-1],{winningSide:void 0})}else y?(l=i||[],Object.assign(l[l.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(g&&!I?l=i?.slice(0,i.length-1)||[]:(l=i,l[i.length-1]=d),g||(l[l.length-1].side2Score=0,l[l.length-1].winningSide=void 0));return{scoreString:o,sets:l}}return{scoreString:e,sets:i}}function vT({brackets:t=Nw,scoreString:e}){if(!e)return{};let[i,n]=t.split(""),r=e.split(""),a=Math.max(...Cp(i,r)),s=Math.max(...Cp(n,r));return{isTiebreakEntry:a>s,lastOpenBracketIndex:a}}function J7e({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[n,r]=gb.split(""),a=t.split(""),s=Math.max(...Cp(n,a)),o=Math.max(...Cp(r,a)),l=Math.max(...Cp(Vh,a));return i&&s>o&&l>s}function Q7e(t){return t.split("").reduce((e,i,n)=>(i.match(/\d+/g)&&e.push(n),e),[]).pop()}function GSe(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:n}=t||{},r=i?1:2;return e+1>=n?e+r:parseInt(n)}function jQ({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:n}){var r;let a=Do(t),{bestOf:s}=a,o=Math.ceil(s/2),l=((r=n?.reduce((u,c)=>{let{winningSide:d}=c;return d&&u[d-1]++,u},[0,0]))==null?void 0:r.indexOf(o))+1||void 0;return z7e.includes(e)&&i&&(l=i),{matchUpWinningSide:l}}function vB({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,isTimedSet:a,set:s}){var o;if(!s)return{error:Xt,info:"missing set"};e=e||i&&Do(i);let l=r&&e.finalSetFormat||e?.setFormat||{},{side1Score:u,side2Score:c}=s,{setTo:d,tiebreakAt:p}=l,h=u||c,f=yB({set:s}),m=Math.abs(u-c),g=u>=d||c>=d,v=n||u>=d&&c>=d||p&&p<d&&(u===p||c===p),y=t||v&&(f===1&&s.side1TiebreakScore>s.side2TiebreakScore||f===2&&s.side2TiebreakScore>s.side1TiebreakScore),b=!v&&l.NoAD||v||n&&(o=l.tiebreakFormat)!=null&&o.NoAD?1:2,I=m>=b;return!!((a&&h||g&&(I||v)||n)&&(!v||y))}function yB({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function R9({analysis:t,set:e}){let i=yB({set:e}),{isDecidingSet:n,isTiebreakSet:r,matchUpScoringFormat:a}=t;return vB({matchUpScoringFormat:a,isDecidingSet:n,isTiebreakSet:r,set:e})&&i}function e8e({analysis:t,scoreString:e,sets:i,value:n}){let r;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];n=ai(n);let{validSide2Score:s,requiresTiebreak:o}=t8e({analysis:t,set:a,value:n});if(s){r=!0,e=(e||"")+n,a.side2Score=n;let l=R9({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,o){let u=Nw.split("")[0];e+=u}else t.isDecidingSet||(e+=XI)}return{sets:i,scoreString:e,updated:r}}function t8e({analysis:t,set:e={},value:i}){let n=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:r,setTo:a,NoAD:s}=n,{side1Score:o}=e,l,u;return r&&r<a?o===r?l=i<=a:l=i<=r:o===a?s?l=i<a:l=i<=a+1:o===a-1?s?l=i<=a:l=i<=a+1:o===a+1?l=i===a||i===a-1:l=i<=a,l&&(r&&r<a?u=o===a&&i===r||o===r&&i===a:u=o>=a&&i>=a&&o!==i),{validSide2Score:l,requiresTiebreak:u}}function HSe({lowSide:t,value:e,sets:i,scoreString:n,winningSide:r,matchUpStatus:a}){let s;return e===NSe?n?(s=!0,n=wS({scoreString:n,lowSide:t,outcome:TSe}),r=t===2?1:2,a=RSe):(s=!0,n=wS({scoreString:n,lowSide:t,outcome:QH}),r=t===2?1:2,a=ez):e===kSe?(s=!0,n=wS({scoreString:n,lowSide:t,outcome:QH}),r=t===2?1:2,a=ez):e===xSe?(s=!0,i=[],n=ISe,r=t===2?1:2,a=ESe):e===ASe&&n?(s=!0,n=wS({scoreString:n,lowSide:t,outcome:SSe}),a=CSe,r=void 0):e===_Se?(s=!0,n=wS({scoreString:n,lowSide:t,outcome:wSe}),a=PSe,r=void 0):e===OSe&&n&&(s=!0,n=wS({scoreString:n,lowSide:t,outcome:USe}),a=MSe,r=void 0),{updated:s,sets:i,scoreString:n,matchUpStatus:a,winningSide:r}}function i8e(t){let{sets:e,info:i,scoreString:n,winningSide:r,matchUpStatus:a}=t,{analysis:s,lowSide:o,value:l}=t,u,c;!(e!=null&&e.length)&&l!==Dx&&(e=[{setNumber:1}]);let d=e.length-1;if(mB.includes(l)){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;h&&!f?i="missing side2Score":s.finalSetIsComplete||r?i="final set is already complete":s.isIncompleteSetScore?i="incomplete set scoreString":s.isIncompleteSetScore||({sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:u}=HSe({lowSide:o,value:l,sets:e,scoreString:n,matchUpStatus:a,winningSide:r}))}else if(l===Dx){if({scoreString:n,sets:e,outcomeRemoved:c}=tz({analysis:s,scoreString:n,sets:e}),n?.trim()===""&&(n=n.trim()),n||(e=[]),c){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;if(h&&f){let m=h>f&&1||f>h&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}a=void 0,r=void 0,u=!0}else if(s.hasOutcome)i="has outcome";else{if(r)return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===gB){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p,m=h>f&&1||f>h&&2||void 0;m&&!r&&!s.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),n+=" ",u=!0)}else if(l===JI&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&n&&s.isNumericEnding)n+="-",e[d].side2Score=0,a=void 0,r=void 0,u=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let h=ai((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=ai(h),p=e[d].side1Score.toString(),u=!0}else{let h=ai((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=ai(h),p=[e[d].side1Score,e[d].side2Score].join("-"),u=!0}if(u){let h=(e.slice(0,d)||[]).filter(f=>f).map(f=>{let{side1Score:m,side2Score:g}=f;return[m,g].join("-")}).join(" ");h?n=h+" "+p:n=p}}}return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,info:i,updated:u}}function n8e({analysis:t,auto:e,lowSide:i,scoreString:n="",sets:r,value:a}){var s;let o,l,{tiebreakSet:{tiebreakTo:u,NoAD:c}}=t.setFormat,[d]=gb.split("");if(t.isMatchTiebreakEntry||(n+=d),r[t.setNumber-1]){let{lastOpenBracketIndex:p}=vT({brackets:gb,scoreString:n}),h=(n.slice((p??0)+1)+(e?"":a)).split(Vh);if((((s=h[i-1])==null?void 0:s.length)||0)>=2)l="tiebreak digit limit";else if(e){i===1&&(h[0]=(h[0]||"")+a),i===2&&(h[1]=(h[1]||"")+a);let f=[h[0]||0,h[1]||0].map(v=>ai(v)),m=i===1?1:0;f[m]=f[1-m]+(c?1:2),f[m]<u&&(f[m]=u);let g=r[r.length-1];g.side1TiebreakScore=f[0],g.side2TiebreakScore=f[1],n=n.slice(0,(p??0)+1),n+=f.join(Vh),o=!0}else{let f=[h[0]||0,h[1]||0].map(g=>ai(g)),m=r[r.length-1];m.side1TiebreakScore=f[0],m.side2TiebreakScore=f[1],n+=a,o=!0}}else{let p=GSe({lowValue:ai(a||0),tiebreakTo:u,NoAD:c}),h=[ai(a),p];i===2&&h.reverse();let f={side1TiebreakScore:h[0],side2TiebreakScore:h[1],setNumber:r?.length+1||1};r.push(f),n+=h.join(Vh),o=!0}return{info:l,scoreString:n,sets:r,updated:o}}function r8e({analysis:t,lowSide:e,scoreString:i,value:n}){let{setTo:r,tiebreakAt:a,NoAD:s}=t?.setFormat||{},o=n===parseInt(a||r);if(a&&a<r&&n>a)return{scoreString:i};if(s&&n===r||n>r)return{scoreString:i};let l=f(),u=[n,l];e===2&&u.reverse();let c=Nw.split("")[0],d=u.join(JI)+(o?c:XI);i=(i||"")+d;let p={side1Score:u[0],side2Score:u[1]},h=R9({analysis:t,set:p});return p.winningSide=h||void 0,{scoreString:i,set:p};function f(){return o?n+1:n+1===r?n+(s?1:2):r}}function a8e({matchUpFormat:t,scoreString:e,winningSide:i,value:n,sets:r}){var a,s,o;let l=(((a=r?.filter(H=>H?.winningSide))==null?void 0:a.length)||0)+(i?0:1),u=Do(t),c=l===u?.bestOf,d=c&&u?.finalSetFormat||u?.setFormat||{},p=d?.timed,h=c&&r[u?.bestOf-1],f=h?.winningSide,{isTiebreakEntry:m}=vT({brackets:Nw,scoreString:e}),{isTiebreakEntry:g}=vT({brackets:gb,scoreString:e}),v=m||g,y=!!d.tiebreakSet,b=(s=e?.[e.length-1])==null?void 0:s.trim(),I=e&&!isNaN(b),S=!v&&b===JI,w=m&&xV.includes(b),T=g&&xV.includes(b),U=g&&b===Vh,C=e?.split(""),[E]=gb.split(""),P=C&&Math.max(...Cp(E,C)),M=C&&Math.max(...Cp(Vh,C)),R=C&&M>P,N=(o=r[r.length-1])==null?void 0:o.winningSide,A=r?.length&&!N,_=DSe.find(H=>e?.indexOf(H)>=0),x=!isNaN(n),O=n===gB,$=Ex.includes(n),F=e?.split("").find(H=>xV.includes(H)),j=$&&g&&!T&&(U||!J7e({scoreString:e}));return{isTiebreakSetValue:y&&x,matchUpScoringFormat:u,setNumber:l,setFormat:d,matchTiebreakHasJoiner:R,isGameScoreEntry:A,isSpace:O,isCloser:$,isTiebreakCloser:$&&F&&v&&I,isDecidingSet:c,isTiebreakSet:y,isTimedSet:p,isNumericEnding:I,isNumericValue:x,hasOpener:F,hasOutcome:_,finalSet:h,finalSetIsComplete:f,lastSetIsComplete:N,isInvalidSetTiebreakValue:O&&v&&w,isInvalidMatchTiebreakValue:j,isTiebreakEntry:v,isSetTiebreakEntry:m,isMatchTiebreakEntry:g,isIncompleteSetScore:S,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:T,isPartialMatchTiebreakValue:U}}function zSe(t){let{lowSide:e=1,value:i}=t,{scoreString:n,sets:r,winningSide:a,matchUpStatus:s}=t,{matchUpFormat:o,shiftFirst:l,auto:u=!0}=t,c,d,p=l&&e===2||!l&&e===1;if(!VSe.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:h}=jQ({sets:r,winningSide:a,matchUpStatus:s,matchUpFormat:o});a=h;let f=a8e({value:i,winningSide:a,scoreString:n,sets:r,matchUpFormat:o});if(FSe.includes(i)&&(i=JI),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&ai(i)===0&&(f.isTiebreakCloser=!0),Ex.includes(i)&&f.hasOpener&&(i=""),Ex.includes(i)&&(i=gB),f.lastSetIsComplete){let m=n?.length&&n[n.length-1];n&&m!==" "&&(n+=" ")}if(f.isTimedSet)({info:d,sets:r,scoreString:n,updated:c,matchUpStatus:s,winningSide:a}=i8e({analysis:f,lowSide:e,scoreString:n,sets:r,matchUpStatus:s,winningSide:a,value:i}));else if(mB.includes(i))f.finalSetIsComplete||a?d="final set is already complete":!f.isTiebreakEntry&&!f.isIncompleteSetScore?{sets:r,scoreString:n,matchUpStatus:s,winningSide:a,updated:c}=HSe({lowSide:e,sets:r,scoreString:n,matchUpStatus:s,winningSide:a,value:i}):f.isTiebreakEntry||f.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===Dx)c=!0,{scoreString:n,sets:r}=tz({analysis:f,scoreString:n,sets:r,lowSide:e}),n||(r=[]),s=void 0,a=void 0;else if(f.hasOutcome)d="has outcome";else if(i===JI&&!f.isMatchTiebreakEntry)(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(c=!0,{scoreString:n,sets:r}=tz({analysis:f,scoreString:n,sets:r,lowSide:e}),s=void 0);else if(i===Vh&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?d="existing joiner":f.isNumericEnding&&(c=!0,n+=Vh);else if([JI,Vh].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:r,scoreString:n,updated:c}=e8e({analysis:f,scoreString:n,sets:r,value:i}));else if(f.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(f.isTiebreakCloser){let m=f.isSetTiebreakEntry?Nw:gb,g=m.split("").reverse()[0],v=m.split("")[0],y=r[r.length-1],{tiebreakFormat:b}=f.setFormat,{tiebreakTo:I,NoAD:S}=b||{},w=yB({set:y});if(!f.isTiebreakSet){let U=parseInt(n.split(v).reverse()[0]),C=GSe({lowValue:U,tiebreakTo:I,NoAD:S});w===1?(y.side1TiebreakScore=C,y.side2TiebreakScore=U):(y.side1TiebreakScore=U,y.side2TiebreakScore=C)}n=(n||"")+g,f.isDecidingSet||(n+=XI);let T=R9({analysis:f,set:y});y.winningSide=T||void 0,c=!0}else if(f.isTiebreakSetValue)({info:d,scoreString:n,sets:r,updated:c}=n8e({analysis:f,auto:u,lowSide:e,scoreString:n,sets:r,value:i}));else if(f.isSetTiebreakEntry){let[m]=Nw.split(""),g=Math.max(...Cp(m,n.split(""))),v=n.slice(g+1),y=v&&ai(v)===Y7e,b=ai(v?v+i:i),{tiebreakFormat:I}=f.setFormat,{tiebreakTo:S,NoAD:w}=I||{};!y&&v.length<2?w&&b>S-1?d="invalid low value for NoAD tiebreak":(c=!0,n=(n||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)d=`invalid key: ${i}`;else if(f.isGameScoreEntry)d="game scoreString entry";else if(f.lastSetIsComplete||!r.length){c=!0;let{scoreString:m,set:g}=r8e({analysis:f,lowSide:e,scoreString:n,value:ai(i)});g&&(g.setNumber=r?.length+1||1),r=r?.concat(g).filter(Boolean)||[g],n=m||void 0}else console.log("error: unknown outcome")}if(c){r=r?.filter(Boolean);let{matchUpWinningSide:m}=jQ({sets:r,winningSide:a,matchUpStatus:s,matchUpFormat:o});return a=m,m&&(!s||[Or,$l].includes(s))?(s=G7e,r=r.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:b,side2TiebreakScore:I}=g;return v||y||b||I})):n&&!a&&![CSe,PSe,MSe].includes(s)&&(s=void 0),{updated:c,scoreString:n,sets:r,winningSide:a,matchUpStatus:s,info:d}}return{updated:c,scoreString:n,sets:r,winningSide:a,matchUpStatus:s,info:d}}var bB="\\d+-\\d+",a1="\\d+-\\d+\\(\\d+\\)",M9="\\[\\d+-\\d+\\]",s8e="\\d+-\\d+\\(\\d+-\\d+\\)",o8e=new RegExp(`(${bB}),`,"g"),l8e=new RegExp(`(${a1}),`,"g"),u8e=[bB,a1,M9,s8e],c8e=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],d8e=c8e.map(t=>{let e=t.split("").map(i=>u8e[i]).join(" ");return new RegExp(`^${e}$`)});function GQ(t){return!t||d8e.some(e=>e.test(t))}function p8e(t){let e="[];",i="()",n=e+i,r=[e[0],i[0]],a=Object.assign({},...n.split("").map(l=>({[l]:0}))),s="",o=t.split("").map(l=>{let u=n.includes(l)&&l,c=r.includes(u);if(c&&u)return a[u]+=1,s=u,l;if(!c&&u&&s&&u!==s){a[s]-=1;let d=e.includes(s)&&e||i.includes(s)&&i||"",p=d.split("").find(h=>h!==s);if(d.includes(u))a[s]||(s="");else return a[u]||(s=""),p}return l}).join("");return t!==o?o:t}function x_(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function h8e(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function IU(t){let e=(i=>i?.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((n,r)=>+n-+r))===1}return!1}function Px(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(r=>parseInt(r.join("")));e&&i.reverse();let n=i;if(Math.abs(n.reduce((r,a)=>+r-+a))>=2)return n.join("-")}function HQ(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function f8e(t){return t.startsWith("(")&&t.endsWith(")")}function m8e({score:t,applied:e}){t=p8e(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let T=w.replace(")",") ");t=t.replace(w,T)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let n=/\(([\d- ]+)\)/g,r=/\(([\d- ]+)\)/,a=t.match(n);for(let w of a||[]){let[T]=w.match(r).slice(1),U=T.replace(/ /g,"");t=t.replace(w,`(${U})`)}let s=/\(\(\d-\d\)\)/g;if(s.test(t)){let w=t.match(s);w.length&&w.forEach(T=>{let U=T.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(T,U)})}if(s=/\(\((\d)\)\)/g,s.test(t)){let w=t.match(s);w.length&&w.forEach(T=>{let U=T.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(T,U)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);t=t.replace(o,"-"),["- "," -"].forEach(w=>{let T=new RegExp(`(\\d+)${w}(\\d+)`,"g"),U=t.match(T);U&&U.forEach(C=>t=t.replace(C,C.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[T]=w.match(/\((\d+), \)/).slice(1);T.length===2?t=t.replace(w,`(${T})`):T.length===1&&T==="6"&&(t=t.replace(w,"(6-0)"))});let u=/\((\d+)\/\)/g;u.test(t)&&t.match(u).forEach(w=>{let[T]=w.match(/\((\d+)\/\)/).slice(1);T.length===2?t=t.replace(w,`(${T})`):T.length===1&&T==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${T})`)});let c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(w=>{let[T]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${T},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[T]=w.match(/\(\/(\d+)\)/).slice(1);T.length===2?t=t.replace(w,`(${T})`):T.length===1&&parseInt(T)<6?t=t.replace(w,`(6-${T})`):t=t.replace(w,`(${T})`)});let p,h,f,m,g,v=()=>{g=Ol(t.split("")),h=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],f=g["["]===g["]"]+1,m=h&&!f};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[w]=t.match(y).slice(1);t=t.replace(y,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(f8e)?t=w.map(T=>{let U=T.slice(1,T.length-1);return U.length>2?U:T}).join(" "):t=w.join(" ")}v();let b=/[A-Za-z]+/.test(t),I=/\d+/.test(t);if(!b&&!I)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],T=0;for(let U of t.split("").reverse())U===")"&&(T?w.push("("):T+=1),U==="("&&(T-=1),w.push(U);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),m){let w="",T=0;for(let U of t.split(""))U==="("&&(T?w+=")":T+=1),U===")"&&(T-=1),w+=U;t=w}v(),f&&!h&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let S=w=>{let T=w.indexOf("("),U=w.indexOf(")");return T>=0&&U>=0&&T<U};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);S(w)&&(t=w,v())}return{score:t,applied:e}}function IB(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=Cp("-",t.split(""));if(!e.length)return t;let i=t.split("-"),n=!(i.length%2),r=!!(e.length%2);return n&&r&&e.length>i.length/2&&e.filter((a,s)=>s%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function g8e({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[o8e,l8e].forEach(i=>{let n=t.match(i);n!=null&&n.length&&(n.forEach(r=>{t=t.replace(r,r.slice(0,r.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(IB).join(" "),{score:t,applied:e}}function v8e({score:t}){if(typeof t!="string")return{score:t};let e=p=>p?.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let n=t.split(" ");t=n.map(p=>{let h=/^-(\d+)$/;if(h.test(p)){let[f]=p.match(h).slice(1);if(f.length===2)return f.split("").join("-")}return p}).join(" "),n=t.split(" ");let r=n.filter(x_),a=0,s="";for(let p of r){let h=Cp(p,n).filter(v=>!a||v>a)[0],f=n.slice(a,h-1),m=n[h-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((b,I)=>+b-+I));if(y===1){let b=[f.join(" "),[m,p].join("")].join(" ");s+=b,a=h+1}else if(y===0){let b=Math.max(...v);if([4,5,6,7,8,9].includes(b)){let I=[6,4].includes(b)?b+1:b-1,S=[b,I].sort().reverse().join("-"),w=[f.join(" "),[S,p].join("")].join(" ");s+=w,a=h+1}}}}if(r.length&&s.length){let p=n.slice(a).join(" ");return s=[s,p].join(" "),{score:s.trim()}}if(n.length===2&&["(","["].some(p=>n[1].includes(p))){let p=e(n[0]).split("");if(Math.abs(p.reduce((h,f)=>+h-+f,0))===1)return n[1]=i(n[1]),{score:n.join("")}}let o=n.map(p=>h8e(p)&&"bracket"||IU(p)&&"set");if(o.includes("set")&&o.includes("bracket")){let p,h="";return n.forEach((f,m)=>{o[m]==="bracket"&&p==="set"?(f=i(f),h+=f):h+=` ${f}`,p=o[m]}),{score:h.trim()}}n=t.split(" ");let l,u=n.map(p=>{let h=new RegExp(/^(\d+)-(\d+)$/);if(h.test(p)){let[f,m]=p.match(h).slice(1),g=Math.abs([f,m].reduce((y,b)=>+y-+b)),v=Math.max(f,m);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),c=Cp("tiebreak",u);if(c.length){let p="";n.forEach((h,f)=>{c.includes(f)?p+=`(${h}) `:c.includes(f+1)?p+=`${h}`:p+=`${h} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,h,f]=t.match(d).slice(1),m=Math.max(h,f)>=10;!IU(p)&&m&&(t=t.replace(d,`${p} [${h}-${f}]`))}return u=[],t=t.split(" ").map(p=>{let h=/^\((.*)\)$/,f=h.test(p),m=new RegExp(M9).test(p)&&"super"||new RegExp(a1).test(p)&&"tiebreak"||new RegExp(bB).test(p)&&"standard"||"unknown";return u.push(m),m==="standard"&&f?p.match(h)[1]:p}).join(" "),{score:t}}function y8e({score:t,applied:e}){for(let U of[".",","," ","/"]){let C=new RegExp(`^(\\d+)\\${U}(\\d+)$`);if(C.test(t)){let E=t.match(C).slice(1).map(M=>parseInt(M)),P=Math.abs(E[0]-E[1]);P<=10&&P>=2&&(t=t.split(U).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[U,C,E,P,M,R]=t.match(i).slice(1);t=t.replace(i,`${U}${C}-${E} ${P}-${M}${R}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let n=/\(6,\)/g;n.test(t)&&(t=t.replace(n,"(6, 0)"),e.push("missingZeroPattern1"));let r=/^\d{3,}\(/,a=/\(\d+\)\d+/;[r,a].forEach(()=>{t=t.split(" ").map(U=>(r.test(U)&&(U=U.replace("("," (")),a.test(U)&&(U=U.replace(")",") ")),U)).join(" "),e.push("spaceConsiderationPatterns")});let s=IB(t);s!==t&&(t=s,e.push("deDashMash"));let o=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(o.test(t)){let[U,C,E]=t.match(o).slice(1),[P,M]=C.split("");t=`${U}-${P} ${M}-${E}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(t)){let[U,C]=t.match(u).slice(1),E=U.trim(),P=C.trim();if(l.test(E)&&l.test(P)){let M=E.match(l).slice(1,3).join("-"),R=P.match(l).slice(1,3).join("-");t=`${M} ${R}`,e.push("slashSeparationPattern")}}let c=/^([\d -]+),([\d -]+)$/;if(c.test(t)){let[U,C]=t.match(c).slice(1),E=U.trim(),P=C.trim();if(l.test(E)&&l.test(P)){let M=E.match(l).slice(1,3).join("-"),R=P.match(l).slice(1,3).join("-");t=`${M} ${R}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let U=t.match(d)[0],C=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,C),e.push("singleSetCommaSeparationPattern")}let p=0,h=/(\d+)-(\d{2})-(\d+)/;for(;h.test(t)&&p<3;){let[U,C,E]=t.match(h).slice(1),P=C.split(""),M=`${U}-${P[0]} ${P[1]}-${E}`;t=t.replace(h,M),e.push("noSetSeparationPattern"),p+=1}let f=/(^|\s)7-6\s(\d+)\s/g,m=t.match(f);if(m!=null&&m.length){let U=/(^|\s)7-6\s(\d+)\s/;m.forEach(C=>{let E=C.match(U).slice(2)[0];t=t.replace(C,`7-6(${E}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g?.forEach(U=>{let C=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,C),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g?.forEach(U=>{let C=" "+U.slice(1).split(" ").join("-");t=t.replace(U,C),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let U=t.match(v)[0],C=U.split("/").map(E=>`(${E})`).join(" ")+" ";t=t.replace(U,C),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let b=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(b.test(t)){let U=t.match(b),C=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),E=t;U.forEach(P=>{let[M,R]=P.match(C).slice(1),N=`${M}-${R}`;E=E.replace(P,N)}),t=E,e.push("slashSetPattern")}let I=/(.*)\s(1\d)\s(\d+)$/;if(I.test(t)){let[U,C,E]=t.match(I).slice(1);U.replace(/\D/g,"").length>=4&&(t=U+` ${C}${E}`,e.push("spaceSeparatedSuperPattern"))}let S=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let U of t.match(S)||[]){let[C,E,P,M]=U.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[R,N]=E.split("-").map(A=>parseInt(A));Math.abs(R-N)===1&&(t=t.replace(U,`${C}${E}(${P})${M}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let U of t.match(w)||[]){let C=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[E,P,M]=U.match(C).slice(1),[R,N]=E.split("-").map(A=>parseInt(A));Math.abs(R-N)===1&&(t=t.replace(U,`${E}(${P})${M}`),e.push("floatingTiebreakPattern2"))}let T=/(^|\s)(\d \d)\(/g;for(let U of t.match(T)||[]){let C=/(^|\s)(\d \d)\(/,[E,P]=U.match(C).slice(1);t=t.replace(U,`${E}${P.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function b8e({score:t,matchUpStatus:e}){var i;let n=t?.split(" ");t=n.map(l=>{if(l.endsWith("]")){let u=l.split("[");if(IU(u[0]))return u[0]+`(${u[1].slice(0,u[1].length-1)})`}return l}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let l of t.match(r)){let u=(i=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:i[1];if(Ir(u)&&u?.[0]>2){if([2,4].includes(u.length))u=u.split("").join("-");else if(u.length===3){let c=u.indexOf("1");u=Px(u.split(""),c)}}t=t.replace(l,`(${u})`)}n=t?.split(" ");let a=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),s=n.length-1;t=n.map((l,u)=>{let c=[void 0,"","COMPLETED"].includes(e)||u!==s;if(a.test(l)&&c){let[d,p,h]=Array.from(l.match(a)).slice(1),f=Math.min(p,h);return`${d}(${f})`}return l}).join(" "),n=t?.split(" "),a=new RegExp(/^(\d{2})\((\d+)\)$/),t=n.map(l=>{if(a.test(l)){let[u,c]=Array.from(l.match(a)).slice(1),d=u.split("");return`${d[0]}-${d[1]}(${c})`}return l}).join(" "),n=t?.split(" "),a=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=n.map(l=>{if(a.test(l)){let[u,c]=Array.from(l.match(a)).slice(1);return IU(u)?`${u}(${c})`:u}return l}).join(" "),n=t?.split(" "),a=new RegExp(/^1-0\((\d+)\)$/),t=n.map(l=>{if(a.test(l)){let[u]=l.match(a).slice(1);return`[${u<9?10:parseInt(u)+2}-${u}]`}return l}).join(" ");let o=/\((\d)+0 /;if(o.test(t)){let l=t.match(o)[1];t=t.replace(o,`(${l}) `)}return{score:t}}function I8e({score:t,attributes:e,identifier:i}){var n,r,a;if(typeof t!="string")return{score:t,identifier:i};let s=new RegExp(/\([\d,/ ]+\)/g),o=t.match(s);for(let h of o||[]){let f=(r=(n=h.match(/^\((.*)\)$/))==null?void 0:n.slice(1))==null?void 0:r[0],m=t.split(h)[0].split(")").reverse()[0].replace(/\D/g,"");if(f?.length===2&&m?.length>=2){let y=m.slice(m.length-2).split("").map(b=>parseInt(b));if(Math.abs(y[0]-y[1])===1)continue}let g=HQ(f),v=IB(g);t=t.replace(h,`(${v})`).trim()}let l=new RegExp(/\[[\d,/ ]+\]/g);(a=t.match(l))==null||a.forEach(h=>{let f=HQ(h.match(/^\[(.*)\]$/)[1]);t=t.replace(h,`(${f}) `).trim()});let u=[")","]"],c=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&u.some(h=>t.endsWith(h))&&c.some(h=>t.includes(h))){let h="",f=t.split(/[)\]]/).filter(Boolean).map(b=>(b.startsWith(",")&&(b=b.slice(1)),b.trim())),m=f.every(b=>b.includes(",")||x_(b)),g=f.every(b=>b.includes("/")||x_(b)),v=f.every(b=>b.includes("-")||x_(b)),y=m&&","||v&&"-"||g&&"/";if(y){let b;f.forEach(I=>{if(I.startsWith("("))if(b==="set"&&(h+=" "),I.includes(y))h+=I.slice(1).split(y).map(S=>S.trim()).join("-"),b="set";else{let S=I.slice(1);h+=`(${S}) `,b="tiebreak"}else if(I.startsWith("[")){let S=I.slice(1).split(y).map(T=>parseInt(T.trim())),w=Math.min(...S);b==="set"?h+=`(${w}) `:h+=`[${S.join("-")}] `,b="tiebreak"}}),t=h.trim()}}let d=Ol(t.split(""));d["("]===1&&d[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),d["-"]===1&&IU(t)&&Ir(e?.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let p=/\(\)/g;return p.test(t)&&(t=t.replace(p,"").trim()),{score:t}}function qSe({score:t}){let e=t.split(""),i=[],n,r=()=>n=[void 0,void 0,void 0],a=()=>{let o=`${n[0]}-${n[1]}`;return n[2]&&(o+=` (${n[2]})`),r(),n.push(n),o};r();let s=()=>n[0]!==void 0&&n[1]!==void 0&&Math.abs(parseInt(n[0])-parseInt(n[1]));for(;e.length;){let o=e.shift(),l=Ir(o)&&parseInt(o),u=n[0]!==void 0&&n[1]!==void 0;if(Ir(l)){if(n[0]===void 0){n[0]=l;continue}if(n[1]===void 0&&(n[1]=l,s())){i.push(a()),n=[void 0,void 0];continue}if(u&&e.length===1&&Ir(e[0])){let c=e.pop();n[0]=n[0].toString()+n[1].toString(),n[1]=c,i.push(a()),n=[void 0,void 0]}u&&s()}}return{sets:i}}function iz(t){let e=t.indexOf("1"),i=t.split(""),n=i.every(r=>!isNaN(r));if(n&&t.length===3&&e===0){let r=Px(i,e);if(r)return r}if(n&&t.length===7&&e>3){let r=i.slice(4),a=Px(r,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function WSe(t){let{score:e}=t,{applied:i,matchUpStatus:n}=t,r=e?.toString().split(""),a=r?.every(o=>Ir(o)),s=o=>Math.abs(o[0]-o[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=r.join(""));let o=a?r.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(qSe({score:e}),o.length,e.length===3&&s(o.slice(0,2))===1){let[l,u,c]=o;e=`${l}-${u}(${c})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&o[0]===1){let[l,u,c]=o;e=`[${l}${u}-${c}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&s(o.slice(0,2))===1&&"987654".split("").includes(o[0].toString())){let[l,u,c,d]=o,p=Math.min(c,d);e=`${l}-${u}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&o[0]===1&&o[2]===1){let[l,u,c,d]=o;e=`[${l}${u}-${c}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,u,c,d]=o;e=`${l}${u} ${c}${d}`,i.push("split4")}else if(e.length===5&&s(o.slice(0,2))===1){let[l,u,c,d,p]=o;e=`${l}-${u}(${c}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&s(o.slice(3))===1){let[l,u,c,d,p]=o;e=`${l}-${u} ${c}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(o.length===7)if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&o[4]===1){let[l,u,c,d,p,h,f]=o;e=`${l}-${u} ${c}-${d} [${p}${h}-${f}]`,i.push("numericTiebreakPattern6")}else if(s(o.slice(0,2))===1&&s(o.slice(3,5))>1&&s(o.slice(5,7))>1){let[l,u,c,d,p,h,f]=o;e=`${l}-${u}(${c}) ${d}-${p} ${h}-${f}`,i.push("numericTiebreakPattern7")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))===1&&s(o.slice(5,7))>1){let[l,u,c,d,p,h,f]=o;e=`${l}-${u} ${c}-${d}(${p}) ${h}-${f}`,i.push("numericTiebreakPattern8")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&s(o.slice(4,6))===1){let[l,u,c,d,p,h,f]=o;e=`${l}-${u} ${c}-${d} ${p}-${h}(${f})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=iz(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=ka(e.split(""),2).map(g=>g.join("")),u=l.map(g=>{let[v,y]=g.split("").map(S=>parseInt(S)),b=Math.abs(v-y),I=v>y?1:2;return b>1&&I||I*-1}),c=u.reduce((g,v)=>g>0&&v>0,1),d=Ol(u),p=u.map(g=>Math.abs(g)),h=Ol(p),f=u[0]<0,m=!f&&u[1]<0;if(u[0]>0&&u[1]>0&&u[0]!==u[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(c)e=l.join(" "),i.push("chunkSplit");else if(o.length===6){if(d[1]===2||d[2]===2)if(!Object.values(h).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,y,b,I,S]=o,w=u.reduce((T,U,C)=>U<0?C:T,void 0);if(w===0){let T=Math.min(y,b);e=`${g}-${v}(${T}) ${I}-${S}`,i.push("chunkSplitTiebreak1")}else if(w===1){let T=Math.min(I,S);e=`${g}-${v} ${y}-${b}(${T})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${y}-${b}`,i.push("chunkSplitTrimExtraneous")}}else if(o.length===8){let[g,v,y,b,I,S,w,T]=o;f||m?o[5]===1&&(f?e=`${g}-${v}(${y}) ${b}-${I} [${S}${w}-${T}]`:e=`${g}-${v} ${y}-${b}(${I}) [${S}${w}-${T}]`):(u[0],u[1])}}}return{score:e,applied:i,matchUpStatus:n}}function YSe(t){let e=[0,0],i=[],n=t.split(" "),r=/(\d+)-(\d+)/;n.forEach(l=>{if(r.test(l)){let u=l.match(r).slice(1).map(d=>parseInt(d)),c=u[0]>u[1]&&1||u[1]>u[0]&&2;c&&(e[c-1]+=1,i.push(c))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,s=e[0]>0&&e[0]===e[1],o=e.reduce((l,u)=>l+u,0);return{setsWon:e,setsTied:s,setWinners:i,totalSets:o,winningSide:a}}function w8e({score:t,matchUpStatus:e,attributes:i}){let n=[],r,a=t.split(" "),s=a.length;t=a.map((c,d)=>{if(new RegExp(a1).test(c)){let h=c.slice(3),f=c.slice(0,3),m=f.split("-");if(!IU(f)&&!e){let g=Math.max(...m),v=f.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+h}}else if(c.length===2&&Ir(c))return c.split("").join("-");c=IB(c);let p=new RegExp(`^${M9}$`).test(c)&&"super"||new RegExp(`^${a1}$`).test(c)&&"tiebreak"||new RegExp(`^${bB}$`).test(c)&&"standard"||"unknown";if(n.push(p),s>1&&p==="standard"&&d<2){let[h,f]=c.split("-"),m=Math.abs(parseInt(h)-parseInt(f)),g=Math.max(h,f),v=Math.min(h,f),y=[parseInt(h),parseInt(f)].indexOf(v);if(g>9&&m>2){let b=g.toString().split(""),I=b.find(S=>parseInt(S)>v||d&&parseInt(S)<=r)??b[0];I&&(c=y?[I,v].join("-"):[v,I].join("-"))}g>(r||0)&&(r=g)}if(p==="standard"){let[h,f]=c.split("-");if(!Math.abs(parseInt(h)-parseInt(f))&&e!=="RETIRED")return""}return c}).filter(Boolean).join(" ");let{setsWon:o,setWinners:l,totalSets:u}=YSe(t);if(u===1&&i?.removed==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...o)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...o)>2){let c=[0,0];t=t.split(" ").map((d,p)=>(c[l[p]]+=1,Math.max(...c)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:n}}function S8e({score:t}){let{setsTied:e,winningSide:i}=YSe(t),n=/\s\((\d+)\)$/;if(!i&&e&&n.test(t)){let o=t.match(n).slice(1)[0],l=o<=8?10:o+2;t=t.replace(n,` [${l}-${o}]`)}let r=t.split(" "),a=r[r.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let s=a.split("(").join("").split(")").join("").split("-");if(!s.every(o=>Ir(o)))return{score:t};if(s[0]==="76"){let o=s[1].length===2?Math.min(...s[1].split("").map(l=>parseInt(l))):s[1];t=[...r.slice(0,r.length-1),`7-6(${o})`].join(" ")}else{s=s.map(u=>parseInt(u));let o=Math.max(...s),l=Math.abs(s[0]-s[1]);if(o>=10){if(l>2&&s.every(u=>+u>=10)){let u=s.map(c=>c===o?c-10:10).sort();l=Math.abs(u[0]-u[1]),l>2&&(s=u)}t=[...r.slice(0,r.length-1),`[${s.join("-")}]`].join(" ")}else r.length===3&&o>=7&&l>2&&(t=[...r.slice(0,r.length-1),`[${s.join("-")}]`].join(" "))}return{score:t}}function T8e({score:t}){return t=t?.toString().toLowerCase()||"",{score:t}}function U8e({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function D8e({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let n=i.indexOf("1");if(i.length%2){if(i.length===3&&n===0){let r=Px(i.split(""),n);return e.push("getSuper"),r}}else{let{score:r,applied:a}=WSe({score:i,applied:[]});r!==i&&(i=r,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function E8e({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&iz(t)?{score:iz(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function P8e({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t?.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function C8e({score:t,profile:e,applied:i}){var n;t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[o]=t.match(r).slice(1);return i.push("handleRetired"),{score:o.trim(),matchUpStatus:"retired",applied:i}}let a=(n=e?.matchUpStatuses)==null?void 0:n.retired,s=["rtd",...Array.isArray(a)?a:[a].filter(Boolean)].find(o=>t?.endsWith(o));return s?(i.push("handleRetired"),{matchUpStatus:"retired",score:t?.replace(s,"").trim(),applied:i}):{score:t}}function R8e({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(r=>t.endsWith(r))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(r=>t.includes(r));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let n=/(.*)[A-Za-z]+$/;return n.test(t)&&(t=t.match(n).slice(1)[0].trim()),{score:t,attributes:e}}function M8e({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function N8e({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(r=>e.test(r))&&(t=i.map(r=>e.test(r)?r.replace("/","-"):r).join(" "));let n=/^(\d+), *(\d+)$/;if(n.test(t)){let[r,a]=t.match(n).slice(1);t=[r,a].join("-")}return{score:t}}function A8e({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let n of i||[]){let r=n.replace("/","-");t=t.replace(n,r)}return{score:t}}function _8e({score:t}){if(t.includes(",")){let e=t.split(",").map(n=>n.trim()),i=n=>/\d \d/.test(n);e.every(i)&&(t=e.map(n=>{let r=/\d+ \d+/g;for(let a of n.match(r)){let[s,o]=a.match(/(\d+) (\d+)/).slice(1);n=n.replace(a,`${s}-${o}`)}return n}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Ir(i))&&e.length===4&&(t=e)}return{score:t}}function k8e({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var x8e={handleTiebreakSlashSeparation:A8e,handleSetSlashSeparation:M8e,punctuationAdjustments:m8e,handleGameSeparation:N8e,joinFloatingTiebreak:v8e,handleBracketSpacing:g8e,handleSpaceSeparator:_8e,separateScoreBlocks:D8e,matchKnownPatterns:y8e,removeDanglingBits:R8e,removeErroneous:E8e,handleWalkover:P8e,properTiebreak:b8e,handleNumeric:WSe,handleRetired:C8e,containedSets:I8e,sensibleSets:w8e,stringScore:T8e,superSquare:S8e,setBuilder:qSe,excisions:k8e,replaceOh:U8e},OV={},O8e=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],L8e=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function KSe(t){if(!t.score)return{error:Ce};let{score:e,sheetName:i,identifier:n,fileName:r,stepLog:a,fullLog:s,profile:o}=t,l=[],u,c=[],d,p,h=e,f=g=>{g.forEach(v=>{p=x8e[v]({profile:o,identifier:n,matchUpStatus:u,attributes:d,applied:c,score:h});let y=p.score!==h;y&&l.push({method:v,score:p.score}),a&&(s||y||p.matchUpStatus!==u)&&console.log(u?{score:p.score,matchUpStatus:u}:{score:p.score},v),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(c=p.applied),h=p.score})};f(O8e);let m=GQ(h);return m||(h=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),f(L8e),m=GQ(h),m||(h="")),c.forEach(g=>{OV[g]||(OV[g]=0),OV[g]+=1}),{matchUpStatus:u?.toUpperCase(),modifications:l,attributes:d,isValid:m,score:h}}var ZSe={};$i(ZSe,{analyzeScore:()=>N9,analyzeSet:()=>s1,checkScoreHasValue:()=>Sa,checkSetIsComplete:()=>vB,getSetComplement:()=>_9,getTiebreakComplement:()=>wB,isValidMatchUpFormat:()=>Ll,parseScoreString:()=>Cx,validateScore:()=>A9,validateTieFormat:()=>Bo});function N9({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){var a,s;let o=r?.sets??[],l=(o?.filter(T=>T?.winningSide)||[]).reduce((T,U)=>{let{winningSide:C}=U;if(!C)return T;let E=C-1;return T[E]++,T},[0,0]),u=n?n-1:void 0,c=u!==void 0?1-u:void 0,d=u!==void 0&&l[u],p=c!==void 0&&l[c],h=e?Do(e):void 0,f=Math.max(...l),m=Ol(l)[f],g=((a=h?.setFormat)==null?void 0:a.timed)||((s=h?.finalSetFormat)==null?void 0:s.timed),v=h?.bestOf,y=v&&Math.ceil(v/2)||1,b=i??t,I=b&&[Wi,os,ln].includes(b),S=!h||!o.length||o.every((T,U)=>{let C=U+1,E=C===v,P=C===o.length,{side1Score:M,side2Score:R,side1TiebreakScore:N,side2TiebreakScore:A,winningSide:_}=T,x=Math.max(M??0,R??0),O=N??A,{finalSetFormat:$,setFormat:F}=h,j=E&&$||F;if(O){let{tiebreakTo:H,NoAD:G}=j?.tiebreakFormat||{},W=Math.max(N??0,A??0);if(G&&W>H||W<H&&_&&(P&&!I||!P))return!1}return j.setTo?!(!j.noTiebreak&&x>j.setTo+1):!0}),w=(!e||f===y)&&m===1&&l.indexOf(f)+1||void 0;return{valid:!!(S&&(n&&d>p&&n===w||n&&I||!n&&!w&&(![kr,Wi,os,ln].includes(b)||g&&b===kr)))}}function A9({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){if(typeof r!="object")return{error:Ce};let{sets:a,scoreStringSide1:s,scoreStringSide2:o}=r,l="scoreString must be a string!";if(s!==void 0&&typeof s!="string")return{error:Ce,info:l};if(o!==void 0&&typeof o!="string")return{error:Ce,info:l};if(a!==void 0&&!Array.isArray(a))return{error:Ce,info:hb("sets")};if(a!=null&&a.length){let u=a.map(d=>d?.setNumber).filter(Boolean);if(u.length!==Si(u).length)return{error:Ce,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:h,side1TiebreakScore:f,side2TiebreakScore:m,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:b}=d;if(![[p,h],[f,m],[g,v]].filter(I=>I.some(S=>![void 0,null].includes(S))).every(I=>I.every(S=>bi(S))))return{error:Ce,info:"non-numeric values"};if(![b,y].filter(I=>![void 0,null].includes(I)).every(I=>bi(I)))return{error:Ce,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:Ce,info:"winningSide must be 1 or 2"}}let{valid:c}=N9({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:n,score:r});if(!c)return{error:uye,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var _9=t=>{let{isSide1:e,lowValue:i,setTo:n,tiebreakAt:r,NoAD:a}=t;if(i===void 0)return!1;let s=ai(i);s?.toString().length>2&&(s=parseInt(s.toString().slice(0,2))),r&&r<n&&s>r&&(s=r);let o;return a&&!r?(s>n&&(o=n),o=s<n?n:n-1):o=s+1<n&&n||r&&r<n&&s===r&&n||!r&&s+2||n+1,[e?s:o,e?o:s]},wB=t=>{let{isSide1:e,lowValue:i,tiebreakTo:n,tiebreakNoAd:r}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;a?.toString().length>2&&(a=parseInt(a.toString().slice(0,2))),r&&a>n-1&&(a=n-1);let s=F8e({lowValue:a,NoAD:r,tiebreakTo:n});return[e?a:s,e?s:a]};function F8e(t){let{lowValue:e,NoAD:i,tiebreakTo:n}=t,r=i?1:2;return e+1>=n?e+r:n}function Cx({tiebreakTo:t=7,scoreString:e=""}){return e?.split(" ").filter(Boolean).map((n,r)=>i({set:n,setNumber:r+1}));function i({set:n,setNumber:r}){let a=/\(([^)]+)\)/,s=/\[([^)]+)\]/,o=a.exec(n),l=s.exec(n),u=n?.startsWith("[")&&l&&l[1].split("-").map(b=>parseInt(b)),c=o&&n.replace(o[0],"")||l&&n.replace(l[0],"")||n,d=!u&&c.split("-").map(b=>parseInt(b)),p=u?u[0]>u[1]&&1||u[0]<u[1]&&2||void 0:d[0]>d[1]&&1||d[0]<d[1]&&2||void 0,h=o?o[1]:void 0,f=(h&&wB({lowValue:h,isSide1:p===2,tiebreakTo:t}))??[],[m,g]=d||[],[v,y]=u||f||[];return{side1Score:m,side2Score:g,side1TiebreakScore:v,side2TiebreakScore:y,winningSide:p,setNumber:r}}}function $8e({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:n,setObject:r}){if(!r)return;let a=yB({set:r});return vB({matchUpScoringFormat:t,set:r,isDecidingSet:e,isTiebreakSet:i,isTimedSet:n})&&a||void 0}function s1(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:a$};let{setNumber:n}=e||{},{bestOf:r,exactly:a}=i||{},s=r||a,o=!!(n&&s&&n===s),l=o&&i?.finalSetFormat||i?.setFormat,u=!!(l!=null&&l.tiebreakSet),c=!!(l!=null&&l.timed),d=!u&&!c,p=!!(n&&s&&n<=s),h=[e?.side1Score,e?.side2Score],f=[e?.side1PointScore,e?.side2PointScore],m=[e?.side1TiebreakScore,e?.side2TiebreakScore],g=h.filter(O=>O!==void 0).length,v=f.filter(O=>O!==void 0).length,y=m.filter(O=>O!==void 0).length,b=h?.filter(O=>!isNaN(O)).length,I=m?.filter(O=>!isNaN(O)).length,{tiebreakAt:S}=l||{},w=S&&h.filter(O=>O>=S).length===2,T=w&&(h[0]>h[1]&&1||h[1]>h[0]&&2||void 0),U=!!(I&&!b),C=!!(e!=null&&e.winningSide),{error:E,result:P}=B8e({sideTiebreakScores:m,sideGameScores:h,setFormat:l,setObject:e}),{error:M,result:R}=V8e({sideTiebreakScores:m,setObject:e,setFormat:l}),N=d&&!U&&P||u&&U&&R||c,A=p&&!(u&&!U)&&!(d&&U)&&(!C||N),_=$8e({isTimedSet:c,matchUpScoringFormat:i,isDecidingSet:o,isTiebreakSet:U,setObject:e}),x={expectTiebreakSet:u,expectTimedSet:c,hasTiebreakCondition:w,isCompletedSet:C,isDecidingSet:o,isTiebreakSet:U,isValidSet:A,isValidSetNumber:p,isValidSetOutcome:N,leadingSide:T,setFormat:l,sideGameScores:h,sideGameScoresCount:g,sidePointScores:f,sidePointScoresCount:v,sideTiebreakScores:m,sideTiebreakScoresCount:y,winningSide:_};return e?.winningSide!==void 0&&(U?(x.isValidTiebreakSetOutcome=R,R||(x.tiebreakSetError=M)):(x.isValidStandardSetOutcome=P,P||(x.standardSetError=E))),x}function B8e({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:n}){if(!t)return{result:!1,error:a$};let r=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||r||a)return{result:!1,error:Ce};if(i?.filter(T=>!isNaN(T)).length!==2)return{result:!1,error:bH};let{setTo:s,tiebreakAt:o,tiebreakFormat:l,NoAD:u}=e||{};if(!(s&&i!=null&&i.find(T=>T>=s)))return{result:!1,error:bH};let c=[1,2].includes(t?.winningSide);if(!t||!c)return{result:!1,error:s$};let d=t?.winningSide-1,p=1-d,h=i[d],f=i[p],m=h-f;if(!(h>f))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=o&&l,v=n?.filter(T=>!isNaN(T)).length===2,y=n?.[d],b=n?.[p],I=o&&i.filter(T=>T>=o).length===2;if(g){let{NoAD:T,tiebreakTo:U}=l;if(I){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(U))return{result:!1,error:{message:"tiebreakTo error"}};if(!(U&&n!=null&&n.find(R=>R>=U)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let C=o<s?s:s+1;if(h>C)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!b||y<b)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let E=T?1:2,P=y-b,M=b>=U-1;if(P&&M&&P<E)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(h>s&&!I)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let S=u?1:2,w=f>=s-1;return m&&w&&!I&&m<S?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>S&&h>s?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function V8e({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:a$};let n=!!(e!=null&&e.tiebreakSet),r=!!(e!=null&&e.timed);if(!e||!n||r)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t?.winningSide);if(!t||!a)return{result:!1,error:s$};let{tiebreakSet:s}=e||{},{NoAD:o,tiebreakTo:l}=s||{};if(i?.filter(g=>!isNaN(g)).length!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=t?.winningSide-1,c=1-u,d=i[u],p=i[c];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let h=o?1:2,f=d-p,m=p>=l-1;return f&&m&&f<h?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}function j8e(t){var e,i,n;let{existingDrawDefinition:r,hydrateCollections:a,enforceGender:s,tieFormatName:o,matchUpType:l,eventType:u,isMock:c,event:d}=t,{tieFormat:p,matchUpFormat:h}=t;if(l===aa&&u===aa){let f=(i=(e=r?.structures)==null?void 0:e.find(({stage:m})=>m===_t))==null?void 0:i.tieFormat;p=p||f||o&&((n=d?.tieFormat)==null?void 0:n.tieFormatName)===o&&d.tieFormat||o&&Um({namedFormat:o,hydrateCollections:a,isMock:c,event:d})||d?.tieFormat||Um({event:d,isMock:c,hydrateCollections:a}),h=void 0}else h||(p=void 0,d!=null&&d.matchUpFormat||(h=Kc));if(p){let f=Bo({gender:d?.gender,enforceGender:s,tieFormat:p});if(f.error)return f}return{tieFormat:p,matchUpFormat:h}}function G8e(t){var e,i,n,r,a;let s=t.drawDefinition,{existingQualifyingPlaceholderStructureId:o,appliedPolicies:l,drawEntries:u,structureId:c,idPrefix:d,isMock:p,event:h}=t,f=t.qualifyingProfiles,m=f!=null&&f.length?Z0e({uuids:t.uuids,qualifyingProfiles:f,appliedPolicies:l,idPrefix:d,isMock:p}):void 0;if(m!=null&&m.error)return m;s.structures=(e=s.structures)==null?void 0:e.filter(({structureId:U})=>U!==o),s.links=(i=s.links)==null?void 0:i.filter(({source:U})=>U.structureId!==o);let{qualifiersCount:g,qualifyingDrawPositionsCount:v,qualifyingDetails:y}=m??{};v&&(m!=null&&m.structures&&((n=s.structures)==null||n.push(...m.structures)),m!=null&&m.links&&((r=s.links)==null||r.push(...m.links)));let b=(a=s.structures)==null?void 0:a.find(({stage:U,stageSequence:C})=>U===_t&&C===1),{qualifiersCount:I}=HD({stageSequence:1,drawDefinition:s,structureId:c,stage:_t}),S=Math.max(g??0,I??0),w=Jwe({qualifiersCount:S,drawDefinition:s,stage:_t});if(w.error||(w=Sx({drawSize:v,stage:Kt,drawDefinition:s}),w.error))return w;H8e({drawDefinition:s,drawEntries:u,event:h});let T=z8e({mainStructure:b,qualifyingDetails:y,drawDefinition:s});return T.error?T:{drawDefinition:s,structureId:c}}function H8e({drawDefinition:t,drawEntries:e,event:i}){for(let n of(e??[]).filter(({entryStage:r})=>r===Kt)){let r={...n,entryStage:n.entryStage??_t,drawDefinition:t,event:i};N8(r)}}function z8e({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var n;for(let r of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:s,roundTarget:o,finishingPositions:l,linkType:u}=r,c=t&&((n=iN({targetStructureId:t.structureId,sourceStructureId:s,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:o,linkType:u}))==null?void 0:n.link);if(c!=null&&c.error)return c;c&&(i.links||(i.links=[]),i.links.push(c))}return{error:void 0}}function XSe(t){var e,i;let{participantIds:n}=t,r=((i=(e=t.drawDefinition)==null?void 0:e.entries)==null?void 0:i.filter(a=>{let s=a.entryStatus;return!t.restrictEntryStatus||yd.includes(s)}).map(Gi))??[];if(n){let a=n.filter(s=>!(r!=null&&r.includes(s)));if(a!=null&&a.length)return pe({result:{error:Hd},info:{invalidParticipantIds:a}})}else n=r;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>n.length-1&&(!t.enableDoubleRobin||t.roundsCount>(n.length-1)*2)?{error:Ce,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:Ce,info:"roundsCount must be less than 32"}:{participantIds:n}}function k9(t){var e;let i=[],{roundsCount:n=1,drawDefinition:r,matchUpsCount:a,structureId:s,idPrefix:o,isMock:l,event:u}=t,c,d=XSe(t);if(d.error)return d;for(let p of Et(1,n+1)){let h=fB({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!c,newRound:!c,drawDefinition:r,matchUpsCount:a,structureId:s,roundNumber:c,idPrefix:o,isMock:l,event:u});if(h.error)return pe({result:h,info:{iteration:p}});(e=h.matchUps)!=null&&e.length&&i.push(...h.matchUps),c=(h?.roundNumber??1)+1}return{matchUps:i}}function q8e(t){var e;let{tournamentRecord:i,participantIds:n,scaleName:r,eventType:a,adHocRatings:s={}}=t,o=t.scaleAccessor??((e=Ra[r])==null?void 0:e.accessor),l=i.participants??[];for(let u of n??[]){let c=l?.find(p=>p.participantId===u),d=zQ({scaleName:`${r}.${H7}`,participant:c,eventType:a});!d&&r&&(d=zQ({scaleAccessor:o,participant:c,scaleName:r,eventType:a})),d&&!s[u]&&(s[u]=d)}return s}function zQ({scaleType:t=Vg,scaleAccessor:e,participant:i,scaleName:n,eventType:r}){var a,s;let o=(s=(a=i&&$h({scaleAttributes:{eventType:r??Tw,scaleType:t,scaleName:n},participant:i}))==null?void 0:a.scaleItem)==null?void 0:s.scaleValue;return e&&Qi(o)?o[e]:o}function x9(t){var e,i;let n=Y8e(t);if(n!=null&&n.error)return n;let r=XSe(t);if(r.error)return r;let a=W8e(t);if(a.error)return a;let s=q8e(t),o=((e=t.tournamentRecord)==null?void 0:e.isMock)??t.isMock,l=t.eventType??((i=t.event)==null?void 0:i.eventType),u=[],c=[],d;for(let p of Et(1,(t.roundsCount??1)+1)){let h=U9({...t,participantIds:r.participantIds,structure:a.structure,ignoreLastRoundNumber:!0,iterationMatchUps:u,adHocRatings:s,roundNumber:d,eventType:l,isMock:o});if(h.error)return h;let{matchUps:f,...m}=h;m.modifiedScaleValues&&(s=m.modifiedScaleValues),c.push({...m,iteration:p,matchUpsCount:f?.length}),d=(m?.roundNumber??1)+1,f!=null&&f.length&&u.push(...f)}return{...ue,matchUps:u,roundResults:c}}function W8e(t){var e,i,n;if(t.structureId)return t.structureId;let r=t.drawDefinition,a=(i=(e=r?.structures)==null?void 0:e.filter(o=>o.stageSequence===1))==null?void 0:i.reduce((o,l)=>{let u=l.stage&&Uw[l.stage];return Vo({structure:l})&&u>(Uw[o?.stage]||1)?l:o},void 0),s=(n=r?.structures)==null?void 0:n.find(o=>o.structureId===a?.structureId);return s?Vo({structure:s})?{structure:s}:{error:qI}:{error:pr}}function Y8e(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:Ce,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==gu?{error:qI}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:Ce,info:"Missing Entries"}:{error:void 0}}function K8e(t){var e,i;let{tournamentRecord:n,drawDefinition:r,structureId:a,idPrefix:s,isMock:o,event:l}=t,u=(e=l?.entries)==null?void 0:e.filter(({entryStage:p,entryStatus:h})=>(!p||p===_t)&&h&&yd.includes(h)),c=u?.map(Gi),d=u?Math.floor(u.length/2):0;if(t.automated)return Z8e({...t,participantIds:c});{let p=k9({roundsCount:t.roundsCount,drawDefinition:r,matchUpsCount:d,idPrefix:s,isMock:o,event:l});if(p.error)return p;(i=p.matchUps)!=null&&i.length&&cB({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:n,drawDefinition:r,structureId:a,event:l})}return{...ue}}function Z8e(t){var e,i;let{restrictEntryStatus:n,generateMatchUps:r,structureId:a,matchUpIds:s,scaleName:o,scaleAccessor:l}=t.drawMatic??{},u=x9({...t,eventType:((e=t.drawMatic)==null?void 0:e.eventType)??t.matchUpType,generateMatchUps:r??!0,scaleAccessor:l??t.scaleAccessor,scaleName:o??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:n,structureId:a,matchUpIds:s});return u.error?u:((i=u?.matchUps)!=null&&i.length&&cB({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:u.matchUps,event:t.event,structureId:a}),{...ue})}function X8e({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:n,participantCount:r,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,seedsCount:u}){var c,d;n=n??r;let p=ui({drawDefinition:s,structureId:l});if(p.error)return p;let h=p.structure;if(!h)return{error:pr};let{positionAssignments:f}=xa({structure:h}),m=f?.length||0;if(u>m)return{error:Bve};let g=(c=h.structures)==null?void 0:c.length,v=bi(o?.groupSeedingThreshold)&&o?.groupSeedingThreshold,y=(d=B8({roundRobinGroupsCount:g,drawSize:m}))==null?void 0:d.seedGroups,{seedsCount:b}=pN({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:n,drawSize:m});return b&&a!=null&&a[Rc]&&u>b&&e&&(u=b),h.seedLimit=u,h.seedAssignments=Et(1,u+1).map(I=>{let S=y?.find(U=>U.includes(I)),w=S&&Math.min(...S),T=v&&I>=v?w:I;return{participantId:void 0,seedNumber:I,seedValue:T}}),Bn({drawDefinition:s,structureIds:[l]}),{...ue,seedLimit:u}}function Y0({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:n,stageSequence:r,entries:a,event:s,stage:o}){if(!e)return{error:lt};return a=a??s?.entries??[],{scaledEntries:a.filter(c=>(!o||!c.entryStage||c.entryStage===o)&&(!r||!c.entryStageSequence||c.entryStageSequence===r)&&yd.includes(c.entryStatus)).map(c=>{let{participantId:d}=c,{scaleItem:p}=bU({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...c,...p}}).filter(c=>{let d=c.scaleValue;return!n&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(n||l)};function l(c,d){return t?u(d)-u(c):u(c)-u(d)}function u(c){return parseFloat(c.scaleValue||(t?-1:1e5))}}function JSe(t){let e="prepareStage",{drawDefinition:i}=t,{structures:n}=ud({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),r=t.preparedStructureIds||[],a=n?.find(({structureId:h})=>!r.includes(h));if(!a)return pe({result:{error:pr},stack:e});let s=a?.structureId,{seedsCount:o,stageEntries:l,seedLimit:u}=a9e({...t,structureId:s});(t.seededParticipants||t.event||t.seedingScaleName)&&e9e({...t,seedsCount:o,structure:a,structureId:s});let c=t.automated!==!1&&t.drawType!==gu&&!(t.qualifyingOnly&&t.stage!==Kt),d=(n?.length||0)>1,p=c?Q8e({...t,multipleStructures:d,seedLimit:u,structureId:s}):{};return p!=null&&p.error?pe({result:p,stack:e}):{...p,stageEntries:l,structureId:s,seedsCount:o}}function J8e({entries:t,stage:e,stageSequence:i,roundTarget:n}){return t.filter(r=>{var a,s;let o=(s=(a=ki({name:sh,element:r}))==null?void 0:a.extension)==null?void 0:s.value;return(!r.entryStage||r.entryStage===e)&&(!i||!r.entryStageSequence||r.entryStageSequence===i)&&(!n||!o||o===n)&&qb.includes(r.entryStatus)})}function Q8e(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=tN({...t,seedsOnly:e});if(i.error)return i;let n=i?.positionAssignments,r=i?.positioningReport;return{conflicts:i.conflicts,positionAssignments:n,positioningReport:r}}function e9e(t){let{seededParticipants:e,seedingScaleName:i,entries:n,event:r}=t,a=n.map(Gi);e?t9e({...t,enteredParticipantIds:a}):(r||i)&&i9e({...t,enteredParticipantIds:a})}function t9e(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:n,tournamentRecord:r,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,structure:u,event:c}=t,d=u?z0({provisionalPositioning:e,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structure:u}):void 0;n.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=n.length).sort((p,h)=>p.seedNumber<h.seedNumber?-1:p.seedNumber<h.seedNumber?1:0).forEach(p=>{let{participantId:h,seedNumber:f,seedValue:m}=p;qD({provisionalPositioning:e,tournamentRecord:r,drawDefinition:s,seedingProfile:o,participantId:h,seedBlockInfo:d,structureId:l,seedNumber:f,seedValue:m,event:c})})}function i9e(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:n,seedAssignmentProfile:r,assignSeedsCount:a,tournamentRecord:s,drawDefinition:o,seedByRanking:l,seedingProfile:u,structureId:c,event:d}=t,{categoryName:p,ageCategoryCode:h}=d?.category||{};d?.eventType;let f=n9e({...t})||l&&r9e({...t}),m=f?.length??0;m<e&&(e=m),f?.filter(({participantId:g})=>n.includes(g)).slice(0,a||e).forEach((g,v)=>{let y=v+1,{participantId:b,scaleValue:I}=g,S=r?.[y]||I||y;qD({provisionalPositioning:i,tournamentRecord:s,drawDefinition:o,seedingProfile:u,participantId:b,structureId:c,seedNumber:y,seedValue:S,event:d})})}function n9e(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:n,entries:r,stage:a,event:s}=t,{categoryName:o,ageCategoryCode:l}=s?.category||{},u=s?.eventType,c={scaleName:i||o||l||s.eventId,scaleType:Lh,eventType:u};return Y0({scaleAttributes:c,tournamentRecord:e,stageSequence:n,entries:r,stage:a}).scaledEntries}function r9e(t){let{tournamentRecord:e,stageSequence:i,event:n,entries:r,stage:a}=t,{categoryName:s,ageCategoryCode:o}=n?.category||{},l=n?.eventType;return Y0({scaleAttributes:{scaleName:s||o,scaleType:iv,eventType:l},tournamentRecord:e,stageSequence:i,entries:r,stage:a}).scaledEntries}function a9e(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=J8e(t);e>i.length&&(e=i.length);let{seedLimit:n}=X8e({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return n&&n<e&&(e=n),{seedsCount:e,stageEntries:i,seedLimit:n}}function s9e(t){var e;let i=S9({...t,modifyOriginal:!1});if(i.error)return i;let n=i.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:a,appliedPolicies:s,qualifyingOnly:o,seedingProfile:l,participants:u,drawEntries:c,placeByes:d,drawSize:p,drawType:h,entries:f}=t,m=[],g=[],v=o9e({ignoreStageSpace:a,drawDefinition:n,drawEntries:c,drawType:h,entries:f});if(v.error)return v;let y=h===Bb?0:ai(t.seedsCount??0),b=JSe({...t,qualifyingOnly:!p||o,appliedPolicies:s,drawDefinition:n,seedingProfile:l,participants:u,stage:_t,seedsCount:y,placeByes:d,drawSize:p,entries:f});if(b.error&&!b.conflicts)return b;(e=b.positioningReport)!=null&&e.length&&m.push({[_t]:b.positioningReport});let I=b.structureId;return b.conflicts&&(g=b.conflicts),h===gu&&t.roundsCount&&K8e({...t,drawDefinition:n,structureId:I}),{drawDefinition:n,positioningReports:m,conflicts:g,structureId:I}}function o9e(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:n,drawType:r,entries:a}=t;for(let s of a){if(n&&s.entryStage&&s.entryStage!==_t)continue;let o={...s,ignoreStageSpace:e??r===gu,entryStage:s.entryStage??_t,event:t.event,drawDefinition:i,drawType:r},l=N8(o);if(n&&l.error)return l}return{error:void 0}}var l9e=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),u9e=l9e;function c9e(t){let{drawId:e=gn(),processCodes:i,matchUpType:n,drawType:r}=t??{},a=u9e();return Object.assign(a,{processCodes:i,matchUpType:n,drawType:r,drawId:e})}function O9(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:n,matchUpFormat:r,structureId:a,matchUpId:s,event:o}=t,l=Yt(t,[{[Po]:!0,[F7]:!0}]);if(l.error)return l;if(!Ll({matchUpFormat:r}))return{error:vM};let u="setMatchUpFormat";if(s){let c=tr({drawDefinition:n,matchUpId:s,event:o});if(c.error)return c;let d=c.matchUp;if(d?.matchUpType===aa)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:ll};d&&(d.matchUpFormat=r,Xi({tournamentId:i?.tournamentId,eventId:o?.eventId,context:u,drawDefinition:n,matchUp:d}))}else if(Array.isArray(e)){if(o?.eventType===aa)return{error:rf};for(let c of e){let d=ui({drawDefinition:n,structureId:c});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=r)}}else if(a){if(o?.eventType===aa)return{error:rf};let c=ui({drawDefinition:n,structureId:a});if(c.error)return c;c.structure&&(c.structure.matchUpFormat=r)}else n&&(n.matchUpFormat=r);return e=e??(a?[a]:void 0),Bn({drawDefinition:n,structureIds:e}),{...ue}}function d9e({tieFormat:t}){let e=Bo({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=gn());return{tieFormat:t}}function p9e({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:n,tieFormat:r,event:a}){if((i||r)&&!(i&&a?.matchUpFormat===i||a!=null&&a.tieFormat&&r&&JSON.stringify(a.tieFormat)===JSON.stringify(r))){if(r){let s=d9e({tieFormat:r});if(s.error)return s;e.tieFormat=s.tieFormat??r}else if(i){let s=O9({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(s.error)return{info:"matchUpFormat or tieFormat error",error:s.error}}n&&(e.matchUpType=n)}return{error:void 0}}var QSe={};$i(QSe,{attachPolicies:()=>fb,findPolicy:()=>Hb,getAppliedPolicies:()=>pn,getPolicyDefinitions:()=>Jm,mutate:()=>eTe,query:()=>iTe,removePolicy:()=>tTe});var eTe={};$i(eTe,{attachPolicies:()=>fb,removePolicy:()=>tTe});function tTe(t){let e=Yt(t,[{[vWe]:!0,_anyOf:{[Hs]:!1,[Ta]:!1,[Po]:!1,[Av]:!1}}]);if(e.error)return e;let i,n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n)return qQ(t,n);if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:lt};for(let a of r){let s=t.tournamentRecords[a],o=qQ(t,s);if(o.error)return o;i=!0}}else return{error:lt};return i?{...ue}:{error:iU}}function qQ(t,e){let i=pn(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?dn({element:e,extension:{name:XC,value:i}}):po({element:e,name:XC}),{...ue}):{error:iU}}var iTe={};$i(iTe,{findPolicy:()=>Hb,getAppliedPolicies:()=>pn,getPolicyDefinitions:()=>Jm});var nTe={[Rc]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[of]:{positioning:ab},[od]:{positioning:ab}},positioning:oWe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},nz=nTe;function h9e({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:n}){if(e&&typeof e!="object")return pe({info:"policyDefinitions must be an object",result:{error:Ce},stack:n});let r={[ZC]:t?.[ZC]};return e?f9e({policyDefinitions:e,appliedPolicies:t,policiesToAttach:r,drawDefinition:i}):r.avoidance&&fb({drawDefinition:i,policyDefinitions:r}),!(t!=null&&t[Rc])&&!(e!=null&&e[Rc])&&(fb({policyDefinitions:nz,drawDefinition:i}),t&&Object.assign(t,nz)),{error:void 0}}function f9e({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:n}){for(let r of Object.keys(t))JSON.stringify(e?.[r])!==JSON.stringify(t[r])&&(i[r]=t[r]);Object.keys(i).length&&(fb({policyDefinitions:i,drawDefinition:n}),e&&Object.assign(e,i))}function m9e(t){var e,i,n,r,a;let{tournamentRecord:s,matchUpFormat:o,appliedPolicies:l,policyDefinitions:u,matchUpType:c,tieFormat:d,drawType:p,stack:h,event:f}=t,m=t.drawId?(e=f?.drawDefinitions)==null?void 0:e.find(w=>w.drawId===t.drawId):void 0;m&&p!==m.drawType&&(m.drawType=p);let g=m??c9e({processCodes:t.processCodes,drawId:t.drawId,drawType:p}),v=p9e({tournamentRecord:s,drawDefinition:g,matchUpFormat:o,matchUpType:c,tieFormat:d,event:f});if(v.error)return pe({result:v,stack:h});let y=h9e({appliedPolicies:l,policyDefinitions:u,drawDefinition:g,stack:h});if(y.error)return y;let b=(n=(i=m?.structures)==null?void 0:i.find(w=>w.stage===_t&&w.stageSequence===1))==null?void 0:n.structureId,I=m?(r=m.structures)==null?void 0:r.filter(w=>w.stage===Kt):[],S=I?.length===1&&!((a=I[0].matchUps)!=null&&a.length)&&I[0].structureId;return{drawDefinition:g,structureId:b,existingDrawDefinition:m,existingQualifyingPlaceholderStructureId:S}}function g9e(t){var e,i;let n="generateOrGetExisting",r=[],a=[],s=m9e(t);if(s.error)return pe({result:s,stack:n});let o=s.existingDrawDefinition,l=s.drawDefinition??{},u=s.structureId,c=t.drawEntries??t.eventEntries??[],d=s.existingQualifyingPlaceholderStructureId&&G8e({...t,...s})||s9e({...t,...s,entries:c});return d.error?pe({result:d,stack:n}):((e=d.positioningReports)!=null&&e.length&&r.push(...d.positioningReports??[]),(i=d.conflicts)!=null&&i.length&&a.push(...d.conflicts??[]),l=d.drawDefinition,u=d.structureId,{existingDrawDefinition:o,positioningReports:r,drawDefinition:l,structureId:u,conflicts:a,entries:c})}function v9e(t){var e,i,n;let{qualifyingPlaceholder:r,qualifyingProfiles:a,existingDrawDefinition:s,positioningReports:o,appliedPolicies:l,qualifyingOnly:u,drawDefinition:c,seedingProfile:d,participants:p,structureId:h,entries:f,stack:m}=t,g=r&&!(a!=null&&a.length)&&!s,v=[];if(a){let y=(w,T)=>w.stageSequence-T.stageSequence,b=(w,T)=>w.roundTarget-T.roundTarget,I=[],S=1;a.sort(b);for(let w of a){if(!Array.isArray(w.structureProfiles))return pe({info:hb("structureProfiles"),result:{error:Xt},stack:m});S=w.roundTarget||S;let T=((e=w.structureProfiles)==null?void 0:e.sort(y))||[],U=1;for(let C of T){let{qualifyingRoundNumber:E,qualifyingPositions:P,seededParticipants:M,seedingScaleName:R,seedsCount:N=0,seedByRanking:A,placeByes:_,drawSize:x}=C,O=JSe({...t,seedingProfile:C.seedingProfile??d,stageSequence:U,qualifyingRoundNumber:E,preparedStructureIds:I,qualifyingPositions:P,seededParticipants:M,stage:Kt,seedingScaleName:R,appliedPolicies:l,drawDefinition:c,qualifyingOnly:u,seedByRanking:A,participants:p,roundTarget:S,seedsCount:N,placeByes:_,drawSize:x,entries:f});if(O.error)return O;O.structureId&&I.push(O.structureId),U+=1,(i=O.conflicts)!=null&&i.length&&v.push(...O.conflicts),(n=O.positioningReport)!=null&&n.length&&o.push({[Kt]:O.positioningReport})}S+=1}}else if(h&&g){let y=Gu({structureName:Ss(Kt),stage:Kt}),{link:b}=iN({sourceStructureId:y.structureId,targetStructureId:h,sourceRoundNumber:0,linkType:Em});c.structures||(c.structures=[]),c.structures.push(y),c.links||(c.links=[]),c.links.push(b)}return{qualifyingConflicts:v,error:void 0}}var rTe={};$i(rTe,{addGoesTo:()=>pb,allCompetitionMatchUps:()=>Wd,allDrawMatchUps:()=>ho,allEventMatchUps:()=>If,allPlayoffPositionsFilled:()=>W8,allTournamentMatchUps:()=>Qa,analyzeDraws:()=>cN,analyzeMatchUp:()=>l1,analyzeTournament:()=>q9,bulkUpdatePublishedEventIds:()=>K9,calculateWinCriteria:()=>Z0,categoryCanContain:()=>SM,checkMatchUpIsComplete:()=>Ny,checkValidEntries:()=>hB,compareTieFormats:()=>_m,competitionScheduleMatchUps:()=>yN,courtGridRows:()=>AB,credits:()=>y9e,drawMatchUps:()=>uY,eventMatchUps:()=>xB,filterMatchUps:()=>Kf,filterParticipants:()=>ZM,findDrawDefinition:()=>v9,findExtension:()=>ki,findVenue:()=>bf,getAggregateTeamResults:()=>z9,getAllDrawMatchUps:()=>pa,getAllEventData:()=>Z9,getAllStructureMatchUps:()=>vn,getAllowedDrawTypes:()=>SB,getAllowedMatchUpFormats:()=>j9,getAppliedPolicies:()=>pn,getAssignedParticipantIds:()=>Yb,getAvailableMatchUpsCount:()=>dB,getAvailablePlayoffProfiles:()=>nN,getCategoryAgeDetails:()=>Sw,getCheckedInParticipantIds:()=>$0,getCompetitionDateRange:()=>UB,getCompetitionMatchUps:()=>o1,getCompetitionParticipants:()=>L9,getCompetitionPenalties:()=>G9,getCompetitionVenues:()=>fN,getCourtInfo:()=>Y$,getCourts:()=>cY,getDrawData:()=>EB,getDrawDefinitionTimeItem:()=>f8,getDrawParticipantRepresentativeIds:()=>m9,getDrawStructures:()=>ud,getDrawTypeCoercion:()=>dN,getEligibleVoluntaryConsolationParticipants:()=>f9,getEntriesAndSeedsCount:()=>_B,getEvent:()=>hY,getEventData:()=>PB,getEventMatchUpFormatTiming:()=>eY,getEventProperties:()=>dY,getEventPublishStatus:()=>hc,getEventStructures:()=>iB,getEventTimeItem:()=>_M,getEvents:()=>pY,getFlightProfile:()=>Rr,getHomeParticipantId:()=>rY,getLinkedTournamentIds:()=>MM,getMatchUpCompetitiveProfile:()=>jM,getMatchUpContextIds:()=>aY,getMatchUpDailyLimits:()=>LB,getMatchUpDailyLimitsUpdate:()=>tY,getMatchUpDependencies:()=>bd,getMatchUpFormat:()=>sY,getMatchUpFormatTiming:()=>GM,getMatchUpFormatTimingUpdate:()=>Q9,getMatchUpScheduleDetails:()=>K$,getMatchUpType:()=>Z$,getMatchUpsMap:()=>Cs,getMatchUpsStats:()=>oY,getMatchUpsToSchedule:()=>CB,getMaxEntryPosition:()=>J9,getModifiedMatchUpFormatTiming:()=>kB,getPairedParticipant:()=>cd,getParticipantEventDetails:()=>F9,getParticipantIdFinishingPositions:()=>g9,getParticipantMembership:()=>$9,getParticipantResults:()=>sN,getParticipantScaleItem:()=>bU,getParticipantSchedules:()=>B9,getParticipantSignInStatus:()=>V9,getParticipantTimeItem:()=>m8,getParticipants:()=>hr,getPersonRequests:()=>Xb,getPolicyDefinitions:()=>Jm,getPositionAssignments:()=>r1,getPositionsPlayedOff:()=>YD,getPredictiveAccuracy:()=>nY,getProfileRounds:()=>NB,getPublishState:()=>G0,getRoundMatchUps:()=>bo,getRounds:()=>lY,getScaleValues:()=>LD,getScaledEntries:()=>Y0,getScheduledRoundsDetails:()=>mN,getSchedulingProfile:()=>ig,getSchedulingProfileIssues:()=>X9,getSeedingThresholds:()=>V8,getSeedsCount:()=>pN,getStructureSeedAssignments:()=>ec,getTeamLineUp:()=>db,getTieFormat:()=>Y9,getTimeItem:()=>cc,getTournamentIds:()=>CM,getTournamentInfo:()=>K0,getTournamentPenalties:()=>TB,getTournamentPersons:()=>H9,getTournamentPoints:()=>DB,getTournamentPublishStatus:()=>KM,getTournamentStructures:()=>q8,getTournamentTimeItem:()=>G$,getValidGroupSizes:()=>QM,getVenueData:()=>gU,getVenuesAndCourts:()=>tg,isAdHoc:()=>Vo,isCompletedStructure:()=>uv,isValidForQualifying:()=>I9,isValidMatchUpFormat:()=>Ll,matchUpActions:()=>pB,participantScaleItem:()=>$h,participantScheduledMatchUps:()=>iY,positionActions:()=>b9,publicFindCourt:()=>E8,publicFindVenue:()=>D8,tallyParticipantResults:()=>KD,tieFormatGenderValidityCheck:()=>b$,tournamentMatchUps:()=>OB,validMatchUp:()=>H$,validMatchUps:()=>pc,validateCollectionDefinition:()=>TM,validateLineUp:()=>tB});function y9e(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var aTe={};$i(aTe,{filterParticipants:()=>ZM,getCompetitionParticipants:()=>L9,getPairedParticipant:()=>cd,getParticipantEventDetails:()=>F9,getParticipantMembership:()=>$9,getParticipantScaleItem:()=>bU,getParticipantSchedules:()=>B9,getParticipantSignInStatus:()=>V9,getParticipantTimeItem:()=>m8,getParticipants:()=>hr,getScaleValues:()=>LD,participantScaleItem:()=>$h,validateLineUp:()=>tB});function L9(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:gr};let i=[],n={},r={},a={},s=[],o={},l=[];for(let u of Object.values(e)){let{participantIdsWithConflicts:c,mappedMatchUps:d,participantMap:p,participants:h,matchUps:f,derivedEventInfo:m,derivedDrawInfo:g}=hr({...t,tournamentRecord:u});Object.assign(o,d),Object.assign(n,p),Object.assign(r,m),Object.assign(a,g),i.push(...h??[]),s.push(...f??[]),c?.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:r,derivedDrawInfo:a,participantMap:n,mappedMatchUps:o,participants:i,...ue,matchUps:s}}function F9({tournamentRecord:t,participantId:e}){if(!t)return{error:lt};if(!e)return{error:da};let i=[e].concat((t.participants??[]).filter(n=>{var r;return n?.participantType&&[Sn,Ai].includes(n.participantType)&&((r=n.individualParticipantIds)==null?void 0:r.includes(e))}).map(n=>n.participantId));return{eventDetails:(t.events??[]).filter(n=>{let r=(n?.entries??[]).map(a=>a.participantId);return yo(r,i)}).map(n=>({eventName:n.eventName,eventId:n.eventId}))}}function $9({tournamentRecord:t,participantId:e}){if(!t)return{error:lt};if(!e)return{error:da};let{participants:i}=hr({participantFilters:{participantTypes:[Sn,Ai,Uu]},tournamentRecord:t});return(i??[]).filter(n=>{var r;return(r=n.individualParticipantIds)==null?void 0:r.includes(e)}).reduce((n,r)=>{let a=r.participantType;return a&&(n[a]||(n[a]=[]),n[a].push(r)),n},{})}function B9({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:lt};if(typeof t!="object")return{error:Zm,context:{participantFilters:t}};let i={eventIds:t.eventIds},n=Qa({tournamentRecord:e,contextFilters:i}).matchUps??[],r=Object.assign({},...n.map(l=>({[l.matchUpId]:l}))),a=n.filter(({schedule:l})=>l&&Object.keys(l).length),s=bd({tournamentRecord:e,matchUps:n}).sourceMatchUpIds??[],o={};for(let l of a){let{sides:u}=l,c,d=u?.map(h=>{if(h.participant)return[h.participant].concat(...h.participant.individualParticipants||[]);s[l.matchUpId]&&!c&&(c=(s[l.matchUpId]||[]).map(f=>r[f]).filter(({winningSide:f,bye:m})=>!f&&!m))}).filter(Boolean).flat()??[];for(let h of d){let{participantId:f}=h;o[f]||(o[f]={potentialMatchUps:[],participant:h,matchUps:[]}),o[f].matchUps.push(l)}let p=c?.map(({sides:h})=>h).flat().map(({participant:h})=>h&&[h].concat(...h.individualParticipants||[])).filter(Boolean).flat()||[];for(let h of p){let{participantId:f}=h;o[f]||(o[f]={potentialMatchUps:[],participant:h,matchUps:[]}),o[f].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(o).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...ue}}function V9({tournamentRecord:t,participantId:e}){if(!t)return{error:lt};if(!e)return{error:da};let{participant:i}=Ov({tournamentRecord:t,participantId:e});if(!i)return{error:Ar};let{timeItem:n}=cc({itemType:AM,element:i});return n&&n.itemValue===QC&&QC}var sTe={};$i(sTe,{analyzeDraws:()=>cN,analyzeTournament:()=>q9,getAggregateTeamResults:()=>z9,getAllowedDrawTypes:()=>SB,getAllowedMatchUpFormats:()=>j9,getAppliedPolicies:()=>pn,getCompetitionDateRange:()=>UB,getCompetitionPenalties:()=>G9,getPolicyDefinitions:()=>Jm,getTournamentInfo:()=>K0,getTournamentPenalties:()=>TB,getTournamentPersons:()=>H9,getTournamentPoints:()=>DB,getTournamentStructures:()=>q8,getTournamentTimeItem:()=>G$});function j9({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:lt};let{appliedPolicies:r}=pn({tournamentRecord:t});return(((n=r?.[Qu])==null?void 0:n.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:s})=>!e&&!s||e&&a?.includes(e)||i&&s?.includes(i))}function SB({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:lt};let{appliedPolicies:r}=pn({tournamentRecord:t});return(((n=r?.[dx])==null?void 0:n.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:s})=>!e&&!s||e&&a?.includes(e)||i&&s?.includes(i))}function TB({tournamentRecord:t}){if(!t)return{error:lt};let e=(t?.participants??[]).reduce((i,n)=>{let{participantId:r}=n;return(n.penalties??[]).forEach(a=>{let{penaltyId:s}=a||{};i[s]?i[s].participants.push(r):i[s]={...a,participantIds:[r]}}),i},{});return{penalties:Object.values(e)}}function G9({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:gr};let e=[];for(let i of Object.values(t)){let{penalties:n}=TB({tournamentRecord:i});e.push(...n??[])}return{penalties:e}}function oTe({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:s,category:o,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:h,notes:f})=>({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:s,category:o,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:h,notes:f}))(t)}}var b9e={[FD]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},I9e=b9e;function K0(t){var e,i,n,r;let{tournamentRecord:a}=t??{};if(!a)return{error:lt};let s=(({tournamentId:d,tournamentRank:p,tournamentStatus:h,formalName:f,tournamentName:m,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:b,startDate:I,endDate:S,hostCountryCode:w,venues:T,notes:U,updatedAt:C})=>({tournamentId:d,tournamentRank:p,tournamentStatus:h,formalName:f,tournamentName:m,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:b,startDate:I,endDate:S,hostCountryCode:w,venues:T,notes:U,updatedAt:C}))(a),o=((e=hr({participantFilters:{participantRoles:[ywe,_8,bwe,Iwe,Swe]},policyDefinitions:I9e,tournamentRecord:a}))==null?void 0:e.participants)??[];o&&(s.tournamentContacts=o);let l=(i=G0({tournamentRecord:a}))==null?void 0:i.publishState,u=((r=(n=l?.tournament)==null?void 0:n.status)==null?void 0:r.publishedEventIds)||[],c=[];for(let d of a.events??[])if(!(t!=null&&t.usePublishState)||u.includes(d.eventId)){let p=oTe({event:d}).eventInfo;p&&c.push(p)}return s.timeItemValues=P0e({element:a}),s.publishState=l?.tournament,s.eventInfo=c,{tournamentInfo:At(Gt(s),!1,!0),...ue}}function UB({tournamentRecords:t}){if(!Qi(t))return{error:gr};let e=Object.keys(t??{}).reduce((r,a)=>{let s=t[a],{tournamentInfo:{startDate:o,endDate:l}}=K0({tournamentRecord:s}),u=o&&new Date(Ci(o));(!r.startDate||u&&u<r.startDate)&&(r.startDate=u);let c=l&&new Date(Ci(l));return(!r.endDate||c&&c>r.endDate)&&(r.endDate=c),r},{startDate:void 0,endDate:void 0}),i=e.startDate&&Ci(e.startDate.toISOString()),n=e.endDate&&Ci(e.endDate.toISOString());return!i||!n?{error:aye}:{startDate:i,endDate:n}}function H9({tournamentRecord:t,participantFilters:e}){if(!t)return{error:lt};let i=t.participants||[];e&&(i=ZM({participants:i,participantFilters:e,tournamentRecord:t}));let n={},r=a=>{if(a.person){let{personId:s}=a.person;n[s]?n[s].participantIds.push(a.participantId):n[s]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&r(a)}),{tournamentPersons:Object.values(n)}}function z9(t){var e,i,n,r,a,s,o,l;let u=Yt(t,[{[Ta]:!0}]);if(u.error)return u;let c=t.finishingPositionRangeBounsPoints||{},d={},p=b=>{var I,S,w;let T=(I=b?.individualParticipants)==null?void 0:I.map(U=>{var C;return((C=U.teams)==null?void 0:C.length)===1&&U.teams[0]});return((S=b?.teams)==null?void 0:S.length)===1&&((w=b?.teams)==null?void 0:w[0])||T?.[0].participantId===T?.[1].participantId&&T?.[0]},{matchUps:h,participants:f}=hr({participantFilters:{participantTypes:[Hi]},withRankingProfile:!0,withStatistics:!0,...t});for(let b of f??[]){if(b.participantType===xo)continue;((i=(e=b.draws)==null?void 0:e[0])==null?void 0:i.drawId)==="draw-0-3"&&console.log(b.participantType,b.draws[0].finishingPositionRange);let I=p(b);if(I)for(let S of b?.draws??[]){let w=(n=S?.finishingPositionRange)==null?void 0:n.join("-");if(w&&c!=null&&c[w]){let T=I?.participantId,U=S?.drawId,C=`${T}|${U}|${w}`;d[C]=c[w]}}}let m=b=>({teamName:b,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),g=(b,I,S)=>{b[I]===void 0&&(b[I]=0),b[I]+=S},v={},y={};for(let b of h??[]){let{sides:I,matchUpFormat:S}=b,w=S&&Do(S);if(I?.length===2&&(r=w.setFormat)!=null&&r.timed&&(!w.finalSetFormat||(a=w.finalSetFormat)!=null&&a.timed))for(let T of I){let U=p(T.participant),C=U?.participantId,E=(s=T.participant)==null?void 0:s.participantId,P=U?.participantName,M=T.sideNumber,R=((o=T.participant)==null?void 0:o.individualParticipantIds)||E&&[E]||[];if(R.forEach(N=>{N&&!v[N]&&(v[N]=m(P))}),C&&M){y[C]||(y[C]=m(P));let N=[...R.map(_=>v[_]),y[C]];b.winningSide&&(M===b.winningSide?N.forEach(_=>g(_,"win",1)):N.forEach(_=>g(_,"loss",1)));let A=((l=b.score)==null?void 0:l.sets)||[];for(let _ of A){let x=_?.[`side${3-M}Score`]||0,O=_?.[`side${M}Score`]||0,$=O-x;N.forEach(F=>g(F,"pointsPlayed",O+x)),N.forEach(F=>g(F,"points",O)),N.forEach(F=>g(F,"diff",$))}}}}for(let b of Object.keys(d)){let[I]=b.split("|");y[I]&&(y[I].bonus+=d[b],y[I].pointsPct=parseFloat((y[I].points/y[I].pointsPlayed).toFixed(2)),y[I].standingPoints=y[I].win+y[I].bonus)}for(let b of Object.keys(v))v[b].pointsPct=parseFloat((v[b].points/v[b].pointsPlayed).toFixed(2));return{...ue,individualResults:v,teamResults:y}}function w9e(t){var e,i,n,r,a,s,o;let l=((i=(e=t.participants)==null?void 0:e.filter(({participantType:p})=>p===Sn))==null?void 0:i.length)===2,u=((n=t.events)==null?void 0:n.length)===1&&t.events[0],c=((r=u?.drawDefinitions)==null?void 0:r.length)===1&&u.drawDefinitions[0],d=((o=(s=((a=c?.structures)==null?void 0:a.length)===1&&c.structures[0])==null?void 0:s.positionAssignments)==null?void 0:o.length)===2;return!!(u.tieFormat&&l&&d)}function q9({tournamentRecord:t}){var e;if(!t)return{error:lt};let{drawsAnalysis:i}=cN({tournamentRecord:t}),n={isDual:w9e(t),drawsAnalysis:i},r=hr({tournamentRecord:t});return(e=r.missingParticipantIds)!=null&&e.length&&(n.missingParticipantIds=r.missingParticipantIds),{...ue,analysis:n}}function lTe(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function S9e(t){let{participation:e={},awardProfiles:i,startDate:n,eventType:r,drawSize:a,drawType:s,category:o,endDate:l,level:u}=t,{participationOrder:c,flightNumber:d,rankingStage:p}=e,h=f=>!n&&!l||!f.dateRanges?!0:f.dateRanges.some(m=>{let g=!n||!m.startDate||new Date(n)>new Date(m.startDate),v=!l||!m.endDate||new Date(l)<=new Date(m.endDate);return g&&v});return{awardProfile:i.find(f=>{var m,g,v,y,b,I,S,w,T,U;return h(f)&&(!f.maxFlightNumber||d<=f.maxFlightNumber)&&(!((m=f.drawTypes)!=null&&m.length)||((g=f.drawTypes)==null?void 0:g.includes(s)))&&(!((v=f.drawSizes)!=null&&v.length)||f.drawSizes.includes(a))&&(!((y=f.stages)!=null&&y.length)||f.stages.includes(p))&&(!((b=f.levels)!=null&&b.length)||f.levels.includes(u))&&(!f.maxDrawSize||a<=f.maxDrawSize)&&(!f.drawSize||f.drawSize===a)&&(!f.maxLevel||u<=f.maxLevel)&&(!d||!((S=(I=f.flights)==null?void 0:I.flightNumbers)!=null&&S.length)||f.flights.flightNumbers.includes(d))&&(!f.participationOrder||f.participationOrder===c)&&(!((w=f.category)!=null&&w.ageCategoryCodes)||f.category.ageCategoryCodes.includes(o?.ageCategoryCode))&&(!((T=f.eventTypes)!=null&&T.length)||((U=f.eventTypes)==null?void 0:U.includes(r)))})}}function WQ({participantWon:t,flightNumber:e,valueObj:i,drawSize:n,flights:r,level:a}){var s,o;let l=(g,v)=>{if(g){if(Array.isArray(v)){let y=v.find(b=>b.flight===g||b.f===g);return y.value||y.v}if(typeof v=="object"){let y=v.flights||v.f;if(Array.isArray(y))return y[g-1]}}},u=(g,v)=>{let y=g?.value||g?.v||(bi(g)?g:0),b=lTe(a,g?.level);return{value:l(v,b)||bi(b)&&b||y}},c=0,d,p,h,f,m=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(b=>{var I;return b.drawSize===n||((I=b.drawSizes)==null?void 0:I.includes(n))}),v=i.find(b=>b.drawSize&&b.threshold&&n>b.drawSize),y=i.find(b=>{var I;return!b.drawSize&&!((I=b.drawSizes)!=null&&I.length)});m!==void 0&&(g=g?.[m],v=v?.[m],y=y?.[m]),p=u(g,e).value,h=u(v,e).value,f=u(y,e).value,c=p||h||f,d=p&&g.requireWin||h&&v.requireWin||y?.requireWin}else if(typeof i=="object"){let g=(s=i?.drawSizes)==null?void 0:s[n],v=i;m!==void 0&&(g=g?.[m],v=v?.[m]),p=u(g,e).value,f=u(v,e).value,c=p||f,d=p?g.requireWin:v?.requireWin}else bi(i)&&m===void 0&&(c=i);return e&&(o=r?.pct)!=null&&o[e]&&(c=Math.round(c*r.pct[e])),{awardPoints:c,requireWin:d}}function DB({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:n}){var r;if(!i)return{error:lt};let{policyDefinitions:a}=Jm({policyTypes:[P_],tournamentRecord:i}),s=e?.[P_]??a?.[P_];if(!s)return{error:r$};let o=s.awardProfiles,l=s.requireWinFirstRound,u=s.requireWinForPoints,{participants:c,derivedEventInfo:d,derivedDrawInfo:p,mappedMatchUps:h}=hr({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),f=c?.filter(y=>{var b;return(b=y.draws)==null?void 0:b.length}),m={},g={},v={};for(let y of f??[]){let{participantType:b,participantId:I,person:S,draws:w}=y;for(let T of w){let{drawId:U,structureParticipation:C,eventId:E}=T,P=d[E],M=p[U],R=M?.drawType,{category:N,eventType:A}=P||{},_=T.startDate||P.startDate||i.startDate,x=T.endDate||P.endDate||i.endDate;if(A===Fl&&I!==xo)continue;let O;if(o){let $=u,F=0,j=0,H=0,G;for(let W of C){let{finishingPositionRange:q,participationOrder:Z,participantWon:K,flightNumber:Q,rankingStage:J,winCount:ne}=W;F+=ne||0;let re=M?.drawSize,{awardProfile:oe}=S9e({awardProfiles:o,participation:W,eventType:A,startDate:_,category:N,drawSize:re,drawType:R,endDate:x,level:n});if(oe){if(!re)continue;let de=Array.isArray(q)&&Math.max(...q),se=Si(q||[]).join("-"),ge=de&&J!==Kt&&q?.includes(re);oe.requireWinForPoints!==void 0&&($=oe.requireWinForPoints),oe.requireWinFirstRound!==void 0&&(l=oe.requireWinFirstRound);let{finishingPositionPoints:ye={},finishingPositionRanges:Te,finishingRound:De,pointsPerWin:xe,flights:Me}=oe,Oe=Array.isArray(oe.perWinPoints)?(r=oe.perWinPoints)==null?void 0:r.find(Xe=>{var gt;return(gt=Xe.participationOrders)==null?void 0:gt.includes(Z)}):oe.perWinPoints,at=ye.participationOrders,Fe=0,mt;if((!at||at.includes(Z))&&Te&&de){let Xe=Te[de];Xe&&({awardPoints:Fe,requireWin:mt}=WQ({flightNumber:Q,valueObj:Xe,drawSize:re,flights:Me,level:n}))}if(!Fe&&De&&Z===1&&de){let Xe=De[de];Xe&&({awardPoints:Fe,requireWin:mt}=WQ({participantWon:K,flightNumber:Q,valueObj:Xe,drawSize:re,flights:Me,level:n}))}if(ge&&l!==void 0&&($=l),mt!==void 0&&($=mt),Fe>j&&(!$||ne)&&(j=Fe,G=de),!Fe&&xe&&ne&&(H+=ne*xe,G=se),!Fe&&ne&&Oe){let Xe=lTe(n,Oe?.level);Xe?H+=ne*Xe:Oe.value&&(H+=ne*Oe.value)}}if(O=j+H,b===xo){let de=(y.matchUps||[]).filter(({structureId:se})=>se===W.structureId);for(let{matchUpId:se}of de){let ge=h[se],ye=ge.sides.find(Te=>Te.participantId===I).sideNumber;if(ge.winningSice===ye)for(let Te of ge.tieMatchUps)Te.winningSide}}}if(H||j){let W={winCount:F,positionPoints:j,rangeAccessor:G,perWinPoints:H,eventType:A,drawId:U,points:O},q=S?.personId;q?(m[q]||(m[q]=[]),m[q].push(W)):b===Ai?(v[I]||(v[I]=[]),v[I].push(W)):b===xo&&(g[I]||(g[I]=[]),g[I].push(W))}}}}return{participantsWithOutcomes:f,personPoints:m,pairPoints:v,teamPoints:g,...ue}}var uTe={};$i(uTe,{compareTieFormats:()=>_m,getTieFormat:()=>Y9,tieFormatGenderValidityCheck:()=>b$,validateCollectionDefinition:()=>TM});function Rx(t){var e;if(!t)return{};let i=[],n=t.tieFormatName,r=(e=t.collectionDefinitions)==null?void 0:e.map(a=>{let{matchUpType:s,matchUpFormat:o,matchUpCount:l,category:u,gender:c}=a;i.includes(o)||i.push(o);let d=u?.ageCategoryCode;return[l,s===nb?"D":"S",d,o,c].join(";")}).join("|");return{tieFormatName:t&&n||"UNNAMED",matchUpFormats:i,tieFormatDesc:r}}function _m({considerations:t={},descendant:e,ancestor:i}){var n,r;let a={},s={},{matchUpFormats:o,tieFormatDesc:l}=Rx(e),{matchUpFormats:u,tieFormatDesc:c}=Rx(i),d=Si((o??[]).filter(T=>!(u??[]).includes(T)).concat((u??[]).filter(T=>!(o??[]).includes(T)))),p=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:T})=>T).join("|")!==i.collectionDefinitions.map(({collectionName:T})=>T).join("|")),h=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:T})=>T).join("|")!==i.collectionDefinitions.map(({collectionOrder:T})=>T).join("|")),f=Object.assign({},...(e?.collectionDefinitions||[]).map(T=>({[T.collectionId]:T}))),m=Object.assign({},...(i?.collectionDefinitions||[]).map(T=>({[T.collectionId]:T})));a.collectionIds=dQ(Object.keys(f),Object.keys(m)),s.collectionIds=dQ(Object.keys(m),Object.keys(f)),a.collectionsValue=YQ(f),s.collectionsValue=YQ(m),a.groupsCount=((n=i?.collectionGroups)==null?void 0:n.length)??(0-(((r=e?.collectionGroups)==null?void 0:r.length)??0)||0),s.groupsCount=a.groupsCount?-1*a.groupsCount:0;let g=a.collectionsValue.totalValue-s.collectionsValue.totalValue,v=a.collectionsValue.totalMatchUps-s.collectionsValue.totalMatchUps,y=s.collectionsValue.assignmentValues.length!==a.collectionsValue.assignmentValues.length,b=s.collectionsValue.assignmentValues.some((T,U)=>{let C=a.collectionsValue.assignmentValues[U];return!C||T.valueKey!==C.valueKey||T.value!==C.value?!0:Array.isArray(T.value)?T.value.every((E,P)=>C.value[P]===E):!1}),I=p||h||c!==l||y||b||g!==0,S=[...s.collectionsValue.invalidValues,...a.collectionsValue.invalidValues],w=S.length&&S;return{matchUpFormatDifferences:d,matchUpCountDifference:v,descendantDifferences:a,ancestorDifferences:s,orderDifference:h,valueDifference:g,nameDifference:p,descendantDesc:l,ancestorDesc:c,...ue,different:I,invalid:w}}function YQ(t){let e=[],i=[],n=0;return{totalValue:Object.keys(t).sort(J$).reduce((r,a)=>{let s=t[a],{collectionValueProfiles:o,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=s,h={collectionValueProfiles:o,collectionValue:l,matchUpValue:c,scoreValue:d,setValue:p},f=Object.keys(h).filter(g=>![void 0,null].includes(h[g])&&(!Array.isArray(h[g])||h[g].length>0));f.length!==1&&e.push({collectionId:a});let m=f[0];if(m){let g=m==="collectionValueProfiles"?Object.values(o):h[m];i.push({valueKey:m,value:g})}return n+=u,o!=null&&o.length?r+o.reduce((g,v)=>g+v.value,0):u?bi(c)?r+c*u:bi(d)?r+d*u:bi(p)?r+p*u:r+l:r},0),totalMatchUps:n,invalidValues:e,assignmentValues:i}}function W9(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=cTe(t);return{matchUp:At(e,!0,!0),error:i}}function cTe({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:s,matchUpId:o,inContext:l,eventId:u,drawId:c,event:d}){var p;if(!i)return{error:lt};if(typeof o!="string")return{error:to};if(!a||!d){let m=(Qa({tournamentRecord:i,nextMatchUps:s}).matchUps??[]).find(g=>g.matchUpId===o);if(!m)return{error:Gs};({eventId:u,drawId:c}=m),{event:d,drawDefinition:a}=jo({tournamentRecord:i,eventId:u,drawId:c})}if(!a)return{error:fu};r&&!n&&(n=Qm({tournamentRecord:i,contextProfile:r}));let h={surfaceCategory:d?.surfaceCategory??i.surfaceCategory,indoorOutDoor:d?.indoorOutdoor??i.indoorOutdoor,endDate:d?.endDate??i.endDate,tournamentId:i.tournamentId,eventId:u??d?.eventId,drawId:c},{participants:f=[]}=Gb({participantsProfile:t,tournamentRecord:i,contextProfile:r,inContext:l});if(s){let m=(ho({context:l?h:void 0,participants:f,afterRecoveryTimes:e,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:s,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===o);if(!m)return{error:Gs};let g=(p=a?.structures)==null?void 0:p.find(v=>v.structureId===m.structureId);return{drawDefinition:a,structure:g,matchUp:m}}else{let{matchUp:m,structure:g}=tr({context:l?h:void 0,tournamentParticipants:f,afterRecoveryTimes:e,contextContent:n,drawDefinition:a,contextProfile:r,matchUpId:o,inContext:l,event:d});return{matchUp:m,structure:g,drawDefinition:a}}}function Y9({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,structure:r,eventId:a,drawId:s,event:o}){var l,u,c,d,p;if(!t)return{error:lt};if(!s&&!o&&!i&&!n)return pe({result:{error:Xt},stack:"getTieFormat"});a&&!o&&(o=(l=t.events)==null?void 0:l.find(y=>y.eventId===a));let h=W9({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:s,event:o});if(n&&h!=null&&h.error)return h;if(!e&&h!=null&&h.drawDefinition&&(e=h?.drawDefinition),r=r??h?.structure,!r&&i&&!n){if(!e)return{error:Xd};let y=ui({drawDefinition:e,structureId:i});if(y.error)return y;r=y.structure}let f=(r?.tieFormat||r?.tieFormatId)&&((u=Xs({structure:r,drawDefinition:e,event:o}))==null?void 0:u.tieFormat),m=(e?.tieFormat||e?.tieFormatId)&&((c=Xs({drawDefinition:e,event:o}))==null?void 0:c.tieFormat),g=(d=Xs({event:o}))==null?void 0:d.tieFormat,v=(p=Xs({matchUp:h?.matchUp,drawDefinition:e,structure:r,event:o}))==null?void 0:p.tieFormat;return{...ue,matchUp:h?.matchUp,structureDefaultTieFormat:fs(f),eventDefaultTieFormat:fs(g),drawDefaultTieFormat:fs(m),tieFormat:fs(v),structure:r}}var dTe={};$i(dTe,{bulkUpdatePublishedEventIds:()=>K9,getAllEventData:()=>Z9,getCourtInfo:()=>Y$,getDrawData:()=>EB,getEventData:()=>PB,getEventPublishStatus:()=>hc,getPublishState:()=>G0,getTournamentPublishStatus:()=>KM,getVenueData:()=>gU});function K9({tournamentRecord:t,outcomes:e}){var i;if(!t)return{error:lt};if(!(e!=null&&e.length))return{error:Xt,info:"Missing outcomes"};let n=e.reduce((a,s)=>{let{drawId:o,eventId:l}=s;return l&&o&&(a[l]?a[l].includes(o)||a[l].push(o):a[l]=[o]),a},{}),r=Object.keys(n);return{publishedEventIds:((i=t.events)==null?void 0:i.filter(a=>r.includes(a.eventId))).filter(a=>{let s=hc({event:a}),{drawDetails:o,drawIds:l}=s??{},{eventId:u}=a;return n[u].filter(c=>{let d=o?Object.keys(s.drawDetails).filter(p=>M8({drawId:p,drawDetails:o})):[];return l?.includes(c)||d.includes(c)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:n}}function pTe({dates:t=[],extension:e}){var i;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let n=Qi(e.value)?(i=e.value)==null?void 0:i.dates:void 0;if(Array.isArray(n))return n!=null&&n.length?!!n.filter(r=>!t.length||t.includes(r)).length:!1}function hTe({convertExtensions:t,ignoreDisabled:e,venue:i,court:n}){var r;let a={...At(n,t,!0),venueId:i.venueId},{extension:s}=ki({name:Od,element:n});if(e&&s){let o=Qi(s.value)?(r=s.value)==null?void 0:r.dates:void 0,l=s?.value===!0?[]:a.dateAvailability.map(u=>{let c=u.date;if(!(!c||o.includes(c)))return u}).filter(Boolean);a.dateAvailability=l}return{inContextCourt:a}}function tg(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:n=[],dates:r}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},s=[],o=[],l=[],u=[];return Object.keys(a).filter(c=>!t.tournamentId||c===t.tournamentId).forEach(c=>{let d=a[c];for(let p of d.venues??[])if(!(n.length&&!n.includes(p.venueId))){if(i){let{extension:h}=ki({name:Od,element:p});if(h!=null&&h.value)continue}s.includes(p.venueId)||(u.push(At(p,e,!0)),s.push(p.venueId));for(let h of p.courts??[])if(!o.includes(h.courtId)){if(i){let{extension:m}=ki({name:Od,element:h});if(pTe({extension:m,dates:r}))continue}let{inContextCourt:f}=hTe({convertExtensions:e,ignoreDisabled:i,venue:p,court:h});l.push(f),o.push(h.courtId)}}}),{courts:l,venues:u,...ue}}function T9e({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:n}){if(!e)return{error:gr};let r=At(e.venues??[],t).filter(s=>{if(!i)return s;let{extension:o}=ki({name:Od,element:s});return!(o!=null&&o.value)&&s}).filter(Boolean),a=r.reduce((s,o)=>{let l=(o?.courts||[]).filter(u=>{if(!i&&!(n!=null&&n.length))return u;let{extension:c}=ki({name:Od,element:u});return pTe({extension:c,dates:n})}).filter(Boolean).map(u=>{let{inContextCourt:c}=hTe({convertExtensions:t,ignoreDisabled:i,venue:o,court:u});return c});return l.length?s.concat(l):s},[]);return{venues:r,courts:a}}function fN({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:gr}:Object.keys(t).reduce((n,r)=>{let a=t[r],{venues:s}=T9e({tournamentRecord:a,dates:i});return s?.forEach(o=>{let{venueId:l,courts:u}=o;(!e||u!=null&&u.length)&&!n.venueIds.includes(l)&&(n.venues.push(o),n.venueIds.push(l))}),n},{venues:[],venueIds:[]})}function Z9({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:lt};let i=t.events||[],n=t?.participants||[],{tournamentInfo:r}=K0({tournamentRecord:t}),{venues:a}=tg({tournamentRecord:t}),s=i.map(o=>{let{eventId:l}=o,u=oTe({event:o}).eventInfo,c=kM({tournamentRecord:t,event:o}).scheduleTiming,d=(o.drawDefinitions||[]).map(h=>{let f=(({drawId:b,drawName:I,matchUpFormat:S,updatedAt:w})=>({matchUpFormat:S,updatedAt:w,drawName:I,drawId:b}))(h),{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=GD({requireParticipants:!0,tournamentParticipants:n,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:h,event:o});return{drawInfo:f,matchUps:{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=hc({event:o});return Object.assign(u,{drawsData:d,publish:p}),u});return{allEventData:{tournamentInfo:r,venuesData:a,eventsData:s}}}function fTe({publishStatus:t,drawId:e}){var i,n,r;return t!=null&&t.drawDetails?(r=(n=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:n.publishingDetail)==null?void 0:r.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}var mTe="PUBLIC",U9e="ADMIN",D9e={PUBLIC_DISPLAY:mTe,ADMIN_DISPLAY:U9e};function EB(t){var e,i,n;let{tournamentParticipants:r=[],includePositionAssignments:a,policyDefinitions:s,tournamentRecord:o,inContext:l=!0,usePublishState:u,status:c=Du,pressureRating:d,refreshResults:p,contextProfile:h,drawDefinition:f,noDeepCopy:m,sortConfig:g,context:v,event:y}=t;if(!f)return{error:Lt};let b=(({matchUpFormat:A,updatedAt:_,drawType:x,drawName:O,drawId:$})=>({matchUpFormat:A,updatedAt:_,drawName:O,drawType:x,drawId:$}))(f);b.display=(e=ki({element:f,name:px}).extension)==null?void 0:e.value;let I={},S,{allStructuresLinked:w,sourceStructureIds:T,hasDrawFeedProfile:U,structureGroups:C}=nB({drawDefinition:f});if(!w)return{error:Wve};let E=t?.publishStatus??hc({event:y,status:c}),P=t.eventPublished??!!((n=(i=G0({event:y}).publishState)==null?void 0:i.status)!=null&&n.published),M=!1,R=!1,N=C.map(A=>{let _={},x=A.map(O=>{let{structure:$}=ui({drawDefinition:f,structureId:O}),{seedAssignments:F}=ec({drawDefinition:f,structure:$});return $?.stage===_t&&$.stageSequence===1&&(S=F),$?.stage===Kt&&(I[$.stageSequence??0]=F),$}).sort((O,$)=>k0(O,$,g)).map(O=>{var $,F;if(!O)return;let j=O?.structureId,H=[];O.stage&&[_t,Ds,Tr].includes(O.stage)&&(H=S),O?.stage===Kt&&(H=I[O.stageSequence??0]);let{matchUps:G,roundMatchUps:W,roundProfile:q}=vn({seedAssignments:($=O?.seedAssignments)!=null&&$.length?void 0:H,context:{drawId:b.drawId,...v},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:r,policyDefinitions:s,tournamentRecord:o,usePublishState:u,publishStatus:E,contextProfile:h,drawDefinition:f,inContext:l,structure:O,event:y}),{positionAssignments:Z}=Fn({structure:O}),K=Z?.filter(Bl(lf)).map(re=>{var oe,de;let se=(de=(oe=ki({element:re,name:rv}))==null?void 0:oe.extension)==null?void 0:de.value,{drawPosition:ge,participantId:ye}=re;return R=!0,{participantResult:se,participantId:ye,drawPosition:ge}});if(G.length&&(!(K!=null&&K.length)&&t.allParticipantResults||p&&!O.structures)){let{subOrderMap:re}=S0e({positionAssignments:Z}),oe=G.some(se=>se.matchUpType===hu)?G.filter(se=>se.matchUpType===hu):G,de=KD({matchUpFormat:O.matchUpFormat,matchUps:oe,policyDefinitions:s,pressureRating:d,subOrderMap:re});K=Z?.filter(Bl(lf)).map(se=>{var ge;let{drawPosition:ye,participantId:Te}=se;return R=!0,{participantResult:Te&&((ge=de?.participantResults)==null?void 0:ge[Te]),participantId:Te,drawPosition:ye}})}let Q=O?(({stageSequence:re,structureName:oe,structureType:de,matchUpFormat:se,stage:ge})=>({stageSequence:re,structureName:oe,structureType:de,matchUpFormat:se,stage:ge}))(O):{},J=(F=ki({element:O,name:px}).extension)==null?void 0:F.value;Q.display=J?.[mTe]??J,Q.sourceStructureIds=T[j],Q.hasDrawFeedProfile=U[j],Q.positionAssignments=Z,Q.structureActive=G.reduce((re,oe)=>{var de;let se=[jr,oa,vd,kr,oh,Wi,os,ln].includes(oe.matchUpStatus);return re||se||!!oe.winningSide||!!((de=oe.score)!=null&&de.scoreStringSide1)},!1);let ne=G.reduce((re,oe)=>re&&[fn,kr,os,ln,Wi,ul].includes(oe.matchUpStatus),!!G.length);return Q.structureCompleted=ne,_[j]=ne,Q.structureActive&&(M=!0),{...Q,participantResults:K,seedAssignments:H,roundMatchUps:W,roundProfile:q,structureId:j}});return x.forEach(O=>{var $;a||delete O.positionAssignments,O.sourceStructuresComplete=($=O.sourceStructureIds)==null?void 0:$.every(F=>_[F])}),x}).flat();return b.drawActive=M,b.participantPlacements=R,b.drawGenerated=N?.reduce((A,_)=>A||!!(_!=null&&_.roundMatchUps),!1),b.drawCompleted=N?.reduce((A,_)=>A&&_.structureCompleted,!0),b.drawPublished=u?P&&fTe({publishStatus:E,drawId:b.drawId}):void 0,{structures:!u||b.drawPublished?m&&N||At(N,!1,!0):void 0,drawInfo:m?b:At(b,!1,!0),...ue}}function PB(t){var e,i,n;let{includePositionAssignments:r,participantsProfile:a,policyDefinitions:s,usePublishState:o,status:l=Du,contextProfile:u,sortConfig:c}=t,d=Yt(t,[{tournamentRecord:!0},{[G7]:{event:!1,eventId:!1}}]);if(d.error)return d;let p=At(t.tournamentRecord,!1,!0),h=t.event?void 0:jo({tournamentRecord:p,eventId:t.eventId}).event,f=t.event?At(t.event,!1,!0):h&&At(h,!1,!0)||void 0;if(!f)return{error:Xu};let{eventId:m}=f,{tournamentId:g,endDate:v}=p,y=hc({event:f,status:l}),b=G0({event:f}).publishState??{},I=!!((e=b?.status)!=null&&e.published),{participants:S}=hr({withEvents:!1,withDraws:!1,policyDefinitions:s,...a,tournamentRecord:p}),w=({stage:_,drawId:x})=>{var O,$,F;if(!o)return!0;let j=($=(O=y?.drawDetails)==null?void 0:O[x])==null?void 0:$.stageDetails;return!j||!Object.keys(j).length?!0:(F=j[_])==null?void 0:F.published},T=({structureId:_,drawId:x})=>{var O,$,F;if(!o)return!0;let j=($=(O=y?.drawDetails)==null?void 0:O[x])==null?void 0:$.structureDetails;return!j||!Object.keys(j).length?!0:(F=j[_])==null?void 0:F.published},U=({drawId:_})=>o?fTe({publishStatus:y,drawId:_}):!0,C=({drawId:_,structure:x})=>{var O,$,F,j;if(!o)return x;let H=(j=(F=($=(O=y?.drawDetails)==null?void 0:O[_])==null?void 0:$.structureDetails)==null?void 0:F[x.structureId])==null?void 0:j.roundLimit;if(bi(H)){let G=Et(1,H+1),W={},q={};for(let Z of G)x.roundMatchUps[Z]&&(W[Z]=x.roundMatchUps[Z],q[Z]=x.roundProfile[Z]);x.roundMatchUps=W,x.roundProfile=q}return x},E=f.drawDefinitions||[],P=!o||I?E.filter(U).map(_=>(({drawInfo:x,structures:O})=>({...x,structures:O}))(EB({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:m,tournamentId:g,endDate:v},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:r,tournamentParticipants:S,noDeepCopy:!0,policyDefinitions:s,tournamentRecord:p,usePublishState:o,contextProfile:u,drawDefinition:_,publishStatus:y,sortConfig:c,event:f}))).map(({structures:_,...x})=>{let O=_?.filter(({stage:$,structureId:F})=>T({structureId:F,drawId:x.drawId})&&w({stage:$,drawId:x.drawId})).map($=>C({drawId:x.drawId,structure:$}));return{...x,structures:O}}).filter(_=>{var x;return(x=_.structures)==null?void 0:x.length}):void 0,M=(Array.isArray(p.venues)?p.venues:[]).map(_=>(({venueData:x})=>({...x}))(gU({venueId:_.venueId,tournamentRecord:p}))),R=(({eventId:_,eventName:x,eventType:O,eventLevel:$,surfaceCategory:F,matchUpFormat:j,category:H,gender:G,startDate:W,endDate:q,ballType:Z,discipline:K})=>({eventId:_,eventName:x,eventType:O,eventLevel:$,surfaceCategory:F,matchUpFormat:j,category:H,gender:G,startDate:W,endDate:q,ballType:Z,discipline:K}))(f);R.display=(i=ki({element:f,name:px}).extension)==null?void 0:i.value;let{tournamentInfo:N}=K0({tournamentRecord:p}),A={tournamentInfo:N,venuesData:M,eventInfo:R,drawsData:P};return A.eventInfo.publishState=b,A.eventInfo.published=(n=b?.status)==null?void 0:n.published,{...ue,eventData:A,participants:S}}var gTe={};$i(gTe,{courtGridRows:()=>AB,findVenue:()=>bf,getMatchUpsToSchedule:()=>CB,getPersonRequests:()=>Xb,getProfileRounds:()=>NB,getScheduledRoundsDetails:()=>mN,getSchedulingProfile:()=>ig,getSchedulingProfileIssues:()=>X9,publicFindCourt:()=>E8});function wU({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:n}){var r,a,s,o;let{individualParticipantIds:l}=V$(n);i=i??((r=n.schedule)==null?void 0:r.timeAfterRecovery);let u=h=>{t[h]||(t[h]=[]),t[h]=Si(t[h].concat(...l))},c=h=>{i&&(!e[h]||i>e[h])&&(e[h]=i)},d=((a=n.winnerTo)==null?void 0:a.matchUpId)||n.winnerMatchUpId;d&&(i&&c(d),u(d));let p=((s=n.loserTo)==null?void 0:s.matchUpId)||n.loserMatchUpId;p&&(i&&c(p),u(p)),(o=n.sidesTo)!=null&&o.length&&n.sidesTo.forEach(({matchUpId:h})=>{h&&(i&&c(h),u(h))})}function CB(t){let e=Yt(t,[{[V7]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:n=[],scheduleCompletedMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,orderedMatchUpIds:o,clearDate:l,matchUps:u}=t,c=s?Object.keys(s):[],d=(o??[]).map(h=>u.find(f=>f.matchUpId===h)).filter(Boolean).filter(h=>{let f=!l&&(n.includes(h.matchUpId)||c.includes(h.matchUpId)),m=[fn,Wi,kr,ul,os,ln,jr,oa].includes(h?.matchUpStatus);return r||!f&&!h.winningSide&&!m}),p=i&&a?d.reduce((h,f)=>{let{drawId:m,tournamentId:g}=f;return h.matchUpMap[g]||(h.matchUpMap[g]={}),h.matchUpMap[g][m]?h.matchUpMap[g][m].push(f):h.matchUpMap[g][m]=[f],wU({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:f}),h},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function RB({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:n,categoryName:r,categoryType:a,tournamentId:s,eventType:o,eventId:l}){if(!Ll({matchUpFormat:n}))return{error:vM};let u=Object.keys(i).filter(d=>!s||d===s),c;return u.forEach(d=>{var p;if(c)return;let h=i[d],f=l?(p=jo({tournamentRecord:h,eventId:l}))==null?void 0:p.event:void 0;return c=GM({tournamentRecord:h,matchUpFormat:n,categoryName:r,categoryType:a,eventType:o,event:f}),c?.averageMinutes||c?.recoveryMinutes}),{recoveryMinutes:c?.recoveryMinutes||t,averageMinutes:c?.averageMinutes||e,typeChangeRecoveryMinutes:c?.typeChangeRecoveryMinutes||c?.recoveryMinutes||t}}function mN(t){let e=Yt(t,[{[G7]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[Ho]:Os}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:n=30}=t,r=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof r!="object")return{error:gr};let a={},s=[],o=t.rounds.toSorted((f,m)=>(f.sortOrder??0)-(m.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(r).map(f=>VD({tournamentRecord:f}).containedStructures)),u=t.matchUps??Wd({nextMatchUps:!0,tournamentRecords:r}).matchUps,c=0,d={},p={},h={};return{scheduledRoundsDetails:o.flatMap(f=>{var m;let g=f.periodLength||n,v=[];l!=null&&l[f.structureId]?v.push(...l[f.structureId]):v.push(f.structureId);let y=u?Kf({tournamentIds:[f.tournamentId],roundNumbers:[f.roundNumber],matchUpIds:f.matchUpIds,eventIds:[f.eventId],drawIds:[f.drawId],processContext:!0,structureIds:v,matchUps:u}).sort(j0):[],{segmentNumber:b,segmentsCount:I}=f.roundSegment||{};if(bi(b)&&Gd(y?.length)&&Gd(I)&&b>0&&b<=I&&I<y?.length&&!((m=f.matchUpIds)!=null&&m.length)){let U=y.length/I,C=U*(b-1);y=y.slice(C,C+U)}let S=r[f.tournamentId],w=jo({drawId:f.drawId,tournamentRecord:S}).event,T=[];for(let U of y){let C=U.matchUpFormat;C&&(a[C]||(a[C]=[],a[C].push(U)),T.push(C))}for(let U of T){let{eventType:C,category:E}=w??{},{categoryName:P,ageCategoryCode:M}=E??{},{typeChangeRecoveryMinutes:R,recoveryMinutes:N,averageMinutes:A,error:_}=RB({categoryName:P??M,categoryType:E?.categoryType,tournamentId:f.tournamentId,eventId:f.eventId,tournamentRecords:r,matchUpFormat:U,eventType:C});if(_)return{error:_,round:f};let x=y.filter($=>(i||!wa.includes($.matchUpStatus))&&$.matchUpStatus!==fn).map(Na);x.forEach($=>{h[$]={typeChangeRecoveryMinutes:R,recoveryMinutes:N,averageMinutes:A},d[$]=N,p[$]=A}),s.push(...x),c=Math.max(A||0,c);let O=`${A}|${g}`;return{roundPeriodLength:g,recoveryMinutes:N,averageMinutes:A,matchUpIds:x,hash:O}}}),greatestAverageMinutes:c,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:s,minutesMap:h,...ue}}function vTe({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:n}){let r=[],a=t?.map(o=>{let l=Ci(o?.scheduleDate);if(!l){r.push(`Invalid date: ${o?.scheduledDate}`);return}let u=(o?.venues||[]).map(c=>{let{rounds:d,venueId:p}=c;if(!(e!=null&&e.includes(p))){r.push(`Missing venueId: ${p}`);return}let h=d.filter(f=>{let m=i.includes(f.eventId)&&n.includes(f.drawId);return m||r.push(`Invalid eventId: ${f.eventId} or drawId: ${f.drawId}`),m});if(h.length)return{venueId:p,rounds:h}}).filter(Boolean);return u.length&&l&&{...o,venues:u}}).filter(Boolean),s=r.length;return{updatedSchedulingProfile:a,modifications:s,issues:r}}function MB({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:Ce};let{venueIds:i,tournamentsMap:n}=P9e({tournamentRecords:t}),r,a,s=e.every(o=>{let{scheduleDate:l,venues:u}=o;return Pl(l)?u.every(c=>{let{venueId:d,rounds:p}=c;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(h=>{var f,m,g,v;if(!h)return a="empty round",!1;let{roundSegment:y,tournamentId:b,structureId:I,roundNumber:S,eventId:w,drawId:T}=h,U=(v=(g=(m=(f=n?.[b])==null?void 0:f[w])==null?void 0:m[T])==null?void 0:g[I])==null?void 0:v.includes(S);U||(a="Invalid rounds");let{segmentNumber:C,segmentsCount:E}=y||{},P=!y||bi(C)&&Gd(E)&&C<=E;return P||(a="Invalid segment"),U&&P}):(r=C0,!1):(a="rounds should be an array",!1)}):!1});return!s&&!r&&(r=Ce),{valid:!!s,error:r,info:a}}function E9e(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:n}=t,r=[],a=[],s=[],o=[],l=(e?.venues||[]).map(({venueId:c,courts:d})=>(!n||d?.length)&&c),u=e?.tournamentId;return u&&(r.push(u),i[u]={},(e?.events||[]).forEach(c=>{let d=c.eventId;s.push(d),i[u][d]={},(c.drawDefinitions||[]).forEach(p=>{let h=p.drawId;o.push(h),i[u][d][h]={};let{structures:f}=ud({drawDefinition:p});(f||[]).forEach(m=>{var g;let v=m.structureId,{matchUps:y}=vn({structure:m}),{roundMatchUps:b}=bo({matchUps:y}),I=b&&Object.keys(b).map(S=>parseInt(S));i[u][d][h][v]=I,a.push(v),(g=m.structures)!=null&&g.length&&m.structures.forEach(S=>{a.push(S.structureId),i[u][d][h][S.structureId]=I})})})})),{tournamentMap:i,tournamentIds:r,structureIds:a,venueIds:l,eventIds:s,drawIds:o}}function P9e(t){let e=t?.tournamentRecords&&Object.values(t?.tournamentRecords)||[],i={},{venueIds:n,eventIds:r,drawIds:a,structureIds:s,tournamentIds:o}=e.reduce((l,u)=>{let{tournamentIds:c,tournamentMap:d,structureIds:p,venueIds:h,eventIds:f,drawIds:m}=E9e({tournamentRecord:u});return h.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...c),l.structureIds.push(...p),l.eventIds.push(...f),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:o,structureIds:s,venueIds:n,eventIds:r,drawIds:a}}function ig({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:gr};let{extension:i}=ki({element:e,name:Pw,tournamentRecords:t,discover:!0}),n=i?.value||[];if(n.length){let{venueIds:r}=fN({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:s}=u9({tournamentRecords:t}),{updatedSchedulingProfile:o,modifications:l,issues:u}=vTe({schedulingProfile:n,venueIds:r,eventIds:a,drawIds:s});if(l){n=o;let c=ZD({tournamentRecords:t,tournamentRecord:e,schedulingProfile:n});return c.error?c:{schedulingProfile:n,modifications:l,issues:u}}}return{schedulingProfile:n,modifications:0}}function ZD({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let n=MB({tournamentRecords:t,schedulingProfile:i});return n.error?n:i?dn({tournamentRecords:t,discover:!0,extension:{name:Pw,value:i}}):po({element:e,name:Pw,tournamentRecords:t,discover:!0})}function gN(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:u,issues:c}=ig({tournamentRecords:i,tournamentRecord:e});return{success:!u,modifications:u,issues:c}}let{venueIds:n}=fN({tournamentRecords:i}),{eventIds:r,drawIds:a}=u9({tournamentRecords:i}),{updatedSchedulingProfile:s,modifications:o,issues:l}=vTe({schedulingProfile:t.schedulingProfile,venueIds:n,eventIds:r,drawIds:a});return o?{...ZD({schedulingProfile:s,tournamentRecords:i}),modifications:o,issues:l}:{...ue,modifications:o,issues:l}}function X9(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:n=30}=t??{};if(typeof i!="object")return{error:fM};if(!Array.isArray(e))return{error:Ce};if(!e.every(Pl))return{error:za};let r=[],a=0,s={},{schedulingProfile:o}=ig({tournamentRecords:i});if(!o)return{issues:r,...ue};let{matchUps:l}=Wd({nextMatchUps:!0,tournamentRecords:i});for(let c of o){let{scheduleDate:d,venues:p=[]}=c;if(!(e!=null&&e.length)||e.includes(d)){for(let h of p||[])if(h){let{rounds:f}=h,m=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=mN({tournamentRecords:i,periodLength:n,matchUps:l,rounds:f}),{matchUpDependencies:y}=bd({tournamentRecords:i,matchUps:l}),b=I=>{let S;return v?.find((w,T)=>{let U=w.matchUpIds.includes(I);return U&&(S=T),U}),S};if(g?.forEach((I,S)=>{var w;let T=g.slice(S+1),U=Pr(T,((w=y?.[I])==null?void 0:w.matchUpIds)||[]);U.length&&m.push({matchUpId:I,shouldBeAfter:U})}),m.length){a+=m.length;let I=m.map(({matchUpId:S,shouldBeAfter:w})=>{let T=b(S),U=Si(w.map(b));return s[d]||(s[d]={}),s[d][T]||(s[d][T]=[]),U.forEach(C=>{s[d][T].includes(C)||s[d][T].push(C)}),{matchUpId:S,matchUpRoundIndex:T,earlierRoundIndices:U,shouldBeAfter:w}});r.push(...I)}}}}let u={matchUpIdShouldBeAfter:Object.assign({},...r.map(c=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:h}=c;return{[d]:{earlierRoundIndices:h,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:s,...ue}}function Xb(t){let{tournamentRecords:e,requestType:i}=t,n=Yt(t,[{[Hs]:!0}]);if(n.error)return n;let r={};for(let a of Object.values(e)){let{extension:s}=ki({element:a,name:$D}),o=s?.value||[];for(let l of o){let{personId:u,requests:c}=l||{};r[u]||(r[u]=[]);for(let d of c)i&&d.requestType!==i||r[u].push(d)}}return{personRequests:r,...ue}}function rz(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:n,tournamentId:r,roundNumber:a,structureId:s,eventId:o,drawId:l}=t,u=n?e:s,c=[r,o,l,u,a].join("|");return Gt({structureId:u,roundSegment:i,tournamentId:r,roundNumber:a,eventId:o,drawId:l,id:c})}function KQ({round:t,matchUps:e,events:i,tournamentRecords:n}){let r=i.find(p=>p.eventId===t.eventId),{eventType:a,category:s,categoryType:o}=r||{},{categoryName:l,ageCategoryCode:u}=s||{},c=Ol(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(c).forEach(p=>{let h=c[p],f=RB({categoryName:l||u,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:n,matchUpFormat:p,categoryType:o,eventType:a});if(f.error)return f;let m=f.averageMinutes*h;isNaN(d)||(d+=m)}),{roundMinutes:d}}function C9e(t){return(t||[]).reduce((e,i)=>{var n,r;let a=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((o,l)=>o+l,0),s=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).join("-")||"";return!e.minFinishingSum||a<e.minFinishingSum?{minFinishingSum:a,winnerFinishingPositionRange:s}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function ZQ(t){let e=t.length,i=t.filter(({sides:u})=>u?.some(({bye:c})=>c)).length||0,n=t.filter(({winningSide:u,matchUpStatus:c})=>u||wa.includes(c)).length||0,r=t.filter(({schedule:u,matchUpStatus:c})=>u?.scheduledDate&&u?.scheduledTime&&c!==fn).length||0,a=e-i,s=a===n,o=a-r,l=a-r;return{unscheduledCount:o,incompleteCount:l,scheduledCount:r,completedCount:n,matchUpsCount:e,isScheduled:a===r,isComplete:s,byeCount:i}}function NB({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:n}){if(i&&!t){if(typeof i!="object")return{error:fM};t={[i.tournamentId]:i}}if(e){let a=MB({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=ig({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:Xa};let r={};return{profileRounds:e.map(({venues:a,scheduleDate:s})=>a.map(({rounds:o})=>o.map(l=>{var u;let c=rz(l);return(u=c.roundSegment)!=null&&u.segmentsCount&&(r[c.id]=c.roundSegment.segmentsCount),Gt({id:n?c.id:void 0,scheduleDate:s,...c})}))).flat(1/0),segmentedRounds:r}}function AB({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:Ce};let n=i?.reduce((s,o)=>{let l=o.matchUps||[],u=Math.max(0,...l.map(c=>c.schedule.courtOrder||0));return u>s?u:s},1),r=e?Math.max(e,n):n,a=Et(0,r).map(s=>({matchUps:Et(0,i.length).map(o=>{let l=i[o],{courtId:u,venueId:c}=l;return{schedule:{courtOrder:s+1,venueId:c,courtId:u}}})}));return i.forEach((s,o)=>{var l;for(let u of s.matchUps){let c=(l=u.schedule)==null?void 0:l.courtOrder;c&&(a[c-1].matchUps[o]=u)}}),{courtPrefix:t,rows:a.map((s,o)=>Object.assign({rowId:`rowId-${o+1}`},...s.matchUps.map((l,u)=>({[`${t}${u}`]:l}))))}}var yTe={};$i(yTe,{getEntriesAndSeedsCount:()=>_B,getMaxEntryPosition:()=>J9});function _B({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:n,event:r,stage:a}){if(!r)return{error:Wn};let{entries:s,stageEntries:o}=Uwe({drawDefinition:e,drawId:n,stage:a,event:r}),l=o.length,{drawSize:u}=K0e({participantsCount:l}),c=pN({drawSize:i??u,participantsCount:l,policyDefinitions:t});if(c.error)return pe({result:c,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=c;return{entries:s,seedsCount:d,stageEntries:o}}function J9(t){let{entries:e=[],entryStatus:i,stage:n}=t;return Math.max(...e.filter(r=>(!n||n===r.entryStage)&&(!i||r.entryStatus===i)&&!isNaN(r.entryPosition)).map(({entryPosition:r})=>ai(r||0)),0)}var bTe={};$i(bTe,{allCompetitionMatchUps:()=>Wd,allDrawMatchUps:()=>ho,allEventMatchUps:()=>If,allTournamentMatchUps:()=>Qa,analyzeMatchUp:()=>l1,calculateWinCriteria:()=>Z0,checkMatchUpIsComplete:()=>Ny,competitionScheduleMatchUps:()=>yN,drawMatchUps:()=>uY,eventMatchUps:()=>xB,filterMatchUps:()=>Kf,getAllDrawMatchUps:()=>pa,getAllStructureMatchUps:()=>vn,getCheckedInParticipantIds:()=>$0,getCompetitionMatchUps:()=>o1,getEventMatchUpFormatTiming:()=>eY,getHomeParticipantId:()=>rY,getMatchUpCompetitiveProfile:()=>jM,getMatchUpContextIds:()=>aY,getMatchUpDailyLimits:()=>LB,getMatchUpDailyLimitsUpdate:()=>tY,getMatchUpDependencies:()=>bd,getMatchUpFormat:()=>sY,getMatchUpFormatTiming:()=>GM,getMatchUpFormatTimingUpdate:()=>Q9,getMatchUpScheduleDetails:()=>K$,getMatchUpType:()=>Z$,getMatchUpsStats:()=>oY,getModifiedMatchUpFormatTiming:()=>kB,getParticipantResults:()=>sN,getPredictiveAccuracy:()=>nY,getRoundMatchUps:()=>bo,getRounds:()=>lY,isValidMatchUpFormat:()=>Ll,matchUpActions:()=>pB,participantScheduledMatchUps:()=>iY,tallyParticipantResults:()=>KD,tournamentMatchUps:()=>OB,validMatchUp:()=>H$,validMatchUps:()=>pc});function ITe({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:gr};let i=[],n;for(let r of Object.values(t)){let{extension:a}=ki({element:r,name:e});a&&!n&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),n=!0);let s=r.events??[];for(let o of s){let{eventId:l}=o,{extension:u}=ki({name:e,element:o});u&&i.push({params:{eventId:l,extension:u},method:"addEventExtension"})}}return{methods:i}}function Q9({tournamentRecords:t}){return ITe({extensionName:Mm,tournamentRecords:t})}var LV="ADULT",FV="JUNIOR",hA="WHEELCHAIR",wTe={[_v]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[En]:30,default:60}}]},defaultDailyLimits:{[Mn]:2,[En]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Kc],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[hA],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[LV,hA],minutes:{default:60,[En]:30}},{categoryTypes:[FV],minutes:{default:60,[En]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[LV,hA],minutes:{default:30}},{categoryTypes:[FV],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[LV,FV],minutes:{default:30}},{categoryTypes:[hA],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},R9e=wTe;function eY({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:n}){if(!n)return{error:Wn};let r=[],a;if(e!=null&&e.length){let d=[];r=e.map(p=>{let h=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(h?.matchUpFormat)&&Ll({matchUpFormat:h?.matchUpFormat}))return d.push(h.matchUpFormat),h}).filter(Boolean)}else{let{policy:d}=Hb({policyType:Qu,tournamentRecord:t,event:n});if(d!=null&&d.matchUpFormats)r=d?.matchUpFormats;else{let{extension:p}=ki({name:Mm,element:n}),h,f;p!=null&&p.value?{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=p.value:{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=R9e[_v],r=Si([...(h||[]).map(m=>m.matchUpFormatCodes),...(f||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),a="default scheduling policy in use"}}let{eventType:s,eventId:o,category:l}=n,u=l?.categoryName??l?.ageCategoryCode??o;if(!o)return{error:Wn};let c=r.map(({matchUpFormat:d,description:p})=>{let h=GM({tournamentRecord:t,matchUpFormat:d,categoryName:u,categoryType:i,eventType:s,event:n});return{matchUpFormat:d,description:p,...h}});return Gt({eventMatchUpFormatTiming:c,info:a})}function kB(t){let e=Yt(t,[{[Ta]:!0},{[vs]:m=>Ll({matchUpFormat:m}),[vu]:vM,[F7]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:n,event:r}=t,{extension:a}=ki({name:Mm,element:r}),s=a?.value,{extension:o}=ki({element:i,name:Mm}),l=o?.value,u=s?.matchUpAverageTimes&&RP({...s,matchUpFormat:n}),c=l?.matchUpAverageTimes&&RP({...l,matchUpFormat:n}),d=[u,c].find(m=>m),p=s?.matchUpRecoveryTimes&&MP({...s,matchUpFormat:n}),h=l?.matchUpRecoveryTimes&&MP({...l,matchUpFormat:n}),f=[p,h].find(m=>m);return{matchUpFormat:n,recoveryTimes:f,averageTimes:d}}function tY({tournamentRecords:t}){return ITe({extensionName:RM,tournamentRecords:t})}var vN=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function iY({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!pc(e))return{error:Km};if(!Array.isArray(t))return{error:Ce};let i=e.filter(Boolean).filter(({schedule:n})=>vN({schedule:n,scheduleAttributes:t})).reduce((n,r)=>{let{schedule:a}=r,s=Ci(a?.scheduledDate),o=er(a?.scheduledTime);return s&&o&&(n[s]?n[s].push(r):n[s]=[r]),n},{});return Object.keys(i).forEach(n=>{i[n].sort((r,a)=>{var s,o;return rbe(er((s=r.schedule)==null?void 0:s.scheduledTime),er((o=a.schedule)==null?void 0:o.scheduledTime))})}),{...ue,scheduledMatchUps:i}}function M9e({tournamentRecords:t}){var e;let i={},n=[];for(let r of Object.values(t))for(let a of r.events??[]){let s=hc({event:a}),o=s?.drawDetails;Qi(o)?(Object.assign(i,o),n.push(...Object.keys(o).filter(l=>M8({drawId:l,drawDetails:o})))):(e=s?.drawIds)!=null&&e.length&&n.push(...s.drawIds)}return{drawIds:n,detailsMap:i}}function Mx({schedulingProfile:t,matchUps:e=[]}){let i={},n=({eventId:o,drawId:l,structureId:u,roundNumber:c})=>`${o}|${l}|${u}${c}`;t!=null&&t.length&&t.map(({venues:o})=>o.map(({rounds:l})=>l)).flat().forEach(o=>{o.sort((l,u)=>(l.sortOrder||0)-(u.sortOrder||0)).forEach(({eventId:l,drawId:u,structureId:c,roundNumber:d},p)=>{let h=n({eventId:l,drawId:u,structureId:c,roundNumber:d});i[h]=p})});let r=[],a={noScheduledDate:[]};for(let o of e){let l=o.schedule||{},u=l.scheduledDate&&Ci(l.scheduledDate)||l.scheduledTime&&Ci(l.scheduledTime)||"noScheduledDate";a[u]||(a[u]=[]),a[u].push(o)}let s=Object.keys(a).sort();for(let o of s){let l=a[o],u={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},h=p.scheduledTime&&er(p.scheduledTime)||"noScheduledTime";u[h]||(u[h]=[]),u[h].push(d)}let c=Object.keys(u).sort();for(let d of c){let p=u[d];p.sort((h,f)=>{let m=i[n(h)]||0,g=i[n(f)]||0;return m-g}),r.push(...p)}}return r}function xB(t){let{participants:e,contextContent:i,participantMap:n}=t,{tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,tournamentId:g,inContext:v,context:y,event:b}=t;if(!b)return{error:Wn};let{eventId:I,eventName:S,endDate:w,eventType:T,category:U,gender:C}=b??{},E={...y,...Gt({surfaceCategory:b.surfaceCategory??c?.surfaceCategory,indoorOutDoor:b.indoorOutdoor??c?.indoorOutdoor,tournamentId:g??c?.tournamentId,endDate:w??c?.endDate,eventName:S,eventType:T,category:U,eventId:I,gender:C})},P;!e&&c&&({participants:e,participantMap:n,groupInfo:P}=Gb({participantsProfile:s,useParticipantMap:u,tournamentRecord:c,contextProfile:f,inContext:v})),f&&!i&&(i=Qm({policyDefinitions:l,tournamentRecord:c,contextProfile:f,event:b}));let M=hc({event:b});return{...(b.drawDefinitions??[]).reduce((R,N)=>{var A;let _=GD({hydrateParticipants:t.hydrateParticipants,context:E,tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:h,participantMap:n,publishStatus:M,contextProfile:f,drawDefinition:N,nextMatchUps:m,inContext:v,event:b});return(A=Object.keys(_))==null||A.forEach(x=>{Array.isArray(_[x])&&(R[x]||(R[x]=[]),R[x]=R[x].concat(_[x]))}),R},{}),...ue,groupInfo:P}}function OB(t){if(!(t!=null&&t.tournamentRecord))return{error:lt};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,inContext:o=!0,usePublishState:l,contextFilters:u,matchUpFilters:c,contextProfile:d,nextMatchUps:p,context:h}=t,f=t.tournamentId??s.tournamentId,m=s?.events??[],{participants:g,participantMap:v,groupInfo:y}=Gb({participantsProfile:n,tournamentRecord:s,contextProfile:d,inContext:o});d&&!e&&(e=Qm({policyDefinitions:a,tournamentRecord:s,contextProfile:d}));let{appliedPolicies:b}=pn({tournamentRecord:s}),I=u?.eventIds??[];return{...m.filter(S=>!I.includes(S.eventId)).map(S=>{var w,T,U;let C={eventDrawsCount:((T=(w=Rr({event:S}).flightProfile)==null?void 0:w.flights)==null?void 0:T.length)||((U=S.drawDefinitions)==null?void 0:U.length)||0,...h};return xB({hydrateParticipants:t.hydrateParticipants,context:C,tournamentAppliedPolicies:b,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:l,contextFilters:u,contextProfile:d,contextContent:e,matchUpFilters:c,participantMap:v,participants:g,tournamentId:f,nextMatchUps:p,inContext:o,event:S})}).reduce((S,w)=>{var T;return(T=w&&Object.keys(w).filter(U=>!["success","matchUpsMap"].includes(U)))==null||T.forEach(U=>{Array.isArray(w[U])&&(S[U]||(S[U]=[]),S[U]=S[U].concat(w[U]),S.matchUpsCount!==void 0?S.matchUpsCount+=w[U].length:S.matchUpsCount=w[U].length)}),S},{matchUpsCount:0}),groupInfo:y,participants:g}}function o1({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:n,useParticipantMap:r,policyDefinitions:a,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:u,inContext:c}){if(typeof n!="object"||!Object.keys(n).length)return{error:gr};let d=Object.keys(n).map(f=>{let m=n[f];return OB({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,policyDefinitions:a,tournamentRecord:m,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:u,inContext:c})}),p={},h={};return{...d.reduce((f,m)=>(Object.keys(m).forEach(g=>{if(g==="groupInfo")Object.assign(h,m[g]);else if(g==="participants")for(let v of m[g]??[])p[v.participantId]=v;else Array.isArray(m[g])&&(f[g]||(f[g]=[]),f[g]=f[g].concat(m[g]))}),f),{}),groupInfo:h,mappedParticipants:p}}function yN(t){var e,i,n,r,a,s,o;if(typeof t?.tournamentRecords!="object"||!Object.keys(t?.tournamentRecords).length)return{error:gr};let{courts:l,venues:u}=tg(t),c=ig(t).schedulingProfile,{sortDateMatchUps:d=!0,courtCompletedMatchUps:p,alwaysReturnCompleted:h,activeTournamentId:f,tournamentRecords:m,withCourtGridRows:g,minCourtGridRows:v,usePublishState:y,status:b=Du,sortCourtsData:I}=t,S=f??R0()??Object.keys(m)[0],w=y?KM({tournamentRecord:m[S],status:b}):void 0,T=h?o1({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[kr]},contextFilters:t.contextFilters}).completedMatchUps:[];if(y&&!((e=w?.orderOfPlay)!=null&&e.published))return{completedMatchUps:T,dateMatchUps:[],courtsData:[],venues:u};let U,C;y&&({drawIds:U,detailsMap:C}=M9e({tournamentRecords:m})),U!=null&&U.length&&(t.contextFilters||(t.contextFilters={}),(i=t.contextFilters)!=null&&i.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(F=>U.includes(F)):t.contextFilters.drawIds=U),(n=w?.eventIds)!=null&&n.length&&(t.matchUpFilters||(t.matchUpFilters={}),(r=t.matchUpFilters)!=null&&r.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(F=>w.eventIds.includes(F)):t.matchUpFilters.eventIds=w.eventIds),(a=w?.scheduledDates)!=null&&a.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(F=>w.scheduledDates.includes(F)):t.matchUpFilters.scheduledDates=w.scheduledDates),h&&(t.matchUpFilters||(t.matchUpFilters={}),(o=(s=t.matchUpFilters)==null?void 0:s.excludeMatchUpStatuses)!=null&&o.length?t.matchUpFilters.excludeMatchUpStatuses.includes(kr)||t.matchUpFilters.excludeMatchUpStatuses.push(kr):t.matchUpFilters.excludeMatchUpStatuses=[kr]);let{completedMatchUps:E,upcomingMatchUps:P,pendingMatchUps:M,groupInfo:R,mappedParticipants:N}=o1({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),A=[...P??[],...M??[]];C&&(!(U!=null&&U.length)||Object.keys(C).length)&&(A=A.filter(F=>{var j,H;let{drawId:G,structureId:W,stage:q}=F;if(!((H=(j=C?.[G])==null?void 0:j.publishingDetail)!=null&&H.published))return!1;if(C[G].stageDetails){let Z=Object.keys(C[G].stageDetails),K=Z.filter(J=>!C[G].stageDetails[J].published),Q=Z.filter(J=>C[G].stageDetails[J].published);return K.length&&K.includes(q)?!1:Q.length&&Q.includes(q)?!0:K.length&&!K.includes(q)&&!Q.length}if(C[G].structureDetails){let Z=Object.keys(C[G].structureDetails),K=Z.filter(J=>!C[G].structureDetails[J].published),Q=Z.filter(J=>C[G].structureDetails[J].published);return K.length&&K.includes(W)?!1:Q.length&&Q.includes(W)?!0:K.length&&!K.includes(W)&&!Q.length}return!0}));let _=d?Mx({matchUps:A,schedulingProfile:c}):A,x=l?.map(F=>{let j=$(F);return{surfaceCategory:F?.surfaceCategory??"",matchUps:j,...F}}),O={completedMatchUps:h?T:E,mappedParticipants:t.hydrateParticipants?void 0:N,dateMatchUps:_,courtsData:x,groupInfo:R,venues:u};if(g){let{rows:F,courtPrefix:j}=AB({minRowsCount:v,courtsData:x});O.courtPrefix=j,O.rows=F}return{...O,...ue};function $({courtId:F}){let j=(p?_.concat(E??[]):_).filter(H=>{var G,W,q;return((G=H.schedule)==null?void 0:G.courtId)===F||((q=(W=H.schedule)==null?void 0:W.allocatedCourts)==null?void 0:q.map(({courtId:Z})=>Z).includes(F))});return I?Mx({matchUps:j,schedulingProfile:c}):j}}function LB({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:gr};let i=Object.keys(t).filter(r=>!e||r===e),n;return i.forEach(r=>{let a=t[r],{matchUpDailyLimits:s}=N9e({tournamentRecord:a});n=s}),{matchUpDailyLimits:n}}function N9e(t){var e;let i=Yt(t,[{[Ta]:!0}]);if(i.error)return i;let{tournamentRecord:n}=t,{policy:r}=Hb({policyType:_v,tournamentRecord:n}),{extension:a}=ki({element:n,name:RM}),s=(e=a?.value)==null?void 0:e.dailyLimits,o=r?.defaultDailyLimits;return{matchUpDailyLimits:s||o}}function nY(t){var e,i,n,r;let{matchUps:a}=t,{singlesForDoubles:s,tournamentRecord:o,drawDefinition:l,excludeMargin:u,exclusionRule:c,zoneDoubling:d,matchUpType:p,scaleName:h,eventId:f,zonePct:m,drawId:g,event:v}=t;if(!o&&!a)return{error:lt};if(p&&![Mn,En].includes(p))return{error:Ce,info:{matchUpType:p}};if(a&&!pc(a))return{error:Ce,context:{matchUps:a}};let y=Ra[h],b=y?.ascending??t.ascending??!1,I=y?.accessor??t.valueAccessor,S=Array.isArray(y?.range)?Math.abs(y.range[0]-y.range[1]):0,w=bi(m)&&S?(m??0/100)*S:t.zoneMargin??S,T={withScaleValues:!0,withCompetitiveness:!0},U={matchUpTypes:p?[p]:[Mn,En]},C=o?.participants;(e=a?.[0])!=null&&e.hasContext?g?a=a.filter(O=>O.drawId===g):f&&(a=a.filter(O=>O.eventId===f)):a===void 0&&(a=g&&!l&&[]||!g&&f&&!v&&[]||g&&((i=ho({inContext:!0,drawDefinition:l,contextFilters:U,contextProfile:T,participants:C}))==null?void 0:i.matchUps)||!g&&f&&((n=If({inContext:!0,contextFilters:U,contextProfile:T,participants:C,event:v}))==null?void 0:n.matchUps)||((r=Qa({tournamentRecord:o,contextFilters:U,contextProfile:T}))==null?void 0:r.matchUps)||[]),p&&(a=a.filter(O=>O.matchUpType===p));let E=a.filter(({winningSide:O,score:$,sides:F,matchUpStatus:j})=>![os,Wi,ln,BD,ul].includes(j??"")&&Sa({score:$})&&F?.length===2&&O),P=_9e({matchUps:E,excludeMargin:u,exclusionRule:c,valueAccessor:I,ascending:b,scaleName:h}),M=!d||xr(Mn)(p)?w:(w||0)*2,R=w?E.map(({competitiveProfile:O,matchUpType:$,score:F,sides:j})=>{let H=STe({singlesForDoubles:s,valueAccessor:I,matchUpType:$,scaleName:h,sides:j}),G=Math.abs(H[0].value-H[1].value);return{competitiveness:O?.competitiveness,valuesGap:G,score:F}}).filter(({valuesGap:O})=>O<=M):[],N=A9e({zoneData:R}),A=N&&[].concat(Object.values(N)).flat().length,_=A&&Object.assign({},...Object.keys(N).map(O=>({[O]:Math.round(1e4*N[O].length/A)/100}))),x=E.length-(R?.length||0);return{...ue,relevantMatchUps:E,zoneDistribution:_,zoneData:R,accuracy:P,nonZone:x}}function A9e({zoneData:t}){let e={[g8]:[],[e1]:[],[t1]:[]};for(let i of t){let{competitiveness:n,score:r,valuesGap:a}=i;e[n]&&e[n].push({score:r,valuesGap:a})}return e}function STe({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:n,scaleName:r,sides:a}){let s=e?.range.sort(),o=l=>{let u=l?.[e?.valueAccessor];return{exclude:e&&u>=s[0]&&u<=s[1],exclusionValue:u}};return a.sort((l,u)=>l.sideNumber-u.sideNumber).map(({participant:l})=>{let u=[],c=l?.individualParticipants;if(c!=null&&c.length){let d=[],p=0;for(let h of c){let{scaleValue:f,value:m}=XQ({singlesForDoubles:t,valueAccessor:i,participant:h,matchUpType:n,scaleName:r}),{exclude:g,exclusionValue:v}=o(f);g&&u.push(v),d.push(f),m&&!isNaN(p)?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:u,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=XQ({singlesForDoubles:t,valueAccessor:i,matchUpType:n,participant:l,scaleName:r}),{exclude:h,exclusionValue:f}=o(d);return h&&u.push(f),{participantName:l.participantName,exclusionValues:u,scaleValue:d,value:p}}else return{}})}function XQ({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:n,scaleName:r}){var a,s,o,l,u;let c=t?Mn:i,d=(s=(a=n?.rankings)==null?void 0:a[c])==null?void 0:s.find(f=>f.scaleName===r),p=(u=((l=(o=n?.ratings)==null?void 0:o[c])==null?void 0:l.find(f=>f.scaleName===r))||d)==null?void 0:u.scaleValue,h=e?p?.[e]:p;return{scaleValue:p,value:h}}function _9e({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:n,scaleName:r,matchUps:a}){let s={affirmative:[],negative:[],excluded:[]};for(let u of a){let{matchUpType:c,sides:d,score:p,winningSide:h}=u;if(!h)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:Xt};let f=h-1,m=STe({exclusionRule:e,valueAccessor:i,matchUpType:c,scaleName:r,sides:d});if(e){let S=m.map(({exclusionValues:w})=>w).flat();if(S.length){s.excluded.push({scoreString:p?.scoreStringSide1,exclusionValues:S,winningSide:h,sideValues:m});continue}}if(m.filter(S=>![void 0,"",null].includes(S.value)).length<2){s.excluded.push({scoreString:p?.scoreStringSide1,missingValues:!0,winningSide:h,sideValues:m});continue}let g=m[f].value-m[1-f].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){s.excluded.push({scoreString:p?.scoreStringSide1,excludeMargin:t,winningSide:h,excludeGap:y,sideValues:m,valuesGap:g});continue}let b=n?g:g*-1,I=h===1?p?.scoreStringSide1:p?.scoreStringSide2;b>0?s.affirmative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p}):s.negative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p})}let o=s.affirmative.length+s.negative.length,l=o&&s.affirmative.length/o*100;return s.percent=l?Math.round(100*l)/100:0,s}function Z0({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:n}=U0e({collectionGroups:e}),r;for(let a of t||[]){let{collectionValueProfiles:s,collectionGroupNumber:o,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=a,h=o&&n.includes(o);if(bi(p||d))r=!0;else{if(h)continue;if(typeof l=="number"&&bi(l))i+=l;else if(Array.isArray(s)&&s!=null&&s.length)for(let f of s)i+=f.matchUpValue;else typeof c=="number"&&bi(c)&&(i+=(u??0)*c)}}for(let a of e)i+=a.groupValue??0;return r||!i?{aggregateValue:!0,...ue}:{valueGoal:Math.floor(i/2)+1,...ue}}function rY(t){let{timeStamp:e,schedule:i,matchUp:n}=t,r=Yt(t,[{[yf]:!0}]);if(r.error)return r;let{itemValue:a,timeStamp:s}=Wb({timeItems:n?.timeItems||[],itemType:S8});return!i||s&&e&&new Date(s).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function aY({matchUps:t,matchUpId:e}){if(!pc(t))return{error:Ce};let i=t.find(o=>o.matchUpId===e),{drawId:n,eventId:r,structureId:a,tournamentId:s}=i||{};return{matchUpId:e,drawId:n,eventId:r,structureId:a,tournamentId:s}}function XD(t,e){if(!Qi(t))return{error:Ce};if(!Array.isArray(e))return{error:Ce};let i={};for(let{param:n,error:r,attr:a}of e){let s=k9e({params:t,param:n,attr:a,error:r});if(s!=null&&s.error)return s;i[n]=s}return i}function k9e({params:t,param:e,attr:i,error:n}){if(e===R$&&Qi(t.drawDefinition)&&nr(t.structureId)){let r=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!r.length&&n?{error:n}:{structure:r}}if(e===yf){let r=cTe({...t,...i});return r.error&&n?{...r,error:n}:r}return{error:Xa,info:{param:e}}}function sY(t){var e,i;let{structureId:n,matchUpId:r,event:a}=t,s=t.drawDefinition,o=Yt(t,[{[Ta]:!0},{[G7]:{[E$]:!1,[ah]:!1,[nIe]:!1,[Av]:!1}}]);if(o[Zc])return o;let l=(e=XD(t,[{[OD]:yf,[Zc]:Xt}]))==null?void 0:e.matchUp;if(r&&l!=null&&l.error)return l;!s&&l!=null&&l.drawDefinition&&(s=l?.drawDefinition);let u=l?.structure;if(!u&&n&&!r){if(!s)return{error:Xd};let f=ui({drawDefinition:s,structureId:n});if(f.error)return f;u=f.structure}let c=u?.matchUpFormat,d=s?.matchUpFormat,p=a?.matchUpFormat,h=((i=l?.matchUp)==null?void 0:i.matchUpFormat)||c||d||p;return{structureDefaultMatchUpFormat:c,eventDefaultMatchUpFormat:p,drawDefaultMatchUpFormat:d,matchUpFormat:h}}function oY({profileBands:t,tournamentRecord:e,matchUps:i}){if(!pc(i))return{error:Km};let n=!t&&Hb({policyType:Yf,tournamentRecord:e}).policy,r=t||n?.profileBands||v8[Yf].profileBands,a=i.filter(({winningSide:p})=>p),s=a.map(zIe),o=(p,h)=>{let f=HIe(h,r);return p[f]+=1,p},l=qIe(s).reduce((p,h)=>o(p,h),{[g8]:0,[e1]:0,[t1]:0,[$Ie]:0}),u=Object.keys(l).reduce((p,h)=>(l[h]||0)+p,0),c=Object.keys(l).map(p=>{let h=parseFloat((l[p]/u).toFixed(4));return{[p]:h*100}}),d=a.filter(({matchUpStatus:p})=>p===wQ).length;return c.push({[wQ]:parseFloat((d/u).toFixed(4))*100}),{competitiveBands:Object.assign({},...c),...ue}}var{stageOrder:JQ}=hWe;function x9e(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(JQ[t?.stage]||0)-(JQ[e?.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function lY({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:n,tournamentRecords:r,schedulingProfile:a,tournamentRecord:s,withSplitRounds:o,matchUpFilters:l,scheduleDate:u,withRoundId:c,venueId:d,context:p}){var h;if(n&&!Array.isArray(n||typeof n[0]!="object"))return{error:Ce,inContextMatchUps:n};if(s&&!r){if(typeof s!="object")return{error:fM};r={[s.tournamentId]:s}}let f=typeof r!="object"||!Object.keys(r).length;if((d||u||!n||!a&&(t||i||a||o))&&f)return{error:gr};let m=Object.assign({},...Object.values(r??{}).map(({venues:T=[],tournamentId:U})=>({[U]:T?.map(({venueId:C})=>C)}))),g=Object.values(r??{}).map(({events:T=[],tournamentId:U,startDate:C,endDate:E})=>T.map(P=>({...P,validVenueIds:m[U],startDate:P.startDate??C,endDate:P.endDate??E}))).flat(),{segmentedRounds:v,profileRounds:y}=r&&(t||i||a||o)&&NB({tournamentRecords:r,schedulingProfile:a})||{},b=t&&Object.assign({},...y.map(T=>({[T.id]:T}))),I=n||r&&((h=Wd({tournamentRecords:r,matchUpFilters:l}))==null?void 0:h.matchUps)||[],S=[],w=I&&Object.values(I.reduce((T,U)=>{var C;let E=rz(U).id,P=v?.[E],M=[...((C=T[E])==null?void 0:C.matchUps)??[],U],{containerStructureId:R,stageSequence:N,structureName:A,tournamentId:_,isRoundRobin:x,matchUpType:O,roundNumber:$,roundOffset:F,structureId:j,eventName:H,roundName:G,drawName:W,eventId:q,drawId:Z}=U,K=x?R:j;return{...T,[E]:{id:c?E:void 0,structureId:K,stageSequence:N,segmentsCount:P,structureName:A,tournamentId:_,matchUpType:O,roundNumber:$,roundOffset:F,eventName:H,roundName:G,drawName:W,matchUps:M,eventId:q,drawId:Z}}},{})).map(T=>{let{minFinishingSum:U,winnerFinishingPositionRange:C}=C9e(T.matchUps),E=T.segmentsCount;if(E){let O=T.matchUps.length/E;return ka(T.matchUps.sort(($,F)=>$.roundPosition-F.roundPosition),O).map(($,F)=>{let{unscheduledCount:j,incompleteCount:H,matchUpsCount:G,isScheduled:W,isComplete:q,byeCount:Z}=ZQ($),K=KQ({matchUps:T.matchUps,tournamentRecords:r,events:g,round:T});return Gt({...T,...p,roundSegment:{segmentsCount:E,segmentNumber:F+1},winnerFinishingPositionRange:C,unscheduledCount:j,incompleteCount:H,minFinishingSum:U,matchUpsCount:G,isScheduled:W,roundTiming:K,isComplete:q,byeCount:Z,matchUps:$})})}let{unscheduledCount:P,incompleteCount:M,matchUpsCount:R,isScheduled:N,isComplete:A,byeCount:_}=ZQ(T.matchUps),x=KQ({matchUps:T.matchUps,tournamentRecords:r,events:g,round:T});return Gt({...T,...p,winnerFinishingPositionRange:C,unscheduledCount:P,incompleteCount:M,minFinishingSum:U,matchUpsCount:R,isScheduled:N,roundTiming:x,isComplete:A,byeCount:_})}).flat().filter(T=>{if(t){let F=Ci(t),j=c?T.id:rz(T).id;if(F&&b[j]&&Ci(b[j].scheduleDate)===F)return!1}let{isComplete:U,isScheduled:C}=T,E=!i||!U,P=!e||!C,M=d||u?g?.find(({eventId:F})=>F===T.eventId):void 0,R=M?.startDate??s?.startDate,N=M?.endDate??s?.endDate,A=!u||!R||new Date(u)>=new Date(R),_=!u||!N||new Date(u)<=new Date(N),x=A&&_,O=!d||M?.validVenueIds.includes(d),$=E&&P&&O&&x;return $||S.push(T),$}).sort(x9e)||[];return{...ue,rounds:w,excludedRounds:S}}function l1(t){var e;let{matchUp:i,sideNumber:n,setNumber:r,isTiebreakValue:a,isPointValue:s}=t||{},{matchUpFormat:o}=t||{};if(!i)return{error:ol};o=o||i?.matchUpFormat;let l=Do(o),u=!!(i!=null&&i.winningSide),c=(e=i.score)==null?void 0:e.sets,d=c?.length,p=r&&r-1,h=!!(c!=null&&c.find((Z,K)=>Z.setNumber===r&&K===p)),f=c?.filter(Z=>Z?.winningSide)||[],m=f?.length||0,g=r&&c?.slice(r)||[],v=!!(d&&r&&g!=null&&g.reduce((Z,K)=>(!K||!K.side1Score&&!K.side2Score&&!K.side1TiebreakScore&&!K.side2TiebreakScore&&!K.side1PointScore&&!K.side2PointScore)&&Z,!0)),y=r<=d&&c.find(Z=>Z.setNumber===r),b=y&&s1({setObject:y,matchUpScoringFormat:l}),{isCompletedSet:I,sideGameScores:S,sideTiebreakScores:w}=b||{},T=!!(y&&!I&&v||r&&r===d+1&&!u),U=[1,2].includes(n),C=U?n-1:0,E=y&&U&&(!a&&!s&&S[C]!==void 0&&S[C]||a&&w[C]!==void 0&&w[C]),P=!!E,M=f?.map(Z=>s1({setObject:Z,matchUpScoringFormat:l}).isValidSetOutcome).reduce((Z,K)=>Z&&K,!0),R=f.reduce((Z,K)=>{let{winningSide:Q}=K,J=Q-1;return Z[J]++,Z},[0,0]),N=i?.winningSide,A=N&&N-1,_=1-A,x=R[A],O=R[_],$=Math.max(...R),F=Ol(R)[$],{bestOf:j,exactly:H}=l??{},G=j&&Math.ceil(j/2)||H||1,W=$===G&&F===1&&R.indexOf($)+1||void 0,q=x>O&&N===W;return{completedSetsHaveValidOutcomes:M,validMatchUpWinningSide:q,calculatedWinningSide:W,matchUpScoringFormat:l,validMatchUpOutcome:W&&M&&q,isLastSetWithValues:v,completedSetsCount:m,isCompletedMatchUp:u,isValidSideNumber:U,hasExistingValue:P,existingValue:E,isExistingSet:h,isActiveSet:T,...b}}function uY({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:s,tournamentRecord:o,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,tournamentId:v,inContext:y,context:b,event:I}){let{eventId:S,eventName:w,endDate:T,eventType:U,category:C,gender:E}=I??{},P={...b,...Gt({surfaceCategory:I?.surfaceCategory??o?.surfaceCategory,indoorOutDoor:I?.indoorOutdoor??o?.indoorOutdoor,endDate:T??I?.endDate??o?.endDate,tournamentId:v??o?.tournamentId,eventName:w,eventType:U,category:C,eventId:S,gender:E})},M;return!(t!=null&&t.length)&&o&&({participants:t,participantMap:p,groupInfo:M}=Gb({participantsProfile:n,useParticipantMap:s,tournamentRecord:o,contextProfile:f,inContext:y})),I&&f&&!c&&(c=Qm({policyDefinitions:a,tournamentRecord:o,contextProfile:f,drawDefinition:m,event:I})),{...GD({context:P,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:l,participantMap:p,contextContent:c,contextFilters:u,matchUpFilters:d,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,inContext:y,event:I}),groupInfo:M}}var TTe={};$i(TTe,{getCompetitionVenues:()=>fN,getCourts:()=>cY,getVenuesAndCourts:()=>tg,publicFindVenue:()=>D8});function cY({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(n=>e?n.venueId===e:i?i.includes(n.venueId):!0).map(n=>{let{venueId:r}=n,a=At(n.courts||[]);return a.forEach(s=>Object.assign(s,{venueId:r})),a}).flat()}:{error:lt}}var UTe={};$i(UTe,{categoryCanContain:()=>SM,getCategoryAgeDetails:()=>Sw,getEvent:()=>hY,getEventProperties:()=>dY,getEventStructures:()=>iB,getEventTimeItem:()=>_M,getEvents:()=>pY,getFlightProfile:()=>Rr,getScaledEntries:()=>Y0});function dY({tournamentRecord:t,event:e}){var i,n;if(!t)return{error:lt};if(!e)return{error:Wn};let r=e.entries||[],a=t.participants||[],s=((i=e.category)==null?void 0:i.categoryName)||((n=e.category)==null?void 0:n.ageCategoryCode),{eventType:o}=e,l=r.map(h=>h.participantId),u=a.filter(h=>l.includes(h.participantId)),c,d,p;return{entryScaleAttributes:u.map(h=>{var f,m,g,v,y,b;let{participantId:I,participantName:S,name:w}=h,T={scaleType:U8,eventType:o,scaleName:s},U=(m=(f=$h({participant:h,scaleAttributes:T}))==null?void 0:f.scaleItem)==null?void 0:m.scaleValue;T={scaleType:twe,eventType:o,scaleName:s};let C=(v=(g=$h({participant:h,scaleAttributes:T}))==null?void 0:g.scaleItem)==null?void 0:v.scaleValue;T={scaleType:ewe,eventType:o,scaleName:s};let E=(b=(y=$h({participant:h,scaleAttributes:T}))==null?void 0:y.scaleItem)==null?void 0:b.scaleValue;return c=!!(c||U),d=!!(d||C),p=!!(p||E),{participantId:I,participantName:S||w,seed:U,ranking:C,rating:E}}),hasSeededParticipants:c,hasRankedParticipants:d,hasRatedParticipants:p}}function pY({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:n,eventIds:r,drawIds:a,context:s}){var o,l,u,c;if(!t)return{error:lt};let{tournamentId:d}=t,p=(t.events??[]).filter(({eventId:f})=>!r||Array.isArray(r)&&r.includes(f)).map(f=>{var m;let g=(m=f.drawDefinitions)==null?void 0:m.map(JC);if(a!=null&&a.length&&!Pr(a,g).length)return;let v=At(f);return n&&Object.assign(v,{tournamentId:d}),s&&Object.assign(v,s),v}).filter(Boolean),h={};if(e){let f=hr({withScaleValues:!0,tournamentRecord:t}).participantMap,m=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(let g of p){let v=i??g.eventType,y=g.eventId;h[y]||(h[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let b=(g.entries??[]).filter(({entryStatus:E})=>yd.includes(E)).map(Gi),I=E=>{var P,M,R,N,A,_;if((P=E?.ratings)!=null&&P[v])for(let x of((M=E?.ratings)==null?void 0:M[v])??[]){let O=x.scaleName;h[y].ratings[O]||(h[y].ratings[O]=[]);let $=(R=Ra[O])==null?void 0:R.accessor;if($){let F=parseFloat((N=x.scaleValue)==null?void 0:N[$]);F&&h[y].ratings[O].push(F)}}if((A=E?.rankings)!=null&&A[v])for(let x of((_=E?.rankings)==null?void 0:_[v])??[]){let O=x.scaleName;h[y].ranking[O]||(h[y].ranking[O]=[]),x.scaleValue&&h[y].ranking[O].push(x.scaleValue)}};for(let E of b){let P=(o=f?.[E])==null?void 0:o.participant;if(P?.participantType!==Hi)for(let M of P?.individualParticipantIds??[]){let R=(l=f?.[M])==null?void 0:l.participant;I(R)}else I(P)}let S=h[y].ratings;for(let E of Object.keys(S)){let P=S[E];if(!P.length)continue;let M=(u=cQ(P))==null?void 0:u.toFixed(2);h[y].ratingsStats[E]={avg:parseFloat((m(P)/P.length).toFixed(2)),median:M?parseFloat(M):void 0,max:Math.max(...P),min:Math.min(...P)}}let w=(E,P)=>{var M,R;let N=A=>{var _,x,O,$,F,j,H,G,W,q;if((_=h[y].draws)!=null&&_[E]&&(x=A?.ratings)!=null&&x[v])for(let Z of((O=A?.ratings)==null?void 0:O[v])??[]){let K=Z.scaleName;($=h[y].draws[E])!=null&&$.ratings[K]||(h[y].draws[E].ratings[K]=[]);let Q=(F=Ra[K])==null?void 0:F.accessor;if(Q){let J=parseFloat((j=Z.scaleValue)==null?void 0:j[Q]);J&&h[y].draws[E].ratings[K].push(J)}}if((H=h[y].draws)!=null&&H[E]&&(G=A?.rankings)!=null&&G[v])for(let Z of((W=A?.rankings)==null?void 0:W[v])??[]){let K=Z.scaleName;(q=h[y].draws[E])!=null&&q.ranking[K]||(h[y].draws[E].ranking[K]=[]);let Q=Z.scaleValue;Q&&h[y].draws[E].ranking[K].push(Q)}};for(let A of P.filter(Boolean)){let _=(M=f?.[A])==null?void 0:M.participant;if(_?.participantType!==Hi)for(let x of _?.individualParticipantIds??[]){let O=(R=f?.[x])==null?void 0:R.participant;N(O)}else N(_)}},T=[],U=E=>a?.length&&a.includes(E)||T.includes(E);for(let E of g.drawDefinitions??[]){let P=E.drawId;if(U(P))continue;let M=Yb({drawDefinition:E}).assignedParticipantIds??[];h[y].draws[P]||(h[y].draws[P]={ratingsStats:{},ratings:{},ranking:{}}),T.push(P),w(P,M)}let C=Rr({event:g}).flightProfile;for(let E of C?.flights??[]){let P=E.drawId;if(U(P))continue;let M=E.drawEntries.map(Gi);w(P,M)}for(let E of T){let P=h[y].draws[E].ratings;for(let M of Object.keys(P)){let R=P[M];if(!R.length)continue;let N=(c=cQ(R))==null?void 0:c.toFixed(2);h[y].draws[E].ratingsStats[M]={avg:parseFloat((m(R)/R.length).toFixed(2)),median:N?parseFloat(N):void 0,max:Math.max(...R),min:Math.min(...R)}}}}}return Gt({eventScaleValues:h,events:p,...ue})}function hY({tournamentRecord:t,drawDefinition:e,context:i,event:n}){var r;if(!t)return{error:lt};if(!n)return{error:Wn};let a=At(n);i&&Object.assign(a,i);let s=e&&((r=a.drawDefinitions)==null?void 0:r.find(({drawId:o})=>e.drawId===o));return Gt({drawDefinition:s,event:a})}function O9e(t){var e,i;let n="validateAndDeriveDrawValues",{appliedPolicies:r,policyDefinitions:a}=$9e(t),s=B9e({...t,policyDefinitions:a,appliedPolicies:r}),o=F9e(t),l=V9e({...t,consideredEntries:o,appliedPolicies:r});if(l!=null&&l.error)return pe({result:l,stack:n});let u=j9e({...t,consideredEntries:o}),c=L9e({...t,appliedPolicies:r,policyDefinitions:a,drawSize:u});if(c.error)return pe({result:c,stack:n});let d=c.drawType;if(isNaN(u)&&d!==gu)return pe({result:{error:gM},stack:n});let p=a?.[Rc]??r?.[Rc],h=t.seedingProfile??((i=(e=p?.seedingProfile)==null?void 0:e.drawTypes)==null?void 0:i[d??""])??p?.seedingProfile;t.seedingProfile&&(a[Rc]||(a[Rc]={...nz[Rc]}),a[Rc].seedingProfile=h);let f=G9e({...t,drawType:d});return f!=null&&f.error?pe({result:f,stack:n}):{drawSize:u,drawType:d,enforceGender:s,seedingProfile:h,appliedPolicies:r,policyDefinitions:a}}function L9e(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:n=!0,drawSize:r}=t,a=t.drawTypeCoercion??dN({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),s=X0e({drawType:t.drawType,enforceMinimumDrawSize:n,drawTypeCoercion:a,drawSize:r});return s.error?s:{drawType:s.drawType}}function DTe(t){return t?.filter(e=>e.entryStatus&&[...yd,BM].includes(e.entryStatus))}function F9e({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:n}){return(n&&[]||DTe(e)||(t?i:[])).filter(({entryStage:r})=>!r||r===_t)}function $9e(t){let{tournamentRecord:e,event:i}=t,n=pn({tournamentRecord:e,event:i}).appliedPolicies??{},r=At(t.policyDefinitions??{},!1,!0);return{appliedPolicies:n,policyDefinitions:r}}function B9e({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var n,r,a,s;return t??((r=(n=e?.[Wa])==null?void 0:n.participants)==null?void 0:r.enforceGender)??((s=(a=i?.[Wa])==null?void 0:a.participants)==null?void 0:s.enforceGender)}function V9e(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:n,enforceGender:r,participantMap:a,participants:s,event:o}=t;return o&&s&&hB({consideredEntries:e,policyDefinitions:n,appliedPolicies:i,participantMap:a,enforceGender:r,participants:s,event:o})}function j9e(t){return!t.drawSize&&t.consideredEntries.length&&![gu,UM,xD,od,of].includes(t.drawType??"")&&ED(t.consideredEntries.length)||t.drawSize&&ai(t.drawSize)||!1}function G9e(t){var e,i;let{tournamentRecord:n,event:r,ignoreAllowedDrawTypes:a,drawType:s}=t,o=!a&&n&&SB({tournamentRecord:n,categoryType:(e=r?.category)==null?void 0:e.categoryType,categoryName:(i=r?.category)==null?void 0:i.categoryName});return o!=null&&o.length&&!o.includes(s)?{error:X6}:{...ue}}function bN(t){let{voluntaryConsolation:e,tournamentRecord:i,event:n}=t,r="generateDrawDefinition",{participants:a,participantMap:s}=hr({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),o=DTe(n?.entries)??[],l=O9e({...t,participantMap:s,participants:a,eventEntries:o});if(l.error)return pe({result:l,stack:r});let{appliedPolicies:u,policyDefinitions:c,drawSize:d,drawType:p,enforceGender:h,seedingProfile:f}=l,m=n?.eventType,g=t.matchUpType??m,v=j8e({...t,enforceGender:h,eventType:m,matchUpType:g});if(v.error)return pe({result:v,stack:r});let{matchUpFormat:y,tieFormat:b}=v;if(t.drawId&&typeof t.drawId!="string")return pe({result:{error:Ce},stack:r});let I=g9e({...t,policyDefinitions:c,tournamentRecord:i,appliedPolicies:u,matchUpFormat:y,seedingProfile:f,participants:a,eventEntries:o,matchUpType:g,tieFormat:b,drawSize:d,drawType:p,event:n});if(I.error)return pe({result:I,stack:r});let{existingDrawDefinition:S,positioningReports:w,drawDefinition:T,structureId:U,conflicts:C,entries:E}=I;if(!T)return pe({result:{error:Ce},stack:r});let P=v9e({...t,existingDrawDefinition:S,positioningReports:w,appliedPolicies:u,drawDefinition:T,seedingProfile:f,participants:a,structureId:U,entries:E,params:t,stack:r});if(P.error)return P;let{qualifyingConflicts:M}=P;return T.drawName=t.drawName??(p&&Ss(p)),d&&typeof e=="object"&&d>=4&&L8({...e,drawDefinition:T,matchUpType:g}),{existingDrawDefinition:!!S,qualifyingConflicts:M,positioningReports:w,drawDefinition:T,structureId:U,...ue,conflicts:C}}function ETe({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:n,scaleName:r}){if(!t)return{error:Xt,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,n).map(({participantId:o},l)=>({[o]:l+1})));r=r||t.scaleName;let s=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:o})=>({scaleItems:[{scaleValue:a[o],eventType:t.eventType,scaleType:Lh,scaleName:r,scaleDate:s}],participantId:o}))}}function H9e({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:n,scaleName:r,drawSize:a,drawId:s,event:o,stage:l,sortDescending:u,scaleSortMethod:c}){let d=_B({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:s,event:o,stage:l});if(d.error)return d;let{entries:p,seedsCount:h,stageEntries:f}=d;if(!f||!h)return{error:Ce};let m=Y0({tournamentRecord:t,scaleAttributes:n,scaleSortMethod:c,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=ETe({scaleAttributes:n,scaledEntries:m,stageEntries:f,seedsCount:h,scaleName:r});return{scaleItemsWithParticipantIds:g}}var PTe={};$i(PTe,{addDrawEntries:()=>A8,addEventEntries:()=>Mp,addEventEntryPairs:()=>ATe,destroyPairEntries:()=>Ewe,destroyPairEntry:()=>O8,getEntriesAndSeedsCount:()=>_B,getMaxEntryPosition:()=>J9,modifyEntriesStatus:()=>yx,modifyEventEntries:()=>_Te,mutate:()=>CTe,promoteAlternate:()=>MTe,promoteAlternates:()=>mY,query:()=>yTe,removeDrawEntries:()=>NTe,removeEventEntries:()=>XM,setEntryPosition:()=>fY,setEntryPositions:()=>RTe});var CTe={};$i(CTe,{addDrawEntries:()=>A8,addEventEntries:()=>Mp,addEventEntryPairs:()=>ATe,destroyPairEntries:()=>Ewe,destroyPairEntry:()=>O8,modifyEntriesStatus:()=>yx,modifyEventEntries:()=>_Te,promoteAlternate:()=>MTe,promoteAlternates:()=>mY,removeDrawEntries:()=>NTe,removeEventEntries:()=>XM,setEntryPosition:()=>fY,setEntryPositions:()=>RTe});function fY({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:n,skipRefresh:r,event:a}){let s="setEntryPositions";if(!t)return{error:lt};if(!i)return pe({result:{error:da},stack:s});if(n!==void 0&&!Number.isSafeInteger(n))return{error:Ce,entryPosition:n};(a?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)}),(e?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)});let o=l=>{l.entries.forEach(u=>{u.entryPosition===n&&u.participantId!==i&&(u.entryPosition+=.1)})};return r||(a!=null&&a.entries&&(o(a),a.entries=Ld({entries:a.entries})),e!=null&&e.entries&&(o(e),e.entries=Ld({entries:e.entries}))),{...ue}}function RTe({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:n}){if(!t)return{error:lt};if(!Array.isArray(e))return{error:Ce};for(let r of e){let{participantId:a,entryPosition:s}=r,o=fY({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:s,event:n});if(o.error)return o}return n!=null&&n.entries&&(n.entries=Ld({entries:n.entries})),i!=null&&i.entries&&(i.entries=Ld({entries:i.entries})),{...ue}}function MTe(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:Ce,participantId:e}:mY({...t,participantIds:[e].filter(Boolean)})}function mY({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:n,stage:r=_t,eventId:a,event:s}){if(!t)return{error:lt};if(!Array.isArray(i))return{error:Ce,participantIds:i};if(!s)return{error:Wn};let o="promoteAlternates";if(s){let l=QQ({element:s,participantIds:i,stageSequence:n,stage:r});if(l.error)return l}if(e){let l=QQ({element:e,participantIds:i,stageSequence:n,stage:r});if(l.error)return a?pe({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...ue},stack:o}):l}return{...ue}}function QQ({participantIds:t,stageSequence:e,element:i,stage:n}){let r=(i.entries||[]).filter(d=>d.entryStatus===Xc),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),s=r.reduce((d,p)=>{let{entryPosition:h}=p;return isNaN(h)&&d||(!d||h<d.entryPosition)&&p||d},void 0),o=a.length?a:[s].filter(Boolean);if(!(o!=null&&o.length))return{error:yye};let l=o.filter(({entryStatus:d})=>d!==Xc);if(l.length)return{error:wH,invalidEntryStatus:l};let u=o.filter(({entryStage:d})=>d&&d!==n);if(u.length)return{error:Zqe,invalidStage:u};let c=e&&o.filter(d=>d.stageSequence!==e);if(c!=null&&c.length)return{error:Xqe,invalidStageSequence:c};for(let d of o){d.entryStatus=cl;let p=d?.entryPosition;isNaN(p)||i.entries.forEach(f=>{f.entryStatus===Xc&&f.entryPosition>p&&(f.entryPosition=f.entryPosition-1)});let h=Math.max(...i.entries.filter(f=>f.entryStatus===cl&&!isNaN(f.entryPosition)).map(({entryPosition:f})=>ai(f||0)),0);d.entryPosition=h||0}return{...ue}}function NTe({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:n,stages:r,event:a}){var s;if(!a)return{error:Wn};if(!n)return{error:Xd};if(!(e!=null&&e.length))return{error:Mv};let o=Yb({drawDefinition:i,stages:r}).assignedParticipantIds??[];if(yo(o,e))return{error:ND};let l=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:u}=Rr({event:a}),c=(s=u?.flights)==null?void 0:s.find(d=>d.drawId===n);return c!=null&&c.drawEntries&&(c.drawEntries=c.drawEntries.filter(l),t&&(c.drawEntries=Ld({entries:c.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(l),t&&(i.entries=Ld({entries:i.entries}))),{...ue}}function Zp(t){var e,i,n,r,a;let s="addParticipant",{allowDuplicateParticipantIdPairs:o,returnParticipant:l,disableNotice:u,pairOverride:c,participant:d}=t,p=t.tournamentId?(e=t.tournamentRecords)==null?void 0:e[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((i=t.tournamentRecords)==null?void 0:i[t.activeTournamentId]));if(!p)return{error:lt};if(!d)return pe({result:{error:P0},stack:s});d.participantId||(d.participantId=gn()),p.participants||(p.participants=[]);let{participantId:h,individualParticipantIds:f}=d;if(p.participants.reduce((I,S)=>S.participantId===h||I,!1))return{error:hye};let{participantType:m,participantRole:g}=d;if(!m||!Object.keys(PP).includes(m))return{error:zd,participantType:m};if(!g)return{error:pye};let v=p.participants||[],y=v.filter(I=>I.participantType===Hi).map(I=>I.participantId);if(m!==Hi&&d.person)return{error:Ce,person:d.person};if(f&&!Array.isArray(f))return{error:Ce,individualParticipantIds:f};if(m===Ai){if(d.person)return{error:Ce,person:d.person};if(d.individualParticipantIds){if(d.individualParticipantIds.length!==2&&!c)return pe({info:"PAIR must be 2 individualParticipantIds",result:{error:El},stack:s});{let w=v.filter(T=>T.participantType===Hi).map(T=>T.participantId);if(!Array.isArray(d.individualParticipantIds))return pe({result:{error:El},stack:s});if(!d.individualParticipantIds.reduce((T,U)=>w.includes(U)&&T,!0))return pe({result:{error:El},stack:s})}}else return pe({result:{error:Mv},stack:s});let I=v.filter(w=>w.participantType===Ai).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),S=d.participantType===Ai&&I.find(w=>Pr(w.individualParticipantIds,d.individualParticipantIds).length===2);if(S&&!o)return{...ue,existingParticipant:!0,participant:l&&At(S.participant)};if(!d.participantName){let w=v.filter(U=>{var C;return(C=d.individualParticipantIds)==null?void 0:C.includes(U.participantId)}),T=w.map(U=>{var C;return(C=U.person)==null?void 0:C.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(T+="/Unknown"),d.participantName=T}}else if(m===Hi){if(!((n=d.person)!=null&&n.standardFamilyName)||!((r=d.person)!=null&&r.standardGivenName))return{error:vye};if(!d.participantName){let I=`${d.person.standardFamilyName.toUpperCase()}, ${d.person.standardGivenName}`;d.participantName=I}}else if(m&&[Sn,Uu].includes(m)){if(f||(d.individualParticipantIds=[]),(a=d.individualParticipantIds)==null?void 0:a.length)for(let I of d.individualParticipantIds){if(typeof I!="string")return pe({result:{participantId:I,error:Ce},stack:s});if(!y.includes(I))return pe({result:{participantId:I,error:Ar},stack:s})}}else return{error:zd};p.participants.push(d),u||Ui({payload:{tournamentId:p.tournamentId,participants:[d]},topic:av});let b={participant:l&&At(d),...ue};return Gt(b)}function dd({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:n=[]}){if(!i)return{error:lt};i.participants||(i.participants=[]);let r=i.participants.map(d=>d.participantId)||[];n.forEach(d=>{d.participantId||(d.participantId=gn())});let a=n.filter(d=>!r.includes(d.participantId)),s=n.filter(d=>r.includes(d.participantId)),o=a.filter(d=>d.participantType===Hi),l=a.filter(d=>d.participantType!==Hi),u=o.concat(...l),c=[];if(u.length){for(let p of u){let h=Zp({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(h.error)return h;h.success&&!h.existingParticipant&&c.push(h.participant)}c.length&&Ui({topic:av,payload:{tournamentId:i.tournamentId,participants:c}});let d={participants:e&&At(c),addedCount:c.length,...ue};return s.length&&Object.assign(d,{notAdded:s,info:u$}),Gt(d)}else return{info:"No new participants to add",addedCount:0,...ue}}function ATe(t){let e=Yt(t,[{[Ta]:!0,[Av]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:n=Xc,participantIdPairs:r=[],entryStage:a=_t,tournamentRecord:s,drawDefinition:o,event:l,uuids:u}=t;if(l.eventType!==En)return{error:rf};let c=[],d=new Map;for(let I of s.participants??[]){let{participantType:S,participantId:w,person:T,individualParticipantIds:U}=I;S===Hi&&T!=null&&T.sex?d.set(w,T.sex):S===Ai&&U&&c.push(U)}let p=r.filter(I=>{if(I.length!==2)return!0;if(!l.gender||l.gender===qd)return!1;if(!d.has(I[0])||!d.has(I[1]))return!0;let S=I.map(T=>d.get(T)),w=l.gender===Un&&(S[0]!==Un||S[1]!==Un)||l.gender===Gn&&(S[0]!==Gn||S[1]!==Gn);return l.gender===ko&&(S.sort(J$),(S[0]!==Gn||S[1]!==Un)&&(w=!0)),w});if(p.length)return{error:El,invalidParticipantIdPairs:p};let h=r.map(I=>({participantId:u?.pop()??gn(),participantRole:ws,individualParticipantIds:I,participantType:Ai})),f=i?h:h.filter(I=>!c.find(S=>Pr(S,I.individualParticipantIds).length===2)),m,g=[];if(f){let I=dd({allowDuplicateParticipantIdPairs:i,participants:f,returnParticipants:!0,tournamentRecord:s});if(I.error)return I;g=I.participants||[],m=I.info}let v=r.map(I=>{let S=g.find(T=>Pr(T.individualParticipantIds,I).length===2);if(S)return S;let{participant:w}=cd({tournamentRecord:s,participantIds:I});return w}).map(I=>I.participantId),y=Mp({participantIds:v,tournamentRecord:s,drawDefinition:o,entryStatus:n,entryStage:a,event:l});f.length&&Ui({payload:{participants:f},topic:av});let b=f.map(Gi);return{...y,info:m,newParticipantIds:b}}function _Te({entryStatus:t=cl,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:n=_t,tournamentRecord:r,event:a}){if(!r)return{error:lt};if(!a)return{error:Wn};let s=r.participants??[],o=s.filter(m=>m.participantType===Hi).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!o.includes(m));if(l.length)return{error:El,invalidParticipantIds:l};let u=i.filter(m=>m.length!==2);if(u.length)return{error:El,invalidParticipantIdPairs:u};let c=s.filter(m=>m.participantType===Ai).map(m=>m.individualParticipantIds),d=i.filter(m=>!c.find(g=>Pr(g,m).length===2)).map(m=>({participantType:Ai,participantRole:ws,individualParticipantIds:m})),p=dd({participants:d,tournamentRecord:r});if(p.error)return p;let h=i.map(m=>{let{participant:g}=cd({tournamentRecord:r,participantIds:m});return g}).map(m=>({participantId:m,entryStatus:t,entryStage:n})),f=e.map(m=>({entryStatus:dc,participantId:m,entryStage:n}));return a.entries=(a.entries??[]).filter(m=>m.entryStage===n),a.entries=a.entries.concat(...h,...f),{...ue}}var kTe={};$i(kTe,{addDrawDefinition:()=>IN,addEvent:()=>JD,addFlight:()=>VB,assignSeedPositions:()=>WTe,attachFlightProfile:()=>SY,categoryCanContain:()=>SM,deleteDrawDefinitions:()=>FB,deleteEvents:()=>KTe,deleteFlightAndFlightDraw:()=>zTe,deleteFlightProfileAndFlightDraws:()=>BTe,generate:()=>xTe,generateEventsFromTieFormat:()=>LTe,getCategoryAgeDetails:()=>Sw,getEvent:()=>hY,getEventProperties:()=>dY,getEventStructures:()=>iB,getEventTimeItem:()=>_M,getEvents:()=>pY,getFlightProfile:()=>Rr,getScaledEntries:()=>Y0,modifyEvent:()=>ZTe,modifyEventMatchUpFormatTiming:()=>VTe,modifyPairAssignment:()=>qTe,mutate:()=>FTe,query:()=>UTe,refreshEventDrawOrder:()=>wY,removeEventMatchUpFormatTiming:()=>$B,removeScaleValues:()=>TY,removeSeeding:()=>YTe,setEventDates:()=>bY,setEventDisplay:()=>BB,setEventEndDate:()=>yY,setEventStartDate:()=>vY,updateDrawIdsOrder:()=>IY,validateCategory:()=>HC});var xTe={};$i(xTe,{generateEventsFromTieFormat:()=>LTe});function z9e({tournamentId:t,event:e}){return e?(Ui({payload:{tournamentId:t,event:e},key:e.eventId,topic:DIe}),{...ue}):{error:Wn}}var q9e={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},W9e={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},Y9e={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},OTe={COLLEGE_D3:q9e,COLLEGE_DEFAULT:W9e,COLLEGE_JUCO:Y9e,DOMINANT_DUO:ybe,DOMINANT_DUO_MIXED:hbe,LAVER_CUP:Tbe,TEAM_DOUBLES_3_AGGREGATION:lbe,TIME_TENNIS_DUAL:fbe,TIME_TENNIS_PRO_CIRCUIT:pbe,USTA_BREWER_CUP:mbe,USTA_OZAKI_CUP:gbe,USTA_COLLEGE:bbe,USTA_GOLD_TEAM_CHALLENGE:obe,USTA_INTERSECTIONAL:dbe,USTA_LEVEL_1:Ibe,USTA_SECTION_BATTLE:cbe,USTA_SOUTHERN_LEVEL_5:ube,USTA_TOC:Ube,USTA_WTT_ITT:wbe,USTA_ZONAL:Sbe};function JD({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:n}){var r,a,s,o;if(!e)return{error:lt};if(e.events||(e.events=[]),!n)return{error:Wn};let{startDate:l,endDate:u}=e;if(!i&&((r=n.entries)!=null&&r.length||(a=n.drawDefinitions)!=null&&a.length)){let d=Gt({drawDefinitions:!!((s=n.drawDefinitions)!=null&&s.length),entries:!!((o=n.entries)!=null&&o.length)});return{info:"entries/drawDefinitions cannot exist",error:Ce,context:d}}let c={eventType:Tw,drawDefinitions:[],entries:[],startDate:l,endDate:u,...n};if(n.eventType===Fl){if(n.tieFormat){let d=Bo({tieFormat:n.tieFormat});if(d.error)return d}else if(n.tieFormatName){if(!OTe[n.tieFormatName])return{context:{tieFormatName:n.tieFormatName},error:Ce};let d=Um({isMock:e?.isMock,namedFormat:n.tieFormatName,event:n});c.tieFormat=d}}if(c.eventId||(c.eventId=gn()),e.events.reduce((d,p)=>d||p.eventId===c.eventId,void 0))return{error:Yve};{let d=c;if(e.events.push(d),!t){let{topics:p}=lc();if(p.includes(L$)){let m=If({event:n}).matchUps??[];sv({tournamentId:e?.tournamentId,eventId:n.eventId,matchUps:m})}let{drawDefinitions:h,...f}=n;for(let m of h||[])NM({drawDefinition:m});z9e({tournamentId:e?.tournamentId,event:f})}return{...ue,event:c}}}function LTe(t){var e,i,n,r;let a=Yt(t,[{[dU]:{[P$]:!0,[Xbe]:!0}},{[Ta]:!0}]);if(a.error)return a;let s=t.tieFormat||Um({namedFormat:t.tieFormatName}),o=t.uuids||[sbe(s.collectionDefinitions.length)],l={[Un]:[],[Gn]:[]};if(t.addEntriesFromTeams){let c=(i=(e=t.tournamentRecord.participants)==null?void 0:e.filter(d=>d.participantType===xo))==null?void 0:i.flatMap(d=>d.individualParticipantIds??[]);for(let d of t.tournamentRecord.participants??[])if(c!=null&&c.includes(d.participantId)){let p=(n=d.person)==null?void 0:n.sex;p&&[Un,Gn].includes(p)&&l[p].push(d.participantId)}}let u=[];for(let c of s.collectionDefinitions??[]){let d=((r=o?.pop())==null?void 0:r.toString())||gn(),p=c.matchUpType,h=c.gender,f={matchUpFormat:c.matchUpFormat,eventName:c.collectionName,category:c.category,gender:h,eventType:p,eventId:d};if(t.addEntriesFromTeams){let m=p===Dm?dc:t.entryStatus||cl,g=h===ko?[...l[Un],...l[Gn]]:l[h]??[];if(g.length){let v=Mp({participantIds:g,entryStatus:m,event:f});if(v.error)return v}}if(u.push(f),t.addEvents!==!1){let m=JD({internalUse:!0,tournamentRecord:t.tournamentRecord,event:f});if(m.error)return m}}return{...ue,events:u}}var FTe={};$i(FTe,{addDrawDefinition:()=>IN,addEvent:()=>JD,addFlight:()=>VB,assignSeedPositions:()=>WTe,attachFlightProfile:()=>SY,deleteDrawDefinitions:()=>FB,deleteEvents:()=>KTe,deleteFlightAndFlightDraw:()=>zTe,deleteFlightProfileAndFlightDraws:()=>BTe,modifyEvent:()=>ZTe,modifyEventMatchUpFormatTiming:()=>VTe,modifyPairAssignment:()=>qTe,refreshEventDrawOrder:()=>wY,removeEventMatchUpFormatTiming:()=>$B,removeScaleValues:()=>TY,removeSeeding:()=>YTe,setEventDates:()=>bY,setEventDisplay:()=>BB,setEventEndDate:()=>yY,setEventStartDate:()=>vY,updateDrawIdsOrder:()=>IY,validateCategory:()=>HC});function QD({removePriorValues:t=!0,status:e=Du,statusObject:i,event:n}){if(!Qi(i))return{error:Ce};let r=hc({event:n,status:e}),a=`${Lv}.${Fv}`,s={itemValue:{[e]:{...r,...i}},itemType:a};return W0({timeItem:s,removePriorValues:t,event:n})}function eE(t){var e,i,n,r,a,s,o;let l=Yt(t,[{[Ta]:!0,[Av]:!0},{eventDataParams:!1,[Ho]:el}]);if(l.error)return l;let{includePositionAssignments:u,removePriorValues:c,tournamentRecord:d,status:p=Du,event:h,drawIdsToRemove:f,drawIdsToAdd:m}=t,{appliedPolicies:g}=pn({tournamentRecord:d,event:h}),v={...g,...t.policyDefinitions},y=((e=h?.drawDefinitions)==null?void 0:e.map(({drawId:M})=>M))??[],b=t.drawDetails?Object.keys(t.drawDetails):[],I=b.length?[]:t.drawIds,S=(m??[]).concat(...f??[],...I??[],...b),w=S.filter(M=>!y.includes(M));if(w.length)return pe({result:{error:fu},context:{invalidDrawIds:w}});let T=hc({event:h,status:p}),U=Object.keys(T?.drawDetails||{}).filter(M=>y.includes(M)).reduce((M,R)=>(M[R]=T.drawDetails[R],M),{});for(let M of y)if((!S.length||S.includes(M))&&(f!=null&&f.includes(M)||I!=null&&I.length&&!I.includes(M)?U[M]={...U[M],publishingDetail:{published:!1}}:(m!=null&&m.includes(M)||I!=null&&I.includes(M)||!(I!=null&&I.length))&&(U[M]={...U[M],publishingDetail:{published:!0}})),(i=t.drawDetails)==null?void 0:i[M]){let R=t.drawDetails[M],N=R.structureDetails??U[M].structureDetails,A=R.stageDetails??U[M].stageDetails??{},{structureIdsToRemove:_=[],structureIdsToAdd:x=[],publishingDetail:O={},stagesToRemove:$=[],stagesToAdd:F=[]}=R;if((x||F)&&(O.published=!0),U[M]={publishingDetail:O,structureDetails:N,stageDetails:A},x.length||_.length){let H=(((r=(n=h?.drawDefinitions)==null?void 0:n.find(W=>W.drawId===M))==null?void 0:r.structures)??[]).map(({structureId:W})=>W),G=(x??[]).concat(_??[]).filter(W=>!H.includes(W));if(G.length)return pe({result:{error:pr},context:{invalidStructureIds:G}});N=N??{};for(let W of H)_.includes(W)?N[W]={published:!1}:N[W]={published:!0};U[M].structureDetails=N}let j=(((s=(a=h?.drawDefinitions)==null?void 0:a.find(H=>H.drawId===M))==null?void 0:s.structures)??[]).map(({stage:H})=>H);if(F.length){for(let H of F)A[H]={published:!0};for(let H of j)A[H]||(A[H]={published:!1})}if(F.length||$.length){for(let H of $)A[H]={published:!1};for(let H of j)A[H]||(A[H]={published:!0})}(F.length||$.length)&&(U[M].stageDetails=A)}QD({statusObject:{drawDetails:U},removePriorValues:c,status:p,event:h});let{topics:C}=lc(),E=C.includes(AH),P=E||t.returnEventData?(o=PB({includePositionAssignments:u,...t.eventDataParams,usePublishState:!0,tournamentRecord:d,policyDefinitions:v,event:h}))==null?void 0:o.eventData:void 0;return E&&Ui({payload:{eventData:P,tournamentId:d.tournamentId},topic:AH}),{...ue,eventData:P}}var $Te="deleteDrawDefinitions",az="autoSchedulingAudit",O_="deleteEvents",K9e={AUTO_SCHEDULING_AUDIT:az,DELETE_EVENTS:O_,DELETE_DRAW_DEFINITIONS:$Te};function FB(t){var e,i,n,r,a;if(!t.tournamentRecord)return{error:lt};let s="deleteDrawDefinitions",o=t.drawIds??[],l=t.event,{autoPublish:u=!0,tournamentRecord:c,auditData:d,eventId:p,force:h}=t,{appliedPolicies:f}=pn({tournamentRecord:c,event:l}),m={...f,...t.policyDefinitions},g=Array.isArray(o)?o[0]:void 0;if(!l){let R=jo({tournamentRecord:c,eventId:p,drawId:g});if(R.error)return R;l=R.event}let v=[],y=[],b=[];if(!(l!=null&&l.drawDefinitions))return pe({info:"event has no drawDefinition",result:{...ue},stack:s});let I=l.drawDefinitions.map(({drawId:R})=>R);if(o.length||(o=I),o=o.filter(R=>I.includes(R)),!o.length)return pe({info:"nothing to do; no matching drawIds in event.",result:{...ue},stack:s});let S=At(Rr({event:l}).flightProfile,!1,!0),w=({participantId:R,drawPosition:N,qualifier:A,bye:_})=>({bye:_,qualifier:A,drawPosition:N,participantId:R}),T=h??((i=(e=f?.[Qu])==null?void 0:e.allowDeletionWithScoresPresent)==null?void 0:i.drawDefinitions),U=hc({event:l})??{},C=U.drawIds??(U.drawDetails&&Object.keys(U.drawDetails))??[],E,P=[],M=l.drawDefinitions.filter(R=>{var N,A,_,x,O,$,F,j;if(o.includes(R.drawId)){let H=((N=ho({event:l,drawDefinition:R}))==null?void 0:N.matchUps)??[];if(H.some(({score:oe})=>Sa({score:oe}))&&!T)return P.push(R.drawId),!0;let{drawId:G,drawType:W,drawName:q}=R,Z=(A=S?.flights)==null?void 0:A.find(oe=>oe.drawId===R.drawId);Z&&(Z.drawEntries=(_=Z.drawEntries)==null?void 0:_.filter(oe=>yd.includes(oe.entryStatus))),C.includes(G)&&(C=C.filter(oe=>oe!==G),E=!0);let K=(O=(x=ud({stageSequence:1,drawDefinition:R,stage:_t}))==null?void 0:x.structures)==null?void 0:O[0],Q=(F=($=K?r1({structureId:K.structureId,tournamentRecord:c,drawDefinition:R}):void 0)==null?void 0:$.positionAssignments)==null?void 0:F.map(w),J=(j=ud({stage:Kt,drawDefinition:R}))==null?void 0:j.structures,ne=J!=null&&J.length?J.map(oe=>{var de;let se=oe.stageSequence;return{positionAssignments:(de=r1({structureId:oe.structureId,tournamentRecord:c,drawDefinition:R}))==null?void 0:de.positionAssignments.map(w),stageSequence:se}}):void 0,re={action:$Te,payload:{drawDefinitions:[R],eventId:p??l?.eventId,auditData:d}};b.push(re),v.push(Gt({tournamentId:c.tournamentId,eventId:p??l?.eventId,qualifyingPositionAssignments:ne,positionAssignments:Q,auditData:d,drawType:W,drawName:q,drawId:G})),H?.forEach(({matchUpId:oe})=>y.push(oe))}return!o.includes(R.drawId)});if(P.length&&!h)return pe({context:{drawIdsWithScoresPresent:P},result:{error:m$},stack:s});if(l.drawDefinitions=M,S&&kv({event:l,extension:{name:ld,value:S}}),gN({tournamentRecord:c}),E){let R={};for(let A of C)R[A]=((n=U.drawDetails)==null?void 0:n[A])??{published:!0};let N=QD({statusObject:{drawDetails:R},event:l});if(N.error)return{error:N.error}}if(b.length)if(g$(rm)){let R=c.tournamentId;Ui({topic:rm,payload:{tournamentId:R,detail:b}});let N=(((a=(r=cc({element:l,itemType:My}))==null?void 0:r.timeItem)==null?void 0:a.itemValue)||0)+1;lh({element:l,timeItem:{itemType:My,itemValue:N},removePriorValues:!0})}else Z9e({appliedPolicies:f,event:l,deletedDrawsDetail:v,auditData:d});if(y.length&&Xm({tournamentId:c?.tournamentId,matchUpIds:y}),o.forEach(R=>ZWe({drawId:R})),u&&E){let R=eE({...t.eventDataParams,drawIdsToRemove:o,policyDefinitions:m,tournamentRecord:c,event:l});if(R.error)return{...ue,info:R.error}}return{...ue}}function Z9e({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:n}){var r;if(((r=t?.audit)==null?void 0:r[My])===!1)return;let{extension:a}=ki({name:My,element:e}),s={...n,deletedDrawsDetail:i},o={value:Array.isArray(a?.value)?a?.value.concat(s):[s],name:My};dn({element:e,extension:o})}function BTe({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:n,force:r}){var a;if(!e)return{error:lt};if(!n)return{error:Wn};let{flightProfile:s}=Rr({event:n});if(s){let o=(a=s.flights)==null?void 0:a.map(({drawId:u})=>u).filter(Boolean),l=FB({eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:o,event:n,force:r});return l.error?l:_$({event:n,name:ld})}return{...ue}}function gY(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:n,tournamentId:r,eventId:a}=t,s=t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(s).length)return{error:gr};let o=Object.keys(s).filter(u=>!r||r===u);if(r&&!o.includes(r))return{error:Ce};let l;for(let u of o){let c=s[u],{event:d}=jo({tournamentRecord:c,eventId:a});a&&d&&(l=!0);let p=X9e({tournamentRecord:c,event:d,matchUpFormat:e,averageTimes:n,recoveryTimes:i});if(p.error)return p}return!a||l?{...ue}:{error:Xu}}function X9e({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:n,event:r}){if(!t)return{error:lt};if(n&&!Array.isArray(n))return{error:Ce};if(e&&!Array.isArray(e))return{error:Ce};let a=Mm;if(r){let{extension:s}=ki({element:r,name:a}),o=s?.value||{},l=eee({...o,matchUpFormat:i,averageTimes:n,recoveryTimes:e});dn({element:r,extension:{name:a,value:l}})}else{let{extension:s}=ki({element:t,name:a}),o=s?.value||{},l=eee({...o,matchUpFormat:i,averageTimes:n,recoveryTimes:e});dn({extension:{name:a,value:l},element:t})}return{...ue}}function eee(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:n}=t,{averageTimes:r,recoveryTimes:a}=t;r=(r||[]).filter(l=>{var u,c;return((u=l?.categoryNames)==null?void 0:u.length)||((c=l?.categoryTypes)==null?void 0:c.length)});let s=r?.length&&i.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==n)}:l}).filter(({matchUpFormatCodes:l})=>l?.length).concat({matchUpFormatCodes:[n],averageTimes:r});a=(a||[]).filter(l=>{var u,c;return((u=l?.categoryNames)==null?void 0:u.length)||((c=l?.categoryTypes)==null?void 0:c.length)});let o=a?.length&&e.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==n)}:l}).filter(({matchUpFormatCodes:l,averageTimes:u})=>l?.length||u).concat({matchUpFormatCodes:[n],recoveryTimes:a});return{matchUpAverageTimes:s?.length&&s||i,matchUpRecoveryTimes:o?.length&&o||e}}function VTe(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:n,matchUpFormat:r,categoryType:a,eventId:s,event:o}=t;if(!e)return{error:lt};if(!Ll({matchUpFormat:r}))return{error:Ce};if(!o)return{error:Wn};let{averageTimes:l=[],recoveryTimes:u=[]}=kB({tournamentRecord:e,matchUpFormat:r,event:o}),c=o.category,d=c?.categoryName||c?.ageCategoryCode||o?.eventId,p={categoryNames:[d],minutes:{}},h={categoryNames:[d],minutes:{}},f=b=>{var I,S;if((I=b.categoryTypes)!=null&&I.includes(a)&&console.log("encountered:",{categoryType:a}),!((S=b.categoryNames)!=null&&S.includes(d)&&(b.categoryNames=b.categoryNames.filter(w=>w!==d),p={minutes:b.minutes,categoryNames:[d]},!b.categoryNames.length)))return b},m=n&&!isNaN(ai(n)),g=i&&!isNaN(ai(i)),v=l.map(f).filter(b=>{var I;return(I=b?.categoryNames)==null?void 0:I.length}),y=u.map(f).filter(b=>{var I;return(I=b?.categoryNames)==null?void 0:I.length});return m&&(Object.assign(p.minutes,{[o?.eventType||Mn]:n}),v.push(p)),g&&(Object.assign(h.minutes,{[o?.eventType||Mn]:i}),y.push(h)),!m&&!g?{error:Ce}:gY({averageTimes:m&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:r,eventId:s})}function $B(t){if(t.event)return tee({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=Yt(t,[{[Hs]:!0,[iIe]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:n}=t;for(let r of Object.values(i??{})){let{event:a}=jo({tournamentRecord:r,eventId:n});if(a)return tee({event:a})}}return{error:Xu}}function tee({event:t}){return _$({event:t,name:Mm})}var J9e="MON",Q9e="TUE",eYe="WED",tYe="THU",iYe="FRI",nYe="SAT",rYe="SUN",jTe={MON:J9e,TUE:Q9e,WED:eYe,THU:tYe,FRI:iYe,SAT:nYe,SUN:rYe};function GTe(t){return!Array.isArray(t)||Si(t).length!==t.length?!1:t.every(e=>Object.keys(jTe).includes(e))}function vY({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:lt};if(!e)return{error:Wn};if(!Hp.test(i))return{error:za};let n=HTe(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,s=new Date(Ci(i)).getTime();if(!r||!a||s<r||s>a)return{error:za};let o=e.endDate&&new Date(Ci(e.endDate)).getTime();return o&&s>o&&(e.endDate=i),e.startDate=i,{...ue}}function yY(t){let{tournamentRecord:e,event:i,endDate:n}=t;if(!e)return{error:lt};if(!i)return{error:Wn};if(!Hp.test(n))return{error:za};let r=HTe(e);if(r.error)return r;let{tournamentStartDate:a,tournamentEndDate:s}=r,o=new Date(Ci(n)).getTime();if(!a||!s||o<a||o>s)return{error:za};let l=i.startDate&&new Date(Ci(i.startDate)).getTime();return l&&o<l&&(i.startDate=n),i.endDate=n,{...ue}}function bY(t){var e;let i=Yt(t,[{tournamentRecord:!0,event:!0},{[vs]:u=>Hp.test(u),[vu]:za,startDate:!1,endDate:!1},{[vs]:u=>u.filter(Boolean).every(c=>Hp.test(c)),[vu]:za,activeDates:!1},{[vs]:GTe,weekdays:!1}]);if(i.error)return i;let{tournamentRecord:n,weekdays:r,event:a,startDate:s,endDate:o}=t,l=(e=t.activeDates)==null?void 0:e.filter(Boolean);if(s&&o){let u=new Date(Ci(s)).getTime(),c=new Date(Ci(o)).getTime();if(u>c)return{error:Ce}}if(l){let u=s||n.startDate,c=o||n.endDate,d=!u||l.every(h=>new Date(h)>=new Date(u)),p=!c||l.every(h=>new Date(h)<=new Date(c));if(!d||!p)return{error:za}}if(s){let u=vY({tournamentRecord:n,event:a,startDate:s});if(u.error)return u}if(o){let u=yY({tournamentRecord:n,event:a,endDate:o});if(u.error)return u}return l&&(a.activeDates=l),r&&(a.weekdays=r),{...ue}}function HTe(t){let{startDate:e,endDate:i}=t;return!Hp.test(e)||!Hp.test(i)?pe({result:{error:lye},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Ci(e)).getTime(),tournamentEndDate:new Date(Ci(i)).getTime()}}function IY({event:t,orderedDrawIdsMap:e}){var i,n;if(typeof t!="object")return{error:Wn};if(!e)return{error:Xt,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:Ce,info:"orderedDrawIdsMap must be an object"};let r=Object.values(e);if(!r.every(s=>!isNaN(s)))return{error:Ce,info:"drawOrder must be numeric"};if(Si(r).length!==r.length)return{error:Ce,info:"drawOrder values must be unique"};if((i=t.drawDefinitions)!=null&&i.length){let s=(t.drawDefinitions||[]).map(({drawId:l})=>l),o=Object.keys(e);if(o!=null&&o.length&&Pr(s,o).length!==s.length)return{error:Ce,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:a}=Rr({event:t});return(n=a?.flights)==null||n.forEach(s=>{s.flightNumber=e[s.drawId]}),{...ue}}function wY({tournamentRecord:t,event:e}){var i;if(!t)return{error:lt};if(!e)return{error:Wn};let{flightProfile:n}=Rr({event:e}),r=n?.flights&&Object.assign({},...n.flights.sort((a,s)=>a.flightNumber-s.flightNumber).map((a,s)=>({[a.drawId]:s+1})))||((i=e.drawDefinitions)==null?void 0:i.length)&&Object.assign({},...e.drawDefinitions.sort((a,s)=>a.drawOrder-s.drawOrder).map((a,s)=>({[a.drawId]:s+1})))||void 0;return r?IY({event:e,orderedDrawIdsMap:r}):{...ue}}function zTe({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:n,event:r,force:a}){var s,o;if(!e)return{error:lt};if(!n)return{error:Xd};if(!r)return{error:Wn};let{flightProfile:l}=Rr({event:r});if(l&&(s=l.flights)!=null&&s.find(u=>u.drawId===n)){let u=l.flights.filter(d=>d.drawId!==n),c={name:ld,value:{...l,flights:u}};kv({event:r,extension:c})}if((o=r.drawDefinitions)!=null&&o.find(u=>u.drawId===n)){let u=FB({drawIds:[n],eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:r,force:a});if(u.error)return u}return wY({tournamentRecord:e,event:r})}function qTe(t){var e,i;let n=Yt(t,[{[Av]:!0,[Ta]:!0,[j7]:!1},{replacementIndividualParticipantId:!0,[vs]:y=>nr(y),existingIndividualParticipantId:!0,[Zc]:da,participantId:!0}]),{replacementIndividualParticipantId:r,existingIndividualParticipantId:a,tournamentRecord:s,drawDefinition:o,participantId:l,event:u,uuids:c}=t;if(n.error)return n;if(u?.eventType!==Ju)return{error:rf};if(!(((e=u?.entries)==null?void 0:e.filter(({entryStatus:y})=>[dc,zb].includes(y)).map(({participantId:y})=>y))||[]).includes(r))return{error:Hd};let d=(s.participants||[]).find(y=>y.participantId===l);if(d?.participantType!==Ai)return{error:E0,participant:d};let p=d.individualParticipantIds,h=[r,...p.filter(y=>y!==a)],{participant:f}=cd({participantIds:h,tournamentRecord:s}),m;if(f)m=f.participantId;else{let y={participantId:c?.pop(),participantRole:ws,individualParticipantIds:h,participantType:Ai},b=Zp({participant:y,returnParticipant:!0,tournamentRecord:s});if(b.error)return b;m=b.participant.participantId}let{flightProfile:g}=Rr({event:u});if(o){let y=(i=g?.flights)==null?void 0:i.find(({drawId:b})=>b===o.drawId);y&&(y.drawEntries=y.drawEntries.map(b=>b.participantId===l?{...b,participantId:m}:b)),o.entries=o.entries.map(b=>b.participantId===l?{...b,participantId:m}:b);for(let b of o.structures||[])if(b.structures){b.positionAssignments=void 0;for(let I of b.structures)I.positionAssignments=I.positionAssignments.map(S=>S.participantId===l?{...S,participantId:m}:S)}else b.positionAssignments&&(b.positionAssignments=b.positionAssignments.map(I=>I.participantId===l?{...I,participantId:m}:I))}u.entries=u.entries.map(y=>y.participantId===l&&{...y,participantId:m}||y.participantId===r&&{...y,participantId:a}||y);let v=s.events.some(({entries:y,eventId:b,drawDefinitions:I})=>u.eventId===b?I.some(({drawId:S,entries:w})=>S===o?.drawId?!1:w?.find(T=>T.participantId===l)):y?.find(S=>S.participantId===l));if(!v){let y=H0({addIndividualParticipantsToEvents:!1,participantIds:[l],tournamentRecord:s});if(y.error)return y}return{...ue,participantOtherEntries:v,newPairParticipantId:m}}function IN(t){var e,i,n,r,a,s,o,l,u,c,d,p;let{flight:h,suppressNotifications:f,modifyEventEntries:m,existingDrawCount:g,allowReplacement:v,checkEntryStatus:y,tournamentRecord:b,drawDefinition:I,event:S}=t;if(!I)return{error:Lt};if(!S)return{error:Wn};S.drawDefinitions||(S.drawDefinitions=[]);let{drawId:w,drawName:T,entries:U}=I,{entries:C}=S,E=0;if(g!==void 0&&g!==S.drawDefinitions.length)return{error:Ce,info:"drawDefintions count mismatch"};let{flightProfile:P}=Rr({event:S}),M=h&&((e=P?.flights)==null?void 0:e.find(W=>W.flightNumber===h.flightNumber)),R=(r=(n=(i=P?.links)==null?void 0:i.find(W=>{var q;return((q=W?.target)==null?void 0:q.drawId)===w}))==null?void 0:n.source)==null?void 0:r.drawId;if(R&&!S.drawDefinitions.find(W=>W.drawId===R))return pe({result:{error:Lt},info:{sourceDrawId:R}});if(M&&M.drawId!==I.drawId)return pe({result:{error:qI},info:{relevantFlight:M}});let N=U?.every(({participantId:W,entryStatus:q})=>{let Z=M?.drawEntries.find(K=>K.participantId===W);return!q||Z?.entryStatus===q}),A=!y||C&&U?.every(({participantId:W,entryStatus:q,entryStage:Z})=>{var K;return((K=C.find(Q=>Q.participantId===W&&(!Q.entryStage||Q.entryStage===Z)))==null?void 0:K.entryStatus)===q});if(M&&!N)return pe({result:{error:qI},context:{drawEntriesPresentInFlight:N,matchingEventEntries:A,relevantFlight:M},info:"Draw entries are not present in flight or do not match entryStatuses"});if(m&&U?.filter(Boolean).forEach(W=>{if(W!=null&&W.entryStatus&&yd.includes(W?.entryStatus)){let q=C?.filter(Boolean).find(Z=>Z.participantId===W.participantId);q&&W.entryStatus&&q?.entryStatus!==W.entryStatus&&(q.entryStatus=W.entryStatus,E+=1)}}),C&&!A)return pe({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:A,eventEntries:C},error:qI}});let _=((s=(a=P?.flights)==null?void 0:a.map(({flightNumber:W})=>!isNaN(W)&&ai(W)))==null?void 0:s.filter(Boolean))||[],x=((o=S.drawDefinitions.map(({drawOrder:W})=>W&&ai(W)))==null?void 0:o.filter(Boolean))||[],O=Math.max(0,...x,..._)+1,$=(l=P?.flights)==null?void 0:l.find(W=>W.drawId===w),F;if($){$.drawName=I.drawName,F={name:ld,value:{...P,flights:P.flights}};let W=$.flightNumber;W&&!x.includes(W)?O=W:$.flightNumber=O}else{let W=P?.flights||[];W.push({manuallyAdded:!0,flightNumber:O,drawEntries:U,drawName:T,drawId:w}),F={name:ld,value:{...P||{},flights:W}}}kv({event:S,extension:F}),Object.assign(I,{drawOrder:O});let j=S.drawDefinitions.find(W=>W.drawId===w),H=b?.tournamentId,G=S.eventId;if(j){if(!v)return{error:Fve};let W=((c=(u=ho({drawDefinition:j}))==null?void 0:u.matchUps)==null?void 0:c.map(Na))??[],q=(d=ho({drawDefinition:I}))==null?void 0:d.matchUps;if(!f){W!=null&&W.length&&Xm({matchUpIds:W,action:"modifyDrawDefinition",tournamentId:H,eventId:G}),q!=null&&q.length&&sv({matchUps:q,tournamentId:H,eventId:G}),S.drawDefinitions=S.drawDefinitions.map(K=>K.drawId===w?I:K);let Z=(p=I.structures)==null?void 0:p.map(({structureId:K})=>K);Bn({drawDefinition:I,tournamentId:H,structureIds:Z,eventId:G})}}else if(S.drawDefinitions.push(I),!f){let{matchUps:W}=ho({drawDefinition:I,event:S});W&&sv({tournamentId:b?.tournamentId,matchUps:W}),NM({drawDefinition:I,tournamentId:H,eventId:G})}return{...ue,modifiedEventEntryStatusCount:E}}function WTe(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:s,assignments:o,drawId:l,event:u}=t,c=0;if(!(o!=null&&o.length))return{error:e7};if(!n)return{error:lt};if(!l)return{error:Xd};let d=ec({provisionalPositioning:e,drawDefinition:r,structureId:s});if(d.error)return d;let{seedAssignments:p,seedLimit:h}=d,f=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));o.forEach(v=>{let{seedNumber:y}=v;h&&y<=h&&(!i||f[y])&&(f[y]=v)});let m=Object.values(f),g=m.map(v=>v?.participantId).filter(Boolean);if(g.length!==Eve(g).length)return{error:$ve};for(let v of m){let y=qD({...v,provisionalPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:s,event:u});if(y!=null&&y.error)return y;y!=null&&y.success&&c++}return c?{...ue,modifications:c}:{error:_D}}function SY({deleteExisting:t,event:e,flightProfile:i}){var n;let r="attachFlightProfile";if(!i)return pe({result:{error:Xt},stack:r});if(!e)return pe({result:{error:Wn},stack:r});let{flightProfile:a}=Rr({event:e});return a&&!t?pe({result:{error:v7},stack:r}):(n=e.drawDefinitions)!=null&&n.length?pe({result:{error:kve},stack:r}):(kv({event:e,extension:{name:ld,value:i}}),{flightProfile:At(i,!1,!0),...ue})}function aYe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var n;if(!t)return{error:lt};if(!i)return{error:Mv};if(!e)return{error:Xt,info:"scaleAttributes required"};let{scaleType:r,eventType:a,scaleName:s}=e,o=[QIe,r,a,s].join(".");return(n=t.participants)==null||n.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(u=>u&&u?.itemType!==o))}),{...ue}}function TY({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:n,drawId:r,event:a,stage:s}){var o;if(!a)return{error:Wn};if(n&&!Array.isArray(n))return pe({result:{error:Ce},info:hb("entryStatus"),stack:"removeScaleValues"});let l=a.entries;if(r){let{flightProfile:c}=Rr({event:a}),d=(o=c?.flights)==null?void 0:o.find(p=>p.drawId===r);d?l=d.drawEntries:l=i?.entries}let u=(l||[]).filter(c=>(!s||!c.entryStage||c.entryStage===s)&&(!n||n.includes(c.entryStatus))).map(Gi);return aYe({tournamentRecord:t,scaleAttributes:e,participantIds:u})}function BB({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:n=Du,event:r}){if(!e)return pe({result:{error:lt}});if(!r)return pe({result:{error:Wn}});if(!Qi(i))return pe({result:{error:Xt}});if(Qi(i.draws))for(let s of Object.keys(i.draws)){let o=i.draws[s].scheduleDetails??[];if(o.length){let l=[];for(let u of o){let c=l.find(d=>kqe(d.attributes,u.attributes));c!=null&&c.dates&&u.dates?c.dates.push(...u.dates):l.push(u)}i.draws[s].scheduleDetails=l}}let a=QD({statusObject:{displaySettings:i},removePriorValues:t,status:n,event:r});return a.error?a:{...ue}}function YTe({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:n,drawId:r,event:a,stage:s}){var o,l;if(!t)return{error:lt};if(!a)return{error:Wn};n=n||((o=a.category)==null?void 0:o.categoryName)||((l=a.category)==null?void 0:l.ageCategoryCode);let u={eventType:a.eventType,scaleType:Lh,scaleName:n};return TY({tournamentRecord:t,scaleAttributes:u,drawDefinition:e,entryStatuses:i,drawId:r,event:a,stage:s})}function KTe(t){let e=Yt(t,[{[Ta]:!0},{eventIds:!0,[Ho]:Os}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:n,eventIds:r}=t,a=[],s=[],o=[],l=[];if(n.events=(n.events||[]).filter(u=>{if(r.includes(u.eventId)){let p={action:O_,payload:{events:[u]}};a.push(p),s.push({tournamentId:n.tournamentId,eventName:u.eventName,eventType:u.eventType,category:u.category,eventId:u.eventId,gender:u.gender})}let c=u.eventType===Ju?(u.entries||[]).map(({entryStatus:p,participantId:h})=>p!==dc&&h).filter(Boolean):[],d=r.includes(u.eventId);return d?l.push(...c):o.push(...c),!d}),i){let u=l.filter(c=>!o.includes(c));n.participants=n.participants.filter(({participantId:c})=>!u.includes(c))}if(gN({tournamentRecord:n}),a.length)if(g$(rm)){let u=n.tournamentId;Ui({topic:rm,payload:{type:O_,tournamentId:u,detail:a}})}else uN({tournamentRecord:n,timeItem:{itemValue:s,itemType:O_}});return{...ue}}function ZTe(t){var e,i,n;let r=Yt(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:el}]);if(r.error)return r;let{eventUpdates:a,event:s}=t,o="modifyEvent",l=lYe(t),u=uYe({enteredParticipants:l}),{enteredParticipantGenders:c,enteredParticipantTypes:d}=u,p=(i=(e=Rr({event:s}))==null?void 0:e.flightProfile)==null?void 0:i.flights,h=!((n=s.drawDefinitions)!=null&&n.length)&&!(p!=null&&p.length),f=cYe({noFlightsNoDraws:h,enteredParticipantGenders:c,eventUpdates:a,stack:o});if(f.error)return f;let m=dYe({enteredParticipantTypes:d,eventUpdates:a,stack:o});if(m.error)return m;let g=sYe({...t,...u,enteredParticipants:l,stack:o});if(g.error)return g;let v=oYe({...t,stack:o});return v.error?v:(a.eventType&&(s.eventType=a.eventType),a.eventName&&(s.eventName=a.eventName),a.gender&&(s.gender=a.gender),{...ue})}function sYe(t){var e,i,n,r,a,s;let o=(e=t.eventUpdates)==null?void 0:e.category;if(!o)return{...ue};let l=HC({category:o});if(l.error)return l;if(t.event.eventType===aa){let u=((n=(i=t.event)==null?void 0:i.drawDefinitions)==null?void 0:n.map(p=>fp(p)))??[],c=fp(t.event),d=(((r=If(t))==null?void 0:r.matchUps)??[]).map(p=>fp(p))??[];if(![c,...u,...d].filter(Boolean).every(p=>p.collectionDefinitions.every(h=>!h.category||SM({category:t.eventUpdates.category,childCategory:h.category}))))return pe({result:{error:FC},stack:t.stack})}if((a=t.enteredParticipants)!=null&&a.length){let u=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,c=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,d=t.enteredParticipants.map(f=>f.participantType===Hi?f:f.individualParticpants??[]).flat(),p=Sw({category:o,consideredDate:u}),h=Sw({category:o,consideredDate:c});if(p!=null&&p.ageMinDate||p!=null&&p.ageMaxDate||h!=null&&h.ageMinDate||h!=null&&h.ageMaxDate)for(let f of d){let m=(s=f.person)==null?void 0:s.birthDate;if(!m)return pe({result:{error:rye},stack:t.stack});let g=new Date(m).getTime();if(p.ageMinDate||p.ageMaxDate){let v=new Date(p.ageMinDate).getTime(),y=new Date(p.ageMaxDate).getTime();if(g<v||g>y)return pe({result:{error:IH},stack:t.stack})}if(h.ageMin||h.ageMax){let v=new Date(h.ageMinDate).getTime(),y=new Date(h.ageMaxDate).getTime();if(g<v||g>y)return pe({result:{error:IH},stack:t.stack})}}}return{...ue}}function oYe(t){let{tournamentRecord:e,eventUpdates:i,event:n,stack:r}=t;if(i.startDate||i.endDate){let a=bY({startDate:i.startDate,endDate:i.endDate,tournamentRecord:e,event:n});if(a.error)return pe({result:a,stack:r})}return{...ue}}function lYe(t){var e;let{tournamentRecord:i,event:n}=t,r=((e=n?.entries)==null?void 0:e.filter(({entryStatus:a})=>{let s=a;return[...yd,Xc].includes(s)}).map(({participantId:a})=>a))??[];return r?hr({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:i}).participants??[]:[]}function uYe({enteredParticipants:t}){let e=[],i=t.reduce((r,a)=>{var s,o;let l=(s=a.person)!=null&&s.sex?[a.person.sex]:((o=a.individualParticpants)==null?void 0:o.map(u=>{var c;return(c=u.person)==null?void 0:c.sex}))||[];return e.push(...l),r.includes(a.participantType)?r:r.concat(a.participantType)},[]),n=Si(e);return{enteredParticipantTypes:i,enteredParticipantGenders:n}}function cYe({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:n}){let r=!e.length||!i.gender||i.gender===qd||e.length===1&&e[0]===i.gender||t&&i.gender===ko;return i.gender&&!r?pe({context:{gender:i.gender,validGender:r},result:{error:DP},stack:n}):{...ue}}function dYe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let n=(t.includes(aa)&&[aa]||t.includes(Hi)&&[zp]||t.includes(Ai)&&[Ju]||[Ju,zp,aa]).includes(e.eventType??"");return e.eventType&&!n?pe({context:{participantType:e.eventType,validEventType:n},result:{error:rf},stack:i}):{...ue}}function VB({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:n,event:r,stage:a}){var s,o,l;let u="addFlight";if(!r)return pe({result:{error:Wn},stack:u});if(!i)return pe({result:{error:Xt},stack:u});if(e!=null&&e.length){let g=(r.entries??[]).map(Gi),v=e.map(Gi);if(Pr(v,g).length!==v.length)return pe({result:{error:Ce},stack:u})}let c=(s=Rr({event:r}))==null?void 0:s.flightProfile,d=((l=(o=c?.flights)==null?void 0:o.map(({flightNumber:g})=>!isNaN(g)&&ai(g)))==null?void 0:l.filter(Boolean))||[],p=Math.max(0,...d)+1,h={drawId:n||gn(),flightNumber:p,drawEntries:e,drawName:i};if(a&&(h.stage=a),t&&(h.qualifyingPositions=t),(c?.flights||[]).find(({drawId:g})=>g===h.drawId))return pe({result:{error:Lye},stack:u});let f=(c?.flights||[]).concat(h),m={name:ld,value:{...c||{},flights:f}};return kv({event:r,extension:m})}var XTe={};$i(XTe,{drawMatic:()=>x9,garman:()=>rUe,generateAdHocMatchUps:()=>fB,generateAdHocRounds:()=>k9,generateAndPopulatePlayoffStructures:()=>c9,generateCourts:()=>UY,generateDrawDefinition:()=>bN,generateDrawMaticRound:()=>U9,generateDrawStructuresAndLinks:()=>w9,generateDrawTypeAndModifyDrawDefinition:()=>S9,generateFlightProfile:()=>fYe,generateLineUps:()=>nUe,generateQualifyingStructure:()=>t9,generateSeedingScaleItems:()=>ETe,generateStatCrew:()=>mYe,generateVoluntaryConsolation:()=>aSe,roundRobinGroups:()=>w5e});var pYe="splitLevelBased",JTe="splitWaterfall",QTe="splitShuttle",hYe={SPLIT_LEVEL_BASED:pYe,SPLIT_WATERFALL:JTe,SPLIT_SHUTTLE:QTe};function fYe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,deleteExisting:s,sortDescending:o,drawNames:l=[],flightsCount:u,splitMethod:c,uuids:d=[],event:p,stage:h}=t;if(!p)return{error:Wn};let f=p.entries??[],{flightProfile:m}=Rr({event:p});if(m&&i&&!s)return{error:v7};let g=t.scaledEntries??Y0({tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,sortDescending:o,event:p,stage:h}).scaledEntries,v=g.map(Gi),y=co(f.filter(({participantId:E})=>!v.includes(E)).filter(E=>(!h||!E.entryStage||E.entryStage===h)&&(!E.entryStatus||qb.includes(E.entryStatus)))),b=g.concat(...y),I=b.length,S=Math.ceil(I/u),w=ka(b,S);c===JTe?w=pH(b,u):c===QTe&&(w=pH(b,u,!0));function T(E){return(E||[]).map(({participantId:P,scaleValue:M})=>{let R=f.find(N=>N.participantId===P);return R!=null&&R.scaleValue&&M&&(R.scaleValue=M),R}).sort((P,M)=>P.scaleValue-M.scaleValue).map((P,M)=>(P.scaleValue&&(P.seedNumber=M+1),P))}let U=Et(0,u).map(E=>{let P=E+1;return{flightNumber:P,drawId:d?.pop()??gn(),drawEntries:T(w[E]),drawName:l?.length&&l[E]||`${e} ${P}`}}),C={scaleAttributes:r,splitMethod:c,flights:U};if(i){let E=SY({flightProfile:C,deleteExisting:s,event:p});return{splitEntries:mu()&&w||void 0,...E}}else return{flightProfile:C,...ue}}function eUe({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(s=>typeof s=="object"&&Object.keys(s).length===1)})),n=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),r=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return tUe({tagName:e,attributes:r,childArrays:i,childObjects:n})}function tUe(t){let{tagName:e,attributes:i=[],childArrays:n=[],childObjects:r}=t,a=`\r
`,s=h=>{let f=Object.keys(h)[0],m=h[f];return{key:f,value:m}},o=n?.map(({key:h,value:f})=>tUe({tagName:h,childObjects:f.map(s)})).join(`\r
`),l=r?.map(({key:h,value:f})=>eUe({tagName:h,json:f??[]})).join(`\r
`),u=i?.map(({key:h,value:f})=>`${h}="${f}"`).join(" "),c=u?` ${u}`:"";if(e==="childArray")return l;let d=l!=null&&l.length?`${a}${l}${a}`:"",p=o!=null&&o.length?`${a}${o}${a}`:"";return`<${e}${c}>${d}${p}</${e}>`}function mYe(t){var e,i,n;let r=Yt(t,[{[Ta]:!0}]);if(r.error)return r;let{tournamentRecord:a}=t,{startDate:s,tournamentId:o,tournamentName:l}=a,{participantMap:u,matchUps:c,mappedMatchUps:d}=hr({withMatchUps:!0,withEvents:!0,tournamentRecord:a}),p=a.participants.filter(w=>w.participantType===Sn),h=c?.filter(w=>w.matchUpType===Sn)??[],f=h?.reduce((w,T)=>{let U=T?.tieMatchUps??[];return U&&[...w,...U]},[])??[],m=c?.filter(w=>w.matchUpType===Mn)??[],g=c?.filter(w=>w.matchUpType===En)??[],v=f.length===m.length+g.length,y=h.length===1&&v,b={mappedMatchUps:d,participantMap:u,tournamentName:l,tournamentId:o,tournament:v?"N":"Y",startDate:s},I=[],S=[];if(y){let w=h[0],{json:T,xml:U}=iee({teamParticipants:p,teamMatchUp:w,...b,doubles:g,singles:m});S.push(T),I.push(U)}else for(let w of h){let T=(e=w?.sides)==null?void 0:e.map(({participant:P})=>P?.participantId).filter(Boolean);if(T?.length!==2)continue;let U=T.map(P=>{var M;return P&&((M=u?.[P])==null?void 0:M.participant)}),{xml:C,json:E}=iee({doubles:(i=w.tieMatchUps)==null?void 0:i.filter(P=>P.matchUpType===En),singles:(n=w.tieMatchUps)==null?void 0:n.filter(P=>P.matchUpType===Mn),teamParticipants:U,teamMatchUp:w,...b});S.push(E),I.push(C)}return{json:S,xml:I,...ue}}function iee({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:n,tournamentId:r,teamMatchUp:a,tournament:s,startDate:o,doubles:l,singles:u}){var c,d,p,h;let f=t?.find(U=>{var C;return(C=U.participantRoleResponsibilities)==null?void 0:C.includes("Home")}),m=t?.filter(U=>U.participantId!==f?.participantId),g=Yc(o,"/","MDY"),v=f?.participantName||((c=m?.[1])==null?void 0:c.participantName),y=f?.participantId||((d=m?.[1])==null?void 0:d.participantId),b=(p=m?.[0])==null?void 0:p.participantName,I=(h=m?.[0])==null?void 0:h.participantId,S={},w=t.map(U=>({team:{...yYe({teamParticipant:U,teamMatchUp:a,uniValues:S,participantMap:i,mappedMatchUps:e,homeid:y})}})),T=Gt({venue:{tournamentname:s?n:void 0,neutralgame:f?"N":"Y",gameid:r,officials:{},tournament:s,rules:{},homename:v,visname:b,homeid:y,visid:I,date:g},childArray:w,singles_matches:u?.map(U=>nee({matchUp:U,homeid:y,uniValues:S})),doubles_matches:l?.map(U=>nee({matchUp:U,homeid:y,uniValues:S}))});return{json:T,xml:eUe({json:T,tagName:"tngame"})}}function gYe({homeid:t,uniValues:e,participant:i}){var n,r,a,s,o,l,u,c,d,p,h,f,m,g,v;if(!i)return{};let y=((n=i.individualParticipants)==null?void 0:n.length)===2,b=y?Si((r=i.individualParticipants)==null?void 0:r.map(N=>{var A,_;return(_=(A=N.teams)==null?void 0:A[0])==null?void 0:_.participantId})):[],I=y?Si((a=i.individualParticipants)==null?void 0:a.map(N=>{var A,_;return(_=(A=N.teams)==null?void 0:A[0])==null?void 0:_.teamId})):[],S=!y&&((o=(s=i.teams)==null?void 0:s[0])==null?void 0:o.participantId)||b?.length===1&&b[0]||void 0,w=!y&&((u=(l=i.teams)==null?void 0:l[0])==null?void 0:u.teamId)||I?.length===1&&I[0]||S,T=y?void 0:i.participantName,U=(d=(c=i.individualParticipants)==null?void 0:c[0])==null?void 0:d.participantName,C=(h=(p=i.individualParticipants)==null?void 0:p[1])==null?void 0:h.participantName,E=t&&(S===t?"H":"V")||"",P=y?void 0:e[S][i.participantId],M=e[S][(m=(f=i.individualParticipants)==null?void 0:f[0])==null?void 0:m.participantId],R=e[S][(v=(g=i.individualParticipants)==null?void 0:g[1])==null?void 0:v.participantId];return Gt({vh:E,uni:P,uni_1:M,uni_2:R,team:w,name:T,name_1:U,name_2:C})}function vYe({sets:t,sideNumber:e}){return Object.assign({},...t?.map(i=>{let{setNumber:n,side1Score:r,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o}=i,l=`set_${n}`,u=`tie_${n}`,c=e===1?r:a,d=e===1?s:o;return{[l]:c,[u]:d}})??[])}function yYe({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:n,homeid:r,uniValues:a}){var s,o,l,u,c,d,p,h,f,m,g,v,y,b;let{participantId:I,participantName:S}=t,w=r&&(I===r?"H":"V")||"",T=(s=i?.[I])==null?void 0:s.matchUps,U=T&&Object.keys(T),C=(l=(o=e?.sides)==null?void 0:o.find(({participant:O})=>O.participantId===I))==null?void 0:l.sideNumber,E=((d=(c=(u=e?.score)==null?void 0:u.sets)==null?void 0:c[0])==null?void 0:d[`side${C}Score`])??0;a[I]={};let P={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},M=[],R=[],N=0;for(let O of U??[]){let $=n?.[O],F=(p=$.sides.find(({participant:H})=>H.participantId===I))==null?void 0:p.sideNumber,j=((m=(f=(h=$.score)==null?void 0:h.sets)==null?void 0:f[0])==null?void 0:m[`side${F}Score`])??0;N+=j;for(let H of $.tieMatchUps??[]){let{matchUpType:G,winningSide:W}=H,q=W&&(W===F?"w":"l")||"";q&&(P[G][q]+=1);let Z=q==="w"?"1":"0",K=q==="l"?"1":"0";if(G===Mn){let Q=R.length+1;R.push({singles_pair:{pair:Q,won:Z,lost:K,tied:"0"}})}else if(G===En){let Q=M.length+1;M.push({doubles_pair:{pair:Q,won:Z,lost:K,tied:"0"}})}}}let A=[{singles:{childArray:R,won:P.SINGLES.w,lost:P.SINGLES.l}},{doubles:{childArray:M,won:P.DOUBLES.w,lost:P.DOUBLES.l}}],_=[],x=1;for(let O of t.individualParticipantIds){let $=i?.[O];if($){let{participant:F,counters:j}=$,H={won:((g=j?.DOUBLES)==null?void 0:g.wins)||0,lost:((v=j?.DOUBLES)==null?void 0:v.losses)||0},G={won:((y=j?.SINGLES)==null?void 0:y.wins)||0,lost:((b=j?.SINGLES)==null?void 0:b.losses)||0},{participantName:W,participantId:q}=F;a[I][q]=x,_.push({player:{name:W,uni:x,singles:G,doubles:H}})}x+=1}return{vh:w,id:I,name:S,score:E||N,totals:A,childArray:_}}function nee({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:n,orderOfFinish:r,matchUpType:a,sides:s}=t??{},o=s?.map(l=>{var u;let{sideNumber:c,participant:d}=l,p=vYe({sets:(u=t.score)==null?void 0:u.sets,sideNumber:c});return{[a===Mn?"singles_score":"doubles_score"]:{...gYe({homeid:e,uniValues:i,participant:d}),...p}}});return{[a===Mn?"singles_match":"doubles_match"]:{match:n,order:r,childArray:o}}}var bYe="ASC",iUe="ASC",IYe="DESC",sz="DESC",wYe={ASC:bYe,ASCENDING:iUe,DESC:IYe,DESCENDING:sz};function nUe(t){var e,i,n,r,a;let{tieFormat:s}=t,{useDefaultEventRanking:o,tournamentRecord:l,drawDefinition:u,scaleAccessor:c,singlesOnly:d,attach:p,event:h}=t;if(h?.eventType!==Fl)return{error:rf};if(!l)return{error:lt};if(!s&&!u)return{error:fu};if(s=s??((e=Xs({drawDefinition:u,event:h}))==null?void 0:e.tieFormat),Bo({tieFormat:s}).error)return{error:Oh};if(typeof c!="object"&&!o)return{error:Ce,context:{scaleAccessor:c}};let f={},m=(u?.entries??h?.entries??[]).filter(_=>_?.entryStatus===cl).map(Gi),{participants:g=[]}=hr({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:l}),v=g.filter(({participantId:_})=>m.includes(_)),y=_=>_===iv?"rankings":"ratings",b=((i=h?.category)==null?void 0:i.categoryName)??((n=h?.category)==null?void 0:n.ageCategoryCode),{scaleName:I=b,scaleType:S=iv,sortOrder:w,accessor:T}=c||{},U=y(S),C=(_,x)=>{var O,$,F;let j=(O=_[U])==null?void 0:O[x];if(!j&&o&&(j=($=_[U])==null?void 0:$[zI]),Array.isArray(j)){let H=(F=j.find(G=>G.scaleName===I))==null?void 0:F.scaleValue;if(Ir(H))return H;if(T&&typeof H=="object")return H[T]}return 0},E=(_,x,O)=>{let $=w===sz?x:_,F=w===sz?_:x;return C($,O)-C(F,O)},P=(_,x)=>E(_,x,zI),M=(_,x)=>E(_,x,nb),R=[],N=s?.collectionDefinitions??[];for(let _ of v){let x=((r=_.individualParticipants)==null?void 0:r.sort(P))??[],O=d?x:((a=_.individualParticipants)==null?void 0:a.sort(M))??[],$={};for(let j of N){let H=[],{collectionId:G,matchUpCount:W,matchUpType:q,gender:Z}=j,K=xr(zI)(q);Et(0,W).forEach(Q=>{let J=K?x:O??[],ne=Q+1,re=[];Et(0,K?1:2).forEach(oe=>{var de;let se=(de=J?.find(ge=>{var ye;let Te=Z&&([Un,Gn].includes(Z)&&Z||Z===ko&&[Un,Gn][oe]);return(!Te||Te===((ye=ge.person)==null?void 0:ye.sex))&&!H.includes(ge.participantId)}))==null?void 0:de.participantId;se&&(re.push(se),H.push(se),$[se]||($[se]=[]),$[se].push({collectionPosition:ne,collectionId:G}))}),K||R.push(re)})}let F=Object.keys($).map(j=>({collectionAssignments:$[j],participantId:j}));f[_.participantId]=F}let A=[];for(let _ of R){let{participant:x}=cd({tournamentParticipants:g,participantIds:_});if(!x){let O={individualParticipantIds:_,participantRole:ws,participantType:Ai};A.push(O)}}if(p){for(;A.length;)Zp({participant:A.pop(),tournamentRecord:l});dn({element:u,extension:{name:Rm,value:f}})}return{...ue,lineUps:f,participantsToAdd:A}}function UY(t){if(!t)return{error:Xt};let e=Yt(t,[{dates:!1,[vs]:s=>Array.isArray(s)&&s.every(Pl)},{uuids:!1,[vs]:s=>Array.isArray(s)&&s.every(nr)},{startTime:!1,endTime:!1,[vs]:P7},{idPrefix:!1,namePrefix:!1,[vs]:nr},{count:!0,[vs]:Ir}]);if(e.error)return e;let{startDate:i,endDate:n}=t.tournamentRecord??{},r=t.dates||i&&n&&rU(i,n)||[],a=Et(1,t.count+1).map(s=>{var o,l;return Gt({courtId:((o=t.uuids)==null?void 0:o.pop())??(t.idPrefix&&`${t.idPrefix}-${s}`)??gn(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${s}`),dateAvailability:r.map(u=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:u}))})});return{...ue,courts:a}}var rUe={};$i(rUe,{default:()=>UYe,garman:()=>oUe});function wN({court:t,date:e}){let i=e&&t.dateAvailability.find(r=>af(r.date,e)),n=t.dateAvailability.find(r=>!r.date);return i||n}function tE(t){let e=Yt(t,[{courtDate:!0,_ofType:el}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:n}=t,r=[],a=qr(n.startTime);(n.bookings||[]).filter(o=>!o.bookingType||!i.includes(o.bookingType)).sort((o,l)=>lx(o.startTime).localeCompare(lx(l.startTime))).forEach(o=>{let l={startTime:er(a.toISOString()),endTime:o.startTime};qr(o.startTime)>a&&r.push(l),qr(o.endTime)>a&&(a=qr(o.endTime))});let s={startTime:er(a.toISOString()),endTime:n.endTime};return qr(n.endTime)>a&&r.push(s),{timeSlots:r}}function SYe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:n}){let r=s=>{var o;let{timeSlots:l}=tE({includeBookingTypes:e,courtDate:s});return!!((o=l?.filter(a))!=null&&o.length)};function a(s){let o=qr(s.startTime),l=qr(s.endTime);return o>i||l<n?!1:wM(i,l)>=t}return{enoughTime:r}}function aUe(t){let e=Yt(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:Os}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:n,periodStart:r,date:a}=t,s=t.courts,o=qr(r),l=R7(o,i),{enoughTime:u}=SYe({averageMatchUpMinutes:i,includeBookingTypes:n,periodStartTime:o,periodEndTime:l});return{availableToScheduleCount:(s?.filter(c=>{if(!Array.isArray(c.dateAvailability))return!1;let d=wN({date:a,court:c});return!!(d&&u(d))})||[]).length,...ue}}function jB(t){var e;let{remainingScheduleTimes:i=[],clearScheduleDates:n,periodLength:r=30,scheduleDate:a,courts:s=[]}=t,{bookings:o=[]}=t;if(!Array.isArray(s)||!s.length)return{error:Ce,courts:s};if(!Array.isArray(o))return{error:rx};if(!Pl(a))return{error:za};n&&(Array.isArray(n)?n.includes(a)&&(o=[]):o=[]);let{courtBookings:l,unassignedBookings:u}=o.reduce((h,f)=>{let{courtId:m}=f;return m?h.courtBookings[m]?h.courtBookings[m].push(f):h.courtBookings[m]=[f]:h.unassignedBookings.push(f),h},{courtBookings:{},unassignedBookings:[]}),c=s.map((h,f)=>{let{courtId:m,courtName:g}=h,v=l[m]||[],y=wN({date:a,court:h})||{},{bookings:b=[],startTime:I,endTime:S,date:w}=y,T=[i[f]&&{startTime:I,endTime:i[f]},...At(b,!1,!0),...v].filter(Boolean);return{courtId:m,courtName:g,dateAvailability:{bookings:T,startTime:I,endTime:S,date:w}}});u.sort((h,f)=>an(h.startTime)-an(f.startTime));let d=()=>c.map(h=>{let f=h.dateAvailability,{timeSlots:m=[]}=tE({courtDate:f});return{courtName:h.courtName,courtId:h.courtId,timeSlots:m}}).flat(),p=[];for(let h of u){let{startTime:f,endTime:m,averageMinutes:g,recoveryMinutes:v,matchUpId:y}=h,b=an(f),I=an(m),S=d().reduce((w,{courtId:T,courtName:U,timeSlots:C})=>{let E;return C.find(({startTime:P,endTime:M})=>{E=an(P)-b;let R=b>=an(P);return I<=an(M)&&w.startDifference!==0&&((E===0||E+r>=0)&&(w.startDifference===void 0||E<w.startDifference)||R)})?{courtName:U,courtId:T,startDifference:E}:w},{});if(S.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:y,startTime:f,endTime:m};p.push(w),(e=c.find(({courtId:T})=>T===S.courtId))==null||e.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:h})}return{virtualCourts:c.map(({courtId:h,courtName:f,dateAvailability:m})=>({dateAvailability:[m],courtName:f,courtId:h})),assignedBookings:p}}function GB({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let n=(t||90)+(i||0);return e>n?n:e||30}function sUe(t){let{startTime:e="8:00",endTime:i="20:30",count:n=10,date:r}=t??{};return Et(0,n).map(()=>({dateAvailability:[{date:r,startTime:e,endTime:i}]}))}function SU({scheduleDate:t,startTime:e,endTime:i,courts:n}){let r=e&&"startTime"||i&&"endTime"||void 0;return n.reduce((a,s)=>{let o=wN({date:t,court:s}),l=r&&(o?.[r]||s[r]);return l&&(!a||e&&an(l)<an(a)||i&&an(l)>an(a))?l:a},void 0)}function TYe({averageMinutes:t,startTime:e,endTime:i,courts:n,date:r}){e=e||SU({courts:n,scheduleDate:r,startTime:!0}),i=i||SU({courts:n,scheduleDate:r,endTime:!0});let a;if(e&&i){let s=qr(e),o=qr(i);for(let l of n||[]){if(!Array.isArray(l.dateAvailability))continue;let u=wN({court:l,date:r}),{timeSlots:c}=tE({courtDate:u});c?.forEach(d=>{let p=qr(d.startTime),h=qr(d.endTime);if(p>o||p<s||h<s)return!1;if(wM(p,h)>=t){let f=er(p.toISOString());(!a||f<a)&&(a=f)}})}}return{firstTimeSlotStartTime:a}}function DY(t){let e=Yt(t,[{courts:!0,_ofType:Os}]);if(e.error)return e;let{date:i=E7(),startTime:n="08:00",endTime:r="19:00",periodLength:a,courts:s}=t,{calculateStartTimeFromCourts:o=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:c,courtsCount:d,bookings:p}=t;a=a||GB({averageMatchUpMinutes:u}),i=Ci(i),n=er(n),r=er(r);let h=0,f=0,m=0,g=0,v=0;!s&&d&&(s=sUe({startTime:n,endTime:r,count:d,date:i}));let{virtualCourts:y}=jB({remainingScheduleTimes:l,clearScheduleDates:c,scheduleDate:i,periodLength:a,bookings:p,courts:s}),{firstTimeSlotStartTime:b}=TYe({averageMinutes:u,courts:y,startTime:n,endTime:r,date:i});o&&b&&(n=b??n);let I=an(n),S=an(r)-I,w=Math.floor(S/a),T=Et(0,w+1).map(U=>{let C=I+U*a,E=L3e(C),P=aUe({courts:y??[],averageMatchUpMinutes:u,periodStart:E,date:i});if(P.error)return{error:P.error};let{availableToScheduleCount:M=0}=P,R=M>f?M-f:0;v+=U?M:0;let N=U?v/U:M,A=a*N/u,_=U?A*(U-1)+N:N,x=M?f&&_-h||R:0;h=_,f=M,m+=x;let O=ai(m)-g;return g+=O,{periodStart:E,add:O,availableToScheduleCount:M,newCourts:R,totalMatchUps:g}});return{scheduleTimes:T.reduce((U,C)=>{let E=Et(0,C.add).map(()=>({scheduleTime:C.periodStart}));return U.concat(...E)},[]).flat(),timingProfile:T,totalMatchUps:g}}var oUe={getCourtsAvailableAtPeriodStart:aUe,generateTimeSlots:tE,getScheduleTimes:DY,courtGenerator:sUe},UYe=oUe,lUe={};$i(lUe,{isValid:()=>Ll,isValidMatchUpFormat:()=>Ll,parse:()=>Do,stringify:()=>I$});var uUe={};$i(uUe,{allCompetitionMatchUps:()=>Wd,allDrawMatchUps:()=>ho,allEventMatchUps:()=>If,allTournamentMatchUps:()=>Qa,analyzeMatchUp:()=>l1,applyLineUps:()=>AUe,assignMatchUpSideParticipant:()=>dUe,assignTieMatchUpParticipantId:()=>Nx,bulkMatchUpStatusUpdate:()=>CUe,calculateWinCriteria:()=>Z0,checkInParticipant:()=>PY,checkMatchUpIsComplete:()=>Ny,checkOutParticipant:()=>EY,competitionScheduleMatchUps:()=>yN,disableTieAutoCalc:()=>DUe,drawMatchUps:()=>uY,enableTieAutoCalc:()=>SUe,eventMatchUps:()=>xB,filterMatchUps:()=>Kf,findMatchUp:()=>W9,getAllDrawMatchUps:()=>pa,getAllStructureMatchUps:()=>vn,getCheckedInParticipantIds:()=>$0,getCompetitionMatchUps:()=>o1,getEventMatchUpFormatTiming:()=>eY,getHomeParticipantId:()=>rY,getMatchUpCompetitiveProfile:()=>jM,getMatchUpContextIds:()=>aY,getMatchUpDailyLimits:()=>LB,getMatchUpDailyLimitsUpdate:()=>tY,getMatchUpDependencies:()=>bd,getMatchUpFormat:()=>sY,getMatchUpFormatTiming:()=>GM,getMatchUpFormatTimingUpdate:()=>Q9,getMatchUpScheduleDetails:()=>K$,getMatchUpType:()=>Z$,getMatchUpsStats:()=>oY,getModifiedMatchUpFormatTiming:()=>kB,getParticipantResults:()=>sN,getPredictiveAccuracy:()=>nY,getRoundMatchUps:()=>bo,getRounds:()=>lY,isValidMatchUpFormat:()=>Ll,matchUpActions:()=>pB,mutate:()=>cUe,participantScheduledMatchUps:()=>iY,query:()=>bTe,removeDelegatedOutcome:()=>TUe,removeMatchUpSideParticipant:()=>MY,removeTieMatchUpParticipantId:()=>hUe,replaceTieMatchUpParticipantId:()=>RY,resetAdHocMatchUps:()=>MUe,resetMatchUpLineUps:()=>LY,resetScorecard:()=>$Y,resetTieFormat:()=>FY,setDelegatedOutcome:()=>RUe,setMatchUpFormat:()=>EUe,setMatchUpStatus:()=>TN,setOrderOfFinish:()=>NUe,substituteParticipant:()=>UUe,tallyParticipantResults:()=>KD,toggleParticipantCheckInState:()=>HB,tournamentMatchUps:()=>OB,updateTieMatchUpScore:()=>eg,validMatchUp:()=>H$,validMatchUps:()=>pc});var cUe={};$i(cUe,{applyLineUps:()=>AUe,assignMatchUpSideParticipant:()=>dUe,assignTieMatchUpParticipantId:()=>Nx,bulkMatchUpStatusUpdate:()=>CUe,checkInParticipant:()=>PY,checkOutParticipant:()=>EY,disableTieAutoCalc:()=>DUe,enableTieAutoCalc:()=>SUe,findMatchUp:()=>W9,removeDelegatedOutcome:()=>TUe,removeMatchUpSideParticipant:()=>MY,removeTieMatchUpParticipantId:()=>hUe,replaceTieMatchUpParticipantId:()=>RY,resetAdHocMatchUps:()=>MUe,resetMatchUpLineUps:()=>LY,resetScorecard:()=>$Y,resetTieFormat:()=>FY,setDelegatedOutcome:()=>RUe,setMatchUpFormat:()=>EUe,setMatchUpStatus:()=>TN,setOrderOfFinish:()=>NUe,substituteParticipant:()=>UUe,toggleParticipantCheckInState:()=>HB,updateTieMatchUpScore:()=>eg});function dUe({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:n,matchUpId:r,event:a}){var s,o;if(i&&typeof i!="string")return{error:Hd};if(!e)return{error:Lt};if(!r)return{error:to};let l=n===void 0;if(l&&(n=1),![1,2].includes(n))return pe({result:{error:Ce,context:{sideNumber:n}}});let{matchUp:u,structure:c}=tr({drawDefinition:e,matchUpId:r,event:a});if(!u)return{error:Gs};if(!(!(c!=null&&c.structures)&&!(e.drawType&&e.drawType!==gu)&&!((s=c?.matchUps)!=null&&s.find(({roundPosition:d})=>!!d))))return{error:X6};if(!i&&((o=u?.score)!=null&&o.scoreStringSide1||wa.includes(u?.matchUpstatus)||u!=null&&u.matchUpStatus&&[jr,oa].includes(u.matchUpStatus)))return{error:o$,info:"matchUp has completed status or score"};if(u){if(u.sides=[1,2].map(d=>{var p;let h=((p=u.sides)==null?void 0:p.find(f=>f.sideNumber===d))??{sideNumber:d};return n===d?{...h,participantId:i}:h}),l)for(let d of u.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);Xi({tournamentId:t?.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:u})}return{...ue,sidesSwapped:l}}function Vl({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:s,event:o}){let{matchUp:l}=tr({drawDefinition:n,event:o,matchUpId:a});if(!l)return{error:Gs};let u=lh({removePriorValues:t,element:l,duplicateValues:i,timeItem:s});return r||Xi({tournamentId:e?.tournamentId,eventId:o?.eventId,context:"addTimeItem",drawDefinition:n,matchUp:l}),u}function EY(t){var e;let i=[{[Ta]:!0},{[Po]:!0},{[lf]:!0},{[ah]:!0}],n=Yt(t,i);if(n.error)return n;let r=XD(t,[{[OD]:yf,attr:{[C$]:!0}}]);if(r.error)return r;let{tournamentRecord:a,drawDefinition:s,participantId:o,matchUpId:l}=t,u=(e=r?.matchUp)==null?void 0:e.matchUp,{matchUpStatus:c,score:d}=u??{};if(c&&J7.includes(c)||c&&wa.includes(c)||Sa({score:d}))return{error:jve};let p=$0({matchUp:u});if(p!=null&&p.error)return p;let{checkedInParticipantIds:h,allRelevantParticipantIds:f}=p??{};if(!(f!=null&&f.includes(o)))return{error:Hd};if(!(h!=null&&h.includes(o)))return{error:gye};let m=WIe({matchUp:u});if(m!=null&&m.error)return m;let{sideParticipantIds:g,nestedIndividualParticipantIds:v}=m??{},y=g?.indexOf(o);return y!==void 0&&[0,1].includes(y)&&(v?.[y]??[]).forEach(b=>{Vl({drawDefinition:s,matchUpId:l,timeItem:{itemType:gx,itemValue:b}})}),Vl({tournamentRecord:a,drawDefinition:s,matchUpId:l,timeItem:{itemValue:o,itemType:gx}}),{...ue,checkedOut:!0}}function PY(t){var e;let i=[{[Ta]:!0},{[Po]:!0},{[lf]:!0},{[ah]:!0}],n=Yt(t,i);if(n[Zc])return n;let r=XD(t,[{[OD]:yf,attr:{[C$]:!0}}]);if(r[Zc])return r;let{tournamentRecord:a,drawDefinition:s,participantId:o,matchUpId:l}=t,u=$0({matchUp:(e=r?.matchUp)==null?void 0:e.matchUp});if(u!=null&&u.error)return u;let{checkedInParticipantIds:c,allRelevantParticipantIds:d}=u??{};if(!(d!=null&&d.includes(o)))return{[Zc]:Hd};let p={...ue,checkedIn:!0};return c!=null&&c.includes(o)||Vl({tournamentRecord:a,drawDefinition:s,matchUpId:l,timeItem:{itemValue:o,itemType:mx}}),p}function HB(t){var e,i;let n=Yt(t,[{[lf]:!0,[Po]:!0,[ah]:!0}]);if(n.error)return n;let r=t.tournamentId??t.activeTournamentId,a=t.tournamentRecord??(r&&((e=t.tournamentRecords)==null?void 0:e[r]));if(!a)return{error:lt};let s=(i=XD(t,[{[OD]:yf,attr:{[C$]:!0},[Zc]:Gs}]).matchUp)==null?void 0:i.matchUp;if(!s)return{error:Gs};let{checkedInParticipantIds:o=[]}=$0({matchUp:s}),{participantId:l,matchUpId:u,drawDefinition:c}=t;return l&&o.includes(l)?EY({tournamentRecord:a,drawDefinition:c,participantId:l,matchUpId:u,matchUp:s}):PY({tournamentRecord:a,drawDefinition:c,participantId:l,matchUpId:u,matchUp:s})}function CY({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:n}){var r,a;if(!t)return{error:lt};if(!e)return{error:Xd};if(!n)return{error:Xu};let s=Cs({drawDefinition:e}),{matchUp:o}=tr({matchUpId:i,drawDefinition:e,matchUpsMap:s});if(!o)return{error:Gs};let{matchUp:l,structure:u}=tr({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:s,event:n});if(!l)return{error:Gs};let{collectionPosition:c,drawPositions:d,collectionId:p,matchUpTieId:h,matchUpType:f}=l;if(f&&!t$([Mn,En],f))return{error:ll};let{positionAssignments:m}=Fn({structure:u}),g=m?.filter(U=>d?.includes(U.drawPosition)),{matchUp:v}=tr({matchUpId:h,drawDefinition:e,matchUpsMap:s}),y=((r=v?.sides)==null?void 0:r.map(Gi))??[],b=g?.map(Gi)??[],I=[...y,...b],{participants:S}=hr({tournamentRecord:t,participantFilters:{participantTypes:[Sn],participantIds:I}}),{matchUp:w}=tr({matchUpId:h,inContext:!0,drawDefinition:e,matchUpsMap:s}),T=(a=Xs({matchUp:v,drawDefinition:e,structure:u,event:n}))==null?void 0:a.tieFormat;return{inContextDualMatchUp:w,inContextTieMatchUp:l,relevantAssignments:g,collectionPosition:c,teamParticipants:S,collectionId:p,matchUpType:f,dualMatchUp:v,tieMatchUp:o,tieFormat:T,structure:u,...ue}}function RY(t){var e,i,n,r,a,s,o,l,u,c,d,p,h,f,m,g;let v=CY(t);if(v.error)return v;let y="replaceTieMatchUpParticipantid",{existingParticipantId:b,tournamentRecord:I,newParticipantId:S,drawDefinition:w,substitution:T,event:U}=t;if(!b||!S)return pe({result:{error:da},stack:y});if(b===S)return{...ue};let{inContextDualMatchUp:C,inContextTieMatchUp:E,collectionPosition:P,collectionId:M,dualMatchUp:R,tieMatchUp:N,tieFormat:A}=v,_=E?.matchUpType,x=(e=E?.sides)==null?void 0:e.find(se=>{var ge,ye,Te;return((ge=se.participant)==null?void 0:ge.participantId)===b||((Te=(ye=se.participant)==null?void 0:ye.individualParticipantIds)==null?void 0:Te.includes(b))});if(!x)return{error:Ar};let O=((i=hr({tournamentRecord:I,participantFilters:{participantIds:[b,S]}}))==null?void 0:i.participants)??[];if(O.length!==2)return pe({result:{error:da},stack:y});if(O[0].participantType!==O[1].participantType)return pe({result:{error:zd},stack:y});let{appliedPolicies:$}=pn({tournamentRecord:I,drawDefinition:w,event:U}),F=((n=t.policyDefinitions)==null?void 0:n[Wa])??$?.[Wa]??zD[Wa],j=O.find(({participantId:se})=>se===S);if((t.enforceGender??((r=F?.participants)==null?void 0:r.enforceGender))!==!1&&[Un,Gn].includes(E?.gender)&&E?.gender!==((a=j?.person)==null?void 0:a.sex))return{error:E0,info:"Gender mismatch"};let H=(s=F?.processCodes)==null?void 0:s.substitution;lN({tournamentId:I.tournamentId,eventId:U.eventId,inContextDualMatchUp:C,drawDefinition:w,dualMatchUp:R});let G=(o=R?.sides)==null?void 0:o.find(({sideNumber:se})=>se===x.sideNumber);if(!G)return pe({result:{sideNumber:x.sideNumber,existingParticipantId:b,error:Xa},stack:y});if((u=(l=E?.sides)==null?void 0:l.flatMap(se=>{var ge,ye;return((ge=se.participant)==null?void 0:ge.individualParticipantIds)||((ye=se.participant)==null?void 0:ye.participantId)||[]}))!=null&&u.includes(S))return pe({result:{error:u$},stack:y});let W=(d=(c=C?.sides)==null?void 0:c.find(({sideNumber:se})=>se===x.sideNumber))==null?void 0:d.participantId,q=G.lineUp,Z=q?.find(({participantId:se})=>S===se),K=q?.reduce((se,ge)=>ge.substitutionOrder>se?ge.substitutionOrder:se,0),Q=q?.map(se=>{var ge;let ye=At(se,!1,!0);if(![b,S].includes(ye.participantId))return ye;if(!T&&[b,S].includes(ye.participantId)&&(ye.collectionAssignments=(ge=ye.collectionAssignments)==null?void 0:ge.filter(Te=>!(Te.collectionPosition===P&&Te.collectionId===M))),T&&b===ye.participantId&&(ye.collectionAssignments=ye.collectionAssignments.map(Te=>Te.collectionPosition===P&&Te.collectionId===M&&Te.substitutionOrder===void 0?{...Te,substitutionOrder:K}:Te)),ye.participantId===S){ye.collectionAssignments||(ye.collectionAssignments=[]);let Te={collectionId:M,collectionPosition:P};T&&(Te.previousParticipantId=b,Te.substitutionOrder=(K??0)+1),ye.collectionAssignments.push(Te)}return ye})??[];if(!Z){let se={collectionId:M,collectionPosition:P};T&&(se.substitutionOrder=(K??0)+1,se.previousParticipantId=b);let ge={collectionAssignments:[se],participantId:S};Q.push(ge)}let J=_===En,{assignedParticipantIds:ne}=vx({lineUp:q,collectionPosition:P,collectionId:M}),{assignedParticipantIds:re}=vx({lineUp:Q,collectionPosition:P,collectionId:M});if(G.lineUp=Q,W&&A){let se=q0({participantId:W,lineUp:Q,drawDefinition:w,tieFormat:A});if(se.error)return pe({result:se,stack:y})}else console.log("team participantId not found");let oe,de;if(J){let{tournamentRecord:se}=t,ge=cd({participantIds:re,tournamentRecord:se});if(!ge.participant){let Te=Zp({returnParticipant:!0,pairOverride:!0,tournamentRecord:se,participant:{participantRole:ws,individualParticipantIds:re,participantType:Ai}});if(Te.error)return pe({result:Te,stack:y});oe=(p=Te.participant)==null?void 0:p.participantId}ge=cd({participantIds:ne,tournamentRecord:se});let ye=(h=ge.participant)==null?void 0:h.participantId;ye&&H0({participantIds:[ye],tournamentRecord:se}).success&&(de=ye)}if(T||((f=x.substitutions)==null?void 0:f.length)===1){if(T)H&&N&&(N.processCodes=Si([...N?.processCodes??[],...H]));else for(let se of H||[]){let ge=(m=N?.processCodes)==null?void 0:m.lastIndexOf(se);ge!==void 0&&((g=N?.processCodes)==null||g.splice(ge,1))}N&&Xi({tournamentId:I?.tournamentId,matchUp:N,context:y,drawDefinition:w})}return R&&Xi({tournamentId:I?.tournamentId,matchUp:R,context:y,drawDefinition:w}),{...ue,modifiedLineUp:Q,participantRemoved:de,participantAdded:oe}}function pUe({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:n,participantIds:r,collectionId:a}){var s;if(!a||!t||!Array.isArray(r))return{modifiedLineUp:i?.lineUp||[],error:Ce};let o=i?.lineUp||((s=db({participantId:e,drawDefinition:n}))==null?void 0:s.lineUp),l=[],u=[];return{modifiedLineUp:o?.map(c=>{var d;if(!r.includes(c.participantId))return c;let p=(d=c.collectionAssignments)==null?void 0:d.filter(h=>{let f=h.collectionId===a&&h.collectionPosition===t;return f&&(h.previousParticipantId&&l.push(h.previousParticipantId),u.push({participantId:c.participantId,...h})),!f});return{participantId:c.participantId,collectionAssignments:p}}).filter(Boolean)||[],assignmentsRemoved:u,previousParticipantIds:l}}function DYe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var n,r;let a=(i.events||[]).filter(o=>{var l;return o?.eventType===aa&&((l=o?.entries)==null?void 0:l.some(u=>u.participantId===e))}),s=o=>!t.includes(o.participantId);for(let o of a){o.entries=(o.entries||[]).filter(s);let{flightProfile:l}=Rr({event:o});(n=l?.flights)==null||n.forEach(u=>{u.drawEntries=(u.drawEntries||[]).filter(s)}),(r=o?.drawDefinitions)==null||r.forEach(u=>{u.entries=(u.entries||[]).filter(s)})}return{...ue}}function zB({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:n}){let r="addIndividualParticipantIds";if(!n)return pe({result:{error:lt},stack:r});if(!e||!t)return pe({result:{error:Xt},stack:r});let a=n.participants??[],s=a.find(d=>d.participantId===e);if(!s)return pe({result:{error:Ar},stack:r});if(s!=null&&s.participantType&&![Sn,Uu].includes(s.participantType))return pe({context:{participantType:s.participantType},result:{error:zd},stack:r});let o=t.filter(d=>{var p;return((p=a.find(h=>h.participantId===d))==null?void 0:p.participantType)!==Hi});if(o.length)return pe({result:{error:El,invalidParticipantIds:o},stack:r});s.individualParticipantIds||(s.individualParticipantIds=[]);let l=s.individualParticipantIds,u=t.filter(d=>!l.includes(d));u.length&&(i&&Q$({individualParticipantIds:u,tournamentRecord:n}),s.individualParticipantIds=s.individualParticipantIds.concat(...u));let{topics:c}=lc();if(c.includes(Es)){let d=a.find(({participantId:p})=>p===e);Ui({topic:Es,payload:{participants:[d]}})}return DYe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:n}),{groupingParticipant:At(s,!1,!0),added:u.length,...ue}}function qB(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r,pairOverride:a,participant:s}=t;if(!r)return{error:lt};if(!s)return{error:P0};if(!s.participantId)return Zp({tournamentRecord:r,participant:s});let{participant:o}=Ov({participantId:s.participantId,tournamentRecord:r});if(!o)return Zp({tournamentRecord:r,participant:s});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:c,participantName:d,participantRole:p,participantType:h,onlineResources:f,contacts:m,person:g}=s;if(h&&o.participantType!==h)return{error:cye};let v={};if(m&&(v.contacts=m),f&&(v.onlineResources=f),c&&nr(c)&&(v.participantOtherName=c),d&&nr(d)&&(v.participantName=d),Array.isArray(u)){let{participants:y}=hr({participantFilters:{participantTypes:[Hi]},tournamentRecord:r}),b=y?.map(Gi);if(b){let I=u.filter(S=>nr(S)&&b.includes(S));([Uu,zn].includes(h||o.participantType)||h===Ai&&(I.length===2||a))&&(v.individualParticipantIds=I),o.participantType===PP.PAIR&&e&&(v.participantName=EYe({individualParticipants:y,newValues:v}))}}return Object.keys(k8).includes(p)&&(v.participantRole=p),Object.keys(PP).includes(h)&&(v.participantType=h),Array.isArray(l)&&(v.participantRoleResponsibilties=l),o.participantType===PP.INDIVIDUAL&&g&&PYe({updateParticipantName:e,existingParticipant:o,newValues:v,person:g}),Object.assign(o,Gt(v)),i&&zB({individualParticipantIds:[o.participantId],groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r}),Ui({topic:Es,payload:{tournamentId:r.tournamentId,participants:[o]}}),{participant:At(o),...ue}}function EYe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,n=t.filter(({participantId:r})=>i.includes(r)).map(({person:r})=>r?.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(n+="/Unknown"),n}function PYe({updateParticipantName:t,existingParticipant:e,newValues:i,person:n}){let r={},{standardFamilyName:a,standardGivenName:s,nationalityCode:o,personId:l,birthdate:u,tennisId:c,sex:d}=n;d&&Object.keys(U7).includes(d)&&(r.sex=d);let p;if(nr(l)&&(r.personId=l),o&&nr(o)&&(CYe(o)||o==="")&&(r.nationalityCode=o),a&&typeof nr(a)&&a.length>1&&(r.standardFamilyName=a,p=!0),s&&typeof nr(s)&&s.length>1&&(r.standardGivenName=s,p=!0),p&&t){let h=`${r.standardGivenName} ${r.standardFamilyName}`;i.participantName=h}u&&Pl(u)&&(r.birthdate=u),c&&nr(c)&&(r.tennisId=c),Object.assign(e.person,r)}function CYe(t){return jg.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function Nx(t){var e,i,n,r,a,s,o,l,u,c,d,p,h,f,m,g,v,y,b,I;let S=CY(t);if(S.error)return S;let w="assignTieMatchUpParticipantId",T=t.teamParticipantId,{tournamentRecord:U,drawDefinition:C,participantId:E,event:P}=t;if(!E)return pe({result:{error:da},stack:w});if(t.sideNumber&&![1,2].includes(t.sideNumber))return pe({result:{error:s7},stack:w});let{inContextDualMatchUp:M,inContextTieMatchUp:R,relevantAssignments:N,collectionPosition:A,teamParticipants:_,collectionId:x,matchUpType:O,dualMatchUp:$,tieFormat:F}=S;if((i=(e=R?.sides)==null?void 0:e.flatMap(Me=>{var Oe,at;return((Oe=Me.participant)==null?void 0:Oe.individualParticipantIds)||((at=Me.participant)==null?void 0:at.participantId)||[]}))!=null&&i.includes(E))return pe({result:{...ue},stack:w});T=T??(t.sideNumber?(r=(n=M?.sides)==null?void 0:n.find(Me=>Me.sideNumber===t.sideNumber))==null?void 0:r.participantId:void 0);let j=(s=(a=hr({participantFilters:{participantIds:[E]},tournamentRecord:U}))==null?void 0:a.participants)==null?void 0:s[0];if(!j)return pe({result:{error:Ar},stack:w});let{appliedPolicies:H}=pn({tournamentRecord:U,drawDefinition:C,event:P}),G=((o=t.policyDefinitions)==null?void 0:o[Wa])??H?.[Wa]??zD[Wa];if((t.enforceGender??((l=G?.participants)==null?void 0:l.enforceGender))!==!1&&[Un,Gn].includes(R?.gender)&&R?.gender!==((u=j.person)==null?void 0:u.sex))return{error:E0,info:"Gender mismatch"};let{individualParticipantIds:W,participantType:q}=j;if(xr(Mn)(O)&&q!==Hi)return{error:zd};let Z=q===Hi?[E]:W,K=T&&_?.find(({participantId:Me})=>Me===T)||_?.find(({individualParticipantIds:Me})=>yo(Z,Me));if(!K)return{error:m7};if(T||(T=K.participantId),!T)return{error:Ar};let Q=(c=N?.find(Me=>Me.participantId===K?.participantId))==null?void 0:c.drawPosition,J=(p=(d=$?.sides)==null?void 0:d.find(Me=>Me.participantId===T))==null?void 0:p.sideNumber,ne=(f=(h=R?.sides)==null?void 0:h.find(Me=>Q&&Me.drawPosition===Q))==null?void 0:f.sideNumber,re=J??ne??t.sideNumber;if(!F)return{error:MD};if(!((m=F.collectionDefinitions)!=null&&m.find(Me=>Me.collectionId===x)))return{error:tye};lN({tournamentId:U.tournamentId,eventId:P.eventId,inContextDualMatchUp:M,drawDefinition:C,dualMatchUp:$});let oe=(g=$?.sides)==null?void 0:g.find(Me=>Me.sideNumber===re),de=(v=R?.sides)==null?void 0:v.find(Me=>Me.sideNumber===re),se=(I=(b=oe?.lineUp??((y=db({participantId:T,drawDefinition:C}))==null?void 0:y.lineUp))==null?void 0:b.filter(Me=>{var Oe;return(Oe=Me.collectionAssignments)==null?void 0:Oe.find(at=>at.collectionPosition===A&&at.collectionId===x&&!at.previousParticipantId)}))==null?void 0:I.map(Me=>Me?.participantId),ge=se?.length>1&&se||(q===Ai?j.individualParticipantIds:[E]),ye=pUe({collectionPosition:A,teamParticipantId:T,dualMatchUpSide:oe,drawDefinition:C,participantIds:ge,collectionId:x});if(ye.error)return pe({result:ye,stack:w});let{modifiedLineUp:Te}=ye,De;if(O===En){if(q!==Ai){let Me=$V({collectionPosition:A,teamParticipantId:T,drawDefinition:C,modifiedLineUp:Te,participantId:E,collectionId:x,tieFormat:F});if(Me!=null&&Me.error)return pe({result:Me,stack:w});if(Me=xe({side:de}),Me.error)return Me;De=Me.deletedParticipantId,oe&&(oe.lineUp=Te),$&&Xi({tournamentId:U?.tournamentId,matchUp:$,context:w,drawDefinition:C})}else if(q===Ai)for(let Me of ge)$V({collectionPosition:A,teamParticipantId:T,drawDefinition:C,modifiedLineUp:Te,participantId:Me,collectionId:x,tieFormat:F})}else{let Me=$V({collectionPosition:A,teamParticipantId:T,drawDefinition:C,modifiedLineUp:Te,participantId:E,collectionId:x,tieFormat:F});if(Me!=null&&Me.error)return Me}if(oe&&(oe.lineUp=Te),$&&Xi({tournamentId:U?.tournamentId,matchUp:$,context:w,drawDefinition:C}),De){let{error:Me}=H0({participantIds:[De],tournamentRecord:U});Me&&console.log("cleanup")}return{...ue,modifiedLineUp:Te};function xe({side:Me}){let Oe;if(Me.participant){let at=Me.participant.individualParticipantIds||[];if(at.filter(Boolean).length===1){let{participant:Fe}=cd({participantIds:at,tournamentRecord:U});at.push(E);let{participant:mt}=cd({participantIds:at,tournamentRecord:U});if(!mt&&Fe){Fe.individualParticipantIds=at;let Xe=qB({pairOverride:!0,tournamentRecord:U,participant:Fe});if(Xe.error)return Xe}else Oe=Fe?.participantId}}else{let at=Zp({participant:{individualParticipantIds:[E],participantRole:ws,participantType:Ai},pairOverride:!0,tournamentRecord:U});if(at.error)return at}return{...ue,deletedParticipantId:Oe}}}function $V({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:n,participantId:r,collectionId:a,tieFormat:s}){var o,l;let u=(o=db({participantId:e,drawDefinition:i}))==null?void 0:o.lineUp,c=(l=n||u)==null?void 0:l.find(p=>p?.participantId===r),d={collectionId:a,collectionPosition:t};if(c)c.collectionAssignments.push(d);else{let p={collectionAssignments:[d],participantId:r};n.push(p)}return q0({participantId:e,lineUp:n,drawDefinition:i,tieFormat:s})}function hUe(t){var e,i,n,r,a,s,o,l,u,c,d,p,h,f,m,g,v,y,b,I,S,w,T;let{tournamentRecord:U,drawDefinition:C,participantId:E,event:P}=t,M="removeTieMatchUpParticiapantId";if(!E)return pe({result:{error:da},stack:M});let R=CY(t);if(R.error)return R;let{appliedPolicies:N}=pn({tournamentRecord:U,drawDefinition:C,event:P}),A=(n=(i=((e=t.policyDefinitions)==null?void 0:e[Wa])??N?.[Wa]??zD[Wa])==null?void 0:i.processCodes)==null?void 0:n.substitution,{inContextDualMatchUp:_,inContextTieMatchUp:x,relevantAssignments:O,collectionPosition:$,teamParticipants:F,collectionId:j,matchUpType:H,dualMatchUp:G,tieMatchUp:W,tieFormat:q}=R;if(!G)return pe({result:{error:ol},stack:M});let Z=(r=x?.sides)==null?void 0:r.find(se=>{var ge,ye,Te;return((ge=se.participant)==null?void 0:ge.participantId)===E||((Te=(ye=se.participant)==null?void 0:ye.individualParticipantIds)==null?void 0:Te.includes(E))});if(!Z)return pe({result:{error:Ar},stack:M});let K=((a=t.policyDefinitions)==null?void 0:a[Qu])??N?.[Qu];if(!((s=Z.substitutions)!=null&&s.length)&&(Sa({score:x?.score})||x!=null&&x.winningSide)&&K?.requireParticipantsForScoring!==!1)return pe({result:{error:Fye},stack:M});let Q=(l=(o=_?.sides)==null?void 0:o.find(({sideNumber:se})=>se===Z.sideNumber))==null?void 0:l.participantId;if(!Q)return pe({result:{error:Ar},stack:M});let J=(c=(u=hr({participantFilters:{participantIds:[E]},tournamentRecord:U}))==null?void 0:u.participants)==null?void 0:c[0];if(!J)return pe({result:{error:Ar},stack:M});if(H===Mn&&J.participantType===Ai)return pe({result:{error:E0},stack:M});let ne=J.participantType===Hi?[E]:J.individualParticipantIds;lN({tournamentId:U.tournamentId,eventId:P.eventId,inContextDualMatchUp:_,drawDefinition:C,dualMatchUp:G});let re=(d=G.sides)==null?void 0:d.find(({sideNumber:se})=>se===Z.sideNumber);if(!re&&(((p=G.sides)==null?void 0:p.filter(({lineUp:se})=>!se).length)||0)<2){let se=F?.map(({participantId:ge})=>{var ye;return{drawPosition:(ye=O?.find(Te=>Te.participantId===ge))==null?void 0:ye.drawPosition,teamParticipantId:ge}});re=(h=G.sides)==null?void 0:h.find(ge=>{var ye;return((ye=se?.find(({drawPosition:Te})=>Te===ge.drawPosition))==null?void 0:ye.teamParticipantId)===Q})}if(!re)return pe({result:{error:Ar,context:{participantId:E}}});let{modifiedLineUp:oe,previousParticipantIds:de}=pUe({collectionPosition:$,teamParticipantId:Q,dualMatchUpSide:re,participantIds:ne,drawDefinition:C,collectionId:j});if(re.lineUp=oe,Q&&q&&q0({participantId:Q,lineUp:oe,drawDefinition:C,tieFormat:q}),H===En&&J.participantType===Hi){let se=(f=x?.sides)==null?void 0:f.find(Te=>Te.sideNumber===re?.sideNumber),{participantId:ge}=se??{},ye=ge&&((g=(m=hr({participantFilters:{participantIds:[ge]},tournamentRecord:U,withDraws:!0}))==null?void 0:m.participants)==null?void 0:g[0]);if(ye){let Te=((v=ye?.individualParticipantIds)==null?void 0:v.filter(De=>De!==E))??[];if(de&&Te.push(...de),Te.length>2)return pe({result:{error:El},stack:M});if((y=ye.draws)!=null&&y.length){if(Te.length===1){let{participant:De}=cd({participantIds:Te,tournamentRecord:U});if(!De){let xe=Zp({participant:{participantRole:ws,individualParticipantIds:Te,participantType:Ai},pairOverride:!0,tournamentRecord:U});if(xe.error)return pe({result:xe,stack:M})}}}else if(Te.length){ye.individualParticipantIds=Te;let De=qB({participant:ye,pairOverride:!0,tournamentRecord:U});if(De.error)return pe({result:De,stack:M})}else{let De=H0({participantIds:[ge],tournamentRecord:U});De.error&&console.log("cleanup",{result:De})}}else return pe({result:{error:Ar},stack:M})}if(((b=Z.substitutions)==null?void 0:b.length)===1&&!((w=(S=(I=x?.sides)==null?void 0:I.find(se=>se.sideNumber!==Z.sideNumber))==null?void 0:S.substitutions)!=null&&w.length)&&(T=W?.processCodes)!=null&&T.length){for(let se of A||[]){let ge=W.processCodes.lastIndexOf(se);W.processCodes.splice(ge,1)}Xi({tournamentId:U?.tournamentId,matchUp:W,context:M,drawDefinition:C})}return Xi({tournamentId:U?.tournamentId,matchUp:G,context:M,drawDefinition:C}),{...ue,modifiedLineUp:oe}}function MY(t){var e,i;let n=Yt(t,[{[Ta]:!0,[Po]:!0,[ah]:!0}]);if(n.error)return n;let{drawDefinition:r,sideNumber:a,matchUpId:s,event:o}=t;if(a&&![1,2].includes(a))return{error:Ce,sideNumber:a};let{matchUp:l,structure:u}=tr({drawDefinition:r,matchUpId:s,event:o});return l?Vo({structure:u})?((e=l.sides)==null||e.forEach(c=>{(!a||c.sideNumber===a)&&delete c.participantId}),Xi({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,context:"assignSideParticipant",drawDefinition:r,matchUp:l}),{...ue}):{error:X6}:{error:Gs}}function RYe({matchUpStatuses:t=[fn,ln,Wi],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:n}){var r;let a=e?.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),s=(r=a?.drawPositions)==null?void 0:r.find(d=>d!==i),o=n.filter(d=>{var p;return(p=d?.drawPositions)==null?void 0:p.includes(s)}).map(d=>d.matchUpStatus),l=n.filter(d=>{var p;return(p=d?.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),u=yo(o||[],t),c=yo(l||[],t);return{sourceMatchUp:a,winnerHadMatchUpStatus:u,winnerMatchUpStatuses:o,loserHadMatchUpStatus:c,loserMatchUpStatuses:l}}function MYe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,structureId:s,dualMatchUp:o,roundNumber:l,matchUpsMap:u,event:c}){let{structure:d}=ui({drawDefinition:a,structureId:s});if(d?.structureType===Eo)return{...ue};u=u??Cs({drawDefinition:a});let p=(u?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:h}=Cw({drawPosition:i,matchUps:p}),f=p?.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==h&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:m}=Fn({drawDefinition:a,structureId:s});for(let g of f??[])NYe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,dualMatchUp:o,matchUpsMap:u,matchUp:g,event:c});return{...ue}}function NYe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:n,tournamentRecord:r,sourceMatchUpId:a,drawDefinition:s,dualMatchUp:o,matchUpsMap:l,matchUp:u,event:c}){var d,p,h;let f="removeSubsequentDrawPosition";if(o){let g=(p=(d=t.find(({matchUpId:y})=>u.matchUpId===y).sides)==null?void 0:d.find(y=>y.drawPosition===n))==null?void 0:p.sideNumber,v=(h=u.sides)==null?void 0:h.find(y=>y.sideNumber===g);v&&delete v.lineUp}u.drawPositions=(u.drawPositions||[]).map(g=>g===n?void 0:g).filter(Boolean);let m=e.filter(({drawPosition:g})=>{var v;return(v=u.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return u.matchUpStatus=m&&fn||[Wi,ln].includes(u.matchUpStatus)&&u.matchUpStatus||Or,[ln,Wi].includes(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&_we({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),Xi({tournamentId:r?.tournamentId,eventId:c?.eventId,context:`${f}-${n}`,drawDefinition:s,matchUp:u}),{...ue}}function iE(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:r,matchUpStatus:a,matchUpsMap:s,dualMatchUp:o,targetData:l,matchUpId:u,structure:c,event:d}=t,p=!!t.matchUp.collectionId,h=Vo({structure:c}),{drawPositions:f,winningSide:m}=l.matchUp||{};if(!h&&!f)return{error:mM};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:b,winnerMatchUp:I,byeMatchUp:S}}=l,w=Np({...t,matchUpStatus:a||Or,removeWinningSide:!0});if(w.error)return w;let T;if(p){let{matchUpTieId:x,matchUpsMap:O}=t;if(T=eg({appliedPolicies:t.appliedPolicies,matchUpId:x,tournamentRecord:n,drawDefinition:r,matchUpsMap:O,event:d}),!e&&!T.removeWinningSide)return{...ue}}if(h)return{...ue};let{matchUps:U}=vn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:r,matchUpsMap:s,structure:c}),{positionAssignments:C}=xa({structure:c}),E=m-1,P=1-E,M=f[E],R=f[P],{winnerParticipantId:N,loserParticipantId:A}=C?.reduce((x,O)=>(O.drawPosition===R&&(x.loserParticipantId=O.participantId),O.drawPosition===M&&(x.winnerParticipantId=O.participantId),x),{winnerParticipantId:void 0,loserParticipantId:void 0})||{},_=U.filter(x=>{var O;return(O=x.drawPositions)==null?void 0:O.includes(R)});if(I&&fUe({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:M,winnerParticipantId:N,tournamentRecord:n,winnerTargetLink:v,drawDefinition:r,winnerMatchUp:I,dualMatchUp:o,matchUpsMap:s}),b){let{winnerHadMatchUpStatus:x}=RYe({drawPositionMatchUps:_,loserDrawPosition:R,sourceMatchUps:U}),O=g.linkCondition===qp;if(x&&O){let F=Math.min(...b.drawPositions);oz({targetLink:g,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:F,matchUpsMap:s,event:d})}let $=AYe({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:A,tournamentRecord:n,loserTargetLink:g,drawDefinition:r,loserMatchUp:b,dualMatchUp:o,matchUpsMap:s,event:d});if($.error)return $}if(S){let x=Math.min(...S.drawPositions);oz({targetLink:y,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:x,matchUpsMap:s,event:d})}return{...ue,...T&&{tieMatchUpResult:T}}}function fUe({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:n,tournamentRecord:r,winnerTargetLink:a,sourceMatchUpId:s,drawDefinition:o,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:c,event:d}){var p,h;let{structureId:f,roundNumber:m}=l,g="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:y}=ui({drawDefinition:o,structureId:v});if(!y)return{error:pr};let{positionAssignments:b}=xa({structure:y});y.seedAssignments=(y.seedAssignments??[]).filter(C=>C.participantId!==n);let I=(p=b?.find(C=>C.participantId===n))==null?void 0:p.drawPosition,{matchUps:S}=vn({drawDefinition:o,structure:y,event:d}),w=S.map(C=>C.drawPositions).flat(1/0).filter(Boolean),T=Ol(w);if((I?T[I]:void 0)===1)b?.forEach(C=>{C.participantId===n&&delete C.participantId});else{let C=S.filter(({drawPositions:E})=>E.includes(I));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:C,winnerTargetLink:a})}let U=(h=u?.drawMatchUps)==null?void 0:h.find(({matchUpId:C})=>C===l.matchUpId);U&&Xi({tournamentId:r?.tournamentId,eventId:d?.eventId,matchUp:U,context:g,drawDefinition:o})}return m&&MYe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:r,sourceMatchUpId:s,drawDefinition:o,dualMatchUp:c,matchUpsMap:u,roundNumber:m,structureId:f}),{...ue}}function AYe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:n,sourceMatchUpId:r,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,dualMatchUp:l,event:u}){var c,d,p;let h="removeDirectedLoser",f=n.target.structureId,{structure:m}=ui({drawDefinition:a,structureId:f});if(!m)return{error:pr};let{positionAssignments:g}=xa({structure:m}),v=(c=g?.find(y=>y.participantId===e))==null?void 0:c.drawPosition;if(g?.forEach(y=>{y.participantId===e&&delete y.participantId}),m.seedAssignments=(m.seedAssignments??[]).filter(y=>y.participantId!==e),l){let y=s?.sides.reduce((S,w,T)=>w.drawPosition===v?T:S,void 0),b=(d=o?.drawMatchUps)==null?void 0:d.find(({matchUpId:S})=>S===s.matchUpId),I=(p=b?.sides)==null?void 0:p[y];I&&(delete I.lineUp,Xi({tournamentId:i?.tournamentId,eventId:u?.eventId,matchUp:b,context:h,drawDefinition:a}))}return{...ue}}function oz({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,targetLink:a,event:s}){let o=a.target.structureId,l="removeDirectedBye";ou({color:"brightyellow",method:l,drawPosition:n});let u=YM({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:o,event:s});return pe({result:u,stack:l})}function _Ye(t){var e,i;let{matchUpFormat:n,score:r}=t,a=(e=r?.sets)==null?void 0:e.length,s=n&&Do(n),{setFormat:o,finalSetFormat:l,bestOf:u}=s??{};return((i=u&&a===u&&l||o)==null?void 0:i.timed)||!1}function kYe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:n}){var r;let a="attemptToSetMatchUpStatusBYE";if(n!=null&&n.winningSide)return pe({result:{error:RD},context:{matchUpStatus:fn},stack:a});let{positionAssignments:s}=xa({structure:i}),o=s?.filter(l=>l.bye).map(l=>l.drawPosition);return(r=n.drawPositions)!=null&&r.some(l=>o?.includes(l))?(n.matchUpStatus=fn,n.matchUpStatusCodes=[],Xi({tournamentId:t?.tournamentId,context:a,drawDefinition:e,matchUp:n}),{...ue}):pe({result:{error:eye},info:"matchUp does not include BYE",stack:a})}function AP(t){var e,i;let{tournamentRecord:n,appliedPolicies:r,drawDefinition:a,matchUpsMap:s,targetData:o,structure:l,event:u}=t,c="doubleExitAdvancement";if(l.structureType===Eo)return pe({result:{...ue},stack:c});let{matchUp:d,targetMatchUps:p,targetLinks:h}=o,{loserMatchUp:f,winnerMatchUp:m,loserTargetDrawPosition:g}=p,v=[ln,Wi].includes(f?.matchUpStatus)&&!((e=f.sides)!=null&&e.map(y=>y.participantId??y.participant).filter(Boolean).length);if(f&&f.matchUpStatus!==fn){let{loserTargetLink:y}=h;if((i=r?.progression)!=null&&i.doubleExitPropagateBye){let b=mUe({loserTargetDrawPosition:g,tournamentRecord:n,loserTargetLink:y,drawDefinition:a,matchUpsMap:s,event:u});if(b.error)return pe({result:b,stack:c})}else if(!v){let{feedRound:b,drawPositions:I,matchUpId:S}=f,w=b?2:2-I.indexOf(g),T=ree({...t,targetMatchUp:f,walkoverWinningSide:w,tournamentRecord:n,sourceMatchUp:d,matchUpId:S});if(T.error)return pe({result:T,stack:c})}}if(m){let y=ree({...t,matchUpId:m.matchUpId,targetMatchUp:m,tournamentRecord:n,sourceMatchUp:d});if(y.error)return pe({result:y,stack:c})}return pe({result:{...ue},stack:c})}function ree(t){var e,i,n;let{inContextDrawMatchUps:r,tournamentRecord:a,drawDefinition:s,sourceMatchUp:o,targetMatchUp:l,matchUpsMap:u}=t,c=s.structures.find(({structureId:Q})=>Q===l.structureId),d=t.matchUpStatus===oa?oa:jr,p=t.matchUpStatus===oa?Wi:ln,h="conditionallyAdvanceDrawPosition",f=u.drawMatchUps.find(Q=>Q.matchUpId===l.matchUpId);if(!f)return{error:ol};let m=o?.drawPositions||[],g=(e=f.drawPositions)==null?void 0:e.filter(Boolean),v=o?.structureId===l.structureId;if(v&&yo(m,g)&&(g=g.filter(Q=>!m.includes(Q))),v&&g.length>1)return pe({result:{error:tU},stack:h});let{pairedPreviousMatchUpIsDoubleExit:y,pairedPreviousMatchUp:b}=Nwe(t),I=Io({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawDefinition:s}),{targetMatchUps:S,targetLinks:w}=I,{loserTargetDrawPosition:T,winnerMatchUp:U,loserMatchUp:C}=S;if(C){let{loserTargetLink:Q}=w,J=mUe({loserTargetDrawPosition:T,tournamentRecord:a,loserTargetLink:Q,drawDefinition:s,matchUpsMap:u});if(J.error)return pe({result:J,stack:h})}let E=((i=f.drawPositions)==null?void 0:i.filter(Boolean))||[],P=E.length===1,M=t.walkoverWinningSide||P&&A_({drawPosition:E[0],matchUpId:l.matchUpId,inContextDrawMatchUps:r})||void 0,R=[ln,Wi].includes(f.matchUpStatus)&&!E.length,N=f.finishingRound===1,A=R&&!N?d:p,_=r.find(Q=>Q.matchUpId===b.matchUpId),x=[],O;o&&(o?.structureId===_?.structureId?o.roundPosition<b?.roundPosition?O=1:O=2:l.feedRound?o.structureId===l.structureId?O=2:O=1:M&&(O=3-M));let $=t.matchUpStatus,F=b?.matchUpStatus;O===1?x=[{matchUpStatus:fA($),previousMatchUpStatus:$,sideNumber:1},{matchUpStatus:fA(F),previousMatchUpStatus:F,sideNumber:2}]:O===2&&(x=[{matchUpStatus:fA(F),previousMatchUpStatus:F,sideNumber:1},{matchUpStatus:fA($),previousMatchUpStatus:$,sideNumber:2}]),x.length&&(x=x.map(Q=>Gt(Q)));let j=Np({...t,winningSide:M,matchUp:f,matchUpStatusCodes:x,matchUpStatus:A});if(j.error)return pe({result:j,stack:h});if(R)return AP({...t,matchUpStatus:A,targetData:I});if(!U)return pe({result:{...ue},stack:h});let H=g.length===2?g[M-1]:g[0],{positionAssignments:G}=Fn({structure:c}),W=G?.find(Q=>Q.drawPosition===H),q=u.drawMatchUps.find(Q=>Q.matchUpId===U.matchUpId),Z=(n=q?.drawPositions)==null?void 0:n.filter(Boolean),K=Z.length===1;if(H){if(W!=null&&W.bye){let Q=Io({matchUpId:q.matchUpId,inContextDrawMatchUps:r,drawDefinition:s});if(K){let J=Z.filter(Boolean)[0],ne=A_({drawPosition:J,matchUpId:q.matchUpId,inContextDrawMatchUps:r}),re=Np({appliedPolicies:t.appliedPolicies,matchUpId:q.matchUpId,matchUp:q,matchUpStatus:p,matchUpStatusCodes:[],removeScore:!0,drawDefinition:s,winningSide:ne});return re.error?pe({result:re,stack:h}):R8({drawPositionToAdvance:J,matchUpId:q.matchUpId,inContextDrawMatchUps:r,drawDefinition:s,matchUpsMap:u})}else if([ln,Wi].includes(U.matchUpStatus)){let J=AP({...t,matchUpId:q.matchUpId,matchUpStatus:A,targetData:Q});if(J.error)return pe({result:J,stack:h})}return pe({result:{...ue},stack:h})}return yU({matchUpId:U.matchUpId,drawPosition:H,inContextDrawMatchUps:r,drawDefinition:s})}else if(y){if(!q)return{error:ol};if(K){let ne=Z[0],re=A_({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawPosition:ne});console.log("existing drawPosition is winningSide",{walkoverWinningSide:re})}let Q=[ln,Wi].includes(q.matchUpStatus)?p:d,J=Np({matchUpId:q.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:q,matchUpStatusCodes:[],removeScore:!0,drawDefinition:s,matchUpStatus:Q});if(J.error)return pe({result:J,stack:h});if(Q===d){let ne=AP({...t,matchUpId:l.matchUpId,matchUpStatus:Q,targetData:I});if(ne.error)return ne}}return pe({result:{...ue},stack:h})}function mUe(t){var e;let{loserTargetDrawPosition:i,tournamentRecord:n,loserTargetLink:r,drawDefinition:a,matchUpsMap:s,event:o}=t,l=(e=r?.target)==null?void 0:e.structureId,{structure:u}=ui({drawDefinition:a,structureId:l});return u?Eu({drawPosition:i,tournamentRecord:n,drawDefinition:a,structureId:l,matchUpsMap:s,event:o}):{error:Fb}}function fA(t){return t===jr?ln:t===oa?Wi:t}function xYe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:n,structure:r,matchUp:a}=t,s=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),o="attemptToSetMatchUpStatus",l=n===fn,u=a.winningSide,c=[jr,oa].includes(n),d=qM({matchUpStatus:n}),p=FH({matchUpStatus:n}),h=!d&&!p,f=t.matchUpTieId||u&&d&&!c,m=u&&c,g=()=>Np({...t,removeScore:[oh,ln].includes(n),matchUpStatus:n||Or});return h&&{error:yH}||f&&lz(t)||m&&OYe(t)||u&&iE(t)||p&&g()||l&&kYe({tournamentRecord:e,drawDefinition:i,structure:r,matchUp:a})||!d&&{error:yH}||c&&LYe(t)||s&&lz(t)||pe({result:{error:RD},stack:o})}function OYe(t){let e=iE(t);return e.error?e:AP(t)}function LYe(t){let e=lz({...t,removeScore:!0});return e.error?e:AP(t)}function lz(t){var e;let i="scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide){let a=iE(t);if(a.error)return pe({result:a,stack:i})}let n=!!t.matchUp.collectionId,r=Np({...t});if(n){let{matchUpTieId:a,drawDefinition:s,matchUpsMap:o}=t,l=eg({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:s,matchUpsMap:o});if(l.error)return pe({result:l,stack:i});Object.assign(r,{tieMatchUpResult:l})}return pe({result:r,stack:i})}function FYe({drawDefinition:t,structure:e,matchUp:i}){var n,r,a,s;let{drawPositions:o}=i,{positionAssignments:l}=Fn({drawDefinition:t,structure:e}),u=(n=l?.filter(({drawPosition:p})=>o?.includes(p)))==null?void 0:n.map(p=>{var h;let{extension:f}=ki({element:p,name:rv});return(h=f?.value)==null?void 0:h.groupOrder}),{containerStructures:c}=VD({drawDefinition:t}),d=c[e.structureId];return{structureIds:(s=(a=(r=jD({drawDefinition:t,structureId:d}))==null?void 0:r.links)==null?void 0:a.source)==null?void 0:s.filter(p=>{var h;return yo(u,((h=p.source)==null?void 0:h.finishingPositions)||[])}).map(p=>p.source.structureId)}}function gUe({drawDefinition:t,structure:e,matchUp:i}){let n=[];if(e.finishingPosition===ob&&uv({drawDefinition:t,structure:e})){let{structureIds:r}=FYe({drawDefinition:t,structure:e,matchUp:i});r!=null&&r.length&&n.push(...r)}return{connectedStructureIds:n}}function $Ye(t){var e,i,n;let r,{inContextDrawMatchUps:a,inContextMatchUp:s,drawDefinition:o,winningSide:l}=t,u=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(u.target.feedProfile===Pd){let c=s.sides.find(({sideNumber:p})=>p!==l).participantId,d=a.find(p=>p.structureId===u.target.structureId&&p.roundNumber===u.target.roundNumber&&p.sides.some(({participantId:h})=>h===c));if(d?.matchUpStatus===Or){let p=Io({matchUpId:d.matchUpId,inContextDrawMatchUps:a,drawDefinition:o});if(!mb({inContextDrawMatchUps:a,drawDefinition:o,targetData:p})){let{structure:h}=ui({structureId:d.structureId,drawDefinition:o}),f=Fn({structure:h}).positionAssignments;for(let m of f||[])if(m.participantId===c){let g=s.sides.find(({sideNumber:v})=>v===l).participantId;if(m.participantId=g,h?.positionAssignments)h.positionAssignments=f;else if(h!=null&&h.structures){let v=Object.assign({},...(f||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of h.structures)(i=y.positionAssignments)==null||i.forEach(b=>b.participantId=v[b.drawPosition])}ov({tournamentId:(n=t.tournamentRecord)==null?void 0:n.tournamentId,event:t.event,drawDefinition:o,structure:h}),r=!0}}}}return{...ue,qualifierReplaced:r}}function BYe(t){var e,i,n,r,a;let s,{inContextDrawMatchUps:o,inContextMatchUp:l,drawDefinition:u,winningSide:c}=t,d=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(d.target.feedProfile===Pd){let p=(i=l.sides.find(({sideNumber:m})=>m===c))==null?void 0:i.participantId,h=o.filter(m=>m.structureId===d.target.structureId&&m.roundNumber===d.target.roundNumber&&m.sides.some(({participantId:g,qualifier:v})=>v&&!g)),f=xc(h);if(f?.matchUpStatus===Or){let m=Io({matchUpId:f.matchUpId,inContextDrawMatchUps:o,drawDefinition:u});if(!mb({inContextDrawMatchUps:o,drawDefinition:u,targetData:m})){let g=(n=f.sides.find(b=>b.qualifier&&!b.participantId))==null?void 0:n.drawPosition,{structure:v}=ui({structureId:f.structureId,drawDefinition:u});if(!v)return{error:pr};let y=Fn({structure:v}).positionAssignments;for(let b of y||[])if(b.drawPosition===g&&!b.participantId){if(b.participantId=p,v.positionAssignments)v.positionAssignments=y;else if(v.structures){let I=Object.assign({},...(y||[]).map(S=>({[S.drawPosition]:S.participantId})));for(let S of v.structures)(r=S.positionAssignments)==null||r.forEach(w=>w.participantId=I[w.drawPosition])}ov({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:u,structure:v}),s=!0}}}}return{...ue,qualifierPlaced:s}}function VYe(t){var e,i;let n="attemptToSetWinningSide",r,{appliedPolicies:a,disableAutoCalc:s,drawDefinition:o,dualMatchUp:l,winningSide:u,structure:c,matchUp:d}=t;if(l!=null&&l._disableAutoCalc&&s!==!1)return l9(t);if(d.winningSide&&d.winningSide!==u){let{connectedStructureIds:m}=gUe({drawDefinition:o,structure:c,matchUp:d});m.length&&(console.log({connectedStructureIds:m}),r=!0);let g=iE(t);if(g.error)return g}let p=E0e(t);if(p.error)return pe({result:p,stack:n});let h,f;return t.qualifierChanging&&(e=a?.[KC])!=null&&e.autoReplaceQualifiers&&(h=$Ye(t).qualifierReplaced),t.qualifierAdvancing&&(i=a?.[KC])!=null&&i.autoPlaceQualifiers&&(f=BYe(t).qualifierPlaced),pe({result:Gt({...ue,...p,connectedStructures:r,qualifierReplaced:h,qualifierPlaced:f}),stack:n})}var L_={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function vUe(t){var e,i,n,r;let{inContextDrawMatchUps:a,appliedPolicies:s,drawDefinition:o,matchUpsMap:l,targetData:u,matchUp:c}=t,{matchUpId:d}=c,{iteration:p=0}=t;p+=1;let h="removeDoubleExit";ou({color:"brightyellow",method:h,matchUpId:d,iteration:p,keyColors:L_});let{targetMatchUps:{loserMatchUp:f,winnerMatchUp:m,loserTargetDrawPosition:g},targetLinks:{loserTargetLink:v}}=u;if(m&&m.matchUpStatus!==fn){let{stage:I,roundNumber:S,roundPosition:w,structureName:T}=m;ou({winner:"winner",roundPosition:w,structureName:T,roundNumber:S,keyColors:L_,stage:I}),aee({...t,targetMatchUp:m,sourceMatchUp:c,iteration:p})}let y=f?.matchUpStatus===fn&&(f?.feedRound||f?.roundNumber===1),b=((i=(e=u?.targetLinks)==null?void 0:e.loserTargetLink)==null?void 0:i.linkCondition)===qp;if(y&&b){let I=a.filter(({roundNumber:T,structureId:U})=>U===c.structureId&&T===1),S=I.map(({roundPosition:T})=>T),w=ka(S.sort(),2).find(T=>T.includes(c.roundPosition));if(((n=I.filter(({roundPosition:T})=>w.includes(T)))==null?void 0:n.map(({matchUpStatus:T})=>T)).every(T=>[oa,jr].includes(T)))return pe({result:{...ue},stack:h})}if(f&&(f.matchUpStatus!==fn||y)){let I=a.find(({matchUpId:P})=>P===f.matchUpId),{structure:S}=ui({drawDefinition:o,structureId:I.structureId}),{stage:w,roundNumber:T,roundPosition:U,feedRound:C,structureName:E}=f;if(ou({loser:"loser",roundPosition:U,structureName:E,roundNumber:T,keyColors:L_,feedRound:C,stage:w}),((r=s?.progression)==null?void 0:r.doubleExitPropagateBye)||y)oz({drawPosition:g,targetLink:v,inContextDrawMatchUps:a,drawDefinition:o,matchUpsMap:l});else{let P=aee({...t,targetMatchUp:f,structure:S,iteration:p});if(P.error)return pe({result:P,stack:h})}}return pe({result:{...ue},stack:h})}function aee(t){var e,i,n,r,a,s;let{inContextDrawMatchUps:o,appliedPolicies:l,drawDefinition:u,sourceMatchUp:c,targetMatchUp:d,matchUpsMap:p,structure:h,iteration:f}=t,m="conditionallyRemoveDrawPosition";ou({method:m,structureName:h?.structureName,iteration:f});let g=Io({matchUpId:d.matchUpId,inContextDrawMatchUps:o,drawDefinition:u}),{targetMatchUps:{winnerMatchUp:v}}=g,y=p?.drawMatchUps.find(E=>E.matchUpId===d.matchUpId),b=[],I,S,w;if(d.feedRound)w=(i=(e=v?.drawPositions)==null?void 0:e.filter(Boolean))==null?void 0:i.find(E=>d.drawPositions.includes(E));else if(!c)w=(n=Pr(d?.drawPositions||[],v?.drawPositions||[]))==null?void 0:n[0];else if(S=(r=Awe({structureId:h.structureId,matchUp:c,matchUpsMap:p}))==null?void 0:r.pairedPreviousMatchUp,I=[jr,oa].includes(S?.matchUpStatus),b=((a=S?.drawPositions)==null?void 0:a.filter(Boolean))||[],[...wa,fn].includes(S?.matchUpStatus)||S?.winningSide){let E=c.drawPositions||[],P=(s=d.drawPositions)==null?void 0:s.filter(Boolean);yo(E,P)&&(P=P?.filter(M=>!E.includes(M))),w=E.concat(b).find(M=>P?.includes(M))}if(v&&w){let{stage:E,roundNumber:P,roundPosition:M,structureName:R}=v;ou({method:"removeDirectedWinner",drawPositionToRemove:w,color:"brightgreen",roundPosition:M,structureName:R,roundNumber:P,keyColors:L_,stage:E}),fUe({winningDrawPosition:w,winnerMatchUp:v,inContextDrawMatchUps:o,drawDefinition:u,matchUpsMap:p})}let T=vUe({targetData:g,matchUp:d,inContextDrawMatchUps:o,appliedPolicies:l,drawDefinition:u,matchUpsMap:p,structure:h,iteration:f});if(T.error)return pe({result:T,stack:m});let U=jYe({pairedPreviousDoubleExit:I,noContextTargetMatchUp:y}),C=!I;return T=Np({...t,matchUpId:d.matchUpId,matchUp:y,removeWinningSide:!0,matchUpStatusCodes:[],matchUpStatus:U,removeScore:C,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),T.error?pe({result:T,stack:m}):{...ue}}function jYe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===fn?fn:t?[oa,Wi].includes(e?.matchUpStatus)?Wi:ln:Or}function GYe(t){var e,i,n,r,a;let s,{inContextDrawMatchUps:o,inContextMatchUp:l,drawDefinition:u}=t,c=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(c.target.feedProfile===Pd){let d=(n=(i=l.sides)==null?void 0:i.find(({sideNumber:h})=>h===l.winningSide))==null?void 0:n.participantId,p=o.find(h=>{var f;return h.structureId===c.target.structureId&&h.roundNumber===c.target.roundNumber&&((f=h.sides)==null?void 0:f.some(({participantId:m})=>m===d))});if(p&&p.matchUpStatus===Or){let h=Io({matchUpId:p.matchUpId,inContextDrawMatchUps:o,drawDefinition:u});if(!mb({inContextDrawMatchUps:o,drawDefinition:u,targetData:h})){let{structure:f}=ui({structureId:p.structureId,drawDefinition:u}),m=Fn({structure:f}).positionAssignments;for(let g of m||[])if(g.participantId===d){if(g.participantId=void 0,f?.positionAssignments)f.positionAssignments=m;else if(f!=null&&f.structures){let v=Object.assign({},...(m||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of f?.structures||[])(r=y.positionAssignments)==null||r.forEach(b=>b.participantId=v[b.drawPosition])}ov({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:u,structure:f}),s=!0}}}}return{qualifierRemoved:s}}function HYe(t){var e;let{matchUp:i,matchUpStatus:n,score:r,winningSide:a}=t,s="noDownStreamDependencies";if([jr,oa].includes(i?.matchUpStatus)&&![jr,oa].includes(n)){let g=vUe(t);if(g.error)return pe({result:g,stack:s})}let o=n===jr,l=Sa({score:r})&&!o&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!a),u=((e=t?.inContextMatchUp)==null?void 0:e.collectionId)&&_Ye(t.inContextMatchUp),c=t.removeScore||!u&&![$l,ul].includes(n||$l),d=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||i.winningSide&&!a&&!Sa({score:r}),p=n&&n!==Or,h=g=>{var v,y;let b,{structure:I,drawDefinition:S,dualMatchUp:w,disableAutoCalc:T}=t;if(w!=null&&w._disableAutoCalc&&T!==!1)return l9({...t,removeWinningSide:d});let{connectedStructureIds:U}=gUe({drawDefinition:S,structure:I,matchUp:i});U.length&&(console.log({connectedStructureIds:U}),b=!0),Object.assign(t,{removeScore:g});let C=iE(t);if(C.error)return C;if(t.removingQualifier&&(y=(v=t.appliedPolicies)==null?void 0:v[KC])!=null&&y.autoRemoveQualifiers){let E=GYe(t);return{...ue,connectedStructures:b,...E}}return{...ue,connectedStructures:b}};if(d&&a&&t.isCollectionMatchUp)return see(t);let f=[oh,ul].includes(n)&&t.dualWinningSideChange,m=(a||f)&&VYe(t)||l&&h(c)||p&&xYe(t)||d&&h(c)||i&&see({...t,removeScore:!0})||{...ue};return pe({result:m,stack:s})}function see(t){var e;let i="ndd:scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide&&!t.autoCalcDisabled){let r=iE(t);if(r.error)return r}let n=Np({...t});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:a,event:s,matchUpsMap:o}=t,{removeWinningSide:l}=eg({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:a,matchUpsMap:o,event:s});l&&console.log("REMOVE WINNING SIDE")}return pe({result:n,stack:i})}function NY(t){var e,i,n;let r=Yt(t,[{[Ta]:!0,[Po]:!0,[ah]:!0},{homeParticipantId:!0,[Zc]:da}]);if(r.error)return r;let a=XD(t,[{[OD]:yf,attr:{[C$]:!0}}]);if(a.error)return a;let s=(n=(i=(e=a?.matchUp)==null?void 0:e.matchUp)==null?void 0:i.sides)==null?void 0:n.map(h=>h?.participantId);if(t.homeParticipantId&&!(s!=null&&s.includes(t.homeParticipantId)))return{error:Hd};let{disableNotice:o,homeParticipantId:l,removePriorValues:u,tournamentRecord:c,drawDefinition:d,matchUpId:p}=t;return Vl({duplicateValues:!1,removePriorValues:u,tournamentRecord:c,drawDefinition:d,disableNotice:o,matchUpId:p,timeItem:{itemType:S8,itemValue:l}})}function yUe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Wb({timeItems:i?.timeItems||[],itemType:q$});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{timeModifiers:n}:e}function Bv(t){var e;let i="addMatchUpScheduledTime",n=t.matchUp,{removePriorValues:r,tournamentRecord:a,drawDefinition:s,disableNotice:o,scheduledTime:l,matchUpId:u}=t;if(!u)return pe({result:{error:to},stack:i});if(!kD(l))return pe({result:{error:Ec},stack:i});if(!n){let f=tr({drawDefinition:s,matchUpId:u});if(f.error)return pe({result:f,stack:i});n=f.matchUp}let c=Ci(l),d=B0({matchUp:n}).scheduledDate,p=c&&!d;if((e=yUe({matchUp:n}).timeModifiers||[])!=null&&e.length){let f=bUe({disableNotice:!0,removePriorValues:r,tournamentRecord:a,timeModifiers:[],drawDefinition:s,matchUpId:u,matchUp:n});if(f!=null&&f.error)return pe({result:f,stack:i})}let h=N0(l,!0,p);return Vl({duplicateValues:!1,removePriorValues:r,tournamentRecord:a,drawDefinition:s,disableNotice:o,matchUpId:u,timeItem:{itemType:F0,itemValue:h}})}function bUe({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,timeModifiers:r,matchUpId:a,matchUp:s}){let o="addMatchUpTimeModifiers";if(!a)return pe({result:{error:to},stack:o});if(r!==void 0&&!Array.isArray(r))return pe({info:hb("timeModifiers"),result:{error:Ce},stack:o});if(!s){let d=tr({drawDefinition:i,matchUpId:a});if(d.error)return pe({result:d,stack:o});s=d.matchUp}let l=yUe({matchUp:s}).timeModifiers||[],u=r.filter(d=>!l.includes(d));if(r.length&&!u.length)return{...ue};if(u.some(d=>kH.includes(d))){l=l.filter(p=>!kH.includes(p));let d=Bv({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return pe({result:d,stack:o})}let c=r!=null&&r.length?[...u,...l]:void 0;return Vl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:q$,itemValue:c}})}function WB({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a}){if(!a)return{error:to};let s=t&&Hp.test(t);if(t&&!s)return{error:za};let o={itemValue:Ci(t),itemType:L0};return Vl({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:o})}function YB({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:s,courtIds:o}){var l,u;if(!i&&!e)return{error:lt};if(!s)return{error:to};let c=tr({drawDefinition:n,matchUpId:s});if(c.error)return c;if(((l=c?.matchUp)==null?void 0:l.matchUpType)!==hu)return{error:ll};if(!(o===void 0||Array.isArray(o)&&o.length&&o.every(p=>typeof p=="string")))return{error:Ce,context:{courtIds:o}};let d;if(o){let p=e||i&&{[i.tournamentId]:i},h=tg({tournamentRecords:p});if(h.error)return h;let f=(u=h.courts)==null?void 0:u.filter(m=>o.includes(m.courtId));if(f?.length!==o.length)return{error:Ce,context:{courtIds:o}};d=f?.map(m=>({venueId:m.venueId,courtId:m.courtId}))}return Vl({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:s,timeItem:{itemType:cf,itemDate:a,itemValue:d}})}function nE({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,venueId:s}){if(!i)return{error:lt};if(!a)return{error:to};if(s){let o=bf({tournamentRecords:e,tournamentRecord:i,venueId:s});if(o.error)return o}return Vl({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:O0,itemValue:s}})}function X0({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:s,courtId:o}){var l;if(!i&&!e)return{error:lt};if(!s)return{error:to};if(o){let u=V0({tournamentRecords:e,tournamentRecord:i,courtId:o});if(u.error)return u;let c=(l=u.venue)==null?void 0:l.venueId;nE({tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:s,venueId:c})}return Vl({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:s,timeItem:{itemType:lv,itemDate:a,itemValue:o}})}function Sp(t,e){let i=nbe.test(t)?t:er(t),n=Ci(t)||Ci(e)||Yc(new Date);return new Date(`${n}T${i}`).getTime()}function KB(t){var e;let i="addMatchUpScheduleItems",n=Yt(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[Ho]:el}],i);if(n.error)return n;let{matchUpDependencies:r,inContextMatchUps:a}=t,{errorOnAnachronism:s=!1,checkChronology:o=!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,disableNotice:p,drawMatchUps:h,matchUpId:f,schedule:m,event:g}=t,v,y;if(h)v=h.find(_=>_.matchUpId===f);else{let _=tr({drawDefinition:d,event:g,matchUpId:f});if(_.error)return _;v=_.matchUp}let{endTime:b,courtId:I,courtIds:S,courtOrder:w,resumeTime:T,homeParticipantId:U,scheduledDate:C,scheduledTime:E,startTime:P,stopTime:M,timeModifiers:R,venueId:N}=m;o&&(!r||!a)&&({matchUpDependencies:r,matchUps:a}=bd({drawDefinition:d}));let A=(e=r?.[f])==null?void 0:e.matchUpIds;if(m.scheduledDate&&o&&A){let _=a?.filter(x=>{var O,$;return(((O=x.schedule)==null?void 0:O.scheduledDate)||Ci(($=x.schedule)==null?void 0:$.scheduledTime))&&A.includes(x.matchUpId)}).map(({schedule:x})=>{let O=sx(x);return new Date(O).getTime()});if(_!=null&&_.length){let x=sx(m),O=new Date(x).getTime();if(Math.max(..._)>=O){if(s)return pe({result:{error:mH},stack:i});y=mH}}}if(C!==void 0){let _=WB({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledDate:C,matchUpId:f});if(_!=null&&_.error)return pe({result:_,stack:i,context:{scheduledDate:C}})}if(E!==void 0){let _=Bv({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,scheduledTime:E,matchUpId:f,matchUp:v});if(_!=null&&_.error)return pe({result:_,stack:i,context:{scheduledTime:E}})}if(P!==void 0){let _=_Y({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:f,startTime:P,event:g});if(_!=null&&_.error)return pe({result:_,stack:i,context:{startTime:P}})}if(M!==void 0){let _=xY({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:f,stopTime:M,event:g});if(_!=null&&_.error)return pe({result:_,stack:i,context:{stopTime:M}})}if(T!==void 0){let _=OY({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,resumeTime:T,matchUpId:f,event:g});if(_!=null&&_.error)return pe({result:_,stack:i,context:{resumeTime:T}})}if(b!==void 0){let _=kY({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:f,endTime:b,event:g});if(_!=null&&_.error)return pe({result:_,stack:i,context:{endTime:b}})}if(S!==void 0){let _=YB({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:f,courtIds:S});if(_!=null&&_.error)return pe({result:_,stack:i,context:{courtIds:S}})}if(I!==void 0&&C!==void 0){let _=X0({courtDayDate:C,disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:f,courtId:I});if(_!=null&&_.error)return pe({result:_,stack:i,context:{courtId:I}})}if(N!==void 0){let _=nE({disableNotice:!0,removePriorValues:l,tournamentRecords:u,tournamentRecord:c,drawDefinition:d,matchUpId:f,venueId:N});if(_!=null&&_.error)return pe({result:_,stack:i,context:{venueId:N}})}if(w!==void 0&&bi(w)){let _=AY({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,courtOrder:w,matchUpId:f});if(_!=null&&_.error)return pe({result:_,stack:i,context:{courtOrder:w}})}if(R!==void 0){let _=bUe({disableNotice:!0,removePriorValues:l,tournamentRecord:c,drawDefinition:d,timeModifiers:R,matchUpId:f,matchUp:v});if(_!=null&&_.error)return pe({result:_,stack:i,context:{timeModifiers:R}})}return nr(U)&&NY({disableNotice:!0,homeParticipantId:U,removePriorValues:l,tournamentRecord:c,drawDefinition:d,matchUpId:f}),p||Xi({tournamentId:c?.tournamentId,eventId:g?.eventId,context:i,drawDefinition:d,matchUp:v}),y?{...ue,warnings:[y]}:{...ue}}function AY({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,courtOrder:r,matchUpId:a}){if(!a)return{error:to};if(r&&!bi(r))return{error:Ce,info:"courtOrder must be numeric"};let s=r&&ai(r);return Vl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:z$,itemValue:s}})}function IUe({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,participantId:r,officialType:a,matchUpId:s}){if(!s)return{error:to};if(!r)return{error:da};if(e){let l=hr({tournamentRecord:e,participantFilters:{participantTypes:[Hi],participantRoles:[_8]}}).participants??[];if(!nv({tournamentParticipants:l,participantId:r}))return{error:Ar}}let o={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:r};return a&&(o.itemSubTypes=[a]),Vl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:s,timeItem:o})}function _Y({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,startTime:a,event:s}){if(!r)return{error:to};if(!kD(a))return{error:Ec};let{matchUp:o}=tr({drawDefinition:i,event:s,matchUpId:r}),{scheduledDate:l}=B0({matchUp:o}),u=(o?.timeItems??[]).filter(c=>[am,Fh,Am].includes(c?.itemType)).map(c=>Sp(c.itemValue,l)).reduce((c,d)=>!c||d<c?d:c,void 0);if(!u||Sp(a,l)<u){o!=null&&o.timeItems&&(o.timeItems=o.timeItems.filter(d=>d.itemType!==Cd));let c=N0(a,!0,!0);return Vl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemType:Cd,itemValue:c}})}else return{error:Cye}}function kY({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,endTime:s,event:o}){if(!a)return{error:to};if(!kD(s))return{error:Ec};let{matchUp:l}=tr({drawDefinition:n,event:o,matchUpId:a}),{scheduledDate:u}=B0({matchUp:l}),c=(l?.timeItems??[]).filter(d=>[Cd,Fh,am].includes(d?.itemType)).map(d=>Sp(d.itemValue,u)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!c||Sp(s,u)>c){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Am));let d=N0(s,!0,!0);return Vl({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:Am,itemValue:d}})}else return{error:Eye}}function xY({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,stopTime:a,event:s}){if(!r)return{error:to};if(!kD(a))return{error:Ec};let{matchUp:o}=tr({drawDefinition:i,event:s,matchUpId:r}),{scheduledDate:l}=B0({matchUp:o}),u=o?.timeItems??[];if(u.reduce((f,m)=>m.itemType===Am||f,void 0))return{error:d7};let c=u.filter(f=>[Cd,Fh,am].includes(f?.itemType)).sort((f,m)=>Sp(f.itemValue,l)-Sp(m.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===am,h=c.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>Sp(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(Sp(a,l)>h){if(o!=null&&o.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:N0(a,!0,!0),itemType:am};return Vl({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:f})}else return{error:Pye}}function OY({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,resumeTime:r,matchUpId:a,event:s}){if(!a)return{error:to};if(!kD(r))return{error:Ec};let{matchUp:o}=tr({drawDefinition:i,event:s,matchUpId:a}),{scheduledDate:l}=B0({matchUp:o}),u=o?.timeItems??[];if(u.reduce((f,m)=>m.itemType===Am||f,void 0))return{error:d7};let c=u.filter(f=>[Cd,Fh,am].includes(f?.itemType)).sort((f,m)=>Sp(f.itemValue,l)-Sp(m.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===Fh,h=c.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>Sp(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(Sp(r,l)>h){if(o!=null&&o.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:N0(r,!0,!0),itemType:Fh};return Vl({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:f})}else return{error:Jqe}}function zYe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:n,dualMatchUp:r,tieFormat:a,structure:s,matchUp:o,event:l,score:u}){var c;let d=At(r,void 0,!0);for(let h of d?.tieMatchUps||[])h.matchUpId===o.matchUpId&&(h.winningSide=n,h.score=u,!Sa({score:u})&&!e?Object.assign(h,{...oB}):e&&(h.matchUpStatus=e));a=a??((c=Xs({matchUp:o,structure:s,drawDefinition:t,event:l}))==null?void 0:c.tieFormat);let{winningSide:p}=oN({matchUp:d,drawDefinition:t,matchUpsMap:i,structure:s,tieFormat:a,event:l});return{projectedWinningSide:p}}function qYe(t){var e;let{tournamentRecord:i,inContextMatchUp:n,structure:r,drawDefinition:a}=t,s=n.roundNumber,o=n.sides.find(w=>w.sideNumber===n.winningSide),l=n.sides.find(w=>w.sideNumber!==n.winningSide),{drawPosition:u,participantId:c}=o,{drawPosition:d,participantId:p}=l,h="swapWinnerLoser",{matchUps:f}=vn(t),m=f.filter(({drawPositions:w,roundNumber:T})=>w?.includes(u)&&T>s);mu({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:m}),m.forEach(w=>{var T,U;w.drawPositions=((T=w.drawPositions)==null?void 0:T.map(C=>C===u?d:C))||[],Xi({tournamentId:i?.tournamentId,eventId:(U=t.event)==null?void 0:U.eventId,context:h,drawDefinition:a,matchUp:w})});let{stage:g,stageSequence:v}=r,y=a.structures.filter(({stage:w,stageSequence:T})=>w===g&&T>v).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:b,winnerTargetLink:I}}=t.targetData,S=[b?.target.structureId,(e=I?.target)==null?void 0:e.structureId].filter(Boolean);return a.structures.filter(({stage:w,structureId:T})=>w!==g&&S.includes(T)).forEach(({stage:w,stageSequence:T,structureId:U})=>{y.includes(U)||y.push(U),a.structures.filter(({stage:C,stageSequence:E})=>C===w&&E>T).forEach(({structureId:C})=>{y.includes(C)||y.push(C)})}),a.structures.filter(({structureId:w})=>y.includes(w)).forEach(w=>{let{positionAssignments:T}=Fn({structure:w}),U=T?.find(({participantId:E})=>E===c),C=T?.find(({participantId:E})=>E===p);U&&(U.participantId=p),C&&(C.participantId=c)}),Np({...t})}function SN(t){var e,i,n;let r="setMatchUpStatus";t.matchUpStatus&&[ln,jr].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:a,disableScoreValidation:s,tournamentRecords:o,tournamentRecord:l,disableAutoCalc:u,enableAutoCalc:c,drawDefinition:d,matchUpStatus:p,winningSide:h,matchUpId:f,event:m,score:g}=t;if(!d)return{error:Lt};if(p&&[oh,$l,ul,Or].includes(p)&&h)return{error:Ce,winningSide:h,matchUpStatus:p};if(![void 0,...bIe].includes(p))return pe({result:{error:RD},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let v=Cs({drawDefinition:d}),{matchUps:y}=pa({nextMatchUps:!0,tournamentRecord:l,inContext:!0,drawDefinition:d,matchUpsMap:v,event:m}),b=v.drawMatchUps.find(W=>W.matchUpId===f),I=y?.find(W=>W.matchUpId===f);if(!b||!y)return{error:Gs};if((b.winningSide||h)&&p===fn)return{context:"Cannot have Bye with winningSide",error:T_,matchUpStatus:p};let S=I?.structureId,{structure:w}=ui({drawDefinition:d,structureId:S}),T=xr(zn)(b.matchUpType),U=(e=I?.drawPositions)==null?void 0:e.filter(Boolean),C=I?.matchUpTieId,E=Io({matchUpId:C||f,inContextDrawMatchUps:y,drawDefinition:d});Object.assign(t,{inContextDrawMatchUps:y,inContextMatchUp:I,matchUpTieId:C,matchUpsMap:v,targetData:E,structure:w,matchUp:b});let P=mb(t),M;if(T){if(u)dn({extension:{name:Ew,value:!0},element:b});else if(c){let W=b.winningSide,{winningSide:q,scoreStringSide1:Z,scoreStringSide2:K,set:Q}=oN({drawDefinition:d,matchUpsMap:v,structure:w,matchUp:b,event:m}),J={scoreStringSide1:Z,scoreStringSide2:K,sets:Q?[Q]:[]};if(M=q!==W,P&&M)return pe({stack:"winningSideWithDownstreamDependencies",result:{error:l$},context:{winningSide:h,matchUp:b}});po({name:Ew,element:b}),Object.assign(t,{winningSide:q,dualWinningSideChange:M,projectedWinningSide:q,score:J})}lN({tournamentId:l?.tournamentId,inContextDualMatchUp:I,eventId:m?.eventId,dualMatchUp:b,drawDefinition:d})}if(T&&p&&[_0].includes(p))return{info:"Not supported for matchUpType: TEAM",error:Ce};if(g&&!T&&!s){let W=b.matchUpFormat??w?.matchUpFormat??d?.matchUpFormat??m?.matchUpFormat,q=A9({existingMatchUpStatus:b.matchUpStatus,matchUpFormat:W,matchUpStatus:p,winningSide:h,score:g});if(q.error)return q}let R=((i=pn({policyTypes:[KC,Qu],tournamentRecord:l,drawDefinition:d,event:m}))==null?void 0:i.appliedPolicies)??{};Qi(t.policyDefinitions)&&Object.assign(R,t.policyDefinitions);let N=YYe({assignedDrawPositions:U,inContextMatchUp:I,appliedPolicies:R,drawDefinition:d,matchUpStatus:p,structure:w,matchUp:b});if(N!=null&&N.error)return N;let A=I?.stage===Kt&&I.finishingRound===1,_=A&&h,x=A&&b.winningSide&&!h&&(!t.matchUpStatus||t.matchUpStatus&&FH({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!Sa({outcome:t.outcome})),O=_&&h!==b.winningSide&&b.winningSide;if(Object.assign(t,{qualifierAdvancing:_,qualifierChanging:O,removingQualifier:x,appliedPolicies:R}),C){let{matchUp:W}=tr({matchUpId:C,inContext:!0,drawDefinition:d,matchUpsMap:v,event:m});if(W){let q=(n=Xs({matchUp:W,drawDefinition:d,structure:w,event:m}))==null?void 0:n.tieFormat,{projectedWinningSide:Z}=zYe({drawDefinition:d,matchUpStatus:p,dualMatchUp:W,matchUpsMap:v,winningSide:h,tieFormat:q,structure:w,matchUp:b,event:m,score:g}),K=W.winningSide;M=Z!==K;let Q=W._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:M,projectedWinningSide:Z,autoCalcDisabled:Q,matchUpTieId:C,dualMatchUp:W,tieFormat:q})}}let $=qM({matchUpStatus:p});if(!C){if(P&&!h&&(p&&FH({matchUpStatus:p})||p&&[jr,oa].includes(p)))return{error:T_,activeDownstream:P,winningSide:h};if(h&&h===b.winningSide&&p&&!$)return{context:"winningSide must include directing matchUpStatus",error:T_,directingMatchUpStatus:$,matchUpStatus:p}}let{schedule:F}=t;if(F){let W=KB({disableNotice:!0,tournamentRecords:o,tournamentRecord:l,drawDefinition:d,matchUpId:f,schedule:F});if(W.error)return W}let j=!T&&!M&&h&&b.winningSide&&b.winningSide!==h;if(a&&j&&b.roundPosition)return qYe(t);let H=h&&!C||t.projectedWinningSide;ou({activeDownstream:P,matchUpWinner:H,method:r,winningSide:h});let G=!P&&HYe(t)||H&&WYe(t)||($||t.autoCalcDisabled)&&wUe(t)||{error:Oye};return pe({result:G,stack:r})}function WYe(t){let{matchUp:e,winningSide:i,matchUpTieId:n,dualWinningSideChange:r}=t;return i===e.winningSide||n&&!r?wUe(t):pe({stack:"winningSideWithDownstreamDependencies",result:{error:l$},context:{winningSide:i,matchUp:e}})}function wUe(t){let{tournamentRecord:e,matchUp:i,event:n}=t,r=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!Sa({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||r&&Or||t.winningSide&&kr||$l:t.matchUpStatus||kr,s=t.removeScore||[oh,ln].includes(a)&&![$l,ul].includes(a),o=Np({...t,matchUpStatus:a,removeWinningSide:r,removeScore:s});if(o.error)return o;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:u,matchUpsMap:c}=t,d=eg({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:u,matchUpsMap:c,event:n});if(d.error)return d;Object.assign(o,{tieMatchUpResult:d})}return o}function YYe({assignedDrawPositions:t,inContextMatchUp:e,appliedPolicies:i,drawDefinition:n,matchUpStatus:r,structure:a,matchUp:s}){var o,l;if(((o=i?.[Qu])==null?void 0:o.requireParticipantsForScoring)===!1)return{...ue};let u=(l=e?.sides)==null?void 0:l.map(p=>p.participantId).filter(Boolean).length,c=s!=null&&s.sides?[]:Fn({structureId:a?.structureId,drawDefinition:n}).positionAssignments,d=u&&u===2||s.collectionId&&Vo({structure:a})&&u&&u>=1||t?.length===2&&c?.filter(p=>t.includes(p.drawPosition)).every(p=>p.participantId);return r&&yIe.includes(r)&&!d?pe({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:r,requiredParticipants:d},result:{error:RD}}):{...ue}}function SUe({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n}){if(!e)return{error:Lt};let{matchUp:r}=tr({drawDefinition:e,matchUpId:i,event:n});return r?.matchUpType!==hu?{error:ll}:SN({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n})}function TUe({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:Lt};if(!i)return{error:to};let{matchUp:n}=tr({drawDefinition:t,event:e,matchUpId:i});return n?po({name:k$,element:n}):{error:Gs}}function KYe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:n,sideNumber:r,matchUpId:a,event:s}){var o,l,u,c,d;let p="substituteParticipant";if(!n)return{error:Lt};if(!a)return{error:to};if(!e||!t)return pe({result:{error:da},stack:p});let{matchUp:h}=tr({drawDefinition:n,matchUpId:a,event:s});if(!h)return{error:Gs};if(!h.collectionId)return pe({result:{error:ll},stack:p});let f=Cs({drawDefinition:n}),{matchUps:m}=pa({tournamentParticipants:i?.participants,inContext:!0,drawDefinition:n,matchUpsMap:f}),g=m?.find(y=>y.matchUpId===a),v=(l=(o=m?.find(y=>y.matchUpId===g?.matchUpTieId))==null?void 0:o.sides)==null?void 0:l.find(y=>y.participant.individualParticipants.some(({participantId:b})=>b===e));return!v||r&&v.sideNumber!==r?{error:Hd}:(d=(c=(u=v.participant)==null?void 0:u.individualParticipants)==null?void 0:c.map(Gi).filter(y=>y!==e))!=null&&d.includes(t)?RY({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:n,event:s}):pe({result:{error:Hd},stack:p})}function UUe(t){return KYe(t)}function DUe({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:Lt};let{matchUp:n}=tr({drawDefinition:t,matchUpId:e,event:i});return dn({extension:{name:Ew,value:!0},element:n})}function EUe(t){let e="setMatchUpFormat",i=Yt(t,[{tournamentRecord:!0},{[vs]:S=>Ll({matchUpFormat:S}),[vu]:vM,matchUpFormat:!0}]);if(i.error)return pe({result:i,stack:e});let{tournamentRecord:n,drawDefinition:r,scheduledDates:a,stageSequences:s,matchUpFormat:o,structureId:l,eventType:u,matchUpId:c,eventId:d,stages:p,drawId:h,event:f,force:m}=t;if(a&&!Array.isArray(a))return pe({result:{error:Ce,scheduledDates:a},stack:e});if(u&&!t$([zp,Ju],u))return pe({result:{error:rf},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],b=t.drawIds||h&&[h].filter(Boolean)||[];if((l||v!=null&&v.length)&&!r)return pe({result:{error:Lt},stack:e});if(h&&c&&r){let S=O9({tournamentRecord:n,drawDefinition:r,matchUpFormat:o,structureIds:v,structureId:l,matchUpId:c});if(S.error)return S;g+=1}let I=S=>{let w=[];for(let T of S.structures||[]){if(Array.isArray(p)&&!p.includes(T.stage)||Array.isArray(s)&&!s.includes(T.stageSequence)||v!=null&&v.length&&!v.includes(T.structureId))continue;v!=null&&v.length&&T.matchUpFormat!==o&&(T.matchUpFormat=o,w.push(T.structureId),g+=1);let U=((m||a)&&vn({matchUpFilters:{matchUpStatuses:[Or]},structure:T}).matchUps)??[],C=(a&&vn({matchUpFilters:{matchUpStatuses:[Or]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:T}).matchUps)??[];if(U!=null&&U.length){let E=C?C.map(Na):U.map(Na);for(let P of U)E.includes(P.matchUpId)&&(P.matchUpFormat=a!=null&&a.length?o:void 0,Xi({tournamentId:n?.tournamentId,eventId:f?.eventId,context:e,drawDefinition:S,matchUp:P}))}}return!w.length&&S.matchUpFormat!==o&&(S.matchUpFormat=o,g+=1),w};for(let S of n?.events||[])if(!(y!=null&&y.length&&!y.includes(S.eventId)||u&&u!==S.eventType||u===aa))if(Array.isArray(s)||Array.isArray(p)||v!=null&&v.length||b!=null&&b.length)for(let w of S.drawDefinitions||[]){if(Array.isArray(b)&&!b.includes(w.drawId))continue;let T=I(w);Bn({structureIds:T,drawDefinition:w})}else S.matchUpFormat!==o&&(S.matchUpFormat=o,g+=1);return g?{...ue,modificationsCount:g}:{...ue,info:_D}}function LY({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}){var a,s;if(!i)return{error:Lt};let o=(a=tr({drawDefinition:i,matchUpId:n}))==null?void 0:a.matchUp;if(!(o!=null&&o.tieMatchUps))return{error:ll};let l=(s=tr({inContext:!0,drawDefinition:i,matchUpId:n,event:r}))==null?void 0:s.matchUp,u=0;return(o?.sides||[]).forEach(c=>{c.lineUp&&delete c.lineUp}),(l?.sides||[]).forEach(c=>{if(u+=1,t===!1){let d=l?.tieFormat,p=c.participantId;d&&p&&q0({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}Xi({tournamentId:e?.tournamentId,context:"resetMatchUpLineUps",eventId:r?.eventId,drawDefinition:i,matchUp:o})}),{...ue,modificationsCount:u}}function PUe(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r,setTBlast:a}=t;if(!r)return{sets:[]};let s=r.sets||[],o=Bh({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),l=Bh({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),u=Bh({matchUpFormat:e,matchUpStatus:i,winningSide:n,setTBlast:a,sets:s}),c=o===u?l:o;return n&&(o=n===1?u:c,l=n===2?u:c),{score:{sets:s,scoreStringSide1:o,scoreStringSide2:l}}}function TN(t){var e,i;let n=Yt(t,[{[ah]:!0,[Po]:!0}]);if(n.error)return n;let r=uc(t);if(!t.drawDefinition){let I=t.tournamentRecord??(t.tournamentId&&r[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=I);let S=jo({eventId:t.eventId,drawId:t.drawId,tournamentRecord:I});if(S.error)return S;S.drawDefinition&&(t.drawDefinition=S.drawDefinition),t.event=S.event}let{disableScoreValidation:a,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpId:d,schedule:p,event:h,notes:f}=t,m=t.matchUpFormat||((e=t.outcome)==null?void 0:e.matchUpFormat),{policy:g}=Hb({policyType:Qu,tournamentRecord:o,event:h}),v=t.allowChangePropagation!==void 0&&t.allowChangePropagation||g?.allowChangePropagation!==void 0&&g.allowChangePropagation||void 0,{outcome:y,setTBlast:b}=t;if(y!=null&&y.winningSide&&![1,2].includes(y.winningSide))return{error:s$};if(m){let I=O9({tournamentRecord:o,drawDefinition:c,matchUpFormat:m,matchUpId:d,event:h});if(I.error)return I}if((i=y?.score)!=null&&i.sets&&!y.score.scoreStringSide1){let{score:I}=PUe({...y,setTBlast:b});y.score=I,y.score.sets=y.score.sets.filter(S=>S.side1Score||S.side2Score||S.side1TiebreakScore||S.side2TiebreakScore)}return SN({matchUpStatusCodes:y?.matchUpStatusCodes,matchUpStatus:y?.matchUpStatus,winningSide:y?.winningSide,allowChangePropagation:v,disableScoreValidation:a,score:y?.score,tournamentRecords:r,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:c,matchUpFormat:m,matchUpId:d,schedule:p,event:h,notes:f})}function CUe(t){if(!(t!=null&&t.outcomes))return{error:Xt};if(!Array.isArray(t.outcomes))return{error:Xt,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],n=i.reduce((r,a)=>r.includes(a.tournamentId)?r:r.concat(a.tournamentId),[]);for(let r of n){let a=e[r];if(!a)return{error:lt};let s=i.filter(o=>o.tournamentId===r);if(s.length){let o=ZYe({outcomes:s,tournamentRecord:a});if(o.error)return o}}return{...ue}}function ZYe(t){var e;let{tournamentRecords:i,tournamentRecord:n,outcomes:r,policyDefinitions:a}=t,s={};r.forEach(o=>{let{eventId:l}=o;s[l]||(s[l]=[]),s[l].push(o)});for(let o of Object.keys(s)){let{event:l}=jo({tournamentRecord:n,eventId:o});for(let u of s[o]){let{drawId:c}=u,d=(e=l?.drawDefinitions)==null?void 0:e.find(p=>p.drawId===c);if(d&&c){let{matchUpFormat:p,matchUpId:h}=u,f=TN({schedule:u?.schedule,tournamentRecords:i,policyDefinitions:a,tournamentRecord:n,drawDefinition:d,matchUpFormat:p,matchUpId:h,outcome:u,drawId:c,event:l});if(f.error)return f}}}return{...ue}}function XYe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:n}){var r,a;if(!n&&!t)return{error:Lt};if(!i)return{error:Xt,info:"missing outcome"};if(!n&&!e)return{error:ol};if(!n){let s=tr({drawDefinition:t,matchUpId:e});if(s.error)return s;n=s.matchUp}return typeof i!="object"||!((r=i.score)!=null&&r.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:Ce}:dn({element:n,extension:{name:k$,value:i}})}function RUe(t){return XYe(t)}function FY(t){var e,i;let n="resetTieFormat",{drawDefinition:r,event:a,uuids:s}=t,o=Yt(t,[{[Ta]:!0,[ah]:!0}],n);if(o.error)return o;let l=XD(t,[{[OD]:yf}]);if(l[Zc])return l;let u=(e=t.tournamentRecord)==null?void 0:e.tournamentId,{matchUp:c,structure:d}=l?.matchUp??{};if(!(c!=null&&c.tieMatchUps))return pe({result:{error:ll},info:"Must be a TEAM matchUp",stack:n});if(!c.tieFormat)return{...ue};let p=(i=Xs({structure:d,drawDefinition:r,event:a}))==null?void 0:i.tieFormat;if(!p)return pe({result:{error:Xa},info:"No inherited tieFormat",stack:n});let h=[],f=[],m=[],g=[];for(let v of p.collectionDefinitions){let{matchUpCount:y,collectionId:b}=v;f.push(b);let I=(c.tieMatchUps||[]).filter(S=>S.collectionId===b);if(I.length>y)I.sort((S,w)=>(S.matchUpStatus===Or?1:0)-(w.matchUpStatus===Or?1:0)),m.push(...I.slice(0,y)),h.push(...I.slice(3).map(Na));else if(m.push(...I),I.length<y){let S=y-I.length,w=aN({collectionDefinition:v,matchUpsLimit:S,matchUp:c,uuids:s});g.push(...w)}}for(let v of c?.tieMatchUps||[])v.collectionId&&!f.includes(v.collectionId)&&h.push(v.matchUpId);return g.length&&(m.push(...g),sv({eventId:a?.eventId,matchUps:g,drawDefinition:r,tournamentId:u})),h.length&&Xm({matchUpIds:h,eventId:a?.eventId,drawDefinition:r,tournamentId:u}),c&&(c.tieMatchUps=m,c.tieFormatId=void 0,c.tieFormat=void 0,Xi({structureId:d?.structureId,eventId:a?.eventId,context:n,drawDefinition:r,tournamentId:u,matchUp:c})),{...ue,newMatchUps:g,deletedMatchUpIds:h}}function $Y(t){var e,i,n;let{tournamentRecord:r,drawDefinition:a,matchUpId:s,event:o}=t,l="resetScorecard";if(!a)return pe({result:{error:Lt},stack:l});if(!s)return pe({result:{error:to},stack:l});if(!nr(s))return pe({result:{error:Ce,matchUpId:s},stack:l});let u=Cs({drawDefinition:a}),{matchUps:c}=pa({nextMatchUps:!0,inContext:!0,drawDefinition:a,matchUpsMap:u}),d=u.drawMatchUps.find(y=>y.matchUpId===s),p=c?.find(y=>y.matchUpId===s);if(!d||!c)return{error:Gs};if(d.matchUpType!==Fl)return{error:ll};let h=Io({inContextDrawMatchUps:c,drawDefinition:a,matchUpId:s}),f=p?.structureId,{structure:m}=ui({drawDefinition:a,structureId:f});if(Object.assign(t,{inContextDrawMatchUps:c,inContextMatchUp:p,matchUpsMap:u,targetData:h,structure:m,matchUp:d}),mb(t))return{error:l$};if((e=d.tieMatchUps)!=null&&e.length)for(let y of d.tieMatchUps){let b=SN({matchUpId:y.matchUpId,matchUpTieId:s,winningSide:void 0,removeScore:!0,tournamentRecord:r,drawDefinition:a,event:o});if(b.error)return pe({result:b,stack:l})}let g=(i=pn({tournamentRecord:r,drawDefinition:a,event:o}))==null?void 0:i.appliedPolicies,v=eg({event:t.event,removeScore:!0,tournamentRecord:r,appliedPolicies:g,drawDefinition:a,matchUpsMap:u,matchUpId:s});if(v.error)return pe({result:v,stack:l});if(t.tiebreakReset&&!v.tieFormatRemoved){let y=(n=Xs({drawDefinition:a,structure:m,event:o}))==null?void 0:n.tieFormat;if(d.tieFormat&&y){let{matchUpCountDifference:b,descendantDifferences:I,ancestorDifferences:S,valueDifference:w}=_m({descendant:d.tieFormat,ancestor:y});if(I.collectionIds.length===1&&!S.collectionIds.length&&!S.groupsCount&&b===1&&w===1){let T=FY({tournamentRecord:r,drawDefinition:a,matchUpId:s,event:o});if(T.error)return T}}}return{...ue}}function MUe(t){let e=Yt(t,[{[Po]:!0,[Av]:!0},{[dU]:{[PM]:!1,roundNumbers:!1},[rIe]:"At least one must be provided",[Ho]:Os}]);if(e.error)return e;let i=_0e(t);if(i.error)return i;let{matchUpIds:n}=i,r=xr(Fl)(t.event.eventType),{tournamentRecord:a,drawDefinition:s,event:o}=t;for(let l of n){if(r){let c=$Y({tiebreakReset:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(c.error||t.removeAssignments&&LY({inheritance:!1,drawDefinition:s,matchUpId:l}).error)return c}let u=SN({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(u.error)return u;if(t.removeAssignments){let c=MY({...t,matchUpId:l});if(c.error)return c}}return{...ue}}function JYe({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){var n;if(!e)return{error:Lt};let r="setOrderOfFinish";if(!Array.isArray(i))return pe({info:hb("finishingOrder"),result:{error:Ce},stack:r});let{completedMatchUps:a,matchUpsMap:s}=GD({inContext:!0,drawDefinition:e}),o=a?.map(Na)??[],l=i.map(Na),{matchUpTypes:u,roundNumbers:c,structureIds:d,matchUpTieIds:p}=(a??[]).filter(({matchUpId:b})=>l.includes(b)).reduce((b,I)=>{let{matchUpTieId:S,matchUpType:w,roundNumber:T,structureId:U}=I;return b.matchUpTypes.includes(w)||b.matchUpTypes.push(w),b.roundNumbers.includes(T)||b.roundNumbers.push(T),b.structureIds.includes(U)||b.structureIds.push(U),b.matchUpTieIds.includes(S)||b.matchUpTieIds.push(S),b},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(u.length>1||p.length>1||c.length>1||d.length>1)return pe({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:Ce},stack:r});let h,f,m={},g=[],v=[];if(!i.every(({orderOfFinish:b,matchUpId:I})=>(g.push(I),b&&v.push(b),m[I]=b,h=o.includes(I),f=b===void 0||bi(b)&&Math.floor(b)>0,h&&f)))return pe({result:{error:h?Ce:RD},info:!h&&"matchUps must be completed"||!f&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:r});let y=a?.filter(b=>b.structureId===d[0]&&b.roundNumber===c[0]&&b.matchUpType===u[0]&&b.matchUpTieId===p[0]&&!g.includes(b.matchUpId));for(let b of y??[]){let{orderOfFinish:I}=b||{};if(I){if(!bi(I))return pe({context:{orderOfFinish:I,matchUp:b},result:{error:Ce},stack:r});v.push(I)}}if(Eve(v).length!==v.length||Math.max(...v)>v.length)return pe({info:"Values not unique or greater than expected number of values",result:{error:Ce},stack:r});if(d.length){let b=X$({matchUpFilters:{matchUpIds:l},structureId:d[0],drawDefinition:e,matchUpsMap:s});if(b.error)return pe({result:b,stack:r});(n=b.completedMatchUps)==null||n.forEach(I=>{I.orderOfFinish=m[I.matchUpId],Xi({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:I})})}return{...ue}}function NUe(t){return JYe(t)}function AUe(t){var e,i,n,r;let{tournamentRecord:a,drawDefinition:s,matchUpId:o,lineUps:l,event:u}=t,c="applyLineUps",d=Yt(t,[{[Ta]:!0,[Po]:!0,[ah]:!0},{lineUps:!0,[Ho]:Os}],c);if(d.error)return d;let p=a.participants||[],h=tr({tournamentParticipants:p,inContext:!0,drawDefinition:s,matchUpId:o});if(h.error)return h;if(!h.matchUp)return{error:Gs};let{matchUp:f,structure:m}=h,{drawPositions:g,matchUpType:v}=f;if(v!==zn)return{error:ll};if(!(g!=null&&g.length))return{error:mM};let y=(e=Xs({matchUp:f,drawDefinition:s,structure:m,event:u}))==null?void 0:e.tieFormat,b={};for(let S of l){if(!Array.isArray(S))return{error:Ce,lineUp:S};let w={},T=[];for(let M of S){if(typeof M!="object")return{error:Ce,lineUpAssignment:M};let{participantId:R,collectionAssignments:N=[]}=M;if(!Array.isArray(N))return{error:Ce,collectionAssignments:N};let A=p.find(x=>x.participantId===R);if(!A)return{error:Ar};if(A.participantType!==Hi)return{error:zd};let _=(n=(i=f.sides)==null?void 0:i.find(x=>{var O,$;return($=(O=x.participant)==null?void 0:O.individualParticipantIds)==null?void 0:$.includes(R)}))==null?void 0:n.sideNumber;_&&T.push(_);for(let x of N){if(typeof x!="object")return{error:Ce,collectionAssignment:x};let{collectionId:O,collectionPosition:$}=x,F=(r=y?.collectionDefinitions)==null?void 0:r.find(G=>G.collectionId===O);if(!F)return{error:Ce,collectionId:O};let j=`${O}-${$}`;w[j]||(w[j]=[]);let H=w[j].length;if(xr(Mn)(F.matchUpType)&&H||F.matchUpType===En&&H>1)return{info:"Excessive collectionPosition assignments",error:Ce};w[j].push(R)}}let U=Object.values(w);for(let M of U)if(M.length===2){let{participant:R}=cd({tournamentParticipants:p,participantIds:M});if(!R){let N=Zp({participant:{participantType:Ai,participantRole:ws,individualParticipantIds:M},pairOverride:!0,tournamentRecord:a});if(N.error)return N}}let C=Ol(T),E=(C[1]||0)>(C[2]||0)&&1||(C[2]||0)>(C[1]||0)&&2||void 0,P=Object.keys(b).map(M=>parseInt(M));E&&!P.includes(E)&&(b[E]=S)}if(!Object.keys(b).length)return{error:g7};if(h=tr({drawDefinition:s,matchUpId:o}),h.error)return h;if(!h.matchUp)return{error:Gs};let{matchUp:I}=h;I.sides||(I.sides=[]);for(let S of[1,2]){let w=I.sides.find(U=>U.sideNumber===S),T=b[S];if(T)w?w.lineUp=T:I.sides.push({lineUp:T,sideNumber:S});else continue}return Xi({tournamentId:a?.tournamentId,context:c,drawDefinition:s,matchUp:I}),{...ue}}var BY={};$i(BY,{anonymizeTournamentRecord:()=>eDe,generate:()=>_Ue,generateEventWithDraw:()=>e2,generateOutcome:()=>YY,generateOutcomeFromScoreString:()=>VY,generateParticipants:()=>rE,generateTournamentRecord:()=>JUe,modifyTournamentRecord:()=>tDe,mutate:()=>QUe});var _Ue={};$i(_Ue,{generateEventWithDraw:()=>e2,generateOutcome:()=>YY,generateOutcomeFromScoreString:()=>VY,generateParticipants:()=>rE,generateTournamentRecord:()=>JUe});function VY(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,scoreString:r,setTBlast:a}=t;if(!r)return{outcome:{...oB,winningSide:n,matchUpStatus:i}};if(n&&![1,2,void 0].includes(n))return{error:Ce,winningSide:n};let s=r&&Cx({scoreString:r}),o={},l=Bh({sets:s,matchUpFormat:e,setTBlast:a}),u=Bh({sets:s,reversed:!0,matchUpFormat:e,setTBlast:a});return n===2?(o.scoreStringSide1=u,o.scoreStringSide2=l):(o.scoreStringSide1=l,o.scoreStringSide2=u),o.sets=Cx({scoreString:o.scoreStringSide1}),Gt({outcome:{matchUpStatus:i,winningSide:n,score:o}})}function jY({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:n}){var r;let a=(((r=e?.[n.matchUpId])==null?void 0:r.matchUpIds)||[]).filter(s=>i.includes(s)).filter(s=>!t[s]);return{dependenciesScheduled:!(a!=null&&a.length),remainingDependencies:a}}function UN({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function QYe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:n,drawId:r}){t[i].potentialRecovery[r]||(t[i].potentialRecovery[r]=[]),t[i].potentialRecovery[r].push(e),t[i].potentialBookings[r]||(t[i].potentialBookings[r]=[]),t[i].potentialBookings[r].push({timeAfterRecovery:e,scheduleTime:n})}function u1({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:n=0,matchUpNotBeforeTimes:r,matchUpDependencies:a,recoveryMinutes:s=0,scheduleTime:o,matchUp:l}){var u,c;let d=er((u=l?.schedule)==null?void 0:u.endTime),p=d?il(d,ai(s)):il(o,ai(n)+ai(s)),h=i&&(d?il(er(d),i):il(o,ai(n)+ai(i))),f=((c=a?.[l.matchUpId])==null?void 0:c.participantIds)||[],m=(l.roundPosition&&t[l.matchUpId]||[]).flat();f.forEach(g=>{UN({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&h||p;m.includes(g)?QYe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:o}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:o,timeAfterRecovery:v}))}),wU({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:r,timeAfterRecovery:p,matchUp:l})}function kUe({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:n,details:r}){var a,s,o,l,u;let c,d=(s=(a=r.minutesMap)==null?void 0:a[n])==null?void 0:s.recoveryMinutes,p=(((l=(o=r.minutesMap)==null?void 0:o[n])==null?void 0:l.averageMinutes)||0)+(d||0),h=il(i,p),f=((u=e?.[n])==null?void 0:u.dependentMatchUpIds)||[];if(f.length){let m=f.reduce((g,v)=>{let y=t[v];if(!y)return g;let b={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||an(y)<an(g.scheduleTime)?b:g},{});m.scheduleTime&&an(h)>an(m.scheduleTime)&&(c=m)}return{scheduledDependent:c}}function eKe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(n=>{var r;return i===En&&(((r=n?.participant)==null?void 0:r.individualParticipants)||[])||n?.participant&&[n.participant]||[]}).flat()}var DN="DO_NOT_SCHEDULE",tKe={DO_NOT_SCHEDULE:DN};function GY({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:n,scheduleTime:r,scheduleDate:a,matchUp:s}){let o=eKe(s).map(({person:h})=>h?.personId);if(i){let h=(s?.potentialParticipants||[]).flat().map(({person:f})=>f?.personId);o.push(...h)}let l=o.map(h=>{var f;return(f=n[h])==null?void 0:f.map(m=>({...m,personId:h}))}).filter(Boolean).flat().filter(h=>h.requestType===DN&&af(a,h.date)),u=[],c=s?.matchUpId,d=qr(er(r),Ci(a)),p=er(R7(d,t).toISOString());for(let h of l){let{requestId:f,startTime:m,endTime:g}=h;(r>m&&r<g||p>m&&p<g)&&(u.push({matchUpId:c,request:h,scheduleTime:r}),e[f]?(e[f].scheduleTimes.includes(r)||e[f].scheduleTimes.push(r),e[f].matchUpIds.includes(c)||e[f].matchUpIds.push(c)):e[f]={request:h,scheduleTimes:[r],matchUpIds:[c]})}return{conflicts:u}}function uz({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:n}){let{matchUpType:r}=i,{individualParticipantIds:a}=V$(i),s=(t[i.matchUpId]||[]).filter(o=>!yo(o,a)).flat();[...a,...s].forEach(o=>{if(UN({individualParticipantProfiles:e,participantId:o}),!e[o].potentialCounted[i.drawId]){let l=e[o].counters;l[r]?l[r]+=n:n>0&&(l[r]=n),l[Jc]?l[Jc]+=n:n>0&&(l[Jc]=n),s.includes(o)&&(e[o].potentialCounted[i.drawId]=!0)}})}function iKe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:n,dateScheduledMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,matchUpDependencies:o,clearScheduleDates:l,scheduleDate:u,minutesMap:c,matchUps:d}){var p,h;let f=[];i||(r=d?.filter(v=>{let y=v.schedule||{},b=v.matchUpStatus===fn;return b&&f.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!b&&vN({schedule:y})&&(!u||v.schedule.scheduledDate===u)}),i=r.map(Na));let m=Array.isArray(l)?l.includes(u):l,g=m?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of g){uz({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let y=(p=v.schedule)==null?void 0:p.scheduledTime;if(y){s[v.matchUpId]=y;let b=(h=c?.[v.matchUpId])==null?void 0:h.recoveryMinutes;u1({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:o,averageMatchUpMinutes:n,recoveryMinutes:b,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:f,dateScheduledMatchUps:r,clearDate:m}}function ZB({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:n,venueIds:r=[],periodLength:a,scheduleDate:s,matchUps:o}){if(typeof n!="object")return{error:gr};if(!pc(o)&&!Array.isArray(i))return{error:Km};a=a??GB({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(n).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:h}=kM({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:h}}})).flat()),u={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=o?.filter(d=>{let p=d.schedule;return vN({schedule:p})&&(!s||d.schedule.scheduledDate===s)}));let c=i?.filter(d=>(!r.length||r.includes(d.schedule.venueId))&&d.matchUpStatus!==fn);return{bookings:c?.map(({eventId:d,schedule:p,matchUpFormat:h})=>{let{event:f,scheduleTiming:m}=l[d],g=f?.eventType,v={...m,defaultTiming:u,matchUpFormat:h},{averageMinutes:y,recoveryMinutes:b}=W$({timingDetails:v,eventType:g}),{courtId:I,venueId:S}=p,w=er(p.scheduledTime),T=il(w,y);return{recoveryMinutes:b,averageMinutes:y,periodLength:a,startTime:w,courtId:I,endTime:T,venueId:S}}).filter(Boolean),relevantMatchUps:c,dateScheduledMatchUps:i}}function nKe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:n,clearScheduleDates:r,tournamentRecords:a,tournamentRecord:s,periodLength:o,scheduleDate:l,startTime:u,venueIds:c,matchUps:d,endTime:p}){if(s&&!a&&(a={[s.tournamentId]:s}),typeof a!="object"||!Object.keys(a).length)return{error:gr};o=o??GB({recoveryMinutes:i,averageMatchUpMinutes:n});let{courts:h,venues:f}=tg({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),m=h?.filter(S=>!c||c.includes(S.venueId))??[];u=u??SU({courts:m,scheduleDate:l,startTime:!0}),p=p??SU({courts:m,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=ZB({defaultRecoveryMinutes:i,averageMatchUpMinutes:n,tournamentRecords:a,scheduleDate:l,periodLength:o,venueIds:c,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:n,clearScheduleDates:r,date:l,periodLength:o,startTime:u,bookings:g,endTime:p,courts:m},{scheduleTimes:b}=DY(y),I=c?.length===1&&c[0]||f?.length===1&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:v?.map(Bl("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:b,venueId:I}}function rKe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let n=[],r=[],a,s,o,l;for(let u of t.filter(Boolean))l||(l=u.hash),(u.hash===l||i)&&(r=r.concat(u.matchUpIds)),u.hash,o=e,s=u.recoveryMinutes,a=u.roundPeriodLength;return r.length&&n.push({matchUpIds:r,roundPeriodLength:a,recoveryMinutes:s,averageMinutes:o}),{groupedRounds:n}}function xUe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:n,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,tournamentRecords:l,periodLength:u,scheduleDate:c,useGarman:d,matchUps:p,courts:h,venues:f}){var m;let g={},v=[],y=[],b=[];for(let I of f){let{rounds:S=[],venueId:w}=I,{scheduledRoundsDetails:T,greatestAverageMinutes:U,orderedMatchUpIds:C,minutesMap:E}=mN({scheduleCompletedMatchUps:i,containedStructureIds:n,tournamentRecords:l,periodLength:u,matchUps:p,rounds:S});b.push(...C??[]);let{groupedRounds:P}=rKe({scheduledRoundsDetails:T,greatestAverageMinutes:U,garmanSinglePass:!0}),M,R=[];d&&({scheduleTimes:R,dateScheduledMatchUpIds:M}=nKe({averageMatchUpMinutes:(m=P[0])==null?void 0:m.averageMinutes,scheduleDate:Ci(c),venueIds:[I.venueId],clearScheduleDates:o,tournamentRecords:l,periodLength:u,matchUps:p}));let N=iKe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:M,greatestAverageMinutes:U,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,scheduleDate:c,minutesMap:E,matchUps:p});({dateScheduledMatchUpIds:M}=N);let A=N,{byeScheduledMatchUpDetails:_,clearDate:x}=N;_!=null&&_.length&&y.push(..._);let{matchUpsToSchedule:O,matchUpMap:$}=CB({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:M,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,orderedMatchUpIds:C,clearDate:x,matchUps:p}),F=h.filter(j=>j.venueId===w);g[w]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:U,scheduledRoundsDetails:T,dateScheduledMatchUps:A,matchUpsToSchedule:O,scheduleTimes:R,groupedRounds:P,venueCourts:F,minutesMap:E,matchUpMap:$},o||v.push(...M)}return{allDateScheduledByeMatchUpDetails:y,allDateScheduledMatchUpIds:v,venueScheduledRoundDetails:g,allDateMatchUpIds:b}}function aKe(t,e){let i=an(t.scheduleTime),n=an(t.timeAfterRecovery),r=an(e.scheduleTime),a=an(e.timeAfterRecovery),s=i===r||n===a,o=i>r&&i<a,l=r>i&&r<n,u=n>r&&n<a,c=a>i&&a<n;return Gt({hasOverlap:s||o||u||l||c,startAisContained:o,endAisContained:u,startBisContained:l,endBisContained:c},!0)}function HY({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:n,matchUp:r,details:a}){var s,o,l,u,c;let d=(((s=i?.[r.matchUpId])==null?void 0:s.participantIds)||[]).flat(),p=((l=(o=a?.minutesMap)==null?void 0:o[r.matchUpId])==null?void 0:l.averageMinutes)||0,h=((c=(u=a?.minutesMap)==null?void 0:u[r.matchUpId])==null?void 0:c.recoveryMinutes)||0,f=d.every(v=>{var y;UN({individualParticipantProfiles:t,participantId:v});let b=t[v];if(!b.timeAfterRecovery)return!0;let I=er((y=r?.schedule)==null?void 0:y.endTime),S=I?il(I,ai(h)):il(n,ai(p)+ai(h));return![...Object.keys(b.potentialBookings).filter(w=>w!==r.drawId).map(w=>b.potentialBookings[w]).flat(),...b.bookings].find(w=>aKe({scheduleTime:n,timeAfterRecovery:S},w).hasOverlap)}),m=e[r.matchUpId],g=(m?wM(qr(m),qr(n),!1):0)>=0;return{enoughTime:f&&g}}function OUe({autoSchedulingAudit:t,tournamentRecords:e}){var i;Ui({topic:rm,payload:t});let n=o=>o?Object.values(o).reduce((l,u)=>l+u.length||0,0):0,r=(t?.schedulingProfile||[]).reduce((o,l)=>o+l.venues.reduce((u,c)=>u+c.rounds.length,0),0),a={scheduledDatesCount:(i=t.scheduledDates)==null?void 0:i.length,noTimeMatchUpIdsCount:n(t?.noTimeMatchUpIds),scheduledMatchUpIdsCount:n(t?.scheduledMatchUpIds),overLimitMatchUpIdsCount:n(t?.overLimitMatchUpIds),requestConflictsCount:n(t?.requestConflicts),profileRoundsCount:r},s={itemType:az,itemValue:a};for(let o of Object.values(e)){let l=o.tournamentId;g$(rm)?Ui({payload:{type:az,tournamentId:l,detail:a},topic:rm}):uN({tournamentRecord:o,timeItem:s})}}function zY({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:n}){let{enteredIndividualParticipantIds:r}=V$(n),{matchUpId:a,matchUpType:s}=n,o=(n.roundPosition&&t[a]||[]).flat(),l=Si(r.concat(...o));return l.forEach(u=>{UN({individualParticipantProfiles:e,participantId:u})}),{participantIdsAtLimit:l.filter(u=>{let c=e[u];if(c)return[s,Jc].find(d=>{var p;let h=((p=c.counters)==null?void 0:p[d])||0,f=i[d]||0;return h&&f&&h>=f})}),relevantParticipantIds:l}}function c1({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:n=!0,matchUpDependencies:r,removePriorValues:a,tournamentRecords:s,tournamentRecord:o,matchUpDetails:l,matchUpIds:u,schedule:c}){var d,p,h;if(!o)return{error:lt};if(!l&&(!u||!Array.isArray(u)))return{error:U0};if(!l&&(!c||typeof c!="object"))return{error:Mye};let f,m=[],g=0;if(n&&!r){let b=bd({tournamentRecords:s,tournamentRecord:o});r=b.matchUpDependencies,f=b.matchUps}f||(f=((d=Qa({tournamentRecord:o}))==null?void 0:d.matchUps)??[]);let v=f.reduce((b,I)=>{let{matchUpId:S,drawId:w,matchUpStatus:T}=I;return(e||T!==fn)&&(t||!wa.includes(T))&&(b[w]?b[w].push(S):b[w]=[S]),b},{}),y=l?.map(b=>b.matchUpId);for(let b of Object.keys(v)){let{drawDefinition:I}=$v({tournamentRecord:o,drawId:b});if(!I)continue;let S=v[b].filter(T=>u?.includes(T)??y?.includes(T)),w=ho({inContext:!1,drawDefinition:I}).matchUps;for(let T of S){let U=((p=l?.find(E=>E.matchUpId===T))==null?void 0:p.schedule)||c,C=KB({schedule:U,matchUpDependencies:r,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:f,tournamentRecords:s,tournamentRecord:o,checkChronology:n,drawDefinition:I,drawMatchUps:w,matchUpId:T});if((h=C?.warnings)!=null&&h.length&&m.push(...C.warnings),C!=null&&C.success&&(g+=1),C.error)return C}}return m.length?{...ue,scheduled:g,warnings:m}:{...ue,scheduled:g}}function EN(t){var e;let{scheduleCompletedMatchUps:i=!1,scheduleByeMatchUps:n=!1,errorOnAnachronism:r,matchUpContextIds:a,removePriorValues:s,tournamentRecords:o,checkChronology:l,matchUpDetails:u,schedule:c}=t;if(t.matchUpIds&&!a)return c1(t);let d=Yt(t,[{[Hs]:!0},{[dU]:{matchUpContextIds:!1,matchUpDetails:!1},[vu]:Ce,[Ho]:Os}]);if(d.error)return d;if((!u||a)&&!c)return{error:Xt,info:"schedule is required"};let p=[],h=0,{matchUpDependencies:f}=bd({tournamentRecords:o});for(let m of Object.values(o)){let{tournamentId:g}=m,v=a?.filter(b=>b.tournamentId===g).map(Na),y=u?.filter(b=>b?.tournamentId===g);if(v!=null&&v.length||y!=null&&y.length){let b=c1({matchUpDetails:y,scheduleCompletedMatchUps:i,scheduleByeMatchUps:n,matchUpDependencies:f,errorOnAnachronism:r,removePriorValues:s,tournamentRecords:o,tournamentRecord:m,checkChronology:l,matchUpIds:v,schedule:c});if((e=b.warnings)!=null&&e.length&&p.push(...b.warnings),b.scheduled&&(h+=b.scheduled),b.error)return b}}return p.length?{...ue,scheduled:h,warnings:p}:{...ue,scheduled:h}}function sKe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:c,personRequests:d,periodLength:p,matchUps:h,courts:f,dryRun:m}){var g,v,y,b,I,S,w;let T={},U={},C={},E={},P={},M={},R={},N={},A={},_={};for(let $ of r){let F=Ci($?.scheduleDate),j=$?.venues||[],H={},G={},W=(de,se)=>{de.forEach(ge=>{let ye=G[ge].counters;ye[se]?ye[se]+=1:ye[se]=1,ye[Jc]?ye[Jc]+=1:ye[Jc]=1})};C[F]={},E[F]={},T[F]={},U[F]={},R[F]=[],N[F]=[],A[F]=[],_[F]=[];let q={};h.forEach(de=>{var se;(se=de.schedule)!=null&&se.scheduledDate&&af(F,Ci(de.schedule.scheduledDate))&&wU({matchUpPotentialParticipantIds:H,matchUpNotBeforeTimes:q,matchUp:de})});let{allDateScheduledByeMatchUpDetails:Z,venueScheduledRoundDetails:K,allDateMatchUpIds:Q}=xUe({matchUpPotentialParticipantIds:H,individualParticipantProfiles:G,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:q,matchUpScheduleTimes:M,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:F,matchUps:h,courts:f,venues:j}),J=10,ne=0,re,oe=10;for(;!re;){for(let{venueId:de}of j){let se=0,ge=K[de];for(;ge.courtsCount&&(g=ge.scheduleTimes)!=null&&g.length&&(v=ge.matchUpsToSchedule)!=null&&v.length&&se<=ge.courtsCount;){let{scheduleTime:ye,attempts:Te=0}=ge.scheduleTimes.shift(),De=ge.matchUpsToSchedule.find(xe=>{var Me,Oe;let{matchUpId:at,matchUpType:Fe}=xe,{participantIdsAtLimit:mt,relevantParticipantIds:Xe}=zY({matchUpPotentialParticipantIds:H,individualParticipantProfiles:G,matchUpDailyLimits:o,matchUp:xe});if(mt.length)return N[F].includes(at)||N[F].push(at),!1;let{scheduledDependent:gt}=kUe({matchUpScheduleTimes:M,matchUpDependencies:s,scheduleTime:ye,matchUpId:at,details:ge});if(gt)return!1;let{dependenciesScheduled:ht,remainingDependencies:_e}=jY({matchUpScheduleTimes:M,matchUpDependencies:s,allDateMatchUpIds:Q,matchUp:xe});if(!ht)return E[F][at]||(E[F][at]=[]),E[F][at].push({scheduleTime:ye,remainingDependencies:_e}),!1;let{enoughTime:Ye}=HY({individualParticipantProfiles:G,matchUpNotBeforeTimes:q,matchUpDependencies:s,scheduleTime:ye,details:ge,matchUp:xe});if(!Ye)return C[F][at]||(C[F][at]=[]),C[F][at].push({scheduleTime:ye}),!1;let Je=ge.greatestAverageMinutes,{conflicts:ct}=GY({potentials:e,averageMatchUpMinutes:Je,requestConflicts:_,personRequests:d,scheduleTime:ye,scheduleDate:F,matchUp:xe});if(ct!=null&&ct.length)return P[F]||(P[F]=[]),P[F].push(...ct),!1;W(Xe,Fe);let pt=(Oe=(Me=ge.minutesMap)==null?void 0:Me[at])==null?void 0:Oe.recoveryMinutes;return u1({matchUpPotentialParticipantIds:H,individualParticipantProfiles:G,matchUpNotBeforeTimes:q,averageMatchUpMinutes:Je,matchUpDependencies:s,recoveryMinutes:pt,scheduleTime:ye,matchUp:xe}),M[at]=ye,!0});ge.matchUpsToSchedule=ge.matchUpsToSchedule.filter(({matchUpId:xe})=>xe!==De?.matchUpId),De?se+=1:(U[F][de]||(U[F][de]=[]),U[F][de].push({scheduleTime:ye,attempts:Te+1}))}(y=ge.matchUpsToSchedule)!=null&&y.length&&(U[F][de]=(b=U[F][de])==null?void 0:b.filter(ye=>{let Te=ye.attempts<J;return Te&&ge.scheduleTimes.push(ye),!Te})),(!((I=ge.scheduleTimes)!=null&&I.length)||!((S=ge.matchUpsToSchedule)!=null&&S.length))&&(ge.complete=!0)}ne+=1,re=j.every(({venueId:de})=>K[de].complete)||ne===oe}for(let{venueId:de}of j){let se=K[de].matchUpMap;Object.keys(se).forEach(ge=>{let ye=u[ge];ye&&Object.keys(se[ge]).forEach(Te=>{let{drawDefinition:De}=$v({tournamentRecord:ye,drawId:Te});De&&se[ge][Te].forEach(({matchUpId:xe})=>{let Me=M[xe];if(Me){let Oe=Me.split(":").map(ju).join(":"),at=`${Ci(F)}T${Oe}`;m?R[F].push(xe):(Bv({drawDefinition:De,scheduledTime:at,matchUpId:xe}).success&&R[F].push(xe),de&&nE({tournamentRecord:ye,drawDefinition:De,matchUpId:xe,venueId:de}))}})})}),A[F]=K[de].matchUpsToSchedule.map(Na),T[F][de]=K[de].scheduleTimes.sort((ge,ye)=>an(ge.scheduleTime)-an(ye.scheduleTime))}!m&&Z!=null&&Z.length&&EN({matchUpDetails:Z,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let de of $.venues)for(let se of de.rounds){let ge=(((w=se.matchUps)==null?void 0:w.map(({matchUpId:Te})=>Te))||[]).filter(Te=>R[F].includes(Te));se.canScheduledMatchUpIds=ge;let ye=Math.round(ge.length/se.matchUpsCount*1e4)/100;(ye===1/0||isNaN(ye))&&(ye=0),se.possibleToSchedulePct=ye,se.matchUpsCount===ge.length&&(se.possibleToSchedule=!0)}}let x=r.map(({scheduleDate:$})=>$),O={timeStamp:Date.now(),overLimitMatchUpIds:N,scheduledMatchUpIds:R,schedulingProfile:c,noTimeMatchUpIds:A,requestConflicts:_,scheduledDates:x};return OUe({tournamentRecords:u,autoSchedulingAudit:O}),{...ue,schedulingProfileModifications:t,schedulingProfileIssues:n,scheduleTimesRemaining:T,dateSchedulingProfiles:r,skippedScheduleTimes:U,recoveryTimeDeferredMatchUpIds:C,dependencyDeferredMatchUpIds:E,matchUpScheduleTimes:M,overLimitMatchUpIds:N,scheduledMatchUpIds:R,noTimeMatchUpIds:A,requestConflicts:_,scheduledDates:x}}function oee({averageMinutes:t,startTime:e,endTime:i,court:n,date:r}){if(!Array.isArray(n.dateAvailability))return{error:Xt,stack:"getEarliestCourtTime"};let a=SU({scheduleDate:r,courts:[n],startTime:!0}),s=SU({scheduleDate:r,courts:[n],endTime:!0});e=e||a,i=i||s;let o=wN({court:n,date:r}),{timeSlots:l}=tE({courtDate:o}),u=qr(e),c=qr(i);return{earliestCourtTime:l?.reduce((d,p)=>{let h=qr(p.startTime),f=qr(p.endTime);if(h>c||f<u)return d;let m=u>h?u:h;if(wM(m,f)>=t){let g=er(m.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:s}}function oKe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:u,periodLength:c=30,schedulingProfile:d,personRequests:p,matchUps:h=[],courts:f,dryRun:m}){var g,v;let y={},b={},I={},S={},w={},T={},U={},C={},E={};for(let R of r??[]){let N=Ci(R?.scheduleDate),A=R?.venues||[],_={},x={},O=(de,se)=>{de.forEach(ge=>{let ye=x[ge].counters;ye[se]?ye[se]+=1:ye[se]=1,ye[Jc]?ye[Jc]+=1:ye[Jc]=1})};y[N]={},b[N]={},T[N]=[],U[N]=[],C[N]=[],E[N]=[];let $={};h?.forEach(de=>{var se;(se=de.schedule)!=null&&se.scheduledDate&&af(N,Ci(de.schedule.scheduledDate))&&wU({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:$,matchUp:de})});let{allDateScheduledByeMatchUpDetails:F,allDateScheduledMatchUpIds:j,venueScheduledRoundDetails:H,allDateMatchUpIds:G}=xUe({matchUpPotentialParticipantIds:_,individualParticipantProfiles:x,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:$,matchUpScheduleTimes:w,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:u,periodLength:c,scheduleDate:N,matchUps:h,courts:f,venues:A}),W=h?.filter(({matchUpId:de})=>j.includes(de)),{bookings:q}=ZB({dateScheduledMatchUps:W,tournamentRecords:u,scheduleDate:N,periodLength:c}),{virtualCourts:Z}=jB({scheduleDate:N,periodLength:c,bookings:q,courts:f}),K=Z?.reduce((de,se)=>{let{earliestCourtTime:ge,courtEndTime:ye}=oee({date:N,averageMinutes:0,court:se});return(!de.startTime||qr(ge)<qr(de.startTime))&&(de.startTime=ge),(!de.endTime||qr(ye)>qr(de.endTime))&&(de.endTime=ye),de},{}),Q=K.startTime,J=({courtId:de,booking:se})=>{var ge;return(ge=Z?.find(ye=>ye.courtId===de))==null?void 0:ge.dateAvailability[0].bookings.push(se)},ne=10,re=0,oe;for(;!oe;){for(let{venueId:de}of A){let se=H[de],ge=se.matchUpsToSchedule.length,ye=[],Te=[],De,xe=0;for(;!De;){for(let Me of se.matchUpsToSchedule){if(Te.length===se.courtsCount||ye.length===se.courtsCount){De=!0;break}let{matchUpId:Oe,matchUpType:at}=Me,{participantIdsAtLimit:Fe,relevantParticipantIds:mt}=zY({matchUpPotentialParticipantIds:_,individualParticipantProfiles:x,matchUpDailyLimits:o,matchUp:Me});if(Fe.length){U[N].includes(Oe)||U[N].push(Oe);continue}let{dependenciesScheduled:Xe,remainingDependencies:gt}=jY({matchUpScheduleTimes:w,matchUpDependencies:s,allDateMatchUpIds:G,matchUp:Me});if(!Xe){b[N][Oe]||(b[N][Oe]=[]),b[N][Oe].push({remainingDependencies:gt});continue}let ht=[],_e=Z?.reduce((Ye,Je)=>{var ct,pt,Se,he;if(Te.includes(Je.courtId))return Ye;let{earliestCourtTime:we}=oee({averageMinutes:se.greatestAverageMinutes,startTime:Q,date:N,court:Je});if(Ye.scheduleTime&&an(we)>=an(Ye.scheduleTime))return Ye;let{scheduledDependent:be}=kUe({matchUpScheduleTimes:w,matchUpDependencies:s,scheduleTime:we,matchUpId:Oe,details:se});if(be)return Ye;let{enoughTime:Ae}=HY({individualParticipantProfiles:x,matchUpNotBeforeTimes:$,matchUpDependencies:s,scheduleTime:we,details:se,matchUp:Me});if(!Ae)return y[N][Oe]||(y[N][Oe]=[]),y[N][Oe].includes(we)||y[N][Oe].push(we),Ye;let ze=((pt=(ct=se.minutesMap)==null?void 0:ct[Oe])==null?void 0:pt.averageMinutes)||se.greatestAverageMinutes,{conflicts:We}=GY({potentials:e,averageMatchUpMinutes:ze,requestConflicts:E,personRequests:p,scheduleTime:we,scheduleDate:N,matchUp:Me});if(We!=null&&We.length)return ht.push(...We),!1;O(mt,at);let Le=(he=(Se=se.minutesMap)==null?void 0:Se[Oe])==null?void 0:he.recoveryMinutes;return u1({matchUpPotentialParticipantIds:_,individualParticipantProfiles:x,matchUpNotBeforeTimes:$,averageMatchUpMinutes:ze,matchUpDependencies:s,recoveryMinutes:Le,scheduleTime:we,matchUp:Me}),(!Ye.scheduleTime||an(we)<an(Ye.scheduleTime))&&(Ye.averageMatchUpMinutes=ze,Ye.recoveryMinutes=Le,Ye.scheduleTime=we,Ye.courtName=Je.courtName,Ye.courtId=Je.courtId),Ye},{});if(_e.scheduleTime){let{averageMatchUpMinutes:Ye,recoveryMinutes:Je,scheduleTime:ct,courtId:pt}=_e;w[Oe]=ct,S[Oe]=pt,ye.push(Oe),Te.push(pt);let Se=ct,he=il(Se,Ye);J({courtId:pt,booking:{averageMatchUpMinutes:Ye,recoveryMinutes:Je,periodLength:c,matchUpId:Oe,startTime:Se,courtId:pt,endTime:he,venueId:de}}),se.matchUpsToSchedule=se.matchUpsToSchedule.filter(we=>we.matchUpId!==Oe)}else ht!=null&&ht.length&&(I[N]||(I[N]=[]),I[N].push(...ht))}(Te.length===se.courtsCount||ye.length===se.courtsCount||!se.matchUpsToSchedule.length)&&(De=!0),se.matchUpsToSchedule.length&&ye<se.courtsCount&&(qr(Q)<qr(K.endTime)?Q=il(Q,c):(De=!0,se.complete=!0)),xe+=1,!De&&xe>=ge&&(De=!0)}(g=se.matchUpsToSchedule)!=null&&g.length||(se.complete=!0)}re+=1,oe=A.every(({venueId:de})=>H[de].complete)||re===ne}for(let{venueId:de}of A){let se=H[de].matchUpMap;Object.keys(se).forEach(ge=>{let ye=u[ge];ye&&Object.keys(se[ge]).forEach(Te=>{let{drawDefinition:De}=$v({tournamentRecord:ye,drawId:Te});De&&se[ge][Te].forEach(({matchUpId:xe})=>{let Me=w[xe],Oe=S[xe];if(Me){let at=Me.split(":").map(ju).join(":"),Fe=`${Ci(N)}T${at}`;m||(Bv({drawDefinition:De,scheduledTime:Fe,matchUpId:xe}),X0({courtDayDate:N,tournamentRecords:u,tournamentRecord:ye,drawDefinition:De,matchUpId:xe,courtId:Oe})),T[N].push(xe)}})})}),C[N]=H[de].matchUpsToSchedule.map(Na)}!m&&F!=null&&F.length&&EN({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let de of R.venues)for(let se of de.rounds){let ge=(v=(se.matchUps??[]).map(({matchUpId:Te})=>Te))==null?void 0:v.filter(Te=>T[N].includes(Te));se.canScheduledMatchUpIds=ge;let ye=Math.round((ge?.length||0)/se.matchUpsCount*1e4)/100;(ye===1/0||isNaN(ye))&&(ye=void 0),se.possibleToSchedulePct=ye,se.matchUpsCount===ge?.length&&(se.possibleToSchedule=!0)}}let P=(r??[]).map(({scheduleDate:R})=>R),M={timeStamp:Date.now(),overLimitMatchUpIds:U,scheduledMatchUpIds:T,schedulingProfile:d,noTimeMatchUpIds:C,requestConflicts:E,scheduledDates:P};return OUe({tournamentRecords:u,autoSchedulingAudit:M}),{...ue,schedulingProfileModifications:t,schedulingProfileIssues:n,dateSchedulingProfiles:r,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:b,matchUpScheduleTimes:w,overLimitMatchUpIds:U,scheduledMatchUpIds:T,noTimeMatchUpIds:C,requestConflicts:E,scheduledDates:P}}function XB(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=wa,scheduledDates:n,venueIds:r}=t,a=uc(t),s=Qi(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(s!=null&&s.length))return{error:gr};let o=0;for(let l of s){let u=a[l],c=lKe({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:u,scheduledDates:n,venueIds:r});if(c.error)return c;o+=c.clearedScheduleCount??0}return{...ue,clearedScheduleCount:o}}function lKe({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=wa,tournamentRecord:i,scheduledDates:n,venueIds:r=[]}){if(typeof i!="object")return{error:lt};if(!Array.isArray(e)||!Array.isArray(r))return{error:Ce};r.length&&t.push("venueId");let a=Qa({matchUpFilters:{scheduledDates:n},tournamentRecord:i}).matchUps??[],s={};a.forEach(({matchUpStatus:u,schedule:c,drawId:d,matchUpId:p})=>{(!u||!e.includes(u))&&vN({schedule:c,scheduleAttributes:t})&&(!(r!=null&&r.length)||r.includes(c.venueId))&&(s[d]||(s[d]=[]),s[d].push(p))});let o=i.tournamentId,l=0;for(let u in s){let{event:c,drawDefinition:d}=jo({tournamentRecord:i,drawId:u}),p=ho({drawDefinition:d,matchUpFilters:{matchUpIds:s[u]}}).matchUps??[];for(let h of p){let f=!1;h.timeItems=(h.timeItems??[]).filter(m=>{let g=m?.itemType&&![cf,lv,O0,z$,L0,F0].includes(m?.itemType);return g||(f=!0),g}),f&&(Xi({context:"clear schedules",eventId:c?.eventId,drawDefinition:d,tournamentId:o,matchUp:h}),l+=1)}}return{...ue,clearedScheduleCount:l}}function JB(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:n,scheduleDates:r=[],tournamentRecords:a,periodLength:s,useGarman:o,dryRun:l,pro:u}=t,c=Yt(t,[{[Hs]:!0},{[vs]:C=>!C||Array.isArray(C)&&C.every(Pl),[Jbe]:!1,[Ho]:Os}]);if(c.error)return c;let d=ig({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...ue};let{modifications:p,issues:h=[],schedulingProfile:f=[]}=d,m=Object.assign({},...Object.values(a).map(C=>VD({tournamentRecord:C}).containedStructures)),g=r.map(C=>{if(Pl(C))return Ci(C)}).filter(Boolean),v=f.map(C=>C.scheduleDate).map(C=>Pl(C)&&Ci(C)).filter(C=>C&&(!r.length||g.includes(C)));if(!v.length)return{error:sye};if(n&&!l){let C=Array.isArray(n)?n:[];XB({tournamentRecords:a,scheduledDates:C})}let y=tg({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:b}=Wd({matchUpFilters:{matchUpTypes:[Mn,En]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:I}=bd({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:b}),{matchUpDailyLimits:S}=LB({tournamentRecords:a}),{personRequests:w}=Xb({requestType:DN,tournamentRecords:a}),T=f.filter(C=>{let E=Ci(C?.scheduleDate);return v.includes(E)}).sort((C,E)=>new Date(C.scheduleDate).getTime()-new Date(E.scheduleDate).getTime()),U={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:h,dateSchedulingProfiles:T,containedStructureIds:m,matchUpDependencies:I,matchUpDailyLimits:S,clearScheduleDates:n,tournamentRecords:a,schedulingProfile:f,personRequests:w,periodLength:s,matchUps:b,dryRun:l,courts:y};return u?oKe(U):sKe(U)}function QB(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:n,...r}=t||{};return r.tournamentId||(r.tournamentId=gn()),r.startDate&&!rb(r.startDate)&&!ax.test(r.startDate)?{error:za}:r.endDate&&!rb(r.endDate)&&!ax.test(r.endDate)?{error:za}:(r.extensions&&(r.extensions=r.extensions.filter(Wp)),{...r})}function qY({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:n,teamNames:r,accessor:a,uuids:s}){var o,l;if(!i)return{error:lt};let u={},c=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===Hi&&v===ws),d=0;for(let g of c){let v=a&&((o=WI({element:g,accessor:a}))==null?void 0:o.value)||n&&((l=g.person)==null?void 0:l[n])||e&&g[e];if(v){if(!Object.keys(u).includes(v)){u[v]={participantName:r?.[d]??v,participantId:s?.pop()??gn(),individualParticipantIds:[],participantRole:ws,participantType:Sn};let y={value:n??e,name:RH};dn({element:u[v],extension:y}),d+=1}u[v].individualParticipantIds.push(g.participantId)}}let p=Object.keys(u),h=(i.participants??[]).map(g=>{if(g.participantType!==Sn||g.participantRole!==ws)return;let{extension:v}=ki({name:RH,element:g}),y=v?.value;if(p.includes(y))return g.participantId}).filter(Boolean),f=0,m=[];return Object.keys(u).forEach(g=>{let v=u[g],{participantId:y}=v;h.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),m.push(v),f++)}),t&&f?(Ui({payload:{tournamentId:i.tournamentId,participants:m},topic:av}),{...ue,participantsAdded:f}):m.length?{...ue,newParticipants:m}:{error:Yqe}}var uKe=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],cKe=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function LUe({count:t=1,participantsCount:e=32}={}){let i=co(cKe),n=i.slice(0,t);return{cities:Et(0,e).map(r=>r<Math.min(t,i.length)?n[r]:xc(n))}}function FUe({count:t=1,participantsCount:e=32}={}){let i=co(uKe),n=i.slice(0,t).map(r=>Object.keys(r)).flat();return{states:Et(0,e).map(r=>r<Math.min(t,i.length)?n[r]:xc(n))}}function $Ue({count:t=1,participantsCount:e=32}={}){let i=Et(0,t).map(()=>Et(0,5).map(()=>Lu(0,9)).join(""));return{postalCodes:Et(0,e).map(n=>n<t?i[n]:xc(i))}}function Ax({idPrefix:t,participantType:e,index:i,uuids:n}){let r=nr(e)?e[0]:"X";return t?`${t}-${r}-${i}`:n?.pop()||gn()}function BUe(t){let{cities:e,states:i,postalCodes:n,nationalityCode:r,participantIndex:a}=t;return{postalCode:n?.[a],state:i?.[a],city:e?.[a],countryCode:r}}var dKe={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function BV(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![Un,Gn].includes(i))return{personData:[],error:Ce};let n=Math.ceil(e*1.3),{lastNames:r,firstFemale:a,firstMale:s}=dKe,o=jg.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(n/r.length),u=Math.ceil(n/a.length),c=Math.ceil(n/s.length),d=Et(0,l).flatMap(()=>{let m=At(r,!1,!0);return Et(0,r.length).map(()=>wl(m))}),p=Et(0,u).flatMap(()=>{let m=At(a,!1,!0);return Et(0,a.length).map(()=>wl(m))}),h=Et(0,c).flatMap(()=>{let m=At(s,!1,!0);return Et(0,s.length).map(()=>wl(m))}),f={};for(let m=0;m<n;m++){let g=d.pop(),v=i||xc([Un,Gn]),y=v===Un?h.pop():p.pop(),b=xc(o);f[`${y}${g}`]={nationalityCode:b,sex:v,firstName:y,lastName:g}}return{personData:Object.values(f).slice(0,e)}}function VUe(t){let e=t?.count||1,{personExtensions:i,consideredDate:n,isMock:r=!0,gendersCount:a,personData:s,category:o,sex:l}=t||{};if(isNaN(e))return{error:Ce};let u=a?.[Un]||l===Un&&e||0,c=a?.[Gn]||l===Gn&&e||0;e=Math.max(e,u+c);let d=e-(u+c),p=u&&BV({count:u,sex:Un}).personData||[],h=c&&BV({count:c,sex:Gn}).personData||[],f=[...p,...h,...d&&BV({count:d}).personData||[]],m=f.filter(U=>!l||u&&c||U.sex===l),g=[];if(Array.isArray(s)){let U=s.filter(C=>typeof C.firstName!="string"||typeof C.lastName!="string"||C.sex&&![Un,Gn].includes(C.sex)||C.nationalityCode&&(typeof C.nationalityCode!="string"||C.nationalityCode.length>3||!jg.find(({iso:E,ioc:P})=>[E,P].includes(C.nationalityCode)))?!1:(C.nationalityCode&&g.push(C.nationalityCode),!0));if(U.length)m=U;else return{error:Ce}}let v=s?m:co(m);if(v.length<e){let{maleFirstNames:U,maleLastNames:C,femaleFirstNames:E,femaleLastNames:P,nationalityCodes:M}=f.reduce((R,N)=>{let{firstName:A,lastName:_,nationalityCode:x}=N;return N.sex===Un?(R.maleFirstNames.includes(A)||R.maleFirstNames.push(A),R.maleLastNames.includes(_)||R.maleLastNames.push(_)):(R.femaleFirstNames.includes(A)||R.femaleFirstNames.push(A),R.femaleLastNames.includes(_)||R.femaleLastNames.push(_)),R.nationalityCodes.includes(x)||R.nationalityCodes.push(x),R},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Et(0,e-v.length).forEach(()=>{let R=l||xc([Un,Gn]),N=xc(M),A=xc(R===Un?U:E),_=xc(R===Un?C:P),x={firstName:A,lastName:_,sex:R,nationalityCode:N};v.push(x)})}let{ageMinDate:y,ageMaxDate:b}=Sw({consideredDate:n,category:o}),I=ai(y?.slice(0,4)||0)||ai(b?.slice(0,4)||0)-3,S=ai(b?.slice(0,4)||0)||ai(y?.slice(0,4)||0)+3,w=(y||b)&&[I,S],T=v.slice(0,e).map((U,C)=>{let[E,P]=w||[],M=w&&wl(Et(E,P)),R=wl(Et(0,365)),N=M&&j3e(M,R);return Object.assign(Gt({extensions:i||[{name:"regionCode",value:C+1}],birthDate:N,isMock:r}),U)});return{persons:T.length&&T||v[0],nationalityCodes:g}}var pKe=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function _x({nameRoot:t="TEAM",count:e=1}={}){let i=co(pKe).slice(0,e);return i.length<e&&Et(0,e-i.length).forEach(n=>i.push(`${t} ${n+1}`)),{names:i}}function rE(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:n=Ra,valuesInstanceLimit:r,ratingsValues:a=[],consideredDate:s,categories:o,category:l,nationalityCodesCount:u,nationalityCodeType:c,nationalityCodes:d,participantsCount:p=32,participantType:h,teamSize:f=8,personIds:m,idPrefix:g,uuids:v,personExtensions:y,addressProps:b,gendersCount:I,matchUpType:S,personData:w,sex:T,inContext:U,withISO2:C,withIOC:E,scaleAllParticipants:P}=t,M=h===Ai||S===nb,R=h===Sn||S===Sn;i&&(!Array.isArray(i)||!i.every(Fe=>Ir(Fe))||i.length!==2)&&(i=void 0),e=P?p:e;let N=1e3,A=e&&e>N?e:N;i=i||[1,A],i[1]+=1;let _=p*(M&&2||R&&(f??8)||1),x=VUe({count:_,personExtensions:y,consideredDate:s,gendersCount:I,personData:w,category:l,sex:T});if(x.error)return x;let{nationalityCodes:O,persons:$}=x,F={},j={},H={},G={},W=Fe=>{Object.assign(F,Fe.doublesRankings),Object.assign(j,Fe.singlesRankings),Object.assign(G,Fe.doublesRatings),Object.assign(H,Fe.singlesRatings)};if(Qi(l)){let Fe=lee({scaledParticipantsCount:e,ratingsParameters:n,participantType:h,ratingsValues:a,rankingRange:i,category:l});W(Fe)}Array.isArray(o)&&o.forEach(Fe=>{let mt=lee({scaledParticipantsCount:e,ratingsParameters:n,participantType:h,ratingsValues:a,rankingRange:i,category:Fe});W(mt)});let q=jg.filter(Fe=>c==="IOC"&&Fe.ioc||Fe.iso);function Z(Fe){let mt=Math.ceil(_/Fe);return r&&mt>r?Math.ceil(_/r):Fe}let{postalCodesProfile:K,postalCodesCount:Q,statesProfile:J,citiesProfile:ne,citiesCount:re,statesCount:oe}=b||{},de=Fe=>Object.keys(Fe).map(mt=>Et(0,J[mt]).map(()=>mt)).flat(),se=ne&&de(ne)||b?.cities||LUe({count:re||_,participantsCount:_}).cities,ge=J&&de(J)||b?.states||FUe({count:oe||_,participantsCount:_}).states,ye=K&&de(K)||b?.postalCodes||$Ue({count:Q||_,participantsCount:_}).postalCodes,Te={cities:se,states:ge,postalCodes:ye},De=Z(u),xe=De?co(q).slice(0,u):d&&q.filter(Fe=>d.includes(Fe.iso))||q,Me=co(Et(0,Math.ceil(_/(De||1))).map(()=>xe).flat(1/0)),Oe=_x({count:p}).names;return{participants:Et(0,p).map(Fe=>{let mt=M&&2||R&&(f??8)||1,Xe=Et(0,mt).map(Je=>{let ct=Fe*mt+Je;return at(ct)}),gt=Xe.map(Je=>Je.participantId),ht=Xe.map(Je=>Je.person.standardFamilyName).join("/"),_e=M?Ai:Sn,Ye={participantId:Ax({participantType:_e,index:Fe,idPrefix:g,uuids:v}),participantName:M?ht:Oe[Fe],participantRole:ws,individualParticipantIds:gt,participantType:_e};return U&&(Ye.individualParticipants=Xe),M||R?[Ye,...Xe]:Xe}).flat(),...ue};function at(Fe){let mt=$[Fe],{nationalityCode:Xe,participantExtensions:gt,participantTimeItems:ht,extensions:_e,firstName:Ye,birthDate:Je,lastName:ct,personId:pt,sex:Se}=mt||{},he=Ye||"GivenName",we=ct||"FamilyName",be=`${he} ${we}`,Ae=Me[Fe],ze=O?.length&&Xe||Ae&&(c==="IOC"?Ae.ioc||Ae.iso:Ae.iso||Ae.ioc)||Xe;Me!=null&&Me.length&&!ze&&!Xe&&console.log("%c Invalid Nationality Code",{participantIndex:Fe,country:Ae});let We=BUe({...Te,participantIndex:Fe,nationalityCode:ze}),Le=Gt({participantId:Ax({participantType:Hi,index:Fe,idPrefix:g,uuids:v}),extensions:gt,timeItems:ht,participantRole:ws,participantType:Hi,participantName:be,person:{personId:pt||m?.length&&m[Fe]||gn(),birthDate:Pl(Je)?Je:void 0,addresses:[We],standardFamilyName:we,standardGivenName:he,nationalityCode:ze,extensions:_e,sex:Se}});if(E&&ze){let rt=jg.find(({iso:St})=>St===ze);rt!=null&&rt.ioc&&(Le.person.iocNationalityCode=rt.ioc),rt!=null&&rt.label&&(Le.person.countryName=rt.label)}if(C&&ze){let rt=jg.find(({iso:St})=>St===ze);rt!=null&&rt.iso2&&(Le.person.iso2NationalityCode=rt.iso2),rt!=null&&rt.label&&(Le.person.countryName=rt.label)}let ft=rt=>{var St,si,Qe,bt;let ci=rt.categoryName||rt.ratingType||rt.ageCategoryCode,Tt=(St=j[ci])==null?void 0:St[Fe],Li=(si=F[ci])==null?void 0:si[Fe];mA({scaleValue:Tt,eventType:Tw,scaleType:iv,participant:Le,category:rt}),mA({scaleValue:Li,eventType:Dm,scaleType:iv,participant:Le,category:rt});let Jt=(Qe=H[ci])==null?void 0:Qe[Fe],Yi=(bt=G[ci])==null?void 0:bt[Fe];mA({scaleValue:Jt,eventType:Tw,scaleType:Vg,participant:Le,category:rt}),mA({scaleValue:Yi,eventType:Dm,scaleType:Vg,participant:Le,category:rt})};return Array.isArray(o)?o.forEach(rt=>ft(rt)):l&&ft(l),Le}}function mA({scaleValue:t,participant:e,eventType:i,scaleType:n,category:r}){let a=r.categoryName||r.ratingType||r.ageCategoryCode,s=[lb,n,i,a].join("."),o={itemValue:t,itemType:s};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(o))}function lee(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:n,participantType:r,ratingsValues:a=[]}=t,s=e.rankingRange||t.rankingRange||[1,1e3],o={},l={},u={},c={},{categoryName:d,ageCategoryCode:p,ratingType:h}=e,f=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!h){let[m,g]=s||[];if(l[f]=co(Et(m,g)).slice(0,i||Lu(20,30)),[Ai,Sn].includes(r)){let[v,y]=s||[];o[f]=co(Et(v,y)).slice(0,i||Lu(20,30))}}if(h&&n[h]){let{ratingMax:m,ratingMin:g,ratingAttributes:v}=e,y={...n[h],...v||{}},{attributes:b={},decimalsCount:I,accessors:S,range:w,step:T}=y,U=R=>{let N={},A=Object.keys(R||{});for(let _ of A){let x=R[_];if(typeof x=="object"&&x.generator){let{range:O}=x,[$,F]=O.slice().sort();N[_]=Lu($,F)}else N[_]=x}return N},C=w[0]>w[1]?2:.7,[E,P]=w.slice().sort(),M=Et(0,2e3).map(()=>Uve(E,P,C,T,I)).filter(R=>(!m||R<=m)&&(!g||R>=g)).slice(0,i||Lu(20,30)).map(R=>S?Object.assign({},...S.map(N=>({[N]:R})),U(b)):R);u[f]=[...a,...M],[Ai,Sn].includes(r)&&(c[f]=[...a,...M])}return{singlesRankings:l,doublesRankings:o,singlesRatings:u,doublesRatings:c}}function WY(t){var e,i;let{alternatesCount:n=0,tieFormatName:r,drawSize:a}=t,s=0,o=0,l=0,u=0,c={},d={[Un]:0,[Gn]:0,[ko]:0,[Iy]:0,[qd]:0};(i=(e=Qi(t.tieFormat)?t.tieFormat:Um({namedFormat:r}))==null?void 0:e.collectionDefinitions)==null||i.filter(Boolean).forEach(m=>{let{category:g,collectionId:v,matchUpType:y,matchUpCount:b,gender:I}=m;if([Un,Gn].includes(I)){let S=b*(y===En?2:1);d[I]<S&&(d[I]=S)}else I===ko&&(d[Un]<b&&(d[Un]=b),d[Gn]<b&&(d[Gn]=b));if(g){let S=JSON.stringify(g);c[S]=g}if(v||(m.collectionId=gn()),xr(En)(y)){let S=b;u+=b,s=Math.max(s,S)}if(xr(Mn)(y)){let S=b;l+=b,o=Math.max(o,S)}});let p=Object.keys(c).length?Math.max(l,u*2):Math.max(o,s*2),h=s*(a+n),f=o*(a+n);return{maxDoublesDraw:h,maxSinglesDraw:f,teamSize:p,genders:d}}function hKe({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:n,participantType:r=Hi}=t||{},a=n||0,s={[Gn]:0,[ko]:0,[Iy]:0,[Un]:0,[qd]:0},o=0,l=0,u=0,c=0,d=0,p=({alternatesCount:f=0,uniqueParticipants:m,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:b,category:I,gender:S,stage:w})=>{let T=y===Ju,U=y===aa,C=!!(m||w===Kt||I||S);if(U){c=Math.max(c,v+f),b=typeof b=="object"?b:Um({namedFormat:g});let{teamSize:E,maxDoublesDraw:P,maxSinglesDraw:M,genders:R}=WY({alternatesCount:f,tieFormatName:g,tieFormat:b,drawSize:v});u=Math.max(u,E),l=Math.max(l,M),C||(o=Math.max(o,P)),Object.keys(R).forEach(N=>s[N]+=R[N])}else if(T)if(C){let E=(v+f)*2;d+=E,S&&(s[S]+=E)}else v+f&&v+f>o&&(o=v+f);else if(C){let E=v+f;S&&(s[S]+=E),d+=E}else v&&v>l&&(l=v+f)};if(e?.forEach(f=>{let{tieFormatName:m,tieFormat:g,drawProfiles:v,eventType:y,category:b,gender:I}=f;if(v)for(let S of v){let{tieFormatName:w,tieFormat:T}=S;p({...S,tieFormatName:w||m,tieFormat:T||g,eventType:y,category:b,gender:I})}}),Array.isArray(i))for(let f of i)p(f);let h=Math.max(c*u,o*2,l);return o&&(r=Ai),(n||a)<h&&(n=h),n&&o&&[Ai,aa].includes(r)&&(l&&Math.floor(l/2)>o?n=Math.floor(l/2):(!l||o*2>=l)&&(n=Math.ceil(n/2))),n===void 0&&(n=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),n<a&&(n=a),{uniqueParticipantsCount:d,participantsCount:n,largestTeamDraw:c,largestTeamSize:u,participantType:r,gendersCount:s}}function jUe({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:n,startDate:r,uuids:a}){if(t?.participantsCount===0)return{addedCount:0,...ue};let{participantsCount:s,participantType:o,largestTeamDraw:l,largestTeamSize:u,gendersCount:c}=hKe({participantsProfile:t,eventProfiles:i,drawProfiles:n}),d=t?.teamKey,p=rE({consideredDate:r,...t,participantsCount:s,participantType:o,gendersCount:c,uuids:a}).participants,h=0,f=dd({tournamentRecord:e,participants:p});if(f.error)return f;if(h+=f.addedCount,d){let y=qY({tournamentRecord:e,...d});if(y.error)return y}let m=p.filter(({participantType:y})=>y===Hi).map(Gi),g=t!=null&&t.idPrefix?`${Sn}-${t.idPrefix}`:void 0,v=Et(0,l).map(y=>{let b=m.slice(y*u,(y+1)*u),I=Ax({index:y,participantType:o,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:ws,individualParticipantIds:b,participantType:Sn,participantId:I}});return f=dd({participants:v,tournamentRecord:e}),f.error?f:(h+=f.addedCount,{addedCount:h,...ue})}function GUe({drawProfiles:t,category:e,gender:i}){let n={},r=t?.reduce((s,o)=>{let{qualifyingPositions:l=0,participantsCount:u=0,uniqueParticipants:c,stage:d=_t,drawSize:p=0}=o||{};Object.keys(s).includes(d)||(s[d]=0);let h=(u||p)-l;return c||i||e||d===Kt?(Object.keys(n).includes(d)||(n[d]=0),n[d]+=h):s[d]=Math.max(s[d],h),s},{}),a=Object.keys(n);return a.forEach(s=>r[s]+=n[s]),{stageParticipantsCount:r,uniqueParticipantsCount:n,uniqueParticipantStages:a}}function HUe({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:n}){let r=e[_t]||0,a=e[Kt]||0;return{stageParticipants:{QUALIFYING:n?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(0,a),MAIN:n?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(a,a+r)}}}var fKe={[ln]:2,[jr]:1,[oa]:1,[os]:1,[Wi]:4};function YY(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:n=fKe,matchUpFormat:r=Kc,pointsPerMinute:a=1,sideWeight:s=4}=t;if(!Ll({matchUpFormat:r}))return{error:t7};if(typeof n!="object")return{error:Ce};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(s))return{error:Ce};let o=Object.keys(n).filter(E=>Object.keys(TIe).includes(E)&&E!==kr);if(Object.keys(o).reduce((E,P)=>E+n[P],0)>100)return{error:Ce,matchUpStatusProfile:n};let l=o.reduce((E,P)=>(E.pointer=E.pointer+n[P],E.valueMap.push([E.pointer,P]),E),{pointer:0,valueMap:[]}),u=Lu(1,100),c=(l.valueMap.find(E=>u<=E[0])??[100,kr])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([ln,Wi].includes(c)){i=i||Lu(1,2);let E={score:d,matchUpStatus:c,winningSide:i};if(!(c===Wi&&Lu(1,100)>100-e))return{outcome:E}}else if([jr,oa].includes(c))return{outcome:{score:d,matchUpStatus:c}};let p=Do(r),{bestOf:h=1,exactly:f,setFormat:m,finalSetFormat:g}=p??{},v=[],y=Lu(0,1),b=i?[i-1]:[...Et(0,s).map(()=>y),1-y],I=[os,Wi,$l,xv].includes(c)&&(wl(Et(1,f||h))||1),S,w=Et(1,(f??h)+1);for(let E of w){let P=E===(f??h),{set:M,incomplete:R,winningSideNumber:N}=mKe({setFormat:P&&g||m,incomplete:I===E,pointsPerMinute:a,matchUpStatus:c,weightedRange:b,setNumber:E});if(v.push(M),R){S=N;break}if(l1({matchUp:{score:{sets:v},matchUpFormat:r}}).calculatedWinningSide)break}let T=l1({matchUp:{score:{sets:v},matchUpFormat:r,winningSide:i}}),U=S?i||S:T.calculatedWinningSide,{score:C}=PUe({winningSide:U,score:{sets:v},matchUpStatus:c});return{outcome:{winningSide:U,matchUpStatus:c,score:C}}}function mKe({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:n,setFormat:r,setNumber:a}){let s={setNumber:a},{setTo:o,tiebreakFormat:l,tiebreakAt:u,tiebreakSet:c,timed:d,minutes:p}=r,h=Lu(0,t.length-1),f=t[h],m;if(d){let g=p*e,v=Math.round(g*.2),y=g+wl([1,-1])*v,b=Dqe(y,2),I=[b,y-b];f&&I.reverse(),m=t[h]+1;let S=I[0]>I[1]&&1||I[1]>I[0]&&2||0;if(n){let[U,C]=I;return Object.assign(s,{side1Score:U,side2Score:C}),wa.includes(i)?{set:s,incomplete:n,winningSideNumber:m}:{set:s,incomplete:n}}S||(I[Lu(0,1)]+=1),S=I[0]>I[1]?1:2,S!==m&&I.reverse();let[w,T]=I;return Object.assign(s,{side1Score:w,side2Score:T,winningSide:m}),{set:s}}else{if(n)return s.side1Score=Lu(0,u),s.side2Score=Lu(0,u),wa.includes(i)&&(m=t[h]+1),{set:s,incomplete:n,winningSideNumber:m};{let g=Et(1,o+1).map(T=>Et(0,o+2-T).map(()=>T)).flat(),v=g[Lu(0,g.length-1)],y=o&&_9({isSide1:!0,tiebreakAt:u,lowValue:v,setTo:o}),b=!y,I=t.length===1&&t[h]+1;if(!b){I?(y[0]>y[1]?1:2)!==I&&y.reverse():f&&y.reverse();let[T,U]=y;Object.assign(s,{side1Score:T,side2Score:U})}let S=s1({matchUpScoringFormat:{setFormat:r},setObject:s}),w;if(S.hasTiebreakCondition||b){let{NoAD:T,tiebreakTo:U}=l||c||{},C=Et(1,U+1).map(M=>Et(0,U+2-M).map(()=>M)).flat(),E=C[Lu(0,C.length-1)],P=wB({isSide1:!0,tiebreakNoAd:T,tiebreakTo:U,lowValue:E});if(P)if(b){let M=P[0]>P[1]?1:2;I?M!==I&&P.reverse():f&&P.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=P,w=P[0]>P[1]&&1||P[1]>P[0]&&2||void 0}else S.leadingSide===2?[s.side1TiebreakScore,s.side2TiebreakScore]=P:[s.side2TiebreakScore,s.side1TiebreakScore]=P}s.winningSide=S.winningSide||S.leadingSide||I||w}}return{set:s}}function kx(t){var e,i,n;let{matchUpStatusProfile:r,completeAllMatchUps:a,randomWinningSide:s,tournamentRecord:o,completionGoal:l,drawDefinition:u,event:c}=t;if(!u)return{error:Lt};let d=t.matchUpFormat||u.matchUpFormat||c?.matchUpFormat,p=u.structures.slice().sort(k0),h=0,{matchUps:f,matchUpsMap:m}=pa({matchUpFilters:{matchUpTypes:[zn],roundNumbers:[1]},contextFilters:{stages:[_t,Kt]},inContext:!0,drawDefinition:u});if(f!=null&&f.length){let I=((e=c?.category)==null?void 0:e.ageCategoryCode)||((i=c?.category)==null?void 0:i.categoryName);if(I){let S=nUe({singlesOnly:!0,tournamentRecord:o,drawDefinition:u,scaleAccessor:{scaleName:I,sortOrder:iUe,scaleType:iv},event:c});if(S.error)return S;let{lineUps:w,participantsToAdd:T}=S;dd({tournamentRecord:o,participants:T}),dn({element:u,extension:{name:Rm,value:w}})}else{let S=(n=f[0])==null?void 0:n.structureId,{positionAssignments:w}=Fn({drawDefinition:u,structureId:S});if(w!=null&&w.length){let{participants:T}=hr({participantFilters:{participantTypes:[zn]},tournamentRecord:o}),U=C=>{let E=C.tieMatchUps.filter(xr(Mn)),P=C.tieMatchUps.filter(xr(En));E.forEach((M,R)=>{let N=M.matchUpId;M.sides.forEach(A=>{var _;let{drawPosition:x}=A,O=T?.find($=>{var F;let{participantId:j}=$;return((F=w.find(H=>H.participantId===j))==null?void 0:F.drawPosition)===x});if(O){let $=(_=O.individualParticipantIds)==null?void 0:_[R];$&&Nx({teamParticipantId:O.participantId,participantId:$,tournamentRecord:o,drawDefinition:u,tieMatchUpId:N,event:c})}})}),P.forEach((M,R)=>{let N=M.matchUpId;M.sides.forEach(A=>{var _,x;let{drawPosition:O}=A,$=T?.find(F=>{var j;let{participantId:H}=F;return((j=w.find(G=>G.participantId===H))==null?void 0:j.drawPosition)===O});$&&((x=(_=$.individualParticipantIds)==null?void 0:_.slice(R*2,R*2+2))==null||x.forEach(F=>{Nx({teamParticipantId:$.participantId,participantId:F,tournamentRecord:o,drawDefinition:u,tieMatchUpId:N,event:c})}))})})};f.forEach(U)}}}let g=typeof a=="string"&&a,v=g&&kr,y=p.length===2&&p[0].finishingPosition===ob&&Pr(p.map(({stage:I})=>I),[_t,Tr]).length===2,b=p.map(({structureId:I})=>I);for(let I of b){if(h>=l)break;let S=u.structures.find(U=>U.structureId===I),w=vn({contextFilters:{matchUpTypes:[En,Mn]},afterRecoveryTimes:!1,tournamentRecord:o,inContext:!0,drawDefinition:u,matchUpsMap:m,structure:S,event:c}).matchUps;w.length;let T=w.filter(({winningSide:U})=>!U).sort(j0).map(Na);for(let U of T){if(!isNaN(l)&&h>=l)break;let{matchUps:C}=vn({matchUpFilters:{matchUpTypes:[En,Mn]},afterRecoveryTimes:!1,tournamentRecord:o,inContext:!0,drawDefinition:u,matchUpsMap:m,structure:S,event:c}),E=C.find(M=>M.matchUpId===U),P=[jr,oa].includes(E.matchUpStatus);if(E!=null&&E.readyToScore&&!P){let M=gKe({matchUpStatusProfile:r,tournamentRecord:o,drawDefinition:u,targetMatchUp:E,matchUpFormat:d,matchUpStatus:v,scoreString:g,winningSide:!s&&1,event:c});if(M!=null&&M.error)return M;h+=1}}y&&S.finishingPosition===ob&&t.completeRoundRobinPlayoffs&&WD({structureId:S.structureId,applyPositioning:!0,drawDefinition:u})}return{...ue,completedCount:h}}function zUe(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:n,drawDefinition:r,targetMatchUp:a,matchUpStatus:s,matchUpFormat:o,scoreString:l,winningSide:u,event:c}=t;if(!a||a.matchUpStatus===fn)return;let{matchUpId:d}=a||{},{outcome:p}=VY({matchUpFormat:o,matchUpStatus:s,scoreString:l,winningSide:u});return e&&(p.matchUpStatusCodes=e),TN({tournamentRecord:n,policyDefinitions:i,drawDefinition:r,matchUpFormat:o,matchUpId:d,outcome:p,event:c})}function gKe(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:n,drawDefinition:r,matchUpStatus:a,matchUpFormat:s,targetMatchUp:o,scoreString:l,winningSide:u,event:c}=t;if(l||a)return zUe(t);let{matchUpId:d}=o||{},{outcome:p}=YY({matchUpStatusProfile:e,matchUpFormat:s,winningSide:u});return TN({policyDefinitions:n,tournamentRecord:i,drawDefinition:r,matchUpFormat:s,matchUpId:d,outcome:p,event:c})}function qUe({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:n,drawProfiles:r,isMock:a,event:s}){var o,l,u,c;let d=Rr({event:s}).flightProfile,{eventName:p,eventType:h,category:f}=s,{startDate:m}=n,g=[],v=f?.categoryName||f?.ageCategoryCode||f?.ratingType,y=(o=s.drawDefinitions)==null?void 0:o.map(({drawId:b})=>b);if(Array.isArray(d?.flights))for(let[b,I]of d.flights.entries()){let{drawId:S,stage:w,drawName:T,drawEntries:U}=I;g.push(I.drawId);let C=r[b],{seedsCount:E,generate:P=!0}=C||{};if(P){let M=U.filter(Bl(lf)).map(Bl(lf)),R=v||p;if(n&&E&&E<=M.length&&Et(1,E+1).forEach((O,$)=>{let F={scaleValue:O,scaleName:R,scaleType:Lh,eventType:h,scaleDate:m},j=M[$];hN({tournamentRecord:n,participantId:j,scaleItem:F})}),y?.includes(S))break;let N=bN({...C,matchUpType:h,seedingScaleName:R,tournamentRecord:n,drawEntries:U,drawName:T,drawId:S,isMock:a,event:s,stage:w});if(N.error)return{error:N.error,drawIds:[]};let{drawDefinition:A}=N;if(!A)return{error:fu};let _=(l=r[b])==null?void 0:l.drawExtensions;if(Array.isArray(_)&&_.filter(Wp).forEach(O=>dn({element:A,extension:O})),N=IN({suppressNotifications:!0,tournamentRecord:n,drawDefinition:A,event:s}),N.error)return{error:N.error,drawIds:[]};if(C!=null&&C.withPlayoffs){let O=(u=A.structures)==null?void 0:u[0].structureId,$=uB({idPrefix:C.idPrefix,...C.withPlayoffs,tournamentRecord:n,drawDefinition:A,structureId:O,isMock:a,event:s});if($!=null&&$.error)return $}let x=C?.completionGoal;if(C?.automated!==!1&&(e||x)){let O=C?.matchUpFormat,$=kx({completeAllMatchUps:!x&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,completionGoal:x,drawDefinition:A,matchUpFormat:O,event:s});if($.error)return{error:$.error,drawIds:[]};let F=$.completedCount;if(C?.drawType===of){let j=(c=A.structures)==null?void 0:c.find(W=>W.stage===_t);if(!j)return{error:pr};let H=WD({structureId:j.structureId,tournamentRecord:n,drawDefinition:A});if(H.error)return{error:H.error,drawIds:[]};let G=x?x-(F??0):void 0;if(H=kx({completeAllMatchUps:!x&&e,completionGoal:x?G:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,drawDefinition:A,matchUpFormat:O,event:s}),H.error)return{error:H.error,drawIds:[]}}}}}return{...ue,drawIds:g}}function WUe(t){var e,i;let{participantsProfile:n={},uniqueParticipantsCount:r,ratingsParameters:a,tournamentRecord:s,eventProfile:o,eventIndex:l,event:u,uuids:c}=t,{category:d,gender:p,eventType:h}=u,f=xr(zp)(h)&&Hi||xr(Ju)(h)&&Ai||h,m=r[_t]||0,g=r[Kt]||0,v=(e=o.drawProfiles)!=null&&e.length?m+g:((i=o.participantsProfile)==null?void 0:i.participantsCount)??0,y=[Un,Gn].includes(p)?p:void 0,b=n!=null&&n.idPrefix?`E-${l}-${n?.idPrefix}`:void 0,{participants:I}=rE({uuids:o.uuids||c,...n,scaledParticipantsCount:o.scaledParticipantsCount,consideredDate:s?.startDate,rankingRange:o.rankingRange,participantType:f,participantsCount:v,ratingsParameters:a,category:d,idPrefix:b,sex:y}),S=dd({tournamentRecord:s,participants:I});if(S.error)return S;let w=I?.filter(({participantType:U})=>U===f),T=I?.map(Gi);return{uniqueDrawParticipants:w,uniqueParticipantIds:T}}function vKe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:n,event:r}){let{drawType:a=Rp,qualifyingPositions:s=0,stage:o=_t,drawSize:l=0,drawName:u,drawId:c}=n,d=l-s,p=i.slice(0,d).map(Gi);if(p.length){let m=Mp({participantIds:p,autoEntryPositions:t,entryStage:o,tournamentRecord:e,event:r});if(m.error)return m}let h=p.map(m=>({entryStatus:cl,entryStage:o,participantId:m})),f=VB({drawName:u||a,qualifyingPositions:s,drawEntries:h,drawId:c,event:r,stage:o});return f.error?f:{...ue}}function YUe({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:n,drawProfiles:r,category:a,gender:s,event:o}){let l=0;for(let u of r){let{qualifyingPositions:c=0,uniqueParticipants:d,stage:p=_t,drawSize:h=0}=u,f=h-c,m=d||s||a||p===Kt,g=m?t.slice(l,l+f):i[p||_t]||[];m&&(l+=f);let v=vKe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:n,drawProfile:u,event:o});if(v.error)return v}return{...ue}}function KUe(t){var e;let{allUniqueParticipantIds:i,matchUpStatusProfile:n,participantsProfile:r,completeAllMatchUps:a,autoEntryPositions:s,hydrateCollections:o,randomWinningSide:l,ratingsParameters:u,tournamentRecord:c,eventProfile:d,eventIndex:p,publish:h,isMock:f,uuids:m}=t,g=d.gender,v=d.eventName,{eventType:y=zp,policyDefinitions:b,drawProfiles:I=[],eventExtensions:S,surfaceCategory:w,tieFormatName:T,processCodes:U,discipline:C,eventLevel:E,timeItems:P,ballType:M,category:R}=d,N=d.eventId||gn(),A=d.tieFormat||(y===aa?Um({namedFormat:T,event:{eventId:N,category:R,gender:g},hydrateCollections:o,isMock:f}):void 0),_=c.participants;for(let ne of I)!g&&ne.gender&&(g=ne?.gender);let{stageParticipantsCount:x,uniqueParticipantsCount:O,uniqueParticipantStages:$}=GUe({drawProfiles:I,category:R,gender:g}),F=xr(zp)(y)&&Hi||xr(Ju)(y)&&Ai||y,{uniqueDrawParticipants:j=[],uniqueParticipantIds:H=[]}=$?WUe({event:{eventType:y,category:R,gender:g},uniqueParticipantsCount:O,participantsProfile:r,ratingsParameters:u,tournamentRecord:c,eventProfile:d,eventIndex:p,uuids:m}):{},{eventAttributes:G}=d;typeof G!="object"&&(G={});let W=R?.categoryName||R?.ageCategoryCode||R?.ratingType;v=v||W||"Generated Event";let q={...G,surfaceCategory:w,processCodes:U,discipline:C,eventLevel:E,eventName:v,eventType:y,tieFormat:A,ballType:M,category:R,eventId:N,gender:g};if(S!=null&&S.length&&Array.isArray(S)){let ne=S.filter(Wp);ne!=null&&ne.length&&Object.assign(q,{extensions:ne})}if(Array.isArray(P)&&P.forEach(ne=>W0({event:Q,timeItem:ne})),typeof b=="object")for(let ne of Object.keys(b))fb({policyDefinitions:{[ne]:b[ne]},event:q});q.category&&(q.category.categoryName=W);let Z,K=JD({suppressNotifications:!1,internalUse:!0,tournamentRecord:c,event:q});if(K.error)return K;let Q=K?.event,{stageParticipants:J}=HUe({allUniqueParticipantIds:i,stageParticipantsCount:x,eventParticipantType:F,targetParticipants:_});if(I!=null&&I.length){let ne=YUe({uniqueDrawParticipants:j,autoEntryPositions:s,stageParticipants:J,tournamentRecord:c,drawProfiles:I,category:R,gender:g,event:Q});if(ne.error)return ne;let re=qUe({matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:c,drawProfiles:I,isMock:f,event:Q});if(re.error)return re;Z=re.drawIds}else if((e=d?.participantsProfile)!=null&&e.participantsCount){let ne=j.map(Gi);if(ne.length){let re=Mp({participantIds:ne,autoEntryPositions:s,tournamentRecord:c,entryStage:_t,event:Q});if(re.error)return re}}return h&&eE({tournamentRecord:c,event:Q}),{drawIds:Z,eventId:N,uniqueParticipantIds:H}}function KY({tournamentRecords:t,scheduleDate:e,venueId:i,round:n}){if(!Pl(e))return{error:za};let r="addSchedulingProfileRound",{extension:a}=ki({name:Pw,tournamentRecords:t,discover:!0}),s=a?.value||[],o=s.find(p=>af(e,p.scheduleDate));if(!o){let{startDate:p,endDate:h}=UB({tournamentRecords:t}),f=new Date(e);if(p&&f<new Date(p)||h&&f>new Date(h))return{error:za};o={scheduleDate:e,venues:[]},s.push(o)}let l=o.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},o.venues.push(l));let u=["notBeforeTime"],c=p=>Object.keys(p).filter(h=>!u.includes(h)).sort().map(h=>Qi(p[h])?c(p[h]):p[h]).flat().join("|");if(l.rounds.find(p=>c(p)===c(n)))return pe({result:{error:qve},stack:r});l.rounds.push(n);let d=ZD({tournamentRecords:t,schedulingProfile:s});return d.error?d:{...ue}}function yKe({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:Ce};let i=VD({tournamentRecord:e}).containedStructures,n=Qa({tournamentRecord:e}).matchUps??[],{tournamentId:r}=e,a=[];for(let s of t){let{scheduleDate:o,venues:l=[]}=s;for(let u of l){let{rounds:c,venueId:d}=u;for(let p of c){let{drawId:h,winnerFinishingPositionRange:f,roundSegment:m}=p,g=n.filter(v=>{var y;let b=f?.indexOf("-")>0&&f.split("-").map(S=>+S),I=(y=v.finishingPositionRange)==null?void 0:y.winner;return v.drawId===h&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!I||!b||Pr(I,b).length===2||Si(I).length===Si(b).length&&Pr(I,b).length===Si(I).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:b,structureName:I,roundName:S}=g,w=g.structureId;y&&!f&&(w=Object.keys(i).find(C=>i[C].includes(w))??w);let T={tournamentId:r,structureId:w,roundNumber:y,roundSegment:m,eventId:v,drawId:h},U=KY({tournamentRecords:{[r]:e},round:T,scheduleDate:o,venueId:d});if(U.error)return U;a.push({structureName:I,roundName:S,drawName:b,...T})}}}}return{scheduledRounds:a}}function e2(t){var e,i,n;let r=Yt(t,[{drawProfile:!0,_ofType:el}]);if(r.error)return r;let{allUniqueParticipantIds:a=[],participantsProfile:s={},matchUpStatusProfile:o,completeAllMatchUps:l,autoEntryPositions:u,hydrateCollections:c,randomWinningSide:d,ratingsParameters:p,tournamentRecord:h,isMock:f=!0,drawProfile:m,startDate:g,drawIndex:v,uuids:y}=t,b=At(m,!1,!0),{excessParticipantAlternates:I=!0,matchUpFormat:S=Kc,drawType:w=Rp,tournamentAlternates:T=0,alternatesCount:U=0,qualifyingPositions:C,qualifyingProfiles:E,generate:P=!0,eventExtensions:M,drawExtensions:R,completionGoal:N,tieFormatName:A,buildTeams:_,seedsCount:x,timeItems:O,drawName:$,category:F,idPrefix:j,publish:H,gender:G,stage:W}=b,q=b.drawSize||(b.ignoreDefaults?void 0:32),Z=b.eventId||gn(),K=m.eventType||m.matchUpType||zp,Q=K===Ju?Ai:Hi,J=Qi(m.tieFormat)&&m.tieFormat||K===Sn&&Um({event:{eventId:Z,category:F,gender:G},namedFormat:A,hydrateCollections:c,isMock:f})||void 0,ne=F?.categoryName||F?.ageCategoryCode||F?.ratingType,re=m.eventName||ne||`Generated ${K}`,oe=h?.participants||[],de=(E?.map(_e=>_e.structureProfiles||[]).flat().reduce((_e,Ye)=>{let Je=!Ye.participantsCount||Ye.participantsCount>Ye.drawSize?Ye.drawSize:Ye.participantsCount||0;return _e+Je},0)||0)*(Q===Ai?2:1),se=(!m.participantsCount||m.participantsCount>q?q:m.participantsCount)||0,ge={eventName:re,eventType:K,tieFormat:J,category:F,eventId:Z,gender:G};Array.isArray(O)&&O.forEach(_e=>W0({event:ge,timeItem:_e}));let{eventAttributes:ye}=m;if(typeof ye!="object"&&(ye={}),Object.assign(ge,ye),M?.length&&Array.isArray(M)){let _e=M.filter(Wp);_e!=null&&_e.length&&Object.assign(ge,{extensions:_e})}let Te=[];if(s?.participantsCount===0||m.uniqueParticipants||de||!h||G||F){let _e=(se||0)+U+de,Ye=_e,Je={[Un]:0,[Gn]:0},ct,pt;K===Sn&&({teamSize:ct,genders:pt}=WY({alternatesCount:U,tieFormatName:A,tieFormat:J,drawSize:q}),Object.keys(pt).forEach(we=>{[Un,Gn].includes(we)&&pt[we]&&(Je[we]=q*pt[we])}),Ye=ct*((q||0)+de));let Se=s!=null&&s.idPrefix?`D-${v}-${s?.idPrefix}`:void 0,he=rE({...s,scaledParticipantsCount:m.scaledParticipantsCount||s.scaledParticipantsCount,participantsCount:Ye,consideredDate:h?.startDate,sex:G||s?.sex,rankingRange:m.rankingRange,uuids:m.uuids||y,ratingsParameters:p,participantType:Q,gendersCount:Je,idPrefix:Se,category:F}).participants;if(ge.category&&(ge.category.categoryName=ne),h){let we=dd({participants:he,tournamentRecord:h});if(we.error)return we}if(he.forEach(({participantId:we})=>Te.push(we)),oe=he,K===Sn){let we=pt[Un]?he.filter(({participantType:Qe,person:bt})=>Qe===Hi&&bt?.sex===Un).map(Gi):[],be=pt[Gn]?he.filter(({participantType:Qe,person:bt})=>Qe===Hi&&bt?.sex===Gn).map(Gi):[],Ae=he.filter(({participantType:Qe})=>Qe===Hi).map(Gi).filter(Qe=>!we.includes(Qe)&&!be.includes(Qe)),ze=[...b.teamNames??[],..._x({count:_e}).names],We=ct-(pt[Un]+pt[Gn]),Le=0,ft=0,rt=0,St=Et(0,_e).map(Qe=>{let bt=be.slice(Le,Le+pt[Gn]),ci=we.slice(ft,ft+pt[Un]),Tt=Ae.slice(rt,rt+We);Le+=pt[Gn],ft+=pt[Un],rt+=We;let Li=_!==!1?[...bt,...ci,...Tt]:[];return{participantName:ze[Qe]||`Team ${Qe+1}`,participantOtherName:`TM${Qe+1}`,participantRole:ws,individualParticipantIds:Li,participantType:Sn,participantId:gn()}}),si=dd({participants:St,tournamentRecord:h});if(!si.success)return si;oe=St}}let De=_e=>{let{participantType:Ye}=_e;return xr(zp)(K)&&Ye===Hi||xr(Ju)(K)&&Ye===Ai?!0:K===Sn&&Ye===Sn},xe=_e=>{var Ye,Je;return!m.gender||((Ye=_e.person)==null?void 0:Ye.sex)===m.gender?!0:(Je=_e.individualParticipantIds)==null?void 0:Je.some(ct=>{let pt=oe.find(Se=>Se.participantId===ct);return pt&&xe(pt)})},Me=oe.filter(De).filter(xe).filter(({participantId:_e})=>!a.includes(_e)),Oe=Me.slice(0,se).map(_e=>_e.participantId);if(f&&Oe!=null&&Oe.length){let _e=Mp({autoEntryPositions:u,entryStage:W,tournamentRecord:h,participantIds:Oe,event:ge});if(_e.error)return _e}let at=de?Me.slice(se,se+de).map(_e=>_e.participantId):0;if(f&&at!=null&&at.length){let _e=0,Ye=1,Je=(pt,Se)=>pt.stageSequence-Se.stageSequence,ct=(pt,Se)=>pt.roundTarget-Se.roundTarget;for(let pt of E.sort(ct)){Ye=pt.roundTarget||Ye;let Se=1,he;for(let we of pt.structureProfiles.sort(Je)){let be=(we.drawSize||q6(we.participantsCount))-(he||0),Ae=at.slice(_e,_e+be),ze=Mp({entryStage:Kt,entryStageSequence:Se,autoEntryPositions:u,tournamentRecord:h,participantIds:Ae,roundTarget:Ye,event:ge});if(ze.error)return ze;he=we.qualifyingPositions,_e+=be,Se+=1}Ye+=1}}let Fe=I&&((e=h?.participants)==null?void 0:e.filter(({participantId:_e})=>!Oe.includes(_e)).filter(De).filter(xe).slice(0,U||q-se||T).map(_e=>_e.participantId));if(f&&Fe!=null&&Fe.length){let _e=Mp({participantIds:Fe,autoEntryPositions:!1,entryStatus:Xc,tournamentRecord:h,event:ge});if(_e.error)return _e.error}let mt=ne||re;h&&x&&x<=Oe.length&&Et(1,x+1).forEach((_e,Ye)=>{let Je={scaleName:mt,scaleDate:g,scaleType:U8,scaleValue:_e,eventType:K},ct=Oe[Ye];hN({tournamentRecord:h,participantId:ct,scaleItem:Je})});let Xe=bN({...At(m,!1,!0),tournamentRecord:h,seedingScaleName:mt,matchUpFormat:S,eventId:Z,isMock:f,event:ge});if(Xe.error)return Xe;if(!Xe.drawDefinition)return{error:fu};let{drawDefinition:gt}=Xe,ht=gt.drawId;if(Array.isArray(R)&&R.filter(Wp).forEach(_e=>dn({element:gt,extension:_e})),P){if(IN({drawDefinition:gt,event:ge,suppressNotifications:!0}),m.withPlayoffs){let Ye=(i=gt.structures)==null?void 0:i[0].structureId,Je=uB({...m.withPlayoffs,tournamentRecord:h,drawDefinition:gt,structureId:Ye,idPrefix:j,isMock:f,event:ge});if(Je!=null&&Je.error)return Je}let _e=m.automated===!1;if(f&&!_e){let Ye=Je=>{var ct;let pt=kx({completeAllMatchUps:Je.completeAllMatchUps,completionGoal:Je.completionGoal,matchUpStatusProfile:o,randomWinningSide:d,tournamentRecord:h,drawDefinition:gt,matchUpFormat:S,event:ge});if(pt.error)return pt;let Se=pt.completedCount;if(w===of){let he=(ct=gt.structures)==null?void 0:ct.find(Ae=>Ae.stage===_t);if(!he)return{error:pr};WD({structureId:he.structureId,tournamentRecord:h,drawDefinition:gt});let we=N?N-(Se??0):void 0,be=kx({completionGoal:N?we:void 0,matchUpStatusProfile:o,completeAllMatchUps:l,randomWinningSide:d,tournamentRecord:h,drawDefinition:gt,matchUpFormat:S,event:ge});if(be.error)return be}};if(N&&Ye({completionGoal:N}),m.outcomes){let{matchUps:Je}=ho({inContext:!0,drawDefinition:gt,event:ge});for(let ct of m.outcomes){let{matchUpStatus:pt=kr,matchUpStatusCodes:Se,stageSequence:he=1,matchUpIndex:we=0,structureOrder:be,matchUpFormat:Ae,drawPositions:ze,roundPosition:We,stage:Le=_t,roundNumber:ft,winningSide:rt,scoreString:St}=ct,si=Je?.reduce((Tt,Li)=>{let{structureId:Jt,matchUpId:Yi}=Li;return Tt[Jt]?Tt[Jt].push(Yi):Tt[Jt]=[Yi],Tt},{})??[],Qe=Object.assign({},...Object.keys(si).map((Tt,Li)=>({[Tt]:Li+1}))),bt=(n=Je?.filter(Tt=>(!Le||Tt.stage===Le)&&(!he||Tt.stageSequence===he)&&(!ft||Tt.roundNumber===ft)&&(!We||Tt.roundPosition===We)&&(!be||Qe[Tt.structureId]===be)&&(!ze||Pr(ze,Tt.drawPositions).length===2)))==null?void 0:n[we],ci=zUe({matchUpStatusCodes:Se,tournamentRecord:h,drawDefinition:gt,targetMatchUp:bt,matchUpFormat:Ae,matchUpStatus:pt,scoreString:St,winningSide:rt});if(ci!=null&&ci.error)return ci}}l&&Ye({completeAllMatchUps:l})}H&&eE({tournamentRecord:h,event:ge})}else{let _e=VB({drawEntries:gt.entries,drawName:$||w,qualifyingPositions:C,drawId:ht,event:ge,stage:W});if(_e.error)return _e}return{...ue,event:Gt(ge),uniqueParticipantIds:Te,targetParticipants:oe,drawDefinition:gt,eventId:Z,drawId:ht}}var ZUe=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),bKe=ZUe;function xx(t){return parseInt(t)}function uee({startTime:t="",endTime:e=""}={}){if(!t||!e||!wy.test(t)||!wy.test(e))return!1;let[i,n]=t.split(":").map(xx),[r,a]=e.split(":").map(xx);return r<i?!1:!(i===r&&a<n)}function IKe(t,e){let[i,n]=t.startTime.split(":").map(xx),[r,a]=e.startTime.split(":").map(xx);return i<r?-1:i>r?1:n<a?-1:n>a?1:0}function XUe({dateAvailability:t}){if(!t)return{error:oye};if(!Array.isArray(t))return{error:U_};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let n of t){if(typeof n!="object")return{error:U_};let{date:r,startTime:a,endTime:s,bookings:o=[]}=n;if(!a||!s)return{error:U_};if(r&&!Hp.test(r))return{error:za,dateAvailability:{date:r},info:e};if(!wy.test(a))return{error:Ec,dateAvailability:{startTime:a},info:i};if(!wy.test(s))return{error:Ec,dateAvailability:{endTime:s},info:i};if(a===s)return{error:Ec,dateAvailability:{startTime:a,endTime:s},info:"startTime and endTime are equivalent"};if(!uee({startTime:a,endTime:s}))return{error:Ec,dateAvailability:{startTime:a,endTime:s},info:"endTime must be after startTime"};if(o){if(!Array.isArray(o))return{error:rx};for(let l of o){if(typeof l!="object")return{error:rx};let{startTime:u,endTime:c}=l;if(!wy.test(u))return{error:Ec,booking:{startTime:u},info:i};if(!wy.test(c))return{error:Ec,booking:{endTime:c},info:i};if(u===c)return{error:Ec,dateAvailability:{startTime:u,endTime:c},info:"startTime and endTime are equivalent"};if(!uee({startTime:u,endTime:c}))return{error:Ec,dateAvailability:{startTime:u,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function t2({tournamentRecord:t,disableNotice:e,venueId:i,courtId:n,court:r}){let{venue:a}=bf({tournamentRecord:t,venueId:i});if(!a)return{error:C0};a.courts||(a.courts=[]);let s={...ZUe(),venueId:i,courtId:n};if(s.courtId||(s.courtId=gn()),a.courts.some(o=>o.courtId===s.courtId))return{error:Uye};{let o=(r?.dateAvailability||[]).map(c=>{var d;return{...c,date:Ci(c.date),startTime:er(c.startTime),endTime:er(c.endTime),bookings:(d=c.bookings)==null?void 0:d.map(({startTime:p,endTime:h,bookingType:f})=>({startTime:er(p),endTime:er(h),bookingType:f}))}}),l=Object.keys(s);for(let c of l)if(r!=null&&r[c])if(c==="dateAvailability"){let d=XUe({dateAvailability:o});if(!d.valid&&d.error)return d;s.dateAvailability=o}else s[c]=r[c];let u=s;return a.courts.push(u),e||Ui({payload:{venue:a,tournamentId:t.tournamentId},topic:jb,key:a.venueId}),{...ue,court:At(s),venueId:i}}}function ZY(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:Nv};let n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r=[],a;for(let s of Object.values(n)){let{venue:o}=bf({tournamentRecord:s,venueId:i});if(o){let l=wKe({...t,tournamentRecord:s});for(let u of l?.courts??[])r.push(u?.courtId);if(l.error)return l;a=!0}}return a?{...ue,courtIds:r}:{error:C0}}function wKe({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:n,courtNames:r=[],courtTimings:a,courtsCount:s,startTime:o,courtIds:l,endTime:u,idPrefix:c,venueId:d,dates:p}){if(!d)return{error:Nv};let h=bf({tournamentRecord:n,venueId:d});if(h.error)return h;let{venue:f}=h;if(!Ir(s)||!r)return{error:Tye};s=s??r.length;let m=Et(0,s).map(g=>{let v=a?.[g],y=v?p.map(b=>({date:Yc(b),startTime:o,endTime:u,...v})):e;return v&&o&&u&&y.push({startTime:o,endTime:u}),{courtName:r[g]||i&&f?.venueAbbreviation&&`${f?.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=l?.pop()||c&&`${c}-${v+1}`;return t2({disableNotice:!0,tournamentRecord:n,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return m.length!==s?pe({info:"not all courts could be generated",result:{error:Ce}}):(f&&Ui({payload:{venue:f,tournamentId:n.tournamentId},topic:jb,key:f.venueId}),{...ue,courts:At(m)})}function XY({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:n}){let{startDate:r,endDate:a}=t,s=[];for(let[o,l]of i.entries()){let{venueAbbreviation:u,venueId:c=n?.pop()??gn(),dateAvailability:d,startTime:p="07:00",endTime:h="19:00",courtTimings:f,courtsCount:m,courtNames:g,venueName:v,idPrefix:y,courtIds:b}=l,I={venueName:v||`Venue ${o+1}`,venueAbbreviation:u,venueId:c},S=HM({tournamentRecord:t,venue:I});if(S.error){if(e)continue;return S}s.push(c);let w=rU(r,a),T=!Array.isArray(d)&&[{startTime:p,endTime:h}].concat(w.map(U=>({date:Yc(U),startTime:p,endTime:h})));if(m||g){let U=ZY({dateAvailability:d||T,tournamentRecord:t,courtTimings:f,courtsCount:m,courtNames:g,startTime:p,idPrefix:y,courtIds:b,endTime:h,venueId:c,dates:w});if(U.error)return U}}return s}function SKe(t){var e,i,n;let{tournamentRecord:r,leagueProfiles:a,eventIds:s,venueIds:o,drawIds:l,allUniqueParticipantIds:u,uuids:c}=t,d=0;for(let h of a){let f=[],{tieFormatName:m=cx,teamProfiles:g=[],teamsCount:v=0,category:y,idPrefix:b,gender:I}=h,S=h.leagueName??h.eventName??`League ${d+1}`,w=h.leagueId??h.eventId??c?.pop()??gn();s.push(w);let T=Qi(h.tieFormat)&&h.tieFormat||Um({event:{eventId:w,category:y,gender:I},namedFormat:m,isMock:t.isMock})||void 0;if(!T)return{error:MD};let U=Math.max(v,g.length),C=Et(0,U),{genders:E,teamSize:P}=WY({tieFormat:T,drawSize:U}),M={[Gn]:0,[ko]:0,[Iy]:0,[Un]:0,[qd]:0};Object.keys(E).forEach(N=>M[N]+=E[N]);for(let N of C){let A=((e=g?.[N])==null?void 0:e.teamName)??`Team ${N+1}`,_=((i=g?.[N])==null?void 0:i.teamId)||c?.pop()||gn(),x=h.startDate??t.startDate,O=rE({...h?.participantsProfile,participantsCount:P,consideredDate:x,gendersCount:M,category:y,uuids:c}).participants,$=O.map(q=>q.participantId),F=Sn,j=_??Ax({participantType:F,idPrefix:b,index:N,uuids:c});f.push({participantId:j,entryStatus:cl,entryStage:_t});let H=((n=g?.[N])==null?void 0:n.venueIds)??[],G={participantId:j,participantRole:ws,participantName:A,individualParticipantIds:$,participantType:F,homeVenueIds:H};H.forEach(q=>!o.includes(q)&&o.push(q)),u.push(...$),u.push(j);let W=dd({participants:[G,...O],tournamentRecord:r});if(W.error)return W}let R={eventName:S,entries:f,eventType:Sn,tieFormat:T,category:y,eventId:w,gender:I};if(r.events||(r.events=[]),r.events.push(R),f.length){let N=(Ir(h.roundsCount)&&h.roundsCount)??h.roundsCount===dWe?(U-1)*2:U-1,A=bN({automated:h.automated,tournamentRecord:r,drawType:gu,roundsCount:N,drawSize:U,event:R});if(A.error)return A;let{drawDefinition:_}=A;if(_){let x=_?.drawId;IN({drawDefinition:_,event:R,suppressNotifications:!0}),l.push(x)}}d++}let p=o.map(h=>({venueId:h}));XY({tournamentRecord:r,ignoreExistingVenues:!0,venueProfiles:p,uuids:c})}var TKe=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function JUe(t){var e,i,n;let{startDate:r,endDate:a}=t??{},{tournamentName:s=wl(TKe),ratingsParameters:o=Ra,tournamentExtensions:l,policyDefinitions:u,schedulingProfile:c,venueProfiles:d,uuids:p}=t??{},h=t?.isMock===!1?void 0:!0;if(r&&!Pl(r)||a&&!Pl(a))return{error:za};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:Ce};if(!r){let S=new Date;r=Yc(a??S),a=Yc(S.setDate(S.getDate()+7))}if(!a){let S=new Date(r);a=Yc(S.setDate(S.getDate()+7))}let f=QB({...t.tournamentAttributes??{},tournamentName:s,startDate:r,endDate:a,isMock:h}),m=d!=null&&d.length?XY({tournamentRecord:f,venueProfiles:d,uuids:p}):[];if(l!=null&&l.length&&Array.isArray(l)){let S=l.filter(w=>Wp({extension:w}));S!=null&&S.length&&Object.assign(f,{extensions:S,isMock:h})}if(typeof u=="object")for(let S of Object.keys(u))fb({policyDefinitions:{[S]:u[S]},tournamentRecord:f});if(!((e=t?.leagueProfiles)!=null&&e.length)||(i=t.eventProfiles)!=null&&i.length||(n=t.drawProfiles)!=null&&n.length||t.participantsProfile){let S=jUe({tournamentRecord:f,...t});if(!S.success)return S}let g=[],v=[],y=[];if(t.leagueProfiles){let S=SKe({allUniqueParticipantIds:g,tournamentRecord:f,...t,eventIds:v,venueIds:m,drawIds:y});if(S!=null&&S.error)return S}if(t.drawProfiles){let S=UKe({allUniqueParticipantIds:g,ratingsParameters:o,tournamentRecord:f,...t,eventIds:v,drawIds:y});if(S!=null&&S.error)return S}if(t.eventProfiles){let S=DKe({allUniqueParticipantIds:g,ratingsParameters:o,tournamentRecord:f,...t,eventIds:v,drawIds:y});if(S!=null&&S.error)return S}let{scheduledRounds:b=void 0,schedulerResult:I={}}=c?EKe({...t,tournamentRecord:f}):{};return w7(),Gt({...ue,tournamentRecord:f,scheduledRounds:b,schedulerResult:I,eventIds:v,venueIds:m,drawIds:y})}function UKe(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:n,eventIds:r,drawIds:a}=t,s=0;for(let o of i){let l=e2({allUniqueParticipantIds:n,tournamentRecord:e,drawProfile:o,drawIndex:s,...t});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if(o?.addEvent!==!1){if(l=JD({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;u&&a.push(u),r.push(c)}p!=null&&p.length&&n.push(...p),s+=1}}function DKe(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:n,drawIds:r}=t,a=0;for(let s of e){let o=KUe({...t,eventIndex:a,eventProfile:s});if(o.error)return o;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=o;u&&r.push(...u),n.push(l),c!=null&&c.length&&i.push(...c),a+=1}}function EKe(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:n,periodLength:r,scheduleCompletedMatchUps:a}=t,s=yKe({schedulingProfile:e,tournamentRecord:i});if(s.error)return s;let o=s.scheduledRounds;if(n){let{tournamentId:l}=i,u={[l]:i};return{schedulerResult:JB({scheduleCompletedMatchUps:a,tournamentRecords:u,periodLength:r}),scheduledRounds:o}}return{scheduledRounds:o}}var QUe={};$i(QUe,{anonymizeTournamentRecord:()=>eDe,modifyTournamentRecord:()=>tDe});function eDe({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:n,personIds:r=[],tournamentId:a}){var s,o,l,u,c;if(!i)return{error:lt};let d=Array.isArray(t)?IQ.concat(...t):IQ,p=G=>{var W;return Array.isArray(t)?(W=G?.extensions)==null?void 0:W.filter(q=>d.includes(q.name)):G?.extensions},h={};i.extensions=p(i);let f=a||gn();h[i.tournamentId]=f,i.tournamentId=f,i.createdAt=new Date().toISOString(),i.tournamentName=n||`Anonymized: ${Yc(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let G of i.participants||[]){G.extensions=p(G),G.onlineResources=[];let W=gn();h[G.participantId]=W,G.participantId=W}for(let G of i.participants||[])Array.isArray(G.individualParticipantIds)&&(G.individualParticipantIds=G.individualParticipantIds.map(W=>h[W]));let m=0;for(let G of i.venues||[]){G.venueAbbreviation=`V${m}`,G.extensions=p(G),G.venueName=`Venue #${m}`,G.onlineResources=[],G.addresses=[];let W=gn();h[G.venueId]=W,G.isMock=!0,m+=1;let q=0;for(let Z of G.courts||[])Z.courtName=`V${m}C${q}`,Z.extensions=p(Z),Z.onlineResources=[],Z.isMock=!0,q+=1}let g=1;for(let G of i.events||[]){G.extensions=p(G),G.onlineResources=[],G.isMock=!0;let W=gn();h[G.eventId]=W,G.eventId=W;let q=((s=G.category)==null?void 0:s.categoryName)||((o=G.category)==null?void 0:o.ageCategoryCode)||((l=G.category)==null?void 0:l.ratingType)||G.gender;if(G.eventName=`Event ${g} ${q}`,Array.isArray(G.entries))for(let K of G.entries)K.participantId=h[K.participantId];for(let K of G.drawDefinitions||[]){K.extensions=p(K);let Q=gn();if(h[K.drawId]=Q,K.drawId=Q,K.isMock=!0,Array.isArray(K.entries))for(let ne of K.entries)ne.participantId=h[ne.participantId];let J=ne=>{ne.extensions=p(ne);let re=gn();h[ne.structureId]=re,ne.structureId=re;for(let oe of ne.positionAssignments||[])oe.participantId&&(oe.participantId=h[oe.participantId]);for(let oe of ne.seedAssignments||[])oe.participantId&&(oe.participantId=h[oe.participantId]);for(let oe of ne.matchUps||[]){oe.isMock=!0;for(let de of oe.sides||[])de.lineUp&&(de.lineUp=de.lineUp.map(({participantId:se,collectionAssignments:ge})=>({participantId:h[se],collectionAssignments:ge})))}};for(let ne of K.structures||[])if(J(ne),Array.isArray(ne.structures))for(let re of ne.structures)J(re);for(let ne of K.links||[])ne.source.structureId=h[ne.source.structureId],ne.target.structureId=h[ne.target.structureId]}let{extension:Z}=ki({name:ld,element:G});Array.isArray((u=Z?.value)==null?void 0:u.flights)&&((c=Z?.value.flights)==null||c.forEach(K=>{if(K.drawId=h[K.drawId],Array.isArray(K.drawEntries))for(let Q of K.drawEntries)Q.participantId=h[Q.participantId]})),g+=1}let v=i.startDate||Yc(new Date),y=(i.participants||[]).filter(({participantType:G})=>G===Hi),b=y.reduce((G,W)=>{var q;let Z=(q=W.person)==null?void 0:q.sex;return[Un,Gn].includes(Z)?G[Z]+=1:G[Iy]+=1,G},{[Un]:0,[Gn]:0,[Iy]:0}),I=Object.assign({},...Object.keys(b).map(G=>{var W;return{[G]:((W=VUe({category:{ageCategoryCode:"O18"},count:b[G],personExtensions:[],consideredDate:v,sex:G}))==null?void 0:W.persons)||[]}})),S={[Un]:0,[Gn]:0,[Iy]:0},w=y.length,T=y.reduce((G,W)=>{var q,Z;let K=((Z=(q=W.person)==null?void 0:q.addresses)==null?void 0:Z[0])||{},{city:Q,state:J,postalCode:ne}=K;return G.cities.includes(Q)||G.cities.push(Q),G.states.includes(J)||G.states.push(J),G.postalCodes.includes(ne)||G.postalCodes.push(ne),G},{cities:[],postalCodes:[],states:[]}),U=T.postalCodes.length,C=T.cities.length,E=T.states.length,{cities:P}=LUe({count:C||w,participantsCount:w}),{states:M}=FUe({count:E||w,participantsCount:w}),{postalCodes:R}=$Ue({count:U||w,participantsCount:w}),N={cities:P,states:M,postalCodes:R};y.forEach((G,W)=>{var q,Z;let K=G?.person,Q=K?.sex||Iy,J=(q=Ci(K?.birthDate))==null?void 0:q.split("-")[0],ne=S[Q],re=I[Q][ne];if(S[Q]+=1,J){let[,oe,de]=((Z=re?.birthDate)==null?void 0:Z.split("-"))||[],se=[J,oe,de].join("-");re.birthDate=se}if(K!=null&&K.addresses){let oe=BUe({...N,participantIndex:W,nationalityCode:re.nationalityCode});re.addresses=[oe]}re.personId=r?.[W]||gn(),e?(re.standardFamilyName=re.lastName,re.standardGivenName=re.firstName,G.participantName=`${re.standardGivenName} ${re.standardFamilyName}`):(re.standardFamilyName=K?.standardFamilyName,re.standardGivenName=K?.standardGivenName),delete re.firstName,delete re.lastName,re.extensions=p(K),G.person=re,h[K?.personId]=re.personId}),(i.participants||[]).filter(({participantType:G})=>G===Ai).forEach(G=>{let{individualParticipantIds:W}=G;G.participantName=PKe({individualParticipantIds:W,individualParticipants:y})});let A=(i.participants||[]).filter(({participantType:G})=>G===Sn),_=A.length,x=_x({count:_}).names;A.forEach((G,W)=>{G.participantName=x[W]});let O=(i.participants||[]).filter(({participantType:G})=>G===Uu),$=O.length,F=_x({count:$,nameRoot:"Group"}).names;O.forEach((G,W)=>{G.participantName=F[W]});let{extension:j}=ki({element:i,name:Pw});Array.isArray(j?.value)&&j?.value.forEach(G=>{G.tournamentId=h[G.tournamentId],G.structureId=h[G.structureId],G.eventId=h[G.eventId],G.drawId=h[G.drawId]});let{extension:H}=ki({element:i,name:$D});return Array.isArray(H?.value)&&H?.value.forEach(G=>{G.personId=h[G.personId]}),{...ue}}function PKe({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:n})=>t.includes(n)).map(({person:n})=>n?.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function tDe(t){var e,i,n;let{ratingsParameters:r=Ra,participantsProfile:a={},matchUpStatusProfile:s,completeAllMatchUps:o,autoEntryPositions:l,hydrateCollections:u,randomWinningSide:c,schedulingProfile:d,tournamentRecord:p,autoSchedule:h,eventProfiles:f,periodLength:m,venueProfiles:g,drawProfiles:v,isMock:y,uuids:b}=t;if(!p)return{error:lt};let I=[],S=[],w=[];f?.forEach(M=>{var R;let N=(R=p.events)==null?void 0:R.find((A,_)=>M.eventIndex!==void 0&&_===M.eventIndex||M.eventName&&A.eventName===M.eventName||M.eventId&&A.eventId===M.eventId);N!=null&&N.gender&&(M.gender=N.gender)});let T=((e=p.participants)==null?void 0:e.length)||void 0;T&&a!=null&&a.idPrefix&&(a.idPrefix=`${a.idPrefix}-${T}`);let U=jUe({startDate:p.startDate,participantsProfile:a,tournamentRecord:p,eventProfiles:f,drawProfiles:v,uuids:b});if(!U.success)return U;if(f){let M=((i=p.events)==null?void 0:i.length)||0;for(let R of f){let{ratingsParameters:N}=R,A=(n=p.events)==null?void 0:n.find((_,x)=>R.eventIndex!==void 0&&x===R.eventIndex||R.eventName&&_.eventName===R.eventName||R.eventId&&_.eventId===R.eventId);if(A){let{gender:_,category:x,eventType:O}=A,{drawProfiles:$,publish:F}=R,j=xr(zp)(O)&&Hi||xr(Ju)(O)&&Ai||O;if($){let{stageParticipantsCount:H,uniqueParticipantsCount:G,uniqueParticipantStages:W}=GUe({drawProfiles:$,category:x,gender:_}),{uniqueDrawParticipants:q=[],uniqueParticipantIds:Z=[]}=W?WUe({event:{eventType:O,category:x,gender:_},uniqueParticipantsCount:G,participantsProfile:a,ratingsParameters:N,tournamentRecord:p,eventProfile:R,uuids:b}):{};I.push(...Z);let{stageParticipants:K}=HUe({targetParticipants:p.participants||[],allUniqueParticipantIds:I,stageParticipantsCount:H,eventParticipantType:j}),Q=YUe({uniqueDrawParticipants:q,autoEntryPositions:l,stageParticipants:K,tournamentRecord:p,drawProfiles:$,category:x,gender:_,event:A});if(Q.error||(Q=qUe({matchUpStatusProfile:s,completeAllMatchUps:o,randomWinningSide:c,tournamentRecord:p,drawProfiles:$,isMock:y,event:A}),Q.error))return Q;w.push(...Q.drawIds)}F&&eE({tournamentRecord:p,event:A})}else{let _=KUe({startDate:p.startDate,allUniqueParticipantIds:I,matchUpStatusProfile:s,participantsProfile:a,completeAllMatchUps:o,autoEntryPositions:l,randomWinningSide:c,ratingsParameters:N,tournamentRecord:p,eventProfile:R,eventIndex:M,uuids:b});if(_.error)return _;let{eventId:x,drawIds:O,uniqueParticipantIds:$}=_;O&&w.push(...O),S.push(x),$!=null&&$.length&&I.push(...$),M+=1}}}if(v){let M=(p.events||[]).map(R=>{var N;return((N=R.drawDefinitions)==null?void 0:N.map(()=>1))||[]}).flat().reduce((R,N)=>R+N,0);for(let R of v){let N=e2({startDate:p.startDate,allUniqueParticipantIds:I,matchUpStatusProfile:s,participantsProfile:a,completeAllMatchUps:o,autoEntryPositions:l,hydrateCollections:u,randomWinningSide:c,ratingsParameters:r,tournamentRecord:p,drawProfile:R,drawIndex:M,uuids:b});if(N.error)return N;let{drawId:A,eventId:_,event:x,uniqueParticipantIds:O}=N;if(N=JD({tournamentRecord:p,event:x,internalUse:!0}),N.error)return N;A&&w.push(A),S.push(_),O!=null&&O.length&&I.push(...O),M+=1}}let C=g!=null&&g.length?XY({tournamentRecord:p,venueProfiles:g}):[],E,P={};if(d!=null&&d.length){let M={[p.tournamentId]:p},R=ZD({tournamentRecords:M,schedulingProfile:d});if(R.error)return R;if(h){let{tournamentId:N}=p,A={[N]:p};P=JB({tournamentRecords:A,periodLength:m})}}return{totalParticipantsCount:p.participants.length,scheduledRounds:E,schedulerResult:P,...ue,eventIds:S,venueIds:C,drawIds:w}}var iDe={};$i(iDe,{addDynamicRatings:()=>T9,addIndividualParticipantIds:()=>zB,addParticipant:()=>Zp,addParticipants:()=>dd,addPenalty:()=>TDe,addPersonRequests:()=>lDe,addPersons:()=>UDe,createGroupParticipant:()=>fDe,createTeamsFromParticipantAttributes:()=>qY,deleteParticipants:()=>H0,filterParticipants:()=>ZM,findParticipant:()=>hDe,getCompetitionParticipants:()=>L9,getPairedParticipant:()=>cd,getParticipantEventDetails:()=>F9,getParticipantMembership:()=>$9,getParticipantScaleItem:()=>bU,getParticipantSchedules:()=>B9,getParticipantSignInStatus:()=>V9,getParticipantTimeItem:()=>m8,getParticipants:()=>hr,getScaleValues:()=>LD,mergeParticipants:()=>SDe,modifyIndividualParticipantIds:()=>uDe,modifyParticipant:()=>qB,modifyParticipantName:()=>mDe,modifyParticipantOtherName:()=>dDe,modifyParticipantsSignInStatus:()=>cDe,modifyPenalty:()=>IDe,modifyPersonRequests:()=>sDe,mutate:()=>nDe,participantScaleItem:()=>$h,query:()=>aTe,regenerateParticipantNames:()=>pDe,removeIndividualParticipantIds:()=>x8,removeParticipantIdsFromAllTeams:()=>Q$,removePenalty:()=>yDe,removePersonRequests:()=>oDe,removeRatings:()=>vDe,scaledTeamAssignment:()=>gDe,setParticipantScaleItem:()=>hN,setParticipantScaleItems:()=>Q0e,validateLineUp:()=>tB});var nDe={};$i(nDe,{addDynamicRatings:()=>T9,addIndividualParticipantIds:()=>zB,addParticipant:()=>Zp,addParticipants:()=>dd,addPenalty:()=>TDe,addPersonRequests:()=>lDe,addPersons:()=>UDe,createGroupParticipant:()=>fDe,createTeamsFromParticipantAttributes:()=>qY,deleteParticipants:()=>H0,findParticipant:()=>hDe,mergeParticipants:()=>SDe,modifyIndividualParticipantIds:()=>uDe,modifyParticipant:()=>qB,modifyParticipantName:()=>mDe,modifyParticipantOtherName:()=>dDe,modifyParticipantsSignInStatus:()=>cDe,modifyPenalty:()=>IDe,modifyPersonRequests:()=>sDe,regenerateParticipantNames:()=>pDe,removeIndividualParticipantIds:()=>x8,removeParticipantIdsFromAllTeams:()=>Q$,removePenalty:()=>yDe,removePersonRequests:()=>oDe,removeRatings:()=>vDe,scaledTeamAssignment:()=>gDe,setParticipantScaleItem:()=>hN,setParticipantScaleItems:()=>Q0e});function rDe(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function aDe({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let n=i.filter(({requestType:r})=>r).map(r=>{let{date:a,startTime:s,endTime:o}=r;return r.requestType===DN&&(a=Ci(a),s=er(s),o=er(o),a&&s&&o)?{date:a,startTime:s,endTime:o,requestType:r.requestType}:r}).filter(Boolean);for(let r of n)r.requestId=rDe(),t[e].push(r);return{mergeCount:n.length}}function JY(t){let{tournamentRecords:e,personRequests:i}=t,n=Yt(t,[{[Hs]:!0}]);if(n.error)return n;if(!i)return{...ue};let r=Object.values(e);for(let a of r){let s=a.participants??[],o=[];for(let l of Object.keys(i))if(nv({tournamentParticipants:s,personId:l})){let u=i[l];u.length&&o.push({personId:l,requests:u})}Object.keys(o).length&&dn({element:a,extension:{value:o,name:$D}})}return{...ue}}function sDe(t){let{tournamentRecords:e,requests:i,personId:n}=t,r=Yt(t,[{[Hs]:!0},{requests:!0,[Ho]:Os,[vu]:Ce}]);if(r.error)return r;let a=i.map(({requestId:u})=>u).filter(Boolean),{personRequests:s}=Xb({tournamentRecords:e}),o=u=>{s&&(s[u]=s[u].map(c=>{if(!a.includes(c.requestId))return c;let d=i.find(p=>p.requestId===c.requestId);if(d.requestType)return Object.assign(c,d)}).filter(Boolean))};if(n&&s!=null&&s[n])o(n);else if(s)for(let u of Object.keys(s))o(u);let l=i.filter(u=>!u.requestId);return l.length&&aDe({personRequests:s,personId:n,requests:l}),JY({tournamentRecords:e,personRequests:s})}function oDe(t){let{tournamentRecords:e,requestType:i,requestId:n,personId:r,date:a}=t,s=Yt(t,[{[Hs]:!0}]);if(s.error)return s;let{personRequests:o}=Xb({tournamentRecords:e}),l=c=>{var d;o&&(o[c]=o[c].filter(p=>(!i||p.requestType!==i)&&(!n||p.requestId!==n)&&(!a||p.date!==a)),(d=o?.[c])!=null&&d.length||delete o[c])},u=!i&&!n&&!r&&!a;if(!u){if(r&&o!=null&&o[r])l(r);else if(o)for(let c of Object.keys(o))l(c)}return u||!o||!Object.keys(o).length?po({name:$D,tournamentRecords:e,discover:!0}):JY({tournamentRecords:e,personRequests:o})}function lDe(t){let{tournamentRecords:e,personId:i,requests:n}=t,r=Yt(t,[{[Hs]:!0,[yWe]:!0},{requests:!0,[Ho]:Os,[vu]:Ce}]);if(r.error)return r;let{personRequests:a}=Xb({tournamentRecords:e}),{mergeCount:s}=aDe({personRequests:a,personId:i,requests:n});return s&&a?JY({tournamentRecords:e,personRequests:a}):{error:Ce}}function uDe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let n="modifyIndividualParticipantIds";if(!i)return pe({result:{error:lt},stack:n});if(!e||!t)return pe({result:{error:Xt},stack:n});let r=i.participants||[],a=r.find(h=>h.participantId===e);if(!a)return pe({result:{error:Ar},stack:n});if(![Sn,Uu].includes(a.participantType))return pe({result:{error:zd},context:{participantType:a.participantType},stack:n});let s=t.filter(h=>{var f;return((f=r.find(m=>m.participantId===h))==null?void 0:f.participantType)!==Hi});if(s.length)return pe({result:{error:El,invalidParticipantIds:s},stack:n});let o=a.individualParticipantIds||[],l=t.filter(h=>!o.includes(h)),u=o.filter(h=>!t.includes(h)),c=zB({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(c.error)return pe({result:c,stack:n});let d=x8({individualParticipantIds:u,groupingParticipantId:e,tournamentRecord:i});if(d.error)return pe({result:d,stack:n});let{topics:p}=lc();if(p.includes(Es)){let h=r.find(({participantId:f})=>f===e);Ui({topic:Es,payload:{tournamentId:i.tournamentId,participants:[h]}})}return{...c,...d}}function cDe({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:lt};if(!Array.isArray(e))return{error:Xt};if(![QC,kIe].includes(i))return{error:Ce,signInState:i};let n=t.participants||[];if(!n.length)return{error:yM};let r=n.map(Gi),a=e.filter(u=>!r.includes(u));if(a.length)return{error:Ce,context:{invalidParticipantIds:a}};let s=[],o=new Date().toISOString();for(let u of n){let{participantId:c}=u;if(e.includes(c)){let d=d9({duplicateValues:!1,tournamentRecord:t,participantId:c,timeItem:{itemType:AM,itemValue:i,createdAt:o}});if(d.error)return d;s.push(u)}}let{topics:l}=lc();return s.length&&l.includes(Es)&&Ui({topic:Es,payload:{tournamentId:t.tournamentId,participants:s}}),{...ue}}function dDe({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:lt};if(!e)return{error:da};let{participant:n}=Ov({tournamentRecord:t,participantId:e});if(!n)return{error:Ar};n.participantOtherName=i;let{topics:r}=lc();return r.includes(Es)&&Ui({topic:Es,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...ue}}function cee({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),n=m=>/^[a-z]*$/.test(i(m)),r=m=>/^[A-Z]*$/.test(i(m)),a=m=>/^[LAST]{4}/.test(i(m)),s=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),o=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,u=m=>m.toLowerCase().indexOf("f")<0,c=m=>m.indexOf(" ")>0;if(!e)return;let d=c(t)?" ":"",p=BH(e?.standardGivenName??""),h=BH(e?.standardFamilyName??"");if(!t)return`${p}${d}${h}`;l(t)&&!o(t)&&!s(t)&&(p=`${p[0]}.`),n(t)?(p=p.toLowerCase(),h=h.toLowerCase()):r(t)?(p=p.toUpperCase(),h=h.toUpperCase()):a(t)&&(h=h.toUpperCase());let f=`${p}${d}${h}`;return u(t)?f=h:s(t)&&(o(t)?f=`${h},${d}${p}`:f=`${h}${d}${p}`),f}function CKe({participantMap:t,participant:e,formats:i}){let{participantType:n,individualParticipantIds:r,person:a}=e,s=n&&i[n];if(n!==xo&&s){let{personFormat:o,doublesJoiner:l}=s;n===Hi&&(e.participantName=cee({person:a,personFormat:o})),n===Ai&&(e.participantName=r?.map(u=>{var c;let d=(c=t[u])==null?void 0:c.person;return cee({person:d,personFormat:o})}).filter(Boolean).join(l??"/"))}}function pDe({tournamentRecord:t,formats:e}){if(!t)return{error:lt};if(!Qi(e))return{error:Xt};let i=t.participants??[],n=Mve(i,"participantId");for(let r of i)CKe({participant:r,participantMap:n,formats:e});return{...ue}}function hDe(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}=t,s=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="string"&&typeof a!="string")return{error:Xt,stack:"publicFindParticipant"};let o,l;for(let u of Object.values(s)){l=u.tournamentId;let c=u.participants||[];if(o=nv({tournamentParticipants:c,internalUse:!0,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}),o)break}return{participant:o,tournamentId:l,...ue}}function fDe({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=wwe,tournamentRecord:n,participantId:r,groupName:a}){if(!n)return{error:lt};if(!a)return{error:Xt,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:Ce};let s=(hr({participantFilters:{participantTypes:[Hi]},tournamentRecord:n}).participants??[]).map(c=>c.participantId);for(let c of t)if(!s.includes(c))return{error:zd,participantId:c};let o=Gt({participantId:r||gn(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:Uu,participantRole:i}),l=Zp({participant:o,tournamentRecord:n});if(l.error)return l;let{topics:u}=lc();return u.includes(av)&&Ui({topic:av,payload:{tournamentId:n.tournamentId,participants:[o]}}),{...ue,participant:At(o)}}function mDe({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:lt};if(!i)return{error:da};if(!e)return{error:Xt,info:"Missing participantName"};let{participant:n}=Ov({tournamentRecord:t,participantId:i});if(!n)return{error:Ar};n.participantName=e;let{topics:r}=lc();return r.includes(Es)&&Ui({topic:Es,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...ue}}function gDe({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:n=0,scaledParticipants:r=[],teamParticipantIds:a,tournamentRecord:s,scaleAttributes:o,teamNameBase:l,teamsCount:u,eventId:c,event:d}){var p,h,f,m,g;if(!s)return{error:lt};if(!Array.isArray(a)&&!bi(u)&&!c||!bi(n)||r&&!Array.isArray(r)||o&&(typeof o!="object"||!Object.keys(o).length))return{error:Ce};if(!o&&!r.length||!r&&!(e&&o))return{error:Xt,info:"Missing scaling details"};if(c&&!a){if(d?.eventType!==Fl)return{error:rf};a=(p=d?.entries)==null?void 0:p.filter(({entryStatus:w})=>w===cl).map(Gi)}if(!(a!=null&&a.length)&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:Xt};let v=e??r.map(({participantId:w})=>w);i&&(a?.reverse(),n+=1),n>(a?.length||0)-1&&(n=0);let y=a?.slice(n).concat(...a.slice(0,n))??[],b=[];for(let w of s.participants??[]){let{participantId:T,participantType:U}=w;if(y.includes(T)){if(U!==xo)return{error:zd,participant:w};b.push(w)}}if(u&&b.length<u){let w=u-(b?.length||0),T=l??"Team",U=Et(0,w).map(M=>({participantName:`${T} ${M+1}`,participantType:xo,participantRole:ws})),{participants:C=[]}=dd({participants:U,returnParticipants:!0,tournamentRecord:s}),E=C.map(Gi),P=((h=s.participants)==null?void 0:h.filter(({participantId:M})=>E.includes(M)))??[];b.push(...P)}if(!b.length)return{error:m7};if(t)for(let w of b)w.individualParticipantIds=[];else{let w=b.map(T=>T).flat();e!=null&&e.length?v=v.filter(T=>!w.includes(T)):r=r?.filter(({participantId:T})=>!w.includes(T))}if(!(e!=null&&e.length)&&!(r!=null&&r.length))return{error:d$,info:"Nothing to be done"};if(!r.length){for(let w of s.participants??[]){let{participantId:T,participantType:U}=w;if(!v.includes(T))continue;if(U!==Hi)return{error:zd,participant:w};let C=(f=$h({scaleAttributes:o,participant:w}))==null?void 0:f.scaleItem,E=o!=null&&o.accessor?(m=C?.scaleValue)==null?void 0:m[o?.accessor]:C?.scaleValue,P={participantId:T,scaleValue:E};r.push(P)}if(!r.length)return{error:Ar}}r.sort((w,T)=>o!=null&&o.sortOrder?(T?.scaleValue||0)-(w?.scaleValue||0):(w?.scaleValue||1/0)-(T?.scaleValue||1/0));for(let w of r)if(!w.participantId)return{error:Ce,scaledParticipant:w};let I=0;for(;I<r.length;){for(let w of b){if(I+1>r.length)break;let T=r[I];w.individualParticipantIds.push(T.participantId),I++}b.reverse()}let S=b.map(Gi);for(let w of s.events??[]){if(w.eventType!==Fl)continue;let T=(w.entries??[]).filter(U=>S.includes(U.participantId));for(let U of T){let C=U.participantId,E=(g=b.find(M=>M.participantId===C))==null?void 0:g.individualParticipantIds;w.entries=(w.entries??[]).filter(M=>!E.includes(M.participantId)),(w.drawDefinitions??[]).forEach(M=>{M.entries=(M.entries??[]).filter(R=>!E.includes(R.participantId))});let{flightProfile:P}=Rr({event:w});(P?.flights||[]).forEach(M=>{M.drawEntries=(M.drawEntries||[]).filter(R=>!E.includes(R.participantId))})}}return{...ue,scaledParticipants:r}}function vDe(t){let e=Yt(t,[{[Ta]:!0,[B7]:!0},{ratingType:!1,[vs]:s=>Ra[s]}]);if(e.error)return e;let i=`${t.ratingType}.${H7}`,n=t.asDynamic?i:t.ratingType,r=[lb,Vg,t.eventType,n].join("."),a=t.tournamentRecord.participants??[];for(let s of a)s.timeItems&&(s.timeItems=s.timeItems.filter(o=>o.itemType!==r));return{...ue}}function yDe(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:gr};for(let i of Object.values(e)){let n=RKe({...t,tournamentRecord:i});if(n.error&&n.error!==nU)return n}return{...ue}}function RKe({tournamentRecord:t,penaltyId:e}){if(!t)return{error:lt};if(!e)return{error:c7};let i=t?.participants??[],n=[],r=!1,a;return i.forEach(s=>{let o=!1;s.penalties=(s.penalties??[]).filter(l=>(l.penaltyId===e&&(o=!0,r||(a=l,r=!0)),o&&n.push(s),l.penaltyId!==e))}),a&&Ui({topic:Es,payload:{tournamentId:t.tournamentId,participants:n}}),a?{...ue,penalty:a}:{error:nU}}var MKe=({penaltyId:t=gn()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),bDe=MKe;function IDe(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:gr};for(let i of Object.values(e)){let n=NKe({...t,tournamentRecord:i});if(n.error&&n.error!==nU||n.success)return n}return{error:nU}}function NKe({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:lt};if(!e)return{error:Ce,modifications:e};if(!i)return{error:c7};let n=t?.participants??[],r=Object.keys(bDe()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>r.includes(l));if(!a.length)return{error:p$};let s,o=[];return n.forEach(l=>{let u=!1;l.penalties=(l.penalties??[]).map(c=>(c.penaltyId===i&&(u=!0,a.forEach(d=>Object.assign(c,{[d]:e[d]})),s||(s=c)),c)),u&&o.push(l)}),s&&Ui({topic:Es,payload:{tournamentId:t.tournamentId,participants:o}}),s?{...ue,penalty:s}:{error:nU}}function wDe(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:Si(Object.keys(t).concat(Object.keys(e))).reduce((n,r)=>{if(!e[r])n[r]=t[r];else if(!t[r])n[r]=e[r];else if(typeof t[r]!=typeof e[r])n[r]=e[r];else if(Array.isArray(t[r]))if(i===!0||Array.isArray(i)&&i.includes(r)){let a=Si(t[r].map(s=>JSON.stringify(s)).concat(e[r].map(s=>JSON.stringify(s)))).map(s=>JSON.parse(s));n[r]=a}else n[r]=e[r];else typeof t[r]=="object"?n[r]=wDe(t[r],e[r],i):n[r]=e[r];return n},{})}function SDe({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:lt};e.participants||(e.participants=[]);let n=t.filter(Bl(lf)).map(u=>({[u.participantId]:u})),r=Object.assign({},...n),a=[];e.participants=e.participants.map(u=>{if(r[u.participantId]){let c=wDe(u,r[u.participantId],i);return a.push(c),c}return u});let s=e.participants.map(Bl(lf))||[],o=t.filter(({participantId:u})=>!s.includes(u)),{topics:l}=lc();return o.length&&(e.participants=e.participants.concat(...o),l.includes(av)&&Ui({topic:av,payload:{participants:o}})),a.length&&l.includes(Es)&&Ui({topic:Es,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:o.length,...ue}}function TDe(t){var e;let{tournamentRecord:i,participantIds:n}=t,r=t.tournamentRecords??(i&&{[i.tournamentId]:i})??{},a;for(let s of Object.values(r)){let o=(e=hr({tournamentRecord:s}).participants??[])==null?void 0:e.map(Gi).filter(l=>n.includes(l));o.length&&(a=AKe({...t,penaltyId:t.penaltyId??a,tournamentRecord:s,participantIds:o}).penaltyId)}return a?{...ue,penaltyId:a}:{error:Ar}}function AKe({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:n,penaltyType:r,extensions:a,penaltyId:s,matchUpId:o,issuedAt:l,notes:u}){if(!e)return{error:lt};if(!i)return{error:da};if(!r)return{error:Sye};let c=(e?.participants??[]).filter(h=>i.includes(h.participantId));if(!c.length)return{error:Ar};let d=new Date().toISOString(),p=Object.assign(bDe({penaltyId:s}),{refereeParticipantId:t,penaltyCode:n,penaltyType:r,matchUpId:o,createdAt:d,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach(h=>dn({element:p,extension:h})),c.forEach(h=>{h.penalties||(h.penalties=[]),h.penalties.push(p)}),Ui({topic:Es,payload:{tournamentId:e.tournamentId,participants:c}}),{...ue,penaltyId:p.penaltyId}}function UDe({participantRole:t=ws,tournamentRecord:e,persons:i}){var n;if(!e)return{error:lt};if(!Array.isArray(i))return{error:Ce};if(!Object.keys(k8).includes(t))return{error:dye};let r=(e.participants||[]).map(({person:m})=>m?.personId).filter(Boolean),a=[],s=i.filter(m=>m&&(!m.personId||!r.includes(m.personId))).map(m=>(m.personId||(m.personId=gn()),a.push(m.personId),m)),o=(m,g)=>Object.assign({},...Object.keys(m).filter(v=>!g.includes(v)).map(v=>({[v]:m[v]}))),l=s.map(m=>Gt({extensions:m.participantExtensions,timeItems:m.participantTimeItems,participantType:Hi,participantRole:t,person:o(m,["participantExtensions","participantTimeItems","pairedPersons"])})),u=0,c=0,d=dd({participants:l,tournamentRecord:e});if(d.error)return d;c=d.addedCount||0;let p=[],h=((n=hr({participantFilters:{participantTypes:[Hi]},tournamentRecord:e}))==null?void 0:n.participants)??[];if(t===ws&&i.filter(({pairedPersons:m})=>m).forEach(({personId:m,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let y=[m,v.personId].map(b=>nv({tournamentParticipants:h,personId:b})).filter(Boolean);if(y.length===2){let b=y.map(Gi);p.push(Gt({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:ws,individualParticipantIds:b,participantType:Ai}))}})}),p.length){if(d=dd({participants:p,tournamentRecord:e}),d.error)return d;u=d.addedCount||0}let f=c+u;return{...ue,addedCount:f,newPersonIds:a}}var DDe={};$i(DDe,{bulkUpdatePublishedEventIds:()=>K9,getAllEventData:()=>Z9,getCourtInfo:()=>Y$,getDrawData:()=>EB,getEventData:()=>PB,getEventPublishStatus:()=>hc,getPublishState:()=>G0,getTournamentPublishStatus:()=>KM,getVenueData:()=>gU,mutate:()=>EDe,publishEvent:()=>eE,publishEventSeeding:()=>PDe,publishOrderOfPlay:()=>ADe,publishParticipants:()=>NDe,query:()=>dTe,setEventDisplay:()=>BB,unPublishEvent:()=>_De,unPublishEventSeeding:()=>CDe,unPublishOrderOfPlay:()=>MDe,unPublishParticipants:()=>RDe});var EDe={};$i(EDe,{publishEvent:()=>eE,publishEventSeeding:()=>PDe,publishOrderOfPlay:()=>ADe,publishParticipants:()=>NDe,setEventDisplay:()=>BB,unPublishEvent:()=>_De,unPublishEventSeeding:()=>CDe,unPublishOrderOfPlay:()=>MDe,unPublishParticipants:()=>RDe});function PDe({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:n,status:r=Du,drawIds:a=[],event:s}){var o,l,u,c;if(!n)return{error:lt};if(!s)return{error:Wn};let d=hc({event:s,status:r}),p=(((o=d?.seeding)==null?void 0:o.seedingScaleNames)||i)&&{...(l=d?.seeding)==null?void 0:l.seedingScaleNames,...i},h=(((u=d?.seeding)==null?void 0:u.stageSeedingScaleNames)||e)&&{...(c=d?.seeding)==null?void 0:c.stageSeedingScaleNames,...e},f=Gt({stageSeedingScaleNames:h,seedingScaleNames:p,published:!0,drawIds:a});return QD({statusObject:{seeding:f},removePriorValues:t,status:r,event:s}),Ui({topic:RIe,payload:{tournamentId:n.tournamentId,eventId:s.eventId,drawIds:a}}),{...ue}}function CDe({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:n=Du,drawIds:r,stages:a,event:s}){var o,l;if(!i)return{error:lt};if(!s)return{error:Wn};let u=hc({event:s});if(u){let c=u.seeding;if(Array.isArray(a)&&c.stageSeedingScaleNames)for(let d of a)c.stageSeedingScaleNames[d]&&delete c.stageSeedingScaleNames[d];Array.isArray(e)&&c!=null&&c.seedingScaleNames&&(c.seedingScaleNames=c.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(r)&&c!=null&&c.drawIds&&(c.drawIds=c.drawIds.filter(d=>!r.includes(d))),(!Object.values(c.stageSeedingScaleNames??{}).length&&!((o=c.seedingScaleNames)!=null&&o.length)&&!((l=c.drawIds)!=null&&l.length)||!a&&!e&&!(r!=null&&r.length))&&(delete c.stageSeedingScaleNames,delete c.seedingScaleNames,delete c.drawIds,c.published=!1),QD({statusObject:{seeding:c},removePriorValues:t,status:n,event:s})}return Ui({topic:d8,payload:{tournamentId:i.tournamentId,eventId:s.eventId}}),{...ue}}function RDe(t){let e=uc(t);if(!Object.keys(e).length)return{error:gr};for(let i of Object.values(e)){let n=_Ke({tournamentRecord:i,...t});if(n.error)return n}return{...ue}}function _Ke({removePriorValues:t=!0,tournamentRecord:e,status:i=Du}){if(!e)return{error:lt};let n=`${Lv}.${Fv}`,{timeItem:r}=cc({element:e,itemType:n}),a=r?.itemValue||{[i]:{}};return a[i]&&delete a[i].participants,lh({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),Ui({payload:{tournamentId:e.tournamentId},topic:WWe}),{...ue}}function MDe(t){let e=uc(t);if(!Object.keys(e).length)return{error:gr};for(let i of Object.values(e)){let n=kKe({tournamentRecord:i,...t});if(n.error)return n}return{...ue}}function kKe({removePriorValues:t=!0,tournamentRecord:e,status:i=Du}){if(!e)return{error:lt};let n=`${Lv}.${Fv}`,{timeItem:r}=cc({element:e,itemType:n}),a=r?.itemValue||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,lh({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),Ui({topic:p8,payload:{tournamentId:e.tournamentId}}),{...ue}}function NDe(t){let e=uc(t);if(!Object.keys(e).length)return{error:gr};for(let i of Object.values(e)){let n=xKe({tournamentRecord:i,...t});if(n.error)return n}return{...ue}}function xKe({removePriorValues:t,tournamentRecord:e,status:i=Du}){if(!e)return{error:lt};let n=`${Lv}.${Fv}`,{timeItem:r}=cc({element:e,itemType:n}),a=r?.itemValue||{[i]:{}};return a[i].participants={published:!0},lh({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),Ui({payload:{tournamentId:e.tournamentId},topic:NIe}),{...ue}}function ADe(t){let e=uc(t);if(!Object.keys(e).length)return{error:gr};for(let i of Object.values(e)){let n=OKe({tournamentRecord:i,...t});if(n.error)return n}return{...ue}}function OKe({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:n=Du,eventIds:r=[]}){if(!i)return{error:lt};let a=`${Lv}.${Fv}`,{timeItem:s}=cc({element:i,itemType:a}),o=s?.itemValue||{[n]:{}};return o[n].orderOfPlay={published:!0,scheduledDates:t,eventIds:r},lh({timeItem:{itemValue:o,itemType:a},element:i,removePriorValues:e}),Ui({topic:MIe,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:r}}),{...ue}}function _De({removePriorValues:t=!0,tournamentRecord:e,status:i=Du,event:n}){if(!e)return{error:lt};if(!n)return{error:Wn};let r=`${Lv}.${Fv}`,{timeItem:a}=_M({itemType:r,event:n}),s=a?.itemValue||{[i]:{}};return delete s[i].structureIds,delete s[i].drawDetails,delete s[i].drawIds,W0({event:n,timeItem:{itemValue:s,itemType:r},removePriorValues:t}),QD({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:n}),Ui({topic:c8,payload:{tournamentId:e.tournamentId,eventId:n.eventId}}),{eventId:n.eventId,...ue}}var kDe={};$i(kDe,{getEntryStatusReports:()=>FKe,getParticipantStats:()=>LKe,getStructureReports:()=>BKe,getVenuesReport:()=>jKe});function LKe({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:n,tournamentRecord:r,withScaleValues:a,tallyPolicy:s,matchUps:o}){var l,u,c,d,p;if(!r)return{error:lt};if(o&&!Array.isArray(o))return{error:ll};if(o=o??Qa({tournamentRecord:r,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(o!=null&&o.length))return{error:Km};let h=[];e&&h.push(e),n&&h.push(n);let f=h.length?{participantIds:h}:{participantTypes:[xo]},m=hr({participantFilters:f,tournamentRecord:r}).participants??[];if(!m.every(({participantType:M})=>M===xo))return{error:El};h.length||h.push(...m.map(Gi));let g=new Map,v=new Map,y=new Map,b=new Map,I=(M,R="")=>v.get(M)||v.set(M,{participantName:R,participantId:M,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&v.get(M);for(let M of m){let{participantId:R,individualParticipantIds:N}=M;b.set(R,N??[]),I(R,M.participantName)}if(n&&!b.get(n))return pe({result:{error:Ar},context:{teamParticipantId:n}});if(e&&!b.get(e))return pe({result:{error:Ar},context:{opponentParticipantId:e}});let S=[],w=M=>{let R=[[],[]];for(let A of M){let _=A.participant;if(_!=null&&_.participantName){g.set(_.participantId,{participantName:_.participantName,ratings:_.ratings});let x=v.get(_.participantId);x&&(x.participantName=_.participantName)}}let N=({side:A,individualParticipantIds:_})=>{var x,O,$,F,j;return A.participantId&&(!(_!=null&&_.length)||_.includes(A.participantId))&&[A.participantId]||((O=(x=A.participant)==null?void 0:x.individualParticipantIds)==null?void 0:O.length)&&(!(_!=null&&_.length)||Pr(_,($=A.participant)==null?void 0:$.individualParticipantIds).length===((j=(F=A.participant)==null?void 0:F.individualParticipantIds)==null?void 0:j.length))&&A.participant.individualParticipantIds};if(b.size){let A=(_,x)=>{for(let O of M){if(!O.participant)continue;let $=N({individualParticipantIds:x,side:O});if($!=null&&$.length){let F=O.sideNumber;if(!F)continue;let j=[_];i&&j.push(...$),R[F-1]=j;let H=v.get(_);for(let G of $.filter(Boolean))H&&!H.competitorIds.includes(G)&&H.competitorIds.push(G)}}};if(n)(!e||M.every(_=>_.participant&&(N({individualParticipantIds:b.get(n),side:_})||N({individualParticipantIds:b.get(e),side:_}))))&&A(n,b.get(n));else for(let[_,x]of b)A(_,x)}else if(i)for(let A of M){if(!A.participant)continue;let _=N({individualParticipantIds:[],side:A}),x=A.sideNumber;x&&(R[x-1]=_)}return R};for(let M of o){if(!Qi(M))return{error:ll};let{matchUpStatus:R,matchUpFormat:N,matchUpType:A,winningSide:_,score:x,sides:O}=M;if(!O||!x||A===hu||R===fn)continue;let $=w(O);if(!$.filter(Boolean).length)continue;let F=t&&_&&((l=jM({matchUp:M}))==null?void 0:l.competitiveness);S.push(M);let j=r9({matchUpStatus:R,matchUpFormat:N,tallyPolicy:s,winningSide:_,score:x}),H=m0e({matchUpStatus:R,matchUpFormat:N,tallyPolicy:s,winningSide:_,score:x}),{pointsTally:G,tiebreaksTally:W}=g0e({matchUpFormat:N,score:x});$.forEach((q,Z)=>{var K;for(let Q of q){let J=(K=g.get(Q))==null?void 0:K.participantName,ne=I(Q,J);if(ne){let re=(ye,Te)=>Te.forEach((De,xe)=>ne[ye][xe]+=De),oe=Z?[...W].reverse():W,de=Z?[...G].reverse():G,se=Z?[...H].reverse():H,ge=Z?[...j].reverse():j;if(re("tiebreaks",oe),re("points",de),re("games",se),re("sets",ge),_){let ye=_-1===Z?0:1;ne.matchUps[ye]+=1}if(F){let ye=F.toLowerCase();ne.competitiveness[ye]||(ne.competitiveness[ye]=[0,0]),ne.competitiveness[ye][Z]+=1}if(R){let ye=R.toLowerCase();ne.matchUpStatuses[ye]||(ne.matchUpStatuses[ye]=0),ne.matchUpStatuses[ye]+=1}}}})}let T=["tiebreaks","matchUps","points","games","sets"],U=["competitive","routine","decisive"],C=new Map,E=(M,R)=>(M??0)+(R??0);for(let[M,R]of v.entries()){for(let N of T){let A=R[N].reduce(E);if(A){let _=R[N][0]/A,x=`${N}Ratio`,O=parseFloat(_.toFixed(2));R[x]=O,y.set(M,!0),C.has(x)||C.set(x,[]),(u=C.get(x))==null||u.push(O)}}for(let N of U){let A=(d=(c=R.competitiveness)==null?void 0:c[N])==null?void 0:d.reduce(E);if(A){let _=R.competitiveness[N][0]/A,x=`${N}Ratio`,O=parseFloat(_.toFixed(2));R[x]=O}}}if(!n){let M=(R,N)=>N-R;for(let R of v.values())for(let N of T){let A=`${N}Ratio`;if(typeof R[A]=="number"){let _=(p=C.get(A))==null?void 0:p.sort(M).indexOf(R[A]);if(typeof _=="number"&&_>=0){let x=`${N}Rank`;R[x]=_+1}}}}let P={relevantMatchUps:S,...ue};return n?(P.teamStats=v.get(n),e&&(P.opponentStats=v.get(e))):P.participatingTeamsCount=y.size,P.allParticipantStats=[...v.values()],P}function Ox({participant:t,eventType:e}){var i,n,r,a,s,o;let l=(i=t?.person)==null?void 0:i.personId,u=(r=(n=t?.person)==null?void 0:n.personOtherIds)==null?void 0:r[0],c=(a=t?.person)==null?void 0:a.tennisId,d=(o=(s=t?.ratings)==null?void 0:s[e])==null?void 0:o.find(({scaleName:m})=>m===n9),p=d?.scaleValue,{wtnRating:h,confidence:f}=p||{};return{timeStamp:d?.scaleDate,personOtherId:u,confidence:f,wtnRating:h,personId:l,tennisId:c}}function FKe({tournamentRecord:t}){if(!t)return{error:lt};let e=t.tournamentId,{participantMap:i}=hr({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),n=(Qa({matchUpFilters:{matchUpTypes:[zI,nb]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:h,matchUpType:f})=>h?.flatMap(m=>{var g,v;return f===nb?(g=m?.participant)==null?void 0:g.individualParticipantIds:((v=m?.participant)==null?void 0:v.participantId)||m.participantId}).filter(Boolean)).filter(Boolean),r=[],a={},s={},o={},l=0,u=({id:h,entry:f,eventId:m,eventType:g})=>{var v;let{qualifyingSeeding:y,mainSeeding:b,entryStatus:I,entryStage:S,drawId:w}=f;a[h]||(a[h]=[]);let{participant:T,events:U}=i?.[h]??{},C=Ox({participant:T,eventType:g}),E=(v=U?.[m])==null?void 0:v.ranking;I===J8&&r.push(h),a[h].push({participantType:T?.participantType,participantId:h,tournamentId:e,eventType:g,eventId:m,drawId:w,entryStatus:I,entryStage:S,...C,ranking:E,mainSeeding:b,qualifyingSeeding:y})};for(let h of t.events??[]){let f={},m=T=>{f[T]||(f[T]={count:0}),f[T].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=h,b=g.flatMap(T=>{let{drawId:U,entries:C}=T;l+=1;let E=({stage:N,stageSequence:A})=>N===_t&&A===1||N===Kt,P=(T.structures??[]).filter(E).flatMap(({positionAssignments:N})=>N).filter(Boolean).map(({participantId:N})=>N),M=({participantId:N})=>P.includes(N),R=N=>{var A,_,x,O,$,F,j,H;let{participantId:G,entryStatus:W,entryStage:q}=N;m(W);let Z=(O=(x=(_=(A=i?.[G])==null?void 0:A.draws)==null?void 0:_[U])==null?void 0:x.seedAssignments)==null?void 0:O[_t];return{qualifyingSeeding:(H=(j=(F=($=i?.[G])==null?void 0:$.draws)==null?void 0:F[U])==null?void 0:j.seedAssignments)==null?void 0:H[Kt],participantId:G,mainSeeding:Z,entryStatus:W,entryStage:q,drawId:U}};return C?.filter(M).map(R)}),I=T=>{var U;let C=T.participantId,E=(U=i?.[C].participant.individualParticipantIds)==null?void 0:U.filter(P=>n.includes(P));return C&&{[C]:{individualParticipantIds:E}}};v===Dm?(()=>{let T=Object.assign({},...b.map(I).filter(Boolean)),U=C=>{T[C.participantId].individualParticipantIds.forEach(E=>{u({id:E,eventType:v,eventId:y,entry:C})})};b.forEach(U)})():b.forEach(T=>{u({id:T?.participantId,eventType:v,eventId:y,entry:T})});let S=Object.values(f).reduce((T,U)=>T+U.count,0);Object.keys(f).forEach(T=>{f[T].pct=f[T].count/S*100}),o[y]={tournamentId:e,eventId:y,entries:b,entryStatuses:f};let w=Object.assign({},...yd.flatMap(T=>{var U,C;return[{[T+"_count"]:(U=f[T])==null?void 0:U.count},{[T+"_pct"]:(C=f[T])==null?void 0:C.pct}]}));s[y]={tournamentId:e,eventId:y,...w}}let c=Object.values(i??{}).filter(({participant:{participantType:h,participantRole:f}})=>h===Hi&&f===ws),d=c.filter(({participant:h})=>!n.includes(h.participantId)).map(({participant:h})=>h.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:c.length,eventsCount:Object.values(o).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(s).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(o).flat(),withDrawnParticipantIds:r,tournamentEntryReport:p}}function $Ke({eventType:t,matchUps:e,eventId:i,drawId:n}){let r={},a=f=>{let m=f?.matchUpFormat;m&&(r[m]||(r[m]=0),r[m]+=1)},s=e.filter(f=>i?f.eventId===i:f.drawId===n).reduce((f,m)=>(a(m),(m.sides??[]).flatMap(g=>{var v;return(((v=g?.participant)==null?void 0:v.individualParticipants)||[g?.participant]).filter(Boolean)}).forEach(g=>f[g.participantId]=g),f),{}),o=Object.values(s),l=o.map(f=>Ox({participant:f,eventType:t})).filter(({wtnRating:f})=>f),u=(o.length-l.length)/o.length*100,c=l.reduce((f,m)=>{let{wtnRating:g,confidence:v}=m;return f.totalWTN+=g,f.totalConfidence+=v,f},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?c.totalWTN/l.length:0,p=l!=null&&l.length?c.totalConfidence/l.length:0,h=Object.values(r).reduce((f,m)=>f+(m||0),0);return{matchUpFormatCounts:r,matchUpsCount:h,avgConfidence:p,pctNoRating:u,avgWTN:d}}function BKe(t){var e;let{tournamentRecord:i,extensionProfiles:n,firstFlightOnly:r}=t;if(!i)return{error:eU};let a=[],s={},o={},l=[],u=Object.assign({},...(n??[]).map(({name:m,label:g,accessor:v})=>{var y,b,I;let S=(b=(y=ki({element:i,name:m}))==null?void 0:y.extension)==null?void 0:b.value,w=v?(I=WI({element:S,accessor:v}))==null?void 0:I.value:S;return{[g||m]:w}})),c=i?.tournamentId,d=Qa({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],p=m=>{var g,v,y;return(y=(v=(g=cc({itemType:e8,itemSubTypes:[Lh],element:{timeItems:m}}))==null?void 0:g.timeItem)==null?void 0:v.itemValue)==null?void 0:y.scaleBasis},h=({positionManipulations:m})=>{m?.forEach(g=>{let{structureId:v,name:y}=g,b=g.drawPositions||[g.drawPosition];s[v]||(s[v]=[]),s[v].push(`${y}: ${b.join("/")}`)})},f=(e=i?.events)==null?void 0:e.flatMap(({timeItems:m,drawDefinitions:g=[],extensions:v,eventType:y,eventName:b,eventId:I,category:S})=>{var w,T,U,C;let E=(U=(T=(w=v?.find(O=>O.name===ld))==null?void 0:w.value)==null?void 0:T.flights)==null?void 0:U.map(O=>({[O.drawId]:O.flightNumber})),P=E&&Object.assign({},...E),M=v?.find(O=>O.name===My),R=m?.find(O=>O.itemType===My),N=((C=M?.value)==null?void 0:C.length)||R?.itemValue||0,A=Object.values(P??{}),_=P&&Math.min(...A),x=p(m);return o[I]={seedingBasis:x?JSON.stringify(x):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:N,tournamentId:c,eventId:I},g.filter(O=>!r||!E||P[O.drawId]===_).flatMap(O=>{let{matchUpFormat:$,tieFormat:F,timeItems:j,extensions:H,structures:G,drawName:W,drawType:q,drawId:Z}=O,{matchUpFormatCounts:K,matchUpsCount:Q,avgConfidence:J,pctNoRating:ne,avgWTN:re}=$Ke({eventType:y,matchUps:d,drawId:Z}),oe=p(j)||x,de=VKe({extensions:H}),se=de?.length||0;return h({positionManipulations:de}),o[I].totalPositionManipulations+=se,o[I].generatedDrawsCount+=1,se>o[I].maxPositionManipulations&&(o[I].maxPositionManipulations=se),G?.filter(ge=>ge.stageSequence===1&&[Kt,_t,Ds,Tr].includes(ge.stage)).map(ge=>{var ye,Te,De;let xe=[_t,Tr].includes(ge.stage)?d.find(Tt=>Tt.structureId===ge.structureId&&Tt.finishingRound===1&&Tt.winningSide):void 0;ge.stage===_t&&a.push({eventName:b,drawName:W,structureId:ge.structureId});let Me=(Te=(ye=xe?.sides)==null?void 0:ye.find(Tt=>Tt.sideNumber===xe.winningSide))==null?void 0:Te.participant,Oe=Me?.participantType===xo&&Me.participantId,at=Me?.participantType===Ai?Me.individualParticipants:[],Fe=Ox({participant:at?.[0]||Me,eventType:y}),{personId:mt,personOtherId:Xe,tennisId:gt,confidence:ht,wtnRating:_e}=Fe||{},Ye=Ox({participant:at?.[1],eventType:y}),{personId:Je,personOtherId:ct,tennisId:pt,confidence:Se,wtnRating:he}=Ye||{},{ageCategoryCode:we,categoryName:be,subType:Ae}=S??{},ze=ge.matchUpFormat||$,We=(K[ze]||0)/Q*100,{tieFormatName:Le,tieFormatDesc:ft}=Rx(F),{tieFormatName:rt,tieFormatDesc:St}=Rx(ge.tieFormat),si=ft===St,Qe=!si&&rt,bt=ge.tieFormat&&!si&&St,ci=((De=de?.filter(Tt=>Tt.structureId===ge.structureId))==null?void 0:De.length)||0;return{...u,tournamentId:c,eventId:I,structureId:ge.structureId,drawId:Z,eventType:y,category:Ae,categoryName:be,ageCategoryCode:we,flightNumber:P?.[Z],drawType:q,stage:ge.stage,seedingBasis:oe?JSON.stringify(oe):void 0,winningPersonId:mt,winningPersonOtherId:Xe,winningPersonTennisId:gt,winningPersonWTNrating:_e,winningPersonWTNconfidence:ht,winningPerson2Id:Je,winningPerson2OtherId:ct,winningPerson2TennisId:pt,winningPerson2WTNrating:he,winningPerson2WTNconfidence:Se,winningTeamId:Oe,positionManipulations:ci,pctNoRating:ne,matchUpFormat:ze,pctInitialMatchUpFormat:We,matchUpsCount:Q,drawTieFormatName:Le,drawTieFormatDesc:ft,tieFormatName:Qe,tieFormatDesc:bt,avgConfidence:J,avgWTN:re}})})});return a.forEach(({eventName:m,drawName:g,structureId:v})=>{var y;(y=s[v])!=null&&y.length&&l.push({eventName:m,drawName:g,actions:s[v]})}),{eventStructureReports:Object.values(o),structureReports:f,flightReports:l}}function VKe({extensions:t}){var e,i;return(i=(e=t?.find(({name:n})=>n===mT))==null?void 0:e.value)==null?void 0:i.slice(1)}function jKe({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:n=[],dates:r=[]}){var a,s;if(!Array.isArray(r))return{error:Ce,dates:r};if(!Array.isArray(n))return{error:Ce,venueIds:n};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:gr};if(!r.every(Pl))return{error:za};let o=tg({tournamentRecords:e,ignoreDisabled:t,dates:r});if(o.error)return o;let l=(a=o?.venues)==null?void 0:a.filter(({venueId:p})=>!(n!=null&&n.length)||n.includes(p)),u=(s=o.courts)==null?void 0:s.reduce((p,h)=>{var f;return(f=h.dateAvailability)==null||f.forEach(m=>{let g=m.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!r.length||r.includes(p)),c={venueIds:l?.map(({venueId:p})=>p)},{matchUps:d}=Wd({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:c});return{venuesReport:l?.map(p=>GKe(u,p,d))}}function GKe(t,e,i){let{venueId:n,courts:r,venueName:a}=e,s={};return t.forEach(o=>{var l;let u=0,c=0,d=0;for(let f of r){let m=f.dateAvailability.find(v=>v.date===o),g=(l=m&&tE({courtDate:m}).timeSlots)==null?void 0:l.reduce((v,y)=>{let{startTime:b,endTime:I}=y,S=an(I)-an(b);return v+S},0);g&&(d+=1),u+=g}let p=i.filter(({schedule:f})=>f.venueId===n&&af(o,f.scheduledDate));p.forEach(({schedule:f})=>{let m=er(f.scheduledTime),g=il(m,f.averageMinutes),v=an(g)-an(m);c+=v});let h=u?(c/u*100).toFixed(2):"100";s[o]={scheduledMatchUpsCount:p.length,availableCourts:d,availableMinutes:u,scheduledMinutes:c,percentUtilization:h}}),{venueId:n,venueName:a,venueReport:s}}var xDe={};$i(xDe,{addMatchUpCourtOrder:()=>AY,addMatchUpEndTime:()=>kY,addMatchUpOfficial:()=>IUe,addMatchUpResumeTime:()=>OY,addMatchUpScheduleItems:()=>KB,addMatchUpScheduledDate:()=>WB,addMatchUpScheduledTime:()=>Bv,addMatchUpStartTime:()=>_Y,addMatchUpStopTime:()=>xY,addSchedulingProfileRound:()=>KY,allocateTeamMatchUpCourts:()=>YB,assignMatchUpCourt:()=>X0,assignMatchUpVenue:()=>nE,bulkRescheduleMatchUps:()=>GDe,bulkScheduleMatchUps:()=>EN,bulkScheduleTournamentMatchUps:()=>c1,bulkUpdateCourtAssignments:()=>$De,calculateScheduleTimes:()=>QY,clearMatchUpSchedule:()=>zDe,clearScheduledMatchUps:()=>XB,courtGridRows:()=>AB,findMatchUpFormatTiming:()=>RB,findVenue:()=>bf,generateBookings:()=>ZB,generateVirtualCourts:()=>jB,getMatchUpsToSchedule:()=>CB,getPersonRequests:()=>Xb,getProfileRounds:()=>NB,getScheduledRoundsDetails:()=>mN,getSchedulingProfile:()=>ig,getSchedulingProfileIssues:()=>X9,matchUpScheduleChange:()=>HDe,modifyMatchUpFormatTiming:()=>gY,mutate:()=>ODe,proAutoSchedule:()=>FDe,proConflicts:()=>VDe,publicFindCourt:()=>E8,query:()=>gTe,removeEventMatchUpFormatTiming:()=>$B,removeMatchUpCourtAssignment:()=>LDe,reorderUpcomingMatchUps:()=>jDe,scheduleMatchUps:()=>BDe,scheduleProfileRounds:()=>JB,setMatchUpDailyLimits:()=>qDe,setMatchUpHomeParticipantId:()=>NY,setSchedulingProfile:()=>ZD,toggleParticipantCheckInState:()=>HB,validateSchedulingProfile:()=>MB});var ODe={};$i(ODe,{addMatchUpCourtOrder:()=>AY,addMatchUpEndTime:()=>kY,addMatchUpOfficial:()=>IUe,addMatchUpResumeTime:()=>OY,addMatchUpScheduleItems:()=>KB,addMatchUpScheduledDate:()=>WB,addMatchUpScheduledTime:()=>Bv,addMatchUpStartTime:()=>_Y,addMatchUpStopTime:()=>xY,addSchedulingProfileRound:()=>KY,allocateTeamMatchUpCourts:()=>YB,assignMatchUpCourt:()=>X0,assignMatchUpVenue:()=>nE,bulkRescheduleMatchUps:()=>GDe,bulkScheduleMatchUps:()=>EN,bulkScheduleTournamentMatchUps:()=>c1,bulkUpdateCourtAssignments:()=>$De,calculateScheduleTimes:()=>QY,clearMatchUpSchedule:()=>zDe,clearScheduledMatchUps:()=>XB,findMatchUpFormatTiming:()=>RB,generateBookings:()=>ZB,generateVirtualCourts:()=>jB,matchUpScheduleChange:()=>HDe,modifyMatchUpFormatTiming:()=>gY,proAutoSchedule:()=>FDe,proConflicts:()=>VDe,removeEventMatchUpFormatTiming:()=>$B,removeMatchUpCourtAssignment:()=>LDe,reorderUpcomingMatchUps:()=>jDe,scheduleMatchUps:()=>BDe,scheduleProfileRounds:()=>JB,setMatchUpDailyLimits:()=>qDe,setMatchUpHomeParticipantId:()=>NY,setSchedulingProfile:()=>ZD,toggleParticipantCheckInState:()=>HB,validateSchedulingProfile:()=>MB});function QY({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,tournamentRecords:a,periodLength:s,scheduleDate:o,startTime:l,venueIds:u,endTime:c}){if(typeof a!="object"||!Object.keys(a).length)return{error:gr};s=s??GB({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=tg({dates:[o],ignoreDisabled:!0,tournamentRecords:a}),h=d?.filter(E=>!u||u.includes(E.venueId));l||(l=h?.reduce((E,P)=>{var M,R;let N=((R=(M=P.dateAvailability)==null?void 0:M.find(A=>!A.date||af(o,A.date)))==null?void 0:R.startTime)??P.startTime;return N&&(!E||an(N)<an(E))?N:E},void 0)),c||(c=h?.reduce((E,P)=>{var M,R;let N=((R=(M=P.dateAvailability)==null?void 0:M.find(A=>!A.date||af(o,A.date)))==null?void 0:R.endTime)??P.endTime;return N&&(!E||an(N)>an(E))?N:E},void 0));let f=Object.values(a),m=Object.assign({},...f.map(E=>(E.events??[]).map(P=>{let{scheduleTiming:M}=kM({tournamentRecord:E,event:P});return{[P.eventId]:{event:P,scheduleTiming:M}}})).flat()),g=yN({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:o,venueIds:u}}),v=g?.dateMatchUps??[],y=g?.completedMatchUps??[],b=[];b.push(...v),b.push(...y);let I={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},S=b?.map(({eventId:E,schedule:P,matchUpFormat:M})=>{let{event:R,scheduleTiming:N}=m[E],A=R?.eventType,_={...N,defaultTiming:I,matchUpFormat:M},{averageMinutes:x,recoveryMinutes:O}=W$({eventType:A,timingDetails:_}),{courtId:$,venueId:F}=P,j=er(P.scheduledTime),H=il(j,x);return{recoveryMinutes:O,averageMinutes:x,periodLength:s,startTime:j,endTime:H,courtId:$,venueId:F}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:i,date:o,clearScheduleDates:r,periodLength:s,startTime:l,endTime:c,bookings:S,courts:h},{scheduleTimes:T}=DY(w),U=u?.length===1&&u[0]||p?.length===1&&p[0].venueId||void 0,C=b.map(Na);return{venueId:U,scheduleTimes:T,dateScheduledMatchUpIds:C}}function LDe(t){var e;let i=Yt(t,[{[Hs]:!0}]);if(i.error)return i;let{removePriorValues:n,tournamentRecords:r,tournamentId:a,courtDayDate:s,matchUpId:o,courtId:l,drawId:u}=t,c=r[a];if(!c)return{error:lt};let{drawDefinition:d,event:p}=$v({tournamentRecord:c,drawId:u});if(!d)return{error:Lt};let h=tr({drawDefinition:d,event:p,matchUpId:o});if(h.error)return h;if(((e=h?.matchUp)==null?void 0:e.matchUpType)===hu){let{itemValue:f}=Wb({timeItems:h.matchUp.timeItems??[],itemType:cf}),m=l&&f.filter(g=>g.courtId!==l);return Vl({duplicateValues:!1,removePriorValues:n,tournamentRecord:c,drawDefinition:d,matchUpId:o,timeItem:{itemType:cf,itemValue:m}})}else return X0({tournamentRecord:c,drawDefinition:d,courtDayDate:s,courtId:"",matchUpId:o})}function FDe({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:n}){if(!pc(n))return{error:Ce};if(n.some(({hasContext:h})=>!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:c$};let r=yN({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(r.error)return r;let{rows:a}=r,s=[],o=h=>[(h.sides||[]).map(f=>{var m;return[f.participantId,(m=f.participant)==null?void 0:m.individualParticipantIds]}),(h.potentialParticipants||[]).flat().map(f=>[f.participantId,f.individualParticipantIds])].flat(1/0).filter(Boolean),l=a?.reduce((h,f)=>{let m=[],g=[];Object.values(f).forEach(y=>{if(Qi(y)&&(y.matchUpId&&(m.push(y.matchUpId),s.push(y)),y.sides)){let b=o(y);g.push(...b)}});let v=Object.values(f).filter(y=>Qi(y)&&!y.matchUpId);return h.concat({matchUpIds:m,availableCourts:v,rowId:f.rowId,participantIds:g})},[]);n.filter(({matchUpStatus:h})=>h&&h!==fn&&(t||!wa.includes(h))).sort(j0);let u=bd({matchUps:n.concat(s),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,c=[],d=[];for(;n.length&&l.length;){let h=l.shift(),f=[];for(;n.length&&h.availableCourts.length;){let m=n.concat(f).map(U=>U.matchUpId),g=n.shift(),v=g?.matchUpId,y=v&&u[v].matchUpIds.concat(u[v].dependentMatchUpIds),b=v&&m.some(U=>u[v].matchUpIds.includes(U)),I=v&&d.some(U=>u[v].dependentMatchUpIds.includes(U)),S=h.matchUpIds.some(U=>y.includes(U)),w=o(g),T=h.participantIds.some(U=>w.includes(U));if(g&&!S&&!b&&!T&&!I){let U=h.availableCourts.shift();Object.assign(g.schedule,U.schedule),Object.assign(U,g),c.push(g),h.participantIds.push(...w),h.matchUpIds.push(v)}else g&&f.push(g)}n.push(...f),d.push(...h.matchUpIds)}let p=c.map(({matchUpId:h,tournamentId:f,schedule:m,drawId:g})=>({tournamentId:f,matchUpId:h,drawId:g,schedule:{...m,scheduledDate:i}}));return r=EN({tournamentRecords:e,matchUpDetails:p}),{...r,scheduled:c,notScheduled:n}}function $De(t){let{courtDayDate:e}=t,i=Yt(t,[{courtAssignments:!0,[Ho]:Os,[vu]:Xt},{[Hs]:!0}]);if(i.error)return i;let n=t.courtAssignments.reduce((a,s)=>{let{tournamentId:o}=s;return a[o]||(a[o]=[]),a[o].push(s),a},{}),r;return Object.keys(n).every(a=>{let s=t[Hs][a];if(!s)return r={error:lt},!1;let o=n[a].reduce((l,u)=>{let{drawId:c}=u;return l[c]||(l[c]=[]),l[c].push(u),l},{});Object.keys(o).every(l=>{let{drawDefinition:u}=jo({tournamentRecord:s,drawId:l});return u?(o[l].every(c=>{let{matchUpId:d,courtId:p}=c,h=X0({tournamentRecord:s,drawDefinition:u,courtDayDate:e,matchUpId:d,courtId:p});if(h.success)return h?.success;r={error:Aye}}),!0):(r={error:Lt},!1)})}),r||ue}function BDe(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:n=90,recoveryMinutes:r=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:o={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:c=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:h=30,scheduleDate:f,matchUpIds:m,venueIds:g,startTime:v,endTime:y,dryRun:b}=t,I=Yt(t,[{[Hs]:!0,[PM]:!0},{[vs]:Pl,[vu]:za,[mWe]:!0},{[vs]:q=>!q||!isNaN(q),[bWe]:!1,[vu]:Ce,[IWe]:!1,[wWe]:!1}]);if(I.error)return I;let S=t.competitionMatchUps??Wd({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??bd({includeParticipantDependencies:!0,matchUps:S,tournamentRecords:e}).matchUpDependencies;S.forEach(q=>{var Z;(Z=q.schedule)!=null&&Z.scheduledDate&&af(f,Ci(q.schedule.scheduledDate))&&wU({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:q})});let T=m.map(q=>S.find(Z=>Z.matchUpId===q)).filter(Boolean),{venueId:U,scheduleTimes:C,dateScheduledMatchUpIds:E}=QY({tournamentRecords:e,remainingScheduleTimes:d,startTime:er(v),endTime:er(y),scheduleDate:Ci(f),averageMatchUpMinutes:n,clearScheduleDates:p,periodLength:h,venueIds:g}),P={},M=[],R={},N={},A={};S.filter(({matchUpId:q})=>E?.includes(q)).forEach(q=>{var Z;uz({matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUp:q,value:1});let K=(Z=q.schedule)==null?void 0:Z.scheduledTime;if(K){R[q.matchUpId]=K;let Q=a?.[q.matchUpId];u1({recoveryMinutes:Q||r,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:K,matchUp:q})}});let _=T.filter(q=>{let Z=E?.includes(q.matchUpId),K=[fn,Wi,kr,ul,os,ln].includes(q?.matchUpStatus);return!Z&&!q.winningSide&&!K}),{matchUpMap:x,overLimitMatchUpIds:O,participantIdsAtLimit:$}=_.reduce((q,Z)=>{let{drawId:K,tournamentId:Q,matchUpType:J}=Z,{participantIdsAtLimit:ne,relevantParticipantIds:re}=zY({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,matchUpDailyLimits:u,matchUp:Z});return ne!=null&&ne.length?(q.overLimitMatchUpIds.push(Z.matchUpId),q.participantIdsAtLimit.push(...ne),q):(re.forEach(oe=>{UN({individualParticipantProfiles:o,participantId:oe});let de=o[oe].counters;de[J]?de[J]+=1:de[J]=1,de[Jc]?de[Jc]+=1:de[Jc]=1}),q.matchUpMap[Q]||(q.matchUpMap[Q]={}),q.matchUpMap[Q][K]?q.matchUpMap[Q][K].push(Z):q.matchUpMap[Q][K]=[Z],wU({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:Z}),q)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});_=_.filter(({matchUpId:q})=>!O.includes(q));let F=0,j=C?.length??0,{personRequests:H}=Xb({tournamentRecords:e,requestType:DN});for(;C!=null&&C.length&&_.length&&F<=j;){F++;let{scheduleTime:q}=C.shift(),Z=_.find(K=>{let{matchUpId:Q}=K,{dependenciesScheduled:J,remainingDependencies:ne}=jY({matchUpScheduleTimes:R,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:K});if(!J)return A[Q]||(A[Q]=[]),A[Q].push({scheduleTime:q,remainingDependencies:ne}),!1;let{enoughTime:re}=HY({individualParticipantProfiles:o,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:q,matchUp:K});if(!re)return N[Q]||(N[Q]=[]),N[Q].push({scheduleTime:q}),!1;let{conflicts:oe}=GY({potentials:c,averageMatchUpMinutes:n,requestConflicts:P,personRequests:H,scheduleTime:q,scheduleDate:f,matchUp:K});if(oe!=null&&oe.length)return!1;let de=a?.[K.matchUpId];return u1({recoveryMinutes:de||r,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:q,matchUp:K}),R[K.matchUpId]=q,!0});_=_.filter(({matchUpId:K})=>K!==Z?.matchUpId),Z||M.push(q)}_.forEach(q=>{uz({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,value:-1,matchUp:q})});let G=[];Object.keys(x).forEach(q=>{let Z=e[q];Z&&Object.keys(x[q]).forEach(K=>{let{drawDefinition:Q}=$v({tournamentRecord:Z,drawId:K});Q&&x[q][K].forEach(({matchUpId:J})=>{let ne=R[J];if(ne){let re=ne.split(":").map(ju).join(":"),oe=`${Ci(f)}T${re}`;b?G.push(J):(Bv({drawDefinition:Q,matchUpId:J,scheduledTime:oe}).success&&G.push(J),U&&nE({tournamentRecords:e,tournamentRecord:Z,drawDefinition:Q,matchUpId:J,venueId:U}))}})})});let W=Z7(_);return{...ue,requestConflicts:Object.values(P),remainingScheduleTimes:C?.map(({scheduleTime:q})=>q),individualParticipantProfiles:o,matchUpNotBeforeTimes:l,participantIdsAtLimit:$,skippedScheduleTimes:M,overLimitMatchUpIds:O,scheduledMatchUpIds:G,noTimeMatchUpIds:W,recoveryTimeDeferred:N,dependencyDeferred:A}}function VDe({tournamentRecords:t,matchUps:e}){if(!pc(e))return{error:Km};if(e.some(({matchUpId:h,hasContext:f})=>h&&!f))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:c$};let i=Math.max(...e.map(({schedule:h})=>h?.courtOrder||1).map(h=>ai(h))),n=Et(1,i+1).map(h=>e.filter(f=>{var m;return ai((m=f.schedule)==null?void 0:m.courtOrder)===h})),r={},a={},s={};n.flat().filter(Boolean).sort(j0).forEach(({schedule:h})=>delete h[N_]);let o=Si(e.map(({drawId:h})=>h)),l=bd({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:o}).matchUpDependencies,u=n.map((h,f)=>h.reduce((m,g)=>{if(!g.matchUpId)return m;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:b,schedule:I,sides:S,potentialParticipants:w}=g,T=I?.courtId;r[v]=f,a[T]=[],m.matchUpIds.push(v),s[v]=g;let U=l[v].matchUpIds;U.length&&m.sourceMatchUpIds.push(...U);let C=S?.map(P=>{var M;return[(M=P.participant)==null?void 0:M.individualParticipantIds,P.participantId]}).flat().filter(Boolean)??[],E=w?.flat().map(({individualParticipantIds:P,participantId:M})=>[P,M]).flat().filter(Boolean)||[];return m.participantIds.push(...E,...C),y&&m.targetMatchUpIds.push(y),b&&m.targetMatchUpIds.push(b),m},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),c=(h,f)=>l[h].sources.reduce((m,g,v)=>g.includes(f)&&v+1||m,0),d=u.map(()=>[]),p=(h,f,m,g)=>{if(!s[h].schedule[N_]){s[h].schedule[N_]=f,s[h].schedule[awe]=g,d[r[h]].push({matchUpId:h,issueType:m,issueIds:g,issue:f});let v=s[h].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:h,issue:f,issueType:m,issueIds:g})}};return u.forEach((h,f)=>{let m=f?u[f-1]:void 0,g=u.slice(f+1),v={},y=Ol(h.participantIds),b=Object.keys(y).filter(w=>y[w]>1),I=h.matchUpIds.filter(w=>l[w].participantIds.some(T=>b.includes(T)));I.forEach(w=>{v[w]||(v[w]={}),v[w][oy]||(v[w][oy]=I.filter(T=>T!==w))});let S=m&&h.participantIds.filter(w=>m.participantIds.includes(w));S&&S.forEach(w=>{let T=h.matchUpIds.concat(m.matchUpIds).filter(U=>l[U].participantIds.includes(w));T.forEach(U=>{v[U]||(v[U]={}),v[U][ly]||(v[U][ly]=T.filter(C=>C!==U))})}),h.matchUpIds.forEach(w=>{var T,U,C,E;let P=l[w].matchUpIds;for(let R of g){let N=R.matchUpIds.filter(A=>P.includes(A));N!=null&&N.length&&(N.forEach(A=>p(A,OH,Dg,[w])),p(w,OH,Dg,N))}if((T=v[w])!=null&&T[oy]&&p(w,oy,xH,v[w][oy]),h.sourceMatchUpIds.includes(w)){let R=h.matchUpIds.filter(N=>l[N].matchUpIds.includes(w));p(w,oy,Dg,R),h.matchUpIds.filter(N=>l[N].matchUpIds.includes(w)).forEach(N=>p(N,oy,Dg,[w]))}let M=(U=m?.matchUpIds)==null?void 0:U.filter(R=>c(w,R)>1);if(M!=null&&M.length&&(p(w,LH,Dg,M),M.forEach(R=>p(R,LH,Dg,[w]))),(C=v[w])!=null&&C[ly]&&p(w,ly,xH,v[w][ly]),(E=m?.targetMatchUpIds)==null?void 0:E.includes(w)){let R=s[w].schedule.courtId,N=P.filter(A=>m.matchUpIds.includes(A));N.some(A=>s[A].schedule.courtId===R)||(N.forEach(A=>p(A,ly,Dg,[w])),p(w,ly,Dg,N))}})}),{courtIssues:a,rowIssues:d}}function jDe(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return pe({result:{error:gr},stack:e});let{matchUpsContextIds:n,firstToLast:r}=t;if(!n)return pe({result:{error:Xt},stack:e});let a=n?.length;if(!a)return{...ue};let s=0;return n.forEach((l,u)=>{let{tournamentId:c,drawId:d,matchUpId:p}=l,h=u+(r?-1:1);h<0&&(h=a-1),h===a&&(h=0);let f=n[h].schedule.scheduledTime,m=o({tournamentId:c,scheduledTime:f,matchUpId:p,drawId:d});if(m.success)s++;else return m}),s===a?ue:pe({result:{error:Nye},stack:e});function o({tournamentId:l,scheduledTime:u,matchUpId:c,drawId:d}){let p=i[l],{drawDefinition:h}=$v({tournamentRecord:p,drawId:d});return h?Bv({drawDefinition:h,scheduledTime:u,matchUpId:c}):{error:fu}}}function GDe(t){var e,i;let{scheduleChange:n,matchUpIds:r,dryRun:a}=t;if(!r||!Array.isArray(r))return{error:U0};if(typeof n!="object")return{error:Ce};let s=uc(t),o=[],l=[];for(let c of Object.values(s)){let d=HKe({tournamentRecord:c,scheduleChange:n,matchUpIds:r,dryRun:a});if(d.error)return d;Array.isArray(d.notRescheduled)&&l.push(...d.notRescheduled);let p=Z7(d.notRescheduled),h=[];(e=d.rescheduled)==null||e.forEach(f=>{let{matchUpId:m}=f;p.includes(m)&&h.push(m),o.push(f)}),h.length&&(l=((i=d?.notRescheduled)==null?void 0:i.filter(({matchUpId:f})=>!h.includes(f)))||[])}let u=!!(o.length&&!l.length);return{...ue,rescheduled:o,notRescheduled:l,allRescheduled:u}}function HKe({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:n}){var r;if(!t)return{error:lt};if(!i||!Array.isArray(i))return{error:U0};if(typeof e!="object")return{error:Ce};let a=[],s=[],{minutesChange:o,daysChange:l}=e;if(!o&&!l)return{...ue};if(o&&isNaN(o))return{error:Ce};if(l&&isNaN(l))return{error:Ce};let{matchUps:u}=Qa({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),c=({matchUpStatus:S})=>!wa.includes(S),d=u?.filter(S=>vN({schedule:S.schedule})).filter(S=>c({matchUpStatus:S.matchUpStatus}));if(!(d!=null&&d.length))return{...ue};let{tournamentInfo:p}=K0({tournamentRecord:t}),{startDate:h,endDate:f}=p,m=d?.reduce((S,w)=>{let{matchUpId:T,drawId:U}=w;return S[U]?S[U].push(T):S[U]=[T],S},{}),g=1440;for(let S of Object.keys(m)){let w=$v({tournamentRecord:t,drawId:S});if(w.error)return w;let T=w.drawDefinition,U=m[S].filter(C=>i.includes(C));for(let C of U)if(C&&T){let E=(r=d.find(_=>_.matchUpId===C))==null?void 0:r.schedule,{scheduledTime:P,scheduledDate:M}=E,R,N,A;if(!R&&l&&M){let _=Ci(M);A=qE(_,l),R=new Date(A)<new Date(h)||new Date(A)>new Date(f)}if(o&&P){let _=Ci(P),x=an(er(P))+o;if(R=x<0||x>g,!R){let O=il(P,o),$=_&&A||M===_&&_;N=$?`${$}T${O}`:O}}if(R)s.push(C);else{if(!n){if(N){let _=Bv({scheduledTime:N,drawDefinition:T,matchUpId:C});if(_.error)return _}if(A){let _=WB({scheduledDate:A,drawDefinition:T,matchUpId:C});if(_.error)return _}}(N||A)&&a.push(C)}}}let v=Qa({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],y=v.filter(({matchUpId:S})=>a.includes(S)),b=v.filter(({matchUpId:S})=>s.includes(S)),I=y.length&&!b.length;return{...ue,rescheduled:y,notRescheduled:b,allRescheduled:I}}function HDe(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:gr};let{sourceMatchUpContextIds:n,targetMatchUpContextIds:r,sourceCourtId:a,targetCourtId:s,courtDayDate:o}=t||{},{drawId:l,matchUpId:u,tournamentId:c}=n||{},{drawId:d,matchUpId:p,tournamentId:h}=r||{};if(!u&&!p)return pe({result:{error:Xt},stack:e});let{matchUps:f}=Wd({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=f?.find(({matchUpId:I})=>I===u),g=f?.find(({matchUpId:I})=>I===p),v=0;if(s&&u&&!p){let I=y({tournamentId:c,matchUpId:u,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(I!=null&&I.success&&v++,I.error)return pe({result:I,stack:e})}else if(a&&s&&u&&p){let I=y({tournamentId:c,matchUpId:u,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(I.success&&v++,I.error)return pe({result:I,stack:e,info:"source"});let S=y({tournamentId:h,sourceCourtId:s,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:o});if(S.success&&v++,S.error)return pe({result:S,stack:e,info:"target"})}else return{error:Xt};return v?ue:pe({result:{error:_D},stack:e});function y(I){let{tournamentRecords:S,tournamentId:w,matchUp:T,drawId:U}=I,C=S[w],{drawDefinition:E}=$v({tournamentRecord:C,drawId:U});return T.matchUpType===zn?b({...I,tournamentRecord:C,drawDefinition:E}):X0({...I,tournamentRecord:C,drawDefinition:E})}function b({removePriorValues:I,tournamentRecords:S,tournamentRecord:w,drawDefinition:T,sourceCourtId:U,courtDayDate:C,matchUpId:E,matchUp:P,courtId:M}){let R=[M].concat(P.schedule.allocatedCourts.map(({courtId:N})=>N).filter(N=>N!==U));return YB({removePriorValues:I,tournamentRecords:S,tournamentRecord:w,drawDefinition:T,courtDayDate:C,matchUpId:E,courtIds:R})}}function zDe({scheduleAttributes:t=[cf,lv,O0,L0,F0,Cd,Am,Fh,am],tournamentRecord:e,drawDefinition:i,matchUpId:n}){var r,a;let s="clearMatchUpSchedule",o=i?(r=ho({matchUpFilters:{matchUpIds:[n]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:r[0]:(a=Qa({matchUpFilters:{matchUpIds:[n]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:a[0];if(!o)return{error:Gs};let l=(o.timeItems??[]).filter(u=>u?.itemType&&!t.includes(u?.itemType));return o.timeItems=l,Xi({tournamentId:e.tournamentId,context:s,drawDefinition:i,matchUp:o}),{...ue}}function qDe(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="object"||!Object.keys(r).length)return{error:gr};if(typeof n!="object")return{error:Zm};let a=Object.keys(r).filter(s=>!i||i===s);if(i&&!a.includes(i))return{error:Ce};for(let s of a){let o=r[s],l=dn({extension:{name:RM,value:{dailyLimits:n}},element:o});if(l.error)return l}return{...ue}}var WDe={};$i(WDe,{addCollectionDefinition:()=>iK,addCollectionGroup:()=>QDe,aggregateTieFormats:()=>tEe,compareTieFormats:()=>_m,getTieFormat:()=>Y9,modifyCollectionDefinition:()=>eK,modifyTieFormat:()=>eEe,mutate:()=>YDe,orderCollectionDefinitions:()=>XDe,query:()=>uTe,removeCollectionDefinition:()=>tK,removeCollectionGroup:()=>ZDe,tieFormatGenderValidityCheck:()=>b$,validateCollectionDefinition:()=>TM});var YDe={};$i(YDe,{addCollectionDefinition:()=>iK,addCollectionGroup:()=>QDe,aggregateTieFormats:()=>tEe,modifyCollectionDefinition:()=>eK,modifyTieFormat:()=>eEe,orderCollectionDefinitions:()=>XDe,removeCollectionDefinition:()=>tK,removeCollectionGroup:()=>ZDe});function vb({drawDefinition:t,structureId:e,matchUpId:i,structure:n,matchUp:r,eventId:a,event:s}){var o;let l="getTieFormat",u;if(e=n?.structureId??e,i=r?.matchUpId??i,(i||e)&&!t)return{error:Lt};if(a&&s)u=fp(s);else if(i){if(t&&(!r||!n)){let c=tr({drawDefinition:t,matchUpId:i});if(c.error)return c;if(((o=c.matchUp)==null?void 0:o.matchUpType)!==hu)return pe({result:{error:ll},stack:l});n||(n=c.structure),r||(r=c.matchUp)}u=CP({item:r,drawDefinition:t,structure:n,event:s})||CP({item:n,drawDefinition:t,structure:n,event:s})||fp(t)||fp(s)}else if(t&&e){if(!n){let c=ui({drawDefinition:t,structureId:e});if(c.error)return c;n=c?.structure}u=CP({item:n,drawDefinition:t,structure:n,event:s})||fp(t)||fp(s)}else u=fp(t)||fp(s);return u?{...ue,structure:n,tieFormat:u,matchUp:r}:pe({result:{error:MD},stack:l})}function Lx({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![wa].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==vd&&!Sa(t))}function VV({from:t,to:e}){let i=Object.keys(t),n=Pr(i,Object.keys(e)).length===i.length,r=i.filter(s=>t[s]!==e[s]).map(s=>({countChange:e[s]-t[s],collectionId:s})),a=i.every(s=>t[s]===e[s]);return{equivalent:n&&a,matchUpsCountChanges:r}}function zKe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:n,tieFormat:r,eventId:a,matchUp:s,event:o,uuids:l}){var u,c,d,p;let h="updateTieFormat",f=e?.tournamentId,m=0,g=0,v=0,y=0,b=r?.collectionDefinitions.reduce((E,P)=>(E[P.collectionId]=(E[P.collectionId]||0)+P.matchUpCount,E),{}),I=({tieFormat:E})=>{let P=E?.collectionDefinitions.reduce((M,R)=>(M[R.collectionId]=(M[R.collectionId]||0)+R.matchUpCount,M),{});return VV({from:P,to:b}).equivalent},S=(u=vb({drawDefinition:i}))==null?void 0:u.tieFormat,w=(c=vb({event:o}))==null?void 0:c.tieFormat;if(o&&a){for(let E of o.drawDefinitions??[])T({drawDefinition:E});o.tieFormat=fs(r),y+=1}else if(s){if(!s.tieMatchUps)return pe({result:{error:ll},stack:h});let E=Ol((d=s.tieMatchUps)==null?void 0:d.map(({collectionId:A})=>A)),P=VV({to:b,from:E}),{changes:M,changesArePossible:R,cannotChangeReaon:N}=dee({matchUp:s,check:P});if(P.equivalent)if(Lx({matchUp:s,updateInProgressMatchUps:t}))s.tieFormat=fs(r),y+=1;else return pe({result:{error:o7},info:"matchUp is IN_PROGRESS or COMPLETE",stack:h});else if(R)C({tieFormat:r,matchUp:s,changes:M,uuids:l});else return pe({context:{collectionMap:b,matchUpMap:E},result:{error:Oh},info:N||"specified changes not possible",stack:h});g+=1,Xi({eventId:o?.eventId,context:h,drawDefinition:i,tournamentId:f,matchUp:s})}else if(n){let E=(p=U({inheritedTieFormat:S??w,structure:n}))==null?void 0:p.modifiedMatchUpsCount;E&&(g+=E,m+=1,y+=1);let P=!n.tieFormat||_m({ancestor:n.tieFormat,descendant:r}).different;P&&(n.tieFormat=fs(r),m+=1,y+=1),(E||P)&&i&&Bn({structureIds:[n.structureId],eventId:o?.eventId,drawDefinition:i})}else if(i)T({drawDefinition:i}),i.tieFormat=fs(r),y+=1;else return{error:Lt};return{modifiedStructuresCount:m,modifiedMatchUpsCount:g,addedMatchUpsCount:v,modifiedCount:y,...ue,tieFormat:r};function T({drawDefinition:E}){var P;let M=E.structures||[],R=[];for(let N of M){if(N.tieFormat)continue;let A=(P=U({inheritedTieFormat:w,structure:N}))==null?void 0:P.modifiedMatchUpsCount;if(A){m+=1,g+=A;let _=N.structureId;R.push(_)}}return Bn({structureIds:R,eventId:o?.eventId,drawDefinition:E}),R.length}function U({inheritedTieFormat:E,structure:P}){var M,R;let N=0,A=((M=vn({matchUpFilters:{matchUpTypes:[zn]},structure:P}))==null?void 0:M.matchUps)||[];for(let _ of A){let x=Lx({matchUp:_,updateInProgressMatchUps:t}),O=!1,$=Ol((R=_.tieMatchUps)==null?void 0:R.map(({collectionId:j})=>j)),F=VV({from:$,to:b});if(F.equivalent)_.tieFormat&&I(_)&&x&&(_.tieFormat=fs(r),O=!0);else{let{changes:j,changesArePossible:H}=dee({matchUp:_,check:F});if(H&&!_.tieFormat)C({changes:j,matchUp:_,tieFormat:r,uuids:l});else if(E)(!_.tieFormat||_m({ancestor:E,descendant:_.tieFormat}).different)&&(_.tieFormat=E,O=!0);else return pe({result:{error:MD},stack:h})}O&&(N+=1,Xi({tournamentId:e?.tournamentId,drawDefinition:i,context:h,eventId:a,matchUp:_}))}return{modifiedMatchUpsCount:N}}function C({uuids:E,matchUp:P,tieFormat:M,changes:R}){P.tieFormat=fs(M);let N=[],A=[];return R.forEach(_=>{if(_.countChange>0){let x=Math.max(0,...P.tieMatchUps.filter(F=>F.collectionId===_.collectionId).map(Bl("collectionPosition"))),O=M.collectionDefinitions.find(F=>F.collectionId===_.collectionId),$=aN({matchUpsLimit:_.countChange,collectionPositionOffset:x,collectionDefinition:O,matchUp:P,uuids:E});A.push(...At($,!1,!0)),v+=A.length,P.tieMatchUps.push(...$)}else{let x=_.toBePlayedTieMatchUpIds.slice(0,Math.abs(_.countChange));console.log("remove",x.length),N.push(...x),P.tieMatchUps=P.tieMatchUps.filter(({matchUpId:O})=>!x.includes(O))}}),A.length&&sv({matchUps:A,drawDefinition:i,tournamentId:f,eventId:a}),N.length&&Xm({matchUpIds:N,action:"updateTieFormat",drawDefinition:i,tournamentId:f,eventId:a}),{matchUpIdsRemoved:N,matchUpsAdded:A}}}function dee({check:t,matchUp:e}){let i="",n=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:r,countChange:a})=>{let s=e.tieMatchUps.filter(l=>l.collectionId===r&&l.matchUpStatus===Or).map(Bl("matchUpId")),o=s.length+a>=0||a>0;return!o&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),n.push({toBePlayedTieMatchUpIds:s,collectionId:r,countChange:a}),o}),changes:n,cannotChangeReaon:i}}function i2({appliedPolicies:t,drawDefinition:e,auditData:i}){var n;if(!((n=t?.audit)!=null&&n[EP]))return;let{extension:r}=ki({name:EP,element:e}),a={value:Array.isArray(r?.value)?r?.value.concat(i):[i],name:EP};dn({element:e,extension:a})}function eK({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:n,tieFormatName:r,drawDefinition:a,matchUpFormat:s,matchUpCount:o,collectionId:l,matchUpType:u,structureId:c,matchUpId:d,category:p,eventId:h,gender:f,event:m,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I}){let S="modifyCollectionDefinition";if(s&&!Ll({matchUpFormat:s}))return pe({result:{error:Ce},context:{matchUpFormat:s},stack:S});if(n&&typeof n!="string")return pe({result:{error:Ce},context:{collectionName:n},stack:S});if(f&&!Object.values(U7).includes(f))return pe({result:{error:Ce},context:{gender:f},stack:S});if(p&&typeof p!="object")return pe({result:{error:Ce},context:{category:p},stack:S});let w={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I};if(!Object.values(w).filter(Boolean).length&&!i&&!n&&!s&&!o&&!u)return pe({result:{error:Xt},stack:S});if(Object.values(w).filter(Boolean).length>1)return pe({info:"Only one value assignment allowed per collectionDefinition",result:{error:Ce},stack:S});let T=vb({drawDefinition:a,structureId:c,matchUpId:d,eventId:h,event:m});if(T.error)return pe({result:T,stack:S});let{matchUp:U,structure:C,tieFormat:E}=T,P=fs(E),M=E?.collectionDefinitions.find(G=>G.collectionId===l),R=P?.collectionDefinitions.find(G=>G.collectionId===l);if(!M)return pe({info:"source collectionDefinition",result:{error:Xa},context:{collectionId:l},stack:S});let N=v??y??b??I;if(g!=null&&g.length){let G=Ave({matchUpCount:o??M?.matchUpCount??0,collectionValueProfiles:g});if(G.errors)return pe({result:{error:Ce},info:G.errors,stack:S})}else if(N&&!bi(N))return pe({result:{error:Ce},info:"value is not an integer",context:{value:N},stack:S});let A=(G,W)=>Pr(Object.keys(G),Object.keys(W)).length===Object.keys(G).length&&Pr(Object.values(G),Object.values(W)).length===Object.values(G).length,_=g&&(!M.collectionValueProfiles||!A(M.collectionValueProfiles,g)),x=bi(v)&&M.collectionValue!==v||bi(y)&&M.matchUpValue!==y||bi(b)&&M.scoreValue!==b||bi(I)&&M.setValue!==I||_,O=[];if(x&&(R.collectionValueProfiles=void 0,R.collectionValue=void 0,R.matchUpValue=void 0,R.scoreValue=void 0,R.setValue=void 0,Object.assign(R,w),O.push({collectionId:l,...Gt(w)})),(bi(b)||bi(I))&&R.collectionGroupNumber){let G=R.collectionGroupNumber;P.collectionDefinitions=P.collectionDefinitions.map(W=>{let{collectionGroupNumber:q,...Z}=W;return q===G?Z:W}),P.collectionGroups=P.collectionGroups.filter(({groupNumber:W})=>W!==G),O.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:$,valueGoal:F}=Z0(P),j=Gt({aggregateValue:$,valueGoal:F});if((j.aggregateValue!==E?.winCriteria.aggregateValue||j.valueGoal!==E?.winCriteria.valueGoal)&&(P.winCriteria=j,O.push({collectionId:l,winCriteria:j})),bi(i)&&M.collectionOrder!==i&&(R.collectionOrder=i,O.push({collectionId:l,collectionOrder:i})),n&&M.collectionName!==n&&(R.collectionName=n,O.push({collectionId:l,collectionName:n})),s&&M.matchUpFormat!==s&&(R.matchUpFormat=s,O.push({collectionId:l,matchUpFormat:s})),bi(o)&&M.matchUpCount!==o&&(R.matchUpCount=o,O.push({collectionId:l,matchUpCount:o})),u&&M.matchUpType!==u)return pe({result:{error:h$},context:{matchUpType:u},stack:S});p&&M.category!==p&&(R.category=p,O.push({collectionId:l,category:p})),f&&M.gender!==f&&(R.gender=f,O.push({collectionId:l,gender:f}));let H=Gt(P);if(T=Bo({tieFormat:H}),T.error)return pe({result:T,stack:S});if(!O.length)return pe({result:{...ue,modifications:O}});if(E?.tieFormatName!==r?(H.tieFormatName=r,O.push({tieFormatName:r})):O.length&&(delete H.tieFormatName,O.push("tieFormatName removed: modifications without new tieFormatName")),T=zKe({tieFormat:H,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:C,eventId:h,matchUp:U,event:m}),!T.error){let{appliedPolicies:G}=pn({tournamentRecord:e}),W=Gt({collectionDefinition:R,drawId:a?.drawId,action:S,structureId:c,matchUpId:d,eventId:h});i2({appliedPolicies:G,drawDefinition:a,auditData:W})}return pe({result:{...T,modifications:O},stack:S})}function qKe({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:n,matchUpId:r,matchUp:a}){var s,o;let l=[];return r&&a?l=[a]:i&&n?l=((s=vn({matchUpFilters:{matchUpTypes:[zn]},structure:n}))==null?void 0:s.matchUps)??[]:e&&(l=((o=ho({matchUpFilters:{matchUpTypes:[zn]},drawDefinition:e}))==null?void 0:o.matchUps)??[]),{targetMatchUps:l.filter(u=>!u.winningSide&&u.matchUpStatus!==kr&&(t||u.matchUpStatus!==vd&&!Sa(u)))}}function WKe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:n,tieFormat:r,event:a}){for(let s of n){let o=!!s.tieFormat;o&&(s.tieFormat=fs(r));let l;if(t){let u=pn({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,c=eg({matchUpId:s.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:u,drawDefinition:i,event:a});if(c.error)return c;l=c.score}o&&!l&&Xi({tournamentId:e?.tournamentId,context:"updateTargetTeamMatchUps",eventId:a?.eventId,matchUp:s,drawDefinition:i})}return{...ue}}function KDe({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:n,tieFormatName:r,drawDefinition:a,structureId:s,structure:o,tieFormat:l,matchUpId:u,matchUp:c,eventId:d,event:p}){let{aggregateValue:h,valueGoal:f}=Z0(l);l.winCriteria=Gt({aggregateValue:h,valueGoal:f}),(e&&e!==f||h&&!n)&&(r?l.tieFormatName=r:delete l.tieFormatName);let{targetMatchUps:m}=qKe({updateInProgressMatchUps:t,drawDefinition:a,structureId:s,structure:o,matchUpId:u,matchUp:c});WKe({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:a,tieFormat:l,event:p});let g=Gt(l),v=Bo({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(u&&c)c.tieFormat=l;else if(o)o.tieFormat=g;else if(a)a.tieFormat=g;else if(!c||!a)return{error:Lt};return Bn({drawDefinition:a,eventId:p?.eventId}),{...ue}}function ZDe({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,matchUpId:s,matchUp:o,eventId:l,event:u}){if(!e)return{error:Xt};if(isNaN(e))return{error:Ce};let c="removeCollectionGroup",d=o?void 0:vb({drawDefinition:n,structureId:a,matchUpId:s,eventId:l,event:u});if(d!=null&&d.error)return pe({result:d,stack:c});let p=d?.structure;o=o??d?.matchUp;let h=d?.tieFormat,f=h?.winCriteria.valueGoal,m=h?.winCriteria.aggregateValue,g=fs(h);if(d=Bo({tieFormat:g}),d.error)return pe({result:d,stack:c});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(y=>{let{collectionGroupNumber:b,...I}=y;return b!==e?y:(v.push(y.collectionId),I)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:y})=>y!==e),d=KDe({updateInProgressMatchUps:t,originalValueGoal:f,wasAggregateValue:m,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,structure:p,tieFormat:g,matchUpId:s,matchUp:o,eventId:l,event:u}),!d.error){let{appliedPolicies:y}=pn({tournamentRecord:i}),b=Gt({drawId:n?.drawId,collectionGroupNumber:e,action:c,structureId:a,matchUpId:s,eventId:l});i2({appliedPolicies:y,drawDefinition:n,auditData:b})}return pe({result:{...d,modifiedCollectionIds:v},stack:c})}function TU({tieFormat:t,orderMap:e}){var i;let n=fs(t);return n.collectionDefinitions.forEach(r=>{let a=e[r.collectionId];a&&(r.collectionOrder=a)}),(i=n.collectionDefinitions)==null||i.sort((r,a)=>QT(r.collectionOrder)-QT(a.collectionOrder)),n}function XDe({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,orderMap:r,eventId:a,matchUp:s,event:o}){if(typeof r!="object"||!Object.values(r).every(l=>bi(l)))return pe({result:{error:Ce},context:{orderMap:r}});if(a&&o!=null&&o.tieFormat)pee({tournamentRecord:t,event:o,orderMap:r});else if(n){let l=e&&tr({drawDefinition:e,matchUpId:n});if(l!=null&&l.error)return l;if(s=l.matchUp,!s)return{error:ol};s!=null&&s.tieFormat&&(s.tieFormat=TU({tieFormat:s.tieFormat,orderMap:r}),Xi({tournamentId:t?.tournamentId,eventId:o?.eventId,drawDefinition:e,matchUp:s}))}else if(i){let l=ui({drawDefinition:e,structureId:i});if(l.error)return l;let u=l.structure;if(u!=null&&u.tieFormat)u.tieFormat=TU({tieFormat:u.tieFormat,orderMap:r}),JDe({eventId:o?.eventId,tournamentRecord:t,drawDefinition:e,structure:u,orderMap:r}),Bn({drawDefinition:e,structureIds:[u.structureId]});else if(e.tieFormat)cz({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:r,event:o});else if(o!=null&&o.tieFormat)pee({structureIds:[i],tournamentRecord:t,orderMap:r,event:o});else return{error:Xa}}else if(e!=null&&e.tieFormat)cz({tournamentRecord:t,drawDefinition:e,orderMap:r,event:o});else return{error:Xa};return{...ue}}function pee({tournamentRecord:t,structureIds:e,orderMap:i,event:n}){let r=TU({tieFormat:n.tieFormat,orderMap:i});e!=null&&e.length||(n.tieFormat=r);for(let a of n.drawDefinitions??[])cz({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:n})}function cz({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:n,event:r}){let a=e.tieFormat??r?.tieFormat,s=TU({tieFormat:a,orderMap:n});i!=null&&i.length||(e.tieFormat=s);let o=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=TU({tieFormat:l.tieFormat??e.tieFormat??r?.tieFormat,orderMap:n})),JDe({eventId:r?.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:n}),o.push(l.structureId));Bn({drawDefinition:e,structureIds:o})}function JDe({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:n,eventId:r}){var a;let s=(a=vn({matchUpFilters:{matchUpTypes:[zn]},structure:i}))==null?void 0:a.matchUps;for(let o of s)o.tieFormat&&(o.tieFormat=TU({tieFormat:o.tieFormat,orderMap:n}),Xi({tournamentId:t?.tournamentId,drawDefinition:e,eventId:r,matchUp:o}))}function tK({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,collectionId:a,structureId:s,matchUpId:o,eventId:l,matchUp:u,event:c}){var d,p,h,f,m;let g="removeCollectionDefinition",v=u?void 0:vb({drawDefinition:n,structureId:s,matchUpId:o,eventId:l,event:c});if(v!=null&&v.error)return pe({result:v,stack:g});let y=v?.structure;u=u??v?.matchUp;let b=v?.tieFormat,I=fs(b);if(v=Bo({tieFormat:I}),v.error)return pe({result:v,stack:g});let S=(d=I?.collectionDefinitions)==null?void 0:d.find(_=>_.collectionId===a);if(!S)return pe({result:{error:Xa,collectionId:a}});I.collectionDefinitions=I.collectionDefinitions.filter(_=>_.collectionId!==a),S.collectionGroupNumber&&(I.collectionDefinitions=I.collectionDefinitions.map(_=>{let{collectionGroupNumber:x,...O}=_;return O}),I.collectionGroups=I.collectionGroups.filter(({groupNumber:_})=>_!==S.collectionGroupNumber));let{aggregateValue:w,valueGoal:T}=Z0(I);I.winCriteria=Gt({aggregateValue:w,valueGoal:T});let U=b?.winCriteria.valueGoal,C=b?.winCriteria.aggregateValue;(U&&U!==T||w&&!C)&&(r?I.tieFormatName=r:delete I.tieFormatName);let E=[];o&&u?E=[u]:s&&y?E=((p=vn({matchUpFilters:{matchUpTypes:[zn]},structure:y}))==null?void 0:p.matchUps)??[]:n?E=((h=ho({matchUpFilters:{matchUpTypes:[zn]},drawDefinition:n}))==null?void 0:h.matchUps)??[]:c&&(E=((f=If({matchUpFilters:{matchUpTypes:[zn]}}))==null?void 0:f.matchUps)??[]);let P=(E||[]).filter(_=>{var x,O,$;let F=(O=(x=_.tieMatchUps)==null?void 0:x.filter(H=>H.collectionId===a))==null?void 0:O.some(Sa),j=e&&_.tieFormat?($=_m({descendant:_.tieFormat,ancestor:I}))==null?void 0:$.different:!1;return t&&!F||!_.winningSide&&_.matchUpStatus!==kr&&(t||_.matchUpStatus!==vd&&!Sa(_)&&!j)});if(!P.length)return{error:_D};let{appliedPolicies:M}=pn({tournamentRecord:i});if(o&&u&&t){let _=(m=u.tieMatchUps)==null?void 0:m.filter(x=>x.collectionId===a);for(let x of _??[]){let O=SN({matchUpId:x.matchUpId,tieMatchUpId:u?.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:M,drawDefinition:n,event:c});if(O.error||(O=tr({drawDefinition:n,matchUpId:o}),O.error))return O;u=O?.matchUp}}let R=[];for(let _ of P){for(let x of _?.sides??[])x.lineUp=(x.lineUp??[]).map(O=>({participantId:O.participantId,collectionAssignments:(O?.collectionAssignments??[]).filter($=>$.collectionId!==a)}));if(_.tieMatchUps=(_.tieMatchUps??[]).filter(x=>{let O=x.collectionId===a;return O&&R.push(x.matchUpId),!O}),_.tieFormat&&(_.tieFormat=fs(I)),t){let x=eg({matchUpId:_.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:M,drawDefinition:n,event:c});if(x.error)return x}Xi({tournamentId:i?.tournamentId,eventId:c?.eventId,drawDefinition:n,context:g,matchUp:_})}R.length&&Xm({tournamentId:i?.tournamentId,matchUpIds:R,eventId:c?.eventId,drawDefinition:n});let N=Gt(I);if(v=Bo({tieFormat:N}),v.error)return pe({result:v,stack:g});if(l&&c)c.tieFormat=N;else if(o&&u)u.tieFormat=N;else if(y)y.tieFormat=N;else if(n)n.tieFormat=N;else if(!u||!n)return{error:Lt};Bn({drawDefinition:n,eventId:c?.eventId});let A=Gt({drawId:n?.drawId,action:g,collectionId:a,structureId:s,matchUpId:o,eventId:l});return i2({appliedPolicies:M,drawDefinition:n,auditData:A}),{tieFormat:N,deletedMatchUpIds:R,targetMatchUps:P,...ue}}function QDe({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:n,collectionIds:r,tieFormatName:a,structureId:s,matchUpId:o,matchUp:l,eventId:u,event:c}){let d="addCollectionGroup";if(!Array.isArray(r))return pe({result:{error:Xt},stack:d});let p=l?void 0:vb({drawDefinition:n,structureId:s,matchUpId:o,eventId:u,event:c});if(p!=null&&p.error)return pe({result:p,stack:d});let h=p?.structure;l=l||p?.matchUp;let f=p?.tieFormat,m=f?.winCriteria.valueGoal,g=fs(f);if(p=Bo({tieFormat:g}),p.error)return pe({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:b,collectionGroupNumber:I}=y;if(I&&r.includes(b))return pe({info:"collectionIds cannot be part of other collectionGroups",result:{error:Ce},stack:d})}let v=(g.collectionGroups||[]).reduce((y,b)=>b.groupNumber>y?b.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>r.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],KDe({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:n,tieFormatName:a,structureId:s,structure:h,tieFormat:g,matchUpId:o,matchUp:l,eventId:u,event:c})}function iK({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:n,policyDefinitions:r,enforceCategory:a,referenceGender:s,drawDefinition:o,tieFormatName:l,enforceGender:u,structureId:c,matchUpId:d,matchUp:p,eventId:h,uuids:f,event:m}){var g,v;let y="addCollectionDefinition",b=pn({tournamentRecord:n,drawDefinition:o,event:m}).appliedPolicies??{},I=r?.[Wa]??b?.[Wa];a=a??((g=I?.participants)==null?void 0:g.enforceCategory);let S=(u??((v=I?.participants)==null?void 0:v.enforceGender))!==!1,w=!!((i??m?.category)&&a!==!1),T=!!((s??m?.gender)&&S),U=TM({referenceCategory:i??m?.category,collectionDefinition:e,referenceGender:s,checkCategory:w,checkGender:T,event:m});if(U.error)return pe({result:U,stack:y});let C=p!=null&&p.tieFormat?void 0:vb({drawDefinition:o,structureId:c,matchUpId:d,eventId:h,event:m});if(C!=null&&C.error)return pe({result:{error:C.error},stack:y});let E=C?.structure;p=p??C?.matchUp;let P=p?.tieFormat??C?.tieFormat,M=fs(P);if(C=Bo({tieFormat:M}),C?.error)return pe({result:{error:C.error},stack:y});if(!e.collectionId)e.collectionId=gn();else if(M.collectionDefinitions.map(({collectionId:H})=>H).includes(e.collectionId))return pe({context:{collectionId:e.collectionId},result:{error:xye}});M.collectionDefinitions.push(e),M.collectionDefinitions.sort((H,G)=>(H.collectionOrder||0)-(G.collectionOrder||0)).forEach((H,G)=>H.collectionOrder=G+1);let{aggregateValue:R,valueGoal:N}=Z0(M);M.winCriteria=Gt({aggregateValue:R,valueGoal:N});let A=P?.winCriteria.valueGoal,_=P?.winCriteria.aggregateValue;(A&&A!==N||R&&!_)&&(l?M.tieFormatName=l:delete M.tieFormatName);let x=[],O=[],$=[],F=Gt(M);if(C=Bo({tieFormat:F}),C?.error)return pe({result:{error:C.error},stack:y});if(h&&m){m.tieFormat=F;for(let H of m.drawDefinitions??[])if(!H.tieFormat)for(let G of H.structures??[]){if(G.tieFormat)continue;let W=jV({updateInProgressMatchUps:t,collectionDefinition:e,structure:G,uuids:f});O.push(...W.newMatchUps),$.push(...W.targetMatchUps),x.push(G.structureId)}gA({modifiedMatchUps:$,eventId:m?.eventId,modifiedStructureIds:x,tournamentRecord:n,drawDefinition:o,addedMatchUps:O,stack:y})}else if(c&&E){E.tieFormat=F;let H=jV({updateInProgressMatchUps:t,collectionDefinition:e,structure:E,uuids:f});O.push(...H.newMatchUps),$=H.targetMatchUps,gA({modifiedMatchUps:$,eventId:m?.eventId,modifiedStructureIds:x,tournamentRecord:n,drawDefinition:o,addedMatchUps:O,stack:y})}else if(d&&p){if(!Lx({matchUp:p,updateInProgressMatchUps:t}))return pe({result:{error:o7},stack:y});p.tieFormat=F;let H=aN({collectionDefinition:e,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...H),O.push(...H),gA({modifiedMatchUps:[p],eventId:m?.eventId,modifiedStructureIds:x,tournamentRecord:n,drawDefinition:o,addedMatchUps:O,stack:y})}else if(o){o.tieFormat=F;for(let H of o.structures??[]){let G=jV({updateInProgressMatchUps:t,collectionDefinition:e,structure:H,uuids:f});x.push(H.structureId),O.push(...G.newMatchUps),$.push(...G.targetMatchUps)}gA({modifiedMatchUps:$,eventId:m?.eventId,tournamentRecord:n,drawDefinition:o,addedMatchUps:O,stack:y})}else return{error:Lt};let j=Gt({drawId:o?.drawId,collectionDefinition:e,action:y,structureId:c,matchUpId:d,eventId:h});return i2({appliedPolicies:b,drawDefinition:o,auditData:j}),{tieFormat:F,targetMatchUps:$,addedMatchUps:O,...ue}}function jV({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:n}){var r;let a=[],s=((r=vn({matchUpFilters:{matchUpTypes:[zn]},structure:i}))==null?void 0:r.matchUps).filter(o=>Lx({matchUp:o,updateInProgressMatchUps:t})&&!o.tieFormat);for(let o of s){let l=aN({collectionDefinition:e,matchUp:o,uuids:n});Array.isArray(o.tieMatchUps)||(o.tieMatchUps=[]),o.tieMatchUps.push(...l),a.push(...l)}return{newMatchUps:a,targetMatchUps:s}}function gA({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:n,addedMatchUps:r,eventId:a,stack:s}){sv({tournamentId:e?.tournamentId,matchUps:r,drawDefinition:n,eventId:a}),i?.forEach(o=>{Xi({tournamentId:e?.tournamentId,drawDefinition:n,context:s,matchUp:o,eventId:a})}),Bn({structureIds:t,drawDefinition:n,eventId:a})}function eEe({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:n,considerations:r,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,uuids:u,event:c}){let d="modifyTieFormat";if(!Bo({tieFormat:i}).valid)return pe({result:{error:Oh},info:"falied validation",stack:d});let p=vb({drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:c});if(p.error)return pe({result:p,stack:d});let{matchUp:h,tieFormat:f}=p,m=fs(f),g=_m({descendant:i,ancestor:m,considerations:r});if(g.invalid)return pe({context:{invalid:g.invalid},result:{error:Oh},stack:d});if(!(g!=null&&g.different))return pe({result:{...ue},info:"Nothing to do",stack:d});let v=m.collectionDefinitions.map(({collectionId:C})=>C),y=i.collectionDefinitions.map(({collectionId:C})=>C),b=v.filter(C=>!y.includes(C)),I=i.collectionDefinitions.filter(({collectionId:C})=>!v.includes(C)),S=I.map(Bl("collectionId")),w=[],T,U=i.tieFormatName;for(let C of i.collectionDefinitions){if(S.includes(C.collectionId))continue;let E=eK({updateInProgressMatchUps:t,...C,tournamentRecord:n,tieFormatName:U,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:c});if(E.modifications&&w.push(...E.modifications),E.error)return pe({result:E,stack:d});E.tieFormat&&(T=E.tieFormat)}for(let C of I){let E=iK({updateInProgressMatchUps:t,collectionDefinition:C,tournamentRecord:n,drawDefinition:a,tieFormatName:U,structureId:s,matchUpId:o,matchUp:h,eventId:l,uuids:u,event:c});if(E.error)return pe({result:E,stack:d});E.tieFormat&&(T=E.tieFormat)}for(let C of b){let E=tK({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:n,drawDefinition:a,tieFormatName:U,collectionId:C,structureId:s,matchUpId:o,eventId:l,matchUp:h,event:c});if(E.error)return pe({result:E,stack:d});E.tieFormat&&(T=E.tieFormat)}return f?.tieFormatName!==U?(T.tieFormatName=U,w.push({tieFormatName:U})):(w.length||S.length||b.length)&&(delete T.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),T.collectionDefinitions=T.collectionDefinitions.sort((C,E)=>QT(C.collectionOrder)-QT(E.collectionOrder)).map((C,E)=>({...C,collectionOrder:E+1})),{processedTieFormat:fs(T),modifications:w,...ue}}function tEe({tournamentRecord:t}){if(!t)return{error:lt};let e=0;for(let i of t.events??[]){let n=i.tieFormats??[],r=u=>{if(!u.tieFormat)return;let c;for(let d of n)_m({descendant:u.tieFormat,ancestor:d}).different||(c=d.tieFormatId);if(c)u.tieFormatId=c,delete u.tieFormat;else{let d=At(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=gn()),u.tieFormatId=d.tieFormatId,delete u.tieFormat,n.push(d),e+=1}};i.eventType,r({tieFormat:i.tieFormat});for(let u of i.drawDefinitions??[]){r({tieFormat:u.tieFormat});for(let c of u.structures??[])r({tieFormat:c.tieFormat})}let a=(u,c)=>{var d;let p=(d=o.matchUps)==null?void 0:d.find(h=>h.matchUpId===u);p&&(p.tieFormatId=c,delete p.tieFormat,Xi({tournamentId:t?.tournamentId,eventId:i.eventId,matchUp:p}))},s=u=>{let c=At(u.tieFormat,void 0,!0);c.tieFormatId||(c.tieFormatId=gn()),n.push(c),e+=1,a(u.matchUpId,c.tieFormatId)},o=If({matchUpFilters:{matchUpTypes:[hu]},event:i}),l=o.matchUps??[];for(let u of l){let c;for(let d of n)u.tieFormat&&_m({descendant:u.tieFormat,ancestor:d}).different||(c=d.tieFormatId);c?a(u.matchUpId,c):s(u)}n.length&&(i.tieFormats=n)}return{...ue,addedCount:e}}var iEe={};$i(iEe,{addDrawDefinitionExtension:()=>A$,addEventExtension:()=>kv,addEventTimeItem:()=>W0,addExtension:()=>dn,addNotes:()=>sB,addOnlineResource:()=>uEe,addParticipantExtension:()=>sIe,addParticipantTimeItem:()=>d9,addTimeItem:()=>lh,addTournamentExtension:()=>q7,addTournamentTimeItem:()=>uN,analyzeDraws:()=>cN,analyzeTournament:()=>q9,copyTournamentRecord:()=>rEe,createTournamentRecord:()=>QB,generate:()=>nEe,getAggregateTeamResults:()=>z9,getAllowedDrawTypes:()=>SB,getAllowedMatchUpFormats:()=>j9,getAppliedPolicies:()=>pn,getCompetitionDateRange:()=>UB,getCompetitionPenalties:()=>G9,getPolicyDefinitions:()=>Jm,getTournamentInfo:()=>K0,getTournamentPenalties:()=>TB,getTournamentPersons:()=>H9,getTournamentPoints:()=>DB,getTournamentStructures:()=>q8,getTournamentTimeItem:()=>G$,mutate:()=>aEe,query:()=>sTe,removeDrawDefinitionExtension:()=>oIe,removeEventExtension:()=>_$,removeExtension:()=>po,removeNotes:()=>o9,removeOnlineResource:()=>lEe,removeParticipantExtension:()=>lIe,removeTournamentExtension:()=>W7,setTournamentCategories:()=>pEe,setTournamentDates:()=>n2,setTournamentEndDate:()=>fEe,setTournamentName:()=>cEe,setTournamentNotes:()=>dEe,setTournamentStartDate:()=>hEe,setTournamentStatus:()=>oEe});var nEe={};$i(nEe,{copyTournamentRecord:()=>rEe,createTournamentRecord:()=>QB});function rEe(t){var e,i;let n=Yt(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(n.error)return n;let{startDate:r,endDate:a}=t.tournamentRecord,s=1440*60*1e3,o=(r&&a?new Date(Ci(a)).getTime()-new Date(Ci(r)).getTime():0)/s,l=t.endDate||C7(t.startDate,o),u=f=>f?.filter(({itemType:m})=>{var g;return(g=t.itemTypeList)==null?void 0:g.includes(m)}),c=f=>f?.filter(({name:m})=>{var g;return(g=t.extensionList)==null?void 0:g.includes(m)}),d=f=>{let{timeItems:m,extensions:g,...v}=f;return At({...v,timeItems:u(m),extensions:c(g)},!1,!0)},p=f=>{let{drawDefinitions:m,timeItems:g,extensions:v,startDate:y,endDate:b,...I}=f;return At({extensions:c(v),timeItems:u(g),startDate:t.startDate,endDate:l,...I},!1,!0)},h={participants:t.copyParticipants?((e=t.tournamentRecord.participants)==null?void 0:e.map(d))??[]:[],parentOrganisation:At({...t.tournamentRecord.parentOrganisation},!1,!0),venues:At(t.tournamentRecord.venues??[],!1,!0),extensions:c(t.tournamentRecord.extensions),timeItems:u(t.tournamentRecord.timeItems),events:((i=t.tournamentRecord.events)==null?void 0:i.map(p))??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:gn(),endDate:l};return{...ue,tournamentRecord:h}}var aEe={};$i(aEe,{addDrawDefinitionExtension:()=>A$,addEventExtension:()=>kv,addEventTimeItem:()=>W0,addExtension:()=>dn,addNotes:()=>sB,addOnlineResource:()=>uEe,addParticipantExtension:()=>sIe,addParticipantTimeItem:()=>d9,addTimeItem:()=>lh,addTournamentExtension:()=>q7,addTournamentTimeItem:()=>uN,removeDrawDefinitionExtension:()=>oIe,removeEventExtension:()=>_$,removeExtension:()=>po,removeNotes:()=>o9,removeOnlineResource:()=>lEe,removeParticipantExtension:()=>lIe,removeTournamentExtension:()=>W7,setTournamentCategories:()=>pEe,setTournamentDates:()=>n2,setTournamentEndDate:()=>fEe,setTournamentName:()=>cEe,setTournamentNotes:()=>dEe,setTournamentStartDate:()=>hEe,setTournamentStatus:()=>oEe});var YKe="ABANDONED",KKe="ACTIVE",ZKe="CANCELLED",XKe="COMPLETED",JKe="IN_PROGRESS",sEe={ABANDONED:YKe,ACTIVE:KKe,CANCELLED:ZKe,COMPLETED:XKe,IN_PROGRESS:JKe};function oEe({tournamentRecord:t,status:e}){return t?e&&!Object.keys(sEe).includes(e)?{error:Ce,info:"Unknown status"}:(t.tournamentStatus=e,{...ue}):{error:lt}}function lEe(t){var e,i,n;let r=Yt(t,[{tournamentRecord:!0,onlineResource:!0}]);if(r.error)return r;let{tournamentRecord:a,onlineResource:s,organisationId:o,participantId:l,personId:u,courtId:c,venueId:d}=t;if(o){if(((e=a.parentOrganisation)==null?void 0:e.parentOrganisationId)!==o)return pe({result:{error:Xa}});SS({element:a.parentOrganisation,onlineResource:s})}else if(l||u){let p=(a.participants??[]).find(h=>{var f;return u&&((f=h.person)==null?void 0:f.personId)===u||h.participantId===l});if(!p)return pe(u?{result:{error:Xa}}:{result:{error:Ar}});if(u){if(((i=p.person)==null?void 0:i.personId)!==u)return pe({result:{error:E0}});SS({element:p.person,onlineResource:s})}else SS({element:p,onlineResource:s})}else if(c){let p=(n=(a.venues??[]).filter(h=>!d||h.venueId===d).flatMap(h=>(h.courts??[]).filter(f=>f.courtId===c)))==null?void 0:n[0];if(!p)return pe({result:{error:AD}});SS({element:p,onlineResource:s})}else if(d){let p=(a.venues??[]).find(h=>h.venueId===d);if(!p)return pe({result:{error:C0}});SS({element:p,onlineResource:s})}else SS({element:a,onlineResource:s}),Ui({payload:{parentOrganisation:a.parentOrganisation,onlineResources:a.onlineResources,tournamentId:a.tournamentId},topic:Vb});return{...ue}}function SS({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(n=>!(n?.[aU]===e[aU]&&n?.[sU]===e[sU]&&n?.[oU]===e[oU]));t.onlineResources=i}function uEe(t){var e,i,n;let r=Yt(t,[{tournamentRecord:!0,onlineResource:!0}]);if(r.error)return r;let{tournamentRecord:a,onlineResource:s,organisationId:o,participantId:l,personId:u,courtId:c,venueId:d}=t;if(o){if(((e=a.parentOrganisation)==null?void 0:e.parentOrganisationId)!==o)return pe({result:{error:Xa}});TS({element:a.parentOrganisation,onlineResource:s})}else if(l||u){let p=(a.participants??[]).find(h=>{var f;return u&&((f=h.person)==null?void 0:f.personId)===u||h.participantId===l});if(!p)return pe(u?{result:{error:Xa}}:{result:{error:Ar}});if(u){if(((i=p.person)==null?void 0:i.personId)!==u)return pe({result:{error:E0}});TS({element:p.person,onlineResource:s})}else TS({element:p,onlineResource:s})}else if(c){let p=(n=(a.venues??[]).filter(h=>!d||h.venueId===d).flatMap(h=>(h.courts??[]).filter(f=>f.courtId===c)))==null?void 0:n[0];if(!p)return pe({result:{error:AD}});TS({element:p,onlineResource:s})}else if(d){let p=(a.venues??[]).find(h=>h.venueId===d);if(!p)return pe({result:{error:C0}});TS({element:p,onlineResource:s})}else TS({element:a,onlineResource:s}),Ui({payload:{parentOrganisation:a.parentOrganisation,onlineResources:a.onlineResources,tournamentId:a.tournamentId},topic:Vb});return{...ue}}function TS({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(n=>n?.[aU]!==e[aU]&&n?.[sU]!==e[sU]&&n?.[oU]!==e[oU]);return i.push(e),t.onlineResources=i,{...ue}}function cEe({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:n}){if(!t)return{error:lt};let r=t.tournamentId,a={tournamentId:r};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),n&&n!==t.formalName&&(t.formalName=n,a.formalName=n),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&Ui({topic:Vb,payload:{parentOrganisation:t.parentOrganisation,tournamentId:r,...a}}),{...ue}}function dEe({tournamentRecord:t,notes:e}){if(!t)return{error:lt};let i=e?sB({element:t,notes:e}):o9({element:t});return i.error?i:(Ui({topic:Vb,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...ue})}function pEe({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,Ui({topic:Vb,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...ue}):{error:lt}}function QKe({tournamentRecord:t}){var e,i;if(!t)return{error:lt};let{startDate:n,endDate:r}=t,a=rU(n,r),s=[];for(let o of t.venues||[])(e=o?.courts)!=null&&e.length&&s.push(...o.courts);for(let o of s){let{startTime:l,endTime:u}=(o.dateAvailability??[]).reduce((p,h)=>{let f=an(p.startTime),m=an(p.endTime);return h.startTime&&an(h.startTime)<f&&(p.startTime=h.startTime),h.endTime&&an(h.endTime)>m&&(p.endTime=h.endTime),p},{startTime:"08:00",endTime:"18:00"}),c=a.map(p=>{var h;return((h=o.dateAvailability)==null?void 0:h.find(f=>f.date===p))??{date:p,startTime:l,endTime:u}}),d=(i=o.dateAvailability)==null?void 0:i.find(p=>!p.date);d&&c.unshift(d),o.dateAvailability=c}return{...ue}}function n2(t){var e,i;let{tournamentRecord:n,startDate:r,endDate:a,weekdays:s}=t,o=(e=t.activeDates)==null?void 0:e.filter(Boolean),l=Yt(t,[{tournamentRecord:!0},{[vs]:m=>Hp.test(m),[vu]:za,startDate:!1,endDate:!1},{[vs]:m=>m.filter(Boolean).every(g=>Hp.test(g)),[vu]:za,activeDates:!1},{[vs]:GTe,weekdays:!1}]);if(l.error)return l;if(a&&r&&new Date(a)<new Date(r))return{error:Ce};if(a&&r&&new Date(r)>new Date(a))return{error:Ce};if(o!=null&&o.length){let m=r||n.startDate,g=a||n.endDate,v=!m||o.every(b=>new Date(b)>=new Date(m)),y=!g||o.every(b=>new Date(b)<=new Date(g));if(!v||!y)return{error:za}}let u;(r&&n.startDate&&new Date(r)>new Date(n.startDate)||a&&n.endDate&&new Date(a)<new Date(n.endDate))&&(u=!0);let c=rU(n.startDate,n.endDate);r&&(n.startDate=r),a&&(n.endDate=a);let d=rU(n.startDate,n.endDate),p=c.filter(m=>!d.includes(m)),h=d.filter(m=>!c.includes(m));for(let m of n.events??[])r&&m.startDate&&new Date(m.startDate)<new Date(r)&&(m.startDate=r),a&&m.startDate&&new Date(m.startDate)>new Date(a)&&(m.startDate=r??a),a&&m.endDate&&new Date(m.endDate)>new Date(a)&&(m.endDate=a),r&&m.endDate&&new Date(m.endDate)<new Date(r)&&(m.endDate=a??r);r&&n.endDate&&new Date(r)>new Date(n.endDate)&&(n.endDate=r),a&&n.startDate&&new Date(a)<new Date(n.startDate)&&(n.startDate=a),o&&(n.activeDates=o),s&&(n.weekdays=s);let f=u&&((i=eZe({tournamentRecord:n}))==null?void 0:i.unscheduledMatchUpIds);return QKe({tournamentRecord:n}),Ui({payload:Gt({parentOrganisation:n.parentOrganisation,tournamentId:n.tournamentId,activeDates:o,startDate:r,weekdays:s,endDate:a}),topic:Vb}),{...ue,unscheduledMatchUpIds:f,datesAdded:h,datesRemoved:p}}function hEe({tournamentRecord:t,startDate:e}){return e?n2({tournamentRecord:t,startDate:e}):{error:za}}function fEe({tournamentRecord:t,endDate:e}){return e?n2({tournamentRecord:t,endDate:e}):{error:za}}function eZe({tournamentRecord:t}){let e=Qa({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),n=t.endDate&&new Date(t.endDate),r=[],a=[];for(let s of e){let{schedule:o,matchUpId:l}=s;if(o&&o.scheduledDate){let u=new Date(o.scheduledDate);(i&&u<i||n&&u>n)&&(a.push(l),r.includes(o.scheduledDate)||r.push(o.scheduledDate))}}return r.length&&!XB({scheduledDates:r,tournamentRecord:t}).clearedScheduleCount?{error:xve}:{unscheduledMatchUpIds:a}}var mEe={};$i(mEe,{addCourt:()=>t2,addCourts:()=>ZY,addVenue:()=>HM,deleteCourt:()=>UEe,deleteVenue:()=>sK,deleteVenues:()=>bEe,disableCourts:()=>IEe,disableVenues:()=>wEe,enableCourts:()=>SEe,enableVenues:()=>TEe,generate:()=>gEe,generateCourts:()=>UY,getCompetitionVenues:()=>fN,getCourts:()=>cY,getVenuesAndCourts:()=>tg,modifyCourt:()=>oK,modifyCourtAvailability:()=>rK,modifyVenue:()=>DEe,mutate:()=>vEe,publicFindVenue:()=>D8,query:()=>TTe});var gEe={};$i(gEe,{generateCourts:()=>UY});var vEe={};$i(vEe,{addCourt:()=>t2,addCourts:()=>ZY,addVenue:()=>HM,deleteCourt:()=>UEe,deleteVenue:()=>sK,deleteVenues:()=>bEe,disableCourts:()=>IEe,disableVenues:()=>wEe,enableCourts:()=>SEe,enableVenues:()=>TEe,modifyCourt:()=>oK,modifyCourtAvailability:()=>rK,modifyVenue:()=>DEe});function nK(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t?.venueMatchUps))return{error:lt};if(!(t!=null&&t.courtId))return{error:D0};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n,venueMatchUps:r,courtId:a}=t,{schedulingProfile:s}=ig({tournamentRecord:i});if(Array.isArray(r))return{matchUps:l({matchUps:r,courtId:a})};let{matchUps:o}=Qa({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n});return{matchUps:l({matchUps:o,courtId:a})};function l({matchUps:u,courtId:c}){let d=u.filter(p=>{var h,f,m;let g=(f=(h=p.schedule)==null?void 0:h.allocatedCourts)==null?void 0:f.map(({courtId:v})=>v);return((m=p.schedule)==null?void 0:m.courtId)===c||g?.includes(c)});return Mx({matchUps:d,schedulingProfile:s})}}function tZe({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:n}){if(!e)return{error:lt};if(!n)return{error:Nv};let{schedulingProfile:r}=ig({tournamentRecord:e}),{matchUps:a}=Qa({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:s({matchUps:a,venueId:n})};function s({matchUps:o,venueId:l}){let u=o.filter(c=>{var d,p,h;let f=(p=(d=c.schedule)==null?void 0:d.allocatedCourts)==null?void 0:p.map(({venueId:m})=>m);return((h=c.schedule)==null?void 0:h.venueId)===l||f?.includes(l)});return Mx({matchUps:u,schedulingProfile:r})}}function rK({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:n,courtId:r,force:a}){var s,o,l;if(!t)return{error:lt};if(!r)return{error:D0};let u=XUe({dateAvailability:e});if(u.error)return u;let{updatedDateAvailability:c,totalMergeCount:d}=iZe(e);e=c;let p=V0({tournamentRecord:t,courtId:r});if(p.error)return p;let{court:h,venue:f}=p,{matchUps:m}=nK({tournamentRecord:t,venueMatchUps:n,courtId:r});if(m!=null&&m.length){let g=(s=pn({tournamentRecord:t}))==null?void 0:s.appliedPolicies,v=a??((l=(o=g?.[_v])==null?void 0:o.allowDeletionWithScoresPresent)==null?void 0:l.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return h&&(h.dateAvailability=e,!i&&f&&Ui({payload:{venue:f,tournamentId:t.tournamentId},topic:jb,key:f.venueId})),{...ue,totalMergeCount:d}}function iZe(t){let e=0,i=t.reduce((r,a)=>{let{date:s,startTime:o,endTime:l,bookings:u}=a;return r[s]||(r[s]=[]),r[s].push({startTime:o,endTime:l,bookings:u}),r},{}),n=[];return Object.keys(i).forEach(r=>{i[r].sort(IKe);let{mergedAvailability:a,mergeCount:s}=nZe(i[r]);n.push(...a.map(o=>({date:r,...o}))),e+=s}),{updatedDateAvailability:n,totalMergeCount:e}}function nZe(t){let e,i,n,r=t.length,a=0,s=[];for(;t.length&&r;){let l=t.shift(),{startTime:u,endTime:c,bookings:d}=l;if(r-=1,!e)e=u,n=d,i=c;else if(wM(qr(i),qr(u),!1)>0){let p={startTime:e,endTime:i};n!=null&&n.length&&(p.bookings=n),s.push(p),e=u,n=d,i=c}else d&&(n?n.push(d):n=d),i=c,a+=1}let o={startTime:e,endTime:i};return n!=null&&n.length&&(o.bookings=n),s.push(o),{mergedAvailability:s,mergeCount:a}}function aK({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:Bye,info:e}}function yEe({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:n}){let r="removeCourtAssignment";if(!i)return{error:to};if(!e&&!n)return{error:Xd};let a;if(!e){if(!t)return{error:lt};({drawDefinition:e}=jo({tournamentRecord:t,drawId:n}))}if(e)({matchUp:a}=tr({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:lt};let s=Qa({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=T0e({matchUps:s,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(s=>[lv,cf].includes(s.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:s})=>![lv,cf].includes(s)),Xi({tournamentId:t?.tournamentId,context:r,drawDefinition:e,matchUp:a})),{...ue}):{error:Gs}}function sK(t){var e,i,n;if(typeof t?.venueId!="string")return{error:Nv};let{tournamentRecord:r,venueId:a,force:s}=t,o=t.tournamentRecords||r&&{[r.tournamentId]:r}||{};if(!Object.keys(o).length)return{error:lt};let l=Wd({tournamentRecords:o,contextFilters:{venueIds:[a]}}).matchUps??[],u=(e=pn({tournamentRecord:r}))==null?void 0:e.appliedPolicies,c=s??((n=(i=u?.[_v])==null?void 0:i.allowDeletionWithScoresPresent)==null?void 0:n.venues);if(!l.length||c)for(let d of Object.values(o)){for(let h of l){let f=yEe({matchUpId:h.matchUpId,drawId:h.drawId,tournamentRecord:d});if(f.error)return f}let p;d.venues=(d.venues??[]).filter(h=>h?.venueId!==a?!0:(p=!0,!1)),p&&Ui({payload:{venueId:a,tournamentId:d.tournamentId},topic:n8,key:a})}else return aK({matchUpsCount:l.length});return gN({tournamentRecords:o}),{...ue}}function bEe({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:lt};if(!Array.isArray(e))return{error:Ce};for(let n of t.venues||[]){let{venueId:r}=n;if(e.includes(r)){let{venueId:a}=n,s=sK({tournamentRecord:t,venueId:a,force:i});if(s.error)return s}}return{...ue}}function IEe(t){let{courtIds:e,dates:i}=t,n=uc(t),r=[{[Hs]:!0,[M$]:!0}],a=Yt(t,r);if(a.error)return a;for(let s of Object.values(n))rZe({tournamentRecord:s,courtIds:e,dates:i});return{...ue}}function rZe({tournamentRecord:t,courtIds:e,dates:i}){let n=Array.isArray(i)&&i.length?{dates:i}:!0,r=a=>dn({extension:{value:n,name:Od},creationTime:!1,element:a});for(let a of t.venues||[])for(let s of a.courts||[])if(e!=null&&e.includes(s.courtId)){let o=r(s);if(o.error)return o}return{...ue}}function wEe(t){let{tournamentRecords:e,tournamentId:i,venueIds:n}=t,r=[{[Hs]:!0,[N$]:!0}],a=Yt(t,r);if(a.error)return a;let s=Object.keys(e).filter(o=>!i||o===i);for(let o of s){let l=e[o];aZe({tournamentRecord:l,venueIds:n})}return{...ue}}function aZe({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let n=dn({creationTime:!1,element:i,extension:{name:Od,value:!0}});if(n.error)return n}return{...ue}}function SEe(t){let e=uc(t),i=[{[Hs]:!0}];!t.enableAll&&i.push({[M$]:!0});let n=Yt(t,i);if(n.error)return n;let{enableAll:r,courtIds:a,dates:s}=t;for(let o of Object.values(e))sZe({tournamentRecord:o,courtIds:a,enableAll:r,dates:s});return{...ue}}function sZe({tournamentRecord:t,courtIds:e,enableAll:i,dates:n}){for(let r of t.venues||[])for(let a of r.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(n)){let{extension:s}=ki({element:a,name:Od});if(s){let o=s.value;Array.isArray(o.dates)&&(o.dates=o.dates.filter(l=>!n.includes(l))),dn({extension:{name:Od,value:o},creationTime:!1,element:a})}}else po({element:a,name:Od});return{...ue}}function TEe(t){let e=uc(t),i=[{[Hs]:!0}];!t.enableAll&&i.push({[N$]:!0});let n=Yt(t,i);if(n.error)return n;let{venueIds:r,enableAll:a}=t;for(let s of Object.values(e))for(let o of s.venues||[])(a||r!=null&&r.includes(o.venueId))&&po({element:o,name:Od});return{...ue}}function UEe(t){let{courtId:e,disableNotice:i,force:n}=t,r=uc(t),a=Yt(t,[{[Hs]:!0,[tIe]:!0}]);if(a.error)return a;let s,o;for(let l of Object.values(r)){if(o=oZe({tournamentRecord:l,disableNotice:i,courtId:e,force:n}),o.error&&o.error!==AD)return o;o.success&&(s=!0)}return s?{...ue}:o}function oZe({tournamentRecord:t,disableNotice:e,courtId:i,force:n}){var r,a,s;let o=V0({tournamentRecord:t,courtId:i});if(o.error)return o;let l=o.venue,{matchUps:u}=nK({tournamentRecord:t,courtId:i}),c=(r=pn({tournamentRecord:t}))==null?void 0:r.appliedPolicies,d=n??((s=(a=c?.[_v])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:s.courts);if(!(u!=null&&u.length)||d){for(let p of u??[]){let h=yEe({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(h.error)return h}l&&(l.courts=(l.courts??[]).filter(p=>p.courtId!==i),e||Ui({payload:{venue:l,tournamentId:t.tournamentId},topic:jb,key:l.venueId}))}else return aK({matchUpsCount:u.length});return{...ue}}function oK(t){let{disableNotice:e,modifications:i,courtId:n,force:r,venueMatchUps:a}=t,s=uc(t);if(!Object.keys(s).length)return{error:gr};let o,l;for(let u of Object.values(s)){let c=lZe({tournamentRecord:u,disableNotice:e,venueMatchUps:a,modifications:i,courtId:n,force:r});if(c!=null&&c.error)return c;o=!0}return o?{...ue}:l}function lZe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:n,courtId:r,force:a}){if(!t)return{error:lt};if(!r)return{error:D0};if(!n||typeof n!="object")return{error:Zm};let s=V0({tournamentRecord:t,courtId:r});if(s.error)return s;let{venue:o,court:l}=s,u=Object.keys(bKe()).filter(p=>p!=="courtId");if(!Object.keys(n).filter(p=>u.includes(p)).length)return{error:p$};let c=u.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(n).filter(p=>c.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:n[p]})),n.dateAvailability){let p=rK({dateAvailability:n.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:r,force:a});if(p.error)return p}return e||Ui({payload:{venue:o,tournamentId:t.tournamentId},topic:jb,key:o?.venueId}),{...ue,court:At(l)}}var uZe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),cZe=uZe;function DEe(t){let{modifications:e,venueId:i,force:n}=t,r=uc(t);if(!Object.keys(r).length)return{error:gr};if(typeof i!="string")return{error:Nv};let a,s;for(let o of Object.values(r)){let l=dZe({tournamentRecord:o,modifications:e,venueId:i,force:n});if(l.success&&(s=!0),l.error&&(a=l.error),l.error&&l.error!==C0)return l}return gN({tournamentRecords:r}),s?{...ue}:{error:a}}function dZe({tournamentRecord:t,modifications:e,venueId:i,force:n}){var r,a,s,o,l,u,c,d;if(!t)return{error:lt};if(!e||typeof e!="object")return{error:Zm};if(!i)return{error:Nv};let p=(r=pn({tournamentRecord:t}))==null?void 0:r.appliedPolicies,h=n??((s=(a=p?.[_v])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:s.venues),{matchUps:f}=tZe({tournamentRecord:t,venueId:i}),m=bf({tournamentRecord:t,venueId:i});if(m.error)return m;let g=m.venue,v=Object.keys(cZe()).filter(U=>U!=="venueId");if(!Object.keys(e).filter(U=>v.includes(U)).length)return{error:p$};let y=v.filter(U=>!["courts","onlineResources"].includes(U)),b=Object.keys(e).filter(U=>y.includes(U));g&&b.forEach(U=>Object.assign(g,{[U]:e[U]}));let I=((o=g?.courts)==null?void 0:o.map(U=>U.courtId))??[],S=((l=e.courts)==null?void 0:l.map(U=>U.courtId))||[],w=S.length?I.filter(U=>!S.includes(U)):e?.courts&&I,T=[];if(w!=null&&w.length){let U=(c=(u=g?.courts)==null?void 0:u.filter(C=>w.includes(C.courtId)))==null?void 0:c.map(C=>{var E;let P=nK({courtId:C.courtId,tournamentRecord:t,venueMatchUps:f});for(let M of P.matchUps??[])T.push({matchUpId:M.matchUpId,drawId:M.drawId});return((E=P.matchUps)==null?void 0:E.length)??0}).reduce((C,E)=>C+E);if(g&&(!U||h))g.courts=(d=g.courts)==null?void 0:d.filter(C=>S.includes(C.courtId)),c1({schedule:{courtId:"",scheduledDate:""},matchUpDetails:T,removePriorValues:!0,tournamentRecord:t});else return aK({matchUpsCount:U})}if(e.courts)for(let U of e.courts){let{courtId:C}=U||{},E=oK({modifications:U,disableNotice:!0,tournamentRecord:t,venueMatchUps:f,courtId:C,force:n});if(E.error===AD&&(E=t2({disableNotice:!0,tournamentRecord:t,venueId:i,court:U})),E.error)return E}return gN({tournamentRecord:t}),g&&Ui({payload:{venue:g,tournamentId:t.tournamentId},topic:jb,key:g?.venueId}),{...ue,venue:At(g)}}var lK={};$i(lK,{JSON2CSV:()=>yZe,UUID:()=>gn,UUIDS:()=>sbe,allNumeric:()=>Cve,attributeFilter:()=>Dw,chunkArray:()=>ka,chunkByNth:()=>pH,chunkSizeProfile:()=>Pve,constantToString:()=>Ss,countValues:()=>Cqe,createMap:()=>Mve,dateTime:()=>abe,definedAttributes:()=>Gt,dehydrateMatchUps:()=>fZe,extractAttributes:()=>uwe,flattenJSON:()=>uK,generateDateRange:()=>rU,generateHashCode:()=>Oqe,generateRange:()=>Et,generateTimeCode:()=>rDe,groupValues:()=>Dve,hasAttributeValues:()=>xqe,instanceCount:()=>Ol,intersection:()=>Pr,isConvertableInteger:()=>bi,isNumeric:()=>Ir,isOdd:()=>Tve,isPowerOf2:()=>Gd,makeDeepCopy:()=>At,matchUpScheduleSort:()=>hZe,matchUpSort:()=>j0,nearestPowerOf2:()=>W6,nextPowerOf2:()=>ED,noNulls:()=>Pqe,noNumeric:()=>Rve,numericSort:()=>ra,occurrences:()=>Mqe,overlap:()=>yo,randomMember:()=>xc,randomPop:()=>wl,shuffleArray:()=>co,structureSort:()=>k0,subSort:()=>Nqe,undefinedToNull:()=>hH,unique:()=>Si,visualizeScheduledMatchUps:()=>pZe});function pZe({scheduledMatchUps:t,showGlobalLog:e}){n5e();let i=t?.reduce((r,{structureId:a})=>r.includes(a)?r:r.concat(a),[]),n=Array.isArray(i)&&{...i.map(r=>{let{structureName:a,matchUpType:s}=t.find(o=>o.structureId===r);return{[r]:`${a} ${s}`}})};i?.forEach(r=>{var a;ou({color:"blue",method:"draw",structure:n[r],keyColors:{structure:"magenta"}},!0);let s=t.filter(l=>l.structureId===r),o=((a=bo({matchUps:s}))==null?void 0:a.roundMatchUps)||[];Object.keys(o).forEach(l=>{ou({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),o[l].forEach(({matchUpId:u,schedule:c})=>{let d=er(c.scheduledTime);ou({matchUpId:u,time:d,date:c.scheduledDate,venue:c.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&i5e()}var{extractTime:hee,timeStringMinutes:fee}=abe;function hZe(t,e){let i=t.schedule??{},n=e.schedule??{};if(i.scheduledDate&&!n.scheduledDate)return 1;if(n.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&n.scheduledDate){if(i.scheduledDate===n.scheduledDate){if(i.scheduledTime&&!n.scheduledTime)return 1;if(n.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&n.scheduledTime){let r=fee(hee(i.scheduledTime)),a=fee(hee(n.scheduledTime));return r-a}}return new Date(i.scheduledDate).getTime()-new Date(n.scheduledDate).getTime()}return 0}function fZe({tournamentRecord:t}){if(!t)return{error:lt};if(typeof t!="object"||!t.tournamentId)return{error:Ce};let{matchUps:e}=Qa({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=mZe({tournamentRecord:t});vZe(e,i)}return{...ue}}function mZe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let n of i.drawDefinitions||[]){n.matchUpFormat&&(e[n.drawId]=n.matchUpFormat);for(let r of n.structures||[]){r.matchUpFormat&&(e[r.structureId]=r.matchUpFormat);for(let a of r.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var gZe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function vZe(t,e={}){for(let i of t){let{structureId:n,drawId:r,eventId:a}=i,s=e[n]||e[r]||e[a],o=i.matchUpFormat===s?void 0:i.matchUpFormat;for(let l of Object.keys(i))gZe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}function yZe(t,e){if(e&&typeof e!="object")return{error:Ce};let{columnTransform:i={}}=e||{},{includeTransformAccessors:n,includeHeaderRow:r=!0,returnTransformedJSON:a,removeEmptyColumns:s,onlyHeaderRow:o,columnAccessors:l=[],functionMap:u={},columnMap:c={},valuesMap:d={},context:p={},delimiter:h='"',columnJoiner:f=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof c!="object"||typeof i!="object"||typeof u!="object"||typeof d!="object"||typeof f!="string"||typeof m!="string"||typeof g!="string"||typeof h!="string")return{error:Ce};i=Object.assign({},...Object.keys(i).reverse().map(N=>({[N]:Array.isArray(i[N])?i[N]:[typeof i[N]=="string"&&i[N]].filter(Boolean)})));let v=t.filter(Boolean).map(N=>uK(N,g)),y=Object.values(i).flat();n&&l.push(...y);let b=v.reduce((N,A)=>Object.keys(A).every(_=>!N.includes(_)&&N.push(_)||!0)&&N,[]).filter(N=>!(l!=null&&l.length)||l.includes(N)),I=Object.assign({},...Object.keys(i).reverse().map(N=>i[N].map(A=>({[A]:N})).flat()).flat()),S=(N,A)=>e!=null&&e.sortOrder?e.sortOrder.includes(N)&&e.sortOrder.includes(A)&&e.sortOrder.indexOf(N)-e.sortOrder.indexOf(A)||!e.sortOrder.includes(A)&&-1:0,w=b.reduce((N,A)=>{let _=I[A];return _?N.includes(_)||N.push(_):N.push(A),N},[]).sort(S);Object.keys(c).forEach(N=>!w.includes(N)&&w.unshift(N)),Object.keys(i).forEach(N=>!w.includes(N)&&w.unshift(N)),typeof p=="object"&&Object.keys(p).forEach(N=>!w.includes(N)&&w.unshift(N));let T=w.map(N=>c[N]||N);if(o)return[T];let U=N=>`${h}${N}${h}`,C=[],E=N=>Object.values(w.reduce((A,_,x)=>{var O;let $=i[_],F=($!=null&&$.length?N[$.find(G=>N[G])]:N[_])||p?.[_]||"",j=((O=d[_])==null?void 0:O[F])||F,H=bl(u[_])?u[_](j):j;return A[_]=U(H),H&&(C[x]=(C[x]||0)+1),A},{})),P=v.map(E),M=s&&[...C].map((N,A)=>!N&&A).filter(Ir).reverse();if(M){let N=A=>A.filter((_,x)=>!M.includes(x));P=P.map(N),T=N(T)}let R=P.map(N=>N.join(f));return a?R.map(N=>{let A=N.split(f);return Object.assign({},...A.map((_,x)=>({[T[x]]:_})))}):r?[T.map(U).join(f),...R].join(m):R.join(m)}function uK(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((n,r)=>typeof t[r]!="object"?(n[i.concat(r).join(e)]=t[r],n):Object.assign(n,uK(t[r],e,i.concat(r))),{})}var{FACTORY:mee}=cIe;function bZe({tournamentRecord:t,value:e}){let{extension:i}=ki({element:t,name:mee}),n={name:mee,value:{...i?.value,...e}};dn({element:t,extension:n})}function EEe({timeStamp:t}){let e=M0(),i=w7();return i&&Object.values(e).forEach(n=>{bZe({tournamentRecord:n,value:{version:e$(),timeStamp:t}})}),i}function PEe({engineType:t,methodName:e,elapsed:i,params:n,result:r}){var a,s;let o=mu();if(typeof o!="object")return;let l={method:e},u=r?.error&&(o.errors===!0||Array.isArray(o.errors)&&o.errors.includes(e)),c=Array.isArray(o.params)&&((a=o.params)==null?void 0:a.includes(e)),d=o.params&&!Array.isArray(o.params)||c,p=Array.isArray(o.exclude)&&o.exclude.includes(e);!p&&![void 0,!1].includes(o.perf)&&!isNaN(o.perf)&&i>=o.perf&&(l.elapsed=i),!p&&(u||d)&&(l.params=n),!p&&(u||o.result&&!Array.isArray(o.result)&&(!Array.isArray(o.params)||c)||Array.isArray(o.result)&&(s=o.result)!=null&&s.includes(e))&&(l.result=r),Object.keys(l).length>1&&Xye(l,t)}function cK({methodName:t,params:e,start:i}){let n={error:f$,methodName:t},r=i?Date.now()-i:0;return PEe({result:n,methodName:t,elapsed:r,params:e,engineType:"sync"}),n}function IZe(t,e){var i;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:lt};let n=e.drawId||((i=e.matchUp)==null?void 0:i.drawId);if(n){let{event:s,drawDefinition:o,tournamentId:l}=jo({tournamentRecords:t,drawId:n});o&&(e.drawDefinition=o),l&&(e.tournamentId=l),s&&(e.event=s)}if(e.eventId&&!e.event){let{event:s,tournamentId:o}=jo({eventId:e.eventId,tournamentRecords:t});if(!s)return{error:Xu};e.tournamentId=o,e.event=s}let r=e.tournamentId??R0();if(!r&&e)return e;let a=t[r];return r&&!a?{error:lt}:(a&&(e.tournamentRecord=a),e)}function dK(t,e,i,n,r){delete t.success,delete t.error;let a=Date.now(),s=R0();i&&(i.activeTournamentId=s);let o=i?.tournamentRecord||T7(s),l=typeof i?.tournamentRecord=="object"&&{[i?.tournamentRecord.tournamentId]:i.tournamentRecord}||M0(),u=i?At(i,void 0,!0):void 0,c=i?IZe(l,i):void 0;if(c!=null&&c.error)return c;let d=wZe({params:c,tournamentRecords:l,tournamentRecord:o,methodName:n,method:e}),p=Date.now()-a;return PEe({result:d,methodName:n,elapsed:p,params:u,engineType:r}),d}function wZe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:n,method:r}){if(mu())return r({tournamentRecords:t,tournamentRecord:e,...i});try{return r({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return y$({engineName:"engine",methodName:n,params:i,err:a})}}function r2(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:a}=lc();for(let s of[...a].sort(SZe)){let o=Yye({topic:s});o!=null&&o.length&&UH({topic:s,notices:o})}e&&r&&a.includes(NH)&&UH({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:NH})}var gee={[d8]:5,[c8]:5,[p8]:5,[u8]:5,[l8]:5,[s8]:5,[PIe]:5,[CIe]:5,[o8]:1,[F$]:1,[Es]:5,[jb]:5,[a8]:4,[i8]:4,[n8]:4,[r8]:4,[L$]:3,[Q7]:2};function SZe(t,e){return(gee[e]||0)-(gee[t]||0)}function TZe({convertExtensions:t,removeExtensions:e}){let i=M0();return{tournamentId:R0(),tournamentRecords:At(i,t,!1,e)}}function UZe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},n=t?.tournamentId??R0();if(typeof n!="string")return{};let r=T7(n);return{tournamentRecord:At(r,e,!1,i)}}function DZe(){var t;let e=M0(),{extension:i}=ki({name:ub,tournamentRecords:e,discover:!0}),n=((t=i?.value)==null?void 0:t.tournamentIds)||[];return Object.keys(e).forEach(r=>{n.includes(r)||delete e[r]}),v$(e)}function vee(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Zm}:t!=null&&t.tournamentId?Kye(e?At(t):t):{error:Ce}}function d1(t,e=!0){if(typeof t!="object")return{error:Zm};if(VC(),Array.isArray(t)){if(t.filter(i=>i?.tournamentId).length!==t.length)return{error:gH};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},VC(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:gH};return v$(e?At(t):t)}function EZe(t,e,i,n,r,a){let s=Jye(i,n,r,a);if(s.error)return s;let o=s.methods??[];return Object.keys(o).filter(l=>bl(o[l])).forEach(l=>{t[l]=u=>{let c=()=>e(t,{[l]:o[l],...u});if(mu())return c();try{return c()}catch(d){y$({engineName:"engine",methodName:l,params:u,err:d})}}}),{...ue,...t}}function US(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function CEe(t,e){t.importMethods=(i,n,r,a)=>EZe(t,e,i,n,r,a),t.getTournament=i=>UZe(i),t.getState=i=>TZe({convertExtensions:i?.convertExtensions,removeExtensions:i?.removeExtensions}),t.version=()=>e$(),t.reset=()=>(v$({}),US(t)),t.devContext=i=>($C(i),US(t)),t.getDevContext=i=>mu(i),t.newTournamentRecord=(i={})=>{let n=QB(i),r=n.tournamentId;return n.error?n:(vee(n),VC(r),{...ue,tournamentId:r})},t.setState=(i,n,r)=>{BC(n,r);let a=d1(i,n);return US(t,a)},t.setTournamentId=i=>VC(i),t.getTournamentId=()=>R0(),t.setTournamentRecord=(i,n,r)=>{BC(n,r);let a=vee(i,n);return US(t,a)},t.removeTournamentRecord=i=>{let n=Zye(i);return US(t,n)},t.removeUnlinkedTournamentRecords=()=>{let i=DZe();return US(t,i)}}function PZe(t,e,i){if(!Array.isArray(e))return{error:Ce,message:"directives must be an array"};let n=Wye(),r=Date.now(),a=i&&At(M0(),!1,!0),s=[];for(let u of e){if(typeof u!="object")return{error:Ce,message:"directive must be an object"};if(u.params&&typeof u.params!="object")return{error:Ce,message:"params must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!n[c])return cK({methodName:c,start:r,params:p});if(d){let f=s[s.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=dK(t,n[c],p,c,"sync");if(h!=null&&h.error)return a&&d1(a),{...h,rolledBack:!!a};s.push({...h,methodName:c})}let o=Date.now(),l=EEe({timeStamp:o});return r2({directives:e,mutationStatus:l,timeStamp:o}),bM(),{success:s.every(u=>u.success),results:s}}function yee(t,e){if(!Qi(e))return{error:Ce,message:"args must be an object"};let i=Object.values(e).filter(bl).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Ce};let n=i?Object.keys(e).find(h=>bl(e[h])):nr(e.method)&&e.method;if(!n)return{error:f$};let{[n]:r,...a}=e,s=e!=null&&e.params?{...e.params}:{...a},o=s.rollbackOnError&&At(M0(),!1,!0),l=r||t[n]||b7()[n];if(!l)return cK({methodName:n,params:s});let u=dK(t,l,s,n,"sync")??{};u!=null&&u.error&&o&&d1(o);let c=Date.now(),d=EEe({timeStamp:c}),p=u?.success&&s?.delayNotify!==!0&&s?.doNotNotify!==!0;return p&&r2({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:c}),(p||!(u!=null&&u.success)||s!=null&&s.doNotNotify)&&bM(),u}var CZe=(()=>{let t={executionQueue:(e,i)=>PZe(t,e,i),execute:e=>yee(t,e)};return CEe(t,yee),t})(),pK=CZe;function bee(t,e){if(!Qi(e))return{error:Ce,message:"args must be an object"};let i=Object.values(e).filter(bl).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Ce};let n=i?Object.keys(e).find(l=>bl(e[l])):nr(e.method)&&e.method;if(!n)return{error:f$};let{[n]:r,...a}=e,s=e!=null&&e.params?{...e.params}:{...a},o=r||t[n]||b7()[n];return o?dK(t,o,s,n,"ask"):cK({methodName:n,params:s})}(()=>{let t={execute:e=>bee(t,e)};return CEe(t,bee),t})();var QI={},Ng;function Iee(t,e=!0){if(!t)return{error:Xt};if(typeof t!="object")return{error:Zm};if(t.matchUpId)Ng=t.matchUpId,QI[Ng]=e?At(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(QI[i.matchUpId]=e?At(i):i,Ng||(Ng=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(QI[i.matchUpId]=e?At(i):i,Ng||(Ng=i.matchUpId));return e?At(t):t}function RZe(){return QI[Ng]}function MZe(){return Object.values(QI)}function NZe(){Ng=void 0,QI={}}function AZe(t){return At(QI[Ng],t?.convertExtensions,!1,t?.removeExtensions)}(()=>{let t={getState:r=>AZe(r),version:()=>e$(),reset:()=>(NZe(),{...ue}),drawId:void 0,error:void 0,success:!1,devContext:r=>($C(r),t),setState:(r,a,s)=>{BC(a,s);let o=Iee(r);return e(o)}};function e(r){return r!=null&&r.error?(t.error=r.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=r.drawId),t}return i([D9]),t;function i(r){r.forEach(a=>{Object.keys(a).forEach(s=>{t[s]=o=>{if(mu())return n({params:o,governor:a,methodName:s});try{return n({params:o,governor:a,methodName:s})}catch(l){y$({engineName:"matchUpEngine",methodName:s,params:o,err:l})}}})})}function n({params:r,governor:a,methodName:s}){t.error=void 0,t.success=!1;let o=r?.matchUp||RZe(),l=r?.matchUps||MZe(),u=r?.rollbackOnError&&At(o,!1,!0);r={...r,matchUpId:o?.matchUpId,matchUps:l,matchUp:o};let c=a[s](r);if(c!=null&&c.error)return u&&Iee(u),{...c,rolledBack:!!u};let d=c?.success&&r?.delayNotify!==!0&&r?.doNotNotify!==!0;return d&&r2(),(d||!(c!=null&&c.success)||r!=null&&r.doNotNotify)&&bM(),c}})();var GV=!1;(()=>{let t={version:()=>e$(),setDeepCopy:(n,r)=>(BC(n,r),t),devContext:n=>($C(n),GV=!0,t)};return i([BY]),t;function e(n,r){let a=n({...r});return a!=null&&a.error||r2(),bM(),GV&&($C(!1),GV=!1),a}function i(n){n.forEach(r=>{Object.keys(r).forEach(a=>{t[a]=s=>{if(mu()){let o=e(r[a],s);return!(o!=null&&o.error)&&s!=null&&s.setState&&o!=null&&o.tournamentRecord&&d1(o.tournamentRecord),o}else try{let o=e(r[a],s);return!(o!=null&&o.error)&&s!=null&&s.setState&&o!=null&&o.tournamentRecord&&d1(o.tournamentRecord),o}catch(o){let l;typeof o=="string"?l=o.toUpperCase():o instanceof Error&&(l=o.message),console.log("ERROR",{params:JSON.stringify(s),method:a,error:l})}}})})}})();pK.importMethods(bve,!0,1);var REe=pK,_Ze={getTournamentPoints:DB},kZe=_Ze,xZe={calculateNewRatings:iSe,generateDynamicRatings:nSe},OZe=xZe,LZe={...kZe,...OZe};pK.importMethods(LZe);var FZe={[ZC]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},$Ze={[Cm]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[KI,NP]}},BZe={[Cm]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[KI,n1,Mw],disabledActions:[]}]}},VZe={[Cm]:{policyName:"positionActionsDisabled",enabledStructures:!1}},jZe={[FD]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},GZe={[Qu]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:Kc,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[_t]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[ul]:[],[oh]:[],[Wi]:[],[$l]:[],[os]:[],[ln]:[]}}},HV="Personal circumstance",HZe={[Qu]:{requireAllPositionsAssigned:!1,stage:{[_t]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Kc,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Kc,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[ul]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[oh]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[$l]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[Wi]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[ln]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:HV,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[os]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:HV,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[uf]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:HV,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},zZe={[Rc]:{seedingProfile:{positioning:S$},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},qZe={POLICY_AVOIDANCE_COUNTRY:FZe,POLICY_POSITION_ACTIONS_DEFAULT:F0e,POLICY_POSITION_ACTIONS_DISABLED:VZe,POLICY_POSITION_ACTIONS_NO_MOVEMENT:BZe,POLICY_POSITION_ACTIONS_UNRESTRICTED:$Ze,POLICY_PRIVACY_DEFAULT:jZe,POLICY_ROUND_NAMING_DEFAULT:w8,POLICY_SCHEDULING_DEFAULT:wTe,POLICY_SCORING_DEFAULT:GZe,POLICY_SCORING_USTA:HZe,POLICY_SEEDING_ITF:zZe,POLICY_SEEDING_DEFAULT:nTe},WZe={ratingsParameters:Ra,matchUpFormats:Q3e,countryToFlag:xIe,tieFormats:OTe,countries:jg,policies:qZe,flagIOC:JWe},YZe={};$i(YZe,{activeMatchUpStatuses:()=>J7,auditConstants:()=>K9e,completedMatchUpStatuses:()=>wa,directingMatchUpStatuses:()=>IIe,displayConstants:()=>D9e,drawDefinitionConstants:()=>Zbe,entryStatusConstants:()=>o4e,errorConditionConstants:()=>Qqe,eventConstants:()=>aWe,extensionConstants:()=>cIe,flightConstants:()=>hYe,genderConstants:()=>U7,keyValueConstants:()=>X7e,matchUpActionConstants:()=>u7e,matchUpStatusConstants:()=>TIe,matchUpTypes:()=>Tqe,nonDirectingMatchUpStatuses:()=>wIe,particicipantsRequiredMatchUpStatuses:()=>yIe,participantConstants:()=>XWe,participantRoles:()=>k8,participantTypes:()=>PP,penaltyConstants:()=>pXe,policyConstants:()=>kWe,positionActionConstants:()=>S6e,ratingConstants:()=>L6e,recoveryTimeRequiredMatchUpStatuses:()=>qWe,requestConstants:()=>tKe,resourceContants:()=>q3e,resultConstants:()=>Lqe,scaleConstants:()=>MWe,scheduleConstants:()=>_4e,sortingConstants:()=>wYe,surfaceConstants:()=>yXe,tieFormatConstants:()=>eWe,timeItemConstants:()=>M4e,topicConstants:()=>YWe,tournamentConstants:()=>sEe,upcomingMatchUpStatuses:()=>SIe,validMatchUpStatuses:()=>bIe,venueConstants:()=>wXe,weekdayConstants:()=>jTe});var KZe="Coaching",ZZe="Ball Abuse",XZe="Racket Abuse",JZe="Verbal Abuse",QZe="INELIGIBILITY",eXe="Physical Abuse",tXe="Unsportmanlike Conduct",iXe="Dress Code Violation",nXe="Equipment Violation",rXe="Leaving the court",aXe="Failure to complete",sXe="No Show",oXe="Other",lXe="REFUSAL_TO_PLAY",uXe="PROHIBITED_SUBSTANCE",cXe="Puncuality",dXe="Failure to sign in",pXe={COACHING:KZe,BALL_ABUSE:ZZe,RACKET_ABUSE:XZe,VERBAL_ABUSE:JZe,PHYSICAL_ABUSE:eXe,INELIGIBILITY:QZe,UNSPORTSMANLIKE_CONDUCT:tXe,PROHIBITED_SUBSTANCE:uXe,DRESS_CODE_VIOLATION:iXe,EQUIMENT_VIOLATION:nXe,LEAVING_THE_COURT:rXe,REFUSAL_TO_PLAY:lXe,FAILURE_TO_COMPLETE:aXe,NO_SHOW:sXe,OTHER:oXe,PUNCTUALITY:cXe,FAILUIRE_TO_SIGN_IN:dXe},hXe="CLAY",fXe="HARD",mXe="GRASS",gXe="CARPET",vXe="ARTIFICIAL",yXe={CLAY:hXe,HARD:fXe,GRASS:mXe,CARPET:gXe,ARTIFICIAL:vXe},bXe="INDOOR",IXe="OUTDOOR",wXe={INDOOR:bXe,OUTDOOR:IXe};const SXe=yn({WebkitBoxSizing:"border-box",marginInlineEnd:".3em",display:"inline-block",boxSizing:"border-box",position:"relative",borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function TXe({matchUp:t,individualParticipant:e,spacer:i}){var n,r,a;const s=((n=e?.person)==null?void 0:n.iso2NationalityCode)||"",o=s?(r=WZe.countryToFlag(s))==null?void 0:r.slice(0,4):"",l=document.createElement("span"),u=(a=t?.matchUpType)==null?void 0:a.toLowerCase();return i||(l.className=SXe({variant:u})),l.innerHTML=i?"":o,l}function zV({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r,side:a,type:s}){if(s==="scale")return wqe({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r});const o=e?.configuration||{},l=document.createElement("div");return s==="flag"&&o.flags&&TXe({matchUp:n,individualParticipant:t,spacer:r})||s==="seeding"&&bqe({className:i,composition:e,side:a})||l}const UXe="Qualifier",DXe="BYE",EXe="TBD";function wee(t){var e,i,n,r;const{isWinningSide:a,side:s,sideNumber:o,individualParticipant:l,matchUp:u,composition:c}=t||{},d=a?"winner":void 0,p=t.eventHandlers||{},h=c?.configuration,f={QUALIFIER:((e=h?.placeHolders)==null?void 0:e.qualifier)||UXe,BYE:((i=h?.placeHolders)==null?void 0:i.bye)||DXe,TBD:((n=h?.placeHolders)==null?void 0:n.tbd)||EXe},m=l?.participantName,g=T=>{Md(p?.participantClick)&&(T.stopPropagation(),p.participantClick({individualParticipant:l,pointerEvent:T,matchUp:u,side:s}))},v=document.createElement("div");v.classList.add("tmx-i"),v.setAttribute("sideNumber",o),v.setAttribute("id",l?.participantId),v.onclick=g;const y=document.createElement("div");y.className=Qze({variant:d});const b=h?.flags&&zV({...t,type:"flag"});if(b)y.appendChild(b);else{const T=zV({type:"scale",...t});T&&y.appendChild(T)}const I=document.createElement("div");if(I.className=eqe({variant:d}),m){const T=document.createElement("span");if(a&&h!=null&&h.winnerColor)T.style.color=typeof h.winnerColor=="string"?h.winnerColor:"green";else if(h!=null&&h.genderColor){const U=(r=l?.person)==null?void 0:r.sex,C=U==="MALE"&&"#2E86C1"||U==="FEMALE"&&"#AA336A"||"";T.style.color=typeof h.genderColor=="string"?h.genderColor:C}T.innerHTML=m,I.appendChild(T)}else{const T=document.createElement("abbr");T.className=Jze({variant:h.showAddress?"showAddress":""}),T.innerHTML=s?.bye&&f.BYE||s?.qualifier&&f.QUALIFIER||f.TBD,I.appendChild(T)}const S=zV({...t,className:yqe(),type:"seeding"});S&&I.appendChild(S),y.appendChild(I),v.appendChild(y);const w=vqe(t);return v.appendChild(w),{element:v}}const PXe=yn({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{defaulted:{backgroundColor:"#df164c"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"}}}});function CXe({matchUpStatus:t}){const e=t?.toLowerCase(),i=["WALKOVER","DOUBLE_WALKOVER"].includes(t)?"WO":t?.slice(0,3)||"",n=document.createElement("div");n.className=PXe({variant:e});const r=document.createElement("abbr");return r.setAttribute("title",t),r.style.textDecoration="none",r.style.borderBottom="none",r.innerHTML=i,n.appendChild(r),n}function RXe(t){return t instanceof Element||t}const MXe=yn({marginInlineEnd:".5rem",backgroundColor:"pink",marginInlineStart:2,height:40,width:40});function NXe({teamLogo:t}){console.log({teamLogo:t});const e=document.createElement("div");return e.className=MXe(),e}const AXe=yn({flexDirection:"column",position:"relative",display:"flex"}),_Xe=yn({alignItems:"stretch",display:"flex"}),kXe=yn({marginInlineEnd:".25rem",color:"green"});function xXe({dim:t="20px"}={}){const e=kXe();return`
    <div style="line-height: 0;">
      <svg height="${t}" viewBox="0 0 18 24" width="${t}" xmlns="http://www.w3.org/2000/svg" class="${e}" style="fill: currentcolor;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
      </svg>
    </div>
  `}function hK({initialRoundNumber:t=1,eventHandlers:e,sideContainer:i,composition:n,participant:r,placeholder:a,sideNumber:s,matchUp:o}){var l,u,c;const{winningSide:d,matchUpType:p,isRoundRobin:h,matchUpStatus:f}=o||{},m=n?.configuration;let g;const v=s?(l=o?.sides)==null?void 0:l.find(N=>N.sideNumber===s):void 0;r||(r=v?.participant,g=m!=null&&m.allDrawPositions||m!=null&&m.drawPositions&&v!=null&&v.drawPosition&&(o?.roundNumber===t||v!=null&&v.participantFed||h)?v?.drawPosition:"");const y=p==="DOUBLES",b=y?(u=r?.individualParticipants)==null?void 0:u[0]:r,I=y&&((c=r?.individualParticipants)==null?void 0:c[1]),S=s===d||f==="BYE"&&r,w=m?.winnerChevron&&S,T=m?.teamLogo,U=["RETIRED","DOUBLE_WALKOVER","WALKOVER","DEFAULTED"].includes(f)&&!S,C=m?.gameScoreOnly,E=document.createElement("div");if(E.className=i&&iqe({drawPosition:g,sideNumber:s}),E.classList.add("tmx-p"),E.setAttribute("id",r?.participantId),T){const N=NXe({teamLogo:T});E.appendChild(N)}const P=document.createElement("div");P.className=tqe({variant:y?"doubles":"singles"});const M=document.createElement("div");M.className=nqe({winnerChevron:w,isDoubles:y});const R=wee({individualParticipant:b,eventHandlers:e,isWinningSide:S,composition:n,sideNumber:s,matchUp:o,side:v}).element;if(M.appendChild(R),I){const N=wee({individualParticipant:I,eventHandlers:e,isWinningSide:S,composition:n,sideNumber:s,matchUp:o,side:v}).element;M.appendChild(N)}else y&&a&&RXe(a)&&M.appendChild(a);if(P.appendChild(M),E.appendChild(P),i){const N=document.createElement("div");if(S&&!C){const A=xXe();typeof A=="string"?N.innerHTML=A:N.appendChild(A)}else if(U){const A=CXe({matchUpStatus:f});N.appendChild(A)}E.appendChild(N)}return E}const OXe=yn({borderBottom:"solid 1px black",marginInlineStart:"16px",marginInlineEnd:"16px",fontWeight:"bold",height:"1.5em"});function LXe({eventHandlers:t,roundMatchUps:e,roundProfile:i,roundNumber:n,context:r}){var a;const s=document.createElement("div");s.className=OXe(),s.classList.add("tmx-rh"),s.setAttribute("roundNumber",n);const o=Md(t?.roundHeaderClick);o&&(s.onclick=d=>t.roundHeaderClick({roundNumber:n,roundProfile:i,roundMatchUps:e,context:r,pointerEvent:d}));const l=o?"":"",u=(a=i?.[n])==null?void 0:a.roundName,c=u&&` <div style="display: flex; flex-direction: row; justify-content: space-between">
        <div>${u}</div>
        <div style="font-weight: bold">${l}</div>
      </div>
  `;return s.innerHTML=c||"",s}const MEe=yn({flexDirection:"column",display:"flex"}),FXe=yn({flexDirection:"row",display:"flex"}),NEe=yn({justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",flexDirection:"column",height:"100%",display:"flex",variants:{variant:{adHoc:{justifyContent:"flex-start"}}}}),$Xe=yn({borderTop:"solid 1px black",marginRight:"-1em",marginLeft:"-1em",paddingTop:".5em",marginTop:".2em",variants:{variant:{0:{marginTop:"1em",borderTop:"none",paddingTop:"0px"}},roundOrder:{first:{marginLeft:"0em"},last:{marginRight:"0em"}}}}),BXe=yn({fontWeight:"bold",color:"blue",height:"1em"}),See=yn({width:"$score$setWidth",display:"inline-block",fontSize:9,variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),VXe=yn({transform:"translateY(-50%)",textTransform:"uppercase",backgroundColor:"#fff",position:"absolute",textAlign:"center",top:"calc(50%)",color:"#bbb",fontSize:0,right:4});function jXe(){return yn({backgroundColor:"magenta",position:"absolute",opacity:"0.2",height:"100%",width:"100%",top:0})}const GXe=yn({});function HXe({configuration:t}){const e={backgroundColor:"$matchUpBackgroundColor",WebkitTransition:"all 0.30s linear",boxShadow:"$matchUp$boxShadow",transition:"all 0.30s linear",border:"solid $border",marginBottom:"$space$1",marginTop:"$space$1",position:"relative",display:"grid",width:"100%",borderInlineStartWidth:"$borderWidths$borderInlineStart"};if(t!=null&&t.matchUpHover){const i=typeof t.matchUpHover=="string"?t.matchUpHover:"cyan";e["&:hover"]={backgroundColor:i}}else e["&:hover"]={borderColor:"$borderHover"};return yn(e)}function zXe({variant:t}){return yn({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",position:"relative",width:"100%",height:"$lineHeights$centerInfo",variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}})({variant:t})}const qXe=yn({justifyContent:"center",alignContent:"center",flexDirection:"column",height:"100%",display:"flex"}),WXe=yn({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",marginInlineStart:"calc(20%)",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",WebkitBoxPack:"center",boxSizing:"inherit",flexDirection:"row",display:"flex"}),Tee=yn({alignContent:"center",boxSizing:"inherit",fontFamily:"Lato",fontWeight:900,fontSize:9});function YXe({eventHandlers:t,entryStatus:e,sideNumber:i,className:n,matchUp:r}){const a=document.createElement("div");Md(t?.centerInfoClick)&&(a.onclick=c=>t.centerInfoClick({matchUp:r,sideNumber:i,pointerEvent:c})),a.className=Ob(zXe({variant:i}),n),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",i);const s=document.createElement("div");s.className=qXe();const o=document.createElement("div");o.className=WXe();const l=document.createElement("div");l.className=Tee(),l.innerHTML=e?"Entry status:&nbsp;":"",o.appendChild(l);const u=document.createElement("div");return u.className=Tee(),u.innerHTML=e||"",o.appendChild(u),s.appendChild(o),a.appendChild(s),{element:a}}const _P={scheduleInfo:1.8,centerInfo:1.5,gameScore:2};function KXe({composition:t,isDoubles:e,roundFactor:i=1}){const n=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),r=t?.configuration||{},a=r?.connectorWidth||16,s=r.centerInfo?_P.centerInfo*n:0,o=r.scheduleInfo?_P.scheduleInfo*n:0,l=(60+(r.showAddress?n:0))*(e?1.3:1)+s,u=l*i,c=(l+o)*i;return yn({"&::before":{borderBlockStart:"$borderWidths$matchUp solid #999",left:-a,width:a,position:"absolute",borderRadius:2,top:-1},"&::after":{width:a,position:"absolute",borderRadius:2,left:"100%"},"&::after, &::before":{borderWidth:"$borderWidths$matchUp",borderColor:"$connector",display:"block",content:""},variants:{isFirstRound:{true:{"&::before":{height:0,width:0,borderWidth:0}}},link:{m1:{"&::after":{borderInlineEnd:"$borderWidths$matchUp solid $connector",borderTopStyle:"solid",height:u,top:-1}},m2:{"&::after":{bottom:"calc(100%)",borderInlineEnd:"$borderWidths$matchUp solid $connector",borderBottomStyle:"solid",height:c}},m0:{"&::after":{borderTopStyle:"solid",borderColor:"$connector",top:-1}},mr:{"&::before":{height:0,width:0,borderWidth:0},"&::after":{height:0,width:0,borderWidth:0}},noProgression:{true:{"&::after":{height:0,width:0,borderWidth:0}}}}}})}const AEe=t=>yn({display:"flex",alignItems:"center",height:t,justifyContent:"flex-end",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}},fontSize:{small:{fontSize:"smaller",paddingRight:"1em",color:"blue"}}}}),ZXe=yn({lineHeight:"0.75rem",fontSize:"0.625rem",left:"1.1rem",top:".4rem"}),_Ee=yn({lineHeight:"$lineHeights$gameScore",justifyContent:"center",width:"$score$setWidth",position:"relative",textAlign:"center",cursor:"pointer",fontWeight:500,fontSize:"$1",display:"flex",margin:0,variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),XXe=yn({marginInlineEnd:"$space$gameMarginInlineEnd",justifyContent:"flex-end",alignItems:"center",display:"flex"});function JXe({value:t}={}){const e=document.createElement("input");return e.onclick=i=>i.target.select(),e.className=_Ee(),e.value=t,e}function QXe({gameScoreOnly:t,scoreStripes:e,set:i,sideNumber:n}){const r=n===i?.winningSide||i!=null&&i.winningSide?"loser":void 0,a=n===2?i.side2Score:i.side1Score,s=i.side2TiebreakScore||i.side1TiebreakScore,o=n===2?i.side2TiebreakScore:i.side1TiebreakScore,l=a===void 0&&o,u=l||a,c=e&&i.setNumber%2?"lightgray":"transparent",d=i.editing?i.editing===n:void 0;let p;if(d)p=JXe({value:u});else if(p=document.createElement("p"),p.className=_Ee({variant:r}),p.classList.add("tmx-st"),p.setAttribute("setNumber",i.setNumber),p.style.backgroundColor=c,p.innerHTML=isNaN(u)?"":u,!t){const h=document.createElement("span");h.className=ZXe(),h.innerHTML=s&&!l?o:"",p.appendChild(h)}return p}function eJe({participantHeight:t,eventHandlers:e,composition:i,sideNumber:n,matchUp:r}){var a,s,o,l;const u=(a=i?.configuration)==null?void 0:a.winnerChevron,c=(s=i?.configuration)==null?void 0:s.gameScoreOnly,d=((o=r?.score)==null?void 0:o.sets)||[],p=(l=i?.configuration)==null?void 0:l.scoreBox,h=n===2?t:t-1,f=AEe(h),m=y=>{Md(e?.scoreClick)&&(y.stopPropagation(),e.scoreClick({pointerEvent:y,matchUp:r}))},g=document.createElement("div");g.className=f({sideNumber:!p&&n,fontSize:"5px"}),g.classList.add("sideScore"),g.classList.add("tmx-scr"),g.onclick=m;const v=document.createElement("div");v.className=XXe();for(const y of d||[]){const b=QXe({gameScoreOnly:c,scoreStripes:u,sideNumber:n,set:y});v.appendChild(b)}return g.appendChild(v),g}const tJe=yn({height:"$lineHeights$scheduleInfo",borderBottom:"1px solid darkgray",justifyContent:"space-between",backgroundColor:"#F8F9F9",boxSizing:"border-box",paddingRight:"0.2rem",paddingLeft:"0.5rem",alignItems:"center",cursor:"pointer",color:"#7F8080",display:"flex",width:"100%"});var kEe={exports:{}};(function(t,e){(function(i,n){t.exports=n()})(rqe,function(){var i=1e3,n=6e4,r=36e5,a="millisecond",s="second",o="minute",l="hour",u="day",c="week",d="month",p="quarter",h="year",f="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(N){var A=["th","st","nd","rd"],_=N%100;return"["+N+(A[(_-20)%10]||A[_]||A[0])+"]"}},b=function(N,A,_){var x=String(N);return!x||x.length>=A?N:""+Array(A+1-x.length).join(_)+N},I={s:b,z:function(N){var A=-N.utcOffset(),_=Math.abs(A),x=Math.floor(_/60),O=_%60;return(A<=0?"+":"-")+b(x,2,"0")+":"+b(O,2,"0")},m:function N(A,_){if(A.date()<_.date())return-N(_,A);var x=12*(_.year()-A.year())+(_.month()-A.month()),O=A.clone().add(x,d),$=_-O<0,F=A.clone().add(x+($?-1:1),d);return+(-(x+(_-O)/($?O-F:F-O))||0)},a:function(N){return N<0?Math.ceil(N)||0:Math.floor(N)},p:function(N){return{M:d,y:h,w:c,d:u,D:f,h:l,m:o,s,ms:a,Q:p}[N]||String(N||"").toLowerCase().replace(/s$/,"")},u:function(N){return N===void 0}},S="en",w={};w[S]=y;var T="$isDayjsObject",U=function(N){return N instanceof M||!(!N||!N[T])},C=function N(A,_,x){var O;if(!A)return S;if(typeof A=="string"){var $=A.toLowerCase();w[$]&&(O=$),_&&(w[$]=_,O=$);var F=A.split("-");if(!O&&F.length>1)return N(F[0])}else{var j=A.name;w[j]=A,O=j}return!x&&O&&(S=O),O||!x&&S},E=function(N,A){if(U(N))return N.clone();var _=typeof A=="object"?A:{};return _.date=N,_.args=arguments,new M(_)},P=I;P.l=C,P.i=U,P.w=function(N,A){return E(N,{locale:A.$L,utc:A.$u,x:A.$x,$offset:A.$offset})};var M=(function(){function N(_){this.$L=C(_.locale,null,!0),this.parse(_),this.$x=this.$x||_.x||{},this[T]=!0}var A=N.prototype;return A.parse=function(_){this.$d=(function(x){var O=x.date,$=x.utc;if(O===null)return new Date(NaN);if(P.u(O))return new Date;if(O instanceof Date)return new Date(O);if(typeof O=="string"&&!/Z$/i.test(O)){var F=O.match(g);if(F){var j=F[2]-1||0,H=(F[7]||"0").substring(0,3);return $?new Date(Date.UTC(F[1],j,F[3]||1,F[4]||0,F[5]||0,F[6]||0,H)):new Date(F[1],j,F[3]||1,F[4]||0,F[5]||0,F[6]||0,H)}}return new Date(O)})(_),this.init()},A.init=function(){var _=this.$d;this.$y=_.getFullYear(),this.$M=_.getMonth(),this.$D=_.getDate(),this.$W=_.getDay(),this.$H=_.getHours(),this.$m=_.getMinutes(),this.$s=_.getSeconds(),this.$ms=_.getMilliseconds()},A.$utils=function(){return P},A.isValid=function(){return this.$d.toString()!==m},A.isSame=function(_,x){var O=E(_);return this.startOf(x)<=O&&O<=this.endOf(x)},A.isAfter=function(_,x){return E(_)<this.startOf(x)},A.isBefore=function(_,x){return this.endOf(x)<E(_)},A.$g=function(_,x,O){return P.u(_)?this[x]:this.set(O,_)},A.unix=function(){return Math.floor(this.valueOf()/1e3)},A.valueOf=function(){return this.$d.getTime()},A.startOf=function(_,x){var O=this,$=!!P.u(x)||x,F=P.p(_),j=function(J,ne){var re=P.w(O.$u?Date.UTC(O.$y,ne,J):new Date(O.$y,ne,J),O);return $?re:re.endOf(u)},H=function(J,ne){return P.w(O.toDate()[J].apply(O.toDate("s"),($?[0,0,0,0]:[23,59,59,999]).slice(ne)),O)},G=this.$W,W=this.$M,q=this.$D,Z="set"+(this.$u?"UTC":"");switch(F){case h:return $?j(1,0):j(31,11);case d:return $?j(1,W):j(0,W+1);case c:var K=this.$locale().weekStart||0,Q=(G<K?G+7:G)-K;return j($?q-Q:q+(6-Q),W);case u:case f:return H(Z+"Hours",0);case l:return H(Z+"Minutes",1);case o:return H(Z+"Seconds",2);case s:return H(Z+"Milliseconds",3);default:return this.clone()}},A.endOf=function(_){return this.startOf(_,!1)},A.$set=function(_,x){var O,$=P.p(_),F="set"+(this.$u?"UTC":""),j=(O={},O[u]=F+"Date",O[f]=F+"Date",O[d]=F+"Month",O[h]=F+"FullYear",O[l]=F+"Hours",O[o]=F+"Minutes",O[s]=F+"Seconds",O[a]=F+"Milliseconds",O)[$],H=$===u?this.$D+(x-this.$W):x;if($===d||$===h){var G=this.clone().set(f,1);G.$d[j](H),G.init(),this.$d=G.set(f,Math.min(this.$D,G.daysInMonth())).$d}else j&&this.$d[j](H);return this.init(),this},A.set=function(_,x){return this.clone().$set(_,x)},A.get=function(_){return this[P.p(_)]()},A.add=function(_,x){var O,$=this;_=Number(_);var F=P.p(x),j=function(W){var q=E($);return P.w(q.date(q.date()+Math.round(W*_)),$)};if(F===d)return this.set(d,this.$M+_);if(F===h)return this.set(h,this.$y+_);if(F===u)return j(1);if(F===c)return j(7);var H=(O={},O[o]=n,O[l]=r,O[s]=i,O)[F]||1,G=this.$d.getTime()+_*H;return P.w(G,this)},A.subtract=function(_,x){return this.add(-1*_,x)},A.format=function(_){var x=this,O=this.$locale();if(!this.isValid())return O.invalidDate||m;var $=_||"YYYY-MM-DDTHH:mm:ssZ",F=P.z(this),j=this.$H,H=this.$m,G=this.$M,W=O.weekdays,q=O.months,Z=O.meridiem,K=function(ne,re,oe,de){return ne&&(ne[re]||ne(x,$))||oe[re].slice(0,de)},Q=function(ne){return P.s(j%12||12,ne,"0")},J=Z||function(ne,re,oe){var de=ne<12?"AM":"PM";return oe?de.toLowerCase():de};return $.replace(v,function(ne,re){return re||(function(oe){switch(oe){case"YY":return String(x.$y).slice(-2);case"YYYY":return P.s(x.$y,4,"0");case"M":return G+1;case"MM":return P.s(G+1,2,"0");case"MMM":return K(O.monthsShort,G,q,3);case"MMMM":return K(q,G);case"D":return x.$D;case"DD":return P.s(x.$D,2,"0");case"d":return String(x.$W);case"dd":return K(O.weekdaysMin,x.$W,W,2);case"ddd":return K(O.weekdaysShort,x.$W,W,3);case"dddd":return W[x.$W];case"H":return String(j);case"HH":return P.s(j,2,"0");case"h":return Q(1);case"hh":return Q(2);case"a":return J(j,H,!0);case"A":return J(j,H,!1);case"m":return String(H);case"mm":return P.s(H,2,"0");case"s":return String(x.$s);case"ss":return P.s(x.$s,2,"0");case"SSS":return P.s(x.$ms,3,"0");case"Z":return F}return null})(ne)||F.replace(":","")})},A.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},A.diff=function(_,x,O){var $,F=this,j=P.p(x),H=E(_),G=(H.utcOffset()-this.utcOffset())*n,W=this-H,q=function(){return P.m(F,H)};switch(j){case h:$=q()/12;break;case d:$=q();break;case p:$=q()/3;break;case c:$=(W-G)/6048e5;break;case u:$=(W-G)/864e5;break;case l:$=W/r;break;case o:$=W/n;break;case s:$=W/i;break;default:$=W}return O?$:P.a($)},A.daysInMonth=function(){return this.endOf(d).$D},A.$locale=function(){return w[this.$L]},A.locale=function(_,x){if(!_)return this.$L;var O=this.clone(),$=C(_,x,!0);return $&&(O.$L=$),O},A.clone=function(){return P.w(this.$d,this)},A.toDate=function(){return new Date(this.valueOf())},A.toJSON=function(){return this.isValid()?this.toISOString():null},A.toISOString=function(){return this.$d.toISOString()},A.toString=function(){return this.$d.toUTCString()},N})(),R=M.prototype;return E.prototype=R,[["$ms",a],["$s",s],["$m",o],["$H",l],["$W",u],["$M",d],["$y",h],["$D",f]].forEach(function(N){R[N[1]]=function(A){return this.$g(A,N[0],N[1])}}),E.extend=function(N,A){return N.$i||(N(A,M,E),N.$i=!0),E},E.locale=C,E.isDayjs=U,E.unix=function(N){return E(1e3*N)},E.en=w[S],E.Ls=w,E.p={},E})})(kEe);var iJe=kEe.exports;const nJe=vve(iJe);function rJe({matchUp:t,eventHandlers:e}){const{scheduledTime:i,scheduledDate:n,venueAbbreviation:r,courtName:a}=t?.schedule||{},{dateTime:{extractDate:s,extractTime:o}}=lK,l=o(i);let u=s(n),c="ddd D MMMM";l&&(c+=", hh:mm A",u+=`T${l}`);const d=n?nJe(u).format(c):"Not scheduled",p=r&&a?.toString().startsWith(r)&&a||r&&a&&`${r} ${a}`||a||r||"",h=document.createElement("div");h.className=tJe(),h.classList.add("tmx-sch"),Md(e?.scheduleClick)&&(h.onclick=y=>e.scheduleClick({matchUp:t,pointerEvent:y}));const f=document.createElement("div");f.innerHTML=d,h.append(f);const m=y=>{Md(e?.venueClick)&&(y.stopPropagation(),e.venueClick({pointerEvent:y,matchUp:t}))},g=document.createElement("div");g.style="display: flex; flex-direction: row";const v=document.createElement("div");if(v.style.paddingRight=".2rem",v.onclick=m,v.innerHTML=p,g.append(v),h.append(g),h.onclick){const y=document.createElement("div");y.innerHTML="",g.append(y)}return h}function Uee({initialRoundNumber:t=1,eventHandlers:e,composition:i,sideNumber:n,className:r,matchUp:a}){var s,o;const l=i?.configuration||{},u=l?.scheduleInfo,c=(s=a?.score)==null?void 0:s.scoreStringSide1,d=((o=i?.configuration)==null?void 0:o.scoreBox)&&c,p=a?.readyToScore&&e?.scoreClick&&!REe.checkScoreHasValue({matchUp:a}),h=document.createElement("div");if(h.className=Ob(AXe(),r),h.classList.add("tmx-sd"),h.setAttribute("sideNumber",n),u&&n===1){const g=rJe({matchUp:a,eventHandlers:e});h.appendChild(g)}const f=document.createElement("div");f.className=_Xe();const m=hK({sideContainer:!0,initialRoundNumber:t,eventHandlers:e,composition:i,sideNumber:n,matchUp:a});if(f.appendChild(m),d){const g=document.createElement("div");g.style.border="1px solid lightgray",f.appendChild(g)}if(c){const g=eJe({eventHandlers:e,composition:i,sideNumber:n,matchUp:a});f.appendChild(g)}if(p){const g=AEe(),v=b=>{Md(e?.scoreClick)&&(event.stopPropagation(),e.scoreClick({pointerEvent:b,matchUp:a}))},y=document.createElement("div");y.className=g({sideNumber:!d&&n,fontSize:"small"}),y.onclick=v,y.innerHTML="[Score]",f.appendChild(y)}return h.appendChild(f),h}function xEe(t){const{composition:e,initialRoundNumber:i=1,matchUp:n,moiety:r,selectedMatchUpId:a,searchActive:s}=t,{roundFactor:o,roundNumber:l,finishingRound:u,matchUpType:c,preFeedRound:d,stage:p}=n,h=t.isFinalRound||parseInt(u)===1,f=p==="QUALIFYING"&&h,m=h,g=parseInt(l)===i,v=c==="DOUBLES",y=(s||n.isRoundRobin||n.collectionId||t.isLucky||t.isAdHoc)&&"mr"||m&&"noProgression"||(f||d)&&"m0"||r&&"m1"||"m2",b=KXe({composition:e,isDoubles:v,roundFactor:o})({isFirstRound:g,link:y}),I=e?.configuration||{},{resultsInfo:S,centerInfo:w}=I||{},T=t.eventHandlers||{},U=N=>{Md(T?.matchUpClick)&&T.matchUpClick({pointerEvent:N,matchUp:n})},C=document.createElement("div");C.className=Ob(e.theme,t?.className,"matchup",GXe()),C.classList.add("tmx-m"),C.setAttribute("id",n?.matchUpId),C.onclick=U;const E=document.createElement("div");E.className=HXe({configuration:I});const P=({sideNumber:N})=>{var A,_,x;const O=(x=(_=(A=n?.sides.find($=>$.sideNumber===N))==null?void 0:A.participant)==null?void 0:_.entryStatus)==null?void 0:x.replace("_"," ");return YXe({eventHandlers:T,entryStatus:O,sideNumber:N,className:N===2&&b,matchUp:n})},M=Uee({initialRoundNumber:i,eventHandlers:T,sideNumber:1,composition:e,matchUp:n}),R=Uee({className:!w&&b,initialRoundNumber:i,eventHandlers:T,sideNumber:2,composition:e,matchUp:n});if(E.appendChild(M),w){const N=P({sideNumber:1}),A=P({sideNumber:2});E.appendChild(N.element),E.appendChild(A.element)}if(E.appendChild(R),S){const N=aJe({score:n.score});E.appendChild(N)}if(C.appendChild(E),a===n.matchUpId){const N=document.createElement("div");N.className=jXe(),C.appendChild(N)}return C}function aJe({score:t}){var e;const i=(e=t?.sets)==null?void 0:e.filter(Boolean).sort((s,o)=>(s.setNumber||0)-(o.setNumber||0)),n=i?.[i.length-1],r=n?.side1PointsScore||n?.side2PointsScore,a=document.createElement("div");if(a.className=VXe(),r){const s=document.createElement("div");s.className=See({variant:"points"}),s.innerHTML="PTS",a.appendChild(s)}for(const s of i||[]){const o=document.createElement("div");o.setAttribute("key",s.setNumber),o.className=See({variant:"set"}),o.innerHTML=s.setNumber,a.appendChild(o)}return a}function sJe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,isFinalRound:n,isRoundRobin:r,searchActive:a,composition:s,roundFactor:o,roundNumber:l,roundProfile:u,minWidth:c,matchUps:d,context:p,isLucky:h}){const f=d.filter(E=>E.roundNumber===l).sort((E,P)=>(E.roundPosition||0)-(P.roundPosition||0)),m=f.every(({roundPosition:E,drawPositions:P})=>!E&&!P),g=s?.configuration||{},v=document.createElement("div");if(v.className=MEe(),v.classList.add("tmx-rd"),v.setAttribute("roundNumber",l),g.roundHeader){const E=LXe({roundProfile:u,roundMatchUps:f,roundNumber:l,eventHandlers:i,context:p});v.appendChild(E)}const y=document.createElement("div");y.className=NEe({variant:m?"adHoc":void 0}),c&&(y.style.minWidth=c);let b,I,S;if(r){const E=M=>M.reduce((R,N)=>N+R,0);f.sort((M,R)=>{const N=E(M.drawPositions)-E(R.drawPositions),A=Math.min(...M.drawPositions??[])-Math.min(...R.drawPositions??[]);return N||A});const P=f.reduce((M,R)=>(M[R.structureId]=R.structureName,M),{});b=Object.values(P),I=Object.keys(P),S=Object.keys(lK.instanceCount(f.map(({structureId:M})=>M))).length}else m&&f.sort((E,P)=>(E.roundOrder??0)-(P.roundOrder??0));const w=S&&f.length/S,T=Object.keys(u).map(E=>parseInt(E)),U=T.indexOf(l),C=U===0&&"first"||U===T.length-1&&"last";return f.forEach((E,P)=>{const M=w&&!(P%w),R=w&&Math.floor(P/w),N=w&&b[R];if(M){const x=document.createElement("div");x.className=$Xe({variant:R,roundOrder:C}),y.appendChild(x);const O=document.createElement("div");if(O.className=BXe(),Md(i?.groupHeaderClick)){const{drawId:$,containerStructureId:F}=f[0];y.onclick=j=>i.groupHeaderClick({structureId:I[R],containerStructureId:F,pointerEvent:j,drawId:$})}l===t&&(O.innerHTML=N),y.appendChild(O)}const A=P%2===0;o?E.roundFactor=o:t>1&&(E.roundFactor=Math.pow(2,l-t));const _=xEe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:n,searchActive:a,composition:s,isAdHoc:m,isLucky:h,matchUp:E,moiety:A});y.appendChild(_)}),v.appendChild(y),v}function oJe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,searchActive:n,composition:r,structureId:a,finalColumn:s,matchUps:o,minWidth:l,context:u}){var c;const{roundNumbers:d,roundProfile:p,hasOddMatchUpsCount:h,isNotEliminationStructure:f}=REe.getRoundMatchUps({matchUps:o});a=a||u?.structureId||((c=o?.[0])==null?void 0:c.structureId);const m=o.some(({isRoundRobin:b})=>b),g=h||f,v=document.createElement("div");v.className=FXe(),v.classList.add("tmx-str"),v.setAttribute("id",a);const y=Math.max(...d);for(const b of d){if(b<t)continue;const I=sJe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:b===y,isRoundRobin:m,searchActive:n,composition:r,roundNumber:b,roundProfile:p,matchUps:o,minWidth:l,context:u,isLucky:g});v.appendChild(I)}if(s){const b=document.createElement("div");b.className=MEe();const I=document.createElement("div");I.className=NEe(),I.appendChild(s),b.appendChild(I),v.appendChild(b)}return v}const Dee=yn({backgroundColor:"$colors$backgroundColor",color:"$colors$color",overflowX:"auto",height:1e3});function lJe({content:t,theme:e}){const i=document.createElement("div");return i.className=e?Ob(Dee(),e):Dee(),e&&i.classList.add(e),typeof t=="string"?i.innerHTML=t:i.appendChild(t),i}const{createTheme:J0}=gve({theme:{lineHeights:{scheduleInfo:`${_P.scheduleInfo}rem`,centerInfo:`${_P.centerInfo}rem`,gameScore:`${_P.gameScore}rem`},borderWidths:{matchUpInline:"1px 1px",matchUp:"1px"},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},colors:{internalDividers:"lightgray",backgroundColor:"white",connector:"lightgray",border:"darkgray",color:"black"},participant:{textTransform:"capitalize",minHeight:"2rem",seed:"gray"},score:{setWidth:"1.3rem"}}}),Eee=J0("australian-theme",{colors:{borderHover:"#0091d2",connector:"#999"}}),uJe=J0("wimbledon-theme",{borderWidths:{borderInlineStart:"10px"},colors:{connector:"transparent",borderHover:"darkgrey",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),cJe=J0("french-theme",{colors:{winnerName:"#01503d!important",winner:"#01503d!important",borderHover:"#0091d2",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),dJe=J0("usopen-theme",{colors:{matchUpBackgroundColor:"#F8F9F9",internalDividers:"darkgray",borderHover:"#0091d2",connector:"#999"}}),Pee=J0("basic-theme",{colors:{internalDividers:"transparent",winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),pJe=J0("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),hJe=J0("itf-theme",{colors:{borderHover:"#0091d2",connector:"#999",matchUp:"#fff"},participant:{textTransform:"uppercase",seed:"gray"}}),Fx={Australian:{configuration:{flags:!0},theme:Eee},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:Pee},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:Pee},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:cJe},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:uJe},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:dJe},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:hJe},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:Eee},Night:{configuration:{flags:!0},theme:pJe}};function Aw(){ix.close()}function Yn(t){const{title:e,content:i,buttons:n,footer:r,onClose:a}=t,o={padding:!e&&!n?"":".5",maxWidth:500};return ix.open({title:e,content:i,footer:r,buttons:n,config:o,onClose:a})}async function fJe({callback:t}){const e={providerId:""},n=(await kC()).data?.providers,r=n.map(({value:c})=>({label:c.organisationName,value:c.organisationId})),a=n.map(({value:c})=>c.organisationName),s=()=>{const c=n.find(({value:d})=>d.organisationId===e.providerId)?.value;c&&Mt(t)&&t(c)},o=c=>{const d=c.target.value,p=d===""||a.includes(d),h=document.getElementById("selectButton");h.disabled=!p,e.providerId=p?d:""},l=c=>{const d=document.getElementById("selectButton");e.providerId=c,d.disabled=!c};Yn({title:"Select provider",content:c=>{mr(c,[{typeAhead:{list:r,callback:l},placeholder:"Type provider name",label:"Provider",field:"provider",width:"100%",onInput:o}])},buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:s,intent:"is-primary",id:"selectButton",label:"Select",disabled:!0,close:!0}]})}var F_={exports:{}},mJe=F_.exports,Cee;function gJe(){return Cee||(Cee=1,(function(t,e){(function(i,n){t.exports=n()})(mJe,function(){var i=function(B,z){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(X,te){X.__proto__=te}||function(X,te){for(var ae in te)Object.prototype.hasOwnProperty.call(te,ae)&&(X[ae]=te[ae])})(B,z)},n=function(){return(n=Object.assign||function(B){for(var z,X=1,te=arguments.length;X<te;X++)for(var ae in z=arguments[X])Object.prototype.hasOwnProperty.call(z,ae)&&(B[ae]=z[ae]);return B}).apply(this,arguments)};function r(B,z,X){for(var te,ae=0,fe=z.length;ae<fe;ae++)!te&&ae in z||((te=te||Array.prototype.slice.call(z,0,ae))[ae]=z[ae]);return B.concat(te||Array.prototype.slice.call(z))}var a=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:xg,s=Object.keys,o=Array.isArray;function l(B,z){return typeof z!="object"||s(z).forEach(function(X){B[X]=z[X]}),B}typeof Promise>"u"||a.Promise||(a.Promise=Promise);var u=Object.getPrototypeOf,c={}.hasOwnProperty;function d(B,z){return c.call(B,z)}function p(B,z){typeof z=="function"&&(z=z(u(B))),(typeof Reflect>"u"?s:Reflect.ownKeys)(z).forEach(function(X){f(B,X,z[X])})}var h=Object.defineProperty;function f(B,z,X,te){h(B,z,l(X&&d(X,"get")&&typeof X.get=="function"?{get:X.get,set:X.set,configurable:!0}:{value:X,configurable:!0,writable:!0},te))}function m(B){return{from:function(z){return B.prototype=Object.create(z.prototype),f(B.prototype,"constructor",B),{extend:p.bind(null,B.prototype)}}}}var g=Object.getOwnPropertyDescriptor,v=[].slice;function y(B,z,X){return v.call(B,z,X)}function b(B,z){return z(B)}function I(B){if(!B)throw new Error("Assertion Failed")}function S(B){a.setImmediate?setImmediate(B):setTimeout(B,0)}function w(B,z){if(typeof z=="string"&&d(B,z))return B[z];if(!z)return B;if(typeof z!="string"){for(var X=[],te=0,ae=z.length;te<ae;++te){var fe=w(B,z[te]);X.push(fe)}return X}var Ie=z.indexOf(".");if(Ie!==-1){var Ue=B[z.substr(0,Ie)];return Ue==null?void 0:w(Ue,z.substr(Ie+1))}}function T(B,z,X){if(B&&z!==void 0&&!("isFrozen"in Object&&Object.isFrozen(B)))if(typeof z!="string"&&"length"in z){I(typeof X!="string"&&"length"in X);for(var te=0,ae=z.length;te<ae;++te)T(B,z[te],X[te])}else{var fe,Ie,Ue=z.indexOf(".");Ue!==-1?(fe=z.substr(0,Ue),(Ie=z.substr(Ue+1))===""?X===void 0?o(B)&&!isNaN(parseInt(fe))?B.splice(fe,1):delete B[fe]:B[fe]=X:T(Ue=!(Ue=B[fe])||!d(B,fe)?B[fe]={}:Ue,Ie,X)):X===void 0?o(B)&&!isNaN(parseInt(z))?B.splice(z,1):delete B[z]:B[z]=X}}function U(B){var z,X={};for(z in B)d(B,z)&&(X[z]=B[z]);return X}var C=[].concat;function E(B){return C.apply([],B)}var gt="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(E([8,16,32,64].map(function(B){return["Int","Uint","Float"].map(function(z){return z+B+"Array"})}))).filter(function(B){return a[B]}),P=new Set(gt.map(function(B){return a[B]})),M=null;function R(B){return M=new WeakMap,B=(function z(X){if(!X||typeof X!="object")return X;var te=M.get(X);if(te)return te;if(o(X)){te=[],M.set(X,te);for(var ae=0,fe=X.length;ae<fe;++ae)te.push(z(X[ae]))}else if(P.has(X.constructor))te=X;else{var Ie,Ue=u(X);for(Ie in te=Ue===Object.prototype?{}:Object.create(Ue),M.set(X,te),X)d(X,Ie)&&(te[Ie]=z(X[Ie]))}return te})(B),M=null,B}var N={}.toString;function A(B){return N.call(B).slice(8,-1)}var _=typeof Symbol<"u"?Symbol.iterator:"@@iterator",x=typeof _=="symbol"?function(B){var z;return B!=null&&(z=B[_])&&z.apply(B)}:function(){return null};function O(B,z){return z=B.indexOf(z),0<=z&&B.splice(z,1),0<=z}var $={};function F(B){var z,X,te,ae;if(arguments.length===1){if(o(B))return B.slice();if(this===$&&typeof B=="string")return[B];if(ae=x(B)){for(X=[];!(te=ae.next()).done;)X.push(te.value);return X}if(B==null)return[B];if(typeof(z=B.length)!="number")return[B];for(X=new Array(z);z--;)X[z]=B[z];return X}for(z=arguments.length,X=new Array(z);z--;)X[z]=arguments[z];return X}var j=typeof Symbol<"u"?function(B){return B[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Xe=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Sc=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Xe),H={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function G(B,z){this.name=B,this.message=z}function W(B,z){return B+". Errors: "+Object.keys(z).map(function(X){return z[X].toString()}).filter(function(X,te,ae){return ae.indexOf(X)===te}).join(`
`)}function q(B,z,X,te){this.failures=z,this.failedKeys=te,this.successCount=X,this.message=W(B,z)}function Z(B,z){this.name="BulkError",this.failures=Object.keys(z).map(function(X){return z[X]}),this.failuresByPos=z,this.message=W(B,this.failures)}m(G).from(Error).extend({toString:function(){return this.name+": "+this.message}}),m(q).from(G),m(Z).from(G);var K=Sc.reduce(function(B,z){return B[z]=z+"Error",B},{}),Q=G,J=Sc.reduce(function(B,z){var X=z+"Error";function te(ae,fe){this.name=X,ae?typeof ae=="string"?(this.message="".concat(ae).concat(fe?`
 `+fe:""),this.inner=fe||null):typeof ae=="object"&&(this.message="".concat(ae.name," ").concat(ae.message),this.inner=ae):(this.message=H[z]||X,this.inner=null)}return m(te).from(Q),B[z]=te,B},{});J.Syntax=SyntaxError,J.Type=TypeError,J.Range=RangeError;var ne=Xe.reduce(function(B,z){return B[z+"Error"]=J[z],B},{}),re=Sc.reduce(function(B,z){return["Syntax","Type","Range"].indexOf(z)===-1&&(B[z+"Error"]=J[z]),B},{});function oe(){}function de(B){return B}function se(B,z){return B==null||B===de?z:function(X){return z(B(X))}}function ge(B,z){return function(){B.apply(this,arguments),z.apply(this,arguments)}}function ye(B,z){return B===oe?z:function(){var X=B.apply(this,arguments);X!==void 0&&(arguments[0]=X);var te=this.onsuccess,ae=this.onerror;this.onsuccess=null,this.onerror=null;var fe=z.apply(this,arguments);return te&&(this.onsuccess=this.onsuccess?ge(te,this.onsuccess):te),ae&&(this.onerror=this.onerror?ge(ae,this.onerror):ae),fe!==void 0?fe:X}}function Te(B,z){return B===oe?z:function(){B.apply(this,arguments);var X=this.onsuccess,te=this.onerror;this.onsuccess=this.onerror=null,z.apply(this,arguments),X&&(this.onsuccess=this.onsuccess?ge(X,this.onsuccess):X),te&&(this.onerror=this.onerror?ge(te,this.onerror):te)}}function De(B,z){return B===oe?z:function(X){var te=B.apply(this,arguments);l(X,te);var ae=this.onsuccess,fe=this.onerror;return this.onsuccess=null,this.onerror=null,X=z.apply(this,arguments),ae&&(this.onsuccess=this.onsuccess?ge(ae,this.onsuccess):ae),fe&&(this.onerror=this.onerror?ge(fe,this.onerror):fe),te===void 0?X===void 0?void 0:X:l(te,X)}}function xe(B,z){return B===oe?z:function(){return z.apply(this,arguments)!==!1&&B.apply(this,arguments)}}function Me(B,z){return B===oe?z:function(){var X=B.apply(this,arguments);if(X&&typeof X.then=="function"){for(var te=this,ae=arguments.length,fe=new Array(ae);ae--;)fe[ae]=arguments[ae];return X.then(function(){return z.apply(te,fe)})}return z.apply(this,arguments)}}re.ModifyError=q,re.DexieError=G,re.BulkError=Z;var Oe=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function at(B){Oe=B}var Fe={},mt=100,gt=typeof Promise>"u"?[]:(function(){var B=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[B,u(B),B];var z=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[z,u(z),B]})(),Xe=gt[0],Sc=gt[1],gt=gt[2],Sc=Sc&&Sc.then,ht=Xe&&Xe.constructor,_e=!!gt,Ye=function(B,z){Ae.push([B,z]),ct&&(queueMicrotask(ci),ct=!1)},Je=!0,ct=!0,pt=[],Se=[],he=de,we={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:oe,pgp:!1,env:{},finalize:oe},be=we,Ae=[],ze=0,We=[];function Le(B){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var z=this._PSD=be;if(typeof B!="function"){if(B!==Fe)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&St(this,this._value))}this._state=null,this._value=null,++z.ref,(function X(te,ae){try{ae(function(fe){if(te._state===null){if(fe===te)throw new TypeError("A promise cannot be resolved with itself.");var Ie=te._lib&&Tt();fe&&typeof fe.then=="function"?X(te,function(Ue,ke){fe instanceof Le?fe._then(Ue,ke):fe.then(Ue,ke)}):(te._state=!0,te._value=fe,si(te)),Ie&&Li()}},St.bind(null,te))}catch(fe){St(te,fe)}})(this,B)}var ft={get:function(){var B=be,z=Xr;function X(te,ae){var fe=this,Ie=!B.global&&(B!==be||z!==Xr),Ue=Ie&&!Ua(),ke=new Le(function($e,He){Qe(fe,new rt(ch(te,B,Ie,Ue),ch(ae,B,Ie,Ue),$e,He,B))});return this._consoleTask&&(ke._consoleTask=this._consoleTask),ke}return X.prototype=Fe,X},set:function(B){f(this,"then",B&&B.prototype===Fe?ft:{get:function(){return B},set:ft.set})}};function rt(B,z,X,te,ae){this.onFulfilled=typeof B=="function"?B:null,this.onRejected=typeof z=="function"?z:null,this.resolve=X,this.reject=te,this.psd=ae}function St(B,z){var X,te;Se.push(z),B._state===null&&(X=B._lib&&Tt(),z=he(z),B._state=!1,B._value=z,te=B,pt.some(function(ae){return ae._value===te._value})||pt.push(te),si(B),X&&Li())}function si(B){var z=B._listeners;B._listeners=[];for(var X=0,te=z.length;X<te;++X)Qe(B,z[X]);var ae=B._PSD;--ae.ref||ae.finalize(),ze===0&&(++ze,Ye(function(){--ze==0&&Jt()},[]))}function Qe(B,z){if(B._state!==null){var X=B._state?z.onFulfilled:z.onRejected;if(X===null)return(B._state?z.resolve:z.reject)(B._value);++z.psd.ref,++ze,Ye(bt,[X,B,z])}else B._listeners.push(z)}function bt(B,z,X){try{var te,ae=z._value;!z._state&&Se.length&&(Se=[]),te=Oe&&z._consoleTask?z._consoleTask.run(function(){return B(ae)}):B(ae),z._state||Se.indexOf(ae)!==-1||(function(fe){for(var Ie=pt.length;Ie;)if(pt[--Ie]._value===fe._value)return pt.splice(Ie,1)})(z),X.resolve(te)}catch(fe){X.reject(fe)}finally{--ze==0&&Jt(),--X.psd.ref||X.psd.finalize()}}function ci(){Ru(we,function(){Tt()&&Li()})}function Tt(){var B=Je;return ct=Je=!1,B}function Li(){var B,z,X;do for(;0<Ae.length;)for(B=Ae,Ae=[],X=B.length,z=0;z<X;++z){var te=B[z];te[0].apply(null,te[1])}while(0<Ae.length);ct=Je=!0}function Jt(){var B=pt;pt=[],B.forEach(function(te){te._PSD.onunhandled.call(null,te._value,te)});for(var z=We.slice(0),X=z.length;X;)z[--X]()}function Yi(B){return new Le(Fe,!1,B)}function Ri(B,z){var X=be;return function(){var te=Tt(),ae=be;try{return zl(X,!0),B.apply(this,arguments)}catch(fe){z&&z(fe)}finally{zl(ae,!1),te&&Li()}}}p(Le.prototype,{then:ft,_then:function(B,z){Qe(this,new rt(null,null,B,z,be))},catch:function(B){if(arguments.length===1)return this.then(null,B);var z=B,X=arguments[1];return typeof z=="function"?this.then(null,function(te){return(te instanceof z?X:Yi)(te)}):this.then(null,function(te){return(te&&te.name===z?X:Yi)(te)})},finally:function(B){return this.then(function(z){return Le.resolve(B()).then(function(){return z})},function(z){return Le.resolve(B()).then(function(){return Yi(z)})})},timeout:function(B,z){var X=this;return B<1/0?new Le(function(te,ae){var fe=setTimeout(function(){return ae(new J.Timeout(z))},B);X.then(te,ae).finally(clearTimeout.bind(null,fe))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&f(Le.prototype,Symbol.toStringTag,"Dexie.Promise"),we.env=Cf(),p(Le,{all:function(){var B=F.apply(null,arguments).map(lr);return new Le(function(z,X){B.length===0&&z([]);var te=B.length;B.forEach(function(ae,fe){return Le.resolve(ae).then(function(Ie){B[fe]=Ie,--te||z(B)},X)})})},resolve:function(B){return B instanceof Le?B:B&&typeof B.then=="function"?new Le(function(z,X){B.then(z,X)}):new Le(Fe,!0,B)},reject:Yi,race:function(){var B=F.apply(null,arguments).map(lr);return new Le(function(z,X){B.map(function(te){return Le.resolve(te).then(z,X)})})},PSD:{get:function(){return be},set:function(B){return be=B}},totalEchoes:{get:function(){return Xr}},newPSD:Qr,usePSD:Ru,scheduler:{get:function(){return Ye},set:function(B){Ye=B}},rejectionMapper:{get:function(){return he},set:function(B){he=B}},follow:function(B,z){return new Le(function(X,te){return Qr(function(ae,fe){var Ie=be;Ie.unhandleds=[],Ie.onunhandled=fe,Ie.finalize=ge(function(){var Ue,ke=this;Ue=function(){ke.unhandleds.length===0?ae():fe(ke.unhandleds[0])},We.push(function $e(){Ue(),We.splice(We.indexOf($e),1)}),++ze,Ye(function(){--ze==0&&Jt()},[])},Ie.finalize),B()},z,X,te)})}}),ht&&(ht.allSettled&&f(Le,"allSettled",function(){var B=F.apply(null,arguments).map(lr);return new Le(function(z){B.length===0&&z([]);var X=B.length,te=new Array(X);B.forEach(function(ae,fe){return Le.resolve(ae).then(function(Ie){return te[fe]={status:"fulfilled",value:Ie}},function(Ie){return te[fe]={status:"rejected",reason:Ie}}).then(function(){return--X||z(te)})})})}),ht.any&&typeof AggregateError<"u"&&f(Le,"any",function(){var B=F.apply(null,arguments).map(lr);return new Le(function(z,X){B.length===0&&X(new AggregateError([]));var te=B.length,ae=new Array(te);B.forEach(function(fe,Ie){return Le.resolve(fe).then(function(Ue){return z(Ue)},function(Ue){ae[Ie]=Ue,--te||X(new AggregateError(ae))})})})}),ht.withResolvers&&(Le.withResolvers=ht.withResolvers));var qi={awaits:0,echoes:0,id:0},hn=0,kt=[],fi=0,Xr=0,Jr=0;function Qr(B,z,X,te){var ae=be,fe=Object.create(ae);return fe.parent=ae,fe.ref=0,fe.global=!1,fe.id=++Jr,we.env,fe.env=_e?{Promise:Le,PromiseProp:{value:Le,configurable:!0,writable:!0},all:Le.all,race:Le.race,allSettled:Le.allSettled,any:Le.any,resolve:Le.resolve,reject:Le.reject}:{},z&&l(fe,z),++ae.ref,fe.finalize=function(){--this.parent.ref||this.parent.finalize()},te=Ru(fe,B,X,te),fe.ref===0&&fe.finalize(),te}function Lr(){return qi.id||(qi.id=++hn),++qi.awaits,qi.echoes+=mt,qi.id}function Ua(){return!!qi.awaits&&(--qi.awaits==0&&(qi.id=0),qi.echoes=qi.awaits*mt,!0)}function lr(B){return qi.echoes&&B&&B.constructor===ht?(Lr(),B.then(function(z){return Ua(),z},function(z){return Ua(),Gr(z)})):B}function Cu(){var B=kt[kt.length-1];kt.pop(),zl(B,!1)}function zl(B,z){var X,te=be;(z?!qi.echoes||fi++&&B===be:!fi||--fi&&B===be)||queueMicrotask(z?(function(ae){++Xr,qi.echoes&&--qi.echoes!=0||(qi.echoes=qi.awaits=qi.id=0),kt.push(be),zl(ae,!0)}).bind(null,B):Cu),B!==be&&(be=B,te===we&&(we.env=Cf()),_e&&(X=we.env.Promise,z=B.env,(te.global||B.global)&&(Object.defineProperty(a,"Promise",z.PromiseProp),X.all=z.all,X.race=z.race,X.resolve=z.resolve,X.reject=z.reject,z.allSettled&&(X.allSettled=z.allSettled),z.any&&(X.any=z.any))))}function Cf(){var B=a.Promise;return _e?{Promise:B,PromiseProp:Object.getOwnPropertyDescriptor(a,"Promise"),all:B.all,race:B.race,allSettled:B.allSettled,any:B.any,resolve:B.resolve,reject:B.reject}:{}}function Ru(B,z,X,te,ae){var fe=be;try{return zl(B,!0),z(X,te,ae)}finally{zl(fe,!1)}}function ch(B,z,X,te){return typeof B!="function"?B:function(){var ae=be;X&&Lr(),zl(z,!0);try{return B.apply(this,arguments)}finally{zl(ae,!1),te&&queueMicrotask(Ua)}}}function fa(B){Promise===ht&&qi.echoes===0?fi===0?B():enqueueNativeMicroTask(B):setTimeout(B,0)}(""+Sc).indexOf("[native code]")===-1&&(Lr=Ua=oe);var Gr=Le.reject,zo="",pl="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Rf="String expected.",ql=[],Wl="__dbnames",ep="readonly",Yl="readwrite";function ma(B,z){return B?z?function(){return B.apply(this,arguments)&&z.apply(this,arguments)}:B:z}var fc={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function mc(B){return typeof B!="string"||/\./.test(B)?function(z){return z}:function(z){return z[B]===void 0&&B in z&&delete(z=R(z))[B],z}}function Mu(){throw J.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Qt(B,z){try{var X=Mr(B),te=Mr(z);if(X!==te)return X==="Array"?1:te==="Array"?-1:X==="binary"?1:te==="binary"?-1:X==="string"?1:te==="string"?-1:X==="Date"?1:te!=="Date"?NaN:-1;switch(X){case"number":case"Date":case"string":return z<B?1:B<z?-1:0;case"binary":return(function(ae,fe){for(var Ie=ae.length,Ue=fe.length,ke=Ie<Ue?Ie:Ue,$e=0;$e<ke;++$e)if(ae[$e]!==fe[$e])return ae[$e]<fe[$e]?-1:1;return Ie===Ue?0:Ie<Ue?-1:1})(hl(B),hl(z));case"Array":return(function(ae,fe){for(var Ie=ae.length,Ue=fe.length,ke=Ie<Ue?Ie:Ue,$e=0;$e<ke;++$e){var He=Qt(ae[$e],fe[$e]);if(He!==0)return He}return Ie===Ue?0:Ie<Ue?-1:1})(B,z)}}catch{}return NaN}function Mr(B){var z=typeof B;return z!="object"?z:ArrayBuffer.isView(B)?"binary":(B=A(B),B==="ArrayBuffer"?"binary":B)}function hl(B){return B instanceof Uint8Array?B:ArrayBuffer.isView(B)?new Uint8Array(B.buffer,B.byteOffset,B.byteLength):new Uint8Array(B)}function cs(B,z,X){var te=B.schema.yProps;return te?(z&&0<X.numFailures&&(z=z.filter(function(ae,fe){return!X.failures[fe]})),Promise.all(te.map(function(ae){return ae=ae.updatesTable,z?B.db.table(ae).where("k").anyOf(z).delete():B.db.table(ae).clear()})).then(function(){return X})):X}var io=(Rs.prototype.execute=function(B){var z=this["@@propmod"];if(z.add!==void 0){var X=z.add;if(o(X))return r(r([],o(B)?B:[],!0),X).sort();if(typeof X=="number")return(Number(B)||0)+X;if(typeof X=="bigint")try{return BigInt(B)+X}catch{return BigInt(0)+X}throw new TypeError("Invalid term ".concat(X))}if(z.remove!==void 0){var te=z.remove;if(o(te))return o(B)?B.filter(function(ae){return!te.includes(ae)}).sort():[];if(typeof te=="number")return Number(B)-te;if(typeof te=="bigint")try{return BigInt(B)-te}catch{return BigInt(0)-te}throw new TypeError("Invalid subtrahend ".concat(te))}return X=(X=z.replacePrefix)===null||X===void 0?void 0:X[0],X&&typeof B=="string"&&B.startsWith(X)?z.replacePrefix[1]+B.substring(X.length):B},Rs);function Rs(B){this["@@propmod"]=B}function Bi(B,z){for(var X=s(z),te=X.length,ae=!1,fe=0;fe<te;++fe){var Ie=X[fe],Ue=z[Ie],ke=w(B,Ie);Ue instanceof io?(T(B,Ie,Ue.execute(ke)),ae=!0):ke!==Ue&&(T(B,Ie,Ue),ae=!0)}return ae}var vr=(rr.prototype._trans=function(B,z,X){var te=this._tx||be.trans,ae=this.name,fe=Oe&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(B==="readonly"?"read":"write"," ").concat(this.name));function Ie($e,He,Re){if(!Re.schema[ae])throw new J.NotFound("Table "+ae+" not part of transaction");return z(Re.idbtrans,Re)}var Ue=Tt();try{var ke=te&&te.db._novip===this.db._novip?te===be.trans?te._promise(B,Ie,X):Qr(function(){return te._promise(B,Ie,X)},{trans:te,transless:be.transless||be}):(function $e(He,Re,qe,Be){if(He.idbdb&&(He._state.openComplete||be.letThrough||He._vip)){var Ve=He._createTransaction(Re,qe,He._dbSchema);try{Ve.create(),He._state.PR1398_maxLoop=3}catch(je){return je.name===K.InvalidState&&He.isOpen()&&0<--He._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),He.close({disableAutoOpen:!1}),He.open().then(function(){return $e(He,Re,qe,Be)})):Gr(je)}return Ve._promise(Re,function(je,Ge){return Qr(function(){return be.trans=Ve,Be(je,Ge,Ve)})}).then(function(je){if(Re==="readwrite")try{Ve.idbtrans.commit()}catch{}return Re==="readonly"?je:Ve._completion.then(function(){return je})})}if(He._state.openComplete)return Gr(new J.DatabaseClosed(He._state.dbOpenError));if(!He._state.isBeingOpened){if(!He._state.autoOpen)return Gr(new J.DatabaseClosed);He.open().catch(oe)}return He._state.dbReadyPromise.then(function(){return $e(He,Re,qe,Be)})})(this.db,B,[this.name],Ie);return fe&&(ke._consoleTask=fe,ke=ke.catch(function($e){return console.trace($e),Gr($e)})),ke}finally{Ue&&Li()}},rr.prototype.get=function(B,z){var X=this;return B&&B.constructor===Object?this.where(B).first(z):B==null?Gr(new J.Type("Invalid argument to Table.get()")):this._trans("readonly",function(te){return X.core.get({trans:te,key:B}).then(function(ae){return X.hook.reading.fire(ae)})}).then(z)},rr.prototype.where=function(B){if(typeof B=="string")return new this.db.WhereClause(this,B);if(o(B))return new this.db.WhereClause(this,"[".concat(B.join("+"),"]"));var z=s(B);if(z.length===1)return this.where(z[0]).equals(B[z[0]]);var X=this.schema.indexes.concat(this.schema.primKey).filter(function(Ue){if(Ue.compound&&z.every(function($e){return 0<=Ue.keyPath.indexOf($e)})){for(var ke=0;ke<z.length;++ke)if(z.indexOf(Ue.keyPath[ke])===-1)return!1;return!0}return!1}).sort(function(Ue,ke){return Ue.keyPath.length-ke.keyPath.length})[0];if(X&&this.db._maxKey!==zo){var fe=X.keyPath.slice(0,z.length);return this.where(fe).equals(fe.map(function(ke){return B[ke]}))}!X&&Oe&&console.warn("The query ".concat(JSON.stringify(B)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(z.join("+"),"]"));var te=this.schema.idxByName;function ae(Ue,ke){return Qt(Ue,ke)===0}var Ie=z.reduce(function(Re,ke){var $e=Re[0],He=Re[1],Re=te[ke],qe=B[ke];return[$e||Re,$e||!Re?ma(He,Re&&Re.multi?function(Be){return Be=w(Be,ke),o(Be)&&Be.some(function(Ve){return ae(qe,Ve)})}:function(Be){return ae(qe,w(Be,ke))}):He]},[null,null]),fe=Ie[0],Ie=Ie[1];return fe?this.where(fe.name).equals(B[fe.keyPath]).filter(Ie):X?this.filter(Ie):this.where(z).equals("")},rr.prototype.filter=function(B){return this.toCollection().and(B)},rr.prototype.count=function(B){return this.toCollection().count(B)},rr.prototype.offset=function(B){return this.toCollection().offset(B)},rr.prototype.limit=function(B){return this.toCollection().limit(B)},rr.prototype.each=function(B){return this.toCollection().each(B)},rr.prototype.toArray=function(B){return this.toCollection().toArray(B)},rr.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},rr.prototype.orderBy=function(B){return new this.db.Collection(new this.db.WhereClause(this,o(B)?"[".concat(B.join("+"),"]"):B))},rr.prototype.reverse=function(){return this.toCollection().reverse()},rr.prototype.mapToClass=function(B){var z,X=this.db,te=this.name;function ae(){return z!==null&&z.apply(this,arguments)||this}(this.schema.mappedClass=B).prototype instanceof Mu&&((function(ke,$e){if(typeof $e!="function"&&$e!==null)throw new TypeError("Class extends value "+String($e)+" is not a constructor or null");function He(){this.constructor=ke}i(ke,$e),ke.prototype=$e===null?Object.create($e):(He.prototype=$e.prototype,new He)})(ae,z=B),Object.defineProperty(ae.prototype,"db",{get:function(){return X},enumerable:!1,configurable:!0}),ae.prototype.table=function(){return te},B=ae);for(var fe=new Set,Ie=B.prototype;Ie;Ie=u(Ie))Object.getOwnPropertyNames(Ie).forEach(function(ke){return fe.add(ke)});function Ue(ke){if(!ke)return ke;var $e,He=Object.create(B.prototype);for($e in ke)if(!fe.has($e))try{He[$e]=ke[$e]}catch{}return He}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=Ue,this.hook("reading",Ue),B},rr.prototype.defineClass=function(){return this.mapToClass(function(B){l(this,B)})},rr.prototype.add=function(B,z){var X=this,te=this.schema.primKey,ae=te.auto,fe=te.keyPath,Ie=B;return fe&&ae&&(Ie=mc(fe)(B)),this._trans("readwrite",function(Ue){return X.core.mutate({trans:Ue,type:"add",keys:z!=null?[z]:null,values:[Ie]})}).then(function(Ue){return Ue.numFailures?Le.reject(Ue.failures[0]):Ue.lastResult}).then(function(Ue){if(fe)try{T(B,fe,Ue)}catch{}return Ue})},rr.prototype.upsert=function(B,z){var X=this,te=this.schema.primKey.keyPath;return this._trans("readwrite",function(ae){return X.core.get({trans:ae,key:B}).then(function(fe){var Ie=fe??{};return Bi(Ie,z),te&&T(Ie,te,B),X.core.mutate({trans:ae,type:"put",values:[Ie],keys:[B],upsert:!0,updates:{keys:[B],changeSpecs:[z]}}).then(function(Ue){return Ue.numFailures?Le.reject(Ue.failures[0]):!!fe})})})},rr.prototype.update=function(B,z){return typeof B!="object"||o(B)?this.where(":id").equals(B).modify(z):(B=w(B,this.schema.primKey.keyPath),B===void 0?Gr(new J.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(B).modify(z))},rr.prototype.put=function(B,z){var X=this,te=this.schema.primKey,ae=te.auto,fe=te.keyPath,Ie=B;return fe&&ae&&(Ie=mc(fe)(B)),this._trans("readwrite",function(Ue){return X.core.mutate({trans:Ue,type:"put",values:[Ie],keys:z!=null?[z]:null})}).then(function(Ue){return Ue.numFailures?Le.reject(Ue.failures[0]):Ue.lastResult}).then(function(Ue){if(fe)try{T(B,fe,Ue)}catch{}return Ue})},rr.prototype.delete=function(B){var z=this;return this._trans("readwrite",function(X){return z.core.mutate({trans:X,type:"delete",keys:[B]}).then(function(te){return cs(z,[B],te)}).then(function(te){return te.numFailures?Le.reject(te.failures[0]):void 0})})},rr.prototype.clear=function(){var B=this;return this._trans("readwrite",function(z){return B.core.mutate({trans:z,type:"deleteRange",range:fc}).then(function(X){return cs(B,null,X)})}).then(function(z){return z.numFailures?Le.reject(z.failures[0]):void 0})},rr.prototype.bulkGet=function(B){var z=this;return this._trans("readonly",function(X){return z.core.getMany({keys:B,trans:X}).then(function(te){return te.map(function(ae){return z.hook.reading.fire(ae)})})})},rr.prototype.bulkAdd=function(B,z,X){var te=this,ae=Array.isArray(z)?z:void 0,fe=(X=X||(ae?void 0:z))?X.allKeys:void 0;return this._trans("readwrite",function(Ie){var $e=te.schema.primKey,Ue=$e.auto,$e=$e.keyPath;if($e&&ae)throw new J.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(ae&&ae.length!==B.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var ke=B.length,$e=$e&&Ue?B.map(mc($e)):B;return te.core.mutate({trans:Ie,type:"add",keys:ae,values:$e,wantResults:fe}).then(function(Ve){var Re=Ve.numFailures,qe=Ve.results,Be=Ve.lastResult,Ve=Ve.failures;if(Re===0)return fe?qe:Be;throw new Z("".concat(te.name,".bulkAdd(): ").concat(Re," of ").concat(ke," operations failed"),Ve)})})},rr.prototype.bulkPut=function(B,z,X){var te=this,ae=Array.isArray(z)?z:void 0,fe=(X=X||(ae?void 0:z))?X.allKeys:void 0;return this._trans("readwrite",function(Ie){var $e=te.schema.primKey,Ue=$e.auto,$e=$e.keyPath;if($e&&ae)throw new J.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(ae&&ae.length!==B.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var ke=B.length,$e=$e&&Ue?B.map(mc($e)):B;return te.core.mutate({trans:Ie,type:"put",keys:ae,values:$e,wantResults:fe}).then(function(Ve){var Re=Ve.numFailures,qe=Ve.results,Be=Ve.lastResult,Ve=Ve.failures;if(Re===0)return fe?qe:Be;throw new Z("".concat(te.name,".bulkPut(): ").concat(Re," of ").concat(ke," operations failed"),Ve)})})},rr.prototype.bulkUpdate=function(B){var z=this,X=this.core,te=B.map(function(Ie){return Ie.key}),ae=B.map(function(Ie){return Ie.changes}),fe=[];return this._trans("readwrite",function(Ie){return X.getMany({trans:Ie,keys:te,cache:"clone"}).then(function(Ue){var ke=[],$e=[];B.forEach(function(Re,qe){var Be=Re.key,Ve=Re.changes,je=Ue[qe];if(je){for(var Ge=0,Ke=Object.keys(Ve);Ge<Ke.length;Ge++){var et=Ke[Ge],dt=Ve[et];if(et===z.schema.primKey.keyPath){if(Qt(dt,Be)!==0)throw new J.Constraint("Cannot update primary key in bulkUpdate()")}else T(je,et,dt)}fe.push(qe),ke.push(Be),$e.push(je)}});var He=ke.length;return X.mutate({trans:Ie,type:"put",keys:ke,values:$e,updates:{keys:te,changeSpecs:ae}}).then(function(Re){var qe=Re.numFailures,Be=Re.failures;if(qe===0)return He;for(var Ve=0,je=Object.keys(Be);Ve<je.length;Ve++){var Ge,Ke=je[Ve],et=fe[Number(Ke)];et!=null&&(Ge=Be[Ke],delete Be[Ke],Be[et]=Ge)}throw new Z("".concat(z.name,".bulkUpdate(): ").concat(qe," of ").concat(He," operations failed"),Be)})})})},rr.prototype.bulkDelete=function(B){var z=this,X=B.length;return this._trans("readwrite",function(te){return z.core.mutate({trans:te,type:"delete",keys:B}).then(function(ae){return cs(z,B,ae)})}).then(function(Ie){var ae=Ie.numFailures,fe=Ie.lastResult,Ie=Ie.failures;if(ae===0)return fe;throw new Z("".concat(z.name,".bulkDelete(): ").concat(ae," of ").concat(X," operations failed"),Ie)})},rr);function rr(){}function Kl(B){function z(Ie,Ue){if(Ue){for(var ke=arguments.length,$e=new Array(ke-1);--ke;)$e[ke-1]=arguments[ke];return X[Ie].subscribe.apply(null,$e),B}if(typeof Ie=="string")return X[Ie]}var X={};z.addEventType=fe;for(var te=1,ae=arguments.length;te<ae;++te)fe(arguments[te]);return z;function fe(Ie,Ue,ke){if(typeof Ie!="object"){var $e;Ue=Ue||xe;var He={subscribers:[],fire:ke=ke||oe,subscribe:function(Re){He.subscribers.indexOf(Re)===-1&&(He.subscribers.push(Re),He.fire=Ue(He.fire,Re))},unsubscribe:function(Re){He.subscribers=He.subscribers.filter(function(qe){return qe!==Re}),He.fire=He.subscribers.reduce(Ue,ke)}};return X[Ie]=z[Ie]=He}s($e=Ie).forEach(function(Re){var qe=$e[Re];if(o(qe))fe(Re,$e[Re][0],$e[Re][1]);else{if(qe!=="asap")throw new J.InvalidArgument("Invalid event config");var Be=fe(Re,de,function(){for(var Ve=arguments.length,je=new Array(Ve);Ve--;)je[Ve]=arguments[Ve];Be.subscribers.forEach(function(Ge){S(function(){Ge.apply(null,je)})})})}})}}function es(B,z){return m(z).from({prototype:B}),z}function Id(B,z){return!(B.filter||B.algorithm||B.or)&&(z?B.justLimit:!B.replayFilter)}function st(B,z){B.filter=ma(B.filter,z)}function mi(B,z,X){var te=B.replayFilter;B.replayFilter=te?function(){return ma(te(),z())}:z,B.justLimit=X&&!te}function xi(B,z){if(B.isPrimKey)return z.primaryKey;var X=z.getIndexByKeyPath(B.index);if(!X)throw new J.Schema("KeyPath "+B.index+" on object store "+z.name+" is not indexed");return X}function Oi(B,z,X){var te=xi(B,z.schema);return z.openCursor({trans:X,values:!B.keysOnly,reverse:B.dir==="prev",unique:!!B.unique,query:{index:te,range:B.range}})}function yr(B,z,X,te){var ae=B.replayFilter?ma(B.filter,B.replayFilter()):B.filter;if(B.or){var fe={},Ie=function(Ue,ke,$e){var He,Re;ae&&!ae(ke,$e,function(qe){return ke.stop(qe)},function(qe){return ke.fail(qe)})||((Re=""+(He=ke.primaryKey))=="[object ArrayBuffer]"&&(Re=""+new Uint8Array(He)),d(fe,Re)||(fe[Re]=!0,z(Ue,ke,$e)))};return Promise.all([B.or._iterate(Ie,X),Oa(Oi(B,te,X),B.algorithm,Ie,!B.keysOnly&&B.valueMapper)])}return Oa(Oi(B,te,X),ma(B.algorithm,ae),z,!B.keysOnly&&B.valueMapper)}function Oa(B,z,X,te){var ae=Ri(te?function(fe,Ie,Ue){return X(te(fe),Ie,Ue)}:X);return B.then(function(fe){if(fe)return fe.start(function(){var Ie=function(){return fe.continue()};z&&!z(fe,function(Ue){return Ie=Ue},function(Ue){fe.stop(Ue),Ie=oe},function(Ue){fe.fail(Ue),Ie=oe})||ae(fe.value,fe,function(Ue){return Ie=Ue}),Ie()})})}var Nu=(Pn.prototype._read=function(B,z){var X=this._ctx;return X.error?X.table._trans(null,Gr.bind(null,X.error)):X.table._trans("readonly",B).then(z)},Pn.prototype._write=function(B){var z=this._ctx;return z.error?z.table._trans(null,Gr.bind(null,z.error)):z.table._trans("readwrite",B,"locked")},Pn.prototype._addAlgorithm=function(B){var z=this._ctx;z.algorithm=ma(z.algorithm,B)},Pn.prototype._iterate=function(B,z){return yr(this._ctx,B,z,this._ctx.table.core)},Pn.prototype.clone=function(B){var z=Object.create(this.constructor.prototype),X=Object.create(this._ctx);return B&&l(X,B),z._ctx=X,z},Pn.prototype.raw=function(){return this._ctx.valueMapper=null,this},Pn.prototype.each=function(B){var z=this._ctx;return this._read(function(X){return yr(z,B,X,z.table.core)})},Pn.prototype.count=function(B){var z=this;return this._read(function(X){var te=z._ctx,ae=te.table.core;if(Id(te,!0))return ae.count({trans:X,query:{index:xi(te,ae.schema),range:te.range}}).then(function(Ie){return Math.min(Ie,te.limit)});var fe=0;return yr(te,function(){return++fe,!1},X,ae).then(function(){return fe})}).then(B)},Pn.prototype.sortBy=function(B,z){var X=B.split(".").reverse(),te=X[0],ae=X.length-1;function fe(ke,$e){return $e?fe(ke[X[$e]],$e-1):ke[te]}var Ie=this._ctx.dir==="next"?1:-1;function Ue(ke,$e){return Qt(fe(ke,ae),fe($e,ae))*Ie}return this.toArray(function(ke){return ke.sort(Ue)}).then(z)},Pn.prototype.toArray=function(B){var z=this;return this._read(function(X){var te=z._ctx;if(te.dir==="next"&&Id(te,!0)&&0<te.limit){var ae=te.valueMapper,fe=xi(te,te.table.core.schema);return te.table.core.query({trans:X,limit:te.limit,values:!0,query:{index:fe,range:te.range}}).then(function(Ue){return Ue=Ue.result,ae?Ue.map(ae):Ue})}var Ie=[];return yr(te,function(Ue){return Ie.push(Ue)},X,te.table.core).then(function(){return Ie})},B)},Pn.prototype.offset=function(B){var z=this._ctx;return B<=0||(z.offset+=B,Id(z)?mi(z,function(){var X=B;return function(te,ae){return X===0||(X===1?--X:ae(function(){te.advance(X),X=0}),!1)}}):mi(z,function(){var X=B;return function(){return--X<0}})),this},Pn.prototype.limit=function(B){return this._ctx.limit=Math.min(this._ctx.limit,B),mi(this._ctx,function(){var z=B;return function(X,te,ae){return--z<=0&&te(ae),0<=z}},!0),this},Pn.prototype.until=function(B,z){return st(this._ctx,function(X,te,ae){return!B(X.value)||(te(ae),z)}),this},Pn.prototype.first=function(B){return this.limit(1).toArray(function(z){return z[0]}).then(B)},Pn.prototype.last=function(B){return this.reverse().first(B)},Pn.prototype.filter=function(B){var z;return st(this._ctx,function(X){return B(X.value)}),(z=this._ctx).isMatch=ma(z.isMatch,B),this},Pn.prototype.and=function(B){return this.filter(B)},Pn.prototype.or=function(B){return new this.db.WhereClause(this._ctx.table,B,this)},Pn.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Pn.prototype.desc=function(){return this.reverse()},Pn.prototype.eachKey=function(B){var z=this._ctx;return z.keysOnly=!z.isMatch,this.each(function(X,te){B(te.key,te)})},Pn.prototype.eachUniqueKey=function(B){return this._ctx.unique="unique",this.eachKey(B)},Pn.prototype.eachPrimaryKey=function(B){var z=this._ctx;return z.keysOnly=!z.isMatch,this.each(function(X,te){B(te.primaryKey,te)})},Pn.prototype.keys=function(B){var z=this._ctx;z.keysOnly=!z.isMatch;var X=[];return this.each(function(te,ae){X.push(ae.key)}).then(function(){return X}).then(B)},Pn.prototype.primaryKeys=function(B){var z=this._ctx;if(z.dir==="next"&&Id(z,!0)&&0<z.limit)return this._read(function(te){var ae=xi(z,z.table.core.schema);return z.table.core.query({trans:te,values:!1,limit:z.limit,query:{index:ae,range:z.range}})}).then(function(te){return te.result}).then(B);z.keysOnly=!z.isMatch;var X=[];return this.each(function(te,ae){X.push(ae.primaryKey)}).then(function(){return X}).then(B)},Pn.prototype.uniqueKeys=function(B){return this._ctx.unique="unique",this.keys(B)},Pn.prototype.firstKey=function(B){return this.limit(1).keys(function(z){return z[0]}).then(B)},Pn.prototype.lastKey=function(B){return this.reverse().firstKey(B)},Pn.prototype.distinct=function(){var B=this._ctx,B=B.index&&B.table.schema.idxByName[B.index];if(!B||!B.multi)return this;var z={};return st(this._ctx,function(ae){var te=ae.primaryKey.toString(),ae=d(z,te);return z[te]=!0,!ae}),this},Pn.prototype.modify=function(B){var z=this,X=this._ctx;return this._write(function(te){var ae=typeof B=="function"?B:function(je){return Bi(je,B)},fe=X.table.core,$e=fe.schema.primaryKey,Ie=$e.outbound,Ue=$e.extractKey,ke=200,$e=z.db._options.modifyChunkSize;$e&&(ke=typeof $e=="object"?$e[fe.name]||$e["*"]||200:$e);function He(je,et){var Ke=et.failures,et=et.numFailures;qe+=je-et;for(var dt=0,yt=s(Ke);dt<yt.length;dt++){var xt=yt[dt];Re.push(Ke[xt])}}var Re=[],qe=0,Be=[],Ve=B===fl;return z.clone().primaryKeys().then(function(je){function Ge(et){var dt=Math.min(ke,je.length-et),yt=je.slice(et,et+dt);return(Ve?Promise.resolve([]):fe.getMany({trans:te,keys:yt,cache:"immutable"})).then(function(xt){var jt=[],Pt=[],Ft=Ie?[]:null,$t=Ve?yt:[];if(!Ve)for(var Bt=0;Bt<dt;++Bt){var ii=xt[Bt],In={value:R(ii),primKey:je[et+Bt]};ae.call(In,In.value,In)!==!1&&(In.value==null?$t.push(je[et+Bt]):Ie||Qt(Ue(ii),Ue(In.value))===0?(Pt.push(In.value),Ie&&Ft.push(je[et+Bt])):($t.push(je[et+Bt]),jt.push(In.value)))}return Promise.resolve(0<jt.length&&fe.mutate({trans:te,type:"add",values:jt}).then(function(Ji){for(var An in Ji.failures)$t.splice(parseInt(An),1);He(jt.length,Ji)})).then(function(){return(0<Pt.length||Ke&&typeof B=="object")&&fe.mutate({trans:te,type:"put",keys:Ft,values:Pt,criteria:Ke,changeSpec:typeof B!="function"&&B,isAdditionalChunk:0<et}).then(function(Ji){return He(Pt.length,Ji)})}).then(function(){return(0<$t.length||Ke&&Ve)&&fe.mutate({trans:te,type:"delete",keys:$t,criteria:Ke,isAdditionalChunk:0<et}).then(function(Ji){return cs(X.table,$t,Ji)}).then(function(Ji){return He($t.length,Ji)})}).then(function(){return je.length>et+dt&&Ge(et+ke)})})}var Ke=Id(X)&&X.limit===1/0&&(typeof B!="function"||Ve)&&{index:X.index,range:X.range};return Ge(0).then(function(){if(0<Re.length)throw new q("Error modifying one or more objects",Re,qe,Be);return je.length})})})},Pn.prototype.delete=function(){var B=this._ctx,z=B.range;return!Id(B)||B.table.schema.yProps||!B.isPrimKey&&z.type!==3?this.modify(fl):this._write(function(X){var te=B.table.core.schema.primaryKey,ae=z;return B.table.core.count({trans:X,query:{index:te,range:ae}}).then(function(fe){return B.table.core.mutate({trans:X,type:"deleteRange",range:ae}).then(function(ke){var Ue=ke.failures,ke=ke.numFailures;if(ke)throw new q("Could not delete some values",Object.keys(Ue).map(function($e){return Ue[$e]}),fe-ke);return fe-ke})})})},Pn);function Pn(){}var fl=function(B,z){return z.value=null};function cg(B,z){return B<z?-1:B===z?0:1}function Mf(B,z){return z<B?-1:B===z?0:1}function Ws(B,z,X){return B=B instanceof dg?new B.Collection(B):B,B._ctx.error=new(X||TypeError)(z),B}function gc(B){return new B.Collection(B,function(){return dh("")}).limit(0)}function vc(B,z,X,te){var ae,fe,Ie,Ue,ke,$e,He,Re=X.length;if(!X.every(function(Ve){return typeof Ve=="string"}))return Ws(B,Rf);function qe(Ve){ae=Ve==="next"?function(Ge){return Ge.toUpperCase()}:function(Ge){return Ge.toLowerCase()},fe=Ve==="next"?function(Ge){return Ge.toLowerCase()}:function(Ge){return Ge.toUpperCase()},Ie=Ve==="next"?cg:Mf;var je=X.map(function(Ge){return{lower:fe(Ge),upper:ae(Ge)}}).sort(function(Ge,Ke){return Ie(Ge.lower,Ke.lower)});Ue=je.map(function(Ge){return Ge.upper}),ke=je.map(function(Ge){return Ge.lower}),He=($e=Ve)==="next"?"":te}qe("next"),B=new B.Collection(B,function(){return ga(Ue[0],ke[Re-1]+te)}),B._ondirectionchange=function(Ve){qe(Ve)};var Be=0;return B._addAlgorithm(function(Ve,je,Ge){var Ke=Ve.key;if(typeof Ke!="string")return!1;var et=fe(Ke);if(z(et,ke,Be))return!0;for(var dt=null,yt=Be;yt<Re;++yt){var xt=(function(jt,Pt,Ft,$t,Bt,ii){for(var In=Math.min(jt.length,$t.length),Ji=-1,An=0;An<In;++An){var Jl=Pt[An];if(Jl!==$t[An])return Bt(jt[An],Ft[An])<0?jt.substr(0,An)+Ft[An]+Ft.substr(An+1):Bt(jt[An],$t[An])<0?jt.substr(0,An)+$t[An]+Ft.substr(An+1):0<=Ji?jt.substr(0,Ji)+Pt[Ji]+Ft.substr(Ji+1):null;Bt(jt[An],Jl)<0&&(Ji=An)}return In<$t.length&&ii==="next"?jt+Ft.substr(jt.length):In<jt.length&&ii==="prev"?jt.substr(0,Ft.length):Ji<0?null:jt.substr(0,Ji)+$t[Ji]+Ft.substr(Ji+1)})(Ke,et,Ue[yt],ke[yt],Ie,$e);xt===null&&dt===null?Be=yt+1:(dt===null||0<Ie(dt,xt))&&(dt=xt)}return je(dt!==null?function(){Ve.continue(dt+He)}:Ge),!1}),B}function ga(B,z,X,te){return{type:2,lower:B,upper:z,lowerOpen:X,upperOpen:te}}function dh(B){return{type:1,lower:B,upper:B}}var dg=(Object.defineProperty(oi.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),oi.prototype.between=function(B,z,X,te){X=X!==!1,te=te===!0;try{return 0<this._cmp(B,z)||this._cmp(B,z)===0&&(X||te)&&(!X||!te)?gc(this):new this.Collection(this,function(){return ga(B,z,!X,!te)})}catch{return Ws(this,pl)}},oi.prototype.equals=function(B){return B==null?Ws(this,pl):new this.Collection(this,function(){return dh(B)})},oi.prototype.above=function(B){return B==null?Ws(this,pl):new this.Collection(this,function(){return ga(B,void 0,!0)})},oi.prototype.aboveOrEqual=function(B){return B==null?Ws(this,pl):new this.Collection(this,function(){return ga(B,void 0,!1)})},oi.prototype.below=function(B){return B==null?Ws(this,pl):new this.Collection(this,function(){return ga(void 0,B,!1,!0)})},oi.prototype.belowOrEqual=function(B){return B==null?Ws(this,pl):new this.Collection(this,function(){return ga(void 0,B)})},oi.prototype.startsWith=function(B){return typeof B!="string"?Ws(this,Rf):this.between(B,B+zo,!0,!0)},oi.prototype.startsWithIgnoreCase=function(B){return B===""?this.startsWith(B):vc(this,function(z,X){return z.indexOf(X[0])===0},[B],zo)},oi.prototype.equalsIgnoreCase=function(B){return vc(this,function(z,X){return z===X[0]},[B],"")},oi.prototype.anyOfIgnoreCase=function(){var B=F.apply($,arguments);return B.length===0?gc(this):vc(this,function(z,X){return X.indexOf(z)!==-1},B,"")},oi.prototype.startsWithAnyOfIgnoreCase=function(){var B=F.apply($,arguments);return B.length===0?gc(this):vc(this,function(z,X){return X.some(function(te){return z.indexOf(te)===0})},B,zo)},oi.prototype.anyOf=function(){var B=this,z=F.apply($,arguments),X=this._cmp;try{z.sort(X)}catch{return Ws(this,pl)}if(z.length===0)return gc(this);var te=new this.Collection(this,function(){return ga(z[0],z[z.length-1])});te._ondirectionchange=function(fe){X=fe==="next"?B._ascending:B._descending,z.sort(X)};var ae=0;return te._addAlgorithm(function(fe,Ie,Ue){for(var ke=fe.key;0<X(ke,z[ae]);)if(++ae===z.length)return Ie(Ue),!1;return X(ke,z[ae])===0||(Ie(function(){fe.continue(z[ae])}),!1)}),te},oi.prototype.notEqual=function(B){return this.inAnyRange([[-1/0,B],[B,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},oi.prototype.noneOf=function(){var B=F.apply($,arguments);if(B.length===0)return new this.Collection(this);try{B.sort(this._ascending)}catch{return Ws(this,pl)}var z=B.reduce(function(X,te){return X?X.concat([[X[X.length-1][1],te]]):[[-1/0,te]]},null);return z.push([B[B.length-1],this.db._maxKey]),this.inAnyRange(z,{includeLowers:!1,includeUppers:!1})},oi.prototype.inAnyRange=function(Ke,z){var X=this,te=this._cmp,ae=this._ascending,fe=this._descending,Ie=this._min,Ue=this._max;if(Ke.length===0)return gc(this);if(!Ke.every(function(et){return et[0]!==void 0&&et[1]!==void 0&&ae(et[0],et[1])<=0}))return Ws(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",J.InvalidArgument);var ke=!z||z.includeLowers!==!1,$e=z&&z.includeUppers===!0,He,Re=ae;function qe(et,dt){return Re(et[0],dt[0])}try{(He=Ke.reduce(function(et,dt){for(var yt=0,xt=et.length;yt<xt;++yt){var jt=et[yt];if(te(dt[0],jt[1])<0&&0<te(dt[1],jt[0])){jt[0]=Ie(jt[0],dt[0]),jt[1]=Ue(jt[1],dt[1]);break}}return yt===xt&&et.push(dt),et},[])).sort(qe)}catch{return Ws(this,pl)}var Be=0,Ve=$e?function(et){return 0<ae(et,He[Be][1])}:function(et){return 0<=ae(et,He[Be][1])},je=ke?function(et){return 0<fe(et,He[Be][0])}:function(et){return 0<=fe(et,He[Be][0])},Ge=Ve,Ke=new this.Collection(this,function(){return ga(He[0][0],He[He.length-1][1],!ke,!$e)});return Ke._ondirectionchange=function(et){Re=et==="next"?(Ge=Ve,ae):(Ge=je,fe),He.sort(qe)},Ke._addAlgorithm(function(et,dt,yt){for(var xt,jt=et.key;Ge(jt);)if(++Be===He.length)return dt(yt),!1;return!Ve(xt=jt)&&!je(xt)||(X._cmp(jt,He[Be][1])===0||X._cmp(jt,He[Be][0])===0||dt(function(){Re===ae?et.continue(He[Be][0]):et.continue(He[Be][1])}),!1)}),Ke},oi.prototype.startsWithAnyOf=function(){var B=F.apply($,arguments);return B.every(function(z){return typeof z=="string"})?B.length===0?gc(this):this.inAnyRange(B.map(function(z){return[z,z+zo]})):Ws(this,"startsWithAnyOf() only works with strings")},oi);function oi(){}function va(B){return Ri(function(z){return jn(z),B(z.target.error),!1})}function jn(B){B.stopPropagation&&B.stopPropagation(),B.preventDefault&&B.preventDefault()}var tp="storagemutated",ip="x-storagemutated-1",qo=Kl(null,tp),Nf=(Hr.prototype._lock=function(){return I(!be.global),++this._reculock,this._reculock!==1||be.global||(be.lockOwnerFor=this),this},Hr.prototype._unlock=function(){if(I(!be.global),--this._reculock==0)for(be.global||(be.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var B=this._blockedFuncs.shift();try{Ru(B[1],B[0])}catch{}}return this},Hr.prototype._locked=function(){return this._reculock&&be.lockOwnerFor!==this},Hr.prototype.create=function(B){var z=this;if(!this.mode)return this;var X=this.db.idbdb,te=this.db._state.dbOpenError;if(I(!this.idbtrans),!B&&!X)switch(te&&te.name){case"DatabaseClosedError":throw new J.DatabaseClosed(te);case"MissingAPIError":throw new J.MissingAPI(te.message,te);default:throw new J.OpenFailed(te)}if(!this.active)throw new J.TransactionInactive;return I(this._completion._state===null),(B=this.idbtrans=B||(this.db.core||X).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ri(function(ae){jn(ae),z._reject(B.error)}),B.onabort=Ri(function(ae){jn(ae),z.active&&z._reject(new J.Abort(B.error)),z.active=!1,z.on("abort").fire(ae)}),B.oncomplete=Ri(function(){z.active=!1,z._resolve(),"mutatedParts"in B&&qo.storagemutated.fire(B.mutatedParts)}),this},Hr.prototype._promise=function(B,z,X){var te=this;if(B==="readwrite"&&this.mode!=="readwrite")return Gr(new J.ReadOnly("Transaction is readonly"));if(!this.active)return Gr(new J.TransactionInactive);if(this._locked())return new Le(function(fe,Ie){te._blockedFuncs.push([function(){te._promise(B,z,X).then(fe,Ie)},be])});if(X)return Qr(function(){var fe=new Le(function(Ie,Ue){te._lock();var ke=z(Ie,Ue,te);ke&&ke.then&&ke.then(Ie,Ue)});return fe.finally(function(){return te._unlock()}),fe._lib=!0,fe});var ae=new Le(function(fe,Ie){var Ue=z(fe,Ie,te);Ue&&Ue.then&&Ue.then(fe,Ie)});return ae._lib=!0,ae},Hr.prototype._root=function(){return this.parent?this.parent._root():this},Hr.prototype.waitFor=function(B){var z,X=this._root(),te=Le.resolve(B);X._waitingFor?X._waitingFor=X._waitingFor.then(function(){return te}):(X._waitingFor=te,X._waitingQueue=[],z=X.idbtrans.objectStore(X.storeNames[0]),(function fe(){for(++X._spinCount;X._waitingQueue.length;)X._waitingQueue.shift()();X._waitingFor&&(z.get(-1/0).onsuccess=fe)})());var ae=X._waitingFor;return new Le(function(fe,Ie){te.then(function(Ue){return X._waitingQueue.push(Ri(fe.bind(null,Ue)))},function(Ue){return X._waitingQueue.push(Ri(Ie.bind(null,Ue)))}).finally(function(){X._waitingFor===ae&&(X._waitingFor=null)})})},Hr.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new J.Abort))},Hr.prototype.table=function(B){var z=this._memoizedTables||(this._memoizedTables={});if(d(z,B))return z[B];var X=this.schema[B];if(!X)throw new J.NotFound("Table "+B+" not part of transaction");return X=new this.db.Table(B,X,this),X.core=this.db.core.table(B),z[B]=X},Hr);function Hr(){}function np(B,z,X,te,ae,fe,Ie,Ue){return{name:B,keyPath:z,unique:X,multi:te,auto:ae,compound:fe,src:(X&&!Ie?"&":"")+(te?"*":"")+(ae?"++":"")+yc(z),type:Ue}}function yc(B){return typeof B=="string"?B:B?"["+[].join.call(B,"+")+"]":""}function La(B,z,X){return{name:B,primKey:z,indexes:X,mappedClass:null,idxByName:(te=function(ae){return[ae.name,ae]},X.reduce(function(ae,fe,Ie){return Ie=te(fe,Ie),Ie&&(ae[Ie[0]]=Ie[1]),ae},{}))};var te}var ml=function(B){try{return B.only([[]]),ml=function(){return[[]]},[[]]}catch{return ml=function(){return zo},zo}};function ee(B){return B==null?function(){}:typeof B=="string"?(z=B).split(".").length===1?function(X){return X[z]}:function(X){return w(X,z)}:function(X){return w(X,B)};var z}function ve(B){return[].slice.call(B)}var Ne=0;function ut(B){return B==null?":id":typeof B=="string"?B:"[".concat(B.join("+"),"]")}function en(B,z,ke){function te(Ge){if(Ge.type===3)return null;if(Ge.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var Be=Ge.lower,Ve=Ge.upper,je=Ge.lowerOpen,Ge=Ge.upperOpen;return Be===void 0?Ve===void 0?null:z.upperBound(Ve,!!Ge):Ve===void 0?z.lowerBound(Be,!!je):z.bound(Be,Ve,!!je,!!Ge)}function ae(qe){var Be,Ve=qe.name;return{name:Ve,schema:qe,mutate:function(je){var Ge=je.trans,Ke=je.type,et=je.keys,dt=je.values,yt=je.range;return new Promise(function(xt,jt){xt=Ri(xt);var Pt=Ge.objectStore(Ve),Ft=Pt.keyPath==null,$t=Ke==="put"||Ke==="add";if(!$t&&Ke!=="delete"&&Ke!=="deleteRange")throw new Error("Invalid operation type: "+Ke);var Bt,ii=(et||dt||{length:1}).length;if(et&&dt&&et.length!==dt.length)throw new Error("Given keys array must have same length as given values array.");if(ii===0)return xt({numFailures:0,failures:{},results:[],lastResult:void 0});function In(Ko){++Jl,jn(Ko)}var Ji=[],An=[],Jl=0;if(Ke==="deleteRange"){if(yt.type===4)return xt({numFailures:Jl,failures:An,results:[],lastResult:void 0});yt.type===3?Ji.push(Bt=Pt.clear()):Ji.push(Bt=Pt.delete(te(yt)))}else{var Ft=$t?Ft?[dt,et]:[dt,null]:[et,null],tn=Ft[0],Yo=Ft[1];if($t)for(var Ys=0;Ys<ii;++Ys)Ji.push(Bt=Yo&&Yo[Ys]!==void 0?Pt[Ke](tn[Ys],Yo[Ys]):Pt[Ke](tn[Ys])),Bt.onerror=In;else for(Ys=0;Ys<ii;++Ys)Ji.push(Bt=Pt[Ke](tn[Ys])),Bt.onerror=In}function kf(Ko){Ko=Ko.target.result,Ji.forEach(function(xf,wE){return xf.error!=null&&(An[wE]=xf.error)}),xt({numFailures:Jl,failures:An,results:Ke==="delete"?et:Ji.map(function(xf){return xf.result}),lastResult:Ko})}Bt.onerror=function(Ko){In(Ko),kf(Ko)},Bt.onsuccess=kf})},getMany:function(je){var Ge=je.trans,Ke=je.keys;return new Promise(function(et,dt){et=Ri(et);for(var yt,xt=Ge.objectStore(Ve),jt=Ke.length,Pt=new Array(jt),Ft=0,$t=0,Bt=function(Ji){Ji=Ji.target,Pt[Ji._pos]=Ji.result,++$t===Ft&&et(Pt)},ii=va(dt),In=0;In<jt;++In)Ke[In]!=null&&((yt=xt.get(Ke[In]))._pos=In,yt.onsuccess=Bt,yt.onerror=ii,++Ft);Ft===0&&et(Pt)})},get:function(je){var Ge=je.trans,Ke=je.key;return new Promise(function(et,dt){et=Ri(et);var yt=Ge.objectStore(Ve).get(Ke);yt.onsuccess=function(xt){return et(xt.target.result)},yt.onerror=va(dt)})},query:(Be=$e,function(je){return new Promise(function(Ge,Ke){Ge=Ri(Ge);var et,dt,yt,Ft=je.trans,xt=je.values,jt=je.limit,Bt=je.query,Pt=jt===1/0?void 0:jt,$t=Bt.index,Bt=Bt.range,Ft=Ft.objectStore(Ve),$t=$t.isPrimaryKey?Ft:Ft.index($t.name),Bt=te(Bt);if(jt===0)return Ge({result:[]});Be?((Pt=xt?$t.getAll(Bt,Pt):$t.getAllKeys(Bt,Pt)).onsuccess=function(ii){return Ge({result:ii.target.result})},Pt.onerror=va(Ke)):(et=0,dt=!xt&&"openKeyCursor"in $t?$t.openKeyCursor(Bt):$t.openCursor(Bt),yt=[],dt.onsuccess=function(ii){var In=dt.result;return In?(yt.push(xt?In.value:In.primaryKey),++et===jt?Ge({result:yt}):void In.continue()):Ge({result:yt})},dt.onerror=va(Ke))})}),openCursor:function(je){var Ge=je.trans,Ke=je.values,et=je.query,dt=je.reverse,yt=je.unique;return new Promise(function(xt,jt){xt=Ri(xt);var $t=et.index,Pt=et.range,Ft=Ge.objectStore(Ve),Ft=$t.isPrimaryKey?Ft:Ft.index($t.name),$t=dt?yt?"prevunique":"prev":yt?"nextunique":"next",Bt=!Ke&&"openKeyCursor"in Ft?Ft.openKeyCursor(te(Pt),$t):Ft.openCursor(te(Pt),$t);Bt.onerror=va(jt),Bt.onsuccess=Ri(function(ii){var In,Ji,An,Jl,tn=Bt.result;tn?(tn.___id=++Ne,tn.done=!1,In=tn.continue.bind(tn),Ji=(Ji=tn.continuePrimaryKey)&&Ji.bind(tn),An=tn.advance.bind(tn),Jl=function(){throw new Error("Cursor not stopped")},tn.trans=Ge,tn.stop=tn.continue=tn.continuePrimaryKey=tn.advance=function(){throw new Error("Cursor not started")},tn.fail=Ri(jt),tn.next=function(){var Yo=this,Ys=1;return this.start(function(){return Ys--?Yo.continue():Yo.stop()}).then(function(){return Yo})},tn.start=function(Yo){function Ys(){if(Bt.result)try{Yo()}catch(Ko){tn.fail(Ko)}else tn.done=!0,tn.start=function(){throw new Error("Cursor behind last entry")},tn.stop()}var kf=new Promise(function(Ko,xf){Ko=Ri(Ko),Bt.onerror=va(xf),tn.fail=xf,tn.stop=function(wE){tn.stop=tn.continue=tn.continuePrimaryKey=tn.advance=Jl,Ko(wE)}});return Bt.onsuccess=Ri(function(Ko){Bt.onsuccess=Ys,Ys()}),tn.continue=In,tn.continuePrimaryKey=Ji,tn.advance=An,Ys(),kf},xt(tn)):xt(null)},jt)})},count:function(je){var Ge=je.query,Ke=je.trans,et=Ge.index,dt=Ge.range;return new Promise(function(yt,xt){var jt=Ke.objectStore(Ve),Pt=et.isPrimaryKey?jt:jt.index(et.name),jt=te(dt),Pt=jt?Pt.count(jt):Pt.count();Pt.onsuccess=Ri(function(Ft){return yt(Ft.target.result)}),Pt.onerror=va(xt)})}}}var fe,Ie,Ue,He=(Ie=ke,Ue=ve((fe=B).objectStoreNames),{schema:{name:fe.name,tables:Ue.map(function(qe){return Ie.objectStore(qe)}).map(function(qe){var Be=qe.keyPath,Ge=qe.autoIncrement,Ve=o(Be),je={},Ge={name:qe.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:Be==null,compound:Ve,keyPath:Be,autoIncrement:Ge,unique:!0,extractKey:ee(Be)},indexes:ve(qe.indexNames).map(function(Ke){return qe.index(Ke)}).map(function(yt){var et=yt.name,dt=yt.unique,xt=yt.multiEntry,yt=yt.keyPath,xt={name:et,compound:o(yt),keyPath:yt,unique:dt,multiEntry:xt,extractKey:ee(yt)};return je[ut(yt)]=xt}),getIndexByKeyPath:function(Ke){return je[ut(Ke)]}};return je[":id"]=Ge.primaryKey,Be!=null&&(je[ut(Be)]=Ge.primaryKey),Ge})},hasGetAll:0<Ue.length&&"getAll"in Ie.objectStore(Ue[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),ke=He.schema,$e=He.hasGetAll,He=ke.tables.map(ae),Re={};return He.forEach(function(qe){return Re[qe.name]=qe}),{stack:"dbcore",transaction:B.transaction.bind(B),table:function(qe){if(!Re[qe])throw new Error("Table '".concat(qe,"' not found"));return Re[qe]},MIN_KEY:-1/0,MAX_KEY:ml(z),schema:ke}}function Di(B,z,X,te){var ae=X.IDBKeyRange;return X.indexedDB,{dbcore:(te=en(z,ae,te),B.dbcore.reduce(function(fe,Ie){return Ie=Ie.create,n(n({},fe),Ie(fe))},te))}}function $n(B,te){var X=te.db,te=Di(B._middlewares,X,B._deps,te);B.core=te.dbcore,B.tables.forEach(function(ae){var fe=ae.name;B.core.schema.tables.some(function(Ie){return Ie.name===fe})&&(ae.core=B.core.table(fe),B[fe]instanceof B.Table&&(B[fe].core=ae.core))})}function ei(B,z,X,te){X.forEach(function(ae){var fe=te[ae];z.forEach(function(Ie){var Ue=(function ke($e,He){return g($e,He)||($e=u($e))&&ke($e,He)})(Ie,ae);(!Ue||"value"in Ue&&Ue.value===void 0)&&(Ie===B.Transaction.prototype||Ie instanceof B.Transaction?f(Ie,ae,{get:function(){return this.table(ae)},set:function(ke){h(this,ae,{value:ke,writable:!0,configurable:!0,enumerable:!0})}}):Ie[ae]=new B.Table(ae,fe))})})}function Da(B,z){z.forEach(function(X){for(var te in X)X[te]instanceof B.Table&&delete X[te]})}function bn(B,z){return B._cfg.version-z._cfg.version}function ts(B,z,X,te){var ae=B._dbSchema;X.objectStoreNames.contains("$meta")&&!ae.$meta&&(ae.$meta=La("$meta",pg("")[0],[]),B._storeNames.push("$meta"));var fe=B._createTransaction("readwrite",B._storeNames,ae);fe.create(X),fe._completion.catch(te);var Ie=fe._reject.bind(fe),Ue=be.transless||be;Qr(function(){return be.trans=fe,be.transless=Ue,z!==0?($n(B,X),$e=z,((ke=fe).storeNames.includes("$meta")?ke.table("$meta").get("version").then(function(He){return He??$e}):Le.resolve($e)).then(function(He){return qe=He,Be=fe,Ve=X,je=[],He=(Re=B)._versions,Ge=Re._dbSchema=Xl(0,Re.idbdb,Ve),(He=He.filter(function(Ke){return Ke._cfg.version>=qe})).length!==0?(He.forEach(function(Ke){je.push(function(){var et=Ge,dt=Ke._cfg.dbschema;bc(Re,et,Ve),bc(Re,dt,Ve),Ge=Re._dbSchema=dt;var yt=Fa(et,dt);yt.add.forEach(function($t){is(Ve,$t[0],$t[1].primKey,$t[1].indexes)}),yt.change.forEach(function($t){if($t.recreate)throw new J.Upgrade("Not yet support for changing primary key");var Bt=Ve.objectStore($t.name);$t.add.forEach(function(ii){return Zl(Bt,ii)}),$t.change.forEach(function(ii){Bt.deleteIndex(ii.name),Zl(Bt,ii)}),$t.del.forEach(function(ii){return Bt.deleteIndex(ii)})});var xt=Ke._cfg.contentUpgrade;if(xt&&Ke._cfg.version>qe){$n(Re,Ve),Be._memoizedTables={};var jt=U(dt);yt.del.forEach(function($t){jt[$t]=et[$t]}),Da(Re,[Re.Transaction.prototype]),ei(Re,[Re.Transaction.prototype],s(jt),jt),Be.schema=jt;var Pt,Ft=j(xt);return Ft&&Lr(),yt=Le.follow(function(){var $t;(Pt=xt(Be))&&Ft&&($t=Ua.bind(null,null),Pt.then($t,$t))}),Pt&&typeof Pt.then=="function"?Le.resolve(Pt):yt.then(function(){return Pt})}}),je.push(function(et){var dt,yt,xt=Ke._cfg.dbschema;dt=xt,yt=et,[].slice.call(yt.db.objectStoreNames).forEach(function(jt){return dt[jt]==null&&yt.db.deleteObjectStore(jt)}),Da(Re,[Re.Transaction.prototype]),ei(Re,[Re.Transaction.prototype],Re._storeNames,Re._dbSchema),Be.schema=Re._dbSchema}),je.push(function(et){Re.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(Re.idbdb.version/10)===Ke._cfg.version?(Re.idbdb.deleteObjectStore("$meta"),delete Re._dbSchema.$meta,Re._storeNames=Re._storeNames.filter(function(dt){return dt!=="$meta"})):et.objectStore("$meta").put(Ke._cfg.version,"version"))})}),(function Ke(){return je.length?Le.resolve(je.shift()(Be.idbtrans)).then(Ke):Le.resolve()})().then(function(){Ms(Ge,Ve)})):Le.resolve();var Re,qe,Be,Ve,je,Ge}).catch(Ie)):(s(ae).forEach(function(He){is(X,He,ae[He].primKey,ae[He].indexes)}),$n(B,X),void Le.follow(function(){return B.on.populate.fire(fe)}).catch(Ie));var ke,$e})}function Co(B,z){Ms(B._dbSchema,z),z.db.version%10!=0||z.objectStoreNames.contains("$meta")||z.db.createObjectStore("$meta").add(Math.ceil(z.db.version/10-1),"version");var X=Xl(0,B.idbdb,z);bc(B,B._dbSchema,z);for(var te=0,ae=Fa(X,B._dbSchema).change;te<ae.length;te++){var fe=(function(Ie){if(Ie.change.length||Ie.recreate)return console.warn("Unable to patch indexes of table ".concat(Ie.name," because it has changes on the type of index or primary key.")),{value:void 0};var Ue=z.objectStore(Ie.name);Ie.add.forEach(function(ke){Oe&&console.debug("Dexie upgrade patch: Creating missing index ".concat(Ie.name,".").concat(ke.src)),Zl(Ue,ke)})})(ae[te]);if(typeof fe=="object")return fe.value}}function Fa(B,z){var X,te={del:[],add:[],change:[]};for(X in B)z[X]||te.del.push(X);for(X in z){var ae=B[X],fe=z[X];if(ae){var Ie={name:X,def:fe,recreate:!1,del:[],add:[],change:[]};if(""+(ae.primKey.keyPath||"")!=""+(fe.primKey.keyPath||"")||ae.primKey.auto!==fe.primKey.auto)Ie.recreate=!0,te.change.push(Ie);else{var Ue=ae.idxByName,ke=fe.idxByName,$e=void 0;for($e in Ue)ke[$e]||Ie.del.push($e);for($e in ke){var He=Ue[$e],Re=ke[$e];He?He.src!==Re.src&&Ie.change.push(Re):Ie.add.push(Re)}(0<Ie.del.length||0<Ie.add.length||0<Ie.change.length)&&te.change.push(Ie)}}else te.add.push([X,fe])}return te}function is(B,z,X,te){var ae=B.db.createObjectStore(z,X.keyPath?{keyPath:X.keyPath,autoIncrement:X.auto}:{autoIncrement:X.auto});return te.forEach(function(fe){return Zl(ae,fe)}),ae}function Ms(B,z){s(B).forEach(function(X){z.db.objectStoreNames.contains(X)||(Oe&&console.debug("Dexie: Creating missing table",X),is(z,X,B[X].primKey,B[X].indexes))})}function Zl(B,z){B.createIndex(z.name,z.keyPath,{unique:z.unique,multiEntry:z.multi})}function Xl(B,z,X){var te={};return y(z.objectStoreNames,0).forEach(function(ae){for(var fe=X.objectStore(ae),Ie=np(yc($e=fe.keyPath),$e||"",!0,!1,!!fe.autoIncrement,$e&&typeof $e!="string",!0),Ue=[],ke=0;ke<fe.indexNames.length;++ke){var He=fe.index(fe.indexNames[ke]),$e=He.keyPath,He=np(He.name,$e,!!He.unique,!!He.multiEntry,!1,$e&&typeof $e!="string",!1);Ue.push(He)}te[ae]=La(ae,Ie,Ue)}),te}function bc(B,z,X){for(var te=X.db.objectStoreNames,ae=0;ae<te.length;++ae){var fe=te[ae],Ie=X.objectStore(fe);B._hasGetAll="getAll"in Ie;for(var Ue=0;Ue<Ie.indexNames.length;++Ue){var ke=Ie.indexNames[Ue],$e=Ie.index(ke).keyPath,He=typeof $e=="string"?$e:"["+y($e).join("+")+"]";!z[fe]||($e=z[fe].idxByName[He])&&($e.name=ke,delete z[fe].idxByName[He],z[fe].idxByName[ke]=$e)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&a.WorkerGlobalScope&&a instanceof a.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(B._hasGetAll=!1)}function pg(B){return B.split(",").map(function(z,X){var fe=z.split(":"),te=(ae=fe[1])===null||ae===void 0?void 0:ae.trim(),ae=(z=fe[0].trim()).replace(/([&*]|\+\+)/g,""),fe=/^\[/.test(ae)?ae.match(/^\[(.*)\]$/)[1].split("+"):ae;return np(ae,fe||null,/\&/.test(z),/\*/.test(z),/\+\+/.test(z),o(fe),X===0,te)})}var Wv=(Ns.prototype._createTableSchema=La,Ns.prototype._parseIndexSyntax=pg,Ns.prototype._parseStoresSpec=function(B,z){var X=this;s(B).forEach(function(te){if(B[te]!==null){var ae=X._parseIndexSyntax(B[te]),fe=ae.shift();if(!fe)throw new J.Schema("Invalid schema for table "+te+": "+B[te]);if(fe.unique=!0,fe.multi)throw new J.Schema("Primary key cannot be multiEntry*");ae.forEach(function(Ie){if(Ie.auto)throw new J.Schema("Only primary key can be marked as autoIncrement (++)");if(!Ie.keyPath)throw new J.Schema("Index must have a name and cannot be an empty string")}),ae=X._createTableSchema(te,fe,ae),z[te]=ae}})},Ns.prototype.stores=function(X){var z=this.db;this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,X):X;var X=z._versions,te={},ae={};return X.forEach(function(fe){l(te,fe._cfg.storesSource),ae=fe._cfg.dbschema={},fe._parseStoresSpec(te,ae)}),z._dbSchema=ae,Da(z,[z._allTables,z,z.Transaction.prototype]),ei(z,[z._allTables,z,z.Transaction.prototype,this._cfg.tables],s(ae),ae),z._storeNames=s(ae),this},Ns.prototype.upgrade=function(B){return this._cfg.contentUpgrade=Me(this._cfg.contentUpgrade||oe,B),this},Ns);function Ns(){}function mE(B,z){var X=B._dbNamesDB;return X||(X=B._dbNamesDB=new ph(Wl,{addons:[],indexedDB:B,IDBKeyRange:z})).version(1).stores({dbnames:"name"}),X.table("dbnames")}function cS(B){return B&&typeof B.databases=="function"}function rp(B){return Qr(function(){return be.letThrough=!0,B()})}function dS(B){return!("from"in B)}var Ro=function(B,z){if(!this){var X=new Ro;return B&&"d"in B&&l(X,B),X}l(this,arguments.length?{d:1,from:B,to:1<arguments.length?z:B}:{d:0})};function hg(B,z,X){var te=Qt(z,X);if(!isNaN(te)){if(0<te)throw RangeError();if(dS(B))return l(B,{from:z,to:X,d:1});var ae=B.l,te=B.r;if(Qt(X,B.from)<0)return ae?hg(ae,z,X):B.l={from:z,to:X,d:1,l:null,r:null},YN(B);if(0<Qt(z,B.to))return te?hg(te,z,X):B.r={from:z,to:X,d:1,l:null,r:null},YN(B);Qt(z,B.from)<0&&(B.from=z,B.l=null,B.d=te?te.d+1:1),0<Qt(X,B.to)&&(B.to=X,B.r=null,B.d=B.l?B.l.d+1:1),X=!B.r,ae&&!B.l&&nI(B,ae),te&&X&&nI(B,te)}}function nI(B,z){dS(z)||(function X(te,ke){var fe=ke.from,Ie=ke.to,Ue=ke.l,ke=ke.r;hg(te,fe,Ie),Ue&&X(te,Ue),ke&&X(te,ke)})(B,z)}function gE(B,z){var X=rI(z),te=X.next();if(te.done)return!1;for(var ae=te.value,fe=rI(B),Ie=fe.next(ae.from),Ue=Ie.value;!te.done&&!Ie.done;){if(Qt(Ue.from,ae.to)<=0&&0<=Qt(Ue.to,ae.from))return!0;Qt(ae.from,Ue.from)<0?ae=(te=X.next(Ue.from)).value:Ue=(Ie=fe.next(ae.from)).value}return!1}function rI(B){var z=dS(B)?null:{s:0,n:B};return{next:function(X){for(var te=0<arguments.length;z;)switch(z.s){case 0:if(z.s=1,te)for(;z.n.l&&Qt(X,z.n.from)<0;)z={up:z,n:z.n.l,s:1};else for(;z.n.l;)z={up:z,n:z.n.l,s:1};case 1:if(z.s=2,!te||Qt(X,z.n.to)<=0)return{value:z.n,done:!1};case 2:if(z.n.r){z.s=3,z={up:z,n:z.n.r,s:0};continue}case 3:z=z.up}return{done:!0}}}}function YN(B){var z,X,te=(((z=B.r)===null||z===void 0?void 0:z.d)||0)-(((X=B.l)===null||X===void 0?void 0:X.d)||0),ae=1<te?"r":te<-1?"l":"";ae&&(z=ae=="r"?"l":"r",X=n({},B),te=B[ae],B.from=te.from,B.to=te.to,B[ae]=te[ae],X[ae]=te[z],(B[z]=X).d=KN(X)),B.d=KN(B)}function KN(X){var z=X.r,X=X.l;return(z?X?Math.max(z.d,X.d):z.d:X?X.d:0)+1}function Yv(B,z){return s(z).forEach(function(X){B[X]?nI(B[X],z[X]):B[X]=(function te(ae){var fe,Ie,Ue={};for(fe in ae)d(ae,fe)&&(Ie=ae[fe],Ue[fe]=!Ie||typeof Ie!="object"||P.has(Ie.constructor)?Ie:te(Ie));return Ue})(z[X])}),B}function vE(B,z){return B.all||z.all||Object.keys(B).some(function(X){return z[X]&&gE(z[X],B[X])})}p(Ro.prototype,((Sc={add:function(B){return nI(this,B),this},addKey:function(B){return hg(this,B,B),this},addKeys:function(B){var z=this;return B.forEach(function(X){return hg(z,X,X)}),this},hasKey:function(B){var z=rI(this).next(B).value;return z&&Qt(z.from,B)<=0&&0<=Qt(z.to,B)}})[_]=function(){return rI(this)},Sc));var Af={},pS={},Kv=!1;function ap(B){Yv(pS,B),Kv||(Kv=!0,setTimeout(function(){Kv=!1,yE(pS,!(pS={}))},0))}function yE(B,z){z===void 0&&(z=!1);var X=new Set;if(B.all)for(var te=0,ae=Object.values(Af);te<ae.length;te++)Zv(Ie=ae[te],B,X,z);else for(var fe in B){var Ie,Ue=/^idb\:\/\/(.*)\/(.*)\//.exec(fe);Ue&&(fe=Ue[1],Ue=Ue[2],(Ie=Af["idb://".concat(fe,"/").concat(Ue)])&&Zv(Ie,B,X,z))}X.forEach(function(ke){return ke()})}function Zv(B,z,X,te){for(var ae=[],fe=0,Ie=Object.entries(B.queries.query);fe<Ie.length;fe++){for(var Ue=Ie[fe],ke=Ue[0],$e=[],He=0,Re=Ue[1];He<Re.length;He++){var qe=Re[He];vE(z,qe.obsSet)?qe.subscribers.forEach(function(Ge){return X.add(Ge)}):te&&$e.push(qe)}te&&ae.push([ke,$e])}if(te)for(var Be=0,Ve=ae;Be<Ve.length;Be++){var je=Ve[Be],ke=je[0],$e=je[1];B.queries.query[ke]=$e}}function Ic(B){var z=B._state,X=B._deps.indexedDB;if(z.isBeingOpened||B.idbdb)return z.dbReadyPromise.then(function(){return z.dbOpenError?Gr(z.dbOpenError):B});z.isBeingOpened=!0,z.dbOpenError=null,z.openComplete=!1;var te=z.openCanceller,ae=Math.round(10*B.verno),fe=!1;function Ie(){if(z.openCanceller!==te)throw new J.DatabaseClosed("db.open() was cancelled")}function Ue(){return new Le(function(qe,Be){if(Ie(),!X)throw new J.MissingAPI;var Ve=B.name,je=z.autoSchema||!ae?X.open(Ve):X.open(Ve,ae);if(!je)throw new J.MissingAPI;je.onerror=va(Be),je.onblocked=Ri(B._fireOnBlocked),je.onupgradeneeded=Ri(function(Ge){var Ke;He=je.transaction,z.autoSchema&&!B._options.allowEmptyDB?(je.onerror=jn,He.abort(),je.result.close(),(Ke=X.deleteDatabase(Ve)).onsuccess=Ke.onerror=Ri(function(){Be(new J.NoSuchDatabase("Database ".concat(Ve," doesnt exist")))})):(He.onerror=va(Be),Ge=Ge.oldVersion>Math.pow(2,62)?0:Ge.oldVersion,Re=Ge<1,B.idbdb=je.result,fe&&Co(B,He),ts(B,Ge/10,He,Be))},Be),je.onsuccess=Ri(function(){He=null;var Ge,Ke,et,dt,yt,xt=B.idbdb=je.result,jt=y(xt.objectStoreNames);if(0<jt.length)try{var Pt=xt.transaction((dt=jt).length===1?dt[0]:dt,"readonly");if(z.autoSchema)Ke=xt,et=Pt,(Ge=B).verno=Ke.version/10,et=Ge._dbSchema=Xl(0,Ke,et),Ge._storeNames=y(Ke.objectStoreNames,0),ei(Ge,[Ge._allTables],s(et),et);else if(bc(B,B._dbSchema,Pt),((yt=Fa(Xl(0,(yt=B).idbdb,Pt),yt._dbSchema)).add.length||yt.change.some(function(Ft){return Ft.add.length||Ft.change.length}))&&!fe)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),xt.close(),ae=xt.version+1,fe=!0,qe(Ue());$n(B,Pt)}catch{}ql.push(B),xt.onversionchange=Ri(function(Ft){z.vcFired=!0,B.on("versionchange").fire(Ft)}),xt.onclose=Ri(function(){B.close({disableAutoOpen:!1})}),Re&&(yt=B._deps,Pt=Ve,xt=yt.indexedDB,yt=yt.IDBKeyRange,cS(xt)||Pt===Wl||mE(xt,yt).put({name:Pt}).catch(oe)),qe()},Be)}).catch(function(qe){switch(qe?.name){case"UnknownError":if(0<z.PR1398_maxLoop)return z.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),Ue();break;case"VersionError":if(0<ae)return ae=0,Ue()}return Le.reject(qe)})}var ke,$e=z.dbReadyResolve,He=null,Re=!1;return Le.race([te,(typeof navigator>"u"?Le.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(qe){function Be(){return indexedDB.databases().finally(qe)}ke=setInterval(Be,100),Be()}).finally(function(){return clearInterval(ke)}):Promise.resolve()).then(Ue)]).then(function(){return Ie(),z.onReadyBeingFired=[],Le.resolve(rp(function(){return B.on.ready.fire(B.vip)})).then(function qe(){if(0<z.onReadyBeingFired.length){var Be=z.onReadyBeingFired.reduce(Me,oe);return z.onReadyBeingFired=[],Le.resolve(rp(function(){return Be(B.vip)})).then(qe)}})}).finally(function(){z.openCanceller===te&&(z.onReadyBeingFired=null,z.isBeingOpened=!1)}).catch(function(qe){z.dbOpenError=qe;try{He&&He.abort()}catch{}return te===z.openCanceller&&B._close(),Gr(qe)}).finally(function(){z.openComplete=!0,$e()}).then(function(){var qe;return Re&&(qe={},B.tables.forEach(function(Be){Be.schema.indexes.forEach(function(Ve){Ve.name&&(qe["idb://".concat(B.name,"/").concat(Be.name,"/").concat(Ve.name)]=new Ro(-1/0,[[[]]]))}),qe["idb://".concat(B.name,"/").concat(Be.name,"/")]=qe["idb://".concat(B.name,"/").concat(Be.name,"/:dels")]=new Ro(-1/0,[[[]]])}),qo(tp).fire(qe),yE(qe,!0)),B})}function hS(B){function z(fe){return B.next(fe)}var X=ae(z),te=ae(function(fe){return B.throw(fe)});function ae(fe){return function(ke){var Ue=fe(ke),ke=Ue.value;return Ue.done?ke:ke&&typeof ke.then=="function"?ke.then(X,te):o(ke)?Promise.all(ke).then(X,te):X(ke)}}return ae(z)()}function aI(B,z,X){for(var te=o(B)?B.slice():[B],ae=0;ae<X;++ae)te.push(z);return te}var W2={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(B){return n(n({},B),{table:function(z){var X=B.table(z),te=X.schema,ae={},fe=[];function Ie(Re,qe,Be){var Ve=ut(Re),je=ae[Ve]=ae[Ve]||[],Ge=Re==null?0:typeof Re=="string"?1:Re.length,Ke=0<qe,Ke=n(n({},Be),{name:Ke?"".concat(Ve,"(virtual-from:").concat(Be.name,")"):Be.name,lowLevelIndex:Be,isVirtual:Ke,keyTail:qe,keyLength:Ge,extractKey:ee(Re),unique:!Ke&&Be.unique});return je.push(Ke),Ke.isPrimaryKey||fe.push(Ke),1<Ge&&Ie(Ge===2?Re[0]:Re.slice(0,Ge-1),qe+1,Be),je.sort(function(et,dt){return et.keyTail-dt.keyTail}),Ke}z=Ie(te.primaryKey.keyPath,0,te.primaryKey),ae[":id"]=[z];for(var Ue=0,ke=te.indexes;Ue<ke.length;Ue++){var $e=ke[Ue];Ie($e.keyPath,0,$e)}function He(Re){var qe,Be=Re.query.index;return Be.isVirtual?n(n({},Re),{query:{index:Be.lowLevelIndex,range:(qe=Re.query.range,Be=Be.keyTail,{type:qe.type===1?2:qe.type,lower:aI(qe.lower,qe.lowerOpen?B.MAX_KEY:B.MIN_KEY,Be),lowerOpen:!0,upper:aI(qe.upper,qe.upperOpen?B.MIN_KEY:B.MAX_KEY,Be),upperOpen:!0})}}):Re}return n(n({},X),{schema:n(n({},te),{primaryKey:z,indexes:fe,getIndexByKeyPath:function(Re){return(Re=ae[ut(Re)])&&Re[0]}}),count:function(Re){return X.count(He(Re))},query:function(Re){return X.query(He(Re))},openCursor:function(Re){var qe=Re.query.index,Be=qe.keyTail,Ve=qe.isVirtual,je=qe.keyLength;return Ve?X.openCursor(He(Re)).then(function(Ke){return Ke&&Ge(Ke)}):X.openCursor(Re);function Ge(Ke){return Object.create(Ke,{continue:{value:function(et){et!=null?Ke.continue(aI(et,Re.reverse?B.MAX_KEY:B.MIN_KEY,Be)):Re.unique?Ke.continue(Ke.key.slice(0,je).concat(Re.reverse?B.MIN_KEY:B.MAX_KEY,Be)):Ke.continue()}},continuePrimaryKey:{value:function(et,dt){Ke.continuePrimaryKey(aI(et,B.MAX_KEY,Be),dt)}},primaryKey:{get:function(){return Ke.primaryKey}},key:{get:function(){var et=Ke.key;return je===1?et[0]:et.slice(0,je)}},value:{get:function(){return Ke.value}}})}}})}})}};function sI(B,z,X,te){return X=X||{},te=te||"",s(B).forEach(function(ae){var fe,Ie,Ue;d(z,ae)?(fe=B[ae],Ie=z[ae],typeof fe=="object"&&typeof Ie=="object"&&fe&&Ie?(Ue=A(fe))!==A(Ie)?X[te+ae]=z[ae]:Ue==="Object"?sI(fe,Ie,X,te+ae+"."):fe!==Ie&&(X[te+ae]=z[ae]):fe!==Ie&&(X[te+ae]=z[ae])):X[te+ae]=void 0}),s(z).forEach(function(ae){d(B,ae)||(X[te+ae]=z[ae])}),X}function oI(B,z){return z.type==="delete"?z.keys:z.keys||z.values.map(B.extractKey)}var Y2={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(B){return n(n({},B),{table:function(z){var X=B.table(z),te=X.schema.primaryKey;return n(n({},X),{mutate:function(ae){var fe=be.trans,Ie=fe.table(z).hook,Ue=Ie.deleting,ke=Ie.creating,$e=Ie.updating;switch(ae.type){case"add":if(ke.fire===oe)break;return fe._promise("readwrite",function(){return He(ae)},!0);case"put":if(ke.fire===oe&&$e.fire===oe)break;return fe._promise("readwrite",function(){return He(ae)},!0);case"delete":if(Ue.fire===oe)break;return fe._promise("readwrite",function(){return He(ae)},!0);case"deleteRange":if(Ue.fire===oe)break;return fe._promise("readwrite",function(){return(function Re(qe,Be,Ve){return X.query({trans:qe,values:!1,query:{index:te,range:Be},limit:Ve}).then(function(je){var Ge=je.result;return He({type:"delete",keys:Ge,trans:qe}).then(function(Ke){return 0<Ke.numFailures?Promise.reject(Ke.failures[0]):Ge.length<Ve?{failures:[],numFailures:0,lastResult:void 0}:Re(qe,n(n({},Be),{lower:Ge[Ge.length-1],lowerOpen:!0}),Ve)})})})(ae.trans,ae.range,1e4)},!0)}return X.mutate(ae);function He(Re){var qe,Be,Ve,je=be.trans,Ge=Re.keys||oI(te,Re);if(!Ge)throw new Error("Keys missing");return(Re=Re.type==="add"||Re.type==="put"?n(n({},Re),{keys:Ge}):n({},Re)).type!=="delete"&&(Re.values=r([],Re.values)),Re.keys&&(Re.keys=r([],Re.keys)),qe=X,Ve=Ge,((Be=Re).type==="add"?Promise.resolve([]):qe.getMany({trans:Be.trans,keys:Ve,cache:"immutable"})).then(function(Ke){var et=Ge.map(function(dt,yt){var xt,jt,Pt,Ft=Ke[yt],$t={onerror:null,onsuccess:null};return Re.type==="delete"?Ue.fire.call($t,dt,Ft,je):Re.type==="add"||Ft===void 0?(xt=ke.fire.call($t,dt,Re.values[yt],je),dt==null&&xt!=null&&(Re.keys[yt]=dt=xt,te.outbound||T(Re.values[yt],te.keyPath,dt))):(xt=sI(Ft,Re.values[yt]),(jt=$e.fire.call($t,xt,dt,Ft,je))&&(Pt=Re.values[yt],Object.keys(jt).forEach(function(Bt){d(Pt,Bt)?Pt[Bt]=jt[Bt]:T(Pt,Bt,jt[Bt])}))),$t});return X.mutate(Re).then(function(dt){for(var yt=dt.failures,xt=dt.results,jt=dt.numFailures,dt=dt.lastResult,Pt=0;Pt<Ge.length;++Pt){var Ft=(xt||Ge)[Pt],$t=et[Pt];Ft==null?$t.onerror&&$t.onerror(yt[Pt]):$t.onsuccess&&$t.onsuccess(Re.type==="put"&&Ke[Pt]?Re.values[Pt]:Ft)}return{failures:yt,results:xt,numFailures:jt,lastResult:dt}}).catch(function(dt){return et.forEach(function(yt){return yt.onerror&&yt.onerror(dt)}),Promise.reject(dt)})})}}})}})}};function ZN(B,z,X){try{if(!z||z.keys.length<B.length)return null;for(var te=[],ae=0,fe=0;ae<z.keys.length&&fe<B.length;++ae)Qt(z.keys[ae],B[fe])===0&&(te.push(X?R(z.values[ae]):z.values[ae]),++fe);return te.length===B.length?te:null}catch{return null}}var XN={stack:"dbcore",level:-1,create:function(B){return{table:function(z){var X=B.table(z);return n(n({},X),{getMany:function(te){if(!te.cache)return X.getMany(te);var ae=ZN(te.keys,te.trans._cache,te.cache==="clone");return ae?Le.resolve(ae):X.getMany(te).then(function(fe){return te.trans._cache={keys:te.keys,values:te.cache==="clone"?R(fe):fe},fe})},mutate:function(te){return te.type!=="add"&&(te.trans._cache=null),X.mutate(te)}})}}}};function JN(B,z){return B.trans.mode==="readonly"&&!!B.subscr&&!B.trans.explicit&&B.trans.db._options.cache!=="disabled"&&!z.schema.primaryKey.outbound}function wc(B,z){switch(B){case"query":return z.values&&!z.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Xv={stack:"dbcore",level:0,name:"Observability",create:function(B){var z=B.schema.name,X=new Ro(B.MIN_KEY,B.MAX_KEY);return n(n({},B),{transaction:function(te,ae,fe){if(be.subscr&&ae!=="readonly")throw new J.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(be.querier));return B.transaction(te,ae,fe)},table:function(te){var ae=B.table(te),fe=ae.schema,Ie=fe.primaryKey,Re=fe.indexes,Ue=Ie.extractKey,ke=Ie.outbound,$e=Ie.autoIncrement&&Re.filter(function(Be){return Be.compound&&Be.keyPath.includes(Ie.keyPath)}),He=n(n({},ae),{mutate:function(Be){function Ve(Bt){return Bt="idb://".concat(z,"/").concat(te,"/").concat(Bt),dt[Bt]||(dt[Bt]=new Ro)}var je,Ge,Ke,et=Be.trans,dt=Be.mutatedParts||(Be.mutatedParts={}),yt=Ve(""),xt=Ve(":dels"),jt=Be.type,$t=Be.type==="deleteRange"?[Be.range]:Be.type==="delete"?[Be.keys]:Be.values.length<50?[oI(Ie,Be).filter(function(Bt){return Bt}),Be.values]:[],Pt=$t[0],Ft=$t[1],$t=Be.trans._cache;return o(Pt)?(yt.addKeys(Pt),($t=jt==="delete"||Pt.length===Ft.length?ZN(Pt,$t):null)||xt.addKeys(Pt),($t||Ft)&&(je=Ve,Ge=$t,Ke=Ft,fe.indexes.forEach(function(Bt){var ii=je(Bt.name||"");function In(An){return An!=null?Bt.extractKey(An):null}function Ji(An){return Bt.multiEntry&&o(An)?An.forEach(function(Jl){return ii.addKey(Jl)}):ii.addKey(An)}(Ge||Ke).forEach(function(An,Yo){var tn=Ge&&In(Ge[Yo]),Yo=Ke&&In(Ke[Yo]);Qt(tn,Yo)!==0&&(tn!=null&&Ji(tn),Yo!=null&&Ji(Yo))})}))):Pt?(Ft={from:(Ft=Pt.lower)!==null&&Ft!==void 0?Ft:B.MIN_KEY,to:(Ft=Pt.upper)!==null&&Ft!==void 0?Ft:B.MAX_KEY},xt.add(Ft),yt.add(Ft)):(yt.add(X),xt.add(X),fe.indexes.forEach(function(Bt){return Ve(Bt.name).add(X)})),ae.mutate(Be).then(function(Bt){return!Pt||Be.type!=="add"&&Be.type!=="put"||(yt.addKeys(Bt.results),$e&&$e.forEach(function(ii){for(var In=Be.values.map(function(tn){return ii.extractKey(tn)}),Ji=ii.keyPath.findIndex(function(tn){return tn===Ie.keyPath}),An=0,Jl=Bt.results.length;An<Jl;++An)In[An][Ji]=Bt.results[An];Ve(ii.name).addKeys(In)})),et.mutatedParts=Yv(et.mutatedParts||{},dt),Bt})}}),Re=function(Ve){var je=Ve.query,Ve=je.index,je=je.range;return[Ve,new Ro((Ve=je.lower)!==null&&Ve!==void 0?Ve:B.MIN_KEY,(je=je.upper)!==null&&je!==void 0?je:B.MAX_KEY)]},qe={get:function(Be){return[Ie,new Ro(Be.key)]},getMany:function(Be){return[Ie,new Ro().addKeys(Be.keys)]},count:Re,query:Re,openCursor:Re};return s(qe).forEach(function(Be){He[Be]=function(Ve){var je=be.subscr,Ge=!!je,Ke=JN(be,ae)&&wc(Be,Ve)?Ve.obsSet={}:je;if(Ge){var et=function(Ft){return Ft="idb://".concat(z,"/").concat(te,"/").concat(Ft),Ke[Ft]||(Ke[Ft]=new Ro)},dt=et(""),yt=et(":dels"),je=qe[Be](Ve),Ge=je[0],je=je[1];if((Be==="query"&&Ge.isPrimaryKey&&!Ve.values?yt:et(Ge.name||"")).add(je),!Ge.isPrimaryKey){if(Be!=="count"){var xt=Be==="query"&&ke&&Ve.values&&ae.query(n(n({},Ve),{values:!1}));return ae[Be].apply(this,arguments).then(function(Ft){if(Be==="query"){if(ke&&Ve.values)return xt.then(function(In){return In=In.result,dt.addKeys(In),Ft});var $t=Ve.values?Ft.result.map(Ue):Ft.result;(Ve.values?dt:yt).addKeys($t)}else if(Be==="openCursor"){var Bt=Ft,ii=Ve.values;return Bt&&Object.create(Bt,{key:{get:function(){return yt.addKey(Bt.primaryKey),Bt.key}},primaryKey:{get:function(){var In=Bt.primaryKey;return yt.addKey(In),In}},value:{get:function(){return ii&&dt.addKey(Bt.primaryKey),Bt.value}}})}return Ft})}yt.add(X)}}return ae[Be].apply(this,arguments)}}),He}})}};function QN(B,z,X){if(X.numFailures===0)return z;if(z.type==="deleteRange")return null;var te=z.keys?z.keys.length:"values"in z&&z.values?z.values.length:1;return X.numFailures===te?null:(z=n({},z),o(z.keys)&&(z.keys=z.keys.filter(function(ae,fe){return!(fe in X.failures)})),"values"in z&&o(z.values)&&(z.values=z.values.filter(function(ae,fe){return!(fe in X.failures)})),z)}function wd(B,z){return X=B,((te=z).lower===void 0||(te.lowerOpen?0<Qt(X,te.lower):0<=Qt(X,te.lower)))&&(B=B,(z=z).upper===void 0||(z.upperOpen?Qt(B,z.upper)<0:Qt(B,z.upper)<=0));var X,te}function eA(B,z,qe,te,ae,fe){if(!qe||qe.length===0)return B;var Ie=z.query.index,Ue=Ie.multiEntry,ke=z.query.range,$e=te.schema.primaryKey.extractKey,He=Ie.extractKey,Re=(Ie.lowLevelIndex||Ie).extractKey,qe=qe.reduce(function(Be,Ve){var je=Be,Ge=[];if(Ve.type==="add"||Ve.type==="put")for(var Ke=new Ro,et=Ve.values.length-1;0<=et;--et){var dt,yt=Ve.values[et],xt=$e(yt);Ke.hasKey(xt)||(dt=He(yt),(Ue&&o(dt)?dt.some(function(Bt){return wd(Bt,ke)}):wd(dt,ke))&&(Ke.addKey(xt),Ge.push(yt)))}switch(Ve.type){case"add":var jt=new Ro().addKeys(z.values?Be.map(function(ii){return $e(ii)}):Be),je=Be.concat(z.values?Ge.filter(function(ii){return ii=$e(ii),!jt.hasKey(ii)&&(jt.addKey(ii),!0)}):Ge.map(function(ii){return $e(ii)}).filter(function(ii){return!jt.hasKey(ii)&&(jt.addKey(ii),!0)}));break;case"put":var Pt=new Ro().addKeys(Ve.values.map(function(ii){return $e(ii)}));je=Be.filter(function(ii){return!Pt.hasKey(z.values?$e(ii):ii)}).concat(z.values?Ge:Ge.map(function(ii){return $e(ii)}));break;case"delete":var Ft=new Ro().addKeys(Ve.keys);je=Be.filter(function(ii){return!Ft.hasKey(z.values?$e(ii):ii)});break;case"deleteRange":var $t=Ve.range;je=Be.filter(function(ii){return!wd($e(ii),$t)})}return je},B);return qe===B?B:(qe.sort(function(Be,Ve){return Qt(Re(Be),Re(Ve))||Qt($e(Be),$e(Ve))}),z.limit&&z.limit<1/0&&(qe.length>z.limit?qe.length=z.limit:B.length===z.limit&&qe.length<z.limit&&(ae.dirty=!0)),fe?Object.freeze(qe):qe)}function fg(B,z){return Qt(B.lower,z.lower)===0&&Qt(B.upper,z.upper)===0&&!!B.lowerOpen==!!z.lowerOpen&&!!B.upperOpen==!!z.upperOpen}function K2(B,z){return(function(X,te,ae,fe){if(X===void 0)return te!==void 0?-1:0;if(te===void 0)return 1;if((te=Qt(X,te))===0){if(ae&&fe)return 0;if(ae)return 1;if(fe)return-1}return te})(B.lower,z.lower,B.lowerOpen,z.lowerOpen)<=0&&0<=(function(X,te,ae,fe){if(X===void 0)return te!==void 0?1:0;if(te===void 0)return-1;if((te=Qt(X,te))===0){if(ae&&fe)return 0;if(ae)return-1;if(fe)return 1}return te})(B.upper,z.upper,B.upperOpen,z.upperOpen)}function lI(B,z,X,te){B.subscribers.add(X),te.addEventListener("abort",function(){var ae,fe;B.subscribers.delete(X),B.subscribers.size===0&&(ae=B,fe=z,setTimeout(function(){ae.subscribers.size===0&&O(fe,ae)},3e3))})}var tA={stack:"dbcore",level:0,name:"Cache",create:function(B){var z=B.schema.name;return n(n({},B),{transaction:function(X,te,ae){var fe,Ie,Ue=B.transaction(X,te,ae);return te==="readwrite"&&(Ie=(fe=new AbortController).signal,ae=function(ke){return function(){if(fe.abort(),te==="readwrite"){for(var $e=new Set,He=0,Re=X;He<Re.length;He++){var qe=Re[He],Be=Af["idb://".concat(z,"/").concat(qe)];if(Be){var Ve=B.table(qe),je=Be.optimisticOps.filter(function(ii){return ii.trans===Ue});if(Ue._explicit&&ke&&Ue.mutatedParts)for(var Ge=0,Ke=Object.values(Be.queries.query);Ge<Ke.length;Ge++)for(var et=0,dt=(jt=Ke[Ge]).slice();et<dt.length;et++)vE((Pt=dt[et]).obsSet,Ue.mutatedParts)&&(O(jt,Pt),Pt.subscribers.forEach(function(ii){return $e.add(ii)}));else if(0<je.length){Be.optimisticOps=Be.optimisticOps.filter(function(ii){return ii.trans!==Ue});for(var yt=0,xt=Object.values(Be.queries.query);yt<xt.length;yt++)for(var jt,Pt,Ft,$t=0,Bt=(jt=xt[yt]).slice();$t<Bt.length;$t++)(Pt=Bt[$t]).res!=null&&Ue.mutatedParts&&(ke&&!Pt.dirty?(Ft=Object.isFrozen(Pt.res),Ft=eA(Pt.res,Pt.req,je,Ve,Pt,Ft),Pt.dirty?(O(jt,Pt),Pt.subscribers.forEach(function(ii){return $e.add(ii)})):Ft!==Pt.res&&(Pt.res=Ft,Pt.promise=Le.resolve({result:Ft}))):(Pt.dirty&&O(jt,Pt),Pt.subscribers.forEach(function(ii){return $e.add(ii)})))}}}$e.forEach(function(ii){return ii()})}}},Ue.addEventListener("abort",ae(!1),{signal:Ie}),Ue.addEventListener("error",ae(!1),{signal:Ie}),Ue.addEventListener("complete",ae(!0),{signal:Ie})),Ue},table:function(X){var te=B.table(X),ae=te.schema.primaryKey;return n(n({},te),{mutate:function(fe){var Ie=be.trans;if(ae.outbound||Ie.db._options.cache==="disabled"||Ie.explicit||Ie.idbtrans.mode!=="readwrite")return te.mutate(fe);var Ue=Af["idb://".concat(z,"/").concat(X)];return Ue?(Ie=te.mutate(fe),fe.type!=="add"&&fe.type!=="put"||!(50<=fe.values.length||oI(ae,fe).some(function(ke){return ke==null}))?(Ue.optimisticOps.push(fe),fe.mutatedParts&&ap(fe.mutatedParts),Ie.then(function(ke){0<ke.numFailures&&(O(Ue.optimisticOps,fe),(ke=QN(0,fe,ke))&&Ue.optimisticOps.push(ke),fe.mutatedParts&&ap(fe.mutatedParts))}),Ie.catch(function(){O(Ue.optimisticOps,fe),fe.mutatedParts&&ap(fe.mutatedParts)})):Ie.then(function(ke){var $e=QN(0,n(n({},fe),{values:fe.values.map(function(He,Re){var qe;return ke.failures[Re]?He:(He=(qe=ae.keyPath)!==null&&qe!==void 0&&qe.includes(".")?R(He):n({},He),T(He,ae.keyPath,ke.results[Re]),He)})}),ke);Ue.optimisticOps.push($e),queueMicrotask(function(){return fe.mutatedParts&&ap(fe.mutatedParts)})}),Ie):te.mutate(fe)},query:function(fe){if(!JN(be,te)||!wc("query",fe))return te.query(fe);var Ie=(($e=be.trans)===null||$e===void 0?void 0:$e.db._options.cache)==="immutable",Re=be,Ue=Re.requery,ke=Re.signal,$e=(function(Ve,je,Ge,Ke){var et=Af["idb://".concat(Ve,"/").concat(je)];if(!et)return[];if(!(je=et.queries[Ge]))return[null,!1,et,null];var dt=je[(Ke.query?Ke.query.index.name:null)||""];if(!dt)return[null,!1,et,null];switch(Ge){case"query":var yt=dt.find(function(xt){return xt.req.limit===Ke.limit&&xt.req.values===Ke.values&&fg(xt.req.query.range,Ke.query.range)});return yt?[yt,!0,et,dt]:[dt.find(function(xt){return("limit"in xt.req?xt.req.limit:1/0)>=Ke.limit&&(!Ke.values||xt.req.values)&&K2(xt.req.query.range,Ke.query.range)}),!1,et,dt];case"count":return yt=dt.find(function(xt){return fg(xt.req.query.range,Ke.query.range)}),[yt,!!yt,et,dt]}})(z,X,"query",fe),He=$e[0],Re=$e[1],qe=$e[2],Be=$e[3];return He&&Re?He.obsSet=fe.obsSet:(Re=te.query(fe).then(function(Ve){var je=Ve.result;if(He&&(He.res=je),Ie){for(var Ge=0,Ke=je.length;Ge<Ke;++Ge)Object.freeze(je[Ge]);Object.freeze(je)}else Ve.result=R(je);return Ve}).catch(function(Ve){return Be&&He&&O(Be,He),Promise.reject(Ve)}),He={obsSet:fe.obsSet,promise:Re,subscribers:new Set,type:"query",req:fe,dirty:!1},Be?Be.push(He):(Be=[He],(qe=qe||(Af["idb://".concat(z,"/").concat(X)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[fe.query.index.name||""]=Be)),lI(He,Be,Ue,ke),He.promise.then(function(Ve){return{result:eA(Ve.result,fe,qe?.optimisticOps,te,He,Ie)}})}})}})}};function mg(B,z){return new Proxy(B,{get:function(X,te,ae){return te==="db"?z:Reflect.get(X,te,ae)}})}var ph=($r.prototype.version=function(B){if(isNaN(B)||B<.1)throw new J.Type("Given version is not a positive number");if(B=Math.round(10*B)/10,this.idbdb||this._state.isBeingOpened)throw new J.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,B);var z=this._versions,X=z.filter(function(te){return te._cfg.version===B})[0];return X||(X=new this.Version(B),z.push(X),z.sort(bn),X.stores({}),this._state.autoSchema=!1,X)},$r.prototype._whenReady=function(B){var z=this;return this.idbdb&&(this._state.openComplete||be.letThrough||this._vip)?B():new Le(function(X,te){if(z._state.openComplete)return te(new J.DatabaseClosed(z._state.dbOpenError));if(!z._state.isBeingOpened){if(!z._state.autoOpen)return void te(new J.DatabaseClosed);z.open().catch(oe)}z._state.dbReadyPromise.then(X,te)}).then(B)},$r.prototype.use=function(B){var z=B.stack,X=B.create,te=B.level,ae=B.name;return ae&&this.unuse({stack:z,name:ae}),B=this._middlewares[z]||(this._middlewares[z]=[]),B.push({stack:z,create:X,level:te??10,name:ae}),B.sort(function(fe,Ie){return fe.level-Ie.level}),this},$r.prototype.unuse=function(B){var z=B.stack,X=B.name,te=B.create;return z&&this._middlewares[z]&&(this._middlewares[z]=this._middlewares[z].filter(function(ae){return te?ae.create!==te:!!X&&ae.name!==X})),this},$r.prototype.open=function(){var B=this;return Ru(we,function(){return Ic(B)})},$r.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var B=this._state,z=ql.indexOf(this);if(0<=z&&ql.splice(z,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}B.isBeingOpened||(B.dbReadyPromise=new Le(function(X){B.dbReadyResolve=X}),B.openCanceller=new Le(function(X,te){B.cancelOpen=te}))},$r.prototype.close=function(X){var z=(X===void 0?{disableAutoOpen:!0}:X).disableAutoOpen,X=this._state;z?(X.isBeingOpened&&X.cancelOpen(new J.DatabaseClosed),this._close(),X.autoOpen=!1,X.dbOpenError=new J.DatabaseClosed):(this._close(),X.autoOpen=this._options.autoOpen||X.isBeingOpened,X.openComplete=!1,X.dbOpenError=null)},$r.prototype.delete=function(B){var z=this;B===void 0&&(B={disableAutoOpen:!0});var X=0<arguments.length&&typeof arguments[0]!="object",te=this._state;return new Le(function(ae,fe){function Ie(){z.close(B);var Ue=z._deps.indexedDB.deleteDatabase(z.name);Ue.onsuccess=Ri(function(){var ke,$e,He;ke=z._deps,$e=z.name,He=ke.indexedDB,ke=ke.IDBKeyRange,cS(He)||$e===Wl||mE(He,ke).delete($e).catch(oe),ae()}),Ue.onerror=va(fe),Ue.onblocked=z._fireOnBlocked}if(X)throw new J.InvalidArgument("Invalid closeOptions argument to db.delete()");te.isBeingOpened?te.dbReadyPromise.then(Ie):Ie()})},$r.prototype.backendDB=function(){return this.idbdb},$r.prototype.isOpen=function(){return this.idbdb!==null},$r.prototype.hasBeenClosed=function(){var B=this._state.dbOpenError;return B&&B.name==="DatabaseClosed"},$r.prototype.hasFailed=function(){return this._state.dbOpenError!==null},$r.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty($r.prototype,"tables",{get:function(){var B=this;return s(this._allTables).map(function(z){return B._allTables[z]})},enumerable:!1,configurable:!0}),$r.prototype.transaction=function(){var B=(function(z,X,te){var ae=arguments.length;if(ae<2)throw new J.InvalidArgument("Too few arguments");for(var fe=new Array(ae-1);--ae;)fe[ae-1]=arguments[ae];return te=fe.pop(),[z,E(fe),te]}).apply(this,arguments);return this._transaction.apply(this,B)},$r.prototype._transaction=function(B,z,X){var te=this,ae=be.trans;ae&&ae.db===this&&B.indexOf("!")===-1||(ae=null);var fe,Ie,Ue=B.indexOf("?")!==-1;B=B.replace("!","").replace("?","");try{if(Ie=z.map(function($e){if($e=$e instanceof te.Table?$e.name:$e,typeof $e!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return $e}),B=="r"||B===ep)fe=ep;else{if(B!="rw"&&B!=Yl)throw new J.InvalidArgument("Invalid transaction mode: "+B);fe=Yl}if(ae){if(ae.mode===ep&&fe===Yl){if(!Ue)throw new J.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");ae=null}ae&&Ie.forEach(function($e){if(ae&&ae.storeNames.indexOf($e)===-1){if(!Ue)throw new J.SubTransaction("Table "+$e+" not included in parent transaction.");ae=null}}),Ue&&ae&&!ae.active&&(ae=null)}}catch($e){return ae?ae._promise(null,function(He,Re){Re($e)}):Gr($e)}var ke=(function $e(He,Re,qe,Be,Ve){return Le.resolve().then(function(){var je=be.transless||be,Ge=He._createTransaction(Re,qe,He._dbSchema,Be);if(Ge.explicit=!0,je={trans:Ge,transless:je},Be)Ge.idbtrans=Be.idbtrans;else try{Ge.create(),Ge.idbtrans._explicit=!0,He._state.PR1398_maxLoop=3}catch(dt){return dt.name===K.InvalidState&&He.isOpen()&&0<--He._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),He.close({disableAutoOpen:!1}),He.open().then(function(){return $e(He,Re,qe,null,Ve)})):Gr(dt)}var Ke,et=j(Ve);return et&&Lr(),je=Le.follow(function(){var dt;(Ke=Ve.call(Ge,Ge))&&(et?(dt=Ua.bind(null,null),Ke.then(dt,dt)):typeof Ke.next=="function"&&typeof Ke.throw=="function"&&(Ke=hS(Ke)))},je),(Ke&&typeof Ke.then=="function"?Le.resolve(Ke).then(function(dt){return Ge.active?dt:Gr(new J.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):je.then(function(){return Ke})).then(function(dt){return Be&&Ge._resolve(),Ge._completion.then(function(){return dt})}).catch(function(dt){return Ge._reject(dt),Gr(dt)})})}).bind(null,this,fe,Ie,ae,X);return ae?ae._promise(fe,ke,"lock"):be.trans?Ru(be.transless,function(){return te._whenReady(ke)}):this._whenReady(ke)},$r.prototype.table=function(B){if(!d(this._allTables,B))throw new J.InvalidTable("Table ".concat(B," does not exist"));return this._allTables[B]},$r);function $r(B,z){var X=this;this._middlewares={},this.verno=0;var te=$r.dependencies;this._options=z=n({addons:$r.addons,autoOpen:!0,indexedDB:te.indexedDB,IDBKeyRange:te.IDBKeyRange,cache:"cloned"},z),this._deps={indexedDB:z.indexedDB,IDBKeyRange:z.IDBKeyRange},te=z.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var ae,fe,Ie,Ue,ke,$e={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:oe,dbReadyPromise:null,cancelOpen:oe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:z.autoOpen};$e.dbReadyPromise=new Le(function(Re){$e.dbReadyResolve=Re}),$e.openCanceller=new Le(function(Re,qe){$e.cancelOpen=qe}),this._state=$e,this.name=B,this.on=Kl(this,"populate","blocked","versionchange","close",{ready:[Me,oe]}),this.once=function(Re,qe){var Be=function(){for(var Ve=[],je=0;je<arguments.length;je++)Ve[je]=arguments[je];X.on(Re).unsubscribe(Be),qe.apply(X,Ve)};return X.on(Re,Be)},this.on.ready.subscribe=b(this.on.ready.subscribe,function(Re){return function(qe,Be){$r.vip(function(){var Ve,je=X._state;je.openComplete?(je.dbOpenError||Le.resolve().then(qe),Be&&Re(qe)):je.onReadyBeingFired?(je.onReadyBeingFired.push(qe),Be&&Re(qe)):(Re(qe),Ve=X,Be||Re(function Ge(){Ve.on.ready.unsubscribe(qe),Ve.on.ready.unsubscribe(Ge)}))})}}),this.Collection=(ae=this,es(Nu.prototype,function(Ke,Ge){this.db=ae;var Be=fc,Ve=null;if(Ge)try{Be=Ge()}catch(et){Ve=et}var je=Ke._ctx,Ge=je.table,Ke=Ge.hook.reading.fire;this._ctx={table:Ge,index:je.index,isPrimKey:!je.index||Ge.schema.primKey.keyPath&&je.index===Ge.schema.primKey.name,range:Be,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:Ve,or:je.or,valueMapper:Ke!==de?Ke:null}})),this.Table=(fe=this,es(vr.prototype,function(Re,qe,Be){this.db=fe,this._tx=Be,this.name=Re,this.schema=qe,this.hook=fe._allTables[Re]?fe._allTables[Re].hook:Kl(null,{creating:[ye,oe],reading:[se,de],updating:[De,oe],deleting:[Te,oe]})})),this.Transaction=(Ie=this,es(Nf.prototype,function(Re,qe,Be,Ve,je){var Ge=this;Re!=="readonly"&&qe.forEach(function(Ke){Ke=(Ke=Be[Ke])===null||Ke===void 0?void 0:Ke.yProps,Ke&&(qe=qe.concat(Ke.map(function(et){return et.updatesTable})))}),this.db=Ie,this.mode=Re,this.storeNames=qe,this.schema=Be,this.chromeTransactionDurability=Ve,this.idbtrans=null,this.on=Kl(this,"complete","error","abort"),this.parent=je||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Le(function(Ke,et){Ge._resolve=Ke,Ge._reject=et}),this._completion.then(function(){Ge.active=!1,Ge.on.complete.fire()},function(Ke){var et=Ge.active;return Ge.active=!1,Ge.on.error.fire(Ke),Ge.parent?Ge.parent._reject(Ke):et&&Ge.idbtrans&&Ge.idbtrans.abort(),Gr(Ke)})})),this.Version=(Ue=this,es(Wv.prototype,function(Re){this.db=Ue,this._cfg={version:Re,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(ke=this,es(dg.prototype,function(Re,qe,Be){if(this.db=ke,this._ctx={table:Re,index:qe===":id"?null:qe,or:Be},this._cmp=this._ascending=Qt,this._descending=function(Ve,je){return Qt(je,Ve)},this._max=function(Ve,je){return 0<Qt(Ve,je)?Ve:je},this._min=function(Ve,je){return Qt(Ve,je)<0?Ve:je},this._IDBKeyRange=ke._deps.IDBKeyRange,!this._IDBKeyRange)throw new J.MissingAPI})),this.on("versionchange",function(Re){0<Re.newVersion?console.warn("Another connection wants to upgrade database '".concat(X.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(X.name,"'. Closing db now to resume the delete request.")),X.close({disableAutoOpen:!1})}),this.on("blocked",function(Re){!Re.newVersion||Re.newVersion<Re.oldVersion?console.warn("Dexie.delete('".concat(X.name,"') was blocked")):console.warn("Upgrade '".concat(X.name,"' blocked by other connection holding version ").concat(Re.oldVersion/10))}),this._maxKey=ml(z.IDBKeyRange),this._createTransaction=function(Re,qe,Be,Ve){return new X.Transaction(Re,qe,Be,X._options.chromeTransactionDurability,Ve)},this._fireOnBlocked=function(Re){X.on("blocked").fire(Re),ql.filter(function(qe){return qe.name===X.name&&qe!==X&&!qe._state.vcFired}).map(function(qe){return qe.on("versionchange").fire(Re)})},this.use(XN),this.use(tA),this.use(Xv),this.use(W2),this.use(Y2);var He=new Proxy(this,{get:function(Re,qe,Be){if(qe==="_vip")return!0;if(qe==="table")return function(je){return mg(X.table(je),He)};var Ve=Reflect.get(Re,qe,Be);return Ve instanceof vr?mg(Ve,He):qe==="tables"?Ve.map(function(je){return mg(je,He)}):qe==="_createTransaction"?function(){return mg(Ve.apply(this,arguments),He)}:Ve}});this.vip=He,te.forEach(function(Re){return Re(X)})}var gg,Sc=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",bE=(IE.prototype.subscribe=function(B,z,X){return this._subscribe(B&&typeof B!="function"?B:{next:B,error:z,complete:X})},IE.prototype[Sc]=function(){return this},IE);function IE(B){this._subscribe=B}try{gg={indexedDB:a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB,IDBKeyRange:a.IDBKeyRange||a.webkitIDBKeyRange}}catch{gg={indexedDB:null,IDBKeyRange:null}}function sp(B){var z,X=!1,te=new bE(function(ae){var fe=j(B),Ie,Ue=!1,ke={},$e={},He={get closed(){return Ue},unsubscribe:function(){Ue||(Ue=!0,Ie&&Ie.abort(),Re&&qo.storagemutated.unsubscribe(Be))}};ae.start&&ae.start(He);var Re=!1,qe=function(){return fa(Ve)},Be=function(je){Yv(ke,je),vE($e,ke)&&qe()},Ve=function(){var je,Ge,Ke;!Ue&&gg.indexedDB&&(ke={},je={},Ie&&Ie.abort(),Ie=new AbortController,Ke=(function(et){var dt=Tt();try{fe&&Lr();var yt=Qr(B,et);return yt=fe?yt.finally(Ua):yt}finally{dt&&Li()}})(Ge={subscr:je,signal:Ie.signal,requery:qe,querier:B,trans:null}),Promise.resolve(Ke).then(function(et){X=!0,z=et,Ue||Ge.signal.aborted||(ke={},(function(dt){for(var yt in dt)if(d(dt,yt))return;return 1})($e=je)||Re||(qo(tp,Be),Re=!0),fa(function(){return!Ue&&ae.next&&ae.next(et)}))},function(et){X=!1,["DatabaseClosedError","AbortError"].includes(et?.name)||Ue||fa(function(){Ue||ae.error&&ae.error(et)})}))};return setTimeout(qe,0),He});return te.hasValue=function(){return X},te.getValue=function(){return z},te}var vg=ph;function _f(B){var z=Wo;try{Wo=!0,qo.storagemutated.fire(B),yE(B,!0)}finally{Wo=z}}p(vg,n(n({},re),{delete:function(B){return new vg(B,{addons:[]}).delete()},exists:function(B){return new vg(B,{addons:[]}).open().then(function(z){return z.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(B){try{return z=vg.dependencies,X=z.indexedDB,z=z.IDBKeyRange,(cS(X)?Promise.resolve(X.databases()).then(function(te){return te.map(function(ae){return ae.name}).filter(function(ae){return ae!==Wl})}):mE(X,z).toCollection().primaryKeys()).then(B)}catch{return Gr(new J.MissingAPI)}var z,X},defineClass:function(){return function(B){l(this,B)}},ignoreTransaction:function(B){return be.trans?Ru(be.transless,B):B()},vip:rp,async:function(B){return function(){try{var z=hS(B.apply(this,arguments));return z&&typeof z.then=="function"?z:Le.resolve(z)}catch(X){return Gr(X)}}},spawn:function(B,z,X){try{var te=hS(B.apply(X,z||[]));return te&&typeof te.then=="function"?te:Le.resolve(te)}catch(ae){return Gr(ae)}},currentTransaction:{get:function(){return be.trans||null}},waitFor:function(B,z){return z=Le.resolve(typeof B=="function"?vg.ignoreTransaction(B):B).timeout(z||6e4),be.trans?be.trans.waitFor(z):z},Promise:Le,debug:{get:function(){return Oe},set:function(B){at(B)}},derive:m,extend:l,props:p,override:b,Events:Kl,on:qo,liveQuery:sp,extendObservabilitySet:Yv,getByKeyPath:w,setByKeyPath:T,delByKeyPath:function(B,z){typeof z=="string"?T(B,z,void 0):"length"in z&&[].map.call(z,function(X){T(B,X,void 0)})},shallowClone:U,deepClone:R,getObjectDiff:sI,cmp:Qt,asap:S,minKey:-1/0,addons:[],connections:ql,errnames:K,dependencies:gg,cache:Af,semVer:"4.2.1",version:"4.2.1".split(".").map(function(B){return parseInt(B)}).reduce(function(B,z,X){return B+z/Math.pow(10,2*X)})})),vg.maxKey=ml(vg.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(qo(tp,function(B){Wo||(B=new CustomEvent(ip,{detail:B}),Wo=!0,dispatchEvent(B),Wo=!1)}),addEventListener(ip,function(B){B=B.detail,Wo||_f(B)}));var Jv,Wo=!1,uI=function(){};return typeof BroadcastChannel<"u"&&((uI=function(){(Jv=new BroadcastChannel(ip)).onmessage=function(B){return B.data&&_f(B.data)}})(),typeof Jv.unref=="function"&&Jv.unref(),qo(tp,function(B){Wo||Jv.postMessage(B)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(B){if(!ph.disableBfCache&&B.persisted){Oe&&console.debug("Dexie: handling persisted pagehide"),Jv?.close();for(var z=0,X=ql;z<X.length;z++)X[z].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(B){!ph.disableBfCache&&B.persisted&&(Oe&&console.debug("Dexie: handling persisted pageshow"),uI(),_f({all:new Ro(-1/0,[[]])}))})),Le.rejectionMapper=function(B,z){return!B||B instanceof G||B instanceof TypeError||B instanceof SyntaxError||!B.name||!ne[B.name]?B:(z=new ne[B.name](z||B.message,B),"stack"in B&&f(z,"stack",{get:function(){return this.inner.stack}}),z)},at(Oe),n(ph,Object.freeze({__proto__:null,Dexie:ph,liveQuery:sp,Entity:Mu,cmp:Qt,PropModification:io,replacePrefix:function(B,z){return new io({replacePrefix:[B,z]})},add:function(B){return new io({add:B})},remove:function(B){return new io({remove:B})},default:ph,RangeSet:Ro,mergeRanges:nI,rangesOverlap:gE}),{default:ph}),ph})})(F_)),F_.exports}var vJe=gJe();const dz=pM(vJe),Ree=Symbol.for("Dexie"),p1=globalThis[Ree]||(globalThis[Ree]=dz);if(dz.semVer!==p1.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${dz.semVer} and ${p1.semVer}`);const{liveQuery:uPt,mergeRanges:cPt,rangesOverlap:dPt,RangeSet:pPt,cmp:hPt,Entity:fPt,PropModification:mPt,replacePrefix:gPt,add:vPt,remove:yPt,DexieYProvider:bPt}=p1,Hu=(function(){const t={};return t.initDB=()=>new Promise((e,i)=>{try{t.dex=new p1("TMX",{autoOpen:!0}),t.dex.version(2).stores({tournaments:"&tournamentId, tournamentName, startDate, endDate",providers:"&providerId, settings, calendar",idioms:"ioc"}),e()}catch(n){return i(n)}}),t.resetDB=e=>{t.dex.close(),p1.delete("TMX").then(e,()=>alert("Failed to Reset Database"))},t.findAll=e=>new Promise((i,n)=>{const r=t.dex[e];return r?r.toArray(i,n).catch(n):i([])}),t.findAllTournaments=()=>t.findAll("tournaments"),t.findAllProviders=()=>t.findAll("providers"),t.findAllIdioms=()=>t.findAll("idioms"),t.findWhere=(e,i,n)=>new Promise((r,a)=>t.dex[e].where(i).equals(n).toArray(r,a).catch(a)),t.deleteTournament=e=>new Promise((i,n)=>{t.dex.tournaments.where("tournamentId").equals(e).delete().then(i,n)}),t.deleteProvider=e=>t.dex.providers.where("providerId").equals(e).delete(),t.deleteAllTournamentAttr=e=>t.dex.tournaments.toCollection().modify(i=>delete i[e]).then(()=>console.log("done")),t.findUnique=(e,i,n)=>new Promise((r,a)=>{t.findWhere(e,i,n).then(s=>r(s?.length?s[0]:void 0),a)}),t.findProvider=e=>t.findUnique("providers","providerId",e),t.findIdiom=e=>t.findUnique("idioms","ioc",e),t.findTournament=e=>t.findUnique("tournaments","tournamentId",e),t.findProviderTournaments=e=>t.findWhere("tournaments","providerId",e),t.addItem=(e,i)=>new Promise((n,r)=>t.dex[e].put(i).then(n,r).catch(a=>{alert("try again:"+a),r(a)})),t.modifyOrAddUnique=(e,i,n,r)=>new Promise((a,s)=>{t.dex[e].where(i).equals(n).modify(o=>Object.assign(o,r)).then(o=>{if(o)return a("exists");t.addItem(e,r).then(a,s)},o=>{console.log({err:o}),s(o)})}),t.addIdiom=e=>t.modifyOrAddUnique("idioms","ioc",e.ioc,e),t.addTournament=e=>t.modifyOrAddUnique("tournaments","tournamentId",e.tournamentId,e),t.addProvider=e=>t.modifyOrAddUnique("providers","providerId",e.providerId,e),t.modify=(e,i,n,r,a)=>new Promise((s,o)=>{t.dex[e].where(i).equals(n).modify(l=>{Object.assign(a,{item:l}),r(a)}).then(s,l=>{console.log("error:",l),o()})}),t})(),fK="@VERSION@",zi={socketIo:{tmx:"/tmx"},activeScale:"wtn",hotkeys:!1,scoring:!1,scales:{utr:{accessor:"utrRating",scaleType:"RATING",scaleColor:"blue",scaleName:"UTR",fallback:!0},wtn:{accessor:"wtnRating",scaleType:"RATING",scaleColor:"red",scaleName:"WTN",fallback:!0}},serverFirst:!0,version:fK,ioc:"gbr",locations:{geolocate:!0,geoposition:void 0,map:void 0,map_view:"satellite",map_provider:"leaflet"},leaflet:{map:{tileLayer:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://openstreetmap.org">OpenStreetMap</a> Contributors',maxZoom:18},satellite:{tileLayer:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri"}},scoreboard:{matchFormats:{categories:{},singles:"SET3-S:6/TB7",doubles:"SET3-S:6/TB7-F:TB10"},options:{bestof:[1,3,5],setsto:[4,6,8,9],tiebreaksto:[5,7,12],supertiebreakto:[7,10,21]},settings:{singles:{max_sets:3,sets_to_win:2,games_for_set:6,tiebreak_to:7,tiebreaks_at:6,supertiebreak_to:10,final_set_tiebreak:!0,final_set_supertiebreak:!1},doubles:{max_sets:3,sets_to_win:2,games_for_set:6,tiebreak_to:7,tiebreaks_at:6,supertiebreak_to:10,final_set_tiebreak:!1,final_set_supertiebreak:!0}}},printing:{pageSize:"A4"},schedule:{teams:!0,clubs:!0,time24:!0,ioc_codes:!1,default_time:"9:00",scores_in_draw_order:!0,completed_matches_in_search:!1,max_matches_per_court:14,court_identifiers:!0},messages:[],device:{}};async function mK(t){zi.log?.verbose&&console.log("%c localSave","color: yellow");const e=t?.tournamentRecord??nt.getTournament()?.tournamentRecord;await Hu.addTournament(e),Mt(t?.callback)&&t?.callback&&t.callback()}const gK=wge();function OEe(){localStorage.removeItem(gK)}function LEe(){return localStorage.getItem(gK)}function yJe(t){localStorage.setItem(gK,t)}function a2(t){const e=t.tournamentName?.toLowerCase()||"Error",i=t.onlineResources?.find(({name:r,resourceType:a})=>r==="tournamentImage"&&a==="URL")?.identifier,n=t.timeItems?.find(({itemType:r})=>r==="TMX")?.itemValue?.offline;return{tournamentId:t.tournamentId,id:t.tournamentId,searchText:e,tournament:{startDate:new Date(t.startDate).toISOString()?.split("T")[0],endDate:new Date(t.endDate).toISOString()?.split("T")[0],tournamentName:t.tournamentName,tournamentImageURL:i,offline:n}}}const Q0=t=>{let e;const i=Array.isArray(t)?t:[t];return n=>{if(e&&i.forEach(r=>r.removeFilter(e)),n){const r=n?.toLowerCase();e=a=>a.searchText?.includes(r),i.forEach(a=>a.addFilter(e))}else e=void 0}};function FEe({tournamentRecord:t,callback:e}){const i=tc()?.provider;i&&!t.parentOrganisation&&(t.parentOrganisation=i),mK({tournamentRecord:t,callback:e})}function bJe({callback:t,autoClose:e=!0}={}){const i=o=>{const l=o.name.split(".").reverse()[0],u=new FileReader;u.onload=function(c){if(c.target?.error){console.log("file error",c.target.error);return}const d=c.target?.result;d.length&&(Mt(t)&&t?t(d):console.log(d))},["csv","json"].includes(l)?u.readAsText(o):console.log("not loaded")},n=document.createElement("div");n.className="dzx-dropzone",n.id="tmxDropzone";const r=document.createElement("label");r.className="dzx-inputLabel",r.innerHTML="Drag and Drop files into this zone";const a=document.createElement("input");a.className="dzx-input",a.setAttribute("type","file"),a.setAttribute("accept","application/json"),r.appendChild(a),n.appendChild(r),Yn({buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Done"}],title:"Import tournament records",content:n}),["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(o=>{n.addEventListener(o,function(l){l.preventDefault(),l.stopPropagation()})});const s="dropone-dragging";n.addEventListener("dragover",function(){this.classList.add(s)},!1),n.addEventListener("dragleave",function(){this.classList.remove(s)},!1),n.addEventListener("drop",function(o){this.classList.remove(s);const l=o.dataTransfer.files,u=new DataTransfer;Array.prototype.forEach.call(l,d=>{u.items.add(d)});const c=u.files;Array.from(c).forEach(i),e&&Aw()},!1)}function $Ee({note:t,data:e}){try{return JSON.parse(e)}catch{console.log({message:"failed normal parse",note:t})}}function IJe(t){if(t){if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return""}}}function wJe({table:t}){const e=t.getData().map(i=>i.tournamentId);bJe({callback:i=>{const n=$Ee({data:i});if(n){let r,a;n.tournamentId&&n.startDate?a=n:n.tuid&&n.start&&Ht({message:"TMX Classic file not converted"}),r=nt.setState(a),r.success?PN({tournamentRecord:a,tournamentIds:e,table:t}):console.log(r)}}})}function PN({tournamentRecord:t,tournamentIds:e,table:i,callback:n}){const r=a2(t);e?.includes(t.tournamentId)?i?.updateOrAddData([r],!0):i?.addData([r],!0),FEe({tournamentRecord:t}),Mt(n)&&n&&n()}const It={matchUpsToBroadcast:[],tables:[],ee:null,drawer:null,modal:null,state:{authorized:!1,admin:!1},displayed:{selectedScheduleDate:null,draw_event:null},columns:{}};function SJe({table:t}){const e=t.getData().map(u=>u.tournamentId);let i;const r=[{control:"identifier",onInput:({inputs:u})=>{const d=u.identifier.value.length>10,p=document.getElementById("fetchButton");p&&(p.disabled=!d)}}],a=u=>i=mr(u,[{iconLeft:"fa-solid fa-fingerprint",placeholder:"Identifier",label:"identifier",field:"identifier"}],r),s=()=>{Ht({onClose:()=>It.router.navigate("/tournaments"),message:"Tournament not found",intent:"is-warning",pauseOnHover:!0,action:"show"})},o=u=>{const c=u?.data?.tournamentRecord,d=u?.data?.tournamentId,p=e.includes(d);p?console.log({exists:p}):PN({tournamentRecord:c,tournamentIds:e,table:t,callback:()=>{}})};Yn({title:"Fetch tournament details",content:a,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Fetch",id:"fetchButton",disabled:!0,intent:"is-primary",onClick:()=>{const u=i.identifier.value;_He({identifier:u}).then(o,s)},close:!0}]})}function TJe({table:t}){const e=t.getData().map(o=>o.tournamentId);let i;const n=o=>i=mr(o,[{iconLeft:"fa-solid fa-fingerprint",placeholder:"tournamentId",label:"Tournament Id",field:"tournamentId"}]),r=()=>{Ht({onClose:()=>It.router.navigate("/tournaments"),message:"Tournament not found",intent:"is-warning",pauseOnHover:!0,action:"show"})},a=o=>{const l=i.tournamentId.value,u=o.data.tournamentRecords?.[l];PN({tournamentRecord:u,tournamentIds:e,table:t,callback:()=>{}})};Yn({title:"Load tournament",content:n,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Load",intent:"is-primary",onClick:()=>{const o=i.tournamentId.value;JF({tournamentId:o}).then(a,r)},close:!0}]})}function Mee(t){return Mi.dateTime.dateValidation.test(t)}const Vr=(t,e)=>i=>i?.trim().length>=t&&(!e||i?.trim().length<=e);function eS(t,e,i){if(!t)return{elements:{}};const n={};for(const r of e||[]){if(!r?.label||r.hide)continue;const a=document.createElement("button");r.id&&(n[r.id]=a,a.id=r.id),a.style.marginRight=".5em",a.className="button font-medium",r.intent&&a.classList.add(r.intent),a.innerHTML=r.label,r.disabled&&(a.disabled=!0),a.onclick=s=>{s.stopPropagation(),!s.target.disabled&&Mt(r.onClick)&&r.onClick(),i&&Mt(i)&&i()},t.appendChild(a)}return{elements:n}}function yb(t,e){const i=Array.from(t.classList).indexOf(e);return{parent:i>=0?t:jl(t,e),index:i>=0?i:-1}}function jl(t,e){if(!t)return null;if(t.classList&&Array.from(t.classList).indexOf(e)>=0)return t;for(;t.parentNode;)if(t=t.parentNode,t.classList&&Array.from(t.classList).indexOf(e)>=0)return t;return null}function PE(t,e,i){return jl(t,e)?.getAttribute(i)||""}function dv(t,e){const i=[];function n(r){r.childNodes.forEach(a=>{a.childNodes.length>0&&n(a),a.classList&&Array.from(a.classList).indexOf(e)>=0&&i.push(a)})}return n(t),i}const UJe="addCourts",DJe="addFlight",EJe="addDrawDefinition",BEe="addAdHocMatchUps",PJe="addDrawEntries",CJe="addDrawDefinitionExtension",RJe="addDynamicRatings",MJe="addEvent",vK="addEventEntries",NJe="addEventEntryPairs",AJe="addEventExtension",VEe="addIndividualParticipantIds",pz="addMatchUpScheduleItems",_Je="addOnlineResource",CN="addParticipants",Nee="addParticipantTimeItem",jEe="addPlayoffStructures",kJe="addTournamentExtension",xJe="addTournamentTimeItem",OJe="addVenue",LJe="attachQualifyingStructure",FJe="attachPolicies",$Je="automatedPlayoffPositioning",yK="bulkScheduleMatchUps",GEe="deleteAdHocMatchUps",Aee="deleteFlightAndFlightDraw",_ee="deleteEvents",BJe="deleteParticipants",VJe="deleteVenues",jJe="destroyPairEntries",HEe="modifyCourt",GJe="modifyEvent",zEe="modifyEntriesStatus",$x="modifyParticipant",bK="modifyParticipantsSignInStatus",HJe="modifyTieFormmat",zJe="modifyVenue",qJe="proAutoSchedule",qEe="publishEvent",WJe="removeIndividualParticipantIds",YJe="removeStructure",WEe="renameStructures",KJe="resetDrawDefinition",YEe="resetMatchUpLinesUps",KEe="resetScorecard",ZJe="setMatchUpFormat",IK="setMatchUpStatus",XJe="setParticipantScaleItems",JJe="setTournamentDates",QJe="setTournamentName",eQe="setTournamentNotes",tQe="unPublishEvent";function ZEe({table:t,tournamentRecord:e}){const i={activeDates:(e?.activeDates||[]).join(","),tournamentName:e?.tournamentName||"",startDate:e?.startDate||"",endDate:e?.endDate||""};let n;const r=[{error:"minimum of 5 characters",placeholder:"Tournament name",value:i.tournamentName,validator:Vr(5),label:"Tournament name",field:"tournamentName",focus:!0},{placeholder:"YYYY-MM-DD",value:i.startDate,label:"Start date",field:"startDate"},{placeholder:"YYYY-MM-DD",value:i.endDate,label:"End date",field:"endDate"},{visible:!i.activeDates.length,label:"Select active dates",field:"activeDateSelector",id:"activeDateSelector",checkbox:!0},{visible:!!i.activeDates.length,value:i.activeDates||[],placeholder:"[datesArray]",minDate:i.startDate,maxDate:i.endDate,label:"Active Dates",maxNumberOfDates:10,field:"activeDates",id:"activeDates",date:!0}],a=({tournamentName:g,startDate:v,endDate:y})=>Vr(5)(g)&&Mee(v)&&Mee(y),s=({inputs:g})=>{const v=g.activeDates.value,y=g.startDate.value,b=g.endDate.value,I=a({tournamentName:g.tournamentName.value,startDate:y,endDate:b});v&&(g.activeDates.value=v.split(",").filter(w=>!(y&&new Date(w)<new Date(y)||b&&new Date(w)>new Date(b))).filter(Boolean).join(",")),y&&g.activeDates.datepicker.setOptions({minDate:y}),b&&g.activeDates.datepicker.setOptions({maxDate:b});const S=document.getElementById("saveTournamentEdits");S&&(S.disabled=!I)},l=[{fields:["startDate","endDate"],dateRange:!0},{control:"tournamentName",onInput:s},{onFocusOut:s,control:"startDate"},{onFocusOut:s,control:"endDate"},{onChange:({inputs:g})=>{const v=g.activeDateSelector.checked,y=document.getElementById("activeDates"),b=yb(y,"field");b?.parent&&(b.parent.style.display=v?"block":"none")},control:"activeDateSelector"}],u=g=>{n=mr(g,r,l),n.activeDates?.datepicker?.update()},c=()=>Vr(5)(n.drawName.value),d=()=>{const g=n.activeDates.value?.split(",").filter(Boolean),v=n.tournamentName.value?.trim(),y=n.startDate.value,b=n.endDate.value;if(e){const I={...e,tournamentName:v,activeDates:g,startDate:y,endDate:b};Wt({tournamentRecord:I,methods:[{method:JJe,params:{activeDates:g,startDate:y,endDate:b}},{method:QJe,params:{tournamentName:v}}],callback:T=>{T.success?t?.updateData([a2(I)],!0):console.log({result:T})}})}else if(nt.newTournamentRecord({tournamentName:v,startDate:y,endDate:b}).success){const S=tc(),w=nt.getTournament()?.tournamentRecord;if(S?.providerId){const T=U=>{const C=U.data?.provider;if(w.parentOrganisation=C,C){const E=P=>console.log("sendTournament",P);wP({tournamentRecord:w}).then(()=>{},E)}kee({tournamentRecord:w,table:t})};OHe({providerId:S.providerId}).then(T)}else kee({tournamentRecord:w,table:t})}},p=e?"Save":"Add",h=[{label:"Cancel",intent:"none",close:!0},{disabled:!a(i),id:"saveTournamentEdits",label:p,intent:"is-primary",onClick:d,close:c}],f=(g,v)=>eS(g,h,v),m=e?"Edit tournament":"New tournament";It.drawer.open({title:m,content:u,footer:f,side:ti,width:"300px"})}function kee({tournamentRecord:t,table:e}){PN({tournamentRecord:t,callback:()=>e?.addData([a2(t)],!0)})}const qV="font-medium";function hz({target:t,button:e,stateChange:i}){let n=0;const r=()=>(n+=1,`Item${n}`),a=document.createElement("div");e.class&&a.classList.add(e.class),a.classList.add("dropdown"),e.id&&(a.id=e.id),e.align===ti?(a.classList.add("is-right"),a.style.cssText="margin-left: 1em"):a.style.cssText="margin-right: 1em";const s=v=>v.classList.contains("is-active"),o=()=>{s(a)&&a.classList.remove("is-active")},l=v=>s(v)?(v.classList.remove("is-active"),!1):(v.classList.add("is-active"),!0);a.onmouseleave=o,a.onclick=()=>l(a);const u=document.createElement("div");u.classList.add("dropdown-trigger");const c=document.createElement("button");c.className="button font-medium",e.intent&&c.classList.add(e.intent),c.setAttribute("aria-haspopup","true");const d=document.createElement("span");Mt(e.onClick)&&(d.onclick=e.onClick),d.style.cssText="margin-right: 1em",d.innerHTML=e.label,c.appendChild(d);const p=document.createElement("span");Mt(e.onClick)&&(p.onclick=e.onClick),p.innerHTML=`
      <span class="icon is-small font-medium">
        <i class="fas fa-angle-down font-medium" aria-hidden="true"></i>
      </span>
  `,c.appendChild(p),u.appendChild(c),a.appendChild(u);const h=document.createElement("div");h.classList.add("dropdown-menu"),h.setAttribute("z-index","99998");const f=document.createElement("div");f.classList.add("dropdown-content");const m=()=>{const v=h.querySelectorAll(".dropdown-item");for(const y of Array.from(v))y.classList.remove("is-active")},g=v=>{const y=document.createElement("a");y.className=qV;const b=v.disabled?"0.4":"1";return y.style.cssText=`text-decoration: none; opacity: ${b};`,v.color&&(y.style.color=v.color),y.classList.add("dropdown-item"),v.isActive&&y.classList.add("is-active"),v.value&&(y.value=v.value),v.class&&y.classList.add(v.class),y.onclick=I=>{if(v.disabled)return;v.value&&(c.value=v.value,a.value=v.value),I.stopPropagation(),Mt(v.onClick)&&(Mt(i)&&i(),v.onClick(I)),v.close&&o();const S=s(y);m(),S?d.innerHTML=e.label:(e.selection&&l(y),e.modifyLabel&&v.modifyLabel!==!1&&(d.innerHTML=`${e.append?e.label+": ":""}${v?.label||r()}`))},y.innerHTML=v?.label||r(),y};for(const v of e.options||[])if(v.heading){const y=document.createElement("div");y.style.cssText="font-weight: bold",y.classList.add("dropdown-item"),y.classList.add(qV),y.innerHTML=v.heading,f.appendChild(y)}else if(v.divider){const y=document.createElement("hr");y.classList.add("dropdown-divider"),y.classList.add(qV),f.appendChild(y)}else v.hide||f.appendChild(g(v));return e.options?.length&&(e.options[0].value&&(a.value=e.options[0].value),h.appendChild(f)),a.appendChild(h),t&&t.appendChild(a),a}class Hl{constructor(e){this.table=e}reloadData(e,i,n){return this.table.dataLoader.load(e,void 0,void 0,void 0,i,n)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,i){return typeof i<"u"&&(this.table.options[e]=i),this.table.options[e]}deprecationCheck(e,i,n){return this.table.deprecationAdvisor.check(e,i,n)}deprecationCheckMsg(e,i){return this.table.deprecationAdvisor.checkMsg(e,i)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class Ia{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var i=e.getBoundingClientRect();return{top:i.top+window.pageYOffset-document.documentElement.clientTop,left:i.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,i,n){var r=e?i.split(e):[i],a=r.length,s;for(let o=0;o<a&&(n=n[r[o]],s=n,!!n);o++);return s}static deepClone(e,i,n=[]){var r={}.__proto__,a=[].__proto__;i||(i=Object.assign(Array.isArray(e)?[]:{},e));for(var s in e){let o=e[s],l,u;o!=null&&typeof o=="object"&&(o.__proto__===r||o.__proto__===a)&&(l=n.findIndex(c=>c.subject===o),l>-1?i[s]=n[l].copy:(u=Object.assign(Array.isArray(o)?[]:{},o),n.unshift({subject:o,copy:u}),i[s]=this.deepClone(o,u,n)))}return i}}let iQe=class XEe extends Hl{constructor(e,i,n){super(e),this.element=i,this.container=this._lookupContainer(),this.parent=n,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,i=this.table.element){return e===i?!0:i.parentNode?this._checkContainerIsParent(e,i.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var i=!(e instanceof MouseEvent),n=i?e.touches[0].pageX:e.pageX,r=i?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let a=Ia.elOffset(this.container);n-=a.left,r-=a.top}return{x:n,y:r}}elementPositionCoords(e,i="right"){var n=Ia.elOffset(e),r,a,s;switch(this.container!==document.body&&(r=Ia.elOffset(this.container),n.left-=r.left,n.top-=r.top),i){case"right":a=n.left+e.offsetWidth,s=n.top-1;break;case"bottom":a=n.left,s=n.top+e.offsetHeight;break;case"left":a=n.left,s=n.top-1;break;case"top":a=n.left,s=n.top;break;case"center":a=n.left+e.offsetWidth/2,s=n.top+e.offsetHeight/2;break}return{x:a,y:s,offset:n}}show(e,i){var n,r,a,s,o;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(a=e,o=this.elementPositionCoords(e,i),s=o.offset,n=o.x,r=o.y):typeof e=="number"?(s={top:0,left:0},n=e,r=i):(o=this.containerEventCoords(e),n=o.x,r=o.y,this.reversedX=!1),this.element.style.top=r+"px",this.element.style.left=n+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(n,r,a,s,i),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,i,n,r,a){var s=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;(e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",n?this.element.style.right=this.container.offsetWidth-r.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0);let o=Math.max(this.container.offsetHeight,s?this.container.scrollHeight:0);if(i+this.element.offsetHeight>o)if(n)switch(a){case"bottom":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-n.offsetHeight-1+"px";break;default:this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+n.offsetHeight+1+"px"}else this.element.style.height=o+"px"}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new XEe(this.table,e,this),this.childPopup}},Vn=class extends Hl{constructor(e,i){super(e),this._handler=null}initialize(){}registerTableOption(e,i){this.table.optionsList.register(e,i)}registerColumnOption(e,i){this.table.columnManager.optionsList.register(e,i)}registerTableFunction(e,i){typeof this.table[e]>"u"?this.table[e]=(...n)=>(this.table.initGuard(e),i(...n)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,i,n){return this.table.componentFunctionBinder.bind(e,i,n)}registerDataHandler(e,i){this.table.rowManager.registerDataPipelineHandler(e,i),this._handler=e}registerDisplayHandler(e,i){this.table.rowManager.registerDisplayPipelineHandler(e,i),this._handler=e}displayRows(e){var i=this.table.rowManager.displayRows.length-1,n;if(this._handler&&(n=this.table.rowManager.displayPipeline.findIndex(r=>r.handler===this._handler),n>-1&&(i=n)),e&&(i=i+e),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,i){i||(i=this._handler),i&&this.table.rowManager.refreshActiveData(i,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,i){return new iQe(this.table,e,i)}alert(e,i){return this.table.alertManager.alert(e,i)}clearAlert(){return this.table.alertManager.clear()}};var nQe={rownum:function(t,e,i,n,r,a){return a.getPosition()}};class Bx extends Vn{static moduleName="accessor";static accessors=nQe;constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var i=!1,n={};this.allowedTypes.forEach(r=>{var a="accessor"+(r.charAt(0).toUpperCase()+r.slice(1)),s;e.definition[a]&&(s=this.lookupAccessor(e.definition[a]),s&&(i=!0,n[a]={accessor:s,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.accessor=n)}lookupAccessor(e){var i=!1;switch(typeof e){case"string":Bx.accessors[e]?i=Bx.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i){var n="accessor"+(i.charAt(0).toUpperCase()+i.slice(1)),r=e.getComponent(),a=Ia.deepClone(e.data||{});return this.table.columnManager.traverse(function(s){var o,l,u,c;s.modules.accessor&&(l=s.modules.accessor[n]||s.modules.accessor.accessor||!1,l&&(o=s.getFieldValue(a),o!="undefined"&&(c=s.getComponent(),u=typeof l.params=="function"?l.params(o,a,i,c,r):l.params,s.setFieldValue(a,l.accessor(o,a,i,u,c,r)))))}),a}}var rQe={method:"GET"};function fz(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((r,a)=>{i=i.concat(fz(r,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var n in t)i=i.concat(fz(t[n],e?e+"["+n+"]":n));else i.push({key:e,value:t});return i}function aQe(t){var e=fz(t),i=[];return e.forEach(function(n){i.push(encodeURIComponent(n.key)+"="+encodeURIComponent(n.value))}),i.join("&")}function JEe(t,e,i){return t&&i&&Object.keys(i).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",t+=(t.includes("?")?"&":"?")+aQe(i)),t}function sQe(t,e,i){var n;return new Promise((r,a)=>{if(t=this.urlGenerator.call(this.table,t,e,i),e.method.toUpperCase()!="GET")if(n=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],n){for(var s in n.headers)e.headers||(e.headers={}),typeof e.headers[s]>"u"&&(e.headers[s]=n.headers[s]);e.body=n.body.call(this,t,e,i)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);t?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(t,e).then(o=>{o.ok?o.json().then(l=>{r(l)}).catch(l=>{a(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+o.status,o.statusText),a(o))}).catch(o=>{console.error("Ajax Load Error - Connection Error: ",o),a(o)})):(console.warn("Ajax Load Error - No URL Set"),r([]))})}function mz(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((r,a)=>{i=i.concat(mz(r,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var n in t)i=i.concat(mz(t[n],e?e+"["+n+"]":n));else i.push({key:e,value:t});return i}var oQe={json:{headers:{"Content-Type":"application/json"},body:function(t,e,i){return JSON.stringify(i)}},form:{headers:{},body:function(t,e,i){var n=mz(i),r=new FormData;return n.forEach(function(a){r.append(a.key,a.value)}),r}}};class nT extends Vn{static moduleName="ajax";static defaultConfig=rQe;static defaultURLGenerator=JEe;static defaultLoaderPromise=sQe;static contentTypeFormatters=oQe;constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=nT.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||nT.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||nT.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,i,n,r){var a=this.table.options.ajaxParams;return a&&(typeof a=="function"&&(a=a.call(this.table)),r=Object.assign(Object.assign({},a),r)),r}requestDataCheck(e,i,n,r){return!!(!e&&this.url||typeof e=="string")}requestData(e,i,n,r,a){var s;return!a&&this.requestDataCheck(e)?(e&&this.setUrl(e),s=this.generateConfig(n),this.sendRequest(this.url,i,s)):a}setDefaultConfig(e={}){this.config=Object.assign({},nT.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var i=Object.assign({},this.config);return typeof e=="string"?i.method=e:Object.assign(i,e),i}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,i,n){return this.table.options.ajaxRequesting.call(this.table,e,i)!==!1?this.loaderPromise(e,n,i).then(r=>(this.table.options.ajaxResponse&&(r=this.table.options.ajaxResponse.call(this.table,e,i,r)),r)):Promise.reject()}}var lQe={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)}},uQe={table:function(t){var e=[],i=!0,n=this.table.columnManager.columns,r=[],a=[];return t=t.split(`
`),t.forEach(function(s){e.push(s.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(s){var o=n.find(function(l){return s&&l.definition.title&&s.trim()&&l.definition.title.trim()===s.trim()});o?r.push(o):i=!1}),i||(i=!0,r=[],e[0].forEach(function(s){var o=n.find(function(l){return s&&l.field&&s.trim()&&l.field.trim()===s.trim()});o?r.push(o):i=!1}),i||(r=this.table.columnManager.columnsByIndex)),i&&e.shift(),e.forEach(function(s){var o={};s.forEach(function(l,u){r[u]&&(o[r[u].field]=l)}),a.push(o)}),a):!1}},cQe={copyToClipboard:["ctrl + 67","meta + 67"]},dQe={copyToClipboard:function(t){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}},pQe={keybindings:{bindings:cQe,actions:dQe}};let hQe=class gz extends Vn{static moduleName="clipboard";static moduleExtensions=pQe;static pasteActions=lQe;static pasteParsers=uQe;constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var i,n,r;this.blocked||(e.preventDefault(),this.customSelection?(i=this.customSelection,this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i))):(r=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),n=this.table.modules.export.generateHTMLTable(r),i=n?this.generatePlainContent(r):"",this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i),n=this.table.options.clipboardCopyFormatter("html",n))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",i):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",i),n&&e.clipboardData.setData("text/html",n)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",i),n&&e.originalEvent.clipboardData.setData("text/html",n)),this.dispatchExternal("clipboardCopied",i,n),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var i=[];return e.forEach(n=>{var r=[];n.columns.forEach(a=>{var s="";if(a)if(n.type==="group"&&(a.value=a.component.getKey()),a.value===null)s="";else switch(typeof a.value){case"object":s=JSON.stringify(a.value);break;case"undefined":s="";break;default:s=a.value}r.push(s)}),i.push(r.join("	"))}),i.join(`
`)}copy(e,i){var n,r;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),n=window.getSelection(),n.toString()&&i&&(this.customSelection=n.toString()),n.removeAllRanges(),n.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(r=document.body.createTextRange(),r.moveToElementText(this.table.element),r.select()),document.execCommand("copy"),n&&n.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=gz.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=gz.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var i,n,r;this.checkPasteOrigin(e)&&(i=this.getPasteData(e),n=this.pasteParser.call(this,i),n?(e.preventDefault(),this.table.modExists("mutator")&&(n=this.mutateData(n)),r=this.pasteAction.call(this,n),this.dispatchExternal("clipboardPasted",i,n,r)):this.dispatchExternal("clipboardPasteError",i))}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(n=>{i.push(this.table.modules.mutator.transformRow(n,"clipboard"))}):i=e,i}checkPasteOrigin(e){var i=!0,n=this.confirm("clipboard-paste",[e]);return(n||!["DIV","SPAN"].includes(e.target.tagName))&&(i=!1),i}getPasteData(e){var i;return window.clipboardData&&window.clipboardData.getData?i=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?i=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(i=e.originalEvent.clipboardData.getData("text/plain")),i}};class fQe{constructor(e){return this._row=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._row.table.componentFunctionBinder.handle("row",i._row,n)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}_getSelf(){return this._row}}class QEe{constructor(e){return this._cell=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._cell.table.componentFunctionBinder.handle("cell",i._cell,n)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,i){typeof i>"u"&&(i=!0),this._cell.setValue(e,i)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class RN extends Hl{constructor(e,i){super(e.table),this.table=e.table,this.column=e,this.row=i,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell"),this.column.isRowHeader&&this.element.classList.add("tabulator-row-header")}_configureCell(){var e=this.element,i=this.column.getField(),n={top:"flex-start",bottom:"flex-end",middle:"center"},r={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=n[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=r[this.column.hozAlign]||"")),i&&e.setAttribute("tabulator-field",i),this.column.definition.cssClass){var a=this.column.definition.cssClass.split(" ");a.forEach(s=>{e.classList.add(s)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,i,n){var r=this.setValueProcessData(e,i,n);r&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,i,n){var r=!1;return(this.value!==e||n)&&(r=!0,i&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),r&&this.dispatch("cell-value-changed",this),r}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new QEe(this)),this.component}}class ePe{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._column.table.componentFunctionBinder.handle("column",i._column,n)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(i){e.push(i.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(i){e.push(i.getComponent())}),e}getParentColumn(){return this._column.getParentComponent()}_getSelf(){return this._column}scrollTo(e,i){return this._column.table.columnManager.scrollToColumn(this._column,e,i)}getTable(){return this._column.table}move(e,i){var n=this._column.table.columnManager.findColumn(e);n?this._column.table.columnManager.moveColumn(this._column,n,i):console.warn("Move Error - No matching column found:",n)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var i;return e===!0?i=this._column.reinitializeWidth(!0):i=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),i}}var tPe={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};class Zf extends Hl{static defaultOptionList=tPe;constructor(e,i,n){super(i.table),this.definition=e,this.parent=i,this.type="column",this.columns=[],this.cells=[],this.isGroup=!1,this.isRowHeader=n,this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((r,a)=>{var s=new Zf(r,this);this.attachColumn(s)}),this.checkColumnVisibility()):i.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.isRowHeader&&e.classList.add("tabulator-row-header"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let i in e)typeof this.definition[i]>"u"&&(this.definition[i]=e[i]);this.definition=this.table.columnManager.optionsList.generate(Zf.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{Zf.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var i=e.cssClass.split(" ");i.forEach(n=>{this.element.classList.add(n)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,i=document.createElement("div");if(i.classList.add("tabulator-col-title"),e.headerWordWrap&&i.classList.add("tabulator-col-title-wrap"),e.editableTitle){var n=document.createElement("input");n.classList.add("tabulator-title-editor"),n.addEventListener("click",r=>{r.stopPropagation(),n.focus()}),n.addEventListener("mousedown",r=>{r.stopPropagation()}),n.addEventListener("change",()=>{e.title=n.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),i.appendChild(n),e.field?this.langBind("columns|"+e.field,r=>{n.value=r||e.title||"&nbsp;"}):n.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,r=>{this._formatColumnHeaderTitle(i,r||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(i,e.title||"&nbsp;");return i}_formatColumnHeaderTitle(e,i){var n=this.chain("column-format",[this,i,e],null,()=>i);switch(typeof n){case"object":n instanceof Node?e.appendChild(n):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",n));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=n}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(i=>{this.element.classList.add(i)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var i=e,n=this.fieldStructure,r=n.length,a;for(let s=0;s<r&&(i=i[n[s]],a=i,!!i);s++);return a}_setFlatData(e,i){this.field&&(e[this.field]=i)}_setNestedData(e,i){var n=e,r=this.fieldStructure,a=r.length;for(let s=0;s<a;s++)if(s==a-1)n[r[s]]=i;else{if(!n[r[s]])if(typeof i<"u")n[r[s]]={};else break;n=n[r[s]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,i){var n=this.parent.isGroup?this.parent.getGroupElement().clientHeight:i||this.parent.getHeadersElement().clientHeight;this.element.style.height=n+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=n-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(r){r.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var i=[];return e?this.columns.forEach(n=>{i.push(n),i=i.concat(n.getColumns(!0))}):i=this.columns,i}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var i=[];return this.isGroup&&e&&(this.columns.forEach(function(n){i.push(n.getDefinition(!0))}),this.definition.columns=i),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(i){i.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,i){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(n){n.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,i){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(n){n.hide()}),this.dispatch("column-hide",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.table.initialized&&(this.element.style.width=e+"px"),this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var i=this.columns.indexOf(e);i>-1&&this.columns.splice(i,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(i){i.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this),this.subscribedExternal("columnWidth")&&this.dispatchExternal("columnWidth",this.getComponent())}checkCellHeights(){var e=[];this.cells.forEach(function(i){i.row.heightInitialized&&(i.row.getElement().offsetParent!==null?(e.push(i.row),i.row.clearCellHeight()):i.row.heightInitialized=!1)}),e.forEach(function(i){i.calcHeight()}),e.forEach(function(i){i.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(i){i.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(i){i.setMaxWidth()})}delete(){return new Promise((e,i)=>{this.isGroup&&this.columns.forEach(function(r){r.delete()}),this.dispatch("column-delete",this);var n=this.cells.length;for(let r=0;r<n;r++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var i=new RN(this,e);return this.cells.push(i),i}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(r=>{r.clearWidth()}));var i=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(r=>{var a=r.getWidth();a>i&&(i=a)}),i)){var n=i+1;e?this.setWidth(n):(this.maxInitialWidth&&!e&&(n=Math.min(n,this.maxInitialWidth)),this.setWidthActual(n))}}}updateDefinition(e){var i;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(i=Object.assign({},this.getDefinition()),i=Object.assign(i,e),this.table.columnManager.addColumn(i,!1,this).then(n=>(i.field==this.field&&(this.field=!1),this.delete().then(()=>n.getComponent()))))}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}getComponent(){return this.component||(this.component=new ePe(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}getParentComponent(){return this.parent instanceof Zf?this.parent.getComponent():!1}}class s2{constructor(e){return this._row=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._row.table.componentFunctionBinder.handle("row",i._row,n)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,i){return this._row.table.rowManager.scrollToRow(this._row,e,i)}move(e,i){this._row.moveToRow(e,i)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class tu extends Hl{constructor(e,i,n="row"){super(i.table),this.parent=i,this.data={},this.type=n,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,i){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,i),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,i)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var i=0,n=0;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(n=this.calcMinHeight(),i=this.calcMaxHeight(),e?this.height=Math.max(i,n):this.height=this.manualHeight?this.height:Math.max(i,n)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}calcMinHeight(){return this.table.options.resizableRows?this.element.clientHeight:0}calcMaxHeight(){var e=0;return this.cells.forEach(function(i){var n=i.getHeight();n>e&&(e=n)}),e}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,i){(this.height!=e||i)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight,this.subscribedExternal("rowHeight")&&this.dispatchExternal("rowHeight",this.getComponent()))}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var i=this.element&&Ia.elVisible(this.element),n={},r;return new Promise((a,s)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(n=Object.assign(n,this.data),n=Object.assign(n,e)),r=this.chain("row-data-changing",[this,n,e],null,e);for(let o in r)this.data[o]=r[o];this.dispatch("row-data-save-after",this);for(let o in e)this.table.columnManager.getColumnsByFieldRoot(o).forEach(u=>{let c=this.getCell(u.getField());if(c){let d=u.getFieldValue(r);c.getValue()!==d&&(c.setValueProcessData(d),i&&c.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),a()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var i=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),i=this.cells.find(function(n){return n.column===e}),i}getCellIndex(e){return this.cells.findIndex(function(i){return i===e})}findCell(e){return this.cells.find(i=>i.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,i){var n=this.table.rowManager.findRow(e);n?(this.table.rowManager.moveRowActual(this,n,!i),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let i=0;i<e;i++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(i=>{i(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new s2(this)),this.component}}var mQe={avg:function(t,e,i){var n=0,r=typeof i.precision<"u"?i.precision:2;return t.length&&(n=t.reduce(function(a,s){return Number(a)+Number(s)}),n=n/t.length,n=r!==!1?n.toFixed(r):n),parseFloat(n).toString()},max:function(t,e,i){var n=null,r=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a>n||n===null)&&(n=a)}),n!==null?r!==!1?n.toFixed(r):n:""},min:function(t,e,i){var n=null,r=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a<n||n===null)&&(n=a)}),n!==null?r!==!1?n.toFixed(r):n:""},sum:function(t,e,i){var n=0,r=typeof i.precision<"u"?i.precision:!1;return t.length&&t.forEach(function(a){a=Number(a),n+=isNaN(a)?0:Number(a)}),r!==!1?n.toFixed(r):n},concat:function(t,e,i){var n=0;return t.length&&(n=t.reduce(function(r,a){return String(r)+String(a)})),n},count:function(t,e,i){var n=0;return t.length&&t.forEach(function(r){r&&n++}),n},unique:function(t,e,i){var n=t.filter((r,a)=>(t||r===0)&&t.indexOf(r)===a);return n.length}};class rT extends Vn{static moduleName="columnCalcs";static calculations=mQe;constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new Zf({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,i){return this.topRow&&i.unshift(this.topRow),this.botRow&&i.push(this.botRow),i}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var i=e.definition,n={topCalcParams:i.topCalcParams||{},botCalcParams:i.bottomCalcParams||{}};if(i.topCalc){switch(typeof i.topCalc){case"string":rT.calculations[i.topCalc]?n.topCalc=rT.calculations[i.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.topCalc);break;case"function":n.topCalc=i.topCalc;break}n.topCalc&&(e.modules.columnCalcs=n,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(i.bottomCalc){switch(typeof i.bottomCalc){case"string":rT.calculations[i.bottomCalc]?n.botCalc=rT.calculations[i.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.bottomCalc);break;case"function":n.botCalc=i.bottomCalc;break}n.botCalc&&(e.modules.columnCalcs=n,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var i,n;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(i=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),n=this.generateRow("top",i),this.topRow=n;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(n.getElement()),n.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),n=this.generateRow("bottom",i),this.botRow=n;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(n.getElement()),n.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(i=>{this.recalcGroup(i)})}}recalcGroup(e){var i,n;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(i=this.rowsToData(e.rows),n=this.generateRowData("bottom",i),e.calcs.bottom.updateData(n),e.calcs.bottom.reinitialize()),e.calcs.top&&(i=this.rowsToData(e.rows),n=this.generateRowData("top",i),e.calcs.top.updateData(n),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var i=[],n=this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs,r=this.table.modules.dataTree;return e.forEach(a=>{i.push(a.getData()),n&&a.modules.dataTree?.open&&this.rowsToData(r.getFilteredTreeChildren(a)).forEach(s=>{i.push(a)})}),i}generateRow(e,i){var n=this.generateRowData(e,i),r;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),r=new tu(n,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),r.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),r.component=!1,r.getComponent=()=>(r.component||(r.component=new fQe(r)),r.component),r.generateCells=()=>{var a=[];this.table.columnManager.columnsByIndex.forEach(s=>{this.genColumn.setField(s.getField()),this.genColumn.hozAlign=s.hozAlign,s.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.lookupFormatter(s.definition[e+"CalcFormatter"]),params:s.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.lookupFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=s.definition.cssClass;var o=new RN(this.genColumn,r);o.getElement(),o.column=s,o.setWidth(),s.cells.push(o),a.push(o),s.visible||o.hide()}),r.cells=a},r}generateRowData(e,i){var n={},r=e=="top"?this.topCalcs:this.botCalcs,a=e=="top"?"topCalc":"botCalc",s,o;return r.forEach(function(l){var u=[];l.modules.columnCalcs&&l.modules.columnCalcs[a]&&(i.forEach(function(c){u.push(l.getFieldValue(c))}),o=a+"Params",s=typeof l.modules.columnCalcs[o]=="function"?l.modules.columnCalcs[o](u,i):l.modules.columnCalcs[o],l.setFieldValue(n,l.modules.columnCalcs[a](u,i,s)))}),n}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},i;return this.table.options.groupBy&&this.table.modExists("groupRows")?(i=this.table.modules.groupRows.getGroups(!0),i.forEach(n=>{e[n.getKey()]=this.getGroupResults(n)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var i=e._getSelf(),n=e.getSubGroups(),r={},a={};return n.forEach(s=>{r[s.getKey()]=this.getGroupResults(s)}),a={top:i.calcs.top?i.calcs.top.getData():{},bottom:i.calcs.bottom?i.calcs.bottom.getData():{},groups:r},a}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}}class gQe extends Vn{static moduleName="dataTree";constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,i=this.table.options;switch(this.field=i.dataTreeChildField,this.indent=i.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),i.dataTreeBranchElement?i.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof i.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=i.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),i.dataTreeCollapseElement?typeof i.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=i.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),i.dataTreeExpandElement?typeof i.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=i.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof i.dataTreeStartExpanded){case"boolean":this.startOpen=function(n,r){return i.dataTreeStartExpanded};break;case"function":this.startOpen=i.dataTreeStartExpanded;break;default:this.startOpen=function(n,r){return i.dataTreeStartExpanded[r]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var i;e&&(i=this.table.rowManager.getRows(),i.forEach(n=>{this.reinitializeRowChildren(n)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(i=>{e=e.concat(this.getTreeChildren(i,!1,!0))}),e}rowDataChanged(e,i,n){this.redrawNeeded(n)&&(this.initializeRow(e),i&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var i=e.column.getField();i===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var i=e.getData()[this.field],n=Array.isArray(i),r=n||!n&&typeof i=="object"&&i!==null;!r&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!r&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:r?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&r?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&r?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:r}}reinitializeRowChildren(e){var i=this.getTreeChildren(e,!1,!0);i.forEach(function(n){n.reinitialize(!0)})}layoutRow(e){var i=this.elementField?e.getCell(this.elementField):e.getCells()[0],n=i.getElement(),r=e.modules.dataTree;r.branchEl&&(r.branchEl.parentNode&&r.branchEl.parentNode.removeChild(r.branchEl),r.branchEl=!1),r.controlEl&&(r.controlEl.parentNode&&r.controlEl.parentNode.removeChild(r.controlEl),r.controlEl=!1),this.generateControlElement(e,n),e.getElement().classList.add("tabulator-tree-level-"+r.index),r.index&&(this.branchEl?(r.branchEl=this.branchEl.cloneNode(!0),n.insertBefore(r.branchEl,n.firstChild),this.table.rtl?r.branchEl.style.marginRight=(r.branchEl.offsetWidth+r.branchEl.style.marginLeft)*(r.index-1)+r.index*this.indent+"px":r.branchEl.style.marginLeft=(r.branchEl.offsetWidth+r.branchEl.style.marginRight)*(r.index-1)+r.index*this.indent+"px"):this.table.rtl?n.style.paddingRight=parseInt(window.getComputedStyle(n,null).getPropertyValue("padding-right"))+r.index*this.indent+"px":n.style.paddingLeft=parseInt(window.getComputedStyle(n,null).getPropertyValue("padding-left"))+r.index*this.indent+"px")}generateControlElement(e,i){var n=e.modules.dataTree,r=n.controlEl;i=i||e.getCells()[0].getElement(),n.children!==!1&&(n.open?(n.controlEl=this.collapseEl.cloneNode(!0),n.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.collapseRow(e)})):(n.controlEl=this.expandEl.cloneNode(!0),n.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.expandRow(e)})),n.controlEl.addEventListener("mousedown",a=>{a.stopPropagation()}),r&&r.parentNode===i?r.parentNode.replaceChild(n.controlEl,r):i.insertBefore(n.controlEl,i.firstChild))}getRows(e){var i=[];return e.forEach((n,r)=>{var a,s;i.push(n),n instanceof tu&&(n.create(),a=n.modules.dataTree,!a.index&&a.children!==!1&&(s=this.getChildren(n,!1,!0),s.forEach(o=>{o.create(),i.push(o)})))}),i}getChildren(e,i,n){var r=e.modules.dataTree,a=[],s=[];return r.children!==!1&&(r.open||i)&&(Array.isArray(r.children)||(r.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?a=this.table.modules.filter.filter(r.children):a=r.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(a,n),a.forEach(o=>{s.push(o);var l=this.getChildren(o,!1,!0);l.forEach(u=>{s.push(u)})})),s}generateChildren(e){var i=[],n=e.getData()[this.field];return Array.isArray(n)||(n=[n]),n.forEach(r=>{var a=new tu(r||{},this.table.rowManager);a.create(),a.modules.dataTree.index=e.modules.dataTree.index+1,a.modules.dataTree.parent=e,a.modules.dataTree.children&&(a.modules.dataTree.open=this.startOpen(a.getComponent(),a.modules.dataTree.index)),i.push(a)}),i}expandRow(e,i){var n=e.modules.dataTree;n.children!==!1&&(n.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var i=e.modules.dataTree,n=[],r;return i.children&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?r=this.table.modules.filter.filter(i.children):r=i.children,r.forEach(a=>{a instanceof tu&&n.push(a)})),n}rowDeleting(e){var i=e.modules.dataTree;i&&i.children&&Array.isArray(i.children)&&i.children.forEach(n=>{n instanceof tu&&n.wipe()})}rowDelete(e){var i=e.modules.dataTree.parent,n;i&&(n=this.findChildIndex(e,i),n!==!1&&i.data[this.field].splice(n,1),i.data[this.field].length||delete i.data[this.field],this.initializeRow(i),this.layoutRow(i)),this.refreshData(!0)}addTreeChildRow(e,i,n,r){var a=!1;typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof r<"u"&&(a=this.findChildIndex(r,e),a!==!1&&e.data[this.field].splice(n?a:a+1,0,i)),a===!1&&(n?e.data[this.field].unshift(i):e.data[this.field].push(i)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,i){var n=!1;return typeof e=="object"?e instanceof tu?n=e.data:e instanceof s2?n=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?i.modules.dataTree&&(n=i.modules.dataTree.children.find(r=>r instanceof tu?r.element===e:!1),n&&(n=n.data)):e===null&&(n=!1):typeof e>"u"?n=!1:n=i.data[this.field].find(r=>r.data[this.table.options.index]==e),n&&(Array.isArray(i.data[this.field])&&(n=i.data[this.field].indexOf(n)),n==-1&&(n=!1)),n}getTreeChildren(e,i,n){var r=e.modules.dataTree,a=[];return r&&r.children&&(Array.isArray(r.children)||(r.children=this.generateChildren(e)),r.children.forEach(s=>{s instanceof tu&&(a.push(i?s.getComponent():s),n&&this.getTreeChildren(s,i,n).forEach(o=>{a.push(o)}))})),a}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}function vQe(t,e={},i){var n=e.delimiter?e.delimiter:",",r=[],a=[];t.forEach(s=>{var o=[];switch(s.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":s.columns.forEach((l,u)=>{l&&l.depth===1&&(a[u]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":s.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}o.push('"'+String(l.value).split('"').join('""')+'"')}}),r.push(o.join(n));break}}),a.length&&r.unshift(a.join(n)),r=r.join(`
`),e.bom&&(r="\uFEFF"+r),i(r,"text/csv")}function yQe(t,e,i){var n=[];t.forEach(r=>{var a={};switch(r.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":r.columns.forEach(s=>{s&&(a[s.component.getTitleDownload()||s.component.getField()]=s.value)}),n.push(a);break}}),n=JSON.stringify(n,null,"	"),i(n,"application/json")}function bQe(t,e={},i){var n=[],r=[],a={},s=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},o=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},u=e.title?e.title:"",c,d;l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),t.forEach(h=>{switch(h.type){case"header":n.push(p(h));break;case"group":r.push(p(h,s));break;case"calc":r.push(p(h,o));break;case"row":r.push(p(h));break}});function p(h,f){var m=[];return h.columns.forEach(g=>{var v;if(g){switch(typeof g.value){case"object":g.value=g.value!==null?JSON.stringify(g.value):"";break;case"undefined":g.value="";break}v={content:g.value,colSpan:g.width,rowSpan:g.height},f&&(v.styles=f),m.push(v)}}),m}c=this.dependencyRegistry.lookup("jspdf","jsPDF"),d=new c(l),e.autoTable&&(typeof e.autoTable=="function"?a=e.autoTable(d)||{}:a=e.autoTable),u&&(a.didDrawPage=function(h){d.text(u,40,30)}),a.head=n,a.body=r,d.autoTable(a),e.documentProcessing&&e.documentProcessing(d),i(d.output("arraybuffer"),"application/pdf")}function IQe(t,e,i){var n=this,r=e.sheetName||"Sheet1",a=this.dependencyRegistry.lookup("XLSX"),s=a.utils.book_new(),o=new Hl(this),l="compress"in e?e.compress:!0,u=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:l},c;u.type="binary",s.SheetNames=[],s.Sheets={};function d(){var f=[],m=[],g={},v={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce((y,b)=>y+(b&&b.width?b.width:1),0):0,r:t.length}};return t.forEach((y,b)=>{var I=[];y.columns.forEach(function(S,w){S?(I.push(!(S.value instanceof Date)&&typeof S.value=="object"?JSON.stringify(S.value):S.value),(S.width>1||S.height>-1)&&(S.height>1||S.width>1)&&m.push({s:{r:b,c:w},e:{r:b+S.height-1,c:w+S.width-1}})):I.push("")}),f.push(I)}),a.utils.sheet_add_aoa(g,f),g["!ref"]=a.utils.encode_range(v),m.length&&(g["!merges"]=m),g}if(e.sheetOnly){i(d());return}if(e.sheets)for(var p in e.sheets)e.sheets[p]===!0?(s.SheetNames.push(p),s.Sheets[p]=d()):(s.SheetNames.push(p),o.commsSend(e.sheets[p],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:n.active,intercept:function(f){s.Sheets[p]=f}}));else s.SheetNames.push(r),s.Sheets[r]=d();e.documentProcessing&&(s=e.documentProcessing(s));function h(f){for(var m=new ArrayBuffer(f.length),g=new Uint8Array(m),v=0;v!=f.length;++v)g[v]=f.charCodeAt(v)&255;return m}c=a.write(s,u),i(h(c),"application/octet-stream")}function wQe(t,e,i){this.modExists("export",!0)&&i(this.modules.export.generateHTMLTable(t),"text/html")}function SQe(t,e,i){const n=[];t.forEach(r=>{const a={};switch(r.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":r.columns.forEach(s=>{s&&(a[s.component.getTitleDownload()||s.component.getField()]=s.value)}),n.push(JSON.stringify(a));break}}),i(n.join(`
`),"application/x-ndjson")}var TQe={csv:vQe,json:yQe,jsonLines:SQe,pdf:bQe,xlsx:IQe,html:wQe};class Vx extends Vn{static moduleName="download";static downloaders=TQe;constructor(e){super(e),this.registerTableOption("downloadEncoder",function(i,n){return new Blob([i],{type:n})}),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){}downloadToTab(e,i,n,r){this.download(e,i,n,r,!0)}download(e,i,n,r,a){var s=!1;function o(u,c){a?a===!0?this.triggerDownload(u,c,e,i,!0):a(u):this.triggerDownload(u,c,e,i)}if(typeof e=="function"?s=e:Vx.downloaders[e]?s=Vx.downloaders[e]:console.warn("Download Error - No such download type found: ",e),s){var l=this.generateExportList(r);s.call(this.table,l,n||{},o.bind(this))}}generateExportList(e){var i=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),n=this.table.options.groupHeaderDownload;return n&&!Array.isArray(n)&&(n=[n]),i.forEach(r=>{var a;r.type==="group"&&(a=r.columns[0],n&&n[r.indent]&&(a.value=n[r.indent](a.value,r.component._group.getRowCount(),r.component._group.getData(),r.component)))}),i}triggerDownload(e,i,n,r,a){var s=document.createElement("a"),o=this.table.options.downloadEncoder(e,i);o&&(a?window.open(window.URL.createObjectURL(o)):(r=r||"Tabulator."+(typeof n=="function"?"txt":n),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(o,r):(s.setAttribute("href",window.URL.createObjectURL(o)),s.setAttribute("download",r),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s))),this.dispatchExternal("downloadComplete"))}commsReceived(e,i,n){switch(i){case"intercept":this.download(n.type,"",n.options,n.active,n.intercept);break}}}function o2(t,e){var i=e.mask,n=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",r=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",a=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function s(o){var l=i[o];typeof l<"u"&&l!==a&&l!==n&&l!==r&&(t.value=t.value+""+l,s(o+1))}t.addEventListener("keydown",o=>{var l=t.value.length,u=o.key;if(o.keyCode>46&&!o.ctrlKey&&!o.metaKey){if(l>=i.length)return o.preventDefault(),o.stopPropagation(),!1;switch(i[l]){case n:if(u.toUpperCase()==u.toLowerCase())return o.preventDefault(),o.stopPropagation(),!1;break;case r:if(isNaN(u))return o.preventDefault(),o.stopPropagation(),!1;break;case a:break;default:if(u!==i[l])return o.preventDefault(),o.stopPropagation(),!1}}}),t.addEventListener("keyup",o=>{o.keyCode>46&&e.maskAutoFill&&s(t.value.length)}),t.placeholder||(t.placeholder=i),e.maskAutoFill&&s(t.value.length)}function UQe(t,e,i,n,r){var a=t.getValue(),s=document.createElement("input");if(s.setAttribute("type",r.search?"search":"text"),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let l in r.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),s.setAttribute(l,s.getAttribute(l)+r.elementAttributes["+"+l])):s.setAttribute(l,r.elementAttributes[l]);s.value=typeof a<"u"?a:"",e(function(){t.getType()==="cell"&&(s.focus({preventScroll:!0}),s.style.height="100%",r.selectContents&&s.select())});function o(l){(a===null||typeof a>"u")&&s.value!==""||s.value!==a?i(s.value)&&(a=s.value):n()}return s.addEventListener("change",o),s.addEventListener("blur",o),s.addEventListener("keydown",function(l){switch(l.keyCode){case 13:o();break;case 27:n();break;case 35:case 36:l.stopPropagation();break}}),r.mask&&o2(s,r),s}function DQe(t,e,i,n,r){var a=t.getValue(),s=r.verticalNavigation||"hybrid",o=String(a!==null&&typeof a<"u"?a:""),l=document.createElement("textarea"),u=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",r.elementAttributes&&typeof r.elementAttributes=="object")for(let d in r.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),l.setAttribute(d,l.getAttribute(d)+r.elementAttributes["+"+d])):l.setAttribute(d,r.elementAttributes[d]);l.value=o,e(function(){t.getType()==="cell"&&(l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",t.getRow().normalizeHeight(),r.selectContents&&l.select())});function c(d){(a===null||typeof a>"u")&&l.value!==""||l.value!==a?(i(l.value)&&(a=l.value),setTimeout(function(){t.getRow().normalizeHeight()},300)):n()}return l.addEventListener("change",c),l.addEventListener("blur",c),l.addEventListener("keyup",function(){l.style.height="";var d=l.scrollHeight;l.style.height=d+"px",d!=u&&(u=d,t.getRow().normalizeHeight())}),l.addEventListener("keydown",function(d){switch(d.keyCode){case 13:d.shiftKey&&r.shiftEnterSubmit&&c();break;case 27:n();break;case 38:(s=="editor"||s=="hybrid"&&l.selectionStart)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 40:(s=="editor"||s=="hybrid"&&l.selectionStart!==l.value.length)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 35:case 36:d.stopPropagation();break}}),r.mask&&o2(l,r),l}function EQe(t,e,i,n,r){var a=t.getValue(),s=r.verticalNavigation||"editor",o=document.createElement("input");if(o.setAttribute("type","number"),typeof r.max<"u"&&o.setAttribute("max",r.max),typeof r.min<"u"&&o.setAttribute("min",r.min),typeof r.step<"u"&&o.setAttribute("step",r.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let c in r.elementAttributes)c.charAt(0)=="+"?(c=c.slice(1),o.setAttribute(c,o.getAttribute(c)+r.elementAttributes["+"+c])):o.setAttribute(c,r.elementAttributes[c]);o.value=a;var l=function(c){u()};e(function(){t.getType()==="cell"&&(o.removeEventListener("blur",l),o.focus({preventScroll:!0}),o.style.height="100%",o.addEventListener("blur",l),r.selectContents&&o.select())});function u(){var c=o.value;!isNaN(c)&&c!==""&&(c=Number(c)),c!==a?i(c)&&(a=c):n()}return o.addEventListener("keydown",function(c){switch(c.keyCode){case 13:u();break;case 27:n();break;case 38:case 40:s=="editor"&&(c.stopImmediatePropagation(),c.stopPropagation());break;case 35:case 36:c.stopPropagation();break}}),r.mask&&o2(o,r),o}function PQe(t,e,i,n,r){var a=t.getValue(),s=document.createElement("input");if(s.setAttribute("type","range"),typeof r.max<"u"&&s.setAttribute("max",r.max),typeof r.min<"u"&&s.setAttribute("min",r.min),typeof r.step<"u"&&s.setAttribute("step",r.step),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let l in r.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),s.setAttribute(l,s.getAttribute(l)+r.elementAttributes["+"+l])):s.setAttribute(l,r.elementAttributes[l]);s.value=a,e(function(){t.getType()==="cell"&&(s.focus({preventScroll:!0}),s.style.height="100%")});function o(){var l=s.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=a?i(l)&&(a=l):n()}return s.addEventListener("blur",function(l){o()}),s.addEventListener("keydown",function(l){switch(l.keyCode){case 13:o();break;case 27:n();break}}),s}function CQe(t,e,i,n,r){var a=r.format,s=r.verticalNavigation||"editor",o=a?window.DateTime||luxon.DateTime:null,l=t.getValue(),u=document.createElement("input");function c(p){var h;return o.isDateTime(p)?h=p:a==="iso"?h=o.fromISO(String(p)):h=o.fromFormat(String(p),a),h.toFormat("yyyy-MM-dd")}if(u.type="date",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",r.max&&u.setAttribute("max",a?c(r.max):r.max),r.min&&u.setAttribute("min",a?c(r.min):r.min),r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+r.elementAttributes["+"+p])):u.setAttribute(p,r.elementAttributes[p]);l=typeof l<"u"?l:"",a&&(o?l=c(l):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=l,e(function(){t.getType()==="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",r.selectContents&&u.select())});function d(){var p=u.value,h;if((l===null||typeof l>"u")&&p!==""||p!==l){if(p&&a)switch(h=o.fromFormat(String(p),"yyyy-MM-dd"),a){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(a)}i(p)&&(l=u.value)}else n()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}function RQe(t,e,i,n,r){var a=r.format,s=r.verticalNavigation||"editor",o=a?window.DateTime||luxon.DateTime:null,l,u=t.getValue(),c=document.createElement("input");if(c.type="time",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+r.elementAttributes["+"+p])):c.setAttribute(p,r.elementAttributes[p]);u=typeof u<"u"?u:"",a&&(o?(o.isDateTime(u)?l=u:a==="iso"?l=o.fromISO(String(u)):l=o.fromFormat(String(u),a),u=l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=u,e(function(){t.getType()=="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",r.selectContents&&c.select())});function d(){var p=c.value,h;if((u===null||typeof u>"u")&&p!==""||p!==u){if(p&&a)switch(h=o.fromFormat(String(p),"hh:mm"),a){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(a)}i(p)&&(u=c.value)}else n()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}function MQe(t,e,i,n,r){var a=r.format,s=r.verticalNavigation||"editor",o=a?this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"):null,l,u=t.getValue(),c=document.createElement("input");if(c.type="datetime-local",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+r.elementAttributes["+"+p])):c.setAttribute(p,r.elementAttributes[p]);u=typeof u<"u"?u:"",a&&(o?(o.isDateTime(u)?l=u:a==="iso"?l=o.fromISO(String(u)):l=o.fromFormat(String(u),a),u=l.toFormat("yyyy-MM-dd")+"T"+l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=u,e(function(){t.getType()==="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",r.selectContents&&c.select())});function d(){var p=c.value,h;if((u===null||typeof u>"u")&&p!==""||p!==u){if(p&&a)switch(h=o.fromISO(String(p)),a){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(a)}i(p)&&(u=c.value)}else n()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}let NQe=class{constructor(e,i,n,r,a,s){this.edit=e,this.table=e.table,this.cell=i,this.params=this._initializeParams(s),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=i.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:r,cancel:a},this._deprecatedOptionsCheck(),this._initializeValue(),n(this._onRendered.bind(this))}_deprecatedOptionsCheck(){}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function i(n){n.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",i),setTimeout(()=>{e.removeEventListener("click",i)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,i=document.createElement("input");if(i.setAttribute("type",this.params.clearable?"search":"text"),i.style.padding="4px",i.style.width="100%",i.style.boxSizing="border-box",this.params.autocomplete||(i.style.cursor="default",i.style.caretColor="transparent"),e&&typeof e=="object")for(let n in e)n.charAt(0)=="+"?(n=n.slice(1),i.setAttribute(n,i.getAttribute(n)+e["+"+n])):i.setAttribute(n,e[n]);return this.params.mask&&o2(i,this.params),this._bindInputEvents(i),i}_initializeParams(e){var i=["values","valuesURL","valuesLookup"],n;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",n=Object.keys(e).filter(r=>i.includes(r)).length,n?n>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i>0&&this._focusItem(this.displayItems[i-1]))}_keyDown(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i<this.displayItems.length-1&&(i==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[i+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var i=String.fromCharCode(e).toLowerCase();this.filterTerm+=i.toLowerCase();var n=this.displayItems.find(r=>typeof r.label<"u"&&r.label.toLowerCase().startsWith(this.filterTerm));n&&this._focusItem(n),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var i=[],n=++this.listIteration;return this.filtered=!1,this.params.values?i=this.params.values:this.params.valuesURL?i=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?i=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(i=this._uniqueColumnValues(this.params.valuesLookupField)),i instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),i.then().then(r=>this.listIteration===n?this._parseList(r):Promise.reject(n))):Promise.resolve(this._parseList(i))}_addPlaceholder(e){var i=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?i=e:(i.classList.add("tabulator-edit-list-placeholder"),i.innerHTML=e),this.listEl.appendChild(i),this._showList())}_ajaxRequest(e,i){var n=this.params.filterRemote?{term:i}:{};return e=JEe(e,{},n),fetch(e).then(r=>r.ok?r.json().catch(a=>(console.warn("List Ajax Load Error - Invalid JSON returned",a),Promise.reject(a))):(console.error("List Ajax Load Error - Connection Error: "+r.status,r.statusText),Promise.reject(r))).catch(r=>(console.error("List Ajax Load Error - Connection Error: ",r),Promise.reject(r)))}_uniqueColumnValues(e){var i={},n=this.table.getData(this.params.valuesLookup),r;return e?r=this.table.columnManager.getColumnByField(e):r=this.cell.getColumn()._getSelf(),r?n.forEach(a=>{var s=r.getFieldValue(a);this._emptyValueCheck(s)||(this.params.multiselect&&Array.isArray(s)?s.forEach(o=>{this._emptyValueCheck(o)||(i[o]=!0)}):i[s]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),i=[]),Object.keys(i)}_emptyValueCheck(e){return e===null||typeof e>"u"||e===""}_parseList(e){var i=[];return Array.isArray(e)||(e=Object.entries(e).map(([n,r])=>({label:r,value:n}))),e.forEach(n=>{typeof n!="object"&&(n={label:n,value:n}),this._parseListItem(n,i,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=i,i}_parseListItem(e,i,n){var r={};e.options?r=this._parseListGroup(e,n+1):(r={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:n,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(r,!0)),i.push(r)}_parseListGroup(e,i){var n={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:i,options:[],original:e};return e.options.forEach(r=>{this._parseListItem(r,n.options,i)}),n}_sortOptions(e){var i;return this.params.sort&&(i=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(i,e)),e}_sortGroup(e,i){i.sort((n,r)=>e(n.label,r.label,n.value,r.value,n.original,r.original)),i.forEach(n=>{n.group&&this._sortGroup(e,n.options)})}_defaultSortFunction(e,i){var n,r,a,s,o=0,l,u=/(\d+)|(\D+)/g,c=/\d/,d=0;if(this.params.sort==="desc"&&([e,i]=[i,e]),!e&&e!==0)d=!i&&i!==0?0:-1;else if(!i&&i!==0)d=1;else{if(isFinite(e)&&isFinite(i))return e-i;if(n=String(e).toLowerCase(),r=String(i).toLowerCase(),n===r)return 0;if(!(c.test(n)&&c.test(r)))return n>r?1:-1;for(n=n.match(u),r=r.match(u),l=n.length>r.length?r.length:n.length;o<l;)if(a=n[o],s=r[o++],a!==s)return isFinite(a)&&isFinite(s)?(a.charAt(0)==="0"&&(a="."+a),s.charAt(0)==="0"&&(s="."+s),a-s):a>s?1:-1;return n.length>r.length}return d}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,i=this.input.value;return i?(this.filtered=!0,this.data.forEach(n=>{this._filterItem(e,i,n)})):this.filtered=!1,this.data}_filterItem(e,i,n){var r=!1;return n.group?(n.options.forEach(a=>{this._filterItem(e,i,a)&&(r=!0)}),n.visible=r):n.visible=e(i,n.label,n.value,n.original),n.visible}_defaultFilterFunc(e,i,n,r){return e=String(e).toLowerCase(),i!==null&&typeof i<"u"&&(String(i).toLowerCase().indexOf(e)>-1||String(n).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(i=>{this._buildItem(i)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var i=e.element,n;if(!this.filtered||e.visible){if(!i){if(i=document.createElement("div"),i.tabIndex=0,n=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,i):e.label,n instanceof HTMLElement?i.appendChild(n):i.innerHTML=n,e.group?i.classList.add("tabulator-edit-list-group"):i.classList.add("tabulator-edit-list-item"),i.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let r in e.elementAttributes)r.charAt(0)=="+"?(r=r.slice(1),i.setAttribute(r,this.input.getAttribute(r)+e.elementAttributes["+"+r])):i.setAttribute(r,e.elementAttributes[r]);e.group?i.addEventListener("click",this._groupClick.bind(this,e)):i.addEventListener("click",this._itemClick.bind(this,e)),i.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=i}this._styleItem(e),this.listEl.appendChild(i),e.group?e.options.forEach(r=>{this._buildItem(r)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,i){i.stopPropagation(),this._chooseItem(e)}_groupClick(e,i){i.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,i){var n;this.typing=!1,this.params.multiselect?(n=this.currentItems.indexOf(e),n>-1?(this.currentItems.splice(n,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(r=>r.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),i||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var i,n;if(this.popup&&this.popup.hide(!0),this.params.multiselect)i=this.currentItems.map(r=>r.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")i=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?i=this.currentItems[0].value:(n=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,n===null||typeof n>"u"||n===""?i=n:i=this.params.emptyValue);i===""&&(i=this.params.emptyValue),this.actions.success(i),this.isFilter&&(this.initialValues=i&&!Array.isArray(i)?[i]:i,this.currentItems=[])}};function AQe(t,e,i,n,r){var a=new NQe(this,t,e,i,n,r);return a.input}function _Qe(t,e,i,n,r){var a=this,s=t.getElement(),o=t.getValue(),l=s.getElementsByTagName("svg").length||5,u=s.getElementsByTagName("svg")[0]?s.getElementsByTagName("svg")[0].getAttribute("width"):14,c=[],d=document.createElement("div"),p=document.createElementNS("http://www.w3.org/2000/svg","svg");function h(v){c.forEach(function(y,b){b<v?(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-active"):y.classList.replace("tabulator-star-inactive","tabulator-star-active"),y.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-inactive"):y.classList.replace("tabulator-star-active","tabulator-star-inactive"),y.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function f(v){var y=document.createElement("span"),b=p.cloneNode(!0);c.push(b),y.addEventListener("mouseenter",function(I){I.stopPropagation(),I.stopImmediatePropagation(),h(v)}),y.addEventListener("mousemove",function(I){I.stopPropagation(),I.stopImmediatePropagation()}),y.addEventListener("click",function(I){I.stopPropagation(),I.stopImmediatePropagation(),i(v),s.blur()}),y.appendChild(b),d.appendChild(y)}function m(v){o=v,h(v)}if(s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis",d.style.verticalAlign="middle",d.style.display="inline-block",d.style.padding="4px",p.setAttribute("width",u),p.setAttribute("height",u),p.setAttribute("viewBox","0 0 512 512"),p.setAttribute("xml:space","preserve"),p.style.padding="0 1px",r.elementAttributes&&typeof r.elementAttributes=="object")for(let v in r.elementAttributes)v.charAt(0)=="+"?(v=v.slice(1),d.setAttribute(v,d.getAttribute(v)+r.elementAttributes["+"+v])):d.setAttribute(v,r.elementAttributes[v]);for(var g=1;g<=l;g++)f(g);return o=Math.min(parseInt(o),l),h(o),d.addEventListener("mousemove",function(v){h(0)}),d.addEventListener("click",function(v){i(0)}),s.addEventListener("blur",function(v){n()}),s.addEventListener("keydown",function(v){switch(v.keyCode){case 39:m(o+1);break;case 37:m(o-1);break;case 13:i(o);break;case 27:n();break}}),d}function kQe(t,e,i,n,r){var a=t.getElement(),s=typeof r.max>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("max")||100:r.max,o=typeof r.min>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("min")||0:r.min,l=(s-o)/100,u=t.getValue()||0,c=document.createElement("div"),d=document.createElement("div"),p,h;function f(){var m=window.getComputedStyle(a,null),g=l*Math.round(d.offsetWidth/((a.clientWidth-parseInt(m.getPropertyValue("padding-left"))-parseInt(m.getPropertyValue("padding-right")))/100))+o;i(g),a.setAttribute("aria-valuenow",g),a.setAttribute("aria-label",u)}if(c.style.position="absolute",c.style.right="0",c.style.top="0",c.style.bottom="0",c.style.width="5px",c.classList.add("tabulator-progress-handle"),d.style.display="inline-block",d.style.position="relative",d.style.height="100%",d.style.backgroundColor="#488CE9",d.style.maxWidth="100%",d.style.minWidth="0%",r.elementAttributes&&typeof r.elementAttributes=="object")for(let m in r.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),d.setAttribute(m,d.getAttribute(m)+r.elementAttributes["+"+m])):d.setAttribute(m,r.elementAttributes[m]);return a.style.padding="4px 4px",u=Math.min(parseFloat(u),s),u=Math.max(parseFloat(u),o),u=Math.round((u-o)/l),d.style.width=u+"%",a.setAttribute("aria-valuemin",o),a.setAttribute("aria-valuemax",s),d.appendChild(c),c.addEventListener("mousedown",function(m){p=m.screenX,h=d.offsetWidth}),c.addEventListener("mouseover",function(){c.style.cursor="ew-resize"}),a.addEventListener("mousemove",function(m){p&&(d.style.width=h+m.screenX-p+"px")}),a.addEventListener("mouseup",function(m){p&&(m.stopPropagation(),m.stopImmediatePropagation(),p=!1,h=!1,f())}),a.addEventListener("keydown",function(m){switch(m.keyCode){case 39:m.preventDefault(),d.style.width=d.clientWidth+a.clientWidth/100+"px";break;case 37:m.preventDefault(),d.style.width=d.clientWidth-a.clientWidth/100+"px";break;case 9:case 13:f();break;case 27:n();break}}),a.addEventListener("blur",function(){n()}),d}function xQe(t,e,i,n,r){var a=t.getValue(),s=document.createElement("input"),o=r.tristate,l=typeof r.indeterminateValue>"u"?null:r.indeterminateValue,u=!1,c=Object.keys(r).includes("trueValue"),d=Object.keys(r).includes("falseValue");if(s.setAttribute("type","checkbox"),s.style.marginTop="5px",s.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let h in r.elementAttributes)h.charAt(0)=="+"?(h=h.slice(1),s.setAttribute(h,s.getAttribute(h)+r.elementAttributes["+"+h])):s.setAttribute(h,r.elementAttributes[h]);s.value=a,o&&(typeof a>"u"||a===l||a==="")&&(u=!0,s.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){t.getType()==="cell"&&s.focus({preventScroll:!0})}),s.checked=c?a===r.trueValue:a===!0||a==="true"||a==="True"||a===1;function p(h){var f=s.checked;return c&&f?f=r.trueValue:d&&!f&&(f=r.falseValue),o?h?u?l:f:s.checked&&!u?(s.checked=!1,s.indeterminate=!0,u=!0,l):(u=!1,f):f}return s.addEventListener("change",function(h){i(p())}),s.addEventListener("blur",function(h){i(p(!0))}),s.addEventListener("keydown",function(h){h.keyCode==13&&i(p()),h.keyCode==27&&n()}),s}function OQe(t,e,i,n,r){var a=t._getSelf().column,s,o,l;function u(c){var d=c.getValue(),p="input";switch(typeof d){case"number":p="number";break;case"boolean":p="tickCross";break;case"string":d.includes(`
`)&&(p="textarea");break}return p}return s=r.editorLookup?r.editorLookup(t):u(t),r.paramsLookup&&(l=typeof r.paramsLookup=="function"?r.paramsLookup(s,t):r.paramsLookup[s]),o=this.table.modules.edit.lookupEditor(s,a),o.call(this,t,e,i,n,l||{})}var LQe={input:UQe,textarea:DQe,number:EQe,range:PQe,date:CQe,time:RQe,datetime:MQe,list:AQe,star:_Qe,progress:kQe,tickCross:xQe,adaptable:OQe};class wK extends Vn{static moduleName="edit";static editors=LQe;constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.convertEmptyValues=!1,this.editors=wK.editors,this.registerTableOption("editTriggerEvent","focus"),this.registerTableOption("editorEmptyValue"),this.registerTableOption("editorEmptyValueFunc",this.emptyValueCheck.bind(this)),this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("editorEmptyValue"),this.registerColumnOption("editorEmptyValueFunc"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0)),Object.keys(this.table.options).includes("editorEmptyValue")&&(this.convertEmptyValues=!0)}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var i=this.currentCell,n=this.options("tabEndNewRow");i&&(this.navigateNext(i,e)||n&&(i.getElement().firstChild.blur(),this.invalidEdit||(n===!0?n=this.table.addRow({}):typeof n=="function"?n=this.table.addRow(n(i.row.getComponent())):n=this.table.addRow(Object.assign({},n)),n.then(()=>{setTimeout(()=>{i.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.table.modules.edit.clearEdited(i._getSelf())})}navigatePrev(e=this.currentCell,i){var n,r;if(e){if(i&&i.preventDefault(),n=this.navigateLeft(),n)return!0;if(r=this.table.rowManager.prevDisplayRow(e.row,!0),r&&(n=this.findPrevEditableCell(r,r.cells.length),n))return n.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,i){var n,r;if(e){if(i&&i.preventDefault(),n=this.navigateRight(),n)return!0;if(r=this.table.rowManager.nextDisplayRow(e.row,!0),r&&(n=this.findNextEditableCell(r,-1),n))return n.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.findPrevEditableCell(e.row,n),r)?(r.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.findNextEditableCell(e.row,n),r)?(r.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.table.rowManager.prevDisplayRow(e.row,!0),r)?(r.cells[n].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.table.rowManager.nextDisplayRow(e.row,!0),r)?(r.cells[n].getComponent().edit(),!0):!1}findNextEditableCell(e,i){var n=!1;if(i<e.cells.length-1)for(var r=i+1;r<e.cells.length;r++){let a=e.cells[r];if(a.column.modules.edit&&Ia.elVisible(a.getElement())&&this.allowEdit(a)){n=a;break}}return n}findPrevEditableCell(e,i){var n=!1;if(i>0)for(var r=i-1;r>=0;r--){let a=e.cells[r];if(a.column.modules.edit&&Ia.elVisible(a.getElement())&&this.allowEdit(a)){n=a;break}}return n}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(i=>{i.column.modules.edit&&typeof i.column.modules.edit.check=="function"&&this.updateCellClass(i)})}initializeColumn(e){var i=Object.keys(e.definition).includes("editorEmptyValue"),n={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{},convertEmptyValues:i,editorEmptyValue:e.definition.editorEmptyValue,editorEmptyValueFunc:e.definition.editorEmptyValueFunc};n.editor=this.lookupEditor(e.definition.editor,e),n.editor&&(e.modules.edit=n)}lookupEditor(e,i){var n;switch(typeof e){case"string":this.editors[e]?n=this.editors[e]:console.warn("Editor Error - No such editor found: ",e);break;case"function":n=e;break;case"boolean":e===!0&&(typeof i.definition.formatter!="function"?this.editors[i.definition.formatter]?n=this.editors[i.definition.formatter]:n=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",i.definition.formatter));break}return n}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var i=this.currentCell,n;if(this.invalidEdit=!1,i){for(this.currentCell=!1,n=i.getElement(),this.dispatch("edit-editor-clear",i,e),n.classList.remove("tabulator-editing");n.firstChild;)n.removeChild(n.firstChild);i.row.getElement().classList.remove("tabulator-editing"),i.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,i=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,i),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",i)}}bindEditor(e){if(e.column.modules.edit){var i=this,n=e.getElement(!0);this.updateCellClass(e),n.setAttribute("tabindex",0),n.addEventListener("mousedown",function(r){r.button===2?r.preventDefault():i.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&n.addEventListener("dblclick",function(r){n.classList.contains("tabulator-editing")||(n.focus({preventScroll:!0}),i.edit(e,r,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&n.addEventListener("click",function(r){n.classList.contains("tabulator-editing")||(n.focus({preventScroll:!0}),i.edit(e,r,!1))}),this.options("editTriggerEvent")==="focus"&&n.addEventListener("focus",function(r){i.recursionBlock||i.edit(e,r,!1)})}}focusCellNoEvent(e,i){this.recursionBlock=!0,i&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,i){this.focusCellNoEvent(e),this.edit(e,!1,i)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var i=this.table.rowManager.element.scrollTop,n=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,r=e.row.getElement();r.offsetTop<i?this.table.rowManager.element.scrollTop-=i-r.offsetTop:r.offsetTop+r.offsetHeight>n&&(this.table.rowManager.element.scrollTop+=r.offsetTop+r.offsetHeight-n);var a=this.table.rowManager.element.scrollLeft,s=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,o=e.getElement();this.table.modExists("frozenColumns")&&(a+=parseInt(this.table.modules.frozenColumns.leftMargin||0),s-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(a-=parseInt(this.table.columnManager.renderer.vDomPadLeft),s-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),o.offsetLeft<a?this.table.rowManager.element.scrollLeft-=a-o.offsetLeft:o.offsetLeft+o.offsetWidth>s&&(this.table.rowManager.element.scrollLeft+=o.offsetLeft+o.offsetWidth-s)}}allowEdit(e){var i=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(i=e.column.modules.edit.check(e.getComponent()));break;case"string":i=!!e.row.data[e.column.modules.edit.check];break;case"boolean":i=e.column.modules.edit.check;break}return i}edit(e,i,n){var r=this,a=!0,s=function(){},o=e.getElement(),l=!1,u,c,d;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function p(v){if(r.currentCell===e&&!l){var y=r.chain("edit-success",[e,v],!0,!0);return y===!0||r.table.options.validationMode==="highlight"?(l=!0,r.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,r.editedCells.indexOf(e)==-1&&r.editedCells.push(e),v=r.transformEmptyValues(v,e),e.setValue(v,!0),y===!0):(l=!0,r.invalidEdit=!0,r.focusCellNoEvent(e,!0),s(),setTimeout(()=>{l=!1},10),!1)}}function h(){r.currentCell===e&&!l&&r.cancelEdit()}function f(v){s=v}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(o),!1;if(i&&i.stopPropagation(),a=this.allowEdit(e),a||n){if(r.cancelEdit(),r.currentCell=e,this.focusScrollAdjust(e),c=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,i,c)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,c),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",c),d=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(c):e.column.modules.edit.params,u=e.column.modules.edit.editor.call(r,c,f,p,h,d),this.currentCell&&u!==!1)if(u instanceof Node){for(o.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");o.firstChild;)o.removeChild(o.firstChild);o.appendChild(u),s();for(var m=o.children,g=0;g<m.length;g++)m[g].addEventListener("click",function(v){v.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",u),this.blur(o),!1;else return this.blur(o),!1;return!0}else return this.mouseClick=!1,this.blur(o),!1}emptyValueCheck(e){return e===""||e===null||typeof e>"u"}transformEmptyValues(e,i){var n=i.column.modules.edit,r=n.convertEmptyValues||this.convertEmptyValues,a;return r&&(a=n.editorEmptyValueFunc||this.options("editorEmptyValueFunc"),a&&a(e)&&(e=n.convertEmptyValues?n.editorEmptyValue:this.options("editorEmptyValue"))),e}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(i=>{e.push(i.getComponent())}),e}clearEdited(e){var i;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),i=this.editedCells.indexOf(e),i>-1&&this.editedCells.splice(i,1)}}class xee{constructor(e,i,n,r){this.type=e,this.columns=i,this.component=n||!1,this.indent=r||0}}class WV{constructor(e,i,n,r,a){this.value=e,this.component=i||!1,this.width=n,this.height=r,this.depth=a}}var FQe={},$Qe={visible:function(){return this.rowManager.getVisibleRows(!1,!0)},all:function(){return this.rowManager.rows},selected:function(){return this.modules.selectRow.selectedRows},active:function(){return this.options.pagination?this.rowManager.getDisplayRows(this.rowManager.displayRows.length-2):this.rowManager.getDisplayRows()}};class kP extends Vn{static moduleName="export";static columnLookups=FQe;static rowLookups=$Qe;constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.colVisPropAttach="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,i,n,r){var a,s,o,l;return this.cloneTableStyle=i,this.config=e||{},this.colVisProp=r,this.colVisPropAttach=this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1),l=kP.columnLookups[n],l&&(o=l.call(this.table),o=o.filter(u=>this.columnVisCheck(u))),a=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(o)):[],o&&(o=o.map(u=>u.getComponent())),s=this.bodyToExportRows(this.rowLookup(n),o),a.concat(s)}generateTable(e,i,n,r){var a=this.generateExportList(e,i,n,r);return this.generateTableElement(a)}rowLookup(e){var i=[],n;return typeof e=="function"?e.call(this.table).forEach(r=>{r=this.table.rowManager.findRow(r),r&&i.push(r)}):(n=kP.rowLookups[e]||kP.rowLookups.active,i=n.call(this.table)),Object.assign([],i)}generateColumnGroupHeaders(e){var i=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(n=>{var r=this.processColumnGroup(n);r&&i.push(r)}),i}processColumnGroup(e){var i=e.columns,n=0,r=e.definition["title"+this.colVisPropAttach]||e.definition.title,a={title:r,column:e,depth:1};if(i.length){if(a.subGroups=[],a.width=0,i.forEach(s=>{var o=this.processColumnGroup(s);o&&(a.width+=o.width,a.subGroups.push(o),o.depth>n&&(n=o.depth))}),a.depth+=n,!a.width)return!1}else if(this.columnVisCheck(e))a.width=1;else return!1;return a}columnVisCheck(e){var i=e.definition[this.colVisProp];return this.config.rowHeaders===!1&&e.isRowHeader?!1:(typeof i=="function"&&(i=i.call(this.table,e.getComponent())),i===!1||i===!0?i:e.visible&&e.field)}headersToExportRows(e){var i=[],n=0,r=[];function a(s,o){var l=n-o;if(typeof i[o]>"u"&&(i[o]=[]),s.height=s.subGroups?1:l-s.depth+1,i[o].push(s),s.height>1)for(let u=1;u<s.height;u++)typeof i[o+u]>"u"&&(i[o+u]=[]),i[o+u].push(!1);if(s.width>1)for(let u=1;u<s.width;u++)i[o].push(!1);s.subGroups&&s.subGroups.forEach(function(u){a(u,o+1)})}return e.forEach(function(s){s.depth>n&&(n=s.depth)}),e.forEach(function(s){a(s,0)}),i.forEach(s=>{var o=[];s.forEach(l=>{if(l){let u=typeof l.title>"u"?"":l.title;o.push(new WV(u,l.column.getComponent(),l.width,l.height,l.depth))}else o.push(null)}),r.push(new xee("header",o))}),r}bodyToExportRows(e,i=[]){var n=[];return i.length===0&&this.table.columnManager.columnsByIndex.forEach(r=>{this.columnVisCheck(r)&&i.push(r.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(r=>{switch(r.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&r.modules.dataTree.parent)}return!0}),e.forEach((r,a)=>{var s=r.getData(this.colVisProp),o=[],l=0;switch(r.type){case"group":l=r.level,o.push(new WV(r.key,r.getComponent(),i.length,1));break;case"calc":case"row":i.forEach(u=>{o.push(new WV(u._column.getFieldValue(s),u,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=r.modules.dataTree.index);break}n.push(new xee(r.type,o,r.getComponent(),l))}),n}generateTableElement(e){var i=document.createElement("table"),n=document.createElement("thead"),r=document.createElement("tbody"),a=this.lookupTableStyles(),s=this.table.options["rowFormatter"+this.colVisPropAttach],o={};return o.rowFormatter=s!==null?s:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(o.treeElementField=this.table.modules.dataTree.elementField),o.groupHeader=this.table.options["groupHeader"+this.colVisPropAttach],o.groupHeader&&!Array.isArray(o.groupHeader)&&(o.groupHeader=[o.groupHeader]),i.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),n,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,u)=>{let c;switch(l.type){case"header":n.appendChild(this.generateHeaderElement(l,o,a));break;case"group":r.appendChild(this.generateGroupElement(l,o,a));break;case"calc":r.appendChild(this.generateCalcElement(l,o,a));break;case"row":c=this.generateRowElement(l,o,a),this.mapElementStyles(u%2&&a.evenRow?a.evenRow:a.oddRow,c,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),r.appendChild(c);break}}),n.innerHTML&&i.appendChild(n),i.appendChild(r),this.mapElementStyles(this.table.element,i,["border-top","border-left","border-right","border-bottom"]),i}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.styleRowHeader=e.firstRow.getElementsByClassName("tabulator-row-header")[0],e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,i,n){var r=document.createElement("tr");return e.columns.forEach(a=>{if(a){var s=document.createElement("th"),o=a.component._column.definition.cssClass?a.component._column.definition.cssClass.split(" "):[];s.colSpan=a.width,s.rowSpan=a.height,s.innerHTML=a.value,this.cloneTableStyle&&(s.style.boxSizing="border-box"),o.forEach(function(l){s.classList.add(l)}),this.mapElementStyles(a.component.getElement(),s,["text-align","border-left","border-right","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(a.component._column.contentElement,s,["padding-top","padding-left","padding-right","padding-bottom"]),a.component._column.visible?this.mapElementStyles(a.component.getElement(),s,["width"]):a.component._column.definition.width&&(s.style.width=a.component._column.definition.width+"px"),a.component._column.parent&&a.component._column.parent.isGroup?this.mapElementStyles(a.component._column.parent.groupElement,s,["border-top"]):this.mapElementStyles(a.component.getElement(),s,["border-top"]),a.component._column.isGroup?this.mapElementStyles(a.component.getElement(),s,["border-bottom"]):this.mapElementStyles(this.table.columnManager.getElement(),s,["border-bottom"]),r.appendChild(s)}}),r}generateGroupElement(e,i,n){var r=document.createElement("tr"),a=document.createElement("td"),s=e.columns[0];return r.classList.add("tabulator-print-table-row"),i.groupHeader&&i.groupHeader[e.indent]?s.value=i.groupHeader[e.indent](s.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):i.groupHeader!==!1&&(s.value=e.component._group.generator(s.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),a.colSpan=s.width,a.innerHTML=s.value,r.classList.add("tabulator-print-table-group"),r.classList.add("tabulator-group-level-"+e.indent),s.component.isVisible()&&r.classList.add("tabulator-group-visible"),this.mapElementStyles(n.firstGroup,r,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(n.firstGroup,a,["padding-top","padding-left","padding-right","padding-bottom"]),r.appendChild(a),r}generateCalcElement(e,i,n){var r=this.generateRowElement(e,i,n);return r.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(n.calcRow,r,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),r}generateRowElement(e,i,n){var r=document.createElement("tr");if(r.classList.add("tabulator-print-table-row"),e.columns.forEach((a,s)=>{if(a){var o=document.createElement("td"),l=a.component._column,u=this.table,c=u.columnManager.findColumnIndex(l),d=a.value,p,h,f={modules:{},getValue:function(){return d},getField:function(){return l.definition.field},getElement:function(){return o},getType:function(){return"cell"},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return u},getComponent:function(){return f},column:l},m=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(m.forEach(function(g){o.classList.add(g)}),this.table.modExists("format")&&this.config.formatCells!==!1)d=this.table.modules.format.formatExportValue(f,this.colVisProp);else switch(typeof d){case"object":d=d!==null?JSON.stringify(d):"";break;case"undefined":d="";break}d instanceof Node?o.appendChild(d):o.innerHTML=d,h=["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"],l.isRowHeader?(p=n.styleRowHeader,h.push("background-color")):p=n.styleCells&&n.styleCells[c]?n.styleCells[c]:n.firstCell,p&&(this.mapElementStyles(p,o,h),l.definition.align&&(o.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(i.treeElementField&&i.treeElementField==l.field||!i.treeElementField&&s==0)&&(e.component._row.modules.dataTree.controlEl&&o.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),o.firstChild),e.component._row.modules.dataTree.branchEl&&o.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),o.firstChild)),r.appendChild(o),f.modules.format&&f.modules.format.renderedCallback&&f.modules.format.renderedCallback()}}),i.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let a=Object.assign(e.component);a.getElement=function(){return r},i.rowFormatter(e.component)}return r}generateHTMLTable(e){var i=document.createElement("div");return i.appendChild(this.generateTableElement(e)),i.innerHTML}getHtml(e,i,n,r){var a=this.generateExportList(n||this.table.options.htmlOutputConfig,i,e,r||"htmlOutput");return this.generateHTMLTable(a)}mapElementStyles(e,i,n){if(this.cloneTableStyle&&e&&i){var r={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var a=window.getComputedStyle(e);n.forEach(function(s){i.style[r[s]]||(i.style[r[s]]=a.getPropertyValue(s))})}}}}var BQe={"=":function(t,e,i,n){return e==t},"<":function(t,e,i,n){return e<t},"<=":function(t,e,i,n){return e<=t},">":function(t,e,i,n){return e>t},">=":function(t,e,i,n){return e>=t},"!=":function(t,e,i,n){return e!=t},regex:function(t,e,i,n){return typeof t=="string"&&(t=new RegExp(t)),t.test(e)},like:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(t.toLowerCase())>-1:!1},keywords:function(t,e,i,n){var r=t.toLowerCase().split(typeof n.separator>"u"?" ":n.separator),a=String(e===null||typeof e>"u"?"":e).toLowerCase(),s=[];return r.forEach(o=>{a.includes(o)&&s.push(!0)}),n.matchAll?s.length===r.length:!!s.length},starts:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(t.toLowerCase()):!1},ends:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(t.toLowerCase()):!1},in:function(t,e,i,n){return Array.isArray(t)?t.length?t.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",t),!1)}};class UI extends Vn{static moduleName="filter";static filters=BQe;constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var i=this.table.columnManager.findColumn(e.field);if(i)this.setHeaderFilterValue(i,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,i,n,r){return r.filter=this.getFilters(!0,!0),r}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,i,n,r){this.setFilter(e,i,n,r),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,i,n,r){this.addFilter(e,i,n,r),this.refreshFilter()}userSetHeaderFilterFocus(e){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterFocus(i);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var i=this.table.columnManager.findColumn(e);if(i)return this.getHeaderFilterValue(i);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,i){var n=this.table.columnManager.findColumn(e);if(n)this.setHeaderFilterValue(n,i);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,i,n){this.removeFilter(e,i,n),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,i,n){return this.search("rows",e,i,n)}searchData(e,i,n){return this.search("data",e,i,n)}initializeColumnHeaderFilter(e){var i=e.definition;i.headerFilter&&this.initializeColumn(e)}initializeColumn(e,i){var n=this,r=e.getField();function a(s){var o=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",u="",c;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==s){if(e.modules.filter.prevSuccess=s,e.modules.filter.emptyFunc(s))delete n.headerFilters[r];else{switch(e.modules.filter.value=s,typeof e.definition.headerFilterFunc){case"string":UI.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,c=function(d){var p=e.definition.headerFilterFuncParams||{},h=e.getFieldValue(d);return p=typeof p=="function"?p(s,h,d):p,UI.filters[e.definition.headerFilterFunc](s,h,d,p)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":c=function(d){var p=e.definition.headerFilterFuncParams||{},h=e.getFieldValue(d);return p=typeof p=="function"?p(s,h,d):p,e.definition.headerFilterFunc(s,h,d,p)},l=c;break}if(!c)switch(o){case"partial":c=function(d){var p=e.getFieldValue(d);return typeof p<"u"&&p!==null?String(p).toLowerCase().indexOf(String(s).toLowerCase())>-1:!1},l="like";break;default:c=function(d){return e.getFieldValue(d)==s},l="="}n.headerFilters[r]={value:s,func:c,type:l}}e.modules.filter.value=s,u=JSON.stringify(n.headerFilters),n.prevHeaderFilterChangeCheck!==u&&(n.prevHeaderFilterChangeCheck=u,n.trackChanges(),n.refreshFilter())}return!0}e.modules.filter={success:a,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,i,n){var r=this,a=e.modules.filter.success,s=e.getField(),o,l,u,c,d,p,h,f;e.modules.filter.value=i;function m(){}function g(v){f=v}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),s){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(v){return!v&&v!==0},o=document.createElement("div"),o.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":r.table.modules.edit.editors[e.definition.headerFilter]?(l=r.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&r.table.modules.edit.editors[e.definition.formatter]?(l=r.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):l=r.table.modules.edit.editors.input;break}if(l){if(c={getValue:function(){return typeof i<"u"?i:""},getField:function(){return e.definition.field},getElement:function(){return o},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},h=e.definition.headerFilterParams||{},h=typeof h=="function"?h.call(r.table,c):h,u=l.call(this.table.modules.edit,c,g,a,m,h),!u){console.warn("Filter Error - Cannot add filter to "+s+" column, editor returned a value of false");return}if(!(u instanceof Node)){console.warn("Filter Error - Cannot add filter to "+s+" column, editor should return an instance of Node, the editor returned:",u);return}r.langBind("headerFilters|columns|"+e.definition.field,function(v){u.setAttribute("placeholder",typeof v<"u"&&v?v:e.definition.headerFilterPlaceholder||r.langText("headerFilters|default"))}),u.addEventListener("click",function(v){v.stopPropagation(),u.focus()}),u.addEventListener("focus",v=>{var y=this.table.columnManager.contentsElement.scrollLeft,b=this.table.rowManager.element.scrollLeft;y!==b&&(this.table.rowManager.scrollHorizontal(y),this.table.columnManager.scrollHorizontal(y))}),d=!1,p=function(v){d&&clearTimeout(d),d=setTimeout(function(){a(u.value)},r.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=u,e.modules.filter.attrType=u.hasAttribute("type")?u.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=u.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(u.addEventListener("keyup",p),u.addEventListener("search",p),e.modules.filter.attrType=="number"&&u.addEventListener("change",function(v){a(u.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&u.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&u.addEventListener("mousedown",function(v){v.stopPropagation()})),o.appendChild(u),e.contentElement.appendChild(o),n||r.headerFilterColumns.push(e),f&&f()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,i){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,i,!0),e.modules.filter.success(i)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,i,n,r){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:i,value:n,params:r}]),this.addFilter(e)}addFilter(e,i,n,r){var a=!1;Array.isArray(e)||(e=[{field:e,type:i,value:n,params:r}]),e.forEach(s=>{s=this.findFilter(s),s&&(this.filterList.push(s),a=!0)}),a&&this.trackChanges()}findFilter(e){var i;if(Array.isArray(e))return this.findSubFilters(e);var n=!1;return typeof e.field=="function"?n=function(r){return e.field(r,e.type||{})}:UI.filters[e.type]?(i=this.table.columnManager.getColumnByField(e.field),i?n=function(r){return UI.filters[e.type](e.value,i.getFieldValue(r),r,e.params||{})}:n=function(r){return UI.filters[e.type](e.value,r[e.field],r,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=n,e.func?e:!1}findSubFilters(e){var i=[];return e.forEach(n=>{n=this.findFilter(n),n&&i.push(n)}),i.length?i:!1}getFilters(e,i){var n=[];return e&&(n=this.getHeaderFilters()),i&&n.forEach(function(r){typeof r.type=="function"&&(r.type="function")}),n=n.concat(this.filtersToArray(this.filterList,i)),n}filtersToArray(e,i){var n=[];return e.forEach(r=>{var a;Array.isArray(r)?n.push(this.filtersToArray(r,i)):(a={field:r.field,type:r.type,value:r.value},i&&typeof a.type=="function"&&(a.type="function"),n.push(a))}),n}getHeaderFilters(){var e=[];for(var i in this.headerFilters)e.push({field:i,type:this.headerFilters[i].type,value:this.headerFilters[i].value});return e}removeFilter(e,i,n){Array.isArray(e)||(e=[{field:e,type:i,value:n}]),e.forEach(r=>{var a=-1;typeof r.field=="object"?a=this.filterList.findIndex(s=>r===s):a=this.filterList.findIndex(s=>r.field===s.field&&r.type===s.type&&r.value===s.value),a>-1?this.filterList.splice(a,1):console.warn("Filter Error - No matching filter type found, ignoring: ",r.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,i,n,r){var a=[],s=[];return Array.isArray(i)||(i=[{field:i,type:n,value:r}]),i.forEach(o=>{o=this.findFilter(o),o&&s.push(o)}),this.table.rowManager.rows.forEach(o=>{var l=!0;s.forEach(u=>{this.filterRecurse(u,o.getData())||(l=!1)}),l&&a.push(e==="data"?o.getData("data"):o.getComponent())}),a}filter(e,i){var n=[],r=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(a=>{this.filterRow(a)&&n.push(a)}):n=e.slice(0),this.subscribedExternal("dataFiltered")&&(n.forEach(a=>{r.push(a.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),r)),n}filterRow(e,i){var n=!0,r=e.getData();this.filterList.forEach(s=>{this.filterRecurse(s,r)||(n=!1)});for(var a in this.headerFilters)this.headerFilters[a].func(r)||(n=!1);return n}filterRecurse(e,i){var n=!1;return Array.isArray(e)?e.forEach(r=>{this.filterRecurse(r,i)&&(n=!0)}):n=e.func(i),n}}function VQe(t,e,i){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function jQe(t,e,i){return t.getValue()}function GQe(t,e,i){return t.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function HQe(t,e,i){var n=parseFloat(t.getValue()),r="",a,s,o,l,u,c=e.decimal||".",d=e.thousand||",",p=e.negativeSign||"-",h=e.symbol||"",f=!!e.symbolAfter,m=typeof e.precision<"u"?e.precision:2;if(isNaN(n))return this.emptyToSpace(this.sanitizeHTML(t.getValue()));if(n<0&&(n=Math.abs(n),r=p),a=m!==!1?n.toFixed(m):n,a=String(a).split("."),s=a[0],o=a.length>1?c+a[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(s);)s=s.replace(l,"$1"+d+"$2");return u=s+o,r===!0?(u="("+u+")",f?u+h:h+u):f?r+u+h:r+h+u}function zQe(t,e,i){var n=t.getValue(),r=e.urlPrefix||"",a=e.download,s=n,o=document.createElement("a"),l;function u(c,d){var p=c.shift(),h=d[p];return c.length&&typeof h=="object"?u(c,h):h}if(e.labelField&&(l=t.getData(),s=u(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":s=e.label;break;case"function":s=e.label(t);break}if(s){if(e.urlField&&(l=t.getData(),n=Ia.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,l)),e.url)switch(typeof e.url){case"string":n=e.url;break;case"function":n=e.url(t);break}return o.setAttribute("href",r+n),e.target&&o.setAttribute("target",e.target),e.download&&(typeof a=="function"?a=a(t):a=a===!0?"":a,o.setAttribute("download",a)),o.innerHTML=this.emptyToSpace(this.sanitizeHTML(s)),o}else return"&nbsp;"}function qQe(t,e,i){var n=document.createElement("img"),r=t.getValue();switch(e.urlPrefix&&(r=e.urlPrefix+t.getValue()),e.urlSuffix&&(r=r+e.urlSuffix),n.setAttribute("src",r),typeof e.height){case"number":n.style.height=e.height+"px";break;case"string":n.style.height=e.height;break}switch(typeof e.width){case"number":n.style.width=e.width+"px";break;case"string":n.style.width=e.width;break}return n.addEventListener("load",function(){t.getRow().normalizeHeight()}),n}function WQe(t,e,i){var n=t.getValue(),r=t.getElement(),a=e.allowEmpty,s=e.allowTruthy,o=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',u=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return o&&n===e.trueValue||!o&&(s&&n||n===!0||n==="true"||n==="True"||n===1||n==="1")?(r.setAttribute("aria-checked",!0),l||""):a&&(n==="null"||n===""||n===null||typeof n>"u")?(r.setAttribute("aria-checked","mixed"),""):(r.setAttribute("aria-checked",!1),u||"")}function YQe(t,e,i){var n=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),r=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=e.outputFormat||"dd/MM/yyyy HH:mm:ss",s=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=t.getValue();if(typeof n<"u"){var l;return n.isDateTime(o)?l=o:r==="iso"?l=n.fromISO(String(o)):l=n.fromFormat(String(o),r),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(a)):s===!0||!o?o:typeof s=="function"?s(o):s}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function KQe(t,e,i){var n=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),r=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",s=typeof e.suffix<"u"?e.suffix:!1,o=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,u=typeof e.date<"u"?e.date:n.now(),c=t.getValue();if(typeof n<"u"){var d;return n.isDateTime(c)?d=c:r==="iso"?d=n.fromISO(String(c)):d=n.fromFormat(String(c),r),d.isValid?l?d.diff(u,o).toHuman()+(s?" "+s:""):parseInt(d.diff(u,o)[o])+(s?" "+s:""):a===!0?c:typeof a=="function"?a(c):a}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function ZQe(t,e,i){var n=t.getValue();return typeof e[n]>"u"?(console.warn("Missing display value for "+n),n):e[n]}function XQe(t,e,i){var n=t.getValue(),r=t.getElement(),a=e&&e.stars?e.stars:5,s=document.createElement("span"),o=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',u='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';s.style.verticalAlign="middle",o.setAttribute("width","14"),o.setAttribute("height","14"),o.setAttribute("viewBox","0 0 512 512"),o.setAttribute("xml:space","preserve"),o.style.padding="0 1px",n=n&&!isNaN(n)?parseInt(n):0,n=Math.max(0,Math.min(n,a));for(var c=1;c<=a;c++){var d=o.cloneNode(!0);d.innerHTML=c<=n?l:u,s.appendChild(d)}return r.style.whiteSpace="nowrap",r.style.overflow="hidden",r.style.textOverflow="ellipsis",r.setAttribute("aria-label",n),s}function JQe(t,e,i){var n=this.sanitizeHTML(t.getValue())||0,r=document.createElement("span"),a=e&&e.max?e.max:100,s=e&&e.min?e.min:0,o=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",u,c;if(!(isNaN(n)||typeof t.getValue()>"u")){switch(r.classList.add("tabulator-traffic-light"),c=parseFloat(n)<=a?parseFloat(n):a,c=parseFloat(c)>=s?parseFloat(c):s,u=(a-s)/100,c=Math.round((c-s)/u),typeof o){case"string":l=o;break;case"function":l=o(n);break;case"object":if(Array.isArray(o)){var d=100/o.length,p=Math.floor(c/d);p=Math.min(p,o.length-1),p=Math.max(p,0),l=o[p];break}}return r.style.backgroundColor=l,r}}function QQe(t,e={},i){var n=this.sanitizeHTML(t.getValue())||0,r=t.getElement(),a=e.max?e.max:100,s=e.min?e.min:0,o=e.legendAlign?e.legendAlign:"center",l,u,c,d,p;switch(u=parseFloat(n)<=a?parseFloat(n):a,u=parseFloat(u)>=s?parseFloat(u):s,l=(a-s)/100,u=Math.round((u-s)/l),typeof e.color){case"string":c=e.color;break;case"function":c=e.color(n);break;case"object":if(Array.isArray(e.color)){let g=100/e.color.length,v=Math.floor(u/g);v=Math.min(v,e.color.length-1),v=Math.max(v,0),c=e.color[v];break}default:c="#2DC214"}switch(typeof e.legend){case"string":d=e.legend;break;case"function":d=e.legend(n);break;case"boolean":d=n;break;default:d=!1}switch(typeof e.legendColor){case"string":p=e.legendColor;break;case"function":p=e.legendColor(n);break;case"object":if(Array.isArray(e.legendColor)){let g=100/e.legendColor.length,v=Math.floor(u/g);v=Math.min(v,e.legendColor.length-1),v=Math.max(v,0),p=e.legendColor[v]}break;default:p="#000"}r.style.minWidth="30px",r.style.position="relative",r.setAttribute("aria-label",u);var h=document.createElement("div");h.style.display="inline-block",h.style.width=u+"%",h.style.backgroundColor=c,h.style.height="100%",h.setAttribute("data-max",a),h.setAttribute("data-min",s);var f=document.createElement("div");if(f.style.position="relative",f.style.width="100%",f.style.height="100%",d){var m=document.createElement("div");m.style.position="absolute",m.style.top=0,m.style.left=0,m.style.textAlign=o,m.style.width="100%",m.style.color=p,m.innerHTML=d}return i(function(){if(!(t instanceof QEe)){var g=document.createElement("div");g.style.position="absolute",g.style.top="4px",g.style.bottom="4px",g.style.left="4px",g.style.right="4px",r.appendChild(g),r=g}r.appendChild(f),f.appendChild(h),d&&f.appendChild(m)}),""}function eet(t,e,i){return t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue()),""}function tet(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function iet(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function net(t,e,i){var n=t.getValue(),r=e.size||15,a=r+"px",s,o,l=e.hasOwnProperty("onValue")?e.onValue:!0,u=e.hasOwnProperty("offValue")?e.offValue:!1,c=e.onTruthy?n:n===l;return s=document.createElement("div"),s.classList.add("tabulator-toggle"),c?(s.classList.add("tabulator-toggle-on"),s.style.flexDirection="row-reverse",e.onColor&&(s.style.background=e.onColor)):e.offColor&&(s.style.background=e.offColor),s.style.width=2.5*r+"px",s.style.borderRadius=a,e.clickable&&s.addEventListener("click",d=>{t.setValue(c?u:l)}),o=document.createElement("div"),o.classList.add("tabulator-toggle-switch"),o.style.height=a,o.style.width=a,o.style.borderRadius=a,s.appendChild(o),s}function ret(t,e,i){var n=document.createElement("span"),r=t.getRow(),a=t.getTable();return r.watchPosition(s=>{e.relativeToPage&&(s+=a.modules.page.getPageSize()*(a.modules.page.getPage()-1)),n.innerText=s}),n}function aet(t,e,i){return t.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}function set(t,e,i){var n,r,a;function s(o){var l=o.getValue(),u="plaintext";switch(typeof l){case"boolean":u="tickCross";break;case"string":l.includes(`
`)&&(u="textarea");break}return u}return n=e.formatterLookup?e.formatterLookup(t):s(t),e.paramsLookup&&(a=typeof e.paramsLookup=="function"?e.paramsLookup(n,t):e.paramsLookup[n]),r=this.table.modules.format.lookupFormatter(n),r.call(this,t,a||{},i)}function oet(t,e,i){var n=e.delimiter||",",r=t.getValue(),a=this.table,s;return e.valueMap&&(typeof e.valueMap=="string"?s=function(o){return o.map(l=>Ia.retrieveNestedData(a.options.nestedFieldSeparator,e.valueMap,l))}:s=e.valueMap),Array.isArray(r)?(s&&(r=s(r)),r.join(n)):r}function uet(t,e,i){var n=e.indent||"	",r=typeof e.multiline>"u"?!0:e.multiline,a=e.replacer||null,s=t.getValue();return r&&(t.getElement().style.whiteSpace="pre-wrap"),JSON.stringify(s,a,n)}var cet={plaintext:VQe,html:jQe,textarea:GQe,money:HQe,link:zQe,image:qQe,tickCross:WQe,datetime:YQe,datetimediff:KQe,lookup:ZQe,star:XQe,traffic:JQe,progress:QQe,color:eet,buttonTick:tet,buttonCross:iet,toggle:net,rownum:ret,handle:aet,adaptable:set,array:oet,json:uet};class aT extends Vn{static moduleName="format";static formatters=cet;constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupTypeFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupTypeFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupTypeFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupTypeFormatter(e,"HtmlOutput"))}lookupTypeFormatter(e,i){var n={params:e.definition["formatter"+i+"Params"]||{}},r=e.definition["formatter"+i];return n.formatter=this.lookupFormatter(r),n}lookupFormatter(e){var i;switch(typeof e){case"string":aT.formatters[e]?i=aT.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),i=aT.formatters.plaintext);break;case"function":i=e;break;default:i=aT.formatters.plaintext;break}return i}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,i,n){var r,a,s,o;return e.definition.titleFormatter?(r=this.lookupFormatter(e.definition.titleFormatter),s=l=>{e.titleFormatterRendered=l},o={getValue:function(){return i},getElement:function(){return n},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},a=e.definition.titleFormatterParams||{},a=typeof a=="function"?a():a,r.call(this,o,a,s)):i}formatValue(e){var i=e.getComponent(),n=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(i):e.column.modules.format.params;function r(a){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=a,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,i,n,r)}formatExportValue(e,i){var n=e.column.modules.format[i],r;if(n){let a=function(s){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=s,e.modules.format.rendered=!1};return r=typeof n.params=="function"?n.params(e.getComponent()):n.params,n.formatter.call(this,e.getComponent(),r,a)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(n){return i[n]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}}class det extends Vn{static moduleName="frozenColumns";constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("columns-loaded",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var i={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(i.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=i):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(i=>{i.calcs.top&&this.layoutRow(i.calcs.top),i.calcs.bottom&&this.layoutRow(i.calcs.bottom),i.groupList&&i.groupList.length&&this.layoutGroupCalcs(i.groupList)})}layoutColumnPosition(e){var i=[],n=0,r=0;this.leftColumns.forEach((a,s)=>{if(a.modules.frozen.marginValue=n,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(n+=a.getWidth()),s==this.leftColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup){var o=this.getColGroupParentElement(a);i.includes(o)||(this.layoutElement(o,a),i.push(o)),o.classList.toggle("tabulator-frozen-left",a.modules.frozen.edge&&a.modules.frozen.position==="left"),o.classList.toggle("tabulator-frozen-right",a.modules.frozen.edge&&a.modules.frozen.position==="right")}else this.layoutElement(a.getElement(),a);e&&a.cells.forEach(l=>{this.layoutElement(l.getElement(!0),a)})}),this.rightColumns.forEach((a,s)=>{a.modules.frozen.marginValue=r,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(r+=a.getWidth()),s==this.rightColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup?this.layoutElement(this.getColGroupParentElement(a),a):this.layoutElement(a.getElement(),a),e&&a.cells.forEach(o=>{this.layoutElement(o.getElement(!0),a)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),i=this.table.rowManager.getRows().filter(n=>!e.includes(n));i.forEach(n=>{n.deinitialize()}),e.forEach(n=>{n.type==="row"&&this.layoutRow(n)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(i=>{var n=e.getCell(i);n&&this.layoutElement(n.getElement(!0),i)}),this.rightColumns.forEach(i=>{var n=e.getCell(i);n&&this.layoutElement(n.getElement(!0),i)})}layoutElement(e,i){var n;i.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?n=i.modules.frozen.position==="left"?"right":"left":n=i.modules.frozen.position,e.style[n]=i.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",i.modules.frozen.edge&&i.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",i.modules.frozen.edge&&i.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}getFrozenColumns(){return this.leftColumns.concat(this.rightColumns)}_calcSpace(e,i){var n=0;for(let r=0;r<i;r++)e[r].visible&&(n+=e[r].getWidth());return n}}class pet extends Vn{static moduleName="frozenRows";constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var i=this.table.options.frozenRows,n=typeof i;n==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=i&&this.freezeRow(e):n==="function"?i.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(i)&&i.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var i=this.rows.indexOf(e);return i>-1}isFrozen(){return!!this.rows.length}visibleRows(e,i){return this.rows.forEach(n=>{i.push(n)}),i}getRows(e){var i=e.slice(0);return this.rows.forEach(function(n){var r=i.indexOf(n);r>-1&&i.splice(r,1)}),i}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var i=this.rows.indexOf(e);if(i>-1){var n=e.getElement();n.parentNode&&n.parentNode.removeChild(n),this.rows.splice(i,1)}}styleRows(e){this.rows.forEach((i,n)=>{this.table.rowManager.styleRow(i,n)})}}class het{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._group.groupManager.table.componentFunctionBinder.handle("group",i._group,n)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,i){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,i)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class sT{constructor(e,i,n,r,a,s,o){this.groupManager=e,this.parent=i,this.key=r,this.level=n,this.field=a,this.hasSubGroups=n<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=o,this.rows=[],this.groups=[],this.groupList=[],this.generator=s,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=o?o.visible:typeof e.startOpen[n]<"u"?e.startOpen[n]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(i){i.wipe()}):this.rows.forEach(i=>{i.modules&&delete i.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(i=>{this._createGroup(i,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",i=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(i.stopPropagation(),i.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,i){var n=i+"_"+e,r=new sT(this.groupManager,this,i,e,this.groupManager.groupIDLookups[i].field,this.groupManager.headerGenerator[i]||this.groupManager.headerGenerator[0],this.old?this.old.groups[n]:!1);this.groups[n]=r,this.groupList.push(r)}_addRowToGroup(e){var i=this.level+1;if(this.hasSubGroups){var n=this.groupManager.groupIDLookups[i].func(e.getData()),r=i+"_"+n;this.groupManager.allowedValues&&this.groupManager.allowedValues[i]?this.groups[r]&&this.groups[r].addRow(e):(this.groups[r]||this._createGroup(n,i),this.groups[r].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,i,n){var r=this.conformRowData({});e.updateData(r);var a=this.rows.indexOf(i);a>-1?n?this.rows.splice(a+1,0,e):this.rows.splice(a,0,e):n?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(i){i.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var i=this.rows.indexOf(e),n=e.getElement();i>-1&&this.rows.splice(i,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(n.parentNode&&n.parentNode.removeChild(n),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var i=e.level+"_"+e.key,n;this.groups[i]&&(delete this.groups[i],n=this.groupList.indexOf(e),n>-1&&this.groupList.splice(n,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(i){e=e.concat(i.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,i){var n=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(r=>{n.push(r.getData(i||"data"))}),n}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(i=>{e+=i.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var i=e.getHeadersAndRows();i.forEach(n=>{n.detachElement()})}):this.rows.forEach(e=>{var i=e.getElement();i.parentNode.removeChild(i)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(i=>{var n=i.getHeadersAndRows();n.forEach(r=>{var a=r.getElement();e.parentNode.insertBefore(a,e.nextSibling),r.initialize(),e=a})}):this.rows.forEach(i=>{var n=i.getElement();e.parentNode.insertBefore(n,e.nextSibling),i.initialize(),e=n}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(i){e.push(i.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var i=!1;return this.groupList.length?this.groupList.forEach(function(n){var r=n.getRowGroup(e);r&&(i=r)}):this.rows.find(function(n){return n===e})&&(i=this),i}getSubGroups(e){var i=[];return this.groupList.forEach(function(n){i.push(e?n.getComponent():n)}),i}getRows(e,i){var n=[];return i&&this.groupList.length?this.groupList.forEach(r=>{n=n.concat(r.getRows(e,i))}):this.rows.forEach(function(r){n.push(e?r.getComponent():r)}),n}generateGroupHeaderContents(){var e=[],i=this.getRows(!1,!0);for(i.forEach(function(n){e.push(n.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,Ia.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new het(this)),this.component}}class fet extends Vn{static moduleName="groupRows";constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,i=this.table.options.groupStartOpen,n=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(n)&&e.length>n.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(a,s)=>{this.headerGenerator[0]=(o,l,u)=>(typeof o>"u"?"":o)+"<span>("+l+" "+(l===1?a:s.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var r=this.table.columnManager.getRealColumns();r.forEach(a=>{a.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),a.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((a,s)=>{var o,l;typeof a=="function"?o=a:(l=this.table.columnManager.getColumnByField(a),l?o=function(u){return l.getFieldValue(u)}:o=function(u){return u[a]}),this.groupIDLookups.push({field:typeof a=="function"?!1:a,func:o,values:this.allowedValues?this.allowedValues[s]:!1})}),i&&(Array.isArray(i)||(i=[i]),i.forEach(a=>{}),this.startOpen=i),n&&(this.headerGenerator=Array.isArray(n)?n:[n])}else this.groupList=[],this.groups={}}rowSample(e,i){if(this.table.options.groupBy){var n=this.getGroups(!1)[0];i.push(n.getRows(!1)[0])}return i}virtualRenderFill(){var e=this.table.rowManager.tableElement,i=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)i=i.filter(n=>n.type!=="group"),e.style.minWidth=i.length?"":this.table.columnManager.getWidth()+"px";else return i}rowAddingIndex(e,i,n){if(this.table.options.groupBy){this.assignRowToGroup(e);var r=e.modules.group.rows;return r.length>1&&(!i||i&&r.indexOf(i)==-1?n?r[0]!==e&&(i=r[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)):r[r.length-1]!==e&&(i=r[r.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)),i}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,i,n){if(this.table.options.groupBy){!n&&i instanceof sT&&(i=this.table.rowManager.prevDisplayRow(e)||i);var r=i instanceof sT?i:i.modules.group,a=e instanceof sT?e:e.modules.group;r===a?this.table.rowManager.moveRowInArray(r.rows,e,i,n):(a&&a.removeRow(e),r.insertRow(e,i,n))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var i=[];return this.groupList.forEach(function(n){i.push(e?n.getComponent():n)}),i}getChildGroups(e){var i=[];return e||(e=this),e.groupList.forEach(n=>{n.groupList.length?i=i.concat(this.getChildGroups(n)):i.push(n)}),i}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var i=[];return e.forEach(n=>{var r={};r.level=0,r.rowCount=0,r.headerContent="";var a=[];n.hasSubGroups?(a=this.pullGroupListData(n.groupList),r.level=n.level,r.rowCount=a.length-n.groupList.length,r.headerContent=n.generator(n.key,r.rowCount,n.rows,n),i.push(r),i=i.concat(a)):(r.level=n.level,r.headerContent=n.generator(n.key,n.rows.length,n.rows,n),r.rowCount=n.getRows().length,i.push(r),n.getRows().forEach(s=>{i.push(s.getData("data"))}))}),i}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var i=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(n=>{var r=n.getRowGroup(e);r&&(i=r)}),i}countGroups(){return this.groupList.length}generateGroups(e){var i=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(n=>{this.createGroup(n,0,i)}),e.forEach(n=>{this.assignRowToExistingGroup(n,i)})):e.forEach(n=>{this.assignRowToGroup(n,i)}),Object.values(i).forEach(n=>{n.wipe(!0)})}createGroup(e,i,n){var r=i+"_"+e,a;n=n||[],a=new sT(this,!1,i,e,this.groupIDLookups[0].field,this.headerGenerator[0],n[r]),this.groups[r]=a,this.groupList.push(a)}assignRowToExistingGroup(e,i){var n=this.groupIDLookups[0].func(e.getData()),r="0_"+n;this.groups[r]&&this.groups[r].addRow(e)}assignRowToGroup(e,i){var n=this.groupIDLookups[0].func(e.getData()),r=!this.groups["0_"+n];return r&&this.createGroup(n,0,i),this.groups["0_"+n].addRow(e),!r}reassignRowToGroup(e){if(e.type==="row"){var i=e.modules.group,n=i.getPath(),r=this.getExpectedPath(e),a;a=n.length==r.length&&n.every((s,o)=>s===r[o]),a||(i.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var i=[],n=e.getData();return this.groupIDLookups.forEach(r=>{i.push(r.func(n))}),i}updateGroupRows(e){var i=[];return this.blockRedraw||(this.groupList.forEach(n=>{i=i.concat(n.getHeadersAndRows())}),e&&this.refreshData(!0)),i}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(i=>{i.scrollHeader(e)}))}removeGroup(e){var i=e.level+"_"+e.key,n;this.groups[i]&&(delete this.groups[i],n=this.groupList.indexOf(e),n>-1&&this.groupList.splice(n,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,i=!0;this.table.rowManager.getDisplayRows().forEach((n,r)=>{this.table.rowManager.styleRow(n,r),e.appendChild(n.getElement()),n.initialize(!0),n.type!=="group"&&(i=!1)}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}var met={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue),t.component.cellRendered()},rowAdd:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(t){var e=t.data.posFrom-t.data.posTo>0;this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},get={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue),t.component.cellRendered()},rowAdd:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posTo),t.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},vet={undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"]},yet={undo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.undo()))},redo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.redo()))}},bet={keybindings:{bindings:vet,actions:yet}};let Iet=class vz extends Vn{static moduleName="history";static moduleExtensions=bet;static undoers=met;static redoers=get;constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,i,n){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:i.getPosition(),to:i,after:n})}rowAdded(e,i,n,r){this.action("rowAdd",e,{data:i,pos:n,index:r})}rowDeleted(e){var i,n;this.table.options.groupBy?(n=e.getComponent().getGroup()._getSelf().rows,i=n.indexOf(e),i&&(i=n[i-1])):(i=e.table.rowManager.getRowIndex(e),i&&(i=e.table.rowManager.rows[i-1])),this.action("rowDelete",e,{data:e.getData(),pos:!i,index:i})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,i,n){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:i,data:n}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var i=this.history.findIndex(function(n){return n.component===e});i>-1&&(this.history.splice(i,1),i<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return vz.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return vz.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,i){this.history.forEach(function(n){if(n.component instanceof tu)n.component===e&&(n.component=i);else if(n.component instanceof RN&&n.component.row===e){var r=n.component.column.getField();r&&(n.component=i.getCell(r))}})}};class wet extends Vn{static moduleName="htmlTableImport";constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,i=this.table.options,n=e.getElementsByTagName("th"),r=e.getElementsByTagName("tbody")[0],a=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),r=r?r.getElementsByTagName("tr"):[],this._extractOptions(e,i),n.length?this._extractHeaders(n,r):this._generateBlankHeaders(n,r);for(var s=0;s<r.length;s++){var o=r[s],l=o.getElementsByTagName("td"),u={};this.hasIndex||(u[i.index]=s);for(var c=0;c<l.length;c++){var d=l[c];typeof this.fieldIndex[c]<"u"&&(u[this.fieldIndex[c]]=d.innerHTML)}a.push(u)}i.data=a,this.dispatchExternal("htmlImported")}_extractOptions(e,i,n){var r=e.attributes,a=Object.keys(n||i),s={};a.forEach(c=>{s[c.toLowerCase()]=c});for(var o in r){var l=r[o],u;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(u=l.name.replace("tabulator-",""),typeof s[u]<"u"&&(i[s[u]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var i=this.table.options.columns.find(n=>n.title===e);return i||!1}_extractHeaders(e,i){for(var n=0;n<e.length;n++){var r=e[n],a=!1,s=this._findCol(r.textContent),o;s?a=!0:s={title:r.textContent.trim()},s.field||(s.field=r.textContent.trim().toLowerCase().replaceAll(" ","_")),o=r.getAttribute("width"),o&&!s.width&&(s.width=o),this._extractOptions(r,s,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[n]=s.field,s.field==this.table.options.index&&(this.hasIndex=!0),a||this.table.options.columns.push(s)}}_generateBlankHeaders(e,i){for(var n=0;n<e.length;n++){var r=e[n],a={title:"",field:"col"+n};this.fieldIndex[n]=a.field;var s=r.getAttribute("width");s&&(a.width=s),this.table.options.columns.push(a)}}}function Tet(t){var e=[],i=0,n=0,r=!1;for(let a=0;a<t.length;a++){let s=t[a],o=t[a+1];if(e[i]||(e[i]=[]),e[i][n]||(e[i][n]=""),s=='"'&&r&&o=='"'){e[i][n]+=s,a++;continue}if(s=='"'){r=!r;continue}if(s==","&&!r){n++;continue}if(s=="\r"&&o==`
`&&!r){n=0,i++,a++;continue}if((s=="\r"||s==`
`)&&!r){n=0,i++;continue}e[i][n]+=s}return e}function Uet(t){try{return JSON.parse(t)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function Det(t){return t}function Eet(t){var e=this.dependencyRegistry.lookup("XLSX"),i=e.read(t),n=i.Sheets[i.SheetNames[0]];return e.utils.sheet_to_json(n,{header:1})}var Pet={csv:Tet,json:Uet,array:Det,xlsx:Eet};class SK extends Vn{static moduleName="import";static importers=Pet;constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text"),this.registerTableOption("importHeaderTransform"),this.registerTableOption("importValueTransform"),this.registerTableOption("importDataValidator"),this.registerTableOption("importFileValidator")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,i,n,r,a){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(s=>(console.error("Import Error:",s||"Unable to import data"),Promise.reject(s)))}lookupImporter(e){var i;return e||(e=this.table.options.importFormat),typeof e=="string"?i=SK.importers[e]:i=e,i||console.error("Import Error - Importer not found:",e),i}importFromFile(e,i,n){var r=this.lookupImporter(e);if(r)return this.pickFile(i,n).then(this.importData.bind(this,r)).then(this.structureData.bind(this)).then(this.mutateData.bind(this)).then(this.validateData.bind(this)).then(this.setData.bind(this)).catch(a=>(this.dispatch("import-error",a),this.dispatchExternal("importError",a),console.error("Import Error:",a||"Unable to import file"),this.table.dataLoader.alertError(),setTimeout(()=>{this.table.dataLoader.clearAlert()},3e3),Promise.reject(a)))}pickFile(e,i){return new Promise((n,r)=>{var a=document.createElement("input");a.type="file",a.accept=e,a.addEventListener("change",s=>{var o=a.files[0],l=new FileReader,u=this.validateFile(o);if(u===!0){switch(this.dispatch("import-importing",a.files),this.dispatchExternal("importImporting",a.files),i||this.table.options.importReader){case"buffer":l.readAsArrayBuffer(o);break;case"binary":l.readAsBinaryString(o);break;case"url":l.readAsDataURL(o);break;case"text":default:l.readAsText(o)}l.onload=c=>{n(l.result)},l.onerror=c=>{console.warn("File Load Error - Unable to read file"),r(c)}}else r(u)}),this.dispatch("import-choose"),this.dispatchExternal("importChoose"),a.click()})}importData(e,i){var n;return this.table.dataLoader.alertLoader(),new Promise((r,a)=>{setTimeout(()=>{n=e.call(this.table,i),n instanceof Promise||n?r(n):a()},10)})}structureData(e){var i=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?i=this.structureArrayToObject(e):i=this.structureArrayToColumns(e),i):e}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(n=>{i.push(this.table.modules.mutator.transformRow(n,"import"))}):i=e,i}transformHeader(e){var i=[];if(this.table.options.importHeaderTransform)e.forEach(n=>{i.push(this.table.options.importHeaderTransform.call(this.table,n,e))});else return e;return i}transformData(e){var i=[];if(this.table.options.importValueTransform)e.forEach(n=>{i.push(this.table.options.importValueTransform.call(this.table,n,e))});else return e;return i}structureArrayToObject(e){var i=this.transformHeader(e.shift()),n=e.map(r=>{var a={};return r=this.transformData(r),i.forEach((s,o)=>{a[s]=r[o]}),a});return n}structureArrayToColumns(e){var i=[],n=this.transformHeader(e[0]),r=this.table.getColumns();return r[0]&&n[0]&&r[0].getDefinition().title===n[0]&&e.shift(),e.forEach(a=>{var s={};a=this.transformData(a),a.forEach((o,l)=>{var u=r[l];u&&(s[u.getField()]=o)}),i.push(s)}),i}validateFile(e){return this.table.options.importFileValidator?this.table.options.importFileValidator.call(this.table,e):!0}validateData(e){var i;return this.table.options.importDataValidator?(i=this.table.options.importDataValidator.call(this.table,e),i===!0?e:Promise.reject(i)):e}setData(e){return this.dispatch("import-imported",e),this.dispatchExternal("importImported",e),this.table.dataLoader.clearAlert(),this.table.setData(e)}}class Cet extends Vn{static moduleName="interaction";constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(i=>{for(let n in i)i[n]=null})}cellContentsSelectionFixer(e,i){var n;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===i)){e.preventDefault();try{document.selection?(n=document.body.createTextRange(),n.moveToElementText(i.getElement()),n.select()):window.getSelection&&(n=document.createRange(),n.selectNode(i.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(n))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,i){i?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var i=this.eventMap[e];this.touchSubscribers[i+"-touchstart"]||(this.touchSubscribers[i+"-touchstart"]=this.handleTouch.bind(this,i,"start"),this.touchSubscribers[i+"-touchend"]=this.handleTouch.bind(this,i,"end"),this.subscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.subscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var i=!0,n=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let r in this.eventMap)this.eventMap[r]===n&&this.subscribers[r]&&(i=!1);i&&(this.unsubscribe(n+"-touchstart",this.touchSubscribers[n+"-touchstart"]),this.unsubscribe(n+"-touchend",this.touchSubscribers[n+"-touchend"]),delete this.touchSubscribers[n+"-touchstart"],delete this.touchSubscribers[n+"-touchend"])}}initializeColumn(e){var i=e.definition;for(let n in this.eventMap)i[n]&&(this.subscriptionChanged(n,!0),this.columnSubscribers[n]||(this.columnSubscribers[n]=[]),this.columnSubscribers[n].push(e))}handle(e,i,n){this.dispatchEvent(e,i,n)}handleTouch(e,i,n,r){var a=this.touchWatchers[e];switch(e==="column"&&(e="header"),i){case"start":a.tap=!0,clearTimeout(a.tapHold),a.tapHold=setTimeout(()=>{clearTimeout(a.tapHold),a.tapHold=null,a.tap=null,clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"TapHold",n,r)},1e3);break;case"end":a.tap&&(a.tap=null,this.dispatchEvent(e+"Tap",n,r)),a.tapDbl?(clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"DblTap",n,r)):a.tapDbl=setTimeout(()=>{clearTimeout(a.tapDbl),a.tapDbl=null},300),clearTimeout(a.tapHold),a.tapHold=null;break}}dispatchEvent(e,i,n){var r=n.getComponent(),a;this.columnSubscribers[e]&&(n instanceof RN?a=n.column.definition[e]:n instanceof Zf&&(a=n.definition[e]),a&&a(i,r)),this.dispatchExternal(e,i,r)}}var Ret={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35},Met={keyBlock:function(t){t.stopPropagation(),t.preventDefault()},scrollPageUp:function(t){var e=this.table.rowManager,i=e.scrollTop-e.element.clientHeight;t.preventDefault(),e.displayRowsCount&&(i>=0?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(t){var e=this.table.rowManager,i=e.scrollTop+e.element.clientHeight,n=e.element.scrollHeight;t.preventDefault(),e.displayRowsCount&&(i<=n?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(t){this.dispatch("keybinding-nav-prev",t)},navNext:function(t){this.dispatch("keybinding-nav-next",t)},navLeft:function(t){this.dispatch("keybinding-nav-left",t)},navRight:function(t){this.dispatch("keybinding-nav-right",t)},navUp:function(t){this.dispatch("keybinding-nav-up",t)},navDown:function(t){this.dispatch("keybinding-nav-down",t)}};class xP extends Vn{static moduleName="keybindings";static bindings=Ret;static actions=Met;constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,i={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(i,xP.bindings),Object.assign(i,e),this.mapBindings(i),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let i in e)xP.actions[i]?e[i]&&(typeof e[i]!="object"&&(e[i]=[e[i]]),e[i].forEach(n=>{var r=Array.isArray(n)?n:[n];r.forEach(a=>{this.mapBinding(i,a)})})):console.warn("Key Binding Error - no such action:",i)}mapBinding(e,i){var n={action:xP.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},r=i.toString().toLowerCase().split(" ").join("").split("+");r.forEach(a=>{switch(a){case"ctrl":n.ctrl=!0;break;case"shift":n.shift=!0;break;case"meta":n.meta=!0;break;default:a=isNaN(a)?a.toUpperCase().charCodeAt(0):parseInt(a),n.keys.push(a),this.watchKeys[a]||(this.watchKeys[a]=[]),this.watchKeys[a].push(n)}})}bindEvents(){var e=this;this.keyupBinding=function(i){var n=i.keyCode,r=e.watchKeys[n];r&&(e.pressedKeys.push(n),r.forEach(function(a){e.checkBinding(i,a)}))},this.keydownBinding=function(i){var n=i.keyCode,r=e.watchKeys[n];if(r){var a=e.pressedKeys.indexOf(n);a>-1&&e.pressedKeys.splice(a,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,i){var n=!0;return e.ctrlKey==i.ctrl&&e.shiftKey==i.shift&&e.metaKey==i.meta?(i.keys.forEach(r=>{var a=this.pressedKeys.indexOf(r);a==-1&&(n=!1)}),n&&i.action.call(this,e),!0):!1}}class Net extends Vn{static moduleName="menu";constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var i=e.definition;i.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),i.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),i.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),i.headerMenu&&this.initializeColumnHeaderMenu(e),i.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),i.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),i.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var i=e.definition.headerMenuIcon,n;n=document.createElement("span"),n.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?n.appendChild(i):n.innerHTML=i):n.innerHTML="&vellip;",n.addEventListener("click",r=>{r.stopPropagation(),r.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,r,e)}),e.titleElement.insertBefore(n,e.titleElement.firstChild)}loadMenuTableCellEvent(e,i,n){n._cell&&(n=n._cell),n.column.definition[e]&&this.loadMenuEvent(n.column.definition[e],i,n)}loadMenuTableColumnEvent(e,i,n){n._column&&(n=n._column),n.definition[e]&&this.loadMenuEvent(n.definition[e],i,n)}loadMenuEvent(e,i,n){n._group?n=n._group:n._row&&(n=n._row),e=typeof e=="function"?e.call(this.table,i,n.getComponent()):e,this.loadMenu(i,n,e)}loadMenu(e,i,n,r,a){var s=!(e instanceof MouseEvent),o=document.createElement("div"),l;if(o.classList.add("tabulator-menu"),s||e.preventDefault(),!(!n||!n.length)){if(r)l=a.child(o);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(o)}n.forEach(u=>{var c=document.createElement("div"),d=u.label,p=u.disabled;u.separator?c.classList.add("tabulator-menu-separator"):(c.classList.add("tabulator-menu-item"),typeof d=="function"&&(d=d.call(this.table,i.getComponent())),d instanceof Node?c.appendChild(d):c.innerHTML=d,typeof p=="function"&&(p=p.call(this.table,i.getComponent())),p?(c.classList.add("tabulator-menu-item-disabled"),c.addEventListener("click",h=>{h.stopPropagation()})):u.menu&&u.menu.length?c.addEventListener("click",h=>{h.stopPropagation(),this.loadMenu(h,i,u.menu,c,l)}):u.action&&c.addEventListener("click",h=>{u.action(h,i.getComponent())}),u.menu&&u.menu.length&&c.classList.add("tabulator-menu-item-submenu")),o.appendChild(c)}),o.addEventListener("click",u=>{this.rootPopup&&this.rootPopup.hide()}),l.show(r||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",n,l),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=i,this.dispatch("menu-opened",n,l),this.dispatchExternal("menuOpened",i.getComponent()))}}}class Aet extends Vn{static moduleName="moveColumn";constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var i=this,n={},r;!e.modules.frozen&&!e.isGroup&&!e.isRowHeader&&(r=e.getElement(),n.mousemove=(function(a){e.parent===i.moving.parent&&((i.touchMove?a.touches[0].pageX:a.pageX)-Ia.elOffset(r).left+i.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(i.toCol!==e||!i.toColAfter)&&(r.parentNode.insertBefore(i.placeholderElement,r.nextSibling),i.moveColumn(e,!0)):(i.toCol!==e||i.toColAfter)&&(r.parentNode.insertBefore(i.placeholderElement,r),i.moveColumn(e,!1)))}).bind(i),r.addEventListener("mousedown",function(a){i.touchMove=!1,a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),r.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),i.bindTouchEvents(e)),e.modules.moveColumn=n}bindTouchEvents(e){var i=e.getElement(),n=!1,r,a,s,o,l,u;i.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,r=e.nextColumn(),s=r?r.getWidth()/2:0,a=e.prevColumn(),o=a?a.getWidth()/2:0,l=0,u=0,n=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),i.addEventListener("touchmove",c=>{var d,p;this.moving&&(this.moveHover(c),n||(n=c.touches[0].pageX),d=c.touches[0].pageX-n,d>0?r&&d-l>s&&(p=r,p!==e&&(n=c.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveColumn(p,!0))):a&&-d-u>o&&(p=a,p!==e&&(n=c.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveColumn(p,!1))),p&&(r=p.nextColumn(),l=s,s=r?r.getWidth()/2:0,a=p.prevColumn(),u=o,o=a?a.getWidth()/2:0))},{passive:!0}),i.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(c)})}startMove(e,i){var n=i.getElement(),r=this.table.columnManager.getContentsElement(),a=this.table.columnManager.getHeadersElement();this.table.modules.selectRange&&this.table.modules.selectRange.columnSelection&&this.table.modules.selectRange.mousedown&&this.table.modules.selectRange.selecting==="column"||(this.moving=i,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-Ia.elOffset(n).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",n.parentNode.insertBefore(this.placeholderElement,n),n.parentNode.removeChild(n),this.hoverElement=n.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),r.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=r.clientHeight-a.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e),this.dispatch("column-moving",e,this.moving))}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,i){var n=this.moving.getCells();this.toCol=e,this.toColAfter=i,i?e.getCells().forEach(function(r,a){var s=r.getElement(!0);s.parentNode&&n[a]&&s.parentNode.insertBefore(n[a].getElement(),s.nextSibling)}):e.getCells().forEach(function(r,a){var s=r.getElement(!0);s.parentNode&&n[a]&&s.parentNode.insertBefore(n[a].getElement(),s)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var i=this.table.columnManager.getContentsElement(),n=i.scrollLeft,r=(this.touchMove?e.touches[0].pageX:e.pageX)-Ia.elOffset(i).left+n,a;this.hoverElement.style.left=r-this.startX+"px",r-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.max(0,n-5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1))),n+i.clientWidth-r<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.min(i.clientWidth,n+5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1)))}}var _et={delete:function(t,e,i){t.delete()}},ket={insert:function(t,e,i){return this.table.addRow(t.getData(),void 0,e),!0},add:function(t,e,i){return this.table.addRow(t.getData()),!0},update:function(t,e,i){return e?(e.update(t.getData()),!0):!1},replace:function(t,e,i){return e?(this.table.addRow(t.getData(),void 0,e),e.delete(),!0):!1}};class jx extends Vn{static moduleName="moveRow";static senders=_et;static receivers=ket;constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var i=this,n={};n.mouseup=(function(r){i.tableRowDrop(r,e)}).bind(i),n.mousemove=(function(r){var a;r.pageY-Ia.elOffset(e.element).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(a=e.getElement(),a.parentNode.insertBefore(i.placeholderElement,a.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(a=e.getElement(),a.previousSibling&&(a.parentNode.insertBefore(i.placeholderElement,a),i.moveRow(e,!1)))}).bind(i),e.modules.moveRow=n}initializeRow(e){var i=this,n={},r;n.mouseup=(function(a){i.tableRowDrop(a,e)}).bind(i),n.mousemove=(function(a){var s=e.getElement();a.pageY-Ia.elOffset(s).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(s.parentNode.insertBefore(i.placeholderElement,s.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(s.parentNode.insertBefore(i.placeholderElement,s),i.moveRow(e,!1))}).bind(i),this.hasHandle||(r=e.getElement(),r.addEventListener("mousedown",function(a){a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),r.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=n}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var i=this,n=e.getElement(!0);n.addEventListener("mousedown",function(r){r.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(r,e.row)},i.checkPeriod))}),n.addEventListener("mouseup",function(r){r.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e.row,n)}}bindTouchEvents(e,i){var n=!1,r,a,s,o,l,u;i.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,r=e.nextRow(),s=r?r.getHeight()/2:0,a=e.prevRow(),o=a?a.getHeight()/2:0,l=0,u=0,n=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,i.addEventListener("touchmove",c=>{var d,p;this.moving&&(c.preventDefault(),this.moveHover(c),n||(n=c.touches[0].pageY),d=c.touches[0].pageY-n,d>0?r&&d-l>s&&(p=r,p!==e&&(n=c.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveRow(p,!0))):a&&-d-u>o&&(p=a,p!==e&&(n=c.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveRow(p,!1))),p&&(r=p.nextRow(),l=s,s=r?r.getHeight()/2:0,a=p.prevRow(),u=o,o=a?a.getHeight()/2:0))}),i.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(c),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,i){var n=i.getElement();this.setStartPosition(e,i),this.moving=i,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(i)):(n.parentNode.insertBefore(this.placeholderElement,n),n.parentNode.removeChild(n)),this.hoverElement=n.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",i.getComponent()),this.moveHover(e)}setStartPosition(e,i){var n=this.touchMove?e.touches[0].pageX:e.pageX,r=this.touchMove?e.touches[0].pageY:e.pageY,a,s;a=i.getElement(),this.connection?(s=a.getBoundingClientRect(),this.startX=s.left-n+window.pageXOffset,this.startY=s.top-r+window.pageYOffset):this.startY=r-a.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,i){this.toRow=e,this.toRowAfter=i}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var i=this.table.rowManager.getElement(),n=i.scrollTop,r=(this.touchMove?e.touches[0].pageY:e.pageY)-i.getBoundingClientRect().top+n;this.hoverElement.style.top=Math.min(r-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,i,n){this.dispatchExternal("movableRowsElementDrop",e,i,n?n.getComponent():!1)}connectToTables(e){var i;this.connectionSelectorsTables&&(i=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",i),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(n=>{typeof n=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(n))):this.connectionElements.push(n)}),this.connectionElements.forEach(n=>{var r=a=>{this.elementRowDrop(a,n,this.moving)};n.addEventListener("mouseup",r),n.tabulatorElementDropEvent=r,n.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(i=>{i.classList.remove("tabulator-movingrow-receiving"),i.removeEventListener("mouseup",i.tabulatorElementDropEvent),delete i.tabulatorElementDropEvent})}connect(e,i){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=i,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(n=>{n.type==="row"&&n.modules.moveRow&&n.modules.moveRow.mouseup&&n.getElement().addEventListener("mouseup",n.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",i,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().removeEventListener("mouseup",i.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,i,n){var r=!1;if(n){switch(typeof this.table.options.movableRowsSender){case"string":r=jx.senders[this.table.options.movableRowsSender];break;case"function":r=this.table.options.movableRowsSender;break}r?r.call(this,this.moving?this.moving.getComponent():void 0,i?i.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),i?i.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),i?i.getComponent():void 0,e);this.endMove()}tableRowDrop(e,i){var n=!1,r=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":n=jx.receivers[this.table.options.movableRowsReceiver];break;case"function":n=this.table.options.movableRowsReceiver;break}n?r=n.call(this,this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),r?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:i,success:r})}commsReceived(e,i,n){switch(i){case"connect":return this.connect(e,n.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,n.row,n.success)}}}var xet={};class Gx extends Vn{static moduleName="mutator";static mutators=xet;constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard","import"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutatorImport"),this.registerColumnOption("mutatorImportParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,i,n){return this.transformRow(i,"data",n)}initializeColumn(e){var i=!1,n={};this.allowedTypes.forEach(r=>{var a="mutator"+(r.charAt(0).toUpperCase()+r.slice(1)),s;e.definition[a]&&(s=this.lookupMutator(e.definition[a]),s&&(i=!0,n[a]={mutator:s,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.mutate=n)}lookupMutator(e){var i=!1;switch(typeof e){case"string":Gx.mutators[e]?i=Gx.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i,n){var r="mutator"+(i.charAt(0).toUpperCase()+i.slice(1)),a;return this.enabled&&this.table.columnManager.traverse(s=>{var o,l,u;s.modules.mutate&&(o=s.modules.mutate[r]||s.modules.mutate.mutator||!1,o&&(a=s.getFieldValue(typeof n<"u"?n:e),(i=="data"&&!n||typeof a<"u")&&(u=s.getComponent(),l=typeof o.params=="function"?o.params(a,e,i,u):o.params,s.setFieldValue(e,o.mutator(a,e,i,l,u)))))}),e}transformCell(e,i){if(e.column.modules.mutate){var n=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,r={};if(n)return r=Object.assign(r,e.row.getData()),e.column.setFieldValue(r,i),n.mutator(i,r,"edit",n.params,e.getComponent())}return i}mutateLink(e){var i=e.column.definition.mutateLink;i&&(Array.isArray(i)||(i=[i]),i.forEach(n=>{var r=e.row.getCell(n);r&&r.setValue(r.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}}function Oet(t,e,i,n,r){var a=document.createElement("span"),s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{s.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|rows",d=>{c.innerHTML=d}),n?(o.innerHTML=" "+e+"-"+Math.min(e+t-1,n)+" ",u.innerHTML=" "+n+" ",a.appendChild(s),a.appendChild(o),a.appendChild(l),a.appendChild(u),a.appendChild(c)):(o.innerHTML=" 0 ",a.appendChild(s),a.appendChild(o),a.appendChild(c)),a}function Let(t,e,i,n,r){var a=document.createElement("span"),s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{s.innerHTML=d}),o.innerHTML=" "+i+" ",this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),u.innerHTML=" "+r+" ",this.table.modules.localize.langBind("pagination|counter|pages",d=>{c.innerHTML=d}),a.appendChild(s),a.appendChild(o),a.appendChild(l),a.appendChild(u),a.appendChild(c),a}var Fet={rows:Oet,pages:Let};class TK extends Vn{static moduleName="page";static pageCounters=Fet;constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("paginationOutOfRange",!1),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,i){var n=this.table.rowManager,r=n.getDisplayRows(),a;return i?r.length?a=r[0]:n.activeRows.length&&(a=n.activeRows[n.activeRows.length-1],i=!1):r.length&&(a=r[r.length-1],i=!(r.length<this.size)),{index:a,top:i}}calculatePageSizes(){var e,i;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",i=document.createElement("div"),i.classList.add("tabulator-cell"),i.innerHTML="Page Row Test",e.appendChild(i),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,i,n,r){return this.initialLoad||(this.progressiveLoad&&!n||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),r.page=this.page,this.size&&(r.size=this.size),r}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,i){var n,r,a;!i&&!this.table.dataLoader.loading&&(n=this.table.rowManager.getElement(),r=n.scrollHeight-n.clientHeight-e,a=this.table.options.progressiveLoadScrollMargin||n.clientHeight*2,r<a&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,i){return i||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let i=1;i<5;i++)e.push(this.size*i);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(i=>{var n=document.createElement("option");n.value=i,i===!0?this.langBind("pagination|all",function(r){n.innerHTML=r}):n.innerHTML=i,this.pageSizeSelect.appendChild(n)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,i=null;e&&(typeof e=="function"?i=e:i=TK.pageCounters[e],i?(this.pageCounter=i,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var i,n;e||(this.langBind("pagination|first",r=>{this.firstBut.innerHTML=r}),this.langBind("pagination|first_title",r=>{this.firstBut.setAttribute("aria-label",r),this.firstBut.setAttribute("title",r)}),this.langBind("pagination|prev",r=>{this.prevBut.innerHTML=r}),this.langBind("pagination|prev_title",r=>{this.prevBut.setAttribute("aria-label",r),this.prevBut.setAttribute("title",r)}),this.langBind("pagination|next",r=>{this.nextBut.innerHTML=r}),this.langBind("pagination|next_title",r=>{this.nextBut.setAttribute("aria-label",r),this.nextBut.setAttribute("title",r)}),this.langBind("pagination|last",r=>{this.lastBut.innerHTML=r}),this.langBind("pagination|last_title",r=>{this.lastBut.setAttribute("aria-label",r),this.lastBut.setAttribute("title",r)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(i=document.createElement("label"),this.langBind("pagination|page_size",r=>{this.pageSizeSelect.setAttribute("aria-label",r),this.pageSizeSelect.setAttribute("title",r),i.innerHTML=r}),this.element.appendChild(i),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",r=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(n=document.querySelector(this.table.options.paginationCounterElement),n?n.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var i=this.displayRows(-1),n=i.indexOf(e);if(n>-1){var r=this.size===!0?1:Math.ceil((n+1)/this.size);return this.setPage(r)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,i,n){var r;if(this.pageCounter)switch(this.mode==="remote"&&(i=this.size,n=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),r=this.pageCounter.call(this,i,n,this.page,e,this.max),typeof r){case"object":if(r instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(r)}else this.pageCounterElement.innerHTML="",r!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",r);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=r}}_setPageButtons(){let e=Math.floor((this.count-1)/2),i=Math.ceil((this.count-1)/2),n=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),r=this.page<=i?Math.min(this.count,this.max):Math.min(this.page+i,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let a=n;a<=r;a++)a>0&&a<=this.max&&this.pagesElement.appendChild(this._generatePageButton(a));this.footerRedraw()}_generatePageButton(e){var i=document.createElement("button");return i.classList.add("tabulator-page"),e==this.page&&i.classList.add("active"),i.setAttribute("type","button"),i.setAttribute("role","button"),this.langBind("pagination|page_title",n=>{i.setAttribute("aria-label",n+" "+e),i.setAttribute("title",n+" "+e)}),i.setAttribute("data-page",e),i.textContent=e,i.addEventListener("click",n=>{this.setPage(e)}),i}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var i=0,n,r,a,s,o=e.filter(l=>l.type==="row");if(this.mode=="local"){n=[],this.setMaxRows(e.length),this.size===!0?(r=0,a=e.length):(r=this.size*(this.page-1),a=r+parseInt(this.size)),this._setPageButtons();for(let l=r;l<a;l++){let u=e[l];u&&(n.push(u),u.type==="row"&&(s||(s=u),i++))}return this._setPageCounter(o.length,i,s?o.indexOf(s)+1:0),n}else return this._setPageButtons(),this._setPageCounter(o.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var i,n;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),i=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+i&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else{if(this.page>this.max&&(console.warn("Remote Pagination Error - Server returned last page value lower than the current page"),n=this.options("paginationOutOfRange"),n))return this.setPage(typeof n=="function"?n.call(this,this.page,this.max):n);this.dispatchExternal("pageLoaded",this.getPage())}else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}}var $et={local:function(t,e){var i=localStorage.getItem(t+"-"+e);return i?JSON.parse(i):!1},cookie:function(t,e){var i=document.cookie,n=t+"-"+e,r=i.indexOf(n+"="),a,s;return r>-1&&(i=i.slice(r),a=i.indexOf(";"),a>-1&&(i=i.slice(0,a)),s=i.replace(n+"=","")),s?JSON.parse(s):!1}},Bet={local:function(t,e,i){localStorage.setItem(t+"-"+e,JSON.stringify(i))},cookie:function(t,e,i){var n=new Date;n.setDate(n.getDate()+1e4),document.cookie=t+"-"+e+"="+JSON.stringify(i)+"; expires="+n.toUTCString()}};class $f extends Vn{static moduleName="persistence";static moduleInitOrder=-10;static readers=$et;static writers=Bet;constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,i=this.table.options.persistenceID,n;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:$f.readers[this.table.options.persistenceReaderFunc]?this.readFunc=$f.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):$f.readers[this.mode]?this.readFunc=$f.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:$f.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=$f.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):$f.writers[this.mode]?this.writeFunc=$f.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(i||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(n=this.retrieveData("page"),n&&(typeof n.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=n.paginationSize),typeof n.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=n.paginationInitialPage))),this.config.group&&(n=this.retrieveData("group"),n&&(typeof n.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=n.groupBy),typeof n.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=n.groupStartOpen),typeof n.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=n.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,i,n;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(i=this.load("filter"),i&&(this.table.options.initialFilter=i)),this.config.headerFilter&&(n=this.load("headerFilter"),n&&(this.table.options.initialHeaderFilter=n))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var i,n;this.config.columns&&(this.defWatcherBlock=!0,i=e.getDefinition(),n=this.config.columns===!0?Object.keys(i):this.config.columns,n.forEach(r=>{var a=Object.getOwnPropertyDescriptor(i,r),s=i[r];a&&Object.defineProperty(i,r,{set:o=>{s=o,this.defWatcherBlock||this.save("columns"),a.set&&a.set(o)},get:()=>(a.get&&a.get(),s)})}),this.defWatcherBlock=!1)}load(e,i){var n=this.retrieveData(e);return i&&(n=n?this.mergeDefinition(i,n):i),n}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,i,n){var r=[];return i=i||[],i.forEach((a,s)=>{var o=this._findColumn(e,a),l;o&&(n?l=Object.keys(a):this.config.columns===!0||this.config.columns==null?(l=Object.keys(o),l.push("width")):l=this.config.columns,l.forEach(u=>{u!=="columns"&&typeof a[u]<"u"&&(o[u]=a[u])}),o.columns&&(o.columns=this.mergeDefinition(o.columns,a.columns)),r.push(o))}),e.forEach((a,s)=>{var o=this._findColumn(i,a);o||(r.length>s?r.splice(s,0,a):r.push(a))}),r}_findColumn(e,i){var n=i.columns?"group":i.field?"field":"object";return e.find(function(r){switch(n){case"group":return r.title===i.title&&r.columns.length===i.columns.length;case"field":return r.field===i.field;case"object":return r===i}})}save(e){var i={};switch(e){case"columns":i=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":i=this.table.modules.filter.getFilters();break;case"headerFilter":i=this.table.modules.filter.getHeaderFilters();break;case"sort":i=this.validateSorters(this.table.modules.sort.getSort());break;case"group":i=this.getGroupConfig();break;case"page":i=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,i)}validateSorters(e){return e.forEach(function(i){i.column=i.field,delete i.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var i=[],n=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(r=>{var a={},s=r.getDefinition(),o;r.isGroup?(a.title=s.title,a.columns=this.parseColumns(r.getColumns())):(a.field=r.getField(),this.config.columns===!0||this.config.columns==null?(o=Object.keys(s),o.push("width"),o.push("visible")):o=this.config.columns,o.forEach(l=>{switch(l){case"width":a.width=r.getWidth();break;case"visible":a.visible=r.visible;break;default:typeof s[l]!="function"&&n.indexOf(l)===-1&&(a[l]=s[l])}})),i.push(a)}),i}}let Vet=class extends Vn{static moduleName="popup";constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,i,n){this.loadPopupEvent(i,null,e,n)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var i=e.definition;i.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),i.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),i.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),i.headerPopup&&this.initializeColumnHeaderPopup(e),i.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),i.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),i.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var i=e.definition.headerPopupIcon,n;n=document.createElement("span"),n.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?n.appendChild(i):n.innerHTML=i):n.innerHTML="&vellip;",n.addEventListener("click",r=>{r.stopPropagation(),r.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,r,e)}),e.titleElement.insertBefore(n,e.titleElement.firstChild)}loadPopupTableCellEvent(e,i,n){n._cell&&(n=n._cell),n.column.definition[e]&&this.loadPopupEvent(n.column.definition[e],i,n)}loadPopupTableColumnEvent(e,i,n){n._column&&(n=n._column),n.definition[e]&&this.loadPopupEvent(n.definition[e],i,n)}loadPopupEvent(e,i,n,r){var a;function s(o){a=o}n._group?n=n._group:n._row&&(n=n._row),e=typeof e=="function"?e.call(this.table,i,n.getComponent(),s):e,this.loadPopup(i,n,e,a,r)}loadPopup(e,i,n,r,a){var s=!(e instanceof MouseEvent),o,l;n instanceof HTMLElement?o=n:(o=document.createElement("div"),o.innerHTML=n),o.classList.add("tabulator-popup"),o.addEventListener("click",u=>{u.stopPropagation()}),s||e.preventDefault(),l=this.popup(o),typeof r=="function"&&l.renderCallback(r),e?l.show(e):l.show(i.getElement(),a||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",i.getComponent())}),this.dispatchExternal("popupOpened",i.getComponent())}};class jet extends Vn{static moduleName="print";constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,i,n){var r=window.scrollX,a=window.scrollY,s=document.createElement("div"),o=document.createElement("div"),l=this.table.modules.export.generateTable(typeof n<"u"?n:this.table.options.printConfig,typeof i<"u"?i:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),u,c;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(s.classList.add("tabulator-print-header"),u=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof u=="string"?s.innerHTML=u:s.appendChild(u),this.element.appendChild(s)),this.element.appendChild(l),this.table.options.printFooter&&(o.classList.add("tabulator-print-footer"),c=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof c=="string"?o.innerHTML=c:o.appendChild(c),this.element.appendChild(o)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(r,a),this.manualBlock=!1}}class Get extends Vn{static moduleName="reactiveData";constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var i=this,n;this.currentVersion++,n=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),a;return!i.blocked&&n===i.currentVersion&&(i.block("data-push"),r.forEach(s=>{i.table.rowManager.addRowActual(s,!1)}),a=i.origFuncs.push.apply(e,arguments),i.unblock("data-push")),a}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),a;return!i.blocked&&n===i.currentVersion&&(i.block("data-unshift"),r.forEach(s=>{i.table.rowManager.addRowActual(s,!0)}),a=i.origFuncs.unshift.apply(e,arguments),i.unblock("data-unshift")),a}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var r,a;return!i.blocked&&n===i.currentVersion&&(i.block("data-shift"),i.data.length&&(r=i.table.rowManager.getRowFromDataObject(i.data[0]),r&&r.deleteActual()),a=i.origFuncs.shift.call(e),i.unblock("data-shift")),a}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var r,a;return!i.blocked&&n===i.currentVersion&&(i.block("data-pop"),i.data.length&&(r=i.table.rowManager.getRowFromDataObject(i.data[i.data.length-1]),r&&r.deleteActual()),a=i.origFuncs.pop.call(e),i.unblock("data-pop")),a}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),a=r[0]<0?e.length+r[0]:r[0],s=r[1],o=r[2]?r.slice(2):!1,l,u;if(!i.blocked&&n===i.currentVersion){if(i.block("data-splice"),o&&(l=e[a]?i.table.rowManager.getRowFromDataObject(e[a]):!1,l?o.forEach(d=>{i.table.rowManager.addRowActual(d,!0,l,!0)}):(o=o.slice().reverse(),o.forEach(d=>{i.table.rowManager.addRowActual(d,!0,!1,!0)}))),s!==0){var c=e.slice(a,typeof r[1]>"u"?r[1]:a+s);c.forEach((d,p)=>{var h=i.table.rowManager.getRowFromDataObject(d);h&&h.deleteActual(p!==c.length-1)})}(o||s!==0)&&i.table.rowManager.reRenderInPosition(),u=i.origFuncs.splice.apply(e,arguments),i.unblock("data-splice")}return u}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var i=e.getData();for(var n in i)this.watchKey(e,i,n);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var i=this,n=e.getData()[this.table.options.dataTreeChildField],r={};n&&(r.push=n.push,Object.defineProperty(n,"push",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-push");var a=r.push.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-push")}return a}}),r.unshift=n.unshift,Object.defineProperty(n,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-unshift");var a=r.unshift.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-unshift")}return a}}),r.shift=n.shift,Object.defineProperty(n,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-shift");var a=r.shift.call(n);this.rebuildTree(e),i.unblock("tree-shift")}return a}}),r.pop=n.pop,Object.defineProperty(n,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-pop");var a=r.pop.call(n);this.rebuildTree(e),i.unblock("tree-pop")}return a}}),r.splice=n.splice,Object.defineProperty(n,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-splice");var a=r.splice.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-splice")}return a}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,i,n){var r=this,a=Object.getOwnPropertyDescriptor(i,n),s=i[n],o=this.currentVersion;Object.defineProperty(i,n,{set:l=>{if(s=l,!r.blocked&&o===r.currentVersion){r.block("key");var u={};u[n]=l,e.updateData(u),r.unblock("key")}a.set&&a.set(l)},get:()=>(a.get&&a.get(),s)})}unwatchRow(e){var i=e.getData();for(var n in i)Object.defineProperty(i,n,{value:i[n]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}class Het extends Vn{static moduleName="resizeColumns";constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1),this.registerTableOption("resizableColumnGuide",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var i=e.prevColumn();this.reinitializeColumn(e),i&&this.reinitializeColumn(i)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.reinitializeColumn(i)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.reinitializeColumn(i)}))}frozenColumnOffset(e){var i=!1;return e.modules.frozen&&(i=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?i+=e.getWidth()-3:i&&(i-=3)),i!==!1?i+"px":!1}reinitializeColumn(e){var i=this.frozenColumnOffset(e);e.cells.forEach(n=>{n.modules.resize&&n.modules.resize.handleEl&&(i&&(n.modules.resize.handleEl.style[e.modules.frozen.position]=i,n.modules.resize.handleEl.style["z-index"]=11),n.element.after(n.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(i&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=i),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,i,n,r){var a=this,s=!1,o=n.definition.resizable,l={},u=n.getLastColumn();if(e==="header"&&(s=n.definition.formatter=="textarea"||n.definition.variableHeight,l={variableHeight:s}),(o===!0||o==e)&&this._checkResizability(u)){var c=document.createElement("span");c.className="tabulator-col-resize-handle",c.addEventListener("click",function(p){p.stopPropagation()});var d=function(p){a.startColumn=n,a.initialNextColumn=a.nextColumn=u.nextColumn(),a._mouseDown(p,u,c)};c.addEventListener("mousedown",d),c.addEventListener("touchstart",d,{passive:!0}),c.addEventListener("dblclick",p=>{var h=u.getWidth();p.stopPropagation(),u.reinitializeWidth(!0),h!==u.getWidth()&&(a.dispatch("column-resized",u),a.dispatchExternal("columnResized",u.getComponent()))}),n.modules.frozen&&(c.style.position="sticky",c.style[n.modules.frozen.position]=this.frozenColumnOffset(n)),l.handleEl=c,r.parentNode&&n.visible&&r.after(c)}i.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(i=>{this.deInitializeComponent(i)})}deInitializeComponent(e){var i;e.modules.resize&&(i=e.modules.resize.handleEl,i&&i.parentElement&&i.parentElement.removeChild(i))}resizeHandle(e,i){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=i)}resize(e,i){var n=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,r=n-this.startX,a=n-this.latestX,s,o;if(this.latestX=n,this.table.rtl&&(r=-r,a=-a),s=i.width==i.minWidth||i.width==i.maxWidth,i.setWidth(this.startWidth+r),o=i.width==i.minWidth||i.width==i.maxWidth,a<0&&(this.nextColumn=this.initialNextColumn),this.table.options.resizableColumnFit&&this.nextColumn&&!(s&&o)){let l=this.nextColumn.getWidth();a>0&&l<=this.nextColumn.minWidth&&(this.nextColumn=this.nextColumn.nextColumn()),this.nextColumn&&this.nextColumn.setWidth(this.nextColumn.getWidth()-a)}this.table.columnManager.rerenderColumns(!0),!this.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights()}calcGuidePosition(e,i,n){var r=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,a=n.getBoundingClientRect().x-this.table.element.getBoundingClientRect().x,s=this.table.element.getBoundingClientRect().x,o=i.element.getBoundingClientRect().left-s,l=r-this.startX,u=Math.max(a+l,o+i.minWidth);return i.maxWidth&&(u=Math.min(u,o+i.maxWidth)),u}_checkResizability(e){return e.definition.resizable}_mouseDown(e,i,n){var r=this,a;this.dispatchExternal("columnResizing",i.getComponent()),r.table.options.resizableColumnGuide&&(a=document.createElement("span"),a.classList.add("tabulator-col-resize-guide"),r.table.element.appendChild(a),setTimeout(()=>{a.style.left=r.calcGuidePosition(e,i,n)+"px"})),r.table.element.classList.add("tabulator-block-select");function s(l){r.table.options.resizableColumnGuide?a.style.left=r.calcGuidePosition(l,i,n)+"px":r.resize(l,i)}function o(l){r.table.options.resizableColumnGuide&&(r.resize(l,i),a.remove()),r.startColumn.modules.edit&&(r.startColumn.modules.edit.blocked=!1),r.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights(),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",s),n.removeEventListener("touchmove",s),n.removeEventListener("touchend",o),r.table.element.classList.remove("tabulator-block-select"),r.startWidth!==i.getWidth()&&(r.table.columnManager.verticalAlignHeaders(),r.dispatch("column-resized",i),r.dispatchExternal("columnResized",i.getComponent()))}e.stopPropagation(),r.startColumn.modules.edit&&(r.startColumn.modules.edit.blocked=!0),r.startX=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,r.latestX=r.startX,r.startWidth=i.getWidth(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",o),n.addEventListener("touchmove",s,{passive:!0}),n.addEventListener("touchend",o)}}class zet extends Vn{static moduleName="resizeRows";constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1),this.registerTableOption("resizableRowGuide",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var i=this,n=e.getElement(),r=document.createElement("div");r.className="tabulator-row-resize-handle";var a=document.createElement("div");a.className="tabulator-row-resize-handle prev",r.addEventListener("click",function(l){l.stopPropagation()});var s=function(l){i.startRow=e,i._mouseDown(l,e,r)};r.addEventListener("mousedown",s),r.addEventListener("touchstart",s,{passive:!0}),a.addEventListener("click",function(l){l.stopPropagation()});var o=function(l){var u=i.table.rowManager.prevDisplayRow(e);u&&(i.startRow=u,i._mouseDown(l,u,a))};a.addEventListener("mousedown",o),a.addEventListener("touchstart",o,{passive:!0}),n.appendChild(r),n.appendChild(a)}resize(e,i){i.setHeight(this.startHeight+((typeof e.screenY>"u"?e.touches[0].screenY:e.screenY)-this.startY))}calcGuidePosition(e,i,n){var r=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,a=n.getBoundingClientRect().y-this.table.element.getBoundingClientRect().y,s=this.table.element.getBoundingClientRect().y,o=i.element.getBoundingClientRect().top-s,l=r-this.startY;return Math.max(a+l,o)}_mouseDown(e,i,n){var r=this,a;r.dispatchExternal("rowResizing",i.getComponent()),r.table.options.resizableRowGuide&&(a=document.createElement("span"),a.classList.add("tabulator-row-resize-guide"),r.table.element.appendChild(a),setTimeout(()=>{a.style.top=r.calcGuidePosition(e,i,n)+"px"})),r.table.element.classList.add("tabulator-block-select");function s(l){r.table.options.resizableRowGuide?a.style.top=r.calcGuidePosition(l,i,n)+"px":r.resize(l,i)}function o(l){r.table.options.resizableRowGuide&&(r.resize(l,i),a.remove()),document.body.removeEventListener("mouseup",s),document.body.removeEventListener("mousemove",s),n.removeEventListener("touchmove",s),n.removeEventListener("touchend",o),r.table.element.classList.remove("tabulator-block-select"),r.dispatchExternal("rowResized",i.getComponent())}e.stopPropagation(),r.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,r.startHeight=i.getHeight(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",o),n.addEventListener("touchmove",s,{passive:!0}),n.addEventListener("touchend",o)}}class qet extends Vn{static moduleName="resizeTable";constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,i;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(n=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var r=Math.floor(n[0].contentRect.height),a=Math.floor(n[0].contentRect.width);(this.tableHeight!=r||this.tableWidth!=a)&&(this.tableHeight=r,this.tableWidth=a,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),i=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(i.getPropertyValue("max-height")||i.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(n=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var r=Math.floor(n[0].contentRect.height),a=Math.floor(n[0].contentRect.width);(this.containerHeight!=r||this.containerWidth!=a)&&(this.containerHeight=r,this.containerWidth=a,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}function Wet(t,e,i){var n=document.createElement("div"),r=t.getRow()._row.modules.responsiveLayout;n.classList.add("tabulator-responsive-collapse-toggle"),n.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,t.getElement().classList.add("tabulator-row-handle");function a(s){var o=r.element;r.open=s,o&&(r.open?(n.classList.add("open"),o.style.display=""):(n.classList.remove("open"),o.style.display="none"))}return n.addEventListener("click",function(s){s.stopImmediatePropagation(),a(!r.open),t.getTable().rowManager.adjustTableSize()}),a(r.open),n}var Yet={format:{formatters:{responsiveCollapse:Wet}}};class Ket extends Vn{static moduleName="responsiveLayout";static moduleExtensions=Yet;constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.collapseFormatter&&(this.collapseFormatter=this.collapseFormatter.bind(this.table)),this.table.columnManager.columnsByIndex.forEach((i,n)=>{i.modules.responsive&&i.modules.responsive.order&&i.modules.responsive.visible&&(i.modules.responsive.index=n,e.push(i),!i.visible&&this.mode==="collapse"&&this.hiddenColumns.push(i))}),e=e.reverse(),e=e.sort((i,n)=>{var r=n.modules.responsive.order-i.modules.responsive.order;return r||n.modules.responsive.index-i.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let i of this.table.columnManager.columnsByIndex)if(i.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=i;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var i=e.getDefinition();e.modules.responsive={order:typeof i.responsive>"u"?1:i.responsive,visible:i.visible!==!1}}initializeRow(e){var i;e.type!=="calc"&&(i=document.createElement("div"),i.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:i,open:this.collapseStartOpen},this.collapseStartOpen||(i.style.display="none"))}layoutRow(e){var i=e.getElement();e.modules.responsiveLayout&&(i.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,i){!i&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var i=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!i&&this.collapseHandleColumn.show())}showColumn(e){var i;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(i=this.hiddenColumns.indexOf(e),i>-1&&this.hiddenColumns.splice(i,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let i=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),n=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-i;if(n<0){let r=this.columns[this.index];r?(this.hideColumn(r),this.index++):e=!1}else{let r=this.columns[this.index-1];r&&n>0&&n>=r.getWidth()?(this.showColumn(r),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(i=>{this.generateCollapsedRowContent(i)})}generateCollapsedRowContent(e){var i,n;if(e.modules.responsiveLayout){for(i=e.modules.responsiveLayout.element;i.firstChild;)i.removeChild(i.firstChild);n=this.collapseFormatter(this.generateCollapsedRowData(e)),n&&i.appendChild(n),e.calcHeight(!0)}}generateCollapsedRowData(e){var i=e.getData(),n=[],r;return this.hiddenColumns.forEach(a=>{var s=a.getFieldValue(i);if(a.definition.title&&a.field)if(a.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let o=function(l){l()};r={value:!1,data:{},getValue:function(){return s},getData:function(){return i},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return a.getComponent()},getTable:()=>this.table},n.push({field:a.field,title:a.definition.title,value:a.modules.format.formatter.call(this.table.modules.format,r,a.modules.format.params,o)})}else n.push({field:a.field,title:a.definition.title,value:s})}),n}formatCollapsedData(e){var i=document.createElement("table");return e.forEach(n=>{var r=document.createElement("tr"),a=document.createElement("td"),s=document.createElement("td"),o,l=document.createElement("strong");a.appendChild(l),this.modules.localize.bind("columns|"+n.field,function(u){l.innerHTML=u||n.title}),n.value instanceof Node?(o=document.createElement("div"),o.appendChild(n.value),s.appendChild(o)):s.innerHTML=n.value,r.appendChild(a),r.appendChild(s),i.appendChild(r)}),Object.keys(e).length?i:""}}function Zet(t,e,i){var n=document.createElement("input"),r=!1;if(n.type="checkbox",n.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(n.addEventListener("click",s=>{s.stopPropagation()}),typeof t.getRow=="function"){var a=t.getRow();a instanceof s2?(n.addEventListener("change",s=>{this.table.options.selectableRowsRangeMode==="click"&&r?r=!1:a.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&n.addEventListener("click",s=>{r=!0,this.table.modules.selectRow.handleComplexRowClick(a._row,s)}),n.checked=a.isSelected&&a.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(a,n)):n=""}else n.addEventListener("change",s=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(n);return n}var Xet={format:{formatters:{rowSelection:Zet}}};class Jet extends Vn{static moduleName="selectRow";static moduleExtensions=Xet;constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(i,n){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){}rowRetrieve(e,i){return e==="selected"?this.selectedRows:i}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var i=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],i&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var i=this,n=i.checkRowSelectability(e),r=e.getElement(),a=function(){setTimeout(function(){i.selecting=!1},50),document.body.removeEventListener("mouseup",a)};e.modules.select={selected:!1},r.classList.toggle("tabulator-selectable",n),r.classList.toggle("tabulator-unselectable",!n),i.checkRowSelectability(e)&&i.table.options.selectableRows&&i.table.options.selectableRows!="highlight"&&(i.table.options.selectableRowsRangeMode==="click"?r.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(r.addEventListener("click",function(s){(!i.table.modExists("edit")||!i.table.modules.edit.getCurrentCell())&&i.table._clearSelection(),i.selecting||i.toggleRow(e)}),r.addEventListener("mousedown",function(s){if(s.shiftKey)return i.table._clearSelection(),i.selecting=!0,i.selectPrev=[],document.body.addEventListener("mouseup",a),document.body.addEventListener("keyup",a),i.toggleRow(e),!1}),r.addEventListener("mouseenter",function(s){i.selecting&&(i.table._clearSelection(),i.toggleRow(e),i.selectPrev[1]==e&&i.toggleRow(i.selectPrev[0]))}),r.addEventListener("mouseout",function(s){i.selecting&&(i.table._clearSelection(),i.selectPrev.unshift(e))})))}handleComplexRowClick(e,i){if(i.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var n=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),r=this.table.rowManager.getDisplayRowIndex(e),a=n<=r?n:r,s=n>=r?n:r,o=this.table.rowManager.getDisplayRows().slice(0),l=o.splice(a,s-a+1);i.ctrlKey||i.metaKey?(l.forEach(u=>{u!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(u):this.toggleRow(u))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&l.length>this.table.options.selectableRows&&(l=l.slice(0,this.table.options.selectableRows)),this.selectRows(l)),this.table._clearSelection()}else i.ctrlKey||i.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var i=[],n,r;switch(typeof e){case"undefined":n=this.table.rowManager.rows;break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(a=>{r=this._selectRow(a,!0,!0),r&&i.push(r)}),this._rowSelectionChanged(!1,i)):n&&this._selectRow(n,!1,!0)}_selectRow(e,i,n){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!n&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var r=this.table.rowManager.findRow(e);if(r){if(this.selectedRows.indexOf(r)==-1)return r.getElement().classList.add("tabulator-selected"),r.modules.select||(r.modules.select={}),r.modules.select.selected=!0,r.modules.select.checkboxEl&&(r.modules.select.checkboxEl.checked=!0),this.selectedRows.push(r),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(r,!0),this.dispatchExternal("rowSelected",r.getComponent()),this._rowSelectionChanged(i,r),r}else i||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,i){var n=[],r,a;switch(typeof e){case"undefined":r=Object.assign([],this.selectedRows);break;case"number":r=this.table.rowManager.findRow(e);break;case"string":r=this.table.rowManager.findRow(e),r||(r=this.table.rowManager.getRows(e));break;default:r=e;break}Array.isArray(r)?r.length&&(r.forEach(s=>{a=this._deselectRow(s,!0,!0),a&&n.push(a)}),this._rowSelectionChanged(i,[],n)):r&&this._deselectRow(r,i,!0)}_deselectRow(e,i){var n=this,r=n.table.rowManager.findRow(e),a,s;if(r){if(a=n.selectedRows.findIndex(function(o){return o==r}),a>-1)return s=r.getElement(),s&&s.classList.remove("tabulator-selected"),r.modules.select||(r.modules.select={}),r.modules.select.selected=!1,r.modules.select.checkboxEl&&(r.modules.select.checkboxEl.checked=!1),n.selectedRows.splice(a,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(r,!1),this.dispatchExternal("rowDeselected",r.getComponent()),n._rowSelectionChanged(i,void 0,r),r}else i||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getComponent())}),e}_rowSelectionChanged(e,i=[],n=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(i)||(i=[i]),i=i.map(r=>r.getComponent()),Array.isArray(n)||(n=[n]),n=n.map(r=>r.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),i,n))}registerRowSelectCheckbox(e,i){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=i}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,i){var n=this.table.modules.dataTree.getChildren(e,!0,!0);if(i)for(let r of n)this._selectRow(r,!0);else for(let r of n)this._deselectRow(r,!0)}}class Qet{constructor(e){return this._range=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._range.table.componentFunctionBinder.handle("range",i._range,n)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0,!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,i){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,i&&i._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}let ett=class extends Hl{constructor(e,i,n,r){super(e),this.rangeManager=i,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.rangeManager.rowHeader&&(this.left=1,this.right=1,this.start.col=1,this.end.col=1),this.initElement(),setTimeout(()=>{this.initBounds(n,r)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,i){this._updateMinMax(),e&&this.setBounds(e,i||e)}setStart(e,i){(this.start.row!==e||this.start.col!==i)&&(this.start.row=e,this.start.col=i,this.initializing.start=!0,this._updateMinMax())}setEnd(e,i){(this.end.row!==e||this.end.col!==i)&&(this.end.row=e,this.end.col=i,this.initializing.end=!0,this._updateMinMax())}setBounds(e,i,n){e&&this.setStartBound(e),this.setEndBound(i||e),this.rangeManager.layoutElement(n)}setStartBound(e){var i,n;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-1):(i=e.row.position-1,n=e.column.getPosition()-1,e.column===this.rangeManager.rowHeader?this.setStart(i,1):this.setStart(i,n))}setEndBound(e){var i=this._getTableRows().length,n,r,a;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(i-1,e.getPosition()-1):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-1)):(n=e.row.position-1,r=e.column.getPosition()-1,a=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(n,this._getTableColumns().length-1):this.rangeManager.selecting!=="row"&&a?this.setEnd(n,0):this.rangeManager.selecting==="column"?this.setEnd(i-1,r):this.setEnd(n,r))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}layout(){var e=this.table.rowManager.renderer.vDomTop,i=this.table.rowManager.renderer.vDomBottom,n=this.table.columnManager.renderer.leftCol,r=this.table.columnManager.renderer.rightCol,a,s,o,l,u,c,d,p,h,f;this.table.options.renderHorizontal==="virtual"&&this.rangeManager.rowHeader&&(r+=1),e==null&&(e=0),i==null&&(i=1/0),n==null&&(n=0),r==null&&(r=1/0),this.overlaps(n,e,r,i)&&(a=Math.max(this.top,e),s=Math.min(this.bottom,i),o=Math.max(this.left,n),l=Math.min(this.right,r),u=this.rangeManager.getCell(a,o),c=this.rangeManager.getCell(s,l),d=u.getElement(),p=c.getElement(),h=u.row.getElement(),f=c.row.getElement(),this.element.classList.add("tabulator-range-active"),this.table.rtl?(this.element.style.right=h.offsetWidth-d.offsetLeft-d.offsetWidth+"px",this.element.style.width=d.offsetLeft+d.offsetWidth-p.offsetLeft+"px"):(this.element.style.left=h.offsetLeft+d.offsetLeft+"px",this.element.style.width=p.offsetLeft+p.offsetWidth-d.offsetLeft+"px"),this.element.style.top=h.offsetTop+"px",this.element.style.height=f.offsetTop+f.offsetHeight-h.offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-1===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-1===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-1&&e.getPosition()-1<=this.right}overlaps(e,i,n,r){return!(this.left>n||e>this.right||this.top>r||i>this.bottom)}getData(){var e=[],i=this.getRows(),n=this.getColumns();return i.forEach(r=>{var a=r.getData(),s={};n.forEach(o=>{s[o.field]=a[o.field]}),e.push(s)}),e}getCells(e,i){var n=[],r=this.getRows(),a=this.getColumns();return e?n=r.map(s=>{var o=[];return s.getCells().forEach(l=>{a.includes(l.column)&&o.push(i?l.getComponent():l)}),o}):r.forEach(s=>{s.getCells().forEach(o=>{a.includes(o.column)&&n.push(i?o.getComponent():o)})}),n}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left,this.right+1)}clearValues(){var e=this.getCells(),i=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(n=>{n.setValue(i)}),this.table.restoreRedraw()}getBounds(e){var i=this.getCells(!1,e),n={start:null,end:null};return i.length?(n.start=i[0],n.end=i[i.length-1]):console.warn("No bounds defined on range"),n}getComponent(){return this.component||(this.component=new Qet(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}};var ttt={rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},itt={rangeJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!1)},rangeJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!1)},rangeJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!1)},rangeJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!1)},rangeExpandLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!1,!0)},rangeExpandRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!1,!0)},rangeExpandUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!1,!0)},rangeExpandDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!1,!0)},rangeExpandJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!0)},rangeExpandJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!0)},rangeExpandJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!0)},rangeExpandJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!0)}},ntt={range:function(t){var e=[],i=this.table.modules.selectRange.activeRange,n=!1,r,a,s,o,l;return l=t.length,i&&(r=i.getBounds(),a=r.start,r.start===r.end&&(n=!0),a&&(e=this.table.rowManager.activeRows.slice(),s=e.indexOf(a.row),n?o=t.length:o=e.indexOf(r.end.row)-s+1,s>-1&&(this.table.blockRedraw(),e=e.slice(s,s+o),e.forEach((u,c)=>{u.updateData(t[c%l])}),this.table.restoreRedraw()))),e}},rtt={range:function(t){var e=[],i=[],n=this.table.modules.selectRange.activeRange,r=!1,a,s,o,l,u;return n&&(a=n.getBounds(),s=a.start,a.start===a.end&&(r=!0),s&&(t=t.split(`
`),t.forEach(function(c){e.push(c.split("	"))}),e.length&&(l=this.table.columnManager.getVisibleColumnsByIndex(),u=l.indexOf(s.column),u>-1)))?(r?o=e[0].length:o=l.indexOf(a.end.column)-u+1,l=l.slice(u,u+o),e.forEach(c=>{var d={},p=c.length;l.forEach(function(h,f){d[h.field]=c[f%p]}),i.push(d)}),i):!1}},att={range:function(){var t=this.modules.selectRange.selectedColumns();return this.columnManager.rowHeader&&t.unshift(this.columnManager.rowHeader),t}},stt={range:function(){return this.modules.selectRange.selectedRows()}},ott={keybindings:{bindings:ttt,actions:itt},clipboard:{pasteActions:ntt,pasteParsers:rtt},export:{columnLookups:att,rowLookups:stt}};class ltt extends Vn{static moduleName="selectRange";static moduleInitOrder=1;static moduleExtensions=ott;constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableOption("selectableRangeAutoFocus",!0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()),this.options("columns").findIndex(e=>e.frozen)>0&&console.warn("Having frozen column in arbitrary position with selectRange option may result in unpredictable behavior."),this.options("columns").filter(e=>e.frozen)>1&&console.warn("Having multiple frozen columns with selectRange option may result in unpredictable behavior."))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-moving",this.handleColumnMoving.bind(this)),this.subscribe("column-moved",this.handleColumnMoved.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'."),e.modules.edit}updateHeaderColumn(){var e;this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior"))),this.table.modules.frozenColumns&&this.table.modules.frozenColumns.active&&(e=this.table.modules.frozenColumns.getFrozenColumns(),(e.length>1||e.length===1&&e[0]!==this.rowHeader)&&console.warn("Using frozen columns that are not the range header in combination with the selectRange option may result in unpredictable behavior"))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,i){return e=e?e._cell:null,i=i?i._cell:null,this.addRange(e,i)}cellGetRanges(e){var i=[];return e.column===this.rowHeader?i=this.ranges.filter(n=>n.occupiesRow(e.row)):i=this.ranges.filter(n=>n.occupies(e)),i.map(n=>n.getComponent())}rowGetRanges(e){var i=this.ranges.filter(n=>n.occupiesRow(e));return i.map(n=>n.getComponent())}colGetRanges(e){var i=this.ranges.filter(n=>n.occupiesColumn(e));return i.map(n=>n.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var i;this.restoreFocus();try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(e.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var i;this.selecting!=="column"&&this.selecting!=="all"||(i=this.ranges.some(n=>n.occupiesColumn(e)),i&&this.ranges.forEach(n=>{var r=n.getColumns(!0);r.forEach(a=>{a!==e&&a.setWidth(e.width)})}))}handleColumnMoving(e,i){this.resetRanges().setBounds(i),this.overlay.style.visibility="hidden"}handleColumnMoved(e,i,n){this.activeRange.setBounds(e),this.layoutElement()}handleColumnMouseDown(e,i){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(i)||this.table.options.movableColumns&&this.selecting==="column"&&this.activeRange.occupiesColumn(i)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleColumnMouseMove(e,i){i===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}renderCell(e){var i=e.getElement(),n=this.ranges.findIndex(r=>r.occupies(e));i.classList.toggle("tabulator-range-selected",n!==-1),i.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),i.dataset.range=n}handleCellMouseDown(e,i){e.button===2&&(this.activeRange.occupies(i)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(i.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleCellMouseMove(e,i){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}handleCellClick(e,i){this.initializeFocus(i)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,i){this.navigate(!1,!1,e),i.preventDefault()}keyNavigateRange(e,i,n,r){this.navigate(n,r,i),e.preventDefault()}navigate(e,i,n){var r=!1,a,s,o,l,u,c,d,p,h,f,m;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(g=>g===this.activeRange?(g.setEnd(g.start.row,g.start.col),!0):(g.destroy(),!1))),a=this.activeRange,o={top:a.top,bottom:a.bottom,left:a.left,right:a.right},s=i?a.end:a.start,l=s.row,u=s.col,e)switch(n){case"left":u=this.findJumpCellLeft(a.start.row,s.col);break;case"right":u=this.findJumpCellRight(a.start.row,s.col);break;case"up":l=this.findJumpCellUp(s.row,a.start.col);break;case"down":l=this.findJumpCellDown(s.row,a.start.col);break}else{if(i&&(this.selecting==="row"&&(n==="left"||n==="right")||this.selecting==="column"&&(n==="up"||n==="down")))return;switch(n){case"left":u=Math.max(u-1,0);break;case"right":u=Math.min(u+1,this.getTableColumns().length-1);break;case"up":l=Math.max(l-1,0);break;case"down":l=Math.min(l+1,this.getTableRows().length-1);break}}if(this.rowHeader&&u===0&&(u=1),i||a.setStart(l,u),a.setEnd(l,u),i||(this.selecting="cell"),r=o.top!==a.top||o.bottom!==a.bottom||o.left!==a.left||o.right!==a.right,r)return c=this.getRowByRangePos(a.end.row),d=this.getColumnByRangePos(a.end.col),p=c.getElement().getBoundingClientRect(),f=d.getElement().getBoundingClientRect(),h=this.table.rowManager.getElement().getBoundingClientRect(),m=this.table.columnManager.getElement().getBoundingClientRect(),p.top>=h.top&&p.bottom<=h.bottom||(c.getElement().parentNode&&d.getElement().parentNode?this.autoScroll(a,c.getElement(),d.getElement()):c.getComponent().scrollTo(void 0,!1)),f.left>=m.left+this.getRowHeaderWidth()&&f.right<=m.right||(c.getElement().parentNode&&d.getElement().parentNode?this.autoScroll(a,c.getElement(),d.getElement()):d.getComponent().scrollTo(void 0,!1)),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(i=>i!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpRow(e,i,n,r,a){return n&&(i=i.reverse()),this.findJumpItem(r,a,i,function(s){return s.getData()[e.getField()]})}findJumpCol(e,i,n,r,a){return n&&(i=i.reverse()),this.findJumpItem(r,a,i,function(s){return e.getData()[s.getField()]})}findJumpItem(e,i,n,r){var a;for(let s of n){let o=r(s);if(e){if(a=s,o)break}else if(i){if(a=s,o)break}else if(o)a=s;else break}return a}findJumpCellLeft(e,i){var n=this.getRowByRangePos(e),r=this.getTableColumns(),a=this.isEmpty(n.getData()[r[i].getField()]),s=r[i-1]?this.isEmpty(n.getData()[r[i-1].getField()]):!1,o=this.rowHeader?r.slice(1,i):r.slice(0,i),l=this.findJumpCol(n,o,!0,a,s);return l?l.getPosition()-1:i}findJumpCellRight(e,i){var n=this.getRowByRangePos(e),r=this.getTableColumns(),a=this.isEmpty(n.getData()[r[i].getField()]),s=r[i+1]?this.isEmpty(n.getData()[r[i+1].getField()]):!1,o=this.findJumpCol(n,r.slice(i+1,r.length),!1,a,s);return o?o.getPosition()-1:i}findJumpCellUp(e,i){var n=this.getColumnByRangePos(i),r=this.getTableRows(),a=this.isEmpty(r[e].getData()[n.getField()]),s=r[e-1]?this.isEmpty(r[e-1].getData()[n.getField()]):!1,o=this.findJumpRow(n,r.slice(0,e),!0,a,s);return o?o.position-1:e}findJumpCellDown(e,i){var n=this.getColumnByRangePos(i),r=this.getTableRows(),a=this.isEmpty(r[e].getData()[n.getField()]),s=r[e+1]?this.isEmpty(r[e+1].getData()[n.getField()]):!1,o=this.findJumpRow(n,r.slice(e+1,r.length),!1,a,s);return o?o.position-1:e}newSelection(e,i){var n;if(i.type==="column"){if(!this.columnSelection)return;if(i===this.rowHeader){n=this.resetRanges(),this.selecting="all";var r,a=this.getCell(-1,-1);this.rowHeader?r=this.getCell(0,1):r=this.getCell(0,0),n.setBounds(r,a);return}else this.selecting="column"}else i.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,i):e.ctrlKey?this.addRange().setBounds(i):this.resetRanges().setBounds(i)}autoScroll(e,i,n){var r=this.table.rowManager.element,a,s,o,l;typeof i>"u"&&(i=this.getRowByRangePos(e.end.row).getElement()),typeof n>"u"&&(n=this.getColumnByRangePos(e.end.col).getElement()),a={left:n.offsetLeft,right:n.offsetLeft+n.offsetWidth,top:i.offsetTop,bottom:i.offsetTop+i.offsetHeight},s={left:r.scrollLeft+this.getRowHeaderWidth(),right:Math.ceil(r.scrollLeft+r.clientWidth),top:r.scrollTop,bottom:r.scrollTop+r.offsetHeight-this.table.rowManager.scrollbarWidth},o=s.left<a.left&&a.left<s.right&&s.left<a.right&&a.right<s.right,l=s.top<a.top&&a.top<s.bottom&&s.top<a.bottom&&a.bottom<s.bottom,o||(a.left<s.left?r.scrollLeft=a.left-this.getRowHeaderWidth():a.right>s.right&&(r.scrollLeft=Math.min(a.right-r.clientWidth,a.left-this.getRowHeaderWidth()))),l||(a.top<s.top?r.scrollTop=a.top:a.bottom>s.bottom&&(r.scrollTop=a.bottom-r.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var i;e?i=this.table.rowManager.getVisibleRows(!0):i=this.table.rowManager.getRows(),i.forEach(n=>{n.type==="row"&&(this.layoutRow(n),n.cells.forEach(r=>this.renderCell(r)))}),this.getTableColumns().forEach(n=>{this.layoutColumn(n)}),this.layoutRanges()}layoutRow(e){var i=e.getElement(),n=!1,r=this.ranges.some(a=>a.occupiesRow(e));this.selecting==="row"?n=r:this.selecting==="all"&&(n=!0),i.classList.toggle("tabulator-range-selected",n),i.classList.toggle("tabulator-range-highlight",r)}layoutColumn(e){var i=e.getElement(),n=!1,r=this.ranges.some(a=>a.occupiesColumn(e));this.selecting==="column"?n=r:this.selecting==="all"&&(n=!0),i.classList.toggle("tabulator-range-selected",n),i.classList.toggle("tabulator-range-highlight",r)}layoutRanges(){var e,i,n;this.table.initialized&&(e=this.getActiveCell(),e&&(i=e.getElement(),n=e.row.getElement(),this.table.rtl?this.activeRangeCellElement.style.right=n.offsetWidth-i.offsetLeft-i.offsetWidth+"px":this.activeRangeCellElement.style.left=n.offsetLeft+i.offsetLeft+"px",this.activeRangeCellElement.style.top=n.offsetTop+"px",this.activeRangeCellElement.style.width=i.offsetWidth+"px",this.activeRangeCellElement.style.height=n.offsetHeight+"px",this.ranges.forEach(r=>r.layout()),this.overlay.style.visibility="visible"))}getCell(e,i){var n;return i<0&&(i=this.getTableColumns().length+i,i<0)?null:(e<0&&(e=this.getTableRows().length+e),n=this.table.rowManager.getRowFromPosition(e+1),n?n.getCells(!1,!0).filter(r=>r.column.visible)[i]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e]}getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,i){var n;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),n=new ett(this.table,this,e,i),this.activeRange=n,this.ranges.push(n),this.rangeContainer.appendChild(n.element),n}resetRanges(){var e,i,n;return this.ranges.forEach(r=>r.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(n=this.table.rowManager.activeRows[0].cells.filter(r=>r.column.visible),i=n[this.rowHeader?1:0],i&&(e.setBounds(i),this.options("selectableRangeAutoFocus")&&this.initializeFocus(i))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(i=>i.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(i=>i.getComponent()):this.activeRange.getColumns()}getRowHeaderWidth(){return this.rowHeader?this.rowHeader.getElement().offsetWidth:0}isEmpty(e){return e==null||e===""}}function utt(t,e,i,n,r,a,s){var o=s.alignEmptyValues,l=s.decimalSeparator,u=s.thousandSeparator,c=0;if(t=String(t),e=String(e),u&&(t=t.split(u).join(""),e=e.split(u).join("")),l&&(t=t.split(l).join("."),e=e.split(l).join(".")),t=parseFloat(t),e=parseFloat(e),isNaN(t))c=isNaN(e)?0:-1;else if(isNaN(e))c=1;else return t-e;return(o==="top"&&a==="desc"||o==="bottom"&&a==="asc")&&(c*=-1),c}function ctt(t,e,i,n,r,a,s){var o=s.alignEmptyValues,l=0,u;if(!t)l=e?-1:0;else if(!e)l=1;else{switch(typeof s.locale){case"boolean":s.locale&&(u=this.langLocale());break;case"string":u=s.locale;break}return String(t).toLowerCase().localeCompare(String(e).toLowerCase(),u)}return(o==="top"&&a==="desc"||o==="bottom"&&a==="asc")&&(l*=-1),l}function UK(t,e,i,n,r,a,s){var o=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),l=s.format||"dd/MM/yyyy HH:mm:ss",u=s.alignEmptyValues,c=0;if(typeof o<"u"){if(o.isDateTime(t)||(l==="iso"?t=o.fromISO(String(t)):t=o.fromFormat(String(t),l)),o.isDateTime(e)||(l==="iso"?e=o.fromISO(String(e)):e=o.fromFormat(String(e),l)),!t.isValid)c=e.isValid?-1:0;else if(!e.isValid)c=1;else return t-e;return(u==="top"&&a==="desc"||u==="bottom"&&a==="asc")&&(c*=-1),c}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function dtt(t,e,i,n,r,a,s){return s.format||(s.format="dd/MM/yyyy"),UK.call(this,t,e,i,n,r,a,s)}function ptt(t,e,i,n,r,a,s){return s.format||(s.format="HH:mm"),UK.call(this,t,e,i,n,r,a,s)}function htt(t,e,i,n,r,a,s){var o=t===!0||t==="true"||t==="True"||t===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return o-l}function ftt(t,e,i,n,r,a,s){var o=s.type||"length",l=s.alignEmptyValues,u=0,c=this.table,d;s.valueMap&&(typeof s.valueMap=="string"?d=function(h){return h.map(f=>Ia.retrieveNestedData(c.options.nestedFieldSeparator,s.valueMap,f))}:d=s.valueMap);function p(h){var f;switch(d&&(h=d(h)),o){case"length":f=h.length;break;case"sum":f=h.reduce(function(m,g){return m+g});break;case"max":f=Math.max.apply(null,h);break;case"min":f=Math.min.apply(null,h);break;case"avg":f=h.reduce(function(m,g){return m+g})/h.length;break;case"string":f=h.join("");break}return f}if(!Array.isArray(t))u=Array.isArray(e)?-1:0;else if(!Array.isArray(e))u=1;else return o==="string"?String(p(t)).toLowerCase().localeCompare(String(p(e)).toLowerCase()):p(e)-p(t);return(l==="top"&&a==="desc"||l==="bottom"&&a==="asc")&&(u*=-1),u}function mtt(t,e,i,n,r,a,s){var o=typeof t>"u"?0:1,l=typeof e>"u"?0:1;return o-l}function gtt(t,e,i,n,r,a,s){var o,l,u,c,d=0,p,h=/(\d+)|(\D+)/g,f=/\d/,m=s.alignEmptyValues,g=0;if(!t&&t!==0)g=!e&&e!==0?0:-1;else if(!e&&e!==0)g=1;else{if(isFinite(t)&&isFinite(e))return t-e;if(o=String(t).toLowerCase(),l=String(e).toLowerCase(),o===l)return 0;if(!(f.test(o)&&f.test(l)))return o>l?1:-1;for(o=o.match(h),l=l.match(h),p=o.length>l.length?l.length:o.length;d<p;)if(u=o[d],c=l[d++],u!==c)return isFinite(u)&&isFinite(c)?(u.charAt(0)==="0"&&(u="."+u),c.charAt(0)==="0"&&(c="."+c),u-c):u>c?1:-1;return o.length>l.length}return(m==="top"&&a==="desc"||m==="bottom"&&a==="asc")&&(g*=-1),g}var vtt={number:utt,string:ctt,date:dtt,time:ptt,datetime:UK,boolean:htt,array:ftt,exists:mtt,alphanum:gtt};class OP extends Vn{static moduleName="sort";static sorters=vtt;constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,i,n,r){var a=this.getSort();return a.forEach(s=>{delete s.column}),r.sort=a,r}userSetSort(e,i){this.setSort(e,i),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var i=!1,n,r;switch(typeof e.definition.sorter){case"string":OP.sorters[e.definition.sorter]?i=OP.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":i=e.definition.sorter;break}if(e.modules.sort={sorter:i,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(n=e.getElement(),n.classList.add("tabulator-sortable"),r=document.createElement("div"),r.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":r.classList.add("tabulator-col-sorter-element");break;case"header":n.classList.add("tabulator-col-sorter-element");break;default:n.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":r.appendChild(this.table.options.headerSortElement);break;default:r.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(r),e.modules.sort.element=r,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&r.addEventListener("mousedown",a=>{a.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?r:n).addEventListener("click",a=>{var s="",o=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?s=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?s=e.modules.sort.dir=="asc"?"desc":"asc":s="none";else switch(e.modules.sort.dir){case"asc":s="desc";break;case"desc":s="asc";break;default:s=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(a.shiftKey||a.ctrlKey)?(o=this.getSort(),l=o.findIndex(u=>u.field===e.getField()),l>-1?(o[l].dir=s,l=o.splice(l,1)[0],s!="none"&&o.push(l)):s!="none"&&o.push({column:e,dir:s}),this.setSort(o)):s=="none"?this.clear():this.setSort(e,s),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,i=[];return e.sortList.forEach(function(n){n.column&&i.push({column:n.column.getComponent(),field:n.column.getField(),dir:n.dir})}),i}setSort(e,i){var n=this,r=[];Array.isArray(e)||(e=[{column:e,dir:i}]),e.forEach(function(a){var s;s=n.table.columnManager.findColumn(a.column),s?(a.column=s,r.push(a),n.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",a.column)}),n.sortList=r,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var i=this.table.rowManager.activeRows[0],n="string",r,a;if(i&&(i=i.getData(),r=e.getField(),r))switch(a=e.getFieldValue(i),typeof a){case"undefined":n="string";break;case"boolean":n="boolean";break;default:!isNaN(a)&&a!==""?n="number":a.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(n="alphanum");break}return OP.sorters[n]}sort(e,i){var n=this,r=this.table.options.sortOrderReverse?n.sortList.slice().reverse():n.sortList,a=[],s=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",n.getSort()),i||n.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(r.forEach(function(o,l){var u;o.column&&(u=o.column.modules.sort,u&&(u.sorter||(u.sorter=n.findSorter(o.column)),o.params=typeof u.params=="function"?u.params(o.column.getComponent(),o.dir):u.params,a.push(o)),i||n.setColumnHeader(o.column,o.dir))}),a.length&&n._sortItems(e,a)):i||r.forEach(function(o,l){n.setColumnHeader(o.column,o.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(o=>{s.push(o.getComponent())}),this.dispatchExternal("dataSorted",n.getSort(),s)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,i){e.modules.sort.dir=i,e.getElement().setAttribute("aria-sort",i==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,i)}setColumnHeaderSortIcon(e,i){var n=e.modules.sort.element,r;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;n.firstChild;)n.removeChild(n.firstChild);r=this.table.options.headerSortElement.call(this.table,e.getComponent(),i),typeof r=="object"?n.appendChild(r):n.innerHTML=r}}_sortItems(e,i){var n=i.length-1;e.sort((r,a)=>{for(var s,o=n;o>=0;o--){let l=i[o];if(s=this._sortRow(r,a,l.column,l.dir,l.params),s!==0)break}return s})}_sortRow(e,i,n,r,a){var s,o,l=r=="asc"?e:i,u=r=="asc"?i:e;return e=n.getFieldValue(l.getData()),i=n.getFieldValue(u.getData()),e=typeof e<"u"?e:"",i=typeof i<"u"?i:"",s=l.getComponent(),o=u.getComponent(),n.modules.sort.sorter.call(this,e,i,s,o,n.getComponent(),r,a)}}class ytt{constructor(e,i){this.columnCount=e,this.rowCount=i,this.columnString=[],this.columns=[],this.rows=[]}genColumns(e){var i=Math.max(this.columnCount,Math.max(...e.map(n=>n.length)));this.columnString=[],this.columns=[];for(let n=1;n<=i;n++)this.incrementChar(this.columnString.length-1),this.columns.push(this.columnString.join(""));return this.columns}genRows(e){var i=Math.max(this.rowCount,e.length);this.rows=[];for(let n=1;n<=i;n++)this.rows.push(n);return this.rows}incrementChar(e){let i=this.columnString[e];i?i!=="Z"?this.columnString[e]=String.fromCharCode(this.columnString[e].charCodeAt(0)+1):(this.columnString[e]="A",e?this.incrementChar(e-1):this.columnString.push("A")):this.columnString.push("A")}setRowCount(e){this.rowCount=e}setColumnCount(e){this.columnCount=e}}class iPe{constructor(e){return this._sheet=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._sheet.table.componentFunctionBinder.handle("sheet",i._sheet,n)}})}getTitle(){return this._sheet.title}getKey(){return this._sheet.key}getDefinition(){return this._sheet.getDefinition()}getData(){return this._sheet.getData()}setData(e){return this._sheet.setData(e)}clear(){return this._sheet.clear()}remove(){return this._sheet.remove()}active(){return this._sheet.active()}setTitle(e){return this._sheet.setTitle(e)}setRows(e){return this._sheet.setRows(e)}setColumns(e){return this._sheet.setColumns(e)}}class Oee extends Hl{constructor(e,i){super(e.table),this.spreadsheetManager=e,this.definition=i,this.title=this.definition.title||"",this.key=this.definition.key||this.definition.title,this.rowCount=this.definition.rows,this.columnCount=this.definition.columns,this.data=this.definition.data||[],this.element=null,this.isActive=!1,this.grid=new ytt(this.columnCount,this.rowCount),this.defaultColumnDefinition={width:100,headerHozAlign:"center",headerSort:!1},this.columnDefinition=Object.assign(this.defaultColumnDefinition,this.options("spreadsheetColumnDefinition")),this.columnDefs=[],this.rowDefs=[],this.columnFields=[],this.columns=[],this.rows=[],this.scrollTop=null,this.scrollLeft=null,this.initialize(),this.dispatchExternal("sheetAdded",this.getComponent())}initialize(){this.initializeElement(),this.initializeColumns(),this.initializeRows()}reinitialize(){this.initializeColumns(),this.initializeRows()}initializeElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tab"),this.element.innerText=this.title,this.element.addEventListener("click",()=>{this.spreadsheetManager.loadSheet(this)})}initializeColumns(){this.grid.setColumnCount(this.columnCount),this.columnFields=this.grid.genColumns(this.data),this.columnDefs=[],this.columnFields.forEach(e=>{var i=Object.assign({},this.columnDefinition);i.field=e,i.title=e,this.columnDefs.push(i)})}initializeRows(){var e;this.grid.setRowCount(this.rowCount),e=this.grid.genRows(this.data),this.rowDefs=[],e.forEach((i,n)=>{var r={_id:i},a=this.data[n];a&&a.forEach((s,o)=>{var l=this.columnFields[o];l&&(r[l]=s)}),this.rowDefs.push(r)})}unload(){this.isActive=!1,this.scrollTop=this.table.rowManager.scrollTop,this.scrollLeft=this.table.rowManager.scrollLeft,this.data=this.getData(!0),this.element.classList.remove("tabulator-spreadsheet-tab-active")}load(){var e=!this.isActive;this.isActive=!0,this.table.blockRedraw(),this.table.setData([]),this.table.setColumns(this.columnDefs),this.table.setData(this.rowDefs),this.table.restoreRedraw(),e&&this.scrollTop!==null&&(this.table.rowManager.element.scrollLeft=this.scrollLeft,this.table.rowManager.element.scrollTop=this.scrollTop),this.element.classList.add("tabulator-spreadsheet-tab-active"),this.dispatchExternal("sheetLoaded",this.getComponent())}getComponent(){return new iPe(this)}getDefinition(){return{title:this.title,key:this.key,rows:this.rowCount,columns:this.columnCount,data:this.getData()}}getData(e){var i=[],n,r,a;return this.rowDefs.forEach(s=>{var o=[];this.columnFields.forEach(l=>{o.push(s[l])}),i.push(o)}),!e&&!this.options("spreadsheetOutputFull")&&(n=i.map(s=>s.findLastIndex(o=>typeof o<"u")+1),r=Math.max(...n),a=n.findLastIndex(s=>s>0)+1,i=i.slice(0,a),i=i.map(s=>s.slice(0,r))),i}setData(e){this.data=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}clear(){this.setData([])}setTitle(e){this.title=e,this.element.innerText=e,this.dispatchExternal("sheetUpdated",this.getComponent())}setRows(e){this.rowCount=e,this.initializeRows(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}setColumns(e){this.columnCount=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}remove(){this.spreadsheetManager.removeSheet(this)}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchExternal("sheetRemoved",this.getComponent())}active(){this.spreadsheetManager.loadSheet(this)}}class btt extends Vn{static moduleName="spreadsheet";constructor(e){super(e),this.sheets=[],this.element=null,this.registerTableOption("spreadsheet",!1),this.registerTableOption("spreadsheetRows",50),this.registerTableOption("spreadsheetColumns",50),this.registerTableOption("spreadsheetColumnDefinition",{}),this.registerTableOption("spreadsheetOutputFull",!1),this.registerTableOption("spreadsheetData",!1),this.registerTableOption("spreadsheetSheets",!1),this.registerTableOption("spreadsheetSheetTabs",!1),this.registerTableOption("spreadsheetSheetTabsElement",!1),this.registerTableFunction("setSheets",this.setSheets.bind(this)),this.registerTableFunction("addSheet",this.addSheet.bind(this)),this.registerTableFunction("getSheets",this.getSheets.bind(this)),this.registerTableFunction("getSheetDefinitions",this.getSheetDefinitions.bind(this)),this.registerTableFunction("setSheetData",this.setSheetData.bind(this)),this.registerTableFunction("getSheet",this.getSheet.bind(this)),this.registerTableFunction("getSheetData",this.getSheetData.bind(this)),this.registerTableFunction("clearSheet",this.clearSheet.bind(this)),this.registerTableFunction("removeSheet",this.removeSheetFunc.bind(this)),this.registerTableFunction("activeSheet",this.activeSheetFunc.bind(this))}initialize(){this.options("spreadsheet")&&(this.subscribe("table-initialized",this.tableInitialized.bind(this)),this.subscribe("data-loaded",this.loadRemoteData.bind(this)),this.table.options.index="_id",this.options("spreadsheetData")&&this.options("spreadsheetSheets")&&(console.warn("You cannot use spreadsheetData and spreadsheetSheets at the same time, ignoring spreadsheetData"),this.table.options.spreadsheetData=!1),this.compatibilityCheck(),this.options("spreadsheetSheetTabs")&&this.initializeTabset())}compatibilityCheck(){this.options("data")&&console.warn("Do not use the data option when working with spreadsheets, use either spreadsheetData or spreadsheetSheets to pass data into the table"),this.options("pagination")&&console.warn("The spreadsheet module is not compatible with the pagination module"),this.options("groupBy")&&console.warn("The spreadsheet module is not compatible with the row grouping module"),this.options("responsiveCollapse")&&console.warn("The spreadsheet module is not compatible with the responsive collapse module")}initializeTabset(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tabs");var e=this.options("spreadsheetSheetTabsElement");e&&!(e instanceof HTMLElement)&&(e=document.querySelector(e),e||console.warn("Unable to find element matching spreadsheetSheetTabsElement selector:",this.options("spreadsheetSheetTabsElement"))),e?e.appendChild(this.element):this.footerAppend(this.element)}tableInitialized(){this.sheets.length?this.loadSheet(this.sheets[0]):this.options("spreadsheetSheets")?this.loadSheets(this.options("spreadsheetSheets")):this.options("spreadsheetData")&&this.loadData(this.options("spreadsheetData"))}loadRemoteData(e,i,n){return console.log("data",e,i,n),Array.isArray(e)?(this.table.dataLoader.clearAlert(),this.dispatchExternal("dataLoaded",e),!e.length||Array.isArray(e[0])?this.loadData(e):this.loadSheets(e)):console.error(`Spreadsheet Loading Error - Unable to process remote data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e),!1}loadData(e){var i={data:e};this.loadSheet(this.newSheet(i))}destroySheets(){this.sheets.forEach(e=>{e.destroy()}),this.sheets=[],this.activeSheet=null}loadSheets(e){Array.isArray(e)||(e=[]),this.destroySheets(),e.forEach(i=>{this.newSheet(i)}),this.loadSheet(this.sheets[0])}loadSheet(e){this.activeSheet!==e&&(this.activeSheet&&this.activeSheet.unload(),this.activeSheet=e,e.load())}newSheet(e={}){var i;return e.rows||(e.rows=this.options("spreadsheetRows")),e.columns||(e.columns=this.options("spreadsheetColumns")),i=new Oee(this,e),this.sheets.push(i),this.element&&this.element.appendChild(i.element),i}removeSheet(e){var i=this.sheets.indexOf(e),n;this.sheets.length>1?i>-1&&(this.sheets.splice(i,1),e.destroy(),this.activeSheet===e&&(n=this.sheets[i-1]||this.sheets[0],n?this.loadSheet(n):this.activeSheet=null)):console.warn("Unable to remove sheet, at least one sheet must be active")}lookupSheet(e){return e?e instanceof Oee?e:e instanceof iPe?e._sheet:this.sheets.find(i=>i.key===e)||!1:this.activeSheet}setSheets(e){return this.loadSheets(e),this.getSheets()}addSheet(e){return this.newSheet(e).getComponent()}getSheetDefinitions(){return this.sheets.map(e=>e.getDefinition())}getSheets(){return this.sheets.map(e=>e.getComponent())}getSheet(e){var i=this.lookupSheet(e);return i?i.getComponent():!1}setSheetData(e,i){e&&!i&&(i=e,e=!1);var n=this.lookupSheet(e);return n?n.setData(i):!1}getSheetData(e){var i=this.lookupSheet(e);return i?i.getData():!1}clearSheet(e){var i=this.lookupSheet(e);return i?i.clear():!1}removeSheetFunc(e){var i=this.lookupSheet(e);i&&this.removeSheet(i)}activeSheetFunc(e){var i=this.lookupSheet(e);return i?this.loadSheet(i):!1}}let Itt=class extends Vn{static moduleName="tooltip";constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,i,n){var r=e==="tooltip"?n.column.definition.tooltip:n.definition.headerTooltip;r&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,i,n,r),this.table.options.tooltipDelay))}mouseoutCheck(e,i,n){this.popupInstance||this.clearPopup()}clearPopup(e,i,n){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,i,n){var r,a,s;function o(l){a=l}typeof n=="function"&&(n=n(e,i.getComponent(),o)),n instanceof HTMLElement?r=n:(r=document.createElement("div"),n===!0&&(i instanceof RN?n=i.value:i.definition.field?this.langBind("columns|"+i.definition.field,l=>{r.innerHTML=n=l||i.definition.title}):n=i.definition.title),r.innerHTML=n),(n||n===0||n===!1)&&(r.classList.add("tabulator-tooltip"),r.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(r),typeof a=="function"&&this.popupInstance.renderCallback(a),s=this.popupInstance.containerEventCoords(e),this.popupInstance.show(s.x+15,s.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",i.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",i.getComponent()))}};var wtt={integer:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=new RegExp(/^[a-z0-9]+$/i);return n.test(e)},max:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=i},min:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=i},starts:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(i).toLowerCase())},ends:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(i).toLowerCase())},minLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length>=i},maxLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length<=i},in:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(typeof i=="string"&&(i=i.split("|")),i.indexOf(e)>-1)},regex:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=new RegExp(i);return n.test(e)},unique:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=!0,r=t.getData(),a=t.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(s){var o=s.getData();o!==r&&e==a.getFieldValue(o)&&(n=!1)}),n},required:function(t,e,i){return e!==""&&e!==null&&typeof e<"u"}};class DK extends Vn{static moduleName="validate";static validators=wtt;constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,i,n){var r=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,i):!0;return r!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),i,r)}),r}editorClear(e,i){i&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var i=[];return e.cells.forEach(n=>{this.cellValidate(n)!==!0&&i.push(n.getComponent())}),i.length?i:!0}rowValidate(e){var i=[];return e.cells.forEach(n=>{this.cellValidate(n)!==!0&&i.push(n.getComponent())}),i.length?i:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.clearValidation(i._getSelf())})}userValidate(e){var i=[];return this.table.rowManager.rows.forEach(n=>{n=n.getComponent();var r=n.validate();r!==!0&&(i=i.concat(r))}),i.length?i:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var i=this,n=[],r;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(a=>{r=i._extractValidator(a),r&&n.push(r)}):(r=this._extractValidator(e.definition.validator),r&&n.push(r)),e.modules.validate=n.length?n:!1)}_extractValidator(e){var i,n,r;switch(typeof e){case"string":return r=e.indexOf(":"),r>-1?(i=e.substring(0,r),n=e.substring(r+1)):i=e,this._buildValidator(i,n);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,i){var n=typeof e=="function"?e:DK.validators[e];return n?{type:typeof e=="function"?"function":e,func:n,params:i}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,i,n){var r=this,a=[],s=this.invalidCells.indexOf(i);return e&&e.forEach(o=>{o.func.call(r,i.getComponent(),n,o.params)||a.push({type:o.type,parameters:o.params})}),i.modules.validate||(i.modules.validate={}),a.length?(i.modules.validate.invalid=a,this.table.options.validationMode!=="manual"&&i.getElement().classList.add("tabulator-validation-fail"),s==-1&&this.invalidCells.push(i)):(i.modules.validate.invalid=!1,i.getElement().classList.remove("tabulator-validation-fail"),s>-1&&this.invalidCells.splice(s,1)),a.length?a:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(i=>{e.push(i.getComponent())}),e}clearValidation(e){var i;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,i=this.invalidCells.indexOf(e),i>-1&&this.invalidCells.splice(i,1))}}var YV=Object.freeze({__proto__:null,AccessorModule:Bx,AjaxModule:nT,ClipboardModule:hQe,ColumnCalcsModule:rT,DataTreeModule:gQe,DownloadModule:Vx,EditModule:wK,ExportModule:kP,FilterModule:UI,FormatModule:aT,FrozenColumnsModule:det,FrozenRowsModule:pet,GroupRowsModule:fet,HistoryModule:Iet,HtmlTableImportModule:wet,ImportModule:SK,InteractionModule:Cet,KeybindingsModule:xP,MenuModule:Net,MoveColumnsModule:Aet,MoveRowsModule:jx,MutatorModule:Gx,PageModule:TK,PersistenceModule:$f,PopupModule:Vet,PrintModule:jet,ReactiveDataModule:Get,ResizeColumnsModule:Het,ResizeRowsModule:zet,ResizeTableModule:qet,ResponsiveLayoutModule:Ket,SelectRangeModule:ltt,SelectRowModule:Jet,SortModule:OP,SpreadsheetModule:btt,TooltipModule:Itt,ValidateModule:DK}),Stt={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},rowHeader:!1,data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{},dependencies:{}};class nPe{constructor(e,i,n={}){this.table=e,this.msgType=i,this.registeredDefaults=Object.assign({},n)}register(e,i){this.registeredDefaults[e]=i}generate(e,i={}){var n=Object.assign({},this.registeredDefaults),r=this.table.options.debugInvalidOptions||i.debugInvalidOptions===!0;Object.assign(n,e);for(let a in i)n.hasOwnProperty(a)||(r&&console.warn("Invalid "+this.msgType+" option:",a),n[a]=i.key);for(let a in n)a in i?n[a]=i[a]:Array.isArray(n[a])?n[a]=Object.assign([],n[a]):typeof n[a]=="object"&&n[a]!==null?n[a]=Object.assign({},n[a]):typeof n[a]>"u"&&delete n[a];return n}}class l2 extends Hl{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,i){}renderRowCells(e){}rerenderRowCells(e,i){}scrollColumns(e,i){}scrollRows(e,i){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,i){var n=e.getElement();i%2?(n.classList.add("tabulator-row-even"),n.classList.remove("tabulator-row-odd")):(n.classList.add("tabulator-row-odd"),n.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,i,n){var r=this.rows().indexOf(e),a=e.getElement(),s=0;return new Promise((o,l)=>{if(r>-1){if(typeof n>"u"&&(n=this.table.options.scrollToRowIfVisible),!n&&Ia.elVisible(a)&&(s=Ia.elOffset(a).top-Ia.elOffset(this.elementVertical).top,s>0&&s<this.elementVertical.clientHeight-a.offsetHeight))return o(),!1;switch(typeof i>"u"&&(i=this.table.options.scrollToRowPosition),i==="nearest"&&(i=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),i){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(a.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-a.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-a.offsetTop)+a.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+a.offsetHeight;break;case"top":this.elementVertical.scrollTop=a.offsetTop;break}o()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}}class Ttt extends l2{constructor(e){super(e)}renderRowCells(e,i){const n=document.createDocumentFragment();e.cells.forEach(r=>{n.appendChild(r.getElement())}),e.element.appendChild(n),i||e.cells.forEach(r=>{r.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(i){i.reinitializeWidth()})}}class Utt extends l2{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,i){this.dataChange()}scrollColumns(e,i){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(i=>{if(i.visible){var n=i.getWidth();n>e&&(e=n)}}),this.windowBuffer=e*2}rerenderColumns(e,i){var n={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},r=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(a=>{var s={},o;a.visible&&(a.modules.frozen||(o=a.getWidth(),s.leftPos=r,s.rightPos=r+o,s.width=o,this.isFitData&&(s.fitDataCheck=a.modules.vdomHoz?a.modules.vdomHoz.fitDataCheck:!0),r+o>this.vDomScrollPosLeft&&r<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=r),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=o),this.columns.push(a),a.modules.vdomHoz=s,r+=o))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,i||(!e||this.reinitChanged(n))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const i=document.createDocumentFragment();e.cells.forEach(n=>{i.appendChild(n.getElement())}),e.element.appendChild(i),e.cells.forEach(n=>{n.cellRendered()})}}rerenderRowCells(e,i){this.reinitializeRow(e,i)}reinitializeColumnWidths(e){for(let i=this.leftCol;i<=this.rightCol;i++){let n=this.columns[i];n&&n.reinitializeWidth()}}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,i,n;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(r=>{!r.definition.width&&r.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,i=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],i)){n=i.getElement(),i.generateCells(),this.tableElement.appendChild(n);for(let r=0;r<i.cells.length;r++){let a=i.cells[r];n.appendChild(a.getElement()),a.column.reinitializeWidth()}n.parentNode.removeChild(n),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var i=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((n,r)=>{n!==this.columns[r]&&(i=!1)}),!i)}reinitializeRows(){var e=this.getVisibleRows(),i=this.table.rowManager.getRows().filter(n=>!e.includes(n));e.forEach(n=>{this.reinitializeRow(n,!0)}),i.forEach(n=>{n.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,i,n){for(let r=e;r<i;r++){let a=this.columns[r];a.modules.vdomHoz.leftPos+=n,a.modules.vdomHoz.rightPos+=n}}addColRight(){for(var e=!1,i=!0;i;){let n=this.columns[this.rightCol+1];n&&n.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var a=r.getCell(n);r.getElement().insertBefore(a.getElement(),r.getCell(this.columns[this.rightCol]).getElement().nextSibling),a.cellRendered()}}),this.fitDataColActualWidthCheck(n),this.rightCol++,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=n.getWidth()):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,i=!0;i;){let n=this.columns[this.leftCol-1];if(n)if(n.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(a=>{if(a.type!=="group"){var s=a.getCell(n);a.getElement().insertBefore(s.getElement(),a.getCell(this.columns[this.leftCol]).getElement()),s.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(a=>{a.type!=="group"&&(a.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=n.getWidth();let r=this.fitDataColActualWidthCheck(n);r&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+r,this.vDomPadRight-=r)}else i=!1;else i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,i=!0;i;){let n=this.columns[this.rightCol];n&&n.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var a=r.getCell(n);try{r.getElement().removeChild(a.getElement())}catch(s){console.warn("Could not removeColRight",s.message)}}}),this.vDomPadRight+=n.getWidth(),this.rightCol--,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.rightCol=this.rightCol)})):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,i=!0;i;){let n=this.columns[this.leftCol];n&&n.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var a=r.getCell(n);try{r.getElement().removeChild(a.getElement())}catch(s){console.warn("Could not removeColLeft",s.message)}}}),this.vDomPadLeft+=n.getWidth(),this.leftCol++,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.leftCol=this.leftCol)})):i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var i,n;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),i=e.getWidth(),n=i-e.modules.vdomHoz.width,n&&(e.modules.vdomHoz.rightPos+=n,e.modules.vdomHoz.width=i,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,n)),e.modules.vdomHoz.fitDataCheck=!1),n}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.appendCell(e,i)});for(let i=this.leftCol;i<=this.rightCol;i++)this.appendCell(e,this.columns[i]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.appendCell(e,i)})}}appendCell(e,i){if(i&&i.visible){let n=e.getCell(i);e.getElement().appendChild(n.getElement()),n.cellRendered()}}reinitializeRow(e,i){if(e.type!=="group"&&(i||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var n=e.getElement();n.firstChild;)n.removeChild(n.firstChild);this.initializeRow(e)}}}class Dtt extends Hl{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.rowHeader=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new nPe(this.table,"column definition",tPe),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,i={virtual:Utt,basic:Ttt};typeof this.table.options.renderHorizontal=="string"?e=i[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var i;e.deltaX&&(i=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(i),this.table.columnManager.scrollHorizontal(i))})}generateColumnsFromRowData(e){var i=[],n={},r=this.table.options.autoColumns==="full"?e:[e[0]],a=this.table.options.autoColumnsDefinitions;if(e&&e.length){if(r.forEach(s=>{Object.keys(s).forEach((o,l)=>{let u=s[o],c;n[o]?n[o]!==!0&&typeof u<"u"&&(n[o].sorter=this.calculateSorterFromValue(u),n[o]=!0):(c={field:o,title:o,sorter:this.calculateSorterFromValue(u)},i.splice(l,0,c),n[o]=typeof u>"u"?c:!0)})}),a)switch(typeof a){case"function":this.table.options.columns=a.call(this.table,i);break;case"object":Array.isArray(a)?i.forEach(s=>{var o=a.find(l=>l.field===s.field);o&&Object.assign(s,o)}):i.forEach(s=>{a[s.field]&&Object.assign(s,a[s.field])}),this.table.options.columns=i;break}else this.table.options.columns=i;this.setColumns(this.table.options.columns)}}calculateSorterFromValue(e){var i;switch(typeof e){case"undefined":i="string";break;case"boolean":i="boolean";break;case"number":i="number";break;case"object":Array.isArray(e)?i="array":i="string";break;default:!isNaN(e)&&e!==""?i="number":e.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?i="alphanum":i="string";break}return i}setColumns(e,i){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),this.dispatchExternal("columnsLoading"),this.table.options.rowHeader&&(this.rowHeader=new Zf(this.table.options.rowHeader===!0?{}:this.table.options.rowHeader,this,!0),this.columns.push(this.rowHeader),this.headersElement.appendChild(this.rowHeader.getElement()),this.rowHeader.columnRendered()),e.forEach((n,r)=>{this._addColumn(n)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.subscribedExternal("columnsLoaded")&&this.dispatchExternal("columnsLoaded",this.getComponents()),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,i,n){var r=new Zf(e,this),a=r.getElement(),s=n&&this.findColumnIndex(n);if(i&&this.rowHeader&&(!n||n===this.rowHeader)&&(i=!1,n=this.rowHeader,s=0),n&&s>-1){var o=n.getTopColumn(),l=this.columns.indexOf(o),u=o.getElement();i?(this.columns.splice(l,0,r),u.parentNode.insertBefore(a,u)):(this.columns.splice(l+1,0,r),u.parentNode.insertBefore(a,u.nextSibling))}else i?(this.columns.unshift(r),this.headersElement.insertBefore(r.getElement(),this.headersElement.firstChild)):(this.columns.push(r),this.headersElement.appendChild(r.getElement()));return r.columnRendered(),r}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(i=>{i.clearVerticalAlign()}),this.columns.forEach(i=>{var n=i.getHeight();n>e&&(e=n)}),this.headersElement.style.height=e+"px",this.columns.forEach(i=>{i.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var i;if(typeof e=="object"){if(e instanceof Zf)return e;if(e instanceof ePe)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return i=[],this.columns.forEach(r=>{i.push(r),i=i.concat(r.getColumns(!0))}),i.find(r=>r.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var i=[];return Object.keys(this.columnsByField).forEach(n=>{var r=this.table.options.nestedFieldSeparator?n.split(this.table.options.nestedFieldSeparator)[0]:n;r===e&&i.push(this.columnsByField[n])}),i}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(i=>i.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(i=>e===i)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((i,n)=>{e(i,n)})}getDefinitions(e){var i=[];return this.columnsByIndex.forEach(n=>{(!e||e&&n.visible)&&i.push(n.getDefinition())}),i}getDefinitionTree(){var e=[];return this.columns.forEach(i=>{e.push(i.getDefinition(!0))}),e}getComponents(e){var i=[],n=e?this.columns:this.columnsByIndex;return n.forEach(r=>{i.push(r.getComponent())}),i}getWidth(){var e=0;return this.columnsByIndex.forEach(i=>{i.visible&&(e+=i.getWidth())}),e}moveColumn(e,i,n){i.element.parentNode.insertBefore(e.element,i.element),n&&i.element.parentNode.insertBefore(i.element,e.element),this.moveColumnActual(e,i,n),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,i,n){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,i,n):this._moveColumnInArray(this.columns,e,i,n),this._moveColumnInArray(this.columnsByIndex,e,i,n,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,i,n),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,i,n,r,a){var s=e.indexOf(i),o,l=[];s>-1&&(e.splice(s,1),o=e.indexOf(n),o>-1?r&&(o=o+1):o=s,e.splice(o,0,i),a&&(l=this.chain("column-moving-rows",[i,n,r],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(u){if(u.cells.length){var c=u.cells.splice(s,1)[0];u.cells.splice(o,0,c)}})))}scrollToColumn(e,i,n){var r=0,a=e.getLeftOffset(),s=0,o=e.getElement();return new Promise((l,u)=>{if(typeof i>"u"&&(i=this.table.options.scrollToColumnPosition),typeof n>"u"&&(n=this.table.options.scrollToColumnIfVisible),e.visible){switch(i){case"middle":case"center":s=-this.element.clientWidth/2;break;case"right":s=o.clientWidth-this.headersElement.clientWidth;break}if(!n&&a>0&&a+o.offsetWidth<this.element.clientWidth)return!1;r=a+s,r=Math.max(Math.min(r,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(r),this.scrollHorizontal(r),l()}else console.warn("Scroll Error - Column not visible"),u("Scroll Error - Column not visible")})}generateCells(e){var i=[];return this.columnsByIndex.forEach(n=>{i.push(n.generateCell(e))}),i}getFlexBaseWidth(){var e=this.table.element.clientWidth,i=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(n){var r,a,s;n.visible&&(r=n.definition.width||0,a=parseInt(n.minWidth),typeof r=="string"?r.indexOf("%")>-1?s=e/100*parseInt(r):s=parseInt(r):s=r,i+=s>a?s:a)}),i}addColumn(e,i,n){return new Promise((r,a)=>{var s=this._addColumn(e,i,n);this._reIndexColumns(),this.dispatch("column-add",e,i,n),this.layoutMode()!="fitColumns"&&s.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),r(s)})}deregisterColumn(e){var i=e.getField(),n;i&&delete this.columnsByField[i],n=this.columnsByIndex.indexOf(e),n>-1&&this.columnsByIndex.splice(n,1),n=this.columns.indexOf(e),n>-1&&this.columns.splice(n,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,i){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,i)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){Ia.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class Ett extends l2{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,i=!0,n=document.createDocumentFragment(),r=this.rows();r.forEach((a,s)=>{this.styleRow(a,s),a.initialize(!1,!0),a.type!=="group"&&(i=!1),n.appendChild(a.getElement())}),e.appendChild(n),r.forEach(a=>{a.rendered(),a.heightInitialized||a.calcHeight(!0)}),r.forEach(a=>{a.heightInitialized||a.setCellHeight()}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var i=Ia.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-i)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-i))}scrollToRow(e){var i=e.getElement();this.elementVertical.scrollTop=Ia.elOffset(i).top-Ia.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class Ptt extends l2{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var i=this.elementVertical.scrollTop,n=!1,r=!1,a=this.table.rowManager.scrollLeft,s=this.rows(),o=this.vDomTop;o<=this.vDomBottom;o++)if(s[o]){var l=i-s[o].getElement().offsetTop;if(r===!1||Math.abs(l)<r)r=l,n=o;else break}s.forEach(u=>{u.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(n===!1?this.rows.length-1:n,!0,r||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(a)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,i){var n=e-this.vDomScrollPosTop,r=e-this.vDomScrollPosBottom,a=this.vDomWindowBuffer*2,s=this.rows();if(this.scrollTop=e,-n>a||r>a){var o=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*s.length)),this.scrollColumns(o)}else i?(n<0&&this._addTopRow(s,-n),r<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(s,-r):this.vDomScrollPosBottom=this.scrollTop)):(r>=0&&this._addBottomRow(s,r),n>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(s,n):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var i=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-i)>Math.abs(this.vDomBottom-i))}scrollToRow(e){var i=this.rows().indexOf(e);i>-1&&this._virtualRenderFill(i,!0)}visibleRows(e){var i=this.elementVertical.scrollTop,n=this.elementVertical.clientHeight+i,r=!1,a=0,s=0,o=this.rows();if(e)a=this.vDomTop,s=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(o[l])if(r)if(n-o[l].getElement().offsetTop>=0)s=l;else break;else if(i-o[l].getElement().offsetTop>=0)a=l;else if(r=!0,n-o[l].getElement().offsetTop>=0)s=l;else break;return o.slice(a,s+1)}_virtualRenderFill(e,i,n){var r=this.tableElement,a=this.elementVertical,s=0,o=0,l=0,u=0,c=0,d=0,p=this.rows(),h=p.length,f=0,m,g,v=[],y=0,b=0,I=this.table.rowManager.fixedHeight,S=this.elementVertical.clientHeight,w=this.table.options.rowHeight,T=!0;if(e=e||0,n=n||0,!e)this.clear();else{for(;r.firstChild;)r.removeChild(r.firstChild);u=(h-e+1)*this.vDomRowHeight,u<S&&(e-=Math.ceil((S-u)/this.vDomRowHeight),e<0&&(e=0)),s=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=s}if(h&&Ia.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,I||this.table.options.maxHeight?(w&&(b=S/w+this.vDomWindowBuffer/w),b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(b))):b=h;(b==h||o<=S+this.vDomWindowBuffer||y<this.vDomWindowMinTotalRows)&&this.vDomBottom<h-1;){for(v=[],g=document.createDocumentFragment(),d=0;d<b&&this.vDomBottom<h-1;)f=this.vDomBottom+1,m=p[f],this.styleRow(m,f),m.initialize(!1,!0),!m.heightInitialized&&!this.table.options.rowHeight&&m.clearCellHeight(),g.appendChild(m.getElement()),v.push(m),this.vDomBottom++,d++;if(!v.length)break;r.appendChild(g),v.forEach(U=>{U.rendered(),U.heightInitialized||U.calcHeight(!0)}),v.forEach(U=>{U.heightInitialized||U.setCellHeight()}),v.forEach(U=>{l=U.getHeight(),y<s?c+=l:o+=l,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=l*2),y++}),T=this.table.rowManager.adjustTableSize(),S=this.elementVertical.clientHeight,T&&(I||this.table.options.maxHeight)&&(w=o/y,b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(S/w+this.vDomWindowBuffer/w)))}e?(this.vDomTopPad=i?this.vDomRowHeight*this.vDomTop+n:this.scrollTop-c,this.vDomBottomPad=this.vDomBottom==h-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-o-c,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((o+c)/y),this.vDomBottomPad=this.vDomRowHeight*(h-this.vDomBottom-1),this.vDomScrollHeight=c+o+this.vDomBottomPad-S),r.style.paddingTop=this.vDomTopPad+"px",r.style.paddingBottom=this.vDomBottomPad+"px",i&&(this.scrollTop=this.vDomTopPad+c+n-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-S:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-S),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&i&&(this.scrollTop+=this.elementVertical.offsetHeight-S),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,a.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,i){for(var n=this.tableElement,r=[],a=0,s=this.vDomTop-1,o=0,l=!0;l;)if(this.vDomTop){let u=e[s],c,d;u&&o<this.vDomMaxRenderChain?(c=u.getHeight()||this.vDomRowHeight,d=u.initialized,i>=c?(this.styleRow(u,s),n.insertBefore(u.getElement(),n.firstChild),(!u.initialized||!u.heightInitialized)&&r.push(u),u.initialize(),d||(c=u.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),i-=c,a+=c,this.vDomTop--,s--,o++):l=!1):l=!1}else l=!1;for(let u of r)u.clearCellHeight();this._quickNormalizeRowHeight(r),a&&(this.vDomTopPad-=a,this.vDomTopPad<0&&(this.vDomTopPad=s*this.vDomRowHeight),s<1&&(this.vDomTopPad=0),n.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=a)}_removeTopRow(e,i){for(var n=[],r=0,a=0,s=!0;s;){let o=e[this.vDomTop],l;o&&a<this.vDomMaxRenderChain?(l=o.getHeight()||this.vDomRowHeight,i>=l?(this.vDomTop++,i-=l,r+=l,n.push(o),a++):s=!1):s=!1}for(let o of n){let l=o.getElement();l.parentNode&&l.parentNode.removeChild(l)}r&&(this.vDomTopPad+=r,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?r:r+this.vDomWindowBuffer)}_addBottomRow(e,i){for(var n=this.tableElement,r=[],a=0,s=this.vDomBottom+1,o=0,l=!0;l;){let u=e[s],c,d;u&&o<this.vDomMaxRenderChain?(c=u.getHeight()||this.vDomRowHeight,d=u.initialized,i>=c?(this.styleRow(u,s),n.appendChild(u.getElement()),(!u.initialized||!u.heightInitialized)&&r.push(u),u.initialize(),d||(c=u.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),i-=c,a+=c,this.vDomBottom++,s++,o++):l=!1):l=!1}for(let u of r)u.clearCellHeight();this._quickNormalizeRowHeight(r),a&&(this.vDomBottomPad-=a,(this.vDomBottomPad<0||s==e.length-1)&&(this.vDomBottomPad=0),n.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=a)}_removeBottomRow(e,i){for(var n=[],r=0,a=0,s=!0;s;){let o=e[this.vDomBottom],l;o&&a<this.vDomMaxRenderChain?(l=o.getHeight()||this.vDomRowHeight,i>=l?(this.vDomBottom--,i-=l,r+=l,n.push(o),a++):s=!1):s=!1}for(let o of n){let l=o.getElement();l.parentNode&&l.parentNode.removeChild(l)}r&&(this.vDomBottomPad+=r,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=r)}_quickNormalizeRowHeight(e){for(let i of e)i.calcHeight();for(let i of e)i.setCellHeight()}}class Ctt extends Hl{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let i=document.createElement("div");if(i.classList.add("tabulator-placeholder"),typeof e=="string"){let n=document.createElement("div");n.classList.add("tabulator-placeholder-contents"),n.innerHTML=e,i.appendChild(n),this.placeholderContents=n}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(i.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=i}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,i=this.scrollLeft>e,n=this.element.scrollTop,r=this.scrollTop>n;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,i),this.dispatchExternal("scrollHorizontal",e,i),this._positionPlaceholder()),this.scrollTop!=n&&(this.scrollTop=n,this.renderer.scrollRows(n,r),this.dispatch("scroll-vertical",n,r),this.dispatchExternal("scrollVertical",n,r))})}findRow(e){if(typeof e=="object"){if(e instanceof tu)return e;if(e instanceof s2)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(n=>n.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(n=>n.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var i=this.rows.find(n=>n.data===e);return i||!1}getRowFromPosition(e){return this.getDisplayRows().find(i=>i.type==="row"&&i.getPosition()===e&&i.isDisplayed())}scrollToRow(e,i,n){return this.renderer.scrollToRowPosition(e,i,n)}setData(e,i,n){return new Promise((r,a)=>{i&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&n&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),r()})}_setDataActual(e,i){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((n,r)=>{if(n&&typeof n=="object"){var a=new tu(n,this);this.rows.push(a)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",n)}),this.refreshActiveData(!1,!1,i),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,i){var n=this.rows.indexOf(e),r=this.activeRows.indexOf(e);r>-1&&this.activeRows.splice(r,1),n>-1&&this.rows.splice(n,1),this.setActiveRows(this.activeRows),this.displayRowIterator(a=>{var s=a.indexOf(e);s>-1&&a.splice(s,1)}),i||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,i,n,r){var a=this.addRowActual(e,i,n,r);return a}addRows(e,i,n,r){var a=[];return new Promise((s,o)=>{i=this.findAddRowPos(i),Array.isArray(e)||(e=[e]),(typeof n>"u"&&i||typeof n<"u"&&!i)&&e.reverse(),e.forEach((l,u)=>{var c=this.addRow(l,i,n,!0);a.push(c),this.dispatch("row-added",c,l,i,n)}),this.refreshActiveData(r?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),s(a)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,i,n,r){var a=e instanceof tu?e:new tu(e||{},this),s=this.findAddRowPos(i),o=-1,l,u;return n||(u=this.chain("row-adding-position",[a,s],null,{index:n,top:s}),n=u.index,s=u.top),typeof n<"u"&&(n=this.findRow(n)),n=this.chain("row-adding-index",[a,n,s],null,n),n&&(o=this.rows.indexOf(n)),n&&o>-1?(l=this.activeRows.indexOf(n),this.displayRowIterator(function(c){var d=c.indexOf(n);d>-1&&c.splice(s?d:d+1,0,a)}),l>-1&&this.activeRows.splice(s?l:l+1,0,a),this.rows.splice(s?o:o+1,0,a)):s?(this.displayRowIterator(function(c){c.unshift(a)}),this.activeRows.unshift(a),this.rows.unshift(a)):(this.displayRowIterator(function(c){c.push(a)}),this.activeRows.push(a),this.rows.push(a)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",a.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),r||this.reRenderInPosition(),a}moveRow(e,i,n){this.dispatch("row-move",e,i,n),this.moveRowActual(e,i,n),this.regenerateRowPositions(),this.dispatch("row-moved",e,i,n),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,i,n){this.moveRowInArray(this.rows,e,i,n),this.moveRowInArray(this.activeRows,e,i,n),this.displayRowIterator(r=>{this.moveRowInArray(r,e,i,n)}),this.dispatch("row-moving",e,i,n)}moveRowInArray(e,i,n,r){var a,s,o,l;if(i!==n&&(a=e.indexOf(i),a>-1&&(e.splice(a,1),s=e.indexOf(n),s>-1?r?e.splice(s+1,0,i):e.splice(s,0,i):e.splice(a,0,i)),e===this.getDisplayRows())){o=a<s?a:s,l=s>a?s:a+1;for(let u=o;u<=l;u++)e[u]&&this.styleRow(e[u],u)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var i=this.getDisplayRows().indexOf(e);return i>-1?i:!1}nextDisplayRow(e,i){var n=this.getDisplayRowIndex(e),r=!1;return n!==!1&&n<this.displayRowsCount-1&&(r=this.getDisplayRows()[n+1]),r&&(!(r instanceof tu)||r.type!="row")?this.nextDisplayRow(r,i):r}prevDisplayRow(e,i){var n=this.getDisplayRowIndex(e),r=!1;return n&&(r=this.getDisplayRows()[n-1]),i&&r&&(!(r instanceof tu)||r.type!="row")?this.prevDisplayRow(r,i):r}findRowIndex(e,i){var n;return e=this.findRow(e),e&&(n=i.indexOf(e),n>-1)?n:!1}getData(e,i){var n=[],r=this.getRows(e);return r.forEach(function(a){a.type=="row"&&n.push(a.getData(i||"data"))}),n}getComponents(e){var i=[],n=this.getRows(e);return n.forEach(function(r){i.push(r.getComponent())}),i}getDataCount(e){var i=this.getRows(e);return i.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,i){typeof i<"u"?(this.dataPipeline.push({handler:e,priority:i}),this.dataPipeline.sort((n,r)=>n.priority-r.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,i){typeof i<"u"?(this.displayPipeline.push({handler:e,priority:i}),this.displayPipeline.sort((n,r)=>n.priority-r.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,i,n){var r=this.table,a="",s=0,o=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(s=this.dataPipeline.findIndex(l=>l.handler===e),s>-1)a="dataPipeline",i&&(s==this.dataPipeline.length-1?a="display":s++);else if(s=this.displayPipeline.findIndex(l=>l.handler===e),s>-1)a="displayPipeline",i&&(s==this.displayPipeline.length-1?a="end":s++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else a=e||"all",s=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===a&&s<this.redrawBlockRestoreConfig.index||o.indexOf(a)<o.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:i,renderInPosition:n,stage:a,index:s});return}else Ia.elVisible(this.element)?n?this.reRenderInPosition(this.refreshPipelines.bind(this,e,a,s,n)):(this.refreshPipelines(e,a,s,n),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),r.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,a,s,n),this.dispatch("data-refreshed")}}refreshPipelines(e,i,n,r){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),i){case"all":case"dataPipeline":for(let a=n;a<this.dataPipeline.length;a++){let s=this.dataPipeline[a].handler(this.activeRowsPipeline[a].slice(0));this.activeRowsPipeline[a+1]=s||this.activeRowsPipeline[a].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":n=0,this.resetDisplayRows();case"displayPipeline":for(let a=n;a<this.displayPipeline.length;a++){let s=this.displayPipeline[a].handler((a?this.getDisplayRows(a-1):this.activeRows).slice(0),r);this.setDisplayRows(s||this.getDisplayRows(a-1).slice(0),a)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),i=1;e.forEach(n=>{n.type==="row"&&(n.setPosition(i),i++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,i){this.displayRows[i]=e,i==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,i){var n=Object.assign([],this.renderer.visibleRows(!i));return e&&(n=this.chain("rows-visible",[i],n,n)),n}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var i=[];switch(e){case"active":i=this.activeRows;break;case"display":i=this.table.rowManager.getDisplayRows();break;case"visible":i=this.getVisibleRows(!1,!0);break;default:i=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return i}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,i={virtual:Ptt,basic:Ett};typeof this.table.options.renderVertical=="string"?e=i[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,i){var n=e.getElement();i%2?(n.classList.add("tabulator-row-even"),n.classList.remove("tabulator-row-odd")):(n.classList.add("tabulator-row-odd"),n.classList.remove("tabulator-row-even"))}normalizeHeight(e){this.activeRows.forEach(function(i){i.normalizeHeight(e)})}adjustTableSize(){let e=this.element.clientHeight,i,n=!1;if(this.renderer.verticalFillMode==="fill"){let r=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){i=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const a="calc(100% - "+r+"px)";this.element.style.minHeight=i||"calc(100% - "+r+"px)",this.element.style.height=a,this.element.style.maxHeight=a}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-r+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(n=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),n}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class Rtt extends Hl{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){if(this.table.options.footerElement)switch(typeof this.table.options.footerElement){case"string":this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement));break;default:this.element=this.table.options.footerElement;break}}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class Mtt extends Hl{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(i=>{e[i]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,i,n){this.pseudoTrackers[e].target!==n&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",i,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,i),this.pseudoTrackers[e].target=n,this.dispatch(e+"-mouseenter",i,n))}pseudoMouseLeave(e,i){var n=Object.keys(this.pseudoTrackers),r={row:["cell"],cell:["row"]};n=n.filter(a=>{var s=r[e];return a!==e&&(!s||s&&!s.includes(a))}),n.forEach(a=>{var s=this.pseudoTrackers[a].target;this.pseudoTrackers[a].target&&(this.dispatch(a+"-mouseleave",i,s),this.pseudoTrackers[a].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),i=Object.values(this.componentMap);for(let n of i)for(let r of e){let a=n+"-"+r;this.subscriptionChange(a,this.subscriptionChanged.bind(this,n,r))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,i,n){var r=this.listeners[i].components,a=r.indexOf(e),s=!1;n?a===-1&&(r.push(e),s=!0):this.subscribed(e+"-"+i)||a>-1&&(r.splice(a,1),s=!0),(i==="mouseenter"||i==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),s&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let i=this.listeners[e];i.components.length?i.handler||(i.handler=this.track.bind(this,e),this.el.addEventListener(e,i.handler)):i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}track(e,i){var n=i.composedPath&&i.composedPath()||i.path,r=this.findTargets(n);r=this.bindComponents(e,r),this.triggerEvents(e,i,r),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(r).length&&this.pseudoMouseLeave("none",i)}findTargets(e){var i={};let n=Object.keys(this.componentMap);for(let r of e){let a=r.classList?[...r.classList]:[];if(a.filter(l=>this.abortClasses.includes(l)).length)break;let o=a.filter(l=>n.includes(l));for(let l of o)i[this.componentMap[l]]||(i[this.componentMap[l]]=r)}return i.group&&i.group===i.row&&delete i.row,i}bindComponents(e,i){var n=Object.keys(i).reverse(),r=this.listeners[e],a={},s={},o={};for(let l of n){let u,c=i[l],d=this.previousTargets[l];if(d&&d.target===c)u=d.component;else switch(l){case"row":case"group":(r.components.includes("row")||r.components.includes("cell")||r.components.includes("group"))&&(u=this.table.rowManager.getVisibleRows(!0).find(h=>h.getElement()===c),i.row&&i.row.parentNode&&i.row.parentNode.closest(".tabulator-row")&&(i[l]=!1));break;case"column":r.components.includes("column")&&(u=this.table.columnManager.findColumn(c));break;case"cell":r.components.includes("cell")&&(a.row instanceof tu?u=a.row.findCell(c):i.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}u&&(a[l]=u,o[l]={target:c,component:u})}return this.previousTargets=o,Object.keys(i).forEach(l=>{let u=a[l];s[l]=u}),s}triggerEvents(e,i,n){var r=this.listeners[e];for(let a in n)n[a]&&r.components.includes(a)&&this.dispatch(a+"-"+e,i,n[a])}clearWatchers(){for(let e in this.listeners){let i=this.listeners[e];i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}}class Ntt{constructor(e){this.table=e,this.bindings={}}bind(e,i,n){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][i]?console.warn("Unable to bind component handler, a matching function name is already bound",e,i,n):this.bindings[e][i]=n}handle(e,i,n){if(this.bindings[e]&&this.bindings[e][n]&&typeof this.bindings[e][n].bind=="function")return this.bindings[e][n].bind(null,i);n!=="then"&&typeof n=="string"&&!n.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+n+" function, have you checked that you have the correct Tabulator module installed?")}}class Att extends Hl{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,i,n,r,a,s){var o=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,i,n,a])){this.loading=!0,a||this.alertLoader(),i=this.chain("data-params",[e,n,a],i||{},i||{}),i=this.mapParams(i,this.table.options.dataSendParams);var l=this.chain("data-load",[e,i,n,a],!1,Promise.resolve([]));return l.then(u=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(u)&&typeof u=="object"&&(u=this.mapParams(u,this.objectInvert(this.table.options.dataReceiveParams)));var c=this.chain("data-loaded",[u],null,u);o==this.requestOrder?(this.clearAlert(),c!==!1&&(this.dispatchExternal("dataLoaded",c),this.table.rowManager.setData(c,r,typeof s>"u"?!r:s))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(u=>{console.error("Data Load Error: ",u),this.dispatchExternal("dataLoadError",u),a||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,r,typeof s>"u"?!r:s),Promise.resolve()}mapParams(e,i){var n={};for(let r in e)n[i.hasOwnProperty(r)?i[r]:r]=e[r];return n}objectInvert(e){var i={};for(let n in e)i[e[n]]=n;return i}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class _tt{constructor(e,i,n){this.table=e,this.events={},this.optionsList=i||{},this.subscriptionNotifiers={},this.dispatch=n?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=n}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var n;if(this.events[e])if(i)if(n=this.events[e].findIndex(r=>r===i),n>-1)this.events[e].splice(n,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,i){var n=this.subscriptionNotifiers[e];n&&n.forEach(r=>{r(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift(),n;return this.events[i]&&this.events[i].forEach((r,a)=>{let s=r.apply(this.table,e);a||(n=s)}),n}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}}class ktt{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i,n=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:i,priority:n}),this.events[e].sort((r,a)=>r.priority-a.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var n;if(this.events[e]){if(i)if(n=this.events[e].findIndex(r=>r.callback===i),n>-1)this.events[e].splice(n,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,i,n,r){var a=n;return Array.isArray(i)||(i=[i]),this.subscribed(e)?(this.events[e].forEach((s,o)=>{a=s.callback.apply(this,i.concat([a]))}),a):typeof r=="function"?r():r}_confirm(e,i){var n=!1;return Array.isArray(i)||(i=[i]),this.subscribed(e)&&this.events[e].forEach((r,a)=>{r.callback.apply(this,i)&&(n=!0)}),n}_notifySubscriptionChange(e,i){var n=this.subscriptionNotifiers[e];n&&n.forEach(r=>{r(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift();this.events[i]&&this.events[i].forEach(n=>{n.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._confirm(...arguments)}}class xtt extends Hl{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,i,n){var r="";return typeof this.options(e)<"u"?(r="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",i?(r=r+", Please use the %c"+i+"%c option instead",this._warnUser(r,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),n&&(this.table.options[i]=this.table.options[e])):this._warnUser(r,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,i){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+i,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}class Ott extends Hl{constructor(e){super(e),this.deps={},this.props={}}initialize(){this.deps=Object.assign({},this.options("dependencies"))}lookup(e,i,n){if(Array.isArray(e)){for(const a of e){var r=this.lookup(a,i,!0);if(r)break}if(r)return r;this.error(e)}else return i?this.lookupProp(e,i,n):this.lookupKey(e,n)}lookupProp(e,i,n){var r;if(this.props[e]&&this.props[e][i])return this.props[e][i];if(r=this.lookupKey(e,n),r)return this.props[e]||(this.props[e]={}),this.props[e][i]=r[i]||r,this.props[e][i]}lookupKey(e,i){var n;return this.deps[e]?n=this.deps[e]:window[e]?(this.deps[e]=window[e],n=this.deps[e]):i||this.error(e),n}error(e){console.error("Unable to find dependency",e,"Please check documentation and ensure you have imported the required library into your project")}}function Ltt(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function Lee(t,e){t.forEach(function(i){i.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function Ftt(t,e){var i=0,n=this.table.rowManager.element.clientWidth,r=0,a=!1;t.forEach((s,o)=>{s.widthFixed||s.reinitializeWidth(),(this.table.options.responsiveLayout?s.modules.responsive.visible:s.visible)&&(a=s),s.visible&&(i+=s.getWidth())}),a?(r=n-i+a.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(a.setWidth(0),this.table.modules.responsiveLayout.update()),r>0?a.setWidth(r):a.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function $tt(t,e){var i=this.table.rowManager.element.getBoundingClientRect().width,n=0,r=0,a=0,s=0,o=[],l=[],u=0,c=0,d=0;function p(f){var m;return typeof f=="string"?f.indexOf("%")>-1?m=i/100*parseInt(f):m=parseInt(f):m=f,m}function h(f,m,g,v){var y=[],b=0,I=0,S=0,w=a,T=0,U=0,C=[];function E(M){return g*(M.column.definition.widthGrow||1)}function P(M){return p(M.width)-g*(M.column.definition.widthShrink||0)}return f.forEach(function(M,R){var N=v?P(M):E(M);M.column.minWidth>=N?y.push(M):M.column.maxWidth&&M.column.maxWidth<N?(M.width=M.column.maxWidth,m-=M.column.maxWidth,w-=v?M.column.definition.widthShrink||1:M.column.definition.widthGrow||1,w&&(g=Math.floor(m/w))):(C.push(M),U+=v?M.column.definition.widthShrink||1:M.column.definition.widthGrow||1)}),y.length?(y.forEach(function(M){b+=v?M.width-M.column.minWidth:M.column.minWidth,M.width=M.column.minWidth}),I=m-b,S=U?Math.floor(I/U):I,T=h(C,I,S,v)):(T=U?m-Math.floor(m/U)*U:m,C.forEach(function(M){M.width=v?P(M):E(M)})),T}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(i-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(f){var m,g,v;f.visible&&(m=f.definition.width,g=parseInt(f.minWidth),m?(v=p(m),n+=v>g?v:g,f.definition.widthShrink&&(l.push({column:f,width:v>g?v:g}),u+=f.definition.widthShrink)):(o.push({column:f,width:0}),a+=f.definition.widthGrow||1))}),r=i-n,s=Math.floor(r/a),d=h(o,r,s,!1),o.length&&d>0&&(o[o.length-1].width+=d),o.forEach(function(f){r-=f.width}),c=Math.abs(d)+r,c>0&&u&&(d=h(l,c,Math.floor(c/u),!0)),d&&l.length&&(l[l.length-1].width-=d),o.forEach(function(f){f.column.setWidth(f.width)}),l.forEach(function(f){f.column.setWidth(f.width)})}var Btt={fitData:Ltt,fitDataFill:Lee,fitDataTable:Lee,fitDataStretch:Ftt,fitColumns:$tt};class Hx extends Vn{static moduleName="layout";static modes=Btt;constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;Hx.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){var i=this.table.columnManager.columnsByIndex.find(n=>n.definition.variableHeight||n.definition.formatter==="textarea");this.dispatch("layout-refreshing"),Hx.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),i&&this.table.rowManager.normalizeHeight(!0),this.dispatch("layout-refreshed")}}var Vtt={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};class EK extends Vn{static moduleName="localize";static langs=Vtt;constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=Ia.deepClone(EK.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,i){this.langList[e]?this._setLangProp(this.langList[e],i):this.langList[e]=i}_setLangProp(e,i){for(let n in i)e[n]&&typeof e[n]=="object"?this._setLangProp(e[n],i[n]):e[n]=i[n]}setLocale(e){e=e||"default";function i(n,r){for(var a in n)typeof n[a]=="object"?(r[a]||(r[a]={}),i(n[a],r[a])):r[a]=n[a]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let n=e.split("-")[0];this.langList[n]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,n),e=n):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=Ia.deepClone(this.langList.default||{}),e!="default"&&i(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,i){var n=i?e+"|"+i:e,r=n.split("|"),a=this._getLangElement(r,this.locale);return a||""}_getLangElement(e,i){var n=this.lang;return e.forEach(function(r){var a;n&&(a=n[r],typeof a<"u"?n=a:n=!1)}),n}bind(e,i){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(i),i(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(i=>{i(this.getText(e),this.lang)})}}class jtt extends Vn{static moduleName="comms";constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var i=[],n;return n=this.table.constructor.registry.lookupTable(e),n.forEach(r=>{this.table!==r&&i.push(r)}),i}send(e,i,n,r){var a=this.getConnections(e);a.forEach(s=>{s.tableComms(this.table.element,i,n,r)}),!a.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,i,n,r){if(this.table.modExists(i))return this.table.modules[i].commsReceived(e,n,r);console.warn("Inter-table Comms Error - no such module:",i)}}var Gtt=Object.freeze({__proto__:null,CommsModule:jtt,LayoutModule:Hx,LocalizeModule:EK});class cp{static registry={tables:[],register(e){cp.registry.tables.push(e)},deregister(e){var i=cp.registry.tables.indexOf(e);i>-1&&cp.registry.tables.splice(i,1)},lookupTable(e,i){var n=[],r,a;if(typeof e=="string"){if(r=document.querySelectorAll(e),r.length)for(var s=0;s<r.length;s++)a=cp.registry.matchElement(r[s]),a&&n.push(a)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof cp?(a=cp.registry.matchElement(e),a&&n.push(a)):Array.isArray(e)?e.forEach(function(o){n=n.concat(cp.registry.lookupTable(o))}):i||console.warn("Table Connection Error - Invalid Selector",e);return n},matchElement(e){return cp.registry.tables.find(function(i){return e instanceof cp?i===e:i.element===e})}};static findTable(e){var i=cp.registry.lookupTable(e,!0);return Array.isArray(i)&&!i.length?!1:i}}class ns extends cp{static moduleBindings={};static moduleExtensions={};static modulesRegistered=!1;static defaultModules=!1;constructor(){super()}static initializeModuleBinder(e){ns.modulesRegistered||(ns.modulesRegistered=!0,ns._registerModules(Gtt,!0),e&&ns._registerModules(e))}static _extendModule(e,i,n){if(ns.moduleBindings[e]){var r=ns.moduleBindings[e][i];if(r)if(typeof n=="object")for(let a in n)r[a]=n[a];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",i)}else console.warn("Module Error - module does not exist:",e)}static _registerModules(e,i){var n=Object.values(e);i&&n.forEach(r=>{r.prototype.moduleCore=!0}),ns._registerModule(n)}static _registerModule(e){Array.isArray(e)||(e=[e]),e.forEach(i=>{ns._registerModuleBinding(i),ns._registerModuleExtensions(i)})}static _registerModuleBinding(e){e.moduleName?ns.moduleBindings[e.moduleName]=e:console.error("Unable to bind module, no moduleName defined",e.moduleName)}static _registerModuleExtensions(e){var i=e.moduleExtensions;if(e.moduleExtensions)for(let n in i){let r=i[n];if(ns.moduleBindings[n])for(let a in r)ns._extendModule(n,a,r[a]);else{ns.moduleExtensions[n]||(ns.moduleExtensions[n]={});for(let a in r)ns.moduleExtensions[n][a]||(ns.moduleExtensions[n][a]={}),Object.assign(ns.moduleExtensions[n][a],r[a])}}ns._extendModuleFromQueue(e)}static _extendModuleFromQueue(e){var i=ns.moduleExtensions[e.moduleName];if(i)for(let n in i)ns._extendModule(e.moduleName,n,i[n])}_bindModules(){var e=[],i=[],n=[];this.modules={};for(var r in ns.moduleBindings){let a=ns.moduleBindings[r],s=new a(this);this.modules[r]=s,a.prototype.moduleCore?this.modulesCore.push(s):a.moduleInitOrder?a.moduleInitOrder<0?e.push(s):i.push(s):n.push(s)}e.sort((a,s)=>a.moduleInitOrder>s.moduleInitOrder?1:-1),i.sort((a,s)=>a.moduleInitOrder>s.moduleInitOrder?1:-1),this.modulesRegular=e.concat(n.concat(i))}}class Htt extends Hl{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,i="msg"){if(e){for(this.clear(),this.dispatch("alert-show",i),this.type=i;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}class hy extends ns{static defaultOptions=Stt;static extendModule(){hy.initializeModuleBinder(),hy._extendModule(...arguments)}static registerModule(){hy.initializeModuleBinder(),hy._registerModule(...arguments)}constructor(e,i,n){super(),hy.initializeModuleBinder(n),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new Ntt(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new xtt(this),this.optionsList=new nPe(this,"table constructor"),this.dependencyRegistry=new Ott(this),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(i),setTimeout(()=>{this._create()})),this.constructor.registry.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new Dtt(this),this.rowManager=new Ctt(this),this.footerManager=new Rtt(this),this.dataLoader=new Att(this),this.alertManager=new Htt(this),this._bindModules(),this.options=this.optionsList.generate(hy.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new _tt(this,this.options,this.options.debugEventsExternal),this.eventBus=new ktt(this.options.debugEventsInternal),this.interactionMonitor=new Mtt(this),this.dataLoader.initialize(),this.footerManager.initialize(),this.dependencyRegistry.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this.initialized=!0,this._loadInitialData().finally(()=>{this.eventBus.dispatch("table-initialized"),this.externalEvents.dispatch("tableBuilt")})}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,i=this.options,n;if(e.tagName==="TABLE"){this.originalElement=this.element,n=document.createElement("div");var r=e.attributes;for(var a in r)typeof r[a]=="object"&&n.setAttribute(r[a].name,r[a].value);e.parentNode.replaceChild(n,e),this.element=e=n}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),i.minHeight!==!1&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),i.maxHeight!==!1&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var e=this.element,i=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(n=>{n.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),i.footerElement&&this.footerManager.activate(),i.autoColumns&&i.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(n=>{n.initialize()}),this.columnManager.setColumns(i.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){return this.dataLoader.load(this.options.data).finally(()=>{this.columnManager.verticalAlignHeaders()})}destroy(){var e=this.element;for(this.destroyed=!0,this.constructor.registry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,i){var n,r;return this.options.debugInitialization&&!this.initialized&&(e||(n=new Error().stack.split(`
`),r=n[0]=="Error"?n[2]:n[1],r[0]==" "?e=r.trim().split(" ")[1].split(".")[1]:e=r.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(i?" "+i:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,i,n){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,i,n,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,i,n){return this.initGuard(),this.dataLoader.load(e,i,n,!0,!0)}updateData(e){var i=0;return this.initGuard(),new Promise((n,r)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(a=>{var s=this.rowManager.findRow(a[this.options.index]);s?(i++,s.updateData(a).then(()=>{i--,i||n()}).catch(o=>{r("Update Error - Unable to update row",a,o)})):r("Update Error - Unable to find row",a)}):(console.warn("Update Error - No data provided"),r("Update Error - No data provided"))})}addData(e,i,n){return this.initGuard(),new Promise((r,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,i,n).then(s=>{var o=[];s.forEach(function(l){o.push(l.getComponent())}),r(o)}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}updateOrAddData(e){var i=[],n=0;return this.initGuard(),new Promise((r,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(s=>{var o=this.rowManager.findRow(s[this.options.index]);n++,o?o.updateData(s).then(()=>{n--,i.push(o.getComponent()),n||r(i)}):this.rowManager.addRows(s).then(l=>{n--,i.push(l[0].getComponent()),n||r(i)})}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}getRow(e){var i=this.rowManager.findRow(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var i=this.rowManager.getRowFromPosition(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var i=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let n of e){let r=this.rowManager.findRow(n,!0);if(r)i.push(r);else return console.error("Delete Error - No matching row found:",n),Promise.reject("Delete Error - No matching row found")}return i.sort((n,r)=>this.rowManager.rows.indexOf(n)>this.rowManager.rows.indexOf(r)?1:-1),i.forEach(n=>{n.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,i,n){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,i,n,!0).then(r=>r[0].getComponent())}updateOrAddRow(e,i){var n=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),n?n.updateData(i).then(()=>n.getComponent()):this.rowManager.addRows(i).then(r=>r[0].getComponent())}updateRow(e,i){var n=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),n?n.updateData(i).then(()=>Promise.resolve(n.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,i,n){var r=this.rowManager.findRow(e);return r?this.rowManager.scrollToRow(r,i,n):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,i,n){var r=this.rowManager.findRow(e);this.initGuard(),r?r.moveToRow(i,n):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var i=this.rowManager.findRow(e);return i?i.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var i=this.columnManager.findColumn(e);return i?i.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.visible?i.hide():i.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,i,n){var r=this.columnManager.findColumn(n);return this.initGuard(),this.columnManager.addColumn(e,i,r).then(a=>a.getComponent())}deleteColumn(e){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,i){var n=this.columnManager.findColumn(e);return this.initGuard(),n?n.updateDefinition(i):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,i,n){var r=this.columnManager.findColumn(e),a=this.columnManager.findColumn(i);this.initGuard(),r?a?this.columnManager.moveColumn(r,a,n):console.warn("Move Error - No matching column found:",a):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,i,n){return new Promise((r,a)=>{var s=this.columnManager.findColumn(e);return s?this.columnManager.scrollToColumn(s,i,n):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(e,i){this.externalEvents.subscribe(e,i)}off(e,i){this.externalEvents.unsubscribe(e,i)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,i){this.initGuard(),this.alertManager.alert(e,i)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,i){return this.modules[e]?!0:(i&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var i=this.modules[e];return i||console.error("Tabulator module not installed: "+e),i}}var CE=hy;class ztt extends CE{static extendModule(){CE.initializeModuleBinder(YV),CE._extendModule(...arguments)}static registerModule(){CE.initializeModuleBinder(YV),CE._registerModule(...arguments)}constructor(e,i,n){super(e,i,YV)}}var Bs=ztt;const{MALE:qtt,FEMALE:Wtt}=eh;function Ytt(t){const e=t.getValue(),i=t.getRow().getData(),n=i.sex||i.person?.sex,r=n?.toUpperCase()===qtt&&"#2E86C1"||n?.toUpperCase()===Wtt&&"#AA336A"||"",a=document.createElement("div");return a.style.color=r,a.innerHTML=e,a}function Ktt(t){return[{visible:t.some(i=>i.drawPosition),field:"drawPosition",title:"Position",headerSort:!1,responsive:!1,editor:!1,maxWidth:100},{formatter:Ytt,field:"participantName",title:"Participant",responsive:!1,minWidth:200,widthGrow:2}]}function rPe(t){let{data:e=[]}=t;const{selectedParticipantIds:i,selectionLimit:n=1,targetAttribute:r,placeholder:a,onSelected:s,anchorId:o}=t;e.some(p=>p.participant)&&(e=e.map(({participant:p,...h})=>({...h,participantName:"BYE",...p}))),e.forEach(p=>p.searchText=p.participantName?.toLowerCase());const u=Ktt(e),c=document.getElementById(o),d=new Bs(c,{placeholder:a||"No options",selectableRows:n,index:r,layout:"fitColumns",reactiveData:!0,maxHeight:350,columns:u,data:e});return It.tables||(It.tables=[]),It.tables.selectionTable||(It.tables={...It.tables,selectionTable:d}),d.on("tableBuilt",()=>{i?.length&&d.selectRow(i)}),d.on("rowSelectionChanged",(p,h)=>{const f=h?.map(m=>m.getData());Mt(s)&&s?.(f)}),{table:d}}function PK(t){const{title:e,placeholder:i,options:n,selectionLimit:r}=t,a="selectionControl",s="selectionTable",o=[{label:"Cancel",intent:"is-none",close:!0}],l=()=>{It.tables.selectionTable?.destroy(),delete It.tables.selectionTable},u=`
    <div style='min-height: 420px'>
      <div id='${a}'></div>
      <div id='${s}'></div>
    </div>
  `;Yn({title:e,content:u,buttons:o,onClose:l});const c=m=>{m?.[0]?.onClick&&(m[0].onClick(),Aw())},{table:d}=rPe({targetAttribute:"participantid",selectionLimit:r,data:n,placeholder:i,onSelected:c,anchorId:s}),p=Q0(d),h=[{onKeyDown:m=>m.keyCode===8&&m.target.value.length===1&&p(""),onChange:m=>p(m.target.value),onKeyUp:m=>p(m.target.value),clearSearch:()=>p(""),placeholder:"Search",location:hi,search:!0}],f=document.getElementById(a)||void 0;wo({table:d,target:f,items:h})}var Qc="top",Xp="bottom",Jp="right",ed="left",CK="auto",MN=[Qc,Xp,Jp,ed],UU="start",h1="end",Ztt="clippingParents",aPe="viewport",RE="popper",Xtt="reference",Fee=MN.reduce(function(t,e){return t.concat([e+"-"+UU,e+"-"+h1])},[]),sPe=[].concat(MN,[CK]).reduce(function(t,e){return t.concat([e,e+"-"+UU,e+"-"+h1])},[]),Jtt="beforeRead",Qtt="read",eit="afterRead",tit="beforeMain",iit="main",nit="afterMain",rit="beforeWrite",ait="write",sit="afterWrite",oit=[Jtt,Qtt,eit,tit,iit,nit,rit,ait,sit];function km(t){return t?(t.nodeName||"").toLowerCase():null}function Yd(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function _w(t){var e=Yd(t).Element;return t instanceof e||t instanceof Element}function Ap(t){var e=Yd(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function RK(t){if(typeof ShadowRoot>"u")return!1;var e=Yd(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function lit(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var n=e.styles[i]||{},r=e.attributes[i]||{},a=e.elements[i];!Ap(a)||!km(a)||(Object.assign(a.style,n),Object.keys(r).forEach(function(s){var o=r[s];o===!1?a.removeAttribute(s):a.setAttribute(s,o===!0?"":o)}))})}function uit(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(n){var r=e.elements[n],a=e.attributes[n]||{},s=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:i[n]),o=s.reduce(function(l,u){return l[u]="",l},{});!Ap(r)||!km(r)||(Object.assign(r.style,o),Object.keys(a).forEach(function(l){r.removeAttribute(l)}))})}}const oPe={name:"applyStyles",enabled:!0,phase:"write",fn:lit,effect:uit,requires:["computeStyles"]};function sm(t){return t.split("-")[0]}var ew=Math.max,zx=Math.min,DU=Math.round;function yz(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function lPe(){return!/^((?!chrome|android).)*safari/i.test(yz())}function EU(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var n=t.getBoundingClientRect(),r=1,a=1;e&&Ap(t)&&(r=t.offsetWidth>0&&DU(n.width)/t.offsetWidth||1,a=t.offsetHeight>0&&DU(n.height)/t.offsetHeight||1);var s=_w(t)?Yd(t):window,o=s.visualViewport,l=!lPe()&&i,u=(n.left+(l&&o?o.offsetLeft:0))/r,c=(n.top+(l&&o?o.offsetTop:0))/a,d=n.width/r,p=n.height/a;return{width:d,height:p,top:c,right:u+d,bottom:c+p,left:u,x:u,y:c}}function MK(t){var e=EU(t),i=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:n}}function uPe(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&RK(i)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function pv(t){return Yd(t).getComputedStyle(t)}function cit(t){return["table","td","th"].indexOf(km(t))>=0}function Jb(t){return((_w(t)?t.ownerDocument:t.document)||window.document).documentElement}function u2(t){return km(t)==="html"?t:t.assignedSlot||t.parentNode||(RK(t)?t.host:null)||Jb(t)}function $ee(t){return!Ap(t)||pv(t).position==="fixed"?null:t.offsetParent}function dit(t){var e=/firefox/i.test(yz()),i=/Trident/i.test(yz());if(i&&Ap(t)){var n=pv(t);if(n.position==="fixed")return null}var r=u2(t);for(RK(r)&&(r=r.host);Ap(r)&&["html","body"].indexOf(km(r))<0;){var a=pv(r);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return r;r=r.parentNode}return null}function NN(t){for(var e=Yd(t),i=$ee(t);i&&cit(i)&&pv(i).position==="static";)i=$ee(i);return i&&(km(i)==="html"||km(i)==="body"&&pv(i).position==="static")?e:i||dit(t)||e}function NK(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function LP(t,e,i){return ew(t,zx(e,i))}function pit(t,e,i){var n=LP(t,e,i);return n>i?i:n}function cPe(){return{top:0,right:0,bottom:0,left:0}}function dPe(t){return Object.assign({},cPe(),t)}function pPe(t,e){return e.reduce(function(i,n){return i[n]=t,i},{})}var hit=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,dPe(typeof e!="number"?e:pPe(e,MN))};function fit(t){var e,i=t.state,n=t.name,r=t.options,a=i.elements.arrow,s=i.modifiersData.popperOffsets,o=sm(i.placement),l=NK(o),u=[ed,Jp].indexOf(o)>=0,c=u?"height":"width";if(!(!a||!s)){var d=hit(r.padding,i),p=MK(a),h=l==="y"?Qc:ed,f=l==="y"?Xp:Jp,m=i.rects.reference[c]+i.rects.reference[l]-s[l]-i.rects.popper[c],g=s[l]-i.rects.reference[l],v=NN(a),y=v?l==="y"?v.clientHeight||0:v.clientWidth||0:0,b=m/2-g/2,I=d[h],S=y-p[c]-d[f],w=y/2-p[c]/2+b,T=LP(I,w,S),U=l;i.modifiersData[n]=(e={},e[U]=T,e.centerOffset=T-w,e)}}function mit(t){var e=t.state,i=t.options,n=i.element,r=n===void 0?"[data-popper-arrow]":n;r!=null&&(typeof r=="string"&&(r=e.elements.popper.querySelector(r),!r)||uPe(e.elements.popper,r)&&(e.elements.arrow=r))}const git={name:"arrow",enabled:!0,phase:"main",fn:fit,effect:mit,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function PU(t){return t.split("-")[1]}var vit={top:"auto",right:"auto",bottom:"auto",left:"auto"};function yit(t,e){var i=t.x,n=t.y,r=e.devicePixelRatio||1;return{x:DU(i*r)/r||0,y:DU(n*r)/r||0}}function Bee(t){var e,i=t.popper,n=t.popperRect,r=t.placement,a=t.variation,s=t.offsets,o=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,d=t.isFixed,p=s.x,h=p===void 0?0:p,f=s.y,m=f===void 0?0:f,g=typeof c=="function"?c({x:h,y:m}):{x:h,y:m};h=g.x,m=g.y;var v=s.hasOwnProperty("x"),y=s.hasOwnProperty("y"),b=ed,I=Qc,S=window;if(u){var w=NN(i),T="clientHeight",U="clientWidth";if(w===Yd(i)&&(w=Jb(i),pv(w).position!=="static"&&o==="absolute"&&(T="scrollHeight",U="scrollWidth")),w=w,r===Qc||(r===ed||r===Jp)&&a===h1){I=Xp;var C=d&&w===S&&S.visualViewport?S.visualViewport.height:w[T];m-=C-n.height,m*=l?1:-1}if(r===ed||(r===Qc||r===Xp)&&a===h1){b=Jp;var E=d&&w===S&&S.visualViewport?S.visualViewport.width:w[U];h-=E-n.width,h*=l?1:-1}}var P=Object.assign({position:o},u&&vit),M=c===!0?yit({x:h,y:m},Yd(i)):{x:h,y:m};if(h=M.x,m=M.y,l){var R;return Object.assign({},P,(R={},R[I]=y?"0":"",R[b]=v?"0":"",R.transform=(S.devicePixelRatio||1)<=1?"translate("+h+"px, "+m+"px)":"translate3d("+h+"px, "+m+"px, 0)",R))}return Object.assign({},P,(e={},e[I]=y?m+"px":"",e[b]=v?h+"px":"",e.transform="",e))}function bit(t){var e=t.state,i=t.options,n=i.gpuAcceleration,r=n===void 0?!0:n,a=i.adaptive,s=a===void 0?!0:a,o=i.roundOffsets,l=o===void 0?!0:o,u={placement:sm(e.placement),variation:PU(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Bee(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Bee(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const Iit={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:bit,data:{}};var vA={passive:!0};function wit(t){var e=t.state,i=t.instance,n=t.options,r=n.scroll,a=r===void 0?!0:r,s=n.resize,o=s===void 0?!0:s,l=Yd(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach(function(c){c.addEventListener("scroll",i.update,vA)}),o&&l.addEventListener("resize",i.update,vA),function(){a&&u.forEach(function(c){c.removeEventListener("scroll",i.update,vA)}),o&&l.removeEventListener("resize",i.update,vA)}}const Sit={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:wit,data:{}};var Tit={left:"right",right:"left",bottom:"top",top:"bottom"};function $_(t){return t.replace(/left|right|bottom|top/g,function(e){return Tit[e]})}var Uit={start:"end",end:"start"};function Vee(t){return t.replace(/start|end/g,function(e){return Uit[e]})}function AK(t){var e=Yd(t),i=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:i,scrollTop:n}}function _K(t){return EU(Jb(t)).left+AK(t).scrollLeft}function Dit(t,e){var i=Yd(t),n=Jb(t),r=i.visualViewport,a=n.clientWidth,s=n.clientHeight,o=0,l=0;if(r){a=r.width,s=r.height;var u=lPe();(u||!u&&e==="fixed")&&(o=r.offsetLeft,l=r.offsetTop)}return{width:a,height:s,x:o+_K(t),y:l}}function Eit(t){var e,i=Jb(t),n=AK(t),r=(e=t.ownerDocument)==null?void 0:e.body,a=ew(i.scrollWidth,i.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),s=ew(i.scrollHeight,i.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),o=-n.scrollLeft+_K(t),l=-n.scrollTop;return pv(r||i).direction==="rtl"&&(o+=ew(i.clientWidth,r?r.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}function kK(t){var e=pv(t),i=e.overflow,n=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+r+n)}function hPe(t){return["html","body","#document"].indexOf(km(t))>=0?t.ownerDocument.body:Ap(t)&&kK(t)?t:hPe(u2(t))}function FP(t,e){var i;e===void 0&&(e=[]);var n=hPe(t),r=n===((i=t.ownerDocument)==null?void 0:i.body),a=Yd(n),s=r?[a].concat(a.visualViewport||[],kK(n)?n:[]):n,o=e.concat(s);return r?o:o.concat(FP(u2(s)))}function bz(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function Pit(t,e){var i=EU(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function jee(t,e,i){return e===aPe?bz(Dit(t,i)):_w(e)?Pit(e,i):bz(Eit(Jb(t)))}function Cit(t){var e=FP(u2(t)),i=["absolute","fixed"].indexOf(pv(t).position)>=0,n=i&&Ap(t)?NN(t):t;return _w(n)?e.filter(function(r){return _w(r)&&uPe(r,n)&&km(r)!=="body"}):[]}function Rit(t,e,i,n){var r=e==="clippingParents"?Cit(t):[].concat(e),a=[].concat(r,[i]),s=a[0],o=a.reduce(function(l,u){var c=jee(t,u,n);return l.top=ew(c.top,l.top),l.right=zx(c.right,l.right),l.bottom=zx(c.bottom,l.bottom),l.left=ew(c.left,l.left),l},jee(t,s,n));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function fPe(t){var e=t.reference,i=t.element,n=t.placement,r=n?sm(n):null,a=n?PU(n):null,s=e.x+e.width/2-i.width/2,o=e.y+e.height/2-i.height/2,l;switch(r){case Qc:l={x:s,y:e.y-i.height};break;case Xp:l={x:s,y:e.y+e.height};break;case Jp:l={x:e.x+e.width,y:o};break;case ed:l={x:e.x-i.width,y:o};break;default:l={x:e.x,y:e.y}}var u=r?NK(r):null;if(u!=null){var c=u==="y"?"height":"width";switch(a){case UU:l[u]=l[u]-(e[c]/2-i[c]/2);break;case h1:l[u]=l[u]+(e[c]/2-i[c]/2);break}}return l}function f1(t,e){e===void 0&&(e={});var i=e,n=i.placement,r=n===void 0?t.placement:n,a=i.strategy,s=a===void 0?t.strategy:a,o=i.boundary,l=o===void 0?Ztt:o,u=i.rootBoundary,c=u===void 0?aPe:u,d=i.elementContext,p=d===void 0?RE:d,h=i.altBoundary,f=h===void 0?!1:h,m=i.padding,g=m===void 0?0:m,v=dPe(typeof g!="number"?g:pPe(g,MN)),y=p===RE?Xtt:RE,b=t.rects.popper,I=t.elements[f?y:p],S=Rit(_w(I)?I:I.contextElement||Jb(t.elements.popper),l,c,s),w=EU(t.elements.reference),T=fPe({reference:w,element:b,placement:r}),U=bz(Object.assign({},b,T)),C=p===RE?U:w,E={top:S.top-C.top+v.top,bottom:C.bottom-S.bottom+v.bottom,left:S.left-C.left+v.left,right:C.right-S.right+v.right},P=t.modifiersData.offset;if(p===RE&&P){var M=P[r];Object.keys(E).forEach(function(R){var N=[Jp,Xp].indexOf(R)>=0?1:-1,A=[Qc,Xp].indexOf(R)>=0?"y":"x";E[R]+=M[A]*N})}return E}function Mit(t,e){e===void 0&&(e={});var i=e,n=i.placement,r=i.boundary,a=i.rootBoundary,s=i.padding,o=i.flipVariations,l=i.allowedAutoPlacements,u=l===void 0?sPe:l,c=PU(n),d=c?o?Fee:Fee.filter(function(f){return PU(f)===c}):MN,p=d.filter(function(f){return u.indexOf(f)>=0});p.length===0&&(p=d);var h=p.reduce(function(f,m){return f[m]=f1(t,{placement:m,boundary:r,rootBoundary:a,padding:s})[sm(m)],f},{});return Object.keys(h).sort(function(f,m){return h[f]-h[m]})}function Nit(t){if(sm(t)===CK)return[];var e=$_(t);return[Vee(t),e,Vee(e)]}function Ait(t){var e=t.state,i=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var r=i.mainAxis,a=r===void 0?!0:r,s=i.altAxis,o=s===void 0?!0:s,l=i.fallbackPlacements,u=i.padding,c=i.boundary,d=i.rootBoundary,p=i.altBoundary,h=i.flipVariations,f=h===void 0?!0:h,m=i.allowedAutoPlacements,g=e.options.placement,v=sm(g),y=v===g,b=l||(y||!f?[$_(g)]:Nit(g)),I=[g].concat(b).reduce(function(W,q){return W.concat(sm(q)===CK?Mit(e,{placement:q,boundary:c,rootBoundary:d,padding:u,flipVariations:f,allowedAutoPlacements:m}):q)},[]),S=e.rects.reference,w=e.rects.popper,T=new Map,U=!0,C=I[0],E=0;E<I.length;E++){var P=I[E],M=sm(P),R=PU(P)===UU,N=[Qc,Xp].indexOf(M)>=0,A=N?"width":"height",_=f1(e,{placement:P,boundary:c,rootBoundary:d,altBoundary:p,padding:u}),x=N?R?Jp:ed:R?Xp:Qc;S[A]>w[A]&&(x=$_(x));var O=$_(x),$=[];if(a&&$.push(_[M]<=0),o&&$.push(_[x]<=0,_[O]<=0),$.every(function(W){return W})){C=P,U=!1;break}T.set(P,$)}if(U)for(var F=f?3:1,j=function(q){var Z=I.find(function(K){var Q=T.get(K);if(Q)return Q.slice(0,q).every(function(J){return J})});if(Z)return C=Z,"break"},H=F;H>0;H--){var G=j(H);if(G==="break")break}e.placement!==C&&(e.modifiersData[n]._skip=!0,e.placement=C,e.reset=!0)}}const _it={name:"flip",enabled:!0,phase:"main",fn:Ait,requiresIfExists:["offset"],data:{_skip:!1}};function Gee(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function Hee(t){return[Qc,Jp,Xp,ed].some(function(e){return t[e]>=0})}function kit(t){var e=t.state,i=t.name,n=e.rects.reference,r=e.rects.popper,a=e.modifiersData.preventOverflow,s=f1(e,{elementContext:"reference"}),o=f1(e,{altBoundary:!0}),l=Gee(s,n),u=Gee(o,r,a),c=Hee(l),d=Hee(u);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":d})}const xit={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:kit};function Oit(t,e,i){var n=sm(t),r=[ed,Qc].indexOf(n)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,s=a[0],o=a[1];return s=s||0,o=(o||0)*r,[ed,Jp].indexOf(n)>=0?{x:o,y:s}:{x:s,y:o}}function Lit(t){var e=t.state,i=t.options,n=t.name,r=i.offset,a=r===void 0?[0,0]:r,s=sPe.reduce(function(c,d){return c[d]=Oit(d,e.rects,a),c},{}),o=s[e.placement],l=o.x,u=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[n]=s}const Fit={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Lit};function $it(t){var e=t.state,i=t.name;e.modifiersData[i]=fPe({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const Bit={name:"popperOffsets",enabled:!0,phase:"read",fn:$it,data:{}};function Vit(t){return t==="x"?"y":"x"}function jit(t){var e=t.state,i=t.options,n=t.name,r=i.mainAxis,a=r===void 0?!0:r,s=i.altAxis,o=s===void 0?!1:s,l=i.boundary,u=i.rootBoundary,c=i.altBoundary,d=i.padding,p=i.tether,h=p===void 0?!0:p,f=i.tetherOffset,m=f===void 0?0:f,g=f1(e,{boundary:l,rootBoundary:u,padding:d,altBoundary:c}),v=sm(e.placement),y=PU(e.placement),b=!y,I=NK(v),S=Vit(I),w=e.modifiersData.popperOffsets,T=e.rects.reference,U=e.rects.popper,C=typeof m=="function"?m(Object.assign({},e.rects,{placement:e.placement})):m,E=typeof C=="number"?{mainAxis:C,altAxis:C}:Object.assign({mainAxis:0,altAxis:0},C),P=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,M={x:0,y:0};if(w){if(a){var R,N=I==="y"?Qc:ed,A=I==="y"?Xp:Jp,_=I==="y"?"height":"width",x=w[I],O=x+g[N],$=x-g[A],F=h?-U[_]/2:0,j=y===UU?T[_]:U[_],H=y===UU?-U[_]:-T[_],G=e.elements.arrow,W=h&&G?MK(G):{width:0,height:0},q=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:cPe(),Z=q[N],K=q[A],Q=LP(0,T[_],W[_]),J=b?T[_]/2-F-Q-Z-E.mainAxis:j-Q-Z-E.mainAxis,ne=b?-T[_]/2+F+Q+K+E.mainAxis:H+Q+K+E.mainAxis,re=e.elements.arrow&&NN(e.elements.arrow),oe=re?I==="y"?re.clientTop||0:re.clientLeft||0:0,de=(R=P?.[I])!=null?R:0,se=x+J-de-oe,ge=x+ne-de,ye=LP(h?zx(O,se):O,x,h?ew($,ge):$);w[I]=ye,M[I]=ye-x}if(o){var Te,De=I==="x"?Qc:ed,xe=I==="x"?Xp:Jp,Me=w[S],Oe=S==="y"?"height":"width",at=Me+g[De],Fe=Me-g[xe],mt=[Qc,ed].indexOf(v)!==-1,Xe=(Te=P?.[S])!=null?Te:0,gt=mt?at:Me-T[Oe]-U[Oe]-Xe+E.altAxis,ht=mt?Me+T[Oe]+U[Oe]-Xe-E.altAxis:Fe,_e=h&&mt?pit(gt,Me,ht):LP(h?gt:at,Me,h?ht:Fe);w[S]=_e,M[S]=_e-Me}e.modifiersData[n]=M}}const Git={name:"preventOverflow",enabled:!0,phase:"main",fn:jit,requiresIfExists:["offset"]};function Hit(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function zit(t){return t===Yd(t)||!Ap(t)?AK(t):Hit(t)}function qit(t){var e=t.getBoundingClientRect(),i=DU(e.width)/t.offsetWidth||1,n=DU(e.height)/t.offsetHeight||1;return i!==1||n!==1}function Wit(t,e,i){i===void 0&&(i=!1);var n=Ap(e),r=Ap(e)&&qit(e),a=Jb(e),s=EU(t,r,i),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!i)&&((km(e)!=="body"||kK(a))&&(o=zit(e)),Ap(e)?(l=EU(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=_K(a))),{x:s.left+o.scrollLeft-l.x,y:s.top+o.scrollTop-l.y,width:s.width,height:s.height}}function Yit(t){var e=new Map,i=new Set,n=[];t.forEach(function(a){e.set(a.name,a)});function r(a){i.add(a.name);var s=[].concat(a.requires||[],a.requiresIfExists||[]);s.forEach(function(o){if(!i.has(o)){var l=e.get(o);l&&r(l)}}),n.push(a)}return t.forEach(function(a){i.has(a.name)||r(a)}),n}function Kit(t){var e=Yit(t);return oit.reduce(function(i,n){return i.concat(e.filter(function(r){return r.phase===n}))},[])}function Zit(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function Xit(t){var e=t.reduce(function(i,n){var r=i[n.name];return i[n.name]=r?Object.assign({},r,n,{options:Object.assign({},r.options,n.options),data:Object.assign({},r.data,n.data)}):n,i},{});return Object.keys(e).map(function(i){return e[i]})}var zee={placement:"bottom",modifiers:[],strategy:"absolute"};function qee(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function Jit(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,n=i===void 0?[]:i,r=e.defaultOptions,a=r===void 0?zee:r;return function(o,l,u){u===void 0&&(u=a);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},zee,a),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},d=[],p=!1,h={state:c,setOptions:function(v){var y=typeof v=="function"?v(c.options):v;m(),c.options=Object.assign({},a,c.options,y),c.scrollParents={reference:_w(o)?FP(o):o.contextElement?FP(o.contextElement):[],popper:FP(l)};var b=Kit(Xit([].concat(n,c.options.modifiers)));return c.orderedModifiers=b.filter(function(I){return I.enabled}),f(),h.update()},forceUpdate:function(){if(!p){var v=c.elements,y=v.reference,b=v.popper;if(qee(y,b)){c.rects={reference:Wit(y,NN(b),c.options.strategy==="fixed"),popper:MK(b)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(E){return c.modifiersData[E.name]=Object.assign({},E.data)});for(var I=0;I<c.orderedModifiers.length;I++){if(c.reset===!0){c.reset=!1,I=-1;continue}var S=c.orderedModifiers[I],w=S.fn,T=S.options,U=T===void 0?{}:T,C=S.name;typeof w=="function"&&(c=w({state:c,options:U,name:C,instance:h})||c)}}}},update:Zit(function(){return new Promise(function(g){h.forceUpdate(),g(c)})}),destroy:function(){m(),p=!0}};if(!qee(o,l))return h;h.setOptions(u).then(function(g){!p&&u.onFirstUpdate&&u.onFirstUpdate(g)});function f(){c.orderedModifiers.forEach(function(g){var v=g.name,y=g.options,b=y===void 0?{}:y,I=g.effect;if(typeof I=="function"){var S=I({state:c,name:v,instance:h,options:b}),w=function(){};d.push(S||w)}})}function m(){d.forEach(function(g){return g()}),d=[]}return h}}var Qit=[Sit,Bit,Iit,oPe,Fit,_it,Git,git,xit],ent=Jit({defaultModifiers:Qit}),tnt="tippy-box",mPe="tippy-content",int="tippy-backdrop",gPe="tippy-arrow",vPe="tippy-svg-arrow",wI={passive:!0,capture:!0},yPe=function(){return document.body};function KV(t,e,i){if(Array.isArray(t)){var n=t[e];return n??(Array.isArray(i)?i[e]:i)}return t}function xK(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function bPe(t,e){return typeof t=="function"?t.apply(void 0,e):t}function Wee(t,e){if(e===0)return t;var i;return function(n){clearTimeout(i),i=setTimeout(function(){t(n)},e)}}function nnt(t){return t.split(/\s+/).filter(Boolean)}function jS(t){return[].concat(t)}function Yee(t,e){t.indexOf(e)===-1&&t.push(e)}function rnt(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function ant(t){return t.split("-")[0]}function qx(t){return[].slice.call(t)}function Kee(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function $P(){return document.createElement("div")}function c2(t){return["Element","Fragment"].some(function(e){return xK(t,e)})}function snt(t){return xK(t,"NodeList")}function ont(t){return xK(t,"MouseEvent")}function lnt(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function unt(t){return c2(t)?[t]:snt(t)?qx(t):Array.isArray(t)?t:qx(document.querySelectorAll(t))}function ZV(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function Zee(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function cnt(t){var e,i=jS(t),n=i[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function dnt(t,e){var i=e.clientX,n=e.clientY;return t.every(function(r){var a=r.popperRect,s=r.popperState,o=r.props,l=o.interactiveBorder,u=ant(s.placement),c=s.modifiersData.offset;if(!c)return!0;var d=u==="bottom"?c.top.y:0,p=u==="top"?c.bottom.y:0,h=u==="right"?c.left.x:0,f=u==="left"?c.right.x:0,m=a.top-n+d>l,g=n-a.bottom-p>l,v=a.left-i+h>l,y=i-a.right-f>l;return m||g||v||y})}function XV(t,e,i){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(r){t[n](r,i)})}function Xee(t,e){for(var i=e;i;){var n;if(t.contains(i))return!0;i=i.getRootNode==null||(n=i.getRootNode())==null?void 0:n.host}return!1}var Vf={isTouch:!1},Jee=0;function pnt(){Vf.isTouch||(Vf.isTouch=!0,window.performance&&document.addEventListener("mousemove",IPe))}function IPe(){var t=performance.now();t-Jee<20&&(Vf.isTouch=!1,document.removeEventListener("mousemove",IPe)),Jee=t}function hnt(){var t=document.activeElement;if(lnt(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function fnt(){document.addEventListener("touchstart",pnt,wI),window.addEventListener("blur",hnt)}var mnt=typeof window<"u"&&typeof document<"u",gnt=mnt?!!window.msCrypto:!1,vnt={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},ynt={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Ch=Object.assign({appendTo:yPe,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},vnt,ynt),bnt=Object.keys(Ch),Int=function(e){var i=Object.keys(e);i.forEach(function(n){Ch[n]=e[n]})};function wPe(t){var e=t.plugins||[],i=e.reduce(function(n,r){var a=r.name,s=r.defaultValue;if(a){var o;n[a]=t[a]!==void 0?t[a]:(o=Ch[a])!=null?o:s}return n},{});return Object.assign({},t,i)}function wnt(t,e){var i=e?Object.keys(wPe(Object.assign({},Ch,{plugins:e}))):bnt,n=i.reduce(function(r,a){var s=(t.getAttribute("data-tippy-"+a)||"").trim();if(!s)return r;if(a==="content")r[a]=s;else try{r[a]=JSON.parse(s)}catch{r[a]=s}return r},{});return n}function Qee(t,e){var i=Object.assign({},e,{content:bPe(e.content,[t])},e.ignoreAttributes?{}:wnt(t,e.plugins));return i.aria=Object.assign({},Ch.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var Snt=function(){return"innerHTML"};function Iz(t,e){t[Snt()]=e}function ete(t){var e=$P();return t===!0?e.className=gPe:(e.className=vPe,c2(t)?e.appendChild(t):Iz(e,t)),e}function tte(t,e){c2(e.content)?(Iz(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Iz(t,e.content):t.textContent=e.content)}function wz(t){var e=t.firstElementChild,i=qx(e.children);return{box:e,content:i.find(function(n){return n.classList.contains(mPe)}),arrow:i.find(function(n){return n.classList.contains(gPe)||n.classList.contains(vPe)}),backdrop:i.find(function(n){return n.classList.contains(int)})}}function SPe(t){var e=$P(),i=$P();i.className=tnt,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var n=$P();n.className=mPe,n.setAttribute("data-state","hidden"),tte(n,t.props),e.appendChild(i),i.appendChild(n),r(t.props,t.props);function r(a,s){var o=wz(e),l=o.box,u=o.content,c=o.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(a.content!==s.content||a.allowHTML!==s.allowHTML)&&tte(u,t.props),s.arrow?c?a.arrow!==s.arrow&&(l.removeChild(c),l.appendChild(ete(s.arrow))):l.appendChild(ete(s.arrow)):c&&l.removeChild(c)}return{popper:e,onUpdate:r}}SPe.$$tippy=!0;var Tnt=1,yA=[],JV=[];function Unt(t,e){var i=Qee(t,Object.assign({},Ch,wPe(Kee(e)))),n,r,a,s=!1,o=!1,l=!1,u=!1,c,d,p,h=[],f=Wee(se,i.interactiveDebounce),m,g=Tnt++,v=null,y=rnt(i.plugins),b={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},I={id:g,reference:t,popper:$P(),popperInstance:v,props:i,state:b,plugins:y,clearDelayTimeouts:gt,setProps:ht,setContent:_e,show:Ye,hide:Je,hideWithInteractivity:ct,enable:mt,disable:Xe,unmount:pt,destroy:Se};if(!i.render)return I;var S=i.render(I),w=S.popper,T=S.onUpdate;w.setAttribute("data-tippy-root",""),w.id="tippy-"+I.id,I.popper=w,t._tippy=I,w._tippy=I;var U=y.map(function(he){return he.fn(I)}),C=t.hasAttribute("aria-expanded");return re(),F(),x(),O("onCreate",[I]),i.showOnCreate&&at(),w.addEventListener("mouseenter",function(){I.props.interactive&&I.state.isVisible&&I.clearDelayTimeouts()}),w.addEventListener("mouseleave",function(){I.props.interactive&&I.props.trigger.indexOf("mouseenter")>=0&&N().addEventListener("mousemove",f)}),I;function E(){var he=I.props.touch;return Array.isArray(he)?he:[he,0]}function P(){return E()[0]==="hold"}function M(){var he;return!!((he=I.props.render)!=null&&he.$$tippy)}function R(){return m||t}function N(){var he=R().parentNode;return he?cnt(he):document}function A(){return wz(w)}function _(he){return I.state.isMounted&&!I.state.isVisible||Vf.isTouch||c&&c.type==="focus"?0:KV(I.props.delay,he?0:1,Ch.delay)}function x(he){he===void 0&&(he=!1),w.style.pointerEvents=I.props.interactive&&!he?"":"none",w.style.zIndex=""+I.props.zIndex}function O(he,we,be){if(be===void 0&&(be=!0),U.forEach(function(ze){ze[he]&&ze[he].apply(ze,we)}),be){var Ae;(Ae=I.props)[he].apply(Ae,we)}}function $(){var he=I.props.aria;if(he.content){var we="aria-"+he.content,be=w.id,Ae=jS(I.props.triggerTarget||t);Ae.forEach(function(ze){var We=ze.getAttribute(we);if(I.state.isVisible)ze.setAttribute(we,We?We+" "+be:be);else{var Le=We&&We.replace(be,"").trim();Le?ze.setAttribute(we,Le):ze.removeAttribute(we)}})}}function F(){if(!(C||!I.props.aria.expanded)){var he=jS(I.props.triggerTarget||t);he.forEach(function(we){I.props.interactive?we.setAttribute("aria-expanded",I.state.isVisible&&we===R()?"true":"false"):we.removeAttribute("aria-expanded")})}}function j(){N().removeEventListener("mousemove",f),yA=yA.filter(function(he){return he!==f})}function H(he){if(!(Vf.isTouch&&(l||he.type==="mousedown"))){var we=he.composedPath&&he.composedPath()[0]||he.target;if(!(I.props.interactive&&Xee(w,we))){if(jS(I.props.triggerTarget||t).some(function(be){return Xee(be,we)})){if(Vf.isTouch||I.state.isVisible&&I.props.trigger.indexOf("click")>=0)return}else O("onClickOutside",[I,he]);I.props.hideOnClick===!0&&(I.clearDelayTimeouts(),I.hide(),o=!0,setTimeout(function(){o=!1}),I.state.isMounted||Z())}}}function G(){l=!0}function W(){l=!1}function q(){var he=N();he.addEventListener("mousedown",H,!0),he.addEventListener("touchend",H,wI),he.addEventListener("touchstart",W,wI),he.addEventListener("touchmove",G,wI)}function Z(){var he=N();he.removeEventListener("mousedown",H,!0),he.removeEventListener("touchend",H,wI),he.removeEventListener("touchstart",W,wI),he.removeEventListener("touchmove",G,wI)}function K(he,we){J(he,function(){!I.state.isVisible&&w.parentNode&&w.parentNode.contains(w)&&we()})}function Q(he,we){J(he,we)}function J(he,we){var be=A().box;function Ae(ze){ze.target===be&&(XV(be,"remove",Ae),we())}if(he===0)return we();XV(be,"remove",d),XV(be,"add",Ae),d=Ae}function ne(he,we,be){be===void 0&&(be=!1);var Ae=jS(I.props.triggerTarget||t);Ae.forEach(function(ze){ze.addEventListener(he,we,be),h.push({node:ze,eventType:he,handler:we,options:be})})}function re(){P()&&(ne("touchstart",de,{passive:!0}),ne("touchend",ge,{passive:!0})),nnt(I.props.trigger).forEach(function(he){if(he!=="manual")switch(ne(he,de),he){case"mouseenter":ne("mouseleave",ge);break;case"focus":ne(gnt?"focusout":"blur",ye);break;case"focusin":ne("focusout",ye);break}})}function oe(){h.forEach(function(he){var we=he.node,be=he.eventType,Ae=he.handler,ze=he.options;we.removeEventListener(be,Ae,ze)}),h=[]}function de(he){var we,be=!1;if(!(!I.state.isEnabled||Te(he)||o)){var Ae=((we=c)==null?void 0:we.type)==="focus";c=he,m=he.currentTarget,F(),!I.state.isVisible&&ont(he)&&yA.forEach(function(ze){return ze(he)}),he.type==="click"&&(I.props.trigger.indexOf("mouseenter")<0||s)&&I.props.hideOnClick!==!1&&I.state.isVisible?be=!0:at(he),he.type==="click"&&(s=!be),be&&!Ae&&Fe(he)}}function se(he){var we=he.target,be=R().contains(we)||w.contains(we);if(!(he.type==="mousemove"&&be)){var Ae=Oe().concat(w).map(function(ze){var We,Le=ze._tippy,ft=(We=Le.popperInstance)==null?void 0:We.state;return ft?{popperRect:ze.getBoundingClientRect(),popperState:ft,props:i}:null}).filter(Boolean);dnt(Ae,he)&&(j(),Fe(he))}}function ge(he){var we=Te(he)||I.props.trigger.indexOf("click")>=0&&s;if(!we){if(I.props.interactive){I.hideWithInteractivity(he);return}Fe(he)}}function ye(he){I.props.trigger.indexOf("focusin")<0&&he.target!==R()||I.props.interactive&&he.relatedTarget&&w.contains(he.relatedTarget)||Fe(he)}function Te(he){return Vf.isTouch?P()!==he.type.indexOf("touch")>=0:!1}function De(){xe();var he=I.props,we=he.popperOptions,be=he.placement,Ae=he.offset,ze=he.getReferenceClientRect,We=he.moveTransition,Le=M()?wz(w).arrow:null,ft=ze?{getBoundingClientRect:ze,contextElement:ze.contextElement||R()}:t,rt={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Qe){var bt=Qe.state;if(M()){var ci=A(),Tt=ci.box;["placement","reference-hidden","escaped"].forEach(function(Li){Li==="placement"?Tt.setAttribute("data-placement",bt.placement):bt.attributes.popper["data-popper-"+Li]?Tt.setAttribute("data-"+Li,""):Tt.removeAttribute("data-"+Li)}),bt.attributes.popper={}}}},St=[{name:"offset",options:{offset:Ae}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!We}},rt];M()&&Le&&St.push({name:"arrow",options:{element:Le,padding:3}}),St.push.apply(St,we?.modifiers||[]),I.popperInstance=ent(ft,w,Object.assign({},we,{placement:be,onFirstUpdate:p,modifiers:St}))}function xe(){I.popperInstance&&(I.popperInstance.destroy(),I.popperInstance=null)}function Me(){var he=I.props.appendTo,we,be=R();I.props.interactive&&he===yPe||he==="parent"?we=be.parentNode:we=bPe(he,[be]),we.contains(w)||we.appendChild(w),I.state.isMounted=!0,De()}function Oe(){return qx(w.querySelectorAll("[data-tippy-root]"))}function at(he){I.clearDelayTimeouts(),he&&O("onTrigger",[I,he]),q();var we=_(!0),be=E(),Ae=be[0],ze=be[1];Vf.isTouch&&Ae==="hold"&&ze&&(we=ze),we?n=setTimeout(function(){I.show()},we):I.show()}function Fe(he){if(I.clearDelayTimeouts(),O("onUntrigger",[I,he]),!I.state.isVisible){Z();return}if(!(I.props.trigger.indexOf("mouseenter")>=0&&I.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(he.type)>=0&&s)){var we=_(!1);we?r=setTimeout(function(){I.state.isVisible&&I.hide()},we):a=requestAnimationFrame(function(){I.hide()})}}function mt(){I.state.isEnabled=!0}function Xe(){I.hide(),I.state.isEnabled=!1}function gt(){clearTimeout(n),clearTimeout(r),cancelAnimationFrame(a)}function ht(he){if(!I.state.isDestroyed){O("onBeforeUpdate",[I,he]),oe();var we=I.props,be=Qee(t,Object.assign({},we,Kee(he),{ignoreAttributes:!0}));I.props=be,re(),we.interactiveDebounce!==be.interactiveDebounce&&(j(),f=Wee(se,be.interactiveDebounce)),we.triggerTarget&&!be.triggerTarget?jS(we.triggerTarget).forEach(function(Ae){Ae.removeAttribute("aria-expanded")}):be.triggerTarget&&t.removeAttribute("aria-expanded"),F(),x(),T&&T(we,be),I.popperInstance&&(De(),Oe().forEach(function(Ae){requestAnimationFrame(Ae._tippy.popperInstance.forceUpdate)})),O("onAfterUpdate",[I,he])}}function _e(he){I.setProps({content:he})}function Ye(){var he=I.state.isVisible,we=I.state.isDestroyed,be=!I.state.isEnabled,Ae=Vf.isTouch&&!I.props.touch,ze=KV(I.props.duration,0,Ch.duration);if(!(he||we||be||Ae)&&!R().hasAttribute("disabled")&&(O("onShow",[I],!1),I.props.onShow(I)!==!1)){if(I.state.isVisible=!0,M()&&(w.style.visibility="visible"),x(),q(),I.state.isMounted||(w.style.transition="none"),M()){var We=A(),Le=We.box,ft=We.content;ZV([Le,ft],0)}p=function(){var St;if(!(!I.state.isVisible||u)){if(u=!0,w.offsetHeight,w.style.transition=I.props.moveTransition,M()&&I.props.animation){var si=A(),Qe=si.box,bt=si.content;ZV([Qe,bt],ze),Zee([Qe,bt],"visible")}$(),F(),Yee(JV,I),(St=I.popperInstance)==null||St.forceUpdate(),O("onMount",[I]),I.props.animation&&M()&&Q(ze,function(){I.state.isShown=!0,O("onShown",[I])})}},Me()}}function Je(){var he=!I.state.isVisible,we=I.state.isDestroyed,be=!I.state.isEnabled,Ae=KV(I.props.duration,1,Ch.duration);if(!(he||we||be)&&(O("onHide",[I],!1),I.props.onHide(I)!==!1)){if(I.state.isVisible=!1,I.state.isShown=!1,u=!1,s=!1,M()&&(w.style.visibility="hidden"),j(),Z(),x(!0),M()){var ze=A(),We=ze.box,Le=ze.content;I.props.animation&&(ZV([We,Le],Ae),Zee([We,Le],"hidden"))}$(),F(),I.props.animation?M()&&K(Ae,I.unmount):I.unmount()}}function ct(he){N().addEventListener("mousemove",f),Yee(yA,f),f(he)}function pt(){I.state.isVisible&&I.hide(),I.state.isMounted&&(xe(),Oe().forEach(function(he){he._tippy.unmount()}),w.parentNode&&w.parentNode.removeChild(w),JV=JV.filter(function(he){return he!==I}),I.state.isMounted=!1,O("onHidden",[I]))}function Se(){I.state.isDestroyed||(I.clearDelayTimeouts(),I.unmount(),oe(),delete t._tippy,I.state.isDestroyed=!0,O("onDestroy",[I]))}}function hv(t,e){e===void 0&&(e={});var i=Ch.plugins.concat(e.plugins||[]);fnt();var n=Object.assign({},e,{plugins:i}),r=unt(t),a=r.reduce(function(s,o){var l=o&&Unt(o,n);return l&&s.push(l),s},[]);return c2(t)?a[0]:a}hv.defaultProps=Ch;hv.setDefaultProps=Int;hv.currentInput=Vf;Object.assign({},oPe,{effect:function(e){var i=e.state,n={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,n.popper),i.styles=n,i.elements.arrow&&Object.assign(i.elements.arrow.style,n.arrow)}});hv.setDefaultProps({render:SPe});function ite(t){const e=document.createElement("button");return e.className="button font-medium",t.disabled&&(e.disabled=!0),t.class&&e.classList.add(t.class),t.id&&(e.id=t.id),t.location===ti?e.style.marginLeft="1em":e.style.marginRight="1em",t.intent&&e.classList.add(t.intent),t.toolTip?.content&&hv(e,t.toolTip),e.innerHTML=t.label,t.visible===!1&&(e.style.display=Rt),e}const OK=({target:t})=>(e=[])=>{t.style.backgroundColor=e?.length?"lightgray":WT;const i=(n,r,a)=>{const s=t.getElementsByClassName(`options_${n}`)[0];s&&(s.style.display=e?.length?r:a)};i(ba,lA,Rt),i(hi,Rt,lA),i(di,Rt,lA),i(ti,Rt,lA)};function wo(t){const{table:e,targetClassName:i,items:n=[],onSelection:r}=t;let{target:a}=t;const s=!!a;if(!a&&i&&(a=document.getElementsByClassName(i)?.[0]),!a)return{elements:{},inputs:{}};let o=0,l=0;const u={},c={};let d;if(s){Js(a);const v=Dnt();Object.assign(u,v.elements),a.appendChild(v.anchor)}const p=Object.assign({},...[ba,hi,di,ti,Hk].map(v=>{const y=a.getElementsByClassName(`options_${v}`)?.[0];return Js(y),{[v]:y}}).filter(Boolean)),h=OK({target:a}),f=(v,y)=>{Mt(y.onClick)&&(v.stopPropagation(),y.disabled||y.onClick(v,e),y.stateChange&&h())},m={onClick:()=>{},location:ti};for(const v of n){const y={...m};kp(v)&&Object.assign(y,v);const b=p[y.location];if(!b){console.log(y.location,p);continue}if(y.location===ba&&(o+=1),y.location===Hk){if(Mt(y.headerClick)){const I=a.getElementsByClassName("panelHeader")[0];I&&(I.onclick=y.headerClick)}l+=1}if(!y.hide&&(y.input||y.placeholder||y.search)){const I=document.createElement("p");I.style.cssText="margin-right: 1em",I.className=`control ${y.search?"has-icons-left has-icons-right":""}`;const S=document.createElement("input");if(y.focus&&(d=S),S.className="input font-medium",S.setAttribute("type","text"),S.setAttribute("autocomplete","off"),S.setAttribute("placeholder",v.placeholder||WT),y.id&&(c[y.id]=S),y.id&&S.setAttribute("id",y.id),y.onKeyDown&&S.addEventListener("keydown",w=>y.onKeyDown(w,y)),y.onChange&&S.addEventListener("change",w=>y.onChange(w,y)),y.onKeyUp&&S.addEventListener("keyup",w=>{y.clearSearch&&w.key==="Escape"&&(w.stopPropagation(),S.value="",y.clearSearch()),y.onKeyUp(w,y)}),y.class&&S.classList.add(y.class),y.visible===!1&&(I.style.display=Rt),y.value&&(S.value=y.value),I.appendChild(S),y.search){const w=document.createElement("span");if(w.className="icon is-small is-left font-medium",w.innerHTML='<i class="fa-solid fa-magnifying-glass"></i>',I.appendChild(w),Mt(y.clearSearch)){const T=document.createElement("span");T.className="icon is-small is-right font-medium",T.innerHTML='<i class="fa-solid fa-circle-xmark" style="color: #dddada; pointer-events: all; cursor: pointer"></i>',T.onclick=U=>{U.stopPropagation(),S.value="",y.clearSearch()},I.appendChild(T)}}if(v.validator){const w=document.createElement("p");w.className="help font-medium",I.appendChild(w),S.addEventListener("input",T=>fve(v,T,S,w,v.validator))}y.id&&(u[y.id]=I,I.id=y.id),b?.appendChild(I);continue}if(!y.hide&&y.text){const I=document.createElement("div");I.className="font-medium",y.id&&(u[y.id]=I,I.id=y.id),I.innerHTML=y.text,I.onclick=S=>f(S,y),b?.appendChild(I);continue}if(!(!y.id&&(!y?.label||y.hide))){if(y.options){const I=hz({target:b,button:y,stateChange:h});y.visible===!1&&(I.style.display=Rt),y.id&&(u[y.id]=I)}else if(kp(y.selection)){const{selection:{options:I,actions:S},actionPlacement:w,threshold:T=8,...U}=y;if(I?.length<T){I.length&&(w===bJ?I.unshift({divider:!0}):I.push({divider:!0})),S.forEach(P=>{const{label:M,...R}=P,N={...R,label:`<p style="font-weight: bold">${M}</p>`};w===bJ?I.unshift(N):I.push(N)});const C={...U,options:I},E=hz({target:b,button:C,stateChange:h});C.visible===!1&&(E.style.display=Rt),C.id&&(u[y.id]=E)}else{const C=ite(y);C.onclick=E=>{E.stopPropagation(),PK({title:"Select team",options:I})},y.id&&(u[y.id]=C),b?.appendChild(C)}}else if(y.tabs){const I=document.createElement("div");I.className="tabs is-toggle is-toggle-rounded";const S=document.createElement("ul");I.appendChild(S),y.tabs.forEach(w=>{const T=document.createElement("li");w.active&&T.classList.add("is-active");const U=document.createElement("a");T.appendChild(U),U.onclick=E=>{S.querySelectorAll("li").forEach(P=>P.classList.remove("is-active")),T.classList.add("is-active"),Mt(w.onClick)&&w.onClick(E,y)};const C=document.createElement("span");C.innerHTML=w.label,U.appendChild(C),S.appendChild(T)}),y.id&&(u[y.id]=I),b.appendChild(I)}else{const I=ite(y);I.onclick=S=>f(S,y),y.id&&(u[y.id]=I),b?.appendChild(I)}(!(y?.label||y.tabs)||y.hide)&&u[y.id]&&(u[y.id].style.display=Rt)}}const g=a.getElementsByClassName("panelHeader")[0];return g&&(g.style.display=l?WT:Rt),e?.on("rowSelectionChanged",(v,y)=>{Mt(r)&&r(y),o&&h(y)}),h(),d&&setTimeout(()=>d.focus(),200),{elements:u,inputs:c}}function Dnt(){const t=document.createElement("div");t.className="panel_container flexcol flexcenter";const e=document.createElement("div");e.className="panelHeader options_header",e.style.display=Rt,t.appendChild(e);const i=document.createElement("div");i.className=fge;const n={optionsOverlay:document.createElement("div"),optionsLeft:document.createElement("div"),optionsCenter:document.createElement("div"),optionsRight:document.createElement("div")};n.optionsOverlay.className="options_overlay",n.optionsCenter.className="options_center",n.optionsRight.className="options_right",n.optionsLeft.className="options_left";for(const r of Object.values(n))i.appendChild(r);return t.appendChild(i),{elements:n,anchor:t,header:e}}const{FIRST_MATCH_LOSER_CONSOLATION:Ent,COMPASS:Pnt,ROUND_ROBIN:Cnt}=Zr,{MALE:Rnt,FEMALE:Mnt}=Uo.genderConstants,{DOUBLES:nte}=Uo.eventConstants,{WTN:bA}=Uo.ratingConstants;function Nnt(t){const e=t.getData().map(n=>n.tournamentId),i=Ant();for(const n of i)PN({tournamentRecord:n,tournamentIds:e,table:t});return{...iM}}function Ant(){const e=[{venueName:"Super Fast Courts",venueAbbreviation:"SFC",startTime:"08:00",endTime:"20:00",courtsCount:8}];return[{tournamentAttributes:{tournamentId:"tournament-id-1"},participantsProfile:{scaledParticipantsCount:200,idPrefix:"p"},tournamentName:"CourtHive Challenge",drawProfiles:[{category:{categoryName:"U18"},eventName:"U18 Boys Doubles",eventId:"event-id-1",drawId:"draw-id-1",eventType:nte,gender:Rnt,seedsCount:4,drawSize:16},{drawType:Ent,category:{categoryName:"U16"},eventName:"U16 Girls Singles",eventId:"event-id-2",drawId:"draw-id-2",gender:Mnt,seedsCount:8,drawSize:32},{category:{ratingType:bA,ratingMin:18,ratingMax:24.99},eventName:"WTN 18-25 SINGLES",scaledParticipantsCount:32,eventId:"event-id-3",drawId:"draw-id-3",seedsCount:8,drawSize:32},{category:{ratingType:bA,ratingMin:18,ratingMax:24.99},eventName:"WTN 18-25 DOUBLES",scaledParticipantsCount:32,eventId:"event-id-4",drawId:"draw-id-4",eventType:nte,seedsCount:8,drawSize:32}],venueProfiles:e},{tournamentAttributes:{tournamentId:"tournament-id-02"},participantsProfile:{idPrefix:"p"},tournamentName:"Level Based Play",drawProfiles:[{eventName:"WTN 14-19 SINGLES",category:{ratingType:bA,ratingMin:14,ratingMax:19.99},scaledParticipantsCount:32,eventId:"event-id-1",drawId:"draw-id-1",drawType:Pnt,seedsCount:8,drawSize:32},{eventName:"WTN 20-26 SINGLES",category:{ratingType:bA,ratingMin:20,ratingMax:25.99},scaledParticipantsCount:16,drawType:Cnt,eventId:"event-id-2",drawId:"draw-id-2",seedsCount:4,drawSize:16}],venueProfiles:e}].map(n=>tM.generateTournamentRecord(n).tournamentRecord)}function _nt(t){const e=tc(),i=e?.roles?.includes(HF),n=e?.services?.includes("tournamentProfile"),r=[{label:"Create new tournament",onClick:()=>ZEe({table:t})},{label:"Import tournament",onClick:()=>wJe({table:t})},n&&{label:"Fetch tournament",onClick:()=>SJe({table:t})},i&&{label:"Load by ID",onClick:()=>TJe({table:t})},{divider:!0},{divider:!0},{label:"Example tournaments",onClick:()=>Nnt(t),close:!0}].filter(Boolean),a=Q0(t),s=[{label:"Actions",options:r,align:ti},{onKeyDown:l=>l.key==="Backspace"&&l.target.value.length===1&&a(""),onChange:l=>a(l.target.value),onKeyUp:l=>a(l.target.value),clearSearch:()=>a(""),placeholder:"Search tournaments",id:"tournamentSearch",location:hi,search:!0}],o=document.getElementById(hge)||void 0;wo({target:o,items:s})}const knt=t=>e=>{const i=document.createElement("table"),n=e.getValue();i.style.width="400px";const r="4em",a=document.createElement("tr");if(n.offline){const u=e.getRow().getElement();u.style.backgroundColor="lightyellow"}const s=n.tournamentImageURL?`<img src='${n.tournamentImageURL}' style='width: ${r}' alt=''>`:"",o=(t?"":`<td style='min-width: ${r};'>${s}</td>`)+`<td><div style='margin-left: 1em'><strong style='font-size: 1.5em'>${n.tournamentName}</strong></div><div style='margin-left: 1em'>${n.startDate} / ${n.endDate}</div></td>`;a.innerHTML=o,i.appendChild(a);const l=document.createElement("span");return l.appendChild(i),l};function xnt({providerId:t,tournamentId:e}){const i=()=>It.router.navigate(`/tournaments/${e}`),n=r=>{r&&(r.calendar=r.calendar.filter(a=>a.tournamentId!==e),Hu.addProvider(r).then(i))};Hu.findProvider(t).then(n)}function Ont(t,e,i){if(!t)return{};const n=document.createElement("aside");n.classList.add("menu");const r={},a=d=>p=>{p.stopPropagation(),d.onClick()};let s=0;const o=()=>(s+=1,s),l=d=>d?.heading||d?.text||d?.label||`Item ${o()}`,u=d=>{const p=document.createElement("li");if(p.className="font-medium",d.style&&(p.style.cssText=d.style),d.onClick){const h=d.fontSize||"1em";if(d.divider){const f=document.createElement("hr");f.classList.add("dropdown-divider"),p.appendChild(f)}else{const f=document.createElement("a"),m=d.disabled?"0.4":"1";f.style.cssText=`text-decoration: none; opacity: ${m}; font-size: ${h}`,d.class&&f.classList.add(d.class),d.color&&(f.style.color=d.color),d.heading&&(f.style.fontWeight="bold"),d.disabled||(f.onclick=a(d)),f.innerHTML=l(d),p.appendChild(f)}}else p.innerHTML=l(d),d.disabled||(p.onclick=d.onClick);return p};let c;for(const d of e||[])if(!d.hide){if(d.items){if(d.text){const h=document.createElement("p");h.className="menu-label font-medium",h.innerHTML=d.text,n.appendChild(h)}const p=document.createElement("ul");p.className="menu-list";for(const h of d.items)h.hide||p.appendChild(u(h));n.appendChild(p)}else if(d.type==="input"){const{field:p,inputElement:h}=UP(d);d.focus&&(c=h),r[d.field]=h,n.appendChild(p)}else if(d.type==="divider"){const p=document.createElement("hr");p.classList.add("dropdown-divider"),n.appendChild(p)}}return t.appendChild(n),{focusElement:c}}let vy;function Nd(t){vy&&(vy?.destroy(!0),vy=void 0),t?.remove&&t.remove()}function Pu(t){const{title:e,options:i,menuItems:n=[],coords:r,callback:a,config:s}=t;let{target:o,items:l}=t;if(!i?.length&&!l?.length&&!n)return;Nd();const u=document.createElement("div");let c;const d=()=>{l=l?.filter(f=>!f.hide&&!f.disabled).map(f=>({...f,onClick:()=>{Nd(u),Mt(f.onClick)&&f.onClick()}}))||i?.filter(f=>!f.hide&&!f.disabled).map(f=>({text:typeof f=="object"?f.option:f,style:f.style,onClick:()=>{f.subMenu?vy.setContent("IMPLEMENT SUB MENU"):Mt(f.onClick)?(Nd(u),f.onClick()):Mt(a)&&a&&(Nd(u),a(typeof f=="object"?{...f,coords:r}:f))}}));const p=[{text:e,items:l},...n];return c=Ont(u,p).focusElement,u};return o=o||r?.evt?.target,o&&(vy=hv(o,{content:d,theme:"light-border",trigger:"click",onShown:()=>{c&&setTimeout(()=>c?.focus(),0)},...s}),vy.show(),vy.setProps({interactive:!0})),vy}const Lnt=(t,e,i)=>{t.delete(),i&&xnt({tournamentId:e,providerId:i})},Fnt=(t,e)=>Hu.deleteTournament(t).then(e,i=>console.log(i)),$nt=(t,e)=>{const i=t.getRow(),n=tc()?.providerId||i.getData().providerId,r=()=>Lnt(i,e,n),a=()=>Fnt(e,r);tc()?.provider||It?.provider?$He({providerId:n,tournamentId:e}).then(a,l=>console.log(l)):a()},Bnt=t=>e=>{const i=document.createElement("span");i.style.width="100%";const n=e.getValue(),r=()=>$nt(e,n),a=()=>{const c=`<div style='font-size: 2em'>${e.getTable().getData().find(p=>p.tournamentId===n).tournament.tournamentName} will be deleted!</div>`,d=[{onClick:r,intent:"is-danger",label:"Delete",close:!0},{label:"Cancel"}];Yn({title:_s.tr("actions.delete_tournament"),buttons:d,content:c})},s=()=>Vnt({table:e.getTable(),tournamentId:n}),o=document.createElement("span");return o.innerHTML="<i class='fa fa-ellipsis-vertical'></i>",i.onclick=l=>{l.stopPropagation(),Pu({target:o,items:[{text:"Delete",onClick:a},{text:"Edit",onClick:s}],config:{placement:Gp}})},i.appendChild(o),i};function Vnt({tournamentId:t,table:e}){const n=tc()?.provider,r=()=>{Ht({message:"Tournament not found",onClose:()=>{It.router.navigate("/tournaments")},intent:"is-warning",pauseOnHover:!0})},a=o=>{o?ZEe({table:e,tournamentRecord:o}):r()},s=o=>{const l=o?.data?.tournamentRecords?.[t];a(l)};n?JF({tournamentId:t}).then(s,o=>console.log(o)):Hu.findTournament(t).then(a,o=>console.log(o))}function jnt(t){const e=/Mobile/.test(navigator.userAgent),i=(n,r)=>{const a=r.getRow().getData().tournamentId;if(a){nt.reset();const s=`/${As}/${a}`;It.router.navigate(s)}};return[{formatter:knt(e),cellClick:i,field:"tournament",headerSort:!1,resizable:!0,minWidth:250,widthGrow:3},{formatter:()=>'<div class="button font-medium">Open</div>',cellClick:i,vertAlign:"middle",visible:!e,title:"Open",width:90},{formatter:Bnt(),field:"tournamentId",vertAlign:"middle",headerSort:!1,hozAlign:ti,width:10}]}function ng({anchorId:t}){const e=Bs.findTable(`#${t}`)[0];e&&e.destroy()}function d2(){if(It.tables)for(const t of Object.keys(It.tables))It.tables[t]?.destroy(),delete It.tables[t];for(;(It.collectionTables||[]).length;)It.collectionTables?.pop()?.destroy()}function TPe(){const t=c=>console.log("db Error",{error:c}),e=document.getElementById("dnav");e&&(e.style.backgroundColor="");let i;const n=jnt(),r=c=>{ng({anchorId:iH});const d=document.getElementById(iH);i=new Bs(d,{height:window.innerHeight*.85,placeholder:"No tournaments",layout:"fitColumns",index:"tournamentId",headerVisible:!1,reactiveData:!0,data:c,columns:n}),i.on("tableBuilt",()=>_nt(i)),i.on("scrollVertical",Nd)},a=c=>{c.sort((d,p)=>new Date(p.startDate||p.start).getTime()-new Date(d.startDate||d.start).getTime()),r(c.map(a2))},s=({tournaments:c,provider:d})=>{const h=[...c].sort((f,m)=>new Date(m.tournament.startDate).getTime()-new Date(f.tournament.startDate).getTime()).map(f=>{const m=f.tournament.timeItemValues?.TMX?.offline;f.tournament.offline=m;const g=f.tournament.onlineResources?.find(({name:v,resourceType:y})=>v==="tournamentImage"&&y==="URL")?.identifier;return g&&(f.tournament.tournamentImageURL=g),{...f,provider:d}});r(h)},l=tc()?.provider||It?.provider,u=()=>Hu.findAllTournaments().then(a,t);if(l?.organisationAbbreviation){const c=d=>{d?.data?.calendar?s(d.data.calendar):u()};LHe({providerAbbr:l.organisationAbbreviation}).then(c)}else u();return{table:i}}const UPe="leaveTournament",Gnt="providerCalendar",Hnt="processDirective",znt="tmxDirective",qnt="tmxMessage";function DPe(t){const e=$Ee({data:t}),{directive:i,content:n}=e||{};i&&(i===Gnt&&n.calendar&&Ht({action:{onClick:()=>Wnt({providerId:n.providerId,calendar:n.calendar}),text:"Load"},message:"Calendar Received",duration:!1}),i.subKey&&It.ee.emit("sendKey",i.subKey))}function Wnt({providerId:t,calendar:e}){const i=()=>TPe();t&&e&&Hu.addProvider({providerId:t,calendar:e}).then(i)}const xm=Object.create(null);xm.open="0";xm.close="1";xm.ping="2";xm.pong="3";xm.message="4";xm.upgrade="5";xm.noop="6";const B_=Object.create(null);Object.keys(xm).forEach(t=>{B_[xm[t]]=t});const Sz={type:"error",data:"parser error"},EPe=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",PPe=typeof ArrayBuffer=="function",CPe=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,LK=({type:t,data:e},i,n)=>EPe&&e instanceof Blob?i?n(e):rte(e,n):PPe&&(e instanceof ArrayBuffer||CPe(e))?i?n(e):rte(new Blob([e]),n):n(xm[t]+(e||"")),rte=(t,e)=>{const i=new FileReader;return i.onload=function(){const n=i.result.split(",")[1];e("b"+(n||""))},i.readAsDataURL(t)};function ate(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let QV;function Ynt(t,e){if(EPe&&t.data instanceof Blob)return t.data.arrayBuffer().then(ate).then(e);if(PPe&&(t.data instanceof ArrayBuffer||CPe(t.data)))return e(ate(t.data));LK(t,!1,i=>{QV||(QV=new TextEncoder),e(QV.encode(i))})}const ste="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",WE=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<ste.length;t++)WE[ste.charCodeAt(t)]=t;const Knt=t=>{let e=t.length*.75,i=t.length,n,r=0,a,s,o,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const u=new ArrayBuffer(e),c=new Uint8Array(u);for(n=0;n<i;n+=4)a=WE[t.charCodeAt(n)],s=WE[t.charCodeAt(n+1)],o=WE[t.charCodeAt(n+2)],l=WE[t.charCodeAt(n+3)],c[r++]=a<<2|s>>4,c[r++]=(s&15)<<4|o>>2,c[r++]=(o&3)<<6|l&63;return u},Znt=typeof ArrayBuffer=="function",FK=(t,e)=>{if(typeof t!="string")return{type:"message",data:RPe(t,e)};const i=t.charAt(0);return i==="b"?{type:"message",data:Xnt(t.substring(1),e)}:B_[i]?t.length>1?{type:B_[i],data:t.substring(1)}:{type:B_[i]}:Sz},Xnt=(t,e)=>{if(Znt){const i=Knt(t);return RPe(i,e)}else return{base64:!0,data:t}},RPe=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},MPe="",Jnt=(t,e)=>{const i=t.length,n=new Array(i);let r=0;t.forEach((a,s)=>{LK(a,!1,o=>{n[s]=o,++r===i&&e(n.join(MPe))})})},Qnt=(t,e)=>{const i=t.split(MPe),n=[];for(let r=0;r<i.length;r++){const a=FK(i[r],e);if(n.push(a),a.type==="error")break}return n};function ert(){return new TransformStream({transform(t,e){Ynt(t,i=>{const n=i.length;let r;if(n<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,n);else if(n<65536){r=new Uint8Array(3);const a=new DataView(r.buffer);a.setUint8(0,126),a.setUint16(1,n)}else{r=new Uint8Array(9);const a=new DataView(r.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(n))}t.data&&typeof t.data!="string"&&(r[0]|=128),e.enqueue(r),e.enqueue(i)})}})}let ej;function IA(t){return t.reduce((e,i)=>e+i.length,0)}function wA(t,e){if(t[0].length===e)return t.shift();const i=new Uint8Array(e);let n=0;for(let r=0;r<e;r++)i[r]=t[0][n++],n===t[0].length&&(t.shift(),n=0);return t.length&&n<t[0].length&&(t[0]=t[0].slice(n)),i}function trt(t,e){ej||(ej=new TextDecoder);const i=[];let n=0,r=-1,a=!1;return new TransformStream({transform(s,o){for(i.push(s);;){if(n===0){if(IA(i)<1)break;const l=wA(i,1);a=(l[0]&128)===128,r=l[0]&127,r<126?n=3:r===126?n=1:n=2}else if(n===1){if(IA(i)<2)break;const l=wA(i,2);r=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),n=3}else if(n===2){if(IA(i)<8)break;const l=wA(i,8),u=new DataView(l.buffer,l.byteOffset,l.length),c=u.getUint32(0);if(c>Math.pow(2,21)-1){o.enqueue(Sz);break}r=c*Math.pow(2,32)+u.getUint32(4),n=3}else{if(IA(i)<r)break;const l=wA(i,r);o.enqueue(FK(a?l:ej.decode(l),e)),n=0}if(r===0||r>t){o.enqueue(Sz);break}}}})}const NPe=4;function so(t){if(t)return irt(t)}function irt(t){for(var e in so.prototype)t[e]=so.prototype[e];return t}so.prototype.on=so.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};so.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this};so.prototype.off=so.prototype.removeListener=so.prototype.removeAllListeners=so.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var i=this._callbacks["$"+t];if(!i)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var n,r=0;r<i.length;r++)if(n=i[r],n===e||n.fn===e){i.splice(r,1);break}return i.length===0&&delete this._callbacks["$"+t],this};so.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),i=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(i){i=i.slice(0);for(var n=0,r=i.length;n<r;++n)i[n].apply(this,e)}return this};so.prototype.emitReserved=so.prototype.emit;so.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};so.prototype.hasListeners=function(t){return!!this.listeners(t).length};const p2=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,i)=>i(e,0),gp=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),nrt="arraybuffer";function APe(t,...e){return e.reduce((i,n)=>(t.hasOwnProperty(n)&&(i[n]=t[n]),i),{})}const rrt=gp.setTimeout,art=gp.clearTimeout;function h2(t,e){e.useNativeTimers?(t.setTimeoutFn=rrt.bind(gp),t.clearTimeoutFn=art.bind(gp)):(t.setTimeoutFn=gp.setTimeout.bind(gp),t.clearTimeoutFn=gp.clearTimeout.bind(gp))}const srt=1.33;function ort(t){return typeof t=="string"?lrt(t):Math.ceil((t.byteLength||t.size)*srt)}function lrt(t){let e=0,i=0;for(let n=0,r=t.length;n<r;n++)e=t.charCodeAt(n),e<128?i+=1:e<2048?i+=2:e<55296||e>=57344?i+=3:(n++,i+=4);return i}function _Pe(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function urt(t){let e="";for(let i in t)t.hasOwnProperty(i)&&(e.length&&(e+="&"),e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e}function crt(t){let e={},i=t.split("&");for(let n=0,r=i.length;n<r;n++){let a=i[n].split("=");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return e}class drt extends Error{constructor(e,i,n){super(e),this.description=i,this.context=n,this.type="TransportError"}}class $K extends so{constructor(e){super(),this.writable=!1,h2(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,i,n){return super.emitReserved("error",new drt(e,i,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const i=FK(e,this.socket.binaryType);this.onPacket(i)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,i={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(i)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const i=urt(e);return i.length?"?"+i:""}}class prt extends $K{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const i=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let n=0;this._polling&&(n++,this.once("pollComplete",function(){--n||i()})),this.writable||(n++,this.once("drain",function(){--n||i()}))}else i()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const i=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};Qnt(e,this.socket.binaryType).forEach(i),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Jnt(e,i=>{this.doWrite(i,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",i=this.query||{};return this.opts.timestampRequests!==!1&&(i[this.opts.timestampParam]=_Pe()),!this.supportsBinary&&!i.sid&&(i.b64=1),this.createUri(e,i)}}let kPe=!1;try{kPe=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const hrt=kPe;function frt(){}class mrt extends prt{constructor(e){if(super(e),typeof location<"u"){const i=location.protocol==="https:";let n=location.port;n||(n=i?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,i){const n=this.request({method:"POST",data:e});n.on("success",i),n.on("error",(r,a)=>{this.onError("xhr post error",r,a)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(i,n)=>{this.onError("xhr poll error",i,n)}),this.pollXhr=e}}class om extends so{constructor(e,i,n){super(),this.createRequest=e,h2(this,n),this._opts=n,this._method=n.method||"GET",this._uri=i,this._data=n.data!==void 0?n.data:null,this._create()}_create(){var e;const i=APe(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");i.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(i);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let r in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(r)&&n.setRequestHeader(r,this._opts.extraHeaders[r])}}catch{}if(this._method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var r;n.readyState===3&&((r=this._opts.cookieJar)===null||r===void 0||r.parseCookies(n.getResponseHeader("set-cookie"))),n.readyState===4&&(n.status===200||n.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof n.status=="number"?n.status:0)},0))},n.send(this._data)}catch(r){this.setTimeoutFn(()=>{this._onError(r)},0);return}typeof document<"u"&&(this._index=om.requestsCount++,om.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=frt,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete om.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}om.requestsCount=0;om.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",ote);else if(typeof addEventListener=="function"){const t="onpagehide"in gp?"pagehide":"unload";addEventListener(t,ote,!1)}}function ote(){for(let t in om.requests)om.requests.hasOwnProperty(t)&&om.requests[t].abort()}const grt=(function(){const t=xPe({xdomain:!1});return t&&t.responseType!==null})();class vrt extends mrt{constructor(e){super(e);const i=e&&e.forceBase64;this.supportsBinary=grt&&!i}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new om(xPe,this.uri(),e)}}function xPe(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||hrt))return new XMLHttpRequest}catch{}if(!e)try{return new gp[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const OPe=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class yrt extends $K{get name(){return"websocket"}doOpen(){const e=this.uri(),i=this.opts.protocols,n=OPe?{}:APe(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,i,n)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const n=e[i],r=i===e.length-1;LK(n,this.supportsBinary,a=>{try{this.doWrite(n,a)}catch{}r&&p2(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",i=this.query||{};return this.opts.timestampRequests&&(i[this.opts.timestampParam]=_Pe()),this.supportsBinary||(i.b64=1),this.createUri(e,i)}}const tj=gp.WebSocket||gp.MozWebSocket;class brt extends yrt{createSocket(e,i,n){return OPe?new tj(e,i,n):i?new tj(e,i):new tj(e)}doWrite(e,i){this.ws.send(i)}}class Irt extends $K{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const i=trt(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(i).getReader(),r=ert();r.readable.pipeTo(e.writable),this._writer=r.writable.getWriter();const a=()=>{n.read().then(({done:o,value:l})=>{o||(this.onPacket(l),a())}).catch(o=>{})};a();const s={type:"open"};this.query.sid&&(s.data=`{"sid":"${this.query.sid}"}`),this._writer.write(s).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const n=e[i],r=i===e.length-1;this._writer.write(n).then(()=>{r&&p2(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const wrt={websocket:brt,webtransport:Irt,polling:vrt},Srt=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Trt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Tz(t){if(t.length>8e3)throw"URI too long";const e=t,i=t.indexOf("["),n=t.indexOf("]");i!=-1&&n!=-1&&(t=t.substring(0,i)+t.substring(i,n).replace(/:/g,";")+t.substring(n,t.length));let r=Srt.exec(t||""),a={},s=14;for(;s--;)a[Trt[s]]=r[s]||"";return i!=-1&&n!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=Urt(a,a.path),a.queryKey=Drt(a,a.query),a}function Urt(t,e){const i=/\/{2,9}/g,n=e.replace(i,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function Drt(t,e){const i={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,r,a){r&&(i[r]=a)}),i}const Uz=typeof addEventListener=="function"&&typeof removeEventListener=="function",V_=[];Uz&&addEventListener("offline",()=>{V_.forEach(t=>t())},!1);class Ay extends so{constructor(e,i){if(super(),this.binaryType=nrt,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(i=e,e=null),e){const n=Tz(e);i.hostname=n.host,i.secure=n.protocol==="https"||n.protocol==="wss",i.port=n.port,n.query&&(i.query=n.query)}else i.host&&(i.hostname=Tz(i.host).host);h2(this,i),this.secure=i.secure!=null?i.secure:typeof location<"u"&&location.protocol==="https:",i.hostname&&!i.port&&(i.port=this.secure?"443":"80"),this.hostname=i.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=i.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},i.transports.forEach(n=>{const r=n.prototype.name;this.transports.push(r),this._transportsByName[r]=n}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},i),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=crt(this.opts.query)),Uz&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},V_.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const i=Object.assign({},this.opts.query);i.EIO=NPe,i.transport=e,this.id&&(i.sid=this.id);const n=Object.assign({},this.opts,{query:i,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Ay.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const i=this.createTransport(e);i.open(),this.setTransport(i)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",i=>this._onClose("transport close",i))}onOpen(){this.readyState="open",Ay.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const i=new Error("server error");i.code=e.data,this._onError(i);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let i=1;for(let n=0;n<this.writeBuffer.length;n++){const r=this.writeBuffer[n].data;if(r&&(i+=ort(r)),n>0&&i>this._maxPayload)return this.writeBuffer.slice(0,n);i+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,p2(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,i,n){return this._sendPacket("message",e,i,n),this}send(e,i,n){return this._sendPacket("message",e,i,n),this}_sendPacket(e,i,n,r){if(typeof i=="function"&&(r=i,i=void 0),typeof n=="function"&&(r=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const a={type:e,data:i,options:n};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},i=()=>{this.off("upgrade",i),this.off("upgradeError",i),e()},n=()=>{this.once("upgrade",i),this.once("upgradeError",i)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}_onError(e){if(Ay.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,i){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Uz&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const n=V_.indexOf(this._offlineEventListener);n!==-1&&V_.splice(n,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,i),this.writeBuffer=[],this._prevBufferLen=0}}}Ay.protocol=NPe;class Ert extends Ay{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let i=this.createTransport(e),n=!1;Ay.priorWebsocketSuccess=!1;const r=()=>{n||(i.send([{type:"ping",data:"probe"}]),i.once("packet",d=>{if(!n)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",i),!i)return;Ay.priorWebsocketSuccess=i.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(c(),this.setTransport(i),i.send([{type:"upgrade"}]),this.emitReserved("upgrade",i),i=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=i.name,this.emitReserved("upgradeError",p)}}))};function a(){n||(n=!0,c(),i.close(),i=null)}const s=d=>{const p=new Error("probe error: "+d);p.transport=i.name,a(),this.emitReserved("upgradeError",p)};function o(){s("transport closed")}function l(){s("socket closed")}function u(d){i&&d.name!==i.name&&a()}const c=()=>{i.removeListener("open",r),i.removeListener("error",s),i.removeListener("close",o),this.off("close",l),this.off("upgrading",u)};i.once("open",r),i.once("error",s),i.once("close",o),this.once("close",l),this.once("upgrading",u),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||i.open()},200):i.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const i=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&i.push(e[n]);return i}}let Prt=class extends Ert{constructor(e,i={}){const n=typeof e=="object"?e:i;(!n.transports||n.transports&&typeof n.transports[0]=="string")&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map(r=>wrt[r]).filter(r=>!!r)),super(e,n)}};function Crt(t,e="",i){let n=t;i=i||typeof location<"u"&&location,t==null&&(t=i.protocol+"//"+i.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=i.protocol+t:t=i.host+t),/^(https?|wss?):\/\//.test(t)||(typeof i<"u"?t=i.protocol+"//"+t:t="https://"+t),n=Tz(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const a=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+a+":"+n.port+e,n.href=n.protocol+"://"+a+(i&&i.port===n.port?"":":"+n.port),n}const Rrt=typeof ArrayBuffer=="function",Mrt=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,LPe=Object.prototype.toString,Nrt=typeof Blob=="function"||typeof Blob<"u"&&LPe.call(Blob)==="[object BlobConstructor]",Art=typeof File=="function"||typeof File<"u"&&LPe.call(File)==="[object FileConstructor]";function BK(t){return Rrt&&(t instanceof ArrayBuffer||Mrt(t))||Nrt&&t instanceof Blob||Art&&t instanceof File}function j_(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let i=0,n=t.length;i<n;i++)if(j_(t[i]))return!0;return!1}if(BK(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return j_(t.toJSON(),!0);for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&j_(t[i]))return!0;return!1}function _rt(t){const e=[],i=t.data,n=t;return n.data=Dz(i,e),n.attachments=e.length,{packet:n,buffers:e}}function Dz(t,e){if(!t)return t;if(BK(t)){const i={_placeholder:!0,num:e.length};return e.push(t),i}else if(Array.isArray(t)){const i=new Array(t.length);for(let n=0;n<t.length;n++)i[n]=Dz(t[n],e);return i}else if(typeof t=="object"&&!(t instanceof Date)){const i={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=Dz(t[n],e));return i}return t}function krt(t,e){return t.data=Ez(t.data,e),delete t.attachments,t}function Ez(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let i=0;i<t.length;i++)t[i]=Ez(t[i],e);else if(typeof t=="object")for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t[i]=Ez(t[i],e));return t}const xrt=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Ort=5;var ur;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(ur||(ur={}));class Lrt{constructor(e){this.replacer=e}encode(e){return(e.type===ur.EVENT||e.type===ur.ACK)&&j_(e)?this.encodeAsBinary({type:e.type===ur.EVENT?ur.BINARY_EVENT:ur.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let i=""+e.type;return(e.type===ur.BINARY_EVENT||e.type===ur.BINARY_ACK)&&(i+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(i+=e.nsp+","),e.id!=null&&(i+=e.id),e.data!=null&&(i+=JSON.stringify(e.data,this.replacer)),i}encodeAsBinary(e){const i=_rt(e),n=this.encodeAsString(i.packet),r=i.buffers;return r.unshift(n),r}}function lte(t){return Object.prototype.toString.call(t)==="[object Object]"}class VK extends so{constructor(e){super(),this.reviver=e}add(e){let i;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");i=this.decodeString(e);const n=i.type===ur.BINARY_EVENT;n||i.type===ur.BINARY_ACK?(i.type=n?ur.EVENT:ur.ACK,this.reconstructor=new Frt(i),i.attachments===0&&super.emitReserved("decoded",i)):super.emitReserved("decoded",i)}else if(BK(e)||e.base64)if(this.reconstructor)i=this.reconstructor.takeBinaryData(e),i&&(this.reconstructor=null,super.emitReserved("decoded",i));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let i=0;const n={type:Number(e.charAt(0))};if(ur[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===ur.BINARY_EVENT||n.type===ur.BINARY_ACK){const a=i+1;for(;e.charAt(++i)!=="-"&&i!=e.length;);const s=e.substring(a,i);if(s!=Number(s)||e.charAt(i)!=="-")throw new Error("Illegal attachments");n.attachments=Number(s)}if(e.charAt(i+1)==="/"){const a=i+1;for(;++i&&!(e.charAt(i)===","||i===e.length););n.nsp=e.substring(a,i)}else n.nsp="/";const r=e.charAt(i+1);if(r!==""&&Number(r)==r){const a=i+1;for(;++i;){const s=e.charAt(i);if(s==null||Number(s)!=s){--i;break}if(i===e.length)break}n.id=Number(e.substring(a,i+1))}if(e.charAt(++i)){const a=this.tryParse(e.substr(i));if(VK.isPayloadValid(n.type,a))n.data=a;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,i){switch(e){case ur.CONNECT:return lte(i);case ur.DISCONNECT:return i===void 0;case ur.CONNECT_ERROR:return typeof i=="string"||lte(i);case ur.EVENT:case ur.BINARY_EVENT:return Array.isArray(i)&&(typeof i[0]=="number"||typeof i[0]=="string"&&xrt.indexOf(i[0])===-1);case ur.ACK:case ur.BINARY_ACK:return Array.isArray(i)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Frt{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const i=krt(this.reconPack,this.buffers);return this.finishedReconstruction(),i}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const $rt=Object.freeze(Object.defineProperty({__proto__:null,Decoder:VK,Encoder:Lrt,get PacketType(){return ur},protocol:Ort},Symbol.toStringTag,{value:"Module"}));function yh(t,e,i){return t.on(e,i),function(){t.off(e,i)}}const Brt=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class FPe extends so{constructor(e,i,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=i,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[yh(e,"open",this.onopen.bind(this)),yh(e,"packet",this.onpacket.bind(this)),yh(e,"error",this.onerror.bind(this)),yh(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...i){var n,r,a;if(Brt.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(i.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(i),this;const s={type:ur.EVENT,data:i};if(s.options={},s.options.compress=this.flags.compress!==!1,typeof i[i.length-1]=="function"){const c=this.ids++,d=i.pop();this._registerAckCallback(c,d),s.id=c}const o=(r=(n=this.io.engine)===null||n===void 0?void 0:n.transport)===null||r===void 0?void 0:r.writable,l=this.connected&&!(!((a=this.io.engine)===null||a===void 0)&&a._hasPingExpired());return this.flags.volatile&&!o||(l?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(e,i){var n;const r=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(r===void 0){this.acks[e]=i;return}const a=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);i.call(this,new Error("operation has timed out"))},r),s=(...o)=>{this.io.clearTimeoutFn(a),i.apply(this,o)};s.withError=!0,this.acks[e]=s}emitWithAck(e,...i){return new Promise((n,r)=>{const a=(s,o)=>s?r(s):n(o);a.withError=!0,i.push(a),this.emit(e,...i)})}_addToQueue(e){let i;typeof e[e.length-1]=="function"&&(i=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((r,...a)=>(this._queue[0],r!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),i&&i(r)):(this._queue.shift(),i&&i(null,...a)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const i=this._queue[0];i.pending&&!e||(i.pending=!0,i.tryCount++,this.flags=i.flags,this.emit.apply(this,i.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:ur.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,i){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,i),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(n=>String(n.id)===e)){const n=this.acks[e];delete this.acks[e],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ur.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ur.EVENT:case ur.BINARY_EVENT:this.onevent(e);break;case ur.ACK:case ur.BINARY_ACK:this.onack(e);break;case ur.DISCONNECT:this.ondisconnect();break;case ur.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const i=e.data||[];e.id!=null&&i.push(this.ack(e.id)),this.connected?this.emitEvent(i):this.receiveBuffer.push(Object.freeze(i))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const i=this._anyListeners.slice();for(const n of i)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const i=this;let n=!1;return function(...r){n||(n=!0,i.packet({type:ur.ACK,id:e,data:r}))}}onack(e){const i=this.acks[e.id];typeof i=="function"&&(delete this.acks[e.id],i.withError&&e.data.unshift(null),i.apply(this,e.data))}onconnect(e,i){this.id=e,this.recovered=i&&this._pid===i,this._pid=i,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ur.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const i=this._anyListeners;for(let n=0;n<i.length;n++)if(e===i[n])return i.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const i=this._anyOutgoingListeners;for(let n=0;n<i.length;n++)if(e===i[n])return i.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const i=this._anyOutgoingListeners.slice();for(const n of i)n.apply(this,e.data)}}}function aE(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}aE.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),i=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-i:t+i}return Math.min(t,this.max)|0};aE.prototype.reset=function(){this.attempts=0};aE.prototype.setMin=function(t){this.ms=t};aE.prototype.setMax=function(t){this.max=t};aE.prototype.setJitter=function(t){this.jitter=t};class Pz extends so{constructor(e,i){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(i=e,e=void 0),i=i||{},i.path=i.path||"/socket.io",this.opts=i,h2(this,i),this.reconnection(i.reconnection!==!1),this.reconnectionAttempts(i.reconnectionAttempts||1/0),this.reconnectionDelay(i.reconnectionDelay||1e3),this.reconnectionDelayMax(i.reconnectionDelayMax||5e3),this.randomizationFactor((n=i.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new aE({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(i.timeout==null?2e4:i.timeout),this._readyState="closed",this.uri=e;const r=i.parser||$rt;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=i.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var i;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(i=this.backoff)===null||i===void 0||i.setMin(e),this)}randomizationFactor(e){var i;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(i=this.backoff)===null||i===void 0||i.setJitter(e),this)}reconnectionDelayMax(e){var i;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(i=this.backoff)===null||i===void 0||i.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Prt(this.uri,this.opts);const i=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=yh(i,"open",function(){n.onopen(),e&&e()}),a=o=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",o),e?e(o):this.maybeReconnectOnOpen()},s=yh(i,"error",a);if(this._timeout!==!1){const o=this._timeout,l=this.setTimeoutFn(()=>{r(),a(new Error("timeout")),i.close()},o);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(r),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(yh(e,"ping",this.onping.bind(this)),yh(e,"data",this.ondata.bind(this)),yh(e,"error",this.onerror.bind(this)),yh(e,"close",this.onclose.bind(this)),yh(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(i){this.onclose("parse error",i)}}ondecoded(e){p2(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,i){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new FPe(this,e,i),this.nsps[e]=n),n}_destroy(e){const i=Object.keys(this.nsps);for(const n of i)if(this.nsps[n].active)return;this._close()}_packet(e){const i=this.encoder.encode(e);for(let n=0;n<i.length;n++)this.engine.write(i[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,i){var n;this.cleanup(),(n=this.engine)===null||n===void 0||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,i),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const i=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(r=>{r?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",r)):e.onreconnect()}))},i);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const ME={};function G_(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const i=Crt(t,e.path||"/socket.io"),n=i.source,r=i.id,a=i.path,s=ME[r]&&a in ME[r].nsps,o=e.forceNew||e["force new connection"]||e.multiplex===!1||s;let l;return o?l=new Pz(n,e):(ME[r]||(ME[r]=new Pz(n,e)),l=ME[r]),i.query&&!e.query&&(e.query=i.queryKey),l.socket(i.path,e)}Object.assign(G_,{Manager:Pz,Socket:FPe,io:G_,connect:G_});function Vrt(){const t=LEe();return t?{authorization:`Bearer ${t}`}:void 0}const gl={timestampOffset:0,socket:void 0},fy={},Cz=[];function jrt(t){console.log("tmxMessage:",{data:t})}function $Pe(t){const e={transportOptions:{polling:{extraHeaders:Vrt()}},"force new connection":!0,reconnectionDelay:1e3,reconnectionAttempts:"Infinity",timeout:2e4};if(gl.socket)console.log("socket exists");else{const n=`${zi.socketPath||"https://courthive.net"}/tmx`;gl.socket=G_(n,e),gl.socket.on("ack",zrt),gl.socket.on(qnt,jrt),gl.socket.on(znt,DPe),gl.socket.on("connect",()=>Grt(t)),gl.socket.on("disconnect",()=>console.log("disconnect")),gl.socket.on("timestamp",r=>gl.timestampOffset=new Date().getTime()-r.timestamp),gl.socket.on("connect_error",r=>{console.log("connection error:",{data:r}),Ht({message:"Connection error",intent:"is-danger"}),f2()})}}function f2(){gl?.socket?.disconnect(),setTimeout(()=>delete gl.socket,1e3)}function jK({data:t,ackCallback:e}){const i=tc(),{email:n}=i||{},r=t.type??"tmx",a=()=>{if(e&&Mt(e)){const o=Mi.UUID();t.payload&&Object.assign(t.payload,{ackId:o}),Hrt({ackId:o,callback:e})}const s=gl.timestampOffset?new Date().getTime()+gl.timestampOffset:new Date().getTime();Object.assign(t.payload||t,{factoryVersion:VU(),tmxVersion:fK,timestamp:s,userId:n}),BPe(r,t)};if(gl.socket)a();else try{$Pe(a)}catch{Cz.push({header:r,data:t,ackCallback:e})}}function BPe(t,e){gl.socket.connected?gl.socket.emit(t,e):console.log("socket not connected")}function Grt(t){for(console.log("** connected"),jK({data:{type:"timestamp"}});Cz.length;){const e=Cz.pop();BPe(e.header,e.data)}Mt(t)&&t()}function Hrt({ackId:t,uuid:e,callback:i}){t&&(fy[t]=i),e&&(fy[e]=i)}function zrt(t){t.ackId&&fy[t.ackId]&&(fy[t.ackId](t),delete fy[t.ackId]),t.uuid&&fy[t.uuid]&&(fy[t.uuid](t),delete fy[t.uuid])}var H_={exports:{}},qrt=H_.exports,ute;function Wrt(){return ute||(ute=1,(function(t,e){(function(i,n){t.exports=n()})(qrt,(function(){var i=1e3,n=6e4,r=36e5,a="millisecond",s="second",o="minute",l="hour",u="day",c="week",d="month",p="quarter",h="year",f="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(N){var A=["th","st","nd","rd"],_=N%100;return"["+N+(A[(_-20)%10]||A[_]||A[0])+"]"}},b=function(N,A,_){var x=String(N);return!x||x.length>=A?N:""+Array(A+1-x.length).join(_)+N},I={s:b,z:function(N){var A=-N.utcOffset(),_=Math.abs(A),x=Math.floor(_/60),O=_%60;return(A<=0?"+":"-")+b(x,2,"0")+":"+b(O,2,"0")},m:function N(A,_){if(A.date()<_.date())return-N(_,A);var x=12*(_.year()-A.year())+(_.month()-A.month()),O=A.clone().add(x,d),$=_-O<0,F=A.clone().add(x+($?-1:1),d);return+(-(x+(_-O)/($?O-F:F-O))||0)},a:function(N){return N<0?Math.ceil(N)||0:Math.floor(N)},p:function(N){return{M:d,y:h,w:c,d:u,D:f,h:l,m:o,s,ms:a,Q:p}[N]||String(N||"").toLowerCase().replace(/s$/,"")},u:function(N){return N===void 0}},S="en",w={};w[S]=y;var T="$isDayjsObject",U=function(N){return N instanceof M||!(!N||!N[T])},C=function N(A,_,x){var O;if(!A)return S;if(typeof A=="string"){var $=A.toLowerCase();w[$]&&(O=$),_&&(w[$]=_,O=$);var F=A.split("-");if(!O&&F.length>1)return N(F[0])}else{var j=A.name;w[j]=A,O=j}return!x&&O&&(S=O),O||!x&&S},E=function(N,A){if(U(N))return N.clone();var _=typeof A=="object"?A:{};return _.date=N,_.args=arguments,new M(_)},P=I;P.l=C,P.i=U,P.w=function(N,A){return E(N,{locale:A.$L,utc:A.$u,x:A.$x,$offset:A.$offset})};var M=(function(){function N(_){this.$L=C(_.locale,null,!0),this.parse(_),this.$x=this.$x||_.x||{},this[T]=!0}var A=N.prototype;return A.parse=function(_){this.$d=(function(x){var O=x.date,$=x.utc;if(O===null)return new Date(NaN);if(P.u(O))return new Date;if(O instanceof Date)return new Date(O);if(typeof O=="string"&&!/Z$/i.test(O)){var F=O.match(g);if(F){var j=F[2]-1||0,H=(F[7]||"0").substring(0,3);return $?new Date(Date.UTC(F[1],j,F[3]||1,F[4]||0,F[5]||0,F[6]||0,H)):new Date(F[1],j,F[3]||1,F[4]||0,F[5]||0,F[6]||0,H)}}return new Date(O)})(_),this.init()},A.init=function(){var _=this.$d;this.$y=_.getFullYear(),this.$M=_.getMonth(),this.$D=_.getDate(),this.$W=_.getDay(),this.$H=_.getHours(),this.$m=_.getMinutes(),this.$s=_.getSeconds(),this.$ms=_.getMilliseconds()},A.$utils=function(){return P},A.isValid=function(){return this.$d.toString()!==m},A.isSame=function(_,x){var O=E(_);return this.startOf(x)<=O&&O<=this.endOf(x)},A.isAfter=function(_,x){return E(_)<this.startOf(x)},A.isBefore=function(_,x){return this.endOf(x)<E(_)},A.$g=function(_,x,O){return P.u(_)?this[x]:this.set(O,_)},A.unix=function(){return Math.floor(this.valueOf()/1e3)},A.valueOf=function(){return this.$d.getTime()},A.startOf=function(_,x){var O=this,$=!!P.u(x)||x,F=P.p(_),j=function(J,ne){var re=P.w(O.$u?Date.UTC(O.$y,ne,J):new Date(O.$y,ne,J),O);return $?re:re.endOf(u)},H=function(J,ne){return P.w(O.toDate()[J].apply(O.toDate("s"),($?[0,0,0,0]:[23,59,59,999]).slice(ne)),O)},G=this.$W,W=this.$M,q=this.$D,Z="set"+(this.$u?"UTC":"");switch(F){case h:return $?j(1,0):j(31,11);case d:return $?j(1,W):j(0,W+1);case c:var K=this.$locale().weekStart||0,Q=(G<K?G+7:G)-K;return j($?q-Q:q+(6-Q),W);case u:case f:return H(Z+"Hours",0);case l:return H(Z+"Minutes",1);case o:return H(Z+"Seconds",2);case s:return H(Z+"Milliseconds",3);default:return this.clone()}},A.endOf=function(_){return this.startOf(_,!1)},A.$set=function(_,x){var O,$=P.p(_),F="set"+(this.$u?"UTC":""),j=(O={},O[u]=F+"Date",O[f]=F+"Date",O[d]=F+"Month",O[h]=F+"FullYear",O[l]=F+"Hours",O[o]=F+"Minutes",O[s]=F+"Seconds",O[a]=F+"Milliseconds",O)[$],H=$===u?this.$D+(x-this.$W):x;if($===d||$===h){var G=this.clone().set(f,1);G.$d[j](H),G.init(),this.$d=G.set(f,Math.min(this.$D,G.daysInMonth())).$d}else j&&this.$d[j](H);return this.init(),this},A.set=function(_,x){return this.clone().$set(_,x)},A.get=function(_){return this[P.p(_)]()},A.add=function(_,x){var O,$=this;_=Number(_);var F=P.p(x),j=function(W){var q=E($);return P.w(q.date(q.date()+Math.round(W*_)),$)};if(F===d)return this.set(d,this.$M+_);if(F===h)return this.set(h,this.$y+_);if(F===u)return j(1);if(F===c)return j(7);var H=(O={},O[o]=n,O[l]=r,O[s]=i,O)[F]||1,G=this.$d.getTime()+_*H;return P.w(G,this)},A.subtract=function(_,x){return this.add(-1*_,x)},A.format=function(_){var x=this,O=this.$locale();if(!this.isValid())return O.invalidDate||m;var $=_||"YYYY-MM-DDTHH:mm:ssZ",F=P.z(this),j=this.$H,H=this.$m,G=this.$M,W=O.weekdays,q=O.months,Z=O.meridiem,K=function(ne,re,oe,de){return ne&&(ne[re]||ne(x,$))||oe[re].slice(0,de)},Q=function(ne){return P.s(j%12||12,ne,"0")},J=Z||function(ne,re,oe){var de=ne<12?"AM":"PM";return oe?de.toLowerCase():de};return $.replace(v,(function(ne,re){return re||(function(oe){switch(oe){case"YY":return String(x.$y).slice(-2);case"YYYY":return P.s(x.$y,4,"0");case"M":return G+1;case"MM":return P.s(G+1,2,"0");case"MMM":return K(O.monthsShort,G,q,3);case"MMMM":return K(q,G);case"D":return x.$D;case"DD":return P.s(x.$D,2,"0");case"d":return String(x.$W);case"dd":return K(O.weekdaysMin,x.$W,W,2);case"ddd":return K(O.weekdaysShort,x.$W,W,3);case"dddd":return W[x.$W];case"H":return String(j);case"HH":return P.s(j,2,"0");case"h":return Q(1);case"hh":return Q(2);case"a":return J(j,H,!0);case"A":return J(j,H,!1);case"m":return String(H);case"mm":return P.s(H,2,"0");case"s":return String(x.$s);case"ss":return P.s(x.$s,2,"0");case"SSS":return P.s(x.$ms,3,"0");case"Z":return F}return null})(ne)||F.replace(":","")}))},A.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},A.diff=function(_,x,O){var $,F=this,j=P.p(x),H=E(_),G=(H.utcOffset()-this.utcOffset())*n,W=this-H,q=function(){return P.m(F,H)};switch(j){case h:$=q()/12;break;case d:$=q();break;case p:$=q()/3;break;case c:$=(W-G)/6048e5;break;case u:$=(W-G)/864e5;break;case l:$=W/r;break;case o:$=W/n;break;case s:$=W/i;break;default:$=W}return O?$:P.a($)},A.daysInMonth=function(){return this.endOf(d).$D},A.$locale=function(){return w[this.$L]},A.locale=function(_,x){if(!_)return this.$L;var O=this.clone(),$=C(_,x,!0);return $&&(O.$L=$),O},A.clone=function(){return P.w(this.$d,this)},A.toDate=function(){return new Date(this.valueOf())},A.toJSON=function(){return this.isValid()?this.toISOString():null},A.toISOString=function(){return this.$d.toISOString()},A.toString=function(){return this.$d.toUTCString()},N})(),R=M.prototype;return E.prototype=R,[["$ms",a],["$s",s],["$m",o],["$H",l],["$W",u],["$M",d],["$y",h],["$D",f]].forEach((function(N){R[N[1]]=function(A){return this.$g(A,N[0],N[1])}})),E.extend=function(N,A){return N.$i||(N(A,M,E),N.$i=!0),E},E.locale=C,E.isDayjs=U,E.unix=function(N){return E(1e3*N)},E.en=w[S],E.Ls=w,E.p={},E}))})(H_)),H_.exports}var Yrt=Wrt();const GK=pM(Yrt);async function Wt(t){const{tournamentRecord:e,methods:i,engine:n=Nje,callback:r}=t,a=tc(),s=b=>{e&&QG[n].reset(),r&&Mt(r)?r(b):b?.error&&Ht({message:b.error.message??"Error",intent:"is-danger"})};if(!Array.isArray(i))return s();const o=QG[n];if(!o)return s();e&&o.setState(e);const l=b=>b?.parentOrganisation?.organisationId,u=o.getState()?.tournamentRecords??{},c=b=>b.timeItems?.find(({itemType:I})=>I==="TMX")?.itemValue?.offline,d=Object.values(u)?.map(c).filter(Boolean);if(d.length>1&&!d.every(b=>!b.email||b.email===d[0].email))return Ht({message:"Not all linked tournaments are offline",intent:"is-danger"});const h=d.length,f=Object.values(u)?.map(b=>b.tournamentId),m=Mi.unique(Object.values(u)?.map(l)).filter(Boolean);if(m.length>1)return Ht({message:"Multiple providers",intent:"is-danger"});const g=new Date().getTime(),v=Object.values(u).every(b=>{const I=GK(b.endDate).endOf("day").valueOf();return!!(I&&I>=g)}),y=b=>Zrt({offline:h,methods:i,factoryEngine:o,tournamentIds:f,completion:s,saveLocal:b});if(!v){Krt({state:a,providerIds:m,mutate:y});return}if(m.length&&!h){VPe({state:a,providerIds:m,mutate:y});return}await y(!0)}function Krt({state:t,providerIds:e,mutate:i}){return Ht({action:{onClick:()=>e?.length?VPe({state:t,providerIds:e,mutate:i}):i(),text:"Modify?"},message:"Not in date range",intent:"is-danger",pauseOnHover:!0,duration:8e3})}function VPe({state:t,providerIds:e,mutate:i}){if(!t)return It.provider=void 0,O2(!1),Ht({message:"Not logged in",intent:"is-warning"});const n=!!(t?.providerIds?.includes(e[0])||t?.provider?.organisationId===e[0]),r=t?.roles?.includes(HF),a=It.provider?.organisationId===e[0];return!n&&!r?Ht({message:"Not authorized",intent:"is-danger"}):!n&&r&&!a?Ht({action:{onClick:()=>(It.provider={organisationId:e[0]},i(!1)),text:"Impersonate?"},message:"Super Admin",intent:"is-danger"}):i(!n&&!(r&&a))}function cte({factoryEngine:t,methods:e}){zi.log?.verbose&&console.log("%c executing locally","color: lightgreen");const i=Mi.makeDeepCopy(e);return t.executionQueue(i,!0)||{}}async function ij(t){(t||zi.saveLocal)&&await mK()}async function Zrt({offline:t,methods:e,completion:i,factoryEngine:n,tournamentIds:r,saveLocal:a}){const s=n.getTournament().tournamentRecord?.parentOrganisation?.organisationId;if(window.dev?.params)for(const u of e)window.dev.params[u.method]&&(u.params={...u.params,...window.dev.params[u.method]});window?.dev?.getContext().internal&&console.log({methods:e});const o=!zi.serverFirst||!s;let l;if(o||t){if(l=cte({factoryEngine:n,methods:e}),l.error)return i(l);if(!s||t)return await ij(!0),i(l)}if(s&&(l?.success||zi.serverFirst)){const u=async c=>{const d=c?.error?.code==="ERR_MISSING_TOURNAMENT";if(zi.serverFirst&&(c?.success||d))return l=cte({factoryEngine:n,methods:e}),l.error||await ij(a||d),i(l)};zi.log?.verbose&&console.log("%c invoking remote","color: lightblue"),jK({data:{type:"executionQueue",payload:{methods:e,tournamentIds:r,rollbackOnError:!0}},ackCallback:u}),o&&await ij(a||!1)}if(o)return i(l)}function jPe(t,e){const i=document.createElement("a");i.style.display="none",i.setAttribute("href",e),i.setAttribute("download",t);const n=document.body.appendChild(i);n.click(),n.remove()}function GPe(t,e){const i="data:text/json;charset=utf-8,"+encodeURIComponent(IJe(e)||"");jPe(t,i)}function Xrt(t,e){const i="data:text/plain;charset=utf-8,"+encodeURIComponent(e);jPe(t,i)}function HPe(){const t=l=>l.toString()[1]?l:"0"+l,e=l=>{if(!l)return"";const u=new Date(l);return[t(u.getMonth()+1),t(u.getDate()),u.getFullYear()].join("/")},{tournamentInfo:i}=nt.getTournamentInfo(),{completedMatchUps:n}=nt.tournamentMatchUps({context:{tournamentSanctionBody:i.parentOrganisation?.organisationName,tournamentStartDate:e(i.startDate),tournamentEndDate:e(i.endDate),tournamentEventSource:"CourtHive",tournamentEventCategory:"Junior",tournamentEventType:"Tournament",...i,idType:yw}}),r=n.map(l=>{const{winningSide:u,sides:c,score:d}=l,p=c.find(({sideNumber:m})=>m===u),h=c.find(({sideNumber:m})=>m!==u);return{winnerScore:d[`scoreStringSide${u}`],...l,winners:p,losers:h}}),a=l=>l?.slice(0,1),s={columnAccessors:[""],columnTransform:{Date:["tournamentEndDate"],"Winner 1 Name":["winners.participant.individualParticipants.0.participantName","winners.participant.participantName"],"Winner 1 Third Party ID":["winners.participant.individualParticipants.0.participantId","winners.participant.participantId"],"Winner 1 UTR ID":["winners.participant.individualParticipants.0.person.personOtherIds.0.idValue"],"Winner 1 Gender":["winners.participant.individualParticipants.0.person.sex","winners.participant.person.sex"],"Winner 1 DOB":["winners.participant.individualParticipants.0.person.birthDate","winners.participant.person.birthDate"],"Winner 1 City":["winners.participant.individualParticipants.0.addresses.0.city","winners.participant.addresses.0.city"],"Winner 1 State":["winners.participant.individualParticipants.0.addresses.0.state","winners.participant.addresses.0.state"],"Winner 1 Country":["winners.participant.individualParticipants.0.addresses.0.nationalityCode","winners.participant.addresses.0nationalityCode"],"Winner 1 College":["winners.participant.individualParticipants.0.college"],"Winner 2 Name":["winner.participant.individualParticipants.1.participantName"],"Winner 2 Third Party ID":["winners.participant.individualParticipants.1.participantId"],"Winner 2 UTR ID":["winners.participant.individualParticipants.1.person.personOtherIds.0.idValue"],"Winner 2 Gender":["winners.participant.individualParticipants.1.person.sex"],"Winner 2 DOB":["winners.participant.individualParticipants.1.person.birthDate"],"Winner 2 City":["winners.participant.individualParticipants.1.addresses.0.city"],"Winner 2 State":["winners.participant.individualParticipants.1.addresses.0.state"],"Winner 2 Country":["winners.participant.individualParticipants.1.addresses.0.nationalityCode"],"Winner 2 College":["winners.participant.individualParticipants.1.college"],"Loser 1 Name":["losers.participant.individualParticipants.0.participantName","losers.participant.participantName"],"Loser 1 Third Party ID":["losers.participant.individualParticipants.0.participantId","losers.participant.participantId"],"Loser 1 UTR ID":["losers.participant.individualParticipants.1.person.personOtherIds.0.idValue"],"Loser 1 Gender":["losers.participant.individualParticipants.0.person.sex","winners.participant.person.sex"],"Loser 1 DOB":["losers.participant.individualParticipants.0.person.birthDate","losers.participant.person.birthDate"],"Loser 1 City":["losers.participant.individualParticipants.0.addresses.0.city","losers.participant.addresses.0.city"],"Loser 1 State":["losers.participant.individualParticipants.0.addresses.0.state","losers.participant.addresses.0.state"],"Loser 1 Country":["losers.participant.individualParticipants.0.addresses.0.nationalityCode","losers.participant.addresses.0nationalityCode"],"Loser 1 College":["losers.participant.individualParticipants.0.college"],"Loser 2 Name":["losers.participant.individualParticipants.1.participantName"],"Loser 2 Third Party ID":["losers.participant.individualParticipants.1.participantId"],"Loser 2 UTR ID":["losers.participant.individualParticipants.1.person.personOtherIds.1.idValue"],"Loser 2 Gender":["losers.participant.individualParticipants.1.person.sex"],"Loser 2 DOB":["losers.participant.individualParticipants.1.person.birthDate"],"Loser 2 City":["losers.participant.individualParticipants.1.addresses.0.city"],"Loser 2 State":["losers.participant.individualParticipants.1.addresses.0.state"],"Loser 2 Country":["losers.participant.individualParticipants.1.addresses.0.nationalityCode"],"Loser 2 College":["losers.participant.individualParticipants.1.college"],Score:["winnerScore"],"Id Type":["idType"],"Draw Name":[vw],"Draw Gender":["gender"],"Draw Team Type":["eventType"],"Draw Bracket Type":[""],"Draw Bracket Value":[""],"Draw Type":[Ph],"Tournament Name":["tournamentName"],"Tournament URL":[""],"Tournament Start Date":["tournamentStartDate"],"Tournament End Date":["tournamentEndDate"],"Tournament City":[""],"Tournament State":[""],"Tournament Country":[""],"Tournament Country Code":[""],"Tournament Host":[""],"Tournament Location Type":[""],"Tournament Surface":[""],"Tournament Event Type":["tournamentEventType"],"Tournament Event Category":["tournamentEventCategory"],"Tournament Import Source":["tournamentEventSource"],"Tournament Sanction Body":["tournamentSanctionBody"],"Match ID":["matchUpId"],"Tournament Event Grade":[""]},functionMap:{"Winner 1 Gender":a,"Winner 2 Gender":a,"Loser 1 Gender":a,"Loser 2 Gender":a}},o=Mi.JSON2CSV(r,s);Xrt(`UTR-${i.tournamentId}.csv`,o)}function Jrt(){Ht({intent:"is-success",message:"Success"})}function Qrt(t){Ht({intent:"is-danger",message:t?.message??"Failure"})}function eat(){const t=nt.getTournament().tournamentRecord,e=t?.timeItems?.find(({itemType:p})=>p==="TMX")?.itemValue?.offline,n=t?.parentOrganisation?.organisationId,r=tc(),a=r?.permissions?.includes("deleteTournament"),s=r?.roles?.includes(tge);let o;const l=()=>{if(o.action.value==="upload"&&o.replace.checked){const p=nt.getTournament().tournamentRecord;return Ht({action:{onClick:()=>wP({tournamentRecord:p}).then(Jrt,Qrt),text:"Send??"},message:"Upload tournament",intent:"is-danger"})}if(o.action.value==="claim"&&r?.provider){const p=nt.getTournament().tournamentRecord;if(!p.parentOrganisation){p.parentOrganisation=r.provider,nt.setState(p);const h=()=>{Hu.deleteTournament(p.tournamentId),It.router.navigate(`/tournament/${p.tournamentId}/detail`),Ht({message:"Tournament claimed",intent:"is-info"})},f=m=>{Ht({message:m.message||"Not claimed",intent:"is-danger"})};wP({tournamentRecord:p}).then(h,f)}}o.action.value==="goOffline"&&r?.provider&&nj({postMutation:h=>{if(h?.success){mK();const f=document.getElementById("dnav");f&&(f.style.backgroundColor="lightyellow"),Ht({message:"Offline",intent:"is-info"})}},state:r,offline:!0}),o.action.value==="goOnline"&&r?.provider&&nj({postMutation:h=>{if(h?.success){const f=()=>{Hu.deleteTournament(t.tournamentId);const v=document.getElementById("dnav");v&&(v.style.backgroundColor=""),Ht({message:"Online",intent:"is-info"})},m=v=>{console.log({err:v}),nj({state:r,offline:!0})},g=nt.getTournament().tournamentRecord;wP({tournamentRecord:g}).then(f,m)}},state:r,offline:!1}),o.action.value==="utrExport"&&HPe(),o.action.value==="todsExport"&&(t?GPe(`${t.tournamentId}.tods.json`,t):Ht({message:"Error"}))},u=[{control:"replace",onChange:({e:p})=>{const h=document.getElementById("go");h&&(h.disabled=!p.target.checked)}},{control:"action",onChange:({e:p})=>{const h=document.getElementById("replace"),f=jl(h,"field");f&&(f.style.display=p.target.value==="upload"?"block":"none");const m=document.getElementById("go");m&&(m.disabled=o.action.value==="upload")}}],c=[{label:"-- select action --",close:!0},n&&{label:"Upload tournament",value:"upload",close:!0},t&&{label:"Delete tournament",disabled:!a,value:"delete",close:!0},t&&!n&&r?.provider&&{label:"Claim tournament",value:"claim",close:!0},n&&!e&&{label:"Go offline - standalone mode",value:"goOffline",close:!0},n&&e&&{label:"Go online - exit standalone mode",value:"goOnline",close:!0},t&&s&&{label:"Export UTR matches",value:"utrExport"},t&&s&&{label:"Export TODS file",value:"todsExport"}].filter(Boolean);if(c.length<2)return Ht({message:"No actions available"});Yn({title:"Tournament actions",content:p=>o=mr(p,[{label:"Action",field:"action",options:c},{label:"Replace tournament on server",field:"replace",visible:!1,checkbox:!0,id:"replace"}],u),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Go",id:"go",intent:"is-danger",disabled:!0,onClick:l,close:!0}]})}function nj({postMutation:t,state:e,offline:i}){const n={...(nt.getTournamentTimeItem({itemType:"TMX"})?.timeItem??{}).itemValue};i?n.offline={email:e.email}:delete n.offline,Wt({methods:[{method:xJe,params:{removePriorValues:!0,timeItem:{itemType:"TMX",itemValue:n}}}],callback:t})}function zPe(){const t=!window.location.host.startsWith("localhost");!window.location.host.endsWith("github.io")&&t&&window.dev&&(delete window.dev,console.log("%c dev cancelled","color: cyan"))}function tat(){const{tournamentRecord:t}=nt.getTournament();if(!t)return;const i=[{label:"Cancel",intent:"none"},{label:yw,intent:"is-warning",onClick:HPe,close:!0},{label:"TODS",intent:"is-primary",onClick:()=>{t?GPe(`${t.tournamentId}.tods.json`,t):Ht({message:"Error"})},close:!0}],n=`${_s.tr("phrases.export")}: ${_s.tr("trn")}`;Yn({title:n,content:t.tournamentName,buttons:i})}function iat(t){t.getElement().style.border="1px solid black";const e=t.getValue(),i=document.createElement("div");return i.innerHTML=e||"",i}function sE(t){const{e,table:i,classNames:n=[],className:r,visible:a,columns:s}=t,o=jl(e.target,"options_right"),l=a?"":Rt,u=a?Rt:"";if(o)for(const c of o.children){const d=r?Array.from(c.classList).includes(r):Array.from(c.classList).some(p=>n.includes(p));c.style.display=d?l:u}for(const c of s)i.updateColumnDefinition(c,{formatter:a?iat:void 0,editable:a})}function nat(t,e){sE({columns:["ratings.wtn.wtnRating","ratings.utr.utrRating"],className:"saveRatings",visible:!0,table:e,e:t}),e.showColumn("ratings.utr.utrRating"),e.showColumn("ratings.wtn.wtnRating"),e.redraw(!0)}const rat=(t,e)=>t.groups?.find(i=>i.participantRoleResponsibilities?.includes(e))?.participantName,aat=t=>rat(t,"CLUB"),qPe=(t,e)=>(t.events||[]).map(({eventId:i})=>e?.[i]),WPe=t=>Sm.countries.find(e=>e.ioc===t||e.iso===t)?.label||"",Rz=/[\p{Lu}]/u,sat=/[\p{Ll}]/u,oat=/^[\p{Lu}](?![\p{Lu}])/u,AN=/[_.\- ]+/,YPe=/([\p{Alpha}\p{N}_]|$)/u,lat=new RegExp("^"+AN.source),uat=new RegExp(AN.source+YPe.source,"gu"),cat=new RegExp(String.raw`\d+`+YPe.source,"gu"),dat=(t,e,i,n)=>{let r=!1,a=!1,s=!1,o=!1;for(let l=0;l<t.length;l++){const u=t[l];o=l>2?t[l-3]==="-":!0,r&&Rz.test(u)?(t=t.slice(0,l)+"-"+t.slice(l),r=!1,s=a,a=!0,l++):a&&s&&sat.test(u)&&(!o||n)?(t=t.slice(0,l-1)+"-"+t.slice(l-1),s=a,a=!1,r=!0):(r=e(u)===u&&i(u)!==u,s=a,a=i(u)===u&&e(u)!==u)}return t},pat=(t,e)=>t.replace(oat,i=>e(i)),hat=(t,e,i)=>{let n="",r=!1,a=!1;const s=[...t];for(let o=0;o<s.length;o++){const l=s[o],u=Rz.test(l),c=o+1<s.length&&Rz.test(s[o+1]);r&&/[\p{Alpha}]/u.test(l)?(n+=l,r=!1,a=u):i&&u&&(a||c)?(n+=l,a=!0):/\d/.test(l)?(n+=l,r=!0,a=!1):AN.test(l)?(n+=l,a=!1):(n+=e(l),r=!1,a=!1)}return n},fat=(t,e,{capitalizeAfterNumber:i})=>{const n=i?(r,a,s,o)=>{const l=o.charAt(s+r.length);return AN.test(l)?r:a?r.slice(0,-a.length)+e(a):r}:r=>r;return t.replaceAll(cat,n).replaceAll(uat,(r,a)=>e(a))};function mat(t,e){if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,capitalizeAfterNumber:!0,...e},Array.isArray(t)?t=t.map(s=>s.trim()).filter(s=>s.length>0).join("-"):t=t.trim(),t.length===0)return"";const i=t.match(/^[_$]*/)[0];if(t=t.slice(i.length),t.length===0)return i;const n=e.locale===!1?s=>s.toLowerCase():s=>s.toLocaleLowerCase(e.locale),r=e.locale===!1?s=>s.toUpperCase():s=>s.toLocaleUpperCase(e.locale);return t.length===1?AN.test(t)?i:i+(e.pascalCase?r(t):n(t)):(t!==n(t)&&(t=dat(t,n,r,e.preserveConsecutiveUppercase)),t=t.replace(lat,""),e.capitalizeAfterNumber?t=e.preserveConsecutiveUppercase?pat(t,n):n(t):t=hat(t,n,e.preserveConsecutiveUppercase),e.pascalCase&&t.length>0&&(t=r(t[0])+t.slice(1)),i+fat(t,r,e))}const{WTN:gat,UTR:vat}=Uo.ratingConstants,{SINGLES:dte}=Uo.eventConstants,yat=(t,e)=>{const{participantId:i,participantName:n,participantType:r,person:a}=t,{standardFamilyName:s,standardGivenName:o}=a||{},l=t.person?.addresses?.[0],u=l?.city&&l?.state?`${l.city}, ${l.state}`:void 0,c=t.ratings?.[dte]?.find(h=>h.scaleName===vat)?.scaleValue,p={wtn:t.ratings?.[dte]?.find(h=>h.scaleName===gat)?.scaleValue,utr:c};return{searchText:`${n} ${o} ${s}`.toLowerCase(),sex:mat(t.person.sex||"",{pascalCase:!0}),eventIds:t.events.map(({eventId:h})=>h),ioc:WPe(t.person?.nationalityCode),events:qPe(t,e),penalties:t.penalties||[],tennisId:t.person.tennisId,signedIn:t.signedIn,lastName:s,firstName:o,club:aat(t),teams:t.teams,participantName:n,participantType:r,participantId:i,participant:t,cityState:u,ratings:p}},wf=t=>(e,i)=>{const n=e.getDefinition();return t.includes(n.field)?"":i==="asc"&&"<div><i class='fas fa-sort-up'></div>"||i==="desc"&&"<div><i class=' fas fa-sort-down'></div>"||"<div><i class='fas fa-sort'></div>"},{MALE:bat,FEMALE:Iat}=eh,{PAIR:wat}=qs,tS=t=>(e,i,n)=>{const r=e.getColumn().getDefinition(),a=r.field==="side1"&&1||r.field==="side2"&&2,s=document.createElement("div"),o=e.getRow().getData(),l=o.winningSide,u=e.getValue(),c=o.participant||u?.participant||o.person&&o;if(c){const d=zi.scales[zi.activeScale],p=f=>hK({eventHandlers:{participantClick:m=>Mt(t)&&t({...m,event:m.pointerEvent,cell:e})},composition:{configuration:{participantDetail:"TEAM",genderColor:!0,winnerColor:!0,scaleAttributes:d,flag:!1}},matchUp:o.matchUp,participant:f,placeholder:i,sideNumber:a}),h=f=>{const m=document.createElement("div");return m.className="flexrow flexjustifystart",f.individualParticipants?.forEach((g,v)=>{if(m.appendChild(p(g)),!v){const y=document.createElement("span");y.style.width="1em",y.innerHTML="&nbsp;",m.appendChild(y)}}),m};return n==="sideBySide"&&c.participantType===wat?h(c):p(c)}if(l){const d=r.field===o.winningSide;s.style.color=d?"green":"red"}else{const d=u?.sex||o?.person?.sex,p=d===bat&&"#2E86C1"||d===Iat&&"#AA336A"||"";s.style.color=p}return s.innerHTML=(kp(u)?u.participantName:u)||"",s};function Sat(t){return t.getValue()?.length||0}function CU(t,e){const i=t?.person||t?.participant?.person,n=e?.person||e?.participant?.person;return i||n?i?.standardFamilyName&&!n?.standardFamilyName||n?.standardFamilyName&&!i?.standardFamilyName||!i?.standardFamilyName&&!n?.standardFamilyName?1:i.standardFamilyName?.localeCompare(n?.standardFamilyName):t.participantName&&!e.participantName||e.participantName&&!t.participantName||!t?.participantName&&!e?.participantName?1:t?.participantName?.localeCompare(e?.participantName)}async function KPe({participantIds:t,participantId:e,callback:i}){(e||t)&&Wt({methods:[{params:{participantIds:t||[e]},method:BJe}],callback:a=>{a.success?Mt(i)&&i&&i(a):console.log({result:a})}})}const{COMPETITOR:Tat,OFFICIAL:pte}=Pv,{INDIVIDUAL:Uat}=qs;function ZPe({participant:t,view:e,callback:i}){const n=Sm.countries.map(m=>({label:Sm.countryToFlag(m.iso||"")+" "+m.label,value:m.ioc})),r={nationalityCode:t?.person?.nationalityCode,firstName:t?.person?.standardGivenName,lastName:t?.person?.standardFamilyName,birthDate:t?.person?.birthDate,sex:t?.person?.sex};let a;const s=m=>r.nationalityCode=m,o=({firstName:m,lastName:g})=>Vr(2)(m||"")&&Vr(2)(g||""),l=({inputs:m})=>{const g=o({firstName:m.firstName.value,lastName:m.lastName.value}),v=document.getElementById("saveParticipant");v&&(v.disabled=!g)},u=[{onInput:l,control:"firstName"},{onInput:l,control:"lastName"}],c=m=>{a=mr(m,[{error:"Please enter a name of at least 3 characters",value:r.firstName||"",validator:Vr(2),placeholder:"Given name",label:"First name",field:"firstName",focus:!0},{error:"Please enter a name of at least 3 characters",value:r.lastName||"",validator:Vr(2),placeholder:"Family name",label:"Last name",field:"lastName"},{value:void 0,label:"Sex",field:"sex",options:[{label:"Unknown",value:void 0,selected:!r.sex},{label:"Male",value:"MALE",selected:r.sex==="MALE"},{label:"Female",value:"FEMALE",selected:r.sex==="FEMALE"}]},{placeholder:"Birthday",value:r.birthDate||"",label:"Date of birth",field:"birthday",date:!0},{typeAhead:{list:n,callback:s},placeholder:"Country of origin",value:r.nationalityCode||"",field:"nationalityCode",label:"Country"}],u)},d=(m,g)=>eS(m,[{label:"Cancel",close:!0},{disabled:!o(r),onClick:h,id:"saveParticipant",intent:"is-info",label:"Save",close:!0}],g),p=t?"Edit":"New";It.drawer.open({title:`<b style='larger'>${p} participant</b>`,callback:()=>{},width:"300px",side:ti,content:c,footer:d});function h(){if(!t?.participantId)f();else{const m={nationalityCode:a.nationalityCode.value,standardFamilyName:a.lastName.value,standardGivenName:a.firstName.value,birthdate:a.birthday.value,sex:a.sex.value},g=[{params:{participant:{participantId:t.participantId,person:m}},method:$x}];Wt({methods:g,callback:y=>{y.success?Mt(i)&&i():console.log(y)}})}}function f(){const m=a.firstName.value,g=a.lastName.value,v=a.sex.value,y={participantRole:e===pte?pte:Tat,participantType:Uat,participantId:Mi.UUID(),person:{nationalityCode:r.nationalityCode,standardGivenName:m,standardFamilyName:g,sex:v}};Wt({methods:[{params:{participants:[y]},method:CN}],callback:S=>{S.success&&Mt(i)&&i(),S.success||console.log(S)}})}return{...iM}}function Dat({participantId:t,callback:e}){const i=nt.getParticipants({participantFilters:{participantIds:[t]},inContext:!1}).participants?.[0];if(i)return ZPe({participant:i,callback:e,view:void 0})}const z_=t=>(e,i)=>{const n=Array.from(document.querySelectorAll(".tippy-content"));if(n.length){n.forEach(c=>c.remove());return}const r=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],a=i.getRow(),s=a.getData(),{participantId:o,participantType:l}=s;Pu({items:[{hide:l!=="INDIVIDUAL",text:"<i class='fas fa-address-card'></i> Participant profile",onClick:()=>console.log("Participant profile",i.getData()?.participant)},{hide:l!=="INDIVIDUAL",text:"<i class='fas fa-user'></i> Edit Participant",onClick:()=>{Dat({participantId:o,callback:t})}},{text:"<div style='color: red'><i class='fas fa-check-square'></i> Delete participant</div>",onClick:()=>{KPe({participantId:o,callback:d=>{if(d.success)a.delete();else{const p=i.getTable();p.alert(d.error.message||"Cannot Remove Participant"),setTimeout(()=>p.clearAlert(),2500)}}})}}],target:r||e.target,config:{placement:Gp}})},{SINGLES:Eat}=dl,XPe=t=>e=>{e.getColumn().getDefinition();const i=document.createElement("div");i.className="tags";const n=e.getValue(),r=e.getRow().getData(),{participantId:a}=r,s=(o,l)=>o?.eventName?.localeCompare(l?.eventName);return n.sort(s).forEach(o=>{const l=JPe({participantId:a,event:o,eventClick:t});i.appendChild(l)}),i};function JPe({matchUpId:t,participantId:e,event:i,eventClick:n}){const r=document.createElement("span");return Mt(n)&&n&&(r.onclick=()=>n({eventId:i.eventId,participantId:e,matchUpId:t})),r.className="tag event-pill",i.gender?.toLowerCase().includes("female")?r.classList.add("is-danger"):i.gender?.toLowerCase().includes("male")?r.classList.add("is-link"):r.classList.add("is-primary"),i.eventType===Eat&&r.classList.add("is-light"),r.innerHTML=i.eventName,r}const Pat=t=>e=>{e.getColumn().getDefinition();const i=e.getRow().getData(),{matchUpId:n}=i,r=document.createElement("div");r.className="tags";const a=JPe({matchUpId:n,event:i,eventClick:t});return r.append(a),r},QPe=t=>e=>{const i=e.getColumn().getDefinition(),n=document.createElement("div");n.className="tags";const r=e.getValue(),a=(s,o)=>s?.participantName?.localeCompare(o?.participantName);return r.sort(a).forEach(s=>{const o=Cat({matchUpId:i.matchUpId,team:s,teamClick:t});n.appendChild(o)}),n};function Cat({matchUpId:t,team:e,teamClick:i}){const n=document.createElement("span"),{participantId:r,participantName:a}=e;return Mt(i)&&i&&(n.onclick=()=>i({participantId:r,matchUpId:t})),n.className="tag event-pill",n.innerHTML=a,n}const Mz=({maxValue:t,decimals:e,field:i})=>(n,r,a)=>{const s=e?/[^0-9.]/g:/^\D/g,o=document.createElement("input");o.style.backgroundColor="lightyellow",o.style.boxSizing="border-box",o.style.textAlign="center",o.style.padding="3px",o.style.height="100%",o.style.width="100%",o.value=n.getValue()||"",r(()=>{o.focus(),o.select()});function l(){let u=o.value;e&&(u=parseFloat(u).toFixed(2)),a(isNaN(u)?void 0:u)}return o.addEventListener("keydown",u=>{u.key==="Tab"&&(u.preventDefault(),u.stopPropagation())}),o.addEventListener("keyup",u=>{const c=u.target.value.replace(s,"")||"";if(u.target.value=c>t?"":c,u.key==="Tab"&&u.shiftKey&&i){const p=jl(u.target,"tabulator-row")?.previousSibling,h=p&&dv(p,"tabulator-editable");if(h)for(n of h)n.getAttribute("tabulator-field")===i&&n.focus()}else if((u.key==="Enter"||u.key==="Tab")&&i){const p=jl(u.target,"tabulator-row")?.nextSibling,h=p&&dv(p,"tabulator-editable");if(h)for(n of h)n.getAttribute("tabulator-field")===i&&n.focus()}}),o.addEventListener("blur",l),o},hte=t=>It.columns[t]!==!1;function Br({eventId:t,drawId:e,structureId:i,renderDraw:n,participantId:r,matchUpId:a,view:s}){const o=nt.getTournament()?.tournamentRecord?.tournamentId,l=t&&nt.getEvent({eventId:t,drawId:e}).event,u=l?.drawDefinitions?.length===1&&l.drawDefinitions[0];r&&u&&(e=u.drawId,n=!0),a&&(e=l.drawDefinitions.find(({drawId:d})=>nt.allDrawMatchUps({drawId:d,inContext:!1}).matchUps.find(h=>h.matchUpId===a))?.drawId,n=!!e);let c=`/${As}/${o}/${bI}/${t}`;n&&e?(c+=`/${HE}/${e}`,i&&(c+=`/${eH}/${i}`),[nH,KT,YT].includes(s||"")&&(c+=`/${tH}/${s}`)):e&&(c+=`/${ige}/${e}`),It.router.navigate(c),It.router.resolve()}const Vv=()=>"<i class='fa fa-ellipsis-vertical'></i>",{SIGNED_IN:Rat,SIGNED_OUT:Mat}=qs;function Nat(t,e){const i=e.getRow().getData().participantId,n=!e.getValue();Wt({methods:[{params:{signInState:n?Rat:Mat,participantIds:[i]},method:bK}],callback:o=>{o.success&&e.setValue(n)}})}const Aat=({field:t})=>(e,i,n)=>{const r=document.createElement("input");r.style.backgroundColor="lightyellow",r.style.boxSizing="border-box",r.style.textAlign="center",r.style.padding="3px",r.style.height="100%",r.style.width="100%",r.value=e.getValue()||"",i(()=>{r.focus(),r.select()});function a(){const s=r.value;n(s)}return r.addEventListener("keydown",s=>{s.key==="Tab"&&(s.preventDefault(),s.stopPropagation())}),r.addEventListener("keyup",s=>{if(s.key==="Tab"&&s.shiftKey&&t){const l=jl(s.target,"tabulator-row")?.previousSibling,u=l&&dv(l,"tabulator-editable");if(u)for(e of u)e.getAttribute("tabulator-field")===t&&e.focus()}else if((s.key==="Enter"||s.key==="Tab")&&t){const l=jl(s.target,"tabulator-row")?.nextSibling,u=l&&dv(l,"tabulator-editable");if(u)for(e of u)e.getAttribute("tabulator-field")===t&&e.focus()}}),r.addEventListener("blur",a),r},rj="fa-check-square",rg=t=>(e,i)=>{const n=i.getTable(),r=n.getColumns(),a=[];for(const s of r){const o=s.getDefinition();if(o.title){const l=document.createElement("i");l.classList.add("fas"),l.classList.add(s.isVisible()?rj:"fa-square");const u=document.createElement("span"),c=document.createElement("span"),d=t?.[o.field]||o.displayTitle||o.title;c.textContent=" "+d,u.appendChild(l),u.appendChild(c),a.push({label:u,action:function(p){p.stopPropagation(),s.toggle(),It.columns[s.getField()]=s.isVisible(),n.redraw(),s.isVisible()?(l.classList.remove("fa-square"),l.classList.add(rj)):(l.classList.remove(rj),l.classList.add("fa-square"))}})}}return a},{WTN:_at,UTR:kat}=Uo.ratingConstants,{FEMALE:xat,MALE:Oat}=eh,fte="ratings.utr.utrRating",mte="ratings.wtn.wtnRating";function Lat({data:t,replaceTableData:e}){const i=t.some(s=>s.cityState),n=t.some(s=>s.tennisId),r=t.some(s=>s.ratings?.utr),a=t.some(s=>s.ratings?.wtn);return[{cellClick:(s,o)=>o.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:hi,width:5},{headerMenu:rg({signedIn:"Sign In Status",sex:"Gender"}),formatter:"rownum",headerSort:!1,hozAlign:hi,width:55},{formatter:tS(({event:s,cell:o})=>z_(e)(s,o)),cellClick:z_(e),sorter:CU,field:"participant",responsive:!1,resizable:!1,minWidth:200,widthGrow:2,title:"Name"},{editor:Aat({field:"tennisId"}),visible:n,field:"tennisId",editable:!1,title:"WTID",width:120},{headerFilter:"input",title:"First Name",field:"firstName",visible:!1,width:150},{headerFilter:"input",title:"Last Name",field:"lastName",visible:!1,width:150},{title:'<i class="fa-solid fa-venus-mars" />',field:"sex",hozAlign:hi,editor:"list",width:80,editorParams:{itemFormatter:(s,o)=>o,values:{Male:Oat,Female:xat,"":"Unknown"}}},{title:"Country",field:"ioc",width:130,visible:!1,headerFilter:"input"},{title:"<div class='fa-solid fa-check' style='color: green' />",cellClick:Nat,formatter:"tickCross",resizable:!1,field:"signedIn",hozAlign:hi,tooltip:!1,width:40},{sorter:(s,o)=>(s.length||0)-(o?.length||0),formatter:Sat,title:"Penalties",field:"penalties",hozAlign:hi,visible:!1,width:130},{headerFilter:"input",title:"Club",field:"club",hozAlign:hi,minWidth:70,editor:!1,visible:!1},{sorter:(s,o)=>s?.[0]?.eventName?.localeCompare(o?.[0]?.eventName),formatter:XPe(Br),visible:hte("events"),title:"Events",field:"events",hozAlign:hi,minWidth:200,editor:!1,widthGrow:2},{sorter:(s,o)=>s?.[0]?.participantName?.localeCompare(o?.[0]?.participantName),formatter:QPe(()=>console.log("boo")),visible:hte("teams"),title:"Teams",field:"teams",hozAlign:hi,minWidth:200,editor:!1,widthGrow:2},{visible:!!i,title:"City/State",field:"cityState",minWidth:110},{editor:Mz({maxValue:40,decimals:!0,field:mte}),sorterParams:{alignEmptyValues:"bottom"},responsive:!0,resizable:!1,sorter:"number",field:mte,editable:!1,visible:!!a,title:_at,width:70},{editor:Mz({maxValue:16,decimals:!0,field:fte}),sorterParams:{alignEmptyValues:"bottom"},responsive:!0,resizable:!1,sorter:"number",field:fte,editable:!1,visible:!!r,title:kat,width:70},{cellClick:z_(e),formatter:Vv,responsive:!1,headerSort:!1,hozAlign:ti,maxWidth:40}]}const{INDIVIDUAL:Fat,GROUP:$at,TEAM:Bat}=qs,{OFFICIAL:gte,COMPETITOR:Vat}=Pv;function jat({view:t}={}){let e,i=[],n,r,a=[],s;const o={participantRoles:[t===gte?gte:Vat]},l=()=>{({participants:n=[],derivedEventInfo:r}=nt.getParticipants({withSignInStatus:!0,withScaleValues:!0,participantFilters:o,withEvents:!0,withISO2:!0}));const m=n.filter(({participantType:g})=>g===Fat);return i=n.filter(({participantType:g})=>g===$at),a=n.filter(({participantType:g})=>g===Bat),m?.map(g=>yat(g,r))||[]},u=()=>{const f=l(),m=f?.some(I=>I.cityState),g=f?.some(I=>I.tennisId),v=f?.some(I=>I.ratings?.utr),y=f?.some(I=>I.ratings?.wtn);m&&e?.showColumn("cityState"),g&&e?.showColumn("tennisId"),v&&e?.showColumn("ratings.utr.utrRating"),y&&e?.showColumn("ratings.wtn.wtnRating"),setTimeout(()=>e.replaceData(f),s?0:1e3)},c=l(),d=Lat({data:c,replaceTableData:u}),p=(f,m)=>(Mi.isNumeric(f)&&f||0)+(Mi.isNumeric(m)&&m||0);return(f=>{ng({anchorId:$k});const m=document.getElementById($k),g=jl(m,"section")?.querySelector(".tabHeader");e=new Bs(m,{headerSortElement:wf(["sex","signedIn","events","teams","ratings.wtn.wtnRating","ratings.utr.utrRating","cityState","tennisId"]),height:window.innerHeight*.86,placeholder:"No participants",index:"participantId",layout:"fitColumns",reactiveData:!0,columns:d,data:f});const v=y=>`Participants (${y.length})`;e.on("dataChanged",y=>g&&(g.innerHTML=v(y))),e.on("dataFiltered",(y,b)=>{g&&(g.innerHTML=v(b));const I=[],S=[];for(const E of b){const P=E.getData(),{wtn:M,utr:R}=P.ratings;Mi.isNumeric(R?.utrRating)&&S.push(parseFloat(R.utrRating)),Mi.isNumeric(M?.wtnRating)&&I.push(parseFloat(M.wtnRating))}const w=S.reduce(p,0),T=I.reduce(p,0),U=(S.length?w/S.length:0).toFixed(2),C=(I.length?T/I.length:0).toFixed(2);zi.averages&&console.log(`UTR ${U}x`),zi.averages&&console.log(`WTN ${C}x`)}),e.on("scrollVertical",Nd),e.on("tableBuilt",()=>s=!0)})(c),{table:e,replaceTableData:u,teamParticipants:a,groupParticipants:i}}function Gat(t,e){sE({className:"saveTennisId",columns:["tennisId"],visible:!0,table:e,e:t}),e.showColumn("tennisId"),e.redraw(!0)}function Hat(t,e){sE({columns:["ratings.wtn.wtnRating","ratings.utr.utrRating"],classNames:["saveRatings","saveTennisId"],visible:!1,table:e,e:t}),e.showColumn("ratings.utr.utrRating"),e.showColumn("ratings.wtn.wtnRating"),e.redraw(!0);const n=e.getData().flatMap(a=>{const s=a.ratings?.wtn,o=s?.wtnRating,l=s?.confidence||o?50:0;let u=l?{...s,wtnRating:o,confidence:l}:"";const c={method:Nee,params:{participantId:a.participantId,removePriorValues:!0,timeItem:{itemType:"SCALE.RATING.SINGLES.WTN",itemValue:u}}},d=a.ratings?.utr?.utrRating,p=d?50:0;u=p?{utrRating:d,confidence:p}:"";const h={method:Nee,params:{participantId:a.participantId,removePriorValues:!0,timeItem:{itemType:"SCALE.RATING.SINGLES.UTR",itemValue:u}}};return[c,h]});Wt({methods:n,callback:a=>{a.success||console.log(a)}})}const{COMPETITOR:zat,OTHER:qat}=Pv,{TEAM:vte}=qs;function eCe({individualParticipantIds:t,participantType:e=vte,title:i="Edit team",participant:n,refresh:r,table:a}){const s="participantName",o={[s]:n?.[s]};let l;const u=()=>{},c=f=>{l=mr(f,[{error:"Please enter a name of at least 3 characters",placeholder:"Participant name",value:o[s]||"",validator:Vr(3),field:s,onChange:u,label:"Name"}])},d=(f,m)=>eS(f,[{label:"Cancel",onClick:()=>a?.deselectRow(),close:!0},{label:"Save",onClick:p,close:!0,intent:"is-info"}],m);It.drawer.open({title:`<b style='larger'>${i}</b>`,callback:()=>{},width:"300px",side:ti,content:c,footer:d});function p(){a?.deselectRow(),n?.participantId?console.log("update existing"):h()}function h(){const f=e===vte?zat:qat,m={individualParticipantIds:t||n?.individualParticipantIds||[],participantName:l[s]?.value,participantRole:f,participantType:e};Wt({methods:[{params:{participants:[m]},method:CN}],callback:y=>{y.success?Mt(r)&&r&&r():console.log({result:y})}})}return{...iM}}const{TEAM:aj}=qs;function yte({participants:t,table:e,replaceTableData:i,participantType:n=aj}){const r=({team:o})=>{const u=e.getSelectedData().map(({participantId:p})=>p);e.deselectRow();const c=[{method:VEe,params:{groupingParticipantId:o.participantId,individualParticipantIds:u}}];Wt({methods:c,callback:p=>{p.success&&i()}})},a=()=>{const o=n===aj?"New team":"New Group",u=e.getSelectedData().map(({participantId:c})=>c);eCe({refresh:i,individualParticipantIds:u,participantType:n,participant:{},table:e,title:o})},s=n===aj?"Create new team":"Create new group";return{options:t.map(o=>({onClick:()=>r({team:o}),label:o.participantName,participant:o,close:!0})),actions:[{onClick:()=>a(),close:!0,label:s}]}}const Wat=t=>e=>{if(e.key==="Enter"){const n=t.getSelectedData().map(({participantId:o})=>o),s=t.getData("active").map(({participantId:o})=>o).filter(o=>!n.includes(o));s.length===1&&(t.selectRow(s),e.target.value="",t.clearFilter())}};function Yat(t,e){sE({classNames:["saveTennisId","saveRatings"],columns:["tennisId"],visible:!1,table:e,e:t}),e.showColumn("tennisId"),e.redraw(!0);const i=nt.getParticipants().participantMap,r=e.getData().map(a=>{const{tennisId:s,participantId:o}=a;if(s!==i[o].participant.person.tennisId)return{params:{participant:{participantId:o,person:{tennisId:s}}},method:$x}}).filter(Boolean);r.length&&Wt({methods:r,callback:s=>{s.success||console.log(s)}})}function tCe(t){let e;const i=l=>e===Rt?!l?.eventIds?.length:l?.eventIds?.includes(e),n=l=>{t.removeFilter(i),e=l,l&&t.addFilter(i)},r=nt.getEvents().events||[],a={label:`<span style='font-weight: bold'>${Qg}</span>`,onClick:()=>n(),close:!0},s={label:`<span style='font-weight: bold'>${Pje}</span>`,onClick:()=>n(Rt),close:!0};return{eventOptions:[a,s,{divider:!0}].concat(r.map(l=>({onClick:()=>n(l.eventId),label:l.eventName,close:!0}))),events:r}}const{WTN:Kat,UTR:Zat}=Uo.ratingConstants,{FEMALE:Xat,MALE:Jat,MIXED:Qat,ANY:est}=eh;function tst({callback:t}){let e;Yn({title:"Generate mock players",content:a=>e=mr(a,[{options:[{label:"Any",value:est,close:!0},{label:"Female",value:Xat,close:!0},{label:"Male",value:Jat,close:!0}],label:"Participant gender",field:"gender",value:32},{options:[{label:"8",value:8,close:!0},{label:"16",value:16,close:!0},{label:"32",value:32,close:!0},{label:"64",value:64,close:!0},{label:"128",value:128,close:!0},{label:"256",value:256,close:!0}],label:"Participant count",field:"participantsCount",value:32},{text:"Generate Ratings",header:!0},{label:"WTN",field:"wtnRating",id:"wtnRating",checkbox:!0},{label:"UTR",field:"utrRating",id:"utrRating",checkbox:!0}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Generate",intent:"is-info",close:!0,onClick:()=>{const a=e.participantsCount.value,s=e.wtnRating.checked,o=e.utrRating.checked,l=e.gender.value,u=l===Qat?void 0:l,c=[s&&{ratingType:Kat,ratingMin:14,ratingMax:19.99},o&&{ratingType:Zat,ratingMin:8,ratingMax:10}].filter(Boolean),{participants:d}=tM.generateParticipants({participantsCount:parseInt(a),scaleAllParticipants:!0,categories:c,sex:u});Wt({methods:[{method:CN,params:{participants:d}}],callback:t})}}]})}function ist({callback:t}){const e=r=>{const a=r?.players;a?.length?nst(a):a&&!a.length&&It.modal.inform({message:"Sheet Empty: No Player Rows"}),Mt(t)&&t&&t()},{extension:i}=nt.findExtension({discover:!0,name:Ey.REGISTRATION});i?.value||tst({callback:e})}function nst(t){console.log({registeredPlayers:t})}function rst({table:t,teamParticipants:e}){let i;const n=o=>o.teams.some(l=>l?.participantId===i),r=o=>{t.removeFilter(n),i=o,o&&t.addFilter(n)};return{teamOptions:[{label:`<span style='font-weight: bold'>${Cje}</span>`,onClick:()=>r(),close:!0},{divider:!0}].concat(e.sort((o,l)=>o?.participantName?.localeCompare(l?.participantName)).map(o=>({onClick:()=>r(o.participantId),label:o.participantName,close:!0})))}}function iCe(t){const i=t.getSelectedData().filter(r=>!r.events?.length).map(({participantId:r})=>r),n=()=>{KPe({participantIds:i,callback:a=>{a.success&&(t.deleteRow(i),t.deselectRow())}})};Yn({content:`Delete ${i.length} participants?`,onClose:()=>t.deselectRow(),title:"Delete participants",buttons:[{label:"Cancel",intent:Rt,close:!0},{label:"Delete",id:"deleteDraw",intent:"is-danger",close:!0,onClick:n}]})}const{FEMALE:bte,MALE:Ite,ANY:wte}=eh;function ast(t){let e;const i=l=>l.participant?.person?.sex===e,n=l=>{t.removeFilter(i),e=l,l&&t.addFilter(i)},r=[Ite,bte],a={[Ite]:"Male",[bte]:"Female",[wte]:Eje};return{sexOptions:[{label:`<span style='font-weight: bold'>${a[wte]}</span>`,onClick:()=>n(),close:!0},{divider:!0}].concat(r.map(l=>({onClick:()=>n(l),label:a[l],close:!0}))),genders:a}}const{SIGNED_IN:sst}=qs;function ost(t){const e=t.getSelectedData(),i=e.map(({participantId:a})=>a);Wt({methods:[{params:{signInState:sst,participantIds:i},method:bK}],callback:a=>{a.success&&(e.forEach(s=>s.signedIn=!0),t.updateData(e),t.deselectRow())}})}const{INDIVIDUAL:lst,SIGNED_OUT:ust}=qs;function cst(t){const i=nt.getParticipants({participantFilters:{participantTypes:[lst]},withSignInStatus:!0,withEvents:!0}).participants.filter(a=>a.signedIn&&!a.events.length).map(a=>a.participantId);Wt({methods:[{params:{signInState:ust,participantIds:i},method:bK}],callback:a=>{a.success&&t()}})}function dst(t){let e=0;if(t.length===0)return e;for(let i=0;i<t.length;i++){const n=t.charCodeAt(i);e=(e<<5)-e+n,e=e&e}return e}const Ig={participantName:["full name","name"],participantId:["id","participantid"],person:{standardFamilyName:["last","last name","last_name"],standardGivenName:["first","First Name","first_name"],nationalityCode:["ioc","country","nationality"],address:{city:["city"],state:["state"]},birthDate:["*birth"],sex:["gender","sex"]}};function pst({data:t,sheetId:e,callback:i}){const r=nt.getParticipants().participants.map(({participantId:u})=>u),a=Sm.countries.map(u=>[u.ioc,u.iso]).flat().filter(Boolean),s=[],o=u=>u.map(c=>[c.toLowerCase(),c.toLowerCase().split(" ").join("")]).flat(),l=u=>(c=[])=>{const d=Object.keys(u),p=o(c),h=p.reduce((m,g)=>u[g]||m,void 0),f=!h&&d.filter(m=>p.find(g=>g.startsWith("*")&&m.toLowerCase().includes(g.slice(1))));return h||u[f[0]]};for(const u of t||[]){const c=Object.assign({},...Object.keys(u).map(C=>({[C.toLowerCase()]:u[C]}))),d=l(c),p={participantType:"INDIVIDUAL",participantRole:"COMPETITOR",person:{}};p.participantName=d(Ig.participantName);const h=d(["tennis id","tennisid"]);h&&(p.person.tennisId=h);const f=d(Ig.person.standardFamilyName),m=d(Ig.person.standardGivenName);if(f&&m)p.person.standardFamilyName=f,p.person.standardGivenName=m,p.participantName=`${m} ${f}`;else continue;const g=d(Ig.person.address.state),v=d(Ig.person.address.city);(v||g)&&(p.person.addresses=[{city:v,state:g}]);const y=d(Ig.person.nationalityCode);y&&a.includes(y.toUpperCase())&&(p.person.nationalityCode=y);const b=d(Ig.person.birthDate);if(Mi.dateTime.dateValidation.test(b)){const C=Mi.dateTime.extractDate(b);C&&(p.person.birthDate=C)}const I=d(Ig.person.sex);if(I){const C=I.toUpperCase();["MALE","FEMALE"].includes(C)?p.person.sex=C:["F","W","G"].includes(I[0])?p.person.sex="FEMALE":["M","B"].includes(I[0])&&(p.person.sex="MALE")}const S=d(["utr profile"]);if(S){p.onlineResources||(p.onlineResources=[]);const C=S.split("profiles/")?.reverse()[0];C&&(p.person.personOtherIds||(p.person.personOtherIds=[]),p.person.personOtherIds.push({uniqueOrganisationName:"UTR",personId:C}),S.startsWith("http")&&p.onlineResources.push({resourceSubType:"PROFILE",identifier:S,name:"UTR Profile",resource:"URL"}))}const w=d(["utr"]);if(w){p.timeItems||(p.timeItems=[]);const C={itemType:"SCALE.RATING.SINGLES.UTR",itemValue:{utrRating:w}};p.timeItems.push(C)}const T=d(["wtn"]);if(T){p.timeItems||(p.timeItems=[]);const C={itemType:"SCALE.RATING.SINGLES.WTN",itemValue:{wtnRating:T}};p.timeItems.push(C)}p.participantId=d(Ig.participantId)||`XXX-${dst(p.participantName)}`,r.includes(p.participantId)||s.push(Mi.definedAttributes(p))}s.length?Wt({methods:[{method:CN,params:{participants:s}},{method:kJe,params:{extension:{name:Qme,value:e}}}],callback:d=>{d.success?(Ht({message:`Added ${d.results[0].addedCount} participant(s)`,intent:"is-success"}),Mt(i)&&i&&i()):console.log(d)}}):Ht({message:"No new participants found",intent:"is-primary"}),Mt(i)&&i&&i()}const nCe=t=>![null,void 0].includes(t),rCe=({c:t})=>t.map(e=>nCe(e?.v)?e:{});function Ste({header:t,rows:e,useFormat:i=!1}){const n=u=>HNe(u)&&/Date\((\d+),(\d+),(\d+)\)/.test(u),r=u=>u.f||u.v,a=u=>i||n(u.v)?r(u):u.v,s=(u,c,d)=>({...u,[t[d]]:a(c)}),o=(u,c,d)=>nCe(c.v)?s(u,c,d):u,l=u=>u.reduce((c,d,p)=>o(c,d,p),{});return e.map(rCe).map(l)}function hst(t){try{const e=t.split("setResponse(")[1].split(");")[0],i=JSON.parse(e),{cols:n,rows:r}=i.table??{},a=n.map(({label:s})=>s.split(" ")[0]);if(a.filter(Boolean).length)return Ste({header:a,rows:r});{const[s,...o]=r,l=rCe(s).map(u=>u.v);return console.log({header:l}),Ste({header:l,rows:o})}}catch(e){return console.error("Error parsing sheet response:",e),[]}}async function fst({sheetId:t}){const e=`https://docs.google.com/spreadsheets/d/${t}/gviz/tq?`;try{const i=await window.fetch(e);return i?.ok?i.text():void 0}catch(i){console.error("Error fetching sheet:",i);return}}async function mst({sheetId:t}){const e=await fst({sheetId:t});return e?hst(e):[]}const gst=`
  <b>Sharing Requirements</b>
  <ul>
    <li>Open your Google Sheet</li>
    <li>Click "Share" button (top right)</li>
    <li>Set to "Anyone with the link can view"</li>
    <li>Copy the shareable link</li>
  </ul>
  <br> 
  <b>Required Columns</b>
  <ul>
    <li><strong>First Name</strong> (or "first", "first_name")</li>
    <li><strong>Last Name</strong> (or "last", "last_name")</li>
  </ul>
  <br> 
  <b>Optional Columns</b>
  <ul>
    <li><strong>id</strong> or <strong>participantid</strong> - Unique identifier</li>
    <li><strong>Gender</strong> or <strong>sex</strong> - MALE, FEMALE, M, F, W, B, G</li>
    <li><strong>Birth Date</strong> - Format: YYYY-MM-DD</li>
    <li><strong>IOC</strong>, <strong>country</strong>, or <strong>nationality</strong> - 3-letter country code</li>
    <li><strong>City</strong> - City of residence</li>
    <li><strong>State</strong> - State/province</li>
    <li><strong>Tennis ID</strong> - Official tennis organization ID</li>
    <li><strong>UTR</strong> - Universal Tennis Rating (numeric)</li>
    <li><strong>WTN</strong> - World Tennis Number (numeric)</li>
    <li><strong>UTR Profile</strong> - Link to UTR profile page</li>
  </ul>
  <br> 
  <b>Column Name Flexibility</b>
  <ul>
    <li>Column names are case-insensitive</li>
    <li>Spaces and underscores are treated the same</li>
    <li>Partial matches work</li>
  </ul>`;function vst({callback:t}){const{extension:e}=nt.findExtension({discover:!0,name:Qme}),i=e?.value;let n;const r=d=>{n=mr(d,[{text:"Pull participants from a Google Sheet which has a shared link"},{placeholder:"URL of Google Sheet",value:i,label:"Sheet URL",field:"url"}])},a="Import participants",{update:s}=Yn({title:a,buttons:[],content:r}),o=()=>{const d=n.url.value;if(d){const p=d.split("/"),h=p.reduce((v,y)=>!v||y.length>v.length?y:v,void 0),f=!i||i&&h!==i,m=i||p.indexOf("docs.google.com")>0&&p.indexOf("spreadsheets")>0,g=f?h:i;if(m)m?mst({sheetId:g}).then(v=>pst({data:v,sheetId:g,callback:t})):Ht({message:"URL unchanged",intent:"is-info"});else{const v=_s.tr("phrases.invalidsheeturl");Ht({message:v,intent:"is-danger"}),n.url.value=""}}},l=()=>{s({buttons:c,content:r,title:a})},c=[{label:"Cancel",intent:"is-nothing"},{label:"Info",intent:"is-info",onClick:()=>{s({buttons:[{label:"Close",intent:"is-nothing",close:!0},{label:"Enter",intent:"is-primary",onClick:l,close:!1}],title:"Google Sheets Import Instructions",content:gst})},close:!1},{label:"Submit",intent:"is-primary",onClick:o,close:!0}];s({buttons:c})}const{ALTERNATE:yst,WILDCARD:bst,DIRECT_ACCEPTANCE:Tte,UNGROUPED:Ist}=md,{MAIN:Ute,QUALIFYING:wst}=Zr,{INDIVIDUAL:Sst}=qs,{TEAM:Dte,DOUBLES:Tst}=dl;function Ust({callback:t,eventName:e,eventType:i,participantType:n,participantIds:r}={}){const a=[Dte,Tst].includes(i)&&n===Sst;if(!r?.length){Ht({message:"Nothing to do",intent:"is-info"});return}const o=[{label:"Main",value:Ute,selected:!0},{label:"Qualifying",value:wst}].map(({label:p,value:h,selected:f})=>({selected:f,label:p,value:h})),l=[{hide:a,label:"Direct Acceptance",value:Tte,selected:!0},{hide:a,label:"Alternate",value:yst},{hide:a,label:"Wildcard",value:bst},{hide:n===Dte,label:"Ungrouped",value:Ist,selected:a}];let u;Yn({title:"Add to event",content:p=>u=mr(p,[{text:`Add ${r.length} participant to ${e}`},{options:o,label:"Event stage",field:"entryStage",value:Ute},{options:l,value:Tte,label:"Entry status",field:"entryStatus"}]),buttons:[{label:"Cancel",intent:Rt,close:!0},{label:"Add",intent:"is-info",close:!0,onClick:()=>{const p=u.entryStatus.value,h=u.entryStage.value;Mt(t)&&t&&t({entryStatus:p,entryStage:h})}}]})}function aCe({event:t,participantType:e,table:i,callback:n}){const r=i.getSelectedData(),{eventId:a,eventName:s,eventType:o}=t,l=r.filter(c=>!c.events.map(d=>d.eventId).includes(a)).map(({participantId:c})=>c);if(!l.length&&r.length){Ht({message:`All selected participants are already in ${s}`,intent:"is-info"});return}Ust({callback:({entryStatus:c,entryStage:d}={})=>{i.deselectRow(),Wt({methods:[{params:{eventId:a,participantIds:l,entryStatus:c,entryStage:d},method:vK}],callback:f=>{f.success?Mt(n)&&n&&n():(console.log({result:f}),f.misMatchedGender&&Ht({intent:"is-danger",message:"Invalid gender"}))}})},eventName:s,participantType:e,eventType:o,participantIds:l})}const{ALTERNATE:Dst,DIRECT_ACCEPTANCE:Est,UNGROUPED:Pst,STRUCTURE_SELECTED_STATUSES:Cst}=md,{ANY:pI,FEMALE:DS,MALE:ES,MIXED:hI}=eh,{DOUBLES:Qv,SINGLES:PS,TEAM:ey}=dl,{INDIVIDUAL:SA,PAIR:Ete}=qs,{MAIN:Rst}=Zr;function m2({table:t,event:e,participants:i,callback:n}={}){const r=nt.getEvents().events?.length||0,a=nt.getTournamentInfo()?.tournamentInfo||{},s={eventName:e?.eventName||`Event ${r+1}`,startDate:e?.startDate??a.startDate,endDate:e?.endDate??a.endDate,ageCategoryCode:e?.category?.ageCategoryCode,eventType:e?.eventType||PS,gender:e?.gender||pI},o=e?.entries?.filter(({entryStatus:w})=>[...Cst,Dst].includes(w)).map(({participantId:w})=>w),l=o?nt.getParticipants({participantFilters:{participantIds:o},withIndividualParticipants:!0}).participants:[];let u,c;const d=i?.[0].participantType;if(i?.length){s.eventType=d===SA&&PS||d===Ete&&Qv||ey,d===SA&&(u=[PS,Qv,ey]),d===Ete&&(u=[Qv]),d===ey&&(u=[ey]);const w=d===SA&&Mi.unique(i.map(T=>T.participant?.person?.sex));c=[pI],w.length===1?(w[0]===DS&&c.push(DS),w[0]===ES&&c.push(ES),s.gender=w[0]):w.length>1&&c.push(hI)}const p=[],h=l.reduce((w,T)=>{const U=T.person?.sex?[T.person.sex]:T.individualParticpants?.map(C=>C.person?.sex)||[];return p.push(U),w.includes(T.participantType)?w:w.concat(T.participantType)},[]),f=[];for(const w of[...l,...(i||[]).map(T=>T.participant)].filter(T=>T)){const T=w.timeItems?.filter(({itemType:U})=>U?.startsWith(`SCALE.RANKING.${s.eventType}`)).map(({itemType:U})=>U?.split(".").pop());f.push(T)}const m=Mi.unique(...f);if(m.length===1&&(s.ageCategoryCode=m[0]),p.length){c=[pI],e.gender&&!e.gender===pI&&c.push(e.gender),e.eventType===Qv&&!c.includes(hI)&&c.push(hI);const w=Mi.unique(...p);w.length===1&&!c.includes(w[0])&&c.push(...w)}else e&&(c=[pI,ES,hI,DS]);const g=()=>{},v=[{fields:["startDate","endDate"],minDate:a.startDate,maxDate:a.endDate,dateRange:!0}],y=w=>mr(w,[{error:"minimum of 5 characters",validator:Vr(5),placeholder:"Event name",value:s.eventName,onChange:g,selectOnFocus:!0,label:"Event name",field:"eventName",focus:!0},{disabled:h.length,value:s.eventType,field:"eventType",label:"Format",options:[{hide:u&&!u.includes(PS),selected:s.eventType===PS,label:"Singles",value:PS},{hide:u&&!u.includes(Qv),selected:s.eventType===Qv,label:"Doubles",value:Qv},{hide:u&&!u.includes(ey),selected:s.eventType===ey,label:"Team",value:ey}],onChange:g},{value:s.gender,label:"Gender",field:"gender",options:[{hide:c&&!c.includes(ES),selected:s.gender===ES,label:"Male",value:ES},{hide:c&&!c.includes(DS),selected:s.gender===DS,label:"Female",value:DS},{selected:s.gender===pI,label:"Any",value:pI},{hide:c&&!c.includes(hI),selected:s.gender===hI,label:"Mixed",value:hI}],onChange:g},{value:s.ageCategoryCode,field:"ageCategoryCode",label:"Category",options:[{selected:["",void 0].includes(s.ageCategoryCode),label:"------------",value:""},{selected:s.ageCategoryCode==="U10",label:"10 and Under",value:"U10"},{selected:s.ageCategoryCode==="U12",label:"12 and Under",value:"U12"},{selected:s.ageCategoryCode==="U14",label:"14 and Under",value:"U14"},{selected:s.ageCategoryCode==="U16",label:"16 and Under",value:"U16"},{selected:s.ageCategoryCode==="U18",label:"18 and Under",value:"U18"},{label:"Custom",value:"custom",disabled:!0}],onChange:g},{value:e?.startDate??a.startDate,placeholder:"YYYY-MM-DD",label:"Start date",field:"startDate"},{value:e?.endDate??a.endDate,placeholder:"YYYY-MM-DD",label:"End date",field:"endDate"},{hide:e||i,divider:!0}],v),b=()=>{const w=It.drawer.attributes.content.ageCategoryCode.value,T=It.drawer.attributes.content.eventName.value,U=It.drawer.attributes.content.eventType.value,C=It.drawer.attributes.content.startDate.value,E=It.drawer.attributes.content.endDate.value,P=It.drawer.attributes.content.gender.value,M={eventName:T,eventType:U,gender:P,startDate:C,endDate:E};w&&w!=="custom"&&(M.category={...e?.category,ageCategoryCode:w});const R=N=>{if(t?.deselectRow(),N.success){const A=N.results?.[0]?.event;Mt(n)&&n({...N,event:A,eventUpdates:M})}else N.error&&(Ht({intent:"is-warning",message:N.error?.message||"Error"}),Mt(n)&&n(N))};if(e){const N=e.eventId;Wt({methods:[{method:GJe,params:{eventId:N,eventUpdates:M}}],callback:R})}else{const N=w&&w!=="custom"?{ageCategoryCode:w}:void 0,A=Mi.UUID(),_=[{params:{event:{category:N,eventId:A,eventName:T,eventType:U,gender:P,startDate:C,endDate:E}},method:MJe}];if(i?.length){const x=i.map(({participantId:F})=>F),O=d===SA&&[Qv,ey].includes(U)?Pst:Est,$={params:{eventId:A,participantIds:x,entryStatus:O,entryStage:Rst},method:vK};_.push($)}Wt({methods:_,callback:R})}},I=(w,T)=>eS(w,[{label:"Cancel",onClick:()=>t?.deselectRow(),close:!0},{label:"Save",onClick:b,close:!0,intent:"is-info"}],T),S=e?.eventId?"Edit event":"Add event";It.drawer.open({title:`<b style='larger'>${S}</b>`,onClose:()=>t?.deselectRow(),width:"300px",side:ti,content:y,footer:I})}const Wx=(t,e)=>{const i=t.getSelectedData(),n=t.getData("active").map(s=>s.participantId),r=i.filter(s=>n.includes(s.participantId));m2({table:t,callback:s=>{if(t.deselectRow(),s?.success){const o=s?.results[0]?.event?.eventId;Mt(e)&&e?e({eventId:o}):o&&Br({eventId:o})}else Mt(e)&&e&&e()},participants:r})},{INDIVIDUAL:Pte,TEAM:Cte,GROUP:Rte}=qs,{OFFICIAL:Mte}=Pv,sCe=t=>[{label:"Individuals",value:Pte,isActive:t===Pte,close:!0},{label:"Officials",value:Mte,isActive:t===Mte,close:!0},{label:"Groups",value:Rte,isActive:t===Rte,close:!0},{label:"Teams",value:Cte,isActive:t===Cte,close:!0}].map(e=>({...e,onClick:()=>{if(e.value!==t){const n=`/tournament/${nt.getTournament().tournamentRecord.tournamentId}/${Tm}/${e.value}`;It.router.navigate(n)}}})),{INDIVIDUAL:Mst,GROUP:Nst}=qs,{OFFICIAL:Ast}=Pv,{ANY:_st}=eh,sj="is-primary";function oCe({view:t}){const{table:e,replaceTableData:i,teamParticipants:n,groupParticipants:r}=jat({view:t}),a=Q0(e),s=t===Ast?"Officials":"Individuals",{extension:o}=nt.findExtension({discover:!0,name:Ey.REGISTRATION}),l=o?.value,u=tc(),c=u?.roles?.includes("superadmin")||u?.permissions?.includes("editTennisId"),d=()=>oCe({view:t}),{eventOptions:p,events:h}=tCe(e),{sexOptions:f,genders:m}=ast(e),{teamOptions:g}=rst({table:e,teamParticipants:n}),b=[{onClick:()=>cst(i),label:"Sign out players not approved for events",close:!0},{onClick:E=>nat(E,e),label:"Edit ratings",close:!0},{onClick:E=>Gat(E,e),hide:!c,label:"Edit WTID",close:!0},{divider:!0},{heading:"Add participants"},{hide:l,label:"Generate mock participants",onClick:()=>{ist({callback:()=>{i(),e?.redraw(!0)}})},close:!0},{label:"Import from Google sheet",onClick:()=>vst({callback:i}),close:!0},{onClick:()=>ZPe({callback:i,view:t}),label:"New participant",close:!0}],I=h.map(E=>({onClick:()=>aCe({event:E,participantType:Mst,table:e,callback:d}),label:E.eventName,close:!0})).concat([{divider:!0},{label:'<p style="font-weight: bold">Create new event</p>',onClick:()=>Wx(e,d),close:!0}]),S=yte({participants:r,participantType:Nst,replaceTableData:i,table:e}),w=yte({participants:n,table:e,replaceTableData:i}),T=Wat(e),U=[{onKeyDown:E=>{E.keyCode===8&&E.target.value.length===1&&a(""),T(E)},onChange:E=>a(E.target.value),onKeyUp:E=>a(E.target.value),clearSearch:()=>a(""),placeholder:"Search participants",location:ba,search:!0},{options:I,label:"Add to event",hide:!h.length,intent:"is-none",location:ba},{onClick:()=>Wx(e,d),label:"Create event",hide:h.length,intent:"is-info",location:ba},{selection:w,label:"Add to team",intent:"is-none",location:ba},{selection:S,label:"Add to group",intent:"is-none",location:ba},{onClick:()=>ost(e),intent:sj,location:ba,label:"Sign in"},{onClick:()=>iCe(e),label:"Delete selected",intent:"is-danger",stateChange:!0,location:ba},{onKeyDown:E=>{E.keyCode===8&&E.target.value.length===1&&a(""),T(E)},onChange:E=>a(E.target.value),onKeyUp:E=>a(E.target.value),clearSearch:()=>a(""),placeholder:"Search participants",location:hi,search:!0},{hide:(h||[]).length<1,options:p,label:Qg,modifyLabel:!0,selection:!0,location:hi},{label:g[0]?.label||"",options:g,modifyLabel:!0,selection:!0,location:hi},{options:f,label:m[_st],modifyLabel:!0,selection:!0,location:hi},{options:sCe(t),label:s,intent:"is-info",modifyLabel:!0,location:ti,selection:!0,align:ti},{options:b,label:"Actions",selection:!1,location:ti,align:ti},{onClick:E=>Yat(E,e),class:"saveTennisId",intent:sj,label:"Save WTID",location:ti,visible:!1},{onClick:E=>Hat(E,e),label:"Save ratings",intent:sj,class:"saveRatings",location:ti,visible:!1}],C=document.getElementById(S6)||void 0;wo({table:e,target:C,items:U})}const kst=t=>{const e=document.createElement("ul");return Object.keys(t).length&&t.forEach(i=>{const n=document.createElement("li");if(i.field==="sex")n.innerHTML="<strong>Gender:&nbsp;</strong>"+i.value;else if(kp(i.value)){if(i.value){const r=document.createElement("div");r.innerHTML=`<strong>${i.title}:&nbsp;</strong>`,n.appendChild(r),n.appendChild(i.value)}}else n.innerHTML="<strong>"+i.title+"</strong>:&nbsp;"+i.value;e.appendChild(n)}),e};function xst(t,e){const{individualParticipantIds:i,individualParticipants:n,participantName:r,participantType:a,participantId:s,representing:o}=t,l=i?.length||0;return{events:qPe(t,e),eventIds:t.events.map(({eventId:u})=>u),searchText:r.toLowerCase(),representing:WPe(o),individualParticipants:n,participantName:r,participantType:a,participantId:s,membersCount:l}}function Ost({table:t,team:e}){const n=t.getSelectedData().map(({participantId:s})=>s);t.deselectRow();const r=[{method:WJe,params:{groupingParticipantId:e.participantId,individualParticipantIds:n,suppressErrors:!0}}];Wt({methods:r,callback:s=>{s.success&&t.deleteRow(n)}})}const{ALTERNATE_PARTICIPANT:Lst,ASSIGN_PARTICIPANT:Fst,LUCKY_PARTICIPANT:$st,QUALIFYING_PARTICIPANT:Bst,SWAP_PARTICIPANTS:Vst}=g0,jst={[Lst]:{selections:"availableAlternates",targetAttribute:"participantId",param:"alternateParticipantId",title:"Assign alternate"},[Fst]:{selections:"participantsAvailable",targetAttribute:"participantId",title:"Select participant"},[$st]:{selections:"availableLuckyLosers",targetAttribute:"participantId",param:"luckyLoserParticipantId",title:"Assign lucky loser"},[Bst]:{selections:"qualifyingParticipants",targetAttribute:"participantId",param:"qualifyingParticipantId",title:"Assign qualifier"},[Vst]:{selections:["availableAssignments","swappableParticipants"],targetAttribute:"drawPosition",title:"Swap draw positions",param:"drawPositions"},selectParticipants:{selections:"participantsAvailable",targetAttribute:"participantId",title:"Select participants"}};function _N(t){const{selectedParticipantIds:e,selectionLimit:i,activeOnEnter:n,selectOnEnter:r,onSelection:a,update:s,action:o}=t,l=jst[o.type];if(!l?.targetAttribute)return;const u=t.title||l.title||"Select participant";let c,d;const p=()=>{const E=l.targetAttribute,P=l.param||l.targetAttribute,M=Array.isArray(c)?c[0]?.[E]:c?.[E];if(o.type==="SWAP"){if(M)o.payload.drawPositions.push(M),a({[P]:o.payload.drawPositions});else if(c?.length===1){const R=c?.[0]?.participantId;o.payload.participantIds.push(R),a({participantIds:o.payload.participantIds})}}else M&&a({[P]:M,selected:c})},h="selectionControl",f="selectionTable",m=[{label:"Cancel",intent:"is-none",close:!0},{hide:i===1,label:"Select",intent:"is-info",onClick:p,close:!0}],g=()=>{It.tables.selectionTable?.destroy(),delete It.tables.selectionTable},v=`
    <div style='min-height: 420px'>
      <div id='${h}'></div>
      <div id='${f}'></div>
    </div>
  `;s?s({title:u,content:v,buttons:m,onClose:g}):Yn({title:u,content:v,buttons:m,onClose:g});const y=E=>{c=E,i&&c?.length===i&&(Aw(),p())},b=Array.isArray(l.selections)?o[l.selections.find(E=>o[E])]:o[l.selections],{table:I}=rPe({selectedParticipantIds:e,targetAttribute:l.targetAttribute,selectionLimit:i,onSelected:y,anchorId:f,data:b}),S=Q0(I),w=()=>{const E=I.getData("active");if(E.length===1){if(r)c=E[0],Aw(),p();else if(n){const P=c?.map(R=>R.participantId)||[],M=E[0].participantId;P.includes(M)||(Array.isArray(c)?c.push(E[0]):c=E,I.selectRow([M]),d.participantSearch.value="")}}},U=[{onKeyDown:E=>{E.key==="Backspace"&&E.target.value.length===1&&S(""),E.key==="Enter"&&w()},onChange:E=>S(E.target.value),onKeyUp:E=>S(E.target.value),clearSearch:()=>S(""),placeholder:"Search entries",id:"participantSearch",location:hi,search:!0,focus:!0}],C=document.getElementById(h)||void 0;d=wo({table:I,target:C,items:U})?.inputs}const{ASSIGN_PARTICIPANT:Gst}=g0,oj=Mi.extractAttributes,Hst=t=>{const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em",e.appendChild(i);const n="1px solid #333",r=document.createElement("div");r.style.backgroundColor="white",r.style.border=n,r.style.width="99%",e.className=qF,e.style.display=Rt,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=n,e.style.borderBottom=n,e.appendChild(r),t.getElement().appendChild(e);const a=t.getData(),s=d=>{const p={};return d?.map(h=>{const f=h.person?.sex||"OTHER";return p[f]||(p[f]=0),p[f]+=1,{...h,order:p[f]}})},o=s(a.individualParticipants),l=new Bs(r,{placeholder:"No individual participants",index:"participantId",layout:"fitColumns",movableRows:!0,maxHeight:400,data:o,columns:[{cellClick:(d,p)=>p.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:hi,width:5},{title:"Order",headerSort:!1,field:"order",width:70},{title:"Name",field:"participantName",formatter:tS(void 0)},{title:"Gender",field:"person.sex",width:100}]});l.on("scrollVertical",Nd),l.on("rowMoved",d=>{const p=d.getTable(),f=p.getData().map((v,y)=>({...v,order:y+1})).map(({participantId:v})=>v),m=[{params:{participant:{participantId:a.participantId,individualParticipantIds:f}},method:$x}];Wt({methods:m,callback:v=>{if(v.success){const y=p.getRows(),b=y.map(S=>S.getData()),I=s(b);y.forEach((S,w)=>S.update(I[w]))}}})}),wo({table:l,target:i,items:[{onClick:()=>Ost({table:l,team:a}),label:"Delete selected",intent:"is-danger",stateChange:!0,location:ba},{onClick:()=>{const d=g=>{if(g.participantId){const v=g.selected,y=(g.selected?g.selected.map(oj("participantId")):[g.participantId]).filter(Boolean),b=(a.individualParticipants??[]).map(oj("participantId")).concat(y);if(y?.length){const I=[{method:VEe,params:{groupingParticipantId:a.participantId,individualParticipantIds:y}},{params:{participant:{participantId:a.participantId,individualParticipantIds:b}},method:$x}];Wt({methods:I,callback:w=>{w.success&&(a.individualParticipants=(a.individualParticipants??[]).concat(v),a.membersCount=a.individualParticipants.length,t.update(a),t.getTable().redraw(!0))}})}}},p=a.individualParticipants?.map(oj("participantId"))||[],{participants:h}=nt.getParticipants({participantFilters:{participantTypes:["INDIVIDUAL"]},withISO2:!0}),f=h.filter(({participantId:g})=>!p.includes(g));_N({title:"Select players to add",activeOnEnter:!0,selectionLimit:99,onSelection:d,action:{type:Gst,participantsAvailable:f}})},label:"Add players",intent:"is-primary",location:ti}]})},HK="&#9660;",lCe=" &#9654;",Xf="&#8964;",uCe=` <span class='tabulator-responsive-collapse-toggle-close toggleCaret'> ${HK} </span>`,cCe=`<span class='tabulator-responsive-collapse-toggle-open toggleCaret'> ${lCe} </span>`,dCe=qF;function tw(t,e){const i=e.getRow(),n=i._row.element.getElementsByClassName(dCe)[0];if(n){const r=n.style.display!==Rt;n.style.display=r?Rt:"";const s=i.getCells().find(o=>o.getColumn().getDefinition().field===vge)?._cell?.element;return s&&(s.innerHTML=r?cCe:uCe),{open:!r}}}function zK(t){return t.getRow()._row.element.getElementsByClassName(dCe)[0]?.style.display!==Rt?cCe:uCe}const{GROUP:zst}=qs;function qst({view:t,replaceTableData:e}){const i=(n,r)=>{tw(n,r)?.open};return[{cellClick:(n,r)=>r.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",responsive:!1,headerSort:!1,hozAlign:hi,width:5},{formatter:"responsiveCollapse",width:50,minWidth:50,hozAlign:di,resizable:!1,headerSort:!1},{headerMenu:rg({matchUpsCount:"Total MatchUps",membersCount:"Individuals",winLoss:"Win/Loss"}),formatter:"rownum",headerSort:!1,hozAlign:hi,width:55},{cellClick:(n,r)=>i(n,r),field:"participantName",title:"Name",minWidth:200,widthGrow:1},{sorter:(n,r)=>n?.[0]?.eventName?.localeCompare(r?.[0]?.eventName),formatter:XPe(Br),visible:t!==zst,hozAlign:hi,field:"events",title:"Events",minWidth:300,editor:!1,widthGrow:2},{title:'<div class="event_icon opponents_header" />',headerTooltip:"Individuals",headerHozAlign:di,field:"membersCount",hozAlign:di,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon matches_header" />',headerTooltip:"Total MatchUps",headerHozAlign:di,field:"matchUpsCount",hozAlign:di,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon winloss_header" />',headerTooltip:"Win/Loss",headerHozAlign:di,field:"winLoss",hozAlign:di,headerSort:!0,visible:!0,width:50},{field:"representing",title:"Representing",visible:!1,minWidth:200},{cellClick:i,formatter:zK,responsive:!1,headerSort:!1,hozAlign:ti,field:vge,width:20},{cellClick:z_(e),formatter:Vv,responsive:!1,headerSort:!1,hozAlign:ti,width:20}]}const{TEAM:lj}=qs;function Wst({view:t}={}){let e,i,n,r;const a=()=>({participants:i,derivedEventInfo:n}=nt.getParticipants({participantFilters:{participantTypes:[t||lj]},withIndividualParticipants:!0,withScaleValues:!0,withEvents:!0,withISO2:!0}),i.map(c=>xst(c,n))),s=()=>{setTimeout(()=>e.replaceData(a()),r?0:1e3)},o=qst({view:t});return(u=>{ng({anchorId:jk});const c=document.getElementById(jk),d=jl(c,"section")?.querySelector(".tabHeader");e=new Bs(c,{headerSortElement:wf(["events","membersCount","matchUpsCount","winLoss"]),responsiveLayoutCollapseFormatter:kst,responsiveLayoutCollapseStartOpen:!1,minHeight:window.innerHeight*.81,height:window.innerHeight*.86,placeholder:"No team participants",rowFormatter:Hst,responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,data:u,columns:o}),e.on("dataChanged",p=>{const h=t===lj?"Teams":"Groups";d&&(d.innerHTML=`${h} (${p.length})`)}),e.on("dataFiltered",(p,h)=>{const f=t===lj?"Teams":"Groups";d&&(d.innerHTML=`${f} (${h.length})`)}),e.on("scrollVertical",Nd),e.on("tableBuilt",()=>r=!0)})(a()),{table:e,replaceTableData:s}}const Yst={country:{personAttribute:"nationalityCode"},city:{accessor:"person.addresses.city"}};function Kst({callback:t}={}){const e=[{label:_s.tr("cnt"),value:"country"},{label:"City",value:"city"}],i="-";Yn({title:"Create Team",content:a=>mr(a,[{options:[{label:"Select attribute",value:i},...e],label:"Attribute",field:"selection",value:""}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Create",intent:"is-primary",onClick:({content:a})=>{const s=a?.selection.value;if(!s||s===i)return;const o=Yst[s],l=nt.createTeamsFromParticipantAttributes({...o,addParticipants:!1});if(l.newParticipants){const u=[{params:{participants:l.newParticipants},method:CN}];Wt({methods:u,callback:t})}},close:!0}],onClose:()=>{}})}const{TEAM:Nte}=qs;function Zst({view:t}){const{table:e,replaceTableData:i}=Wst({view:t}),n=Q0(e),{eventOptions:r,events:a}=tCe(e),s=[{label:"New team",onClick:()=>eCe({title:"New team",refresh:i})},{label:"Generate teams",onClick:()=>Kst({callback:i})}],l=[{label:'<p style="font-weight: bold">Create new event</p>',onClick:()=>Wx(e,i),close:!0},{divider:!0}].concat(a.filter(({eventType:p})=>p===Nte).map(p=>({onClick:()=>aCe({event:p,participantType:Nte,table:e,callback:i}),label:p.eventName,close:!0}))),u=t==="GROUP"?"Groups":"Teams",c=[{onKeyDown:p=>p.keyCode===8&&p.target.value.length===1&&n(""),onChange:p=>n(p.target.value),onKeyUp:p=>n(p.target.value),clearSearch:()=>n(""),placeholder:"Search teams",location:ba,search:!0},{options:l,label:"Add to event",hide:!a.length,intent:"is-none",location:ba},{onClick:()=>Wx(e,i),label:"Create event",hide:a.length,intent:"is-info",location:ba},{onClick:()=>iCe(e),label:"Delete selected",intent:"is-danger",stateChange:!0,location:ba},{onKeyDown:p=>p.keyCode===8&&p.target.value.length===1&&n(""),onChange:p=>n(p.target.value),onKeyUp:p=>n(p.target.value),clearSearch:()=>n(""),placeholder:"Search teams",location:hi,search:!0},{hide:r.length<2,options:r,modifyLabel:!0,label:Qg,location:hi,selection:!0},{options:sCe(t),label:u,modifyLabel:!0,intent:"is-info",location:ti,selection:!0,align:ti},{options:s,label:"Actions",selection:!1,location:ti,align:ti}],d=document.getElementById(C6)||void 0;wo({table:e,target:d,items:c})}const{INDIVIDUAL:Xst,TEAM:Jst,GROUP:Qst}=qs;function eot({participantView:t=Xst}={}){const e=t.toUpperCase(),i=[Jst,Qst].includes(e),n=document.getElementById("individuals"),r=document.getElementById("participantGroupings");i?(n&&(n.style.display=Rt),r&&(r.style.display="")):(r&&(r.style.display=Rt),n&&(n.style.display="")),i?Zst({view:e}):oCe({view:e})}var pCe=function(t){return String.prototype.normalize?t.normalize("NFKD").replace(/[\u0300-\u036F]/g,""):t};const{TEAM:tot}=dl,oE=t=>{const{potentialParticipants:e,matchUpType:i,matchUpId:n,eventName:r,roundName:a,schedule:s,eventId:o,drawId:l,gender:u,sides:c,...d}=t,{scheduledDate:p,scheduledTime:h,courtName:f}=s||{},m=A=>A.person?.standardFamilyName||A.participantName,g=e?.map(A=>({participantName:A.map(m).filter(Boolean).join(" or ")}))||[],v=c?.[0]?.participant||g.shift(),y=c?.[1]?.participant||g.shift(),b={participantName:v?.participantName,sex:v?.person?.sex,participant:v},I={participantName:y?.participantName,sex:y?.person?.sex,participant:y},S=c.flatMap(({participant:A})=>A?.individualParticipantIds?.length?A.individualParticipantIds:A?.participantId).filter(Boolean),w=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,T=!!d.winningSide,U=!!(d.winningSide||d.readyToScore),C=d.score?.scoreStringSide1,E=c.flatMap(A=>{const _=A.participant?.person;return _?[_.standardGivenName,_.standardFamilyName]:A.participant?.individualParticipants?.map(({person:x})=>[x.standardGivenName,x.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),P=pCe([E,v?.participantName,y?.participantName].filter(Boolean).join(" ")).toLowerCase(),M=t.collectionId?tot:i,R=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,N={score:C,matchUpStatus:t.matchUpStatus,readyToScore:U,complete:T,winningSide:w};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:S,flight:t.drawName,competitiveProfile:R,scheduledDate:p,readyToScore:U,scheduledTime:h,matchUpType:i,scoreDetail:N,winningSide:w,searchText:P,courtName:f,eventName:r,eventType:M,matchUpId:n,roundName:a,complete:T,eventId:o,matchUp:t,gender:u,drawId:l,side1:b,side2:I,score:C}};function hCe(t,e){const i=t.target.id;t.dataTransfer?.setData("itemid",i),e&&t.dataTransfer&&(t.dataTransfer.setData("itemtype",Aje),t.dataTransfer.setDragImage(It.dragMatch,10,10)),t.dataTransfer&&(t.dataTransfer.effectAllowed="move")}const{MALE:iot,FEMALE:not}=eh;function rot(t){function e(a){const s=document.createElement("div"),o=a.getValue(),l=kp(o)&&o?.sex===iot&&"#2E86C1"||o?.sex===not&&"#AA336A"||"";return s.style.color=l,s.innerHTML=(kp(o)?o.participantName:o)||"",s}function i(a){const s=document.createElement("div");return s.innerHTML=a.getValue(),s}function n(a){const s=a.getElement();return s.classList.add("tag"),s.classList.add("is-info"),s.classList.add("is-light"),t?.length||0}const r=(a,s)=>a.participantName&&!s.participantName||s.participantName&&!a.participantName||!a?.participantName&&!s?.participantName?1:a?.participantName?.localeCompare(s?.participantName);return[{titleFormatter:n,formatter:"rownum",headerSort:!1,hozAlign:di,frozen:!0,width:55},{formatter:i,field:"eventName",resizable:!1,title:"Event",visible:!0,minWidth:250},{title:"Flight",field:"flight"},{formatter:i,field:"roundName",resizable:!1,title:"Round",minWidth:90},{formatter:e,sorter:r,responsive:!1,resizable:!1,title:"Side 1",minWidth:120,field:"side1"},{formatter:e,sorter:r,responsive:!1,resizable:!1,title:"Side 2",minWidth:120,field:"side2"},{field:"matchUp.matchUpFormat",title:"Scoring Format",formatter:i,responsive:!1,resizable:!1,minWidth:100}]}const Ate=Object.keys(age);function aot(t,e){return Ate.indexOf(t.issue)-Ate.indexOf(e.issue)}function Yx(t){const e=t.getData(),i=e.flatMap(s=>Object.values(s).filter(kp)).filter(s=>s.matchUpId),{courtIssues:n,rowIssues:r}=wm.proConflicts({matchUps:i});n&&Object.keys(n)?.length,e?.length&&t.updateData(e);const a=t.getColumns()[0].getCells();r?.length&&r.forEach((s,o)=>{const l=o+1,u=a.find(c=>c.getData().rowNumber===l);if(u){u.getElement().classList.forEach(d=>{d.startsWith("matchup")&&u.getElement().classList.remove(d)});const c=u.getData();if(s.length){s.sort(aot),c.issues=s;const d=age[s[0].issue];u.getElement().classList.add(d)}else u.getElement().style.backgroundColor="white",c.issues=[]}else console.log("control cell not found",{rowNumber:l})})}function sot(t,e){t.preventDefault();const i=t.dataTransfer?.getData("itemid"),n=Bs.findTable("#tournamentSchedule")[0],a=n.getData().flatMap(m=>Object.values(m).filter(g=>g&&typeof g=="object"&&"matchUpId"in g)).find(m=>m.matchUpId===i)||{};if(!a?.schedule?.courtId)return;let s;const o=n.getData().find(m=>(s=Object.keys(m).find(g=>{if(kp(m[g]))return m[g].matchUpId===i}),s)),{courtId:l,courtOrder:u,venueId:c}=a.schedule;o&&s&&(o[s]={schedule:{courtOrder:u,courtId:l,venueId:c}},n.updateData([o])),delete a.schedule.scheduledDate,delete a.schedule.scheduledTime,delete a.schedule.courtOrder,delete a.schedule.courtId,delete a.schedule.venueId;const d={scheduledTime:"",scheduledDate:"",courtOrder:"",venueId:"",courtId:""},p=[{method:pz,params:{tournamentId:a.tournamentId,matchUpId:a.matchUpId,schedule:d,drawId:a.drawId,removePriorValues:!0}}];Wt({methods:p,engine:d6,callback:m=>!m.success&&console.log({result:m})}),a.schedule=d;const f=oE(a);e.addRow(f,!0),Yx(n)}const{SINGLES:oot,DOUBLES:lot}=dl;function uot({scheduledDate:t}={}){const e=t;let i=[],n,r;function a(d){const p=d.getElement(),f=d.getData().matchUp.matchUpId;p.id=f,p.addEventListener("dragstart",m=>hCe(m,!0)),p.draggable=!0}function s({scheduledDate:d}){const p=wm.allCompetitionMatchUps({matchUpFilters:{matchUpStatuses:Uo.upcomingMatchUpStatuses,matchUpTypes:[oot,lot]},nextMatchUps:!0}).matchUps?.filter(m=>!m.schedule?.courtId&&!m.sides?.some(({bye:g})=>g))||[],h=d||e;return i=p.filter(m=>!m.schedule?.scheduledDate||m.schedule.scheduledDate===h),{rowMatchUps:i.map(oE)}}function o({scheduledDate:d}={}){return setTimeout(()=>{const{rowMatchUps:h=[]}=s({scheduledDate:d});r&&r.replaceData(h)},n?0:1e3),{unscheduledMatchUps:i}}const l=rot(i);ng({anchorId:VI});const u=document.getElementById(VI),{rowMatchUps:c=[]}=s({scheduledDate:e});return r=new Bs(u,{headerSortElement:wf(["flight"]),placeholder:"No unscheduled matches",rowFormatter:a,layout:"fitDataStretch",index:"matchUpId",data:c,height:250,columns:l}),r.on("tableBuilt",()=>{n=!0;const d=u?.getElementsByClassName("tabulator-tableholder")[0];d.addEventListener("drop",p=>sot(p,r)),d.ondragover=p=>p.preventDefault(),d.draggable=!0}),r.on("dataChanged",d=>{const p=r.getColumns()[0]._getSelf().titleElement;p.innerHTML=`${d.length}`}),r.on("dataFiltered",(d,p)=>{const h=r.getColumns()[0]._getSelf().titleElement;h.innerHTML=`${p.length}`}),r.on("rowClick",(d,p)=>{const h=p.getData();console.log({matchUp:h})}),{table:r,replaceTableData:o,unscheduledMatchUps:i}}function qK(t,e){return t?Mi.dateTime.convertTime(t,e):""}function cot(t){const e=qK(t,!0).split(":");return+e[0]*60*60+ +e[1]*60+(+e[2]||0)}function _te(t){return t.toString()[1]?t.toString():"0"+t}function dot(t,e){let i=Math.floor(t/3600),n=Math.floor((t-i*3600)/60);return e&&(n=0,i+=1,i>23&&(i=0)),`${_te(i)}:${_te(n)}`}function pot(t){const{matchUp:e}=t??{};let i;const n=()=>{console.log({matchUp:e,inputs:i}),Mt(t.callback)&&console.log("Callback")},r=zi.scales[zi.activeScale],a=({matchUp:y,sideNumber:b})=>{const I=y?.sides.find(S=>S.sideNumber===b)?.participant;return hK({composition:{configuration:{participantDetail:"TEAM",genderColor:!0,winnerColor:!0,scaleAttributes:r,flag:!1}},placeholder:"TBD",participant:I,sideNumber:b,matchUp:y})},s=a({matchUp:e,sideNumber:1}),o=a({matchUp:e,sideNumber:2}),l="space-between",u="flex-end",c=document.createElement("div");c.style.flexDirection="column",c.style.display="flex",c.style.padding="1em",c.style.width="100%";const d=(y,b)=>{const I=document.createElement("div");return I.style.justifyContent=l,I.style.marginBottom=y,I.style.flexDirection="row",I.style.display="flex",I.appendChild(b),I},p=d("0.5em",s),h=d("0em",o),f=(y,b)=>{const I=document.createElement("input");return I.style.marginLeft="0.5em",I.className="input",I.style.width="2em",I.id=`i${y}-${b}`,I},m=(y,b)=>{const I=document.createElement("div");I.style.marginBottom=y,I.style.justifyContent=u,I.style.flexDirection="row",I.style.display="flex";const S=f(b,1),w=f(b,2);return I.appendChild(S),I.appendChild(w),I},g=m("0.5em",1);p.appendChild(g);const v=m("0em",2);h.appendChild(v),c.appendChild(p),c.appendChild(h),Yn({title:"Score entry",content:c,buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:n,intent:"is-primary",id:"submitScore",disabled:!1,label:"Submit",close:!0}]})}const hot=""+new URL("completed-DD-jSIm6.png",import.meta.url).href;function fCe(t){return Object.assign({},...Object.keys(t).map(e=>({[e]:{id:t[e],element:document.getElementById(t[e])}})))}const fot=(function(){let t={};t.display=({muid:l,teams:u})=>{let c={scoreboard:"sbId"},{ids:d,html:p}=e({muid:l,teams:u});return Yn({content:p}),Object.assign(d,c),fCe(d)};function e({muid:l,teams:u,round_name:c,match:d}){let p={root:"sb-root",actions:"sb-actions",favorite:"sb-favorite",scoring:"sb-scoring",delegate:"sb-delegate",docs:"sb-docs",clear:"sb-clear",cancel:"sb-cancel",accept:"sb-accept",p1action:"sb-p1action",p2action:"sb-p2action",p1scores:"sb-p1scores",p2scores:"sb-p2score",round_name:"sb-round-name",p1scores_e:"sb-p1scores-e",p2scores_e:"sb-p2scores-e",p1selector:"sb-p1selector",p2selector:"sb-p2selector",p1tiebreak:"sb-p1tiebreak",p2tiebreak:"sb-p2tiebreak",details:"sb-details"},h=i();Object.assign(p,h.ids);let f=`
         <div id="${p.root}" class="scoreboard noselect muid ${p.root}" muid='${l}'>
            <div class='scorebox'>
               <div class='info'>
                  <span class="info-text">
                     <span class="round_name" id='${p.round_name}'>${c||""}</span>
                  </span>
                  <div id='${p.favorite}' class='fav favoriteMatch' style='display: none'></div>
                  <div id='${p.scoring}' class='options' style='display: none'>-</div>
               </div>
               <div class='sbox'>
                  <div class='sbcol flexgrow'> 
                     <div class="opponent opponent0">
                        <div class="opponent-name">
                           <div class="name-detail">
                              ${s({team:u[0],index:0})}
                              ${s({team:u[0],index:1})}
                           </div>
                        </div>
                     </div>
               
                     <div class="opponent opponent1">
                        <div class="opponent-name">
                           <div class="name-detail">
                              ${s({team:u[1],index:0})}
                              ${s({team:u[1],index:1})}
                           </div>
                        </div>
                     </div>
                  </div>

                  <div class='sbcol'> 
                     <div class="opponent opponent0">
                        <div id="${p.p1scores}" class="opponent-scores"></div>
                        <div id="${p.p1selector}" class="score-selector"></div>
                        <div class="score-selector tbinput"> <input id="${p.p1tiebreak}"> </div>
                        <div id="${p.p1scores_e}" class="opponent-scores"></div>
                     </div>
               
                     <div class="opponent opponent1">
                        <div id="${p.p2scores}" class="opponent-scores"></div>
                        <div id="${p.p2selector}" class="score-selector"></div>
                        <div class="score-selector tbinput"> <input id="${p.p2tiebreak}"> </div>
                        <div id="${p.p2scores_e}" class="opponent-scores"></div>
                     </div>
                  </div>

                  <div class='sbcol'>
                     <div class="opponent opponent0">
                        <div id="${p.p1action}" class="score-action"></div>
                     </div>
                     <div class="opponent opponent1">
                        <div id="${p.p2action}" class="score-action"></div>
                     </div>
                  </div>

                  <div class='sbcol'>
                     <div class="opponent opponent0">&nbsp;</div>
                     <div class="opponent opponent1">&nbsp;</div>
                  </div>

               </div>
               <div class="info">
                  <span class="info-text"> <span id="${p.details}" class="court">${r(d)}</span> </span>
                  <div id='${p.delegate}' class='options' style='display: none'>&#x25B7;</div>
               </div>
            </div>

            ${h.html}

            <div id='${p.actions}' class="scoreboard-action">
               <div class="edit flexcol">
                  <div class="frame">
                     <div class="scoreboard-actions">
                        <button id='${p.cancel}' class='btn dismiss'>${_s.tr("actions.cancel")}</button>
                        <button id='${p.clear}' class='btn dismiss'>${_s.tr("clr")}</button>
                        <button id='${p.accept}' class='btn accept'>${_s.tr("apt")}</button>
                     </div>
                  </div>
               </div>
            </div>

         </div>
      `;return{ids:p,html:f}}function i(){let l={edit_scoring:"sbcfg-edit",bestof:"sbcfg-bestof",setsto:"sbcfg-setsto",tiebreaksat:"sbcfg-tiebreasat",tiebreaksto:"sbcfg-tiebreaksto",finalset:"sbcfg-finalset",supertiebreakto:"sbcfg-supertbto",stb2:"sbcfg-stb2"},u=`
            <div id='${l.edit_scoring}' class="scoreboard-config scoreboard-action">
               <div class="edit configure sb_flexrow">
                  <div class='flexcol' style='width: 25%'>
                     <div style='text-align: right'>${_s.tr("scoring_format.bestof")}</div>
                     <div style='text-align: right'>${_s.tr("scoring_format.tbat")}</div>
                     <div style='text-align: right'>${_s.tr("scoring_format.finalset")}</div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div id="${l.bestof}" class="score-selector"></div>
                     <div id="${l.tiebreaksat}" class="score-selector"></div>
                     <div id="${l.finalset}" class="score-selector"></div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div style='text-align: right'>${_s.tr("scoring_format.setsto")}</div>
                     <div style='text-align: right'>${_s.tr("scoring_format.tbto")}</div>
                     <div id='${l.stb2}' style='text-align: right'>${_s.tr("scoring_format.superto")}</div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div id="${l.setsto}" class="score-selector"></div>
                     <div id="${l.tiebreaksto}" class="score-selector"></div>
                     <div id="${l.supertiebreakto}" class="score-selector"></div>
                  </div>
               </div>
            </div>
      `;return{ids:l,html:u}}const n=(l,u)=>{let c=parseInt(l,10),d=Math.floor(c/3600),p=Math.floor((c-d*3600)/60),h=c-d*3600-p*60,f=!u||u?.display_seconds,m=!u||u?.pad_hours;return d<10&&m&&(d="0"+d),p<10&&(p="0"+p),h<10&&(h="0"+h),f?d+":"+p+":"+h:d+":"+p};function r(l){if(!l)return"";if(l.status)return l.status;if(!l.schedule)return"";let u=a(l.schedule);if(u)return`Duration ${u}`;let c=`${l.schedule.time_prefix||""}${l.schedule.time||""}`,d=`${l.schedule.court||""}${c?" / "+c:""}`;return l.winner_index===void 0?d:""}function a(l){if(!l.start||!l.end)return"";let u=o(l.end)-o(l.start);return n(u,{pad_hours:!1,display_seconds:!1})}function s({team:l,index:u=0}){if(u===1)return"";const c=l.person?.nationalityCode;return`
         <div class="team_player">
            <span class="pad">${c?Sm.countryToFlag(c)?.slice(0,4):""}</span>
            <span class="pad">${l.participantName}</span>
            <span class="pad"></span>
         </div>
      `}function o(l){let u=l.split(":");return u[0]*60*60+u[1]*60}return t})();function mCe(t,e){if(!t||!e)return;const i=Object.keys(t),n=Object.keys(e);for(const r of i)if(n.indexOf(r)>=0){const a=e[r],s=t[r];typeof a=="object"&&typeof s!="function"&&a.constructor!==Array?mCe(t[r],e[r]):e[r]=t[r]}}function gCe(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function mot(t){return t.length===1&&(t=got(t)),{left:function(e,i,n,r){for(n==null&&(n=0),r==null&&(r=e.length);n<r;){var a=n+r>>>1;t(e[a],i)<0?n=a+1:r=a}return n},right:function(e,i,n,r){for(n==null&&(n=0),r==null&&(r=e.length);n<r;){var a=n+r>>>1;t(e[a],i)>0?r=a:n=a+1}return n}}}function got(t){return function(e,i){return gCe(t(e),i)}}mot(gCe);var vot={value:function(){}};function vCe(){for(var t=0,e=arguments.length,i={},n;t<e;++t){if(!(n=arguments[t]+"")||n in i||/[\s.]/.test(n))throw new Error("illegal type: "+n);i[n]=[]}return new q_(i)}function q_(t){this._=t}function yot(t,e){return t.trim().split(/^|\s+/).map(function(i){var n="",r=i.indexOf(".");if(r>=0&&(n=i.slice(r+1),i=i.slice(0,r)),i&&!e.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:n}})}q_.prototype=vCe.prototype={constructor:q_,on:function(t,e){var i=this._,n=yot(t+"",i),r,a=-1,s=n.length;if(arguments.length<2){for(;++a<s;)if((r=(t=n[a]).type)&&(r=bot(i[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<s;)if(r=(t=n[a]).type)i[r]=kte(i[r],t.name,e);else if(e==null)for(r in i)i[r]=kte(i[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new q_(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var i=new Array(r),n=0,r,a;n<r;++n)i[n]=arguments[n+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],n=0,r=a.length;n<r;++n)a[n].value.apply(e,i)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],r=0,a=n.length;r<a;++r)n[r].value.apply(e,i)}};function bot(t,e){for(var i=0,n=t.length,r;i<n;++i)if((r=t[i]).name===e)return r.value}function kte(t,e,i){for(var n=0,r=t.length;n<r;++n)if(t[n].name===e){t[n]=vot,t=t.slice(0,n).concat(t.slice(n+1));break}return i!=null&&t.push({name:e,value:i}),t}var Nz="http://www.w3.org/1999/xhtml";const xte={svg:"http://www.w3.org/2000/svg",xhtml:Nz,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function g2(t){var e=t+="",i=e.indexOf(":");return i>=0&&(e=t.slice(0,i))!=="xmlns"&&(t=t.slice(i+1)),xte.hasOwnProperty(e)?{space:xte[e],local:t}:t}function Iot(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===Nz&&e.documentElement.namespaceURI===Nz?e.createElement(t):e.createElementNS(i,t)}}function wot(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function yCe(t){var e=g2(t);return(e.local?wot:Iot)(e)}function Sot(){}function WK(t){return t==null?Sot:function(){return this.querySelector(t)}}function Tot(t){typeof t!="function"&&(t=WK(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a=e[r],s=a.length,o=n[r]=new Array(s),l,u,c=0;c<s;++c)(l=a[c])&&(u=t.call(l,l.__data__,c,a))&&("__data__"in l&&(u.__data__=l.__data__),o[c]=u);return new Kd(n,this._parents)}function Uot(){return[]}function bCe(t){return t==null?Uot:function(){return this.querySelectorAll(t)}}function Dot(t){typeof t!="function"&&(t=bCe(t));for(var e=this._groups,i=e.length,n=[],r=[],a=0;a<i;++a)for(var s=e[a],o=s.length,l,u=0;u<o;++u)(l=s[u])&&(n.push(t.call(l,l.__data__,u,s)),r.push(l));return new Kd(n,r)}function ICe(t){return function(){return this.matches(t)}}function Eot(t){typeof t!="function"&&(t=ICe(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a=e[r],s=a.length,o=n[r]=[],l,u=0;u<s;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&o.push(l);return new Kd(n,this._parents)}function wCe(t){return new Array(t.length)}function Pot(){return new Kd(this._enter||this._groups.map(wCe),this._parents)}function Kx(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Kx.prototype={constructor:Kx,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Cot(t){return function(){return t}}var Ote="$";function Rot(t,e,i,n,r,a){for(var s=0,o,l=e.length,u=a.length;s<u;++s)(o=e[s])?(o.__data__=a[s],n[s]=o):i[s]=new Kx(t,a[s]);for(;s<l;++s)(o=e[s])&&(r[s]=o)}function Mot(t,e,i,n,r,a,s){var o,l,u={},c=e.length,d=a.length,p=new Array(c),h;for(o=0;o<c;++o)(l=e[o])&&(p[o]=h=Ote+s.call(l,l.__data__,o,e),h in u?r[o]=l:u[h]=l);for(o=0;o<d;++o)h=Ote+s.call(t,a[o],o,a),(l=u[h])?(n[o]=l,l.__data__=a[o],u[h]=null):i[o]=new Kx(t,a[o]);for(o=0;o<c;++o)(l=e[o])&&u[p[o]]===l&&(r[o]=l)}function Not(t,e){if(!t)return h=new Array(this.size()),u=-1,this.each(function(w){h[++u]=w}),h;var i=e?Mot:Rot,n=this._parents,r=this._groups;typeof t!="function"&&(t=Cot(t));for(var a=r.length,s=new Array(a),o=new Array(a),l=new Array(a),u=0;u<a;++u){var c=n[u],d=r[u],p=d.length,h=t.call(c,c&&c.__data__,u,n),f=h.length,m=o[u]=new Array(f),g=s[u]=new Array(f),v=l[u]=new Array(p);i(c,d,m,g,v,h,e);for(var y=0,b=0,I,S;y<f;++y)if(I=m[y]){for(y>=b&&(b=y+1);!(S=g[b])&&++b<f;);I._next=S||null}}return s=new Kd(s,n),s._enter=o,s._exit=l,s}function Aot(){return new Kd(this._exit||this._groups.map(wCe),this._parents)}function _ot(t,e,i){var n=this.enter(),r=this,a=this.exit();return n=typeof t=="function"?t(n):n.append(t+""),e!=null&&(r=e(r)),i==null?a.remove():i(a),n&&r?n.merge(r).order():r}function kot(t){for(var e=this._groups,i=t._groups,n=e.length,r=i.length,a=Math.min(n,r),s=new Array(n),o=0;o<a;++o)for(var l=e[o],u=i[o],c=l.length,d=s[o]=new Array(c),p,h=0;h<c;++h)(p=l[h]||u[h])&&(d[h]=p);for(;o<n;++o)s[o]=e[o];return new Kd(s,this._parents)}function xot(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var n=t[e],r=n.length-1,a=n[r],s;--r>=0;)(s=n[r])&&(a&&s.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(s,a),a=s);return this}function Oot(t){t||(t=Lot);function e(d,p){return d&&p?t(d.__data__,p.__data__):!d-!p}for(var i=this._groups,n=i.length,r=new Array(n),a=0;a<n;++a){for(var s=i[a],o=s.length,l=r[a]=new Array(o),u,c=0;c<o;++c)(u=s[c])&&(l[c]=u);l.sort(e)}return new Kd(r,this._parents).order()}function Lot(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Fot(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function $ot(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t}function Bot(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],r=0,a=n.length;r<a;++r){var s=n[r];if(s)return s}return null}function Vot(){var t=0;return this.each(function(){++t}),t}function jot(){return!this.node()}function Got(t){for(var e=this._groups,i=0,n=e.length;i<n;++i)for(var r=e[i],a=0,s=r.length,o;a<s;++a)(o=r[a])&&t.call(o,o.__data__,a,r);return this}function Hot(t){return function(){this.removeAttribute(t)}}function zot(t){return function(){this.removeAttributeNS(t.space,t.local)}}function qot(t,e){return function(){this.setAttribute(t,e)}}function Wot(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Yot(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(t):this.setAttribute(t,i)}}function Kot(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function Zot(t,e){var i=g2(t);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((e==null?i.local?zot:Hot:typeof e=="function"?i.local?Kot:Yot:i.local?Wot:qot)(i,e))}function SCe(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Xot(t){return function(){this.style.removeProperty(t)}}function Jot(t,e,i){return function(){this.style.setProperty(t,e,i)}}function Qot(t,e,i){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(t):this.style.setProperty(t,n,i)}}function elt(t,e,i){return arguments.length>1?this.each((e==null?Xot:typeof e=="function"?Qot:Jot)(t,e,i??"")):RU(this.node(),t)}function RU(t,e){return t.style.getPropertyValue(e)||SCe(t).getComputedStyle(t,null).getPropertyValue(e)}function tlt(t){return function(){delete this[t]}}function ilt(t,e){return function(){this[t]=e}}function nlt(t,e){return function(){var i=e.apply(this,arguments);i==null?delete this[t]:this[t]=i}}function rlt(t,e){return arguments.length>1?this.each((e==null?tlt:typeof e=="function"?nlt:ilt)(t,e)):this.node()[t]}function TCe(t){return t.trim().split(/^|\s+/)}function YK(t){return t.classList||new UCe(t)}function UCe(t){this._node=t,this._names=TCe(t.getAttribute("class")||"")}UCe.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function DCe(t,e){for(var i=YK(t),n=-1,r=e.length;++n<r;)i.add(e[n])}function ECe(t,e){for(var i=YK(t),n=-1,r=e.length;++n<r;)i.remove(e[n])}function alt(t){return function(){DCe(this,t)}}function slt(t){return function(){ECe(this,t)}}function olt(t,e){return function(){(e.apply(this,arguments)?DCe:ECe)(this,t)}}function llt(t,e){var i=TCe(t+"");if(arguments.length<2){for(var n=YK(this.node()),r=-1,a=i.length;++r<a;)if(!n.contains(i[r]))return!1;return!0}return this.each((typeof e=="function"?olt:e?alt:slt)(i,e))}function ult(){this.textContent=""}function clt(t){return function(){this.textContent=t}}function dlt(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function plt(t){return arguments.length?this.each(t==null?ult:(typeof t=="function"?dlt:clt)(t)):this.node().textContent}function hlt(){this.innerHTML=""}function flt(t){return function(){this.innerHTML=t}}function mlt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function glt(t){return arguments.length?this.each(t==null?hlt:(typeof t=="function"?mlt:flt)(t)):this.node().innerHTML}function vlt(){this.nextSibling&&this.parentNode.appendChild(this)}function ylt(){return this.each(vlt)}function blt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ilt(){return this.each(blt)}function wlt(t){var e=typeof t=="function"?t:yCe(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Slt(){return null}function Tlt(t,e){var i=typeof t=="function"?t:yCe(t),n=e==null?Slt:typeof e=="function"?e:WK(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)})}function Ult(){var t=this.parentNode;t&&t.removeChild(this)}function Dlt(){return this.each(Ult)}function Elt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Plt(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Clt(t){return this.select(t?Plt:Elt)}function Rlt(t){return arguments.length?this.property("__data__",t):this.node().__data__}var PCe={};if(typeof document<"u"){var Mlt=document.documentElement;"onmouseenter"in Mlt||(PCe={mouseenter:"mouseover",mouseleave:"mouseout"})}function Nlt(t,e,i){return t=CCe(t,e,i),function(n){var r=n.relatedTarget;(!r||r!==this&&!(r.compareDocumentPosition(this)&8))&&t.call(this,n)}}function CCe(t,e,i){return function(n){t.call(this,this.__data__,e,i)}}function Alt(t){return t.trim().split(/^|\s+/).map(function(e){var i="",n=e.indexOf(".");return n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),{type:e,name:i}})}function _lt(t){return function(){var e=this.__on;if(e){for(var i=0,n=-1,r=e.length,a;i<r;++i)a=e[i],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.capture):e[++n]=a;++n?e.length=n:delete this.__on}}}function klt(t,e,i){var n=PCe.hasOwnProperty(t.type)?Nlt:CCe;return function(r,a,s){var o=this.__on,l,u=n(e,a,s);if(o){for(var c=0,d=o.length;c<d;++c)if((l=o[c]).type===t.type&&l.name===t.name){this.removeEventListener(l.type,l.listener,l.capture),this.addEventListener(l.type,l.listener=u,l.capture=i),l.value=e;return}}this.addEventListener(t.type,u,i),l={type:t.type,name:t.name,value:e,listener:u,capture:i},o?o.push(l):this.__on=[l]}}function xlt(t,e,i){var n=Alt(t+""),r,a=n.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,u=o.length,c;l<u;++l)for(r=0,c=o[l];r<a;++r)if((s=n[r]).type===c.type&&s.name===c.name)return c.value}return}for(o=e?klt:_lt,i==null&&(i=!1),r=0;r<a;++r)this.each(o(n[r],e,i));return this}function RCe(t,e,i){var n=SCe(t),r=n.CustomEvent;typeof r=="function"?r=new r(e,i):(r=n.document.createEvent("Event"),i?(r.initEvent(e,i.bubbles,i.cancelable),r.detail=i.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Olt(t,e){return function(){return RCe(this,t,e)}}function Llt(t,e){return function(){return RCe(this,t,e.apply(this,arguments))}}function Flt(t,e){return this.each((typeof e=="function"?Llt:Olt)(t,e))}var MCe=[null];function Kd(t,e){this._groups=t,this._parents=e}function kN(){return new Kd([[document.documentElement]],MCe)}Kd.prototype=kN.prototype={constructor:Kd,select:Tot,selectAll:Dot,filter:Eot,data:Not,enter:Pot,exit:Aot,join:_ot,merge:kot,order:xot,sort:Oot,call:Fot,nodes:$ot,node:Bot,size:Vot,empty:jot,each:Got,attr:Zot,style:elt,property:rlt,classed:llt,text:plt,html:glt,raise:ylt,lower:Ilt,append:wlt,insert:Tlt,remove:Dlt,clone:Clt,datum:Rlt,on:xlt,dispatch:Flt};function $lt(t){return typeof t=="string"?new Kd([[document.querySelector(t)]],[document.documentElement]):new Kd([[t]],MCe)}function KK(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function NCe(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}function xN(){}var m1=.7,Zx=1/m1,yT="\\s*([+-]?\\d+)\\s*",g1="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",lm="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Blt=/^#([0-9a-f]{3,8})$/,Vlt=new RegExp("^rgb\\("+[yT,yT,yT]+"\\)$"),jlt=new RegExp("^rgb\\("+[lm,lm,lm]+"\\)$"),Glt=new RegExp("^rgba\\("+[yT,yT,yT,g1]+"\\)$"),Hlt=new RegExp("^rgba\\("+[lm,lm,lm,g1]+"\\)$"),zlt=new RegExp("^hsl\\("+[g1,lm,lm]+"\\)$"),qlt=new RegExp("^hsla\\("+[g1,lm,lm,g1]+"\\)$"),Lte={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};KK(xN,v1,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Fte,formatHex:Fte,formatHsl:Wlt,formatRgb:$te,toString:$te});function Fte(){return this.rgb().formatHex()}function Wlt(){return ACe(this).formatHsl()}function $te(){return this.rgb().formatRgb()}function v1(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=Blt.exec(t))?(i=e[1].length,e=parseInt(e[1],16),i===6?Bte(e):i===3?new Ad(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?TA(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?TA(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Vlt.exec(t))?new Ad(e[1],e[2],e[3],1):(e=jlt.exec(t))?new Ad(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Glt.exec(t))?TA(e[1],e[2],e[3],e[4]):(e=Hlt.exec(t))?TA(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=zlt.exec(t))?Gte(e[1],e[2]/100,e[3]/100,1):(e=qlt.exec(t))?Gte(e[1],e[2]/100,e[3]/100,e[4]):Lte.hasOwnProperty(t)?Bte(Lte[t]):t==="transparent"?new Ad(NaN,NaN,NaN,0):null}function Bte(t){return new Ad(t>>16&255,t>>8&255,t&255,1)}function TA(t,e,i,n){return n<=0&&(t=e=i=NaN),new Ad(t,e,i,n)}function Ylt(t){return t instanceof xN||(t=v1(t)),t?(t=t.rgb(),new Ad(t.r,t.g,t.b,t.opacity)):new Ad}function Az(t,e,i,n){return arguments.length===1?Ylt(t):new Ad(t,e,i,n??1)}function Ad(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}KK(Ad,Az,NCe(xN,{brighter:function(t){return t=t==null?Zx:Math.pow(Zx,t),new Ad(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?m1:Math.pow(m1,t),new Ad(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Vte,formatHex:Vte,formatRgb:jte,toString:jte}));function Vte(){return"#"+uj(this.r)+uj(this.g)+uj(this.b)}function jte(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}function uj(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function Gte(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new Gf(t,e,i,n)}function ACe(t){if(t instanceof Gf)return new Gf(t.h,t.s,t.l,t.opacity);if(t instanceof xN||(t=v1(t)),!t)return new Gf;if(t instanceof Gf)return t;t=t.rgb();var e=t.r/255,i=t.g/255,n=t.b/255,r=Math.min(e,i,n),a=Math.max(e,i,n),s=NaN,o=a-r,l=(a+r)/2;return o?(e===a?s=(i-n)/o+(i<n)*6:i===a?s=(n-e)/o+2:s=(e-i)/o+4,o/=l<.5?a+r:2-a-r,s*=60):o=l>0&&l<1?0:s,new Gf(s,o,l,t.opacity)}function Klt(t,e,i,n){return arguments.length===1?ACe(t):new Gf(t,e,i,n??1)}function Gf(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}KK(Gf,Klt,NCe(xN,{brighter:function(t){return t=t==null?Zx:Math.pow(Zx,t),new Gf(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?m1:Math.pow(m1,t),new Gf(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,r=2*i-n;return new Ad(cj(t>=240?t-240:t+120,r,n),cj(t,r,n),cj(t<120?t+240:t-120,r,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(t===1?")":", "+t+")")}}));function cj(t,e,i){return(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)*255}function _Ce(t){return function(){return t}}function Zlt(t,e){return function(i){return t+i*e}}function Xlt(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}function Jlt(t){return(t=+t)==1?kCe:function(e,i){return i-e?Xlt(e,i,t):_Ce(isNaN(e)?i:e)}}function kCe(t,e){var i=e-t;return i?Zlt(t,i):_Ce(isNaN(t)?e:t)}const Hte=(function t(e){var i=Jlt(e);function n(r,a){var s=i((r=Az(r)).r,(a=Az(a)).r),o=i(r.g,a.g),l=i(r.b,a.b),u=kCe(r.opacity,a.opacity);return function(c){return r.r=s(c),r.g=o(c),r.b=l(c),r.opacity=u(c),r+""}}return n.gamma=t,n})(1);function my(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}var _z=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,dj=new RegExp(_z.source,"g");function Qlt(t){return function(){return t}}function eut(t){return function(e){return t(e)+""}}function tut(t,e){var i=_z.lastIndex=dj.lastIndex=0,n,r,a,s=-1,o=[],l=[];for(t=t+"",e=e+"";(n=_z.exec(t))&&(r=dj.exec(e));)(a=r.index)>i&&(a=e.slice(i,a),o[s]?o[s]+=a:o[++s]=a),(n=n[0])===(r=r[0])?o[s]?o[s]+=r:o[++s]=r:(o[++s]=null,l.push({i:s,x:my(n,r)})),i=dj.lastIndex;return i<e.length&&(a=e.slice(i),o[s]?o[s]+=a:o[++s]=a),o.length<2?l[0]?eut(l[0].x):Qlt(e):(e=l.length,function(u){for(var c=0,d;c<e;++c)o[(d=l[c]).i]=d.x(u);return o.join("")})}var zte=180/Math.PI,kz={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function xCe(t,e,i,n,r,a){var s,o,l;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(l=t*i+e*n)&&(i-=t*l,n-=e*l),(o=Math.sqrt(i*i+n*n))&&(i/=o,n/=o,l/=o),t*n<e*i&&(t=-t,e=-e,l=-l,s=-s),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*zte,skewX:Math.atan(l)*zte,scaleX:s,scaleY:o}}var NE,pj,qte,UA;function iut(t){return t==="none"?kz:(NE||(NE=document.createElement("DIV"),pj=document.documentElement,qte=document.defaultView),NE.style.transform=t,t=qte.getComputedStyle(pj.appendChild(NE),null).getPropertyValue("transform"),pj.removeChild(NE),t=t.slice(7,-1).split(","),xCe(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))}function nut(t){return t==null||(UA||(UA=document.createElementNS("http://www.w3.org/2000/svg","g")),UA.setAttribute("transform",t),!(t=UA.transform.baseVal.consolidate()))?kz:(t=t.matrix,xCe(t.a,t.b,t.c,t.d,t.e,t.f))}function OCe(t,e,i,n){function r(u){return u.length?u.pop()+" ":""}function a(u,c,d,p,h,f){if(u!==d||c!==p){var m=h.push("translate(",null,e,null,i);f.push({i:m-4,x:my(u,d)},{i:m-2,x:my(c,p)})}else(d||p)&&h.push("translate("+d+e+p+i)}function s(u,c,d,p){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),p.push({i:d.push(r(d)+"rotate(",null,n)-2,x:my(u,c)})):c&&d.push(r(d)+"rotate("+c+n)}function o(u,c,d,p){u!==c?p.push({i:d.push(r(d)+"skewX(",null,n)-2,x:my(u,c)}):c&&d.push(r(d)+"skewX("+c+n)}function l(u,c,d,p,h,f){if(u!==d||c!==p){var m=h.push(r(h)+"scale(",null,",",null,")");f.push({i:m-4,x:my(u,d)},{i:m-2,x:my(c,p)})}else(d!==1||p!==1)&&h.push(r(h)+"scale("+d+","+p+")")}return function(u,c){var d=[],p=[];return u=t(u),c=t(c),a(u.translateX,u.translateY,c.translateX,c.translateY,d,p),s(u.rotate,c.rotate,d,p),o(u.skewX,c.skewX,d,p),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,d,p),u=c=null,function(h){for(var f=-1,m=p.length,g;++f<m;)d[(g=p[f]).i]=g.x(h);return d.join("")}}}var rut=OCe(iut,"px, ","px)","deg)"),aut=OCe(nut,", ",")",")"),MU=0,YE=0,AE=0,LCe=1e3,Xx,KE,Jx=0,kw=0,v2=0,y1=typeof performance=="object"&&performance.now?performance:Date,FCe=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function y2(){return kw||(FCe(sut),kw=y1.now()+v2)}function sut(){kw=0}function Qx(){this._call=this._time=this._next=null}Qx.prototype=$Ce.prototype={constructor:Qx,restart:function(t,e,i){if(typeof t!="function")throw new TypeError("callback is not a function");i=(i==null?y2():+i)+(e==null?0:+e),!this._next&&KE!==this&&(KE?KE._next=this:Xx=this,KE=this),this._call=t,this._time=i,xz()},stop:function(){this._call&&(this._call=null,this._time=1/0,xz())}};function $Ce(t,e,i){var n=new Qx;return n.restart(t,e,i),n}function out(){y2(),++MU;for(var t=Xx,e;t;)(e=kw-t._time)>=0&&t._call.call(null,e),t=t._next;--MU}function Wte(){kw=(Jx=y1.now())+v2,MU=YE=0;try{out()}finally{MU=0,uut(),kw=0}}function lut(){var t=y1.now(),e=t-Jx;e>LCe&&(v2-=e,Jx=t)}function uut(){for(var t,e=Xx,i,n=1/0;e;)e._call?(n>e._time&&(n=e._time),t=e,e=e._next):(i=e._next,e._next=null,e=t?t._next=i:Xx=i);KE=t,xz(n)}function xz(t){if(!MU){YE&&(YE=clearTimeout(YE));var e=t-kw;e>24?(t<1/0&&(YE=setTimeout(Wte,t-y1.now()-v2)),AE&&(AE=clearInterval(AE))):(AE||(Jx=y1.now(),AE=setInterval(lut,LCe)),MU=1,FCe(Wte))}}function Yte(t,e,i){var n=new Qx;return e=e==null?0:+e,n.restart(function(r){n.stop(),t(r+e)},e,i),n}var cut=vCe("start","end","cancel","interrupt"),dut=[],BCe=0,Kte=1,Oz=2,W_=3,Zte=4,Lz=5,Y_=6;function b2(t,e,i,n,r,a){var s=t.__transition;if(!s)t.__transition={};else if(i in s)return;put(t,i,{name:e,index:n,group:r,on:cut,tween:dut,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:BCe})}function ZK(t,e){var i=Sf(t,e);if(i.state>BCe)throw new Error("too late; already scheduled");return i}function jv(t,e){var i=Sf(t,e);if(i.state>W_)throw new Error("too late; already running");return i}function Sf(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function put(t,e,i){var n=t.__transition,r;n[e]=i,i.timer=$Ce(a,0,i.time);function a(u){i.state=Kte,i.timer.restart(s,i.delay,i.time),i.delay<=u&&s(u-i.delay)}function s(u){var c,d,p,h;if(i.state!==Kte)return l();for(c in n)if(h=n[c],h.name===i.name){if(h.state===W_)return Yte(s);h.state===Zte?(h.state=Y_,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete n[c]):+c<e&&(h.state=Y_,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete n[c])}if(Yte(function(){i.state===W_&&(i.state=Zte,i.timer.restart(o,i.delay,i.time),o(u))}),i.state=Oz,i.on.call("start",t,t.__data__,i.index,i.group),i.state===Oz){for(i.state=W_,r=new Array(p=i.tween.length),c=0,d=-1;c<p;++c)(h=i.tween[c].value.call(t,t.__data__,i.index,i.group))&&(r[++d]=h);r.length=d+1}}function o(u){for(var c=u<i.duration?i.ease.call(null,u/i.duration):(i.timer.restart(l),i.state=Lz,1),d=-1,p=r.length;++d<p;)r[d].call(t,c);i.state===Lz&&(i.on.call("end",t,t.__data__,i.index,i.group),l())}function l(){i.state=Y_,i.timer.stop(),delete n[e];for(var u in n)return;delete t.__transition}}function hut(t,e){var i=t.__transition,n,r,a=!0,s;if(i){e=e==null?null:e+"";for(s in i){if((n=i[s]).name!==e){a=!1;continue}r=n.state>Oz&&n.state<Lz,n.state=Y_,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete i[s]}a&&delete t.__transition}}function fut(t){return this.each(function(){hut(this,t)})}function mut(t,e){var i,n;return function(){var r=jv(this,t),a=r.tween;if(a!==i){n=i=a;for(var s=0,o=n.length;s<o;++s)if(n[s].name===e){n=n.slice(),n.splice(s,1);break}}r.tween=n}}function gut(t,e,i){var n,r;if(typeof i!="function")throw new Error;return function(){var a=jv(this,t),s=a.tween;if(s!==n){r=(n=s).slice();for(var o={name:e,value:i},l=0,u=r.length;l<u;++l)if(r[l].name===e){r[l]=o;break}l===u&&r.push(o)}a.tween=r}}function vut(t,e){var i=this._id;if(t+="",arguments.length<2){for(var n=Sf(this.node(),i).tween,r=0,a=n.length,s;r<a;++r)if((s=n[r]).name===t)return s.value;return null}return this.each((e==null?mut:gut)(i,t,e))}function XK(t,e,i){var n=t._id;return t.each(function(){var r=jv(this,n);(r.value||(r.value={}))[e]=i.apply(this,arguments)}),function(r){return Sf(r,n).value[e]}}function VCe(t,e){var i;return(typeof e=="number"?my:e instanceof v1?Hte:(i=v1(e))?(e=i,Hte):tut)(t,e)}function yut(t){return function(){this.removeAttribute(t)}}function but(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Iut(t,e,i){var n,r=i+"",a;return function(){var s=this.getAttribute(t);return s===r?null:s===n?a:a=e(n=s,i)}}function wut(t,e,i){var n,r=i+"",a;return function(){var s=this.getAttributeNS(t.space,t.local);return s===r?null:s===n?a:a=e(n=s,i)}}function Sut(t,e,i){var n,r,a;return function(){var s,o=i(this),l;return o==null?void this.removeAttribute(t):(s=this.getAttribute(t),l=o+"",s===l?null:s===n&&l===r?a:(r=l,a=e(n=s,o)))}}function Tut(t,e,i){var n,r,a;return function(){var s,o=i(this),l;return o==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),l=o+"",s===l?null:s===n&&l===r?a:(r=l,a=e(n=s,o)))}}function Uut(t,e){var i=g2(t),n=i==="transform"?aut:VCe;return this.attrTween(t,typeof e=="function"?(i.local?Tut:Sut)(i,n,XK(this,"attr."+t,e)):e==null?(i.local?but:yut)(i):(i.local?wut:Iut)(i,n,e))}function Dut(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}function Eut(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}function Put(t,e){var i,n;function r(){var a=e.apply(this,arguments);return a!==n&&(i=(n=a)&&Eut(t,a)),i}return r._value=e,r}function Cut(t,e){var i,n;function r(){var a=e.apply(this,arguments);return a!==n&&(i=(n=a)&&Dut(t,a)),i}return r._value=e,r}function Rut(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;var n=g2(t);return this.tween(i,(n.local?Put:Cut)(n,e))}function Mut(t,e){return function(){ZK(this,t).delay=+e.apply(this,arguments)}}function Nut(t,e){return e=+e,function(){ZK(this,t).delay=e}}function Aut(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Mut:Nut)(e,t)):Sf(this.node(),e).delay}function _ut(t,e){return function(){jv(this,t).duration=+e.apply(this,arguments)}}function kut(t,e){return e=+e,function(){jv(this,t).duration=e}}function xut(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?_ut:kut)(e,t)):Sf(this.node(),e).duration}function Out(t,e){if(typeof e!="function")throw new Error;return function(){jv(this,t).ease=e}}function Lut(t){var e=this._id;return arguments.length?this.each(Out(e,t)):Sf(this.node(),e).ease}function Fut(t){typeof t!="function"&&(t=ICe(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a=e[r],s=a.length,o=n[r]=[],l,u=0;u<s;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&o.push(l);return new fv(n,this._parents,this._name,this._id)}function $ut(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,n=e.length,r=i.length,a=Math.min(n,r),s=new Array(n),o=0;o<a;++o)for(var l=e[o],u=i[o],c=l.length,d=s[o]=new Array(c),p,h=0;h<c;++h)(p=l[h]||u[h])&&(d[h]=p);for(;o<n;++o)s[o]=e[o];return new fv(s,this._parents,this._name,this._id)}function But(t){return(t+"").trim().split(/^|\s+/).every(function(e){var i=e.indexOf(".");return i>=0&&(e=e.slice(0,i)),!e||e==="start"})}function Vut(t,e,i){var n,r,a=But(e)?ZK:jv;return function(){var s=a(this,t),o=s.on;o!==n&&(r=(n=o).copy()).on(e,i),s.on=r}}function jut(t,e){var i=this._id;return arguments.length<2?Sf(this.node(),i).on.on(t):this.each(Vut(i,t,e))}function Gut(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}function Hut(){return this.on("end.remove",Gut(this._id))}function zut(t){var e=this._name,i=this._id;typeof t!="function"&&(t=WK(t));for(var n=this._groups,r=n.length,a=new Array(r),s=0;s<r;++s)for(var o=n[s],l=o.length,u=a[s]=new Array(l),c,d,p=0;p<l;++p)(c=o[p])&&(d=t.call(c,c.__data__,p,o))&&("__data__"in c&&(d.__data__=c.__data__),u[p]=d,b2(u[p],e,i,p,u,Sf(c,i)));return new fv(a,this._parents,e,i)}function qut(t){var e=this._name,i=this._id;typeof t!="function"&&(t=bCe(t));for(var n=this._groups,r=n.length,a=[],s=[],o=0;o<r;++o)for(var l=n[o],u=l.length,c,d=0;d<u;++d)if(c=l[d]){for(var p=t.call(c,c.__data__,d,l),h,f=Sf(c,i),m=0,g=p.length;m<g;++m)(h=p[m])&&b2(h,e,i,m,p,f);a.push(p),s.push(c)}return new fv(a,s,e,i)}var Wut=kN.prototype.constructor;function Yut(){return new Wut(this._groups,this._parents)}function Kut(t,e){var i,n,r;return function(){var a=RU(this,t),s=(this.style.removeProperty(t),RU(this,t));return a===s?null:a===i&&s===n?r:r=e(i=a,n=s)}}function jCe(t){return function(){this.style.removeProperty(t)}}function Zut(t,e,i){var n,r=i+"",a;return function(){var s=RU(this,t);return s===r?null:s===n?a:a=e(n=s,i)}}function Xut(t,e,i){var n,r,a;return function(){var s=RU(this,t),o=i(this),l=o+"";return o==null&&(l=o=(this.style.removeProperty(t),RU(this,t))),s===l?null:s===n&&l===r?a:(r=l,a=e(n=s,o))}}function Jut(t,e){var i,n,r,a="style."+e,s="end."+a,o;return function(){var l=jv(this,t),u=l.on,c=l.value[a]==null?o||(o=jCe(e)):void 0;(u!==i||r!==c)&&(n=(i=u).copy()).on(s,r=c),l.on=n}}function Qut(t,e,i){var n=(t+="")=="transform"?rut:VCe;return e==null?this.styleTween(t,Kut(t,n)).on("end.style."+t,jCe(t)):typeof e=="function"?this.styleTween(t,Xut(t,n,XK(this,"style."+t,e))).each(Jut(this._id,t)):this.styleTween(t,Zut(t,n,e),i).on("end.style."+t,null)}function ect(t,e,i){return function(n){this.style.setProperty(t,e.call(this,n),i)}}function tct(t,e,i){var n,r;function a(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&ect(t,s,i)),n}return a._value=e,a}function ict(t,e,i){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,tct(t,e,i??""))}function nct(t){return function(){this.textContent=t}}function rct(t){return function(){var e=t(this);this.textContent=e??""}}function act(t){return this.tween("text",typeof t=="function"?rct(XK(this,"text",t)):nct(t==null?"":t+""))}function sct(t){return function(e){this.textContent=t.call(this,e)}}function oct(t){var e,i;function n(){var r=t.apply(this,arguments);return r!==i&&(e=(i=r)&&sct(r)),e}return n._value=t,n}function lct(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,oct(t))}function uct(){for(var t=this._name,e=this._id,i=GCe(),n=this._groups,r=n.length,a=0;a<r;++a)for(var s=n[a],o=s.length,l,u=0;u<o;++u)if(l=s[u]){var c=Sf(l,e);b2(l,t,i,u,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new fv(n,this._parents,t,i)}function cct(){var t,e,i=this,n=i._id,r=i.size();return new Promise(function(a,s){var o={value:s},l={value:function(){--r===0&&a()}};i.each(function(){var u=jv(this,n),c=u.on;c!==t&&(e=(t=c).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(l)),u.on=e})})}var dct=0;function fv(t,e,i,n){this._groups=t,this._parents=e,this._name=i,this._id=n}function GCe(){return++dct}var CS=kN.prototype;fv.prototype={constructor:fv,select:zut,selectAll:qut,filter:Fut,merge:$ut,selection:Yut,transition:uct,call:CS.call,nodes:CS.nodes,node:CS.node,size:CS.size,empty:CS.empty,each:CS.each,on:jut,attr:Uut,attrTween:Rut,style:Qut,styleTween:ict,text:act,textTween:lct,remove:Hut,tween:vut,delay:Aut,duration:xut,ease:Lut,end:cct};function pct(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Fz={time:null,delay:0,duration:250,ease:pct};function hct(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))return Fz.time=y2(),Fz;return i}function fct(t){var e,i;t instanceof fv?(e=t._id,t=t._name):(e=GCe(),(i=Fz).time=y2(),t=t==null?null:t+"");for(var n=this._groups,r=n.length,a=0;a<r;++a)for(var s=n[a],o=s.length,l,u=0;u<o;++u)(l=s[u])&&b2(l,t,e,u,s,i||hct(l,e));return new fv(n,this._parents,t,e)}kN.prototype.interrupt=fut;kN.prototype.transition=fct;var up="$";function eO(){}eO.prototype=HCe.prototype={constructor:eO,has:function(t){return up+t in this},get:function(t){return this[up+t]},set:function(t,e){return this[up+t]=e,this},remove:function(t){var e=up+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===up&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===up&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===up&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===up&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===up&&++t;return t},empty:function(){for(var t in this)if(t[0]===up)return!1;return!0},each:function(t){for(var e in this)e[0]===up&&t(this[e],e.slice(1),this)}};function HCe(t,e){var i=new eO;if(t instanceof eO)t.each(function(o,l){i.set(l,o)});else if(Array.isArray(t)){var n=-1,r=t.length,a;if(e==null)for(;++n<r;)i.set(n,t[n]);else for(;++n<r;)i.set(e(a=t[n],n,t),a)}else if(t)for(var s in t)i.set(s,t[s]);return i}function Xte(){}var fI=HCe.prototype;Xte.prototype={constructor:Xte,has:fI.has,add:function(t){return t+="",this[up+t]=t,this},remove:fI.remove,clear:fI.clear,values:fI.keys,size:fI.size,empty:fI.empty,each:fI.each};function lE(){return Math.random()}(function t(e){function i(n,r){return n=n==null?0:+n,r=r==null?1:+r,arguments.length===1?(r=n,n=0):r-=n,function(){return e()*r+n}}return i.source=t,i})(lE);const mct=(function t(e){function i(n,r){var a,s;return n=n==null?0:+n,r=r==null?1:+r,function(){var o;if(a!=null)o=a,a=null;else do a=e()*2-1,o=e()*2-1,s=a*a+o*o;while(!s||s>1);return n+r*o*Math.sqrt(-2*Math.log(s)/s)}}return i.source=t,i})(lE);(function t(e){function i(){var n=mct.source(e).apply(this,arguments);return function(){return Math.exp(n())}}return i.source=t,i})(lE);const gct=(function t(e){function i(n){return function(){for(var r=0,a=0;a<n;++a)r+=e();return r}}return i.source=t,i})(lE);(function t(e){function i(n){var r=gct.source(e)(n);return function(){return r()/n}}return i.source=t,i})(lE);(function t(e){function i(n){return function(){return-Math.log(1-e())/n}}return i.source=t,i})(lE);function tO(){this._=null}function I2(t){t.U=t.C=t.L=t.R=t.P=t.N=null}tO.prototype={constructor:tO,insert:function(t,e){var i,n,r;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;i=t}else this._?(t=Jte(this._),e.P=null,e.N=t,t.P=t.L=e,i=t):(e.P=e.N=null,this._=e,i=null);for(e.L=e.R=null,e.U=i,e.C=!0,t=e;i&&i.C;)n=i.U,i===n.L?(r=n.R,r&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.R&&(_E(this,i),t=i,i=t.U),i.C=!1,n.C=!0,kE(this,n))):(r=n.L,r&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.L&&(kE(this,i),t=i,i=t.U),i.C=!1,n.C=!0,_E(this,n))),i=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e=t.U,i,n=t.L,r=t.R,a,s;if(n?r?a=Jte(r):a=n:a=r,e?e.L===t?e.L=a:e.R=a:this._=a,n&&r?(s=a.C,a.C=t.C,a.L=n,n.U=a,a!==r?(e=a.U,a.U=t.U,t=a.R,e.L=t,a.R=r,r.U=a):(a.U=e,e=a,t=a.R)):(s=t.C,t=a),t&&(t.U=e),!s){if(t&&t.C){t.C=!1;return}do{if(t===this._)break;if(t===e.L){if(i=e.R,i.C&&(i.C=!1,e.C=!0,_E(this,e),i=e.R),i.L&&i.L.C||i.R&&i.R.C){(!i.R||!i.R.C)&&(i.L.C=!1,i.C=!0,kE(this,i),i=e.R),i.C=e.C,e.C=i.R.C=!1,_E(this,e),t=this._;break}}else if(i=e.L,i.C&&(i.C=!1,e.C=!0,kE(this,e),i=e.L),i.L&&i.L.C||i.R&&i.R.C){(!i.L||!i.L.C)&&(i.R.C=!1,i.C=!0,_E(this,i),i=e.L),i.C=e.C,e.C=i.L.C=!1,kE(this,e),t=this._;break}i.C=!0,t=e,e=e.U}while(!t.C);t&&(t.C=!1)}}};function _E(t,e){var i=e,n=e.R,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.R=n.L,i.R&&(i.R.U=i),n.L=i}function kE(t,e){var i=e,n=e.L,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.L=n.R,i.L&&(i.L.U=i),n.R=i}function Jte(t){for(;t.L;)t=t.L;return t}function ZE(t,e,i,n){var r=[null,null],a=eu.push(r)-1;return r.left=t,r.right=e,i&&iO(r,t,e,i),n&&iO(r,e,t,n),Rd[t.index].halfedges.push(a),Rd[e.index].halfedges.push(a),r}function xE(t,e,i){var n=[e,i];return n.left=t,n}function iO(t,e,i,n){!t[0]&&!t[1]?(t[0]=n,t.left=e,t.right=i):t.left===i?t[1]=n:t[0]=n}function vct(t,e,i,n,r){var a=t[0],s=t[1],o=a[0],l=a[1],u=s[0],c=s[1],d=0,p=1,h=u-o,f=c-l,m;if(m=e-o,!(!h&&m>0)){if(m/=h,h<0){if(m<d)return;m<p&&(p=m)}else if(h>0){if(m>p)return;m>d&&(d=m)}if(m=n-o,!(!h&&m<0)){if(m/=h,h<0){if(m>p)return;m>d&&(d=m)}else if(h>0){if(m<d)return;m<p&&(p=m)}if(m=i-l,!(!f&&m>0)){if(m/=f,f<0){if(m<d)return;m<p&&(p=m)}else if(f>0){if(m>p)return;m>d&&(d=m)}if(m=r-l,!(!f&&m<0)){if(m/=f,f<0){if(m>p)return;m>d&&(d=m)}else if(f>0){if(m<d)return;m<p&&(p=m)}return!(d>0)&&!(p<1)||(d>0&&(t[0]=[o+d*h,l+d*f]),p<1&&(t[1]=[o+p*h,l+p*f])),!0}}}}}function yct(t,e,i,n,r){var a=t[1];if(a)return!0;var s=t[0],o=t.left,l=t.right,u=o[0],c=o[1],d=l[0],p=l[1],h=(u+d)/2,f=(c+p)/2,m,g;if(p===c){if(h<e||h>=n)return;if(u>d){if(!s)s=[h,i];else if(s[1]>=r)return;a=[h,r]}else{if(!s)s=[h,r];else if(s[1]<i)return;a=[h,i]}}else if(m=(u-d)/(p-c),g=f-m*h,m<-1||m>1)if(u>d){if(!s)s=[(i-g)/m,i];else if(s[1]>=r)return;a=[(r-g)/m,r]}else{if(!s)s=[(r-g)/m,r];else if(s[1]<i)return;a=[(i-g)/m,i]}else if(c<p){if(!s)s=[e,m*e+g];else if(s[0]>=n)return;a=[n,m*n+g]}else{if(!s)s=[n,m*n+g];else if(s[0]<e)return;a=[e,m*e+g]}return t[0]=s,t[1]=a,!0}function bct(t,e,i,n){for(var r=eu.length,a;r--;)(!yct(a=eu[r],t,e,i,n)||!vct(a,t,e,i,n)||!(Math.abs(a[0][0]-a[1][0])>rs||Math.abs(a[0][1]-a[1][1])>rs))&&delete eu[r]}function Ict(t){return Rd[t.index]={site:t,halfedges:[]}}function wct(t,e){var i=t.site,n=e.left,r=e.right;return i===r&&(r=n,n=i),r?Math.atan2(r[1]-n[1],r[0]-n[0]):(i===n?(n=e[1],r=e[0]):(n=e[0],r=e[1]),Math.atan2(n[0]-r[0],r[1]-n[1]))}function zCe(t,e){return e[+(e.left!==t.site)]}function Sct(t,e){return e[+(e.left===t.site)]}function Tct(){for(var t=0,e=Rd.length,i,n,r,a;t<e;++t)if((i=Rd[t])&&(a=(n=i.halfedges).length)){var s=new Array(a),o=new Array(a);for(r=0;r<a;++r)s[r]=r,o[r]=wct(i,eu[n[r]]);for(s.sort(function(l,u){return o[u]-o[l]}),r=0;r<a;++r)o[r]=n[s[r]];for(r=0;r<a;++r)n[r]=o[r]}}function Uct(t,e,i,n){var r=Rd.length,a,s,o,l,u,c,d,p,h,f,m,g,v=!0;for(a=0;a<r;++a)if(s=Rd[a]){for(o=s.site,u=s.halfedges,l=u.length;l--;)eu[u[l]]||u.splice(l,1);for(l=0,c=u.length;l<c;)f=Sct(s,eu[u[l]]),m=f[0],g=f[1],d=zCe(s,eu[u[++l%c]]),p=d[0],h=d[1],(Math.abs(m-p)>rs||Math.abs(g-h)>rs)&&(u.splice(l,0,eu.push(xE(o,f,Math.abs(m-t)<rs&&n-g>rs?[t,Math.abs(p-t)<rs?h:n]:Math.abs(g-n)<rs&&i-m>rs?[Math.abs(h-n)<rs?p:i,n]:Math.abs(m-i)<rs&&g-e>rs?[i,Math.abs(p-i)<rs?h:e]:Math.abs(g-e)<rs&&m-t>rs?[Math.abs(h-e)<rs?p:t,e]:null))-1),++c);c&&(v=!1)}if(v){var y,b,I,S=1/0;for(a=0,v=null;a<r;++a)(s=Rd[a])&&(o=s.site,y=o[0]-t,b=o[1]-e,I=y*y+b*b,I<S&&(S=I,v=s));if(v){var w=[t,e],T=[t,n],U=[i,n],C=[i,e];v.halfedges.push(eu.push(xE(o=v.site,w,T))-1,eu.push(xE(o,T,U))-1,eu.push(xE(o,U,C))-1,eu.push(xE(o,C,w))-1)}}for(a=0;a<r;++a)(s=Rd[a])&&(s.halfedges.length||delete Rd[a])}var qCe=[],JK;function Dct(){I2(this),this.x=this.y=this.arc=this.site=this.cy=null}function oT(t){var e=t.P,i=t.N;if(!(!e||!i)){var n=e.site,r=t.site,a=i.site;if(n!==a){var s=r[0],o=r[1],l=n[0]-s,u=n[1]-o,c=a[0]-s,d=a[1]-o,p=2*(l*d-u*c);if(!(p>=-1e-12)){var h=l*l+u*u,f=c*c+d*d,m=(d*h-u*f)/p,g=(l*f-c*h)/p,v=qCe.pop()||new Dct;v.arc=t,v.site=r,v.x=m+s,v.y=(v.cy=g+o)+Math.sqrt(m*m+g*g),t.circle=v;for(var y=null,b=b1._;b;)if(v.y<b.y||v.y===b.y&&v.x<=b.x)if(b.L)b=b.L;else{y=b.P;break}else if(b.R)b=b.R;else{y=b;break}b1.insert(y,v),y||(JK=v)}}}}function bT(t){var e=t.circle;e&&(e.P||(JK=e.N),b1.remove(e),qCe.push(e),I2(e),t.circle=null)}var WCe=[];function Ect(){I2(this),this.edge=this.site=this.circle=null}function Qte(t){var e=WCe.pop()||new Ect;return e.site=t,e}function hj(t){bT(t),IT.remove(t),WCe.push(t),I2(t)}function Pct(t){var e=t.circle,i=e.x,n=e.cy,r=[i,n],a=t.P,s=t.N,o=[t];hj(t);for(var l=a;l.circle&&Math.abs(i-l.circle.x)<rs&&Math.abs(n-l.circle.cy)<rs;)a=l.P,o.unshift(l),hj(l),l=a;o.unshift(l),bT(l);for(var u=s;u.circle&&Math.abs(i-u.circle.x)<rs&&Math.abs(n-u.circle.cy)<rs;)s=u.N,o.push(u),hj(u),u=s;o.push(u),bT(u);var c=o.length,d;for(d=1;d<c;++d)u=o[d],l=o[d-1],iO(u.edge,l.site,u.site,r);l=o[0],u=o[c-1],u.edge=ZE(l.site,u.site,null,r),oT(l),oT(u)}function Cct(t){for(var e=t[0],i=t[1],n,r,a,s,o=IT._;o;)if(a=YCe(o,i)-e,a>rs)o=o.L;else if(s=e-Rct(o,i),s>rs){if(!o.R){n=o;break}o=o.R}else{a>-rs?(n=o.P,r=o):s>-rs?(n=o,r=o.N):n=r=o;break}Ict(t);var l=Qte(t);if(IT.insert(n,l),!(!n&&!r)){if(n===r){bT(n),r=Qte(n.site),IT.insert(l,r),l.edge=r.edge=ZE(n.site,l.site),oT(n),oT(r);return}if(!r){l.edge=ZE(n.site,l.site);return}bT(n),bT(r);var u=n.site,c=u[0],d=u[1],p=t[0]-c,h=t[1]-d,f=r.site,m=f[0]-c,g=f[1]-d,v=2*(p*g-h*m),y=p*p+h*h,b=m*m+g*g,I=[(g*y-h*b)/v+c,(p*b-m*y)/v+d];iO(r.edge,u,f,I),l.edge=ZE(u,t,null,I),r.edge=ZE(t,f,null,I),oT(n),oT(r)}}function YCe(t,e){var i=t.site,n=i[0],r=i[1],a=r-e;if(!a)return n;var s=t.P;if(!s)return-1/0;i=s.site;var o=i[0],l=i[1],u=l-e;if(!u)return o;var c=o-n,d=1/a-1/u,p=c/u;return d?(-p+Math.sqrt(p*p-2*d*(c*c/(-2*u)-l+u/2+r-a/2)))/d+n:(n+o)/2}function Rct(t,e){var i=t.N;if(i)return YCe(i,e);var n=t.site;return n[1]===e?n[0]:1/0}var rs=1e-6,IT,Rd,b1,eu;function Mct(t,e,i){return(t[0]-i[0])*(e[1]-t[1])-(t[0]-e[0])*(i[1]-t[1])}function Nct(t,e){return e[1]-t[1]||e[0]-t[0]}function eie(t,e){var i=t.sort(Nct).pop(),n,r,a;for(eu=[],Rd=new Array(t.length),IT=new tO,b1=new tO;;)if(a=JK,i&&(!a||i[1]<a.y||i[1]===a.y&&i[0]<a.x))(i[0]!==n||i[1]!==r)&&(Cct(i),n=i[0],r=i[1]),i=t.pop();else if(a)Pct(a.arc);else break;if(Tct(),e){var s=+e[0][0],o=+e[0][1],l=+e[1][0],u=+e[1][1];bct(s,o,l,u),Uct(s,o,l,u)}this.edges=eu,this.cells=Rd,IT=b1=eu=Rd=null}eie.prototype={constructor:eie,polygons:function(){var t=this.edges;return this.cells.map(function(e){var i=e.halfedges.map(function(n){return zCe(e,t[n])});return i.data=e.site.data,i})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(i,n){if(o=(a=i.halfedges).length)for(var r=i.site,a,s=-1,o,l,u=e[a[o-1]],c=u.left===r?u.right:u.left;++s<o;)l=c,u=e[a[s]],c=u.left===r?u.right:u.left,l&&c&&n<l.index&&n<c.index&&Mct(r,l,c)<0&&t.push([r.data,l.data,c.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,i){for(var n=this,r,a=n._found||0,s=n.cells.length,o;!(o=n.cells[a]);)if(++a>=s)return null;var l=t-o.site[0],u=e-o.site[1],c=l*l+u*u;do o=n.cells[r=a],a=null,o.halfedges.forEach(function(d){var p=n.edges[d],h=p.left;if(!((h===o.site||!h)&&!(h=p.right))){var f=t-h[0],m=e-h[1],g=f*f+m*m;g<c&&(c=g,a=h.index)}});while(a!==null);return n._found=r,i==null||c<=i*i?o.site:null}};function XE(t,e,i){this.k=t,this.x=e,this.y=i}XE.prototype={constructor:XE,scale:function(t){return t===1?this:new XE(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new XE(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};XE.prototype;const Act=(function(){let t={};t.jsonTODS=i=>{let n={bestOf:e(i.max_sets)};if(i.max_sets&&parseInt(i.max_sets)===1&&i.final_set_supertiebreak)n.setFormat={tiebreakSet:{tiebreakTo:i.supertiebreak_to}};else{const r=e(i.games_for_set),a=e(i.tiereaks_at),s=a>r?r:a;n.setFormat={setTo:r,tiebreakAt:s,tiebreakFormat:{tiebreakTo:e(i.tiebreak_to)}},i.final_set_supertiebreak&&(n.finalSetFormat={tiebreakSet:{tiebreakTo:i.supertiebreak_to}})}return n};function e(i){return!isNaN(Number(i))&&Number(i)}return t})(),KCe=(function(){let t={};function e(s,o){let l=parseInt(s);return isNaN(l)?o:l}function i({source:s={},objects:o=[]}){let l={...s};return o&&!Array.isArray(o)&&(o=[o]),o=o.filter(u=>u),o.forEach(u=>{if(typeof u!="object")return;Object.keys(u).forEach(d=>l[d]=l[d]!==void 0?l[d]:u[d])}),l}t.setsToWin=s=>s&&Math.ceil(s/2)||1,t.tiebreakTo=(s,o)=>{let l=s?.setFormat?.tiebreakFormat?.tiebreakTo,u=s?.finalSetFormat?.tiebreakFormat?.tiebreakTo;return o?u:l},t.matchFormat=n;function n(s){return(s||"SET3-S:6/TB7").slice(3)}t.getExistingScores=({match:s})=>{if(s?.score)return r({string_score:s.score,winner_index:s.winner_index,matchFormat:s.matchFormat})},t.generateMatchFormat=({cfg_obj:s})=>{let o=s.bestof.ddlb.getValue(),l=e(o),u=KCe.setsToWin(l),c={max_sets:l,sets_to_win:u,games_for_set:e(s.setsto.ddlb.getValue()),tiebreaks_at:e(s.tiebreaksat.ddlb.getValue())||"",tiebreak_to:e(s.tiebreaksto.ddlb.getValue()),supertiebreak_to:e(s.supertiebreakto.ddlb.getValue()),final_set_supertiebreak:s.finalset.ddlb.getValue()!=="N"};return{matchFormat:Im.stringify(Act.jsonTODS(c)),score_format:c}},t.getScoringFormat=({e:s,match:o})=>{let l=o?.format||(s?.format==="D"?"doubles":"singles"),u=[o?.score_format,o?.match?.score_format,s.scoring_format?.[l],s.score_format];return i({objects:u})},t.defaultMatchFormat=({format:s,category:o,env:l})=>{let u=l.scoreboard.matchFormats,c={S:"singles",D:"doubles"};return Object.keys(c).indexOf(s)>=0&&(s=c[s]),s&&o&&u.categories[o]?.[s]?u.categories[o][s]:s&&u[s]?u[s]:u.singles},t.convertStringScore=r;function r({string_score:s,winner_index:o,split:l=" ",matchFormat:u}){if(!s)return[];s=o?a(s):s;let c=null,d=/(\d+)/,p=/(\d+)\((\d+)\)/,h=Im.parse(u),f=s.split(l).filter(m=>m).map(m=>{if(m.indexOf("/")>0){let y=m.split("/").map(b=>d.exec(b)?{games:+d.exec(b)[1]}:void 0).filter(b=>b);if(y.length===2)return y}let g=null,v=m.split("-").map(y=>{let b;return p.test(y)?(g=+p.exec(y)[2],b={games:+p.exec(y)[1]}):d.test(y)?b={games:+d.exec(y)[1]}:c=y,b||void 0});if(v=v.filter(y=>y),g!==null){let y=Math.min(...v.map(b=>b.games));v.forEach(b=>{+b.games==+y?b.tiebreak=g:b.spacer=g})}return v});if(f=f.filter(m=>m&&m.length===2),f.forEach(m=>{let v=(h&&(h.finalSetFormat||h.setFormat))?.tiebreakSet?.tiebreakTo;(m[0].games>=v||m[1].games>=v)&&(m[0].supertiebreak=m[0].games,m[1].supertiebreak=m[1].games,delete m[0].games,delete m[1].games)}),o!==void 0&&(f.winner_index=o),c){if(c==="Cancelled"&&(f.cancelled=!0),c==="Abandoned"&&(f.abandoned=!0),c==="INC."&&(f.incomplete=!0),c==="INT."&&(f.interrupted=!0),c==="LIVE"&&(f.live=!0),c==="TIME"&&(f.time=!0),c==="DEF."&&(f.default=!0),c==="W.O."&&(f.walkover=!0),!f.length)return f;o!==void 0&&(f[f.length-1][1-o].outcome=c,f[f.length-1].outcome=c,f.outome=c)}return f}t.reverseScore=a;function a(s,o=" "){let l=null;if(s){let d=s.split(o).map(u).join(o);return l?`${l} ${d}`:d}function u(d){let p=d.indexOf("/")>0?"/":"-",h=d.split(p).map(c).reverse().filter(y=>y),f=h.map(y=>y.games),m=h.map(y=>y.tiebreak).filter(y=>y),g=m.length===1?`(${m[0]})`:"";return`${m.length<2?f.join(p):f.map((y,b)=>`${y}(${m[b]})`).join(p)}${g}`}function c(d){let p=/(\d+)/,h=/(\d+)\((\d+)\)/;if(h.test(d))return{games:h.exec(d)[1],tiebreak:h.exec(d)[2]};if(p.test(d))return{games:p.exec(d)[1]};l=d}}return t})(),ro=(function(){let t={};function e(l,u){let c=1;if(Array.from(l.classList).indexOf(u)>=0)return{elem:l,depth:c};for(;l.parentNode;){if(l=l.parentNode,l.classList&&Array.from(l.classList).indexOf(u)>=0)return{elem:l,depth:c};c+=1}return{elem:null,depth:0}}const i="span:first-of-type";t.DropDown=n;function n({element:l,onChange:u,css_class:c,id:d,locked:p,max:h,maxFx:f,value_attribute:m=!0,background:g}){!l&&d&&(l=document.getElementById(d)),this.id=d,this.val="",this.max=h,this.maxFx=f,this.el=l,this.locked=p,this.background=g||"",this.bordercolor="",this.labelcolor="#000",this.class=c,this.value_attribute=m,this.list=this.el?.querySelector(".dd_state"),this.options=this.el?.querySelector(".options"),this.label=this.el?.querySelector("div:first-of-type"),this.opts=this.list?.querySelectorAll("li")||[],this.selection=this.list?.querySelector(i)||void 0,typeof u=="function"&&(this.onChange=u),this.initEvents()}function r(l){l.el&&(l.el.ddclick||(l.el.ddclick=!0,l.el.addEventListener("click",u=>{if(l.locked)return;let{elem:c,depth:d}=e(u.target,"dd_state"),{elem:p,depth:h}=e(u.target,"dd_option"),f=c&&Array.from(c.classList).indexOf("active")>=0;if(l.max&&!p&&l.opts&&l.opts.length>l.max&&l.maxFx&&typeof l.maxFx=="function"){l.maxFx(l.options);return}t.closeAllDropDowns(l.class),c&&(!h||d<h)&&c.classList[f?"remove":"add"]("active"),u.stopPropagation()})))}function a(l){Array.from(l.opts).forEach(u=>{u.addEventListener("click",()=>{l.list.classList.remove("active");let c=u.querySelector(i),d=c.getAttribute("value");l.selection.innerHTML=c.innerHTML;let p=l.val!=d;l.val=d,p&&l.onChange&&(l.onChange(d),l.selectionBackground(),l.labelColor())})})}function s(l,u){return`<li class='dd_option' title='${l.title||""}'><span value="${l.value}" style="${u||""}">${l.key}</span></li>`}n.prototype={initEvents(){let l=this;r(l),a(l)},getLabel(){return this.selection.innerHTML},getValue(){return this.val},setId(l){this.id=l},getId(){return this.id},lock(){this.locked=!0},unlock(){this.locked=!1},setOptions(l,u=""){if(!Array.isArray(l)||!l.length||!this.list)return;let c=this.list.querySelector("ul");if(c)return this.max&&l&&l.length>this.max&&t.closeAllDropDowns(this.class),c.innerHTML=l.map(d=>s(d,u)).join(""),this.options=l,this.opts=this.list.querySelectorAll("li"),a(this),this},getOptions(){return Array.from(this.opts).map(l=>{let u=l.querySelector(i);return{key:u.innerHTML,value:u.getAttribute("value")}})},setLabel(l,u,c,d){this.selection&&(this.selection.innerHTML=l,this.selectionBackground(u),this.labelColor(c),this.borderColor(d))},setValue(l,u,c,d){let p=Array.from(this.opts).filter(f=>f.querySelector(i).getAttribute("value")==l),h=p.length?p[0].querySelector("span").innerHTML:l;this.val=l,this.selection&&(this.selection.innerHTML=h,this.selectionBackground(u),this.labelColor(c),this.borderColor(d))},selectionBackground(l){this.selection&&(l&&(this.background=l),this.background?(this.selection.classList.remove("novalue"),this.selection.classList.remove("hasvalue"),this.selection.style.background=this.background):this.locked?(this.value_attribute&&this.selection.classList.add("hasvalue"),this.selection.classList.remove("novalue")):this.val?(this.selection.style.background="",this.value_attribute&&this.selection.classList.add("hasvalue"),this.selection.classList.remove("novalue")):(this.selection.style.background="",this.selection.classList.add("novalue"),this.selection.classList.remove("hasvalue")))},labelColor(l){l&&(this.labelcolor=l),this.label.style.color=this.labelcolor},borderColor(l){l&&(this.bordercolor=l),this.bordercolor&&this.options?.style&&(this.options.style.border=`1px solid ${this.bordercolor}`)}};let o=(l,u=[],c,d=!0,p,h)=>{let f=c!==void 0&&u[c]?u[c].key:"",m=d?"style='border: 1px solid #000;'":"",g=u.map(v=>s(v,p)).join("");return`
         <div class='dd-label'>${l}</div>
         <div class='options' ${m}>
            <ul>
               <li class='dd_state'>
                  <span class='active'>${f}</span>
                  <div>
                     <ul class='${h?"floatleft":""}'>
                     ${g}
                     </ul>
                  </div>
               </li>
            </ul>
         </div>`};return t.attachDropDown=({element:l,id:u,label:c="",options:d,selected:p=0,css_class:h,border:f,style:m,floatleft:g,display:v="flex"})=>{!u&&!l||(l=l||document.getElementById(u),l&&(l.style.display=v,l.classList.add(h||"dd"),l.innerHTML=o(c,d,p,f,m,g)))},t.closeAllDropDowns=()=>{let l=document.querySelectorAll("li.dd_state.active");Array.from(l).forEach(u=>{u.classList.remove("active")})},document.addEventListener("click",()=>t.closeAllDropDowns()),t})(),tie=(t,e)=>{let i=parseInt(t);return isNaN(i)?e:i},iie=1500;function nie({elem:t,type:e,duration:i=800,height:n=80,visible:r}){let a=$lt(t);s();function s(){let o=a.select("."+e),l=o.style("display"),u=l==="none"?"flex":"none";r===!0&&l==="none"||r===void 0&&u==="flex"?(o.style("height","0px"),o.style("display",u).transition().duration(i).style("height",`${n}px`)):(r===!1&&l==="flex"||r===void 0&&u==="none")&&o.transition().duration(i).style("height","0px").transition().duration(0).style("display","none")}}const _ct=(function(){let t={numericFx:void 0,enterFx:void 0};document.addEventListener("keyup",r=>{if(r.key&&r.key==="Enter"&&t.enterFx&&typeof t.enterFx=="function"&&t.enterFx(),r.key&&t.numericFx&&typeof t.numericFx=="function"){let a=["0","1","2","3","4","5","6","7","8","9"].indexOf(r.key),s=[")","!","@","#","$","%","^","&","*",")"].indexOf(r.key);a>=0?t.numericFx(a):s>=0&&t.numericFx(s,1)}});let e={},i={auto_score:!0},n={bestof:[1,3,5],setsto:[4,6,8],tiebreaksto:[5,7,12],supertiebreakto:[7,10,21]};return t.options=r=>{if(!r)return n;mCe(r,n)},t.setMatchScore=({auto_score:r=!0,existing_scores:a,matchFormat:s,round_name:o,callback:l,grouped:u,match:c,teams:d,muid:p,lock:h})=>{i.auto_score=r;let f={...i},m=Im.parse(s||"SET3-S:6/TB7");if(!m)return;let g=m?.setFormat?.tiebreakAt,v=m?.setFormat?.setTo,y=m.bestOf,b=KCe.setsToWin(y),S=(m.finalSetFormat||m.setFormat)?.tiebreakSet?.tiebreakTo,w=m?.setFormat?.tiebreakFormat?.tiebreakTo,T=m?.finalSetFormat?.tiebreakSet,U,C,E,P,M,R=fot.display({muid:p,teams:d});R.details.element.style.display="none",o&&(R.round_name.element.innerHTML=o),R.details.element.innerHTML=kct(c),R.scoring.element.style.display=h?"none":"inline",R.favorite.element.style.display=h?"inline":"none",p&&(e[p]=Se=>{h||(P.length-Se>1&&(P=P.slice(0,P.length-1),Se=P.length-1,Me()),ht({selected_set:Se}),N(!0),O(),R.scoring.element.style.display="inline",R.edit_scoring.element.style.display="inline")});let N=Se=>{let he=Se&&!h;M=he,nie({elem:R.actions.element,type:"edit",height:50,visible:he}),R.scoring.element.style.display=M||h?"none":"inline",R.edit_scoring.element.style.display=M?"none":"inline"};pt({sobj:R,changeFx:F}),q(),G(),Z(),x();const A=document.querySelectorAll(".setClick");for(const Se of A){let he=yb(Se,"set_number");if(he){let we=he.getAttribute("setnum"),be=yb(Se,"muid").getAttribute("muid");Se.addEventListener("click",()=>{e[be]&&typeof e[be]=="function"&&e[be](we)})}}function _(Se){return Se.map(he=>[{tiebreak:he.side1Score?he.side1TiebreakScore:void 0,supertiebreak:he.side1TiebreakScore,spacer:he.side1score,games:he.side1Score},{tiebreak:he.side2score?he.side2TiebreakScore:void 0,supertiebreak:he.side2TiebreakScore,spacer:he.side2score,games:he.side2Score}])}function x(){if(P=a?_(a):[],M=!1,E=!1,t.enterFx=()=>{M&&H()},O(),W(),U=at(!u)!==void 0?P.length:Math.max(0,P.length-1),a&&(Object.keys(a).length||a.length||a.walkover||a.default)){let he=P.length?P[P.length-1]:void 0;if(P.interrupted)R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue("interrupted"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),N(!0),he&&re(he[0].games,he[1].games)&&(U+=1);else if(P.abandoned)R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue("abandoned"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),N(!0);else if(P.cancelled)R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue("cancelled"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),N(!0);else if(P.incomplete)R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue("incomplete"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),N(!0),he&&re(he[0].games,he[1].games)&&(U+=1);else if(P.live)R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue("live"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),N(!0),he&&re(he[0].games,he[1].games)&&(U+=1),f.auto_score=!1;else if(P.retired){let we=a.winner_index!==void 0?1-a.winner_index:void 0;R.p1action.ddlb.setValue(we===0?"retired":"winner"),R.p2action.ddlb.setValue(we===1?"retired":"winner"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),N(!1),$(1-we)}else if(P.time){let we=a.winner_index!==void 0?1-a.winner_index:void 0;R.p1action.ddlb.setValue(we===0?"time":"winner"),R.p2action.ddlb.setValue(we===1?"time":"winner"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),N(!1),$(1-we)}else if(P.default){let we=a.winner_index!==void 0?1-a.winner_index:void 0;R.p1action.ddlb.setValue(we===0?"defaulted":"winner"),R.p2action.ddlb.setValue(we===1?"defaulted":"winner"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),N(!1),$(1-we)}else if(P.walkover){let we=a.winner_index!==void 0?1-a.winner_index:void 0;R.p1action.ddlb.setValue(we===0?"walkover":"winner"),R.p2action.ddlb.setValue(we===1?"walkover":"winner"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),N(!0),$(1-we)}else N(!1)}else R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue(" ");(P.time||P.retired||P.default||P.walkover)&&(U=void 0),ht({selected_set:U,actions:!u})}function O(){Array.from(R.root.element.querySelectorAll(".victor")).forEach(he=>he.classList.remove("victor")),h||Me()}function $(Se){Array.from(R.root.element.querySelectorAll(`.opponent${Se}`)).forEach(be=>be.classList.add("victor")),Array.from(R.root.element.querySelectorAll(`.opponent${Se} .hasvalue`)).forEach(be=>be.classList.add("victor"))}function F(){O(),U=0,P=[],Je(),Ye(),W(),t.enterFx=void 0,R.p2action.ddlb.setValue(" "),R.p1action.ddlb.setValue(" "),f.auto_score=i.auto_score,ht({selected_set:U})}function j(Se){let he={bestOf:y,setFormat:{setTo:v,tiebreakAt:g,tiebreakFormat:{tiebreakTo:w}}};T&&(he.finalSetFormat={tiebreakSet:{tiebreakTo:S}});const we=Im.stringify(he);if(Se){const be=P.map((Ae,ze)=>Mi.definedAttributes({side1TiebreakScore:Ae[0].supertiebreak,side2TiebreakScore:Ae[1].supertiebreak,side1score:Ae[0].games,side2score:Ae[1].games,setNumber:ze+1}));Se.sets=be,Se.set_scores=P,Se.matchUpFormat=we}Se&&typeof l=="function"&&l(Se),t.numericFx=void 0,t.enterFx=void 0,document.body.style.overflow=null,Aw()}function H(){t.numericFx=void 0,t.enterFx=void 0,at(),j(_e())}function G(){R.cancel.element.addEventListener("click",()=>j(),!1),R.accept.element.addEventListener("click",H,!1),R.clear.element.addEventListener("click",F,!1),R.scoring.element.addEventListener("click",Se,!1);function Se(){let we=R.scoring.element.innerHTML==="-";we||(R.edit_scoring.element.style.overflow="hidden"),R.scoring.element.innerHTML=we?"&#x25A2;":"-",he(R.edit_scoring.element,we)}function he(we,be){let Ae=800;nie({elem:we,type:"edit",height:100,visible:be,duration:Ae}),be&&setTimeout(function(){we.style.overflow="visible"},Ae)}}function W(){let Se=[{key:"-",value:""}],he=v===g?v+2:v+1;Mi.generateRange(0,he).forEach(We=>Se.push({key:We,value:We}));let we=We=>de(0,We),be=We=>de(1,We);ro.attachDropDown({id:R.p1selector.id,options:Se,border:!1}),ro.attachDropDown({id:R.p2selector.id,options:Se,border:!1}),R.p1selector.ddlb=new ro.DropDown({element:R.p1selector.element,onChange:we,id:R.p1selector.id,value_attribute:!1}),R.p2selector.ddlb=new ro.DropDown({element:R.p2selector.element,onChange:be,id:R.p2selector.id,value_attribute:!1}),h&&(R.p1selector.ddlb.lock(),R.p2selector.ddlb.lock()),R.p1selector.ddlb.selectionBackground(),R.p2selector.ddlb.selectionBackground();let Ae;t.numericFx=(We,Le=0)=>{Ae=new Date().getTime(),R.p1tiebreak.element.style.display==="none"&&We<he?(Le?R.p1selector.ddlb.setValue(We):R.p2selector.ddlb.setValue(We),de(1-Le,We)):setTimeout(function(){ze()},iie)};function ze(){if(new Date().getTime()-Ae>iie){let Le=+R.p1tiebreak.element.value,ft=+R.p2tiebreak.element.value;(Le!=""||ft!="")&&(C?J(Le,ft):Q(Le,ft))}}}function q(){let Se=[{key:" ",value:""},{key:"-",value:" "},{key:"RET.",value:"retired"},{key:"TIME",value:"time"},{key:"W.O.",value:"walkover"},{key:"DEF.",value:"defaulted"},{key:"INT.",value:"interrupted"},{key:"INC.",value:"incomplete"},{key:"CCL",value:"cancelled"},{key:"ABD",value:"abandoned"},{key:"LIVE",value:"live"},{key:`<div class='link'><img src='${hot}' class='completed_icon'></div>`,value:"winner"}],he=be=>ct(0,be),we=be=>ct(1,be);ro.attachDropDown({id:R.p1action.id,options:Se,border:!1,floatleft:!0}),ro.attachDropDown({id:R.p2action.id,options:Se,border:!1,floatleft:!0}),R.p1action.ddlb=new ro.DropDown({element:R.p1action.element,onChange:he,id:R.p1action.id}),R.p2action.ddlb=new ro.DropDown({element:R.p2action.element,onChange:we,id:R.p2action.id}),h&&(R.p1action.ddlb.lock(),R.p2action.ddlb.lock()),R.p1action.ddlb.selectionBackground(),R.p2action.ddlb.selectionBackground()}function Z(){let Se=we=>K(we,0),he=we=>K(we,1);R.p1tiebreak.element.addEventListener("keyup",Se,!1),R.p2tiebreak.element.addEventListener("keyup",he,!1)}function K(Se,he,we){let be=+R.p1tiebreak.element.value,Ae=+R.p2tiebreak.element.value;(Se.which===13||we)&&(be!=""||Ae!="")&&(C?J(be,Ae):Q(be,Ae));let ze=R[he?"p2tiebreak":"p1tiebreak"].element.value.match(/-?\d+\.?\d*/),We=ze&&!isNaN(ze[0])?parseInt(ze[0].toString().slice(-2)):void 0,Le=C?S:w,ft=We===void 0||We==""||We+2<Le?Le:We+2;R[he?"p2tiebreak":"p1tiebreak"].element.value=We!==void 0?We:"",f.auto_score&&!Te()&&(R[he?"p1tiebreak":"p2tiebreak"].element.value=ft)}function Q(Se,he,we){let be=P.length,Ae=be>U?be-1:U-1;P?.[Ae]&&(P[Ae][0][Se<he?"tiebreak":"spacer"]=Se<he?Se:he,P[Ae][1][he<Se?"tiebreak":"spacer"]=he<Se?he:Se,ne())}function J(Se,he,we){if(Se<S&&he<S)return;let be=[{supertiebreak:Se},{supertiebreak:he}],Ae=P.length;Ae&&P[Ae-1][0].supertiebreak!==void 0?P[Ae-1]=be:P.push(be),ne()}function ne(){Je(),at()!==void 0&&N(!0),ht({selected_set:U})}function re(Se,he){let we=Math.abs(Se-he);return!g&&(+Se===v||+he===v)?!0:we>=2&&(+Se>=v||+he>=v)}function oe(Se,he){return g?+Se===g+1&&+he===g||+Se===g&&+he===g+1:!1}function de(Se,he){if(he===""){R.p1selector.ddlb.setValue(""),R.p2selector.ddlb.setValue(""),P[U]=[{games:0},{games:0}];return}De()&&Me();let we=!1;Je(),ge()&&(U=P.length-1,R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue(" "),Ye());let be=R.p1selector.ddlb.getValue(),Ae=R.p2selector.ddlb.getValue();f.auto_score?Se===0&&Ae===""?(Ae=We(he),R.p2selector.ddlb.setValue(Ae)):Se===1&&be===""?(be=We(he),R.p1selector.ddlb.setValue(be)):g?(+be===g+1&&+Ae===g+1&&ze(g),+be===g+1&&+Ae<g-1&&ze(g),+Ae===g+1&&+be<g-1&&ze(g)):+be===v&&+Ae===v&&ze(v-1):Se===0&&!Ae?(Ae=0,R.p2selector.ddlb.setValue(Ae)):Se===1&&!be&&(be=0,R.p1selector.ddlb.setValue(be)),P[U]=[{games:tie(be)||0},{games:tie(Ae)||0}],!re(be,Ae)&&!oe(be,Ae)?(P=P.slice(0,U+1),ht({selected_set:U})):(oe(be,Ae)&&(we=!0),at(),se(be,Ae,we));function ze(Le){Se?(be=Le,R.p1selector.ddlb.setValue(be)):(Ae=Le,R.p2selector.ddlb.setValue(Ae))}function We(Le){return Le===""?"":g?((+Le===g||+Le===g+1)&&(we=!0),+Le===g-1||+Le===g?parseInt(g||0)+1:+Le<g?v:g):+Le===v?v-1:(+Le===v-1,v)}}function se(Se,he,we){we&&!h&&(R.p1tiebreak.element.style.display="inline",R.p2tiebreak.element.style.display="inline",R[Se>he?"p1tiebreak":"p2tiebreak"].element.disabled=!0,R[Se>he?"p2tiebreak":"p1tiebreak"].element.disabled=!1,R[Se>he?"p2tiebreak":"p1tiebreak"].element.focus(),N(!1));let be=Se!==""&&he!=="",Ae=at()===void 0&&Te()===void 0;be&&Ae&&U+1<y&&(U+=1),ht({selected_set:U,tiebreak:we})}function ge(){let Se=R.p1action.ddlb.getValue(),he=R.p2action.ddlb.getValue();return Se==="winner"||he==="winner"}function ye(){let Se=R.p1action.ddlb.getValue(),he=R.p2action.ddlb.getValue();if(["cancelled","incomplete","abandoned"].indexOf(Se)>=0||["cancelled","incomplete","abandoned"].indexOf(he)>=0)return!1}function Te(){let Se=R.p1action.ddlb.getValue(),he=R.p2action.ddlb.getValue();if(["time","retired","defaulted","walkover"].indexOf(Se)>=0)return 0;if(["time","retired","defaulted","walkover"].indexOf(he)>=0)return 1}function De(){let Se=R.p1action.ddlb.getValue(),he=R.p2action.ddlb.getValue();return["interrupted"].indexOf(Se)>=0||["interrupted"].indexOf(he)>=0}function xe(){let Se=R.p1action.ddlb.getValue(),he=R.p2action.ddlb.getValue();return["live"].indexOf(Se)>=0||["live"].indexOf(he)>=0}function Me(){xe()||(R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue(" ")),R.p1action.ddlb.unlock(),R.p2action.ddlb.unlock()}function Oe(){return P.length?P.map(he=>{let we=isNaN(he[0].games)?he[0].games:+he[0].games,be=isNaN(he[1].games)?he[1].games:+he[1].games;if(we!==void 0&&be!==void 0&&we!==""&&be!==""){if(oe(we,be)&&he[0].tiebreak===void 0&&he[1].tiebreak===void 0)return[0,0];const Ae=+we===v&&+we==+be+1,ze=+be===v&&+be==+we+1;if(g)if(!g||v===g){if(Ae)return[0,0];if(+be===v&&+be==+we+1)return[0,0]}else{if(Ae)return[1,0];if(ze)return[0,1]}else{if(+we===v&&+we==+be+1)return[1,0];if(+be===v&&+be==+we+1)return[0,1]}if(we>be&&we>=v)return[1,0];if(be>we&&be>=v)return[0,1]}else if(he[0].supertiebreak!==void 0&&he[1].supertiebreak!==void 0){if(he[0].supertiebreak>he[1].supertiebreak+1&&he[0].supertiebreak>=S)return[1,0];if(he[1].supertiebreak>he[0].supertiebreak+1&&he[1].supertiebreak>=S)return[0,1]}return[0,0]}).reduce((he,we)=>[he[0]+we[0],he[1]+we[1]]):[0,0]}function at(Se=!0){if(!P.length)return;let he=Oe();if(+he[0]==+he[1]&&!xe()&&!De()&&!ye()&&Te()===void 0)return;let we=Math.max(...he),be=Math.max(b,Math.floor(P.length/2)+1);if(we<be)return;const Ae=he[0]>=be&&1||(he[1]>=be?2:void 0);if(Ae===void 0&&!xe()&&!De()&&!ye()&&Te()===void 0){N(!1);return}return R.p1tiebreak.element.style.display!=="inline"&&Se&&N(!0),R[Ae===1?"p1action":"p2action"].ddlb.setValue("winner"),R[Ae===2?"p1action":"p2action"].ddlb.setValue(""),R[Ae===2?"p1action":"p2action"].ddlb.lock(),$(Ae-1),U=P.length,Ae-1}function Fe(Se){let he=P.length;return+Se===P.length-1&&he&&P[he-1][0].supertiebreak!==void 0?P[he-1]:!1}function mt(Se,he){return T?at(he)!==void 0&&Fe(Se)?!0:Xe(Se):!1}function Xe(Se){let he=Oe();if(+he[0]==+he[1]&&+he[0]+1===b&&+Se==+P.length)return!0}function gt(Se,he,we){return he||E||Se===void 0?!1:P.length===0?!0:!((at(we)!==void 0||Te()!==void 0)&&(Se===void 0||+Se===P.length))}function ht({selected_set:Se,tiebreak:he,actions:we}){C=mt(Se,we);let be=gt(Se,he||C,we);if(!be&&!C&&(Se=P.length),U=Math.min(y-1,+Se),be&&Je(),C&&!h){let rt=Xe(Se);R.p1tiebreak.element.style.display="inline",R.p2tiebreak.element.style.display="inline",R.p1tiebreak.element.disabled=!1,R.p2tiebreak.element.disabled=!1,rt||(R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue(" "),N(!1));let St=Fe(Se);St&&(R.p1tiebreak.element.value=St[0].supertiebreak,R.p2tiebreak.element.value=St[1].supertiebreak)}let Ae=P[Se],ze=h?P:P.slice(0,+Se),We=P.slice(+Se+1);h&&!P.length&&(ze=[[{games:0},{games:0}]]);let Le=ze.map((rt,St)=>DA({setnum:St,score:rt[0]})).join(""),ft=ze.map((rt,St)=>DA({setnum:St,score:rt[1]})).join("");R.p1scores.element.innerHTML=Le,R.p2scores.element.innerHTML=ft,R.p1selector.ddlb.setValue(Ae?Ae[0].games+"":""),R.p2selector.ddlb.setValue(Ae?Ae[1].games+"":""),R.p1selector.element.style.display=be&&!E&&!h?"flex":"none",R.p2selector.element.style.display=be&&!E&&!h?"flex":"none",Le=We.map((rt,St)=>DA({setnum:+Se+1+St,score:rt[0]})).join(""),ft=We.map((rt,St)=>DA({setnum:+Se+1+St,score:rt[1]})).join(""),R.p1scores_e.element.innerHTML=Le,R.p2scores_e.element.innerHTML=ft}function _e(){const Se=R.p1action.ddlb.getValue(),he=R.p2action.ddlb.getValue(),we=Se==="winner"&&1||he==="winner"&&2||void 0;let be=[1,2].includes(we),Ae=P.map(We=>{if(We[0].supertiebreak)return`[${We[0].supertiebreak}-${We[1].supertiebreak}]`;let Le=We[0].tiebreak,ft=We[1].tiebreak,rt=Le!==void 0||ft!==void 0?`(${[Le,ft].filter(St=>St>=0).join("-")})`:"";return`${We[0].games}-${We[1].games}${rt}`}).join(" "),ze;return[1,2].includes(we)&&(ze="COMPLETED"),(Se==="retired"||he==="retired")&&(ze="RETIRED"),(Se==="time"||he==="time")&&(Ae+=" TIME"),(Se==="walkover"||he==="walkover")&&(ze="WALKOVER",be=!0),(Se==="defaulted"||he==="defaulted")&&(ze="DEFAULTED",be=!0),(Se==="abandoned"||he==="abandoned")&&(ze="ABANDONED",be=!0,Ae=""),(Se==="interrupted"||he==="interrupted")&&(ze="SUSPENDED",be=!1),(Se==="live"||he==="live")&&(ze="IN_PROGRESS",be=!1),(Se==="cancelled"||he==="cancelled")&&(ze="CANCELLED",be=!1),(Se==="incomplete"||he==="incomplete")&&(ze="ABANDONED",be=!1),{matchUpStatus:ze,winningSide:we,complete:be,score:Ae}}function Ye(){E=!1,R.p1selector.ddlb.unlock(),R.p2selector.ddlb.unlock(),R.p1action.ddlb.unlock(),R.p2action.ddlb.unlock()}function Je(){R.p1tiebreak.element.value="",R.p2tiebreak.element.value="",R.p1tiebreak.element.style.display="none",R.p2tiebreak.element.style.display="none"}function ct(Se,he){let we=R.p1action.ddlb.getValue(),be=R.p2action.ddlb.getValue(),Ae=at(),ze=Se?we:be;if(f.auto_score=i.auto_score,he===""){Ae!==void 0&&(P=[],U=0,R[Se?"p2action":"p1action"].ddlb.setValue(" ")),R[Se?"p1action":"p2action"].ddlb.setValue(" "),Ye();let We=P.length;if(We){let Le=P[We-1];!oe(Le[0].games,Le[1].games)&&!re(Le[0].games,Le[1].games)&&(U=We-1)}ht({selected_set:U})}else["interrupted","cancelled","incomplete","abandoned"].indexOf(he)>=0?(R[Se?"p1action":"p2action"].ddlb.setValue(" "),ht({selected_set:U}),N(!0)):he==="live"?(f.auto_score=!1,R[Se?"p1action":"p2action"].ddlb.setValue(" "),ht({selected_set:U}),N(!0)):he==="winner"&&ze==="winner"?(Ae===void 0&&R[Se?"p1action":"p2action"].ddlb.setValue("retired"),ht({selected_set:U}),N(!0)):["time","retired","walkover","defaulted"].indexOf(he)>=0?(N(!0),Ae!==void 0?(R[Ae?"p2action":"p1action"].ddlb.setValue("winner"),R[Ae?"p1action":"p2action"].ddlb.setValue(" "),R[Ae?"p2action":"p1action"].ddlb.unlock(),R[Ae?"p1action":"p2action"].ddlb.lock()):(R.p1tiebreak.element.disabled=!1,R.p2tiebreak.element.disabled=!1,R[Se?"p1action":"p2action"].ddlb.setValue("winner"),R[Se?"p1action":"p2action"].ddlb.unlock(),R[Se?"p2action":"p1action"].ddlb.lock(),(he==="time"||he==="retired"||he==="defaulted")&&(Ae!==void 0&&R[Se?"p2action":"p1action"].ddlb.setValue(" "),U=P.length),(he==="time"||he==="retired")&&!P.length&&R[Se?"p2action":"p1action"].ddlb.setValue("walkover"),he==="walkover"&&(P=[],U=0),ht({selected_set:U}))):he==="winner"&&(Ae===void 0?R[Se?"p1action":"p2action"].ddlb.setValue(P.length?"retired":"walkover"):R[Se?"p1action":"p2action"].ddlb.setValue(" "),R[Se?"p1action":"p2action"].ddlb.lock(),E=!0,R.p1selector.ddlb.lock(),R.p2selector.ddlb.lock(),ht({selected_set:U}))}function pt({sobj:Se,changeFx:he}){ro.attachDropDown({id:Se.bestof.id,options:Ae(n.bestof)}),Se.bestof.ddlb=new ro.DropDown({element:Se.bestof.element,id:Se.bestof.id,onChange:ze}),Se.bestof.ddlb.setValue(y,"white"),ro.attachDropDown({id:Se.setsto.id,options:Ae(n.setsto)}),Se.setsto.ddlb=new ro.DropDown({element:Se.setsto.element,id:Se.setsto.id,onChange:ft}),Se.setsto.ddlb.setValue(v,"white");let we=v,be=Le(we);ro.attachDropDown({id:Se.tiebreaksat.id,options:be}),Se.tiebreaksat.ddlb=new ro.DropDown({element:Se.tiebreaksat.element,id:Se.tiebreaksat.id,onChange:rt}),Se.tiebreaksat.ddlb.setValue(g&&g<we?g:we,"white"),Se.tiebreaksat.ddlb.setValue(g||"","white"),ro.attachDropDown({id:Se.tiebreaksto.id,options:Ae(n.tiebreaksto)}),Se.tiebreaksto.ddlb=new ro.DropDown({element:Se.tiebreaksto.element,id:Se.tiebreaksto.id,onChange:St}),Se.tiebreaksto.ddlb.setValue(w,"white"),ro.attachDropDown({id:Se.finalset.id,options:[{key:_s.tr("scoring.normal"),value:"N"},{key:_s.tr("scoring.supertiebreak"),value:"S"}]}),Se.finalset.ddlb=new ro.DropDown({element:Se.finalset.element,id:Se.finalset.id,onChange:si}),Se.finalset.ddlb.selectionBackground(),Se.finalset.ddlb.setValue(T?"S":"N","white"),ro.attachDropDown({id:Se.supertiebreakto.id,options:Ae(n.supertiebreakto)}),Se.supertiebreakto.ddlb=new ro.DropDown({element:Se.supertiebreakto.element,id:Se.supertiebreakto.id,onChange:Qe}),Se.supertiebreakto.ddlb.selectionBackground(),Se.supertiebreakto.ddlb.setValue(S||10,"white"),We(T);function Ae(bt){return!bt||!Array.isArray(bt)?{}:bt.map(ci=>({key:ci,value:ci}))}function ze(bt){y=parseInt(bt),b=Math.ceil(bt/2),T=!1,Se.finalset.ddlb.setValue("N","white"),We(T),typeof he=="function"&&he()}function We(bt){Se.stb2.element.style.opacity=bt?1:0,Se.supertiebreakto.element.style.opacity=bt?1:0}function Le(bt){return[{key:_s.tr("none"),value:""},{key:`${bt-1}-${bt-1}`,value:bt-1},{key:`${bt}-${bt}`,value:bt}]}function ft(bt){v=parseInt(bt),g=parseInt(bt);let ci=Le(bt);Se.tiebreaksat.ddlb.setOptions(ci),Se.tiebreaksat.ddlb.setValue(bt,"white"),typeof he=="function"&&he()}function rt(bt){g=parseInt(bt),typeof he=="function"&&he()}function St(bt){w=parseInt(bt),typeof he=="function"&&he()}function si(bt){S=Se.supertiebreakto.ddlb.getValue()||10,T=bt==="S"?{tiebreakTo:S}:!1,We(T),typeof he=="function"&&he()}function Qe(bt){S=parseInt(bt),typeof he=="function"&&he()}}},t})();function DA({setnum:t,score:e={games:0}}){let i=e.tiebreak!==void 0&&e.tiebreak||e.spacer!==void 0&&e.spacer||"",n=e.supertiebreak!==void 0?e.supertiebreak:e.games;return`
      <div class="set score set_number setClick" setnum="${t!==void 0?t:""}">
         <div class="setscore setClick">${n}</div>
         <div class="tbscore" ${e.spacer!==void 0?'style="opacity: 0"':""}>${i}</div>
      </div>
   `}function kct(t){if(!t)return"";if(t.status)return t.status;if(!t.schedule)return"";let e=Oct(t.schedule);if(e)return`Duration ${e}`;let i=`${t.schedule.time_prefix||""}${t.schedule.time||""}`,n=`${t.schedule.court||""}${i?" / "+i:""}`;return t.winner_index===void 0?n:""}const xct=(t,e)=>{let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),a=i-n*3600-r*60,s=!e||e?.display_seconds,o=!e||e?.pad_hours;return n<10&&o&&(n="0"+n),r<10&&(r="0"+r),a<10&&(a="0"+a),s?n+":"+r+":"+a:n+":"+r};function Oct(t){if(!t.start||!t.end)return"";let e=rie(t.end)-rie(t.start);return xct(e,{pad_hours:!1,display_seconds:!1})}function rie(t){let e=t.split(":");return e[0]*60*60+e[1]*60}function ON(t){const{matchUpId:e,callback:i}=t,n={withScaleValues:!0},r=t.matchUp??nt.findMatchUp({participantsProfile:n,matchUpId:e}).matchUp,a=l=>{const{matchUpStatus:u,matchUpFormat:c,winningSide:d,score:p}=l,f=p&&nt.parseScoreString({scoreString:p})||[],m=[{method:IK,params:{allowChangePropagation:!0,drawId:r.drawId,outcome:{score:{sets:f},matchUpFormat:c,matchUpStatus:u,winningSide:d},matchUpId:e}}];Wt({methods:m,callback:v=>{Aw(),Mt(i)&&i&&i({...v,outcome:l})}})},s=r.sides.map(l=>l.participant),o=r.score?.sets||[];zi.scoring?pot({matchUp:r,callback:a}):_ct.setMatchScore({round_name:r.roundName||"",matchFormat:r.matchUpFormat,callback:a,muid:r.matchUpId,existing_scores:o,teams:s})}function aie(t,e,i,n){return new(i||(i=Promise))((function(r,a){function s(u){try{l(n.next(u))}catch(c){a(c)}}function o(u){try{l(n.throw(u))}catch(c){a(c)}}function l(u){var c;u.done?r(u.value):(c=u.value,c instanceof i?c:new i((function(d){d(c)}))).then(s,o)}l((n=n.apply(t,[])).next())}))}const sie=(t,e)=>{const{touches:i}=t,{clientX:n,clientY:r}=t;if(!e)return;const{left:a,top:s}=e.getBoundingClientRect();let o={x:0,y:0};if(i===void 0)o={x:n-a,y:r-s};else if(i!==void 0&&i.length>0&&Object.keys(i).length>0){const{clientX:l,clientY:u}=i[0];o={x:l-a,y:u-s}}return Object.keys(o).length!==0||o.constructor!==Object?o:void 0},_n=(t,e)=>!!t&&t.classList.contains(e),lp=(t,e,i)=>{if(!t)return;const n=new CustomEvent(e,{detail:i});t.dispatchEvent(n)},fj=(t,e,i)=>((n,r)=>Math.round(n/r)*r)(t,e*i),EA=(t,e)=>Array.from({length:Number(e)-Number(t)+1},((i,n)=>Number(t)+n)),mj=(t,e)=>Array.from({length:Number(e)-Number(t)+1},((i,n)=>Number(e)-n)).reverse(),PA=t=>{t&&typeof t=="function"&&t()},gj=(t="")=>{const e=t.replace(/(AM|PM|am|pm)/,(n=>` ${n}`)),i=new Date(`September 20, 2000 ${e}`);return`${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}`},Sd=(t,e,i,n)=>{if(!t)return{hour:"12",minutes:"00",type:e==="24h"?void 0:"PM"};const{value:r}=t;if(i){if(typeof i=="boolean"&&i){const[d,p]=new Date().toLocaleTimeString().split(":");if(/[a-z]/i.test(p)&&e==="12h"){const[h,f]=p.split(" ");return{hour:Number(d)<=9?`0${Number(d)}`:d,minutes:h,type:f}}return{hour:Number(d)<=9?`0${Number(d)}`:d,minutes:p,type:void 0}}{const{time:d,locales:p,preventClockType:h}=i;let f=d;if(d||(f=new Date),h&&n){const[v,y]=new Date(f).toLocaleTimeString().split(":");if(/[a-z]/i.test(y)){const[b,I]=y.split(" ");return{hour:v,minutes:b,type:I}}return{hour:Number(v)<=9?`0${Number(v)}`:v,minutes:y,type:void 0}}const[m,g]=new Date(f).toLocaleTimeString(p,{timeStyle:"short"}).split(":");if(/[a-z]/i.test(g)&&e==="12h"){const[v,y]=g.split(" ");return{hour:Number(m)<=9?`0${Number(m)}`:m,minutes:v,type:y}}if(e==="12h"){const[v,y]=new Date(`1970-01-01T${m}:${g}Z`).toLocaleTimeString("en-US",{timeZone:"UTC",hour12:!0,hour:"numeric",minute:"numeric"}).split(":"),[b,I]=y.split(" ");return{hour:Number(v)<=9?`0${Number(v)}`:m,minutes:b,type:I}}return{hour:Number(m)<=9?`0${Number(m)}`:m,minutes:g,type:void 0}}}if(r===""||!r)return{hour:"12",minutes:"00",type:e==="24h"?void 0:"PM"};const[a,s]=r.split(" "),[o,l]=a.split(":");if(/[a-z]/i.test(a))return{error:"The input contains invalid letters or whitespace."};if(r.includes(" ")){if(!s)return{error:`The input contains invalid letters or whitespace.
        Problem is with input length (max 5), currentLength: ${r.length}.`,currentLength:r.length};if(r.length>8||s!=="AM"&&s!=="PM")return{error:`The input contains invalid letters or whitespace.
        Problem is with input length (max 8), currentLength: ${r.length} or invalid type (PM or AM), currentType: ${s}.`,currentLength:r.length,currentType:s}}let u=Number(l);const c=Number(o);return u<10?u=`0${u}`:u===0&&(u="00"),e==="12h"?c>12||u>59||u<0||c===0||s!=="AM"&&s!=="PM"?{error:`The input contains invalid letters or numbers. Problem is with hour which should be less than 13 and higher or equal 0, currentHour: ${c}. Minutes should be less than 60 and higher or equal 0, currentMinutes: ${Number(u)} or invalid type (PM or AM), currentType: ${s}.`,currentHour:c,currentMin:u,currentType:s}:{hour:c<10?`0${c}`:c.toString(),minutes:u.toString(),type:s}:c<0||c>23||u>59?{error:`The input contains invalid numbers. Problem is with hour which should be less than 24 and higher or equal 0, currentHour: ${c}. Minutes should be less than 60 and higher or equal 0, currentMinutes: ${Number(u)}`,currentHour:c,currentMin:u}:{hour:c<10?`0${c}`:c.toString(),minutes:u.toString()}},gy=(t,e,i)=>{const n=Number(t);return e==="hour"?i!=="24h"?n>0&&n<=12:n>=0&&n<=23:e==="minutes"?n>=0&&n<=59:void 0},CA=(t,e,i,n)=>{if(t){if(Array.isArray(t)&&t.length>0)return!t.map((r=>gy(r,e,i))).some((r=>r===!1));if(typeof t=="string"||typeof t=="number"){const r=gy(t,e,i),a=n?.map(Number).includes(Number(t));return!(!r||a)}}};function w2(t,e){e===void 0&&(e={});var i=e.insertAt;if(t&&typeof document<"u"){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",i==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}w2(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui * {
  box-sizing: border-box !important;
}
.timepicker-ui-modal {
  font-family: "Roboto", sans-serif;
  position: fixed;
  opacity: 0;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: rgba(156, 155, 155, 0.6);
  z-index: 5000;
  pointer-events: none;
}
.timepicker-ui-modal.show {
  pointer-events: auto;
}
.timepicker-ui-modal.removed {
  top: auto;
  bottom: auto;
  left: auto;
  right: auto;
  background-color: transparent;
}
.timepicker-ui-measure {
  position: absolute;
  top: -9999px;
  width: 3.125rem;
  height: 3.125rem;
  overflow: scroll;
}
.timepicker-ui-wrapper, .timepicker-ui-wrapper.mobile {
  position: fixed;
  z-index: 5001;
  width: 328px;
  height: 500px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff;
  border-radius: 4px;
  box-shadow: 0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 5px 8px 0px rgba(0, 0, 0, 0.14), 0px 1px 14px 0px rgba(0, 0, 0, 0.12);
  display: flex;
  flex-direction: column;
  outline: none;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper:not(.timepicker-ui-wrapper + .mobile) {
    flex-direction: row;
    height: 360px;
    width: 584px;
  }
}
@media screen and (max-width: 330px) and (orientation: portrait) {
  .timepicker-ui-wrapper:not(.timepicker-ui-wrapper + .mobile) {
    width: 315px;
  }
}
.timepicker-ui-wrapper.mobile {
  height: 218px;
}
@media screen and (max-width: 330px) {
  .timepicker-ui-wrapper.mobile {
    width: 315px;
  }
}
.timepicker-ui-header, .timepicker-ui-header.mobile {
  padding-top: 52px;
  padding-bottom: 36px;
  padding-right: 24px;
  padding-left: 24px;
  height: 104px;
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  position: relative;
  height: 100%;
}
.timepicker-ui-header.mobile {
  padding-bottom: 0;
  padding-top: 35px;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-header:not(.timepicker-ui-header + .mobile) {
    height: auto;
    flex-direction: column;
  }
}
.timepicker-ui-select-time, .timepicker-ui-select-time.mobile {
  text-transform: uppercase;
  position: absolute;
  top: 16px;
  left: 24px;
  font-size: 12px;
  color: #a9a9a9;
}
.timepicker-ui-body {
  height: 256px;
  width: 256px;
  margin: 0 auto;
  position: relative;
  border-radius: 100%;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-body {
    padding-right: 0;
    padding-left: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 23px;
  }
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-landspace {
    display: flex;
    flex-direction: column;
    width: 100%;
  }
}
.timepicker-ui-footer, .timepicker-ui-footer-mobile {
  height: 76px;
  display: flex;
  justify-content: space-between;
  margin-bottom: 4px;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-footer:not(.timepicker-ui-footer + .mobile) {
    justify-content: flex-end;
  }
}
.timepicker-ui-footer.mobile {
  align-items: flex-start;
}
.timepicker-ui-clock-face {
  background-color: #e0e0e0;
  height: 100%;
  width: 100%;
  border-radius: 100%;
  position: relative;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-clock-face {
    height: 256px;
    width: 256px;
    top: 15px;
  }
}
.timepicker-ui-dot {
  position: absolute;
  top: 50%;
  left: 50%;
  user-select: none;
  touch-action: none;
  transform: translate(-50%, -50%);
  background-color: #6200ee;
  height: 8px;
  width: 8px;
  border-radius: 100%;
}
.timepicker-ui-tips-wrapper {
  height: 100%;
  width: 100%;
}
.timepicker-ui-tips-wrapper-24h {
  position: absolute;
  height: 160px;
  width: 160px;
  z-index: 0;
  transform: translate(-50%, -50%);
  left: 50%;
  top: 50%;
  border-radius: 50%;
}
.timepicker-ui-tips-wrapper-24h-disabled {
  pointer-events: none;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12, .timepicker-ui-minutes-time, .timepicker-ui-hour-time-24 {
  position: absolute;
  width: 32px;
  height: 32px;
  text-align: center;
  cursor: pointer;
  font-size: 17.6px;
  display: flex;
  justify-content: center;
  align-items: center;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12 span, .timepicker-ui-minutes-time span, .timepicker-ui-hour-time-24 span {
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12 {
  display: block;
  display: flex;
  justify-content: center;
  align-items: center;
}
.timepicker-ui-wrapper-time, .timepicker-ui-wrapper-time.mobile {
  display: flex;
  margin-right: 10px;
  height: 100%;
  justify-content: center;
  align-items: center;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-time:not(.timepicker-ui-wrapper-time + .mobile) {
    margin-right: 0;
    height: auto;
  }
}
.timepicker-ui-wrapper-time-24h {
  margin-right: 0px;
}
.timepicker-ui-wrapper-time.mobile {
  position: relative;
}
.timepicker-ui-hour, .timepicker-ui-minutes, .timepicker-ui-hour.mobile, .timepicker-ui-minutes.mobile {
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 51.2px;
  background-color: #e4e4e4;
  border-radius: 7px;
  cursor: pointer;
  transition: all 0.3s ease;
  outline: none;
  border: 2px solid transparent;
  padding: 10px;
  width: 96px;
  text-align: center;
}
.timepicker-ui-hour:focus-visible, .timepicker-ui-minutes:focus-visible, .timepicker-ui-hour.mobile:focus-visible, .timepicker-ui-minutes.mobile:focus-visible {
  outline: auto;
}
.timepicker-ui-hour:hover, .timepicker-ui-hour.active, .timepicker-ui-minutes:hover, .timepicker-ui-minutes.active, .timepicker-ui-hour.mobile:hover, .timepicker-ui-hour.mobile.active, .timepicker-ui-minutes.mobile:hover, .timepicker-ui-minutes.mobile.active {
  color: #6200ee;
  background-color: #ece0fd;
}
.timepicker-ui-hour::-webkit-outer-spin-button, .timepicker-ui-hour::-webkit-inner-spin-button, .timepicker-ui-minutes::-webkit-outer-spin-button, .timepicker-ui-minutes::-webkit-inner-spin-button, .timepicker-ui-hour.mobile::-webkit-outer-spin-button, .timepicker-ui-hour.mobile::-webkit-inner-spin-button, .timepicker-ui-minutes.mobile::-webkit-outer-spin-button, .timepicker-ui-minutes.mobile::-webkit-inner-spin-button {
  -webkit-appearance: none !important;
  margin: 0 !important;
}
.timepicker-ui-hour[type=number], .timepicker-ui-minutes[type=number], .timepicker-ui-hour.mobile[type=number], .timepicker-ui-minutes.mobile[type=number] {
  -moz-appearance: textfield !important;
}
.timepicker-ui-hour, .timepicker-ui-minutes {
  outline: none;
  border: 2px solid transparent;
}
.timepicker-ui-hour[contenteditable=true]:focus, .timepicker-ui-hour[contenteditable=true]:active, .timepicker-ui-minutes[contenteditable=true]:focus, .timepicker-ui-minutes[contenteditable=true]:active {
  border: 2px solid #6200ee;
  outline-color: #6200ee;
  user-select: all;
}
.timepicker-ui-hour.mobile, .timepicker-ui-minutes.mobile {
  height: 70px;
  outline: none;
  border: 2px solid transparent;
}
.timepicker-ui-hour.mobile[contenteditable=true]:focus, .timepicker-ui-hour.mobile[contenteditable=true]:active, .timepicker-ui-minutes.mobile[contenteditable=true]:focus, .timepicker-ui-minutes.mobile[contenteditable=true]:active {
  border: 2px solid #6200ee;
  outline-color: #6200ee;
  user-select: all;
}
.timepicker-ui-dots, .timepicker-ui-dots.mobile {
  padding-left: 5px;
  padding-right: 5px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 57.6px;
  user-select: none;
  touch-action: none;
}
.timepicker-ui-wrapper-type-time, .timepicker-ui-wrapper-type-time.mobile {
  display: flex;
  flex-direction: column;
  height: 80px;
  justify-content: center;
  align-items: center;
  font-size: 16px;
  font-weight: 500;
  color: #787878;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-type-time {
    flex-direction: row;
    width: 100%;
  }
}
.timepicker-ui-wrapper-type-time.mobile {
  height: 70px;
}
.timepicker-ui-am, .timepicker-ui-pm, .timepicker-ui-am.mobile, .timepicker-ui-pm.mobile {
  display: flex;
  justify-content: center;
  align-items: center;
  border: 2px solid #d6d6d6;
  transition: all 0.3s ease;
  cursor: pointer;
  width: 100%;
  height: 100%;
}
.timepicker-ui-am:hover, .timepicker-ui-am.active, .timepicker-ui-pm:hover, .timepicker-ui-pm.active, .timepicker-ui-am.mobile:hover, .timepicker-ui-am.mobile.active, .timepicker-ui-pm.mobile:hover, .timepicker-ui-pm.mobile.active {
  color: #6200ee;
  background-color: #ece0fd;
}
.timepicker-ui-am.active, .timepicker-ui-pm.active, .timepicker-ui-am.mobile.active, .timepicker-ui-pm.mobile.active {
  pointer-events: none;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile), .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile) {
    width: 50%;
    height: 44px;
  }
}
.timepicker-ui-am, .timepicker-ui-am.mobile {
  border-top-left-radius: 7px;
  border-top-right-radius: 7px;
  border-bottom-width: 0.3752px;
}
.timepicker-ui-am.mobile {
  border-bottom-left-radius: 0;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile) {
    border-top-left-radius: 7px;
    border-bottom-left-radius: 7px;
    border-top-right-radius: 0;
    border-top-width: 1.5008px;
    border-right-width: 0.3752px;
  }
}
.timepicker-ui-pm, .timepicker-ui-pm.mobile {
  border-bottom-left-radius: 7px;
  border-bottom-right-radius: 7px;
  border-top-width: 0.3752px;
  width: 54px;
}
.timepicker-ui-pm.mobile {
  border-top-right-radius: 0;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile) {
    border-bottom-right-radius: 7px;
    border-top-right-radius: 7px;
    border-bottom-left-radius: 0;
    border-bottom-width: 1.5008px;
    border-left-width: 0.3752px;
    width: 50%;
    height: 44px;
  }
}
.timepicker-ui-cancel-btn, .timepicker-ui-ok-btn, .timepicker-ui-cancel-btn.mobile, .timepicker-ui-ok.btn-mobile {
  color: #6200ee;
  text-transform: uppercase;
  border-radius: 7px;
  background-color: transparent;
  text-align: center;
  font-size: 15.2px;
  padding-top: 9px;
  padding-bottom: 9px;
  font-weight: 500;
  transition: all 0.3s ease;
  cursor: pointer;
}
.timepicker-ui-cancel-btn:hover, .timepicker-ui-ok-btn:hover, .timepicker-ui-cancel-btn.mobile:hover, .timepicker-ui-ok.btn-mobile:hover {
  background-color: #d6d6d6;
}
.timepicker-ui-cancel-btn, .timepicker-ui-cancel-btn.mobile {
  width: 72px;
  margin-right: 4px;
}
.timepicker-ui-ok-btn, .timepicker-ui-ok-btn.mobile {
  width: 64px;
  margin-left: 4px;
}
.timepicker-ui-wrapper-btn, .timepicker-ui-keyboard-icon, .timepicker-ui-wrapper-btn-mobile, .timepicker-ui-keyboard-icon-mobile {
  display: flex;
  justify-content: center;
  align-items: center;
}
.timepicker-ui-keyboard-icon-wrapper, .timepicker-ui-keyboard-icon-wrapper.mobile {
  width: 44px;
  height: 44px;
  position: relative;
  bottom: -26px;
  left: 12px;
  transition: all 0.3s ease;
}
.timepicker-ui-keyboard-icon-wrapper:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile:hover .timepicker-ui-keyboard-icon.mobile {
  background-color: #d6d6d6;
  border-radius: 7px;
}
.timepicker-ui-keyboard-icon-wrapper.mobile {
  bottom: -5px;
}
.timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon.mobile {
  padding: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  color: #4e545a;
  height: 44px;
  width: 44px;
}
.timepicker-ui-keyboard-icon:hover, .timepicker-ui-keyboard-icon.mobile:hover {
  color: #6200ee;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-keyboard-icon-wrapper, .timepicker-ui-keyboard-icon-wrapper.mobile {
    position: absolute;
    bottom: 8px;
  }
}
.timepicker-ui-wrapper-btn, .timepicker-ui-wrapper-btn.mobile {
  margin-right: 8px;
  position: relative;
  bottom: -14px;
}
.timepicker-ui-hour-text, .timepicker-ui-minute-text, .timepicker-ui-hour-text.mobile, .timepicker-ui-minute-text.mobile {
  position: absolute;
  bottom: 6px;
  font-size: 12.8px;
  color: #a9a9a9;
  left: 0;
}
.timepicker-ui-minute-text, .timepicker-ui-minute-text.mobile {
  left: 120px;
}
.timepicker-ui-clock-hand {
  position: absolute;
  background-color: #6200ee;
  bottom: 50%;
  height: 40%;
  left: calc(50% - 1px);
  transform-origin: center bottom 0;
  width: 2px;
}
.timepicker-ui-clock-hand-24h {
  height: 23%;
}
.timepicker-ui-circle-hand {
  position: absolute;
  transform: translate(-48%, -50%);
  width: 4px;
  height: 4px;
  border-radius: 100%;
  transition: all 0.2s ease;
  height: 46px;
  width: 46px;
  box-sizing: border-box !important;
  background-color: #6200ee;
}
.timepicker-ui-circle-hand.small-circle {
  height: 36px;
  width: 36px;
  box-sizing: border-box !important;
}
.timepicker-ui-circle-hand-24h {
  transform: translate(-50%, -50%);
  height: 32px;
  width: 32px;
  top: 4px;
  left: 1px;
}
.timepicker-ui-value-tips, .timepicker-ui-value-tips-24h {
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: 0.3s ease color;
  border-radius: 50%;
  outline: none;
}
.timepicker-ui-value-tips:focus, .timepicker-ui-value-tips-24h:focus {
  background: rgba(143, 143, 143, 0.315);
  box-shadow: 0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 5px 8px 0px rgba(0, 0, 0, 0.14), 0px 1px 14px 0px rgba(0, 0, 0, 0.12);
}
.timepicker-ui-value-tips.active, .timepicker-ui-value-tips-24h.active {
  color: #fff;
  transition: none;
}
.timepicker-ui-clock-animation {
  animation: clockanimation 350ms linear;
}
.timepicker-ui-open-element.disabled {
  pointer-events: none;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-tips-animation {
  transition: transform 400ms cubic-bezier(0.4, 0, 0.2, 1) 0ms, height 400ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
}
.timepicker-ui-tips-disabled {
  color: rgba(156, 155, 155, 0.6);
  pointer-events: none;
}

.opacity {
  transition: opacity 0.15s linear;
}
.opacity.show {
  opacity: 1;
}

.invalid-value {
  border-color: #d50000 !important;
  color: #d50000 !important;
}
.invalid-value:hover, .invalid-value:focus, .invalid-value:active {
  border-color: #d50000 !important;
  color: #d50000 !important;
}

@keyframes clockanimation {
  0% {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
.timepicker-ui-invalid-format {
  border: 2px solid red;
  color: red;
}

.timepicker-ui-invalid-text {
  color: red;
}`);w2(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui-wrapper.crane-straight, .timepicker-ui-wrapper.mobile.crane-straight {
  border-radius: 0;
  background-color: #4e0d3a;
  color: #fff;
}
.timepicker-ui-wrapper.crane-straight.radius, .timepicker-ui-wrapper.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-select-time.crane-straight, .timepicker-ui-select-time.mobile.crane-straight {
  color: #e5e5e5;
}
.timepicker-ui-clock-face.crane-straight, .timepicker-ui-clock-face.mobile.crane-straight {
  background-color: #71135c;
}
.timepicker-ui-dot.crane-straight, .timepicker-ui-dot.mobile.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-hour.crane-straight, .timepicker-ui-minutes.crane-straight, .timepicker-ui-hour.mobile.crane-straight, .timepicker-ui-minutes.mobile.crane-straight {
  background-color: #71135c;
  border-radius: 0;
  color: #fff;
}
.timepicker-ui-hour.crane-straight.radius, .timepicker-ui-minutes.crane-straight.radius, .timepicker-ui-hour.mobile.crane-straight.radius, .timepicker-ui-minutes.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-hour.crane-straight:hover, .timepicker-ui-hour.crane-straight.active, .timepicker-ui-minutes.crane-straight:hover, .timepicker-ui-minutes.crane-straight.active, .timepicker-ui-hour.mobile.crane-straight:hover, .timepicker-ui-hour.mobile.crane-straight.active, .timepicker-ui-minutes.mobile.crane-straight:hover, .timepicker-ui-minutes.mobile.crane-straight.active {
  background-color: #f7363e;
}
.timepicker-ui-hour.mobile.crane-straight[contenteditable=true]:focus, .timepicker-ui-hour.mobile.crane-straight[contenteditable=true]:active, .timepicker-ui-minutes.mobile.crane-straight[contenteditable=true]:focus, .timepicker-ui-minutes.mobile.crane-straight[contenteditable=true]:active {
  border-color: #fff;
  outline-color: #fff;
}
.timepicker-ui-dots.crane-straight, .timepicker-ui-dots.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-wrapper-type-time.crane-straight, .timepicker-ui-wrapper-type-time.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-am.crane-straight, .timepicker-ui-pm.crane-straight, .timepicker-ui-am.mobile.crane-straight, .timepicker-ui-pm.mobile.crane-straight {
  border: 0.125rem solid transparent;
  border-radius: 0;
  background-color: #71135c;
}
.timepicker-ui-am:hover.crane-straight, .timepicker-ui-am.active.crane-straight, .timepicker-ui-pm:hover.crane-straight, .timepicker-ui-pm.active.crane-straight, .timepicker-ui-am.mobile:hover.crane-straight, .timepicker-ui-am.mobile.active.crane-straight, .timepicker-ui-pm.mobile:hover.crane-straight, .timepicker-ui-pm.mobile.active.crane-straight {
  color: #fff;
  background-color: #f7363e;
}
.timepicker-ui-am.crane-straight.radius {
  border-top-left-radius: 1.25rem;
  border-top-right-radius: 1.25rem;
}
.timepicker-ui-pm.crane-straight.radius {
  border-bottom-left-radius: 1.25rem;
  border-bottom-right-radius: 1.25rem;
}
@media screen and (min-width: 320px) and (max-width: 826px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile).crane-straight.radius {
    border-bottom-left-radius: 1.25rem;
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
  }
}
@media screen and (min-width: 320px) and (max-width: 826px) and (orientation: landscape) {
  .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile).crane-straight.radius {
    border-bottom-right-radius: 1.25rem;
    border-top-right-radius: 1.25rem;
    border-bottom-left-radius: 0;
    border-top-left-radius: 0;
  }
}
@media screen and (min-width: 320px) and (max-width: 767px) and (orientation: landscape) {
  .timepicker-ui-am.mobile.crane-straight.radius {
    border-bottom-left-radius: 0rem;
    border-bottom-right-radius: 0rem;
  }
}
@media screen and (min-width: 320px) and (max-width: 767px) and (orientation: landscape) {
  .timepicker-ui-pm.mobile.crane-straight.radius {
    border-top-left-radius: 0rem;
    border-top-right-radius: 0rem;
  }
}
.timepicker-ui-cancel-btn.crane-straight, .timepicker-ui-ok-btn.crane-straight, .timepicker-ui-cancel-btn.mobile.crane-straight, .timepicker-ui-ok-btn.mobile.crane-straight {
  color: #fff;
  border-radius: 0rem;
}
.timepicker-ui-cancel-btn.crane-straight.radius, .timepicker-ui-ok-btn.crane-straight.radius, .timepicker-ui-cancel-btn.mobile.crane-straight.radius, .timepicker-ui-ok-btn.mobile.crane-straight.radius {
  border-radius: 0.8125rem;
}
.timepicker-ui-cancel-btn:hover.crane-straight, .timepicker-ui-ok-btn:hover.crane-straight, .timepicker-ui-cancel-btn.mobile:hover.crane-straight, .timepicker-ui-ok-btn.mobile:hover.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight.radius, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.crane-straight:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight:hover .timepicker-ui-keyboard-icon.mobile {
  background-color: #f7363e;
  color: #fff;
  border-radius: 0;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight.radius:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.crane-straight.radius:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius:hover .timepicker-ui-keyboard-icon.mobile {
  border-radius: 0.875rem;
}
.timepicker-ui-keyboard-icon.crane-straight:hover, .timepicker-ui-keyboard-icon.mobile.crane-straight:hover {
  color: #fff;
}
.timepicker-ui-keyboard-icon.crane-straight:hover.radius, .timepicker-ui-keyboard-icon.mobile.crane-straight:hover.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-clock-hand.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-circle-hand.crane-straight {
  border-color: #f7363e;
  background-color: #f7363e;
}
.timepicker-ui-value-tips.crane-straight {
  color: #fff;
}`);w2(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui-hour-time-12.m3, .timepicker-ui-hour-time-24.m3 {
  color: #1a1c18;
}
.timepicker-ui-wrapper.m3 {
  border-radius: 35px;
  background-color: #e5eadc;
  box-shadow: unset;
}
.timepicker-ui-hour.active.m3, .timepicker-ui-minutes.active.m3 {
  background-color: #b8f397;
  color: #042100;
}
.timepicker-ui-minutes.m3, .timepicker-ui-hour.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-minutes:hover.m3, .timepicker-ui-hour:hover.m3 {
  color: #386a20;
}
.timepicker-ui-clock-face.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-clock-hand.m3, .timepicker-ui-dot.m3, .timepicker-ui-circle-hand.m3 {
  background-color: #386a20 !important;
}
.timepicker-ui-cancel-btn.m3, .timepicker-ui-ok-btn.m3 {
  color: #386a20;
}
.timepicker-ui-cancel-btn:hover.m3, .timepicker-ui-ok-btn:hover.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-wrapper-type-time.m3 {
  color: #6b7165;
}
.timepicker-ui-am.m3, .timepicker-ui-am.m3, .timepicker-ui-pm.m3, .timepicker-ui-pm.m3 {
  border-color: #74796e;
  border-width: 1px;
}
.timepicker-ui-am.m3, .timepicker-ui-am.m3 {
  border-bottom-width: 0px;
}
.timepicker-ui-am:hover.m3, .timepicker-ui-am.active.m3, .timepicker-ui-pm:hover.m3, .timepicker-ui-pm.active.m3 {
  background-color: #bbebeb;
  color: #002021;
}
.timepicker-ui-hour.mobile:hover.m3, .timepicker-ui-minutes.mobile:hover.m3 {
  background-color: #dfe4d6;
}`);var JE=`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}`;w2(JE);const Lct={amLabel:"AM",animation:!0,appendModalSelector:"",backdrop:!0,cancelLabel:"CANCEL",editable:!1,enableScrollbar:!1,enableSwitchIcon:!1,mobileTimeLabel:"Enter Time",focusInputAfterCloseModal:!1,hourMobileLabel:"Hour",iconTemplate:'<i class="material-icons timepicker-ui-keyboard-icon">keyboard</i>',iconTemplateMobile:'<i class="material-icons timepicker-ui-keyboard-icon">schedule</i>',incrementHours:1,incrementMinutes:1,minuteMobileLabel:"Minute",mobile:!1,okLabel:"OK",pmLabel:"PM",timeLabel:"Select Time",switchToMinutesAfterSelectHour:!1,theme:"basic",clockType:"12h",disabledTime:void 0,currentTime:void 0,focusTrap:!0,delayHandler:300},vj="mousedown mouseup mousemove mouseleave mouseover touchstart touchmove touchend",oie=["00","13","14","15","16","17","18","19","20","21","22","23"],RS=["12","1","2","3","4","5","6","7","8","9","10","11"],mI=["00","05","10","15","20","25","30","35","40","45","50","55"];let wg=class{constructor(e){this.clean=()=>{var i,n;const r=(i=this.tipsWrapper)===null||i===void 0?void 0:i.querySelectorAll("span.timepicker-ui-hour-time-12"),a=(n=this.tipsWrapper)===null||n===void 0?void 0:n.querySelectorAll("span.timepicker-ui-minutes-time");this._removeClasses(r),this._removeClasses(a)},this.create=()=>{var i;if(!(this.clockFace&&this.array&&this.classToAdd&&this.tipsWrapper))return;const n=(this.clockFace.offsetWidth-32)/2,r=(this.clockFace.offsetHeight-32)/2,a=n-9;this.tipsWrapper.innerHTML="",(i=this.array)===null||i===void 0||i.forEach(((s,o)=>{var l,u,c,d,p,h;const f=o*(360/this.array.length)*(Math.PI/180),m=document.createElement("span"),g=document.createElement("span");g.innerHTML=s,this.disabledTime&&(Array.isArray(this.disabledTime)&&(!((l=this.disabledTime)===null||l===void 0)&&l.includes(s))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled")),this.hour===this.disabledTime.removedStartedHour&&(!((c=(u=this.disabledTime)===null||u===void 0?void 0:u.startMinutes)===null||c===void 0)&&c.includes(s))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled"),g.tabIndex=-1),this.hour===this.disabledTime.removedEndHour&&(!((p=(d=this.disabledTime)===null||d===void 0?void 0:d.endMinutes)===null||p===void 0)&&p.includes(s))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled"),g.tabIndex=-1)),this.clockType==="24h"?(g.classList.add("timepicker-ui-value-tips-24h"),_n(g,"timepicker-ui-tips-disabled")||(g.tabIndex=0)):(g.classList.add("timepicker-ui-value-tips"),_n(g,"timepicker-ui-tips-disabled")||(g.tabIndex=0)),m.classList.add(this.classToAdd),this.theme==="crane-straight"&&(m.classList.add("crane-straight"),g.classList.add("crane-straight")),this.theme==="m3"&&(m.classList.add("m3"),g.classList.add("m3")),m.style.left=n+Math.sin(f)*a-m.offsetWidth+"px",m.style.bottom=r+Math.cos(f)*a-m.offsetHeight+"px",m.appendChild(g),(h=this.tipsWrapper)===null||h===void 0||h.appendChild(m)}))},this.updateDisable=i=>{var n,r;const a=(n=this.tipsWrapper)===null||n===void 0?void 0:n.querySelectorAll("span.timepicker-ui-hour-time-12"),s=(r=this.tipsWrapper)===null||r===void 0?void 0:r.querySelectorAll("span.timepicker-ui-minutes-time");if(this._removeClasses(a),this._removeClasses(s),i?.hoursToUpdate&&a&&this._addClassesWithIncludes(a,i.hoursToUpdate),i?.minutesToUpdate&&s){const{actualHour:o,removedEndHour:l,removedStartedHour:u,startMinutes:c,endMinutes:d}=i.minutesToUpdate;l===o&&d.length>0?this._addClassesWithIncludes(s,d):Number(o)>Number(u)&&Number(o)<Number(l)&&this._addClasses(s),u===o&&c.length>0?this._addClassesWithIncludes(s,c):Number(o)>Number(u)&&Number(o)<Number(l)&&this._addClasses(s)}if(i){const{amHours:o,pmHours:l,activeMode:u,startMinutes:c,endMinutes:d,removedAmHour:p,removedPmHour:h,actualHour:f}=i.minutesToUpdate;if(!o||!l)return;a&&(o&&u==="AM"&&this._addClassesWithIncludes(a,o),l&&u==="PM"&&this._addClassesWithIncludes(a,l)),s&&c&&d&&(u==="AM"&&(d[0]==="00"&&d.length===1&&c.length===0&&Number(f)>=Number(o[0])&&this._addClasses(s),c.length===0&&d.length>1&&Number(f)>=Number(p)&&this._addClasses(s),c.length>0&&d.length>1&&d[0]==="00"&&(Number(p)===Number(f)?this._addClassesWithIncludes(s,c):Number(f)>Number(p)&&this._addClasses(s)),d[0]==="00"&&d.length===1&&c.length>0&&(Number(p)===Number(f)?this._addClassesWithIncludes(s,c):Number(f)>Number(p)&&this._addClasses(s))),u==="PM"&&(f<Number(h)&&this._addClasses(s),f===h&&this._addClassesWithIncludes(s,d),d.length>0&&Number(f)===h-1&&this._addClassesWithIncludes(s,d)))}},this._removeClasses=i=>{i?.forEach((({classList:n,children:r})=>{n.remove("timepicker-ui-tips-disabled"),r[0].classList.remove("timepicker-ui-tips-disabled"),r[0].tabIndex=0}))},this._addClasses=i=>{i?.forEach((({classList:n,children:r})=>{n.add("timepicker-ui-tips-disabled"),r[0].classList.add("timepicker-ui-tips-disabled"),r[0].tabIndex=-1}))},this._addClassesWithIncludes=(i,n)=>{i?.forEach((({classList:r,children:a,textContent:s})=>{n?.includes(s)&&(r.add("timepicker-ui-tips-disabled"),a[0].classList.add("timepicker-ui-tips-disabled"),a[0].tabIndex=-1)}))},this.array=e?.array,this.classToAdd=e?.classToAdd,this.clockFace=e?.clockFace,this.tipsWrapper=e?.tipsWrapper,this.theme=e?.theme,this.clockType=e?.clockType,this.disabledTime=e?.disabledTime,this.hour=e?.hour}};const lie=(t,e)=>{let i;return(...n)=>{clearTimeout(i),i=setTimeout((()=>{t(...n)}),e)}};let Fct=class{constructor(e,i){var n,r,a;this.create=()=>{this._updateInputValueWithCurrentTimeOnStart(),this._checkDisabledValuesOnStart(),this._setTimepickerClassToElement(),this._setInputClassToInputElement(),this._setDataOpenToInputIfDosentExistInWrapper(),this._setClassTopOpenElement(),this._handleOpenOnEnterFocus(),this._handleOpenOnClick(),this._getDisableTime()},this.open=s=>{this.create(),this._eventsBundle(),PA(s)},this.close=()=>lie(((...s)=>{var o;if(s.length>2||!this.modalElement)return;const[l]=s.filter((c=>typeof c=="boolean")),[u]=s.filter((c=>typeof c=="function"));l&&(this._handleOkButton(),(o=this.okButton)===null||o===void 0||o.click()),this._isTouchMouseMove=!1,vj.split(" ").map((c=>document.removeEventListener(c,this._mutliEventsMoveHandler,!1))),document.removeEventListener("mousedown",this._eventsClickMobileHandler),document.removeEventListener("touchstart",this._eventsClickMobileHandler),document.removeEventListener("keypress",this._handleEscClick),this.wrapper.removeEventListener("keydown",this._focusTrapHandler),this._options.enableSwitchIcon&&(this.keyboardClockIcon.removeEventListener("touchstart",this._handlerViewChange()),this.keyboardClockIcon.removeEventListener("mousedown",this._handlerViewChange())),this._removeAnimationToClose(),this.openElement.forEach((c=>c?.classList.remove("disabled"))),setTimeout((()=>{document.body.style.overflowY="",document.body.style.paddingRight=""}),400),this.openElement.forEach((c=>c?.classList.remove("disabled"))),setTimeout((()=>{var c;this._options.focusInputAfterCloseModal&&((c=this.input)===null||c===void 0||c.focus()),this.modalElement!==null&&(this.modalElement.remove(),this._isModalRemove=!0)}),300),PA(u)}),this._options.delayHandler||300),this.destroy=s=>{vj.split(" ").map((o=>document.removeEventListener(o,this._mutliEventsMoveHandler,!1))),document.removeEventListener("mousedown",this._eventsClickMobileHandler),document.removeEventListener("touchstart",this._eventsClickMobileHandler),this._options.enableSwitchIcon&&this.keyboardClockIcon&&(this.keyboardClockIcon.removeEventListener("touchstart",this._handlerViewChange()),this.keyboardClockIcon.removeEventListener("mousedown",this._handlerViewChange())),this._cloned=this._element.cloneNode(!0),this._element.after(this._cloned),this._element.remove(),this._element=null,this._element===null&&PA(s),this._element=this._cloned},this.update=(s,o)=>{this._options=Object.assign(Object.assign({},this._options),s.options),this._checkMobileOption(),s.create&&this.create(),PA(o)},this._preventClockTypeByCurrentTime=()=>{var s,o,l,u,c;if(typeof((s=this._options)===null||s===void 0?void 0:s.currentTime)!="boolean"&&(!((l=(o=this._options)===null||o===void 0?void 0:o.currentTime)===null||l===void 0)&&l.preventClockType)||typeof((u=this._options)===null||u===void 0?void 0:u.currentTime)=="boolean"&&(!((c=this._options)===null||c===void 0)&&c.currentTime)){const{currentTime:d,clockType:p}=this._options,{type:h}=Sd(this.input,p,d,!0);this._options.clockType=h?"12h":"24h"}},this._updateInputValueWithCurrentTimeOnStart=()=>{var s,o,l,u,c;if(typeof((s=this._options)===null||s===void 0?void 0:s.currentTime)!="boolean"&&(!((l=(o=this._options)===null||o===void 0?void 0:o.currentTime)===null||l===void 0)&&l.updateInput)||typeof((u=this._options)===null||u===void 0?void 0:u.currentTime)=="boolean"&&(!((c=this._options)===null||c===void 0)&&c.currentTime)){const{hour:d,minutes:p,type:h}=Sd(this.input,this._options.clockType,this._options.currentTime);this.input.value=h?`${d}:${p} ${h}`:`${d}:${p}`}},this._setTheme=()=>{var s,o;const l=(s=this.modalElement)===null||s===void 0?void 0:s.querySelectorAll("div"),u=[...(o=this.modalElement)===null||o===void 0?void 0:o.querySelectorAll("input"),...l],{theme:c}=this._options;c==="crane-straight"?u.forEach((d=>d.classList.add("crane-straight"))):c==="crane-radius"?u.forEach((d=>d.classList.add("crane-straight","radius"))):c==="m3"&&u.forEach((d=>d.classList.add("m3")))},this._setInputClassToInputElement=()=>{var s;_n(this.input,"timepicker-ui-input")||(s=this.input)===null||s===void 0||s.classList.add("timepicker-ui-input")},this._setDataOpenToInputIfDosentExistInWrapper=()=>{var s;this.openElementData===null&&((s=this.input)===null||s===void 0||s.setAttribute("data-open","timepicker-ui-input"))},this._setClassTopOpenElement=()=>{this.openElement.forEach((s=>s?.classList.add("timepicker-ui-open-element")))},this._removeBackdrop=()=>{var s;this._options.backdrop||((s=this.modalElement)===null||s===void 0||s.classList.add("removed"),this.openElement.forEach((o=>o?.classList.add("disabled"))))},this._setNormalizeClass=()=>{var s,o;const l=(s=this.modalElement)===null||s===void 0?void 0:s.querySelectorAll("div");(o=this.modalElement)===null||o===void 0||o.classList.add("timepicker-ui-normalize"),l?.forEach((u=>u.classList.add("timepicker-ui-normalize")))},this._setFlexEndToFooterIfNoKeyboardIcon=()=>{!this._options.enableSwitchIcon&&this.footer&&(this.footer.style.justifyContent="flex-end")},this._eventsBundle=()=>{var s,o,l,u,c,d,p,h,f,m,g,v,y;if(this._isModalRemove){if(this._handleEscClick(),this._setErrorHandler(),this._removeErrorHandler(),this.openElement.forEach((b=>b?.classList.add("disabled"))),(s=this.input)===null||s===void 0||s.blur(),this._setScrollbarOrNot(),this._setModalTemplate(),this._setNormalizeClass(),this._removeBackdrop(),this._setBgColorToCirleWithHourTips(),this._setOnStartCSSClassesIfClockType24h(),this._setClassActiveToHourOnOpen(),this.clockFace!==null){const b=new wg({array:RS,classToAdd:"timepicker-ui-hour-time-12",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:!((l=(o=this._disabledTime)===null||o===void 0?void 0:o.value)===null||l===void 0)&&l.isInterval?(u=this._disabledTime)===null||u===void 0?void 0:u.value.rangeArrHour:(d=(c=this._disabledTime)===null||c===void 0?void 0:c.value)===null||d===void 0?void 0:d.hours,clockType:"12h",hour:this.hour.value});b.create(),this._options.clockType==="24h"?new wg({array:oie,classToAdd:"timepicker-ui-hour-time-24",clockFace:this.tipsWrapperFor24h,tipsWrapper:this.tipsWrapperFor24h,theme:this._options.theme,clockType:"24h",disabledTime:!((h=(p=this._disabledTime)===null||p===void 0?void 0:p.value)===null||h===void 0)&&h.isInterval?(f=this._disabledTime)===null||f===void 0?void 0:f.value.rangeArrHour:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.hours,hour:this.hour.value}).create():(((v=this._disabledTime)===null||v===void 0?void 0:v.value.startType)===((y=this._disabledTime)===null||y===void 0?void 0:y.value.endType)?setTimeout((()=>{var I,S,w,T,U,C,E,P;((I=this._disabledTime)===null||I===void 0?void 0:I.value.startType)===((S=this.activeTypeMode)===null||S===void 0?void 0:S.textContent)&&b.updateDisable({hoursToUpdate:(T=(w=this._disabledTime)===null||w===void 0?void 0:w.value)===null||T===void 0?void 0:T.rangeArrHour,minutesToUpdate:{endMinutes:(U=this._disabledTime)===null||U===void 0?void 0:U.value.endMinutes,removedEndHour:(C=this._disabledTime)===null||C===void 0?void 0:C.value.removedEndHour,removedStartedHour:(E=this._disabledTime)===null||E===void 0?void 0:E.value.removedStartedHour,actualHour:this.hour.value,startMinutes:(P=this._disabledTime)===null||P===void 0?void 0:P.value.startMinutes}})}),300):setTimeout((()=>{var I,S,w;b.updateDisable({minutesToUpdate:{actualHour:this.hour.value,pmHours:(I=this._disabledTime)===null||I===void 0?void 0:I.value.pmHours,amHours:(S=this._disabledTime)===null||S===void 0?void 0:S.value.amHours,activeMode:(w=this.activeTypeMode)===null||w===void 0?void 0:w.textContent}})}),300),b.updateDisable())}this._setFlexEndToFooterIfNoKeyboardIcon(),setTimeout((()=>{this._setTheme()}),0),this._setAnimationToOpen(),this._getInputValueOnOpenAndSet(),this._toggleClassActiveToValueTips(this.hour.value),this._isMobileView||(this._setTransformToCircleWithSwitchesHour(this.hour.value),this._handleAnimationClock()),this._handleMinutesEvents(),this._handleHourEvents(),this._options.clockType!=="24h"&&(this._handleAmClick(),this._handlePmClick()),this.clockFace&&this._handleMoveHand(),this._handleCancelButton(),this._handleOkButton(),this.modalElement&&(this._setShowClassToBackdrop(),this._handleBackdropClick()),this._handleIconChangeView(),this._handleClickOnHourMobile(),this._options.focusTrap&&this._focusTrapHandler()}},this._handleOpenOnClick=()=>{this.openElement.forEach((s=>this._clickTouchEvents.forEach((o=>s?.addEventListener(o,(()=>this._eventsBundle()))))))},this._getInputValueOnOpenAndSet=()=>{var s,o;const l=Sd(this.input,this._options.clockType,this._options.currentTime);if(l===void 0)return this.hour.value="12",this.minutes.value="00",lp(this._element,"show",{hour:this.hour.value,minutes:this.minutes.value,type:(s=this.activeTypeMode)===null||s===void 0?void 0:s.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),void(this._options.clockType!=="24h"&&this.AM.classList.add("active"));let[u,c,d]=this.input.value.split(":").join(" ").split(" ");this.input.value.length===0&&(u=l.hour,c=l.minutes,d=l.type),this.hour.value=u,this.minutes.value=c;const p=document.querySelector(`[data-type='${d}']`);this._options.clockType!=="24h"&&p&&p.classList.add("active"),lp(this._element,"show",Object.assign(Object.assign({},l),{type:(o=this.activeTypeMode)===null||o===void 0?void 0:o.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}))},this._handleCancelButton=()=>{this._clickTouchEvents.forEach((s=>{this.cancelButton.addEventListener(s,(()=>{var o;const l=Sd(this.input,this._options.clockType);lp(this._element,"cancel",Object.assign(Object.assign({},l),{hourNotAccepted:this.hour.value,minutesNotAccepted:this.minutes.value,type:(o=this.activeTypeMode)===null||o===void 0?void 0:o.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})),this.close()()}))}))},this._handleOkButton=()=>{this._clickTouchEvents.forEach((s=>{var o;(o=this.okButton)===null||o===void 0||o.addEventListener(s,(()=>{var l,u,c;const{clockType:d,disabledTime:p}=this._options,h=gy(this.hour.value,"hour",d),f=gy(this.minutes.value,"minutes",d);let m;const g=CA(this.hour.value,"hour",d,p?.hours),v=CA(this.minutes.value,"minutes",d,p?.minutes);if(p?.interval&&(m=((y,b,I,S)=>{const w=I?gj(`${y}:${b} ${I}`.trim()):`${y}:${b}`.trim();let T,U;if(I){const[C,E]=S.trim().split("-").map((P=>P.trim()));T=gj(C),U=gj(E)}else{const[C,E]=S.trim().split("-"),P=M=>M.trim().split(":").map((R=>Number(R)<=9?`0${Number(R)}`:R)).join(":");T=P(C),U=P(E)}return w<T||w>U})(this.hour.value,this.minutes.value,(l=this.activeTypeMode)===null||l===void 0?void 0:l.textContent,p.interval)),m===!1||h===!1||f===!1||g===!1||v===!1)return m!==!1&&f&&v||this.minutes.classList.add("invalid-value"),void(m!==!1&&h&&g||this.hour.classList.add("invalid-value"));this.input.value=`${this.hour.value}:${this.minutes.value} ${this._options.clockType==="24h"?"":(u=this.activeTypeMode)===null||u===void 0?void 0:u.dataset.type}`.trimEnd(),lp(this._element,"accept",{hour:this.hour.value,minutes:this.minutes.value,type:(c=this.activeTypeMode)===null||c===void 0?void 0:c.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),this.close()()}))}))},this._setShowClassToBackdrop=()=>{this._options.backdrop&&setTimeout((()=>{this.modalElement.classList.add("show")}),300)},this._handleBackdropClick=()=>{var s;(s=this.modalElement)===null||s===void 0||s.addEventListener("click",(o=>{var l;const u=o.target;if(!_n(u,"timepicker-ui-modal"))return;const c=Sd(this.input,this._options.clockType);lp(this._element,"cancel",Object.assign(Object.assign({},c),{hourNotAccepted:this.hour.value,minutesNotAccepted:this.minutes.value,type:(l=this.activeTypeMode)===null||l===void 0?void 0:l.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})),this.close()()}))},this._setBgColorToCirleWithHourTips=()=>{if(!this._options)return;const{mobile:s,theme:o}=this._options;s||this.circle===null||(this.circle.style.backgroundColor=o==="crane-straight"||o==="crane-radius"?JE.cranered400:JE.purple)},this._setBgColorToCircleWithMinutesTips=()=>{const{theme:s}=this._options;this.minutes.value&&mI.includes(this.minutes.value)&&(this.circle.style.backgroundColor=s==="crane-straight"||s==="crane-radius"?JE.cranered400:JE.purple,this.circle.classList.remove("small-circle"))},this._removeBgColorToCirleWithMinutesTips=()=>{this.minutes.value&&mI.includes(this.minutes.value)||(this.circle.style.backgroundColor="",this.circle.classList.add("small-circle"))},this._setTimepickerClassToElement=()=>{var s;(s=this._element)===null||s===void 0||s.classList.add("timepicker-ui")},this._setClassActiveToHourOnOpen=()=>{var s;this._options.mobile||this._isMobileView||(s=this.hour)===null||s===void 0||s.classList.add("active")},this._setMinutesToClock=s=>{var o,l,u,c,d;this.clockFace!==null&&this._setTransformToCircleWithSwitchesMinutes(s),this._removeBgColorToCirleWithMinutesTips();const p=!((l=(o=this._disabledTime)===null||o===void 0?void 0:o.value)===null||l===void 0)&&l.minutes?(c=(u=this._disabledTime)===null||u===void 0?void 0:u.value)===null||c===void 0?void 0:c.minutes:(d=this._disabledTime)===null||d===void 0?void 0:d.value,h=new wg({array:mI,classToAdd:"timepicker-ui-minutes-time",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:p,hour:this.hour.value,clockType:this._options.clockType});h.create(),this._options.clockType==="12h"&&h.updateDisable(),this._toggleClassActiveToValueTips(s),this._options.clockType==="24h"&&(this.tipsWrapperFor24h.innerHTML="")},this._setHoursToClock=s=>{var o,l,u,c,d;if(this.clockFace!==null){this._setTransformToCircleWithSwitchesHour(s),this._setBgColorToCirleWithHourTips();const p=!((l=(o=this._disabledTime)===null||o===void 0?void 0:o.value)===null||l===void 0)&&l.isInterval?(u=this._disabledTime)===null||u===void 0?void 0:u.value.rangeArrHour:(d=(c=this._disabledTime)===null||c===void 0?void 0:c.value)===null||d===void 0?void 0:d.hours,h=new wg({array:RS,classToAdd:"timepicker-ui-hour-time-12",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:p,clockType:"12h",hour:this.hour.value});h.create(),this._options.clockType==="24h"?new wg({array:oie,classToAdd:"timepicker-ui-hour-time-24",clockFace:this.tipsWrapperFor24h,tipsWrapper:this.tipsWrapperFor24h,theme:this._options.theme,clockType:"24h",disabledTime:p,hour:this.hour.value}).create():h.updateDisable(),this._toggleClassActiveToValueTips(s)}},this._setTransformToCircleWithSwitchesHour=s=>{const o=Number(s);let l=o>12?30*o-360:30*o;l===360&&(l=0),l>360||(this.clockHand.style.transform=`rotateZ(${l}deg)`)},this._setTransformToCircleWithSwitchesMinutes=s=>{const o=6*Number(s);o>360||(this.clockHand.style.transform=`rotateZ(${o}deg)`)},this._handleAmClick=()=>{this._clickTouchEvents.forEach((s=>{this.AM.addEventListener(s,(o=>{var l,u,c,d;if(o.target.classList.add("active"),this.PM.classList.remove("active"),this._options.clockType==="12h"&&((l=this._options.disabledTime)===null||l===void 0?void 0:l.interval)){const p=new wg({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:_n(this.hour,"active")?RS:mI});((u=this._disabledTime)===null||u===void 0?void 0:u.value.startType)===((c=this._disabledTime)===null||c===void 0?void 0:c.value.endType)?setTimeout((()=>{var h,f,m,g;((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this.activeTypeMode)===null||f===void 0?void 0:f.textContent)?p.updateDisable(Object.assign({hoursToUpdate:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.rangeArrHour},this._getDestructuringObj())):p.clean()}),300):setTimeout((()=>{p.updateDisable(Object.assign({},this._getDestructuringObj(!0)))}),300),p.updateDisable()}lp(this._element,"selectamtypemode",{hour:this.hour.value,minutes:this.minutes.value,type:(d=this.activeTypeMode)===null||d===void 0?void 0:d.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})}))}))},this._handlePmClick=()=>{this._clickTouchEvents.forEach((s=>{this.PM.addEventListener(s,(o=>{var l,u,c,d;if(o.target.classList.add("active"),this.AM.classList.remove("active"),this._options.clockType==="12h"&&((l=this._options.disabledTime)===null||l===void 0?void 0:l.interval)){const p=new wg({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:_n(this.hour,"active")?RS:mI});((u=this._disabledTime)===null||u===void 0?void 0:u.value.startType)===((c=this._disabledTime)===null||c===void 0?void 0:c.value.endType)?setTimeout((()=>{var h,f,m,g;((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this.activeTypeMode)===null||f===void 0?void 0:f.textContent)?p.updateDisable(Object.assign({hoursToUpdate:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.rangeArrHour},this._getDestructuringObj())):p.clean()}),300):setTimeout((()=>{p.updateDisable(Object.assign({},this._getDestructuringObj(!0)))}),300)}lp(this._element,"selectpmtypemode",{hour:this.hour.value,minutes:this.minutes.value,type:(d=this.activeTypeMode)===null||d===void 0?void 0:d.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})}))}))},this._handleAnimationClock=()=>{this._options.animation&&setTimeout((()=>{var s;(s=this.clockFace)===null||s===void 0||s.classList.add("timepicker-ui-clock-animation"),setTimeout((()=>{var o;(o=this.clockFace)===null||o===void 0||o.classList.remove("timepicker-ui-clock-animation")}),600)}),150)},this._handleAnimationSwitchTipsMode=()=>{this.clockHand.classList.add("timepicker-ui-tips-animation"),setTimeout((()=>{var s;(s=this.clockHand)===null||s===void 0||s.classList.remove("timepicker-ui-tips-animation")}),401)},this._handleClasses24h=(s,o)=>{var l;const u=s.target;this.hourTips&&this._options.clockType==="24h"&&(Number(u.textContent)>12||Number(u.textContent)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h(),this._options.mobile||(l=this.tipsWrapperFor24h)===null||l===void 0||l.classList.remove("timepicker-ui-tips-wrapper-24h-disabled")),u&&o&&(o.value=u.value.replace(/\D+/g,""),o.click())},this._handleHourEvents=()=>{var s,o;this._inputEvents.forEach((l=>{var u;(u=this.hour)===null||u===void 0||u.addEventListener(l,(c=>{var d,p,h,f,m;const g=c.target;if(this.clockFace!==null&&this._handleAnimationSwitchTipsMode(),this._options.clockType==="24h"&&(Number(g.value)>12||Number(g.value)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h(),this._options.mobile||(d=this.tipsWrapperFor24h)===null||d===void 0||d.classList.remove("timepicker-ui-tips-wrapper-24h-disabled")),this._setHoursToClock(g.value),g.classList.add("active"),this.minutes.classList.remove("active"),this._options.clockType==="12h"&&((p=this._options.disabledTime)===null||p===void 0?void 0:p.interval)){const v=new wg({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:_n(this.hour,"active")?RS:mI});((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this._disabledTime)===null||f===void 0?void 0:f.value.endType)?setTimeout((()=>{var y,b,I,S;((y=this._disabledTime)===null||y===void 0?void 0:y.value.startType)===((b=this.activeTypeMode)===null||b===void 0?void 0:b.textContent)?v.updateDisable(Object.assign({hoursToUpdate:(S=(I=this._disabledTime)===null||I===void 0?void 0:I.value)===null||S===void 0?void 0:S.rangeArrHour},this._getDestructuringObj())):v.clean()}),300):setTimeout((()=>{v.updateDisable(Object.assign({},this._getDestructuringObj(!0)))}),300)}lp(this._element,"selecthourmode",{hour:this.hour.value,minutes:this.minutes.value,type:(m=this.activeTypeMode)===null||m===void 0?void 0:m.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),this.clockFace!==null&&this.circle.classList.remove("small-circle")}))})),(s=this.hour)===null||s===void 0||s.addEventListener("blur",(l=>this._handleClasses24h(l,this.hour))),(o=this.hour)===null||o===void 0||o.addEventListener("focus",(l=>this._handleClasses24h(l,this.hour)))},this._handleMinutesEvents=()=>{var s,o;this._inputEvents.forEach((l=>{this.minutes.addEventListener(l,(u=>{var c,d,p,h,f,m;const g=u.target;if(this.clockFace!==null&&(this._handleAnimationSwitchTipsMode(),this._setMinutesToClock(g.value)),this._options.clockType==="24h"&&(this._removeCircleClockClasses24h(),this._options.mobile||(c=this.tipsWrapperFor24h)===null||c===void 0||c.classList.add("timepicker-ui-tips-wrapper-24h-disabled")),g.classList.add("active"),(d=this.hour)===null||d===void 0||d.classList.remove("active"),this._options.clockType==="12h"&&((p=this._options.disabledTime)===null||p===void 0?void 0:p.interval)){const v=new wg({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:_n(this.hour,"active")?RS:mI});((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this._disabledTime)===null||f===void 0?void 0:f.value.endType)?setTimeout((()=>{var y,b,I;((y=this._disabledTime)===null||y===void 0?void 0:y.value.startType)===((b=this.activeTypeMode)===null||b===void 0?void 0:b.textContent)?v.updateDisable(Object.assign({hoursToUpdate:(I=this._disabledTime)===null||I===void 0?void 0:I.value.rangeArrHour},this._getDestructuringObj())):v.clean()}),300):setTimeout((()=>{v.updateDisable(Object.assign({},this._getDestructuringObj(!0)))}),300)}lp(this._element,"selectminutemode",{hour:this.hour.value,minutes:this.minutes.value,type:(m=this.activeTypeMode)===null||m===void 0?void 0:m.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})}))})),(s=this.minutes)===null||s===void 0||s.addEventListener("blur",(l=>this._handleClasses24h(l,this.minutes))),(o=this.minutes)===null||o===void 0||o.addEventListener("focus",(l=>this._handleClasses24h(l,this.minutes)))},this._handleEventToMoveHand=s=>{var o,l,u,c,d,p,h,f,m,g,v,y,b,I,S,w,T,U,C,E,P,M,R,N,A,_,x,O,$,F,j,H,G,W,q,Z,K,Q,J,ne,re,oe,de,se,ge,ye,Te,De,xe,Me,Oe,at,Fe,mt,Xe,gt,ht,_e,Ye,Je,ct,pt;const{target:Se,type:he,touches:we}=s,be=Se,{incrementMinutes:Ae,incrementHours:ze,switchToMinutesAfterSelectHour:We}=this._options;if(!sie(s,this.clockFace))return;const Le=sie(s,this.clockFace),ft=this.clockFace.offsetWidth/2,rt=Le&&Math.atan2(Le.y-ft,Le.x-ft);if(he==="mouseup"||he==="touchend")return this._isTouchMouseMove=!1,void(We&&(_n(be,"timepicker-ui-value-tips")||_n(be,"timepicker-ui-value-tips-24h")||_n(be,"timepicker-ui-tips-wrapper"))&&this.minutes.click());if(he!=="mousedown"&&he!=="mousemove"&&he!=="touchmove"&&he!=="touchstart"||he!=="mousedown"&&he!=="touchstart"&&he!=="touchmove"||((_n(be,"timepicker-ui-clock-face")||_n(be,"timepicker-ui-circle-hand")||_n(be,"timepicker-ui-hour-time-12")||_n(be,"timepicker-ui-minutes-time")||_n(be,"timepicker-ui-clock-hand")||_n(be,"timepicker-ui-value-tips")||_n(be,"timepicker-ui-value-tips-24h")||_n(be,"timepicker-ui-tips-wrapper")||_n(be,"timepicker-ui-tips-wrapper-24h"))&&!_n(be,"timepicker-ui-tips-disabled")?(s.preventDefault(),this._isTouchMouseMove=!0):this._isTouchMouseMove=!1),!this._isTouchMouseMove)return;if(this.minutesTips!==null){this.minutes.classList.add("active");let Qe,bt=rt&&fj(Math.trunc(180*rt/Math.PI)+90,Ae,6);if(bt===void 0)return;if(bt<0?(Qe=Math.round(360+bt/6)%60,bt=360+6*Math.round(bt/6)):(Qe=Math.round(bt/6)%60,bt=6*Math.round(bt/6)),(o=this._disabledTime)===null||o===void 0?void 0:o.value.isInterval){if(((d=this._disabledTime)===null||d===void 0?void 0:d.value.endType)===((p=this._disabledTime)===null||p===void 0?void 0:p.value.startType)){if(!((m=(f=(h=this._disabledTime)===null||h===void 0?void 0:h.value)===null||f===void 0?void 0:f.endMinutes)===null||m===void 0)&&m.includes(Qe<=9?`0${Qe}`:`${Qe}`)&&this.hour.value===((v=(g=this._disabledTime)===null||g===void 0?void 0:g.value)===null||v===void 0?void 0:v.removedEndHour)&&((y=this._disabledTime)===null||y===void 0?void 0:y.value.endType)===((b=this.activeTypeMode)===null||b===void 0?void 0:b.textContent)||!((w=(S=(I=this._disabledTime)===null||I===void 0?void 0:I.value)===null||S===void 0?void 0:S.startMinutes)===null||w===void 0)&&w.includes(Qe<=9?`0${Qe}`:`${Qe}`)&&this.hour.value===((U=(T=this._disabledTime)===null||T===void 0?void 0:T.value)===null||U===void 0?void 0:U.removedStartedHour)&&((C=this._disabledTime)===null||C===void 0?void 0:C.value.startType)===((E=this.activeTypeMode)===null||E===void 0?void 0:E.textContent))return}else if(((P=this.activeTypeMode)===null||P===void 0?void 0:P.textContent)===((M=this._disabledTime)===null||M===void 0?void 0:M.value.endType)&&(!((A=(N=(R=this._disabledTime)===null||R===void 0?void 0:R.value)===null||N===void 0?void 0:N.endMinutes)===null||A===void 0)&&A.includes(Qe<=9?`0${Qe}`:`${Qe}`)&&((_=this._disabledTime)===null||_===void 0?void 0:_.value.removedPmHour)===this.hour.value||!((x=this._disabledTime)===null||x===void 0)&&x.value.pmHours.map(Number).includes(Number(this.hour.value)))||((O=this.activeTypeMode)===null||O===void 0?void 0:O.textContent)===(($=this._disabledTime)===null||$===void 0?void 0:$.value.startType)&&(!((H=(j=(F=this._disabledTime)===null||F===void 0?void 0:F.value)===null||j===void 0?void 0:j.startMinutes)===null||H===void 0)&&H.includes(Qe<=9?`0${Qe}`:`${Qe}`)&&((G=this._disabledTime)===null||G===void 0?void 0:G.value.removedAmHour)===this.hour.value||!((W=this._disabledTime)===null||W===void 0)&&W.value.amHours.map(Number).includes(Number(this.hour.value))))return}else if(!((c=(u=(l=this._disabledTime)===null||l===void 0?void 0:l.value)===null||u===void 0?void 0:u.minutes)===null||c===void 0)&&c.includes(Qe<=9?`0${Qe}`:`${Qe}`))return;this.minutes.value=Qe>=10?`${Qe}`:`0${Qe}`,this.clockHand.style.transform=`rotateZ(${bt}deg)`,this._degreesMinutes=bt,this._toggleClassActiveToValueTips(this.minutes.value),this._removeBgColorToCirleWithMinutesTips(),this._setBgColorToCircleWithMinutesTips(),lp(this._element,"update",Object.assign(Object.assign({},Sd(this.input,this._options.clockType)),{degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes,eventType:he,type:(q=this.activeTypeMode)===null||q===void 0?void 0:q.dataset.type}))}const St=we?we[0]:void 0,si=we&&St?document.elementFromPoint(St.clientX,St.clientY):null;if(this.hourTips!==null){if((Z=this.hour)===null||Z===void 0||Z.classList.add("active"),!_n(si||be,"timepicker-ui-value-tips-24h")&&!_n(si||be,"timepicker-ui-tips-disabled")&&(_n(si||be,"timepicker-ui-value-tips")||_n(si||be,"timepicker-ui-tips-wrapper"))){let Qe,bt=rt&&fj(Math.trunc(180*rt/Math.PI)+90,ze,30);if(this._degreesHours=bt,bt===void 0)return;bt<0?(Qe=Math.round(360+bt/30)%12,bt=360+bt):(Qe=Math.round(bt/30)%12,(Qe===0||Qe>12)&&(Qe=12));const ci=!((K=this._disabledTime)===null||K===void 0)&&K.value.isInterval?"rangeArrHour":"hours";if(((Q=this._disabledTime)===null||Q===void 0?void 0:Q.value.endType)===((ne=(J=this._disabledTime)===null||J===void 0?void 0:J.value)===null||ne===void 0?void 0:ne.startType)){if(typeof((oe=(re=this._disabledTime)===null||re===void 0?void 0:re.value)===null||oe===void 0?void 0:oe.endType)=="string"){if(((se=(de=this._disabledTime)===null||de===void 0?void 0:de.value)===null||se===void 0?void 0:se.endType)===((ge=this.activeTypeMode)===null||ge===void 0?void 0:ge.textContent)&&((Te=(ye=this._disabledTime)===null||ye===void 0?void 0:ye.value)===null||Te===void 0?void 0:Te.startType)===((De=this.activeTypeMode)===null||De===void 0?void 0:De.textContent)&&(!((Me=(xe=this._disabledTime)===null||xe===void 0?void 0:xe.value[ci])===null||Me===void 0)&&Me.includes(Qe.toString())))return}else if(!((at=(Oe=this._disabledTime)===null||Oe===void 0?void 0:Oe.value[ci])===null||at===void 0)&&at.includes(Qe.toString()))return}else if(((Fe=this._disabledTime)===null||Fe===void 0?void 0:Fe.value.startType)===((mt=this.activeTypeMode)===null||mt===void 0?void 0:mt.textContent)&&(!((Xe=this._disabledTime)===null||Xe===void 0)&&Xe.value.amHours.includes(Qe.toString()))||((gt=this._disabledTime)===null||gt===void 0?void 0:gt.value.endType)===((ht=this.activeTypeMode)===null||ht===void 0?void 0:ht.textContent)&&(!((_e=this._disabledTime)===null||_e===void 0)&&_e.value.pmHours.includes(Qe.toString())))return;this.clockHand.style.transform=`rotateZ(${bt}deg)`,this.hour.value=Qe>9?`${Qe}`:`0${Qe}`,this._removeCircleClockClasses24h(),this._toggleClassActiveToValueTips(Qe)}if((_n(si||be,"timepicker-ui-value-tips-24h")||_n(si||be,"timepicker-ui-tips-wrapper-24h"))&&!_n(si||be,"timepicker-ui-tips-disabled")){let Qe,bt=rt&&fj(Math.trunc(180*rt/Math.PI)+90,ze,30);if(this._degreesHours=bt,bt===void 0)return;bt<0?(Qe=Math.round(360+bt/30)%24,bt=360+bt):(Qe=Math.round(bt/30)+12,Qe===12&&(Qe="00"));const ci=!((Ye=this._disabledTime)===null||Ye===void 0)&&Ye.value.isInterval?"rangeArrHour":"hours";if(!((ct=(Je=this._disabledTime)===null||Je===void 0?void 0:Je.value[ci])===null||ct===void 0)&&ct.includes(Qe.toString()))return;this._setCircleClockClasses24h(),this.clockHand.style.transform=`rotateZ(${bt}deg)`,this.hour.value=`${Qe}`,this._toggleClassActiveToValueTips(Qe)}lp(this._element,"update",Object.assign(Object.assign({},Sd(this.input,this._options.clockType)),{degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes,eventType:he,type:(pt=this.activeTypeMode)===null||pt===void 0?void 0:pt.dataset.type}))}},this._toggleClassActiveToValueTips=s=>{const o=this.allValueTips.find((l=>Number(l.innerText)===Number(s)));this.allValueTips.map((l=>l.classList.remove("active"))),o!==void 0&&o.classList.add("active")},this._handleMoveHand=()=>{this._options.mobile||this._isMobileView||vj.split(" ").forEach((s=>{s==="touchstart"||s==="touchmove"||s==="touchend"?document.addEventListener(s,this._mutliEventsMoveHandler,{passive:!1}):document.addEventListener(s,this._mutliEventsMoveHandler,!1)}))},this._setModalTemplate=()=>{if(!this._options)return;const{appendModalSelector:s}=this._options;if(s!==""&&s){const o=document?.querySelector(s);o?.insertAdjacentHTML("beforeend",this.modalTemplate)}else document.body.insertAdjacentHTML("afterend",this.modalTemplate)},this._setScrollbarOrNot=()=>{this._options.enableScrollbar?setTimeout((()=>{document.body.style.overflowY="",document.body.style.paddingRight=""}),400):(document.body.style.paddingRight=`${(()=>{const s=document.createElement("div");s.className="timepicker-ui-measure",document.body.appendChild(s);const o=s.getBoundingClientRect().width-s.clientWidth;return document.body.removeChild(s),o})()}px`,document.body.style.overflowY="hidden")},this._setAnimationToOpen=()=>{var s,o;(s=this.modalElement)===null||s===void 0||s.classList.add("opacity"),this._options.animation?setTimeout((()=>{var l;(l=this.modalElement)===null||l===void 0||l.classList.add("show")}),150):(o=this.modalElement)===null||o===void 0||o.classList.add("show")},this._removeAnimationToClose=()=>{var s;this.modalElement&&(this._options.animation?setTimeout((()=>{var o;(o=this.modalElement)===null||o===void 0||o.classList.remove("show")}),150):(s=this.modalElement)===null||s===void 0||s.classList.remove("show"))},this._handlerViewChange=()=>lie((()=>{var s,o,l,u;const{clockType:c}=this._options;if(_n(this.modalElement,"mobile")){const d=gy(this.hour.value,"hour",c),p=gy(this.minutes.value,"minutes",c);if(d===!1||p===!1)return p||this.minutes.classList.add("invalid-value"),void(d||(o=this.hour)===null||o===void 0||o.classList.add("invalid-value"));d===!0&&p===!0&&(p&&this.minutes.classList.remove("invalid-value"),d&&((l=this.hour)===null||l===void 0||l.classList.remove("invalid-value"))),this.close()(),this._isMobileView=!1,this._options.mobile=!1;const h=this.hour.value,f=this.minutes.value,m=(u=this.activeTypeMode)===null||u===void 0?void 0:u.dataset.type;setTimeout((()=>{this.destroy(),this.update({options:{mobile:!1}}),setTimeout((()=>{if(this.open(),this.hour.value=h,this.minutes.value=f,this._options.clockType==="12h"){const g=m==="PM"?"AM":"PM";this[m==="PM"?"PM":"AM"].classList.add("active"),this[g].classList.remove("active")}this._setTransformToCircleWithSwitchesHour(this.hour.value),this._toggleClassActiveToValueTips(this.hour.value),Number(this.hour.value)>12||Number(this.hour.value)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h()}),300)}),300)}else{this.close()(),this._isMobileView=!0,this._options.mobile=!0;const d=this.hour.value,p=this.minutes.value,h=(s=this.activeTypeMode)===null||s===void 0?void 0:s.dataset.type;setTimeout((()=>{this.destroy(),this.update({options:{mobile:!0}}),setTimeout((()=>{if(this.open(),this.hour.value=d,this.minutes.value=p,this._options.clockType==="12h"){const f=h==="PM"?"AM":"PM";this[h==="PM"?"PM":"AM"].classList.add("active"),this[f].classList.remove("active")}}),300)}),300)}}),this._options.delayHandler||300),this._handleIconChangeView=()=>aie(this,void 0,void 0,(function*(){this._options.enableSwitchIcon&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?this.keyboardClockIcon.addEventListener("touchstart",this._handlerViewChange()):this.keyboardClockIcon.addEventListener("click",this._handlerViewChange()))})),this._handlerClickHourMinutes=s=>aie(this,void 0,void 0,(function*(){var o,l;if(!this.modalElement)return;const{clockType:u,editable:c}=this._options,d=s.target,p=gy(this.hour.value,"hour",u),h=gy(this.minutes.value,"minutes",u);c&&(_n(d,"timepicker-ui-hour")||_n(d,"timepicker-ui-minutes")?p!==!1&&h!==!1||(h||this.minutes.classList.add("invalid-value"),p||(l=this.hour)===null||l===void 0||l.classList.add("invalid-value")):p===!0&&h===!0&&(h&&this.minutes.classList.remove("invalid-value"),p&&((o=this.hour)===null||o===void 0||o.classList.remove("invalid-value"))))})),this._handleClickOnHourMobile=()=>{document.addEventListener("mousedown",this._eventsClickMobileHandler),document.addEventListener("touchstart",this._eventsClickMobileHandler)},this._handleKeyPress=s=>{s.key==="Escape"&&this.modalElement&&this.close()()},this._handleEscClick=()=>{document.addEventListener("keydown",this._handleKeyPress)},this._focusTrapHandler=()=>{setTimeout((()=>{var s,o;const l=(s=this.wrapper)===null||s===void 0?void 0:s.querySelectorAll('div[tabindex="0"]:not([disabled])'),u=(o=this.wrapper)===null||o===void 0?void 0:o.querySelectorAll('input[tabindex="0"]:not([disabled])');if(!l||l.length<=0||u.length<=0)return;const c=[...u,...l],d=c[0],p=c[c.length-1];this.wrapper.focus(),this.wrapper.addEventListener("keydown",(({key:h,shiftKey:f,target:m})=>{const g=m;if(h==="Tab"&&(f?document.activeElement===d&&p.focus():document.activeElement===p&&d.focus()),h==="Enter"&&(_n(g,"timepicker-ui-minutes")&&this.minutes.click(),_n(g,"timepicker-ui-hour")&&this.hour.click(),_n(g,"timepicker-ui-cancel-btn")&&this.cancelButton.click(),_n(g,"timepicker-ui-ok-btn")&&this.okButton.click(),_n(g,"timepicker-ui-keyboard-icon-wrapper")&&this.keyboardClockIcon.click(),_n(g,"timepicker-ui-am")&&this.AM.click(),_n(g,"timepicker-ui-pm")&&this.PM.click(),_n(g,"timepicker-ui-value-tips")||_n(g,"timepicker-ui-value-tips-24h"))){const{left:v,top:y,x:b,y:I,width:S,height:w}=g.getBoundingClientRect(),T=document.elementFromPoint(b,I);(()=>{var C;const E=new MouseEvent("mousedown",{clientX:v+S/2,clientY:y+w/2,cancelable:!0,bubbles:!0});_n(T,"timepicker-ui-value-tips-24h")?T?.dispatchEvent(E):(C=T?.childNodes[0])===null||C===void 0||C.dispatchEvent(E),this._isTouchMouseMove=!1})()}setTimeout((()=>{this.wrapper.addEventListener("mousedown",(()=>document.activeElement.blur()))}),100)}))}),301)},this._handleOpenOnEnterFocus=()=>{this.input.addEventListener("keydown",(({target:s,key:o})=>{s.disabled||o==="Enter"&&this.open()}))},this._element=e,this._cloned=null,this._options=((s,o)=>Object.assign(Object.assign({},o),s))(Object.assign(Object.assign({},i),(s=>{if(!s)return;const o=JSON.parse(JSON.stringify(s)),l=Object.keys(o);return Object.values(o).reduce(((u,c,d)=>(Number(c)?u[l[d]]=Number(c):u[l[d]]=c==="true"||c==="false"?JSON.parse(c):c,u)),{})})((n=this._element)===null||n===void 0?void 0:n.dataset)),Lct),this._isTouchMouseMove=!1,this._degreesHours=30*Number(Sd((r=this._element)===null||r===void 0?void 0:r.querySelector("input"),this._options.clockType).hour),this._degreesMinutes=6*Number(Sd((a=this._element)===null||a===void 0?void 0:a.querySelector("input"),this._options.clockType).minutes),this._isMobileView=!1,this._mutliEventsMove=s=>this._handleEventToMoveHand(s),this._mutliEventsMoveHandler=this._mutliEventsMove.bind(this),this._eventsClickMobile=s=>this._handlerClickHourMinutes(s),this._eventsClickMobileHandler=this._eventsClickMobile.bind(this),this._checkMobileOption(),this._clickTouchEvents=["click","mousedown","touchstart"],this._inputEvents=["change",...this._clickTouchEvents],this._disabledTime=null,this._preventClockTypeByCurrentTime(),this._isModalRemove=!0}get modalTemplate(){return this._options.mobile&&this._isMobileView?(e=>{const{mobileTimeLabel:i,amLabel:n,pmLabel:r,cancelLabel:a,okLabel:s,iconTemplateMobile:o,minuteMobileLabel:l,hourMobileLabel:u,enableSwitchIcon:c,animation:d,clockType:p}=e;return`
  <div class="timepicker-ui-modal normalize mobile" role="dialog" style='transition:${d?"opacity 0.15s linear":"none"}'>
    <div class="timepicker-ui-wrapper mobile" tabindex="0">
      <div class="timepicker-ui-header mobile">
        <div class="timepicker-ui-select-time mobile">${i}</div>
        <div class="timepicker-ui-wrapper-time mobile">
          <input class="timepicker-ui-hour mobile" tabindex="0" type="number" min="0" max="${p==="12h"?"12":"23"}" />
          <div class="timepicker-ui-hour-text mobile">${u}</div>
          <div class="timepicker-ui-dots mobile">:</div>  
          <div class="timepicker-ui-minute-text mobile">${l}</div>
          <input class="timepicker-ui-minutes mobile" tabindex="0" type="number" min="0" max="59" /> 
        </div>
  ${p!=="24h"?`<div class="timepicker-ui-wrapper-type-time mobile">
          <div class="timepicker-ui-type-mode timepicker-ui-am mobile" data-type="AM" tabindex="0">${n}</div>    
          <div class="timepicker-ui-type-mode timepicker-ui-pm mobile" data-type="PM" tabindex="0">${r}</div>    
        </div>`:""}
      </div>
      <div class="timepicker-ui-footer mobile" data-view="mobile">
      ${c?`
      <div class="timepicker-ui-keyboard-icon-wrapper mobile" role="button" aria-pressed="false" data-view="desktop" tabindex="0">
      ${o}
      </div>`:""}
      <div class="timepicker-ui-wrapper-btn mobile">
        <div class="timepicker-ui-cancel-btn mobile" role="button" aria-pressed="false" tabindex="0">${a}</div>
        <div class="timepicker-ui-ok-btn mobile" role="button" aria-pressed="false" tabindex="0">${s}</div>
      </div>
      </div>
    </div>  
  </div>`})(this._options):(e=>{const{iconTemplate:i,timeLabel:n,amLabel:r,pmLabel:a,cancelLabel:s,okLabel:o,enableSwitchIcon:l,animation:u,clockType:c,editable:d}=e;return`
  <div class="timepicker-ui-modal normalize" role="dialog" style='transition:${u?"opacity 0.15s linear":"none"}'>
    <div class="timepicker-ui-wrapper" tabindex="0">
      <div class="timepicker-ui-header">
        <div class="timepicker-ui-select-time">${n}</div>
        <div class="timepicker-ui-wrapper-time ${c==="24h"?"timepicker-ui-wrapper-time-24h":""}">
          <input ${d?"":"readonly"} class="timepicker-ui-hour" tabindex="0" type="number" min="0" max="${c==="12h"?"12":"23"}" />
          <div class="timepicker-ui-dots">:</div>    
          <input ${d?"":"readonly"} class="timepicker-ui-minutes" tabindex="0" type="number" min="0" max="59" /> 
        </div>
      ${c!=="24h"?`
      <div class="timepicker-ui-wrapper-type-time">
        <div class="timepicker-ui-type-mode timepicker-ui-am" tabindex="0" role="button" data-type="AM">${r}</div>    
        <div class="timepicker-ui-type-mode timepicker-ui-pm" tabindex="0" role="button" data-type="PM">${a}</div>    
      </div>
      `:""}
      </div>
      <div class="timepicker-ui-wrapper-landspace">
        <div class="timepicker-ui-body">
          <div class="timepicker-ui-clock-face">
            <div class="timepicker-ui-dot"></div>
            <div class="timepicker-ui-clock-hand">
              <div class="timepicker-ui-circle-hand"></div>
            </div>
            <div class="timepicker-ui-tips-wrapper"></div>
            ${c==="24h"?'<div class="timepicker-ui-tips-wrapper-24h"></div>':""}
          </div>
        </div>
        <div class="timepicker-ui-footer">
        ${l?`
      <div class="timepicker-ui-keyboard-icon-wrapper" tabindex="0" role="button" aria-pressed="false" data-view="desktop">
        ${i}
      </div>`:""}
        <div class="timepicker-ui-wrapper-btn" >
          <div class="timepicker-ui-cancel-btn" tabindex="0" role="button" aria-pressed="false">${s}</div>
          <div class="timepicker-ui-ok-btn" tabindex="0" role="button" aria-pressed="false">${o}</div>
        </div>
        </div>
      </div>
    </div>  
  </div>`})(this._options)}get modalElement(){return document.querySelector(".timepicker-ui-modal")}get clockFace(){return document.querySelector(".timepicker-ui-clock-face")}get input(){var e;return(e=this._element)===null||e===void 0?void 0:e.querySelector("input")}get clockHand(){return document.querySelector(".timepicker-ui-clock-hand")}get circle(){return document.querySelector(".timepicker-ui-circle-hand")}get tipsWrapper(){return document.querySelector(".timepicker-ui-tips-wrapper")}get tipsWrapperFor24h(){return document.querySelector(".timepicker-ui-tips-wrapper-24h")}get minutes(){return document.querySelector(".timepicker-ui-minutes")}get hour(){return document.querySelector(".timepicker-ui-hour")}get AM(){return document.querySelector(".timepicker-ui-am")}get PM(){return document.querySelector(".timepicker-ui-pm")}get minutesTips(){return document.querySelector(".timepicker-ui-minutes-time")}get hourTips(){return document.querySelector(".timepicker-ui-hour-time-12")}get allValueTips(){return[...document.querySelectorAll(".timepicker-ui-value-tips"),...document.querySelectorAll(".timepicker-ui-value-tips-24h")]}get openElementData(){var e;const i=(e=this._element)===null||e===void 0?void 0:e.querySelectorAll("[data-open]");if(i?.length>0){const n=[];return i.forEach((({dataset:r})=>{var a;return n.push((a=r.open)!==null&&a!==void 0?a:"")})),[...new Set(n)]}return null}get openElement(){var e,i;return this.openElementData===null?((e=this.input)===null||e===void 0||e.setAttribute("data-open","timepicker-ui-input"),[this.input]):(i=this.openElementData.map((n=>{var r;return(r=this._element)===null||r===void 0?void 0:r.querySelectorAll(`[data-open='${n}']`)}))[0])!==null&&i!==void 0?i:""}get cancelButton(){return document.querySelector(".timepicker-ui-cancel-btn")}get okButton(){return document.querySelector(".timepicker-ui-ok-btn")}get activeTypeMode(){return document.querySelector(".timepicker-ui-type-mode.active")}get keyboardClockIcon(){return document.querySelector(".timepicker-ui-keyboard-icon-wrapper")}get footer(){return document.querySelector(".timepicker-ui-footer")}get wrapper(){return document.querySelector(".timepicker-ui-wrapper")}_checkDisabledValuesOnStart(){if(!this._options.disabledTime||this._options.disabledTime.interval)return;const{disabledTime:{hours:e,minutes:i},clockType:n}=this._options,r=!e||CA(e,"hour",n),a=!i||CA(i,"minutes",n);if(!r||!a)throw new Error("You set wrong hours or minutes in disabled option")}_checkMobileOption(){this._isMobileView=!!this._options.mobile,this._options.mobile&&(this._options.editable=!0)}_getDisableTime(){this._disabledTime=(e=>{if(!e)return;const{disabledTime:i,clockType:n}=e;if(!i||Object.keys(i).length<=0||i.constructor.name!=="Object")return;const{hours:r,interval:a,minutes:s}=i;if(a){delete i.hours,delete i.minutes;const[o,l]=a.toString().split("-"),{hour:u,minutes:c,type:d}=Sd({value:o.trimEnd()},n),{hour:p,minutes:h,type:f}=Sd({value:l.trimEnd().trimStart()},n);let m=EA(u,p).map((b=>b==="00"||Number(b)===0?`0${Number(b)}`:`${Number(b)}`));const g=[],v=Number(c),y=Number(h);if(f===d)return v>0&&y<=0?(g.push(m[0],m[m.length-1]),m=m.slice(1,-1)):y<59&&y>0&&v<=0?(g.push(void 0,m[m.length-1]),m=m.slice(0,-1)):y>0&&v>0?(g.push(m[0],m[m.length-1]),m=m.slice(1,-1)):y===0&&v===0&&(g.push(void 0,m[m.length-1]),m.pop()),{value:{removedStartedHour:Number(g[0])<=9?`0${g[0]}`:g[0],removedEndHour:Number(g[1])<=9?`0${g[1]}`:g[1],rangeArrHour:m,isInterval:!0,startMinutes:EA(c,59).map((b=>Number(b)<=9?`0${b}`:`${b}`)),endMinutes:mj(0,h).map((b=>Number(b)<=9?`0${b}`:`${b}`)),endType:f,startType:d}};{const b=EA(u,12).map(String),I=mj(1,p).map(String),S=[],w=[];return v>0&&y<=0?(S.push(I[I.length-1]),w.push(b[0]),I.splice(-1,1),b.splice(0,1)):y<59&&y>0&&v<=0?(w.push(b[0]),S.push(I[I.length-1]),I.splice(-1,1)):y>0&&v>0?(S.push(I[I.length-1]),w.push(b[0]),I.splice(-1,1),b.splice(0,1)):y===0&&v===0&&(S.push(I[I.length-1]),w.push(b[0]),I.pop()),{value:{isInterval:!0,endType:f,startType:d,pmHours:I,amHours:b,startMinutes:Number(c)===0?[]:EA(c,59).map((T=>Number(T)<=9?`0${T}`:`${T}`)),endMinutes:mj(0,h).map((T=>Number(T)<=9?`0${T}`:`${T}`)),removedAmHour:Number(w[0])<=9?`0${w[0]}`:w[0],removedPmHour:Number(S[0])<=9?`0${S[0]}`:S[0]}}}}return r?.forEach((o=>{if(n==="12h"&&Number(o)>12)throw new Error("The disabled hours value has to be less than 13");if(n==="24h"&&Number(o)>23)throw new Error("The disabled hours value has to be less than 24")})),s?.forEach((o=>{if(Number(o)>59)throw new Error("The disabled minutes value has to be less than 60")})),{value:{hours:r?.map((o=>o==="00"||Number(o)===0?`0${Number(o)}`:`${Number(o)}`)),minutes:s?.map((o=>Number(o)<=9?`0${o}`:`${o}`))}}})(this._options)}_removeCircleClockClasses24h(){var e,i;(e=this.circle)===null||e===void 0||e.classList.remove("timepicker-ui-circle-hand-24h"),(i=this.clockHand)===null||i===void 0||i.classList.remove("timepicker-ui-clock-hand-24h")}_setCircleClockClasses24h(){var e,i;this.circle&&((e=this.circle)===null||e===void 0||e.classList.add("timepicker-ui-circle-hand-24h")),this.clockHand&&((i=this.clockHand)===null||i===void 0||i.classList.add("timepicker-ui-clock-hand-24h"))}_setErrorHandler(){var e,i,n,r;const{error:a,currentHour:s,currentMin:o,currentType:l,currentLength:u}=Sd(this.input,this._options.clockType);if(a){const c=document.createElement("div");throw(e=this.input)===null||e===void 0||e.classList.add("timepicker-ui-invalid-format"),c.classList.add("timepicker-ui-invalid-text"),c.innerHTML="<b>Invalid Time Format</b>",!((i=this.input)===null||i===void 0)&&i.parentElement&&((n=this.input)===null||n===void 0?void 0:n.parentElement.querySelector(".timepicker-ui-invalid-text"))===null&&((r=this.input)===null||r===void 0||r.after(c)),lp(this._element,"geterror",{error:a,currentHour:s,currentMin:o,currentType:l,currentLength:u}),new Error(`Invalid Time Format: ${a}`)}}_removeErrorHandler(){var e,i;(e=this.input)===null||e===void 0||e.classList.remove("timepicker-ui-invalid-format");const n=(i=this._element)===null||i===void 0?void 0:i.querySelector(".timepicker-ui-invalid-text");n&&n.remove()}_setOnStartCSSClassesIfClockType24h(){if(this._options.clockType==="24h"){let{hour:e}=Sd(this.input,this._options.clockType,this._options.currentTime);this.input.value.length>0&&(e=this.input.value.split(":")[0]),(Number(e)>12||Number(e)===0)&&this._setCircleClockClasses24h()}}_getDestructuringObj(e){var i;const{endMinutes:n,removedEndHour:r,removedStartedHour:a,startMinutes:s,pmHours:o,amHours:l,removedAmHour:u,removedPmHour:c}=this._disabledTime.value;return e?{minutesToUpdate:{actualHour:this.hour.value,pmHours:o,amHours:l,activeMode:(i=this.activeTypeMode)===null||i===void 0?void 0:i.textContent,startMinutes:s,endMinutes:n,removedAmHour:u,removedPmHour:c}}:{minutesToUpdate:{endMinutes:n,removedEndHour:r,removedStartedHour:a,actualHour:this.hour.value,startMinutes:s}}}};function ZCe({time:t,options:e,callback:i}={}){const n=document.getElementById("timepicker"),r=document.getElementById("timevalue");r.value=$ct(t);const a=new Fct(document.getElementById("timepicker"),{switchToMinutesAfterSelectHour:!0,clockType:"12h",...e});a.create(),a.open(),n.addEventListener("accept",()=>{const s=r.value;Mt(i)&&i&&i({time:s}),a.destroy()})}function $ct(t,e){const i=Bct(t||e?.schedule?.default_time);return i.ampm?t||"":(Number(i.hours)>12?(i.hours=(Number(i.hours)-12).toString(),i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),`${i.hours||"12"}:${i.minutes} ${i.ampm}`)}function Bct(t){t=t||"00:00";const e=t?.split(" ")||[],i=e[0]?.split(":")||[];return{hours:i[0]||"00",minutes:i[1]||"00",ampm:e[1]}}const{AFTER_REST:uie,FOLLOWED_BY:cie,NEXT_AVAILABLE:die,NOT_BEFORE:pie,TO_BE_ANNOUNCED:hie}=PL;function XCe({e:t,cell:e,callback:i,matchUpId:n,rowData:r}={}){const a=r||e.getRow().getData(),s=v=>{const y=Object.values(a).filter(w=>w?.matchUpId),I=[{params:{matchUpIds:n?[n]:y.map(({matchUpId:w})=>w),schedule:v,removePriorValues:!0},method:yK}];Wt({methods:I,callback:w=>{w.success&&Mt(i)&&i&&i(v)}})},o=v=>ON({matchUp:v,matchUpId:n,callback:i}),l=()=>s({scheduledTime:"",timeModifiers:[]}),u=({time:v})=>{const b=Mi.dateTime.convertTime(v,!0)||"";s({scheduledTime:b})},c=()=>{const y=e.getTable().getData();let b;const I=y.flatMap((U,C)=>{if(!b&&!(U.rowId===a.rowId&&(b=C+1,C)))return Object.values(U).flatMap(E=>E?.schedule?.scheduledTime)}).filter(Boolean).map(cot),S=Math.max(...I,0),w=(b??0)>1,T=S&&dot(S,w)||"8:00 AM";ZCe({time:T,callback:u})},d=v=>s({timeModifiers:[v]}),p=n?"Set match time":"Set match times",h=Object.values(e.getData()).find(v=>v?.matchUpId===n),f=h?.readyToScore||h?.winningSide||h?.score?.sets,m=[{option:p,onClick:c},f&&{option:"Enter score",onClick:()=>o(h)},{option:SE[cie],onClick:()=>d(cie)},{option:SE[die],onClick:()=>d(die)},{option:SE[pie],onClick:()=>d(pie)},{option:SE[uie],onClick:()=>d(uie)},{option:SE[hie],onClick:()=>d(hie)},{option:"Clear time settings",onClick:l}].filter(Boolean),g=t.target;Pu({options:m,target:g,config:{placement:ti}})}function Vct({column:t,courtInfo:e}){const i=e.courtId;Yn({title:"Rename Court",content:a=>mr(a,[{value:e.courtName,label:"Court Name",field:"courtName"}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Rename",intent:"is-primary",onClick:({content:a})=>{const s=a?.courtName.value;s.length&&s!==e.courtName&&Wt({methods:[{method:HEe,params:{courtId:i,modifications:{courtName:s}}}],callback:u=>{u.success?t.updateDefinition({title:s}):console.log({result:u})}})},close:!0}]})}function jct(t,e,i){const r=[{option:`${_s.tr("remove")} court identifiers`,onClick:s},{option:_s.tr("rename"),onClick:()=>Vct({column:e,courtInfo:i})}],a=t.target;Pu({options:r,target:a});function s(){console.log("toggle court identifiers",{column:e})}}async function Gct(t,e){t.preventDefault();const i=t.dataTransfer?.getData("itemid"),n=[],r=e.getTable(),a=r.getData(),s=e.getRow().getData(),o=r.getData().flatMap(P=>Object.values(P).filter(M=>M.matchUpId));let l=o.find(P=>P.matchUpId===i);l||(l=Bs.findTable(`#${VI}`)[0].getData().map(R=>R.matchUp).find(R=>R.matchUpId===i)||{});const u=It.displayed.selectedScheduleDate,{courtOrder:c,courtId:d,venueId:p}=l.schedule||{},h=t.currentTarget,f=h.id;if(i===f)return;const m=l.schedule,g=f&&o.find(P=>P.matchUpId===f),v=h.getAttribute("venueId"),y=h.getAttribute("courtId"),b=h.getAttribute("courtOrder"),I=Object.keys(s).find(P=>{if(!kp(s[P]))return;const M=s[P]?.schedule||{},{courtOrder:R,courtId:N,venueId:A}=M;return R?.toString()===b?.toString()&&A===v&&N===y});let S;const w=a.find(P=>(S=Object.keys(P).find(M=>{if(!kp(P[M]))return;const R=P[M]?.schedule||{},{courtOrder:N,courtId:A,venueId:_}=R;return N===c&&_===p&&A===d}),S)),T=()=>{Wt({methods:n,engine:d6,callback:M=>{M.success||console.log({result:M}),Yx(r)}})},U=({scheduledTime:P="",timeModifiers:M=[]}={})=>{const R={courtOrder:b,scheduledDate:u,venueId:v,courtId:y,scheduledTime:P,timeModifiers:M};n.push({method:pz,params:{tournamentId:l?.tournamentId,matchUpId:l?.matchUpId,schedule:R,drawId:l?.drawId,removePriorValues:!0}}),l.schedule=R},C={scheduledDate:m?.scheduledDate,scheduledTime:m?.scheduledTime,timeModifiers:m?.timeModifiers,courtOrder:c,venueId:p,courtId:d},E=()=>{n.push({method:pz,params:{tournamentId:g?.tournamentId,matchUpId:g?.matchUpId,schedule:C,drawId:g?.drawId,removePriorValues:!0}}),g?g.schedule=C:console.log("missing targetMatchUp")};if(f==="")w?(U(),w[S]={schedule:{courtOrder:c,venueId:p,courtId:d}},w.rowId==s.rowId?(w[I]=l,r.updateData([w])):(s[I]=l,r.updateData([w,s]))):(Bs.findTable(`#${VI}`)[0].deleteRow(i),U(),s[I]=l,r.updateData([s]));else if(!w&&g){const P=Bs.findTable(`#${VI}`)[0];P.deleteRow(i),U(),s[I]=l,r.updateData([s]),P.addRow(oE(g),!0),E()}else{const P=g?.schedule;U({scheduledTime:P?.scheduledTime,timeModifiers:P?.timeModifiers}),E(),w.rowId==s.rowId?(w[S]=g,w[I]=l,r.updateData([w])):(w[S]=g,s[I]=l,r.updateData([w,s]))}T()}const{SCHEDULE_STATE:Hct,SCHEDULE_ERROR:zct,SCHEDULE_WARNING:qct,SCHEDULE_CONFLICT:Wct}=Uo.scheduleConstants;function JCe(t){const e=document.createElement("span");if(!t.getColumn().getDefinition().field)return e.className="schedule-cell",e;const n=t.getValue(),{potentialParticipants:r,eventName:a="",roundName:s="",schedule:o={},matchUpStatus:l,winningSide:u,matchUpId:c,sides:d}=n||{},{courtOrder:p="",scheduledTime:h="",courtId:f="",timeModifiers:m,venueId:g=""}=o;if(e.setAttribute("courtOrder",p),e.setAttribute("courtId",f),e.setAttribute("venueId",g),e.className="schedule-cell dragdrop",e.ondragover=R=>R.preventDefault(),c)if(e.draggable=!0,e.id=c,u)e.classList.add("matchup-complete");else{const R=o[Hct];l==="IN_PROGRESS"?e.classList.add("matchup-inprogress"):R===Wct?e.classList.add("matchup-conflict"):R===rge?e.classList.add("matchup-issue"):R===qct?e.classList.add("matchup-warning"):R===zct&&e.classList.add("matchup-error")}if(e.addEventListener("drop",R=>Gct(R,t)),e.addEventListener("dragstart",hCe),!c)return e;const v=`${a} ${s}`,y=R=>R.person?.standardFamilyName?.toUpperCase()||R.participantName,b=r?.map(R=>R?.map(N=>`<span class='potential nowrap'>${y(N)}</span>`).join('<span style="font-weight: bold">&nbsp;or&nbsp;</span>')),I=R=>{const N=d?.find(A=>R===A.sideNumber)?.participant?.participantName;if(N)return u===R?`<span style='font-weight: bold'>${N}</span>`:N},S=I(1)||b?.shift()||"Unkown",w=I(2)||b?.shift()||"Unknown";e.id=c;const T=document.createElement("div");T.className="header flexrow",T.innerHTML=(m?.[0]&&Lje[m[0]]+"&nbsp;"||"")+qK(h),e.appendChild(T);const U=document.createElement("div");U.className="catround",U.innerHTML=v,e.appendChild(U);const C=document.createElement("div");C.className="scheduled_teams";const E=document.createElement("div");E.className="scheduled_team",E.style.fontSize="1em",E.innerHTML=S,C.appendChild(E);const P=document.createElement("div");P.className="divider",P.innerHTML="vs.",C.appendChild(P);const M=document.createElement("div");if(M.className="scheduled_team",M.style.fontSize="1em",M.innerHTML=w,C.appendChild(M),u){const R=document.createElement("div");R.innerHTML=n.score?.scoreStringSide1||"",C.appendChild(R)}return e.appendChild(C),e}function Yct({values:t,valueChange:e,isValid:i}){const n=(s,o)=>l=>l.length>=s&&(!o||l.length<=o),r=s=>!isNaN(Number(s)),a=s=>e(s);return[{error:"Please enter a name of at least 5 characters",placeholder:"Venue name",value:t.venueName||"",validator:n(5),label:"Venue name",field:"venueName",focus:!0,onChange:a},{error:"Please enter an abbreviation of 2-6 characters",value:t.venueAbbreviation||"",validator:n(2,6),field:"venueAbbreviation",label:"Abbreviation",onChange:a},{error:"Must be a whole number",value:t.courtsCount||"",validator:r,label:"Number of courts",field:"courtsCount",onChange:a}]}function Kct(t){return{venueAbbreviation:t?.venueAbbreviation.value,courtsCount:t?.courtsCount.value,venueName:t?.venueName.value}}const Zct=t=>{const e=Kct(It.drawer.attributes.content),{venueName:i,venueAbbreviation:n,courtsCount:r}=e,a=Mi.UUID();if(!i||!n||!r){Ht({message:"Invalid values",intent:"is-danger"});return}const s=[{params:{venue:{venueName:i,venueAbbreviation:n,venueId:a},returnDetails:!0},method:OJe},{params:{courtsCount:parseInt(r),venueId:a,venueAbbreviationRoot:!0},method:UJe}];Wt({methods:s,callback:l=>{if(l?.success&&Mt(t)&&t){const{venue:u}=nt.findVenue({venueId:a});u&&t({...l,venue:u})}}})};function QCe(t){const e=()=>{},i=o=>o&&!isNaN(Number(o)),n=({inputs:o})=>{const l=!!(Vr(2,6)(o.venueAbbreviation.value)&&i(o.courtsCount.value)&&Vr(5)(o.venueName.value)),u=document.getElementById("addVenueButton");u&&(u.disabled=!l)},r=[{control:"venueAbbreviation",onInput:n},{control:"courtsCount",onInput:n},{control:"venueName",onInput:n}],a=o=>mr(o,Yct({values:{},valueChange:e}),r),s=(o,l)=>eS(o,[{label:"Cancel",close:!0},{onClick:()=>Zct(t),id:"addVenueButton",intent:"is-info",disabled:!0,label:"Add",close:!0}],l);It.drawer.open({title:"<b style='larger'>Add venue</b>",width:"300px",side:ti,content:a,footer:s})}function Xct({courtsData:t,count:e}){const i=r=>{r.stopPropagation(),r.preventDefault(),QCe(e1e)},n=r=>r?"":t?.length?"<p style='font-weight: normal; color: lightblue'>Add venue</p>":"<button class='button is-danger'>Add venue</button>";return e>0?Mi.generateRange(0,e).map(r=>({headerClick:a=>r===0&&i(a),title:n(r),headerHozAlign:di,formatter:JCe,headerSort:!1,resizable:!1,minWidth:150})):[]}function Jct({notice:t,notes:e,callback:i}){let n;Yn({title:"Order of play",buttons:[{label:"Cancel",intent:"is-nothing"},{label:"Save",intent:"is-info",onClick:()=>{const o=n.notice.value,l=n.notes.value;typeof i=="function"&&i({notice:o,notes:l})},close:!0}],content:o=>{n=mr(o,[{placeholder:"appears on PDF Header",value:t,label:"Schedule notice",field:"notice"},{placeholder:"appears on PDF Footer",value:e,label:"Umpire notes",field:"notes"}])}})}const{NOT_BEFORE:fie}=PL;function Qct(t,e){const i=e.getRow().getData(),n=Object.values(i).filter(r=>r?.matchUpId);i.issues?.length&&console.log({issues:i.issues}),n.length&&XCe({e:t,cell:e,rowData:i,callback:a=>{if(kp(a)){const s=e.getTable(),o=s.getData().find(l=>l.rowId===i.rowId);Object.values(o).forEach(l=>{l?.matchUpId&&l?.schedule&&(a.scheduledTime&&(l.schedule.scheduledTime=qK(a.scheduledTime),l.schedule.timeModifiers?.[0]!==fie&&(l.schedule.timeModifiers=[])),a.timeModifiers&&(l.schedule?.scheduledTime&&a.timeModifiers[0]!==fie&&(l.schedule.scheduledTime=""),l.schedule&&(l.schedule.timeModifiers=a.timeModifiers)))}),s.updateData([o])}}})}function edt(){function t(n){const r=n.getElement();return r.classList.add("tag"),r.classList.add("is-info"),r.classList.add("is-light"),'<i class="fa-regular fa-note-sticky"></i>'}function e(n){n.getElement().style.backgroundColor="white";const r=document.createElement("span"),a=n.getRow().getData();return r.innerHTML=a.rowNumber,r}return{titleFormatter:t,formatter:e,headerClick:()=>{Jct({notes:"",notice:"",callback:n});function n(r){console.log({result:r})}},cellClick:Qct,headerSort:!1,resizable:!1,hozAlign:di,frozen:!0,width:55}}function tdt({courtsData:t,courtPrefix:e}){const i=(l,u)=>{const c=u.getColumn().getDefinition().field,{drawId:d,matchUpId:p}=u.getData()[c];XCe({e:l,cell:u,matchUpId:p,callback:()=>{const f=nt.allTournamentMatchUps({matchUpFilters:{drawIds:[d],matchUpIds:[p]},nextMatchUps:!0})?.matchUps?.[0],m=u.getRow().getData();m[c]=f,u.getTable().updateData([m])}})},n=_je-t?.length||0,r=n<=0?1:n,a=Xct({courtsData:t,count:r}),s=edt(),o=(l,u)=>({headerClick:(c,d)=>jct(c,d,l),cellClick:i,field:`${e}${u}`,title:l.courtName,headerHozAlign:di,formatter:JCe,headerSort:!1,resizable:!1,hozAlign:di,minWidth:150});return[s].concat(t?.map(o),a)}function idt({scheduledDate:t}={}){let e,i,n,r=[];const a=({scheduledDate:d})=>{const p={localPerspective:!0,scheduledDate:d},h=wm.competitionScheduleMatchUps({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,nextMatchUps:!0,matchUpFilters:p}),{dateMatchUps:f=[],completedMatchUps:m=[],courtsData:g,courtPrefix:v="C|",rows:y,groupInfo:b}=h,I=f.concat(...m),S=tdt({courtsData:g,courtPrefix:v});return y?.forEach((w,T)=>{w.rowId=`rowId-${T+1}`,w.rowNumber=T+1}),{rows:y,columns:S,matchUps:I,courtsCount:g?.length??0,courtsData:g,groupInfo:b}},s=({scheduledDate:d}={})=>{setTimeout(()=>{const{rows:h,matchUps:f,columns:m,courtsData:g}=a({scheduledDate:d}),v=g?.map(b=>b.courtId);Mi.intersection(r,v).length===v?.length||(i.setColumns(m),r=v),n=!0,i?.replaceData(h),i.matchUps=f},e?0:1e3)};ng({anchorId:Vk});const o=document.getElementById(Vk),{rows:l=[],columns:u=[],courtsCount:c}=a({scheduledDate:t});return r=u.map(d=>d?.courtId).filter(Boolean),i=new Bs(o,{height:window.innerHeight*.84,renderHorizontal:"virtual",placeholder:"No courts",index:"rowId",data:l,columns:u}),i.on("scrollVertical",Nd),i.on("tableBuilt",()=>{Yx(i),e=!0}),i.on("dataProcessed",()=>{n&&(n=!1,Yx(i))}),{table:i,replaceTableData:s,courtsCount:c}}function ndt({updateUnscheduledTable:t,updateScheduleTable:e,scheduledDate:i,table:n}){const a=[{params:{matchUps:n.getData("active").map(o=>o.matchUp),scheduledDate:i},method:qJe}];Wt({methods:a,callback:o=>{o.success&&(t(),e({scheduledDate:i}))},engine:d6})}function rdt({scheduledDate:t,target:e,roundNameFilter:i,eventIdFilter:n,callback:r}){const a=wm.competitionScheduleMatchUps({courtCompletedMatchUps:!0}),{dateMatchUps:s=[],completedMatchUps:o=[]}=a,u=s.concat(...o).filter(({schedule:m})=>m.scheduledDate||m.scheduledTime||m.courtId),c=u.filter(({schedule:m})=>m.scheduledDate===t),d=[{disabled:!c.length,option:"Clear scheduled matches",onClick:f},{disabled:!c.length,option:"Clear all matches",onClick:h},{disabled:!u.length,option:"Clear all days",onClick:p}];d.filter(m=>!m.disabled).length&&Pu({target:e,options:d,config:{placement:Gp}});function p(){f({all:!0})}function h(){f({completed:!0})}function f({all:m,completed:g}={}){let v=u.filter(({schedule:w})=>w.scheduledDate===t).filter(({roundName:w})=>!i||i===w).filter(({eventId:w})=>!n||n===w);g||(v=v?.filter(({matchUpStatus:w,winningSide:T})=>w!=="COMPLETED"&&!T));const b=(m?u:v).map(w=>w.matchUpId);Wt({methods:[{method:yK,params:{schedule:{courtId:"",scheduledDate:"",courtOrder:"",scheduledTime:"",venueId:""},removePriorValues:!0,matchUpIds:b}}],callback:w=>{w.success&&r&&Mt(r)&&r()}})}}function adt({updateUnscheduledTable:t,updateScheduleTable:e,toggleUnscheduled:i,flightNameFilter:n,roundNameFilter:r,controlAnchor:a,eventIdFilter:s,scheduledDate:o,matchUps:l=[],table:u}){let c=o;const d=x=>{c=x},p=x=>x.eventId===s,h=x=>{u.removeFilter(p),s=x,x&&u.addFilter(p)},f=nt.getEvents().events||[],g=[{label:Qg,onClick:()=>h(),close:!0}].concat(f.map(x=>({onClick:()=>h(x.eventId),label:x.eventName,close:!0}))),v=x=>x.roundName===r,y=Mi.unique(l.map(x=>x.roundName)),b=x=>{u.removeFilter(v),r=x,x&&u.addFilter(v)},S=[{label:yJ,onClick:()=>b(),close:!0}].concat(y.map(x=>({onClick:()=>b(x),label:x,close:!0}))),w=x=>x.flight===n,T=Mi.unique(l.map(x=>x.drawName)),U=x=>{u.removeFilter(w),n=x,x&&u.addFilter(w)},E=[{label:CC,onClick:()=>U(),close:!0}].concat(T.map(x=>({onClick:()=>U(x),label:x,close:!0}))),P=()=>{t()&&e({scheduledDate:c}),console.log("clear filters ?")},M=x=>{const O=jl(x.target,"dropdown");rdt({target:O||x?.target,scheduledDate:c,callback:P,roundNameFilter:r,eventIdFilter:s})},R=Q0(u),A=[{onClick:()=>ndt({scheduledDate:c,table:u,updateScheduleTable:e,updateUnscheduledTable:t}),label:"Auto schedule",intent:"is-primary",id:"autoSchedule",close:!0},{label:"Clear schedule",onClick:M,intent:"is-warning",id:"clearSchedule",close:!0}],_=[{onKeyDown:x=>x.key==="Backspace"&&x.target.value.length===1&&R(""),onChange:x=>R(x.target.value),onKeyUp:x=>R(x.target.value),clearSearch:()=>R(""),placeholder:"Search participants",location:hi,search:!0},{hide:g.length<2,options:g,id:"eventOptions",label:Qg,modifyLabel:!0,location:hi,selection:!0},{hide:S.length<2,options:S,id:"roundOptions",label:yJ,modifyLabel:!0,location:hi,selection:!0},{hide:E.length<2,options:E,id:"flightOptions",label:CC,modifyLabel:!0,location:hi,selection:!0},{options:A,label:"Actions",selection:!1,location:ti,align:ti},{onClick:i,id:"doneScheduling",intent:"is-info",label:"Done"}];return wo({target:a,items:_}),{updateScheduledDate:d}}function sdt({toggleUnscheduled:t,schedulingActive:e,controlAnchor:i,scheduledDate:n,courtsCount:r}={}){if(!i)return{elements:void 0};let a;const s=h=>GK(h).format("dddd MMM D"),{startDate:o,endDate:l}=wm.getCompetitionDateRange(),c=Mi.generateDateRange(o,l).map(h=>({onClick:()=>{const f=wm.getTournamentInfo().tournamentInfo.tournamentId;It.router.navigate(`/tournament/${f}/schedule/${h}`)},isActive:h===n,label:s(h),value:h,close:!0})),d=()=>{},p=[{clearSearch:()=>d(),placeholder:"Search participants",id:"searchParticipants",visible:!!r,location:hi,search:!0},{options:[{label:"Team ",onClick:()=>console.log("team clicked"),close:!0}],label:"Highlight team",visible:!!r,id:"highlightTeam",location:hi,align:hi},{visible:!!r&&!e,onClick:t,label:"Schedule matches",id:"scheduleMatchUps",intent:"is-primary",location:ti},{label:s(n||o),value:n||o,id:kje,options:c,modifyLabel:!0,intent:"is-info",location:ti,align:ti}];return a=wo({target:i,items:p})?.elements,{elements:a}}function e1e(t){let e;const{startDate:i,endDate:n}=wm.getCompetitionDateRange(),r=new Date,a=Mi.dateTime.formatDate(r),s=r>=new Date(i)&&r<=new Date(n),o=r>new Date(n)?n:i;if(!t.scheduledDate){const b=s?a:o,I=wm.getTournamentInfo().tournamentInfo?.tournamentId;It.router.navigate(`/tournament/${I}/schedule/${b}`)}const l=t.scheduledDate||(s?a:o);It.displayed.selectedScheduleDate=l;const u=document.getElementById(pge),c=document.getElementById(T6),d=document.getElementById(U6);c.style.paddingBottom="1em",d.style.paddingBottom="1em";let p=It.state.schedulingActive;u.style.display=p?"":Rt;const{replaceTableData:h,table:f,unscheduledMatchUps:m}=uot({scheduledDate:l}),g=()=>{p=!p,It.state.schedulingActive=p,u.style.display=p?"":Rt,e?.scheduleMatchUps&&(e.scheduleMatchUps.style.display=p?Rt:"")},{replaceTableData:v,courtsCount:y}=idt({scheduledDate:l});adt({controlAnchor:c,matchUps:m,table:f,updateUnscheduledTable:h,updateScheduleTable:v,toggleUnscheduled:g,scheduledDate:l}),e=sdt({toggleUnscheduled:g,schedulingActive:p,controlAnchor:d,scheduledDate:l,courtsCount:y}).elements}const{SUBSTITUTION:mie,PENALTY:gie,REMOVE_PARTICIPANT:vie,REPLACE_PARTICIPANT:yie}=o4,{POLICY_TYPE_MATCHUP_ACTIONS:odt}=Ub,{ASSIGN_PARTICIPANT:$z}=g0,{TEAM:ldt,DOUBLES:t1e}=dl,udt=Mi.extractAttributes;function I1(t,e,i,n){if(!e)return;const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(v=>v.remove());return}const s=e.getRow().getData(),o=e.getColumn().getDefinition(),l=s.matchUpType===t1e,u=s.eventType===ldt,{matchUpId:c,drawId:d}=s,p=o.field==="side1"&&1||o.field==="side2"&&2,{validActions:h}=nt.matchUpActions({matchUpId:c,drawId:d,sideNumber:p,policyDefinitions:{[odt]:{substituteAfterCompleted:!0,substituteWithoutScore:!0}}}),f=n?.individualParticipant?.participantId,m={[$z]:{params:{data:s,sideNumber:p,callback:i,isTeam:u,isDoubles:l},text:"Assign participant",method:yj},[gie]:{onClick:()=>console.log({data:s}),text:"Assess penalty"},[vie]:{params:{data:s,sideNumber:p,callback:i,isTeam:u,isDoubles:l,clickedParticipantId:f},text:"Remove participant",method:cdt},[yie]:{params:{data:s,sideNumber:p,callback:i,isTeam:u,isDoubles:l,clickedParticipantId:f},text:"Replace participant",method:yj},[mie]:{params:{data:s,sideNumber:p,callback:i,isTeam:u,isDoubles:l,clickedParticipantId:f},method:yj,text:"Substitution"}},g=h.filter(({type:v})=>[$z,gie,vie,yie,mie].includes(v)).map(v=>{const y=m[v.type];return{onClick:()=>{Mt(y.method)?y.method({...y.params,action:v}):Mt(y.onClick)&&y.onClick()},text:y.text}});g.length===1?g[0].onClick():g.length>0&&t?.target&&Pu({items:g,target:t.target,config:{placement:Gp}})}function cdt(t){const{action:e,callback:i,clickedParticipantId:n}=t;e.payload.participantId=n;const r=[{method:e.method,params:e.payload}];Wt({methods:r,callback:s=>Mt(i)&&i&&i(s)})}function yj(t){const{sideNumber:e,callback:i,isTeam:n,isDoubles:r,data:a}=t,s=t.action.availableParticipants,o=a.matchUp.matchUpType,u=a.matchUp.sides.find(m=>e===m.sideNumber)?.participant?.individualParticipantIds,c=t.clickedParticipantId;_N({selectedParticipantIds:u,selectOnEnter:!0,selectionLimit:o===t1e&&!c?2:1,onSelection:m=>{if(m.participantId||m.selected){const g=[];(Array.isArray(m.selected)?m.selected.map(udt("participantId")):[m.participantId]).filter(Boolean).forEach(b=>{g.push({params:{...t.action.payload,substituteParticipantId:b,newParticipantId:b,existingParticipantId:c,participantId:b},method:t.action.method})}),Wt({methods:g,callback:b=>{Mt(i)&&i&&i(b)}})}},action:{type:$z,participantsAvailable:s},title:n&&r?"Doubles: Select participants":void 0})}function i1e(t,e){return t.pctSpread&&!e.pctSpread?-1:e.pctSpread&&!t.pctSpread?1:!t.pctSpread&&!e.pctSpread?0:e.pctSpread-t.pctSpread}function n1e(t){const e=t.getRow().getData(),i=document.createElement("span");if(!e.competitiveProfile?.competitiveness)return i;const{competitiveProfile:n,score:r}=e,a={COMPETITIVE:"green",DECISIVE:"magenta",ROUTINE:"blue"};if(r){const{competitiveness:s}=n;i.style.color=a[s],i.style.fontSize="smaller",i.innerHTML=s}return i}function QK(t){const e=t.getRow().getData();if(!e.readyToScore)return;const i=e.matchUp.matchUpStatus==="WALKOVER",n=document.createElement("span");return n.classList.add("scoreCell"),e.score?(n.style.fontSize="smaller",n.innerHTML=e.score):i?n.innerHTML="WO":(n.style.color="blue",n.style.fontSize="smaller",n.innerHTML="Enter score"),n}function bie(t){const e=document.createElement("div");return e.style.fontWeight="bold",e.innerHTML=t.getValue(),e}function r1e(t){const{matchUpId:e,schedule:i,callback:n}=t;Wt({methods:[{params:{matchUpIds:[e],schedule:i,removePriorValues:!0},method:yK}],callback:s=>{s.success&&n&&Mt(n)&&n()}})}function eZ({pointerEvent:t,cell:e,matchUp:i,callback:n}){const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(p=>p.remove());return}const a=!i?.roundPosition&&!i?.drawPositions,s=e&&t.target?.getElementsByClassName("fa-ellipsis-vertical")[0],o=e?.getRow().getData()||i,l=()=>{Mt(n)&&n&&n(o)},u=i?.schedule?.scheduledTime||i?.schedule?.scheduledDate||i?.schedule?.venueId||i?.schedule?.courtId,d=[{onClick:()=>{const p={scheduledDate:"",scheduledTime:"",courtId:"",venueId:""},h=()=>{if(!e){n&&n({refresh:!0});return}e.getRow().update({...o,...p,courtName:"",venueName:""})};r1e({matchUpId:i.matchUpId,schedule:p,callback:h})},text:"Clear schedule",hide:!u},{onClick:l,text:"Schedule"},{onClick:l,text:"Start time"},{onClick:l,text:"End time"},{onClick:l,text:"Set referee"}];a&&d.push({onClick:()=>ddt({...i,callback:l}),text:"Delete match",color:"red"}),Pu({items:d,target:s||t.target,config:{placement:Gp}})}function ddt({drawId:t,structureId:e,matchUpId:i,callback:n}){Wt({methods:[{method:GEe,params:{matchUpIds:[i],removeIncomplete:!0,removeCompleted:!0,structureId:e,drawId:t}}],callback:s=>{s.success?Mt(n)&&n&&n():console.log({postMutationError:s.error})}})}const Iie=t=>e=>{const i=document.createElement("div");return i.className="has-text-warning-dark",i.innerHTML="Select participant",(e.getValue().participantName&&tS(t)(e,i,void 0))??i},RA=t=>({cell:e,event:i,...n})=>{I1(i,e,a=>{if(a.success){const s=e.getRow(),{drawId:o,matchUpId:l}=t,u=nt.findMatchUp({drawId:o,matchUpId:l}).matchUp,c=s.getData().matchUp.collectionId,p=u.tieMatchUps.filter(f=>f.collectionId===c).map(f=>oE({...f,dualMatchUp:t})),h=e.getTable();h.updateData(p),h.redraw(!0)}},n)};function pdt(t,e){const i=e.getRow(),n=i.getData(),{matchUpId:r,readyToScore:a}=n;a&&ON({matchUpId:r,callback:o=>{if(o.success){const{matchUpStatus:l,sets:u,matchUpFormat:c,score:d,winningSide:p}=o.outcome;Object.assign(n,{matchUpStatus:l,sets:u,matchUpFormat:c,score:d}),n.winningSide=p&&`side${p}`,i.update(n),e.getTable().redraw(!0);const f=o.results.find(({methodName:m})=>m===IK)?.tieMatchUpResult;Ddt(f)}else console.log({result:o})}})}function hdt({matchUp:t}){const e=t.sides?.find(r=>r.sideNumber===1)?.participant?.participantName||"Side 1",i=t.sides?.find(r=>r.sideNumber===2)?.participant?.participantName||"Side 2",n=(r,a)=>r?.participantName?.localeCompare(a?.participantName);return[{formatter:Iie(RA(t)),cellClick:(r,a)=>RA(t)({event:r,cell:a}),sorter:n,title:e,responsive:!1,minWidth:100,field:"side1",widthGrow:2},{formatter:Iie(RA(t)),cellClick:(r,a)=>RA(t)({event:r,cell:a}),sorter:n,title:i,responsive:!1,minWidth:100,field:"side2",widthGrow:2},{formatter:QK,cellClick:pdt,responsive:!1,title:"Score",field:"score",width:140},{field:"matchUpStatus",title:"Status",width:150}]}function fdt({matchUp:t,tableElement:e,collectionMatchUps:i}){const n=i.map(s=>oE({...s,dualMatchUp:t})),r=hdt({matchUp:t});return{table:new Bs(e,{responsiveLayoutCollapseStartOpen:!1,responsiveLayout:"collapse",placeholder:"No matches",reactiveData:!0,layout:"fitColumns",index:"matchUpId",columns:r,data:n})}}function a1e({side1:t,side2:e,side1Score:i,side2Score:n}){const r=document.createElement("div");r.className="overlay-content-overview";const a=document.createElement("div");a.className="overlay-content-body";const s=mdt({side1Score:i,side2Score:n});return a.appendChild(t),a.appendChild(s),a.appendChild(e),r.appendChild(a),r}function nO({participantName:t,justify:e="start"}){const i=document.createElement("div");i.className=`matchup-side justify-${e}`;const n=document.createElement("div");return n.className="side-name",n.innerHTML=t,i.appendChild(n),i}function mdt({side1Score:t,side2Score:e}){const i=document.createElement("div");i.className="score-box";const n=document.createElement("div");n.className="score-flex";const r=document.createElement("div");return r.className="score-vs",r.innerHTML="vs",n.appendChild(t),n.appendChild(r),n.appendChild(e),i.appendChild(n),i}function rO({winningSide:t,sets:e,sideNumber:i,id:n}){const r=`side${i}Score`,a=e?.[0]?.[r]||0,s=document.createElement("span");return n&&(s.id=n),s.className="side-score",i===1?s.style.paddingLeft="1rem":s.style.paddingRight="1rem",i===t&&s.classList.add("has-text-success"),s.innerHTML=String(a),s}let s1e;function o1e({title:t,content:e,footer:i}={}){if(!e||!i)return;const n=document.getElementById(NC);n&&Js(n);const r=document.createElement("div");r.className="overlay noselect",r.id=NC;const a=document.createElement("div");a.className="overlay-center-align",r.appendChild(a);const s=document.createElement("div");if(s.className="overlay-root",a.appendChild(s),t){const c=vdt({title:t});s.appendChild(c)}const o=document.createElement("div");o.className="overlay-content",typeof e=="string"?o.innerHTML=e:e&&o.appendChild(e),s.appendChild(o);const l=document.createElement("div");l.className="overlay-footer",typeof i=="string"?l.innerHTML=i:i&&l.appendChild(i),s.appendChild(l),document.body.appendChild(r),s1e=window.scrollY||document.documentElement.scrollTop;const u=document.getElementById("root");u.style.display=Rt}function gdt({content:t}){const e=document.getElementById(NC)?.getElementsByClassName("overlay-content")?.[0];e&&(Js(e),typeof t=="string"?e.innerHTML=t:t&&e.appendChild(t))}function vdt({title:t}){const e=document.createElement("h2");return e.className="overlay-header",e.innerHTML=`
    <div class="overlay-header-content">
      <h1 class="overlay-title">${t}</h1> 
    </div>
  `,e}function l1e(){const t=document.getElementById("root");t.style.display="inline",window.scrollTo({top:s1e});let e=document.getElementById(NC);Js(e);let i=0;for(;i<5&&e;)e.remove(),i+=1,e=document.getElementById(NC)}const u1e=[{key:"custom",name:"Custom",desc:""},{key:"standard",name:"Standard Advantage",format:"SET3-S:6/TB7",desc:"Best of 3 Sets to 6 with Advantage"},{key:"atpd",name:"Standard Doubles",format:"SET3-S:6/TB7-F:TB10",desc:"Best of 3 Sets to 6, no Ad",desc2:"Final Set Tiebreak to 10"},{key:"standard1",name:"One Standard Set",format:"SET1-S:6/TB7",desc:"1 Set to 6 Games, Tiebreak to 7"},{key:"wimbledon2018",name:"Wimbledon 2018",format:"SET5-S:6/TB7-F:6",desc:"Best of 5 tiebreak sets, final set no tiebreak"},{key:"wimbledon2019",name:"Wimbledon 2019",format:"SET5-S:6/TB7-F:6/TB7@12",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"Aus2019",name:"Australian Open 2019",format:"SET5-S:6/TB7-F:6/TB10",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"short",name:"Short Sets TB7@4",format:"SET3-S:4/TB7",desc:"Best of 3 Sets to 4, tiebreak to 7 at 4-4"},{key:"short1",name:"Fast 4",format:"SET3-S:4/TB5@3",desc:"Best of 3 Sets to 4, tiebreak to 5 at 3-3"},{key:"short2",name:"One Short Set TB7",format:"SET1-S:4/TB7",desc:"One Set to 4, tiebreak to 7 at 4-4"},{key:"short3",name:"One Short Set TB5",format:"SET1-S:4/TB5@3",desc:"One Set to 4, tiebreak to 5 at 3-3"},{key:"short4",name:"Short Sets w/ 3rd TB10",format:"SET3-S:4/TB7-F:TB10",desc:"Best of 3 Sets to 4 Games, tiebreak to 10",desc2:"3rd Set Tiebreak to 7"},{key:"short5",name:"Short Sets w/ 3rd TB7",format:"SET3-S:4/TB7-F:TB7",desc:"Best of 3 Sets to 4 Games, tiebreak to 7",desc2:"3rd Set Tiebreak to 7"},{key:"pro",name:"Pro Set",format:"SET1-S:8/TB7",desc:"One Set to 8 with Advantage, tiebreak at 8-8"},{key:"cps",name:"College Pro Set",format:"SET1-S:8/TB7@7"},{key:"tbsets1",name:"Best of 3 TB7",format:"SET3-S:TB7",desc:"Two tiebreak sets",desc2:"7-point match tiebreak at one set all"},{key:"tbsets2",name:"Best of 3 TB10",format:"SET3-S:TB10",desc:"Best of 3 tiebreaks to 10"},{key:"tbsets3",name:"One Tiebreak to 10",format:"SET1-S:TB10",desc:"One Match Tiebreak to 10 with Advantage"},{key:"tbsets4",name:"Two TB7 w/ 3rd TB10",format:"SET3-S:TB7-F:TB10",desc:"Two 7 point tiebreak sets",desc2:"10 point tiebreak at one set all"},{key:"timed10",name:"Timed 10 minute game - game based",format:"SET1-S:T10"}];let gI,$a;const K_="Timed set",QE="Tiebreak",Bz="No-Ad",Pc="Set",BP="Ad",Mo={setFormat:{descriptor:"Best of",bestOf:3,advantage:BP,what:Pc,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10},finalSetFormat:{descriptor:"Final set",advantage:BP,what:Pc,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10}};function wie(t){const e=t?"finalSetFormat":"setFormat",i=Mo[e].what,n={setTo:Mo[e].setTo};return i===Pc&&Mo[e].advantage===Bz&&(n.NoAD=!0),i===Pc&&document.getElementById(t?"finalSetTiebreak":"setTiebreak")?.checked&&(n.tiebreakAt=Mo[e].tiebreakAt,n.tiebreakFormat={tiebreakTo:Mo[e].tiebreakTo},i===Pc&&Mo[e].winBy===1&&(n.tiebreakFormat.NoAD=!0)),i===K_&&(n.minutes=Mo[e].minutes,n.timed=!0),i===QE&&(n.tiebreakSet={tiebreakTo:Mo[e].tiebreakTo},Mo[e].winBy===1&&(n.tiebreakSet.NoAD=!0)),n}function c1e(){const t=wie();$a={bestOf:Mo.setFormat.bestOf,setFormat:t},document.getElementById("finalSetOption")?.checked&&($a.finalSetFormat=wie(1));const i=kO.scoreGovernor.stringifyMatchUpFormat($a),n=!!u1e.find(s=>s.format===i),a=document.getElementById("matchUpFormatSelector")?.querySelectorAll("option");return Array.from(a).forEach(s=>{s.selected=!n&&s.value==="Custom"||s.value===i}),i}function eP(t){const e=t||c1e(),i=document.getElementById("matchUpFormatString");i.innerHTML=e}const vI=(t,e)=>e&&t.finalSetFormat||t.setFormat,GS=[{getValue:t=>t.bestOf>1?"Best of":"Exactly",options:["Best of","Exactly"],id:"descriptor",value:"Best of",finalSet:!1},{getValue:t=>t.bestOf,finalSet:!1,id:"bestOf",options:[1,3,5],onChange:"pluralize",value:3},{getValue:(t,e)=>{const i=vI(t,e),n=i?.NoAD?Bz:BP;return i?.timed||i?.tiebreakSet?void 0:n},options:[BP,Bz],defaultValue:BP,id:"advantage",whats:[Pc]},{getValue:(t,e)=>{const i=vI(t,e);return i||console.log({pmf:t}),i?.timed?K_:i?.tiebreakSet?QE:Pc},options:[Pc,QE,K_],finalSetLabel:`${Pc}${Xf}`,onChange:"changeWhat",pluralize:!0,id:"what"},{getValue:(t,e)=>vI(t,e).setTo,options:[1,2,3,4,5,6,7,8,9],onChange:"changeCount",defaultValue:6,whats:[Pc],prefix:"to ",id:"setTo"},{getValue:(t,e)=>{const i=vI(t,e);return i.tiebreakFormat?.tiebreakTo||i.tiebreakSet?.tiebreakTo},options:[5,7,9,10,12],whats:[Pc,QE],id:"tiebreakTo",defaultValue:7,prefix:"TB to ",tbSet:!0,value:7,tb:!0},{getValue:(t,e)=>vI(t,e).tiebreakAt,options:t=>{const e=Mo[t?"finalSetFormat":"setFormat"].setTo;return e>1?[e-1,e]:[]},id:"tiebreakAt",defaultValue:6,whats:[Pc],prefix:"@",value:6,tb:!0},{getValue:(t,e)=>{const i=vI(t,e);if(i.tiebreakFormat)return i.tiebreakFormat?.NoAD?1:2},whats:[Pc,QE],prefix:"Win by ",options:[1,2],defaultValue:2,tbSet:!0,id:"winBy",tb:!0},{getValue:(t,e)=>{const i=vI(t,e);return i.timed&&i.minutes||void 0},options:[10,15,20,25,30,45,60,90],whats:[K_],suffix:" Minutes",defaultValue:10,id:"minutes",timed:!0}],Sie={changeWhat:(t,e,i)=>{const n=i===Pc,r=e?"finalSetTiebreakToggle":"setTiebreakToggle",a=document.getElementById(r);a.style.display=n?"":Rt,GS.forEach(s=>{if(s.whats){const{prefix:o="",suffix:l="",pluralize:u}=s,c=s.whats.includes(i),d=e?`${s.id}-${e}`:s.id,p=document.getElementById(d);if(p.style.display===Rt&&c){const h=$a.bestOf,f=!e&&u&&h>1?"s":"",m=s.defaultValue;p.innerHTML=`${o}${m}${f}${l}${Xf}`}p.style.display=c?"":Rt}})},changeCount:(t,e,i)=>{const n=e?`tiebreakAt-${e}`:"tiebreakAt";Mo[e?"finalSetFormat":"setFormat"].tiebreakAt=i;const r=document.getElementById(n);r.innerHTML=`@${i}${Xf}`},pluralize:(t,e,i)=>{const n=Mo[e?"finalSetFormat":"setFormat"].what,r=e?`what-${e}`:"what",a=document.getElementById(r),s=i>1?"s":"";a.innerHTML=`${n}${s}${Xf}`}};function tZ({existingMatchUpFormat:t="SET3-S:6/TB7",callback:e}={}){gI=t,$a=Im.parse(gI);const i=()=>{const S=c1e();Mt(e)&&e&&e(S)};let n,r,a,s,o;const l=[{onClick:()=>e&&e(""),label:"Cancel",intent:"none",close:!0},{label:"Select",intent:"is-info",close:!0,onClick:i}],u="switch is-rounded is-danger",c=document.createElement("div"),d=document.createElement("div");d.id="matchUpFormatString",d.innerHTML=gI,d.style.fontSize="1.5em",d.style.color="blue",d.style.marginBottom="1em",c.appendChild(d);const p=document.createElement("div");p.style.marginBlockEnd="1em";const h={id:"matchUpFormatSelector",options:u1e.map(S=>({selected:S.format===gI,value:S.format,label:S.name}))},{field:f,inputElement:m}=UP(h);m.onchange=S=>{gI=S.target.value,eP(gI),$a=Im.parse(gI),Mo.setFormat=$a.setFormat,Mo.setFormat.bestOf=$a.bestOf,$a.finalSetFormat&&(Mo.finalSetFormat=$a.finalSetFormat);const w=$a.finalSetFormat;n.style.display=w?"":Rt,r.style.display=w?"":Rt,a.checked=w,o.checked=!!w?.tiebreakFormat,s.checked=$a.setFormat.tiebreakFormat,GS.forEach(T=>{if(T.getValue){const U=T.getValue($a),C=document.getElementById(T.id);if(C&&U){const{prefix:E="",suffix:P="",pluralize:M}=T,R=$a.bestOf,N=M&&R>1?"s":"";C.innerHTML=`${E}${U}${N}${P}${Xf}`,C.style.display=""}else C&&(C.style.display=Rt);if(w){const E=T.getValue($a,!0),P=document.getElementById(`${T.id}-1`);if(P&&E){const{prefix:M="",suffix:R="",pluralize:N}=T,A=$a.bestOf,_=N&&A>1?"s":"";P.innerHTML=`${M}${E}${_}${R}${Xf}`,P.style.display=""}else P&&(P.style.display=Rt)}}})},p.appendChild(f),c.appendChild(p);const g=document.createElement("div");GS.map(S=>{const w=S.getValue?S.getValue($a):void 0;return Tie({...S,value:w})}).forEach(S=>g.appendChild(S)),g.id="setFormat",c.appendChild(g);const v=document.createElement("div");v.className="field",v.style.fontSize="1em",s=document.createElement("input"),s.className=u,s.name="setTiebreak",s.id="setTiebreak",s.type="checkbox",s.checked=$a.tiebreakFormat,s.onchange=S=>{const w=S.target.checked;GS.filter(({tb:T})=>T).forEach(T=>{const U=document.getElementById(T.id);if(U.style.display===Rt&&w){const{prefix:C="",suffix:E="",pluralize:P,defaultValue:M}=T,R=$a.bestOf,N=P&&R>1?"s":"";U.innerHTML=`${C}${M}${N}${E}${Xf}`}U.style.display=w?"":Rt}),eP()},v.appendChild(s);const y=document.createElement("label");y.setAttribute("for","setTiebreak"),y.id="setTiebreakToggle",y.innerHTML="Tiebreak",y.style.marginRight="1em",v.appendChild(y),a=document.createElement("input"),a.className="switch is-rounded is-info",a.type="checkbox",a.name="finalSetOption",a.checked=!!$a.finalSetFormat,a.id="finalSetOption",a.onchange=S=>{const w=S.target.checked;n.style.display=w?"":Rt,r.style.display=w?"":Rt,eP()},v.appendChild(a);const b=document.createElement("label");b.setAttribute("for","finalSetOption"),b.innerHTML="Final set",v.appendChild(b),c.appendChild(v),n=document.createElement("div"),n.style.display=$a.finalSetFormat?"":Rt,n.id="finalSetFormat",[{label:"<div style='font-weight: bold'>Final set</div>",options:[],finalSet:!0}].concat(GS.map(S=>{const w=S.getValue?S.getValue($a,!0):void 0;return{...S,value:w}})).filter(S=>S.finalSet!==!1).map(S=>Tie({...S,index:1})).forEach(S=>n.appendChild(S)),c.appendChild(n),r=document.createElement("div"),r.style.display=$a.finalSetFormat?"":Rt,r.className="field",r.style.fontSize="1em",o=document.createElement("input"),o.className=u,o.name="finalSetTiebreak",o.id="finalSetTiebreak",o.type="checkbox",o.checked=$a.finalSetFormat?.tiebreakFormat,r.onchange=S=>{const w=S.target.checked;GS.filter(({tb:T})=>T).forEach(T=>{const U=document.getElementById(`${T.id}-1`);if(U.style.display===Rt&&w){const{prefix:C="",suffix:E="",pluralize:P,defaultValue:M}=T,R=$a.bestOf,N=P&&R>1?"s":"";U.innerHTML=`${C}${M}${N}${E}${Xf}`}U.style.display=w?"":Rt}),eP()},r.appendChild(o);const I=document.createElement("label");I.setAttribute("for","finalSetTiebreak"),I.id="finalSetTiebreakToggle",I.innerHTML="Tiebreak",I.style.marginRight="1em",r.appendChild(I),c.appendChild(r),Yn({title:"Score format",content:c,buttons:l})}function ydt({index:t,finalSetLabel:e,label:i,prefix:n="",suffix:r="",value:a,pluralize:s}){const o=!t&&s&&(Mo.setFormat.bestOf||1)>1?"s":"";return i||t&&e||`${n}${a}${o}${r}${Xf}`}function Tie(t){const{id:e,initiallyHidden:i,index:n,value:r}=t,a=document.createElement("button");return a.className="mfcButton",a.id=n?`${e}-${n}`:e,a.innerHTML=ydt(t),a.onclick=s=>bdt({e:s,button:a,...t}),a.style.display=r||t.label?"":Rt,i&&(a.style.display=Rt),a}function bdt(t){const{e,id:i,button:n,pluralize:r,options:a,onChange:s,index:o,prefix:l="",suffix:u=""}=t,c=Mo.setFormat.bestOf||1,d=!o&&r&&c>1?"s":"",h=(Mt(a)?a(o):a).map(f=>({text:`${f}${d}`,onClick:()=>{n.innerHTML=`${l}${f}${d}${u}${Xf}`,s&&Mt(Sie[s])&&Sie[s](e,o,f),Mo[o?"finalSetFormat":"setFormat"][i]=f,eP()}}));Pu({items:h,target:e.target,config:{arrow:!1,offset:[0,0]}})}function Idt(){return[{rowHandle:!0,formatter:"handle",width:30,minWidth:30},{cellClick:(e,i)=>i.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",responsive:!1,hozAlign:hi,width:5},{formatter:"responsiveCollapse",responsive:!1,resizable:!1,hozAlign:di,width:50},{editorParams:{selectContents:!0},field:"collectionName",minWidth:200,title:"Name",editor:!0},{field:"matchUpCount",editor:"number",title:"#",width:70,editorParams:{elementAttributes:{maxlength:2},selectContents:!0,mask:"99",step:1,max:20,min:0}},{field:"matchUpType",editor:"list",title:"Type",width:100,editorParams:{values:["Singles","Doubles"]}},{title:"Gender",field:"gender",editor:"list",width:100,editorParams:{values:["Male","Female","Any"]}},{cellClick:(e,i)=>{const n=i.getRow(),r=n.getData();tZ({callback:s=>{s&&(Object.assign(r,{matchUpFormat:s}),n.update(r),i.getTable().redraw(!0))},existingMatchUpFormat:r.matchUpFormat})},title:"Score format",field:_6,minWidth:150},{title:"Award type",field:"awardType",editor:"list",width:150,editorParams:{values:[R6,M6,A6,N6]}},{field:"awardValue",editor:"number",title:"Value",width:70,editorParams:{elementAttributes:{maxlength:2},selectContents:!0,mask:"99",step:1,max:99,min:0}}]}function Uie(t){return t?.[0].toUpperCase()+t?.substring(1).toLowerCase()||""}function wdt({tableElement:t,tieFormat:e}){const i=(e?.collectionDefinitions?.sort((a,s)=>a.collectionOrder-s.collectionOrder)||[]).map(a=>{const{collectionValue:s,matchUpValue:o,scoreValue:l,setValue:u,matchUpType:c,gender:d}=a,p=Mi.isConvertableInteger(s)&&R6||Mi.isConvertableInteger(l)&&N6||Mi.isConvertableInteger(u)&&A6||M6,h=s??l??u??o;return{...a,matchUpType:Uie(c),gender:Uie(d),awardValue:h,awardType:p}}),n=Idt();return{table:new Bs(t,{responsiveLayoutCollapseStartOpen:!1,columnDefaults:{headerSort:!1},placeholder:"No collections",responsiveLayout:"collapse",index:"collectionId",reactiveData:!0,layout:"fitColumns",movableRows:!0,minHeight:200,columns:n,data:i})}}function d1e(t){const e=t?.winCriteria?.valueGoal,i=t?.collectionDefinitions?.length?t?.winCriteria?.aggregateValue&&"Aggregate value":"none";return`<div style="font-weight: bold">Win criteria: <span class="has-text-success">${e||i}</span></div>`}function p1e({title:t,tieFormat:e,onClose:i}){const{content:n,inputs:r,elements:a,table:s}=Sdt({tieFormat:e}),o=c=>{const d=r.tieFormatName.value,p=c.map(f=>Mi.definedAttributes({collectionValue:f.awardType===R6?f.awardValue:void 0,matchUpValue:f.awardType===M6?f.awardValue:void 0,scoreValue:f.awardType===N6?f.awardValue:void 0,setValue:f.awardType===A6?f.awardValue:void 0,matchUpType:f.matchUpType.toUpperCase(),collectionName:f.collectionName,matchUpFormat:f.matchUpFormat,gender:f.gender.toUpperCase(),collectionId:f.collectionId,matchUpCount:f.matchUpCount})),h=nt.calculateWinCriteria({collectionDefinitions:p});return{collectionDefinitions:p,tieFormatName:d,winCriteria:h}};s.on("dataChanged",()=>{const c=o(s.getData());a.winCriteria.innerHTML=d1e(c)});const u=Udt({table:s,onClose:c=>{const d=o(c);Mt(i)&&i(d?.collectionDefinitions?.length&&d)}});return o1e({title:t,content:n,footer:u})}function Sdt({tieFormat:t}){const e=document.createElement("div");e.className="overlay-content-container",e.style.backgroundColor="white";const i=document.createElement("div"),{table:n}=wdt({tieFormat:t,tableElement:i}),r=Tdt();e.appendChild(r);const a=document.createElement("div");e.appendChild(a),e.appendChild(i);const s=()=>{const c=n?.getSelectedData().map(({collectionId:d})=>d);n?.deleteRow(c)},o=[{value:t?.tieFormatName||"Custom scorecard",error:"minimum of 5 characters",placeholder:"Scorecard name",validator:Vr(5),field:"tieFormatName",id:"tieFormatName",location:hi},{text:d1e(t),id:"winCriteria",location:hi},{onClick:s,label:"Delete selected",intent:"is-danger",stateChange:!0,location:ba},{onClick:()=>{const d={collectionName:`Collection ${n.getData().length+1}`,collectionId:Mi.UUID(),awardType:"Match value",matchUpFormat:"SET3-S:6/TB7",matchUpType:"Singles",matchUpCount:1,gender:"Any",awardValue:1};n.addRow(d)},label:"Add collection",intent:"is-info",location:ti}],{elements:l,inputs:u}=wo({table:n,target:a,items:o})||{};return{content:e,table:n,elements:l,inputs:u}}function Tdt(){const t=document.createElement("div");t.className="overlay-content-overview";const e=document.createElement("div");return e.className="overlay-content-body",t.appendChild(e),t}function Udt({table:t,onClose:e}){const i=()=>{t.destroy(),l1e()},n=document.createElement("button");n.className="button is-warning is-light",n.onclick=i,n.innerHTML="Cancel";const r=document.createElement("button");r.className="button is-info button-spacer",r.onclick=s=>{s.preventDefault(),s.stopPropagation();const o=t.getData();i(),Mt(e)&&e(o)},r.innerHTML="Done";const a=document.createElement("div");return a.className="overlay-footer-wrap",a.appendChild(n),a.appendChild(r),a}function h1e({matchUpId:t,structureId:e,eventId:i,drawId:n,callback:r}){const{tieFormat:a}=nt.getTieFormat({structureId:e,matchUpId:t,eventId:i,drawId:n});p1e({title:"Edit scorecard",tieFormat:a,onClose:o=>{if(o){o.collectionDefinitions?.forEach((p,h)=>p.collectionOrder=h+1);const l={collectionName:!0,collectionOrder:!0};if(!$R.compareTieFormats({descendant:o,ancestor:a,considerations:l})?.different){Ht({intent:"is-info",message:"No changes"});return}Wt({methods:[{method:HJe,params:{modifiedTieFormat:o,considerations:l,structureId:e,matchUpId:t,drawId:n}}],callback:p=>p.success?(Ht({intent:"is-success",message:"Scorecard updated"}),Mt(r)&&r&&r()):Ht({intent:"is-danger",message:p.error?.message||"Error"})})}}})}const MA="has-text-success",f1e="tieSide1",m1e="tieSide2";function S2({title:t,drawId:e,matchUpId:i,onClose:n}){const r=nt.findMatchUp({drawId:e,matchUpId:i,participantsProfile:{withISO2:!0}}),a=r.matchUp;if(!a||r.error||!t||!Array.isArray(a?.tieFormat?.collectionDefinitions))return;const s=T2({matchUp:a}),o=Edt({title:t,drawId:e,matchUpId:i,onClose:n});return o1e({title:t,content:s,footer:o})}function T2({matchUp:t}){const e=document.createElement("div");e.className="overlay-content-container";const i=nO({participantName:Die({matchUp:t,sideNumber:1})||"",justify:"end"}),n=nO({participantName:Die({matchUp:t,sideNumber:2})||"",justify:"start"}),{winningSide:r,score:a}=t,s=a?.sets||[],o=rO({winningSide:r,sets:s,sideNumber:1,id:f1e}),l=rO({winningSide:r,sets:s,sideNumber:2,id:m1e}),u=a1e({side1:i,side2:n,side1Score:o,side2Score:l});e.appendChild(u),It.collectionTables||(It.collectionTables=[]);const c=t.tieFormat.collectionDefinitions?.sort((d,p)=>d.collectionOrder-p.collectionOrder)||[];for(const d of c){const p=t.tieMatchUps.filter(v=>v.collectionId===d.collectionId),h=document.createElement("div");h.className="collection";const f=document.createElement("div");f.className="title is-4",f.innerHTML=d.collectionName,h.appendChild(f);const m=document.createElement("div");h.appendChild(m);const{table:g}=fdt({matchUp:t,tableElement:m,collectionMatchUps:p});It.collectionTables.push(g),e.appendChild(h)}return e}function Ddt(t){const e=t?.score?.sets?.[0];if(!e)return;const i=document.getElementById(f1e),n=document.getElementById(m1e);i.classList.remove(MA),n.classList.remove(MA),i.innerHTML=e.side1Score,n.innerHTML=e.side2Score,t.winningSide===1&&i.classList.add(MA),t.winningSide===2&&n.classList.add(MA)}function Die({matchUp:t,sideNumber:e}){return t.sides.find(i=>i.sideNumber===e)?.participant?.participantName}function Edt({title:t,drawId:e,matchUpId:i,onClose:n}){const r=document.createElement("button");r.className="button is-warning is-light",r.onclick=()=>{h1e({matchUpId:i,drawId:e,callback:()=>S2({title:t,drawId:e,matchUpId:i,onClose:()=>console.log("closed")})})},r.innerHTML="Edit scorecard";const a=c=>{if(c.success){const d=nt.findMatchUp({drawId:e,matchUpId:i})?.matchUp,p=T2({matchUp:d});gdt({content:p})}},s=document.createElement("button");s.className="button is-warning is-light button-spacer",s.innerHTML="Remove players",s.onclick=()=>{Wt({methods:[{params:{drawId:e,matchUpId:i,inheritance:!1},method:YEe}],callback:a})};const o=document.createElement("button");o.className="button is-info is-light button-spacer",o.innerHTML="Clear results",o.onclick=()=>{Wt({methods:[{params:{drawId:e,matchUpId:i},method:KEe}],callback:a})};const l=document.createElement("button");l.className="button is-info button-spacer",l.onclick=c=>{for(c.preventDefault(),c.stopPropagation();It.collectionTables&&It.collectionTables.length;)It.collectionTables.pop().destroy();l1e(),Mt(n)&&n&&n()},l.innerHTML="Done";const u=document.createElement("div");return u.className="overlay-footer-wrap",u.appendChild(r),u.appendChild(s),u.appendChild(o),u.appendChild(l),u}const{TEAM:Pdt}=qs,Cdt=(t,e)=>(i,n)=>{const r=n.getRow().getData(),{matchUpId:a,readyToScore:s,matchUpType:o,drawId:l,eventName:u}=r.matchUp;if(o===Pdt)S2({title:u,matchUpId:a,drawId:l,onClose:()=>t()});else if(s||r.matchUp.score?.scoreStringSide1)if(zi.hotkeys&&!zi.device.isMobile){e({e:i,cell:n,replaceTableData:t});const c=document.querySelectorAll(".activeScoreCell");for(const d of Array.from(c))d.classList.remove("activeScoreCell");i.target.classList.contains("tabulator-cell")?i.target.firstChild.classList.add("activeScoreCell"):i.target.classList.add("activeScoreCell")}else ON({matchUp:r.matchUp,matchUpId:a,callback:t})};function g1e(t,e){if(!t.score&&!e.score){if(t.readyToScore&&!e.readyToScore)return-1;if(e.readyToScore&&!t.readyToScore)return 1}return t.score&&!e.score?-1:e.score&&!t.score?1:0}const Eie={fn:t=>({name:"dynamicContent",default:!0,onShow(){typeof t.props.dynContent=="function"&&t.setContent(t.props.dynContent(t.reference))}})},RI={"o-route":TD,"p-route":Tm,"e-route":wh,"m-route":p6,"s-route":ib,"v-route":h6},Pie={"o-route":"Overview","p-route":"Participants","e-route":"Events","m-route":"MatchUps","s-route":"Schedule","v-route":"Venues"};function Rdt(){const t=`
  <div class="side-bar collapse">
    <ul class="features-list">
      <span class="features-item-text">Overview</span>
      <span class="features-item-text">Participants</span>
      <span class="features-item-text">Events</span>
      <span class="features-item-text">Matches</span>
      <span class="features-item-text">Schedule</span>
      <span class="features-item-text">Venues</span>
    </ul>
  </div>
`,e=document.getElementById("navText");e.innerHTML=t;const i=Object.keys(RI),n=It.router?.current?.[0]?.data?.selectedTab,r=s=>document.querySelector(".side-bar")?.classList.contains("collapse")?s:"",a=document.getElementById("o-route");hv(a,{dynContent:()=>!zi.device.isMobile&&r(Pie["o-route"]),onShow:s=>!!s.props.content,plugins:[Eie],placement:Gp,arrow:!1}),i.forEach(s=>{const o=document.getElementById(s);hv(o,{dynContent:()=>!zi.device.isMobile&&r(Pie[s]),onShow:l=>!!l.props.content,plugins:[Eie],placement:Gp,arrow:!1}),(n===RI[s]||!n&&RI[s]===Tm)&&(o.style.color="blue"),o.onclick=()=>{document.querySelectorAll(".nav-icon").forEach(c=>c.style.color=""),o.style.color="blue";const l=nt.getTournament()?.tournamentRecord?.tournamentId,u=`/${As}/${l}/${RI[s]}`;It.router.navigate(u)}})}function iZ(t){document.querySelectorAll(".nav-icon").forEach(i=>i.style.color=""),Object.keys(RI).forEach(i=>{const n=document.getElementById(i);n&&(t===RI[i]||!t&&RI[i]===Tm)&&(n.style.color="blue")})}function Mdt({data:t,replaceTableData:e,setFocusData:i}){const n=(u,c)=>{const p=c.getRow().getData(),{courtName:h,scheduledDate:f}=p;if(h&&f){const m=nt.getTournament()?.tournamentRecord?.tournamentId,g=`/${As}/${m}/${ib}/${f}`;It.router.navigate(g),iZ(ib)}},r=(u,c)=>{const d=c.getValue();ZCe({time:d,callback:({time:h})=>{const m=Mi.dateTime.convertTime(h,!0),g=c.getRow(),v=g.getData(),{matchUpId:y}=v;m!==d&&r1e({matchUpId:y,schedule:{scheduledTime:m},callback:()=>{console.log("callback"),g.update({...v,scheduledTime:m})}})}})},a=()=>e(),s=t.some(u=>u.courtName),o=(u,c)=>I1(u,c,a),l=u=>{const c=document.createElement("div");c.className="has-text-warning-dark",c.innerHTML="Select participant";const d=({event:h,...f})=>{I1(h,u,a,f)};return u.getValue().participantName&&tS(d)(u,c)};return[{cellClick:(u,c)=>c.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:hi,width:5},{headerMenu:rg({duration:"Duration",complete:"Complete"}),formatter:"rownum",headerSort:!1,hozAlign:hi,width:55},{formatter:Pat(Br),field:"eventId",title:"Event",visible:!0,minWidth:200,widthGrow:1},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{field:"matchUpType",titleFormatter:bie,title:"Type",minWidth:90},{field:"roundName",title:"Round",titleFormatter:bie,minWidth:90},{cellClick:n,field:"scheduledDate",title:"Date",width:110},{cellClick:n,visible:!!s,field:"courtName",title:"Court",width:100},{cellClick:r,field:"scheduledTime",visible:!0,title:"Time",width:70},{formatter:l,cellClick:o,sorter:CU,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:l,cellClick:o,sorter:CU,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{cellClick:Cdt(e,i),formatter:QK,sorter:g1e,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:i1e,formatter:n1e,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:hi,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70},{cellClick:(u,c)=>eZ({pointerEvent:u,cell:c,...c.getData()}),formatter:Vv,responsive:!1,headerSort:!1,hozAlign:ti,widthGrow:0,width:50}]}const bj=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Ij(t,e,i,n){t.addEventListener?t.addEventListener(e,i,n):t.attachEvent&&t.attachEvent(`on${e}`,i)}function OE(t,e,i,n){t&&(t.removeEventListener?t.removeEventListener(e,i,n):t.detachEvent&&t.detachEvent(`on${e}`,i))}function v1e(t,e){const i=e.slice(0,e.length-1),n=[];for(let r=0;r<i.length;r++)n.push(t[i[r].toLowerCase()]);return n}function y1e(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let i=e.lastIndexOf("");for(;i>=0;)e[i-1]+=",",e.splice(i,1),i=e.lastIndexOf("");return e}function Ndt(t,e){const i=t.length>=e.length?t:e,n=t.length>=e.length?e:t;let r=!0;for(let a=0;a<i.length;a++)n.indexOf(i[a])===-1&&(r=!1);return r}function b1e(t){let e=t.keyCode||t.which||t.charCode;return t.code&&/^Key[A-Z]$/.test(t.code)&&(e=t.code.charCodeAt(3)),e}const w1={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":bj?173:189,"=":bj?61:187,";":bj?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},jh={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,meta:91,command:91},tP={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},vl={16:!1,18:!1,17:!1,91:!1},ys={};for(let t=1;t<20;t++)w1[`f${t}`]=111+t;let as=[],VP=null,I1e="all";const Pg=new Map,uE=t=>w1[t.toLowerCase()]||jh[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),Adt=t=>Object.keys(w1).find(e=>w1[e]===t),_dt=t=>Object.keys(jh).find(e=>jh[e]===t),w1e=t=>{I1e=t||"all"},S1=()=>I1e||"all",kdt=()=>as.slice(0),xdt=()=>as.map(t=>Adt(t)||_dt(t)||String.fromCharCode(t)),Odt=()=>{const t=[];return Object.keys(ys).forEach(e=>{ys[e].forEach(({key:i,scope:n,mods:r,shortcut:a})=>{t.push({scope:n,shortcut:a,mods:r,keys:i.split("+").map(s=>uE(s))})})}),t},S1e=t=>{const e=t.target||t.srcElement,{tagName:i}=e;let n=!0;const r=i==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(r||i==="TEXTAREA"||i==="SELECT")&&!e.readOnly)&&(n=!1),n},Ldt=t=>(typeof t=="string"&&(t=uE(t)),as.indexOf(t)!==-1),Fdt=(t,e)=>{let i,n;t||(t=S1());for(const r in ys)if(Object.prototype.hasOwnProperty.call(ys,r))for(i=ys[r],n=0;n<i.length;)i[n].scope===t?i.splice(n,1).forEach(({element:a})=>nZ(a)):n++;S1()===t&&w1e(e||"all")};function $dt(t){let e=b1e(t);t.key&&t.key.toLowerCase()==="capslock"&&(e=uE(t.key));const i=as.indexOf(e);if(i>=0&&as.splice(i,1),t.key&&t.key.toLowerCase()==="meta"&&as.splice(0,as.length),(e===93||e===224)&&(e=91),e in vl){vl[e]=!1;for(const n in jh)jh[n]===e&&(Jf[n]=!1)}}const T1e=(t,...e)=>{if(typeof t>"u")Object.keys(ys).forEach(i=>{Array.isArray(ys[i])&&ys[i].forEach(n=>NA(n)),delete ys[i]}),nZ(null);else if(Array.isArray(t))t.forEach(i=>{i.key&&NA(i)});else if(typeof t=="object")t.key&&NA(t);else if(typeof t=="string"){let[i,n]=e;typeof i=="function"&&(n=i,i=""),NA({key:t,scope:i,method:n,splitKey:"+"})}},NA=({key:t,scope:e,method:i,splitKey:n="+"})=>{y1e(t).forEach(r=>{const a=r.split(n),s=a.length,o=a[s-1],l=o==="*"?"*":uE(o);if(!ys[l])return;e||(e=S1());const u=s>1?v1e(jh,a):[],c=[];ys[l]=ys[l].filter(d=>{const p=(i?d.method===i:!0)&&d.scope===e&&Ndt(d.mods,u);return p&&c.push(d.element),!p}),c.forEach(d=>nZ(d))})};function Cie(t,e,i,n){if(e.element!==n)return;let r;if(e.scope===i||e.scope==="all"){r=e.mods.length>0;for(const a in vl)Object.prototype.hasOwnProperty.call(vl,a)&&(!vl[a]&&e.mods.indexOf(+a)>-1||vl[a]&&e.mods.indexOf(+a)===-1)&&(r=!1);(e.mods.length===0&&!vl[16]&&!vl[18]&&!vl[17]&&!vl[91]||r||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(as),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function Rie(t,e){const i=ys["*"];let n=b1e(t);if(t.key&&t.key.toLowerCase()==="capslock"||!(Jf.filter||S1e).call(this,t))return;if((n===93||n===224)&&(n=91),as.indexOf(n)===-1&&n!==229&&as.push(n),["metaKey","ctrlKey","altKey","shiftKey"].forEach(o=>{const l=tP[o];t[o]&&as.indexOf(l)===-1?as.push(l):!t[o]&&as.indexOf(l)>-1?as.splice(as.indexOf(l),1):o==="metaKey"&&t[o]&&(as=as.filter(u=>u in tP||u===n))}),n in vl){vl[n]=!0;for(const o in jh)if(Object.prototype.hasOwnProperty.call(jh,o)){const l=tP[jh[o]];Jf[o]=t[l]}if(!i)return}for(const o in vl)Object.prototype.hasOwnProperty.call(vl,o)&&(vl[o]=t[tP[o]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(as.indexOf(17)===-1&&as.push(17),as.indexOf(18)===-1&&as.push(18),vl[17]=!0,vl[18]=!0);const r=S1();if(i)for(let o=0;o<i.length;o++)i[o].scope===r&&(t.type==="keydown"&&i[o].keydown||t.type==="keyup"&&i[o].keyup)&&Cie(t,i[o],r,e);if(!(n in ys))return;const a=ys[n],s=a.length;for(let o=0;o<s;o++)if((t.type==="keydown"&&a[o].keydown||t.type==="keyup"&&a[o].keyup)&&a[o].key){const l=a[o],{splitKey:u}=l,c=l.key.split(u),d=[];for(let p=0;p<c.length;p++)d.push(uE(c[p]));d.sort().join("")===as.sort().join("")&&Cie(t,l,r,e)}}const Jf=function(t,e,i){as=[];const n=y1e(t);let r=[],a="all",s=document,o=0,l=!1,u=!0,c="+",d=!1,p=!1;if(i===void 0&&typeof e=="function"&&(i=e),Object.prototype.toString.call(e)==="[object Object]"){const h=e;h.scope&&(a=h.scope),h.element&&(s=h.element),h.keyup&&(l=h.keyup),h.keydown!==void 0&&(u=h.keydown),h.capture!==void 0&&(d=h.capture),typeof h.splitKey=="string"&&(c=h.splitKey),h.single===!0&&(p=!0)}for(typeof e=="string"&&(a=e),p&&T1e(t,a);o<n.length;o++){const h=n[o].split(c);r=[],h.length>1&&(r=v1e(jh,h));let f=h[h.length-1];f=f==="*"?"*":uE(f),f in ys||(ys[f]=[]),ys[f].push({keyup:l,keydown:u,scope:a,mods:r,shortcut:n[o],method:i,key:n[o],splitKey:c,element:s})}if(typeof s<"u"&&typeof window<"u"){if(!Pg.has(s)){const h=(m=window.event)=>Rie(m,s),f=(m=window.event)=>{Rie(m,s),$dt(m)};Pg.set(s,{keydownListener:h,keyupListenr:f,capture:d}),Ij(s,"keydown",h,d),Ij(s,"keyup",f,d)}if(!VP){const h=()=>{as=[]};VP={listener:h,capture:d},Ij(window,"focus",h,d)}}};function Bdt(t,e="all"){Object.keys(ys).forEach(i=>{ys[i].filter(n=>n.scope===e&&n.shortcut===t).forEach(n=>{n&&n.method&&n.method({},n)})})}function nZ(t){const e=Object.values(ys).flat();if(e.findIndex(({element:i})=>i===t)<0&&t){const{keydownListener:i,keyupListenr:n,capture:r}=Pg.get(t)||{};i&&n&&(OE(t,"keyup",n,r),OE(t,"keydown",i,r),Pg.delete(t))}if((e.length<=0||Pg.size<=0)&&(Array.from(Pg.keys()).forEach(i=>{const{keydownListener:n,keyupListenr:r,capture:a}=Pg.get(i)||{};n&&r&&(OE(i,"keyup",r,a),OE(i,"keydown",n,a),Pg.delete(i))}),Pg.clear(),Object.keys(ys).forEach(i=>delete ys[i]),VP)){const{listener:i,capture:n}=VP;OE(window,"focus",i,n),VP=null}}const wj={getPressedKeyString:xdt,setScope:w1e,getScope:S1,deleteScope:Fdt,getPressedKeyCodes:kdt,getAllKeyCodes:Odt,isPressed:Ldt,filter:S1e,trigger:Bdt,unbind:T1e,keyMap:w1,modifier:jh,modifierMap:tP};for(const t in wj){const e=t;Object.prototype.hasOwnProperty.call(wj,e)&&(Jf[e]=wj[e])}if(typeof window<"u"){const t=window.hotkeys;Jf.noConflict=e=>(e&&window.hotkeys===Jf&&(window.hotkeys=t),Jf),window.hotkeys=Jf}const{HOTKEYS:Vdt,SIDE1KEYS:jdt,MODIFIERS:Gdt}=y4;function Hdt(){let t,e;const i=n=>{e=void 0,t=n};return Jf(Vdt+",esc",(n,r)=>{if(t){const a=t.cell.getElement(),s=a.classList?.contains("tabulator-cell")?a.firstChild:a;n.preventDefault();const o=t.cell.getRow().getData();e||(e=o.matchUp);const l=Jf.shift,u=l?r.key.split(r.splitKey)[1]:r.key;u==="esc"&&(t.replaceTableData(),t=void 0);const c=jdt.some(d=>d===u)&&(l?2:1)||void 0;if(c||Gdt.includes(u)){const{matchUpFormat:d,matchUpStatus:p,score:h,sets:f,winningSide:m}=e,{matchUpStatus:g,scoreString:v,winningSide:y,sets:b,updated:I}=Cy.keyValueScore({scoreString:h?.scoreStringSide1,shiftFirst:!0,sets:f||[],matchUpStatus:p,matchUpFormat:d,winningSide:m,lowSide:c,value:u});I&&(e={matchUpId:o.matchUp.matchUpId,drawId:o.matchUp.drawId,score:{scoreStringSide1:v},matchUpStatus:g,winningSide:y,sets:b,matchUpFormat:d,updated:I},s.innerText=v||"Enter score")}}if(t&&r.key==="enter"){const a=Cy.generateScoreString({sets:e.sets,reversed:!0}),s=Cy.generateScoreString({sets:e.sets}),o={matchUpStatus:e.matchUpStatus,winningSide:e.winningSide,score:{sets:e.sets,scoreStringSide1:s,scoreStringSide2:a}};zdt({callback:t.replaceTableData,matchUpId:e.matchUpId,drawId:e.drawId,outcome:o}),t=void 0}}),{setFocusData:i}}function zdt({outcome:t,callback:e,matchUpId:i,drawId:n}){const{matchUpStatus:r,winningSide:a,score:s}=t;Wt({methods:[{method:IK,params:{outcome:{matchUpStatus:r,winningSide:a,score:s},matchUpId:i,drawId:n}}],callback:u=>{Mt(e)&&e({...u,outcome:t})}})}function qdt(){let t;const{setFocusData:e}=Hdt(),i=()=>(nt.allTournamentMatchUps({participantsProfile:{withISO2:!0,withScaleValues:!0},contextProfile:{withCompetitiveness:!0}}).matchUps||[]).filter(({matchUpStatus:l})=>l!=="BYE").map(oE),n=()=>{t.replaceData(i())},r=i(),a=Mdt({data:r,replaceTableData:n,setFocusData:e});return(o=>{ng({anchorId:Bk});const l=document.getElementById(Bk),u=jl(l,"section")?.querySelector(".tabHeader");t=new Bs(l,{headerSortElement:wf(["complete","duration","score","scheduledTime"]),height:window.innerHeight*.85,placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",columns:a,data:o}),t.on("dataFiltered",(c,d)=>{const p=d.map(v=>v.getData().matchUp);u&&(u.innerHTML=`Matches (${p.length})`);const h=document.getElementById("wtnPredictiveAccuracy"),f=nt.getPredictiveAccuracy({valueAccessor:"wtnRating",scaleName:"WTN",zoneMargin:2.5,matchUps:p});f?.accuracy?.percent?(h.style.display="",h.innerHTML=`WTN ${f.accuracy.percent}%`):h.style.display=Rt;const m=document.getElementById("utrPredictiveAccuracy"),g=nt.getPredictiveAccuracy({valueAccessor:"utrRating",singlesForDoubles:!0,scaleName:"UTR",zoneMargin:1,matchUps:p});g?.accuracy?.percent?(m.style.display="",m.innerHTML=`UTR ${g.accuracy.percent}%`):m.style.display=Rt})})(r),{table:t,data:r,replaceTableData:n}}function aO(t){zi.activeScale=t}const{TEAM_EVENT:Mie,SINGLES:Nie,DOUBLES:Aie}=dl,{TEAM:Wdt}=qs;function Ydt(){const t=new Map,e={elements:{},options:{}},{data:i,table:n,replaceTableData:r}=qdt(),a=nt.getEvents().events||[],s=document.getElementById(m6);s.style.display=Rt,e.options.flight=Jdt({matchUpFilters:t,events:a,table:n});const o=Qdt({matchUpFilters:t,components:e,events:a,table:n}),l=Zdt({table:n,matchUpFilters:t,statsPanel:s}),u=Kdt({table:n,matchUpFilters:t,data:i}),c=Xdt({matchUpFilters:t,table:n}),d=m=>m.searchText?.includes(t.get("searchText")),p=m=>{m||n?.removeFilter(d),t.set("searchText",m),m&&n?.addFilter(d)},h=[{onClick:()=>n?.deselectRow(),label:"Schedule",stateChange:!0,location:ba},{onKeyDown:m=>m.keyCode===8&&m.target.value.length===1&&p(""),onKeyUp:m=>p(m.target.value),clearSearch:()=>{n?.removeFilter(d),t.set("searchText",""),n?.removeFilter()},placeholder:"Search matches",location:hi,search:!0},{hide:o.length<4,options:o,id:"eventOptions",label:Qg,modifyLabel:!0,selection:!0,location:hi},{options:e.options.flight.flightOptions,hide:!t.get("eventIdFilter")||e.options.flight.flightOptions.length<3,label:CC,id:"flightOptions",modifyLabel:!0,selection:!0,location:hi},{hide:l.length<3,options:l,modifyLabel:!0,label:Xme,location:hi,selection:!0},{options:c,label:Zme,modifyLabel:!0,selection:!0,location:hi},{hide:u.length<4,options:u,modifyLabel:!0,label:Jme,selection:!0,location:hi},{onClick:()=>{aO(_C),r()},id:"wtnPredictiveAccuracy",intent:"is-danger",location:ti,text:"WTN %",hide:!0},{onClick:()=>{aO(yw),r()},id:"utrPredictiveAccuracy",intent:"is-info",location:ti,text:"UTR %",hide:!0}],f=document.getElementById(D6);e.elements=wo({table:n,target:f,items:h})?.elements}function Kdt({table:t,matchUpFilters:e,data:i}){const n=o=>o.matchUpType===e.get("matchUpTypeFilter"),r=o=>{t?.removeFilter(n),e.set("matchUpTypeFilter",o),o&&t?.addFilter(n)},a={label:`<span style='font-weight: bold'>${Jme}</span>`,onClick:()=>r(),close:!0},s=i.reduce((o,l)=>(o.includes(l.matchUpType)||o.push(l.matchUpType),o),[]);return[a,{divider:!0},s.includes(Nie)&&{label:"Singles",close:!0,onClick:()=>r(Nie)},s.includes(Aie)&&{label:"Doubles",close:!0,onClick:()=>r(Aie)},s.includes(Mie)&&{label:"Team",close:!0,onClick:()=>r(Mie)}].filter(Boolean)}function Zdt({table:t,matchUpFilters:e,statsPanel:i}){const n=nt.getParticipants({participantFilters:{participantTypes:[Wdt]}}).participants||[],r=Object.assign({},...n.map(l=>({[l.participantId]:l.individualParticipantIds}))),a=l=>l.individualParticipantIds.some(u=>r[e.get("teamIdFilter")]?.includes(u)),s=l=>{if(e.get("teamIdFilter")&&t?.removeFilter(a),e.set("teamIdFilter",l),l){t?.addFilter(a);const{teamStats:u}=nt.getParticipantStats({teamParticipantId:l});if(u?.participantName){i.style.display="";const c=nO({participantName:u.participantName,justify:"end"}),d=nO({participantName:"Opponents",justify:"start"}),p=[{side1Score:u.matchUps[0],side2Score:u.matchUps[1]}],h=rO({sets:p,sideNumber:1}),f=rO({sets:p,sideNumber:2});Js(i),i.appendChild(a1e({side1:c,side2:d,side1Score:h,side2Score:f}))}}else i.style.display=Rt};return[{label:`<span style='font-weight: bold'>${Xme}</span>`,onClick:()=>s(),close:!0},{divider:!0}].concat(n.sort((l,u)=>l?.participantName?.localeCompare(u?.participantName)).map(l=>({onClick:()=>s(l.participantId),label:l.participantName,close:!0})))}function Xdt({matchUpFilters:t,table:e}){const i=a=>{const s=t.get("matchUpStatusFilter");if(s==="readyToScore")return a.scoreDetail.readyToScore&&!a.scoreDetail.score&&!a.scoreDetail.winningSide;if(s==="complete")return a.scoreDetail.winningSide||["DOUBLE_WALKOVER","DOUBLE_DEFAULT","CANCELLED","ABANDONED"].includes(a.scoreDetail.matchUpStatus)},n=a=>{e?.removeFilter(i),t.set("matchUpStatusFilter",a),a&&e?.addFilter(i)};return[{label:`<span style='font-weight: bold'>${Zme}</span>`,onClick:()=>n(),close:!0},{divider:!0},{label:"Ready to score",close:!0,onClick:()=>n("readyToScore")},{label:"Complete",close:!0,onClick:()=>n("complete")}]}function Jdt({matchUpFilters:t,events:e,table:i}){const n=l=>l.drawId===t.get("drawIdFilter"),r=l=>{i?.removeFilter(n),t.set("drawIdFilter",l),l&&i?.addFilter(n)},a={label:`<span style='font-weight: bold'>${CC}</span>`,onClick:()=>r(),close:!0},s=l=>l.drawDefinitions?.map(({drawId:u,drawName:c})=>({onClick:()=>r(u),label:c,close:!0})),o=[a,{divider:!0}].concat(e.flatMap(s)).filter(Boolean);return{flightFilter:n,flightOptions:o,allFlights:a,mapFlightOptions:s}}function Qdt({matchUpFilters:t,table:e,events:i,components:n}){const r=o=>o.eventId===t.get("eventIdFilter"),a=o=>{if(e?.removeFilter(r),t.set("eventIdFilter",o),e?.removeFilter(n.options.flight.flightFilter),t.set("drawIdFilter",void 0),o){e?.addFilter(r),n.options.flight.flightOptions=[n.options.flight.allFlights,{divider:!0}].concat(n.options.flight.mapFlightOptions(i.find(c=>o===c.eventId))).filter(Boolean);const l={options:n.options.flight.flightOptions,label:CC,id:"flightOptions",modifyLabel:!0,selection:!0},u=hz({button:l});n.elements.flightOptions.replaceWith(u),n.elements.flightOptions=u,n.elements.flightOptions.style.display=n.options.flight.flightOptions.length<3?Rt:""}else n.elements.flightOptions.style.display=Rt};return[{label:`<span style='font-weight: bold'>${Qg}</span>`,onClick:()=>a(),close:!0},{divider:!0}].concat(i.map(o=>({onClick:()=>a(o.eventId),label:o.eventName,close:!0})))}function ept(){const t=nt.getTournamentInfo().tournamentInfo;if(t?.timeItemValues?.TMX?.offline){const r=document.getElementById("dnav");r&&(r.style.backgroundColor="lightyellow")}const i=document.getElementById("provider");i&&(i.onclick=()=>It.router.navigate("/tournaments"));const n=document.getElementById("pageTitle");n&&t?.tournamentName?(Js(n),n.innerHTML=`<div class='tmx-title'>${t?.tournamentName}</div>`):It.router.navigate("/tournaments")}function U1e(t){const{venueName:e,venueAbbreviation:i,addresses:n,venueId:r,courts:a}=t;return{hasLocation:n?.[0]?.longitude,courtsCount:a?.length||0,scheduledMatchUpsCount:0,address:n?.[0],availableTime:"",venueAbbreviation:i,venueName:e,venueId:r,courts:a,venue:t}}function tpt(){function t(i){return i.getValue()?'<i class="fa-solid fa-check" style="color: green"></i>':'<i class="fa-solid fa-xmark"></i>'}const e=()=>console.log("Court actions");return[{cellClick:(i,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:hi,width:5},{headerMenu:rg({floodlit:"Lights"}),formatter:"rownum",headerSort:!1,hozAlign:di,width:55},{title:"Court Name",field:"courtName",editor:!0},{title:"Scheduled Time",field:"scheduledTime"},{title:"Unscheduled Time",field:"unscheduledTime"},{title:"In/Out",field:"indoorOutdoor"},{title:"Surface",field:"surfaceType"},{title:'<i class="fa-regular fa-lightbulb"></i>',formatter:t,headerTooltip:"Lights",field:"floodlit",width:50},{cellClick:e,formatter:Vv,responsive:!1,headerSort:!1,hozAlign:ti,width:50}]}function ipt(t){const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em";const n=[{label:"Delete selected",intent:"is-danger",stateChange:!0,location:ba},{label:"Add courts",location:ti,align:ti}];e.appendChild(i);const r="1px solid #333",a=document.createElement("div");a.style.backgroundColor="white",a.style.border=r,a.style.width="99%",e.className=qF,e.style.display=Rt,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=r,e.style.borderBottom=r,e.appendChild(a),t.getElement().appendChild(e);const s=tpt(),o=new Bs(a,{headerSortElement:wf(["courtName","scheduledTime","unscheduledTime","floodlit","surfaceType","indoorOutdoor"]),data:t.getData().courts,placeholder:"No courts",layout:"fitColumns",index:"courtId",maxHeight:400,columns:s});wo({table:o,target:i,items:n}),o.on("scrollVertical",Nd),o.on("cellEdited",l=>{const u=l.getRow().getData(),c=l.getValue();if(c.length){const d=h=>{h.success?console.log("success",{result:h}):console.log({result:h})},p=[{method:HEe,params:{courtId:u.courtId,modifications:{courtName:c}}}];Wt({methods:p,callback:d})}else console.log("INVALID VALUE")})}const rZ=/[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?)\s*,\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/;function npt(t){const e=t.split("/");if(e[2]==="www.openstreetmap.org"){const i=e.slice(4).join(",");return rZ.test(i)?{latitude:e[4],longitude:e[5]}:{}}return{}}function rpt(t){const n=t.split("/").reduce((s,o)=>o&&o[0]==="@"?o:s,void 0)?.split(","),r=n?.[0].slice(1),a=n?.[1];return{latitude:r,longitude:a}}function apt(t){const e=t.split(",");return rZ.test(t)?{latitude:e[0],longitude:e[1]}:{}}function spt(t){const e=t.split("=");if(e.length>1){const i=e[1].split(","),n=[i[0],i[1]].join(",");return rZ.test(n)?{latitude:i[0],longitude:i[1]}:{}}return{}}var iP={exports:{}};var opt=iP.exports,_ie;function lpt(){return _ie||(_ie=1,(function(t,e){(function(i,n){n(e)})(opt,(function(i){var n="1.9.4";function r(D){var k,V,Y,ie;for(V=1,Y=arguments.length;V<Y;V++){ie=arguments[V];for(k in ie)D[k]=ie[k]}return D}var a=Object.create||(function(){function D(){}return function(k){return D.prototype=k,new D}})();function s(D,k){var V=Array.prototype.slice;if(D.bind)return D.bind.apply(D,V.call(arguments,1));var Y=V.call(arguments,2);return function(){return D.apply(k,Y.length?Y.concat(V.call(arguments)):arguments)}}var o=0;function l(D){return"_leaflet_id"in D||(D._leaflet_id=++o),D._leaflet_id}function u(D,k,V){var Y,ie,me,Pe;return Pe=function(){Y=!1,ie&&(me.apply(V,ie),ie=!1)},me=function(){Y?ie=arguments:(D.apply(V,arguments),setTimeout(Pe,k),Y=!0)},me}function c(D,k,V){var Y=k[1],ie=k[0],me=Y-ie;return D===Y&&V?D:((D-ie)%me+me)%me+ie}function d(){return!1}function p(D,k){if(k===!1)return D;var V=Math.pow(10,k===void 0?6:k);return Math.round(D*V)/V}function h(D){return D.trim?D.trim():D.replace(/^\s+|\s+$/g,"")}function f(D){return h(D).split(/\s+/)}function m(D,k){Object.prototype.hasOwnProperty.call(D,"options")||(D.options=D.options?a(D.options):{});for(var V in k)D.options[V]=k[V];return D.options}function g(D,k,V){var Y=[];for(var ie in D)Y.push(encodeURIComponent(V?ie.toUpperCase():ie)+"="+encodeURIComponent(D[ie]));return(!k||k.indexOf("?")===-1?"?":"&")+Y.join("&")}var v=/\{ *([\w_ -]+) *\}/g;function y(D,k){return D.replace(v,function(V,Y){var ie=k[Y];if(ie===void 0)throw new Error("No value provided for variable "+V);return typeof ie=="function"&&(ie=ie(k)),ie})}var b=Array.isArray||function(D){return Object.prototype.toString.call(D)==="[object Array]"};function I(D,k){for(var V=0;V<D.length;V++)if(D[V]===k)return V;return-1}var S="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function w(D){return window["webkit"+D]||window["moz"+D]||window["ms"+D]}var T=0;function U(D){var k=+new Date,V=Math.max(0,16-(k-T));return T=k+V,window.setTimeout(D,V)}var C=window.requestAnimationFrame||w("RequestAnimationFrame")||U,E=window.cancelAnimationFrame||w("CancelAnimationFrame")||w("CancelRequestAnimationFrame")||function(D){window.clearTimeout(D)};function P(D,k,V){if(V&&C===U)D.call(k);else return C.call(window,s(D,k))}function M(D){D&&E.call(window,D)}var R={__proto__:null,extend:r,create:a,bind:s,get lastId(){return o},stamp:l,throttle:u,wrapNum:c,falseFn:d,formatNum:p,trim:h,splitWords:f,setOptions:m,getParamString:g,template:y,isArray:b,indexOf:I,emptyImageUrl:S,requestFn:C,cancelFn:E,requestAnimFrame:P,cancelAnimFrame:M};function N(){}N.extend=function(D){var k=function(){m(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},V=k.__super__=this.prototype,Y=a(V);Y.constructor=k,k.prototype=Y;for(var ie in this)Object.prototype.hasOwnProperty.call(this,ie)&&ie!=="prototype"&&ie!=="__super__"&&(k[ie]=this[ie]);return D.statics&&r(k,D.statics),D.includes&&(A(D.includes),r.apply(null,[Y].concat(D.includes))),r(Y,D),delete Y.statics,delete Y.includes,Y.options&&(Y.options=V.options?a(V.options):{},r(Y.options,D.options)),Y._initHooks=[],Y.callInitHooks=function(){if(!this._initHooksCalled){V.callInitHooks&&V.callInitHooks.call(this),this._initHooksCalled=!0;for(var me=0,Pe=Y._initHooks.length;me<Pe;me++)Y._initHooks[me].call(this)}},k},N.include=function(D){var k=this.prototype.options;return r(this.prototype,D),D.options&&(this.prototype.options=k,this.mergeOptions(D.options)),this},N.mergeOptions=function(D){return r(this.prototype.options,D),this},N.addInitHook=function(D){var k=Array.prototype.slice.call(arguments,1),V=typeof D=="function"?D:function(){this[D].apply(this,k)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(V),this};function A(D){if(!(typeof L>"u"||!L||!L.Mixin)){D=b(D)?D:[D];for(var k=0;k<D.length;k++)D[k]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var _={on:function(D,k,V){if(typeof D=="object")for(var Y in D)this._on(Y,D[Y],k);else{D=f(D);for(var ie=0,me=D.length;ie<me;ie++)this._on(D[ie],k,V)}return this},off:function(D,k,V){if(!arguments.length)delete this._events;else if(typeof D=="object")for(var Y in D)this._off(Y,D[Y],k);else{D=f(D);for(var ie=arguments.length===1,me=0,Pe=D.length;me<Pe;me++)ie?this._off(D[me]):this._off(D[me],k,V)}return this},_on:function(D,k,V,Y){if(typeof k!="function"){console.warn("wrong listener type: "+typeof k);return}if(this._listens(D,k,V)===!1){V===this&&(V=void 0);var ie={fn:k,ctx:V};Y&&(ie.once=!0),this._events=this._events||{},this._events[D]=this._events[D]||[],this._events[D].push(ie)}},_off:function(D,k,V){var Y,ie,me;if(this._events&&(Y=this._events[D],!!Y)){if(arguments.length===1){if(this._firingCount)for(ie=0,me=Y.length;ie<me;ie++)Y[ie].fn=d;delete this._events[D];return}if(typeof k!="function"){console.warn("wrong listener type: "+typeof k);return}var Pe=this._listens(D,k,V);if(Pe!==!1){var Ze=Y[Pe];this._firingCount&&(Ze.fn=d,this._events[D]=Y=Y.slice()),Y.splice(Pe,1)}}},fire:function(D,k,V){if(!this.listens(D,V))return this;var Y=r({},k,{type:D,target:this,sourceTarget:k&&k.sourceTarget||this});if(this._events){var ie=this._events[D];if(ie){this._firingCount=this._firingCount+1||1;for(var me=0,Pe=ie.length;me<Pe;me++){var Ze=ie[me],tt=Ze.fn;Ze.once&&this.off(D,tt,Ze.ctx),tt.call(Ze.ctx||this,Y)}this._firingCount--}}return V&&this._propagateEvent(Y),this},listens:function(D,k,V,Y){typeof D!="string"&&console.warn('"string" type argument expected');var ie=k;typeof k!="function"&&(Y=!!k,ie=void 0,V=void 0);var me=this._events&&this._events[D];if(me&&me.length&&this._listens(D,ie,V)!==!1)return!0;if(Y){for(var Pe in this._eventParents)if(this._eventParents[Pe].listens(D,k,V,Y))return!0}return!1},_listens:function(D,k,V){if(!this._events)return!1;var Y=this._events[D]||[];if(!k)return!!Y.length;V===this&&(V=void 0);for(var ie=0,me=Y.length;ie<me;ie++)if(Y[ie].fn===k&&Y[ie].ctx===V)return ie;return!1},once:function(D,k,V){if(typeof D=="object")for(var Y in D)this._on(Y,D[Y],k,!0);else{D=f(D);for(var ie=0,me=D.length;ie<me;ie++)this._on(D[ie],k,V,!0)}return this},addEventParent:function(D){return this._eventParents=this._eventParents||{},this._eventParents[l(D)]=D,this},removeEventParent:function(D){return this._eventParents&&delete this._eventParents[l(D)],this},_propagateEvent:function(D){for(var k in this._eventParents)this._eventParents[k].fire(D.type,r({layer:D.target,propagatedFrom:D.target},D),!0)}};_.addEventListener=_.on,_.removeEventListener=_.clearAllEventListeners=_.off,_.addOneTimeEventListener=_.once,_.fireEvent=_.fire,_.hasEventListeners=_.listens;var x=N.extend(_);function O(D,k,V){this.x=V?Math.round(D):D,this.y=V?Math.round(k):k}var $=Math.trunc||function(D){return D>0?Math.floor(D):Math.ceil(D)};O.prototype={clone:function(){return new O(this.x,this.y)},add:function(D){return this.clone()._add(F(D))},_add:function(D){return this.x+=D.x,this.y+=D.y,this},subtract:function(D){return this.clone()._subtract(F(D))},_subtract:function(D){return this.x-=D.x,this.y-=D.y,this},divideBy:function(D){return this.clone()._divideBy(D)},_divideBy:function(D){return this.x/=D,this.y/=D,this},multiplyBy:function(D){return this.clone()._multiplyBy(D)},_multiplyBy:function(D){return this.x*=D,this.y*=D,this},scaleBy:function(D){return new O(this.x*D.x,this.y*D.y)},unscaleBy:function(D){return new O(this.x/D.x,this.y/D.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=$(this.x),this.y=$(this.y),this},distanceTo:function(D){D=F(D);var k=D.x-this.x,V=D.y-this.y;return Math.sqrt(k*k+V*V)},equals:function(D){return D=F(D),D.x===this.x&&D.y===this.y},contains:function(D){return D=F(D),Math.abs(D.x)<=Math.abs(this.x)&&Math.abs(D.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}};function F(D,k,V){return D instanceof O?D:b(D)?new O(D[0],D[1]):D==null?D:typeof D=="object"&&"x"in D&&"y"in D?new O(D.x,D.y):new O(D,k,V)}function j(D,k){if(D)for(var V=k?[D,k]:D,Y=0,ie=V.length;Y<ie;Y++)this.extend(V[Y])}j.prototype={extend:function(D){var k,V;if(!D)return this;if(D instanceof O||typeof D[0]=="number"||"x"in D)k=V=F(D);else if(D=H(D),k=D.min,V=D.max,!k||!V)return this;return!this.min&&!this.max?(this.min=k.clone(),this.max=V.clone()):(this.min.x=Math.min(k.x,this.min.x),this.max.x=Math.max(V.x,this.max.x),this.min.y=Math.min(k.y,this.min.y),this.max.y=Math.max(V.y,this.max.y)),this},getCenter:function(D){return F((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,D)},getBottomLeft:function(){return F(this.min.x,this.max.y)},getTopRight:function(){return F(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(D){var k,V;return typeof D[0]=="number"||D instanceof O?D=F(D):D=H(D),D instanceof j?(k=D.min,V=D.max):k=V=D,k.x>=this.min.x&&V.x<=this.max.x&&k.y>=this.min.y&&V.y<=this.max.y},intersects:function(D){D=H(D);var k=this.min,V=this.max,Y=D.min,ie=D.max,me=ie.x>=k.x&&Y.x<=V.x,Pe=ie.y>=k.y&&Y.y<=V.y;return me&&Pe},overlaps:function(D){D=H(D);var k=this.min,V=this.max,Y=D.min,ie=D.max,me=ie.x>k.x&&Y.x<V.x,Pe=ie.y>k.y&&Y.y<V.y;return me&&Pe},isValid:function(){return!!(this.min&&this.max)},pad:function(D){var k=this.min,V=this.max,Y=Math.abs(k.x-V.x)*D,ie=Math.abs(k.y-V.y)*D;return H(F(k.x-Y,k.y-ie),F(V.x+Y,V.y+ie))},equals:function(D){return D?(D=H(D),this.min.equals(D.getTopLeft())&&this.max.equals(D.getBottomRight())):!1}};function H(D,k){return!D||D instanceof j?D:new j(D,k)}function G(D,k){if(D)for(var V=k?[D,k]:D,Y=0,ie=V.length;Y<ie;Y++)this.extend(V[Y])}G.prototype={extend:function(D){var k=this._southWest,V=this._northEast,Y,ie;if(D instanceof q)Y=D,ie=D;else if(D instanceof G){if(Y=D._southWest,ie=D._northEast,!Y||!ie)return this}else return D?this.extend(Z(D)||W(D)):this;return!k&&!V?(this._southWest=new q(Y.lat,Y.lng),this._northEast=new q(ie.lat,ie.lng)):(k.lat=Math.min(Y.lat,k.lat),k.lng=Math.min(Y.lng,k.lng),V.lat=Math.max(ie.lat,V.lat),V.lng=Math.max(ie.lng,V.lng)),this},pad:function(D){var k=this._southWest,V=this._northEast,Y=Math.abs(k.lat-V.lat)*D,ie=Math.abs(k.lng-V.lng)*D;return new G(new q(k.lat-Y,k.lng-ie),new q(V.lat+Y,V.lng+ie))},getCenter:function(){return new q((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new q(this.getNorth(),this.getWest())},getSouthEast:function(){return new q(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(D){typeof D[0]=="number"||D instanceof q||"lat"in D?D=Z(D):D=W(D);var k=this._southWest,V=this._northEast,Y,ie;return D instanceof G?(Y=D.getSouthWest(),ie=D.getNorthEast()):Y=ie=D,Y.lat>=k.lat&&ie.lat<=V.lat&&Y.lng>=k.lng&&ie.lng<=V.lng},intersects:function(D){D=W(D);var k=this._southWest,V=this._northEast,Y=D.getSouthWest(),ie=D.getNorthEast(),me=ie.lat>=k.lat&&Y.lat<=V.lat,Pe=ie.lng>=k.lng&&Y.lng<=V.lng;return me&&Pe},overlaps:function(D){D=W(D);var k=this._southWest,V=this._northEast,Y=D.getSouthWest(),ie=D.getNorthEast(),me=ie.lat>k.lat&&Y.lat<V.lat,Pe=ie.lng>k.lng&&Y.lng<V.lng;return me&&Pe},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(D,k){return D?(D=W(D),this._southWest.equals(D.getSouthWest(),k)&&this._northEast.equals(D.getNorthEast(),k)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function W(D,k){return D instanceof G?D:new G(D,k)}function q(D,k,V){if(isNaN(D)||isNaN(k))throw new Error("Invalid LatLng object: ("+D+", "+k+")");this.lat=+D,this.lng=+k,V!==void 0&&(this.alt=+V)}q.prototype={equals:function(D,k){if(!D)return!1;D=Z(D);var V=Math.max(Math.abs(this.lat-D.lat),Math.abs(this.lng-D.lng));return V<=(k===void 0?1e-9:k)},toString:function(D){return"LatLng("+p(this.lat,D)+", "+p(this.lng,D)+")"},distanceTo:function(D){return Q.distance(this,Z(D))},wrap:function(){return Q.wrapLatLng(this)},toBounds:function(D){var k=180*D/40075017,V=k/Math.cos(Math.PI/180*this.lat);return W([this.lat-k,this.lng-V],[this.lat+k,this.lng+V])},clone:function(){return new q(this.lat,this.lng,this.alt)}};function Z(D,k,V){return D instanceof q?D:b(D)&&typeof D[0]!="object"?D.length===3?new q(D[0],D[1],D[2]):D.length===2?new q(D[0],D[1]):null:D==null?D:typeof D=="object"&&"lat"in D?new q(D.lat,"lng"in D?D.lng:D.lon,D.alt):k===void 0?null:new q(D,k,V)}var K={latLngToPoint:function(D,k){var V=this.projection.project(D),Y=this.scale(k);return this.transformation._transform(V,Y)},pointToLatLng:function(D,k){var V=this.scale(k),Y=this.transformation.untransform(D,V);return this.projection.unproject(Y)},project:function(D){return this.projection.project(D)},unproject:function(D){return this.projection.unproject(D)},scale:function(D){return 256*Math.pow(2,D)},zoom:function(D){return Math.log(D/256)/Math.LN2},getProjectedBounds:function(D){if(this.infinite)return null;var k=this.projection.bounds,V=this.scale(D),Y=this.transformation.transform(k.min,V),ie=this.transformation.transform(k.max,V);return new j(Y,ie)},infinite:!1,wrapLatLng:function(D){var k=this.wrapLng?c(D.lng,this.wrapLng,!0):D.lng,V=this.wrapLat?c(D.lat,this.wrapLat,!0):D.lat,Y=D.alt;return new q(V,k,Y)},wrapLatLngBounds:function(D){var k=D.getCenter(),V=this.wrapLatLng(k),Y=k.lat-V.lat,ie=k.lng-V.lng;if(Y===0&&ie===0)return D;var me=D.getSouthWest(),Pe=D.getNorthEast(),Ze=new q(me.lat-Y,me.lng-ie),tt=new q(Pe.lat-Y,Pe.lng-ie);return new G(Ze,tt)}},Q=r({},K,{wrapLng:[-180,180],R:6371e3,distance:function(D,k){var V=Math.PI/180,Y=D.lat*V,ie=k.lat*V,me=Math.sin((k.lat-D.lat)*V/2),Pe=Math.sin((k.lng-D.lng)*V/2),Ze=me*me+Math.cos(Y)*Math.cos(ie)*Pe*Pe,tt=2*Math.atan2(Math.sqrt(Ze),Math.sqrt(1-Ze));return this.R*tt}}),J=6378137,ne={R:J,MAX_LATITUDE:85.0511287798,project:function(D){var k=Math.PI/180,V=this.MAX_LATITUDE,Y=Math.max(Math.min(V,D.lat),-V),ie=Math.sin(Y*k);return new O(this.R*D.lng*k,this.R*Math.log((1+ie)/(1-ie))/2)},unproject:function(D){var k=180/Math.PI;return new q((2*Math.atan(Math.exp(D.y/this.R))-Math.PI/2)*k,D.x*k/this.R)},bounds:(function(){var D=J*Math.PI;return new j([-D,-D],[D,D])})()};function re(D,k,V,Y){if(b(D)){this._a=D[0],this._b=D[1],this._c=D[2],this._d=D[3];return}this._a=D,this._b=k,this._c=V,this._d=Y}re.prototype={transform:function(D,k){return this._transform(D.clone(),k)},_transform:function(D,k){return k=k||1,D.x=k*(this._a*D.x+this._b),D.y=k*(this._c*D.y+this._d),D},untransform:function(D,k){return k=k||1,new O((D.x/k-this._b)/this._a,(D.y/k-this._d)/this._c)}};function oe(D,k,V,Y){return new re(D,k,V,Y)}var de=r({},Q,{code:"EPSG:3857",projection:ne,transformation:(function(){var D=.5/(Math.PI*ne.R);return oe(D,.5,-D,.5)})()}),se=r({},de,{code:"EPSG:900913"});function ge(D){return document.createElementNS("http://www.w3.org/2000/svg",D)}function ye(D,k){var V="",Y,ie,me,Pe,Ze,tt;for(Y=0,me=D.length;Y<me;Y++){for(Ze=D[Y],ie=0,Pe=Ze.length;ie<Pe;ie++)tt=Ze[ie],V+=(ie?"L":"M")+tt.x+" "+tt.y;V+=k?kt.svg?"z":"x":""}return V||"M0 0"}var Te=document.documentElement.style,De="ActiveXObject"in window,xe=De&&!document.addEventListener,Me="msLaunchUri"in navigator&&!("documentMode"in document),Oe=hn("webkit"),at=hn("android"),Fe=hn("android 2")||hn("android 3"),mt=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Xe=at&&hn("Google")&&mt<537&&!("AudioNode"in window),gt=!!window.opera,ht=!Me&&hn("chrome"),_e=hn("gecko")&&!Oe&&!gt&&!De,Ye=!ht&&hn("safari"),Je=hn("phantom"),ct="OTransition"in Te,pt=navigator.platform.indexOf("Win")===0,Se=De&&"transition"in Te,he="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Fe,we="MozPerspective"in Te,be=!window.L_DISABLE_3D&&(Se||he||we)&&!ct&&!Je,Ae=typeof orientation<"u"||hn("mobile"),ze=Ae&&Oe,We=Ae&&he,Le=!window.PointerEvent&&window.MSPointerEvent,ft=!!(window.PointerEvent||Le),rt="ontouchstart"in window||!!window.TouchEvent,St=!window.L_NO_TOUCH&&(rt||ft),si=Ae&&gt,Qe=Ae&&_e,bt=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,ci=(function(){var D=!1;try{var k=Object.defineProperty({},"passive",{get:function(){D=!0}});window.addEventListener("testPassiveEventSupport",d,k),window.removeEventListener("testPassiveEventSupport",d,k)}catch{}return D})(),Tt=(function(){return!!document.createElement("canvas").getContext})(),Li=!!(document.createElementNS&&ge("svg").createSVGRect),Jt=!!Li&&(function(){var D=document.createElement("div");return D.innerHTML="<svg/>",(D.firstChild&&D.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),Yi=!Li&&(function(){try{var D=document.createElement("div");D.innerHTML='<v:shape adj="1"/>';var k=D.firstChild;return k.style.behavior="url(#default#VML)",k&&typeof k.adj=="object"}catch{return!1}})(),Ri=navigator.platform.indexOf("Mac")===0,qi=navigator.platform.indexOf("Linux")===0;function hn(D){return navigator.userAgent.toLowerCase().indexOf(D)>=0}var kt={ie:De,ielt9:xe,edge:Me,webkit:Oe,android:at,android23:Fe,androidStock:Xe,opera:gt,chrome:ht,gecko:_e,safari:Ye,phantom:Je,opera12:ct,win:pt,ie3d:Se,webkit3d:he,gecko3d:we,any3d:be,mobile:Ae,mobileWebkit:ze,mobileWebkit3d:We,msPointer:Le,pointer:ft,touch:St,touchNative:rt,mobileOpera:si,mobileGecko:Qe,retina:bt,passiveEvents:ci,canvas:Tt,svg:Li,vml:Yi,inlineSvg:Jt,mac:Ri,linux:qi},fi=kt.msPointer?"MSPointerDown":"pointerdown",Xr=kt.msPointer?"MSPointerMove":"pointermove",Jr=kt.msPointer?"MSPointerUp":"pointerup",Qr=kt.msPointer?"MSPointerCancel":"pointercancel",Lr={touchstart:fi,touchmove:Xr,touchend:Jr,touchcancel:Qr},Ua={touchstart:pl,touchmove:zo,touchend:zo,touchcancel:zo},lr={},Cu=!1;function zl(D,k,V){return k==="touchstart"&&Gr(),Ua[k]?(V=Ua[k].bind(this,V),D.addEventListener(Lr[k],V,!1),V):(console.warn("wrong event specified:",k),d)}function Cf(D,k,V){if(!Lr[k]){console.warn("wrong event specified:",k);return}D.removeEventListener(Lr[k],V,!1)}function Ru(D){lr[D.pointerId]=D}function ch(D){lr[D.pointerId]&&(lr[D.pointerId]=D)}function fa(D){delete lr[D.pointerId]}function Gr(){Cu||(document.addEventListener(fi,Ru,!0),document.addEventListener(Xr,ch,!0),document.addEventListener(Jr,fa,!0),document.addEventListener(Qr,fa,!0),Cu=!0)}function zo(D,k){if(k.pointerType!==(k.MSPOINTER_TYPE_MOUSE||"mouse")){k.touches=[];for(var V in lr)k.touches.push(lr[V]);k.changedTouches=[k],D(k)}}function pl(D,k){k.MSPOINTER_TYPE_TOUCH&&k.pointerType===k.MSPOINTER_TYPE_TOUCH&&La(k),zo(D,k)}function Rf(D){var k={},V,Y;for(Y in D)V=D[Y],k[Y]=V&&V.bind?V.bind(D):V;return D=k,k.type="dblclick",k.detail=2,k.isTrusted=!1,k._simulated=!0,k}var ql=200;function Wl(D,k){D.addEventListener("dblclick",k);var V=0,Y;function ie(me){if(me.detail!==1){Y=me.detail;return}if(!(me.pointerType==="mouse"||me.sourceCapabilities&&!me.sourceCapabilities.firesTouchEvents)){var Pe=ee(me);if(!(Pe.some(function(tt){return tt instanceof HTMLLabelElement&&tt.attributes.for})&&!Pe.some(function(tt){return tt instanceof HTMLInputElement||tt instanceof HTMLSelectElement}))){var Ze=Date.now();Ze-V<=ql?(Y++,Y===2&&k(Rf(me))):Y=1,V=Ze}}}return D.addEventListener("click",ie),{dblclick:k,simDblclick:ie}}function ep(D,k){D.removeEventListener("dblclick",k.dblclick),D.removeEventListener("click",k.simDblclick)}var Yl=st(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ma=st(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),fc=ma==="webkitTransition"||ma==="OTransition"?ma+"End":"transitionend";function mc(D){return typeof D=="string"?document.getElementById(D):D}function Mu(D,k){var V=D.style[k]||D.currentStyle&&D.currentStyle[k];if((!V||V==="auto")&&document.defaultView){var Y=document.defaultView.getComputedStyle(D,null);V=Y?Y[k]:null}return V==="auto"?null:V}function Qt(D,k,V){var Y=document.createElement(D);return Y.className=k||"",V&&V.appendChild(Y),Y}function Mr(D){var k=D.parentNode;k&&k.removeChild(D)}function hl(D){for(;D.firstChild;)D.removeChild(D.firstChild)}function cs(D){var k=D.parentNode;k&&k.lastChild!==D&&k.appendChild(D)}function io(D){var k=D.parentNode;k&&k.firstChild!==D&&k.insertBefore(D,k.firstChild)}function Rs(D,k){if(D.classList!==void 0)return D.classList.contains(k);var V=Kl(D);return V.length>0&&new RegExp("(^|\\s)"+k+"(\\s|$)").test(V)}function Bi(D,k){if(D.classList!==void 0)for(var V=f(k),Y=0,ie=V.length;Y<ie;Y++)D.classList.add(V[Y]);else if(!Rs(D,k)){var me=Kl(D);rr(D,(me?me+" ":"")+k)}}function vr(D,k){D.classList!==void 0?D.classList.remove(k):rr(D,h((" "+Kl(D)+" ").replace(" "+k+" "," ")))}function rr(D,k){D.className.baseVal===void 0?D.className=k:D.className.baseVal=k}function Kl(D){return D.correspondingElement&&(D=D.correspondingElement),D.className.baseVal===void 0?D.className:D.className.baseVal}function es(D,k){"opacity"in D.style?D.style.opacity=k:"filter"in D.style&&Id(D,k)}function Id(D,k){var V=!1,Y="DXImageTransform.Microsoft.Alpha";try{V=D.filters.item(Y)}catch{if(k===1)return}k=Math.round(k*100),V?(V.Enabled=k!==100,V.Opacity=k):D.style.filter+=" progid:"+Y+"(opacity="+k+")"}function st(D){for(var k=document.documentElement.style,V=0;V<D.length;V++)if(D[V]in k)return D[V];return!1}function mi(D,k,V){var Y=k||new O(0,0);D.style[Yl]=(kt.ie3d?"translate("+Y.x+"px,"+Y.y+"px)":"translate3d("+Y.x+"px,"+Y.y+"px,0)")+(V?" scale("+V+")":"")}function xi(D,k){D._leaflet_pos=k,kt.any3d?mi(D,k):(D.style.left=k.x+"px",D.style.top=k.y+"px")}function Oi(D){return D._leaflet_pos||new O(0,0)}var yr,Oa,Nu;if("onselectstart"in document)yr=function(){oi(window,"selectstart",La)},Oa=function(){jn(window,"selectstart",La)};else{var Pn=st(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);yr=function(){if(Pn){var D=document.documentElement.style;Nu=D[Pn],D[Pn]="none"}},Oa=function(){Pn&&(document.documentElement.style[Pn]=Nu,Nu=void 0)}}function fl(){oi(window,"dragstart",La)}function cg(){jn(window,"dragstart",La)}var Mf,Ws;function gc(D){for(;D.tabIndex===-1;)D=D.parentNode;D.style&&(vc(),Mf=D,Ws=D.style.outlineStyle,D.style.outlineStyle="none",oi(window,"keydown",vc))}function vc(){Mf&&(Mf.style.outlineStyle=Ws,Mf=void 0,Ws=void 0,jn(window,"keydown",vc))}function ga(D){do D=D.parentNode;while((!D.offsetWidth||!D.offsetHeight)&&D!==document.body);return D}function dh(D){var k=D.getBoundingClientRect();return{x:k.width/D.offsetWidth||1,y:k.height/D.offsetHeight||1,boundingClientRect:k}}var dg={__proto__:null,TRANSFORM:Yl,TRANSITION:ma,TRANSITION_END:fc,get:mc,getStyle:Mu,create:Qt,remove:Mr,empty:hl,toFront:cs,toBack:io,hasClass:Rs,addClass:Bi,removeClass:vr,setClass:rr,getClass:Kl,setOpacity:es,testProp:st,setTransform:mi,setPosition:xi,getPosition:Oi,get disableTextSelection(){return yr},get enableTextSelection(){return Oa},disableImageDrag:fl,enableImageDrag:cg,preventOutline:gc,restoreOutline:vc,getSizedParentNode:ga,getScale:dh};function oi(D,k,V,Y){if(k&&typeof k=="object")for(var ie in k)qo(D,ie,k[ie],V);else{k=f(k);for(var me=0,Pe=k.length;me<Pe;me++)qo(D,k[me],V,Y)}return this}var va="_leaflet_events";function jn(D,k,V,Y){if(arguments.length===1)tp(D),delete D[va];else if(k&&typeof k=="object")for(var ie in k)Nf(D,ie,k[ie],V);else if(k=f(k),arguments.length===2)tp(D,function(Ze){return I(k,Ze)!==-1});else for(var me=0,Pe=k.length;me<Pe;me++)Nf(D,k[me],V,Y);return this}function tp(D,k){for(var V in D[va]){var Y=V.split(/\d/)[0];(!k||k(Y))&&Nf(D,Y,null,null,V)}}var ip={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function qo(D,k,V,Y){var ie=k+l(V)+(Y?"_"+l(Y):"");if(D[va]&&D[va][ie])return this;var me=function(Ze){return V.call(Y||D,Ze||window.event)},Pe=me;!kt.touchNative&&kt.pointer&&k.indexOf("touch")===0?me=zl(D,k,me):kt.touch&&k==="dblclick"?me=Wl(D,me):"addEventListener"in D?k==="touchstart"||k==="touchmove"||k==="wheel"||k==="mousewheel"?D.addEventListener(ip[k]||k,me,kt.passiveEvents?{passive:!1}:!1):k==="mouseenter"||k==="mouseleave"?(me=function(Ze){Ze=Ze||window.event,en(D,Ze)&&Pe(Ze)},D.addEventListener(ip[k],me,!1)):D.addEventListener(k,Pe,!1):D.attachEvent("on"+k,me),D[va]=D[va]||{},D[va][ie]=me}function Nf(D,k,V,Y,ie){ie=ie||k+l(V)+(Y?"_"+l(Y):"");var me=D[va]&&D[va][ie];if(!me)return this;!kt.touchNative&&kt.pointer&&k.indexOf("touch")===0?Cf(D,k,me):kt.touch&&k==="dblclick"?ep(D,me):"removeEventListener"in D?D.removeEventListener(ip[k]||k,me,!1):D.detachEvent("on"+k,me),D[va][ie]=null}function Hr(D){return D.stopPropagation?D.stopPropagation():D.originalEvent?D.originalEvent._stopped=!0:D.cancelBubble=!0,this}function np(D){return qo(D,"wheel",Hr),this}function yc(D){return oi(D,"mousedown touchstart dblclick contextmenu",Hr),D._leaflet_disable_click=!0,this}function La(D){return D.preventDefault?D.preventDefault():D.returnValue=!1,this}function ml(D){return La(D),Hr(D),this}function ee(D){if(D.composedPath)return D.composedPath();for(var k=[],V=D.target;V;)k.push(V),V=V.parentNode;return k}function ve(D,k){if(!k)return new O(D.clientX,D.clientY);var V=dh(k),Y=V.boundingClientRect;return new O((D.clientX-Y.left)/V.x-k.clientLeft,(D.clientY-Y.top)/V.y-k.clientTop)}var Ne=kt.linux&&kt.chrome?window.devicePixelRatio:kt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function ut(D){return kt.edge?D.wheelDeltaY/2:D.deltaY&&D.deltaMode===0?-D.deltaY/Ne:D.deltaY&&D.deltaMode===1?-D.deltaY*20:D.deltaY&&D.deltaMode===2?-D.deltaY*60:D.deltaX||D.deltaZ?0:D.wheelDelta?(D.wheelDeltaY||D.wheelDelta)/2:D.detail&&Math.abs(D.detail)<32765?-D.detail*20:D.detail?D.detail/-32765*60:0}function en(D,k){var V=k.relatedTarget;if(!V)return!0;try{for(;V&&V!==D;)V=V.parentNode}catch{return!1}return V!==D}var Di={__proto__:null,on:oi,off:jn,stopPropagation:Hr,disableScrollPropagation:np,disableClickPropagation:yc,preventDefault:La,stop:ml,getPropagationPath:ee,getMousePosition:ve,getWheelDelta:ut,isExternalTarget:en,addListener:oi,removeListener:jn},$n=x.extend({run:function(D,k,V,Y){this.stop(),this._el=D,this._inProgress=!0,this._duration=V||.25,this._easeOutPower=1/Math.max(Y||.5,.2),this._startPos=Oi(D),this._offset=k.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=P(this._animate,this),this._step()},_step:function(D){var k=+new Date-this._startTime,V=this._duration*1e3;k<V?this._runFrame(this._easeOut(k/V),D):(this._runFrame(1),this._complete())},_runFrame:function(D,k){var V=this._startPos.add(this._offset.multiplyBy(D));k&&V._round(),xi(this._el,V),this.fire("step")},_complete:function(){M(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(D){return 1-Math.pow(1-D,this._easeOutPower)}}),ei=x.extend({options:{crs:de,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(D,k){k=m(this,k),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(D),this._initLayout(),this._onResize=s(this._onResize,this),this._initEvents(),k.maxBounds&&this.setMaxBounds(k.maxBounds),k.zoom!==void 0&&(this._zoom=this._limitZoom(k.zoom)),k.center&&k.zoom!==void 0&&this.setView(Z(k.center),k.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ma&&kt.any3d&&!kt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),oi(this._proxy,fc,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(D,k,V){if(k=k===void 0?this._zoom:this._limitZoom(k),D=this._limitCenter(Z(D),k,this.options.maxBounds),V=V||{},this._stop(),this._loaded&&!V.reset&&V!==!0){V.animate!==void 0&&(V.zoom=r({animate:V.animate},V.zoom),V.pan=r({animate:V.animate,duration:V.duration},V.pan));var Y=this._zoom!==k?this._tryAnimatedZoom&&this._tryAnimatedZoom(D,k,V.zoom):this._tryAnimatedPan(D,V.pan);if(Y)return clearTimeout(this._sizeTimer),this}return this._resetView(D,k,V.pan&&V.pan.noMoveStart),this},setZoom:function(D,k){return this._loaded?this.setView(this.getCenter(),D,{zoom:k}):(this._zoom=D,this)},zoomIn:function(D,k){return D=D||(kt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+D,k)},zoomOut:function(D,k){return D=D||(kt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-D,k)},setZoomAround:function(D,k,V){var Y=this.getZoomScale(k),ie=this.getSize().divideBy(2),me=D instanceof O?D:this.latLngToContainerPoint(D),Pe=me.subtract(ie).multiplyBy(1-1/Y),Ze=this.containerPointToLatLng(ie.add(Pe));return this.setView(Ze,k,{zoom:V})},_getBoundsCenterZoom:function(D,k){k=k||{},D=D.getBounds?D.getBounds():W(D);var V=F(k.paddingTopLeft||k.padding||[0,0]),Y=F(k.paddingBottomRight||k.padding||[0,0]),ie=this.getBoundsZoom(D,!1,V.add(Y));if(ie=typeof k.maxZoom=="number"?Math.min(k.maxZoom,ie):ie,ie===1/0)return{center:D.getCenter(),zoom:ie};var me=Y.subtract(V).divideBy(2),Pe=this.project(D.getSouthWest(),ie),Ze=this.project(D.getNorthEast(),ie),tt=this.unproject(Pe.add(Ze).divideBy(2).add(me),ie);return{center:tt,zoom:ie}},fitBounds:function(D,k){if(D=W(D),!D.isValid())throw new Error("Bounds are not valid.");var V=this._getBoundsCenterZoom(D,k);return this.setView(V.center,V.zoom,k)},fitWorld:function(D){return this.fitBounds([[-90,-180],[90,180]],D)},panTo:function(D,k){return this.setView(D,this._zoom,{pan:k})},panBy:function(D,k){if(D=F(D).round(),k=k||{},!D.x&&!D.y)return this.fire("moveend");if(k.animate!==!0&&!this.getSize().contains(D))return this._resetView(this.unproject(this.project(this.getCenter()).add(D)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new $n,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),k.noMoveStart||this.fire("movestart"),k.animate!==!1){Bi(this._mapPane,"leaflet-pan-anim");var V=this._getMapPanePos().subtract(D).round();this._panAnim.run(this._mapPane,V,k.duration||.25,k.easeLinearity)}else this._rawPanBy(D),this.fire("move").fire("moveend");return this},flyTo:function(D,k,V){if(V=V||{},V.animate===!1||!kt.any3d)return this.setView(D,k,V);this._stop();var Y=this.project(this.getCenter()),ie=this.project(D),me=this.getSize(),Pe=this._zoom;D=Z(D),k=k===void 0?Pe:k;var Ze=Math.max(me.x,me.y),tt=Ze*this.getZoomScale(Pe,k),Ut=ie.distanceTo(Y)||1,ni=1.42,nn=ni*ni;function Kn(no){var iA=no?-1:1,BNe=no?tt:Ze,VNe=tt*tt-Ze*Ze+iA*nn*nn*Ut*Ut,jNe=2*BNe*nn*Ut,Z2=VNe/jNe,aX=Math.sqrt(Z2*Z2+1)-Z2,GNe=aX<1e-9?-18:Math.log(aX);return GNe}function Au(no){return(Math.exp(no)-Math.exp(-no))/2}function Zo(no){return(Math.exp(no)+Math.exp(-no))/2}function op(no){return Au(no)/Zo(no)}var Tc=Kn(0);function fS(no){return Ze*(Zo(Tc)/Zo(Tc+ni*no))}function ONe(no){return Ze*(Zo(Tc)*op(Tc+ni*no)-Au(Tc))/nn}function LNe(no){return 1-Math.pow(1-no,1.5)}var FNe=Date.now(),nX=(Kn(1)-Tc)/ni,$Ne=V.duration?1e3*V.duration:1e3*nX*.8;function rX(){var no=(Date.now()-FNe)/$Ne,iA=LNe(no)*nX;no<=1?(this._flyToFrame=P(rX,this),this._move(this.unproject(Y.add(ie.subtract(Y).multiplyBy(ONe(iA)/Ut)),Pe),this.getScaleZoom(Ze/fS(iA),Pe),{flyTo:!0})):this._move(D,k)._moveEnd(!0)}return this._moveStart(!0,V.noMoveStart),rX.call(this),this},flyToBounds:function(D,k){var V=this._getBoundsCenterZoom(D,k);return this.flyTo(V.center,V.zoom,k)},setMaxBounds:function(D){return D=W(D),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),D.isValid()?(this.options.maxBounds=D,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(D){var k=this.options.minZoom;return this.options.minZoom=D,this._loaded&&k!==D&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(D):this},setMaxZoom:function(D){var k=this.options.maxZoom;return this.options.maxZoom=D,this._loaded&&k!==D&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(D):this},panInsideBounds:function(D,k){this._enforcingBounds=!0;var V=this.getCenter(),Y=this._limitCenter(V,this._zoom,W(D));return V.equals(Y)||this.panTo(Y,k),this._enforcingBounds=!1,this},panInside:function(D,k){k=k||{};var V=F(k.paddingTopLeft||k.padding||[0,0]),Y=F(k.paddingBottomRight||k.padding||[0,0]),ie=this.project(this.getCenter()),me=this.project(D),Pe=this.getPixelBounds(),Ze=H([Pe.min.add(V),Pe.max.subtract(Y)]),tt=Ze.getSize();if(!Ze.contains(me)){this._enforcingBounds=!0;var Ut=me.subtract(Ze.getCenter()),ni=Ze.extend(me).getSize().subtract(tt);ie.x+=Ut.x<0?-ni.x:ni.x,ie.y+=Ut.y<0?-ni.y:ni.y,this.panTo(this.unproject(ie),k),this._enforcingBounds=!1}return this},invalidateSize:function(D){if(!this._loaded)return this;D=r({animate:!1,pan:!0},D===!0?{animate:!0}:D);var k=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var V=this.getSize(),Y=k.divideBy(2).round(),ie=V.divideBy(2).round(),me=Y.subtract(ie);return!me.x&&!me.y?this:(D.animate&&D.pan?this.panBy(me):(D.pan&&this._rawPanBy(me),this.fire("move"),D.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(s(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:k,newSize:V}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(D){if(D=this._locateOptions=r({timeout:1e4,watch:!1},D),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var k=s(this._handleGeolocationResponse,this),V=s(this._handleGeolocationError,this);return D.watch?this._locationWatchId=navigator.geolocation.watchPosition(k,V,D):navigator.geolocation.getCurrentPosition(k,V,D),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(D){if(this._container._leaflet_id){var k=D.code,V=D.message||(k===1?"permission denied":k===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:k,message:"Geolocation error: "+V+"."})}},_handleGeolocationResponse:function(D){if(this._container._leaflet_id){var k=D.coords.latitude,V=D.coords.longitude,Y=new q(k,V),ie=Y.toBounds(D.coords.accuracy*2),me=this._locateOptions;if(me.setView){var Pe=this.getBoundsZoom(ie);this.setView(Y,me.maxZoom?Math.min(Pe,me.maxZoom):Pe)}var Ze={latlng:Y,bounds:ie,timestamp:D.timestamp};for(var tt in D.coords)typeof D.coords[tt]=="number"&&(Ze[tt]=D.coords[tt]);this.fire("locationfound",Ze)}},addHandler:function(D,k){if(!k)return this;var V=this[D]=new k(this);return this._handlers.push(V),this.options[D]&&V.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Mr(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(M(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var D;for(D in this._layers)this._layers[D].remove();for(D in this._panes)Mr(this._panes[D]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(D,k){var V="leaflet-pane"+(D?" leaflet-"+D.replace("Pane","")+"-pane":""),Y=Qt("div",V,k||this._mapPane);return D&&(this._panes[D]=Y),Y},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var D=this.getPixelBounds(),k=this.unproject(D.getBottomLeft()),V=this.unproject(D.getTopRight());return new G(k,V)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(D,k,V){D=W(D),V=F(V||[0,0]);var Y=this.getZoom()||0,ie=this.getMinZoom(),me=this.getMaxZoom(),Pe=D.getNorthWest(),Ze=D.getSouthEast(),tt=this.getSize().subtract(V),Ut=H(this.project(Ze,Y),this.project(Pe,Y)).getSize(),ni=kt.any3d?this.options.zoomSnap:1,nn=tt.x/Ut.x,Kn=tt.y/Ut.y,Au=k?Math.max(nn,Kn):Math.min(nn,Kn);return Y=this.getScaleZoom(Au,Y),ni&&(Y=Math.round(Y/(ni/100))*(ni/100),Y=k?Math.ceil(Y/ni)*ni:Math.floor(Y/ni)*ni),Math.max(ie,Math.min(me,Y))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new O(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(D,k){var V=this._getTopLeftPoint(D,k);return new j(V,V.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(D){return this.options.crs.getProjectedBounds(D===void 0?this.getZoom():D)},getPane:function(D){return typeof D=="string"?this._panes[D]:D},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(D,k){var V=this.options.crs;return k=k===void 0?this._zoom:k,V.scale(D)/V.scale(k)},getScaleZoom:function(D,k){var V=this.options.crs;k=k===void 0?this._zoom:k;var Y=V.zoom(D*V.scale(k));return isNaN(Y)?1/0:Y},project:function(D,k){return k=k===void 0?this._zoom:k,this.options.crs.latLngToPoint(Z(D),k)},unproject:function(D,k){return k=k===void 0?this._zoom:k,this.options.crs.pointToLatLng(F(D),k)},layerPointToLatLng:function(D){var k=F(D).add(this.getPixelOrigin());return this.unproject(k)},latLngToLayerPoint:function(D){var k=this.project(Z(D))._round();return k._subtract(this.getPixelOrigin())},wrapLatLng:function(D){return this.options.crs.wrapLatLng(Z(D))},wrapLatLngBounds:function(D){return this.options.crs.wrapLatLngBounds(W(D))},distance:function(D,k){return this.options.crs.distance(Z(D),Z(k))},containerPointToLayerPoint:function(D){return F(D).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(D){return F(D).add(this._getMapPanePos())},containerPointToLatLng:function(D){var k=this.containerPointToLayerPoint(F(D));return this.layerPointToLatLng(k)},latLngToContainerPoint:function(D){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Z(D)))},mouseEventToContainerPoint:function(D){return ve(D,this._container)},mouseEventToLayerPoint:function(D){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(D))},mouseEventToLatLng:function(D){return this.layerPointToLatLng(this.mouseEventToLayerPoint(D))},_initContainer:function(D){var k=this._container=mc(D);if(k){if(k._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");oi(k,"scroll",this._onScroll,this),this._containerId=l(k)},_initLayout:function(){var D=this._container;this._fadeAnimated=this.options.fadeAnimation&&kt.any3d,Bi(D,"leaflet-container"+(kt.touch?" leaflet-touch":"")+(kt.retina?" leaflet-retina":"")+(kt.ielt9?" leaflet-oldie":"")+(kt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var k=Mu(D,"position");k!=="absolute"&&k!=="relative"&&k!=="fixed"&&k!=="sticky"&&(D.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var D=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),xi(this._mapPane,new O(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Bi(D.markerPane,"leaflet-zoom-hide"),Bi(D.shadowPane,"leaflet-zoom-hide"))},_resetView:function(D,k,V){xi(this._mapPane,new O(0,0));var Y=!this._loaded;this._loaded=!0,k=this._limitZoom(k),this.fire("viewprereset");var ie=this._zoom!==k;this._moveStart(ie,V)._move(D,k)._moveEnd(ie),this.fire("viewreset"),Y&&this.fire("load")},_moveStart:function(D,k){return D&&this.fire("zoomstart"),k||this.fire("movestart"),this},_move:function(D,k,V,Y){k===void 0&&(k=this._zoom);var ie=this._zoom!==k;return this._zoom=k,this._lastCenter=D,this._pixelOrigin=this._getNewPixelOrigin(D),Y?V&&V.pinch&&this.fire("zoom",V):((ie||V&&V.pinch)&&this.fire("zoom",V),this.fire("move",V)),this},_moveEnd:function(D){return D&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return M(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(D){xi(this._mapPane,this._getMapPanePos().subtract(D))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(D){this._targets={},this._targets[l(this._container)]=this;var k=D?jn:oi;k(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&k(window,"resize",this._onResize,this),kt.any3d&&this.options.transform3DLimit&&(D?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){M(this._resizeRequest),this._resizeRequest=P(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var D=this._getMapPanePos();Math.max(Math.abs(D.x),Math.abs(D.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(D,k){for(var V=[],Y,ie=k==="mouseout"||k==="mouseover",me=D.target||D.srcElement,Pe=!1;me;){if(Y=this._targets[l(me)],Y&&(k==="click"||k==="preclick")&&this._draggableMoved(Y)){Pe=!0;break}if(Y&&Y.listens(k,!0)&&(ie&&!en(me,D)||(V.push(Y),ie))||me===this._container)break;me=me.parentNode}return!V.length&&!Pe&&!ie&&this.listens(k,!0)&&(V=[this]),V},_isClickDisabled:function(D){for(;D&&D!==this._container;){if(D._leaflet_disable_click)return!0;D=D.parentNode}},_handleDOMEvent:function(D){var k=D.target||D.srcElement;if(!(!this._loaded||k._leaflet_disable_events||D.type==="click"&&this._isClickDisabled(k))){var V=D.type;V==="mousedown"&&gc(k),this._fireDOMEvent(D,V)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(D,k,V){if(D.type==="click"){var Y=r({},D);Y.type="preclick",this._fireDOMEvent(Y,Y.type,V)}var ie=this._findEventTargets(D,k);if(V){for(var me=[],Pe=0;Pe<V.length;Pe++)V[Pe].listens(k,!0)&&me.push(V[Pe]);ie=me.concat(ie)}if(ie.length){k==="contextmenu"&&La(D);var Ze=ie[0],tt={originalEvent:D};if(D.type!=="keypress"&&D.type!=="keydown"&&D.type!=="keyup"){var Ut=Ze.getLatLng&&(!Ze._radius||Ze._radius<=10);tt.containerPoint=Ut?this.latLngToContainerPoint(Ze.getLatLng()):this.mouseEventToContainerPoint(D),tt.layerPoint=this.containerPointToLayerPoint(tt.containerPoint),tt.latlng=Ut?Ze.getLatLng():this.layerPointToLatLng(tt.layerPoint)}for(Pe=0;Pe<ie.length;Pe++)if(ie[Pe].fire(k,tt,!0),tt.originalEvent._stopped||ie[Pe].options.bubblingMouseEvents===!1&&I(this._mouseEvents,k)!==-1)return}},_draggableMoved:function(D){return D=D.dragging&&D.dragging.enabled()?D:this,D.dragging&&D.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var D=0,k=this._handlers.length;D<k;D++)this._handlers[D].disable()},whenReady:function(D,k){return this._loaded?D.call(k||this,{target:this}):this.on("load",D,k),this},_getMapPanePos:function(){return Oi(this._mapPane)||new O(0,0)},_moved:function(){var D=this._getMapPanePos();return D&&!D.equals([0,0])},_getTopLeftPoint:function(D,k){var V=D&&k!==void 0?this._getNewPixelOrigin(D,k):this.getPixelOrigin();return V.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(D,k){var V=this.getSize()._divideBy(2);return this.project(D,k)._subtract(V)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(D,k,V){var Y=this._getNewPixelOrigin(V,k);return this.project(D,k)._subtract(Y)},_latLngBoundsToNewLayerBounds:function(D,k,V){var Y=this._getNewPixelOrigin(V,k);return H([this.project(D.getSouthWest(),k)._subtract(Y),this.project(D.getNorthWest(),k)._subtract(Y),this.project(D.getSouthEast(),k)._subtract(Y),this.project(D.getNorthEast(),k)._subtract(Y)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(D){return this.latLngToLayerPoint(D).subtract(this._getCenterLayerPoint())},_limitCenter:function(D,k,V){if(!V)return D;var Y=this.project(D,k),ie=this.getSize().divideBy(2),me=new j(Y.subtract(ie),Y.add(ie)),Pe=this._getBoundsOffset(me,V,k);return Math.abs(Pe.x)<=1&&Math.abs(Pe.y)<=1?D:this.unproject(Y.add(Pe),k)},_limitOffset:function(D,k){if(!k)return D;var V=this.getPixelBounds(),Y=new j(V.min.add(D),V.max.add(D));return D.add(this._getBoundsOffset(Y,k))},_getBoundsOffset:function(D,k,V){var Y=H(this.project(k.getNorthEast(),V),this.project(k.getSouthWest(),V)),ie=Y.min.subtract(D.min),me=Y.max.subtract(D.max),Pe=this._rebound(ie.x,-me.x),Ze=this._rebound(ie.y,-me.y);return new O(Pe,Ze)},_rebound:function(D,k){return D+k>0?Math.round(D-k)/2:Math.max(0,Math.ceil(D))-Math.max(0,Math.floor(k))},_limitZoom:function(D){var k=this.getMinZoom(),V=this.getMaxZoom(),Y=kt.any3d?this.options.zoomSnap:1;return Y&&(D=Math.round(D/Y)*Y),Math.max(k,Math.min(V,D))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){vr(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(D,k){var V=this._getCenterOffset(D)._trunc();return(k&&k.animate)!==!0&&!this.getSize().contains(V)?!1:(this.panBy(V,k),!0)},_createAnimProxy:function(){var D=this._proxy=Qt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(D),this.on("zoomanim",function(k){var V=Yl,Y=this._proxy.style[V];mi(this._proxy,this.project(k.center,k.zoom),this.getZoomScale(k.zoom,1)),Y===this._proxy.style[V]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Mr(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var D=this.getCenter(),k=this.getZoom();mi(this._proxy,this.project(D,k),this.getZoomScale(k,1))},_catchTransitionEnd:function(D){this._animatingZoom&&D.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(D,k,V){if(this._animatingZoom)return!0;if(V=V||{},!this._zoomAnimated||V.animate===!1||this._nothingToAnimate()||Math.abs(k-this._zoom)>this.options.zoomAnimationThreshold)return!1;var Y=this.getZoomScale(k),ie=this._getCenterOffset(D)._divideBy(1-1/Y);return V.animate!==!0&&!this.getSize().contains(ie)?!1:(P(function(){this._moveStart(!0,V.noMoveStart||!1)._animateZoom(D,k,!0)},this),!0)},_animateZoom:function(D,k,V,Y){this._mapPane&&(V&&(this._animatingZoom=!0,this._animateToCenter=D,this._animateToZoom=k,Bi(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:D,zoom:k,noUpdate:Y}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(s(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&vr(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Da(D,k){return new ei(D,k)}var bn=N.extend({options:{position:"topright"},initialize:function(D){m(this,D)},getPosition:function(){return this.options.position},setPosition:function(D){var k=this._map;return k&&k.removeControl(this),this.options.position=D,k&&k.addControl(this),this},getContainer:function(){return this._container},addTo:function(D){this.remove(),this._map=D;var k=this._container=this.onAdd(D),V=this.getPosition(),Y=D._controlCorners[V];return Bi(k,"leaflet-control"),V.indexOf("bottom")!==-1?Y.insertBefore(k,Y.firstChild):Y.appendChild(k),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Mr(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(D){this._map&&D&&D.screenX>0&&D.screenY>0&&this._map.getContainer().focus()}}),ts=function(D){return new bn(D)};ei.include({addControl:function(D){return D.addTo(this),this},removeControl:function(D){return D.remove(),this},_initControlPos:function(){var D=this._controlCorners={},k="leaflet-",V=this._controlContainer=Qt("div",k+"control-container",this._container);function Y(ie,me){var Pe=k+ie+" "+k+me;D[ie+me]=Qt("div",Pe,V)}Y("top","left"),Y("top","right"),Y("bottom","left"),Y("bottom","right")},_clearControlPos:function(){for(var D in this._controlCorners)Mr(this._controlCorners[D]);Mr(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Co=bn.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(D,k,V,Y){return V<Y?-1:Y<V?1:0}},initialize:function(D,k,V){m(this,V),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var Y in D)this._addLayer(D[Y],Y);for(Y in k)this._addLayer(k[Y],Y,!0)},onAdd:function(D){this._initLayout(),this._update(),this._map=D,D.on("zoomend",this._checkDisabledLayers,this);for(var k=0;k<this._layers.length;k++)this._layers[k].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(D){return bn.prototype.addTo.call(this,D),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var D=0;D<this._layers.length;D++)this._layers[D].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(D,k){return this._addLayer(D,k),this._map?this._update():this},addOverlay:function(D,k){return this._addLayer(D,k,!0),this._map?this._update():this},removeLayer:function(D){D.off("add remove",this._onLayerChange,this);var k=this._getLayer(l(D));return k&&this._layers.splice(this._layers.indexOf(k),1),this._map?this._update():this},expand:function(){Bi(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var D=this._map.getSize().y-(this._container.offsetTop+50);return D<this._section.clientHeight?(Bi(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=D+"px"):vr(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return vr(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var D="leaflet-control-layers",k=this._container=Qt("div",D),V=this.options.collapsed;k.setAttribute("aria-haspopup",!0),yc(k),np(k);var Y=this._section=Qt("section",D+"-list");V&&(this._map.on("click",this.collapse,this),oi(k,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var ie=this._layersLink=Qt("a",D+"-toggle",k);ie.href="#",ie.title="Layers",ie.setAttribute("role","button"),oi(ie,{keydown:function(me){me.keyCode===13&&this._expandSafely()},click:function(me){La(me),this._expandSafely()}},this),V||this.expand(),this._baseLayersList=Qt("div",D+"-base",Y),this._separator=Qt("div",D+"-separator",Y),this._overlaysList=Qt("div",D+"-overlays",Y),k.appendChild(Y)},_getLayer:function(D){for(var k=0;k<this._layers.length;k++)if(this._layers[k]&&l(this._layers[k].layer)===D)return this._layers[k]},_addLayer:function(D,k,V){this._map&&D.on("add remove",this._onLayerChange,this),this._layers.push({layer:D,name:k,overlay:V}),this.options.sortLayers&&this._layers.sort(s(function(Y,ie){return this.options.sortFunction(Y.layer,ie.layer,Y.name,ie.name)},this)),this.options.autoZIndex&&D.setZIndex&&(this._lastZIndex++,D.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;hl(this._baseLayersList),hl(this._overlaysList),this._layerControlInputs=[];var D,k,V,Y,ie=0;for(V=0;V<this._layers.length;V++)Y=this._layers[V],this._addItem(Y),k=k||Y.overlay,D=D||!Y.overlay,ie+=Y.overlay?0:1;return this.options.hideSingleBase&&(D=D&&ie>1,this._baseLayersList.style.display=D?"":"none"),this._separator.style.display=k&&D?"":"none",this},_onLayerChange:function(D){this._handlingClick||this._update();var k=this._getLayer(l(D.target)),V=k.overlay?D.type==="add"?"overlayadd":"overlayremove":D.type==="add"?"baselayerchange":null;V&&this._map.fire(V,k)},_createRadioElement:function(D,k){var V='<input type="radio" class="leaflet-control-layers-selector" name="'+D+'"'+(k?' checked="checked"':"")+"/>",Y=document.createElement("div");return Y.innerHTML=V,Y.firstChild},_addItem:function(D){var k=document.createElement("label"),V=this._map.hasLayer(D.layer),Y;D.overlay?(Y=document.createElement("input"),Y.type="checkbox",Y.className="leaflet-control-layers-selector",Y.defaultChecked=V):Y=this._createRadioElement("leaflet-base-layers_"+l(this),V),this._layerControlInputs.push(Y),Y.layerId=l(D.layer),oi(Y,"click",this._onInputClick,this);var ie=document.createElement("span");ie.innerHTML=" "+D.name;var me=document.createElement("span");k.appendChild(me),me.appendChild(Y),me.appendChild(ie);var Pe=D.overlay?this._overlaysList:this._baseLayersList;return Pe.appendChild(k),this._checkDisabledLayers(),k},_onInputClick:function(){if(!this._preventClick){var D=this._layerControlInputs,k,V,Y=[],ie=[];this._handlingClick=!0;for(var me=D.length-1;me>=0;me--)k=D[me],V=this._getLayer(k.layerId).layer,k.checked?Y.push(V):k.checked||ie.push(V);for(me=0;me<ie.length;me++)this._map.hasLayer(ie[me])&&this._map.removeLayer(ie[me]);for(me=0;me<Y.length;me++)this._map.hasLayer(Y[me])||this._map.addLayer(Y[me]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var D=this._layerControlInputs,k,V,Y=this._map.getZoom(),ie=D.length-1;ie>=0;ie--)k=D[ie],V=this._getLayer(k.layerId).layer,k.disabled=V.options.minZoom!==void 0&&Y<V.options.minZoom||V.options.maxZoom!==void 0&&Y>V.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var D=this._section;this._preventClick=!0,oi(D,"click",La),this.expand();var k=this;setTimeout(function(){jn(D,"click",La),k._preventClick=!1})}}),Fa=function(D,k,V){return new Co(D,k,V)},is=bn.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(D){var k="leaflet-control-zoom",V=Qt("div",k+" leaflet-bar"),Y=this.options;return this._zoomInButton=this._createButton(Y.zoomInText,Y.zoomInTitle,k+"-in",V,this._zoomIn),this._zoomOutButton=this._createButton(Y.zoomOutText,Y.zoomOutTitle,k+"-out",V,this._zoomOut),this._updateDisabled(),D.on("zoomend zoomlevelschange",this._updateDisabled,this),V},onRemove:function(D){D.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(D){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(D.shiftKey?3:1))},_zoomOut:function(D){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(D.shiftKey?3:1))},_createButton:function(D,k,V,Y,ie){var me=Qt("a",V,Y);return me.innerHTML=D,me.href="#",me.title=k,me.setAttribute("role","button"),me.setAttribute("aria-label",k),yc(me),oi(me,"click",ml),oi(me,"click",ie,this),oi(me,"click",this._refocusOnMap,this),me},_updateDisabled:function(){var D=this._map,k="leaflet-disabled";vr(this._zoomInButton,k),vr(this._zoomOutButton,k),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||D._zoom===D.getMinZoom())&&(Bi(this._zoomOutButton,k),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||D._zoom===D.getMaxZoom())&&(Bi(this._zoomInButton,k),this._zoomInButton.setAttribute("aria-disabled","true"))}});ei.mergeOptions({zoomControl:!0}),ei.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new is,this.addControl(this.zoomControl))});var Ms=function(D){return new is(D)},Zl=bn.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(D){var k="leaflet-control-scale",V=Qt("div",k),Y=this.options;return this._addScales(Y,k+"-line",V),D.on(Y.updateWhenIdle?"moveend":"move",this._update,this),D.whenReady(this._update,this),V},onRemove:function(D){D.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(D,k,V){D.metric&&(this._mScale=Qt("div",k,V)),D.imperial&&(this._iScale=Qt("div",k,V))},_update:function(){var D=this._map,k=D.getSize().y/2,V=D.distance(D.containerPointToLatLng([0,k]),D.containerPointToLatLng([this.options.maxWidth,k]));this._updateScales(V)},_updateScales:function(D){this.options.metric&&D&&this._updateMetric(D),this.options.imperial&&D&&this._updateImperial(D)},_updateMetric:function(D){var k=this._getRoundNum(D),V=k<1e3?k+" m":k/1e3+" km";this._updateScale(this._mScale,V,k/D)},_updateImperial:function(D){var k=D*3.2808399,V,Y,ie;k>5280?(V=k/5280,Y=this._getRoundNum(V),this._updateScale(this._iScale,Y+" mi",Y/V)):(ie=this._getRoundNum(k),this._updateScale(this._iScale,ie+" ft",ie/k))},_updateScale:function(D,k,V){D.style.width=Math.round(this.options.maxWidth*V)+"px",D.innerHTML=k},_getRoundNum:function(D){var k=Math.pow(10,(Math.floor(D)+"").length-1),V=D/k;return V=V>=10?10:V>=5?5:V>=3?3:V>=2?2:1,k*V}}),Xl=function(D){return new Zl(D)},bc='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',pg=bn.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(kt.inlineSvg?bc+" ":"")+"Leaflet</a>"},initialize:function(D){m(this,D),this._attributions={}},onAdd:function(D){D.attributionControl=this,this._container=Qt("div","leaflet-control-attribution"),yc(this._container);for(var k in D._layers)D._layers[k].getAttribution&&this.addAttribution(D._layers[k].getAttribution());return this._update(),D.on("layeradd",this._addAttribution,this),this._container},onRemove:function(D){D.off("layeradd",this._addAttribution,this)},_addAttribution:function(D){D.layer.getAttribution&&(this.addAttribution(D.layer.getAttribution()),D.layer.once("remove",function(){this.removeAttribution(D.layer.getAttribution())},this))},setPrefix:function(D){return this.options.prefix=D,this._update(),this},addAttribution:function(D){return D?(this._attributions[D]||(this._attributions[D]=0),this._attributions[D]++,this._update(),this):this},removeAttribution:function(D){return D?(this._attributions[D]&&(this._attributions[D]--,this._update()),this):this},_update:function(){if(this._map){var D=[];for(var k in this._attributions)this._attributions[k]&&D.push(k);var V=[];this.options.prefix&&V.push(this.options.prefix),D.length&&V.push(D.join(", ")),this._container.innerHTML=V.join(' <span aria-hidden="true">|</span> ')}}});ei.mergeOptions({attributionControl:!0}),ei.addInitHook(function(){this.options.attributionControl&&new pg().addTo(this)});var Wv=function(D){return new pg(D)};bn.Layers=Co,bn.Zoom=is,bn.Scale=Zl,bn.Attribution=pg,ts.layers=Fa,ts.zoom=Ms,ts.scale=Xl,ts.attribution=Wv;var Ns=N.extend({initialize:function(D){this._map=D},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Ns.addTo=function(D,k){return D.addHandler(k,this),this};var mE={Events:_},cS=kt.touch?"touchstart mousedown":"mousedown",rp=x.extend({options:{clickTolerance:3},initialize:function(D,k,V,Y){m(this,Y),this._element=D,this._dragStartTarget=k||D,this._preventOutline=V},enable:function(){this._enabled||(oi(this._dragStartTarget,cS,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(rp._dragging===this&&this.finishDrag(!0),jn(this._dragStartTarget,cS,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(D){if(this._enabled&&(this._moved=!1,!Rs(this._element,"leaflet-zoom-anim"))){if(D.touches&&D.touches.length!==1){rp._dragging===this&&this.finishDrag();return}if(!(rp._dragging||D.shiftKey||D.which!==1&&D.button!==1&&!D.touches)&&(rp._dragging=this,this._preventOutline&&gc(this._element),fl(),yr(),!this._moving)){this.fire("down");var k=D.touches?D.touches[0]:D,V=ga(this._element);this._startPoint=new O(k.clientX,k.clientY),this._startPos=Oi(this._element),this._parentScale=dh(V);var Y=D.type==="mousedown";oi(document,Y?"mousemove":"touchmove",this._onMove,this),oi(document,Y?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(D){if(this._enabled){if(D.touches&&D.touches.length>1){this._moved=!0;return}var k=D.touches&&D.touches.length===1?D.touches[0]:D,V=new O(k.clientX,k.clientY)._subtract(this._startPoint);!V.x&&!V.y||Math.abs(V.x)+Math.abs(V.y)<this.options.clickTolerance||(V.x/=this._parentScale.x,V.y/=this._parentScale.y,La(D),this._moved||(this.fire("dragstart"),this._moved=!0,Bi(document.body,"leaflet-dragging"),this._lastTarget=D.target||D.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Bi(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(V),this._moving=!0,this._lastEvent=D,this._updatePosition())}},_updatePosition:function(){var D={originalEvent:this._lastEvent};this.fire("predrag",D),xi(this._element,this._newPos),this.fire("drag",D)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(D){vr(document.body,"leaflet-dragging"),this._lastTarget&&(vr(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),jn(document,"mousemove touchmove",this._onMove,this),jn(document,"mouseup touchend touchcancel",this._onUp,this),cg(),Oa();var k=this._moved&&this._moving;this._moving=!1,rp._dragging=!1,k&&this.fire("dragend",{noInertia:D,distance:this._newPos.distanceTo(this._startPos)})}});function dS(D,k,V){var Y,ie=[1,4,2,8],me,Pe,Ze,tt,Ut,ni,nn,Kn;for(me=0,ni=D.length;me<ni;me++)D[me]._code=ap(D[me],k);for(Ze=0;Ze<4;Ze++){for(nn=ie[Ze],Y=[],me=0,ni=D.length,Pe=ni-1;me<ni;Pe=me++)tt=D[me],Ut=D[Pe],tt._code&nn?Ut._code&nn||(Kn=Kv(Ut,tt,nn,k,V),Kn._code=ap(Kn,k),Y.push(Kn)):(Ut._code&nn&&(Kn=Kv(Ut,tt,nn,k,V),Kn._code=ap(Kn,k),Y.push(Kn)),Y.push(tt));D=Y}return D}function Ro(D,k){var V,Y,ie,me,Pe,Ze,tt,Ut,ni;if(!D||D.length===0)throw new Error("latlngs not passed");Ic(D)||(console.warn("latlngs are not flat! Only the first ring will be used"),D=D[0]);var nn=Z([0,0]),Kn=W(D),Au=Kn.getNorthWest().distanceTo(Kn.getSouthWest())*Kn.getNorthEast().distanceTo(Kn.getNorthWest());Au<1700&&(nn=hg(D));var Zo=D.length,op=[];for(V=0;V<Zo;V++){var Tc=Z(D[V]);op.push(k.project(Z([Tc.lat-nn.lat,Tc.lng-nn.lng])))}for(Ze=tt=Ut=0,V=0,Y=Zo-1;V<Zo;Y=V++)ie=op[V],me=op[Y],Pe=ie.y*me.x-me.y*ie.x,tt+=(ie.x+me.x)*Pe,Ut+=(ie.y+me.y)*Pe,Ze+=Pe*3;Ze===0?ni=op[0]:ni=[tt/Ze,Ut/Ze];var fS=k.unproject(F(ni));return Z([fS.lat+nn.lat,fS.lng+nn.lng])}function hg(D){for(var k=0,V=0,Y=0,ie=0;ie<D.length;ie++){var me=Z(D[ie]);k+=me.lat,V+=me.lng,Y++}return Z([k/Y,V/Y])}var nI={__proto__:null,clipPolygon:dS,polygonCenter:Ro,centroid:hg};function gE(D,k){if(!k||!D.length)return D.slice();var V=k*k;return D=vE(D,V),D=KN(D,V),D}function rI(D,k,V){return Math.sqrt(Zv(D,k,V,!0))}function YN(D,k,V){return Zv(D,k,V)}function KN(D,k){var V=D.length,Y=typeof Uint8Array<"u"?Uint8Array:Array,ie=new Y(V);ie[0]=ie[V-1]=1,Yv(D,ie,k,0,V-1);var me,Pe=[];for(me=0;me<V;me++)ie[me]&&Pe.push(D[me]);return Pe}function Yv(D,k,V,Y,ie){var me=0,Pe,Ze,tt;for(Ze=Y+1;Ze<=ie-1;Ze++)tt=Zv(D[Ze],D[Y],D[ie],!0),tt>me&&(Pe=Ze,me=tt);me>V&&(k[Pe]=1,Yv(D,k,V,Y,Pe),Yv(D,k,V,Pe,ie))}function vE(D,k){for(var V=[D[0]],Y=1,ie=0,me=D.length;Y<me;Y++)yE(D[Y],D[ie])>k&&(V.push(D[Y]),ie=Y);return ie<me-1&&V.push(D[me-1]),V}var Af;function pS(D,k,V,Y,ie){var me=Y?Af:ap(D,V),Pe=ap(k,V),Ze,tt,Ut;for(Af=Pe;;){if(!(me|Pe))return[D,k];if(me&Pe)return!1;Ze=me||Pe,tt=Kv(D,k,Ze,V,ie),Ut=ap(tt,V),Ze===me?(D=tt,me=Ut):(k=tt,Pe=Ut)}}function Kv(D,k,V,Y,ie){var me=k.x-D.x,Pe=k.y-D.y,Ze=Y.min,tt=Y.max,Ut,ni;return V&8?(Ut=D.x+me*(tt.y-D.y)/Pe,ni=tt.y):V&4?(Ut=D.x+me*(Ze.y-D.y)/Pe,ni=Ze.y):V&2?(Ut=tt.x,ni=D.y+Pe*(tt.x-D.x)/me):V&1&&(Ut=Ze.x,ni=D.y+Pe*(Ze.x-D.x)/me),new O(Ut,ni,ie)}function ap(D,k){var V=0;return D.x<k.min.x?V|=1:D.x>k.max.x&&(V|=2),D.y<k.min.y?V|=4:D.y>k.max.y&&(V|=8),V}function yE(D,k){var V=k.x-D.x,Y=k.y-D.y;return V*V+Y*Y}function Zv(D,k,V,Y){var ie=k.x,me=k.y,Pe=V.x-ie,Ze=V.y-me,tt=Pe*Pe+Ze*Ze,Ut;return tt>0&&(Ut=((D.x-ie)*Pe+(D.y-me)*Ze)/tt,Ut>1?(ie=V.x,me=V.y):Ut>0&&(ie+=Pe*Ut,me+=Ze*Ut)),Pe=D.x-ie,Ze=D.y-me,Y?Pe*Pe+Ze*Ze:new O(ie,me)}function Ic(D){return!b(D[0])||typeof D[0][0]!="object"&&typeof D[0][0]<"u"}function hS(D){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Ic(D)}function aI(D,k){var V,Y,ie,me,Pe,Ze,tt,Ut;if(!D||D.length===0)throw new Error("latlngs not passed");Ic(D)||(console.warn("latlngs are not flat! Only the first ring will be used"),D=D[0]);var ni=Z([0,0]),nn=W(D),Kn=nn.getNorthWest().distanceTo(nn.getSouthWest())*nn.getNorthEast().distanceTo(nn.getNorthWest());Kn<1700&&(ni=hg(D));var Au=D.length,Zo=[];for(V=0;V<Au;V++){var op=Z(D[V]);Zo.push(k.project(Z([op.lat-ni.lat,op.lng-ni.lng])))}for(V=0,Y=0;V<Au-1;V++)Y+=Zo[V].distanceTo(Zo[V+1])/2;if(Y===0)Ut=Zo[0];else for(V=0,me=0;V<Au-1;V++)if(Pe=Zo[V],Ze=Zo[V+1],ie=Pe.distanceTo(Ze),me+=ie,me>Y){tt=(me-Y)/ie,Ut=[Ze.x-tt*(Ze.x-Pe.x),Ze.y-tt*(Ze.y-Pe.y)];break}var Tc=k.unproject(F(Ut));return Z([Tc.lat+ni.lat,Tc.lng+ni.lng])}var W2={__proto__:null,simplify:gE,pointToSegmentDistance:rI,closestPointOnSegment:YN,clipSegment:pS,_getEdgeIntersection:Kv,_getBitCode:ap,_sqClosestPointOnSegment:Zv,isFlat:Ic,_flat:hS,polylineCenter:aI},sI={project:function(D){return new O(D.lng,D.lat)},unproject:function(D){return new q(D.y,D.x)},bounds:new j([-180,-90],[180,90])},oI={R:6378137,R_MINOR:6356752314245179e-9,bounds:new j([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(D){var k=Math.PI/180,V=this.R,Y=D.lat*k,ie=this.R_MINOR/V,me=Math.sqrt(1-ie*ie),Pe=me*Math.sin(Y),Ze=Math.tan(Math.PI/4-Y/2)/Math.pow((1-Pe)/(1+Pe),me/2);return Y=-V*Math.log(Math.max(Ze,1e-10)),new O(D.lng*k*V,Y)},unproject:function(D){for(var k=180/Math.PI,V=this.R,Y=this.R_MINOR/V,ie=Math.sqrt(1-Y*Y),me=Math.exp(-D.y/V),Pe=Math.PI/2-2*Math.atan(me),Ze=0,tt=.1,Ut;Ze<15&&Math.abs(tt)>1e-7;Ze++)Ut=ie*Math.sin(Pe),Ut=Math.pow((1-Ut)/(1+Ut),ie/2),tt=Math.PI/2-2*Math.atan(me*Ut)-Pe,Pe+=tt;return new q(Pe*k,D.x*k/V)}},Y2={__proto__:null,LonLat:sI,Mercator:oI,SphericalMercator:ne},ZN=r({},Q,{code:"EPSG:3395",projection:oI,transformation:(function(){var D=.5/(Math.PI*oI.R);return oe(D,.5,-D,.5)})()}),XN=r({},Q,{code:"EPSG:4326",projection:sI,transformation:oe(1/180,1,-1/180,.5)}),JN=r({},K,{projection:sI,transformation:oe(1,0,-1,0),scale:function(D){return Math.pow(2,D)},zoom:function(D){return Math.log(D)/Math.LN2},distance:function(D,k){var V=k.lng-D.lng,Y=k.lat-D.lat;return Math.sqrt(V*V+Y*Y)},infinite:!0});K.Earth=Q,K.EPSG3395=ZN,K.EPSG3857=de,K.EPSG900913=se,K.EPSG4326=XN,K.Simple=JN;var wc=x.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(D){return D.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(D){return D&&D.removeLayer(this),this},getPane:function(D){return this._map.getPane(D?this.options[D]||D:this.options.pane)},addInteractiveTarget:function(D){return this._map._targets[l(D)]=this,this},removeInteractiveTarget:function(D){return delete this._map._targets[l(D)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(D){var k=D.target;if(k.hasLayer(this)){if(this._map=k,this._zoomAnimated=k._zoomAnimated,this.getEvents){var V=this.getEvents();k.on(V,this),this.once("remove",function(){k.off(V,this)},this)}this.onAdd(k),this.fire("add"),k.fire("layeradd",{layer:this})}}});ei.include({addLayer:function(D){if(!D._layerAdd)throw new Error("The provided object is not a Layer.");var k=l(D);return this._layers[k]?this:(this._layers[k]=D,D._mapToAdd=this,D.beforeAdd&&D.beforeAdd(this),this.whenReady(D._layerAdd,D),this)},removeLayer:function(D){var k=l(D);return this._layers[k]?(this._loaded&&D.onRemove(this),delete this._layers[k],this._loaded&&(this.fire("layerremove",{layer:D}),D.fire("remove")),D._map=D._mapToAdd=null,this):this},hasLayer:function(D){return l(D)in this._layers},eachLayer:function(D,k){for(var V in this._layers)D.call(k,this._layers[V]);return this},_addLayers:function(D){D=D?b(D)?D:[D]:[];for(var k=0,V=D.length;k<V;k++)this.addLayer(D[k])},_addZoomLimit:function(D){(!isNaN(D.options.maxZoom)||!isNaN(D.options.minZoom))&&(this._zoomBoundLayers[l(D)]=D,this._updateZoomLevels())},_removeZoomLimit:function(D){var k=l(D);this._zoomBoundLayers[k]&&(delete this._zoomBoundLayers[k],this._updateZoomLevels())},_updateZoomLevels:function(){var D=1/0,k=-1/0,V=this._getZoomSpan();for(var Y in this._zoomBoundLayers){var ie=this._zoomBoundLayers[Y].options;D=ie.minZoom===void 0?D:Math.min(D,ie.minZoom),k=ie.maxZoom===void 0?k:Math.max(k,ie.maxZoom)}this._layersMaxZoom=k===-1/0?void 0:k,this._layersMinZoom=D===1/0?void 0:D,V!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Xv=wc.extend({initialize:function(D,k){m(this,k),this._layers={};var V,Y;if(D)for(V=0,Y=D.length;V<Y;V++)this.addLayer(D[V])},addLayer:function(D){var k=this.getLayerId(D);return this._layers[k]=D,this._map&&this._map.addLayer(D),this},removeLayer:function(D){var k=D in this._layers?D:this.getLayerId(D);return this._map&&this._layers[k]&&this._map.removeLayer(this._layers[k]),delete this._layers[k],this},hasLayer:function(D){var k=typeof D=="number"?D:this.getLayerId(D);return k in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(D){var k=Array.prototype.slice.call(arguments,1),V,Y;for(V in this._layers)Y=this._layers[V],Y[D]&&Y[D].apply(Y,k);return this},onAdd:function(D){this.eachLayer(D.addLayer,D)},onRemove:function(D){this.eachLayer(D.removeLayer,D)},eachLayer:function(D,k){for(var V in this._layers)D.call(k,this._layers[V]);return this},getLayer:function(D){return this._layers[D]},getLayers:function(){var D=[];return this.eachLayer(D.push,D),D},setZIndex:function(D){return this.invoke("setZIndex",D)},getLayerId:function(D){return l(D)}}),QN=function(D,k){return new Xv(D,k)},wd=Xv.extend({addLayer:function(D){return this.hasLayer(D)?this:(D.addEventParent(this),Xv.prototype.addLayer.call(this,D),this.fire("layeradd",{layer:D}))},removeLayer:function(D){return this.hasLayer(D)?(D in this._layers&&(D=this._layers[D]),D.removeEventParent(this),Xv.prototype.removeLayer.call(this,D),this.fire("layerremove",{layer:D})):this},setStyle:function(D){return this.invoke("setStyle",D)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var D=new G;for(var k in this._layers){var V=this._layers[k];D.extend(V.getBounds?V.getBounds():V.getLatLng())}return D}}),eA=function(D,k){return new wd(D,k)},fg=N.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(D){m(this,D)},createIcon:function(D){return this._createIcon("icon",D)},createShadow:function(D){return this._createIcon("shadow",D)},_createIcon:function(D,k){var V=this._getIconUrl(D);if(!V){if(D==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var Y=this._createImg(V,k&&k.tagName==="IMG"?k:null);return this._setIconStyles(Y,D),(this.options.crossOrigin||this.options.crossOrigin==="")&&(Y.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),Y},_setIconStyles:function(D,k){var V=this.options,Y=V[k+"Size"];typeof Y=="number"&&(Y=[Y,Y]);var ie=F(Y),me=F(k==="shadow"&&V.shadowAnchor||V.iconAnchor||ie&&ie.divideBy(2,!0));D.className="leaflet-marker-"+k+" "+(V.className||""),me&&(D.style.marginLeft=-me.x+"px",D.style.marginTop=-me.y+"px"),ie&&(D.style.width=ie.x+"px",D.style.height=ie.y+"px")},_createImg:function(D,k){return k=k||document.createElement("img"),k.src=D,k},_getIconUrl:function(D){return kt.retina&&this.options[D+"RetinaUrl"]||this.options[D+"Url"]}});function K2(D){return new fg(D)}var lI=fg.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(D){return typeof lI.imagePath!="string"&&(lI.imagePath=this._detectIconPath()),(this.options.imagePath||lI.imagePath)+fg.prototype._getIconUrl.call(this,D)},_stripUrl:function(D){var k=function(V,Y,ie){var me=Y.exec(V);return me&&me[ie]};return D=k(D,/^url\((['"])?(.+)\1\)$/,2),D&&k(D,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var D=Qt("div","leaflet-default-icon-path",document.body),k=Mu(D,"background-image")||Mu(D,"backgroundImage");if(document.body.removeChild(D),k=this._stripUrl(k),k)return k;var V=document.querySelector('link[href$="leaflet.css"]');return V?V.href.substring(0,V.href.length-11-1):""}}),tA=Ns.extend({initialize:function(D){this._marker=D},addHooks:function(){var D=this._marker._icon;this._draggable||(this._draggable=new rp(D,D,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Bi(D,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&vr(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(D){var k=this._marker,V=k._map,Y=this._marker.options.autoPanSpeed,ie=this._marker.options.autoPanPadding,me=Oi(k._icon),Pe=V.getPixelBounds(),Ze=V.getPixelOrigin(),tt=H(Pe.min._subtract(Ze).add(ie),Pe.max._subtract(Ze).subtract(ie));if(!tt.contains(me)){var Ut=F((Math.max(tt.max.x,me.x)-tt.max.x)/(Pe.max.x-tt.max.x)-(Math.min(tt.min.x,me.x)-tt.min.x)/(Pe.min.x-tt.min.x),(Math.max(tt.max.y,me.y)-tt.max.y)/(Pe.max.y-tt.max.y)-(Math.min(tt.min.y,me.y)-tt.min.y)/(Pe.min.y-tt.min.y)).multiplyBy(Y);V.panBy(Ut,{animate:!1}),this._draggable._newPos._add(Ut),this._draggable._startPos._add(Ut),xi(k._icon,this._draggable._newPos),this._onDrag(D),this._panRequest=P(this._adjustPan.bind(this,D))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(D){this._marker.options.autoPan&&(M(this._panRequest),this._panRequest=P(this._adjustPan.bind(this,D)))},_onDrag:function(D){var k=this._marker,V=k._shadow,Y=Oi(k._icon),ie=k._map.layerPointToLatLng(Y);V&&xi(V,Y),k._latlng=ie,D.latlng=ie,D.oldLatLng=this._oldLatLng,k.fire("move",D).fire("drag",D)},_onDragEnd:function(D){M(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",D)}}),mg=wc.extend({options:{icon:new lI,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(D,k){m(this,k),this._latlng=Z(D)},onAdd:function(D){this._zoomAnimated=this._zoomAnimated&&D.options.markerZoomAnimation,this._zoomAnimated&&D.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(D){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&D.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(D){var k=this._latlng;return this._latlng=Z(D),this.update(),this.fire("move",{oldLatLng:k,latlng:this._latlng})},setZIndexOffset:function(D){return this.options.zIndexOffset=D,this.update()},getIcon:function(){return this.options.icon},setIcon:function(D){return this.options.icon=D,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var D=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(D)}return this},_initIcon:function(){var D=this.options,k="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),V=D.icon.createIcon(this._icon),Y=!1;V!==this._icon&&(this._icon&&this._removeIcon(),Y=!0,D.title&&(V.title=D.title),V.tagName==="IMG"&&(V.alt=D.alt||"")),Bi(V,k),D.keyboard&&(V.tabIndex="0",V.setAttribute("role","button")),this._icon=V,D.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&oi(V,"focus",this._panOnFocus,this);var ie=D.icon.createShadow(this._shadow),me=!1;ie!==this._shadow&&(this._removeShadow(),me=!0),ie&&(Bi(ie,k),ie.alt=""),this._shadow=ie,D.opacity<1&&this._updateOpacity(),Y&&this.getPane().appendChild(this._icon),this._initInteraction(),ie&&me&&this.getPane(D.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&jn(this._icon,"focus",this._panOnFocus,this),Mr(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Mr(this._shadow),this._shadow=null},_setPos:function(D){this._icon&&xi(this._icon,D),this._shadow&&xi(this._shadow,D),this._zIndex=D.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(D){this._icon&&(this._icon.style.zIndex=this._zIndex+D)},_animateZoom:function(D){var k=this._map._latLngToNewLayerPoint(this._latlng,D.zoom,D.center).round();this._setPos(k)},_initInteraction:function(){if(this.options.interactive&&(Bi(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),tA)){var D=this.options.draggable;this.dragging&&(D=this.dragging.enabled(),this.dragging.disable()),this.dragging=new tA(this),D&&this.dragging.enable()}},setOpacity:function(D){return this.options.opacity=D,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var D=this.options.opacity;this._icon&&es(this._icon,D),this._shadow&&es(this._shadow,D)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var D=this._map;if(D){var k=this.options.icon.options,V=k.iconSize?F(k.iconSize):F(0,0),Y=k.iconAnchor?F(k.iconAnchor):F(0,0);D.panInside(this._latlng,{paddingTopLeft:Y,paddingBottomRight:V.subtract(Y)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function ph(D,k){return new mg(D,k)}var $r=wc.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(D){this._renderer=D.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(D){return m(this,D),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&D&&Object.prototype.hasOwnProperty.call(D,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),gg=$r.extend({options:{fill:!0,radius:10},initialize:function(D,k){m(this,k),this._latlng=Z(D),this._radius=this.options.radius},setLatLng:function(D){var k=this._latlng;return this._latlng=Z(D),this.redraw(),this.fire("move",{oldLatLng:k,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(D){return this.options.radius=this._radius=D,this.redraw()},getRadius:function(){return this._radius},setStyle:function(D){var k=D&&D.radius||this._radius;return $r.prototype.setStyle.call(this,D),this.setRadius(k),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var D=this._radius,k=this._radiusY||D,V=this._clickTolerance(),Y=[D+V,k+V];this._pxBounds=new j(this._point.subtract(Y),this._point.add(Y))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(D){return D.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Sc(D,k){return new gg(D,k)}var bE=gg.extend({initialize:function(D,k,V){if(typeof k=="number"&&(k=r({},V,{radius:k})),m(this,k),this._latlng=Z(D),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(D){return this._mRadius=D,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var D=[this._radius,this._radiusY||this._radius];return new G(this._map.layerPointToLatLng(this._point.subtract(D)),this._map.layerPointToLatLng(this._point.add(D)))},setStyle:$r.prototype.setStyle,_project:function(){var D=this._latlng.lng,k=this._latlng.lat,V=this._map,Y=V.options.crs;if(Y.distance===Q.distance){var ie=Math.PI/180,me=this._mRadius/Q.R/ie,Pe=V.project([k+me,D]),Ze=V.project([k-me,D]),tt=Pe.add(Ze).divideBy(2),Ut=V.unproject(tt).lat,ni=Math.acos((Math.cos(me*ie)-Math.sin(k*ie)*Math.sin(Ut*ie))/(Math.cos(k*ie)*Math.cos(Ut*ie)))/ie;(isNaN(ni)||ni===0)&&(ni=me/Math.cos(Math.PI/180*k)),this._point=tt.subtract(V.getPixelOrigin()),this._radius=isNaN(ni)?0:tt.x-V.project([Ut,D-ni]).x,this._radiusY=tt.y-Pe.y}else{var nn=Y.unproject(Y.project(this._latlng).subtract([this._mRadius,0]));this._point=V.latLngToLayerPoint(this._latlng),this._radius=this._point.x-V.latLngToLayerPoint(nn).x}this._updateBounds()}});function IE(D,k,V){return new bE(D,k,V)}var sp=$r.extend({options:{smoothFactor:1,noClip:!1},initialize:function(D,k){m(this,k),this._setLatLngs(D)},getLatLngs:function(){return this._latlngs},setLatLngs:function(D){return this._setLatLngs(D),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(D){for(var k=1/0,V=null,Y=Zv,ie,me,Pe=0,Ze=this._parts.length;Pe<Ze;Pe++)for(var tt=this._parts[Pe],Ut=1,ni=tt.length;Ut<ni;Ut++){ie=tt[Ut-1],me=tt[Ut];var nn=Y(D,ie,me,!0);nn<k&&(k=nn,V=Y(D,ie,me))}return V&&(V.distance=Math.sqrt(k)),V},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return aI(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(D,k){return k=k||this._defaultShape(),D=Z(D),k.push(D),this._bounds.extend(D),this.redraw()},_setLatLngs:function(D){this._bounds=new G,this._latlngs=this._convertLatLngs(D)},_defaultShape:function(){return Ic(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(D){for(var k=[],V=Ic(D),Y=0,ie=D.length;Y<ie;Y++)V?(k[Y]=Z(D[Y]),this._bounds.extend(k[Y])):k[Y]=this._convertLatLngs(D[Y]);return k},_project:function(){var D=new j;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,D),this._bounds.isValid()&&D.isValid()&&(this._rawPxBounds=D,this._updateBounds())},_updateBounds:function(){var D=this._clickTolerance(),k=new O(D,D);this._rawPxBounds&&(this._pxBounds=new j([this._rawPxBounds.min.subtract(k),this._rawPxBounds.max.add(k)]))},_projectLatlngs:function(D,k,V){var Y=D[0]instanceof q,ie=D.length,me,Pe;if(Y){for(Pe=[],me=0;me<ie;me++)Pe[me]=this._map.latLngToLayerPoint(D[me]),V.extend(Pe[me]);k.push(Pe)}else for(me=0;me<ie;me++)this._projectLatlngs(D[me],k,V)},_clipPoints:function(){var D=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(D))){if(this.options.noClip){this._parts=this._rings;return}var k=this._parts,V,Y,ie,me,Pe,Ze,tt;for(V=0,ie=0,me=this._rings.length;V<me;V++)for(tt=this._rings[V],Y=0,Pe=tt.length;Y<Pe-1;Y++)Ze=pS(tt[Y],tt[Y+1],D,Y,!0),Ze&&(k[ie]=k[ie]||[],k[ie].push(Ze[0]),(Ze[1]!==tt[Y+1]||Y===Pe-2)&&(k[ie].push(Ze[1]),ie++))}},_simplifyPoints:function(){for(var D=this._parts,k=this.options.smoothFactor,V=0,Y=D.length;V<Y;V++)D[V]=gE(D[V],k)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(D,k){var V,Y,ie,me,Pe,Ze,tt=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(D))return!1;for(V=0,me=this._parts.length;V<me;V++)for(Ze=this._parts[V],Y=0,Pe=Ze.length,ie=Pe-1;Y<Pe;ie=Y++)if(!(!k&&Y===0)&&rI(D,Ze[ie],Ze[Y])<=tt)return!0;return!1}});function vg(D,k){return new sp(D,k)}sp._flat=hS;var _f=sp.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ro(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(D){var k=sp.prototype._convertLatLngs.call(this,D),V=k.length;return V>=2&&k[0]instanceof q&&k[0].equals(k[V-1])&&k.pop(),k},_setLatLngs:function(D){sp.prototype._setLatLngs.call(this,D),Ic(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Ic(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var D=this._renderer._bounds,k=this.options.weight,V=new O(k,k);if(D=new j(D.min.subtract(V),D.max.add(V)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(D))){if(this.options.noClip){this._parts=this._rings;return}for(var Y=0,ie=this._rings.length,me;Y<ie;Y++)me=dS(this._rings[Y],D,!0),me.length&&this._parts.push(me)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(D){var k=!1,V,Y,ie,me,Pe,Ze,tt,Ut;if(!this._pxBounds||!this._pxBounds.contains(D))return!1;for(me=0,tt=this._parts.length;me<tt;me++)for(V=this._parts[me],Pe=0,Ut=V.length,Ze=Ut-1;Pe<Ut;Ze=Pe++)Y=V[Pe],ie=V[Ze],Y.y>D.y!=ie.y>D.y&&D.x<(ie.x-Y.x)*(D.y-Y.y)/(ie.y-Y.y)+Y.x&&(k=!k);return k||sp.prototype._containsPoint.call(this,D,!0)}});function Jv(D,k){return new _f(D,k)}var Wo=wd.extend({initialize:function(D,k){m(this,k),this._layers={},D&&this.addData(D)},addData:function(D){var k=b(D)?D:D.features,V,Y,ie;if(k){for(V=0,Y=k.length;V<Y;V++)ie=k[V],(ie.geometries||ie.geometry||ie.features||ie.coordinates)&&this.addData(ie);return this}var me=this.options;if(me.filter&&!me.filter(D))return this;var Pe=uI(D,me);return Pe?(Pe.feature=Ie(D),Pe.defaultOptions=Pe.options,this.resetStyle(Pe),me.onEachFeature&&me.onEachFeature(D,Pe),this.addLayer(Pe)):this},resetStyle:function(D){return D===void 0?this.eachLayer(this.resetStyle,this):(D.options=r({},D.defaultOptions),this._setLayerStyle(D,this.options.style),this)},setStyle:function(D){return this.eachLayer(function(k){this._setLayerStyle(k,D)},this)},_setLayerStyle:function(D,k){D.setStyle&&(typeof k=="function"&&(k=k(D.feature)),D.setStyle(k))}});function uI(D,k){var V=D.type==="Feature"?D.geometry:D,Y=V?V.coordinates:null,ie=[],me=k&&k.pointToLayer,Pe=k&&k.coordsToLatLng||z,Ze,tt,Ut,ni;if(!Y&&!V)return null;switch(V.type){case"Point":return Ze=Pe(Y),B(me,D,Ze,k);case"MultiPoint":for(Ut=0,ni=Y.length;Ut<ni;Ut++)Ze=Pe(Y[Ut]),ie.push(B(me,D,Ze,k));return new wd(ie);case"LineString":case"MultiLineString":return tt=X(Y,V.type==="LineString"?0:1,Pe),new sp(tt,k);case"Polygon":case"MultiPolygon":return tt=X(Y,V.type==="Polygon"?1:2,Pe),new _f(tt,k);case"GeometryCollection":for(Ut=0,ni=V.geometries.length;Ut<ni;Ut++){var nn=uI({geometry:V.geometries[Ut],type:"Feature",properties:D.properties},k);nn&&ie.push(nn)}return new wd(ie);case"FeatureCollection":for(Ut=0,ni=V.features.length;Ut<ni;Ut++){var Kn=uI(V.features[Ut],k);Kn&&ie.push(Kn)}return new wd(ie);default:throw new Error("Invalid GeoJSON object.")}}function B(D,k,V,Y){return D?D(k,V):new mg(V,Y&&Y.markersInheritOptions&&Y)}function z(D){return new q(D[1],D[0],D[2])}function X(D,k,V){for(var Y=[],ie=0,me=D.length,Pe;ie<me;ie++)Pe=k?X(D[ie],k-1,V):(V||z)(D[ie]),Y.push(Pe);return Y}function te(D,k){return D=Z(D),D.alt!==void 0?[p(D.lng,k),p(D.lat,k),p(D.alt,k)]:[p(D.lng,k),p(D.lat,k)]}function ae(D,k,V,Y){for(var ie=[],me=0,Pe=D.length;me<Pe;me++)ie.push(k?ae(D[me],Ic(D[me])?0:k-1,V,Y):te(D[me],Y));return!k&&V&&ie.length>0&&ie.push(ie[0].slice()),ie}function fe(D,k){return D.feature?r({},D.feature,{geometry:k}):Ie(k)}function Ie(D){return D.type==="Feature"||D.type==="FeatureCollection"?D:{type:"Feature",properties:{},geometry:D}}var Ue={toGeoJSON:function(D){return fe(this,{type:"Point",coordinates:te(this.getLatLng(),D)})}};mg.include(Ue),bE.include(Ue),gg.include(Ue),sp.include({toGeoJSON:function(D){var k=!Ic(this._latlngs),V=ae(this._latlngs,k?1:0,!1,D);return fe(this,{type:(k?"Multi":"")+"LineString",coordinates:V})}}),_f.include({toGeoJSON:function(D){var k=!Ic(this._latlngs),V=k&&!Ic(this._latlngs[0]),Y=ae(this._latlngs,V?2:k?1:0,!0,D);return k||(Y=[Y]),fe(this,{type:(V?"Multi":"")+"Polygon",coordinates:Y})}}),Xv.include({toMultiPoint:function(D){var k=[];return this.eachLayer(function(V){k.push(V.toGeoJSON(D).geometry.coordinates)}),fe(this,{type:"MultiPoint",coordinates:k})},toGeoJSON:function(D){var k=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(k==="MultiPoint")return this.toMultiPoint(D);var V=k==="GeometryCollection",Y=[];return this.eachLayer(function(ie){if(ie.toGeoJSON){var me=ie.toGeoJSON(D);if(V)Y.push(me.geometry);else{var Pe=Ie(me);Pe.type==="FeatureCollection"?Y.push.apply(Y,Pe.features):Y.push(Pe)}}}),V?fe(this,{geometries:Y,type:"GeometryCollection"}):{type:"FeatureCollection",features:Y}}});function ke(D,k){return new Wo(D,k)}var $e=ke,He=wc.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(D,k,V){this._url=D,this._bounds=W(k),m(this,V)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Bi(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Mr(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(D){return this.options.opacity=D,this._image&&this._updateOpacity(),this},setStyle:function(D){return D.opacity&&this.setOpacity(D.opacity),this},bringToFront:function(){return this._map&&cs(this._image),this},bringToBack:function(){return this._map&&io(this._image),this},setUrl:function(D){return this._url=D,this._image&&(this._image.src=D),this},setBounds:function(D){return this._bounds=W(D),this._map&&this._reset(),this},getEvents:function(){var D={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(D.zoomanim=this._animateZoom),D},setZIndex:function(D){return this.options.zIndex=D,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var D=this._url.tagName==="IMG",k=this._image=D?this._url:Qt("img");if(Bi(k,"leaflet-image-layer"),this._zoomAnimated&&Bi(k,"leaflet-zoom-animated"),this.options.className&&Bi(k,this.options.className),k.onselectstart=d,k.onmousemove=d,k.onload=s(this.fire,this,"load"),k.onerror=s(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(k.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),D){this._url=k.src;return}k.src=this._url,k.alt=this.options.alt},_animateZoom:function(D){var k=this._map.getZoomScale(D.zoom),V=this._map._latLngBoundsToNewLayerBounds(this._bounds,D.zoom,D.center).min;mi(this._image,V,k)},_reset:function(){var D=this._image,k=new j(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),V=k.getSize();xi(D,k.min),D.style.width=V.x+"px",D.style.height=V.y+"px"},_updateOpacity:function(){es(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var D=this.options.errorOverlayUrl;D&&this._url!==D&&(this._url=D,this._image.src=D)},getCenter:function(){return this._bounds.getCenter()}}),Re=function(D,k,V){return new He(D,k,V)},qe=He.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var D=this._url.tagName==="VIDEO",k=this._image=D?this._url:Qt("video");if(Bi(k,"leaflet-image-layer"),this._zoomAnimated&&Bi(k,"leaflet-zoom-animated"),this.options.className&&Bi(k,this.options.className),k.onselectstart=d,k.onmousemove=d,k.onloadeddata=s(this.fire,this,"load"),D){for(var V=k.getElementsByTagName("source"),Y=[],ie=0;ie<V.length;ie++)Y.push(V[ie].src);this._url=V.length>0?Y:[k.src];return}b(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(k.style,"objectFit")&&(k.style.objectFit="fill"),k.autoplay=!!this.options.autoplay,k.loop=!!this.options.loop,k.muted=!!this.options.muted,k.playsInline=!!this.options.playsInline;for(var me=0;me<this._url.length;me++){var Pe=Qt("source");Pe.src=this._url[me],k.appendChild(Pe)}}});function Be(D,k,V){return new qe(D,k,V)}var Ve=He.extend({_initImage:function(){var D=this._image=this._url;Bi(D,"leaflet-image-layer"),this._zoomAnimated&&Bi(D,"leaflet-zoom-animated"),this.options.className&&Bi(D,this.options.className),D.onselectstart=d,D.onmousemove=d}});function je(D,k,V){return new Ve(D,k,V)}var Ge=wc.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(D,k){D&&(D instanceof q||b(D))?(this._latlng=Z(D),m(this,k)):(m(this,D),this._source=k),this.options.content&&(this._content=this.options.content)},openOn:function(D){return D=arguments.length?D:this._source._map,D.hasLayer(this)||D.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(D){return this._map?this.close():(arguments.length?this._source=D:D=this._source,this._prepareOpen(),this.openOn(D._map)),this},onAdd:function(D){this._zoomAnimated=D._zoomAnimated,this._container||this._initLayout(),D._fadeAnimated&&es(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),D._fadeAnimated&&es(this._container,1),this.bringToFront(),this.options.interactive&&(Bi(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(D){D._fadeAnimated?(es(this._container,0),this._removeTimeout=setTimeout(s(Mr,void 0,this._container),200)):Mr(this._container),this.options.interactive&&(vr(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(D){return this._latlng=Z(D),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(D){return this._content=D,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var D={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(D.zoomanim=this._animateZoom),D},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&cs(this._container),this},bringToBack:function(){return this._map&&io(this._container),this},_prepareOpen:function(D){var k=this._source;if(!k._map)return!1;if(k instanceof wd){k=null;var V=this._source._layers;for(var Y in V)if(V[Y]._map){k=V[Y];break}if(!k)return!1;this._source=k}if(!D)if(k.getCenter)D=k.getCenter();else if(k.getLatLng)D=k.getLatLng();else if(k.getBounds)D=k.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(D),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var D=this._contentNode,k=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof k=="string")D.innerHTML=k;else{for(;D.hasChildNodes();)D.removeChild(D.firstChild);D.appendChild(k)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var D=this._map.latLngToLayerPoint(this._latlng),k=F(this.options.offset),V=this._getAnchor();this._zoomAnimated?xi(this._container,D.add(V)):k=k.add(D).add(V);var Y=this._containerBottom=-k.y,ie=this._containerLeft=-Math.round(this._containerWidth/2)+k.x;this._container.style.bottom=Y+"px",this._container.style.left=ie+"px"}},_getAnchor:function(){return[0,0]}});ei.include({_initOverlay:function(D,k,V,Y){var ie=k;return ie instanceof D||(ie=new D(Y).setContent(k)),V&&ie.setLatLng(V),ie}}),wc.include({_initOverlay:function(D,k,V,Y){var ie=V;return ie instanceof D?(m(ie,Y),ie._source=this):(ie=k&&!Y?k:new D(Y,this),ie.setContent(V)),ie}});var Ke=Ge.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(D){return D=arguments.length?D:this._source._map,!D.hasLayer(this)&&D._popup&&D._popup.options.autoClose&&D.removeLayer(D._popup),D._popup=this,Ge.prototype.openOn.call(this,D)},onAdd:function(D){Ge.prototype.onAdd.call(this,D),D.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof $r||this._source.on("preclick",Hr))},onRemove:function(D){Ge.prototype.onRemove.call(this,D),D.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof $r||this._source.off("preclick",Hr))},getEvents:function(){var D=Ge.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(D.preclick=this.close),this.options.keepInView&&(D.moveend=this._adjustPan),D},_initLayout:function(){var D="leaflet-popup",k=this._container=Qt("div",D+" "+(this.options.className||"")+" leaflet-zoom-animated"),V=this._wrapper=Qt("div",D+"-content-wrapper",k);if(this._contentNode=Qt("div",D+"-content",V),yc(k),np(this._contentNode),oi(k,"contextmenu",Hr),this._tipContainer=Qt("div",D+"-tip-container",k),this._tip=Qt("div",D+"-tip",this._tipContainer),this.options.closeButton){var Y=this._closeButton=Qt("a",D+"-close-button",k);Y.setAttribute("role","button"),Y.setAttribute("aria-label","Close popup"),Y.href="#close",Y.innerHTML='<span aria-hidden="true">&#215;</span>',oi(Y,"click",function(ie){La(ie),this.close()},this)}},_updateLayout:function(){var D=this._contentNode,k=D.style;k.width="",k.whiteSpace="nowrap";var V=D.offsetWidth;V=Math.min(V,this.options.maxWidth),V=Math.max(V,this.options.minWidth),k.width=V+1+"px",k.whiteSpace="",k.height="";var Y=D.offsetHeight,ie=this.options.maxHeight,me="leaflet-popup-scrolled";ie&&Y>ie?(k.height=ie+"px",Bi(D,me)):vr(D,me),this._containerWidth=this._container.offsetWidth},_animateZoom:function(D){var k=this._map._latLngToNewLayerPoint(this._latlng,D.zoom,D.center),V=this._getAnchor();xi(this._container,k.add(V))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var D=this._map,k=parseInt(Mu(this._container,"marginBottom"),10)||0,V=this._container.offsetHeight+k,Y=this._containerWidth,ie=new O(this._containerLeft,-V-this._containerBottom);ie._add(Oi(this._container));var me=D.layerPointToContainerPoint(ie),Pe=F(this.options.autoPanPadding),Ze=F(this.options.autoPanPaddingTopLeft||Pe),tt=F(this.options.autoPanPaddingBottomRight||Pe),Ut=D.getSize(),ni=0,nn=0;me.x+Y+tt.x>Ut.x&&(ni=me.x+Y-Ut.x+tt.x),me.x-ni-Ze.x<0&&(ni=me.x-Ze.x),me.y+V+tt.y>Ut.y&&(nn=me.y+V-Ut.y+tt.y),me.y-nn-Ze.y<0&&(nn=me.y-Ze.y),(ni||nn)&&(this.options.keepInView&&(this._autopanning=!0),D.fire("autopanstart").panBy([ni,nn]))}},_getAnchor:function(){return F(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),et=function(D,k){return new Ke(D,k)};ei.mergeOptions({closePopupOnClick:!0}),ei.include({openPopup:function(D,k,V){return this._initOverlay(Ke,D,k,V).openOn(this),this},closePopup:function(D){return D=arguments.length?D:this._popup,D&&D.close(),this}}),wc.include({bindPopup:function(D,k){return this._popup=this._initOverlay(Ke,this._popup,D,k),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(D){return this._popup&&(this instanceof wd||(this._popup._source=this),this._popup._prepareOpen(D||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(D){return this._popup&&this._popup.setContent(D),this},getPopup:function(){return this._popup},_openPopup:function(D){if(!(!this._popup||!this._map)){ml(D);var k=D.layer||D.target;if(this._popup._source===k&&!(k instanceof $r)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(D.latlng);return}this._popup._source=k,this.openPopup(D.latlng)}},_movePopup:function(D){this._popup.setLatLng(D.latlng)},_onKeyPress:function(D){D.originalEvent.keyCode===13&&this._openPopup(D)}});var dt=Ge.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(D){Ge.prototype.onAdd.call(this,D),this.setOpacity(this.options.opacity),D.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(D){Ge.prototype.onRemove.call(this,D),D.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var D=Ge.prototype.getEvents.call(this);return this.options.permanent||(D.preclick=this.close),D},_initLayout:function(){var D="leaflet-tooltip",k=D+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Qt("div",k),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(D){var k,V,Y=this._map,ie=this._container,me=Y.latLngToContainerPoint(Y.getCenter()),Pe=Y.layerPointToContainerPoint(D),Ze=this.options.direction,tt=ie.offsetWidth,Ut=ie.offsetHeight,ni=F(this.options.offset),nn=this._getAnchor();Ze==="top"?(k=tt/2,V=Ut):Ze==="bottom"?(k=tt/2,V=0):Ze==="center"?(k=tt/2,V=Ut/2):Ze==="right"?(k=0,V=Ut/2):Ze==="left"?(k=tt,V=Ut/2):Pe.x<me.x?(Ze="right",k=0,V=Ut/2):(Ze="left",k=tt+(ni.x+nn.x)*2,V=Ut/2),D=D.subtract(F(k,V,!0)).add(ni).add(nn),vr(ie,"leaflet-tooltip-right"),vr(ie,"leaflet-tooltip-left"),vr(ie,"leaflet-tooltip-top"),vr(ie,"leaflet-tooltip-bottom"),Bi(ie,"leaflet-tooltip-"+Ze),xi(ie,D)},_updatePosition:function(){var D=this._map.latLngToLayerPoint(this._latlng);this._setPosition(D)},setOpacity:function(D){this.options.opacity=D,this._container&&es(this._container,D)},_animateZoom:function(D){var k=this._map._latLngToNewLayerPoint(this._latlng,D.zoom,D.center);this._setPosition(k)},_getAnchor:function(){return F(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),yt=function(D,k){return new dt(D,k)};ei.include({openTooltip:function(D,k,V){return this._initOverlay(dt,D,k,V).openOn(this),this},closeTooltip:function(D){return D.close(),this}}),wc.include({bindTooltip:function(D,k){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(dt,this._tooltip,D,k),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(D){if(!(!D&&this._tooltipHandlersAdded)){var k=D?"off":"on",V={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?V.add=this._openTooltip:(V.mouseover=this._openTooltip,V.mouseout=this.closeTooltip,V.click=this._openTooltip,this._map?this._addFocusListeners():V.add=this._addFocusListeners),this._tooltip.options.sticky&&(V.mousemove=this._moveTooltip),this[k](V),this._tooltipHandlersAdded=!D}},openTooltip:function(D){return this._tooltip&&(this instanceof wd||(this._tooltip._source=this),this._tooltip._prepareOpen(D)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(D){return this._tooltip&&this._tooltip.setContent(D),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(D){var k=typeof D.getElement=="function"&&D.getElement();k&&(oi(k,"focus",function(){this._tooltip._source=D,this.openTooltip()},this),oi(k,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(D){var k=typeof D.getElement=="function"&&D.getElement();k&&k.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(D){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var k=this;this._map.once("moveend",function(){k._openOnceFlag=!1,k._openTooltip(D)});return}this._tooltip._source=D.layer||D.target,this.openTooltip(this._tooltip.options.sticky?D.latlng:void 0)}},_moveTooltip:function(D){var k=D.latlng,V,Y;this._tooltip.options.sticky&&D.originalEvent&&(V=this._map.mouseEventToContainerPoint(D.originalEvent),Y=this._map.containerPointToLayerPoint(V),k=this._map.layerPointToLatLng(Y)),this._tooltip.setLatLng(k)}});var xt=fg.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(D){var k=D&&D.tagName==="DIV"?D:document.createElement("div"),V=this.options;if(V.html instanceof Element?(hl(k),k.appendChild(V.html)):k.innerHTML=V.html!==!1?V.html:"",V.bgPos){var Y=F(V.bgPos);k.style.backgroundPosition=-Y.x+"px "+-Y.y+"px"}return this._setIconStyles(k,"icon"),k},createShadow:function(){return null}});function jt(D){return new xt(D)}fg.Default=lI;var Pt=wc.extend({options:{tileSize:256,opacity:1,updateWhenIdle:kt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(D){m(this,D)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(D){D._addZoomLimit(this)},onRemove:function(D){this._removeAllTiles(),Mr(this._container),D._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(cs(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(io(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(D){return this.options.opacity=D,this._updateOpacity(),this},setZIndex:function(D){return this.options.zIndex=D,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var D=this._clampZoom(this._map.getZoom());D!==this._tileZoom&&(this._tileZoom=D,this._updateLevels()),this._update()}return this},getEvents:function(){var D={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=u(this._onMoveEnd,this.options.updateInterval,this)),D.move=this._onMove),this._zoomAnimated&&(D.zoomanim=this._animateZoom),D},createTile:function(){return document.createElement("div")},getTileSize:function(){var D=this.options.tileSize;return D instanceof O?D:new O(D,D)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(D){for(var k=this.getPane().children,V=-D(-1/0,1/0),Y=0,ie=k.length,me;Y<ie;Y++)me=k[Y].style.zIndex,k[Y]!==this._container&&me&&(V=D(V,+me));isFinite(V)&&(this.options.zIndex=V+D(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!kt.ielt9){es(this._container,this.options.opacity);var D=+new Date,k=!1,V=!1;for(var Y in this._tiles){var ie=this._tiles[Y];if(!(!ie.current||!ie.loaded)){var me=Math.min(1,(D-ie.loaded)/200);es(ie.el,me),me<1?k=!0:(ie.active?V=!0:this._onOpaqueTile(ie),ie.active=!0)}}V&&!this._noPrune&&this._pruneTiles(),k&&(M(this._fadeFrame),this._fadeFrame=P(this._updateOpacity,this))}},_onOpaqueTile:d,_initContainer:function(){this._container||(this._container=Qt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var D=this._tileZoom,k=this.options.maxZoom;if(D!==void 0){for(var V in this._levels)V=Number(V),this._levels[V].el.children.length||V===D?(this._levels[V].el.style.zIndex=k-Math.abs(D-V),this._onUpdateLevel(V)):(Mr(this._levels[V].el),this._removeTilesAtZoom(V),this._onRemoveLevel(V),delete this._levels[V]);var Y=this._levels[D],ie=this._map;return Y||(Y=this._levels[D]={},Y.el=Qt("div","leaflet-tile-container leaflet-zoom-animated",this._container),Y.el.style.zIndex=k,Y.origin=ie.project(ie.unproject(ie.getPixelOrigin()),D).round(),Y.zoom=D,this._setZoomTransform(Y,ie.getCenter(),ie.getZoom()),d(Y.el.offsetWidth),this._onCreateLevel(Y)),this._level=Y,Y}},_onUpdateLevel:d,_onRemoveLevel:d,_onCreateLevel:d,_pruneTiles:function(){if(this._map){var D,k,V=this._map.getZoom();if(V>this.options.maxZoom||V<this.options.minZoom){this._removeAllTiles();return}for(D in this._tiles)k=this._tiles[D],k.retain=k.current;for(D in this._tiles)if(k=this._tiles[D],k.current&&!k.active){var Y=k.coords;this._retainParent(Y.x,Y.y,Y.z,Y.z-5)||this._retainChildren(Y.x,Y.y,Y.z,Y.z+2)}for(D in this._tiles)this._tiles[D].retain||this._removeTile(D)}},_removeTilesAtZoom:function(D){for(var k in this._tiles)this._tiles[k].coords.z===D&&this._removeTile(k)},_removeAllTiles:function(){for(var D in this._tiles)this._removeTile(D)},_invalidateAll:function(){for(var D in this._levels)Mr(this._levels[D].el),this._onRemoveLevel(Number(D)),delete this._levels[D];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(D,k,V,Y){var ie=Math.floor(D/2),me=Math.floor(k/2),Pe=V-1,Ze=new O(+ie,+me);Ze.z=+Pe;var tt=this._tileCoordsToKey(Ze),Ut=this._tiles[tt];return Ut&&Ut.active?(Ut.retain=!0,!0):(Ut&&Ut.loaded&&(Ut.retain=!0),Pe>Y?this._retainParent(ie,me,Pe,Y):!1)},_retainChildren:function(D,k,V,Y){for(var ie=2*D;ie<2*D+2;ie++)for(var me=2*k;me<2*k+2;me++){var Pe=new O(ie,me);Pe.z=V+1;var Ze=this._tileCoordsToKey(Pe),tt=this._tiles[Ze];if(tt&&tt.active){tt.retain=!0;continue}else tt&&tt.loaded&&(tt.retain=!0);V+1<Y&&this._retainChildren(ie,me,V+1,Y)}},_resetView:function(D){var k=D&&(D.pinch||D.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),k,k)},_animateZoom:function(D){this._setView(D.center,D.zoom,!0,D.noUpdate)},_clampZoom:function(D){var k=this.options;return k.minNativeZoom!==void 0&&D<k.minNativeZoom?k.minNativeZoom:k.maxNativeZoom!==void 0&&k.maxNativeZoom<D?k.maxNativeZoom:D},_setView:function(D,k,V,Y){var ie=Math.round(k);this.options.maxZoom!==void 0&&ie>this.options.maxZoom||this.options.minZoom!==void 0&&ie<this.options.minZoom?ie=void 0:ie=this._clampZoom(ie);var me=this.options.updateWhenZooming&&ie!==this._tileZoom;(!Y||me)&&(this._tileZoom=ie,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),ie!==void 0&&this._update(D),V||this._pruneTiles(),this._noPrune=!!V),this._setZoomTransforms(D,k)},_setZoomTransforms:function(D,k){for(var V in this._levels)this._setZoomTransform(this._levels[V],D,k)},_setZoomTransform:function(D,k,V){var Y=this._map.getZoomScale(V,D.zoom),ie=D.origin.multiplyBy(Y).subtract(this._map._getNewPixelOrigin(k,V)).round();kt.any3d?mi(D.el,ie,Y):xi(D.el,ie)},_resetGrid:function(){var D=this._map,k=D.options.crs,V=this._tileSize=this.getTileSize(),Y=this._tileZoom,ie=this._map.getPixelWorldBounds(this._tileZoom);ie&&(this._globalTileRange=this._pxBoundsToTileRange(ie)),this._wrapX=k.wrapLng&&!this.options.noWrap&&[Math.floor(D.project([0,k.wrapLng[0]],Y).x/V.x),Math.ceil(D.project([0,k.wrapLng[1]],Y).x/V.y)],this._wrapY=k.wrapLat&&!this.options.noWrap&&[Math.floor(D.project([k.wrapLat[0],0],Y).y/V.x),Math.ceil(D.project([k.wrapLat[1],0],Y).y/V.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(D){var k=this._map,V=k._animatingZoom?Math.max(k._animateToZoom,k.getZoom()):k.getZoom(),Y=k.getZoomScale(V,this._tileZoom),ie=k.project(D,this._tileZoom).floor(),me=k.getSize().divideBy(Y*2);return new j(ie.subtract(me),ie.add(me))},_update:function(D){var k=this._map;if(k){var V=this._clampZoom(k.getZoom());if(D===void 0&&(D=k.getCenter()),this._tileZoom!==void 0){var Y=this._getTiledPixelBounds(D),ie=this._pxBoundsToTileRange(Y),me=ie.getCenter(),Pe=[],Ze=this.options.keepBuffer,tt=new j(ie.getBottomLeft().subtract([Ze,-Ze]),ie.getTopRight().add([Ze,-Ze]));if(!(isFinite(ie.min.x)&&isFinite(ie.min.y)&&isFinite(ie.max.x)&&isFinite(ie.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ut in this._tiles){var ni=this._tiles[Ut].coords;(ni.z!==this._tileZoom||!tt.contains(new O(ni.x,ni.y)))&&(this._tiles[Ut].current=!1)}if(Math.abs(V-this._tileZoom)>1){this._setView(D,V);return}for(var nn=ie.min.y;nn<=ie.max.y;nn++)for(var Kn=ie.min.x;Kn<=ie.max.x;Kn++){var Au=new O(Kn,nn);if(Au.z=this._tileZoom,!!this._isValidTile(Au)){var Zo=this._tiles[this._tileCoordsToKey(Au)];Zo?Zo.current=!0:Pe.push(Au)}}if(Pe.sort(function(Tc,fS){return Tc.distanceTo(me)-fS.distanceTo(me)}),Pe.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var op=document.createDocumentFragment();for(Kn=0;Kn<Pe.length;Kn++)this._addTile(Pe[Kn],op);this._level.el.appendChild(op)}}}},_isValidTile:function(D){var k=this._map.options.crs;if(!k.infinite){var V=this._globalTileRange;if(!k.wrapLng&&(D.x<V.min.x||D.x>V.max.x)||!k.wrapLat&&(D.y<V.min.y||D.y>V.max.y))return!1}if(!this.options.bounds)return!0;var Y=this._tileCoordsToBounds(D);return W(this.options.bounds).overlaps(Y)},_keyToBounds:function(D){return this._tileCoordsToBounds(this._keyToTileCoords(D))},_tileCoordsToNwSe:function(D){var k=this._map,V=this.getTileSize(),Y=D.scaleBy(V),ie=Y.add(V),me=k.unproject(Y,D.z),Pe=k.unproject(ie,D.z);return[me,Pe]},_tileCoordsToBounds:function(D){var k=this._tileCoordsToNwSe(D),V=new G(k[0],k[1]);return this.options.noWrap||(V=this._map.wrapLatLngBounds(V)),V},_tileCoordsToKey:function(D){return D.x+":"+D.y+":"+D.z},_keyToTileCoords:function(D){var k=D.split(":"),V=new O(+k[0],+k[1]);return V.z=+k[2],V},_removeTile:function(D){var k=this._tiles[D];k&&(Mr(k.el),delete this._tiles[D],this.fire("tileunload",{tile:k.el,coords:this._keyToTileCoords(D)}))},_initTile:function(D){Bi(D,"leaflet-tile");var k=this.getTileSize();D.style.width=k.x+"px",D.style.height=k.y+"px",D.onselectstart=d,D.onmousemove=d,kt.ielt9&&this.options.opacity<1&&es(D,this.options.opacity)},_addTile:function(D,k){var V=this._getTilePos(D),Y=this._tileCoordsToKey(D),ie=this.createTile(this._wrapCoords(D),s(this._tileReady,this,D));this._initTile(ie),this.createTile.length<2&&P(s(this._tileReady,this,D,null,ie)),xi(ie,V),this._tiles[Y]={el:ie,coords:D,current:!0},k.appendChild(ie),this.fire("tileloadstart",{tile:ie,coords:D})},_tileReady:function(D,k,V){k&&this.fire("tileerror",{error:k,tile:V,coords:D});var Y=this._tileCoordsToKey(D);V=this._tiles[Y],V&&(V.loaded=+new Date,this._map._fadeAnimated?(es(V.el,0),M(this._fadeFrame),this._fadeFrame=P(this._updateOpacity,this)):(V.active=!0,this._pruneTiles()),k||(Bi(V.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:V.el,coords:D})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),kt.ielt9||!this._map._fadeAnimated?P(this._pruneTiles,this):setTimeout(s(this._pruneTiles,this),250)))},_getTilePos:function(D){return D.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(D){var k=new O(this._wrapX?c(D.x,this._wrapX):D.x,this._wrapY?c(D.y,this._wrapY):D.y);return k.z=D.z,k},_pxBoundsToTileRange:function(D){var k=this.getTileSize();return new j(D.min.unscaleBy(k).floor(),D.max.unscaleBy(k).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var D in this._tiles)if(!this._tiles[D].loaded)return!1;return!0}});function Ft(D){return new Pt(D)}var $t=Pt.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(D,k){this._url=D,k=m(this,k),k.detectRetina&&kt.retina&&k.maxZoom>0?(k.tileSize=Math.floor(k.tileSize/2),k.zoomReverse?(k.zoomOffset--,k.minZoom=Math.min(k.maxZoom,k.minZoom+1)):(k.zoomOffset++,k.maxZoom=Math.max(k.minZoom,k.maxZoom-1)),k.minZoom=Math.max(0,k.minZoom)):k.zoomReverse?k.minZoom=Math.min(k.maxZoom,k.minZoom):k.maxZoom=Math.max(k.minZoom,k.maxZoom),typeof k.subdomains=="string"&&(k.subdomains=k.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(D,k){return this._url===D&&k===void 0&&(k=!0),this._url=D,k||this.redraw(),this},createTile:function(D,k){var V=document.createElement("img");return oi(V,"load",s(this._tileOnLoad,this,k,V)),oi(V,"error",s(this._tileOnError,this,k,V)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(V.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(V.referrerPolicy=this.options.referrerPolicy),V.alt="",V.src=this.getTileUrl(D),V},getTileUrl:function(D){var k={r:kt.retina?"@2x":"",s:this._getSubdomain(D),x:D.x,y:D.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var V=this._globalTileRange.max.y-D.y;this.options.tms&&(k.y=V),k["-y"]=V}return y(this._url,r(k,this.options))},_tileOnLoad:function(D,k){kt.ielt9?setTimeout(s(D,this,null,k),0):D(null,k)},_tileOnError:function(D,k,V){var Y=this.options.errorTileUrl;Y&&k.getAttribute("src")!==Y&&(k.src=Y),D(V,k)},_onTileRemove:function(D){D.tile.onload=null},_getZoomForUrl:function(){var D=this._tileZoom,k=this.options.maxZoom,V=this.options.zoomReverse,Y=this.options.zoomOffset;return V&&(D=k-D),D+Y},_getSubdomain:function(D){var k=Math.abs(D.x+D.y)%this.options.subdomains.length;return this.options.subdomains[k]},_abortLoading:function(){var D,k;for(D in this._tiles)if(this._tiles[D].coords.z!==this._tileZoom&&(k=this._tiles[D].el,k.onload=d,k.onerror=d,!k.complete)){k.src=S;var V=this._tiles[D].coords;Mr(k),delete this._tiles[D],this.fire("tileabort",{tile:k,coords:V})}},_removeTile:function(D){var k=this._tiles[D];if(k)return k.el.setAttribute("src",S),Pt.prototype._removeTile.call(this,D)},_tileReady:function(D,k,V){if(!(!this._map||V&&V.getAttribute("src")===S))return Pt.prototype._tileReady.call(this,D,k,V)}});function Bt(D,k){return new $t(D,k)}var ii=$t.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(D,k){this._url=D;var V=r({},this.defaultWmsParams);for(var Y in k)Y in this.options||(V[Y]=k[Y]);k=m(this,k);var ie=k.detectRetina&&kt.retina?2:1,me=this.getTileSize();V.width=me.x*ie,V.height=me.y*ie,this.wmsParams=V},onAdd:function(D){this._crs=this.options.crs||D.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var k=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[k]=this._crs.code,$t.prototype.onAdd.call(this,D)},getTileUrl:function(D){var k=this._tileCoordsToNwSe(D),V=this._crs,Y=H(V.project(k[0]),V.project(k[1])),ie=Y.min,me=Y.max,Pe=(this._wmsVersion>=1.3&&this._crs===XN?[ie.y,ie.x,me.y,me.x]:[ie.x,ie.y,me.x,me.y]).join(","),Ze=$t.prototype.getTileUrl.call(this,D);return Ze+g(this.wmsParams,Ze,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Pe},setParams:function(D,k){return r(this.wmsParams,D),k||this.redraw(),this}});function In(D,k){return new ii(D,k)}$t.WMS=ii,Bt.wms=In;var Ji=wc.extend({options:{padding:.1},initialize:function(D){m(this,D),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Bi(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var D={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(D.zoomanim=this._onAnimZoom),D},_onAnimZoom:function(D){this._updateTransform(D.center,D.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(D,k){var V=this._map.getZoomScale(k,this._zoom),Y=this._map.getSize().multiplyBy(.5+this.options.padding),ie=this._map.project(this._center,k),me=Y.multiplyBy(-V).add(ie).subtract(this._map._getNewPixelOrigin(D,k));kt.any3d?mi(this._container,me,V):xi(this._container,me)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var D in this._layers)this._layers[D]._reset()},_onZoomEnd:function(){for(var D in this._layers)this._layers[D]._project()},_updatePaths:function(){for(var D in this._layers)this._layers[D]._update()},_update:function(){var D=this.options.padding,k=this._map.getSize(),V=this._map.containerPointToLayerPoint(k.multiplyBy(-D)).round();this._bounds=new j(V,V.add(k.multiplyBy(1+D*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),An=Ji.extend({options:{tolerance:0},getEvents:function(){var D=Ji.prototype.getEvents.call(this);return D.viewprereset=this._onViewPreReset,D},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Ji.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var D=this._container=document.createElement("canvas");oi(D,"mousemove",this._onMouseMove,this),oi(D,"click dblclick mousedown mouseup contextmenu",this._onClick,this),oi(D,"mouseout",this._handleMouseOut,this),D._leaflet_disable_events=!0,this._ctx=D.getContext("2d")},_destroyContainer:function(){M(this._redrawRequest),delete this._ctx,Mr(this._container),jn(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var D;this._redrawBounds=null;for(var k in this._layers)D=this._layers[k],D._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ji.prototype._update.call(this);var D=this._bounds,k=this._container,V=D.getSize(),Y=kt.retina?2:1;xi(k,D.min),k.width=Y*V.x,k.height=Y*V.y,k.style.width=V.x+"px",k.style.height=V.y+"px",kt.retina&&this._ctx.scale(2,2),this._ctx.translate(-D.min.x,-D.min.y),this.fire("update")}},_reset:function(){Ji.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(D){this._updateDashArray(D),this._layers[l(D)]=D;var k=D._order={layer:D,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=k),this._drawLast=k,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(D){this._requestRedraw(D)},_removePath:function(D){var k=D._order,V=k.next,Y=k.prev;V?V.prev=Y:this._drawLast=Y,Y?Y.next=V:this._drawFirst=V,delete D._order,delete this._layers[l(D)],this._requestRedraw(D)},_updatePath:function(D){this._extendRedrawBounds(D),D._project(),D._update(),this._requestRedraw(D)},_updateStyle:function(D){this._updateDashArray(D),this._requestRedraw(D)},_updateDashArray:function(D){if(typeof D.options.dashArray=="string"){var k=D.options.dashArray.split(/[, ]+/),V=[],Y,ie;for(ie=0;ie<k.length;ie++){if(Y=Number(k[ie]),isNaN(Y))return;V.push(Y)}D.options._dashArray=V}else D.options._dashArray=D.options.dashArray},_requestRedraw:function(D){this._map&&(this._extendRedrawBounds(D),this._redrawRequest=this._redrawRequest||P(this._redraw,this))},_extendRedrawBounds:function(D){if(D._pxBounds){var k=(D.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new j,this._redrawBounds.extend(D._pxBounds.min.subtract([k,k])),this._redrawBounds.extend(D._pxBounds.max.add([k,k]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var D=this._redrawBounds;if(D){var k=D.getSize();this._ctx.clearRect(D.min.x,D.min.y,k.x,k.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var D,k=this._redrawBounds;if(this._ctx.save(),k){var V=k.getSize();this._ctx.beginPath(),this._ctx.rect(k.min.x,k.min.y,V.x,V.y),this._ctx.clip()}this._drawing=!0;for(var Y=this._drawFirst;Y;Y=Y.next)D=Y.layer,(!k||D._pxBounds&&D._pxBounds.intersects(k))&&D._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(D,k){if(this._drawing){var V,Y,ie,me,Pe=D._parts,Ze=Pe.length,tt=this._ctx;if(Ze){for(tt.beginPath(),V=0;V<Ze;V++){for(Y=0,ie=Pe[V].length;Y<ie;Y++)me=Pe[V][Y],tt[Y?"lineTo":"moveTo"](me.x,me.y);k&&tt.closePath()}this._fillStroke(tt,D)}}},_updateCircle:function(D){if(!(!this._drawing||D._empty())){var k=D._point,V=this._ctx,Y=Math.max(Math.round(D._radius),1),ie=(Math.max(Math.round(D._radiusY),1)||Y)/Y;ie!==1&&(V.save(),V.scale(1,ie)),V.beginPath(),V.arc(k.x,k.y/ie,Y,0,Math.PI*2,!1),ie!==1&&V.restore(),this._fillStroke(V,D)}},_fillStroke:function(D,k){var V=k.options;V.fill&&(D.globalAlpha=V.fillOpacity,D.fillStyle=V.fillColor||V.color,D.fill(V.fillRule||"evenodd")),V.stroke&&V.weight!==0&&(D.setLineDash&&D.setLineDash(k.options&&k.options._dashArray||[]),D.globalAlpha=V.opacity,D.lineWidth=V.weight,D.strokeStyle=V.color,D.lineCap=V.lineCap,D.lineJoin=V.lineJoin,D.stroke())},_onClick:function(D){for(var k=this._map.mouseEventToLayerPoint(D),V,Y,ie=this._drawFirst;ie;ie=ie.next)V=ie.layer,V.options.interactive&&V._containsPoint(k)&&(!(D.type==="click"||D.type==="preclick")||!this._map._draggableMoved(V))&&(Y=V);this._fireEvent(Y?[Y]:!1,D)},_onMouseMove:function(D){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var k=this._map.mouseEventToLayerPoint(D);this._handleMouseHover(D,k)}},_handleMouseOut:function(D){var k=this._hoveredLayer;k&&(vr(this._container,"leaflet-interactive"),this._fireEvent([k],D,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(D,k){if(!this._mouseHoverThrottled){for(var V,Y,ie=this._drawFirst;ie;ie=ie.next)V=ie.layer,V.options.interactive&&V._containsPoint(k)&&(Y=V);Y!==this._hoveredLayer&&(this._handleMouseOut(D),Y&&(Bi(this._container,"leaflet-interactive"),this._fireEvent([Y],D,"mouseover"),this._hoveredLayer=Y)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,D),this._mouseHoverThrottled=!0,setTimeout(s(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(D,k,V){this._map._fireDOMEvent(k,V||k.type,D)},_bringToFront:function(D){var k=D._order;if(k){var V=k.next,Y=k.prev;if(V)V.prev=Y;else return;Y?Y.next=V:V&&(this._drawFirst=V),k.prev=this._drawLast,this._drawLast.next=k,k.next=null,this._drawLast=k,this._requestRedraw(D)}},_bringToBack:function(D){var k=D._order;if(k){var V=k.next,Y=k.prev;if(Y)Y.next=V;else return;V?V.prev=Y:Y&&(this._drawLast=Y),k.prev=null,k.next=this._drawFirst,this._drawFirst.prev=k,this._drawFirst=k,this._requestRedraw(D)}}});function Jl(D){return kt.canvas?new An(D):null}var tn=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(D){return document.createElement("<lvml:"+D+' class="lvml">')}}catch{}return function(D){return document.createElement("<"+D+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),Yo={_initContainer:function(){this._container=Qt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Ji.prototype._update.call(this),this.fire("update"))},_initPath:function(D){var k=D._container=tn("shape");Bi(k,"leaflet-vml-shape "+(this.options.className||"")),k.coordsize="1 1",D._path=tn("path"),k.appendChild(D._path),this._updateStyle(D),this._layers[l(D)]=D},_addPath:function(D){var k=D._container;this._container.appendChild(k),D.options.interactive&&D.addInteractiveTarget(k)},_removePath:function(D){var k=D._container;Mr(k),D.removeInteractiveTarget(k),delete this._layers[l(D)]},_updateStyle:function(D){var k=D._stroke,V=D._fill,Y=D.options,ie=D._container;ie.stroked=!!Y.stroke,ie.filled=!!Y.fill,Y.stroke?(k||(k=D._stroke=tn("stroke")),ie.appendChild(k),k.weight=Y.weight+"px",k.color=Y.color,k.opacity=Y.opacity,Y.dashArray?k.dashStyle=b(Y.dashArray)?Y.dashArray.join(" "):Y.dashArray.replace(/( *, *)/g," "):k.dashStyle="",k.endcap=Y.lineCap.replace("butt","flat"),k.joinstyle=Y.lineJoin):k&&(ie.removeChild(k),D._stroke=null),Y.fill?(V||(V=D._fill=tn("fill")),ie.appendChild(V),V.color=Y.fillColor||Y.color,V.opacity=Y.fillOpacity):V&&(ie.removeChild(V),D._fill=null)},_updateCircle:function(D){var k=D._point.round(),V=Math.round(D._radius),Y=Math.round(D._radiusY||V);this._setPath(D,D._empty()?"M0 0":"AL "+k.x+","+k.y+" "+V+","+Y+" 0,"+65535*360)},_setPath:function(D,k){D._path.v=k},_bringToFront:function(D){cs(D._container)},_bringToBack:function(D){io(D._container)}},Ys=kt.vml?tn:ge,kf=Ji.extend({_initContainer:function(){this._container=Ys("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Ys("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Mr(this._container),jn(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ji.prototype._update.call(this);var D=this._bounds,k=D.getSize(),V=this._container;(!this._svgSize||!this._svgSize.equals(k))&&(this._svgSize=k,V.setAttribute("width",k.x),V.setAttribute("height",k.y)),xi(V,D.min),V.setAttribute("viewBox",[D.min.x,D.min.y,k.x,k.y].join(" ")),this.fire("update")}},_initPath:function(D){var k=D._path=Ys("path");D.options.className&&Bi(k,D.options.className),D.options.interactive&&Bi(k,"leaflet-interactive"),this._updateStyle(D),this._layers[l(D)]=D},_addPath:function(D){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(D._path),D.addInteractiveTarget(D._path)},_removePath:function(D){Mr(D._path),D.removeInteractiveTarget(D._path),delete this._layers[l(D)]},_updatePath:function(D){D._project(),D._update()},_updateStyle:function(D){var k=D._path,V=D.options;k&&(V.stroke?(k.setAttribute("stroke",V.color),k.setAttribute("stroke-opacity",V.opacity),k.setAttribute("stroke-width",V.weight),k.setAttribute("stroke-linecap",V.lineCap),k.setAttribute("stroke-linejoin",V.lineJoin),V.dashArray?k.setAttribute("stroke-dasharray",V.dashArray):k.removeAttribute("stroke-dasharray"),V.dashOffset?k.setAttribute("stroke-dashoffset",V.dashOffset):k.removeAttribute("stroke-dashoffset")):k.setAttribute("stroke","none"),V.fill?(k.setAttribute("fill",V.fillColor||V.color),k.setAttribute("fill-opacity",V.fillOpacity),k.setAttribute("fill-rule",V.fillRule||"evenodd")):k.setAttribute("fill","none"))},_updatePoly:function(D,k){this._setPath(D,ye(D._parts,k))},_updateCircle:function(D){var k=D._point,V=Math.max(Math.round(D._radius),1),Y=Math.max(Math.round(D._radiusY),1)||V,ie="a"+V+","+Y+" 0 1,0 ",me=D._empty()?"M0 0":"M"+(k.x-V)+","+k.y+ie+V*2+",0 "+ie+-V*2+",0 ";this._setPath(D,me)},_setPath:function(D,k){D._path.setAttribute("d",k)},_bringToFront:function(D){cs(D._path)},_bringToBack:function(D){io(D._path)}});kt.vml&&kf.include(Yo);function Ko(D){return kt.svg||kt.vml?new kf(D):null}ei.include({getRenderer:function(D){var k=D.options.renderer||this._getPaneRenderer(D.options.pane)||this.options.renderer||this._renderer;return k||(k=this._renderer=this._createRenderer()),this.hasLayer(k)||this.addLayer(k),k},_getPaneRenderer:function(D){if(D==="overlayPane"||D===void 0)return!1;var k=this._paneRenderers[D];return k===void 0&&(k=this._createRenderer({pane:D}),this._paneRenderers[D]=k),k},_createRenderer:function(D){return this.options.preferCanvas&&Jl(D)||Ko(D)}});var xf=_f.extend({initialize:function(D,k){_f.prototype.initialize.call(this,this._boundsToLatLngs(D),k)},setBounds:function(D){return this.setLatLngs(this._boundsToLatLngs(D))},_boundsToLatLngs:function(D){return D=W(D),[D.getSouthWest(),D.getNorthWest(),D.getNorthEast(),D.getSouthEast()]}});function wE(D,k){return new xf(D,k)}kf.create=Ys,kf.pointsToPath=ye,Wo.geometryToLayer=uI,Wo.coordsToLatLng=z,Wo.coordsToLatLngs=X,Wo.latLngToCoords=te,Wo.latLngsToCoords=ae,Wo.getFeature=fe,Wo.asFeature=Ie,ei.mergeOptions({boxZoom:!0});var ZZ=Ns.extend({initialize:function(D){this._map=D,this._container=D._container,this._pane=D._panes.overlayPane,this._resetStateTimeout=0,D.on("unload",this._destroy,this)},addHooks:function(){oi(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){jn(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Mr(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(D){if(!D.shiftKey||D.which!==1&&D.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),yr(),fl(),this._startPoint=this._map.mouseEventToContainerPoint(D),oi(document,{contextmenu:ml,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(D){this._moved||(this._moved=!0,this._box=Qt("div","leaflet-zoom-box",this._container),Bi(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(D);var k=new j(this._point,this._startPoint),V=k.getSize();xi(this._box,k.min),this._box.style.width=V.x+"px",this._box.style.height=V.y+"px"},_finish:function(){this._moved&&(Mr(this._box),vr(this._container,"leaflet-crosshair")),Oa(),cg(),jn(document,{contextmenu:ml,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(D){if(!(D.which!==1&&D.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(s(this._resetState,this),0);var k=new G(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(k).fire("boxzoomend",{boxZoomBounds:k})}},_onKeyDown:function(D){D.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});ei.addInitHook("addHandler","boxZoom",ZZ),ei.mergeOptions({doubleClickZoom:!0});var XZ=Ns.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(D){var k=this._map,V=k.getZoom(),Y=k.options.zoomDelta,ie=D.originalEvent.shiftKey?V-Y:V+Y;k.options.doubleClickZoom==="center"?k.setZoom(ie):k.setZoomAround(D.containerPoint,ie)}});ei.addInitHook("addHandler","doubleClickZoom",XZ),ei.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var JZ=Ns.extend({addHooks:function(){if(!this._draggable){var D=this._map;this._draggable=new rp(D._mapPane,D._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),D.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),D.on("zoomend",this._onZoomEnd,this),D.whenReady(this._onZoomEnd,this))}Bi(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){vr(this._map._container,"leaflet-grab"),vr(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var D=this._map;if(D._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var k=W(this._map.options.maxBounds);this._offsetLimit=H(this._map.latLngToContainerPoint(k.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(k.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;D.fire("movestart").fire("dragstart"),D.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(D){if(this._map.options.inertia){var k=this._lastTime=+new Date,V=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(V),this._times.push(k),this._prunePositions(k)}this._map.fire("move",D).fire("drag",D)},_prunePositions:function(D){for(;this._positions.length>1&&D-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var D=this._map.getSize().divideBy(2),k=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=k.subtract(D).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(D,k){return D-(D-k)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var D=this._draggable._newPos.subtract(this._draggable._startPos),k=this._offsetLimit;D.x<k.min.x&&(D.x=this._viscousLimit(D.x,k.min.x)),D.y<k.min.y&&(D.y=this._viscousLimit(D.y,k.min.y)),D.x>k.max.x&&(D.x=this._viscousLimit(D.x,k.max.x)),D.y>k.max.y&&(D.y=this._viscousLimit(D.y,k.max.y)),this._draggable._newPos=this._draggable._startPos.add(D)}},_onPreDragWrap:function(){var D=this._worldWidth,k=Math.round(D/2),V=this._initialWorldOffset,Y=this._draggable._newPos.x,ie=(Y-k+V)%D+k-V,me=(Y+k+V)%D-k-V,Pe=Math.abs(ie+V)<Math.abs(me+V)?ie:me;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Pe},_onDragEnd:function(D){var k=this._map,V=k.options,Y=!V.inertia||D.noInertia||this._times.length<2;if(k.fire("dragend",D),Y)k.fire("moveend");else{this._prunePositions(+new Date);var ie=this._lastPos.subtract(this._positions[0]),me=(this._lastTime-this._times[0])/1e3,Pe=V.easeLinearity,Ze=ie.multiplyBy(Pe/me),tt=Ze.distanceTo([0,0]),Ut=Math.min(V.inertiaMaxSpeed,tt),ni=Ze.multiplyBy(Ut/tt),nn=Ut/(V.inertiaDeceleration*Pe),Kn=ni.multiplyBy(-nn/2).round();!Kn.x&&!Kn.y?k.fire("moveend"):(Kn=k._limitOffset(Kn,k.options.maxBounds),P(function(){k.panBy(Kn,{duration:nn,easeLinearity:Pe,noMoveStart:!0,animate:!0})}))}}});ei.addInitHook("addHandler","dragging",JZ),ei.mergeOptions({keyboard:!0,keyboardPanDelta:80});var QZ=Ns.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(D){this._map=D,this._setPanDelta(D.options.keyboardPanDelta),this._setZoomDelta(D.options.zoomDelta)},addHooks:function(){var D=this._map._container;D.tabIndex<=0&&(D.tabIndex="0"),oi(D,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),jn(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var D=document.body,k=document.documentElement,V=D.scrollTop||k.scrollTop,Y=D.scrollLeft||k.scrollLeft;this._map._container.focus(),window.scrollTo(Y,V)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(D){var k=this._panKeys={},V=this.keyCodes,Y,ie;for(Y=0,ie=V.left.length;Y<ie;Y++)k[V.left[Y]]=[-1*D,0];for(Y=0,ie=V.right.length;Y<ie;Y++)k[V.right[Y]]=[D,0];for(Y=0,ie=V.down.length;Y<ie;Y++)k[V.down[Y]]=[0,D];for(Y=0,ie=V.up.length;Y<ie;Y++)k[V.up[Y]]=[0,-1*D]},_setZoomDelta:function(D){var k=this._zoomKeys={},V=this.keyCodes,Y,ie;for(Y=0,ie=V.zoomIn.length;Y<ie;Y++)k[V.zoomIn[Y]]=D;for(Y=0,ie=V.zoomOut.length;Y<ie;Y++)k[V.zoomOut[Y]]=-D},_addHooks:function(){oi(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){jn(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(D){if(!(D.altKey||D.ctrlKey||D.metaKey)){var k=D.keyCode,V=this._map,Y;if(k in this._panKeys){if(!V._panAnim||!V._panAnim._inProgress)if(Y=this._panKeys[k],D.shiftKey&&(Y=F(Y).multiplyBy(3)),V.options.maxBounds&&(Y=V._limitOffset(F(Y),V.options.maxBounds)),V.options.worldCopyJump){var ie=V.wrapLatLng(V.unproject(V.project(V.getCenter()).add(Y)));V.panTo(ie)}else V.panBy(Y)}else if(k in this._zoomKeys)V.setZoom(V.getZoom()+(D.shiftKey?3:1)*this._zoomKeys[k]);else if(k===27&&V._popup&&V._popup.options.closeOnEscapeKey)V.closePopup();else return;ml(D)}}});ei.addInitHook("addHandler","keyboard",QZ),ei.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var eX=Ns.extend({addHooks:function(){oi(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){jn(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(D){var k=ut(D),V=this._map.options.wheelDebounceTime;this._delta+=k,this._lastMousePos=this._map.mouseEventToContainerPoint(D),this._startTime||(this._startTime=+new Date);var Y=Math.max(V-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(s(this._performZoom,this),Y),ml(D)},_performZoom:function(){var D=this._map,k=D.getZoom(),V=this._map.options.zoomSnap||0;D._stop();var Y=this._delta/(this._map.options.wheelPxPerZoomLevel*4),ie=4*Math.log(2/(1+Math.exp(-Math.abs(Y))))/Math.LN2,me=V?Math.ceil(ie/V)*V:ie,Pe=D._limitZoom(k+(this._delta>0?me:-me))-k;this._delta=0,this._startTime=null,Pe&&(D.options.scrollWheelZoom==="center"?D.setZoom(k+Pe):D.setZoomAround(this._lastMousePos,k+Pe))}});ei.addInitHook("addHandler","scrollWheelZoom",eX);var kNe=600;ei.mergeOptions({tapHold:kt.touchNative&&kt.safari&&kt.mobile,tapTolerance:15});var tX=Ns.extend({addHooks:function(){oi(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){jn(this._map._container,"touchstart",this._onDown,this)},_onDown:function(D){if(clearTimeout(this._holdTimeout),D.touches.length===1){var k=D.touches[0];this._startPos=this._newPos=new O(k.clientX,k.clientY),this._holdTimeout=setTimeout(s(function(){this._cancel(),this._isTapValid()&&(oi(document,"touchend",La),oi(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",k))},this),kNe),oi(document,"touchend touchcancel contextmenu",this._cancel,this),oi(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function D(){jn(document,"touchend",La),jn(document,"touchend touchcancel",D)},_cancel:function(){clearTimeout(this._holdTimeout),jn(document,"touchend touchcancel contextmenu",this._cancel,this),jn(document,"touchmove",this._onMove,this)},_onMove:function(D){var k=D.touches[0];this._newPos=new O(k.clientX,k.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(D,k){var V=new MouseEvent(D,{bubbles:!0,cancelable:!0,view:window,screenX:k.screenX,screenY:k.screenY,clientX:k.clientX,clientY:k.clientY});V._simulated=!0,k.target.dispatchEvent(V)}});ei.addInitHook("addHandler","tapHold",tX),ei.mergeOptions({touchZoom:kt.touch,bounceAtZoomLimits:!0});var iX=Ns.extend({addHooks:function(){Bi(this._map._container,"leaflet-touch-zoom"),oi(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){vr(this._map._container,"leaflet-touch-zoom"),jn(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(D){var k=this._map;if(!(!D.touches||D.touches.length!==2||k._animatingZoom||this._zooming)){var V=k.mouseEventToContainerPoint(D.touches[0]),Y=k.mouseEventToContainerPoint(D.touches[1]);this._centerPoint=k.getSize()._divideBy(2),this._startLatLng=k.containerPointToLatLng(this._centerPoint),k.options.touchZoom!=="center"&&(this._pinchStartLatLng=k.containerPointToLatLng(V.add(Y)._divideBy(2))),this._startDist=V.distanceTo(Y),this._startZoom=k.getZoom(),this._moved=!1,this._zooming=!0,k._stop(),oi(document,"touchmove",this._onTouchMove,this),oi(document,"touchend touchcancel",this._onTouchEnd,this),La(D)}},_onTouchMove:function(D){if(!(!D.touches||D.touches.length!==2||!this._zooming)){var k=this._map,V=k.mouseEventToContainerPoint(D.touches[0]),Y=k.mouseEventToContainerPoint(D.touches[1]),ie=V.distanceTo(Y)/this._startDist;if(this._zoom=k.getScaleZoom(ie,this._startZoom),!k.options.bounceAtZoomLimits&&(this._zoom<k.getMinZoom()&&ie<1||this._zoom>k.getMaxZoom()&&ie>1)&&(this._zoom=k._limitZoom(this._zoom)),k.options.touchZoom==="center"){if(this._center=this._startLatLng,ie===1)return}else{var me=V._add(Y)._divideBy(2)._subtract(this._centerPoint);if(ie===1&&me.x===0&&me.y===0)return;this._center=k.unproject(k.project(this._pinchStartLatLng,this._zoom).subtract(me),this._zoom)}this._moved||(k._moveStart(!0,!1),this._moved=!0),M(this._animRequest);var Pe=s(k._move,k,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=P(Pe,this,!0),La(D)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,M(this._animRequest),jn(document,"touchmove",this._onTouchMove,this),jn(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});ei.addInitHook("addHandler","touchZoom",iX),ei.BoxZoom=ZZ,ei.DoubleClickZoom=XZ,ei.Drag=JZ,ei.Keyboard=QZ,ei.ScrollWheelZoom=eX,ei.TapHold=tX,ei.TouchZoom=iX,i.Bounds=j,i.Browser=kt,i.CRS=K,i.Canvas=An,i.Circle=bE,i.CircleMarker=gg,i.Class=N,i.Control=bn,i.DivIcon=xt,i.DivOverlay=Ge,i.DomEvent=Di,i.DomUtil=dg,i.Draggable=rp,i.Evented=x,i.FeatureGroup=wd,i.GeoJSON=Wo,i.GridLayer=Pt,i.Handler=Ns,i.Icon=fg,i.ImageOverlay=He,i.LatLng=q,i.LatLngBounds=G,i.Layer=wc,i.LayerGroup=Xv,i.LineUtil=W2,i.Map=ei,i.Marker=mg,i.Mixin=mE,i.Path=$r,i.Point=O,i.PolyUtil=nI,i.Polygon=_f,i.Polyline=sp,i.Popup=Ke,i.PosAnimation=$n,i.Projection=Y2,i.Rectangle=xf,i.Renderer=Ji,i.SVG=kf,i.SVGOverlay=Ve,i.TileLayer=$t,i.Tooltip=dt,i.Transformation=re,i.Util=R,i.VideoOverlay=qe,i.bind=s,i.bounds=H,i.canvas=Jl,i.circle=IE,i.circleMarker=Sc,i.control=ts,i.divIcon=jt,i.extend=r,i.featureGroup=eA,i.geoJSON=ke,i.geoJson=$e,i.gridLayer=Ft,i.icon=K2,i.imageOverlay=Re,i.latLng=Z,i.latLngBounds=W,i.layerGroup=QN,i.map=Da,i.marker=ph,i.point=F,i.polygon=Jv,i.polyline=vg,i.popup=et,i.rectangle=wE,i.setOptions=m,i.stamp=l,i.svg=Ko,i.svgOverlay=je,i.tileLayer=Bt,i.tooltip=yt,i.transformation=oe,i.version=n,i.videoOverlay=Be;var xNe=window.L;i.noConflict=function(){return window.L=xNe,this},window.L=i}))})(iP,iP.exports)),iP.exports}var Z_=lpt();function upt(){try{return navigator||window.navigator}catch(t){console.log(t);return}}function cpt({coords:t,callback:e}){let i=16;(!t?.latitude||!t?.longitude)&&(t={latitude:0,longitude:0},i=2);const n={map:"latLongMap",link:"latLonglink"},a=`
         <div style='min-height: 150px'>
         <h2 class='tmx-title'>Enter map URL</h2>
         <div class='flexcenter'>${_s.tr("phrases.addgooglemap")}</div>
         <div class='flexcenter flexcol'>
            <input id='${n.link}' value='' style='text-align: center; width: 25em; margin: 1em;'>
            <div class='flexrow' style='margin-top: 1em; margin-bottom: 1em;'>
            </div>
         </div>
         <div class='location_detail_body' style='min-width: 350px; min-height: 350px;'>
            <div id='${n.map}' class='location_map' style='width: 100%; height: 100%; min-width: 350px; min-height: 350px;'>
         </div>
      `,l=[{label:"Cancel",intent:"none",close:!0},{onClick:m,intent:"is-warning",label:"Clear"},{onClick:()=>{!t.latitude||!t.longitude?u():m(t)},intent:"is-primary",label:"View",close:!1},{onClick:()=>{(!t.latitude||!t.longitude)&&u(),Mt(e)&&e&&e(t)},intent:"is-info",label:"Submit",close:!0}],u=()=>{const g=d.link.element?.value,v=rpt(g)||apt(g)||npt(g)||spt(g);v.latitude?m(v):g&&v.latitude===void 0&&Ht({message:"Invalid URL"})},c=g=>{g.key==="Enter"&&u()};Yn({title:"Location",content:a,buttons:l});const d=fCe(n),{map:p,marker:h}=dpt({successElement:d.map.element,mapElementId:d.map.id,coords:t,zoom:i});d.link.element&&(d.link.element.value="",d.link.element.focus(),d.link.element.addEventListener("keyup",c)),p&&(p.on("click",g=>f({latitude:g.latlng.lat,longitude:g.latlng.lng})),p.on("contextmenu",g=>console.log("Coordinates: "+g.latlng.toString())));function f({latitude:g,longitude:v}){t={latitude:g,longitude:v};const y=new Z_.LatLng(g,v);h.setLatLng(y)}function m({latitude:g=0,longitude:v=0}={}){return g&&v?(t={latitude:+g,longitude:+v},p.setView([+g,+v],16),!0):(t={latitude:0,longitude:0},p.fitWorld(),!1)}}function dpt({successElement:t,mapElementId:e,coords:i,zoom:n}){if(!upt()?.onLine)return{};if(i.latitude&&i.longitude)return t&&(t.style.display="inline"),a(i.latitude,i.longitude,n);return{};function a(s,o,l){if(isNaN(s)||isNaN(o))return{};const u=zi.locations.map_view||"map",c=Z_.tileLayer(zi.leaflet[u].tileLayer,{attribution:zi.leaflet[u].attribution,maxZoom:zi.leaflet[u].maxZoom??16}),d=Z_.map(e).fitWorld().addLayer(c);(s||o)&&d.setView([+s,+o],l);const p=Z_.marker([+s,+o]).addTo(d);return setTimeout(function(){d.invalidateSize()},300),{map:d,marker:p}}}function ppt(t,e){const i=e.getRow().getData(),{latitude:n,longitude:r}=i?.address||{};cpt({coords:{latitude:n,longitude:r},callback:(s={})=>{i.address||(i.address={});const o=i.venue;o.addresses||(o.addresses=[]),o.addresses.length?Object.assign(o.addresses[0],{latitude:s.latitude,longitude:s.longitude}):o.addresses.push({latitude:s.latitude,longitude:s.longitude});const l=c=>{if(c.results?.[0]?.success){const d=e.getTable();i.address.latitude=s.latitude,i.address.longitude=s.longitude,i.hasLocation=s.latitude&&s.longitude,d.updateData([i])}},u=[{method:zJe,params:{venueId:i.venueId,modifications:{addresses:o.addresses}}}];Wt({methods:u,callback:l})}})}function hpt(){const t=()=>console.log("Venue actions"),e=i=>i.getValue()?'<i class="fa-sharp fa-solid fa-location-dot" style="color: blue"></i>':"?";return[{cellClick:(i,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:hi,width:5},{headerMenu:rg({scheduledMatchUpsCount:"Scheduled matches",availableTime:"Time Available",courtsCount:"Number of courts",hasLocation:"Location"}),formatter:"rownum",headerSort:!1,hozAlign:di,width:55},{cellClick:tw,field:"venueAbbreviation",title:"Abbr",visible:!0,width:120},{cellClick:tw,field:"venueName",title:"Venue",visible:!0,minWidth:200,widthGrow:3},{title:'<div class="event_icon surface_header"></div>',headerTooltip:"Number of courts",headerHozAlign:di,field:"courtsCount",hozAlign:di,headerSort:!0,visible:!0,width:50},{title:"Scheduled",headerTooltip:"Scheduled matches",field:"scheduledMatchUpsCount",headerHozAlign:di,headerSort:!0,hozAlign:di,visible:!0,minWidth:120},{title:"Time",headerHozAlign:di,field:"availableTime",headerSort:!0,hozAlign:di,visible:!0,minWidth:120},{title:'<i class="fa-sharp fa-solid fa-location-dot"></i>',formatter:e,headerTooltip:"Location",headerHozAlign:di,cellClick:ppt,field:"hasLocation",headerSort:!1,hozAlign:di,visible:!0,width:50},{cellClick:tw,formatter:zK,responsive:!1,headerSort:!1,hozAlign:ti,field:"isOpen",width:20},{cellClick:t,formatter:Vv,responsive:!1,headerSort:!1,hozAlign:ti,width:50}]}function fpt({table:t}={}){const e=()=>{const{venues:r}=wm.getVenuesAndCourts();return{rows:r.map(U1e)}},i=()=>{const{rows:r}=e();t?.replaceData(r)},n=hpt();if(t)i();else{ng({anchorId:Gk});const r=document.getElementById(Gk),{rows:a}=e();t=new Bs(r,{headerSortElement:wf(["scheduledMatchUpsCount","venueAbbreviation","availableTime","courtsCount","venueName"]),minHeight:window.innerHeight*.81,rowFormatter:ipt,placeholder:"No venues",layout:"fitColumns",reactiveData:!0,index:"venueId",columns:n,data:a}),t.on("scrollVertical",Nd),t.on("cellEdited",s=>{const o=s.getColumn().getDefinition(),l=s.getRow().getData(),u=s.getValue();console.log({cell:s,row:l,value:u,def:o})})}return{table:t,replaceTableData:i}}function mpt({table:t,updateVenueRow:e,controlAnchor:i}={}){return i?wo({table:t,target:i,items:[{onClick:()=>{const a=t.getSelectedData().map(({venueId:l})=>l);Wt({methods:[{method:VJe,params:{venueIds:a,force:!0}}],callback:l=>l.success&&t.deleteRow(a)})},label:"Delete selected",intent:"is-danger",stateChange:!0,location:ba},{label:"Add venue",onClick:()=>QCe(e),location:ti,id:"addVenue",intent:"none"}]})?.elements:void 0}function gpt(){const t=document.getElementById(E6)||void 0,{table:e}=fpt();mpt({table:e,controlAnchor:t,updateVenueRow:({venue:n})=>{e.updateOrAddData([U1e(n)])}})}const{POLICY_TYPE_AVOIDANCE:kie}=Ub;function D1e({eventId:t,drawId:e}){return nt.getPolicyDefinitions({policyTypes:[kie],eventId:t,drawId:e})?.policyDefinitions?.[kie]?.policyAttributes}const Vz={city:[{key:"person.addresses.city"},{key:"individualParticipants.person.addresses.city"}],state:[{key:"person.addresses.state"},{key:"individualParticipants.person.addresses.state"}],postal:[{key:"person.addresses.postalCode",significantCharacters:5},{key:"individualParticipants.person.addresses.postalCode",significantCharacters:5}],iso:[{key:"person.addresses.country"},{key:"individualParticipants.person.addresses.country"}],groups:[{directive:"groupParticipants"}],pairs:[{directive:"pairParticipants"}],teams:[{directive:"teamParticipants"}]};function vpt({event:t}){const i=D1e({eventId:t.eventId})?.map(r=>Object.keys(Vz).find(a=>Vz[a].some(o=>o.directive&&o.directive===r.directive||o.key&&o.key===r.key))).filter(Boolean)??[];return{items:[{text:"Select rules"},{checked:i.includes("pairs"),label:"Doubles pairs",id:"avoidancePairs",checkbox:!0,field:"pairs"},{checked:i.includes("groups"),id:"avoidanceGroups",checkbox:!0,label:"Groups",field:"groups"},{checked:i.includes("teams"),id:"avoidanceTeams",checkbox:!0,label:"Teams",field:"teams"},{checked:i.includes("iso"),id:"avoidanceCountry",label:"Country",checkbox:!0,field:"iso"},{checked:i?.includes("city"),id:"avoidancedCity",checkbox:!0,label:"City",field:"city"},{checked:i.includes("state"),id:"avoidancedState",checkbox:!0,label:"State",field:"state"},{checked:i.includes("zip"),id:"avoidancedPostal",label:"Postal code",checkbox:!0,field:"zip"},{label:"Postal code digits",visible:!1,field:"zip"}]}}function E1e({eventId:t}){const e=nt.getEvent({eventId:t}).event;if(!e)return;const{items:i}=vpt({event:e});let n;const r=!0,a=c=>n=mr(c,i),o=[{label:"Cancel",intent:Rt,close:!0},{label:"Save",id:"setAvoidances",intent:"is-info",onClick:()=>{const d=Object.keys(n).filter(f=>n[f].checked).flatMap(f=>Vz[f]).filter(Boolean);Wt({methods:[{method:FJe,params:{policyDefinitions:{avoidance:{policyAttributes:d}},allowReplacement:!0,eventId:t}}],callback:f=>{if(f.success){const m="is-success",g=document.getElementById("editAvoidances");g&&(d.length?g.classList.add(m):g.classList.remove(m))}else Ht({message:"Error",intent:"is-danger"})}})},close:r}],l="Set avoidances",u=(c,d)=>eS(c,o,d);It.drawer.open({title:l,content:a,footer:u,side:ti,width:"300px"})}const{WTN:ypt,UTR:bpt}=Uo.ratingConstants,{TEAM:Ipt}=Uo.eventConstants,{QUALIFYING:xie}=Zr;function U2({entry:t,derivedDrawInfo:e,participants:i,participant:n,eventType:r,categoryName:a,eventId:s}){n=n||i?.find(y=>y.participantId===t.participantId);const o=n?.draws?.filter(y=>y.eventId===s).map(y=>({...y,drawName:e[y.drawId].drawName}))??[],l=n?.person?.addresses?.[0],u=l?`${l.city}, ${l.state}`:void 0,c=r===Ipt?"AVERAGE":r,d=n?.ratings?.[c]?.find(y=>y.scaleName===ypt)?.scaleValue,p=n?.ratings?.[c]?.find(y=>y.scaleName===bpt)?.scaleValue,h={wtn:d,utr:p},f=n?.rankings?.[r]?.find(y=>y.scaleName===a)?.scaleValue,m=t.entryStage===xie?`${s}${xie}`:s,g=n?.seedings?.[r]?.find(y=>y.scaleName===m)?.scaleValue,v=yge[t.entryStatus];return{searchText:n?.participantName.toLowerCase(),participant:n,seedNumber:g,cityState:u,...t,ranking:f,ratings:h,flights:o,status:v}}function bh(t){return Mi.isConvertableInteger(t)&&parseInt(t.toString())>=0}const P1e=(t,e)=>i=>bh(i)&&Number(i)>=t&&Number(i)<=e,{ORGANISER_ACCEPTANCE:wpt,DIRECT_ACCEPTANCE:Spt,SPECIAL_EXEMPT:Tpt,JUNIOR_EXEMPT:Upt,WILDCARD:Dpt}=md,{MAIN:Ept}=Zr,sO=(t=Ept)=>[`${t}.${Spt}`,`${t}.${wpt}`,`${t}.${Tpt}`,`${t}.${Upt}`,`${t}.${Dpt}`],{MAIN:Oie}=Zr;function X_(t,e=Oie){return t.entries.filter(({entryStage:i=Oie,entryStatus:n})=>sO(e).includes(`${i}.${n}`)).length}const{FEED_IN:Ppt,LUCKY_DRAW:Cpt,MAIN:Rpt,QUALIFYING:Mpt,ROUND_ROBIN:Lie,ROUND_ROBIN_WITH_PLAYOFF:AA}=Zr;function Npt({event:t,isQualifying:e,maxQualifiers:i}){const n=e?Mpt:Rpt,r=({fields:p,inputs:h})=>{const f=h[dy].value||0,m=bh(f)?parseInt(f):0,g=X_(t,n),v=h.qualifiersCount.value||0,y=bh(v)?parseInt(v):0,b=i||e&&m<g||m<g+y;b&&(h[Ou].value=f6);const I=p&&dv(p[Ou],"help")?.[0];I&&(I.style.display=b?"":Rt);for(const S of h[Ou].options)S.label===Ou&&(S.disabled=b)},a=({drawType:p,fields:h,inputs:f})=>{const m=i?f[dy].value:X_(t,n),g=f.qualifiersCount.value||1,v=bh(g)&&parseInt(g)||i?1:0,y=e&&!i?m:parseInt(m)+v,b=(i||[Cpt,Ppt,Lie,AA].includes(p))&&y||Mi.nextPowerOf2(y);return f[dy].value=b,r({fields:h,inputs:f}),b},s=({fields:p,inputs:h})=>{let f=parseInt(h[dy].value);const m=h.qualifiersCount.value;bh(m)&&parseInt(m)<1&&(h.qualifiersCount.value=i?1:0);const g=document.getElementById("generateDraw");let v=h.qualifiersCount.value;if(g&&(g.disabled=!1),i&&bh(v)&&parseInt(v)>i)h.qualifiersCount.value=i;else if(!i){const y=h[Ph].value;f=a({drawType:y,fields:p,inputs:h})}v=h.qualifiersCount.value,g&&(!bh(v)||f<=parseInt(v))&&(g.disabled=!0)},o=({e:p,fields:h,inputs:f})=>{const m=f[yP].value,g=p.target.value;if(i||a({drawType:g,fields:h,inputs:f}),r({fields:h,inputs:f}),h){h[$S].style.display=g===AA&&m===bP?"":Rt,h[yP].style.display=g===AA?"":Rt;const v=[Lie,AA].includes(g);h[Wf].style.display=v?"":Rt}},l=({fields:p,inputs:h})=>{const f=document.getElementById("generateDraw"),m=h[dy].value||0,g=bh(m)?parseInt(m):0,v=X_(t,n),y=Math.max(Mi.nextPowerOf2(v),512),b=P1e(2,y)(m);f&&(f.disabled=!b);const{validGroupSizes:I}=nt.getValidGroupSizes({drawSize:g,groupSizeLimit:8}),S=I.map(U=>({label:U,value:U})),w=h[Wf],T=I.includes(g)?4:I[0];Js(w),G6(w,{options:S,value:T}),r({fields:p,inputs:h})},u=({e:p,fields:h})=>{const f=p.target.value;h&&(h[$S].style.display=f===bP?"":Rt,h[Yk].style.display=f===bP?"":Rt)},c=({inputs:p})=>{const h=parseInt(p[Wf].value),f=p[$S].options,m=Array.from(f).map(v=>parseInt(v.value)),g=Math.max(...m);g>h?Mi.generateRange(h+1,g+1).reverse().forEach(v=>{p[$S].remove(v-2)}):g<h&&Mi.generateRange(g+1,h+1).forEach(v=>p[$S].add(new Option(v.toString(),v.toString())))},d=({inputs:p,name:h})=>{const f=p[h].value,m=document.getElementById("generateDraw"),g=Vr(4)(f);m&&(m.disabled=!g)};return[{onInput:({inputs:p})=>d({inputs:p,name:vw}),control:vw},{onInput:({inputs:p})=>d({inputs:p,name:AC}),control:AC},{onChange:c,control:Wf},{onChange:o,control:Ph},{onChange:u,control:yP},{onInput:l,control:dy},{onInput:s,control:Wk}]}const{AD_HOC:Apt,COMPASS:_pt,CURTIS:kpt,DOUBLE_ELIMINATION:xpt,FEED_IN_CHAMPIONSHIP:Opt,FEED_IN:Lpt,FIRST_MATCH_LOSER_CONSOLATION:Fpt,FIRST_ROUND_LOSER_CONSOLATION:$pt,LUCKY_DRAW:Bpt,OLYMPIC:Vpt,PLAY_OFF:jpt,ROUND_ROBIN:Gpt,ROUND_ROBIN_WITH_PLAYOFF:Hpt,SINGLE_ELIMINATION:zpt}=Zr;function C1e({isPlayoff:t,isQualifying:e}={}){return[{label:"Ad-hoc",value:Apt,hide:e},{label:"Compass",value:_pt,hide:e},{label:"Curtis consolation",value:kpt,hide:e},{label:"Double elimination",value:xpt,hide:t||e},{label:"Elimination: fed consolation",value:Opt,hide:e},{label:"First match loser consolation",value:Fpt,hide:e},{label:"First round loser consolation",value:$pt,hide:e},{label:"Lucky",value:Bpt,hide:t||e},{label:"Olympic",value:Vpt,hide:e},{label:"Playoff",value:jpt,hide:e},{label:"Round robin w/ playoff",value:Hpt,hide:t||e},{label:"Round robin",value:Gpt},{label:"Single elimination",value:zpt},{label:"Staggered Entry",value:Lpt,hide:t||e}]}const{POLICY_TYPE_SCORING:qpt}=Ub,{MAIN:Wpt}=Zr,Ypt={[qpt]:{requireAllPositionsAssigned:!1,stage:{[Wpt]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:"SET3-S:6/TB7",matchUpFormats:[{categoryNames:[],categoryTypes:[],description:"Best of 3 sets with 7-point tiebreak at 6-6",matchUpFormat:"SET3-S:6/TB7"},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One set set to 6, 7-point tiebreak at 6-6",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three sets to 4 with 5-point tiebreak at 3-3",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One set to 4, 7-point tiebreak at 4-4",matchUpFormat:"SET1-S:4/TB7"},{description:"One set to 4, 5-point tiebreak at 3-3",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5-5",matchUpFormat:"SET1-S:6NOAD"},{description:"One set to 4, deciding game is played at 3-3",matchUpFormat:"SET1-S:4NOAD"},{description:"8 game pro-set with 7 point tiebreak at 8-8",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7-7",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20G"},{description:"Timed 20 minute game - point based",matchUpFormat:"SET1-S:T20P"},{description:"Aggregate Points - Four 10 minute quarters",matchUpFormat:"SET4-S:T10P"}]}},{ROUND_ROBIN:Kpt,ROUND_ROBIN_WITH_PLAYOFF:Fie,SINGLE_ELIMINATION:Zpt,QUALIFYING:Xpt,MAIN:$ie}=Zr,{DOMINANT_DUO:Jpt,COLLEGE_DEFAULT:Qpt,LAVER_CUP:eht}=Uo.tieFormatConstants,{POLICY_TYPE_SCORING:tht}=Ub,{TEAM:Bie}=dl,{ENTRY_PROFILE:iht}=Uo.extensionConstants;function nht({event:t,drawId:e,isQualifying:i,structureId:n}){const r=i?Xpt:$ie,a=t.drawDefinitions?.length||0,s=Zpt,o=e&&t.drawDefinitions?.find(T=>T.drawId===e),l=n&&nt.getPositionAssignments({drawId:e,structureId:n})?.positionAssignments,u=nt.findExtension({element:o,name:iht})?.extension?.value,c=n?1:0,d=!n&&u?.[$ie]?.qualifiersCount||c,p="Qualifying",h=l?.length||Mi.nextPowerOf2(X_(t,r)),f=Math.max(h,512),m=[{label:"Custom",value:qk}].concat(Ypt[tht].matchUpFormats.map(({matchUpFormat:T,description:U})=>({selected:T==="SET3-S:6/TB7",value:T,label:U}))),g=[{label:"Dominant Duo",value:Jpt,selected:!0},{label:"College Default",value:Qpt},{label:"Laver Cup",value:eht},{label:"Custom",value:qk}],{validGroupSizes:v}=nt.getValidGroupSizes({drawSize:32,groupSizeLimit:8}),y=v.map(T=>({label:T,value:T})),b=[{label:"Group winners",value:Fje},{label:"Group positions",value:bge},{label:"Top finishers",value:bP}],I=[{label:"2",value:2},{label:"3",value:3},{label:"4",value:4}],S=[{label:Ou,value:Ou,selected:!n,disabled:!!n},{label:f6,value:!1,selected:n}];return{items:[{error:"minimum of 4 characters",placeholder:"Display name of the structure",validator:Vr(4),label:"Structure name",value:p,field:AC,selectOnFocus:!0,hide:!i},{error:"minimum of 4 characters",placeholder:"Display name of the draw",value:`Draw ${a+1}`,validator:Vr(4),selectOnFocus:!0,hide:i,label:"Draw name",field:vw,focus:!0},{options:C1e({isQualifying:i}),label:"Draw Type",field:Ph,value:s},{error:`Must be in range 2-${f}`,validator:P1e(2,f),selectOnFocus:!0,label:"Draw size",value:h,field:dy},{visible:[Kpt,Fie].includes(s),options:y,label:"Group size",field:Wf,value:4},{visible:[Fie].includes(s),options:b,label:"Playoff Type",field:yP},{label:"Advance per group",options:I,field:$S,visible:!1},{label:"2nd playoff from remaining",field:Yk,id:Yk,checkbox:!0,visible:!1},{help:{text:"Automation disabled",visible:!1},options:S,label:"Creation",field:Ou,value:""},{hide:t.eventType===Bie,options:m,field:_6,label:"Score format",value:""},{hide:t.eventType!==Bie,options:g,field:"tieFormatName",label:"Scorecard",value:""},{disabled:i&&!n,validator:bh,field:Wk,value:d,selectOnFocus:!0,label:"Qualifiers"}],structurePositionAssignments:l}}function Vie({eventId:t,drawOptions:e,callback:i}){const n=zi.scales[zi.activeScale?.toLowerCase()],r={scaleAccessor:n?.accessor,scaleName:n?.scaleName},a=nt.generateDrawDefinition({...e,...r,ignoreStageSpace:!0});if(a.success){const s=a.drawDefinition;Wt({methods:[{method:EJe,params:{eventId:t,drawDefinition:s,allowReplacement:!0}}],callback:u=>Mt(i)&&i&&i({drawDefinition:s,...u})})}else a.error&&Ht({message:a.error?.message||"Error",intent:"is-warning",pauseOnHover:!0})}const{POLICY_TYPE_SEEDING:rht}=Ub,{SEPARATE:aht}=Zr,{SEEDING:sht}=QU,R1e={[rht]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:aht,policyName:sht,seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},{AD_HOC:oht,FEED_IN:lht,LUCKY_DRAW:uht,MAIN:cht,QUALIFYING:dht,ROUND_ROBIN:jie,ROUND_ROBIN_WITH_PLAYOFF:Gie}=Zr,{TIME_TENNIS_PRO_CIRCUIT:pht}=Uo.tieFormatConstants,{DIRECT_ENTRY_STATUSES:Hie}=md,{POLICY_TYPE_ROUND_NAMING:hht}=Ub;function zie({drawName:t,matchUpFormat:e,isQualifying:i,structureId:n,callback:r,inputs:a,drawId:s,event:o}){const l=a[Ph].options[a[Ph].selectedIndex].getAttribute("value"),u=e||a[_6]?.value,c=a[AC]?.value,d=a.tieFormatName?.value,p=a[vw]?.value,h=a[dy].value||0,f=parseInt(a[Wf].value),m=Mi.isConvertableInteger(h)&&parseInt(h),g=[uht,lht,jie,Gie].includes(l)&&m||Mi.nextPowerOf2(m),v=o.entries.filter(({entryStage:M,entryStatus:R})=>M===dht&&Hie.includes(R)),y=i&&v.length?v:o.entries.filter(({entryStage:M,entryStatus:R})=>(!M||M===cht)&&Hie.includes(R)),b=g<y.length?!1:a[Ou].value===Ou,I=o.eventId,S={drawEntries:y,automated:b,eventId:I,drawId:s},w=parseInt(a.advancePerGroup?.value||0),T=a[Yk]?.checked,U=a[yP]?.value;let C;if(l===Gie){const M=[];if(U===bP){const R=[Mi.generateRange(1,w+1)];if(T){const N=Mi.generateRange(w+1,f+1);N.length&&R.push(N)}R.forEach((N,A)=>{M.push({structureName:`Playoff ${A+1}`,finishingPositions:N})})}else U===bge&&Mi.generateRange(1,f+1).forEach(R=>{M.push({structureName:`Playoff ${R}`,finishingPositions:[R]})});C={groupSize:f},M.length&&(C.playoffGroups=M)}else l===jie?C={groupSize:f}:l===oht&&Object.assign(S,{roundsCount:1});const E=nt.getSeedsCount({participantsCount:y?.length,policyDefinitions:R1e,drawSizeProgression:!0})?.seedsCount,P=bh(a[Wk].value)&&parseInt(a[Wk]?.value)||0;if(n){const M=nt.generateQualifyingStructure({qualifyingPositions:P,targetStructureId:n,structureOptions:C,matchUpFormat:u,structureName:c,automated:b,drawSize:g,drawType:l,drawId:s});if(M.success){const R=[{method:LJe,params:{structure:M.structure,link:M.link,eventId:I,drawId:s}}];Wt({methods:R,callback:A=>Mt(r)&&r&&r({...M,...A.results?.[0]})})}return}if(i?(S.drawName=t,S.qualifyingProfiles=[{structureProfiles:[{qualifyingPositions:P,structureOptions:C,matchUpFormat:u,structureName:c,seedsCount:E,drawSize:g,drawType:l}]}]):(P&&(S.qualifiersCount=P,S.qualifyingPlaceholder=!0),Object.assign(S,{seedingScaleName:I,structureOptions:C,matchUpFormat:u,seedsCount:E,drawName:p,drawSize:g,drawType:l})),m)if(d===qk)p1e({title:"Custom scorecard",tieFormat:void 0,onClose:R=>{R&&(S.tieFormat=R,Vie({drawOptions:S,eventId:I,callback:r}))}});else{if(S.tieFormatName=d,d===pht){const M={[hht]:{namingConventions:{round:"Day"},affixes:{roundNumber:"D"},policyName:"TTPro 4 Day"}};S.policyDefinitions={...M}}Vie({drawOptions:S,eventId:I,callback:r})}else Ht({message:"Invalid draw size",intent:"is-warning",pauseOnHover:!0})}function NU({eventId:t,callback:e,drawId:i,drawName:n,structureId:r,isQualifying:a}){const s=nt.getEvent({eventId:t}).event;if(!s)return;const{items:o,structurePositionAssignments:l}=nht({event:s,drawId:i,isQualifying:a,structureId:r}),u=Npt({maxQualifiers:l?.length,isQualifying:a,event:s});let c;const d=v=>{c=mr(v,o,u)},p=()=>a?Vr(4)(c[AC].value):Vr(4)(c[vw].value),f=[{label:"Cancel",intent:Rt,close:!0},{label:"Generate",id:"generateDraw",intent:"is-primary",onClick:()=>{p()?c.matchUpFormat?.value===qk?tZ({callback:y=>{y&&zie({event:s,inputs:c,callback:e,structureId:r,matchUpFormat:y,drawId:i,drawName:n,isQualifying:a})}}):zie({event:s,inputs:c,callback:e,structureId:r,drawId:i,drawName:n,isQualifying:a}):Ht({message:"Missing Draw name",intent:"is-danger"})},close:p}],m="Configure draw",g=(v,y)=>eS(v,f,y);It.drawer.open({title:m,content:d,footer:g,side:ti,width:"300px"})}const Sj={high:[80,100],medium:[60,80],low:[40,60]},{ratingsParameters:fht}=Sm,qie=t=>(e,i)=>{const n=fht[t];if(!n)return 0;const{accessor:r,ascending:a}=n,s=!a,o=Wie(e),l=Wie(i);if(o<l)return 1;if(l<o)return-1;const u=e?.[r]||0,c=i?.[r]||0;return s?u-c:c-u};function Wie(t){const e=oO(t.confidence??100);return e==="high"&&100||e==="medium"&&80||e==="low"&&60||0}function oO(t){return parseInt(t.toString())>=Sj.high[0]?"high":parseInt(t.toString())>=Sj.medium[0]?"medium":parseInt(t.toString())>=Sj.low[0]?"low":"unrated"}const{ratingsParameters:mht}=Sm,Yie=t=>e=>{const i=mht[t],{accessor:n}=i,r=e.getValue(),a=r?.confidence??100,s=r?.[n],o=oO(a),l=document.createElement("span"),u={medium:"darkgreen",low:"lightblue",high:"blue"};return l.style.color=u[o],l.innerHTML=s??"",l},{SINGLES:ght}=dl,vht=t=>e=>{e.getColumn().getDefinition();const i=document.createElement("div");i.className="tags";const n=o=>t({...o,renderDraw:!0}),r=e.getValue(),a=e.getRow().getData(),{participantId:s}=a;return r?.forEach(o=>{const l=yht({flight:o,flightClick:n});i.appendChild(l)}),i};function yht({flight:t,flightClick:e}){const i=document.createElement("span");return Mt(e)&&e&&(i.onclick=()=>e(t)),i.className="tag event-pill",t.gender?.toLowerCase().includes("female")?i.classList.add("is-danger"):t.gender?.toLowerCase().includes("male")?i.classList.add("is-link"):i.classList.add("is-primary"),t.eventType===ght&&i.classList.add("is-light"),i.innerHTML=t.drawName,i}const{MAIN:bht,QUALIFYING:Tj}=Zr,{DIRECT_ACCEPTANCE:Kie}=md;function M1e({participantIds:t,group:e,eventId:i,drawId:n,callback:r}){Wt({methods:[{method:zEe,params:{autoEntryPositions:!0,participantIds:t,entryStatus:e===Ud&&Kie||e===Tj&&Kie||e,entryStage:e===Tj?Tj:bht,eventId:i,drawId:n}}],callback:r})}const{ALTERNATE:Zie,DIRECT_ACCEPTANCE:Xie,WITHDRAWN:Jie,UNGROUPED:Iht}=md,{QUALIFYING:Qie}=Zr,wht=(t,e,i)=>(n,r)=>{const{participant:a}=r.getRow().getData(),s=u=>()=>{const c=p=>{if(p.success){const h=r.getRow(),f=u===Ud?Xie:u;It.tables[f]?.addRow(h.getData()),h.delete()}else console.log({result:p})},d=[a.participantId];M1e({participantIds:d,callback:c,eventId:e,drawId:i,group:u})},o=()=>{const u=nt.destroyPairEntry({participantIds:[a.participantId],autoEntryPositions:!0,eventId:e,drawId:i});console.log({result:u})},l=[{onClick:s(Xie),option:"Move to accepted",action:Ud},{onClick:s(Qie),option:"Move to qualifying",action:Qie},{onClick:s(Zie),option:"Move to alternates",action:Zie},{onClick:o,option:"Unpair players",action:Iht},{onClick:s(Jie),option:"Withdraw participant",action:Jie}].filter(u=>t.includes(u.action));if(l.length){const u=n.target;Pu({options:l,target:u,config:{placement:Gp}})}},{WTN:Uj,UTR:Dj}=Uo.ratingConstants;function Sht({entries:t,exclude:e=[],eventId:i,drawId:n,actions:r=[],drawCreated:a}={}){const s=t.find(p=>p.participant?.teams?.length),o=t.find(p=>p.ratings?.utr),l=t.find(p=>p.ratings?.wtn),u=t.find(p=>p.cityState),c=t.find(p=>p.seedNumber),d=t.find(p=>p.ranking);return[{cellClick:(p,h)=>h.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",visible:!a,headerSort:!1,responsive:!1,hozAlign:hi,width:5},{headerMenu:rg({}),formatter:"rownum",headerSort:!1,hozAlign:hi,width:55},{formatter:"responsiveCollapse",responsive:!1,headerSort:!1,hozAlign:di,resizable:!1,width:50},{formatter:p=>tS(void 0)(p,void 0,"sideBySide"),field:"participant",responsive:!1,resizable:!1,minWidth:200,widthGrow:1,title:"Name"},{sorterParams:{alignEmptyValues:"bottom"},visible:!!d,resizable:!1,sorter:"number",field:"ranking",title:"Rank",width:70},{formatter:Yie(Uj),sorter:qie(Uj),visible:!!l,field:"ratings.wtn",resizable:!1,title:Uj,width:70},{formatter:Yie(Dj),sorter:qie(Dj),visible:!!o,field:"ratings.utr",resizable:!1,title:Dj,width:70},{sorter:(p,h)=>p?.[0]?.participantName?.localeCompare(h?.[0]?.participantName),formatter:QPe(()=>console.log("boo")),field:"participant.teams",visible:!!s,title:"Teams",responsive:!1,resizable:!1,minWidth:100},{visible:!!u,title:"City/State",field:"cityState",responsive:!1,resizable:!1,minWidth:100},{editor:Mz({maxValue:t?.length||0,decimals:!1,field:"seedNumber"}),sorterParams:{alignEmptyValues:"bottom"},visible:!!c,field:"seedNumber",hozAlign:di,resizable:!1,sorter:"number",editable:!1,title:"Seed",maxWidth:70},{formatter:vht(Br),title:"Flights",responsive:!0,field:"flights",minWidth:100,widthGrow:1},{responsive:!1,resizable:!1,title:"Status",field:"status",maxWidth:80},{cellClick:wht(r,i||"",n),formatter:Vv,responsive:!1,headerSort:!1,hozAlign:ti,maxWidth:40}].filter(({field:p})=>Array.isArray(e)&&!e?.includes(p||""))}function N1e(){const t=nt.getTournament().tournamentRecord.tournamentId,e=`/${As}/${t}/${wh}`;It.router.navigate(e)}function A1e(t,e){sE({classNames:["saveSeeding","cancelManualSeeding"],columns:["seedNumber"],visible:!1,table:e,e:t})}const{SEEDING:Tht}=QU;function _1e({scaleItemsWithParticipantIds:t,scaleBasis:e,eventId:i,callback:n}){Wt({methods:[{method:XJe,params:{scaleItemsWithParticipantIds:t,removePriorValues:!0,context:{scaleAttributes:{scaleType:Tht},scaleBasis:{scaleType:e},eventId:i}}}],callback:s=>{s.success&&Mt(n)&&n&&n()}})}const{QUALIFYING:ene}=Zr,{SEEDING:Uht,MANUAL:Dht}=QU;function k1e({event:t,rows:e,callback:i}){const{eventId:n,eventType:r}=t,a=e.map(({entryStage:s,participantId:o,seedNumber:l})=>{const u=s===ene?`${n}${ene}`:n;return{participantId:o,scaleItems:[{scaleValue:l,scaleType:Uht,scaleName:u,eventType:r}]}});_1e({scaleItemsWithParticipantIds:a,scaleBasis:Dht,eventId:n,callback:i})}function x1e({table:t}){const e=t.getRows();let i;for(const n of e){const r=n.getData();i=r.entryStage,r.seedNumber=void 0,n.update(r)}return i}function Eht({event:t,table:e}){x1e({table:e});const i=e.getData();k1e({event:t,rows:i})}const{DIRECT_ACCEPTANCE:Pht}=md,{QUALIFYING:tne}=Zr,ine=t=>e=>{const i=t?.eventId;return{class:"cancelManualSeeding",intent:"is-warning",location:ti,label:"Cancel",visible:!1,onClick:r=>{A1e(r,e);const a=x1e({table:e}),s=nt.getEvent({eventId:i})?.event,l=(s.entries?.filter(f=>f.entryStage===a&&f.entryStatus===Pht)).map(({participantId:f})=>f),{participants:u}=nt.getParticipants({participantFilters:{participantIds:l},withScaleValues:!0}),c=a===tne?`${i}${tne}`:i,d=u.map(f=>{const m=f?.seedings?.[s.eventType]?.find(g=>g.scaleName===c)?.scaleValue;if(m)return{participantId:f.participantId,seedNumber:m}}).filter(Boolean),p=Object.assign({},...d.map(f=>({[f.participantId]:f}))),h=e.getRows();for(const f of h){const m=f.getData(),g=m.participantId;p[g]&&(m.seedNumber=p[g].seedNumber,f.update(m))}}}};function Cht(t,e){sE({classNames:["saveSeeding","cancelManualSeeding"],columns:["seedNumber"],visible:!0,table:e,e:t}),e.showColumn("seedNumber"),e.redraw(!0)}const{QUALIFYING:_A,MAIN:Rht}=Zr,{SEEDING:Mht,RATING:Nht}=QU,{ratingsParameters:nne}=Sm;function Aht({event:t,group:e,table:i,field:n}){const{eventId:r,eventType:a}=t,{seedsCount:s,stageEntries:o}=nt.getEntriesAndSeedsCount({stage:e===_A?_A:Rht,policyDefinitions:R1e,eventId:r}),[l,u]=n.split("."),c=u?!nne[u.toUpperCase()].ascending:!1,d=nne[u.toUpperCase()].accessor,p=U=>U.ratings?.[u]||{confidence:0,[d]:1/0},h=U=>p(U)?.[d]||0,f=(U,C)=>(l==="ratings"&&c?h(U)-h(C):h(C)-h(U))||U-C,m=i.getData(),g={high:[],medium:[],low:[]};let v=0;for(const U of m){const C=p(U);C[d]&&(v+=1);const E=C.confidence??100;oO(E)==="high"?g.high.push(U):oO(E)==="medium"?g.medium.push(U):g.low.push(U)}const b=(Mt(f)&&[].concat([...g.high].sort(f),[...g.medium].sort(f),[...g.low].sort(f))||[]).slice(0,Math.min(v,s)),I=e===_A?`${r}${_A}`:r,S={scaleType:Mht,scaleName:I,eventType:a},{scaleItemsWithParticipantIds:w}=nt.generateSeedingScaleItems({scaleAttributes:S,scaledEntries:b,stageEntries:o,seedsCount:s,scaleName:I});_1e({scaleItemsWithParticipantIds:w,scaleBasis:Nht,eventId:r,callback:()=>{const U=Object.assign({},...b.map((E,P)=>({[E.participantId]:P+1}))),C=i.getRows();i.showColumn("seedNumber"),i.redraw(!0);for(const E of C){const P=E.getData(),M=U[P.participantId];P.seedNumber=M,E.update(P)}}})}const rne=(t,e)=>i=>{const n={ranking:"Seed by ranking","ratings.wtn":"Seed by WTN","ratings.utr":"Seed by UTR"},r=i.getColumns().map(s=>s.getDefinition()).filter(s=>["ratings.wtn","ratings.utr"].includes(s.field)),a=[{label:"Manual seeding",onClick:s=>Cht(s,i),close:!0},{label:"Clear seeding",onClick:()=>Eht({event:t,table:i}),close:!0}].concat(...r.map(s=>({onClick:()=>Aht({event:t,group:e,table:i,field:s.field}),label:n[s.field],value:s.field,close:!0})));return{class:"seedingOptions",label:"Seeding",selection:!1,location:ti,align:ti,options:a}},_ht=(t,e,i,n)=>{const a=t.getSelectedData().filter(c=>!c.events?.length).map(({participantId:c})=>c),[s,o]=e.split(".");Wt({methods:[{method:zEe,params:{ignoreAssignment:!0,participantIds:a,entryStatus:o,entryStage:s,eventId:i,drawId:n}}],callback:c=>{if(t.deselectRow(),c.success){const d=t.getRows();for(const p of d){const h=p.getData();a.includes(h.participantId)&&(h.status=yge[o],p.update(h))}}else console.log(c.error)}})},kht=(t,e,i)=>n=>{const r=t.map(a=>({onClick:()=>_ht(n,a,e,i),label:a,value:a,close:!0}));return{location:ba,label:"Change status",options:r}},xht=(t,e=0)=>{const i=`${t} <span class='${sge}'>${e}</span>`;return{location:Hk,text:i}},HS=({target:t,table:e,close:i})=>{if(!t)return;const n=jl(t,TI);if(n){const r=n.getElementsByClassName("toggle")?.[0],a=n.getElementsByClassName(fge)?.[0],s=n.getElementsByClassName(mge)?.[0];if(r){const o=i||r.innerHTML.charCodeAt(0)===9660;a.style.display=o?Rt:WT,s.style.display=o?Rt:WT,r.parentNode.innerHTML=`<span class='toggle' style='color: white'>${o?lCe:HK}</span>`,o||e.redraw(!0)}}},Oht=t=>{const e=i=>HS({target:i.target,table:t});return{headerClick:e,text:`<span class='toggle' style='color: white'>${HK}</span>`,location:Hk,onClick:e}},LE=({heading:t,count:e})=>[xht(t,e),i=>Oht(i)],Lht=(t,e,i)=>(n,r="Search participants")=>{let a,s;const o=l=>{const u=yb(n.element,"tableClass");if(u){const c=dv(u,"controlBar")?.[0];if(c){const d=dv(c,"search");Array.from(d).forEach(p=>p.value=l)}}a=n.getSelectedData().map(c=>c[e]),n.removeFilter(s),s=c=>c.searchText?.includes(l?.toLowerCase())||a?.length&&a.includes(c[e]),l&&n.addFilter(s)};return{onKeyDown:l=>{l.keyCode===8&&l.target.value.length===1&&o(""),(l.key==="Enter"||l.keyCode===13)&&Mt(i)&&i&&i(n)&&o("")},onChange:l=>o(l.target.value),onKeyUp:l=>o(l.target.value),location:t||hi,class:"search",search:!0,placeholder:r}},ane=t=>e=>({label:"Save seeding",class:"saveSeeding",intent:"is-info",location:ti,visible:!1,onClick:n=>{A1e(n,e);const r=e.getData();k1e({event:t,rows:r})}}),{UNGROUPED:sne}=md,{DOUBLES:Fht}=dl,$ht=(t,e)=>i=>{const n=r=>{const a=r.getSelectedData(),s=a.filter(u=>!u.events?.length).map(({participantId:u})=>u);Wt({methods:[{method:jJe,params:{removeGroupParticipant:!0,participantIds:s,eventId:t,drawId:e}}],callback:u=>{if(u?.error)r.deselectRow(),Ht({message:u.error[0]?.message??"Error destroying pair",intent:"is-danger"});else{r.deleteRow(s);const d=yb(r.element,"tableClass")?.parent?.getElementsByClassName("controlBar")?.[0];d&&setTimeout(()=>OK({target:d})(),100);const p=a.flatMap(({participant:m})=>m?.individualParticipantIds),{participants:h}=nt.getParticipants({participantFilters:{participantIds:p}}),f=h.map(m=>U2({entry:{participantId:m.participantId,entryStatus:sne},eventType:Fht,participant:m}));It.tables[sne].updateOrAddData(f)}}})};return{onClick:()=>n(i),label:"Destroy pairs",intent:"is-danger",location:ba}},Bht=(t,e)=>{const n=t.getSelectedData().map(({participantId:o})=>o),r=e.entries.filter(({participantId:o})=>n.includes(o)),a=[{method:DJe,params:{eventId:e.eventId,drawName:"Flight",drawEntries:r}}];Wt({methods:a,callback:o=>{o.success?t.deselectRow():console.log(o.error)}})},Vht=(t,e)=>i=>({onClick:()=>Bht(i,t),label:"Add flight",location:ba,hide:e}),jht=(t,e,i,n)=>{const a=t.getSelectedData().filter(o=>!o.events?.length).map(({participantId:o})=>o);M1e({participantIds:a,group:e,eventId:i,drawId:n,callback:o=>{if(o?.success){const u=t.getData().filter(({participantId:c})=>a.includes(c));It.tables[e].updateOrAddData(u),t.deleteRow(a)}else t.deselectRow(),Ht({message:o.error.message??"Error moving participants",intent:"is-danger"})}})},kA=(t,e,i)=>n=>{const r=t.map(a=>({onClick:()=>jht(n,a,e,i),stateChange:!0,label:a,value:a,close:!0}));return{label:"Move participants",location:ba,options:r}},{ASSIGN_PARTICIPANT:Ght}=g0,Ej=(t,e)=>i=>({label:"Add entries",class:"addEntries",location:ti,onClick:()=>{const{entries:r=[],eventId:a,eventType:s}=t,o=(r||[]).map(({participantId:p})=>p),l=t.eventType==="TEAM"&&"TEAM"||t.eventType==="DOUBLES"&&"PAIR"||"INDIVIDUAL",u=nt.getParticipants({inContext:!0,participantFilters:{participantTypes:[l]},withISO2:!0}).participants.filter(p=>!o.includes(p.participantId));_N({title:"Select participants to add",activeOnEnter:!0,selectionLimit:99,onSelection:({selected:p})=>{if(!p?.length)return;const h=p.map(({participantId:y})=>y),f=e===nM?"QUALIFYING":"MAIN",m="DIRECT_ACCEPTANCE";Wt({methods:[{params:{eventId:a,participantIds:h,entryStatus:m,entryStage:f},method:vK}],callback:y=>{if(y.success){const{participants:b,derivedDrawInfo:I}=nt.getParticipants({participantFilters:{participantIds:h},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0}),S=h.map(w=>U2({entry:{participantId:w,entryStage:f,entryStatus:m},derivedDrawInfo:I,participants:b,eventType:s,eventId:a}));i.addRow(S)}}})},action:{type:Ght,participantsAvailable:u}})}}),{ALTERNATE:Pj,UNGROUPED:Hht}=md,{MAIN:zht}=Zr,{DOUBLES:one}=dl,qht=(t,e=!0)=>{const{eventId:i,eventType:n,gender:r}=t,a=(l,u)=>{const c=u.getSelectedData().map(m=>m.participantId);if(c.length!==2)return;const p=[Mi.UUID()],h=[{method:NJe,params:{participantIdPairs:[c],allowDuplicateParticipantIdPairs:!0,entryStatus:Pj,entryStage:zht,eventId:i,uuids:p}}];Wt({methods:h,callback:m=>{if(m.success){u.deleteRow(c),u.clearFilter();const g=yb(u.element,"tableClass");if(g){const b=dv(g,"controlBar")?.[0];if(b){const I=dv(b,"search");Array.from(I).forEach(S=>S.value="")}}const v=m.results[0].newParticipantIds,{participants:[y]}=nt.getParticipants({participantFilters:{participantIds:v},withIndividualParticipants:!0,withISO2:!0});if(y){const b=U2({entry:{participantId:y.participantId,entryStatus:Pj},eventType:one,participant:y});It.tables[Pj].updateOrAddData([b]);const S=yb(l.target,"tableClass")?.parent?.getElementsByClassName("controlBar")?.[0];S&&setTimeout(()=>OK({target:S})(),100)}else console.log("participant not found",{participantIds:v,methods:h,result:m})}else m.error?.code==="ERR_INVALID_PARTICIPANT_IDS"?(Ht({intent:"is-danger",message:r==="MIXED"?"Genders must be mixed":"Invalid pairing"}),u.deselectRow()):console.log({methods:h,result:m})}})};return{createPairButton:{hide:n!==one,label:"Create pair",onClick:a,intent:"is-info",location:ba,id:"create-pair",visible:!1},createPairFromSelected:l=>{const u=l?.length===2;if(u&&e){const c=It.tables[Hht];a({target:c.element},c)}else{const c=document.getElementById("create-pair");c&&(c.style.display=u?"":Rt)}}}},{DIRECT_ACCEPTANCE:Wht}=md,{MAIN:Yht}=Zr,Kht=(t,e,i)=>{const r=t.getSelectedData().filter(o=>!o.events?.length).map(({participantId:o})=>o);Wt({methods:[{method:PJe,params:{entryStatus:Wht,ignoreStageSpace:!0,entryStage:Yht,participantIds:r,eventId:e,drawId:i}}],callback:o=>{o.success?t.deselectRow():console.log(o.error)}})},Zht=(t,e)=>i=>{const n=(t.drawDefinitions||[]).filter(Boolean).map(({drawName:r,drawId:a})=>({onClick:()=>Kht(i,t.eventId,a),stateChange:!0,label:r,value:a,close:!0}));return{hide:!t.drawDefinitions?.length||e,label:"Add to draw",location:ba,options:n}},{DIRECT_ACCEPTANCE:Xht,ALTERNATE:Lf,UNGROUPED:lne,WITHDRAWN:Ff}=md,{MAIN:MS,QUALIFYING:ty}=Zr,{SINGLES:Jht,DOUBLES:une}=dl;function Qht({drawDefinition:t,event:e,entryData:i,hasFlights:n}){const r=v=>i.filter(({entryStage:y=MS,entryStatus:b})=>v.includes(`${y}.${b}`)),a=!!t,s=t?.drawId,o=e?.eventId,l={[Ud]:[Lf,Ff],[ty]:[Ud,Lf,Ff],[Lf]:[Ud,ty,Ff],[Ff]:[Lf]},{createPairFromSelected:u}=qht(e),c=n?[]:["flights"],d=v=>{const y=v.getData("active"),b=y.map(({participantId:I})=>I);return y.length===1?(v.selectRow(b),!0):(y.length===2&&v.selectRow(b),!1)},p=r(sO(MS)),h=r([`${ty}.${Xht}`]),f=r([`${MS}.${Lf}`]),m=r([`${MS}.${lne}`]),g=r([`${MS}.${Ff}`]);return[{placeholder:"No accepted participants",items:[kA(l[Ud],o,s),kht(sO(MS),o,s),Zht(e,s),Vht(e,s),...LE({heading:"Accepted",count:p.length}),!a&&rne(e,Ud),ine(e),ane(e),!a&&Ej(e,Ud)],actions:l[Ud],anchorId:v6,entries:p,group:Ud,excludeColumns:c,drawCreated:a,togglePanel:HS},{placeholder:"No qualifying participants",items:[...LE({heading:"Qualifying",count:h.length}),kA(l[ty],o,s),!a&&rne(e,ty),ine(e),ane(e),!a&&Ej(e,ty)],actions:[Ud,Lf,Ff],anchorId:b6,entries:h,group:ty,excludeColumns:c,drawCreated:a,togglePanel:HS},{items:[...LE({heading:"Alternates",count:f.length}),kA(l[Lf],o,s),e?.eventType===une&&$ht(o,s),!a&&Ej(e,Lf)],actions:[Ud,ty,Ff],excludeColumns:["seedNumber","flights"],placeholder:"No alternates",anchorId:y6,entries:f,group:Lf,drawCreated:a,togglePanel:HS},{hide:!!([Jht].includes(e?.eventType)||a),items:[...LE({heading:"Ungrouped",count:m.length}),Lht(hi,"participantId",d)],placeholder:"No ungrouped participants",excludeColumns:["seedNumber","flights"],onSelection:e?.eventType===une&&u,anchorId:I6,entries:m,actions:[Ff],group:lne,drawCreated:a,togglePanel:HS},{items:[...LE({heading:"Withdrawn",count:g.length}),!a&&kA(l[Ff],o,s)],placeholder:"No withdrawn participants",excludeColumns:["seedNumber","flights"],anchorId:w6,entries:g,actions:[Lf],hide:a,group:Ff,collapsed:!0,drawCreated:a,togglePanel:HS}]}function cne({eventId:t,drawId:e,headerElement:i}){(!t||t==="undefined")&&It.router.navigate("/");let n;const r=l=>{n&&Object.values(It.tables).forEach(c=>c.removeFilter(n));const u=l?.toLowerCase();n=c=>c.searchText?.includes(u),l?Object.values(It.tables).forEach(c=>c.addFilter(n)):n=void 0},a=()=>{const{event:l,drawDefinition:u}=nt.getEvent({eventId:t,drawId:e});if(i&&(i.innerHTML=l?.eventName),!l)return{error:"EVENT_NOT_FOUND"};const{participants:c,derivedDrawInfo:d}=nt.getParticipants({participantFilters:{eventIds:[t]},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0,withISO2:!0})??{},p=l?.drawDefinitions?.length>1,h=l.category?.categoryName??l.category?.ageCategoryCode,f=(u?.entries||l?.entries||[]).map(g=>U2({eventType:l.eventType,derivedDrawInfo:d,categoryName:h,participants:c,eventId:t,entry:g})),{events:m}=nt.getEvents();return{tableData:Qht({event:l,drawDefinition:u,entryData:f,hasFlights:p}),events:m,event:l}},s=l=>{for(const u of l){const{entries:c,group:d,anchorId:p,placeholder:h,excludeColumns:f,actions:m,drawCreated:g}=u,v=document.getElementById(p);if(v){v.style.display=u.hide?Rt:WT,Js(v);const y=document.createElement("div");y.className=`${Oje} flexcol flexcenter`,v.appendChild(y);const b=document.createElement("div");b.className=`${mge} flexcol flexcenter`,v.appendChild(b);const I=new Bs(b,{headerSortElement:wf(["ratings.utr","ratings.wtn","seedNumber","ranking","cityState","status","flights"]),columns:Sht({actions:m,exclude:f,entries:c,eventId:t,drawId:e,drawCreated:g}),responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,height:"400px",data:c,placeholder:h});It.tables[d]=I;const S=jl(v,TI);I.on("tableBuilt",()=>{const w=u.items?.map(T=>Mt(T)?T(I):T);wo({target:y,table:I,items:w,onSelection:u.onSelection}),!c.length&&u.togglePanel&&u.togglePanel({target:S,table:I,close:!0})}),I.on("dataChanged",()=>{const U=yb(I.element,"tableClass")?.parent?.getElementsByClassName("controlBar")?.[0]?.getElementsByClassName(sge)?.[0],C=I.getData().length;u.togglePanel&&!C&&u.togglePanel({target:S,table:I,close:!0}),U&&(U.innerHTML=C||0)})}}},o=a();if(!o.error){const l="All entries",u=document.getElementById(rM)||void 0,c={label:l,onClick:()=>Br({eventId:t}),close:!0},d=(o.event.drawDefinitions||[]).map(S=>({onClick:()=>Br({eventId:t,drawId:S.drawId}),label:S?.drawName,close:!0})).concat([{divider:!0},c]),p={label:Qg,onClick:N1e,close:!0},h=o.events.map(S=>({onClick:()=>Br({eventId:S.eventId}),label:S.eventName,close:!0})).concat([{divider:!0},p]),f=S=>{S.success&&Br({eventId:t,drawId:S.drawDefinition?.drawId,renderDraw:!0})},m={label:"<div style='font-weight: bold'>Add draw</div>",onClick:()=>NU({eventId:t,callback:f})},g=o.event.drawDefinitions?.map(S=>({onClick:()=>Br({eventId:t,drawId:S?.drawId,renderDraw:!0}),label:S?.drawName,close:!0})).concat([{divider:!0},m]),v=o.event?.drawDefinitions?.find(S=>S?.drawId===e)?.drawName,y=({eventId:S})=>{console.log("generateFlights",{eventId:S})},b=D1e({eventId:t})?.length?"is-success":Rt,I=[{onKeyDown:S=>S.keyCode===8&&S.target.value.length===1&&r(""),onChange:S=>r(S.target.value),onKeyUp:S=>r(S.target.value),clearSearch:()=>r(""),placeholder:"Search entries",location:hi,search:!0},{label:o.event.eventName,options:h.length>1&&h,location:hi},{label:v||l,options:d,location:hi},{onClick:()=>Br({eventId:t,drawId:e,renderDraw:!0}),label:"View draw",intent:"is-info",location:ti,hide:!e},{onClick:()=>E1e({eventId:t}),intent:b,id:"editAvoidances",label:"Avoidances",location:ti},{onClick:()=>y({eventId:t}),label:"Flights",location:ti,hide:e,intent:Rt},{options:g?.length>2&&g,hide:(g?.length||0)<3||e,intent:"is-info",location:ti,label:"Draws",align:ti},{onClick:()=>NU({eventId:t,callback:f}),hide:g?.length>2||e,intent:"is-info",label:"Add draw",location:ti}];wo({target:u,items:I}),o.tableData&&s(o.tableData)}}function eft({drawId:t,callback:e}){const i=nt.getEvent({drawId:t})?.drawDefinition?.structures;if(!i?.length)return;const n=i.map(({structureName:u,structureId:c},d)=>({text:`${u}:`,fieldPair:{error:"minimum 4 characters",validator:Vr(4),placeholder:u,focus:d===0,field:c,id:c}}));let r;const a=()=>{const u=i.map(({structureId:p})=>r[p]?.value&&{structureId:p,structureName:r[p].value.trim()}).filter(Boolean);Wt({methods:[{params:{drawId:t,structureDetails:u},method:WEe}],callback:p=>{p.success&&(Ht({message:"Structure renamed",intent:"is-success"}),Mt(e)&&e&&e())}})},s=()=>{const u=i.map(({structureId:h})=>r[h]?.value).filter(Boolean),c=u.every(Vr(4)),d=document.getElementById("renameStructures"),p=u.length&&c;d&&(d.disabled=!p)},o=i.map(({structureId:u})=>({control:u,onInput:s}));Yn({title:"Edit structure names",content:u=>r=mr(u,n,o),buttons:[{label:"Cancel",intent:Rt,close:!0},{label:"Rename",id:"renameStructures",disabled:!0,intent:"is-info",close:!0,onClick:a}]})}function tft({drawId:t,structure:e,callback:i}){const r=Object.values(e.roundMatchUps).flat().reduce((d,p)=>{const{structureName:h,structureId:f}=p;return d[f]||(d[f]={structureName:h,structureId:f}),d},{}),a=Object.values(r).map(({structureName:d,structureId:p})=>({text:`${d}:`,fieldPair:{error:"minimum 4 characters",validator:Vr(4),placeholder:d,field:p,id:p}}));let s;const o=()=>{const d=Object.values(r).map(({structureId:f})=>s[f]?.value&&{structureId:f,structureName:s[f].value.trim()}).filter(Boolean);Wt({methods:[{params:{drawId:t,structureDetails:d},method:WEe}],callback:f=>{f.success&&(Ht({message:"Groups renamed",intent:"is-success"}),Mt(i)&&i&&i(f))}})},l=()=>{const d=Object.values(r).map(({structureId:m})=>s[m]?.value).filter(Boolean),p=d.every(Vr(4)),h=document.getElementById("renameGroups"),f=d.length&&p;h&&(h.disabled=!f)},u=Object.values(r).map(({structureId:d})=>({control:d,onInput:l}));Yn({title:"Edit group names",content:d=>s=mr(d,a,u),buttons:[{label:"Cancel",intent:Rt,close:!0},{label:"Rename",id:"renameGroups",disabled:!0,intent:"is-info",close:!0,onClick:o}]})}const{ROUND_ROBIN:dne,SINGLE_ELIMINATION:ift}=Zr;function nft({callback:t,drawId:e,structureId:i,playoffFinishingPositionRanges:n}){const r=T=>`finishingPosition-${T}`,a=n.map(({finishingPosition:T,finishingPositionRange:U})=>({field:r(T),id:r(T),label:T,checkbox:!0,fieldPair:{text:`Creates playoff for positions ${U}`,width:"400px"}}));if(!a||a.length<1){Ht({message:"No playoff positions available",intent:"is-danger"});return}const s={value:zk,label:"Playoff name",field:"structureName",id:"structureName"},o=C1e({isPlayoff:!0}),l={value:ift,options:o,label:"Draw type",field:Ph,id:Ph},{validGroupSizes:u}=nt.getValidGroupSizes({drawSize:4,groupSizeLimit:8}),d={options:u.map(T=>({label:T,value:T})),label:"Group size",field:Wf,visible:!1,value:4},p="Positions to be played off:",h={text:`${p} None`,id:"selectedPlayoffRange"},m=[s,l,d,h,{text:"Select group finishing positions. Selections must be sequential"}].concat(a);let g;const v=()=>{const U=n.filter(({finishingPosition:N})=>g[r(N)]?.checked).map(({finishingPosition:N})=>N),C=g.structureName.value,E=g[Ph].value,P={finishingPositions:U,structureName:C,drawType:E};if(E===dne){const N=parseInt(g[Wf].value);P.structureOptions={groupSize:N}}Wt({methods:[{params:{drawId:e,structureId:i,playoffGroups:[P],playoffStructureNameBase:zk},method:jEe}],callback:N=>{N.success?(Ht({message:"Structure added",intent:"is-success"}),Mt(t)&&t&&t()):(console.log({result:N}),Ht({message:N.error?.message||"Error",intent:"is-danger"}))}})},y=T=>`${Math.min(...T)}-${Math.max(...T)}`,b=()=>{const T=n.filter(({finishingPosition:$})=>g[r($)]?.checked).map(({finishingPositions:$})=>$).flat(),U=n.map(({finishingPosition:$})=>g[r($)].checked),C=n.map(({finishingPosition:$})=>g[r($)].checked&&$).filter(Boolean),E=C.map(($,F)=>(C[F+1]||$)-$).every($=>$<2),P=U.filter(Boolean).length,M=document.getElementById("addStructure"),R=P&&E;M&&(M.disabled=!R);const N=document.getElementById("selectedPlayoffRange");if(N){const $=R?y(T):"None";N.innerHTML=`${p} ${$}`}const{validGroupSizes:A}=nt.getValidGroupSizes({drawSize:T?.length||4,groupSizeLimit:8}),_=A.map($=>({label:$,value:$})),x=g[Wf],O=A.includes(4)?4:A[0];Js(x),G6(x,{options:_,value:O})},I=({e:T,fields:U})=>{const C=T.target.value,E=[dne].includes(C);U[Wf].style.display=E?"":Rt},S=n.map(({finishingPosition:T})=>({control:r(T),onChange:b})).concat([{onChange:I,control:Ph}]);Yn({title:"Add playoff structure",content:T=>g=mr(T,m,S),buttons:[{label:"Cancel",intent:Rt,close:!0},{label:"Add",id:"addStructure",intent:"is-info",disabled:!0,close:!0,onClick:v}]})}function rft({drawId:t,structureId:e,callback:i}){const n=nt.getAvailablePlayoffProfiles({drawId:t,structureId:e}),r=f=>f.finishingPositions.reduce((m,g)=>(m||0)+(g||0));if(!n.playoffRoundsRanges&&n.finishingPositionsAvailable?.length)return nft({...n,drawId:t,structureId:e,callback:i});const a=n.playoffRoundsRanges?.sort((f,m)=>r(f)-r(m)).map(({finishingPositionRange:f})=>({label:f,field:f,id:f,checkbox:!0,fieldPair:{field:`${f}-name`,placeholder:`${zk} ${f}`,id:`${f}-name`,width:"350px"}}));if(!a||a.length<1){Ht({message:"No playoff positions available",intent:"is-danger"});return}const s=f=>{a.forEach(({label:m,fieldPair:g})=>{const v=document.getElementById(g.id);v&&(v.placeholder=`${f} ${m}`)})},l=[{onChange:f=>s(f.target.value),onKeyDown:f=>f.key==="Tab"&&s(f.target.value),value:zk,label:"Name base",field:"nameBase",id:"nameBase"}].concat(a);let u;const c=()=>{const f=n.playoffRoundsRanges.filter(I=>u[I.finishingPositionRange]?.checked),m=u.nameBase.value,g={},v=f.map(({roundNumber:I,finishingPositionRange:S})=>{const w=u[`${S}-name`]?.value;return w&&(g[`0-${I}`]={name:w}),{[I]:1}});Wt({methods:[{params:{drawId:t,structureId:e,playoffAttributes:g,roundProfiles:v,playoffStructureNameBase:m},method:jEe}],callback:I=>{I.success?(Ht({message:"Structure(s) added",intent:"is-success"}),Mt(i)&&i&&i()):Ht({message:I.error?.message||"Error",intent:"is-danger"})}})},d=()=>{const f=n.playoffRoundsRanges.filter(g=>u[g.finishingPositionRange]?.checked),m=document.getElementById("addStructure");m&&(m.disabled=!f.length)},p=n.playoffRoundsRanges.map(({finishingPositionRange:f})=>({control:f,onChange:d}));Yn({title:"Add playoff structures",content:f=>u=mr(f,l,p),buttons:[{label:"Cancel",intent:Rt,close:!0},{label:"Add",id:"addStructure",disabled:!0,intent:"is-info",close:!0,onClick:c}]})}const{FINISHING_POSITIONS:aft,CONTAINER:sft}=Zr;function oft({drawData:t,eventId:e,structureId:i,updateControlBar:n}){const r=t.drawId,a=nt.getAvailablePlayoffProfiles({drawId:r,structureId:i})?.playoffRounds?.length,s=nt.isValidForQualifying({drawId:r,structureId:i})?.valid,o=()=>{NU({callback:c=>{if(c.success){const d=c.structure.structureId;Br({eventId:e,drawId:r,structureId:d,renderDraw:!0})}},drawName:"Qualifying",isQualifying:!0,structureId:i,eventId:e,drawId:r})},l=t.structures.find(c=>c.structureId===i),u=l?.structureType===sft;return t.structures.sort((c,d)=>Mi.structureSort(c,d,{mode:aft})).map(c=>({onClick:()=>{Br({eventId:e,drawId:r,structureId:c.structureId,renderDraw:!0})},label:c.structureName,close:!0})).concat([{divider:!0},{onClick:()=>eft({drawId:r,callback:()=>n(!0)}),label:"Edit structure names",modifyLabel:!1,close:!0},{onClick:()=>tft({drawId:r,structure:l,callback:c=>console.log(c)}),label:"Edit group names",hide:!u,modifyLabel:!1,close:!0},{onClick:()=>o(),hide:!s,label:"Add qualifying",modifyLabel:!1,close:!0},{onClick:()=>rft({drawId:r,structureId:i,callback:()=>n(!0)}),hide:!a,label:"Add playoffs",modifyLabel:!1,close:!0}])}const AU=(t,e)=>i=>(i||"").trim().split(" ").length>=t&&!0;function D2(t){const{eventData:e,drawIds:i,callback:n}=t,r=t.eventId??e.eventInfo.eventId;if(zi.skipReason){const h={auditReason:"Reason skipped"},f=i.map(g=>({params:{eventId:r,drawId:g,auditData:h,force:!0},method:Aee}));Wt({methods:f,callback:g=>n?n(g):Br({eventId:r})});return}const a=i.length===1&&e?.drawsData?.find(h=>i.includes(h.drawId)).drawName,s=a?`Delete ${a}`:"Delete flights";let o;const l=()=>{const h={auditReason:o.drawDeletionReason.value},f=i.map(g=>({params:{eventId:r,drawId:g,auditData:h,force:!0},method:Aee}));Wt({methods:f,callback:g=>n?n(g):Br({eventId:r})})},u=[{text:"Please provide a reason for draw deletion."},{placeholder:"Explanation",field:"drawDeletionReason",validator:AU(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],d=[{control:"drawDeletionReason",onInput:({inputs:h})=>{const f=h.drawDeletionReason.value,m=AU(5)(f),g=document.getElementById("deleteDraw");g&&(g.disabled=!m)}}];Yn({title:s,content:h=>o=mr(h,u,d),buttons:[{label:"Cancel",intent:Rt,close:!0},{label:"Delete",id:"deleteDraw",disabled:!0,intent:"is-danger",close:!0,onClick:l}]})}function lft({eventData:t,drawIds:e}){const i=t.eventInfo.eventId,n=e.length===1&&t?.drawsData?.find(d=>e.includes(d.drawId)).drawName,r=n?`Delete ${n}`:"Delete flights";let a;const s=()=>{const d={auditReason:a.drawDeletionReason.value},p=e.map(f=>({params:{eventId:i,drawId:f,auditData:d},method:KJe}));Wt({methods:p,callback:f=>f.success&&Br({eventId:i,drawId:e[0]})})},o=[{text:"Please provide a reason for resetting draws."},{placeholder:"Explanation",field:"drawDeletionReason",validator:AU(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],u=[{control:"drawDeletionReason",onInput:({inputs:d})=>{const p=d.drawDeletionReason.value,h=AU(5)(p),f=document.getElementById("deleteDraw");f&&(f.disabled=!h)}}];Yn({title:r,content:d=>a=mr(d,o,u),buttons:[{label:"Cancel",intent:Rt,close:!0},{label:"Delete",id:"deleteDraw",disabled:!0,intent:"is-danger",close:!0,onClick:s}]})}function uft({structureId:t,drawId:e}){const i=nt.getMatchUpFormat({drawId:e,structureId:t}).matchUpFormat;tZ({callback:r=>{r&&(r===i?Ht({message:"No changes",intent:"is-warning"}):Wt({methods:[{params:{matchUpFormat:r,structureId:t,drawId:e},method:ZJe}],callback:o=>o.success&&Ht({message:"Scoring changed"})}))},existingMatchUpFormat:i})}function cft({drawId:t,eventId:e,structureId:i}){const n=[{params:{drawId:t,structureId:i,force:!0},method:YJe}],r=l=>{l.success?Br({eventId:e,drawId:t,renderDraw:!0}):Ht({message:l.error?.message||"Error",intent:"is-danger "})};Yn({title:"Remove structure",buttons:[{intent:"is-danger",onClick:()=>Wt({methods:n,callback:r}),label:"Remove",close:!0},{label:"Cancel"}],content:"<div style='font-size: 2em'>Structure will be removed!</div>"})}const{TEAM:pne}=dl;function dft({structureName:t,dualMatchUp:e,structureId:i,eventData:n,drawData:r,drawId:a}){const s=r.structures?.find(d=>d.stage===nM),o=r.structures?.find(d=>d.structureId===i),l=n.eventInfo.eventId,u=()=>{const d=e.matchUpId,p=nt.findMatchUp({drawId:a,matchUpId:d})?.matchUp,h=T2({matchUp:p}),f=document.getElementById(nf);Js(f),f.appendChild(h)},c=[{hide:n.eventInfo.eventType!==pne,onClick:()=>h1e({matchUpId:e.matchUpId,structureId:i,eventId:l,drawId:a,callback:u}),label:"Edit scorecard",close:!0},{hide:n.eventInfo.eventType===pne,onClick:()=>uft({structureId:i,drawId:a}),label:`Edit ${t} scoring`,close:!0},{hide:o?.stage==="MAIN"&&o.stageSequence===1&&!s,onClick:()=>cft({drawId:a,eventId:l,structureId:i}),label:"Remove structure",close:!0},{onClick:()=>D2({eventData:n,drawIds:[a]}),label:"Delete draw"},{onClick:()=>lft({eventData:n,drawIds:[a]}),label:"Reset draw"}];if(e){const d=e.matchUpId;c.push({divider:!0});const p=v=>v.success&&u(),f={label:"Remove players",onClick:()=>{nt.findMatchUp({matchUpId:d,drawId:a}).matchUp.tieMatchUps?.some(nt.checkScoreHasValue)?Ht({message:"Cannot remove when scores are present",intent:"is-warning",pauseOnHover:!0}):Wt({methods:[{params:{drawId:a,matchUpId:d,inheritance:!1},method:YEe}],callback:p})},close:!0};c.push(f);const g={label:"Clear results",onClick:()=>{Wt({methods:[{params:{drawId:a,matchUpId:d},method:KEe}],callback:p})},close:!0};c.push(g)}return c}function pft({eventData:t}){const e=t.drawsData.map(({drawId:o,drawName:l})=>({label:l,checkbox:!0,field:o,id:o}));let i;const n=()=>{const o=t.drawsData.filter(({drawId:l})=>i[l]?.checked).map(({drawId:l})=>l);setTimeout(()=>D2({eventData:t,drawIds:o}),200)},r=()=>{const o=t.drawsData.filter(({drawId:u})=>i[u]?.checked).length,l=document.getElementById("deleteSelected");l&&(l.disabled=!o)},a=t.drawsData.map(({drawId:o})=>({onChange:r,control:o}));Yn({title:"Delete flights",content:o=>i=mr(o,e,a),buttons:[{label:"Cancel",intent:Rt,close:!0},{label:"Delete",id:"deleteSelected",intent:"is-danger",disabled:!0,close:!0,onClick:n}]})}function hft({eventData:t,drawId:e}){const i=()=>{const s=o=>{if(o.drawDefinition){const l=o.drawDefinition.structures?.[0]?.structureId,u=t.eventInfo.eventId,c=o.drawDefinition.drawId;Br({eventId:u,drawId:c,structureId:l,renderDraw:!0})}};NU({eventId:t.eventInfo.eventId,callback:s})},n=()=>pft({eventData:t}),r=t.drawsData.length>1&&{onClick:n,label:"Delete flights",modifyLabel:!1,close:!0},a=t.drawsData.length&&{onClick:()=>Br({eventId:t.eventInfo.eventId,drawId:e}),label:"View entries",modifyLabel:!1,close:!0};return t.drawsData.map(s=>({onClick:()=>{const o=s.structures?.[0]?.structureId,l=t.eventInfo.eventId,u=s.drawId;Br({eventId:l,drawId:u,structureId:o,renderDraw:!0})},label:s.drawName,close:!0})).concat([{divider:!0},a,r,{label:"Add flight",modifyLabel:!1,onClick:i}]).filter(Boolean)}function fft(){return{eventOptions:(nt.getEvents().events??[]).map(i=>({onClick:()=>{const n=nt.getEventData({eventId:i.eventId});if(!n?.eventData?.drawsData?.length)Br({eventId:i.eventId});else{const r=n.eventData.drawsData?.[0]?.drawId;Br({eventId:n.eventData.eventInfo.eventId,drawId:r,renderDraw:!0})}},label:i.eventName,close:!0})).concat([{divider:!0},{label:`<div style='font-weight: bold'>${Qg}</div>`,onClick:N1e,close:!0}])}}const{TEAM:mft}=dl;function O1e({updateParticipantFilter:t,updateControlBar:e,structureId:i,eventData:n,matchUps:r,eventId:a,drawId:s}){const{eventOptions:o}=fft(),l=hft({eventData:n,drawId:s}),u=n?.drawsData?.find(f=>f.drawId===s),c=u?.structures?.find(f=>f.structureId===i)?.structureName,d=r?.length===1&&n.eventInfo.eventType===mft,p=oft({updateControlBar:e,structureId:i,drawData:u,eventId:a}),h=dft({dualMatchUp:d&&r[0],structureName:c,structureId:i,eventData:n,drawData:u,drawId:s});return[{onKeyDown:f=>f.key==="Backspace"&&f.target.value.length===1&&t(""),onChange:f=>t(f.target.value),onKeyUp:f=>t(f.target.value),clearSearch:()=>t(""),placeholder:"Participant name",location:hi,search:!0},{options:o.length>1?o:void 0,label:n.eventInfo.eventName,modifyLabel:!0,location:hi},{options:l.length>1?l:void 0,label:u.drawName,modifyLabel:!0,location:hi},{options:p.length>1?p:void 0,label:c,modifyLabel:!0,location:hi},{options:h,intent:"is-info",label:"Actions",location:ti,align:ti}]}function aZ({eventId:t,drawId:e,structureId:i,updateDisplay:n}){const r=nt.getEventData({eventId:t}).eventData,s=r?.drawsData?.find(m=>m.drawId===e)?.structures||[];i=i||s?.[0]?.structureId;const o=s.find(m=>m.structureId===i),{roundMatchUps:l}=Mi.makeDeepCopy(o||{}),u=Object.values(l||{}).flat();let c;const d=m=>m.searchText?.includes(c),h=O1e({updateControlBar:aZ,updateParticipantFilter:m=>{m||Object.values(It.tables).filter(Boolean).forEach(g=>g.clearFilter()),c=m?.toLowerCase(),m&&Object.values(It.tables).filter(Boolean).forEach(g=>g.addFilter(d)),typeof n=="function"&&n({participantFilter:c})},structureId:i,eventData:r,matchUps:u,eventId:t,drawId:e}),f=document.getElementById(rM)||void 0;wo({target:f,items:h})}function gft(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML))e.style.fontWeight="bold",e.style.color="#ed0c76"}function vft(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML))e.style.fontWeight="",e.style.color=""}function L1e({drawId:t,roundNumber:e,structure:i,structureId:n,callback:r}={}){n=n||i?.structureId;const a=nt.allDrawMatchUps({matchUpFilters:{structureIds:[n]},drawId:t}).matchUps||[],s=a.reduce((f,m)=>{const g=m.roundNumber;return g&&!f.includes(g)&&f.push(g),f},[]);if(e=e||s.length&&s[s.length-1],!e)return;let o;const u=[{label:"Cancel",intent:"none",close:!0},{label:"Delete",intent:"is-danger",close:!0,onClick:()=>{const f=a.filter(v=>{if(v.roundNumber===e)return v.winningSide&&o.completed.checked||v.sides.some(({participantId:y})=>y)&&!v.winningSide&&o.unscored.checked?!0:v.sides.every(({participantId:y})=>!y)&&o.empties.checked}).map(({matchUpId:v})=>v),m=[{params:{removeCompleted:o.completed.checked,removeIncomplete:o.unscored.checked,removeUnassigned:o.empties.checked,structureId:n,matchUpIds:f,drawId:t},method:GEe}],g=v=>{v.success?Mt(r)&&r&&r({refresh:!0}):console.log({postMutationError:v.error})};f.length&&Wt({methods:m,callback:g})}}],p=[{text:"Round number",fieldPair:{options:s.map(f=>({label:f,value:f})),field:"roundNumber",value:e,id:"roundNumber"}},{spacer:!0},{label:"Remove empty (TBD) matches",intent:"is-success",checkbox:!0,field:"empties",checked:!0,id:"empties"},{label:"Remove incomplete/unscored matches",intent:"is-danger",field:"unscored",checkbox:!0,id:"unscored"},{label:"Remove completed matches",intent:"is-danger",field:"completed",id:"completed",checkbox:!0,color:"red"}];Yn({title:"Delete matches",content:f=>o=mr(f,p),buttons:u})}function F1e({drawId:t,structure:e,structureId:i,roundNumber:n,callback:r}={}){i=i||e?.structureId;const a=nt.allDrawMatchUps({matchUpFilters:{structureIds:[i]},drawId:t}).matchUps||[],s=a.reduce((v,y)=>{const b=y.roundNumber;return b&&!v.includes(b)&&v.push(b),v},[]),o=Math.max(...s,1);a.length?s.push(o+1):s.length||s.push(1);let l;const c=[{label:"Cancel",intent:"none",close:!0},{label:"Add",intent:"is-success",close:!0,onClick:()=>{const v=parseInt(l.roundNumber.value),y=l.matchUpsCount.value==="Auto"?void 0:parseInt(l.matchUpsCount.value),b=nt.generateAdHocMatchUps({roundNumber:v,matchUpsCount:y,structureId:i,drawId:t});if(!b.matchUps?.length)return;const I=[{method:BEe,params:{matchUps:b.matchUps,structureId:i,drawId:t}}];Wt({methods:I,callback:w=>{w.success?Mt(r)&&r&&r({refresh:!0}):console.log(w.error)}})}}],p={text:"Round number:",fieldPair:{options:s.map(v=>({label:v,value:v})),field:"roundNumber",value:n,id:"roundNumber"}},f={text:"Number to add:",fieldPair:{options:["Auto",1,5,10].map(v=>({label:v,value:v})),field:"matchUpsCount",id:"matchUpsCount",value:"Auto"}},m=[p,{spacer:!0},f];Yn({title:"Add matches",content:v=>l=mr(v,m),buttons:c})}const{ASSIGN_PARTICIPANT:yft}=g0;function sZ({drawId:t,structure:e,structureId:i,callback:n}={}){i=i||e?.structureId;let r,a;const s=nt.allDrawMatchUps({matchUpFilters:{structureIds:[i]},drawId:t}).matchUps||[],o=s.reduce((v,y)=>{const b=y.roundNumber;return b&&!v.includes(b)&&v.push(b),v},[]),l=o[o.length-1],u=Math.max(...o,1);s.length&&o.push(u+1);const c=({matchUps:v,roundResults:y})=>{const b=[{params:{structureId:i,matchUps:v,drawId:t},method:BEe}];if(y?.length)for(const S of y){const w=S?.modifiedScaleValues;b.push({params:{modifiedScaleValues:w,replacePriorValues:!0},method:RJe})}Wt({methods:b,callback:S=>{S.success?Mt(n)&&n&&n({refresh:!0}):console.log(S.error)}})},d=v=>{const y=a.wtn.checked&&"wtn"||a.utr.checked&&"utr"||"",{accessor:b,scaleName:I}=zi.scales[y]??{};aO(y);const S=nt.drawMatic({updateParticipantRatings:!0,dynamicRatings:!0,refreshRatings:!0,participantIds:v,scaleAccessor:b,scaleName:I,drawId:t});S.matchUps?.length&&c(S)},p=({participantIds:v})=>{const y=nt.getParticipants({participantFilters:{participantIds:v}}).participants,b=l?s.filter(({roundNumber:T,sides:U})=>T===l&&U?.some(({participantId:C})=>C)).map(({sides:T})=>T.map(({participantId:U})=>U)).flat():[],I=b.length?b:v;_N({title:"Confirm player selection",selectedParticipantIds:I,activeOnEnter:!0,selectionLimit:99,onSelection:T=>{const U=T.selected?.map(({participantId:C})=>C);d(U)},action:{type:yft,participantsAvailable:y},update:r})},f=[{label:"Cancel",intent:"none",close:!0},{label:"Add round",intent:"is-success",close:!1,onClick:()=>{if(a[Ou].value===Ou){const{drawDefinition:v}=nt.getEvent({drawId:t}),y=v.entries.filter(({entryStatus:b,entryStage:I})=>!["WITHDRAWN","UNGROUPED"].includes(b)&&(!I||I===e.stage)).map(({participantId:b})=>b);p({participantIds:y})}else{Aw();const v=nt.generateAdHocMatchUps({newRound:!0,structureId:i,drawId:t});if(!v.matchUps?.length)return;c(v)}}}],m=[{field:Ou,value:Ou,options:[{label:Ou,value:Ou,selected:!0},{label:f6,value:!1}]},{options:[{text:"WTN",field:"wtn",checked:zi.activeScale===_C},{text:"UTR",field:"utr",checked:zi.activeScale===yw},{text:"None",field:"none",checked:!zi.activeScale}],onClick:v=>console.log({x:v}),label:"Level of play",field:"levelOfPlay",id:"levelOfPlay",radio:!0}];r=Yn({title:"Add round",content:v=>a=mr(v,m),buttons:f}).update}const $1e="Delete matches",B1e="Add matches",V1e="Add round";function bft({structure:t,drawId:e,callback:i}){if(!nt.isAdHoc({structure:t}))return{};const n=()=>i({refresh:!0});return{label:"Round actions",options:[{onClick:()=>F1e({drawId:e,structure:t,callback:n}),label:B1e,color:"blue"},{onClick:()=>sZ({drawId:e,structure:t,callback:n}),label:V1e,color:"blue"},{label:$1e,color:"red",onClick:()=>L1e({drawId:e,structure:t,callback:n})}],selection:!1,location:ti,align:ti}}const{CONTAINER:Ift}=Zr;function wft({callback:t,structure:e,existingView:i}){const n=o=>i!==o&&t({refresh:!0,view:o}),r=e?.structureType===Ift,a=nt.isAdHoc({structure:e}),s=[];return s.push({active:!i||i===nH,onClick:()=>n(nH),label:a?"Columns":"Draw",close:!0}),s.push({active:i===KT,onClick:()=>n(KT),label:"Table",close:!0}),(a||r)&&s.push({active:i===YT,onClick:()=>n(YT),label:"Stats",close:!0}),{tabs:s}}const{MAIN:Sft,QUALIFYING:Tft,VOLUNTARY_CONSOLATION:Uft}=Zr;function oZ({updateDisplay:t,callback:e,structure:i,drawId:n,existingView:r}){const a=document.getElementById(g6),{sourceStructuresComplete:s,hasDrawFeedProfile:o}=i??{},l=!(i?.stage===Sft&&i?.stageSequence===1)&&i?.stage!==Tft&&o,u=nt.isAdHoc({structure:i}),c=[];if(l){const h=()=>{const m={params:{structureId:i.sourceStructureIds[0],drawId:n},method:$Je};Wt({methods:[m],callback:v=>{v.success&&typeof t=="function"&&t()}})},f=i.positionAssignments?.filter(({participantId:m})=>m).length;c.push({intent:s?"is-primary":Rt,disabled:s!==!0,visible:!f,onClick:h,label:"Auto position",location:ti})}const d=({refresh:h,view:f})=>typeof e=="function"&&e&&e({refresh:h,view:f});if(u){const h=bft({structure:i,drawId:n,callback:e});c.push(h)}i?.stage===Uft&&console.log("voluntary controlBar with [View participants]");const p=wft({structure:i,existingView:r,callback:d}).tabs;c.push({onClick:()=>d({refresh:!0,view:"participants"}),id:"roundDisplayTabs",location:hi,tabs:p}),c.length&&a&&wo({target:a,items:c})}function E2(){[g6,lge,uge].forEach(t=>{const e=document.getElementById(t);e&&Js(e)})}const Dft=t=>t.reduce((e,i)=>e+parseFloat(i.toString()),0),hne=t=>parseFloat((Dft(t)/t.length).toFixed(2));function fne({participantResult:t,drawPosition:e,participantId:i,participantMap:n}={}){const r=`${t?.pointsWon||0}/${t?.pointsLost||0}`,a=`${t?.gamesWon||0}/${t?.gamesLost||0}`,s=`${t?.setsWon||0}/${t?.setsLost||0}`,o=t?.groupOrder||t?.provisionalOrder,l=t?.pressureScores?.length?hne(t.pressureScores):0,u=t?.ratingVariation?.length?hne(t.ratingVariation):0,c=n?.[i||""];return{participantName:c?.participantName,groupName:c?.groupName,...t,averageVariation:u,averagePressure:l,participantId:i,pointsResult:r,drawPosition:e,participant:c,gamesResult:a,setsResult:s,order:o}}function jz(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:t-e}function NS(t){const e=t.getValue();return e&&`${(parseFloat(e)*100).toFixed(0)}%`}function mne(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:e-t}function Eft(){return[{headerMenu:rg({}),field:"drawPosition",headerSort:!1,hozAlign:hi,width:55},{formatter:"responsiveCollapse",hozAlign:di,responsive:!1,headerSort:!1,resizable:!1,width:50},{formatter:tS(({event:t,cell:e,...i})=>console.log("cell clicked",{event:t,cell:e,undefined:void 0,params:i})),sorter:CU,field:"participantName",responsive:!1,resizable:!1,maxWidth:400,minWidth:200,widthGrow:2,title:"Name"},{headerHozAlign:di,headerWordWrap:!0,title:"Match W/L",hozAlign:di,maxWidth:80,field:"result"},{formatter:NS,headerHozAlign:di,headerWordWrap:!0,field:"matchUpsPct",title:"Match Win%",hozAlign:di,maxWidth:80},{headerHozAlign:di,headerWordWrap:!0,field:"setsResult",title:"Sets W/L",hozAlign:di,maxWidth:80},{formatter:NS,headerHozAlign:di,headerWordWrap:!0,title:"Set Win%",hozAlign:di,field:"setsPct",maxWidth:80},{headerHozAlign:di,headerWordWrap:!0,field:"gamesResult",title:"Games W/L",hozAlign:di,maxWidth:80},{formatter:NS,headerHozAlign:di,headerWordWrap:!0,title:"Game Win%",hozAlign:di,field:"gamesPct",maxWidth:80},{headerHozAlign:di,headerWordWrap:!0,field:"pointsResult",title:"Points W/L",hozAlign:di,maxWidth:80},{formatter:NS,headerHozAlign:di,headerWordWrap:!0,title:"Points Win%",field:"pointsPct",hozAlign:di,maxWidth:80},{formatter:NS,field:"averageVariation",headerHozAlign:di,sorter:mne,hozAlign:di,maxWidth:70,title:"RV"},{formatter:NS,field:"averagePressure",headerHozAlign:di,sorter:mne,hozAlign:di,maxWidth:70,title:"PS"},{headerHozAlign:di,field:"pressureOrder",sorter:jz,title:"PS#",hozAlign:di,maxWidth:80},{headerHozAlign:di,sorter:jz,hozAlign:di,title:"Order",field:"order",maxWidth:80},{field:"groupName",visible:!1,title:"Group"}]}async function j1e({eventId:t,drawId:e,structureId:i}){let n,r,a,s;const o=y=>(y??[]).reduce((b,I)=>(b[I.participantId]=I,b),{}),l={},u=()=>{const{participants:y,eventData:b}=nt.getEventData({participantsProfile:{withScaleValues:!0},allParticipantResults:!0,pressureRating:!0,refreshResults:!0,eventId:t});return r=b?.drawsData?.find(w=>w.drawId===e)?.structures?.find(w=>w.structureId===i),s||(s=o(y)),(r?.roundMatchUps?Object.values(r.roundMatchUps).flat():[]).forEach(({sides:w,structureName:T,structureId:U})=>{l[U]=T,w.forEach(C=>{C.participantId&&(s[C.participantId].groupName=T)})}),(r?.participantResults??[]).filter(w=>{const T=s[w.participantId];return!a||T?.participantName?.toLowerCase().includes(a?.toLowerCase())})},c=u(),d=()=>c?.map(y=>fne({...y,participantMap:s})).sort((y,b)=>jz(y.order,b.order)),p=()=>u()?.map(y=>fne({...y,participantMap:s})),h=y=>{y?.participantFilter!==void 0&&(a=y.participantFilter),n.replaceData(p())},f=d(),m=Eft();return(y=>{ng({anchorId:nf});const b=document.getElementById(nf),I=Object.values(l).length>1?["groupName"]:void 0;n=new Bs(b,{headerSortElement:wf(["averageVariation","averagePressure","participantName","pressureOrder","pointsResult","gamesResult","matchUpsPct","setsResult","pointsPct","gamesPct","setsPct","result","order"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,groupHeader:[S=>S],placeholder:"No participants",responsiveLayout:"collapse",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:I,columns:m,data:y})})(f),oZ({structure:r,drawId:e,existingView:YT,callback:({refresh:y,view:b}={})=>{E2(),b?Br({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:b}):T1({eventId:t,drawId:e,structureId:i,redraw:y,roundsView:b})},updateDisplay:h}),aZ({eventId:t,drawId:e,structureId:i,updateDisplay:h}),{table:n,replaceTableData:h}}const gne=(function(){let t;const e={elapsed:1e5,held:void 0,touched:void 0,holdTime:800,holdAction:void 0,holdActions:{}},i={};let n={};const r=(d,p)=>d.filter(h=>p.indexOf(h)!==-1).filter((h,f,m)=>m.indexOf(h)===f);e.reset=()=>(n={},e),e.register=(d,p,h,f)=>(typeof h=="function"&&(n[p]||(n[p]={},i[p]=[]),n[p][d]={fx:h,delay:f},i[p]=Object.keys(n[p])),e),e.deRegister=(d,p)=>(n[p]&&(delete n[p][d],i[p]=Object.keys(n[p])),e),e.call=(d,p,...h)=>n?.[p]?.[d]?.fx(...h),e.trigger=(d,p,h,f)=>n[p][d].fx(h,f,p),e.list=()=>console.log(n);const a="ontouchstart"in document.documentElement?"touchstart":"click";document.addEventListener(a,d=>o({evt:d,evnt:"tap"})),document.addEventListener("change",d=>o({evt:d,evnt:"change"})),document.addEventListener("click",d=>o({evt:d,evnt:"click"})),document.addEventListener("mouseover",d=>o({evt:d,evnt:"mouseover",stopPropagation:!1})),document.addEventListener("mouseout",d=>o({evt:d,evnt:"mouseout",stopPropagation:!1})),document.addEventListener("keyup",d=>o({evt:d,evnt:"keyup",stopPropagation:!1}));let s=0;function o({evt:d,evnt:p,stopPropagation:h=!0}){h&&d.stopPropagation();const f=d,m={x:f.clientX,y:f.clientY,pageX:f.pageX,pageY:f.pageY},g=Array.from(d.target.classList),v=g.length&&i[p]?r(g,i[p]):[];if(v.length){const y=new Date().getTime();e.elapsed=y-s,s=y,v.forEach(b=>{l({cls:b,evt:d,evnt:p,mouse:m})})}}function l({cls:d,evt:p,evnt:h,mouse:f}){const m=p.target;n[h][d].fx(m,f,h,p)}document.addEventListener("touchstart",d=>{const p=d;e.touched=p.target,e.coords=[p.touches[0].clientX,p.touches[0].clientY],e.touched&&(t=setTimeout(function(){c()},e.holdTime))},!1),document.addEventListener("touchend",function(){u()},!1),document.addEventListener("touchmove",function(d){const p=d;e.touched!==p.target&&u()},!1);function u(){clearTimeout(t)}function c(){typeof e.holdAction=="function"&&(e.held=e.touched,e.holdAction(e.held,e.coords))}return(function(){let d=!1,p,h="";function f(){clearTimeout(p),d=!0,h!=="can-touch"&&(h="can-touch",document.documentElement.classList.add(h)),p=setTimeout(function(){d=!1},500)}function m(){!d&&h==="can-touch"&&(d=!1,h="",document.documentElement.classList.remove("can-touch"))}document.addEventListener("touchstart",f,!1),document.addEventListener("mouseover",m,!1)})(),e})();function Pft({structure:t,drawId:e,callback:i}){const n=document.createElement("div");n.className="flexcol flexcenter",n.style.width="100%",n.style.height="300px";const r=document.createElement("button");r.onclick=s=>{s.stopPropagation(),s.preventDefault(),sZ({structure:t,callback:i,drawId:e})},r.className="button is-info",r.innerHTML="Generate round",n.appendChild(r);const a=document.getElementById(nf);a&&a.appendChild(n)}function Cft({drawData:t,eventId:e,drawId:i}){const n=document.createElement("div");n.className="flexcol flexcenter",n.style.width="100%",n.style.height="300px";const r=document.createElement("button");r.onclick=s=>{s.stopPropagation(),s.preventDefault();const o=t.drawName;NU({callback:l=>{const u=l.drawDefinition?.structures?.find(({stage:c})=>c===nM)?.structureId;Br({eventId:e,drawId:i,structureId:u,renderDraw:!0})},isQualifying:!0,drawName:o,eventId:e,drawId:i})},r.className="button is-info",r.innerHTML="Generate qualifying",n.appendChild(r);const a=document.getElementById(nf);a&&a.appendChild(n)}const vne={ALTERNATE:"Assign alternate",ASSIGN:"Assign participant",BYE:"Assign BYE",REMOVE_PARTICIPANT:"Remove assignment",REMOVE:"Remove assignment",QUALIFIER:"Assign qualifier",LUCKY:"Assign Lucky Loser",SEED_VALUE:"Assign seed",SWAP:"Swap draw positions",WITHDRAW:"Withdraw participant"};function Rft({pointerEvent:t,actions:e,callback:i}){const n=t.target,r=s=>{["WITHDRAW","BYE","REMOVE","REMOVE_PARTICIPANT"].includes(s.type)&&Mft({action:s,callback:i}),["ASSIGN","ALTERNATE","SWAP","QUALIFIER","LUCKY"].includes(s.type)&&Nft({action:s,callback:i}),["SEED_VALUE"].includes(s.type)&&Aft({target:n,action:s,callback:i})},a=e?.filter(({type:s})=>vne[s]).map(s=>({option:vne[s.type]||s.type,onClick:()=>r(s)}));a?.length&&Pu({options:a,target:n,config:{arrow:!1,offset:[0,0]}})}function Mft({action:t,callback:e}){const i=r=>r.success?e():console.log({result:r}),n=[{method:t.method,params:t.payload}];Wt({methods:n,callback:i})}function Nft({action:t,callback:e}){_N({action:t,onSelection:n=>{const r=s=>s.success?e():console.log({result:s}),a=[{params:{...t.payload,...n},method:t.method}];Wt({methods:a,callback:r})},selectOnEnter:!0})}function Aft({target:t,action:e,callback:i}){let n;function r(s){if(s?.key==="Enter"){const o=s.target.value;if(Mi.isConvertableInteger(o)){const l=c=>c.success?i():console.log({result:c}),u=[{params:{...e.payload,seedValue:o},method:e.method}];Wt({methods:u,callback:l})}n.destroy()}}n=Pu({menuItems:[{label:"Assign seed number ",validator:bh,placeholder:"Seed number",field:"seedNumber",id:"seedNumber",type:"input",focus:!0,onKeyDown:r}],target:t,config:{arrow:!1,offset:[0,0]}})}function _ft(t){const{structureId:e,drawId:i}=t?.context??t,n=t.eventData?.drawsData?.find(a=>a.drawId===i)?.structures?.find(a=>a.structureId===e),r=[];if(nt.isAdHoc({structure:n})){const a=[{onClick:()=>F1e({...t}),text:B1e,color:"blue"},{onClick:()=>sZ({...t,structure:n}),text:V1e,color:"blue"},{onClick:()=>L1e({...t}),text:$1e,color:"red"}];r.push(...a)}t?.pointerEvent&&r.length&&Pu({items:r,target:t.pointerEvent.target,config:{placement:Gp}})}const{TEAM:kft}=qs;function xft({callback:t,drawId:e,eventData:i}){const n=i?.drawsData?.flatMap(({structures:d})=>d.flatMap(p=>[p.structures?.flatMap(h=>Object.values(h.roundMatchUps||{}).flat()),...Object.values(p.roundMatchUps||{}).flat()]).filter(Boolean)),r=Mi.createMap(n,"matchUpId"),a=d=>{const p=PE(d.pointerEvent.target,"tmx-m","id");return r[p]},s=d=>parseInt(PE(d.pointerEvent.target,"tmx-sd","sideNumber")),o=d=>PE(d.pointerEvent.target,"tmx-str","id"),l=d=>parseInt(PE(d.pointerEvent.target,"tmx-rd","roundNumber")),u=d=>{const p=a(d);if(!p)return;const h=s(d),f=d.side||p.sides?.find(g=>g.sideNumber===h),{validActions:m}=p.drawId&&nt.positionActions({sideNumber:h||f?.sideNumber,structureId:p?.structureId,drawPosition:f?.drawPosition,matchUpId:p?.matchUpId,drawId:p?.drawId,policyDefinitions:{positionActions:{},...Sm.policies.POLICY_POSITION_ACTIONS_UNRESTRICTED}})||{};Rft({...d,actions:m,callback:t})},c=d=>{const p=s(d),h=a(d);if(!h)return;const{validActions:f}=nt.matchUpActions({matchUpId:h.matchUpId,drawId:h.drawId,sideNumber:p})||{},m=f?.find(({type:g})=>g==="SCORE");if(m)if(h.matchUpType===kft){const g=()=>t(),v=i?.eventInfo?.eventName,{matchUpId:y,drawId:b}=h;S2({title:v,drawId:b,matchUpId:y,onClose:g})}else ON({matchUpId:m.payload.matchUpId,callback:t})};return{centerInfoClick:()=>console.log("centerInfo click"),roundHeaderClick:d=>{const p=l(d),h=o(d);return _ft({pointerEvent:d.pointerEvent,roundNumber:p,structureId:h,eventData:i,callback:t,drawId:e})},scheduleClick:d=>{if(d?.pointerEvent){d.pointerEvent.stopPropagation();const p=PE(d.pointerEvent.target,"tmx-m","id"),h=r[p];eZ({pointerEvent:d.pointerEvent,matchUp:h,callback:t})}},venueClick:d=>{const p=a(d);if(d?.pointerEvent&&p?.schedule?.venueId){const h=p.schedule.venueId,f=nt.findVenue({venueId:h})?.venue?.addresses?.[0],{latitude:m,longitude:g}=f||{};if(!m||!g)return;const v=`https://www.google.com/maps/@?api=1&map_action=map&center=${m}%2C${g}&zoom=18&basemap=satellite`,y=`https://bing.com/maps/default.aspx?cp=${m}~${g}&lvl=17&style=h`,b=S=>{const w=S&&m&&g&&(S==="google"&&v||y);w&&window.open(w,"_blank")};Pu({items:[{heading:"Venue Location"},{divider:"divider"},{onClick:()=>b("google"),hide:!m||!g,text:"Open in Google Maps"},{onClick:()=>b("bing"),hide:!m||!g,text:"Open in Bing Maps"}],target:d.pointerEvent.target,config:{placement:Gp}})}},participantClick:u,matchUpClick:c,scoreClick:c}}var yne=11;function Oft(t,e){var i=e.attributes,n,r,a,s,o;if(!(e.nodeType===yne||t.nodeType===yne)){for(var l=i.length-1;l>=0;l--)n=i[l],r=n.name,a=n.namespaceURI,s=n.value,a?(r=n.localName||r,o=t.getAttributeNS(a,r),o!==s&&(n.prefix==="xmlns"&&(r=n.name),t.setAttributeNS(a,r,s))):(o=t.getAttribute(r),o!==s&&t.setAttribute(r,s));for(var u=t.attributes,c=u.length-1;c>=0;c--)n=u[c],r=n.name,a=n.namespaceURI,a?(r=n.localName||r,e.hasAttributeNS(a,r)||t.removeAttributeNS(a,r)):e.hasAttribute(r)||t.removeAttribute(r)}}var xA,Lft="http://www.w3.org/1999/xhtml",td=typeof document>"u"?void 0:document,Fft=!!td&&"content"in td.createElement("template"),$ft=!!td&&td.createRange&&"createContextualFragment"in td.createRange();function Bft(t){var e=td.createElement("template");return e.innerHTML=t,e.content.childNodes[0]}function Vft(t){xA||(xA=td.createRange(),xA.selectNode(td.body));var e=xA.createContextualFragment(t);return e.childNodes[0]}function jft(t){var e=td.createElement("body");return e.innerHTML=t,e.childNodes[0]}function Gft(t){return t=t.trim(),Fft?Bft(t):$ft?Vft(t):jft(t)}function OA(t,e){var i=t.nodeName,n=e.nodeName,r,a;return i===n?!0:(r=i.charCodeAt(0),a=n.charCodeAt(0),r<=90&&a>=97?i===n.toUpperCase():a<=90&&r>=97?n===i.toUpperCase():!1)}function Hft(t,e){return!e||e===Lft?td.createElement(t):td.createElementNS(e,t)}function zft(t,e){for(var i=t.firstChild;i;){var n=i.nextSibling;e.appendChild(i),i=n}return e}function Cj(t,e,i){t[i]!==e[i]&&(t[i]=e[i],t[i]?t.setAttribute(i,""):t.removeAttribute(i))}var bne={OPTION:function(t,e){var i=t.parentNode;if(i){var n=i.nodeName.toUpperCase();n==="OPTGROUP"&&(i=i.parentNode,n=i&&i.nodeName.toUpperCase()),n==="SELECT"&&!i.hasAttribute("multiple")&&(t.hasAttribute("selected")&&!e.selected&&(t.setAttribute("selected","selected"),t.removeAttribute("selected")),i.selectedIndex=-1)}Cj(t,e,"selected")},INPUT:function(t,e){Cj(t,e,"checked"),Cj(t,e,"disabled"),t.value!==e.value&&(t.value=e.value),e.hasAttribute("value")||t.removeAttribute("value")},TEXTAREA:function(t,e){var i=e.value;t.value!==i&&(t.value=i);var n=t.firstChild;if(n){var r=n.nodeValue;if(r==i||!i&&r==t.placeholder)return;n.nodeValue=i}},SELECT:function(t,e){if(!e.hasAttribute("multiple")){for(var i=-1,n=0,r=t.firstChild,a,s;r;)if(s=r.nodeName&&r.nodeName.toUpperCase(),s==="OPTGROUP")a=r,r=a.firstChild,r||(r=a.nextSibling,a=null);else{if(s==="OPTION"){if(r.hasAttribute("selected")){i=n;break}n++}r=r.nextSibling,!r&&a&&(r=a.nextSibling,a=null)}t.selectedIndex=i}}},FE=1,Ine=11,wne=3,Sne=8;function iy(){}function qft(t){if(t)return t.getAttribute&&t.getAttribute("id")||t.id}function Wft(t){return function(i,n,r){if(r||(r={}),typeof n=="string")if(i.nodeName==="#document"||i.nodeName==="HTML"||i.nodeName==="BODY"){var a=n;n=td.createElement("html"),n.innerHTML=a}else n=Gft(n);else n.nodeType===Ine&&(n=n.firstElementChild);var s=r.getNodeKey||qft,o=r.onBeforeNodeAdded||iy,l=r.onNodeAdded||iy,u=r.onBeforeElUpdated||iy,c=r.onElUpdated||iy,d=r.onBeforeNodeDiscarded||iy,p=r.onNodeDiscarded||iy,h=r.onBeforeElChildrenUpdated||iy,f=r.skipFromChildren||iy,m=r.addChild||function(x,O){return x.appendChild(O)},g=r.childrenOnly===!0,v=Object.create(null),y=[];function b(x){y.push(x)}function I(x,O){if(x.nodeType===FE)for(var $=x.firstChild;$;){var F=void 0;O&&(F=s($))?b(F):(p($),$.firstChild&&I($,O)),$=$.nextSibling}}function S(x,O,$){d(x)!==!1&&(O&&O.removeChild(x),p(x),I(x,$))}function w(x){if(x.nodeType===FE||x.nodeType===Ine)for(var O=x.firstChild;O;){var $=s(O);$&&(v[$]=O),w(O),O=O.nextSibling}}w(i);function T(x){l(x);for(var O=x.firstChild;O;){var $=O.nextSibling,F=s(O);if(F){var j=v[F];j&&OA(O,j)?(O.parentNode.replaceChild(j,O),C(j,O)):T(O)}else T(O);O=$}}function U(x,O,$){for(;O;){var F=O.nextSibling;($=s(O))?b($):S(O,x,!0),O=F}}function C(x,O,$){var F=s(O);if(F&&delete v[F],!$){var j=u(x,O);if(j===!1||(j instanceof HTMLElement&&(x=j,w(x)),t(x,O),c(x),h(x,O)===!1))return}x.nodeName!=="TEXTAREA"?E(x,O):bne.TEXTAREA(x,O)}function E(x,O){var $=f(x,O),F=O.firstChild,j=x.firstChild,H,G,W,q,Z;e:for(;F;){for(q=F.nextSibling,H=s(F);!$&&j;){if(W=j.nextSibling,F.isSameNode&&F.isSameNode(j)){F=q,j=W;continue e}G=s(j);var K=j.nodeType,Q=void 0;if(K===F.nodeType&&(K===FE?(H?H!==G&&((Z=v[H])?W===Z?Q=!1:(x.insertBefore(Z,j),G?b(G):S(j,x,!0),j=Z,G=s(j)):Q=!1):G&&(Q=!1),Q=Q!==!1&&OA(j,F),Q&&C(j,F)):(K===wne||K==Sne)&&(Q=!0,j.nodeValue!==F.nodeValue&&(j.nodeValue=F.nodeValue))),Q){F=q,j=W;continue e}G?b(G):S(j,x,!0),j=W}if(H&&(Z=v[H])&&OA(Z,F))$||m(x,Z),C(Z,F);else{var J=o(F);J!==!1&&(J&&(F=J),F.actualize&&(F=F.actualize(x.ownerDocument||td)),m(x,F),T(F))}F=q,j=W}U(x,j,G);var ne=bne[x.nodeName];ne&&ne(x,O)}var P=i,M=P.nodeType,R=n.nodeType;if(!g){if(M===FE)R===FE?OA(i,n)||(p(i),P=zft(i,Hft(n.nodeName,n.namespaceURI))):P=n;else if(M===wne||M===Sne){if(R===M)return P.nodeValue!==n.nodeValue&&(P.nodeValue=n.nodeValue),P;P=n}}if(P===n)p(i);else{if(n.isSameNode&&n.isSameNode(P))return;if(C(P,n,g),y)for(var N=0,A=y.length;N<A;N++){var _=v[y[N]];_&&S(_,_.parentNode,!1)}}return!g&&P!==i&&i.parentNode&&(P.actualize&&(P=P.actualize(i.ownerDocument||td)),i.parentNode.replaceChild(P,i)),P}}var Yft=Wft(Oft);const{DOUBLES:Kft,TEAM:Tne}=dl;function T1({eventId:t,drawId:e,structureId:i,roundsView:n,redraw:r}){if(!nt.getEvents().events?.length)return;let s;gne.register("tmx-tm","mouseover",gft),gne.register("tmx-tm","mouseout",vft);let o,l,u=[],c,d="",p,h,f=[],m;const g=()=>{c=nt.getEventData({participantsProfile:{convertExtensions:!0,withScaleValues:!0,withGroupings:!0,withISO2:!0,withIOC:!0},includePositionAssignments:!0,eventId:t})?.eventData,d=c?.eventInfo?.eventType,h=c?.drawsData?.find(R=>R.drawId===e),u=h?.structures||[],i=i||u?.[0]?.structureId,p=u.find(R=>R.structureId===i),s=nt.isAdHoc({structure:p}),{roundMatchUps:l,stage:m}=Mi.makeDeepCopy(p||{}),f=Object.values(l||{}).flat(),s&&f.sort(Mi.matchUpScheduleSort)};d2(),g();const v=R=>{const{refresh:N,view:A}=R??{},_=N||o;E2(),A?Br({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:A}):T1({eventId:t,drawId:e,structureId:i,redraw:_,roundsView:A})},y=f?.length===1&&c?.eventInfo?.eventType===Tne,b=xft({eventData:c,callback:v,drawId:e}),I=p?.display||h?.display||c?.eventInfo?.display||{},S=I?.compositionName,w=I?.configuration,T=Fx[S]||zi.composition||Fx[d===Kft&&"National"||d===Tne&&"Basic"||"National"];T.configuration.flags=!1,Object.assign(T.configuration,w),T.configuration.scaleAttributes&&(T.configuration.scaleAttributes=zi.scales[zi.activeScale]),zi.composition||(T.configuration.genderColor=!0,T.configuration.showAddress=void 0,T.configuration.allDrawPositions=!0,T.configuration.drawPositions=!0),T.configuration.roundHeader=!0;const U=document.getElementById(nf);r&&U&&Js(U);const C=()=>{if(y)return;for(const N of Object.keys(p?.roundMatchUps??{}))p.roundMatchUps[N]=l?.[N]?.filter(({sides:A})=>A?.some(({participant:x})=>x?.participantName.toLowerCase().includes(o))||!o);const R=Object.values(p.roundMatchUps||{}).flat();if(f.length)if(n===KT)G1e({matchUps:R,eventData:c});else if(n===YT)j1e({eventId:t,drawId:e,structureId:i});else{const N=lJe({content:oJe({context:{drawId:e,structureId:i},searchActive:o,matchUps:R,eventHandlers:b,composition:T}),theme:T.theme}),A=x=>x?.classList?.contains("tmx-p")?x:jl(x,"tmx-p"),_=U?.firstChild;_?Yft(_,N,{addChild:function(x,O){if(O.classList){const $=x.firstChild,F=O.getAttribute("id"),j=![null,"undefined",void 0].includes(F),H=x.firstChild?.getAttribute?.("id"),G=![null,"undefined",void 0].includes(H);try{if(!j&&!G){zi.renderLog&&console.log("condition 0");const W=A($)?.nextSibling;W?.getAttribute("id")&&A($)?.getAttribute("id")&&W.parentElement.removeChild(W)}else j&&G&&F&&H&&F!==H?(zi.renderLog&&console.log("condition 1"),x.removeChild(x.firstChild)):O.classList?.contains("tmx-p")&&!G?(zi.renderLog&&console.log("condition 2"),x.removeChild(x.firstChild)):x.firstChild?.classList?.contains("tmx-p")&&x.firstChild.getAttribute("id")!=="undefined"&&O.getAttribute("id")==="undefined"?(zi.renderLog&&console.log("condition 3"),x.removeChild(x.firstChild)):!j&&G?zi.renderLog&&console.log("condition 4"):console.log({incomingId:j,existingId:G,incomingIdValue:F,existingIdValue:H})}catch(W){console.log({err:W})}}x.appendChild(O)}}):U&&U.appendChild(N)}else if(m===nM)Cft({drawData:h,drawId:e,eventId:t});else if(s)Pft({structure:p,drawId:e,callback:v});else{const N=u?.[0]?.structureId;return T1({eventId:t,drawId:e,structureId:N,redraw:!0})}};oZ({updateDisplay:()=>{g(),C()},drawId:e,structure:p,existingView:n,callback:v});const P=document.getElementById(rM)||void 0,M=R=>{R&&g();const N=x=>x.searchText?.includes(o),_=O1e({updateParticipantFilter:x=>{x||Object.values(It.tables).filter(Boolean).forEach(O=>O.clearFilter()),o=x?.toLowerCase(),x&&Object.values(It.tables).filter(Boolean).forEach(O=>O.addFilter(N)),U&&Js(U),C()},updateControlBar:M,structureId:i,eventData:c,matchUps:f,eventId:t,drawId:e});wo({target:P,items:_})};if(!h){console.log("no draw data",{eventData:c,drawData:h});return}if(i||(i=h.structures?.[0]?.structureId),!i){console.log("structure not found");return}if(y){const R=T2({matchUp:f[0]});R&&U&&U.appendChild(R)}else C();M()}function Zft(t,e){const i=e>1?"items":"item";return t+`<span style='color:blue; margin-left:10px;'>(${e} ${i})</span>`}const{TEAM:Xft}=qs,Jft=t=>(e,i)=>{const r=i.getRow().getData(),{matchUpId:a,readyToScore:s,matchUpType:o,drawId:l,eventName:u}=r.matchUp;if(o===Xft)S2({title:u,matchUpId:a,drawId:l,onClose:()=>t()});else if(s||Cy.checkScoreHasValue(r.matchUp)){const c=()=>{t()};ON({matchUp:r.matchUp,matchUpId:a,callback:c})}};function Qft({data:t,replaceTableData:e}){const i=(o,l)=>{const c=l.getRow().getData(),{courtName:d,scheduledDate:p}=c;if(d&&p){const h=nt.getTournament()?.tournamentRecord?.tournamentId,f=`/${As}/${h}/${ib}/${p}`;It.router.navigate(f)}},n=()=>e(),r=t.some(o=>o.courtName),a=(o,l)=>I1(o,l,n),s=o=>{const l=document.createElement("div");l.className="has-text-warning-dark",l.innerHTML="Select participant";const u=({event:d,...p})=>{I1(d,o,n,p)};return o.getValue().participantName&&tS(u)(o,l)};return[{cellClick:(o,l)=>l.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:hi,width:5},{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:di,minWidth:50,width:50},{headerMenu:rg({duration:"Duration",complete:"Complete"}),formatter:"rownum",headerSort:!1,hozAlign:hi,width:55},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{cellClick:i,field:"scheduledDate",title:"Date",width:110},{cellClick:i,visible:!!r,field:"courtName",title:"Court",width:100},{cellClick:i,field:"scheduleTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:s,cellClick:a,sorter:CU,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:s,cellClick:a,sorter:CU,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{cellClick:Jft(e),formatter:QK,sorter:g1e,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:i1e,formatter:n1e,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:hi,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70},{cellClick:(o,l)=>eZ({pointerEvent:o,...l.getData()}),formatter:Vv,responsive:!1,headerSort:!1,hozAlign:ti,widthGrow:0,width:50}]}const{TEAM:emt}=dl,Une=t=>{const{potentialParticipants:e,structureName:i,matchUpType:n,roundNumber:r,matchUpId:a,roundName:s,schedule:o,eventId:l,drawId:u,sides:c,...d}=t,{scheduledDate:p,scheduleTime:h,courtName:f}=o||{},m=A=>A.person?.standardFamilyName||A.participantName,g=e?.map(A=>({participantName:A.map(m).filter(Boolean).join(" or ")}))||[],v=c?.[0]?.participant||g.shift(),y=c?.[1]?.participant||g.shift(),b={participantName:v?.participantName,sex:v?.person?.sex,participant:v},I={participantName:y?.participantName,sex:y?.person?.sex,participant:y},S=c.flatMap(({participant:A})=>A?.individualParticipantIds?.length?A.individualParticipantIds:A?.participantId).filter(Boolean),w=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,T=!!d.winningSide,U=!!(d.winningSide||d.readyToScore),C=d.score?.scoreStringSide1,E=c.flatMap(A=>{const _=A.participant?.person;return _?[_.standardGivenName,_.standardFamilyName]:A.participant?.individualParticipants?.map(({person:x})=>[x.standardGivenName,x.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),P=pCe([E,v?.participantName,y?.participantName].filter(Boolean).join(" ")).toLowerCase(),M=t.collectionId?emt:n,R=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,N={score:C,matchUpStatus:t.matchUpStatus,readyToScore:U,complete:T,winningSide:w};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:S,flight:t.drawName,competitiveProfile:R,structureName:i,scheduledDate:p,readyToScore:U,scheduleTime:h,matchUpType:n,scoreDetail:N,winningSide:w,roundNumber:r,searchText:P,courtName:f,eventType:M,matchUpId:a,roundName:s,complete:T,eventId:l,matchUp:t,drawId:u,side1:b,side2:I,score:C}},{CONTAINER:tmt}=Zr;async function G1e({eventId:t,drawId:e,structureId:i,matchUps:n,eventData:r}){let a,s,o,l=!1;const u=()=>{const y={withISO2:!0,withScaleValues:!0},b={withCompetitiveness:!0};s=nt.getEventData({eventId:t,contextProfile:b,participantsProfile:y}).eventData?.drawsData?.find(U=>U.drawId===e)?.structures?.find(U=>U.structureId===i),l=s?.structureType===tmt;const w=s?.roundMatchUps?Object.values(s?.roundMatchUps||{}).flat():[],T=w.flatMap(U=>U.tieMatchUps||[]);return T.length&&w.push(...T),w.filter(({matchUpStatus:U})=>U!=="BYE").filter(({sides:U})=>!o||U.find(C=>C.participant?.participantName?.toLowerCase().includes(o?.toLowerCase())))};n||(n=u()),r&&n.forEach(y=>y.eventName=r.eventInfo.eventName);const c=()=>n?.map(Une),d=()=>u().map(Une),p=y=>{y?.participantFilter&&(o=y.participantFilter),a.replaceData(d())},h=c(),f=Qft({data:h,replaceTableData:p}),m=l?["roundName","structureName"]:["roundName"];return(y=>{ng({anchorId:nf});const b=document.getElementById(nf);a=new Bs(b,{groupHeader:[Zft,I=>I],headerSortElement:wf(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:m,columns:f,data:y})})(h),oZ({structure:s,drawId:e,existingView:KT,callback:({refresh:y,view:b}={})=>{E2(),b?Br({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:b}):T1({eventId:t,drawId:e,structureId:i,redraw:y,roundsView:b})}}),aZ({eventId:t,drawId:e,structureId:i,updateDisplay:p}),{table:a,replaceTableData:p}}function LA({eventId:t,renderDraw:e}={}){const i=document.getElementById(cge),n=document.getElementById(oge),r=document.getElementById(nf),a=document.getElementById(dge);a&&(a.style.display=t||e?"":Rt),i&&(i.style.display=t&&!e?"":Rt),n&&(n.style.display=t||e?Rt:""),r&&(r.style.display=e?"":Rt)}function imt({eventId:t,drawId:e,headerElement:i}){const{event:n,drawDefinition:r}=nt.getEvent({eventId:t,drawId:e});return n&&r?(i.innerHTML=n.eventName,{success:!0}):{}}const H1e=t=>({drawDefinition:e,scaleValues:i})=>{const{drawId:n,drawName:r,drawType:a,entries:s,matchUpFormat:o,tieFormat:l}=e,c=nt.getPublishState({drawId:n}).publishState?.status?.published,d=s?.filter(({entryStatus:h})=>h!=="WITHDRAWN")?.length;return{entries:nt.getAssignedParticipantIds({drawDefinition:e}).assignedParticipantIds?.filter(Boolean)?.length??d??0,matchUpFormat:o,tieFormat:l,utrAvg:i?.ratingsStats?.UTR?.avg,wtnAvg:i?.ratingsStats?.WTN?.avg,published:c,drawName:r,drawType:a,eventId:t,drawId:n}},{MAIN:Dne}=Zr;function z1e({event:t,scaleValues:e,lightMode:i=!1}){const{drawDefinitions:n=[],eventName:r,entries:a,eventId:s}=t,o=$F.getPublishState({event:t}).publishState,l=n.length,u=a.filter(({entryStage:m=Dne,entryStatus:g})=>sO(Dne).includes(`${m}.${g}`))?.length||0;let c=0,d=0,p=0,h=[];if(!i){const m=nt.allEventMatchUps({inContext:!0,eventId:s}).matchUps;c=m?.length||0,d=m?.filter(({winningSide:g,schedule:v})=>!g&&v?.scheduledTime)?.length||0,p=m.filter(({winningSide:g})=>g)?.length||0,h=n.map(g=>H1e(s)({drawDefinition:g,scaleValues:e?.draws?.[g.drawId]}))}const f=[r].concat(n.map(({drawName:m})=>m||"")).join(" ").toLowerCase();return{published:o?.status.published,scheduledMatchUpsCount:d,completedMatchUpsCount:p,matchUpsCount:c,entriesCount:u,drawsCount:l,searchText:f,drawDefs:h,eventId:s,event:t}}function q1e({eventRow:t,drawsTable:e,drawIds:i}){e.deleteRow(i);const n=t?.getData();if(n){const r=nt.allEventMatchUps({eventId:n.eventId,inContext:!1}).matchUps;n.drawDefs=n.drawDefs.filter(a=>!i.includes(a.drawId)),n.matchUpsCount=r?.length||0,n.drawsCount-=i.length}}const W1e=t=>(e,i)=>{const n=i.getRow().getData(),r=n.published?[n.drawId]:void 0,a=n.published?void 0:[n.drawId],o=[{method:qEe,params:{eventId:n.eventId,drawIdsToRemove:r,drawIdsToAdd:a,eventDataParams:{participantsProfile:{withScaleValues:!0},pressureRating:!0,refreshResults:!0}}}];Wt({methods:o,callback:u=>{if(u?.success){i.getRow().update({published:!n.published});const c=t.getData().eventId,p=nt.getPublishState({eventId:c}).publishState?.status?.published;t.update({published:p})}else Ht({message:u.error.message,intent:"is-danger"})}})},Y1e=t=>t.getValue()?'<i class="fa-solid fa-eye" style="color: blue">':'<i class="fa-solid fa-eye-slash" style="color: red">';function K1e(t){const{eventId:e,drawId:i,callback:n}=t,r=nt.findExtension({name:Ey.DISPLAY,discover:!0,eventId:e,drawId:i}).extension?.value,a=r?.admin??r,s=["Wimbledon","French","ITF"],o="saveDisplaySettings",l={compositionName:a?.compositionName??zi.composition?.compositionName??"Australian",configuration:a?.configuration??{},composition:void 0,inputs:void 0},u=Mi.dateTime.extractDate(new Date().toISOString()),c="drawId",p=[{onlineResources:[{link:"https://www.google.com",label:"Google"}],venueName:"Club Courts",venueAbbreviation:"CC",startTime:"08:00",endTime:"20:00",courtsCount:6,venueId:"venueId"}],h=[{eventName:"WTN 14-19 SINGLES",category:{ratingType:"WTN",ratingMin:14,ratingMax:19.99},drawId:c,generate:!0,drawSize:4}],f=[{scheduleDate:u,venues:[{rounds:[{drawId:c,winnerFinishingPositionRange:"1-2"}],venueId:p[0].venueId}]}],m={withScaleValues:!0},g=tM.generateTournamentRecord({scheduleCompletedMatchUps:!0,completeAllMatchUps:!0,participantsProfile:m,autoSchedule:!0,schedulingProfile:f,venueProfiles:p,drawProfiles:h,startDate:u}).tournamentRecord,y=$R.allTournamentMatchUps({tournamentRecord:g}).matchUps.find(N=>N.matchUpType==="SINGLES"),b=document.createElement("div");b.style.maxWidth="500px";const I=document.createElement("div");b.appendChild(I);const S=({compositionName:N,configuration:A})=>{Js(I),l.composition=Fx[N],l.composition.configuration.flags=void 0,Object.assign(l.composition.configuration,A),l.composition.genderColor=!0,l.composition.compositionName=N;const _=xEe({isLucky:!0,composition:l.composition,matchUp:y});I.appendChild(_)};S(l);const w=Object.keys(Fx).filter(N=>N!=="Night").map(N=>({selected:N===l.compositionName,label:N,value:N})),T=l.configuration.participantDetail,U=[{label:"None",value:"NONE",selected:!T},{label:"Address",value:"ADDRESS",selected:T==="ADDRESS"},{label:"Team",value:"TEAM",selected:T==="TEAM"}],C=()=>{l.compositionName=l.inputs.composition.value,l.configuration.scheduleInfo=!s.includes(l.compositionName)&&l.inputs.showSchedule.checked,l.configuration.participantDetail=l.inputs.detail.value,S(l)},E=[{options:w,label:"Composition",field:"composition",onChange:C},{controlVisible:!s.includes(l.compositionName),checked:l.configuration.scheduleInfo,controlId:"scheduleToggle",label:"Show Schedule",field:"showSchedule",id:"showSchedule",checkbox:!0,onChange:C},{options:U,label:"Detail",field:"detail",onChange:C}],P=document.createElement("div");b.appendChild(P);const M=[{onChange:({e:N})=>{const A=!s.includes(N.target.value),_=document.getElementById("scheduleToggle");_&&(_.style.display=A?"block":Rt)},control:"composition"}];l.inputs=mr(P,E,M),Yn({title:"Edit display settings",buttons:[{label:"Cancel",intent:Rt,close:!0},{label:"Save",id:o,intent:"is-info",close:!0,onClick:()=>{const N=()=>{console.log("Mutation completed")},_={value:{...nt.findExtension({name:Ey.DISPLAY,discover:!0,eventId:e,drawId:i})?.extension?.value,compositionName:l.composition.compositionName,configuration:l.configuration},name:Ey.DISPLAY};Wt({methods:[{method:i?CJe:AJe,params:{eventId:e,drawId:i,extension:_}}],callback:N}),Mt(n)&&n(l.composition),zi.composition=l.composition}}],content:b})}const nmt=t=>(e,i)=>{const n=Array.from(document.querySelectorAll(".tippy-content"));if(n.length){n.forEach(h=>h.remove());return}const r=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],s=i.getRow()?.getData(),{published:o,drawId:l,eventId:u}=s;Pu({items:[{onClick:()=>K1e({drawId:s.drawId}),text:"Display settings"},{text:o?"Unpublish":"Publish",onClick:()=>{W1e(t)(e,i)}},{onClick:()=>{D2({eventId:u,drawIds:[l],callback:f=>{f.success||f.error?.message&&Ht({message:f.error.message,intent:"is-danger"}),q1e({eventRow:t,drawsTable:i.getTable(),drawIds:[l]})}})},text:"Delete"},{text:"Edit"}],target:r||e.target,config:{placement:Gp}})};function rmt(t,e){const i=(a,s)=>{const{eventId:o,drawId:l}=s.getRow().getData();Br({eventId:o,drawId:l,renderDraw:!0})},n=t.find(a=>a.utrAvg),r=t.find(a=>a.wtnAvg);return[{cellClick:(a,s)=>s.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:hi,width:5},{headerMenu:rg({entries:"Entries",wtnAvg:"WTN avg",utrAvg:"UTR avg"}),headerSort:!1,formatter:"rownum",hozAlign:di,width:55},{title:'<i class="fa-solid fa-eye"></i>',cellClick:W1e(e),formatter:Y1e,headerSort:!1,field:"published",width:55},{title:"Draw Name",field:vw,cellClick:i},{title:"Draw Type",field:Ph,cellClick:i},{title:'<div class="event_icon opponents_header" />',field:"entries",width:50},{visible:!!r,field:"wtnAvg",title:_C,width:80},{visible:!!n,field:"utrAvg",title:yw,width:80},{cellClick:nmt(e),formatter:Vv,responsive:!1,headerSort:!1,hozAlign:ti}]}const amt=t=>e=>{const i=document.createElement("div"),n=document.createElement("div");n.className="tableControl",n.style.marginBottom="1em";const r=e.getData().drawDefs;i.appendChild(n);const a=document.createElement("div");a.style.backgroundColor="white";const s="1px solid #333";a.style.border=s,a.style.width="99%",i.style.borderBottom=s,i.style.boxSizing="border-box",i.style.borderTop=s,i.style.paddingLeft="10px",i.className=qF,i.style.display=Rt,i.appendChild(a),e.getElement().appendChild(i);const o=rmt(r,e),l=new Bs(a,{headerSortElement:wf(["entries"]),placeholder:"No draws",layout:"fitColumns",index:"drawId",maxHeight:400,columns:o,data:r});l.on("scrollVertical",Nd);const u=e.getData().event,c=u.eventId;t(c,l);const d=()=>{const g=l.getSelectedData().map(({drawId:y})=>y);l.deselectRow(),D2({eventId:c,drawIds:g,callback:y=>{if(!y.success){y.error?.message&&Ht({message:y.error.message,intent:"is-danger"});return}q1e({eventRow:e,drawsTable:l,drawIds:g})}})},p=m=>{if(m.success){l?.addRow(H1e(c)({drawDefinition:m.drawDefinition}));const g=e?.getData();if(a.style.display="",g)if(!g.matchUpsCount)Br({eventId:c,drawId:m.drawDefinition?.drawId,renderDraw:!0});else{const v=nt.allDrawMatchUps({drawId:m.drawDefinition.drawId,inContext:!1,eventId:c}).matchUps;g.matchUpsCount+=v?.length||0,g.drawsCount+=1}}},h=({success:m,eventUpdates:g})=>{if(m){const v=e?.getData();Object.assign(v.event,g),e.update(v)}};wo({table:l,target:n,items:[{onClick:d,label:"Delete selected",intent:"is-danger",stateChange:!0,location:ba},{onClick:()=>Br({eventId:c}),label:"View entries",intent:"is-info",location:hi},{onClick:()=>E1e({eventId:c}),id:"editAvoidances",label:"Avoidances",location:hi},{onClick:()=>m2({event:u,callback:h}),label:"Edit event",location:ti},{onClick:()=>NU({eventId:c,callback:p}),intent:"is-primary",label:"Add draw",location:ti}]})},Z1e=t=>(e,i)=>{const n=i.getRow().getData(),r=n.eventId,a=!n.published,s=n.published?tQe:qEe;t.get(r).getRows().forEach(c=>c.update({published:a})),Wt({methods:[{method:s,params:{eventDataParams:{participantsProfile:{withScaleValues:!0},pressureRating:!0,refreshResults:!0},eventId:r}}],callback:c=>{c?.success?i.getRow().update({published:!n.published}):Ht({message:c.error.message,intent:"is-danger"})}})};function X1e(t){const{eventIds:e,callback:i}=t;if(zi.skipReason){Wt({methods:[{method:_ee,params:{eventIds:e,auditData:{auditReason:"Reason skipped"}}}],callback:i});return}const n=e.length>1?"Delete Events":"Delete Event";let r;const a=()=>{const c={auditReason:r.eventDeletionReason.value};Wt({methods:[{method:_ee,params:{eventIds:e,auditData:c}}],callback:i})},s=[{text:"Please provide a reason for event deletion."},{placeholder:"Explanation",field:"eventDeletionReason",validator:AU(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],l=[{control:"eventDeletionReason",onInput:({inputs:c})=>{const d=c.eventDeletionReason.value,p=AU(5)(d),h=document.getElementById("deleteEvent");h&&(h.disabled=!p)}}];Yn({title:n,content:c=>r=mr(c,s,l),buttons:[{label:"Cancel",intent:Rt,close:!0},{label:"Delete",id:"deleteEvent",disabled:!0,intent:"is-danger",close:!0,onClick:a}]})}const smt=t=>(e,i)=>{const n=Array.from(document.querySelectorAll(".tippy-content"));if(n.length){n.forEach(h=>h.remove());return}const r=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],a=i.getRow().getData(),s=i.getRow(),o=s?.getData(),l=o?.published,u=({success:h,eventUpdates:f})=>{h&&(Object.assign(o.event,f),s.update(o))};Pu({items:[{onClick:()=>K1e({eventId:a.eventId}),text:"Display settings"},{text:l?"Unpublish":"Publish",onClick:()=>{Z1e(t)(e,i)}},{onClick:()=>{const h=[a.eventId];return X1e({eventIds:h,callback:m=>{const g=i.getTable();m.success&&g?.deleteRow(h)}})},text:"Delete"},{onClick:()=>m2({event:a.event,callback:u}),text:"Edit"}],target:r||e.target,config:{placement:Gp}})};function omt(t,e){const i=typeof e=="function"?e():!1,n=(a,s)=>{a.stopPropagation();const o=s.getRow().getData().eventId;Br({eventId:o})},r=(a,s)=>{tw(a,s)};return[{cellClick:(a,s)=>s.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,hozAlign:hi,width:5},{headerMenu:rg({completedMatchUpsCount:"Completed MatchUps",scheduledMatchUpsCount:"Scheduled MatchUps",entriesCount:"Accepted entries",matchUpsCount:"Total matches",drawsCount:"Number of draws",published:"Published"}),formatter:"rownum",headerSort:!1,hozAlign:di,width:55},{title:'<i class="fa-solid fa-eye"></i>',cellClick:Z1e(t),formatter:Y1e,headerSort:!1,field:"published",width:55},{field:"event.eventName",cellClick:r,title:"Event",minWidth:200,visible:!0,widthGrow:3},{field:"event.eventType",title:"Type",visible:!0},{field:"event.gender",title:"Gender",visible:!0},{title:'<div class="event_icon drawsize_header" />',headerTooltip:"Number of Draws",cellClick:tw,headerHozAlign:di,field:"drawsCount",hozAlign:di,headerSort:!0,visible:!0,width:45},{title:'<div class="event_icon opponents_header" />',headerTooltip:"Accepted Entries",headerHozAlign:di,field:"entriesCount",cellClick:n,hozAlign:di,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon matches_header" />',headerTooltip:"Total MatchUps",headerHozAlign:di,field:"matchUpsCount",hozAlign:di,headerSort:!0,visible:!i,width:50},{title:'<div class="event_icon time_header" />',headerTooltip:"Scheduled MatchUps",field:"scheduledMatchUpsCount",headerHozAlign:di,hozAlign:di,headerSort:!0,visible:!i,width:50},{title:'<div class="event_icon rank_header" />',headerTooltip:"Completed MatchUps",field:"completedMatchUpsCount",headerHozAlign:di,hozAlign:di,headerSort:!0,visible:!i,width:50},{cellClick:tw,formatter:zK,responsive:!1,headerSort:!1,hozAlign:ti,field:"isOpen",width:20},{cellClick:smt(t),formatter:Vv,responsive:!1,headerSort:!1,hozAlign:ti,width:20}]}const lmt=15;function umt(){let t;const e=new Map,i=(c,d)=>{e.has(c)||e.set(c,d)},a=(nt.getEvents({withScaleValues:!1})?.events?.length||0)>lmt,s=()=>{const c=nt.getEvents({withScaleValues:!a});return c?.events?.map(d=>z1e({event:d,scaleValues:c.eventScaleValues?.[d.eventId],lightMode:a}))},o=()=>{t.replaceData(s())},l=omt(e,()=>a);return(c=>{ng({anchorId:MC});const d=document.getElementById(MC),p=jl(d,"section")?.querySelector(".tabHeader");p?.innerHTML&&(p.innerHTML=`Events (${c.length})`),t=new Bs(d,{columnDefaults:{},headerSortElement:wf(["scheduledMatchUpsCount","completedMatchUpsCount","matchUpsCount","entriesCount","drawsCount"]),rowFormatter:amt(i),height:window.innerHeight*.8,placeholder:"No events",layout:"fitColumns",reactiveData:!0,index:"eventId",columns:l,data:c}),t.on("scrollVertical",Nd),t.on("dataChanged",h=>{p&&(p.innerHTML=`Events (${h.length})`)}),t.on("dataFiltered",(h,f)=>{p&&(p.innerHTML=`Events (${f.length})`)})})(s()),{table:t,replaceTableData:o}}function cmt(){const t=nt.getPublishState().publishState?.tournament,{table:e}=umt(),i=c=>{if(c?.event){const d=z1e({event:c.event});e?.updateOrAddData([d])}},n=Q0(e),r=()=>{const c=e?.getSelectedData().map(({eventId:p})=>p);return X1e({eventIds:c,callback:p=>p.success&&e?.deleteRow(c)})},a=c=>c?"Unpublish":"Publish",s=c=>`${a(c)} OOP`,o=c=>{if(c?.success){const d=nt.getPublishState().publishState?.tournament,p=document.getElementById("oopButton");p.innerText=s(d?.orderOfPlay?.published),p.classList.toggle("is-primary")}},l=[{onClick:r,label:"Delete selected",intent:"is-danger",stateChange:!0,location:ba},{onKeyDown:c=>c.key==="Backspace"&&c.target.value.length===1&&n(""),onChange:c=>n(c.target.value),onKeyUp:c=>n(c.target.value),clearSearch:()=>n(""),placeholder:"Search events",location:hi,search:!0},{onClick:()=>dmt(o),label:s(t?.orderOfPlay?.published),intent:t?.orderOfPlay?.published?"is-primary":"",id:"oopButton",location:ti},{onClick:()=>m2({callback:i}),label:"Add event",location:ti}],u=document.getElementById(P6)||void 0;wo({table:e,target:u,items:l})}function dmt(t){const r=[{method:nt.getPublishState().publishState?.tournament?.orderOfPlay?.published?"unPublishOrderOfPlay":"publishOrderOfPlay"}];Wt({methods:r,callback:t})}function pmt(t){const{eventId:e,drawId:i,structureId:n,renderDraw:r,roundsView:a="roundsColumns"}=t;if(iZ(wh),d2(),E2(),e||i){const s=document.getElementById(MC),o=jl(s,"section")?.querySelector(".tabHeader");i&&r?imt({eventId:e,drawId:i,headerElement:o}).success?(a===KT?G1e({eventId:e,drawId:i,structureId:n}):a===YT?j1e({eventId:e,drawId:i,structureId:n}):T1({eventId:e,drawId:i,structureId:n,redraw:!0,roundsView:a}),LA({renderDraw:r})):(cne({eventId:e,drawId:i}),LA({eventId:e})):(cne({eventId:e,drawId:i,headerElement:o}),LA({eventId:e}))}else cmt(),LA({eventId:e})}function hmt({callback:t}={}){let e,i=!1;const r=nt.getTournament().tournamentRecord?.onlineResources?.find(({name:p,resourceType:h})=>p==="tournamentImage"&&h==="URL")?.identifier,a=()=>{const p=document.getElementById("tournamentImagePreview");p&&(p.style.display=Rt),s(!0)},s=p=>{const h=document.getElementById("createButton"),f=p?!1:!i&&e.tournamentImage.value;h.disabled=f},o=()=>{s(!1),i=!1;const p=document.getElementById("tournamentImagePreview");p&&(p.onload=()=>{i=!0,s()},p.src=e.tournamentImage.value,p.style.display="")},l=p=>e=mr(p,[{onKeyUp:h=>h.key==="Enter"&&o(),onChange:()=>e.tournamentImage.value?o():a(),label:"Web address of online image",value:r,placeholder:"Image URL",field:"tournamentImage",autocomplete:"off"}]),u=document.createElement("div");l(u);const c=document.createElement("img");c.id="tournamentImagePreview",c.onload=()=>i=!0,r&&(c.src=r),c.style.width="100%",u.appendChild(c),Yn({title:"Tournament image",content:u,buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{const p=e.tournamentImage.value;Wt({methods:[{method:_Je,params:{onlineResource:{resourceSubType:"IMAGE",name:"tournamentImage",resourceType:"URL",identifier:p}}}],callback:m=>{m.success&&(Ht({message:"Tournament image updated",intent:"is-success"}),Mt(t)&&t(p))}})},intent:"is-primary",id:"createButton",disabled:!0,label:"Save",close:!0}]})}var J1e=typeof global=="object"&&global&&global.Object===Object&&global,fmt=typeof self=="object"&&self&&self.Object===Object&&self,ag=J1e||fmt||Function("return this")(),bb=ag.Symbol,Q1e=Object.prototype,mmt=Q1e.hasOwnProperty,gmt=Q1e.toString,$E=bb?bb.toStringTag:void 0;function vmt(t){var e=mmt.call(t,$E),i=t[$E];try{t[$E]=void 0;var n=!0}catch{}var r=gmt.call(t);return n&&(e?t[$E]=i:delete t[$E]),r}var ymt=Object.prototype,bmt=ymt.toString;function Imt(t){return bmt.call(t)}var wmt="[object Null]",Smt="[object Undefined]",Ene=bb?bb.toStringTag:void 0;function cE(t){return t==null?t===void 0?Smt:wmt:Ene&&Ene in Object(t)?vmt(t):Imt(t)}function mv(t){return t!=null&&typeof t=="object"}var xw=Array.isArray;function Qb(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function eRe(t){return t}var Tmt="[object AsyncFunction]",Umt="[object Function]",Dmt="[object GeneratorFunction]",Emt="[object Proxy]";function lZ(t){if(!Qb(t))return!1;var e=cE(t);return e==Umt||e==Dmt||e==Tmt||e==Emt}var Rj=ag["__core-js_shared__"],Pne=(function(){var t=/[^.]+$/.exec(Rj&&Rj.keys&&Rj.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function Pmt(t){return!!Pne&&Pne in t}var Cmt=Function.prototype,Rmt=Cmt.toString;function iS(t){if(t!=null){try{return Rmt.call(t)}catch{}try{return t+""}catch{}}return""}var Mmt=/[\\^$.*+?()[\]{}|]/g,Nmt=/^\[object .+?Constructor\]$/,Amt=Function.prototype,_mt=Object.prototype,kmt=Amt.toString,xmt=_mt.hasOwnProperty,Omt=RegExp("^"+kmt.call(xmt).replace(Mmt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Lmt(t){if(!Qb(t)||Pmt(t))return!1;var e=lZ(t)?Omt:Nmt;return e.test(iS(t))}function Fmt(t,e){return t?.[e]}function nS(t,e){var i=Fmt(t,e);return Lmt(i)?i:void 0}var Gz=nS(ag,"WeakMap"),Cne=Object.create,$mt=(function(){function t(){}return function(e){if(!Qb(e))return{};if(Cne)return Cne(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}})();function Bmt(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function Vmt(t,e){var i=-1,n=t.length;for(e||(e=Array(n));++i<n;)e[i]=t[i];return e}var jmt=800,Gmt=16,Hmt=Date.now;function zmt(t){var e=0,i=0;return function(){var n=Hmt(),r=Gmt-(n-i);if(i=n,r>0){if(++e>=jmt)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function qmt(t){return function(){return t}}var lO=(function(){try{var t=nS(Object,"defineProperty");return t({},"",{}),t}catch{}})(),Wmt=lO?function(t,e){return lO(t,"toString",{configurable:!0,enumerable:!1,value:qmt(e),writable:!0})}:eRe,Ymt=zmt(Wmt);function Kmt(t,e){for(var i=-1,n=t==null?0:t.length;++i<n&&e(t[i],i,t)!==!1;);return t}var Zmt=9007199254740991,Xmt=/^(?:0|[1-9]\d*)$/;function tRe(t,e){var i=typeof t;return e=e??Zmt,!!e&&(i=="number"||i!="symbol"&&Xmt.test(t))&&t>-1&&t%1==0&&t<e}function uZ(t,e,i){e=="__proto__"&&lO?lO(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function LN(t,e){return t===e||t!==t&&e!==e}var Jmt=Object.prototype,Qmt=Jmt.hasOwnProperty;function iRe(t,e,i){var n=t[e];(!(Qmt.call(t,e)&&LN(n,i))||i===void 0&&!(e in t))&&uZ(t,e,i)}function egt(t,e,i,n){var r=!i;i||(i={});for(var a=-1,s=e.length;++a<s;){var o=e[a],l=void 0;l===void 0&&(l=t[o]),r?uZ(i,o,l):iRe(i,o,l)}return i}var Rne=Math.max;function tgt(t,e,i){return e=Rne(e===void 0?t.length-1:e,0),function(){for(var n=arguments,r=-1,a=Rne(n.length-e,0),s=Array(a);++r<a;)s[r]=n[e+r];r=-1;for(var o=Array(e+1);++r<e;)o[r]=n[r];return o[e]=i(s),Bmt(t,this,o)}}function igt(t,e){return Ymt(tgt(t,e,eRe),t+"")}var ngt=9007199254740991;function nRe(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=ngt}function P2(t){return t!=null&&nRe(t.length)&&!lZ(t)}function rgt(t,e,i){if(!Qb(i))return!1;var n=typeof e;return(n=="number"?P2(i)&&tRe(e,i.length):n=="string"&&e in i)?LN(i[e],t):!1}function agt(t){return igt(function(e,i){var n=-1,r=i.length,a=r>1?i[r-1]:void 0,s=r>2?i[2]:void 0;for(a=t.length>3&&typeof a=="function"?(r--,a):void 0,s&&rgt(i[0],i[1],s)&&(a=r<3?void 0:a,r=1),e=Object(e);++n<r;){var o=i[n];o&&t(e,o,n,a)}return e})}var sgt=Object.prototype;function cZ(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||sgt;return t===i}function ogt(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}var lgt="[object Arguments]";function Mne(t){return mv(t)&&cE(t)==lgt}var rRe=Object.prototype,ugt=rRe.hasOwnProperty,cgt=rRe.propertyIsEnumerable,Hz=Mne((function(){return arguments})())?Mne:function(t){return mv(t)&&ugt.call(t,"callee")&&!cgt.call(t,"callee")};function dgt(){return!1}var aRe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Nne=aRe&&typeof module=="object"&&module&&!module.nodeType&&module,pgt=Nne&&Nne.exports===aRe,Ane=pgt?ag.Buffer:void 0,hgt=Ane?Ane.isBuffer:void 0,U1=hgt||dgt,fgt="[object Arguments]",mgt="[object Array]",ggt="[object Boolean]",vgt="[object Date]",ygt="[object Error]",bgt="[object Function]",Igt="[object Map]",wgt="[object Number]",Sgt="[object Object]",Tgt="[object RegExp]",Ugt="[object Set]",Dgt="[object String]",Egt="[object WeakMap]",Pgt="[object ArrayBuffer]",Cgt="[object DataView]",Rgt="[object Float32Array]",Mgt="[object Float64Array]",Ngt="[object Int8Array]",Agt="[object Int16Array]",_gt="[object Int32Array]",kgt="[object Uint8Array]",xgt="[object Uint8ClampedArray]",Ogt="[object Uint16Array]",Lgt="[object Uint32Array]",Ba={};Ba[Rgt]=Ba[Mgt]=Ba[Ngt]=Ba[Agt]=Ba[_gt]=Ba[kgt]=Ba[xgt]=Ba[Ogt]=Ba[Lgt]=!0;Ba[fgt]=Ba[mgt]=Ba[Pgt]=Ba[ggt]=Ba[Cgt]=Ba[vgt]=Ba[ygt]=Ba[bgt]=Ba[Igt]=Ba[wgt]=Ba[Sgt]=Ba[Tgt]=Ba[Ugt]=Ba[Dgt]=Ba[Egt]=!1;function Fgt(t){return mv(t)&&nRe(t.length)&&!!Ba[cE(t)]}function dZ(t){return function(e){return t(e)}}var sRe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,jP=sRe&&typeof module=="object"&&module&&!module.nodeType&&module,$gt=jP&&jP.exports===sRe,Mj=$gt&&J1e.process,_U=(function(){try{var t=jP&&jP.require&&jP.require("util").types;return t||Mj&&Mj.binding&&Mj.binding("util")}catch{}})(),_ne=_U&&_U.isTypedArray,pZ=_ne?dZ(_ne):Fgt,Bgt=Object.prototype,Vgt=Bgt.hasOwnProperty;function oRe(t,e){var i=xw(t),n=!i&&Hz(t),r=!i&&!n&&U1(t),a=!i&&!n&&!r&&pZ(t),s=i||n||r||a,o=s?ogt(t.length,String):[],l=o.length;for(var u in t)(e||Vgt.call(t,u))&&!(s&&(u=="length"||r&&(u=="offset"||u=="parent")||a&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||tRe(u,l)))&&o.push(u);return o}function lRe(t,e){return function(i){return t(e(i))}}var jgt=lRe(Object.keys,Object),Ggt=Object.prototype,Hgt=Ggt.hasOwnProperty;function zgt(t){if(!cZ(t))return jgt(t);var e=[];for(var i in Object(t))Hgt.call(t,i)&&i!="constructor"&&e.push(i);return e}function qgt(t){return P2(t)?oRe(t):zgt(t)}function Wgt(t){var e=[];if(t!=null)for(var i in Object(t))e.push(i);return e}var Ygt=Object.prototype,Kgt=Ygt.hasOwnProperty;function Zgt(t){if(!Qb(t))return Wgt(t);var e=cZ(t),i=[];for(var n in t)n=="constructor"&&(e||!Kgt.call(t,n))||i.push(n);return i}function uRe(t){return P2(t)?oRe(t,!0):Zgt(t)}var D1=nS(Object,"create");function Xgt(){this.__data__=D1?D1(null):{},this.size=0}function Jgt(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Qgt="__lodash_hash_undefined__",evt=Object.prototype,tvt=evt.hasOwnProperty;function ivt(t){var e=this.__data__;if(D1){var i=e[t];return i===Qgt?void 0:i}return tvt.call(e,t)?e[t]:void 0}var nvt=Object.prototype,rvt=nvt.hasOwnProperty;function avt(t){var e=this.__data__;return D1?e[t]!==void 0:rvt.call(e,t)}var svt="__lodash_hash_undefined__";function ovt(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=D1&&e===void 0?svt:e,this}function Ow(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}Ow.prototype.clear=Xgt;Ow.prototype.delete=Jgt;Ow.prototype.get=ivt;Ow.prototype.has=avt;Ow.prototype.set=ovt;function lvt(){this.__data__=[],this.size=0}function C2(t,e){for(var i=t.length;i--;)if(LN(t[i][0],e))return i;return-1}var uvt=Array.prototype,cvt=uvt.splice;function dvt(t){var e=this.__data__,i=C2(e,t);if(i<0)return!1;var n=e.length-1;return i==n?e.pop():cvt.call(e,i,1),--this.size,!0}function pvt(t){var e=this.__data__,i=C2(e,t);return i<0?void 0:e[i][1]}function hvt(t){return C2(this.__data__,t)>-1}function fvt(t,e){var i=this.__data__,n=C2(i,t);return n<0?(++this.size,i.push([t,e])):i[n][1]=e,this}function Gv(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}Gv.prototype.clear=lvt;Gv.prototype.delete=dvt;Gv.prototype.get=pvt;Gv.prototype.has=hvt;Gv.prototype.set=fvt;var E1=nS(ag,"Map");function mvt(){this.size=0,this.__data__={hash:new Ow,map:new(E1||Gv),string:new Ow}}function gvt(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function R2(t,e){var i=t.__data__;return gvt(e)?i[typeof e=="string"?"string":"hash"]:i.map}function vvt(t){var e=R2(this,t).delete(t);return this.size-=e?1:0,e}function yvt(t){return R2(this,t).get(t)}function bvt(t){return R2(this,t).has(t)}function Ivt(t,e){var i=R2(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this}function rS(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}rS.prototype.clear=mvt;rS.prototype.delete=vvt;rS.prototype.get=yvt;rS.prototype.has=bvt;rS.prototype.set=Ivt;function wvt(t,e){for(var i=-1,n=e.length,r=t.length;++i<n;)t[r+i]=e[i];return t}var cRe=lRe(Object.getPrototypeOf,Object),Svt="[object Object]",Tvt=Function.prototype,Uvt=Object.prototype,dRe=Tvt.toString,Dvt=Uvt.hasOwnProperty,Evt=dRe.call(Object);function Pvt(t){if(!mv(t)||cE(t)!=Svt)return!1;var e=cRe(t);if(e===null)return!0;var i=Dvt.call(e,"constructor")&&e.constructor;return typeof i=="function"&&i instanceof i&&dRe.call(i)==Evt}function Cvt(){this.__data__=new Gv,this.size=0}function Rvt(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}function Mvt(t){return this.__data__.get(t)}function Nvt(t){return this.__data__.has(t)}var Avt=200;function _vt(t,e){var i=this.__data__;if(i instanceof Gv){var n=i.__data__;if(!E1||n.length<Avt-1)return n.push([t,e]),this.size=++i.size,this;i=this.__data__=new rS(n)}return i.set(t,e),this.size=i.size,this}function um(t){var e=this.__data__=new Gv(t);this.size=e.size}um.prototype.clear=Cvt;um.prototype.delete=Rvt;um.prototype.get=Mvt;um.prototype.has=Nvt;um.prototype.set=_vt;var pRe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,kne=pRe&&typeof module=="object"&&module&&!module.nodeType&&module,kvt=kne&&kne.exports===pRe,xne=kvt?ag.Buffer:void 0,One=xne?xne.allocUnsafe:void 0;function hRe(t,e){if(e)return t.slice();var i=t.length,n=One?One(i):new t.constructor(i);return t.copy(n),n}function xvt(t,e){for(var i=-1,n=t==null?0:t.length,r=0,a=[];++i<n;){var s=t[i];e(s,i,t)&&(a[r++]=s)}return a}function Ovt(){return[]}var Lvt=Object.prototype,Fvt=Lvt.propertyIsEnumerable,Lne=Object.getOwnPropertySymbols,$vt=Lne?function(t){return t==null?[]:(t=Object(t),xvt(Lne(t),function(e){return Fvt.call(t,e)}))}:Ovt;function Bvt(t,e,i){var n=e(t);return xw(t)?n:wvt(n,i(t))}function zz(t){return Bvt(t,qgt,$vt)}var qz=nS(ag,"DataView"),Wz=nS(ag,"Promise"),Yz=nS(ag,"Set"),Fne="[object Map]",Vvt="[object Object]",$ne="[object Promise]",Bne="[object Set]",Vne="[object WeakMap]",jne="[object DataView]",jvt=iS(qz),Gvt=iS(E1),Hvt=iS(Wz),zvt=iS(Yz),qvt=iS(Gz),Sh=cE;(qz&&Sh(new qz(new ArrayBuffer(1)))!=jne||E1&&Sh(new E1)!=Fne||Wz&&Sh(Wz.resolve())!=$ne||Yz&&Sh(new Yz)!=Bne||Gz&&Sh(new Gz)!=Vne)&&(Sh=function(t){var e=cE(t),i=e==Vvt?t.constructor:void 0,n=i?iS(i):"";if(n)switch(n){case jvt:return jne;case Gvt:return Fne;case Hvt:return $ne;case zvt:return Bne;case qvt:return Vne}return e});var Wvt=Object.prototype,Yvt=Wvt.hasOwnProperty;function Kvt(t){var e=t.length,i=new t.constructor(e);return e&&typeof t[0]=="string"&&Yvt.call(t,"index")&&(i.index=t.index,i.input=t.input),i}var uO=ag.Uint8Array;function hZ(t){var e=new t.constructor(t.byteLength);return new uO(e).set(new uO(t)),e}function Zvt(t,e){var i=hZ(t.buffer);return new t.constructor(i,t.byteOffset,t.byteLength)}var Xvt=/\w*$/;function Jvt(t){var e=new t.constructor(t.source,Xvt.exec(t));return e.lastIndex=t.lastIndex,e}var Gne=bb?bb.prototype:void 0,Hne=Gne?Gne.valueOf:void 0;function Qvt(t){return Hne?Object(Hne.call(t)):{}}function fRe(t,e){var i=e?hZ(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}var eyt="[object Boolean]",tyt="[object Date]",iyt="[object Map]",nyt="[object Number]",ryt="[object RegExp]",ayt="[object Set]",syt="[object String]",oyt="[object Symbol]",lyt="[object ArrayBuffer]",uyt="[object DataView]",cyt="[object Float32Array]",dyt="[object Float64Array]",pyt="[object Int8Array]",hyt="[object Int16Array]",fyt="[object Int32Array]",myt="[object Uint8Array]",gyt="[object Uint8ClampedArray]",vyt="[object Uint16Array]",yyt="[object Uint32Array]";function byt(t,e,i){var n=t.constructor;switch(e){case lyt:return hZ(t);case eyt:case tyt:return new n(+t);case uyt:return Zvt(t);case cyt:case dyt:case pyt:case hyt:case fyt:case myt:case gyt:case vyt:case yyt:return fRe(t,i);case iyt:return new n;case nyt:case syt:return new n(t);case ryt:return Jvt(t);case ayt:return new n;case oyt:return Qvt(t)}}function mRe(t){return typeof t.constructor=="function"&&!cZ(t)?$mt(cRe(t)):{}}var Iyt="[object Map]";function wyt(t){return mv(t)&&Sh(t)==Iyt}var zne=_U&&_U.isMap,Syt=zne?dZ(zne):wyt,Tyt="[object Set]";function Uyt(t){return mv(t)&&Sh(t)==Tyt}var qne=_U&&_U.isSet,Dyt=qne?dZ(qne):Uyt,Eyt=1,gRe="[object Arguments]",Pyt="[object Array]",Cyt="[object Boolean]",Ryt="[object Date]",Myt="[object Error]",vRe="[object Function]",Nyt="[object GeneratorFunction]",Ayt="[object Map]",_yt="[object Number]",yRe="[object Object]",kyt="[object RegExp]",xyt="[object Set]",Oyt="[object String]",Lyt="[object Symbol]",Fyt="[object WeakMap]",$yt="[object ArrayBuffer]",Byt="[object DataView]",Vyt="[object Float32Array]",jyt="[object Float64Array]",Gyt="[object Int8Array]",Hyt="[object Int16Array]",zyt="[object Int32Array]",qyt="[object Uint8Array]",Wyt="[object Uint8ClampedArray]",Yyt="[object Uint16Array]",Kyt="[object Uint32Array]",Ea={};Ea[gRe]=Ea[Pyt]=Ea[$yt]=Ea[Byt]=Ea[Cyt]=Ea[Ryt]=Ea[Vyt]=Ea[jyt]=Ea[Gyt]=Ea[Hyt]=Ea[zyt]=Ea[Ayt]=Ea[_yt]=Ea[yRe]=Ea[kyt]=Ea[xyt]=Ea[Oyt]=Ea[Lyt]=Ea[qyt]=Ea[Wyt]=Ea[Yyt]=Ea[Kyt]=!0;Ea[Myt]=Ea[vRe]=Ea[Fyt]=!1;function J_(t,e,i,n,r,a){var s,o=e&Eyt;if(s!==void 0)return s;if(!Qb(t))return t;var l=xw(t);if(l)s=Kvt(t);else{var u=Sh(t),c=u==vRe||u==Nyt;if(U1(t))return hRe(t,o);if(u==yRe||u==gRe||c&&!r)s=c?{}:mRe(t);else{if(!Ea[u])return r?t:{};s=byt(t,u,o)}}a||(a=new um);var d=a.get(t);if(d)return d;a.set(t,s),Dyt(t)?t.forEach(function(f){s.add(J_(f,e,i,f,t,a))}):Syt(t)&&t.forEach(function(f,m){s.set(m,J_(f,e,i,m,t,a))});var p=zz,h=l?void 0:p(t);return Kmt(h||t,function(f,m){h&&(m=f,f=t[m]),iRe(s,m,J_(f,e,i,m,t,a))}),s}var Zyt=1,Xyt=4;function wT(t){return J_(t,Zyt|Xyt)}var Jyt="__lodash_hash_undefined__";function Qyt(t){return this.__data__.set(t,Jyt),this}function ebt(t){return this.__data__.has(t)}function cO(t){var e=-1,i=t==null?0:t.length;for(this.__data__=new rS;++e<i;)this.add(t[e])}cO.prototype.add=cO.prototype.push=Qyt;cO.prototype.has=ebt;function tbt(t,e){for(var i=-1,n=t==null?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}function ibt(t,e){return t.has(e)}var nbt=1,rbt=2;function bRe(t,e,i,n,r,a){var s=i&nbt,o=t.length,l=e.length;if(o!=l&&!(s&&l>o))return!1;var u=a.get(t),c=a.get(e);if(u&&c)return u==e&&c==t;var d=-1,p=!0,h=i&rbt?new cO:void 0;for(a.set(t,e),a.set(e,t);++d<o;){var f=t[d],m=e[d];if(n)var g=s?n(m,f,d,e,t,a):n(f,m,d,t,e,a);if(g!==void 0){if(g)continue;p=!1;break}if(h){if(!tbt(e,function(v,y){if(!ibt(h,y)&&(f===v||r(f,v,i,n,a)))return h.push(y)})){p=!1;break}}else if(!(f===m||r(f,m,i,n,a))){p=!1;break}}return a.delete(t),a.delete(e),p}function abt(t){var e=-1,i=Array(t.size);return t.forEach(function(n,r){i[++e]=[r,n]}),i}function sbt(t){var e=-1,i=Array(t.size);return t.forEach(function(n){i[++e]=n}),i}var obt=1,lbt=2,ubt="[object Boolean]",cbt="[object Date]",dbt="[object Error]",pbt="[object Map]",hbt="[object Number]",fbt="[object RegExp]",mbt="[object Set]",gbt="[object String]",vbt="[object Symbol]",ybt="[object ArrayBuffer]",bbt="[object DataView]",Wne=bb?bb.prototype:void 0,Nj=Wne?Wne.valueOf:void 0;function Ibt(t,e,i,n,r,a,s){switch(i){case bbt:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case ybt:return!(t.byteLength!=e.byteLength||!a(new uO(t),new uO(e)));case ubt:case cbt:case hbt:return LN(+t,+e);case dbt:return t.name==e.name&&t.message==e.message;case fbt:case gbt:return t==e+"";case pbt:var o=abt;case mbt:var l=n&obt;if(o||(o=sbt),t.size!=e.size&&!l)return!1;var u=s.get(t);if(u)return u==e;n|=lbt,s.set(t,e);var c=bRe(o(t),o(e),n,r,a,s);return s.delete(t),c;case vbt:if(Nj)return Nj.call(t)==Nj.call(e)}return!1}var wbt=1,Sbt=Object.prototype,Tbt=Sbt.hasOwnProperty;function Ubt(t,e,i,n,r,a){var s=i&wbt,o=zz(t),l=o.length,u=zz(e),c=u.length;if(l!=c&&!s)return!1;for(var d=l;d--;){var p=o[d];if(!(s?p in e:Tbt.call(e,p)))return!1}var h=a.get(t),f=a.get(e);if(h&&f)return h==e&&f==t;var m=!0;a.set(t,e),a.set(e,t);for(var g=s;++d<l;){p=o[d];var v=t[p],y=e[p];if(n)var b=s?n(y,v,p,e,t,a):n(v,y,p,t,e,a);if(!(b===void 0?v===y||r(v,y,i,n,a):b)){m=!1;break}g||(g=p=="constructor")}if(m&&!g){var I=t.constructor,S=e.constructor;I!=S&&"constructor"in t&&"constructor"in e&&!(typeof I=="function"&&I instanceof I&&typeof S=="function"&&S instanceof S)&&(m=!1)}return a.delete(t),a.delete(e),m}var Dbt=1,Yne="[object Arguments]",Kne="[object Array]",FA="[object Object]",Ebt=Object.prototype,Zne=Ebt.hasOwnProperty;function Pbt(t,e,i,n,r,a){var s=xw(t),o=xw(e),l=s?Kne:Sh(t),u=o?Kne:Sh(e);l=l==Yne?FA:l,u=u==Yne?FA:u;var c=l==FA,d=u==FA,p=l==u;if(p&&U1(t)){if(!U1(e))return!1;s=!0,c=!1}if(p&&!c)return a||(a=new um),s||pZ(t)?bRe(t,e,i,n,r,a):Ibt(t,e,l,i,n,r,a);if(!(i&Dbt)){var h=c&&Zne.call(t,"__wrapped__"),f=d&&Zne.call(e,"__wrapped__");if(h||f){var m=h?t.value():t,g=f?e.value():e;return a||(a=new um),r(m,g,i,n,a)}}return p?(a||(a=new um),Ubt(t,e,i,n,r,a)):!1}function IRe(t,e,i,n,r){return t===e?!0:t==null||e==null||!mv(t)&&!mv(e)?t!==t&&e!==e:Pbt(t,e,i,n,IRe,r)}function Cbt(t){return function(e,i,n){for(var r=-1,a=Object(e),s=n(e),o=s.length;o--;){var l=s[++r];if(i(a[l],l,a)===!1)break}return e}}var Rbt=Cbt();function Kz(t,e,i){(i!==void 0&&!LN(t[e],i)||i===void 0&&!(e in t))&&uZ(t,e,i)}function Mbt(t){return mv(t)&&P2(t)}function Zz(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}function Nbt(t){return egt(t,uRe(t))}function Abt(t,e,i,n,r,a,s){var o=Zz(t,i),l=Zz(e,i),u=s.get(l);if(u){Kz(t,i,u);return}var c=a?a(o,l,i+"",t,e,s):void 0,d=c===void 0;if(d){var p=xw(l),h=!p&&U1(l),f=!p&&!h&&pZ(l);c=l,p||h||f?xw(o)?c=o:Mbt(o)?c=Vmt(o):h?(d=!1,c=hRe(l,!0)):f?(d=!1,c=fRe(l,!0)):c=[]:Pvt(l)||Hz(l)?(c=o,Hz(o)?c=Nbt(o):(!Qb(o)||lZ(o))&&(c=mRe(l))):d=!1}d&&(s.set(l,c),r(c,l,n,a,s),s.delete(l)),Kz(t,i,c)}function wRe(t,e,i,n,r){t!==e&&Rbt(e,function(a,s){if(r||(r=new um),Qb(a))Abt(t,e,s,i,wRe,n,r);else{var o=n?n(Zz(t,s),a,s+"",t,e,r):void 0;o===void 0&&(o=a),Kz(t,s,o)}},uRe)}function fZ(t,e){return IRe(t,e)}var _y=agt(function(t,e,i){wRe(t,e,i)}),Ei=(t=>(t[t.TYPE=3]="TYPE",t[t.LEVEL=12]="LEVEL",t[t.ATTRIBUTE=13]="ATTRIBUTE",t[t.BLOT=14]="BLOT",t[t.INLINE=7]="INLINE",t[t.BLOCK=11]="BLOCK",t[t.BLOCK_BLOT=10]="BLOCK_BLOT",t[t.INLINE_BLOT=6]="INLINE_BLOT",t[t.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",t[t.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",t[t.ANY=15]="ANY",t))(Ei||{});class Om{constructor(e,i,n={}){this.attrName=e,this.keyName=i;const r=Ei.TYPE&Ei.ATTRIBUTE;this.scope=n.scope!=null?n.scope&Ei.LEVEL|r:Ei.ATTRIBUTE,n.whitelist!=null&&(this.whitelist=n.whitelist)}static keys(e){return Array.from(e.attributes).map(i=>i.name)}add(e,i){return this.canAdd(e,i)?(e.setAttribute(this.keyName,i),!0):!1}canAdd(e,i){return this.whitelist==null?!0:typeof i=="string"?this.whitelist.indexOf(i.replace(/["']/g,""))>-1:this.whitelist.indexOf(i)>-1}remove(e){e.removeAttribute(this.keyName)}value(e){const i=e.getAttribute(this.keyName);return this.canAdd(e,i)&&i?i:""}}class ST extends Error{constructor(e){e="[Parchment] "+e,super(e),this.message=e,this.name=this.constructor.name}}const SRe=class Xz{constructor(){this.attributes={},this.classes={},this.tags={},this.types={}}static find(e,i=!1){if(e==null)return null;if(this.blots.has(e))return this.blots.get(e)||null;if(i){let n=null;try{n=e.parentNode}catch{return null}return this.find(n,i)}return null}create(e,i,n){const r=this.query(i);if(r==null)throw new ST(`Unable to create ${i} blot`);const a=r,s=i instanceof Node||i.nodeType===Node.TEXT_NODE?i:a.create(n),o=new a(e,s,n);return Xz.blots.set(o.domNode,o),o}find(e,i=!1){return Xz.find(e,i)}query(e,i=Ei.ANY){let n;return typeof e=="string"?n=this.types[e]||this.attributes[e]:e instanceof Text||e.nodeType===Node.TEXT_NODE?n=this.types.text:typeof e=="number"?e&Ei.LEVEL&Ei.BLOCK?n=this.types.block:e&Ei.LEVEL&Ei.INLINE&&(n=this.types.inline):e instanceof Element&&((e.getAttribute("class")||"").split(/\s+/).some(r=>(n=this.classes[r],!!n)),n=n||this.tags[e.tagName]),n==null?null:"scope"in n&&i&Ei.LEVEL&n.scope&&i&Ei.TYPE&n.scope?n:null}register(...e){return e.map(i=>{const n="blotName"in i,r="attrName"in i;if(!n&&!r)throw new ST("Invalid definition");if(n&&i.blotName==="abstract")throw new ST("Cannot register abstract class");const a=n?i.blotName:r?i.attrName:void 0;return this.types[a]=i,r?typeof i.keyName=="string"&&(this.attributes[i.keyName]=i):n&&(i.className&&(this.classes[i.className]=i),i.tagName&&(Array.isArray(i.tagName)?i.tagName=i.tagName.map(s=>s.toUpperCase()):i.tagName=i.tagName.toUpperCase(),(Array.isArray(i.tagName)?i.tagName:[i.tagName]).forEach(s=>{(this.tags[s]==null||i.className==null)&&(this.tags[s]=i)}))),i})}};SRe.blots=new WeakMap;let kU=SRe;function Xne(t,e){return(t.getAttribute("class")||"").split(/\s+/).filter(i=>i.indexOf(`${e}-`)===0)}class _bt extends Om{static keys(e){return(e.getAttribute("class")||"").split(/\s+/).map(i=>i.split("-").slice(0,-1).join("-"))}add(e,i){return this.canAdd(e,i)?(this.remove(e),e.classList.add(`${this.keyName}-${i}`),!0):!1}remove(e){Xne(e,this.keyName).forEach(i=>{e.classList.remove(i)}),e.classList.length===0&&e.removeAttribute("class")}value(e){const i=(Xne(e,this.keyName)[0]||"").slice(this.keyName.length+1);return this.canAdd(e,i)?i:""}}const Tf=_bt;function Aj(t){const e=t.split("-"),i=e.slice(1).map(n=>n[0].toUpperCase()+n.slice(1)).join("");return e[0]+i}class kbt extends Om{static keys(e){return(e.getAttribute("style")||"").split(";").map(i=>i.split(":")[0].trim())}add(e,i){return this.canAdd(e,i)?(e.style[Aj(this.keyName)]=i,!0):!1}remove(e){e.style[Aj(this.keyName)]="",e.getAttribute("style")||e.removeAttribute("style")}value(e){const i=e.style[Aj(this.keyName)];return this.canAdd(e,i)?i:""}}const eI=kbt;class xbt{constructor(e){this.attributes={},this.domNode=e,this.build()}attribute(e,i){i?e.add(this.domNode,i)&&(e.value(this.domNode)!=null?this.attributes[e.attrName]=e:delete this.attributes[e.attrName]):(e.remove(this.domNode),delete this.attributes[e.attrName])}build(){this.attributes={};const e=kU.find(this.domNode);if(e==null)return;const i=Om.keys(this.domNode),n=Tf.keys(this.domNode),r=eI.keys(this.domNode);i.concat(n).concat(r).forEach(a=>{const s=e.scroll.query(a,Ei.ATTRIBUTE);s instanceof Om&&(this.attributes[s.attrName]=s)})}copy(e){Object.keys(this.attributes).forEach(i=>{const n=this.attributes[i].value(this.domNode);e.format(i,n)})}move(e){this.copy(e),Object.keys(this.attributes).forEach(i=>{this.attributes[i].remove(this.domNode)}),this.attributes={}}values(){return Object.keys(this.attributes).reduce((e,i)=>(e[i]=this.attributes[i].value(this.domNode),e),{})}}const M2=xbt,TRe=class{constructor(e,i){this.scroll=e,this.domNode=i,kU.blots.set(i,this),this.prev=null,this.next=null}static create(e){if(this.tagName==null)throw new ST("Blot definition missing tagName");let i,n;return Array.isArray(this.tagName)?(typeof e=="string"?(n=e.toUpperCase(),parseInt(n,10).toString()===n&&(n=parseInt(n,10))):typeof e=="number"&&(n=e),typeof n=="number"?i=document.createElement(this.tagName[n-1]):n&&this.tagName.indexOf(n)>-1?i=document.createElement(n):i=document.createElement(this.tagName[0])):i=document.createElement(this.tagName),this.className&&i.classList.add(this.className),i}get statics(){return this.constructor}attach(){}clone(){const e=this.domNode.cloneNode(!1);return this.scroll.create(e)}detach(){this.parent!=null&&this.parent.removeChild(this),kU.blots.delete(this.domNode)}deleteAt(e,i){this.isolate(e,i).remove()}formatAt(e,i,n,r){const a=this.isolate(e,i);if(this.scroll.query(n,Ei.BLOT)!=null&&r)a.wrap(n,r);else if(this.scroll.query(n,Ei.ATTRIBUTE)!=null){const s=this.scroll.create(this.statics.scope);a.wrap(s),s.format(n,r)}}insertAt(e,i,n){const r=n==null?this.scroll.create("text",i):this.scroll.create(i,n),a=this.split(e);this.parent.insertBefore(r,a||void 0)}isolate(e,i){const n=this.split(e);if(n==null)throw new Error("Attempt to isolate at end");return n.split(i),n}length(){return 1}offset(e=this.parent){return this.parent==null||this===e?0:this.parent.children.offset(this)+this.parent.offset(e)}optimize(e){this.statics.requiredContainer&&!(this.parent instanceof this.statics.requiredContainer)&&this.wrap(this.statics.requiredContainer.blotName)}remove(){this.domNode.parentNode!=null&&this.domNode.parentNode.removeChild(this.domNode),this.detach()}replaceWith(e,i){const n=typeof e=="string"?this.scroll.create(e,i):e;return this.parent!=null&&(this.parent.insertBefore(n,this.next||void 0),this.remove()),n}split(e,i){return e===0?this:this.next}update(e,i){}wrap(e,i){const n=typeof e=="string"?this.scroll.create(e,i):e;if(this.parent!=null&&this.parent.insertBefore(n,this.next||void 0),typeof n.appendChild!="function")throw new ST(`Cannot wrap ${e}`);return n.appendChild(this),n}};TRe.blotName="abstract";let URe=TRe;const DRe=class extends URe{static value(e){return!0}index(e,i){return this.domNode===e||this.domNode.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(i,1):-1}position(e,i){let n=Array.from(this.parent.domNode.childNodes).indexOf(this.domNode);return e>0&&(n+=1),[this.parent.domNode,n]}value(){return{[this.statics.blotName]:this.statics.value(this.domNode)||!0}}};DRe.scope=Ei.INLINE_BLOT;let Obt=DRe;const nu=Obt;class Lbt{constructor(){this.head=null,this.tail=null,this.length=0}append(...e){if(this.insertBefore(e[0],null),e.length>1){const i=e.slice(1);this.append(...i)}}at(e){const i=this.iterator();let n=i();for(;n&&e>0;)e-=1,n=i();return n}contains(e){const i=this.iterator();let n=i();for(;n;){if(n===e)return!0;n=i()}return!1}indexOf(e){const i=this.iterator();let n=i(),r=0;for(;n;){if(n===e)return r;r+=1,n=i()}return-1}insertBefore(e,i){e!=null&&(this.remove(e),e.next=i,i!=null?(e.prev=i.prev,i.prev!=null&&(i.prev.next=e),i.prev=e,i===this.head&&(this.head=e)):this.tail!=null?(this.tail.next=e,e.prev=this.tail,this.tail=e):(e.prev=null,this.head=this.tail=e),this.length+=1)}offset(e){let i=0,n=this.head;for(;n!=null;){if(n===e)return i;i+=n.length(),n=n.next}return-1}remove(e){this.contains(e)&&(e.prev!=null&&(e.prev.next=e.next),e.next!=null&&(e.next.prev=e.prev),e===this.head&&(this.head=e.next),e===this.tail&&(this.tail=e.prev),this.length-=1)}iterator(e=this.head){return()=>{const i=e;return e!=null&&(e=e.next),i}}find(e,i=!1){const n=this.iterator();let r=n();for(;r;){const a=r.length();if(e<a||i&&e===a&&(r.next==null||r.next.length()!==0))return[r,e];e-=a,r=n()}return[null,0]}forEach(e){const i=this.iterator();let n=i();for(;n;)e(n),n=i()}forEachAt(e,i,n){if(i<=0)return;const[r,a]=this.find(e);let s=e-a;const o=this.iterator(r);let l=o();for(;l&&s<e+i;){const u=l.length();e>s?n(l,e-s,Math.min(i,s+u-e)):n(l,0,Math.min(u,e+i-s)),s+=u,l=o()}}map(e){return this.reduce((i,n)=>(i.push(e(n)),i),[])}reduce(e,i){const n=this.iterator();let r=n();for(;r;)i=e(i,r),r=n();return i}}function Jne(t,e){const i=e.find(t);if(i)return i;try{return e.create(t)}catch{const n=e.create(Ei.INLINE);return Array.from(t.childNodes).forEach(r=>{n.domNode.appendChild(r)}),t.parentNode&&t.parentNode.replaceChild(n.domNode,t),n.attach(),n}}const ERe=class uy extends URe{constructor(e,i){super(e,i),this.uiNode=null,this.build()}appendChild(e){this.insertBefore(e)}attach(){super.attach(),this.children.forEach(e=>{e.attach()})}attachUI(e){this.uiNode!=null&&this.uiNode.remove(),this.uiNode=e,uy.uiClass&&this.uiNode.classList.add(uy.uiClass),this.uiNode.setAttribute("contenteditable","false"),this.domNode.insertBefore(this.uiNode,this.domNode.firstChild)}build(){this.children=new Lbt,Array.from(this.domNode.childNodes).filter(e=>e!==this.uiNode).reverse().forEach(e=>{try{const i=Jne(e,this.scroll);this.insertBefore(i,this.children.head||void 0)}catch(i){if(i instanceof ST)return;throw i}})}deleteAt(e,i){if(e===0&&i===this.length())return this.remove();this.children.forEachAt(e,i,(n,r,a)=>{n.deleteAt(r,a)})}descendant(e,i=0){const[n,r]=this.children.find(i);return e.blotName==null&&e(n)||e.blotName!=null&&n instanceof e?[n,r]:n instanceof uy?n.descendant(e,r):[null,-1]}descendants(e,i=0,n=Number.MAX_VALUE){let r=[],a=n;return this.children.forEachAt(i,n,(s,o,l)=>{(e.blotName==null&&e(s)||e.blotName!=null&&s instanceof e)&&r.push(s),s instanceof uy&&(r=r.concat(s.descendants(e,o,a))),a-=l}),r}detach(){this.children.forEach(e=>{e.detach()}),super.detach()}enforceAllowedChildren(){let e=!1;this.children.forEach(i=>{e||this.statics.allowedChildren.some(n=>i instanceof n)||(i.statics.scope===Ei.BLOCK_BLOT?(i.next!=null&&this.splitAfter(i),i.prev!=null&&this.splitAfter(i.prev),i.parent.unwrap(),e=!0):i instanceof uy?i.unwrap():i.remove())})}formatAt(e,i,n,r){this.children.forEachAt(e,i,(a,s,o)=>{a.formatAt(s,o,n,r)})}insertAt(e,i,n){const[r,a]=this.children.find(e);if(r)r.insertAt(a,i,n);else{const s=n==null?this.scroll.create("text",i):this.scroll.create(i,n);this.appendChild(s)}}insertBefore(e,i){e.parent!=null&&e.parent.children.remove(e);let n=null;this.children.insertBefore(e,i||null),e.parent=this,i!=null&&(n=i.domNode),(this.domNode.parentNode!==e.domNode||this.domNode.nextSibling!==n)&&this.domNode.insertBefore(e.domNode,n),e.attach()}length(){return this.children.reduce((e,i)=>e+i.length(),0)}moveChildren(e,i){this.children.forEach(n=>{e.insertBefore(n,i)})}optimize(e){if(super.optimize(e),this.enforceAllowedChildren(),this.uiNode!=null&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),this.children.length===0)if(this.statics.defaultChild!=null){const i=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(i)}else this.remove()}path(e,i=!1){const[n,r]=this.children.find(e,i),a=[[this,e]];return n instanceof uy?a.concat(n.path(r,i)):(n!=null&&a.push([n,r]),a)}removeChild(e){this.children.remove(e)}replaceWith(e,i){const n=typeof e=="string"?this.scroll.create(e,i):e;return n instanceof uy&&this.moveChildren(n),super.replaceWith(n)}split(e,i=!1){if(!i){if(e===0)return this;if(e===this.length())return this.next}const n=this.clone();return this.parent&&this.parent.insertBefore(n,this.next||void 0),this.children.forEachAt(e,this.length(),(r,a,s)=>{const o=r.split(a,i);o!=null&&n.appendChild(o)}),n}splitAfter(e){const i=this.clone();for(;e.next!=null;)i.appendChild(e.next);return this.parent&&this.parent.insertBefore(i,this.next||void 0),i}unwrap(){this.parent&&this.moveChildren(this.parent,this.next||void 0),this.remove()}update(e,i){const n=[],r=[];e.forEach(a=>{a.target===this.domNode&&a.type==="childList"&&(n.push(...a.addedNodes),r.push(...a.removedNodes))}),r.forEach(a=>{if(a.parentNode!=null&&a.tagName!=="IFRAME"&&document.body.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_CONTAINED_BY)return;const s=this.scroll.find(a);s!=null&&(s.domNode.parentNode==null||s.domNode.parentNode===this.domNode)&&s.detach()}),n.filter(a=>a.parentNode===this.domNode&&a!==this.uiNode).sort((a,s)=>a===s?0:a.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1).forEach(a=>{let s=null;a.nextSibling!=null&&(s=this.scroll.find(a.nextSibling));const o=Jne(a,this.scroll);(o.next!==s||o.next==null)&&(o.parent!=null&&o.parent.removeChild(this),this.insertBefore(o,s||void 0))}),this.enforceAllowedChildren()}};ERe.uiClass="";let Fbt=ERe;const Gh=Fbt;function $bt(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(t[i]!==e[i])return!1;return!0}const zS=class qS extends Gh{static create(e){return super.create(e)}static formats(e,i){const n=i.query(qS.blotName);if(!(n!=null&&e.tagName===n.tagName)){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return e.tagName.toLowerCase()}}constructor(e,i){super(e,i),this.attributes=new M2(this.domNode)}format(e,i){if(e===this.statics.blotName&&!i)this.children.forEach(n=>{n instanceof qS||(n=n.wrap(qS.blotName,!0)),this.attributes.copy(n)}),this.unwrap();else{const n=this.scroll.query(e,Ei.INLINE);if(n==null)return;n instanceof Om?this.attributes.attribute(n,i):i&&(e!==this.statics.blotName||this.formats()[e]!==i)&&this.replaceWith(e,i)}}formats(){const e=this.attributes.values(),i=this.statics.formats(this.domNode,this.scroll);return i!=null&&(e[this.statics.blotName]=i),e}formatAt(e,i,n,r){this.formats()[n]!=null||this.scroll.query(n,Ei.ATTRIBUTE)?this.isolate(e,i).format(n,r):super.formatAt(e,i,n,r)}optimize(e){super.optimize(e);const i=this.formats();if(Object.keys(i).length===0)return this.unwrap();const n=this.next;n instanceof qS&&n.prev===this&&$bt(i,n.formats())&&(n.moveChildren(this),n.remove())}replaceWith(e,i){const n=super.replaceWith(e,i);return this.attributes.copy(n),n}update(e,i){super.update(e,i),e.some(n=>n.target===this.domNode&&n.type==="attributes")&&this.attributes.build()}wrap(e,i){const n=super.wrap(e,i);return n instanceof qS&&this.attributes.move(n),n}};zS.allowedChildren=[zS,nu],zS.blotName="inline",zS.scope=Ei.INLINE_BLOT,zS.tagName="SPAN";let Bbt=zS;const mZ=Bbt,WS=class Jz extends Gh{static create(e){return super.create(e)}static formats(e,i){const n=i.query(Jz.blotName);if(!(n!=null&&e.tagName===n.tagName)){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return e.tagName.toLowerCase()}}constructor(e,i){super(e,i),this.attributes=new M2(this.domNode)}format(e,i){const n=this.scroll.query(e,Ei.BLOCK);n!=null&&(n instanceof Om?this.attributes.attribute(n,i):e===this.statics.blotName&&!i?this.replaceWith(Jz.blotName):i&&(e!==this.statics.blotName||this.formats()[e]!==i)&&this.replaceWith(e,i))}formats(){const e=this.attributes.values(),i=this.statics.formats(this.domNode,this.scroll);return i!=null&&(e[this.statics.blotName]=i),e}formatAt(e,i,n,r){this.scroll.query(n,Ei.BLOCK)!=null?this.format(n,r):super.formatAt(e,i,n,r)}insertAt(e,i,n){if(n==null||this.scroll.query(i,Ei.INLINE)!=null)super.insertAt(e,i,n);else{const r=this.split(e);if(r!=null){const a=this.scroll.create(i,n);r.parent.insertBefore(a,r)}else throw new Error("Attempt to insertAt after block boundaries")}}replaceWith(e,i){const n=super.replaceWith(e,i);return this.attributes.copy(n),n}update(e,i){super.update(e,i),e.some(n=>n.target===this.domNode&&n.type==="attributes")&&this.attributes.build()}};WS.blotName="block",WS.scope=Ei.BLOCK_BLOT,WS.tagName="P",WS.allowedChildren=[mZ,WS,nu];let Vbt=WS;const P1=Vbt,Qz=class extends Gh{checkMerge(){return this.next!==null&&this.next.statics.blotName===this.statics.blotName}deleteAt(e,i){super.deleteAt(e,i),this.enforceAllowedChildren()}formatAt(e,i,n,r){super.formatAt(e,i,n,r),this.enforceAllowedChildren()}insertAt(e,i,n){super.insertAt(e,i,n),this.enforceAllowedChildren()}optimize(e){super.optimize(e),this.children.length>0&&this.next!=null&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}};Qz.blotName="container",Qz.scope=Ei.BLOCK_BLOT;let jbt=Qz;const N2=jbt;class Gbt extends nu{static formats(e,i){}format(e,i){super.formatAt(0,this.length(),e,i)}formatAt(e,i,n,r){e===0&&i===this.length()?this.format(n,r):super.formatAt(e,i,n,r)}formats(){return this.statics.formats(this.domNode,this.scroll)}}const Jd=Gbt,Hbt={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},zbt=100,YS=class extends Gh{constructor(e,i){super(null,i),this.registry=e,this.scroll=this,this.build(),this.observer=new MutationObserver(n=>{this.update(n)}),this.observer.observe(this.domNode,Hbt),this.attach()}create(e,i){return this.registry.create(this,e,i)}find(e,i=!1){const n=this.registry.find(e,i);return n?n.scroll===this?n:i?this.find(n.scroll.domNode.parentNode,!0):null:null}query(e,i=Ei.ANY){return this.registry.query(e,i)}register(...e){return this.registry.register(...e)}build(){this.scroll!=null&&super.build()}detach(){super.detach(),this.observer.disconnect()}deleteAt(e,i){this.update(),e===0&&i===this.length()?this.children.forEach(n=>{n.remove()}):super.deleteAt(e,i)}formatAt(e,i,n,r){this.update(),super.formatAt(e,i,n,r)}insertAt(e,i,n){this.update(),super.insertAt(e,i,n)}optimize(e=[],i={}){super.optimize(i);const n=i.mutationsMap||new WeakMap;let r=Array.from(this.observer.takeRecords());for(;r.length>0;)e.push(r.pop());const a=(l,u=!0)=>{l==null||l===this||l.domNode.parentNode!=null&&(n.has(l.domNode)||n.set(l.domNode,[]),u&&a(l.parent))},s=l=>{n.has(l.domNode)&&(l instanceof Gh&&l.children.forEach(s),n.delete(l.domNode),l.optimize(i))};let o=e;for(let l=0;o.length>0;l+=1){if(l>=zbt)throw new Error("[Parchment] Maximum optimize iterations reached");for(o.forEach(u=>{const c=this.find(u.target,!0);c!=null&&(c.domNode===u.target&&(u.type==="childList"?(a(this.find(u.previousSibling,!1)),Array.from(u.addedNodes).forEach(d=>{const p=this.find(d,!1);a(p,!1),p instanceof Gh&&p.children.forEach(h=>{a(h,!1)})})):u.type==="attributes"&&a(c.prev)),a(c))}),this.children.forEach(s),o=Array.from(this.observer.takeRecords()),r=o.slice();r.length>0;)e.push(r.pop())}}update(e,i={}){e=e||this.observer.takeRecords();const n=new WeakMap;e.map(r=>{const a=this.find(r.target,!0);return a==null?null:n.has(a.domNode)?(n.get(a.domNode).push(r),null):(n.set(a.domNode,[r]),a)}).forEach(r=>{r!=null&&r!==this&&n.has(r.domNode)&&r.update(n.get(r.domNode)||[],i)}),i.mutationsMap=n,n.has(this.domNode)&&super.update(n.get(this.domNode),i),this.optimize(e,i)}};YS.blotName="scroll",YS.defaultChild=P1,YS.allowedChildren=[P1,N2],YS.scope=Ei.BLOCK_BLOT,YS.tagName="DIV";let qbt=YS;const gZ=qbt,eq=class PRe extends nu{static create(e){return document.createTextNode(e)}static value(e){return e.data}constructor(e,i){super(e,i),this.text=this.statics.value(this.domNode)}deleteAt(e,i){this.domNode.data=this.text=this.text.slice(0,e)+this.text.slice(e+i)}index(e,i){return this.domNode===e?i:-1}insertAt(e,i,n){n==null?(this.text=this.text.slice(0,e)+i+this.text.slice(e),this.domNode.data=this.text):super.insertAt(e,i,n)}length(){return this.text.length}optimize(e){super.optimize(e),this.text=this.statics.value(this.domNode),this.text.length===0?this.remove():this.next instanceof PRe&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())}position(e,i=!1){return[this.domNode,e]}split(e,i=!1){if(!i){if(e===0)return this;if(e===this.length())return this.next}const n=this.scroll.create(this.domNode.splitText(e));return this.parent.insertBefore(n,this.next||void 0),this.text=this.statics.value(this.domNode),n}update(e,i){e.some(n=>n.type==="characterData"&&n.target===this.domNode)&&(this.text=this.statics.value(this.domNode))}value(){return this.text}};eq.blotName="text",eq.scope=Ei.INLINE_BLOT;let Wbt=eq;const dO=Wbt,Ybt=Object.freeze(Object.defineProperty({__proto__:null,Attributor:Om,AttributorStore:M2,BlockBlot:P1,ClassAttributor:Tf,ContainerBlot:N2,EmbedBlot:Jd,InlineBlot:mZ,LeafBlot:nu,ParentBlot:Gh,Registry:kU,Scope:Ei,ScrollBlot:gZ,StyleAttributor:eI,TextBlot:dO},Symbol.toStringTag,{value:"Module"}));var $A={exports:{}},_j,Qne;function Kbt(){if(Qne)return _j;Qne=1;var t=-1,e=1,i=0;function n(P,M,R,N,A){if(P===M)return P?[[i,P]]:[];if(R!=null){var _=C(P,M,R);if(_)return _}var x=o(P,M),O=P.substring(0,x);P=P.substring(x),M=M.substring(x),x=u(P,M);var $=P.substring(P.length-x);P=P.substring(0,P.length-x),M=M.substring(0,M.length-x);var F=r(P,M);return O&&F.unshift([i,O]),$&&F.push([i,$]),y(F,A),N&&d(F),F}function r(P,M){var R;if(!P)return[[e,M]];if(!M)return[[t,P]];var N=P.length>M.length?P:M,A=P.length>M.length?M:P,_=N.indexOf(A);if(_!==-1)return R=[[e,N.substring(0,_)],[i,A],[e,N.substring(_+A.length)]],P.length>M.length&&(R[0][0]=R[2][0]=t),R;if(A.length===1)return[[t,P],[e,M]];var x=c(P,M);if(x){var O=x[0],$=x[1],F=x[2],j=x[3],H=x[4],G=n(O,F),W=n($,j);return G.concat([[i,H]],W)}return a(P,M)}function a(P,M){for(var R=P.length,N=M.length,A=Math.ceil((R+N)/2),_=A,x=2*A,O=new Array(x),$=new Array(x),F=0;F<x;F++)O[F]=-1,$[F]=-1;O[_+1]=0,$[_+1]=0;for(var j=R-N,H=j%2!==0,G=0,W=0,q=0,Z=0,K=0;K<A;K++){for(var Q=-K+G;Q<=K-W;Q+=2){var J=_+Q,ne;Q===-K||Q!==K&&O[J-1]<O[J+1]?ne=O[J+1]:ne=O[J-1]+1;for(var re=ne-Q;ne<R&&re<N&&P.charAt(ne)===M.charAt(re);)ne++,re++;if(O[J]=ne,ne>R)W+=2;else if(re>N)G+=2;else if(H){var oe=_+j-Q;if(oe>=0&&oe<x&&$[oe]!==-1){var de=R-$[oe];if(ne>=de)return s(P,M,ne,re)}}}for(var se=-K+q;se<=K-Z;se+=2){var oe=_+se,de;se===-K||se!==K&&$[oe-1]<$[oe+1]?de=$[oe+1]:de=$[oe-1]+1;for(var ge=de-se;de<R&&ge<N&&P.charAt(R-de-1)===M.charAt(N-ge-1);)de++,ge++;if($[oe]=de,de>R)Z+=2;else if(ge>N)q+=2;else if(!H){var J=_+j-se;if(J>=0&&J<x&&O[J]!==-1){var ne=O[J],re=_+ne-J;if(de=R-de,ne>=de)return s(P,M,ne,re)}}}}return[[t,P],[e,M]]}function s(P,M,R,N){var A=P.substring(0,R),_=M.substring(0,N),x=P.substring(R),O=M.substring(N),$=n(A,_),F=n(x,O);return $.concat(F)}function o(P,M){if(!P||!M||P.charAt(0)!==M.charAt(0))return 0;for(var R=0,N=Math.min(P.length,M.length),A=N,_=0;R<A;)P.substring(_,A)==M.substring(_,A)?(R=A,_=R):N=A,A=Math.floor((N-R)/2+R);return b(P.charCodeAt(A-1))&&A--,A}function l(P,M){var R=P.length,N=M.length;if(R==0||N==0)return 0;R>N?P=P.substring(R-N):R<N&&(M=M.substring(0,R));var A=Math.min(R,N);if(P==M)return A;for(var _=0,x=1;;){var O=P.substring(A-x),$=M.indexOf(O);if($==-1)return _;x+=$,($==0||P.substring(A-x)==M.substring(0,x))&&(_=x,x++)}}function u(P,M){if(!P||!M||P.slice(-1)!==M.slice(-1))return 0;for(var R=0,N=Math.min(P.length,M.length),A=N,_=0;R<A;)P.substring(P.length-A,P.length-_)==M.substring(M.length-A,M.length-_)?(R=A,_=R):N=A,A=Math.floor((N-R)/2+R);return I(P.charCodeAt(P.length-A))&&A--,A}function c(P,M){var R=P.length>M.length?P:M,N=P.length>M.length?M:P;if(R.length<4||N.length*2<R.length)return null;function A(W,q,Z){for(var K=W.substring(Z,Z+Math.floor(W.length/4)),Q=-1,J="",ne,re,oe,de;(Q=q.indexOf(K,Q+1))!==-1;){var se=o(W.substring(Z),q.substring(Q)),ge=u(W.substring(0,Z),q.substring(0,Q));J.length<ge+se&&(J=q.substring(Q-ge,Q)+q.substring(Q,Q+se),ne=W.substring(0,Z-ge),re=W.substring(Z+se),oe=q.substring(0,Q-ge),de=q.substring(Q+se))}return J.length*2>=W.length?[ne,re,oe,de,J]:null}var _=A(R,N,Math.ceil(R.length/4)),x=A(R,N,Math.ceil(R.length/2)),O;if(!_&&!x)return null;x?_?O=_[4].length>x[4].length?_:x:O=x:O=_;var $,F,j,H;P.length>M.length?($=O[0],F=O[1],j=O[2],H=O[3]):(j=O[0],H=O[1],$=O[2],F=O[3]);var G=O[4];return[$,F,j,H,G]}function d(P){for(var M=!1,R=[],N=0,A=null,_=0,x=0,O=0,$=0,F=0;_<P.length;)P[_][0]==i?(R[N++]=_,x=$,O=F,$=0,F=0,A=P[_][1]):(P[_][0]==e?$+=P[_][1].length:F+=P[_][1].length,A&&A.length<=Math.max(x,O)&&A.length<=Math.max($,F)&&(P.splice(R[N-1],0,[t,A]),P[R[N-1]+1][0]=e,N--,N--,_=N>0?R[N-1]:-1,x=0,O=0,$=0,F=0,A=null,M=!0)),_++;for(M&&y(P),v(P),_=1;_<P.length;){if(P[_-1][0]==t&&P[_][0]==e){var j=P[_-1][1],H=P[_][1],G=l(j,H),W=l(H,j);G>=W?(G>=j.length/2||G>=H.length/2)&&(P.splice(_,0,[i,H.substring(0,G)]),P[_-1][1]=j.substring(0,j.length-G),P[_+1][1]=H.substring(G),_++):(W>=j.length/2||W>=H.length/2)&&(P.splice(_,0,[i,j.substring(0,W)]),P[_-1][0]=e,P[_-1][1]=H.substring(0,H.length-W),P[_+1][0]=t,P[_+1][1]=j.substring(W),_++),_++}_++}}var p=/[^a-zA-Z0-9]/,h=/\s/,f=/[\r\n]/,m=/\n\r?\n$/,g=/^\r?\n\r?\n/;function v(P){function M(W,q){if(!W||!q)return 6;var Z=W.charAt(W.length-1),K=q.charAt(0),Q=Z.match(p),J=K.match(p),ne=Q&&Z.match(h),re=J&&K.match(h),oe=ne&&Z.match(f),de=re&&K.match(f),se=oe&&W.match(m),ge=de&&q.match(g);return se||ge?5:oe||de?4:Q&&!ne&&re?3:ne||re?2:Q||J?1:0}for(var R=1;R<P.length-1;){if(P[R-1][0]==i&&P[R+1][0]==i){var N=P[R-1][1],A=P[R][1],_=P[R+1][1],x=u(N,A);if(x){var O=A.substring(A.length-x);N=N.substring(0,N.length-x),A=O+A.substring(0,A.length-x),_=O+_}for(var $=N,F=A,j=_,H=M(N,A)+M(A,_);A.charAt(0)===_.charAt(0);){N+=A.charAt(0),A=A.substring(1)+_.charAt(0),_=_.substring(1);var G=M(N,A)+M(A,_);G>=H&&(H=G,$=N,F=A,j=_)}P[R-1][1]!=$&&($?P[R-1][1]=$:(P.splice(R-1,1),R--),P[R][1]=F,j?P[R+1][1]=j:(P.splice(R+1,1),R--))}R++}}function y(P,M){P.push([i,""]);for(var R=0,N=0,A=0,_="",x="",O;R<P.length;){if(R<P.length-1&&!P[R][1]){P.splice(R,1);continue}switch(P[R][0]){case e:A++,x+=P[R][1],R++;break;case t:N++,_+=P[R][1],R++;break;case i:var $=R-A-N-1;if(M){if($>=0&&w(P[$][1])){var F=P[$][1].slice(-1);if(P[$][1]=P[$][1].slice(0,-1),_=F+_,x=F+x,!P[$][1]){P.splice($,1),R--;var j=$-1;P[j]&&P[j][0]===e&&(A++,x=P[j][1]+x,j--),P[j]&&P[j][0]===t&&(N++,_=P[j][1]+_,j--),$=j}}if(S(P[R][1])){var F=P[R][1].charAt(0);P[R][1]=P[R][1].slice(1),_+=F,x+=F}}if(R<P.length-1&&!P[R][1]){P.splice(R,1);break}if(_.length>0||x.length>0){_.length>0&&x.length>0&&(O=o(x,_),O!==0&&($>=0?P[$][1]+=x.substring(0,O):(P.splice(0,0,[i,x.substring(0,O)]),R++),x=x.substring(O),_=_.substring(O)),O=u(x,_),O!==0&&(P[R][1]=x.substring(x.length-O)+P[R][1],x=x.substring(0,x.length-O),_=_.substring(0,_.length-O)));var H=A+N;_.length===0&&x.length===0?(P.splice(R-H,H),R=R-H):_.length===0?(P.splice(R-H,H,[e,x]),R=R-H+1):x.length===0?(P.splice(R-H,H,[t,_]),R=R-H+1):(P.splice(R-H,H,[t,_],[e,x]),R=R-H+2)}R!==0&&P[R-1][0]===i?(P[R-1][1]+=P[R][1],P.splice(R,1)):R++,A=0,N=0,_="",x="";break}}P[P.length-1][1]===""&&P.pop();var G=!1;for(R=1;R<P.length-1;)P[R-1][0]===i&&P[R+1][0]===i&&(P[R][1].substring(P[R][1].length-P[R-1][1].length)===P[R-1][1]?(P[R][1]=P[R-1][1]+P[R][1].substring(0,P[R][1].length-P[R-1][1].length),P[R+1][1]=P[R-1][1]+P[R+1][1],P.splice(R-1,1),G=!0):P[R][1].substring(0,P[R+1][1].length)==P[R+1][1]&&(P[R-1][1]+=P[R+1][1],P[R][1]=P[R][1].substring(P[R+1][1].length)+P[R+1][1],P.splice(R+1,1),G=!0)),R++;G&&y(P,M)}function b(P){return P>=55296&&P<=56319}function I(P){return P>=56320&&P<=57343}function S(P){return I(P.charCodeAt(0))}function w(P){return b(P.charCodeAt(P.length-1))}function T(P){for(var M=[],R=0;R<P.length;R++)P[R][1].length>0&&M.push(P[R]);return M}function U(P,M,R,N){return w(P)||S(N)?null:T([[i,P],[t,M],[e,R],[i,N]])}function C(P,M,R){var N=typeof R=="number"?{index:R,length:0}:R.oldRange,A=typeof R=="number"?null:R.newRange,_=P.length,x=M.length;if(N.length===0&&(A===null||A.length===0)){var O=N.index,$=P.slice(0,O),F=P.slice(O),j=A?A.index:null;e:{var H=O+x-_;if(j!==null&&j!==H||H<0||H>x)break e;var G=M.slice(0,H),W=M.slice(H);if(W!==F)break e;var q=Math.min(O,H),Z=$.slice(0,q),K=G.slice(0,q);if(Z!==K)break e;var Q=$.slice(q),J=G.slice(q);return U(Z,Q,J,F)}e:{if(j!==null&&j!==O)break e;var ne=O,G=M.slice(0,ne),W=M.slice(ne);if(G!==$)break e;var re=Math.min(_-ne,x-ne),oe=F.slice(F.length-re),de=W.slice(W.length-re);if(oe!==de)break e;var Q=F.slice(0,F.length-re),J=W.slice(0,W.length-re);return U($,Q,J,oe)}}if(N.length>0&&A&&A.length===0)e:{var Z=P.slice(0,N.index),oe=P.slice(N.index+N.length),q=Z.length,re=oe.length;if(x<q+re)break e;var K=M.slice(0,q),de=M.slice(x-re);if(Z!==K||oe!==de)break e;var Q=P.slice(q,_-re),J=M.slice(q,x-re);return U(Z,Q,J,oe)}return null}function E(P,M,R,N){return n(P,M,R,N,!0)}return E.INSERT=e,E.DELETE=t,E.EQUAL=i,_j=E,_j}var nP={exports:{}};nP.exports;var ere;function CRe(){return ere||(ere=1,(function(t,e){var i=200,n="__lodash_hash_undefined__",r=9007199254740991,a="[object Arguments]",s="[object Array]",o="[object Boolean]",l="[object Date]",u="[object Error]",c="[object Function]",d="[object GeneratorFunction]",p="[object Map]",h="[object Number]",f="[object Object]",m="[object Promise]",g="[object RegExp]",v="[object Set]",y="[object String]",b="[object Symbol]",I="[object WeakMap]",S="[object ArrayBuffer]",w="[object DataView]",T="[object Float32Array]",U="[object Float64Array]",C="[object Int8Array]",E="[object Int16Array]",P="[object Int32Array]",M="[object Uint8Array]",R="[object Uint8ClampedArray]",N="[object Uint16Array]",A="[object Uint32Array]",_=/[\\^$.*+?()[\]{}|]/g,x=/\w*$/,O=/^\[object .+?Constructor\]$/,$=/^(?:0|[1-9]\d*)$/,F={};F[a]=F[s]=F[S]=F[w]=F[o]=F[l]=F[T]=F[U]=F[C]=F[E]=F[P]=F[p]=F[h]=F[f]=F[g]=F[v]=F[y]=F[b]=F[M]=F[R]=F[N]=F[A]=!0,F[u]=F[c]=F[I]=!1;var j=typeof xg=="object"&&xg&&xg.Object===Object&&xg,H=typeof self=="object"&&self&&self.Object===Object&&self,G=j||H||Function("return this")(),W=e&&!e.nodeType&&e,q=W&&!0&&t&&!t.nodeType&&t,Z=q&&q.exports===W;function K(ee,ve){return ee.set(ve[0],ve[1]),ee}function Q(ee,ve){return ee.add(ve),ee}function J(ee,ve){for(var Ne=-1,ut=ee?ee.length:0;++Ne<ut&&ve(ee[Ne],Ne,ee)!==!1;);return ee}function ne(ee,ve){for(var Ne=-1,ut=ve.length,en=ee.length;++Ne<ut;)ee[en+Ne]=ve[Ne];return ee}function re(ee,ve,Ne,ut){for(var en=-1,Di=ee?ee.length:0;++en<Di;)Ne=ve(Ne,ee[en],en,ee);return Ne}function oe(ee,ve){for(var Ne=-1,ut=Array(ee);++Ne<ee;)ut[Ne]=ve(Ne);return ut}function de(ee,ve){return ee?.[ve]}function se(ee){var ve=!1;if(ee!=null&&typeof ee.toString!="function")try{ve=!!(ee+"")}catch{}return ve}function ge(ee){var ve=-1,Ne=Array(ee.size);return ee.forEach(function(ut,en){Ne[++ve]=[en,ut]}),Ne}function ye(ee,ve){return function(Ne){return ee(ve(Ne))}}function Te(ee){var ve=-1,Ne=Array(ee.size);return ee.forEach(function(ut){Ne[++ve]=ut}),Ne}var De=Array.prototype,xe=Function.prototype,Me=Object.prototype,Oe=G["__core-js_shared__"],at=(function(){var ee=/[^.]+$/.exec(Oe&&Oe.keys&&Oe.keys.IE_PROTO||"");return ee?"Symbol(src)_1."+ee:""})(),Fe=xe.toString,mt=Me.hasOwnProperty,Xe=Me.toString,gt=RegExp("^"+Fe.call(mt).replace(_,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ht=Z?G.Buffer:void 0,_e=G.Symbol,Ye=G.Uint8Array,Je=ye(Object.getPrototypeOf,Object),ct=Object.create,pt=Me.propertyIsEnumerable,Se=De.splice,he=Object.getOwnPropertySymbols,we=ht?ht.isBuffer:void 0,be=ye(Object.keys,Object),Ae=yr(G,"DataView"),ze=yr(G,"Map"),We=yr(G,"Promise"),Le=yr(G,"Set"),ft=yr(G,"WeakMap"),rt=yr(Object,"create"),St=ga(Ae),si=ga(ze),Qe=ga(We),bt=ga(Le),ci=ga(ft),Tt=_e?_e.prototype:void 0,Li=Tt?Tt.valueOf:void 0;function Jt(ee){var ve=-1,Ne=ee?ee.length:0;for(this.clear();++ve<Ne;){var ut=ee[ve];this.set(ut[0],ut[1])}}function Yi(){this.__data__=rt?rt(null):{}}function Ri(ee){return this.has(ee)&&delete this.__data__[ee]}function qi(ee){var ve=this.__data__;if(rt){var Ne=ve[ee];return Ne===n?void 0:Ne}return mt.call(ve,ee)?ve[ee]:void 0}function hn(ee){var ve=this.__data__;return rt?ve[ee]!==void 0:mt.call(ve,ee)}function kt(ee,ve){var Ne=this.__data__;return Ne[ee]=rt&&ve===void 0?n:ve,this}Jt.prototype.clear=Yi,Jt.prototype.delete=Ri,Jt.prototype.get=qi,Jt.prototype.has=hn,Jt.prototype.set=kt;function fi(ee){var ve=-1,Ne=ee?ee.length:0;for(this.clear();++ve<Ne;){var ut=ee[ve];this.set(ut[0],ut[1])}}function Xr(){this.__data__=[]}function Jr(ee){var ve=this.__data__,Ne=Yl(ve,ee);if(Ne<0)return!1;var ut=ve.length-1;return Ne==ut?ve.pop():Se.call(ve,Ne,1),!0}function Qr(ee){var ve=this.__data__,Ne=Yl(ve,ee);return Ne<0?void 0:ve[Ne][1]}function Lr(ee){return Yl(this.__data__,ee)>-1}function Ua(ee,ve){var Ne=this.__data__,ut=Yl(Ne,ee);return ut<0?Ne.push([ee,ve]):Ne[ut][1]=ve,this}fi.prototype.clear=Xr,fi.prototype.delete=Jr,fi.prototype.get=Qr,fi.prototype.has=Lr,fi.prototype.set=Ua;function lr(ee){var ve=-1,Ne=ee?ee.length:0;for(this.clear();++ve<Ne;){var ut=ee[ve];this.set(ut[0],ut[1])}}function Cu(){this.__data__={hash:new Jt,map:new(ze||fi),string:new Jt}}function zl(ee){return Oi(this,ee).delete(ee)}function Cf(ee){return Oi(this,ee).get(ee)}function Ru(ee){return Oi(this,ee).has(ee)}function ch(ee,ve){return Oi(this,ee).set(ee,ve),this}lr.prototype.clear=Cu,lr.prototype.delete=zl,lr.prototype.get=Cf,lr.prototype.has=Ru,lr.prototype.set=ch;function fa(ee){this.__data__=new fi(ee)}function Gr(){this.__data__=new fi}function zo(ee){return this.__data__.delete(ee)}function pl(ee){return this.__data__.get(ee)}function Rf(ee){return this.__data__.has(ee)}function ql(ee,ve){var Ne=this.__data__;if(Ne instanceof fi){var ut=Ne.__data__;if(!ze||ut.length<i-1)return ut.push([ee,ve]),this;Ne=this.__data__=new lr(ut)}return Ne.set(ee,ve),this}fa.prototype.clear=Gr,fa.prototype.delete=zo,fa.prototype.get=pl,fa.prototype.has=Rf,fa.prototype.set=ql;function Wl(ee,ve){var Ne=va(ee)||oi(ee)?oe(ee.length,String):[],ut=Ne.length,en=!!ut;for(var Di in ee)mt.call(ee,Di)&&!(en&&(Di=="length"||Mf(Di,ut)))&&Ne.push(Di);return Ne}function ep(ee,ve,Ne){var ut=ee[ve];(!(mt.call(ee,ve)&&dg(ut,Ne))||Ne===void 0&&!(ve in ee))&&(ee[ve]=Ne)}function Yl(ee,ve){for(var Ne=ee.length;Ne--;)if(dg(ee[Ne][0],ve))return Ne;return-1}function ma(ee,ve){return ee&&st(ve,yc(ve),ee)}function fc(ee,ve,Ne,ut,en,Di,$n){var ei;if(ut&&(ei=Di?ut(ee,en,Di,$n):ut(ee)),ei!==void 0)return ei;if(!Hr(ee))return ee;var Da=va(ee);if(Da){if(ei=Pn(ee),!ve)return Id(ee,ei)}else{var bn=Nu(ee),ts=bn==c||bn==d;if(ip(ee))return cs(ee,ve);if(bn==f||bn==a||ts&&!Di){if(se(ee))return Di?ee:{};if(ei=fl(ts?{}:ee),!ve)return mi(ee,ma(ei,ee))}else{if(!F[bn])return Di?ee:{};ei=cg(ee,bn,fc,ve)}}$n||($n=new fa);var Co=$n.get(ee);if(Co)return Co;if($n.set(ee,ei),!Da)var Fa=Ne?xi(ee):yc(ee);return J(Fa||ee,function(is,Ms){Fa&&(Ms=is,is=ee[Ms]),ep(ei,Ms,fc(is,ve,Ne,ut,Ms,ee,$n))}),ei}function mc(ee){return Hr(ee)?ct(ee):{}}function Mu(ee,ve,Ne){var ut=ve(ee);return va(ee)?ut:ne(ut,Ne(ee))}function Qt(ee){return Xe.call(ee)}function Mr(ee){if(!Hr(ee)||gc(ee))return!1;var ve=qo(ee)||se(ee)?gt:O;return ve.test(ga(ee))}function hl(ee){if(!vc(ee))return be(ee);var ve=[];for(var Ne in Object(ee))mt.call(ee,Ne)&&Ne!="constructor"&&ve.push(Ne);return ve}function cs(ee,ve){if(ve)return ee.slice();var Ne=new ee.constructor(ee.length);return ee.copy(Ne),Ne}function io(ee){var ve=new ee.constructor(ee.byteLength);return new Ye(ve).set(new Ye(ee)),ve}function Rs(ee,ve){var Ne=ve?io(ee.buffer):ee.buffer;return new ee.constructor(Ne,ee.byteOffset,ee.byteLength)}function Bi(ee,ve,Ne){var ut=ve?Ne(ge(ee),!0):ge(ee);return re(ut,K,new ee.constructor)}function vr(ee){var ve=new ee.constructor(ee.source,x.exec(ee));return ve.lastIndex=ee.lastIndex,ve}function rr(ee,ve,Ne){var ut=ve?Ne(Te(ee),!0):Te(ee);return re(ut,Q,new ee.constructor)}function Kl(ee){return Li?Object(Li.call(ee)):{}}function es(ee,ve){var Ne=ve?io(ee.buffer):ee.buffer;return new ee.constructor(Ne,ee.byteOffset,ee.length)}function Id(ee,ve){var Ne=-1,ut=ee.length;for(ve||(ve=Array(ut));++Ne<ut;)ve[Ne]=ee[Ne];return ve}function st(ee,ve,Ne,ut){Ne||(Ne={});for(var en=-1,Di=ve.length;++en<Di;){var $n=ve[en],ei=void 0;ep(Ne,$n,ei===void 0?ee[$n]:ei)}return Ne}function mi(ee,ve){return st(ee,Oa(ee),ve)}function xi(ee){return Mu(ee,yc,Oa)}function Oi(ee,ve){var Ne=ee.__data__;return Ws(ve)?Ne[typeof ve=="string"?"string":"hash"]:Ne.map}function yr(ee,ve){var Ne=de(ee,ve);return Mr(Ne)?Ne:void 0}var Oa=he?ye(he,Object):La,Nu=Qt;(Ae&&Nu(new Ae(new ArrayBuffer(1)))!=w||ze&&Nu(new ze)!=p||We&&Nu(We.resolve())!=m||Le&&Nu(new Le)!=v||ft&&Nu(new ft)!=I)&&(Nu=function(ee){var ve=Xe.call(ee),Ne=ve==f?ee.constructor:void 0,ut=Ne?ga(Ne):void 0;if(ut)switch(ut){case St:return w;case si:return p;case Qe:return m;case bt:return v;case ci:return I}return ve});function Pn(ee){var ve=ee.length,Ne=ee.constructor(ve);return ve&&typeof ee[0]=="string"&&mt.call(ee,"index")&&(Ne.index=ee.index,Ne.input=ee.input),Ne}function fl(ee){return typeof ee.constructor=="function"&&!vc(ee)?mc(Je(ee)):{}}function cg(ee,ve,Ne,ut){var en=ee.constructor;switch(ve){case S:return io(ee);case o:case l:return new en(+ee);case w:return Rs(ee,ut);case T:case U:case C:case E:case P:case M:case R:case N:case A:return es(ee,ut);case p:return Bi(ee,ut,Ne);case h:case y:return new en(ee);case g:return vr(ee);case v:return rr(ee,ut,Ne);case b:return Kl(ee)}}function Mf(ee,ve){return ve=ve??r,!!ve&&(typeof ee=="number"||$.test(ee))&&ee>-1&&ee%1==0&&ee<ve}function Ws(ee){var ve=typeof ee;return ve=="string"||ve=="number"||ve=="symbol"||ve=="boolean"?ee!=="__proto__":ee===null}function gc(ee){return!!at&&at in ee}function vc(ee){var ve=ee&&ee.constructor,Ne=typeof ve=="function"&&ve.prototype||Me;return ee===Ne}function ga(ee){if(ee!=null){try{return Fe.call(ee)}catch{}try{return ee+""}catch{}}return""}function dh(ee){return fc(ee,!0,!0)}function dg(ee,ve){return ee===ve||ee!==ee&&ve!==ve}function oi(ee){return tp(ee)&&mt.call(ee,"callee")&&(!pt.call(ee,"callee")||Xe.call(ee)==a)}var va=Array.isArray;function jn(ee){return ee!=null&&Nf(ee.length)&&!qo(ee)}function tp(ee){return np(ee)&&jn(ee)}var ip=we||ml;function qo(ee){var ve=Hr(ee)?Xe.call(ee):"";return ve==c||ve==d}function Nf(ee){return typeof ee=="number"&&ee>-1&&ee%1==0&&ee<=r}function Hr(ee){var ve=typeof ee;return!!ee&&(ve=="object"||ve=="function")}function np(ee){return!!ee&&typeof ee=="object"}function yc(ee){return jn(ee)?Wl(ee):hl(ee)}function La(){return[]}function ml(){return!1}t.exports=dh})(nP,nP.exports)),nP.exports}var rP={exports:{}};rP.exports;var tre;function RRe(){return tre||(tre=1,(function(t,e){var i=200,n="__lodash_hash_undefined__",r=1,a=2,s=9007199254740991,o="[object Arguments]",l="[object Array]",u="[object AsyncFunction]",c="[object Boolean]",d="[object Date]",p="[object Error]",h="[object Function]",f="[object GeneratorFunction]",m="[object Map]",g="[object Number]",v="[object Null]",y="[object Object]",b="[object Promise]",I="[object Proxy]",S="[object RegExp]",w="[object Set]",T="[object String]",U="[object Symbol]",C="[object Undefined]",E="[object WeakMap]",P="[object ArrayBuffer]",M="[object DataView]",R="[object Float32Array]",N="[object Float64Array]",A="[object Int8Array]",_="[object Int16Array]",x="[object Int32Array]",O="[object Uint8Array]",$="[object Uint8ClampedArray]",F="[object Uint16Array]",j="[object Uint32Array]",H=/[\\^$.*+?()[\]{}|]/g,G=/^\[object .+?Constructor\]$/,W=/^(?:0|[1-9]\d*)$/,q={};q[R]=q[N]=q[A]=q[_]=q[x]=q[O]=q[$]=q[F]=q[j]=!0,q[o]=q[l]=q[P]=q[c]=q[M]=q[d]=q[p]=q[h]=q[m]=q[g]=q[y]=q[S]=q[w]=q[T]=q[E]=!1;var Z=typeof xg=="object"&&xg&&xg.Object===Object&&xg,K=typeof self=="object"&&self&&self.Object===Object&&self,Q=Z||K||Function("return this")(),J=e&&!e.nodeType&&e,ne=J&&!0&&t&&!t.nodeType&&t,re=ne&&ne.exports===J,oe=re&&Z.process,de=(function(){try{return oe&&oe.binding&&oe.binding("util")}catch{}})(),se=de&&de.isTypedArray;function ge(ee,ve){for(var Ne=-1,ut=ee==null?0:ee.length,en=0,Di=[];++Ne<ut;){var $n=ee[Ne];ve($n,Ne,ee)&&(Di[en++]=$n)}return Di}function ye(ee,ve){for(var Ne=-1,ut=ve.length,en=ee.length;++Ne<ut;)ee[en+Ne]=ve[Ne];return ee}function Te(ee,ve){for(var Ne=-1,ut=ee==null?0:ee.length;++Ne<ut;)if(ve(ee[Ne],Ne,ee))return!0;return!1}function De(ee,ve){for(var Ne=-1,ut=Array(ee);++Ne<ee;)ut[Ne]=ve(Ne);return ut}function xe(ee){return function(ve){return ee(ve)}}function Me(ee,ve){return ee.has(ve)}function Oe(ee,ve){return ee?.[ve]}function at(ee){var ve=-1,Ne=Array(ee.size);return ee.forEach(function(ut,en){Ne[++ve]=[en,ut]}),Ne}function Fe(ee,ve){return function(Ne){return ee(ve(Ne))}}function mt(ee){var ve=-1,Ne=Array(ee.size);return ee.forEach(function(ut){Ne[++ve]=ut}),Ne}var Xe=Array.prototype,gt=Function.prototype,ht=Object.prototype,_e=Q["__core-js_shared__"],Ye=gt.toString,Je=ht.hasOwnProperty,ct=(function(){var ee=/[^.]+$/.exec(_e&&_e.keys&&_e.keys.IE_PROTO||"");return ee?"Symbol(src)_1."+ee:""})(),pt=ht.toString,Se=RegExp("^"+Ye.call(Je).replace(H,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),he=re?Q.Buffer:void 0,we=Q.Symbol,be=Q.Uint8Array,Ae=ht.propertyIsEnumerable,ze=Xe.splice,We=we?we.toStringTag:void 0,Le=Object.getOwnPropertySymbols,ft=he?he.isBuffer:void 0,rt=Fe(Object.keys,Object),St=Oa(Q,"DataView"),si=Oa(Q,"Map"),Qe=Oa(Q,"Promise"),bt=Oa(Q,"Set"),ci=Oa(Q,"WeakMap"),Tt=Oa(Object,"create"),Li=ga(St),Jt=ga(si),Yi=ga(Qe),Ri=ga(bt),qi=ga(ci),hn=we?we.prototype:void 0,kt=hn?hn.valueOf:void 0;function fi(ee){var ve=-1,Ne=ee==null?0:ee.length;for(this.clear();++ve<Ne;){var ut=ee[ve];this.set(ut[0],ut[1])}}function Xr(){this.__data__=Tt?Tt(null):{},this.size=0}function Jr(ee){var ve=this.has(ee)&&delete this.__data__[ee];return this.size-=ve?1:0,ve}function Qr(ee){var ve=this.__data__;if(Tt){var Ne=ve[ee];return Ne===n?void 0:Ne}return Je.call(ve,ee)?ve[ee]:void 0}function Lr(ee){var ve=this.__data__;return Tt?ve[ee]!==void 0:Je.call(ve,ee)}function Ua(ee,ve){var Ne=this.__data__;return this.size+=this.has(ee)?0:1,Ne[ee]=Tt&&ve===void 0?n:ve,this}fi.prototype.clear=Xr,fi.prototype.delete=Jr,fi.prototype.get=Qr,fi.prototype.has=Lr,fi.prototype.set=Ua;function lr(ee){var ve=-1,Ne=ee==null?0:ee.length;for(this.clear();++ve<Ne;){var ut=ee[ve];this.set(ut[0],ut[1])}}function Cu(){this.__data__=[],this.size=0}function zl(ee){var ve=this.__data__,Ne=cs(ve,ee);if(Ne<0)return!1;var ut=ve.length-1;return Ne==ut?ve.pop():ze.call(ve,Ne,1),--this.size,!0}function Cf(ee){var ve=this.__data__,Ne=cs(ve,ee);return Ne<0?void 0:ve[Ne][1]}function Ru(ee){return cs(this.__data__,ee)>-1}function ch(ee,ve){var Ne=this.__data__,ut=cs(Ne,ee);return ut<0?(++this.size,Ne.push([ee,ve])):Ne[ut][1]=ve,this}lr.prototype.clear=Cu,lr.prototype.delete=zl,lr.prototype.get=Cf,lr.prototype.has=Ru,lr.prototype.set=ch;function fa(ee){var ve=-1,Ne=ee==null?0:ee.length;for(this.clear();++ve<Ne;){var ut=ee[ve];this.set(ut[0],ut[1])}}function Gr(){this.size=0,this.__data__={hash:new fi,map:new(si||lr),string:new fi}}function zo(ee){var ve=yr(this,ee).delete(ee);return this.size-=ve?1:0,ve}function pl(ee){return yr(this,ee).get(ee)}function Rf(ee){return yr(this,ee).has(ee)}function ql(ee,ve){var Ne=yr(this,ee),ut=Ne.size;return Ne.set(ee,ve),this.size+=Ne.size==ut?0:1,this}fa.prototype.clear=Gr,fa.prototype.delete=zo,fa.prototype.get=pl,fa.prototype.has=Rf,fa.prototype.set=ql;function Wl(ee){var ve=-1,Ne=ee==null?0:ee.length;for(this.__data__=new fa;++ve<Ne;)this.add(ee[ve])}function ep(ee){return this.__data__.set(ee,n),this}function Yl(ee){return this.__data__.has(ee)}Wl.prototype.add=Wl.prototype.push=ep,Wl.prototype.has=Yl;function ma(ee){var ve=this.__data__=new lr(ee);this.size=ve.size}function fc(){this.__data__=new lr,this.size=0}function mc(ee){var ve=this.__data__,Ne=ve.delete(ee);return this.size=ve.size,Ne}function Mu(ee){return this.__data__.get(ee)}function Qt(ee){return this.__data__.has(ee)}function Mr(ee,ve){var Ne=this.__data__;if(Ne instanceof lr){var ut=Ne.__data__;if(!si||ut.length<i-1)return ut.push([ee,ve]),this.size=++Ne.size,this;Ne=this.__data__=new fa(ut)}return Ne.set(ee,ve),this.size=Ne.size,this}ma.prototype.clear=fc,ma.prototype.delete=mc,ma.prototype.get=Mu,ma.prototype.has=Qt,ma.prototype.set=Mr;function hl(ee,ve){var Ne=oi(ee),ut=!Ne&&dg(ee),en=!Ne&&!ut&&jn(ee),Di=!Ne&&!ut&&!en&&np(ee),$n=Ne||ut||en||Di,ei=$n?De(ee.length,String):[],Da=ei.length;for(var bn in ee)Je.call(ee,bn)&&!($n&&(bn=="length"||en&&(bn=="offset"||bn=="parent")||Di&&(bn=="buffer"||bn=="byteLength"||bn=="byteOffset")||cg(bn,Da)))&&ei.push(bn);return ei}function cs(ee,ve){for(var Ne=ee.length;Ne--;)if(dh(ee[Ne][0],ve))return Ne;return-1}function io(ee,ve,Ne){var ut=ve(ee);return oi(ee)?ut:ye(ut,Ne(ee))}function Rs(ee){return ee==null?ee===void 0?C:v:We&&We in Object(ee)?Nu(ee):vc(ee)}function Bi(ee){return Hr(ee)&&Rs(ee)==o}function vr(ee,ve,Ne,ut,en){return ee===ve?!0:ee==null||ve==null||!Hr(ee)&&!Hr(ve)?ee!==ee&&ve!==ve:rr(ee,ve,Ne,ut,vr,en)}function rr(ee,ve,Ne,ut,en,Di){var $n=oi(ee),ei=oi(ve),Da=$n?l:fl(ee),bn=ei?l:fl(ve);Da=Da==o?y:Da,bn=bn==o?y:bn;var ts=Da==y,Co=bn==y,Fa=Da==bn;if(Fa&&jn(ee)){if(!jn(ve))return!1;$n=!0,ts=!1}if(Fa&&!ts)return Di||(Di=new ma),$n||np(ee)?st(ee,ve,Ne,ut,en,Di):mi(ee,ve,Da,Ne,ut,en,Di);if(!(Ne&r)){var is=ts&&Je.call(ee,"__wrapped__"),Ms=Co&&Je.call(ve,"__wrapped__");if(is||Ms){var Zl=is?ee.value():ee,Xl=Ms?ve.value():ve;return Di||(Di=new ma),en(Zl,Xl,Ne,ut,Di)}}return Fa?(Di||(Di=new ma),xi(ee,ve,Ne,ut,en,Di)):!1}function Kl(ee){if(!Nf(ee)||Ws(ee))return!1;var ve=ip(ee)?Se:G;return ve.test(ga(ee))}function es(ee){return Hr(ee)&&qo(ee.length)&&!!q[Rs(ee)]}function Id(ee){if(!gc(ee))return rt(ee);var ve=[];for(var Ne in Object(ee))Je.call(ee,Ne)&&Ne!="constructor"&&ve.push(Ne);return ve}function st(ee,ve,Ne,ut,en,Di){var $n=Ne&r,ei=ee.length,Da=ve.length;if(ei!=Da&&!($n&&Da>ei))return!1;var bn=Di.get(ee);if(bn&&Di.get(ve))return bn==ve;var ts=-1,Co=!0,Fa=Ne&a?new Wl:void 0;for(Di.set(ee,ve),Di.set(ve,ee);++ts<ei;){var is=ee[ts],Ms=ve[ts];if(ut)var Zl=$n?ut(Ms,is,ts,ve,ee,Di):ut(is,Ms,ts,ee,ve,Di);if(Zl!==void 0){if(Zl)continue;Co=!1;break}if(Fa){if(!Te(ve,function(Xl,bc){if(!Me(Fa,bc)&&(is===Xl||en(is,Xl,Ne,ut,Di)))return Fa.push(bc)})){Co=!1;break}}else if(!(is===Ms||en(is,Ms,Ne,ut,Di))){Co=!1;break}}return Di.delete(ee),Di.delete(ve),Co}function mi(ee,ve,Ne,ut,en,Di,$n){switch(Ne){case M:if(ee.byteLength!=ve.byteLength||ee.byteOffset!=ve.byteOffset)return!1;ee=ee.buffer,ve=ve.buffer;case P:return!(ee.byteLength!=ve.byteLength||!Di(new be(ee),new be(ve)));case c:case d:case g:return dh(+ee,+ve);case p:return ee.name==ve.name&&ee.message==ve.message;case S:case T:return ee==ve+"";case m:var ei=at;case w:var Da=ut&r;if(ei||(ei=mt),ee.size!=ve.size&&!Da)return!1;var bn=$n.get(ee);if(bn)return bn==ve;ut|=a,$n.set(ee,ve);var ts=st(ei(ee),ei(ve),ut,en,Di,$n);return $n.delete(ee),ts;case U:if(kt)return kt.call(ee)==kt.call(ve)}return!1}function xi(ee,ve,Ne,ut,en,Di){var $n=Ne&r,ei=Oi(ee),Da=ei.length,bn=Oi(ve),ts=bn.length;if(Da!=ts&&!$n)return!1;for(var Co=Da;Co--;){var Fa=ei[Co];if(!($n?Fa in ve:Je.call(ve,Fa)))return!1}var is=Di.get(ee);if(is&&Di.get(ve))return is==ve;var Ms=!0;Di.set(ee,ve),Di.set(ve,ee);for(var Zl=$n;++Co<Da;){Fa=ei[Co];var Xl=ee[Fa],bc=ve[Fa];if(ut)var pg=$n?ut(bc,Xl,Fa,ve,ee,Di):ut(Xl,bc,Fa,ee,ve,Di);if(!(pg===void 0?Xl===bc||en(Xl,bc,Ne,ut,Di):pg)){Ms=!1;break}Zl||(Zl=Fa=="constructor")}if(Ms&&!Zl){var Wv=ee.constructor,Ns=ve.constructor;Wv!=Ns&&"constructor"in ee&&"constructor"in ve&&!(typeof Wv=="function"&&Wv instanceof Wv&&typeof Ns=="function"&&Ns instanceof Ns)&&(Ms=!1)}return Di.delete(ee),Di.delete(ve),Ms}function Oi(ee){return io(ee,yc,Pn)}function yr(ee,ve){var Ne=ee.__data__;return Mf(ve)?Ne[typeof ve=="string"?"string":"hash"]:Ne.map}function Oa(ee,ve){var Ne=Oe(ee,ve);return Kl(Ne)?Ne:void 0}function Nu(ee){var ve=Je.call(ee,We),Ne=ee[We];try{ee[We]=void 0;var ut=!0}catch{}var en=pt.call(ee);return ut&&(ve?ee[We]=Ne:delete ee[We]),en}var Pn=Le?function(ee){return ee==null?[]:(ee=Object(ee),ge(Le(ee),function(ve){return Ae.call(ee,ve)}))}:La,fl=Rs;(St&&fl(new St(new ArrayBuffer(1)))!=M||si&&fl(new si)!=m||Qe&&fl(Qe.resolve())!=b||bt&&fl(new bt)!=w||ci&&fl(new ci)!=E)&&(fl=function(ee){var ve=Rs(ee),Ne=ve==y?ee.constructor:void 0,ut=Ne?ga(Ne):"";if(ut)switch(ut){case Li:return M;case Jt:return m;case Yi:return b;case Ri:return w;case qi:return E}return ve});function cg(ee,ve){return ve=ve??s,!!ve&&(typeof ee=="number"||W.test(ee))&&ee>-1&&ee%1==0&&ee<ve}function Mf(ee){var ve=typeof ee;return ve=="string"||ve=="number"||ve=="symbol"||ve=="boolean"?ee!=="__proto__":ee===null}function Ws(ee){return!!ct&&ct in ee}function gc(ee){var ve=ee&&ee.constructor,Ne=typeof ve=="function"&&ve.prototype||ht;return ee===Ne}function vc(ee){return pt.call(ee)}function ga(ee){if(ee!=null){try{return Ye.call(ee)}catch{}try{return ee+""}catch{}}return""}function dh(ee,ve){return ee===ve||ee!==ee&&ve!==ve}var dg=Bi((function(){return arguments})())?Bi:function(ee){return Hr(ee)&&Je.call(ee,"callee")&&!Ae.call(ee,"callee")},oi=Array.isArray;function va(ee){return ee!=null&&qo(ee.length)&&!ip(ee)}var jn=ft||ml;function tp(ee,ve){return vr(ee,ve)}function ip(ee){if(!Nf(ee))return!1;var ve=Rs(ee);return ve==h||ve==f||ve==u||ve==I}function qo(ee){return typeof ee=="number"&&ee>-1&&ee%1==0&&ee<=s}function Nf(ee){var ve=typeof ee;return ee!=null&&(ve=="object"||ve=="function")}function Hr(ee){return ee!=null&&typeof ee=="object"}var np=se?xe(se):es;function yc(ee){return va(ee)?hl(ee):Id(ee)}function La(){return[]}function ml(){return!1}t.exports=tp})(rP,rP.exports)),rP.exports}var BA={},ire;function Zbt(){if(ire)return BA;ire=1,Object.defineProperty(BA,"__esModule",{value:!0});const t=CRe(),e=RRe();var i;return(function(n){function r(l={},u={},c=!1){typeof l!="object"&&(l={}),typeof u!="object"&&(u={});let d=t(u);c||(d=Object.keys(d).reduce((p,h)=>(d[h]!=null&&(p[h]=d[h]),p),{}));for(const p in l)l[p]!==void 0&&u[p]===void 0&&(d[p]=l[p]);return Object.keys(d).length>0?d:void 0}n.compose=r;function a(l={},u={}){typeof l!="object"&&(l={}),typeof u!="object"&&(u={});const c=Object.keys(l).concat(Object.keys(u)).reduce((d,p)=>(e(l[p],u[p])||(d[p]=u[p]===void 0?null:u[p]),d),{});return Object.keys(c).length>0?c:void 0}n.diff=a;function s(l={},u={}){l=l||{};const c=Object.keys(u).reduce((d,p)=>(u[p]!==l[p]&&l[p]!==void 0&&(d[p]=u[p]),d),{});return Object.keys(l).reduce((d,p)=>(l[p]!==u[p]&&u[p]===void 0&&(d[p]=null),d),c)}n.invert=s;function o(l,u,c=!1){if(typeof l!="object")return u;if(typeof u!="object")return;if(!c)return u;const d=Object.keys(u).reduce((p,h)=>(l[h]===void 0&&(p[h]=u[h]),p),{});return Object.keys(d).length>0?d:void 0}n.transform=o})(i||(i={})),BA.default=i,BA}var VA={},nre;function MRe(){if(nre)return VA;nre=1,Object.defineProperty(VA,"__esModule",{value:!0});var t;return(function(e){function i(n){return typeof n.delete=="number"?n.delete:typeof n.retain=="number"?n.retain:typeof n.retain=="object"&&n.retain!==null?1:typeof n.insert=="string"?n.insert.length:1}e.length=i})(t||(t={})),VA.default=t,VA}var jA={},rre;function Xbt(){if(rre)return jA;rre=1,Object.defineProperty(jA,"__esModule",{value:!0});const t=MRe();class e{constructor(n){this.ops=n,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(n){n||(n=1/0);const r=this.ops[this.index];if(r){const a=this.offset,s=t.default.length(r);if(n>=s-a?(n=s-a,this.index+=1,this.offset=0):this.offset+=n,typeof r.delete=="number")return{delete:n};{const o={};return r.attributes&&(o.attributes=r.attributes),typeof r.retain=="number"?o.retain=n:typeof r.retain=="object"&&r.retain!==null?o.retain=r.retain:typeof r.insert=="string"?o.insert=r.insert.substr(a,n):o.insert=r.insert,o}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?t.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const n=this.ops[this.index];return n?typeof n.delete=="number"?"delete":typeof n.retain=="number"||typeof n.retain=="object"&&n.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const n=this.offset,r=this.index,a=this.next(),s=this.ops.slice(this.index);return this.offset=n,this.index=r,[a].concat(s)}}else return[]}}return jA.default=e,jA}var are;function Jbt(){return are||(are=1,(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const i=Kbt(),n=CRe(),r=RRe(),a=Zbt();e.AttributeMap=a.default;const s=MRe();e.Op=s.default;const o=Xbt();e.OpIterator=o.default;const l="\0",u=(d,p)=>{if(typeof d!="object"||d===null)throw new Error(`cannot retain a ${typeof d}`);if(typeof p!="object"||p===null)throw new Error(`cannot retain a ${typeof p}`);const h=Object.keys(d)[0];if(!h||h!==Object.keys(p)[0])throw new Error(`embed types not matched: ${h} != ${Object.keys(p)[0]}`);return[h,d[h],p[h]]};class c{constructor(p){Array.isArray(p)?this.ops=p:p!=null&&Array.isArray(p.ops)?this.ops=p.ops:this.ops=[]}static registerEmbed(p,h){this.handlers[p]=h}static unregisterEmbed(p){delete this.handlers[p]}static getHandler(p){const h=this.handlers[p];if(!h)throw new Error(`no handlers for embed type "${p}"`);return h}insert(p,h){const f={};return typeof p=="string"&&p.length===0?this:(f.insert=p,h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(f.attributes=h),this.push(f))}delete(p){return p<=0?this:this.push({delete:p})}retain(p,h){if(typeof p=="number"&&p<=0)return this;const f={retain:p};return h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(f.attributes=h),this.push(f)}push(p){let h=this.ops.length,f=this.ops[h-1];if(p=n(p),typeof f=="object"){if(typeof p.delete=="number"&&typeof f.delete=="number")return this.ops[h-1]={delete:f.delete+p.delete},this;if(typeof f.delete=="number"&&p.insert!=null&&(h-=1,f=this.ops[h-1],typeof f!="object"))return this.ops.unshift(p),this;if(r(p.attributes,f.attributes)){if(typeof p.insert=="string"&&typeof f.insert=="string")return this.ops[h-1]={insert:f.insert+p.insert},typeof p.attributes=="object"&&(this.ops[h-1].attributes=p.attributes),this;if(typeof p.retain=="number"&&typeof f.retain=="number")return this.ops[h-1]={retain:f.retain+p.retain},typeof p.attributes=="object"&&(this.ops[h-1].attributes=p.attributes),this}}return h===this.ops.length?this.ops.push(p):this.ops.splice(h,0,p),this}chop(){const p=this.ops[this.ops.length-1];return p&&typeof p.retain=="number"&&!p.attributes&&this.ops.pop(),this}filter(p){return this.ops.filter(p)}forEach(p){this.ops.forEach(p)}map(p){return this.ops.map(p)}partition(p){const h=[],f=[];return this.forEach(m=>{(p(m)?h:f).push(m)}),[h,f]}reduce(p,h){return this.ops.reduce(p,h)}changeLength(){return this.reduce((p,h)=>h.insert?p+s.default.length(h):h.delete?p-h.delete:p,0)}length(){return this.reduce((p,h)=>p+s.default.length(h),0)}slice(p=0,h=1/0){const f=[],m=new o.default(this.ops);let g=0;for(;g<h&&m.hasNext();){let v;g<p?v=m.next(p-g):(v=m.next(h-g),f.push(v)),g+=s.default.length(v)}return new c(f)}compose(p){const h=new o.default(this.ops),f=new o.default(p.ops),m=[],g=f.peek();if(g!=null&&typeof g.retain=="number"&&g.attributes==null){let y=g.retain;for(;h.peekType()==="insert"&&h.peekLength()<=y;)y-=h.peekLength(),m.push(h.next());g.retain-y>0&&f.next(g.retain-y)}const v=new c(m);for(;h.hasNext()||f.hasNext();)if(f.peekType()==="insert")v.push(f.next());else if(h.peekType()==="delete")v.push(h.next());else{const y=Math.min(h.peekLength(),f.peekLength()),b=h.next(y),I=f.next(y);if(I.retain){const S={};if(typeof b.retain=="number")S.retain=typeof I.retain=="number"?y:I.retain;else if(typeof I.retain=="number")b.retain==null?S.insert=b.insert:S.retain=b.retain;else{const T=b.retain==null?"insert":"retain",[U,C,E]=u(b[T],I.retain),P=c.getHandler(U);S[T]={[U]:P.compose(C,E,T==="retain")}}const w=a.default.compose(b.attributes,I.attributes,typeof b.retain=="number");if(w&&(S.attributes=w),v.push(S),!f.hasNext()&&r(v.ops[v.ops.length-1],S)){const T=new c(h.rest());return v.concat(T).chop()}}else typeof I.delete=="number"&&(typeof b.retain=="number"||typeof b.retain=="object"&&b.retain!==null)&&v.push(I)}return v.chop()}concat(p){const h=new c(this.ops.slice());return p.ops.length>0&&(h.push(p.ops[0]),h.ops=h.ops.concat(p.ops.slice(1))),h}diff(p,h){if(this.ops===p.ops)return new c;const f=[this,p].map(b=>b.map(I=>{if(I.insert!=null)return typeof I.insert=="string"?I.insert:l;const S=b===p?"on":"with";throw new Error("diff() called "+S+" non-document")}).join("")),m=new c,g=i(f[0],f[1],h,!0),v=new o.default(this.ops),y=new o.default(p.ops);return g.forEach(b=>{let I=b[1].length;for(;I>0;){let S=0;switch(b[0]){case i.INSERT:S=Math.min(y.peekLength(),I),m.push(y.next(S));break;case i.DELETE:S=Math.min(I,v.peekLength()),v.next(S),m.delete(S);break;case i.EQUAL:S=Math.min(v.peekLength(),y.peekLength(),I);const w=v.next(S),T=y.next(S);r(w.insert,T.insert)?m.retain(S,a.default.diff(w.attributes,T.attributes)):m.push(T).delete(S);break}I-=S}}),m.chop()}eachLine(p,h=`
`){const f=new o.default(this.ops);let m=new c,g=0;for(;f.hasNext();){if(f.peekType()!=="insert")return;const v=f.peek(),y=s.default.length(v)-f.peekLength(),b=typeof v.insert=="string"?v.insert.indexOf(h,y)-y:-1;if(b<0)m.push(f.next());else if(b>0)m.push(f.next(b));else{if(p(m,f.next(1).attributes||{},g)===!1)return;g+=1,m=new c}}m.length()>0&&p(m,{},g)}invert(p){const h=new c;return this.reduce((f,m)=>{if(m.insert)h.delete(s.default.length(m));else{if(typeof m.retain=="number"&&m.attributes==null)return h.retain(m.retain),f+m.retain;if(m.delete||typeof m.retain=="number"){const g=m.delete||m.retain;return p.slice(f,f+g).forEach(y=>{m.delete?h.push(y):m.retain&&m.attributes&&h.retain(s.default.length(y),a.default.invert(m.attributes,y.attributes))}),f+g}else if(typeof m.retain=="object"&&m.retain!==null){const g=p.slice(f,f+1),v=new o.default(g.ops).next(),[y,b,I]=u(m.retain,v.insert),S=c.getHandler(y);return h.retain({[y]:S.invert(b,I)},a.default.invert(m.attributes,v.attributes)),f+1}}return f},0),h.chop()}transform(p,h=!1){if(h=!!h,typeof p=="number")return this.transformPosition(p,h);const f=p,m=new o.default(this.ops),g=new o.default(f.ops),v=new c;for(;m.hasNext()||g.hasNext();)if(m.peekType()==="insert"&&(h||g.peekType()!=="insert"))v.retain(s.default.length(m.next()));else if(g.peekType()==="insert")v.push(g.next());else{const y=Math.min(m.peekLength(),g.peekLength()),b=m.next(y),I=g.next(y);if(b.delete)continue;if(I.delete)v.push(I);else{const S=b.retain,w=I.retain;let T=typeof w=="object"&&w!==null?w:y;if(typeof S=="object"&&S!==null&&typeof w=="object"&&w!==null){const U=Object.keys(S)[0];if(U===Object.keys(w)[0]){const C=c.getHandler(U);C&&(T={[U]:C.transform(S[U],w[U],h)})}}v.retain(T,a.default.transform(b.attributes,I.attributes,h))}}return v.chop()}transformPosition(p,h=!1){h=!!h;const f=new o.default(this.ops);let m=0;for(;f.hasNext()&&m<=p;){const g=f.peekLength(),v=f.peekType();if(f.next(),v==="delete"){p-=Math.min(g,p-m);continue}else v==="insert"&&(m<p||!h)&&(p+=g);m+=g}return p}}c.Op=s.default,c.OpIterator=o.default,c.AttributeMap=a.default,c.handlers={},e.default=c,t.exports=c,t.exports.default=c})($A,$A.exports)),$A.exports}var Tp=Jbt();const Ii=pM(Tp);class Uf extends Jd{static value(){}optimize(){(this.prev||this.next)&&this.remove()}length(){return 0}value(){return""}}Uf.blotName="break";Uf.tagName="BR";let df=class extends dO{};const Qbt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function A2(t){return t.replace(/[&<>"']/g,e=>Qbt[e])}class Fu extends mZ{static allowedChildren=[Fu,Uf,Jd,df];static order=["cursor","inline","link","underline","strike","italic","bold","script","code"];static compare(e,i){const n=Fu.order.indexOf(e),r=Fu.order.indexOf(i);return n>=0||r>=0?n-r:e===i?0:e<i?-1:1}formatAt(e,i,n,r){if(Fu.compare(this.statics.blotName,n)<0&&this.scroll.query(n,Ei.BLOT)){const a=this.isolate(e,i);r&&a.wrap(n,r)}else super.formatAt(e,i,n,r)}optimize(e){if(super.optimize(e),this.parent instanceof Fu&&Fu.compare(this.statics.blotName,this.parent.statics.blotName)>0){const i=this.parent.isolate(this.offset(),this.length());this.moveChildren(i),i.wrap(this)}}}const sre=1;class Cl extends P1{cache={};delta(){return this.cache.delta==null&&(this.cache.delta=NRe(this)),this.cache.delta}deleteAt(e,i){super.deleteAt(e,i),this.cache={}}formatAt(e,i,n,r){i<=0||(this.scroll.query(n,Ei.BLOCK)?e+i===this.length()&&this.format(n,r):super.formatAt(e,Math.min(i,this.length()-e-1),n,r),this.cache={})}insertAt(e,i,n){if(n!=null){super.insertAt(e,i,n),this.cache={};return}if(i.length===0)return;const r=i.split(`
`),a=r.shift();a.length>0&&(e<this.length()-1||this.children.tail==null?super.insertAt(Math.min(e,this.length()-1),a):this.children.tail.insertAt(this.children.tail.length(),a),this.cache={});let s=this;r.reduce((o,l)=>(s=s.split(o,!0),s.insertAt(0,l),l.length),e+a.length)}insertBefore(e,i){const{head:n}=this.children;super.insertBefore(e,i),n instanceof Uf&&n.remove(),this.cache={}}length(){return this.cache.length==null&&(this.cache.length=super.length()+sre),this.cache.length}moveChildren(e,i){super.moveChildren(e,i),this.cache={}}optimize(e){super.optimize(e),this.cache={}}path(e){return super.path(e,!0)}removeChild(e){super.removeChild(e),this.cache={}}split(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(i&&(e===0||e>=this.length()-sre)){const r=this.clone();return e===0?(this.parent.insertBefore(r,this),this):(this.parent.insertBefore(r,this.next),r)}const n=super.split(e,i);return this.cache={},n}}Cl.blotName="block";Cl.tagName="P";Cl.defaultChild=Uf;Cl.allowedChildren=[Uf,Fu,Jd,df];class bp extends Jd{attach(){super.attach(),this.attributes=new M2(this.domNode)}delta(){return new Ii().insert(this.value(),{...this.formats(),...this.attributes.values()})}format(e,i){const n=this.scroll.query(e,Ei.BLOCK_ATTRIBUTE);n!=null&&this.attributes.attribute(n,i)}formatAt(e,i,n,r){this.format(n,r)}insertAt(e,i,n){if(n!=null){super.insertAt(e,i,n);return}const r=i.split(`
`),a=r.pop(),s=r.map(l=>{const u=this.scroll.create(Cl.blotName);return u.insertAt(0,l),u}),o=this.split(e);s.forEach(l=>{this.parent.insertBefore(l,o)}),a&&this.parent.insertBefore(this.scroll.create("text",a),o)}}bp.scope=Ei.BLOCK_BLOT;function NRe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return t.descendants(nu).reduce((i,n)=>n.length()===0?i:i.insert(n.value(),vp(n,{},e)),new Ii).insert(`
`,vp(t))}function vp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return t==null||("formats"in t&&typeof t.formats=="function"&&(e={...e,...t.formats()},i&&delete e["code-token"]),t.parent==null||t.parent.statics.blotName==="scroll"||t.parent.statics.scope!==t.statics.scope)?e:vp(t.parent,e,i)}class Th extends Jd{static blotName="cursor";static className="ql-cursor";static tagName="span";static CONTENTS="\uFEFF";static value(){}constructor(e,i,n){super(e,i),this.selection=n,this.textNode=document.createTextNode(Th.CONTENTS),this.domNode.appendChild(this.textNode),this.savedLength=0}detach(){this.parent!=null&&this.parent.removeChild(this)}format(e,i){if(this.savedLength!==0){super.format(e,i);return}let n=this,r=0;for(;n!=null&&n.statics.scope!==Ei.BLOCK_BLOT;)r+=n.offset(n.parent),n=n.parent;n!=null&&(this.savedLength=Th.CONTENTS.length,n.optimize(),n.formatAt(r,Th.CONTENTS.length,e,i),this.savedLength=0)}index(e,i){return e===this.textNode?0:super.index(e,i)}length(){return this.savedLength}position(){return[this.textNode,this.textNode.data.length]}remove(){super.remove(),this.parent=null}restore(){if(this.selection.composing||this.parent==null)return null;const e=this.selection.getNativeRange();for(;this.domNode.lastChild!=null&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);const i=this.prev instanceof df?this.prev:null,n=i?i.length():0,r=this.next instanceof df?this.next:null,a=r?r.text:"",{textNode:s}=this,o=s.data.split(Th.CONTENTS).join("");s.data=Th.CONTENTS;let l;if(i)l=i,(o||r)&&(i.insertAt(i.length(),o+a),r&&r.remove());else if(r)l=r,r.insertAt(0,o);else{const u=document.createTextNode(o);l=this.scroll.create(u),this.parent.insertBefore(l,this)}if(this.remove(),e){const u=(p,h)=>i&&p===i.domNode?h:p===s?n+h-1:r&&p===r.domNode?n+o.length+h:null,c=u(e.start.node,e.start.offset),d=u(e.end.node,e.end.offset);if(c!==null&&d!==null)return{startNode:l.domNode,startOffset:c,endNode:l.domNode,endOffset:d}}return null}update(e,i){if(e.some(n=>n.type==="characterData"&&n.target===this.textNode)){const n=this.restore();n&&(i.range=n)}}optimize(e){super.optimize(e);let{parent:i}=this;for(;i;){if(i.domNode.tagName==="A"){this.savedLength=Th.CONTENTS.length,i.isolate(this.offset(i),this.length()).unwrap(),this.savedLength=0;break}i=i.parent}}value(){return""}}var kj={exports:{}},ore;function eIt(){return ore||(ore=1,(function(t){var e=Object.prototype.hasOwnProperty,i="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(i=!1));function r(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function a(l,u,c,d,p){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new r(c,d||l,p),f=i?i+u:u;return l._events[f]?l._events[f].fn?l._events[f]=[l._events[f],h]:l._events[f].push(h):(l._events[f]=h,l._eventsCount++),l}function s(l,u){--l._eventsCount===0?l._events=new n:delete l._events[u]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(i?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=i?i+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var p=0,h=d.length,f=new Array(h);p<h;p++)f[p]=d[p].fn;return f},o.prototype.listenerCount=function(u){var c=i?i+u:u,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,c,d,p,h,f){var m=i?i+u:u;if(!this._events[m])return!1;var g=this._events[m],v=arguments.length,y,b;if(g.fn){switch(g.once&&this.removeListener(u,g.fn,void 0,!0),v){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,d),!0;case 4:return g.fn.call(g.context,c,d,p),!0;case 5:return g.fn.call(g.context,c,d,p,h),!0;case 6:return g.fn.call(g.context,c,d,p,h,f),!0}for(b=1,y=new Array(v-1);b<v;b++)y[b-1]=arguments[b];g.fn.apply(g.context,y)}else{var I=g.length,S;for(b=0;b<I;b++)switch(g[b].once&&this.removeListener(u,g[b].fn,void 0,!0),v){case 1:g[b].fn.call(g[b].context);break;case 2:g[b].fn.call(g[b].context,c);break;case 3:g[b].fn.call(g[b].context,c,d);break;case 4:g[b].fn.call(g[b].context,c,d,p);break;default:if(!y)for(S=1,y=new Array(v-1);S<v;S++)y[S-1]=arguments[S];g[b].fn.apply(g[b].context,y)}}return!0},o.prototype.on=function(u,c,d){return a(this,u,c,d,!1)},o.prototype.once=function(u,c,d){return a(this,u,c,d,!0)},o.prototype.removeListener=function(u,c,d,p){var h=i?i+u:u;if(!this._events[h])return this;if(!c)return s(this,h),this;var f=this._events[h];if(f.fn)f.fn===c&&(!p||f.once)&&(!d||f.context===d)&&s(this,h);else{for(var m=0,g=[],v=f.length;m<v;m++)(f[m].fn!==c||p&&!f[m].once||d&&f[m].context!==d)&&g.push(f[m]);g.length?this._events[h]=g.length===1?g[0]:g:s(this,h)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=i?i+u:u,this._events[c]&&s(this,c)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,t.exports=o})(kj)),kj.exports}var tIt=eIt();const iIt=pM(tIt),tq=new WeakMap,iq=["error","warn","log","info"];let nq="warn";function ARe(t){if(nq&&iq.indexOf(t)<=iq.indexOf(nq)){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];console[t](...i)}}function Hv(t){return iq.reduce((e,i)=>(e[i]=ARe.bind(console,i,t),e),{})}Hv.level=t=>{nq=t};ARe.level=Hv.level;const xj=Hv("quill:events"),nIt=["selectionchange","mousedown","mouseup","click"];nIt.forEach(t=>{document.addEventListener(t,function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];Array.from(document.querySelectorAll(".ql-container")).forEach(r=>{const a=tq.get(r);a&&a.emitter&&a.emitter.handleDOM(...i)})})});class vi extends iIt{static events={EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_BLOT_MOUNT:"scroll-blot-mount",SCROLL_BLOT_UNMOUNT:"scroll-blot-unmount",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SCROLL_EMBED_UPDATE:"scroll-embed-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change",COMPOSITION_BEFORE_START:"composition-before-start",COMPOSITION_START:"composition-start",COMPOSITION_BEFORE_END:"composition-before-end",COMPOSITION_END:"composition-end"};static sources={API:"api",SILENT:"silent",USER:"user"};constructor(){super(),this.domListeners={},this.on("error",xj.error)}emit(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return xj.log.call(xj,...i),super.emit(...i)}handleDOM(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];(this.domListeners[e.type]||[]).forEach(a=>{let{node:s,handler:o}=a;(e.target===s||s.contains(e.target))&&o(e,...n)})}listenDOM(e,i,n){this.domListeners[e]||(this.domListeners[e]=[]),this.domListeners[e].push({node:i,handler:n})}}const Oj=Hv("quill:selection");class Lw{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.index=e,this.length=i}}class rIt{constructor(e,i){this.emitter=i,this.scroll=e,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=this.scroll.create("cursor",this),this.savedRange=new Lw(0,0),this.lastRange=this.savedRange,this.lastNative=null,this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,()=>{!this.mouseDown&&!this.composing&&setTimeout(this.update.bind(this,vi.sources.USER),1)}),this.emitter.on(vi.events.SCROLL_BEFORE_UPDATE,()=>{if(!this.hasFocus())return;const n=this.getNativeRange();n!=null&&n.start.node!==this.cursor.textNode&&this.emitter.once(vi.events.SCROLL_UPDATE,(r,a)=>{try{this.root.contains(n.start.node)&&this.root.contains(n.end.node)&&this.setNativeRange(n.start.node,n.start.offset,n.end.node,n.end.offset);const s=a.some(o=>o.type==="characterData"||o.type==="childList"||o.type==="attributes"&&o.target===this.root);this.update(s?vi.sources.SILENT:r)}catch{}})}),this.emitter.on(vi.events.SCROLL_OPTIMIZE,(n,r)=>{if(r.range){const{startNode:a,startOffset:s,endNode:o,endOffset:l}=r.range;this.setNativeRange(a,s,o,l),this.update(vi.sources.SILENT)}}),this.update(vi.sources.SILENT)}handleComposition(){this.emitter.on(vi.events.COMPOSITION_BEFORE_START,()=>{this.composing=!0}),this.emitter.on(vi.events.COMPOSITION_END,()=>{if(this.composing=!1,this.cursor.parent){const e=this.cursor.restore();if(!e)return;setTimeout(()=>{this.setNativeRange(e.startNode,e.startOffset,e.endNode,e.endOffset)},1)}})}handleDragging(){this.emitter.listenDOM("mousedown",document.body,()=>{this.mouseDown=!0}),this.emitter.listenDOM("mouseup",document.body,()=>{this.mouseDown=!1,this.update(vi.sources.USER)})}focus(){this.hasFocus()||(this.root.focus({preventScroll:!0}),this.setRange(this.savedRange))}format(e,i){this.scroll.update();const n=this.getNativeRange();if(!(n==null||!n.native.collapsed||this.scroll.query(e,Ei.BLOCK))){if(n.start.node!==this.cursor.textNode){const r=this.scroll.find(n.start.node,!1);if(r==null)return;if(r instanceof nu){const a=r.split(n.start.offset);r.parent.insertBefore(this.cursor,a)}else r.insertBefore(this.cursor,n.start.node);this.cursor.attach()}this.cursor.format(e,i),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}getBounds(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=this.scroll.length();e=Math.min(e,n-1),i=Math.min(e+i,n-1)-e;let r,[a,s]=this.scroll.leaf(e);if(a==null)return null;if(i>0&&s===a.length()){const[c]=this.scroll.leaf(e+1);if(c){const[d]=this.scroll.line(e),[p]=this.scroll.line(e+1);d===p&&(a=c,s=0)}}[r,s]=a.position(s,!0);const o=document.createRange();if(i>0)return o.setStart(r,s),[a,s]=this.scroll.leaf(e+i),a==null?null:([r,s]=a.position(s,!0),o.setEnd(r,s),o.getBoundingClientRect());let l="left",u;if(r instanceof Text){if(!r.data.length)return null;s<r.data.length?(o.setStart(r,s),o.setEnd(r,s+1)):(o.setStart(r,s-1),o.setEnd(r,s),l="right"),u=o.getBoundingClientRect()}else{if(!(a.domNode instanceof Element))return null;u=a.domNode.getBoundingClientRect(),s>0&&(l="right")}return{bottom:u.top+u.height,height:u.height,left:u[l],right:u[l],top:u.top,width:0}}getNativeRange(){const e=document.getSelection();if(e==null||e.rangeCount<=0)return null;const i=e.getRangeAt(0);if(i==null)return null;const n=this.normalizeNative(i);return Oj.info("getNativeRange",n),n}getRange(){const e=this.scroll.domNode;if("isConnected"in e&&!e.isConnected)return[null,null];const i=this.getNativeRange();return i==null?[null,null]:[this.normalizedToRange(i),i]}hasFocus(){return document.activeElement===this.root||document.activeElement!=null&&Lj(this.root,document.activeElement)}normalizedToRange(e){const i=[[e.start.node,e.start.offset]];e.native.collapsed||i.push([e.end.node,e.end.offset]);const n=i.map(s=>{const[o,l]=s,u=this.scroll.find(o,!0),c=u.offset(this.scroll);return l===0?c:u instanceof nu?c+u.index(o,l):c+u.length()}),r=Math.min(Math.max(...n),this.scroll.length()-1),a=Math.min(r,...n);return new Lw(a,r-a)}normalizeNative(e){if(!Lj(this.root,e.startContainer)||!e.collapsed&&!Lj(this.root,e.endContainer))return null;const i={start:{node:e.startContainer,offset:e.startOffset},end:{node:e.endContainer,offset:e.endOffset},native:e};return[i.start,i.end].forEach(n=>{let{node:r,offset:a}=n;for(;!(r instanceof Text)&&r.childNodes.length>0;)if(r.childNodes.length>a)r=r.childNodes[a],a=0;else if(r.childNodes.length===a)r=r.lastChild,r instanceof Text?a=r.data.length:r.childNodes.length>0?a=r.childNodes.length:a=r.childNodes.length+1;else break;n.node=r,n.offset=a}),i}rangeToNative(e){const i=this.scroll.length(),n=(r,a)=>{r=Math.min(i-1,r);const[s,o]=this.scroll.leaf(r);return s?s.position(o,a):[null,-1]};return[...n(e.index,!1),...n(e.index+e.length,!0)]}setNativeRange(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:i,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(Oj.info("setNativeRange",e,i,n,r),e!=null&&(this.root.parentNode==null||e.parentNode==null||n.parentNode==null))return;const s=document.getSelection();if(s!=null)if(e!=null){this.hasFocus()||this.root.focus({preventScroll:!0});const{native:o}=this.getNativeRange()||{};if(o==null||a||e!==o.startContainer||i!==o.startOffset||n!==o.endContainer||r!==o.endOffset){e instanceof Element&&e.tagName==="BR"&&(i=Array.from(e.parentNode.childNodes).indexOf(e),e=e.parentNode),n instanceof Element&&n.tagName==="BR"&&(r=Array.from(n.parentNode.childNodes).indexOf(n),n=n.parentNode);const l=document.createRange();l.setStart(e,i),l.setEnd(n,r),s.removeAllRanges(),s.addRange(l)}}else s.removeAllRanges(),this.root.blur()}setRange(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vi.sources.API;if(typeof i=="string"&&(n=i,i=!1),Oj.info("setRange",e),e!=null){const r=this.rangeToNative(e);this.setNativeRange(...r,i)}else this.setNativeRange(null);this.update(n)}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:vi.sources.USER;const i=this.lastRange,[n,r]=this.getRange();if(this.lastRange=n,this.lastNative=r,this.lastRange!=null&&(this.savedRange=this.lastRange),!fZ(i,this.lastRange)){if(!this.composing&&r!=null&&r.native.collapsed&&r.start.node!==this.cursor.textNode){const s=this.cursor.restore();s&&this.setNativeRange(s.startNode,s.startOffset,s.endNode,s.endOffset)}const a=[vi.events.SELECTION_CHANGE,wT(this.lastRange),wT(i),e];this.emitter.emit(vi.events.EDITOR_CHANGE,...a),e!==vi.sources.SILENT&&this.emitter.emit(...a)}}}function Lj(t,e){try{e.parentNode}catch{return!1}return t.contains(e)}const aIt=/^[ -~]*$/;class sIt{constructor(e){this.scroll=e,this.delta=this.getDelta()}applyDelta(e){this.scroll.update();let i=this.scroll.length();this.scroll.batchStart();const n=lre(e),r=new Ii;return lIt(n.ops.slice()).reduce((s,o)=>{const l=Tp.Op.length(o);let u=o.attributes||{},c=!1,d=!1;if(o.insert!=null){if(r.retain(l),typeof o.insert=="string"){const f=o.insert;d=!f.endsWith(`
`)&&(i<=s||!!this.scroll.descendant(bp,s)[0]),this.scroll.insertAt(s,f);const[m,g]=this.scroll.line(s);let v=_y({},vp(m));if(m instanceof Cl){const[y]=m.descendant(nu,g);y&&(v=_y(v,vp(y)))}u=Tp.AttributeMap.diff(v,u)||{}}else if(typeof o.insert=="object"){const f=Object.keys(o.insert)[0];if(f==null)return s;const m=this.scroll.query(f,Ei.INLINE)!=null;if(m)(i<=s||this.scroll.descendant(bp,s)[0])&&(d=!0);else if(s>0){const[g,v]=this.scroll.descendant(nu,s-1);g instanceof df?g.value()[v]!==`
`&&(c=!0):g instanceof Jd&&g.statics.scope===Ei.INLINE_BLOT&&(c=!0)}if(this.scroll.insertAt(s,f,o.insert[f]),m){const[g]=this.scroll.descendant(nu,s);if(g){const v=_y({},vp(g));u=Tp.AttributeMap.diff(v,u)||{}}}}i+=l}else if(r.push(o),o.retain!==null&&typeof o.retain=="object"){const f=Object.keys(o.retain)[0];if(f==null)return s;this.scroll.updateEmbedAt(s,f,o.retain[f])}Object.keys(u).forEach(f=>{this.scroll.formatAt(s,l,f,u[f])});const p=c?1:0,h=d?1:0;return i+=p+h,r.retain(p),r.delete(h),s+l+p+h},0),r.reduce((s,o)=>typeof o.delete=="number"?(this.scroll.deleteAt(s,o.delete),s):s+Tp.Op.length(o),0),this.scroll.batchEnd(),this.scroll.optimize(),this.update(n)}deleteText(e,i){return this.scroll.deleteAt(e,i),this.update(new Ii().retain(e).delete(i))}formatLine(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.scroll.update(),Object.keys(n).forEach(a=>{this.scroll.lines(e,Math.max(i,1)).forEach(s=>{s.format(a,n[a])})}),this.scroll.optimize();const r=new Ii().retain(e).retain(i,wT(n));return this.update(r)}formatText(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.keys(n).forEach(a=>{this.scroll.formatAt(e,i,a,n[a])});const r=new Ii().retain(e).retain(i,wT(n));return this.update(r)}getContents(e,i){return this.delta.slice(e,e+i)}getDelta(){return this.scroll.lines().reduce((e,i)=>e.concat(i.delta()),new Ii)}getFormat(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=[],r=[];i===0?this.scroll.path(e).forEach(o=>{const[l]=o;l instanceof Cl?n.push(l):l instanceof nu&&r.push(l)}):(n=this.scroll.lines(e,i),r=this.scroll.descendants(nu,e,i));const[a,s]=[n,r].map(o=>{const l=o.shift();if(l==null)return{};let u=vp(l);for(;Object.keys(u).length>0;){const c=o.shift();if(c==null)return u;u=oIt(vp(c),u)}return u});return{...a,...s}}getHTML(e,i){const[n,r]=this.scroll.line(e);if(n){const a=n.length();return n.length()>=r+i&&!(r===0&&i===a)?C1(n,r,i,!0):C1(this.scroll,e,i,!0)}return""}getText(e,i){return this.getContents(e,i).filter(n=>typeof n.insert=="string").map(n=>n.insert).join("")}insertContents(e,i){const n=lre(i),r=new Ii().retain(e).concat(n);return this.scroll.insertContents(e,n),this.update(r)}insertEmbed(e,i,n){return this.scroll.insertAt(e,i,n),this.update(new Ii().retain(e).insert({[i]:n}))}insertText(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return i=i.replace(/\r\n/g,`
`).replace(/\r/g,`
`),this.scroll.insertAt(e,i),Object.keys(n).forEach(r=>{this.scroll.formatAt(e,i.length,r,n[r])}),this.update(new Ii().retain(e).insert(i,wT(n)))}isBlank(){if(this.scroll.children.length===0)return!0;if(this.scroll.children.length>1)return!1;const e=this.scroll.children.head;if(e?.statics.blotName!==Cl.blotName)return!1;const i=e;return i.children.length>1?!1:i.children.head instanceof Uf}removeFormat(e,i){const n=this.getText(e,i),[r,a]=this.scroll.line(e+i);let s=0,o=new Ii;r!=null&&(s=r.length()-a,o=r.delta().slice(a,a+s-1).insert(`
`));const u=this.getContents(e,i+s).diff(new Ii().insert(n).concat(o)),c=new Ii().retain(e).concat(u);return this.applyDelta(c)}update(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;const r=this.delta;if(i.length===1&&i[0].type==="characterData"&&i[0].target.data.match(aIt)&&this.scroll.find(i[0].target)){const a=this.scroll.find(i[0].target),s=vp(a),o=a.offset(this.scroll),l=i[0].oldValue.replace(Th.CONTENTS,""),u=new Ii().insert(l),c=new Ii().insert(a.value()),d=n&&{oldRange:ure(n.oldRange,-o),newRange:ure(n.newRange,-o)};e=new Ii().retain(o).concat(u.diff(c,d)).reduce((h,f)=>f.insert?h.insert(f.insert,s):h.push(f),new Ii),this.delta=r.compose(e)}else this.delta=this.getDelta(),(!e||!fZ(r.compose(e),this.delta))&&(e=r.diff(this.delta,n));return e}}function KS(t,e,i){if(t.length===0){const[h]=Fj(i.pop());return e<=0?`</li></${h}>`:`</li></${h}>${KS([],e-1,i)}`}const[{child:n,offset:r,length:a,indent:s,type:o},...l]=t,[u,c]=Fj(o);if(s>e)return i.push(o),s===e+1?`<${u}><li${c}>${C1(n,r,a)}${KS(l,s,i)}`:`<${u}><li>${KS(t,e+1,i)}`;const d=i[i.length-1];if(s===e&&o===d)return`</li><li${c}>${C1(n,r,a)}${KS(l,s,i)}`;const[p]=Fj(i.pop());return`</li></${p}>${KS(t,e-1,i)}`}function C1(t,e,i){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if("html"in t&&typeof t.html=="function")return t.html(e,i);if(t instanceof df)return A2(t.value().slice(e,e+i)).replaceAll(" ","&nbsp;");if(t instanceof Gh){if(t.statics.blotName==="list-container"){const u=[];return t.children.forEachAt(e,i,(c,d,p)=>{const h="formats"in c&&typeof c.formats=="function"?c.formats():{};u.push({child:c,offset:d,length:p,indent:h.indent||0,type:h.list})}),KS(u,-1,[])}const r=[];if(t.children.forEachAt(e,i,(u,c,d)=>{r.push(C1(u,c,d))}),n||t.statics.blotName==="list")return r.join("");const{outerHTML:a,innerHTML:s}=t.domNode,[o,l]=a.split(`>${s}<`);return o==="<table"?`<table style="border: 1px solid #000;">${r.join("")}<${l}`:`${o}>${r.join("")}<${l}`}return t.domNode instanceof Element?t.domNode.outerHTML:""}function oIt(t,e){return Object.keys(e).reduce((i,n)=>{if(t[n]==null)return i;const r=e[n];return r===t[n]?i[n]=r:Array.isArray(r)?r.indexOf(t[n])<0?i[n]=r.concat([t[n]]):i[n]=r:i[n]=[r,t[n]],i},{})}function Fj(t){const e=t==="ordered"?"ol":"ul";switch(t){case"checked":return[e,' data-list="checked"'];case"unchecked":return[e,' data-list="unchecked"'];default:return[e,""]}}function lre(t){return t.reduce((e,i)=>{if(typeof i.insert=="string"){const n=i.insert.replace(/\r\n/g,`
`).replace(/\r/g,`
`);return e.insert(n,i.attributes)}return e.push(i)},new Ii)}function ure(t,e){let{index:i,length:n}=t;return new Lw(i+e,n)}function lIt(t){const e=[];return t.forEach(i=>{typeof i.insert=="string"?i.insert.split(`
`).forEach((r,a)=>{a&&e.push({insert:`
`,attributes:i.attributes}),r&&e.push({insert:r,attributes:i.attributes})}):e.push(i)}),e}class sg{static DEFAULTS={};constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.quill=e,this.options=i}}const GA="\uFEFF";class vZ extends Jd{constructor(e,i){super(e,i),this.contentNode=document.createElement("span"),this.contentNode.setAttribute("contenteditable","false"),Array.from(this.domNode.childNodes).forEach(n=>{this.contentNode.appendChild(n)}),this.leftGuard=document.createTextNode(GA),this.rightGuard=document.createTextNode(GA),this.domNode.appendChild(this.leftGuard),this.domNode.appendChild(this.contentNode),this.domNode.appendChild(this.rightGuard)}index(e,i){return e===this.leftGuard?0:e===this.rightGuard?1:super.index(e,i)}restore(e){let i=null,n;const r=e.data.split(GA).join("");if(e===this.leftGuard)if(this.prev instanceof df){const a=this.prev.length();this.prev.insertAt(a,r),i={startNode:this.prev.domNode,startOffset:a+r.length}}else n=document.createTextNode(r),this.parent.insertBefore(this.scroll.create(n),this),i={startNode:n,startOffset:r.length};else e===this.rightGuard&&(this.next instanceof df?(this.next.insertAt(0,r),i={startNode:this.next.domNode,startOffset:r.length}):(n=document.createTextNode(r),this.parent.insertBefore(this.scroll.create(n),this.next),i={startNode:n,startOffset:r.length}));return e.data=GA,i}update(e,i){e.forEach(n=>{if(n.type==="characterData"&&(n.target===this.leftGuard||n.target===this.rightGuard)){const r=this.restore(n.target);r&&(i.range=r)}})}}class uIt{isComposing=!1;constructor(e,i){this.scroll=e,this.emitter=i,this.setupListeners()}setupListeners(){this.scroll.domNode.addEventListener("compositionstart",e=>{this.isComposing||this.handleCompositionStart(e)}),this.scroll.domNode.addEventListener("compositionend",e=>{this.isComposing&&queueMicrotask(()=>{this.handleCompositionEnd(e)})})}handleCompositionStart(e){const i=e.target instanceof Node?this.scroll.find(e.target,!0):null;i&&!(i instanceof vZ)&&(this.emitter.emit(vi.events.COMPOSITION_BEFORE_START,e),this.scroll.batchStart(),this.emitter.emit(vi.events.COMPOSITION_START,e),this.isComposing=!0)}handleCompositionEnd(e){this.emitter.emit(vi.events.COMPOSITION_BEFORE_END,e),this.scroll.batchEnd(),this.emitter.emit(vi.events.COMPOSITION_END,e),this.isComposing=!1}}class dE{static DEFAULTS={modules:{}};static themes={default:dE};modules={};constructor(e,i){this.quill=e,this.options=i}init(){Object.keys(this.options.modules).forEach(e=>{this.modules[e]==null&&this.addModule(e)})}addModule(e){const i=this.quill.constructor.import(`modules/${e}`);return this.modules[e]=new i(this.quill,this.options.modules[e]||{}),this.modules[e]}}const cIt=t=>t.parentElement||t.getRootNode().host||null,dIt=t=>{const e=t.getBoundingClientRect(),i="offsetWidth"in t&&Math.abs(e.width)/t.offsetWidth||1,n="offsetHeight"in t&&Math.abs(e.height)/t.offsetHeight||1;return{top:e.top,right:e.left+t.clientWidth*i,bottom:e.top+t.clientHeight*n,left:e.left}},HA=t=>{const e=parseInt(t,10);return Number.isNaN(e)?0:e},cre=(t,e,i,n,r,a)=>t<i&&e>n?0:t<i?-(i-t+r):e>n?e-t>n-i?t+r-i:e-n+a:0,pIt=(t,e)=>{const i=t.ownerDocument;let n=e,r=t;for(;r;){const a=r===i.body,s=a?{top:0,right:window.visualViewport?.width??i.documentElement.clientWidth,bottom:window.visualViewport?.height??i.documentElement.clientHeight,left:0}:dIt(r),o=getComputedStyle(r),l=cre(n.left,n.right,s.left,s.right,HA(o.scrollPaddingLeft),HA(o.scrollPaddingRight)),u=cre(n.top,n.bottom,s.top,s.bottom,HA(o.scrollPaddingTop),HA(o.scrollPaddingBottom));if(l||u)if(a)i.defaultView?.scrollBy(l,u);else{const{scrollLeft:c,scrollTop:d}=r;u&&(r.scrollTop+=u),l&&(r.scrollLeft+=l);const p=r.scrollLeft-c,h=r.scrollTop-d;n={left:n.left-p,top:n.top-h,right:n.right-p,bottom:n.bottom-h}}r=a||o.position==="fixed"?null:cIt(r)}},hIt=100,fIt=["block","break","cursor","inline","scroll","text"],mIt=(t,e,i)=>{const n=new kU;return fIt.forEach(r=>{const a=e.query(r);a&&n.register(a)}),t.forEach(r=>{let a=e.query(r);a||i.error(`Cannot register "${r}" specified in "formats" config. Are you sure it was registered?`);let s=0;for(;a;)if(n.register(a),a="blotName"in a?a.requiredContainer??null:null,s+=1,s>hIt){i.error(`Cycle detected in registering blot requiredContainer: "${r}"`);break}}),n},TT=Hv("quill"),zA=new kU;Gh.uiClass="ql-ui";class vt{static DEFAULTS={bounds:null,modules:{clipboard:!0,keyboard:!0,history:!0,uploader:!0},placeholder:"",readOnly:!1,registry:zA,theme:"default"};static events=vi.events;static sources=vi.sources;static version="2.0.3";static imports={delta:Ii,parchment:Ybt,"core/module":sg,"core/theme":dE};static debug(e){e===!0&&(e="log"),Hv.level(e)}static find(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return tq.get(e)||zA.find(e,i)}static import(e){return this.imports[e]==null&&TT.error(`Cannot import ${e}. Are you sure it was registered?`),this.imports[e]}static register(){if(typeof(arguments.length<=0?void 0:arguments[0])!="string"){const e=arguments.length<=0?void 0:arguments[0],i=!!(!(arguments.length<=1)&&arguments[1]),n="attrName"in e?e.attrName:e.blotName;typeof n=="string"?this.register(`formats/${n}`,e,i):Object.keys(e).forEach(r=>{this.register(r,e[r],i)})}else{const e=arguments.length<=0?void 0:arguments[0],i=arguments.length<=1?void 0:arguments[1],n=!!(!(arguments.length<=2)&&arguments[2]);this.imports[e]!=null&&!n&&TT.warn(`Overwriting ${e} with`,i),this.imports[e]=i,(e.startsWith("blots/")||e.startsWith("formats/"))&&i&&typeof i!="boolean"&&i.blotName!=="abstract"&&zA.register(i),typeof i.register=="function"&&i.register(zA)}}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.options=gIt(e,i),this.container=this.options.container,this.container==null){TT.error("Invalid Quill container",e);return}this.options.debug&&vt.debug(this.options.debug);const n=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",tq.set(this.container,this),this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.emitter=new vi;const r=gZ.blotName,a=this.options.registry.query(r);if(!a||!("blotName"in a))throw new Error(`Cannot initialize Quill without "${r}" blot`);if(this.scroll=new a(this.options.registry,this.root,{emitter:this.emitter}),this.editor=new sIt(this.scroll),this.selection=new rIt(this.scroll,this.emitter),this.composition=new uIt(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.uploader=this.theme.addModule("uploader"),this.theme.addModule("input"),this.theme.addModule("uiNode"),this.theme.init(),this.emitter.on(vi.events.EDITOR_CHANGE,s=>{s===vi.events.TEXT_CHANGE&&this.root.classList.toggle("ql-blank",this.editor.isBlank())}),this.emitter.on(vi.events.SCROLL_UPDATE,(s,o)=>{const l=this.selection.lastRange,[u]=this.selection.getRange(),c=l&&u?{oldRange:l,newRange:u}:void 0;mh.call(this,()=>this.editor.update(null,o,c),s)}),this.emitter.on(vi.events.SCROLL_EMBED_UPDATE,(s,o)=>{const l=this.selection.lastRange,[u]=this.selection.getRange(),c=l&&u?{oldRange:l,newRange:u}:void 0;mh.call(this,()=>{const d=new Ii().retain(s.offset(this)).retain({[s.statics.blotName]:o});return this.editor.update(d,[],c)},vt.sources.USER)}),n){const s=this.clipboard.convert({html:`${n}<p><br></p>`,text:`
`});this.setContents(s)}this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable(),this.allowReadOnlyEdits=!1}addContainer(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof e=="string"){const n=e;e=document.createElement("div"),e.classList.add(n)}return this.container.insertBefore(e,i),e}blur(){this.selection.setRange(null)}deleteText(e,i,n){return[e,i,,n]=Sg(e,i,n),mh.call(this,()=>this.editor.deleteText(e,i),n,e,-1*i)}disable(){this.enable(!1)}editReadOnly(e){this.allowReadOnlyEdits=!0;const i=e();return this.allowReadOnlyEdits=!1,i}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.scroll.enable(e),this.container.classList.toggle("ql-disabled",!e)}focus(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.selection.focus(),e.preventScroll||this.scrollSelectionIntoView()}format(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vi.sources.API;return mh.call(this,()=>{const r=this.getSelection(!0);let a=new Ii;if(r==null)return a;if(this.scroll.query(e,Ei.BLOCK))a=this.editor.formatLine(r.index,r.length,{[e]:i});else{if(r.length===0)return this.selection.format(e,i),a;a=this.editor.formatText(r.index,r.length,{[e]:i})}return this.setSelection(r,vi.sources.SILENT),a},n)}formatLine(e,i,n,r,a){let s;return[e,i,s,a]=Sg(e,i,n,r,a),mh.call(this,()=>this.editor.formatLine(e,i,s),a,e,0)}formatText(e,i,n,r,a){let s;return[e,i,s,a]=Sg(e,i,n,r,a),mh.call(this,()=>this.editor.formatText(e,i,s),a,e,0)}getBounds(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=null;if(typeof e=="number"?n=this.selection.getBounds(e,i):n=this.selection.getBounds(e.index,e.length),!n)return null;const r=this.container.getBoundingClientRect();return{bottom:n.bottom-r.top,height:n.height,left:n.left-r.left,right:n.right-r.left,top:n.top-r.top,width:n.width}}getContents(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-e;return[e,i]=Sg(e,i),this.editor.getContents(e,i)}getFormat(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.getSelection(!0),i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return typeof e=="number"?this.editor.getFormat(e,i):this.editor.getFormat(e.index,e.length)}getIndex(e){return e.offset(this.scroll)}getLength(){return this.scroll.length()}getLeaf(e){return this.scroll.leaf(e)}getLine(e){return this.scroll.line(e)}getLines(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;return typeof e!="number"?this.scroll.lines(e.index,e.length):this.scroll.lines(e,i)}getModule(e){return this.theme.modules[e]}getSelection(){return arguments.length>0&&arguments[0]!==void 0&&arguments[0]&&this.focus(),this.update(),this.selection.getRange()[0]}getSemanticHTML(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;return typeof e=="number"&&(i=i??this.getLength()-e),[e,i]=Sg(e,i),this.editor.getHTML(e,i)}getText(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;return typeof e=="number"&&(i=i??this.getLength()-e),[e,i]=Sg(e,i),this.editor.getText(e,i)}hasFocus(){return this.selection.hasFocus()}insertEmbed(e,i,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:vt.sources.API;return mh.call(this,()=>this.editor.insertEmbed(e,i,n),r,e)}insertText(e,i,n,r,a){let s;return[e,,s,a]=Sg(e,0,n,r,a),mh.call(this,()=>this.editor.insertText(e,i,s),a,e,i.length)}isEnabled(){return this.scroll.isEnabled()}off(){return this.emitter.off(...arguments)}on(){return this.emitter.on(...arguments)}once(){return this.emitter.once(...arguments)}removeFormat(e,i,n){return[e,i,,n]=Sg(e,i,n),mh.call(this,()=>this.editor.removeFormat(e,i),n,e)}scrollRectIntoView(e){pIt(this.root,e)}scrollIntoView(){console.warn("Quill#scrollIntoView() has been deprecated and will be removed in the near future. Please use Quill#scrollSelectionIntoView() instead."),this.scrollSelectionIntoView()}scrollSelectionIntoView(){const e=this.selection.lastRange,i=e&&this.selection.getBounds(e.index,e.length);i&&this.scrollRectIntoView(i)}setContents(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vi.sources.API;return mh.call(this,()=>{e=new Ii(e);const n=this.getLength(),r=this.editor.deleteText(0,n),a=this.editor.insertContents(0,e),s=this.editor.deleteText(this.getLength()-1,1);return r.compose(a).compose(s)},i)}setSelection(e,i,n){e==null?this.selection.setRange(null,i||vt.sources.API):([e,i,,n]=Sg(e,i,n),this.selection.setRange(new Lw(Math.max(0,e),i),n),n!==vi.sources.SILENT&&this.scrollSelectionIntoView())}setText(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vi.sources.API;const n=new Ii().insert(e);return this.setContents(n,i)}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:vi.sources.USER;const i=this.scroll.update(e);return this.selection.update(e),i}updateContents(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vi.sources.API;return mh.call(this,()=>(e=new Ii(e),this.editor.applyDelta(e)),i,!0)}}function dre(t){return typeof t=="string"?document.querySelector(t):t}function $j(t){return Object.entries(t??{}).reduce((e,i)=>{let[n,r]=i;return{...e,[n]:r===!0?{}:r}},{})}function pre(t){return Object.fromEntries(Object.entries(t).filter(e=>e[1]!==void 0))}function gIt(t,e){const i=dre(t);if(!i)throw new Error("Invalid Quill container");const r=!e.theme||e.theme===vt.DEFAULTS.theme?dE:vt.import(`themes/${e.theme}`);if(!r)throw new Error(`Invalid theme ${e.theme}. Did you register it?`);const{modules:a,...s}=vt.DEFAULTS,{modules:o,...l}=r.DEFAULTS;let u=$j(e.modules);u!=null&&u.toolbar&&u.toolbar.constructor!==Object&&(u={...u,toolbar:{container:u.toolbar}});const c=_y({},$j(a),$j(o),u),d={...s,...pre(l),...pre(e)};let p=e.registry;return p?e.formats&&TT.warn('Ignoring "formats" option because "registry" is specified'):p=e.formats?mIt(e.formats,d.registry,TT):d.registry,{...d,registry:p,container:i,theme:r,modules:Object.entries(c).reduce((h,f)=>{let[m,g]=f;if(!g)return h;const v=vt.import(`modules/${m}`);return v==null?(TT.error(`Cannot load ${m} module. Are you sure you registered it?`),h):{...h,[m]:_y({},v.DEFAULTS||{},g)}},{}),bounds:dre(d.bounds)}}function mh(t,e,i,n){if(!this.isEnabled()&&e===vi.sources.USER&&!this.allowReadOnlyEdits)return new Ii;let r=i==null?null:this.getSelection();const a=this.editor.delta,s=t();if(r!=null&&(i===!0&&(i=r.index),n==null?r=hre(r,s,e):n!==0&&(r=hre(r,i,n,e)),this.setSelection(r,vi.sources.SILENT)),s.length()>0){const o=[vi.events.TEXT_CHANGE,s,a,e];this.emitter.emit(vi.events.EDITOR_CHANGE,...o),e!==vi.sources.SILENT&&this.emitter.emit(...o)}return s}function Sg(t,e,i,n,r){let a={};return typeof t.index=="number"&&typeof t.length=="number"?typeof e!="number"?(r=n,n=i,i=e,e=t.length,t=t.index):(e=t.length,t=t.index):typeof e!="number"&&(r=n,n=i,i=e,e=0),typeof i=="object"?(a=i,r=n):typeof i=="string"&&(n!=null?a[i]=n:r=i),r=r||vi.sources.API,[t,e,a,r]}function hre(t,e,i,n){const r=typeof i=="number"?i:0;if(t==null)return null;let a,s;return e&&typeof e.transformPosition=="function"?[a,s]=[t.index,t.index+t.length].map(o=>e.transformPosition(o,n!==vi.sources.USER)):[a,s]=[t.index,t.index+t.length].map(o=>o<e||o===e&&n===vi.sources.USER?o:r>=0?o+r:Math.max(e,o+r)),new Lw(a,s-a)}class aS extends N2{}function fre(t){return t instanceof Cl||t instanceof bp}function mre(t){return typeof t.updateContent=="function"}class vIt extends gZ{static blotName="scroll";static className="ql-editor";static tagName="DIV";static defaultChild=Cl;static allowedChildren=[Cl,bp,aS];constructor(e,i,n){let{emitter:r}=n;super(e,i),this.emitter=r,this.batch=!1,this.optimize(),this.enable(),this.domNode.addEventListener("dragstart",a=>this.handleDragStart(a))}batchStart(){Array.isArray(this.batch)||(this.batch=[])}batchEnd(){if(!this.batch)return;const e=this.batch;this.batch=!1,this.update(e)}emitMount(e){this.emitter.emit(vi.events.SCROLL_BLOT_MOUNT,e)}emitUnmount(e){this.emitter.emit(vi.events.SCROLL_BLOT_UNMOUNT,e)}emitEmbedUpdate(e,i){this.emitter.emit(vi.events.SCROLL_EMBED_UPDATE,e,i)}deleteAt(e,i){const[n,r]=this.line(e),[a]=this.line(e+i);if(super.deleteAt(e,i),a!=null&&n!==a&&r>0){if(n instanceof bp||a instanceof bp){this.optimize();return}const s=a.children.head instanceof Uf?null:a.children.head;n.moveChildren(a,s),n.remove()}this.optimize()}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.domNode.setAttribute("contenteditable",e?"true":"false")}formatAt(e,i,n,r){super.formatAt(e,i,n,r),this.optimize()}insertAt(e,i,n){if(e>=this.length())if(n==null||this.scroll.query(i,Ei.BLOCK)==null){const r=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(r),n==null&&i.endsWith(`
`)?r.insertAt(0,i.slice(0,-1),n):r.insertAt(0,i,n)}else{const r=this.scroll.create(i,n);this.appendChild(r)}else super.insertAt(e,i,n);this.optimize()}insertBefore(e,i){if(e.statics.scope===Ei.INLINE_BLOT){const n=this.scroll.create(this.statics.defaultChild.blotName);n.appendChild(e),super.insertBefore(n,i)}else super.insertBefore(e,i)}insertContents(e,i){const n=this.deltaToRenderBlocks(i.concat(new Ii().insert(`
`))),r=n.pop();if(r==null)return;this.batchStart();const a=n.shift();if(a){const l=a.type==="block"&&(a.delta.length()===0||!this.descendant(bp,e)[0]&&e<this.length()),u=a.type==="block"?a.delta:new Ii().insert({[a.key]:a.value});Bj(this,e,u);const c=a.type==="block"?1:0,d=e+u.length()+c;l&&this.insertAt(d-1,`
`);const p=vp(this.line(e)[0]),h=Tp.AttributeMap.diff(p,a.attributes)||{};Object.keys(h).forEach(f=>{this.formatAt(d-1,1,f,h[f])}),e=d}let[s,o]=this.children.find(e);if(n.length&&(s&&(s=s.split(o),o=0),n.forEach(l=>{if(l.type==="block"){const u=this.createBlock(l.attributes,s||void 0);Bj(u,0,l.delta)}else{const u=this.create(l.key,l.value);this.insertBefore(u,s||void 0),Object.keys(l.attributes).forEach(c=>{u.format(c,l.attributes[c])})}})),r.type==="block"&&r.delta.length()){const l=s?s.offset(s.scroll)+o:this.length();Bj(this,l,r.delta)}this.batchEnd(),this.optimize()}isEnabled(){return this.domNode.getAttribute("contenteditable")==="true"}leaf(e){const i=this.path(e).pop();if(!i)return[null,-1];const[n,r]=i;return n instanceof nu?[n,r]:[null,-1]}line(e){return e===this.length()?this.line(e-1):this.descendant(fre,e)}lines(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;const n=(r,a,s)=>{let o=[],l=s;return r.children.forEachAt(a,s,(u,c,d)=>{fre(u)?o.push(u):u instanceof N2&&(o=o.concat(n(u,c,l))),l-=d}),o};return n(this,e,i)}optimize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.batch||(super.optimize(e,i),e.length>0&&this.emitter.emit(vi.events.SCROLL_OPTIMIZE,e,i))}path(e){return super.path(e).slice(1)}remove(){}update(e){if(this.batch){Array.isArray(e)&&(this.batch=this.batch.concat(e));return}let i=vi.sources.USER;typeof e=="string"&&(i=e),Array.isArray(e)||(e=this.observer.takeRecords()),e=e.filter(n=>{let{target:r}=n;const a=this.find(r,!0);return a&&!mre(a)}),e.length>0&&this.emitter.emit(vi.events.SCROLL_BEFORE_UPDATE,i,e),super.update(e.concat([])),e.length>0&&this.emitter.emit(vi.events.SCROLL_UPDATE,i,e)}updateEmbedAt(e,i,n){const[r]=this.descendant(a=>a instanceof bp,e);r&&r.statics.blotName===i&&mre(r)&&r.updateContent(n)}handleDragStart(e){e.preventDefault()}deltaToRenderBlocks(e){const i=[];let n=new Ii;return e.forEach(r=>{const a=r?.insert;if(a)if(typeof a=="string"){const s=a.split(`
`);s.slice(0,-1).forEach(l=>{n.insert(l,r.attributes),i.push({type:"block",delta:n,attributes:r.attributes??{}}),n=new Ii});const o=s[s.length-1];o&&n.insert(o,r.attributes)}else{const s=Object.keys(a)[0];if(!s)return;this.query(s,Ei.INLINE)?n.push(r):(n.length()&&i.push({type:"block",delta:n,attributes:{}}),n=new Ii,i.push({type:"blockEmbed",key:s,value:a[s],attributes:r.attributes??{}}))}}),n.length()&&i.push({type:"block",delta:n,attributes:{}}),i}createBlock(e,i){let n;const r={};Object.entries(e).forEach(o=>{let[l,u]=o;this.query(l,Ei.BLOCK&Ei.BLOT)!=null?n=l:r[l]=u});const a=this.create(n||this.statics.defaultChild.blotName,n?e[n]:void 0);this.insertBefore(a,i||void 0);const s=a.length();return Object.entries(r).forEach(o=>{let[l,u]=o;a.formatAt(0,s,l,u)}),a}}function Bj(t,e,i){i.reduce((n,r)=>{const a=Tp.Op.length(r);let s=r.attributes||{};if(r.insert!=null){if(typeof r.insert=="string"){const o=r.insert;t.insertAt(n,o);const[l]=t.descendant(nu,n),u=vp(l);s=Tp.AttributeMap.diff(u,s)||{}}else if(typeof r.insert=="object"){const o=Object.keys(r.insert)[0];if(o==null)return n;if(t.insertAt(n,o,r.insert[o]),t.scroll.query(o,Ei.INLINE)!=null){const[u]=t.descendant(nu,n),c=vp(u);s=Tp.AttributeMap.diff(c,s)||{}}}}return Object.keys(s).forEach(o=>{t.formatAt(n,a,o,s[o])}),n+a},e)}const yZ={scope:Ei.BLOCK,whitelist:["right","center","justify"]},yIt=new Om("align","align",yZ),_Re=new Tf("align","ql-align",yZ),kRe=new eI("align","text-align",yZ);class xRe extends eI{value(e){let i=super.value(e);return i.startsWith("rgb(")?(i=i.replace(/^[^\d]+/,"").replace(/[^\d]+$/,""),`#${i.split(",").map(r=>`00${parseInt(r,10).toString(16)}`.slice(-2)).join("")}`):i}}const bIt=new Tf("color","ql-color",{scope:Ei.INLINE}),bZ=new xRe("color","color",{scope:Ei.INLINE}),IIt=new Tf("background","ql-bg",{scope:Ei.INLINE}),IZ=new xRe("background","background-color",{scope:Ei.INLINE});class sS extends aS{static create(e){const i=super.create(e);return i.setAttribute("spellcheck","false"),i}code(e,i){return this.children.map(n=>n.length()<=1?"":n.domNode.innerText).join(`
`).slice(e,e+i)}html(e,i){return`<pre>
${A2(this.code(e,i))}
</pre>`}}class zu extends Cl{static TAB="  ";static register(){vt.register(sS)}}class wZ extends Fu{}wZ.blotName="code";wZ.tagName="CODE";zu.blotName="code-block";zu.className="ql-code-block";zu.tagName="DIV";sS.blotName="code-block-container";sS.className="ql-code-block-container";sS.tagName="DIV";sS.allowedChildren=[zu];zu.allowedChildren=[df,Uf,Th];zu.requiredContainer=sS;const SZ={scope:Ei.BLOCK,whitelist:["rtl"]},ORe=new Om("direction","dir",SZ),LRe=new Tf("direction","ql-direction",SZ),FRe=new eI("direction","direction",SZ),$Re={scope:Ei.INLINE,whitelist:["serif","monospace"]},BRe=new Tf("font","ql-font",$Re);class wIt extends eI{value(e){return super.value(e).replace(/["']/g,"")}}const VRe=new wIt("font","font-family",$Re),jRe=new Tf("size","ql-size",{scope:Ei.INLINE,whitelist:["small","large","huge"]}),GRe=new eI("size","font-size",{scope:Ei.INLINE,whitelist:["10px","18px","32px"]}),SIt=Hv("quill:keyboard"),TIt=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey";class _2 extends sg{static match(e,i){return["altKey","ctrlKey","metaKey","shiftKey"].some(n=>!!i[n]!==e[n]&&i[n]!==null)?!1:i.key===e.key||i.key===e.which}constructor(e,i){super(e,i),this.bindings={},Object.keys(this.options.bindings).forEach(n=>{this.options.bindings[n]&&this.addBinding(this.options.bindings[n])}),this.addBinding({key:"Enter",shiftKey:null},this.handleEnter),this.addBinding({key:"Enter",metaKey:null,ctrlKey:null,altKey:null},()=>{}),/Firefox/i.test(navigator.userAgent)?(this.addBinding({key:"Backspace"},{collapsed:!0},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0},this.handleDelete)):(this.addBinding({key:"Backspace"},{collapsed:!0,prefix:/^.?$/},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0,suffix:/^.?$/},this.handleDelete)),this.addBinding({key:"Backspace"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Delete"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Backspace",altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},this.handleBackspace),this.listen()}addBinding(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=DIt(e);if(r==null){SIt.warn("Attempted to add invalid keyboard binding",r);return}typeof i=="function"&&(i={handler:i}),typeof n=="function"&&(n={handler:n}),(Array.isArray(r.key)?r.key:[r.key]).forEach(s=>{const o={...r,key:s,...i,...n};this.bindings[o.key]=this.bindings[o.key]||[],this.bindings[o.key].push(o)})}listen(){this.quill.root.addEventListener("keydown",e=>{if(e.defaultPrevented||e.isComposing||e.keyCode===229&&(e.key==="Enter"||e.key==="Backspace"))return;const r=(this.bindings[e.key]||[]).concat(this.bindings[e.which]||[]).filter(v=>_2.match(e,v));if(r.length===0)return;const a=vt.find(e.target,!0);if(a&&a.scroll!==this.quill.scroll)return;const s=this.quill.getSelection();if(s==null||!this.quill.hasFocus())return;const[o,l]=this.quill.getLine(s.index),[u,c]=this.quill.getLeaf(s.index),[d,p]=s.length===0?[u,c]:this.quill.getLeaf(s.index+s.length),h=u instanceof dO?u.value().slice(0,c):"",f=d instanceof dO?d.value().slice(p):"",m={collapsed:s.length===0,empty:s.length===0&&o.length()<=1,format:this.quill.getFormat(s),line:o,offset:l,prefix:h,suffix:f,event:e};r.some(v=>{if(v.collapsed!=null&&v.collapsed!==m.collapsed||v.empty!=null&&v.empty!==m.empty||v.offset!=null&&v.offset!==m.offset)return!1;if(Array.isArray(v.format)){if(v.format.every(y=>m.format[y]==null))return!1}else if(typeof v.format=="object"&&!Object.keys(v.format).every(y=>v.format[y]===!0?m.format[y]!=null:v.format[y]===!1?m.format[y]==null:fZ(v.format[y],m.format[y])))return!1;return v.prefix!=null&&!v.prefix.test(m.prefix)||v.suffix!=null&&!v.suffix.test(m.suffix)?!1:v.handler.call(this,s,m,v)!==!0})&&e.preventDefault()})}handleBackspace(e,i){const n=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(i.prefix)?2:1;if(e.index===0||this.quill.getLength()<=1)return;let r={};const[a]=this.quill.getLine(e.index);let s=new Ii().retain(e.index-n).delete(n);if(i.offset===0){const[o]=this.quill.getLine(e.index-1);if(o&&!(o.statics.blotName==="block"&&o.length()<=1)){const u=a.formats(),c=this.quill.getFormat(e.index-1,1);if(r=Tp.AttributeMap.diff(u,c)||{},Object.keys(r).length>0){const d=new Ii().retain(e.index+a.length()-2).retain(1,r);s=s.compose(d)}}}this.quill.updateContents(s,vt.sources.USER),this.quill.focus()}handleDelete(e,i){const n=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(i.suffix)?2:1;if(e.index>=this.quill.getLength()-n)return;let r={};const[a]=this.quill.getLine(e.index);let s=new Ii().retain(e.index).delete(n);if(i.offset>=a.length()-1){const[o]=this.quill.getLine(e.index+1);if(o){const l=a.formats(),u=this.quill.getFormat(e.index,1);r=Tp.AttributeMap.diff(l,u)||{},Object.keys(r).length>0&&(s=s.retain(o.length()-1).retain(1,r))}}this.quill.updateContents(s,vt.sources.USER),this.quill.focus()}handleDeleteRange(e){TZ({range:e,quill:this.quill}),this.quill.focus()}handleEnter(e,i){const n=Object.keys(i.format).reduce((a,s)=>(this.quill.scroll.query(s,Ei.BLOCK)&&!Array.isArray(i.format[s])&&(a[s]=i.format[s]),a),{}),r=new Ii().retain(e.index).delete(e.length).insert(`
`,n);this.quill.updateContents(r,vt.sources.USER),this.quill.setSelection(e.index+1,vt.sources.SILENT),this.quill.focus()}}const UIt={bindings:{bold:Vj("bold"),italic:Vj("italic"),underline:Vj("underline"),indent:{key:"Tab",format:["blockquote","indent","list"],handler(t,e){return e.collapsed&&e.offset!==0?!0:(this.quill.format("indent","+1",vt.sources.USER),!1)}},outdent:{key:"Tab",shiftKey:!0,format:["blockquote","indent","list"],handler(t,e){return e.collapsed&&e.offset!==0?!0:(this.quill.format("indent","-1",vt.sources.USER),!1)}},"outdent backspace":{key:"Backspace",collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler(t,e){e.format.indent!=null?this.quill.format("indent","-1",vt.sources.USER):e.format.list!=null&&this.quill.format("list",!1,vt.sources.USER)}},"indent code-block":gre(!0),"outdent code-block":gre(!1),"remove tab":{key:"Tab",shiftKey:!0,collapsed:!0,prefix:/\t$/,handler(t){this.quill.deleteText(t.index-1,1,vt.sources.USER)}},tab:{key:"Tab",handler(t,e){if(e.format.table)return!0;this.quill.history.cutoff();const i=new Ii().retain(t.index).delete(t.length).insert("	");return this.quill.updateContents(i,vt.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(t.index+1,vt.sources.SILENT),!1}},"blockquote empty enter":{key:"Enter",collapsed:!0,format:["blockquote"],empty:!0,handler(){this.quill.format("blockquote",!1,vt.sources.USER)}},"list empty enter":{key:"Enter",collapsed:!0,format:["list"],empty:!0,handler(t,e){const i={list:!1};e.format.indent&&(i.indent=!1),this.quill.formatLine(t.index,t.length,i,vt.sources.USER)}},"checklist enter":{key:"Enter",collapsed:!0,format:{list:"checked"},handler(t){const[e,i]=this.quill.getLine(t.index),n={...e.formats(),list:"checked"},r=new Ii().retain(t.index).insert(`
`,n).retain(e.length()-i-1).retain(1,{list:"unchecked"});this.quill.updateContents(r,vt.sources.USER),this.quill.setSelection(t.index+1,vt.sources.SILENT),this.quill.scrollSelectionIntoView()}},"header enter":{key:"Enter",collapsed:!0,format:["header"],suffix:/^$/,handler(t,e){const[i,n]=this.quill.getLine(t.index),r=new Ii().retain(t.index).insert(`
`,e.format).retain(i.length()-n-1).retain(1,{header:null});this.quill.updateContents(r,vt.sources.USER),this.quill.setSelection(t.index+1,vt.sources.SILENT),this.quill.scrollSelectionIntoView()}},"table backspace":{key:"Backspace",format:["table"],collapsed:!0,offset:0,handler(){}},"table delete":{key:"Delete",format:["table"],collapsed:!0,suffix:/^$/,handler(){}},"table enter":{key:"Enter",shiftKey:null,format:["table"],handler(t){const e=this.quill.getModule("table");if(e){const[i,n,r,a]=e.getTable(t),s=EIt(i,n,r,a);if(s==null)return;let o=i.offset();if(s<0){const l=new Ii().retain(o).insert(`
`);this.quill.updateContents(l,vt.sources.USER),this.quill.setSelection(t.index+1,t.length,vt.sources.SILENT)}else if(s>0){o+=i.length();const l=new Ii().retain(o).insert(`
`);this.quill.updateContents(l,vt.sources.USER),this.quill.setSelection(o,vt.sources.USER)}}}},"table tab":{key:"Tab",shiftKey:null,format:["table"],handler(t,e){const{event:i,line:n}=e,r=n.offset(this.quill.scroll);i.shiftKey?this.quill.setSelection(r-1,vt.sources.USER):this.quill.setSelection(r+n.length(),vt.sources.USER)}},"list autofill":{key:" ",shiftKey:null,collapsed:!0,format:{"code-block":!1,blockquote:!1,table:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler(t,e){if(this.quill.scroll.query("list")==null)return!0;const{length:i}=e.prefix,[n,r]=this.quill.getLine(t.index);if(r>i)return!0;let a;switch(e.prefix.trim()){case"[]":case"[ ]":a="unchecked";break;case"[x]":a="checked";break;case"-":case"*":a="bullet";break;default:a="ordered"}this.quill.insertText(t.index," ",vt.sources.USER),this.quill.history.cutoff();const s=new Ii().retain(t.index-r).delete(i+1).retain(n.length()-2-r).retain(1,{list:a});return this.quill.updateContents(s,vt.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(t.index-i,vt.sources.SILENT),!1}},"code exit":{key:"Enter",collapsed:!0,format:["code-block"],prefix:/^$/,suffix:/^\s*$/,handler(t){const[e,i]=this.quill.getLine(t.index);let n=2,r=e;for(;r!=null&&r.length()<=1&&r.formats()["code-block"];)if(r=r.prev,n-=1,n<=0){const a=new Ii().retain(t.index+e.length()-i-2).retain(1,{"code-block":null}).delete(1);return this.quill.updateContents(a,vt.sources.USER),this.quill.setSelection(t.index-1,vt.sources.SILENT),!1}return!0}},"embed left":qA("ArrowLeft",!1),"embed left shift":qA("ArrowLeft",!0),"embed right":qA("ArrowRight",!1),"embed right shift":qA("ArrowRight",!0),"table down":vre(!1),"table up":vre(!0)}};_2.DEFAULTS=UIt;function gre(t){return{key:"Tab",shiftKey:!t,format:{"code-block":!0},handler(e,i){let{event:n}=i;const r=this.quill.scroll.query("code-block"),{TAB:a}=r;if(e.length===0&&!n.shiftKey){this.quill.insertText(e.index,a,vt.sources.USER),this.quill.setSelection(e.index+a.length,vt.sources.SILENT);return}const s=e.length===0?this.quill.getLines(e.index,1):this.quill.getLines(e);let{index:o,length:l}=e;s.forEach((u,c)=>{t?(u.insertAt(0,a),c===0?o+=a.length:l+=a.length):u.domNode.textContent.startsWith(a)&&(u.deleteAt(0,a.length),c===0?o-=a.length:l-=a.length)}),this.quill.update(vt.sources.USER),this.quill.setSelection(o,l,vt.sources.SILENT)}}}function qA(t,e){return{key:t,shiftKey:e,altKey:null,[t==="ArrowLeft"?"prefix":"suffix"]:/^$/,handler(n){let{index:r}=n;t==="ArrowRight"&&(r+=n.length+1);const[a]=this.quill.getLeaf(r);return a instanceof Jd?(t==="ArrowLeft"?e?this.quill.setSelection(n.index-1,n.length+1,vt.sources.USER):this.quill.setSelection(n.index-1,vt.sources.USER):e?this.quill.setSelection(n.index,n.length+1,vt.sources.USER):this.quill.setSelection(n.index+n.length+1,vt.sources.USER),!1):!0}}}function Vj(t){return{key:t[0],shortKey:!0,handler(e,i){this.quill.format(t,!i.format[t],vt.sources.USER)}}}function vre(t){return{key:t?"ArrowUp":"ArrowDown",collapsed:!0,format:["table"],handler(e,i){const n=t?"prev":"next",r=i.line,a=r.parent[n];if(a!=null){if(a.statics.blotName==="table-row"){let s=a.children.head,o=r;for(;o.prev!=null;)o=o.prev,s=s.next;const l=s.offset(this.quill.scroll)+Math.min(i.offset,s.length()-1);this.quill.setSelection(l,0,vt.sources.USER)}}else{const s=r.table()[n];s!=null&&(t?this.quill.setSelection(s.offset(this.quill.scroll)+s.length()-1,0,vt.sources.USER):this.quill.setSelection(s.offset(this.quill.scroll),0,vt.sources.USER))}return!1}}}function DIt(t){if(typeof t=="string"||typeof t=="number")t={key:t};else if(typeof t=="object")t=wT(t);else return null;return t.shortKey&&(t[TIt]=t.shortKey,delete t.shortKey),t}function TZ(t){let{quill:e,range:i}=t;const n=e.getLines(i);let r={};if(n.length>1){const a=n[0].formats(),s=n[n.length-1].formats();r=Tp.AttributeMap.diff(s,a)||{}}e.deleteText(i,vt.sources.USER),Object.keys(r).length>0&&e.formatLine(i.index,1,r,vt.sources.USER),e.setSelection(i.index,vt.sources.SILENT)}function EIt(t,e,i,n){return e.prev==null&&e.next==null?i.prev==null&&i.next==null?n===0?-1:1:i.prev==null?-1:1:e.prev==null?-1:e.next==null?1:null}const PIt=/font-weight:\s*normal/,CIt=["P","OL","UL"],yre=t=>t&&CIt.includes(t.tagName),RIt=t=>{Array.from(t.querySelectorAll("br")).filter(e=>yre(e.previousElementSibling)&&yre(e.nextElementSibling)).forEach(e=>{e.parentNode?.removeChild(e)})},MIt=t=>{Array.from(t.querySelectorAll('b[style*="font-weight"]')).filter(e=>e.getAttribute("style")?.match(PIt)).forEach(e=>{const i=t.createDocumentFragment();i.append(...e.childNodes),e.parentNode?.replaceChild(i,e)})};function NIt(t){t.querySelector('[id^="docs-internal-guid-"]')&&(MIt(t),RIt(t))}const AIt=/\bmso-list:[^;]*ignore/i,_It=/\bmso-list:[^;]*\bl(\d+)/i,kIt=/\bmso-list:[^;]*\blevel(\d+)/i,xIt=(t,e)=>{const i=t.getAttribute("style"),n=i?.match(_It);if(!n)return null;const r=Number(n[1]),a=i?.match(kIt),s=a?Number(a[1]):1,o=new RegExp(`@list l${r}:level${s}\\s*\\{[^\\}]*mso-level-number-format:\\s*([\\w-]+)`,"i"),l=e.match(o),u=l&&l[1]==="bullet"?"bullet":"ordered";return{id:r,indent:s,type:u,element:t}},OIt=t=>{const e=Array.from(t.querySelectorAll("[style*=mso-list]")),i=[],n=[];e.forEach(s=>{(s.getAttribute("style")||"").match(AIt)?i.push(s):n.push(s)}),i.forEach(s=>s.parentNode?.removeChild(s));const r=t.documentElement.innerHTML,a=n.map(s=>xIt(s,r)).filter(s=>s);for(;a.length;){const s=[];let o=a.shift();for(;o;)s.push(o),o=a.length&&a[0]?.element===o.element.nextElementSibling&&a[0].id===o.id?a.shift():null;const l=document.createElement("ul");s.forEach(d=>{const p=document.createElement("li");p.setAttribute("data-list",d.type),d.indent>1&&p.setAttribute("class",`ql-indent-${d.indent-1}`),p.innerHTML=d.element.innerHTML,l.appendChild(p)});const u=s[0]?.element,{parentNode:c}=u??{};u&&c?.replaceChild(l,u),s.slice(1).forEach(d=>{let{element:p}=d;c?.removeChild(p)})}};function LIt(t){t.documentElement.getAttribute("xmlns:w")==="urn:schemas-microsoft-com:office:word"&&OIt(t)}const FIt=[LIt,NIt],$It=t=>{t.documentElement&&FIt.forEach(e=>{e(t)})},BIt=Hv("quill:clipboard"),VIt=[[Node.TEXT_NODE,ewt],[Node.TEXT_NODE,Ire],["br",WIt],[Node.ELEMENT_NODE,Ire],[Node.ELEMENT_NODE,qIt],[Node.ELEMENT_NODE,zIt],[Node.ELEMENT_NODE,JIt],["li",ZIt],["ol, ul",XIt],["pre",YIt],["tr",QIt],["b",jj("bold")],["i",jj("italic")],["strike",jj("strike")],["style",KIt]],jIt=[yIt,ORe].reduce((t,e)=>(t[e.keyName]=e,t),{}),bre=[kRe,IZ,bZ,FRe,VRe,GRe].reduce((t,e)=>(t[e.keyName]=e,t),{});class GIt extends sg{static DEFAULTS={matchers:[]};constructor(e,i){super(e,i),this.quill.root.addEventListener("copy",n=>this.onCaptureCopy(n,!1)),this.quill.root.addEventListener("cut",n=>this.onCaptureCopy(n,!0)),this.quill.root.addEventListener("paste",this.onCapturePaste.bind(this)),this.matchers=[],VIt.concat(this.options.matchers??[]).forEach(n=>{let[r,a]=n;this.addMatcher(r,a)})}addMatcher(e,i){this.matchers.push([e,i])}convert(e){let{html:i,text:n}=e,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(r[zu.blotName])return new Ii().insert(n||"",{[zu.blotName]:r[zu.blotName]});if(!i)return new Ii().insert(n||"",r);const a=this.convertHTML(i);return FN(a,`
`)&&(a.ops[a.ops.length-1].attributes==null||r.table)?a.compose(new Ii().retain(a.length()-1).delete(1)):a}normalizeHTML(e){$It(e)}convertHTML(e){const i=new DOMParser().parseFromString(e,"text/html");this.normalizeHTML(i);const n=i.body,r=new WeakMap,[a,s]=this.prepareMatching(n,r);return UZ(this.quill.scroll,n,a,s,r)}dangerouslyPasteHTML(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vt.sources.API;if(typeof e=="string"){const r=this.convert({html:e,text:""});this.quill.setContents(r,i),this.quill.setSelection(0,vt.sources.SILENT)}else{const r=this.convert({html:i,text:""});this.quill.updateContents(new Ii().retain(e).concat(r),n),this.quill.setSelection(e+r.length(),vt.sources.SILENT)}}onCaptureCopy(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.defaultPrevented)return;e.preventDefault();const[n]=this.quill.selection.getRange();if(n==null)return;const{html:r,text:a}=this.onCopy(n,i);e.clipboardData?.setData("text/plain",a),e.clipboardData?.setData("text/html",r),i&&TZ({range:n,quill:this.quill})}normalizeURIList(e){return e.split(/\r?\n/).filter(i=>i[0]!=="#").join(`
`)}onCapturePaste(e){if(e.defaultPrevented||!this.quill.isEnabled())return;e.preventDefault();const i=this.quill.getSelection(!0);if(i==null)return;const n=e.clipboardData?.getData("text/html");let r=e.clipboardData?.getData("text/plain");if(!n&&!r){const s=e.clipboardData?.getData("text/uri-list");s&&(r=this.normalizeURIList(s))}const a=Array.from(e.clipboardData?.files||[]);if(!n&&a.length>0){this.quill.uploader.upload(i,a);return}if(n&&a.length>0){const s=new DOMParser().parseFromString(n,"text/html");if(s.body.childElementCount===1&&s.body.firstElementChild?.tagName==="IMG"){this.quill.uploader.upload(i,a);return}}this.onPaste(i,{html:n,text:r})}onCopy(e){const i=this.quill.getText(e);return{html:this.quill.getSemanticHTML(e),text:i}}onPaste(e,i){let{text:n,html:r}=i;const a=this.quill.getFormat(e.index),s=this.convert({text:n,html:r},a);BIt.log("onPaste",s,{text:n,html:r});const o=new Ii().retain(e.index).delete(e.length).concat(s);this.quill.updateContents(o,vt.sources.USER),this.quill.setSelection(o.length()-e.length,vt.sources.SILENT),this.quill.scrollSelectionIntoView()}prepareMatching(e,i){const n=[],r=[];return this.matchers.forEach(a=>{const[s,o]=a;switch(s){case Node.TEXT_NODE:r.push(o);break;case Node.ELEMENT_NODE:n.push(o);break;default:Array.from(e.querySelectorAll(s)).forEach(l=>{i.has(l)?i.get(l)?.push(o):i.set(l,[o])});break}}),[n,r]}}function oS(t,e,i,n){return n.query(e)?t.reduce((r,a)=>{if(!a.insert)return r;if(a.attributes&&a.attributes[e])return r.push(a);const s=i?{[e]:i}:{};return r.insert(a.insert,{...s,...a.attributes})},new Ii):t}function FN(t,e){let i="";for(let n=t.ops.length-1;n>=0&&i.length<e.length;--n){const r=t.ops[n];if(typeof r.insert!="string")break;i=r.insert+i}return i.slice(-1*e.length)===e}function Sy(t,e){if(!(t instanceof Element))return!1;const i=e.query(t);return i&&i.prototype instanceof Jd?!1:["address","article","blockquote","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","iframe","li","main","nav","ol","output","p","pre","section","table","td","tr","ul","video"].includes(t.tagName.toLowerCase())}function HIt(t,e){return t.previousElementSibling&&t.nextElementSibling&&!Sy(t.previousElementSibling,e)&&!Sy(t.nextElementSibling,e)}const WA=new WeakMap;function HRe(t){return t==null?!1:(WA.has(t)||(t.tagName==="PRE"?WA.set(t,!0):WA.set(t,HRe(t.parentNode))),WA.get(t))}function UZ(t,e,i,n,r){return e.nodeType===e.TEXT_NODE?n.reduce((a,s)=>s(e,a,t),new Ii):e.nodeType===e.ELEMENT_NODE?Array.from(e.childNodes||[]).reduce((a,s)=>{let o=UZ(t,s,i,n,r);return s.nodeType===e.ELEMENT_NODE&&(o=i.reduce((l,u)=>u(s,l,t),o),o=(r.get(s)||[]).reduce((l,u)=>u(s,l,t),o)),a.concat(o)},new Ii):new Ii}function jj(t){return(e,i,n)=>oS(i,t,!0,n)}function zIt(t,e,i){const n=Om.keys(t),r=Tf.keys(t),a=eI.keys(t),s={};return n.concat(r).concat(a).forEach(o=>{let l=i.query(o,Ei.ATTRIBUTE);l!=null&&(s[l.attrName]=l.value(t),s[l.attrName])||(l=jIt[o],l!=null&&(l.attrName===o||l.keyName===o)&&(s[l.attrName]=l.value(t)||void 0),l=bre[o],l!=null&&(l.attrName===o||l.keyName===o)&&(l=bre[o],s[l.attrName]=l.value(t)||void 0))}),Object.entries(s).reduce((o,l)=>{let[u,c]=l;return oS(o,u,c,i)},e)}function qIt(t,e,i){const n=i.query(t);if(n==null)return e;if(n.prototype instanceof Jd){const r={},a=n.value(t);if(a!=null)return r[n.blotName]=a,new Ii().insert(r,n.formats(t,i))}else if(n.prototype instanceof P1&&!FN(e,`
`)&&e.insert(`
`),"blotName"in n&&"formats"in n&&typeof n.formats=="function")return oS(e,n.blotName,n.formats(t,i),i);return e}function WIt(t,e){return FN(e,`
`)||e.insert(`
`),e}function YIt(t,e,i){const n=i.query("code-block"),r=n&&"formats"in n&&typeof n.formats=="function"?n.formats(t,i):!0;return oS(e,"code-block",r,i)}function KIt(){return new Ii}function ZIt(t,e,i){const n=i.query(t);if(n==null||n.blotName!=="list"||!FN(e,`
`))return e;let r=-1,a=t.parentNode;for(;a!=null;)["OL","UL"].includes(a.tagName)&&(r+=1),a=a.parentNode;return r<=0?e:e.reduce((s,o)=>o.insert?o.attributes&&typeof o.attributes.indent=="number"?s.push(o):s.insert(o.insert,{indent:r,...o.attributes||{}}):s,new Ii)}function XIt(t,e,i){const n=t;let r=n.tagName==="OL"?"ordered":"bullet";const a=n.getAttribute("data-checked");return a&&(r=a==="true"?"checked":"unchecked"),oS(e,"list",r,i)}function Ire(t,e,i){if(!FN(e,`
`)){if(Sy(t,i)&&(t.childNodes.length>0||t instanceof HTMLParagraphElement))return e.insert(`
`);if(e.length()>0&&t.nextSibling){let n=t.nextSibling;for(;n!=null;){if(Sy(n,i))return e.insert(`
`);const r=i.query(n);if(r&&r.prototype instanceof bp)return e.insert(`
`);n=n.firstChild}}}return e}function JIt(t,e,i){const n={},r=t.style||{};return r.fontStyle==="italic"&&(n.italic=!0),r.textDecoration==="underline"&&(n.underline=!0),r.textDecoration==="line-through"&&(n.strike=!0),(r.fontWeight?.startsWith("bold")||parseInt(r.fontWeight,10)>=700)&&(n.bold=!0),e=Object.entries(n).reduce((a,s)=>{let[o,l]=s;return oS(a,o,l,i)},e),parseFloat(r.textIndent||0)>0?new Ii().insert("	").concat(e):e}function QIt(t,e,i){const n=t.parentElement?.tagName==="TABLE"?t.parentElement:t.parentElement?.parentElement;if(n!=null){const a=Array.from(n.querySelectorAll("tr")).indexOf(t)+1;return oS(e,"table",a,i)}return e}function ewt(t,e,i){let n=t.data;if(t.parentElement?.tagName==="O:P")return e.insert(n.trim());if(!HRe(t)){if(n.trim().length===0&&n.includes(`
`)&&!HIt(t,i))return e;n=n.replace(/[^\S\u00a0]/g," "),n=n.replace(/ {2,}/g," "),(t.previousSibling==null&&t.parentElement!=null&&Sy(t.parentElement,i)||t.previousSibling instanceof Element&&Sy(t.previousSibling,i))&&(n=n.replace(/^ /,"")),(t.nextSibling==null&&t.parentElement!=null&&Sy(t.parentElement,i)||t.nextSibling instanceof Element&&Sy(t.nextSibling,i))&&(n=n.replace(/ $/,"")),n=n.replaceAll(""," ")}return e.insert(n)}class twt extends sg{static DEFAULTS={delay:1e3,maxStack:100,userOnly:!1};lastRecorded=0;ignoreChange=!1;stack={undo:[],redo:[]};currentRange=null;constructor(e,i){super(e,i),this.quill.on(vt.events.EDITOR_CHANGE,(n,r,a,s)=>{n===vt.events.SELECTION_CHANGE?r&&s!==vt.sources.SILENT&&(this.currentRange=r):n===vt.events.TEXT_CHANGE&&(this.ignoreChange||(!this.options.userOnly||s===vt.sources.USER?this.record(r,a):this.transform(r)),this.currentRange=rq(this.currentRange,r))}),this.quill.keyboard.addBinding({key:"z",shortKey:!0},this.undo.bind(this)),this.quill.keyboard.addBinding({key:["z","Z"],shortKey:!0,shiftKey:!0},this.redo.bind(this)),/Win/i.test(navigator.platform)&&this.quill.keyboard.addBinding({key:"y",shortKey:!0},this.redo.bind(this)),this.quill.root.addEventListener("beforeinput",n=>{n.inputType==="historyUndo"?(this.undo(),n.preventDefault()):n.inputType==="historyRedo"&&(this.redo(),n.preventDefault())})}change(e,i){if(this.stack[e].length===0)return;const n=this.stack[e].pop();if(!n)return;const r=this.quill.getContents(),a=n.delta.invert(r);this.stack[i].push({delta:a,range:rq(n.range,a)}),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(n.delta,vt.sources.USER),this.ignoreChange=!1,this.restoreSelection(n)}clear(){this.stack={undo:[],redo:[]}}cutoff(){this.lastRecorded=0}record(e,i){if(e.ops.length===0)return;this.stack.redo=[];let n=e.invert(i),r=this.currentRange;const a=Date.now();if(this.lastRecorded+this.options.delay>a&&this.stack.undo.length>0){const s=this.stack.undo.pop();s&&(n=n.compose(s.delta),r=s.range)}else this.lastRecorded=a;n.length()!==0&&(this.stack.undo.push({delta:n,range:r}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift())}redo(){this.change("redo","undo")}transform(e){wre(this.stack.undo,e),wre(this.stack.redo,e)}undo(){this.change("undo","redo")}restoreSelection(e){if(e.range)this.quill.setSelection(e.range,vt.sources.USER);else{const i=nwt(this.quill.scroll,e.delta);this.quill.setSelection(i,vt.sources.USER)}}}function wre(t,e){let i=e;for(let n=t.length-1;n>=0;n-=1){const r=t[n];t[n]={delta:i.transform(r.delta,!0),range:r.range&&rq(r.range,i)},i=r.delta.transform(i),t[n].delta.length()===0&&t.splice(n,1)}}function iwt(t,e){const i=e.ops[e.ops.length-1];return i==null?!1:i.insert!=null?typeof i.insert=="string"&&i.insert.endsWith(`
`):i.attributes!=null?Object.keys(i.attributes).some(n=>t.query(n,Ei.BLOCK)!=null):!1}function nwt(t,e){const i=e.reduce((r,a)=>r+(a.delete||0),0);let n=e.length()-i;return iwt(t,e)&&(n-=1),n}function rq(t,e){if(!t)return t;const i=e.transformPosition(t.index),n=e.transformPosition(t.index+t.length);return{index:i,length:n-i}}class zRe extends sg{constructor(e,i){super(e,i),e.root.addEventListener("drop",n=>{n.preventDefault();let r=null;if(document.caretRangeFromPoint)r=document.caretRangeFromPoint(n.clientX,n.clientY);else if(document.caretPositionFromPoint){const s=document.caretPositionFromPoint(n.clientX,n.clientY);r=document.createRange(),r.setStart(s.offsetNode,s.offset),r.setEnd(s.offsetNode,s.offset)}const a=r&&e.selection.normalizeNative(r);if(a){const s=e.selection.normalizedToRange(a);n.dataTransfer?.files&&this.upload(s,n.dataTransfer.files)}})}upload(e,i){const n=[];Array.from(i).forEach(r=>{r&&this.options.mimetypes?.includes(r.type)&&n.push(r)}),n.length>0&&this.options.handler.call(this,e,n)}}zRe.DEFAULTS={mimetypes:["image/png","image/jpeg"],handler(t,e){if(!this.quill.scroll.query("image"))return;const i=e.map(n=>new Promise(r=>{const a=new FileReader;a.onload=()=>{r(a.result)},a.readAsDataURL(n)}));Promise.all(i).then(n=>{const r=n.reduce((a,s)=>a.insert({image:s}),new Ii().retain(t.index).delete(t.length));this.quill.updateContents(r,vi.sources.USER),this.quill.setSelection(t.index+n.length,vi.sources.SILENT)})}};const rwt=["insertText","insertReplacementText"];class awt extends sg{constructor(e,i){super(e,i),e.root.addEventListener("beforeinput",n=>{this.handleBeforeInput(n)}),/Android/i.test(navigator.userAgent)||e.on(vt.events.COMPOSITION_BEFORE_START,()=>{this.handleCompositionStart()})}deleteRange(e){TZ({range:e,quill:this.quill})}replaceText(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e.length===0)return!1;if(i){const n=this.quill.getFormat(e.index,1);this.deleteRange(e),this.quill.updateContents(new Ii().retain(e.index).insert(i,n),vt.sources.USER)}else this.deleteRange(e);return this.quill.setSelection(e.index+i.length,0,vt.sources.SILENT),!0}handleBeforeInput(e){if(this.quill.composition.isComposing||e.defaultPrevented||!rwt.includes(e.inputType))return;const i=e.getTargetRanges?e.getTargetRanges()[0]:null;if(!i||i.collapsed===!0)return;const n=swt(e);if(n==null)return;const r=this.quill.selection.normalizeNative(i),a=r?this.quill.selection.normalizedToRange(r):null;a&&this.replaceText(a,n)&&e.preventDefault()}handleCompositionStart(){const e=this.quill.getSelection();e&&this.replaceText(e)}}function swt(t){return typeof t.data=="string"?t.data:t.dataTransfer?.types.includes("text/plain")?t.dataTransfer.getData("text/plain"):null}const owt=/Mac/i.test(navigator.platform),lwt=100,uwt=t=>!!(t.key==="ArrowLeft"||t.key==="ArrowRight"||t.key==="ArrowUp"||t.key==="ArrowDown"||t.key==="Home"||owt&&t.key==="a"&&t.ctrlKey===!0);class cwt extends sg{isListening=!1;selectionChangeDeadline=0;constructor(e,i){super(e,i),this.handleArrowKeys(),this.handleNavigationShortcuts()}handleArrowKeys(){this.quill.keyboard.addBinding({key:["ArrowLeft","ArrowRight"],offset:0,shiftKey:null,handler(e,i){let{line:n,event:r}=i;if(!(n instanceof Gh)||!n.uiNode)return!0;const a=getComputedStyle(n.domNode).direction==="rtl";return a&&r.key!=="ArrowRight"||!a&&r.key!=="ArrowLeft"?!0:(this.quill.setSelection(e.index-1,e.length+(r.shiftKey?1:0),vt.sources.USER),!1)}})}handleNavigationShortcuts(){this.quill.root.addEventListener("keydown",e=>{!e.defaultPrevented&&uwt(e)&&this.ensureListeningToSelectionChange()})}ensureListeningToSelectionChange(){if(this.selectionChangeDeadline=Date.now()+lwt,this.isListening)return;this.isListening=!0;const e=()=>{this.isListening=!1,Date.now()<=this.selectionChangeDeadline&&this.handleSelectionChange()};document.addEventListener("selectionchange",e,{once:!0})}handleSelectionChange(){const e=document.getSelection();if(!e)return;const i=e.getRangeAt(0);if(i.collapsed!==!0||i.startOffset!==0)return;const n=this.quill.scroll.find(i.startContainer);if(!(n instanceof Gh)||!n.uiNode)return;const r=document.createRange();r.setStartAfter(n.uiNode),r.setEndAfter(n.uiNode),e.removeAllRanges(),e.addRange(r)}}vt.register({"blots/block":Cl,"blots/block/embed":bp,"blots/break":Uf,"blots/container":aS,"blots/cursor":Th,"blots/embed":vZ,"blots/inline":Fu,"blots/scroll":vIt,"blots/text":df,"modules/clipboard":GIt,"modules/history":twt,"modules/keyboard":_2,"modules/uploader":zRe,"modules/input":awt,"modules/uiNode":cwt});class dwt extends Tf{add(e,i){let n=0;if(i==="+1"||i==="-1"){const r=this.value(e)||0;n=i==="+1"?r+1:r-1}else typeof i=="number"&&(n=i);return n===0?(this.remove(e),!0):super.add(e,n.toString())}canAdd(e,i){return super.canAdd(e,i)||super.canAdd(e,parseInt(i,10))}value(e){return parseInt(super.value(e),10)||void 0}}const pwt=new dwt("indent","ql-indent",{scope:Ei.BLOCK,whitelist:[1,2,3,4,5,6,7,8]});class hwt extends Cl{static blotName="blockquote";static tagName="blockquote"}let fwt=class extends Cl{static blotName="header";static tagName=["H1","H2","H3","H4","H5","H6"];static formats(e){return this.tagName.indexOf(e.tagName)+1}};class $N extends aS{}$N.blotName="list-container";$N.tagName="OL";class BN extends Cl{static create(e){const i=super.create();return i.setAttribute("data-list",e),i}static formats(e){return e.getAttribute("data-list")||void 0}static register(){vt.register($N)}constructor(e,i){super(e,i);const n=i.ownerDocument.createElement("span"),r=a=>{if(!e.isEnabled())return;const s=this.statics.formats(i,e);s==="checked"?(this.format("list","unchecked"),a.preventDefault()):s==="unchecked"&&(this.format("list","checked"),a.preventDefault())};n.addEventListener("mousedown",r),n.addEventListener("touchstart",r),this.attachUI(n)}format(e,i){e===this.statics.blotName&&i?this.domNode.setAttribute("data-list",i):super.format(e,i)}}BN.blotName="list";BN.tagName="LI";$N.allowedChildren=[BN];BN.requiredContainer=$N;class DZ extends Fu{static blotName="bold";static tagName=["STRONG","B"];static create(){return super.create()}static formats(){return!0}optimize(e){super.optimize(e),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}}class mwt extends DZ{static blotName="italic";static tagName=["EM","I"]}class pO extends Fu{static blotName="link";static tagName="A";static SANITIZED_URL="about:blank";static PROTOCOL_WHITELIST=["http","https","mailto","tel","sms"];static create(e){const i=super.create(e);return i.setAttribute("href",this.sanitize(e)),i.setAttribute("rel","noopener noreferrer"),i.setAttribute("target","_blank"),i}static formats(e){return e.getAttribute("href")}static sanitize(e){return qRe(e,this.PROTOCOL_WHITELIST)?e:this.SANITIZED_URL}format(e,i){e!==this.statics.blotName||!i?super.format(e,i):this.domNode.setAttribute("href",this.constructor.sanitize(i))}}function qRe(t,e){const i=document.createElement("a");i.href=t;const n=i.href.slice(0,i.href.indexOf(":"));return e.indexOf(n)>-1}class gwt extends Fu{static blotName="script";static tagName=["SUB","SUP"];static create(e){return e==="super"?document.createElement("sup"):e==="sub"?document.createElement("sub"):super.create(e)}static formats(e){if(e.tagName==="SUB")return"sub";if(e.tagName==="SUP")return"super"}}class vwt extends DZ{static blotName="strike";static tagName=["S","STRIKE"]}class ywt extends Fu{static blotName="underline";static tagName="U"}class bwt extends vZ{static blotName="formula";static className="ql-formula";static tagName="SPAN";static create(e){if(window.katex==null)throw new Error("Formula module requires KaTeX.");const i=super.create(e);return typeof e=="string"&&(window.katex.render(e,i,{throwOnError:!1,errorColor:"#f00"}),i.setAttribute("data-value",e)),i}static value(e){return e.getAttribute("data-value")}html(){const{formula:e}=this.value();return`<span>${e}</span>`}}const Sre=["alt","height","width"];let Iwt=class extends Jd{static blotName="image";static tagName="IMG";static create(e){const i=super.create(e);return typeof e=="string"&&i.setAttribute("src",this.sanitize(e)),i}static formats(e){return Sre.reduce((i,n)=>(e.hasAttribute(n)&&(i[n]=e.getAttribute(n)),i),{})}static match(e){return/\.(jpe?g|gif|png)$/.test(e)||/^data:image\/.+;base64/.test(e)}static sanitize(e){return qRe(e,["http","https","data"])?e:"//:0"}static value(e){return e.getAttribute("src")}format(e,i){Sre.indexOf(e)>-1?i?this.domNode.setAttribute(e,i):this.domNode.removeAttribute(e):super.format(e,i)}};const Tre=["height","width"];class wwt extends bp{static blotName="video";static className="ql-video";static tagName="IFRAME";static create(e){const i=super.create(e);return i.setAttribute("frameborder","0"),i.setAttribute("allowfullscreen","true"),i.setAttribute("src",this.sanitize(e)),i}static formats(e){return Tre.reduce((i,n)=>(e.hasAttribute(n)&&(i[n]=e.getAttribute(n)),i),{})}static sanitize(e){return pO.sanitize(e)}static value(e){return e.getAttribute("src")}format(e,i){Tre.indexOf(e)>-1?i?this.domNode.setAttribute(e,i):this.domNode.removeAttribute(e):super.format(e,i)}html(){const{video:e}=this.value();return`<a href="${e}">${e}</a>`}}const aP=new Tf("code-token","hljs",{scope:Ei.INLINE});class gv extends Fu{static formats(e,i){for(;e!=null&&e!==i.domNode;){if(e.classList&&e.classList.contains(zu.className))return super.formats(e,i);e=e.parentNode}}constructor(e,i,n){super(e,i,n),aP.add(this.domNode,n)}format(e,i){e!==gv.blotName?super.format(e,i):i?aP.add(this.domNode,i):(aP.remove(this.domNode),this.domNode.classList.remove(this.statics.className))}optimize(){super.optimize(...arguments),aP.value(this.domNode)||this.unwrap()}}gv.blotName="code-token";gv.className="ql-token";class yp extends zu{static create(e){const i=super.create(e);return typeof e=="string"&&i.setAttribute("data-language",e),i}static formats(e){return e.getAttribute("data-language")||"plain"}static register(){}format(e,i){e===this.statics.blotName&&i?this.domNode.setAttribute("data-language",i):super.format(e,i)}replaceWith(e,i){return this.formatAt(0,this.length(),gv.blotName,!1),super.replaceWith(e,i)}}class GP extends sS{attach(){super.attach(),this.forceNext=!1,this.scroll.emitMount(this)}format(e,i){e===yp.blotName&&(this.forceNext=!0,this.children.forEach(n=>{n.format(e,i)}))}formatAt(e,i,n,r){n===yp.blotName&&(this.forceNext=!0),super.formatAt(e,i,n,r)}highlight(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.children.head==null)return;const r=`${Array.from(this.domNode.childNodes).filter(s=>s!==this.uiNode).map(s=>s.textContent).join(`
`)}
`,a=yp.formats(this.children.head.domNode);if(i||this.forceNext||this.cachedText!==r){if(r.trim().length>0||this.cachedText==null){const s=this.children.reduce((l,u)=>l.concat(NRe(u,!1)),new Ii),o=e(r,a);s.diff(o).reduce((l,u)=>{let{retain:c,attributes:d}=u;return c?(d&&Object.keys(d).forEach(p=>{[yp.blotName,gv.blotName].includes(p)&&this.formatAt(l,c,p,d[p])}),l+c):l},0)}this.cachedText=r,this.forceNext=!1}}html(e,i){const[n]=this.children.find(e);return`<pre data-language="${n?yp.formats(n.domNode):"plain"}">
${A2(this.code(e,i))}
</pre>`}optimize(e){if(super.optimize(e),this.parent!=null&&this.children.head!=null&&this.uiNode!=null){const i=yp.formats(this.children.head.domNode);i!==this.uiNode.value&&(this.uiNode.value=i)}}}GP.allowedChildren=[yp];yp.requiredContainer=GP;yp.allowedChildren=[gv,Th,df,Uf];const Swt=(t,e,i)=>{if(typeof t.versionString=="string"){const n=t.versionString.split(".")[0];if(parseInt(n,10)>=11)return t.highlight(i,{language:e}).value}return t.highlight(e,i).value};class WRe extends sg{static register(){vt.register(gv,!0),vt.register(yp,!0),vt.register(GP,!0)}constructor(e,i){if(super(e,i),this.options.hljs==null)throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");this.languages=this.options.languages.reduce((n,r)=>{let{key:a}=r;return n[a]=!0,n},{}),this.highlightBlot=this.highlightBlot.bind(this),this.initListener(),this.initTimer()}initListener(){this.quill.on(vt.events.SCROLL_BLOT_MOUNT,e=>{if(!(e instanceof GP))return;const i=this.quill.root.ownerDocument.createElement("select");this.options.languages.forEach(n=>{let{key:r,label:a}=n;const s=i.ownerDocument.createElement("option");s.textContent=a,s.setAttribute("value",r),i.appendChild(s)}),i.addEventListener("change",()=>{e.format(yp.blotName,i.value),this.quill.root.focus(),this.highlight(e,!0)}),e.uiNode==null&&(e.attachUI(i),e.children.head&&(i.value=yp.formats(e.children.head.domNode)))})}initTimer(){let e=null;this.quill.on(vt.events.SCROLL_OPTIMIZE,()=>{e&&clearTimeout(e),e=setTimeout(()=>{this.highlight(),e=null},this.options.interval)})}highlight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.quill.selection.composing)return;this.quill.update(vt.sources.USER);const n=this.quill.getSelection();(e==null?this.quill.scroll.descendants(GP):[e]).forEach(a=>{a.highlight(this.highlightBlot,i)}),this.quill.update(vt.sources.SILENT),n!=null&&this.quill.setSelection(n,vt.sources.SILENT)}highlightBlot(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"plain";if(i=this.languages[i]?i:"plain",i==="plain")return A2(e).split(`
`).reduce((r,a,s)=>(s!==0&&r.insert(`
`,{[zu.blotName]:i}),r.insert(a)),new Ii);const n=this.quill.root.ownerDocument.createElement("div");return n.classList.add(zu.className),n.innerHTML=Swt(this.options.hljs,i,e),UZ(this.quill.scroll,n,[(r,a)=>{const s=aP.value(r);return s?a.compose(new Ii().retain(a.length(),{[gv.blotName]:s})):a}],[(r,a)=>r.data.split(`
`).reduce((s,o,l)=>(l!==0&&s.insert(`
`,{[zu.blotName]:i}),s.insert(o)),a)],new WeakMap)}}WRe.DEFAULTS={hljs:window.hljs,interval:1e3,languages:[{key:"plain",label:"Plain"},{key:"bash",label:"Bash"},{key:"cpp",label:"C++"},{key:"cs",label:"C#"},{key:"css",label:"CSS"},{key:"diff",label:"Diff"},{key:"xml",label:"HTML/XML"},{key:"java",label:"Java"},{key:"javascript",label:"JavaScript"},{key:"markdown",label:"Markdown"},{key:"php",label:"PHP"},{key:"python",label:"Python"},{key:"ruby",label:"Ruby"},{key:"sql",label:"SQL"}]};class Dh extends Cl{static blotName="table";static tagName="TD";static create(e){const i=super.create();return e?i.setAttribute("data-row",e):i.setAttribute("data-row",EZ()),i}static formats(e){if(e.hasAttribute("data-row"))return e.getAttribute("data-row")}cellOffset(){return this.parent?this.parent.children.indexOf(this):-1}format(e,i){e===Dh.blotName&&i?this.domNode.setAttribute("data-row",i):super.format(e,i)}row(){return this.parent}rowOffset(){return this.row()?this.row().rowOffset():-1}table(){return this.row()&&this.row().table()}}class Fw extends aS{static blotName="table-row";static tagName="TR";checkMerge(){if(super.checkMerge()&&this.next.children.head!=null){const e=this.children.head.formats(),i=this.children.tail.formats(),n=this.next.children.head.formats(),r=this.next.children.tail.formats();return e.table===i.table&&e.table===n.table&&e.table===r.table}return!1}optimize(e){super.optimize(e),this.children.forEach(i=>{if(i.next==null)return;const n=i.formats(),r=i.next.formats();if(n.table!==r.table){const a=this.splitAfter(i);a&&a.optimize(),this.prev&&this.prev.optimize()}})}rowOffset(){return this.parent?this.parent.children.indexOf(this):-1}table(){return this.parent&&this.parent.parent}}class ky extends aS{static blotName="table-body";static tagName="TBODY"}class hO extends aS{static blotName="table-container";static tagName="TABLE";balanceCells(){const e=this.descendants(Fw),i=e.reduce((n,r)=>Math.max(r.children.length,n),0);e.forEach(n=>{new Array(i-n.children.length).fill(0).forEach(()=>{let r;n.children.head!=null&&(r=Dh.formats(n.children.head.domNode));const a=this.scroll.create(Dh.blotName,r);n.appendChild(a),a.optimize()})})}cells(e){return this.rows().map(i=>i.children.at(e))}deleteColumn(e){const[i]=this.descendant(ky);i==null||i.children.head==null||i.children.forEach(n=>{const r=n.children.at(e);r?.remove()})}insertColumn(e){const[i]=this.descendant(ky);i==null||i.children.head==null||i.children.forEach(n=>{const r=n.children.at(e),a=Dh.formats(n.children.head.domNode),s=this.scroll.create(Dh.blotName,a);n.insertBefore(s,r)})}insertRow(e){const[i]=this.descendant(ky);if(i==null||i.children.head==null)return;const n=EZ(),r=this.scroll.create(Fw.blotName);i.children.head.children.forEach(()=>{const s=this.scroll.create(Dh.blotName,n);r.appendChild(s)});const a=i.children.at(e);i.insertBefore(r,a)}rows(){const e=this.children.head;return e==null?[]:e.children.map(i=>i)}}hO.allowedChildren=[ky];ky.requiredContainer=hO;ky.allowedChildren=[Fw];Fw.requiredContainer=ky;Fw.allowedChildren=[Dh];Dh.requiredContainer=Fw;function EZ(){return`row-${Math.random().toString(36).slice(2,6)}`}class Twt extends sg{static register(){vt.register(Dh),vt.register(Fw),vt.register(ky),vt.register(hO)}constructor(){super(...arguments),this.listenBalanceCells()}balanceTables(){this.quill.scroll.descendants(hO).forEach(e=>{e.balanceCells()})}deleteColumn(){const[e,,i]=this.getTable();i!=null&&(e.deleteColumn(i.cellOffset()),this.quill.update(vt.sources.USER))}deleteRow(){const[,e]=this.getTable();e!=null&&(e.remove(),this.quill.update(vt.sources.USER))}deleteTable(){const[e]=this.getTable();if(e==null)return;const i=e.offset();e.remove(),this.quill.update(vt.sources.USER),this.quill.setSelection(i,vt.sources.SILENT)}getTable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.quill.getSelection();if(e==null)return[null,null,null,-1];const[i,n]=this.quill.getLine(e.index);if(i==null||i.statics.blotName!==Dh.blotName)return[null,null,null,-1];const r=i.parent;return[r.parent.parent,r,i,n]}insertColumn(e){const i=this.quill.getSelection();if(!i)return;const[n,r,a]=this.getTable(i);if(a==null)return;const s=a.cellOffset();n.insertColumn(s+e),this.quill.update(vt.sources.USER);let o=r.rowOffset();e===0&&(o+=1),this.quill.setSelection(i.index+o,i.length,vt.sources.SILENT)}insertColumnLeft(){this.insertColumn(0)}insertColumnRight(){this.insertColumn(1)}insertRow(e){const i=this.quill.getSelection();if(!i)return;const[n,r,a]=this.getTable(i);if(a==null)return;const s=r.rowOffset();n.insertRow(s+e),this.quill.update(vt.sources.USER),e>0?this.quill.setSelection(i,vt.sources.SILENT):this.quill.setSelection(i.index+r.children.length,i.length,vt.sources.SILENT)}insertRowAbove(){this.insertRow(0)}insertRowBelow(){this.insertRow(1)}insertTable(e,i){const n=this.quill.getSelection();if(n==null)return;const r=new Array(e).fill(0).reduce(a=>{const s=new Array(i).fill(`
`).join("");return a.insert(s,{table:EZ()})},new Ii().retain(n.index));this.quill.updateContents(r,vt.sources.USER),this.quill.setSelection(n.index,vt.sources.SILENT),this.balanceTables()}listenBalanceCells(){this.quill.on(vt.events.SCROLL_OPTIMIZE,e=>{e.some(i=>["TD","TR","TBODY","TABLE"].includes(i.target.tagName)?(this.quill.once(vt.events.TEXT_CHANGE,(n,r,a)=>{a===vt.sources.USER&&this.balanceTables()}),!0):!1)})}}const Ure=Hv("quill:toolbar");let PZ=class extends sg{constructor(e,i){if(super(e,i),Array.isArray(this.options.container)){const n=document.createElement("div");n.setAttribute("role","toolbar"),Uwt(n,this.options.container),e.container?.parentNode?.insertBefore(n,e.container),this.container=n}else typeof this.options.container=="string"?this.container=document.querySelector(this.options.container):this.container=this.options.container;if(!(this.container instanceof HTMLElement)){Ure.error("Container required for toolbar",this.options);return}this.container.classList.add("ql-toolbar"),this.controls=[],this.handlers={},this.options.handlers&&Object.keys(this.options.handlers).forEach(n=>{const r=this.options.handlers?.[n];r&&this.addHandler(n,r)}),Array.from(this.container.querySelectorAll("button, select")).forEach(n=>{this.attach(n)}),this.quill.on(vt.events.EDITOR_CHANGE,()=>{const[n]=this.quill.selection.getRange();this.update(n)})}addHandler(e,i){this.handlers[e]=i}attach(e){let i=Array.from(e.classList).find(r=>r.indexOf("ql-")===0);if(!i)return;if(i=i.slice(3),e.tagName==="BUTTON"&&e.setAttribute("type","button"),this.handlers[i]==null&&this.quill.scroll.query(i)==null){Ure.warn("ignoring attaching to nonexistent format",i,e);return}const n=e.tagName==="SELECT"?"change":"click";e.addEventListener(n,r=>{let a;if(e.tagName==="SELECT"){if(e.selectedIndex<0)return;const o=e.options[e.selectedIndex];o.hasAttribute("selected")?a=!1:a=o.value||!1}else e.classList.contains("ql-active")?a=!1:a=e.value||!e.hasAttribute("value"),r.preventDefault();this.quill.focus();const[s]=this.quill.selection.getRange();if(this.handlers[i]!=null)this.handlers[i].call(this,a);else if(this.quill.scroll.query(i).prototype instanceof Jd){if(a=prompt(`Enter ${i}`),!a)return;this.quill.updateContents(new Ii().retain(s.index).delete(s.length).insert({[i]:a}),vt.sources.USER)}else this.quill.format(i,a,vt.sources.USER);this.update(s)}),this.controls.push([i,e])}update(e){const i=e==null?{}:this.quill.getFormat(e);this.controls.forEach(n=>{const[r,a]=n;if(a.tagName==="SELECT"){let s=null;if(e==null)s=null;else if(i[r]==null)s=a.querySelector("option[selected]");else if(!Array.isArray(i[r])){let o=i[r];typeof o=="string"&&(o=o.replace(/"/g,'\\"')),s=a.querySelector(`option[value="${o}"]`)}s==null?(a.value="",a.selectedIndex=-1):s.selected=!0}else if(e==null)a.classList.remove("ql-active"),a.setAttribute("aria-pressed","false");else if(a.hasAttribute("value")){const s=i[r],o=s===a.getAttribute("value")||s!=null&&s.toString()===a.getAttribute("value")||s==null&&!a.getAttribute("value");a.classList.toggle("ql-active",o),a.setAttribute("aria-pressed",o.toString())}else{const s=i[r]!=null;a.classList.toggle("ql-active",s),a.setAttribute("aria-pressed",s.toString())}})}};PZ.DEFAULTS={};function Dre(t,e,i){const n=document.createElement("button");n.setAttribute("type","button"),n.classList.add(`ql-${e}`),n.setAttribute("aria-pressed","false"),i!=null?(n.value=i,n.setAttribute("aria-label",`${e}: ${i}`)):n.setAttribute("aria-label",e),t.appendChild(n)}function Uwt(t,e){Array.isArray(e[0])||(e=[e]),e.forEach(i=>{const n=document.createElement("span");n.classList.add("ql-formats"),i.forEach(r=>{if(typeof r=="string")Dre(n,r);else{const a=Object.keys(r)[0],s=r[a];Array.isArray(s)?Dwt(n,a,s):Dre(n,a,s)}}),t.appendChild(n)})}function Dwt(t,e,i){const n=document.createElement("select");n.classList.add(`ql-${e}`),i.forEach(r=>{const a=document.createElement("option");r!==!1?a.setAttribute("value",String(r)):a.setAttribute("selected","selected"),n.appendChild(a)}),t.appendChild(n)}PZ.DEFAULTS={container:null,handlers:{clean(){const t=this.quill.getSelection();if(t!=null)if(t.length===0){const e=this.quill.getFormat();Object.keys(e).forEach(i=>{this.quill.scroll.query(i,Ei.INLINE)!=null&&this.quill.format(i,!1,vt.sources.USER)})}else this.quill.removeFormat(t.index,t.length,vt.sources.USER)},direction(t){const{align:e}=this.quill.getFormat();t==="rtl"&&e==null?this.quill.format("align","right",vt.sources.USER):!t&&e==="right"&&this.quill.format("align",!1,vt.sources.USER),this.quill.format("direction",t,vt.sources.USER)},indent(t){const e=this.quill.getSelection(),i=this.quill.getFormat(e),n=parseInt(i.indent||0,10);if(t==="+1"||t==="-1"){let r=t==="+1"?1:-1;i.direction==="rtl"&&(r*=-1),this.quill.format("indent",n+r,vt.sources.USER)}},link(t){t===!0&&(t=prompt("Enter link URL:")),this.quill.format("link",t,vt.sources.USER)},list(t){const e=this.quill.getSelection(),i=this.quill.getFormat(e);t==="check"?i.list==="checked"||i.list==="unchecked"?this.quill.format("list",!1,vt.sources.USER):this.quill.format("list","unchecked",vt.sources.USER):this.quill.format("list",t,vt.sources.USER)}}};const Ewt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="13" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="9" y1="4" y2="4"/></svg>',Pwt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="14" x2="4" y1="14" y2="14"/><line class="ql-stroke" x1="12" x2="6" y1="4" y2="4"/></svg>',Cwt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="5" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="9" y1="4" y2="4"/></svg>',Rwt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="3" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="3" y1="4" y2="4"/></svg>',Mwt='<svg viewbox="0 0 18 18"><g class="ql-fill ql-color-label"><polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"/><rect height="1" width="1" x="4" y="4"/><polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"/><rect height="1" width="1" x="2" y="6"/><rect height="1" width="1" x="3" y="5"/><rect height="1" width="1" x="4" y="7"/><polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"/><rect height="1" width="1" x="2" y="12"/><rect height="1" width="1" x="2" y="9"/><rect height="1" width="1" x="2" y="15"/><polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"/><rect height="1" width="1" x="3" y="8"/><path d="M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z"/><path d="M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z"/><path d="M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z"/><rect height="1" width="1" x="12" y="2"/><rect height="1" width="1" x="11" y="3"/><path d="M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z"/><rect height="1" width="1" x="2" y="3"/><rect height="1" width="1" x="6" y="2"/><rect height="1" width="1" x="3" y="2"/><rect height="1" width="1" x="5" y="3"/><rect height="1" width="1" x="9" y="2"/><rect height="1" width="1" x="15" y="14"/><polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"/><rect height="1" width="1" x="13" y="7"/><rect height="1" width="1" x="15" y="5"/><rect height="1" width="1" x="14" y="6"/><rect height="1" width="1" x="15" y="8"/><rect height="1" width="1" x="14" y="9"/><path d="M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z"/><rect height="1" width="1" x="14" y="3"/><polygon points="12 6.868 12 6 11.62 6 12 6.868"/><rect height="1" width="1" x="15" y="2"/><rect height="1" width="1" x="12" y="5"/><rect height="1" width="1" x="13" y="4"/><polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"/><rect height="1" width="1" x="9" y="14"/><rect height="1" width="1" x="8" y="15"/><path d="M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z"/><rect height="1" width="1" x="5" y="15"/><path d="M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z"/><rect height="1" width="1" x="11" y="15"/><path d="M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z"/><rect height="1" width="1" x="14" y="15"/><rect height="1" width="1" x="15" y="11"/></g><polyline class="ql-stroke" points="5.5 13 9 5 12.5 13"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="11" y2="11"/></svg>',Nwt='<svg viewbox="0 0 18 18"><rect class="ql-fill ql-stroke" height="3" width="3" x="4" y="5"/><rect class="ql-fill ql-stroke" height="3" width="3" x="11" y="5"/><path class="ql-even ql-fill ql-stroke" d="M7,8c0,4.031-3,5-3,5"/><path class="ql-even ql-fill ql-stroke" d="M14,8c0,4.031-3,5-3,5"/></svg>',Awt='<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z"/><path class="ql-stroke" d="M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z"/></svg>',_wt='<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="5" x2="13" y1="3" y2="3"/><line class="ql-stroke" x1="6" x2="9.35" y1="12" y2="3"/><line class="ql-stroke" x1="11" x2="15" y1="11" y2="15"/><line class="ql-stroke" x1="15" x2="11" y1="11" y2="15"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="7" x="2" y="14"/></svg>',Ere='<svg viewbox="0 0 18 18"><polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"/><polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"/><line class="ql-stroke" x1="10" x2="8" y1="5" y2="13"/></svg>',kwt='<svg viewbox="0 0 18 18"><line class="ql-color-label ql-stroke ql-transparent" x1="3" x2="15" y1="15" y2="15"/><polyline class="ql-stroke" points="5.5 11 9 3 12.5 11"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="9" y2="9"/></svg>',xwt='<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"/><line class="ql-stroke ql-fill" x1="15" x2="11" y1="4" y2="4"/><path class="ql-fill" d="M11,3a3,3,0,0,0,0,6h1V3H11Z"/><rect class="ql-fill" height="11" width="1" x="11" y="4"/><rect class="ql-fill" height="11" width="1" x="13" y="4"/></svg>',Owt='<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"/><line class="ql-stroke ql-fill" x1="9" x2="5" y1="4" y2="4"/><path class="ql-fill" d="M5,3A3,3,0,0,0,5,9H6V3H5Z"/><rect class="ql-fill" height="11" width="1" x="5" y="4"/><rect class="ql-fill" height="11" width="1" x="7" y="4"/></svg>',Lwt='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z"/><rect class="ql-fill" height="1.6" rx="0.8" ry="0.8" width="5" x="5.15" y="6.2"/><path class="ql-fill" d="M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z"/></svg>',Fwt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z"/></svg>',$wt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',Bwt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.65186,12.30664a2.6742,2.6742,0,0,1-2.915,2.68457,3.96592,3.96592,0,0,1-2.25537-.6709.56007.56007,0,0,1-.13232-.83594L11.64648,13c.209-.34082.48389-.36328.82471-.1543a2.32654,2.32654,0,0,0,1.12256.33008c.71484,0,1.12207-.35156,1.12207-.78125,0-.61523-.61621-.86816-1.46338-.86816H13.2085a.65159.65159,0,0,1-.68213-.41895l-.05518-.10937a.67114.67114,0,0,1,.14307-.78125l.71533-.86914a8.55289,8.55289,0,0,1,.68213-.7373V8.58887a3.93913,3.93913,0,0,1-.748.05469H11.9873a.54085.54085,0,0,1-.605-.60547V7.59863a.54085.54085,0,0,1,.605-.60547h3.75146a.53773.53773,0,0,1,.60547.59375v.17676a1.03723,1.03723,0,0,1-.27539.748L14.74854,10.0293A2.31132,2.31132,0,0,1,16.65186,12.30664ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',Vwt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm7.05371,7.96582v.38477c0,.39648-.165.60547-.46191.60547h-.47314v1.29785a.54085.54085,0,0,1-.605.60547h-.69336a.54085.54085,0,0,1-.605-.60547V12.95605H11.333a.5412.5412,0,0,1-.60547-.60547v-.15332a1.199,1.199,0,0,1,.22021-.748l2.56348-4.05957a.7819.7819,0,0,1,.72607-.39648h1.27637a.54085.54085,0,0,1,.605.60547v3.7627h.33008A.54055.54055,0,0,1,17.05371,11.96582ZM14.28125,8.7207h-.022a4.18969,4.18969,0,0,1-.38525.81348l-1.188,1.80469v.02246h1.5293V9.60059A7.04058,7.04058,0,0,1,14.28125,8.7207Z"/></svg>',jwt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.74023,12.18555a2.75131,2.75131,0,0,1-2.91553,2.80566,3.908,3.908,0,0,1-2.25537-.68164.54809.54809,0,0,1-.13184-.8252L11.73438,13c.209-.34082.48389-.36328.8252-.1543a2.23757,2.23757,0,0,0,1.1001.33008,1.01827,1.01827,0,0,0,1.1001-.96777c0-.61621-.53906-.97949-1.25439-.97949a2.15554,2.15554,0,0,0-.64893.09961,1.15209,1.15209,0,0,1-.814.01074l-.12109-.04395a.64116.64116,0,0,1-.45117-.71484l.231-3.00391a.56666.56666,0,0,1,.62744-.583H15.541a.54085.54085,0,0,1,.605.60547v.43945a.54085.54085,0,0,1-.605.60547H13.41748l-.04395.72559a1.29306,1.29306,0,0,1-.04395.30859h.022a2.39776,2.39776,0,0,1,.57227-.07715A2.53266,2.53266,0,0,1,16.74023,12.18555ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',Gwt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M14.51758,9.64453a1.85627,1.85627,0,0,0-1.24316.38477H13.252a1.73532,1.73532,0,0,1,1.72754-1.4082,2.66491,2.66491,0,0,1,.5498.06641c.35254.05469.57227.01074.70508-.40723l.16406-.5166a.53393.53393,0,0,0-.373-.75977,4.83723,4.83723,0,0,0-1.17773-.14258c-2.43164,0-3.7627,2.17773-3.7627,4.43359,0,2.47559,1.60645,3.69629,3.19043,3.69629A2.70585,2.70585,0,0,0,16.96,12.19727,2.43861,2.43861,0,0,0,14.51758,9.64453Zm-.23047,3.58691c-.67187,0-1.22168-.81445-1.22168-1.45215,0-.47363.30762-.583.72559-.583.96875,0,1.27734.59375,1.27734,1.12207A.82182.82182,0,0,1,14.28711,13.23145ZM10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Z"/></svg>',Hwt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="13" y1="4" y2="4"/><line class="ql-stroke" x1="5" x2="11" y1="14" y2="14"/><line class="ql-stroke" x1="8" x2="10" y1="14" y2="4"/></svg>',zwt='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="10" width="12" x="3" y="4"/><circle class="ql-fill" cx="6" cy="7" r="1"/><polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"/></svg>',qwt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"/></svg>',Wwt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="5 7 5 11 3 9 5 7"/></svg>',Ywt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="11" y1="7" y2="11"/><path class="ql-even ql-stroke" d="M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z"/><path class="ql-even ql-stroke" d="M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z"/></svg>',Kwt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="6" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="6" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="6" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="3" y1="4" y2="4"/><line class="ql-stroke" x1="3" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="3" y1="14" y2="14"/></svg>',Zwt='<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="9" x2="15" y1="4" y2="4"/><polyline class="ql-stroke" points="3 4 4 5 6 3"/><line class="ql-stroke" x1="9" x2="15" y1="14" y2="14"/><polyline class="ql-stroke" points="3 14 4 15 6 13"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="3 9 4 10 6 8"/></svg>',Xwt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="7" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="7" x2="15" y1="14" y2="14"/><line class="ql-stroke ql-thin" x1="2.5" x2="4.5" y1="5.5" y2="5.5"/><path class="ql-fill" d="M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z"/><path class="ql-stroke ql-thin" d="M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156"/><path class="ql-stroke ql-thin" d="M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109"/></svg>',Jwt='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z"/><path class="ql-fill" d="M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z"/></svg>',Qwt='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z"/><path class="ql-fill" d="M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z"/></svg>',e0t='<svg viewbox="0 0 18 18"><line class="ql-stroke ql-thin" x1="15.5" x2="2.5" y1="8.5" y2="9.5"/><path class="ql-fill" d="M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z"/><path class="ql-fill" d="M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z"/></svg>',t0t='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="2" width="3" x="5" y="5"/><rect class="ql-fill" height="2" width="4" x="9" y="5"/><g class="ql-fill ql-transparent"><rect height="2" width="3" x="5" y="8"/><rect height="2" width="4" x="9" y="8"/><rect height="2" width="3" x="5" y="11"/><rect height="2" width="4" x="9" y="11"/></g></svg>',i0t='<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="12" x="3" y="15"/></svg>',n0t='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="12" width="1" x="5" y="3"/><rect class="ql-fill" height="12" width="1" x="12" y="3"/><rect class="ql-fill" height="2" width="8" x="5" y="8"/><rect class="ql-fill" height="1" width="3" x="3" y="5"/><rect class="ql-fill" height="1" width="3" x="3" y="7"/><rect class="ql-fill" height="1" width="3" x="3" y="10"/><rect class="ql-fill" height="1" width="3" x="3" y="12"/><rect class="ql-fill" height="1" width="3" x="12" y="5"/><rect class="ql-fill" height="1" width="3" x="12" y="7"/><rect class="ql-fill" height="1" width="3" x="12" y="10"/><rect class="ql-fill" height="1" width="3" x="12" y="12"/></svg>',R1={align:{"":Ewt,center:Pwt,right:Cwt,justify:Rwt},background:Mwt,blockquote:Nwt,bold:Awt,clean:_wt,code:Ere,"code-block":Ere,color:kwt,direction:{"":xwt,rtl:Owt},formula:Lwt,header:{1:Fwt,2:$wt,3:Bwt,4:Vwt,5:jwt,6:Gwt},italic:Hwt,image:zwt,indent:{"+1":qwt,"-1":Wwt},link:Ywt,list:{bullet:Kwt,check:Zwt,ordered:Xwt},script:{sub:Jwt,super:Qwt},strike:e0t,table:t0t,underline:i0t,video:n0t},r0t='<svg viewbox="0 0 18 18"><polygon class="ql-stroke" points="7 11 9 13 11 11 7 11"/><polygon class="ql-stroke" points="7 7 9 5 11 7 7 7"/></svg>';let Pre=0;function Cre(t,e){t.setAttribute(e,`${t.getAttribute(e)!=="true"}`)}class k2{constructor(e){this.select=e,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",()=>{this.togglePicker()}),this.label.addEventListener("keydown",i=>{switch(i.key){case"Enter":this.togglePicker();break;case"Escape":this.escape(),i.preventDefault();break}}),this.select.addEventListener("change",this.update.bind(this))}togglePicker(){this.container.classList.toggle("ql-expanded"),Cre(this.label,"aria-expanded"),Cre(this.options,"aria-hidden")}buildItem(e){const i=document.createElement("span");i.tabIndex="0",i.setAttribute("role","button"),i.classList.add("ql-picker-item");const n=e.getAttribute("value");return n&&i.setAttribute("data-value",n),e.textContent&&i.setAttribute("data-label",e.textContent),i.addEventListener("click",()=>{this.selectItem(i,!0)}),i.addEventListener("keydown",r=>{switch(r.key){case"Enter":this.selectItem(i,!0),r.preventDefault();break;case"Escape":this.escape(),r.preventDefault();break}}),i}buildLabel(){const e=document.createElement("span");return e.classList.add("ql-picker-label"),e.innerHTML=r0t,e.tabIndex="0",e.setAttribute("role","button"),e.setAttribute("aria-expanded","false"),this.container.appendChild(e),e}buildOptions(){const e=document.createElement("span");e.classList.add("ql-picker-options"),e.setAttribute("aria-hidden","true"),e.tabIndex="-1",e.id=`ql-picker-options-${Pre}`,Pre+=1,this.label.setAttribute("aria-controls",e.id),this.options=e,Array.from(this.select.options).forEach(i=>{const n=this.buildItem(i);e.appendChild(n),i.selected===!0&&this.selectItem(n)}),this.container.appendChild(e)}buildPicker(){Array.from(this.select.attributes).forEach(e=>{this.container.setAttribute(e.name,e.value)}),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}escape(){this.close(),setTimeout(()=>this.label.focus(),1)}close(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}selectItem(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const n=this.container.querySelector(".ql-selected");e!==n&&(n?.classList.remove("ql-selected"),e!=null&&(e.classList.add("ql-selected"),this.select.selectedIndex=Array.from(e.parentNode.children).indexOf(e),e.hasAttribute("data-value")?this.label.setAttribute("data-value",e.getAttribute("data-value")):this.label.removeAttribute("data-value"),e.hasAttribute("data-label")?this.label.setAttribute("data-label",e.getAttribute("data-label")):this.label.removeAttribute("data-label"),i&&(this.select.dispatchEvent(new Event("change")),this.close())))}update(){let e;if(this.select.selectedIndex>-1){const n=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];e=this.select.options[this.select.selectedIndex],this.selectItem(n)}else this.selectItem(null);const i=e!=null&&e!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",i)}}class YRe extends k2{constructor(e,i){super(e),this.label.innerHTML=i,this.container.classList.add("ql-color-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).slice(0,7).forEach(n=>{n.classList.add("ql-primary")})}buildItem(e){const i=super.buildItem(e);return i.style.backgroundColor=e.getAttribute("value")||"",i}selectItem(e,i){super.selectItem(e,i);const n=this.label.querySelector(".ql-color-label"),r=e&&e.getAttribute("data-value")||"";n&&(n.tagName==="line"?n.style.stroke=r:n.style.fill=r)}}class KRe extends k2{constructor(e,i){super(e),this.container.classList.add("ql-icon-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).forEach(n=>{n.innerHTML=i[n.getAttribute("data-value")||""]}),this.defaultItem=this.container.querySelector(".ql-selected"),this.selectItem(this.defaultItem)}selectItem(e,i){super.selectItem(e,i);const n=e||this.defaultItem;if(n!=null){if(this.label.innerHTML===n.innerHTML)return;this.label.innerHTML=n.innerHTML}}}const a0t=t=>{const{overflowY:e}=getComputedStyle(t,null);return e!=="visible"&&e!=="clip"};class ZRe{constructor(e,i){this.quill=e,this.boundsContainer=i||document.body,this.root=e.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,a0t(this.quill.root)&&this.quill.root.addEventListener("scroll",()=>{this.root.style.marginTop=`${-1*this.quill.root.scrollTop}px`}),this.hide()}hide(){this.root.classList.add("ql-hidden")}position(e){const i=e.left+e.width/2-this.root.offsetWidth/2,n=e.bottom+this.quill.root.scrollTop;this.root.style.left=`${i}px`,this.root.style.top=`${n}px`,this.root.classList.remove("ql-flip");const r=this.boundsContainer.getBoundingClientRect(),a=this.root.getBoundingClientRect();let s=0;if(a.right>r.right&&(s=r.right-a.right,this.root.style.left=`${i+s}px`),a.left<r.left&&(s=r.left-a.left,this.root.style.left=`${i+s}px`),a.bottom>r.bottom){const o=a.bottom-a.top,l=e.bottom-e.top+o;this.root.style.top=`${n-l}px`,this.root.classList.add("ql-flip")}return s}show(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}}const s0t=[!1,"center","right","justify"],o0t=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],l0t=[!1,"serif","monospace"],u0t=["1","2","3",!1],c0t=["small",!1,"large","huge"];class VN extends dE{constructor(e,i){super(e,i);const n=r=>{if(!document.body.contains(e.root)){document.body.removeEventListener("click",n);return}this.tooltip!=null&&!this.tooltip.root.contains(r.target)&&document.activeElement!==this.tooltip.textbox&&!this.quill.hasFocus()&&this.tooltip.hide(),this.pickers!=null&&this.pickers.forEach(a=>{a.container.contains(r.target)||a.close()})};e.emitter.listenDOM("click",document.body,n)}addModule(e){const i=super.addModule(e);return e==="toolbar"&&this.extendToolbar(i),i}buildButtons(e,i){Array.from(e).forEach(n=>{(n.getAttribute("class")||"").split(/\s+/).forEach(a=>{if(a.startsWith("ql-")&&(a=a.slice(3),i[a]!=null))if(a==="direction")n.innerHTML=i[a][""]+i[a].rtl;else if(typeof i[a]=="string")n.innerHTML=i[a];else{const s=n.value||"";s!=null&&i[a][s]&&(n.innerHTML=i[a][s])}})})}buildPickers(e,i){this.pickers=Array.from(e).map(r=>{if(r.classList.contains("ql-align")&&(r.querySelector("option")==null&&BE(r,s0t),typeof i.align=="object"))return new KRe(r,i.align);if(r.classList.contains("ql-background")||r.classList.contains("ql-color")){const a=r.classList.contains("ql-background")?"background":"color";return r.querySelector("option")==null&&BE(r,o0t,a==="background"?"#ffffff":"#000000"),new YRe(r,i[a])}return r.querySelector("option")==null&&(r.classList.contains("ql-font")?BE(r,l0t):r.classList.contains("ql-header")?BE(r,u0t):r.classList.contains("ql-size")&&BE(r,c0t)),new k2(r)});const n=()=>{this.pickers.forEach(r=>{r.update()})};this.quill.on(vi.events.EDITOR_CHANGE,n)}}VN.DEFAULTS=_y({},dE.DEFAULTS,{modules:{toolbar:{handlers:{formula(){this.quill.theme.tooltip.edit("formula")},image(){let t=this.container.querySelector("input.ql-image[type=file]");t==null&&(t=document.createElement("input"),t.setAttribute("type","file"),t.setAttribute("accept",this.quill.uploader.options.mimetypes.join(", ")),t.classList.add("ql-image"),t.addEventListener("change",()=>{const e=this.quill.getSelection(!0);this.quill.uploader.upload(e,t.files),t.value=""}),this.container.appendChild(t)),t.click()},video(){this.quill.theme.tooltip.edit("video")}}}}});class XRe extends ZRe{constructor(e,i){super(e,i),this.textbox=this.root.querySelector('input[type="text"]'),this.listen()}listen(){this.textbox.addEventListener("keydown",e=>{e.key==="Enter"?(this.save(),e.preventDefault()):e.key==="Escape"&&(this.cancel(),e.preventDefault())})}cancel(){this.hide(),this.restoreFocus()}edit(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"link",i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),this.textbox==null)return;i!=null?this.textbox.value=i:e!==this.root.getAttribute("data-mode")&&(this.textbox.value="");const n=this.quill.getBounds(this.quill.selection.savedRange);n!=null&&this.position(n),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute(`data-${e}`)||""),this.root.setAttribute("data-mode",e)}restoreFocus(){this.quill.focus({preventScroll:!0})}save(){let{value:e}=this.textbox;switch(this.root.getAttribute("data-mode")){case"link":{const{scrollTop:i}=this.quill.root;this.linkRange?(this.quill.formatText(this.linkRange,"link",e,vi.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",e,vi.sources.USER)),this.quill.root.scrollTop=i;break}case"video":e=d0t(e);case"formula":{if(!e)break;const i=this.quill.getSelection(!0);if(i!=null){const n=i.index+i.length;this.quill.insertEmbed(n,this.root.getAttribute("data-mode"),e,vi.sources.USER),this.root.getAttribute("data-mode")==="formula"&&this.quill.insertText(n+1," ",vi.sources.USER),this.quill.setSelection(n+2,vi.sources.USER)}break}}this.textbox.value="",this.hide()}}function d0t(t){let e=t.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||t.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return e?`${e[1]||"https"}://www.youtube.com/embed/${e[2]}?showinfo=0`:(e=t.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?`${e[1]||"https"}://player.vimeo.com/video/${e[2]}/`:t}function BE(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;e.forEach(n=>{const r=document.createElement("option");n===i?r.setAttribute("selected","selected"):r.setAttribute("value",String(n)),t.appendChild(r)})}const p0t=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]];class h0t extends XRe{static TEMPLATE=['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join("");constructor(e,i){super(e,i),this.quill.on(vi.events.EDITOR_CHANGE,(n,r,a,s)=>{if(n===vi.events.SELECTION_CHANGE)if(r!=null&&r.length>0&&s===vi.sources.USER){this.show(),this.root.style.left="0px",this.root.style.width="",this.root.style.width=`${this.root.offsetWidth}px`;const o=this.quill.getLines(r.index,r.length);if(o.length===1){const l=this.quill.getBounds(r);l!=null&&this.position(l)}else{const l=o[o.length-1],u=this.quill.getIndex(l),c=Math.min(l.length()-1,r.index+r.length-u),d=this.quill.getBounds(new Lw(u,c));d!=null&&this.position(d)}}else document.activeElement!==this.textbox&&this.quill.hasFocus()&&this.hide()})}listen(){super.listen(),this.root.querySelector(".ql-close").addEventListener("click",()=>{this.root.classList.remove("ql-editing")}),this.quill.on(vi.events.SCROLL_OPTIMIZE,()=>{setTimeout(()=>{if(this.root.classList.contains("ql-hidden"))return;const e=this.quill.getSelection();if(e!=null){const i=this.quill.getBounds(e);i!=null&&this.position(i)}},1)})}cancel(){this.show()}position(e){const i=super.position(e),n=this.root.querySelector(".ql-tooltip-arrow");return n.style.marginLeft="",i!==0&&(n.style.marginLeft=`${-1*i-n.offsetWidth/2}px`),i}}class JRe extends VN{constructor(e,i){i.modules.toolbar!=null&&i.modules.toolbar.container==null&&(i.modules.toolbar.container=p0t),super(e,i),this.quill.container.classList.add("ql-bubble")}extendToolbar(e){this.tooltip=new h0t(this.quill,this.options.bounds),e.container!=null&&(this.tooltip.root.appendChild(e.container),this.buildButtons(e.container.querySelectorAll("button"),R1),this.buildPickers(e.container.querySelectorAll("select"),R1))}}JRe.DEFAULTS=_y({},VN.DEFAULTS,{modules:{toolbar:{handlers:{link(t){t?this.quill.theme.tooltip.edit():this.quill.format("link",!1,vt.sources.USER)}}}}});const f0t=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]];class m0t extends XRe{static TEMPLATE=['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join("");preview=this.root.querySelector("a.ql-preview");listen(){super.listen(),this.root.querySelector("a.ql-action").addEventListener("click",e=>{this.root.classList.contains("ql-editing")?this.save():this.edit("link",this.preview.textContent),e.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",e=>{if(this.linkRange!=null){const i=this.linkRange;this.restoreFocus(),this.quill.formatText(i,"link",!1,vi.sources.USER),delete this.linkRange}e.preventDefault(),this.hide()}),this.quill.on(vi.events.SELECTION_CHANGE,(e,i,n)=>{if(e!=null){if(e.length===0&&n===vi.sources.USER){const[r,a]=this.quill.scroll.descendant(pO,e.index);if(r!=null){this.linkRange=new Lw(e.index-a,r.length());const s=pO.formats(r.domNode);this.preview.textContent=s,this.preview.setAttribute("href",s),this.show();const o=this.quill.getBounds(this.linkRange);o!=null&&this.position(o);return}}else delete this.linkRange;this.hide()}})}show(){super.show(),this.root.removeAttribute("data-mode")}}class QRe extends VN{constructor(e,i){i.modules.toolbar!=null&&i.modules.toolbar.container==null&&(i.modules.toolbar.container=f0t),super(e,i),this.quill.container.classList.add("ql-snow")}extendToolbar(e){e.container!=null&&(e.container.classList.add("ql-snow"),this.buildButtons(e.container.querySelectorAll("button"),R1),this.buildPickers(e.container.querySelectorAll("select"),R1),this.tooltip=new m0t(this.quill,this.options.bounds),e.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"k",shortKey:!0},(i,n)=>{e.handlers.link.call(e,!n.format.link)}))}}QRe.DEFAULTS=_y({},VN.DEFAULTS,{modules:{toolbar:{handlers:{link(t){if(t){const e=this.quill.getSelection();if(e==null||e.length===0)return;let i=this.quill.getText(e);/^\S+@\S+\.\S+$/.test(i)&&i.indexOf("mailto:")!==0&&(i=`mailto:${i}`);const{tooltip:n}=this.quill.theme;n.edit("link",i)}else this.quill.format("link",!1,vt.sources.USER)}}}}});vt.register({"attributors/attribute/direction":ORe,"attributors/class/align":_Re,"attributors/class/background":IIt,"attributors/class/color":bIt,"attributors/class/direction":LRe,"attributors/class/font":BRe,"attributors/class/size":jRe,"attributors/style/align":kRe,"attributors/style/background":IZ,"attributors/style/color":bZ,"attributors/style/direction":FRe,"attributors/style/font":VRe,"attributors/style/size":GRe},!0);vt.register({"formats/align":_Re,"formats/direction":LRe,"formats/indent":pwt,"formats/background":IZ,"formats/color":bZ,"formats/font":BRe,"formats/size":jRe,"formats/blockquote":hwt,"formats/code-block":zu,"formats/header":fwt,"formats/list":BN,"formats/bold":DZ,"formats/code":wZ,"formats/italic":mwt,"formats/link":pO,"formats/script":gwt,"formats/strike":vwt,"formats/underline":ywt,"formats/formula":bwt,"formats/image":Iwt,"formats/video":wwt,"modules/syntax":WRe,"modules/table":Twt,"modules/toolbar":PZ,"themes/bubble":JRe,"themes/snow":QRe,"ui/icons":R1,"ui/picker":k2,"ui/icon-picker":KRe,"ui/color-picker":YRe,"ui/tooltip":ZRe},!0);function g0t({controlAnchor:t}){const e={editing:!1};return wo({target:t,items:[{label:"Tournament image",onClick:hmt,id:"tournamentImage",location:ti,intent:"none"},{label:"Edit overview",onClick:()=>{const r=document.getElementById("editOverview"),a=document.getElementById("notes");if(!(!r||!a)){if(r.innerHTML=e.editing?"Edit overview":"Save overview",e.editing){a.previousElementSibling&&a.previousElementSibling.remove(),a.style.border="none";const s=a.querySelector(".ql-editor"),l=s?.innerText?.replace(`
`,"")?s.innerHTML:"";Js(a),a.innerHTML=l,Wt({methods:[{method:eQe,params:{notes:l}}]})}else{a.style.border=".5px solid",a.style.borderTop="";const s=new vt("#notes",{modules:{toolbar:[[{header:[1,2,3,4,5,6,!1]}],[{font:[]}],["bold","italic","underline"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["blockquote","code-block","link","video"],["clean"]]},theme:"snow"});It.quill=s}e.editing=!e.editing}},id:"editOverview",location:ti,intent:"none"}]})?.elements}function v0t({tournamentName:t}){const e=document.getElementById(TD);if(!e)return;e.style.minHeight=`${window.innerHeight*.9}px`,Js(e);const i=document.createElement("div");i.style.fontWeight="bold",i.className="block",i.innerHTML=zi.device.isMobile?t??"Tournament overview":"Tournament overview",e.appendChild(i);const n=document.createElement("div");e.appendChild(n);const r=nt.getTournament().tournamentRecord?.notes,a=document.createElement("div");a.className="ql-container ql-snow",a.style.border="none",a.innerHTML=r??"",a.id="notes",e.appendChild(a),g0t({controlAnchor:n})}let xU;function x2(t){YA(vP,t),YA(RC,t),YA(tf,t),YA(zF,t);const e=document.getElementById("trnynav"),i=document.getElementById("dnav");[vP,tf].includes(t)?(e&&(e.style.display=t===vP?"":Rt),i&&(i.style.display="")):i&&(i.style.display=Rt)}function YA(t,e){const i=t===e,n=document.getElementById(t);n&&(n.style.display=i?"flex":"none")}const Gj=()=>{const t=document.getElementById("dnav");t&&(t.style.display=Rt),xU=RC,x2(RC)},y0t=t=>{xU=t,x2(vP)},b0t=()=>{const t=document.getElementById("pageTitle");t&&(t.innerHTML="<div class='tmx-title'>Tournaments</div>"),xU=tf,x2(xU)},I0t=()=>{xU=zF,x2(xU)};function w0t({config:t}={}){const{tournamentRecord:e}=nt.getTournament();e?.tournamentId===t.tournamentId?eMe(t):(It.ee.emit(UPe,It.tournamentId),Hu.findTournament(t.tournamentId).then(i=>aq({tournamentRecord:i,config:t})))}function Hj({config:t}){y0t(As),ept(),iZ(t.selectedTab),eMe(t)}function eMe(t){const{selectedTab:e=Tm}=t;Ige(e)&&(e===Tm&&eot({participantView:t.participantView}),e===ib&&e1e({scheduledDate:t.scheduledDate}),e===TD&&v0t({tournamentName:nt.getTournamentInfo().tournamentInfo?.tournamentName}),e===wh&&pmt(t),e===p6&&Ydt(),e===h6&&gpt())}function aq({tournamentRecord:t,config:e}){const n=tc()?.provider||It?.provider,r=()=>{Ht({message:"Tournament not found",onClose:()=>{It.router.navigate("/tournaments")},intent:"is-warning",pauseOnHover:!0})},a=s=>{const o=s?.data?.tournamentRecords?.[e.tournamentId];o?(nt.setState(o),Hj({config:e})):r()};if(n){const s=()=>{t?(nt.setState(t),Hj({config:e})):r()};if(e.tournamentId){if(t?.timeItems?.find(({itemType:l})=>l==="TMX")?.itemValue?.offline)return s();JF({tournamentId:e.tournamentId}).then(a,s)}}else nt.setState(t),Hj({config:e})}const Rre={addDrawDefinition:t=>ds("addDrawDefinition",t),addMatchUps:t=>ds("addMatchUps",t),addParticipants:t=>ds("addParticipants",t),addVenue:t=>ds("addVenue",t),deletedDrawIds:t=>ds("deletedDrawIds",t),deletedMatchUpIds:t=>ds("deletedMatchUpIds",t),deleteVenue:t=>ds("deleteVenue",t),modifyDrawDefinition:t=>ds("modifyDrawDefinition",t),modifyDrawEntries:t=>ds("modifyDrawEntries",t),modifyEventEntries:t=>ds("modifyEventEntries",t),modifyMatchUp:t=>ds("modifyMatchUp",t),modifyParticipants:t=>ds("modifyParticipants",t),modifyPositionAssignments:t=>ds("modifyPositionAssignments",t),modifySeedAssignments:t=>ds("modifySeedAssignments",t),modifyVenue:t=>ds("modifyVenue",t),publishEvent:t=>ds("publishEvent",t),publishEventSeeding:t=>ds("publishEventSeeding",t),publishOrderOfPlay:t=>ds("publishOrderOfPlay",t),unPublishEvent:t=>ds("unPublishEvent",t),unPublishEventSeeding:t=>ds("unPublishEventSeeding",t),unPublishOrderOfPlay:t=>ds("unPublishOrderOfPlay",t),updateInContextMatchUp:t=>ds("updateInContextMatchUp",t),modifyTournamentDetail:t=>ds("modifyTournamentDetail",t)};function ds(t,e){return typeof window.dev?.subs?.[t]=="function"?window.dev.subs[t](e):(window.dev.allSubscriptions||window.dev.subs?.[t])&&console.log(t,e)}function tMe(){if(!window.dev)console.log("%c dev initialized","color: yellow"),window.dev={};else return;const t=()=>console.log("set window.socketURL for messaging"),e=r=>{if(!Array.isArray(r)){Ht({message:"missing methods array",intent:"is-danger"});return}nt.getTournament().tournamentRecord?.tournamentId?Wt({methods:r,callback:o=>{if(o?.success){Ht({message:"success",intent:"is-success"});const l=nt.getTournament().tournamentRecord;aq({tournamentRecord:l,config:{selectedTab:As}})}else Ht({message:o?.error?.message??"error",intent:"is-danger"}),console.log({result:o})}}):Ht({message:"missing tournament",intent:"is-danger"})},i=r=>{JF({tournamentId:r}).then(a=>{if(a?.error)console.log({error:a.error});else{const s=a?.data?.tournamentRecords?.[r];s&&aq({tournamentRecord:s,config:{selectedTab:As}})}})},n=Object.assign({},...Object.keys(Rre).map(r=>({[r]:!1})));KA({getProviders:kC,getProvider:r=>kC().then(a=>console.log(a?.data?.providers.find(s=>s.value.organisationName.toLowerCase().includes(r.toLowerCase())))),getTournament:()=>nt.getTournament()?.tournamentRecord,getContext:cT.getDevContext,tournamentEngine:nt,context:cT.setDevContext,generateMockTournament:T0t,modifyTournament:e,fetchTournament:i,sendTournament:wP,getLoginState:tc,getUsers:Yge,factory:QG,baseApi:oc,dayjs:GK,help:t,subs:n}),KA({connectSocket:$Pe,disconnectSocket:f2,emitTmx:jK}),KA({tmx2db:Hu,load:S0t,exportTournamentRecord:tat}),KA({env:zi,tournamentContext:It}),cT.setSubscriptions({subscriptions:Rre})}function KA(t){if(kp(window.dev))try{Object.keys(t).forEach(e=>window.dev[e]=t[e])}catch(e){Ht({message:"An error occurred while adding dev variables",intent:"is-danger"}),console.error("Error adding dev variables:",e)}}function S0t(t){if(typeof t=="object"){const e=t.tournamentRecord||t;e?.tournamentId&&iMe(e)}}function T0t(t){const{tournamentRecord:e,error:i}=tM.generateTournamentRecord(t);i?console.log({error:i}):iMe(e)}function iMe(t){const e=t?.tournamentId;FEe({tournamentRecord:t,callback:()=>It.router.navigate(`/${As}/${e}`)})}class sP extends Error{}sP.prototype.name="InvalidTokenError";function U0t(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,i)=>{let n=i.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function D0t(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return U0t(e)}catch{return atob(e)}}function E0t(t,e){if(typeof t!="string")throw new sP("Invalid token specified: must be a string");e||(e={});const i=e.header===!0?0:1,n=t.split(".")[i];if(typeof n!="string")throw new sP(`Invalid token specified: missing part #${i+1}`);let r;try{r=D0t(n)}catch(a){throw new sP(`Invalid token specified: invalid base64 for part #${i+1} (${a.message})`)}try{return JSON.parse(r)}catch(a){throw new sP(`Invalid token specified: invalid json for part #${i+1} (${a.message})`)}}function nMe(t){if(!t||t==="undefined"){zPe();return}let e;try{e=E0t(t)}catch{OEe();return}const i=new Date;return e?.exp<i.getTime()/1e3?CZ():((e?.permissions?.includes("devMode")||e?.roles?.includes("develope"))&&tMe(),e)}function Mre(t){const{callback:e,provider:i}=t||{},n=i?.onlineResources?.find(m=>m.name==="providerImage"&&m.resourceType==="URL"&&m.resourceSubType==="IMAGE");let r,a;const s=i||{},o=()=>{const m=document.getElementById("providerImagePreview");m&&(m.style.display=Rt)},l=()=>{u({inputs:r}),a=!1;const m=document.getElementById("providerImagePreview");m&&(m.onload=()=>{a=!0,u({inputs:r})},m.src=r.tournamentImage.value,m.style.display="")},u=({inputs:m})=>{const g=(a||!m.tournamentImage.value||a===void 0)&&Vr(10)(m.providerName.value)&&Vr(3)(m.providerAbbr.value)&&(!m.providerId.value.length||Vr(36)(m.providerId.value)),v=document.getElementById("createButton");v&&(v.disabled=!g)},c=[{control:"providerAbbr",onInput:u},{control:"providerName",onInput:u},{control:"providerId",onInput:u}],d=m=>r=mr(m,[{value:s.organisationName,placeholder:"Provider name",validator:Vr(10),label:"Provider Name",field:"providerName",autocomplete:"off"},{value:s.organisationAbbreviation,placeholder:"Abbreviation",validator:Vr(3),label:"Abbreviation",field:"providerAbbr",autocomplete:"off"},{placeholder:"NOT REQUIRED - automatically generated",value:t?.provider?.organisationId??"",disabled:t?.provider?.organisationId,label:"Provider ID",autocomplete:"off",field:"providerId"},{onKeyUp:g=>g.key==="Enter"&&l(),onChange:()=>r.tournamentImage.value?l():o(),label:"Web address of online image",value:n?.identifier,placeholder:"Image URL",field:"tournamentImage",autocomplete:"off"}],c),p=document.createElement("div");d(p);const h=document.createElement("img");h.id="providerImagePreview",h.style.width="100%",p.appendChild(h);const f=()=>{const m=r.providerAbbr.value,g=r.providerName.value,v=t?.provider?.organisationId||r.providerId.value||Mi.UUID(),y={organisationAbbreviation:m,organisationName:g,organisationId:v};if(a){const S={resourceSubType:"IMAGE",name:"providerImage",resourceType:"URL",identifier:r.tournamentImage.value};y.onlineResources=[S]}const b=I=>Mt(e)&&e(I);t?.provider?xHe({provider:y}).then(b,I=>console.log({err:I})):kHe({provider:y}).then(b,I=>console.log({err:I}))};Yn({title:"Create provider",content:p,buttons:[{label:"Cancel",intent:"none",close:!0},{label:t?.provider?"Update":"Create",onClick:f,id:"createButton",intent:"is-info",disabled:!0,close:!0}]}),n&&setTimeout(l,400)}function rMe(){let t;Yn({title:"Settings",content:n=>t=mr(n,[{options:[{text:"WTN",field:"wtn",checked:zi.activeScale===_C},{text:"UTR",field:"utr",checked:zi.activeScale===yw}],onClick:r=>console.log({x:r}),label:"Active rating",field:"activeRating",id:"activeRating",radio:!0},{label:"Save local copies",checked:zi.saveLocal,field:"saveLocal",id:"saveLocal",checkbox:!0}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Save",intent:"is-primary",onClick:()=>{const n=t.wtn.checked?_C:yw;zi.saveLocal=t.saveLocal.checked,aO(n)},close:!0}]})}function P0t(t){const e=document.getElementById(t);e&&e.addEventListener("click",rMe)}const C0t=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,fO=t=>C0t.exec(t);async function R0t(t,e){return oc.post("/auth/login",{password:e,email:t})}async function M0t(t,e,i,n,r){return oc.post("/auth/invite",{permissions:n,providerId:e,services:r,email:t,roles:i})}async function N0t(t,e,i,n){return oc.post("/auth/register",{firstName:t,lastName:e,password:i,code:n})}function A0t(t,e=[]){const n=[{value:{organisationName:"None"},key:""},...e].map(({key:f,value:m})=>({label:m?.organisationName,value:f}));let r;const a={providerId:""},s=f=>a.providerId=f,l=[{onInput:({inputs:f})=>{const m=f.email.value,g=fO(m),v=document.getElementById("inviteUser");v&&(v.disabled=!g)},control:"email"}],u=f=>r=mr(f,[{iconLeft:"fa-regular fa-envelope",placeholder:"valid@email.com",validator:fO,autocomplete:"off",label:"Email",field:"email"},{text:"Roles",header:!0},{label:"Client",field:"client",checkbox:!0,width:"50%",id:"client",fieldPair:{label:"Director",field:"director",id:"director",checkbox:!0}},{label:"Admin",checkbox:!0,field:"admin",width:"50%",id:"admin",fieldPair:{label:"Official",field:"official",id:"official",checkbox:!0}},{label:"Scoring",field:"score",width:"50%",id:"score",checkbox:!0,fieldPair:{label:"Developer",field:"developer",id:"developer",checkbox:!0}},{label:"Generate",field:"generate",checkbox:!0,id:"generate"},{typeAhead:{list:n,callback:s},value:a.providerId||"",placeholder:"None",field:"providerId",label:"Provider"},{text:"Permissions",header:!0},{label:"Delete Tournaments",field:"deleteTournament",checkbox:!0,id:"delete"},{field:"editTennisId",label:"Edit WTID",id:"editTennisId",checkbox:!0},{label:"Dev mode",field:"devMode",checkbox:!0,id:"devmode"},{text:"Services",header:!0},{label:"Tournament Profiles (fetch)",field:"tournamentProfile",id:"tournamentProfile",checkbox:!0}],l),c=["client","admin","score","developer","generate","director","official"],d=["devMode","editTennisId","deleteTournament"],p=["tournamentProfile"];Yn({title:"Invite user",content:u,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Invite",intent:"is-primary",id:"inviteUser",disabled:!0,onClick:()=>{const f=r.email.value,m=a.providerId||r.providerId?.value,g=d.map(I=>r[I].checked&&I).filter(Boolean),v=p.map(I=>r[I].checked&&I).filter(Boolean),y=c.map(I=>r[I].checked&&I).filter(Boolean),b=I=>Mt(t)&&t(I);M0t(f,m,y,g,v).then(b,I=>console.log({err:I}))},close:!0}]})}function _0t(t){let e;const n=[{onInput:({inputs:s})=>{const o=s.email.value,l=fO(o),u=document.getElementById("loginButton");u&&(u.disabled=!l)},control:"email"}];Yn({title:"Log in",content:s=>e=mr(s,[{iconLeft:"fa-regular fa-envelope",placeholder:"valid@email.com",validator:fO,autocomplete:"email",label:"Email",field:"email"},{placeholder:"minimum 8 characters",autocomplete:"current-password",iconLeft:"fa-solid fa-lock",label:"Password",field:"password",type:"password"}],n),buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{const s=e.email.value,o=e.password.value,l=u=>{u||CZ(),u?.status===200&&x0t({data:u.data,callback:t})};R0t(s,o).then(l,u=>console.log({err:u}))},intent:"is-primary",id:"loginButton",disabled:!0,label:"Login",close:!0}]})}async function k0t(t){try{await navigator.clipboard.writeText(t),Ht({message:"Copied to clipboard",intent:"is-success"})}catch(e){Ht({message:String(e),intent:"is-danger"})}}function O2(t){const e=document.getElementById("login"),i=It?.provider,n=t?.roles?.includes(HF);e&&(t?e.style.color=i&&"red"||n&&"green"||"blue":e.style.color="")}function tc(){const t=LEe(),e=nMe(t);return e&&O2(e),e}function CZ(){OEe(),zPe(),f2(),It.provider=void 0,It.router.navigate(`/${tf}/logout`),O2(!1)}function x0t({data:t,callback:e}){const i=nMe(t.token),n=nt.getTournament().tournamentRecord?.tournamentId;i&&(yJe(t.token),Ht({intent:"is-success",message:"Log in successful"}),f2(),n||nt.reset(),O2(i),Mt(e)?e():n||It.router.navigate(`/${tf}/${i.provider?.organisationAbbreviation}`))}function O0t(){kC().then(({data:t})=>{const e=t?.providers?.map(({value:i})=>({onClick:()=>{It.provider=i,It.router.navigate(`/${tf}/${i.organisationAbbreviation}`)},participantName:i.organisationName}));e&&PK({title:"Select Provider",options:e,selectionLimit:1})})}function L0t(t){return()=>FHe(t).then(()=>Ht({message:"User removed"}))}function F0t(){Yge().then(({data:t})=>{const e=t?.users?.map(({value:i})=>({participantName:`${i.firstName} ${i.lastName} (${i.email})`,onClick:L0t(i)}));e&&PK({title:"Select User",options:e,selectionLimit:1})})}function $0t(){It.provider=void 0,It.router.navigate(`/${tf}/superadmin`)}function Nre(t){const e=document.getElementById(t),i=n=>Ht({intent:"is-danger",message:n?.data?.message||"Error"});if(e){const n=a=>{const s=a?.data.inviteCode;if(s){const o=`${window.location.origin}${window.location.pathname}/#/${nge}/${s}`;k0t(o),console.log({inviteCode:s,inviteURL:o})}else i(a)},r=a=>setTimeout(()=>Mre({provider:a}),200);e.addEventListener("click",()=>{const a=tc(),s=a?.roles?.includes(HF),o=a?.roles?.includes(tge),l=It?.provider;Pu({target:e,title:"Authorization",items:[{onClick:()=>Ht({message:"TBD: Registration Modal"}),text:"Register",hide:a},{onClick:()=>_0t(),hide:a,text:"Log in"},{style:"text-decoration: line-through;",hide:!s||!l,onClick:$0t,text:"Impersonate"},{hide:!s||l,onClick:O0t,text:"Impersonate"},{onClick:Mre,text:"Create provider",hide:!s},{onClick:()=>fJe({callback:r}),text:"Edit provider",hide:!s},{onClick:F0t,text:"Remove user",hide:!s},{onClick:()=>kC().then(({data:c})=>A0t(n,c?.providers),i),hide:!s&&!l,text:"Invite User"},{text:"Log out",hide:!a,onClick:CZ},{hide:!o,divider:!0},{onClick:eat,heading:"Actions",hide:!o},{divider:!0},{onClick:rMe,heading:"Settings"}]})})}}const B0t=(function(){function t(){}const e=t.prototype;function i(a,s){let o=a.length;for(;o--;)if(a[o].listener===s)return o;return-1}function n(a){return function(...o){return this[a](...o)}}e.getListeners=function(s){const o=this._getEvents();let l,u;if(s instanceof RegExp){l={};for(u in o)o.hasOwnProperty(u)&&s.test(u)&&(l[u]=o[u])}else l=o[s]||(o[s]=[]);return l},e.flattenListeners=function(s){const o=[];for(let l=0;l<s.length;l+=1)o.push(s[l].listener);return o},e.getListenersAsObject=function(s){const o=this.getListeners(s);let l;return o instanceof Array&&(l={},l[s]=o),l||o};function r(a){return typeof a=="function"||a instanceof RegExp?!0:a&&typeof a=="object"?r(a.listener):!1}return e.addListener=function(s,o){if(!r(o))throw new TypeError("listener must be a function");const l=this.getListenersAsObject(s),u=typeof o=="object";let c;for(c in l)l.hasOwnProperty(c)&&i(l[c],u?o.listener:o)===-1&&l[c].push(u?o:{listener:o,once:!1});return this},e.on=n("addListener"),e.addOnceListener=function(s,o){return this.addListener(s,{listener:o,once:!0})},e.once=n("addOnceListener"),e.defineEvent=function(s){return this.getListeners(s),this},e.defineEvents=function(s){for(let o=0;o<s.length;o+=1)this.defineEvent(s[o]);return this},e.removeListener=function(s,o){const l=this.getListenersAsObject(s);let u,c;for(c in l)l.hasOwnProperty(c)&&(u=i(l[c],o),u!==-1&&l[c].splice(u,1));return this},e.off=n("removeListener"),e.addListeners=function(s,o){return this.manipulateListeners(!1,s,o)},e.removeListeners=function(s,o){return this.manipulateListeners(!0,s,o)},e.manipulateListeners=function(s,o,l){let u,c;const d=s?this.removeListener:this.addListener,p=s?this.removeListeners:this.addListeners;if(typeof o=="object"&&!(o instanceof RegExp))for(u in o)o.hasOwnProperty(u)&&(c=o[u])&&(typeof c=="function"?d.call(this,u,c):p.call(this,u,c));else for(u=l.length;u--;)d.call(this,o,l[u]);return this},e.removeEvent=function(s){const o=typeof s,l=this._getEvents();let u;if(o==="string")delete l[s];else if(s instanceof RegExp)for(u in l)l.hasOwnProperty(u)&&s.test(u)&&delete l[u];else delete this._events;return this},e.removeAllListeners=n("removeEvent"),e.emitEvent=function(s,o){const l=this.getListenersAsObject(s);let u,c,d,p,h;for(p in l)if(l.hasOwnProperty(p))for(u=l[p].slice(0),d=0;d<u.length;d++)c=u[d],c.once===!0&&this.removeListener(s,c.listener),h=c.listener.apply(this,o||[]),h===this._getOnceReturnValue()&&this.removeListener(s,c.listener);return this},e.trigger=n("emitEvent"),e.emit=function(s,...o){return this.emitEvent(s,o)},e.setOnceReturnValue=function(s){return this._onceReturnValue=s,this},e._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},e._getEvents=function(){return this._events||(this._events={})},t})();function Are(){try{return window}catch{return}}const aMe=()=>Are()?.dev&&typeof Are()?.dev=="object";function V0t(){document.oncontextmenu=()=>!1,window.addEventListener("contextmenu",t=>{t.preventDefault()},!1),window.packageEntry={updateReady:Hje},window.onunhandledrejection=t=>{if(aMe())return;t.preventDefault();const e=t.reason,i=e&&(e.stack||e);i&&i.indexOf("blocked")>0?(zje(),console.warn("popup blocked")):console.warn("Unhandled rejection:",e&&(e.stack||e))}}var sMe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],mO=sMe.join(","),oMe=typeof Element>"u",$w=oMe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,gO=!oMe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},M1=function(e,i){var n;i===void 0&&(i=!0);var r=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"inert"),a=r===""||r==="true",s=a||i&&e&&M1(e.parentNode);return s},j0t=function(e){var i,n=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return n===""||n==="true"},lMe=function(e,i,n){if(M1(e))return[];var r=Array.prototype.slice.apply(e.querySelectorAll(mO));return i&&$w.call(e,mO)&&r.unshift(e),r=r.filter(n),r},vO=function(e,i,n){for(var r=[],a=Array.from(e);a.length;){var s=a.shift();if(!M1(s,!1))if(s.tagName==="SLOT"){var o=s.assignedElements(),l=o.length?o:s.children,u=vO(l,!0,n);n.flatten?r.push.apply(r,u):r.push({scopeParent:s,candidates:u})}else{var c=$w.call(s,mO);c&&n.filter(s)&&(i||!e.includes(s))&&r.push(s);var d=s.shadowRoot||typeof n.getShadowRoot=="function"&&n.getShadowRoot(s),p=!M1(d,!1)&&(!n.shadowRootFilter||n.shadowRootFilter(s));if(d&&p){var h=vO(d===!0?s.children:d.children,!0,n);n.flatten?r.push.apply(r,h):r.push({scopeParent:s,candidates:h})}else a.unshift.apply(a,s.children)}}return r},uMe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},DI=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||j0t(e))&&!uMe(e)?0:e.tabIndex},G0t=function(e,i){var n=DI(e);return n<0&&i&&!uMe(e)?0:n},H0t=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},cMe=function(e){return e.tagName==="INPUT"},z0t=function(e){return cMe(e)&&e.type==="hidden"},q0t=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(n){return n.tagName==="SUMMARY"});return i},W0t=function(e,i){for(var n=0;n<e.length;n++)if(e[n].checked&&e[n].form===i)return e[n]},Y0t=function(e){if(!e.name)return!0;var i=e.form||gO(e),n=function(o){return i.querySelectorAll('input[type="radio"][name="'+o+'"]')},r;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")r=n(window.CSS.escape(e.name));else try{r=n(e.name)}catch(s){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",s.message),!1}var a=W0t(r,e.form);return!a||a===e},K0t=function(e){return cMe(e)&&e.type==="radio"},Z0t=function(e){return K0t(e)&&!Y0t(e)},X0t=function(e){var i,n=e&&gO(e),r=(i=n)===null||i===void 0?void 0:i.host,a=!1;if(n&&n!==e){var s,o,l;for(a=!!((s=r)!==null&&s!==void 0&&(o=s.ownerDocument)!==null&&o!==void 0&&o.contains(r)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!a&&r;){var u,c,d;n=gO(r),r=(u=n)===null||u===void 0?void 0:u.host,a=!!((c=r)!==null&&c!==void 0&&(d=c.ownerDocument)!==null&&d!==void 0&&d.contains(r))}}return a},_re=function(e){var i=e.getBoundingClientRect(),n=i.width,r=i.height;return n===0&&r===0},J0t=function(e,i){var n=i.displayCheck,r=i.getShadowRoot;if(n==="full-native"&&"checkVisibility"in e){var a=e.checkVisibility({checkOpacity:!1,opacityProperty:!1,contentVisibilityAuto:!0,visibilityProperty:!0,checkVisibilityCSS:!0});return!a}if(getComputedStyle(e).visibility==="hidden")return!0;var s=$w.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if($w.call(o,"details:not([open]) *"))return!0;if(!n||n==="full"||n==="full-native"||n==="legacy-full"){if(typeof r=="function"){for(var l=e;e;){var u=e.parentElement,c=gO(e);if(u&&!u.shadowRoot&&r(u)===!0)return _re(e);e.assignedSlot?e=e.assignedSlot:!u&&c!==e.ownerDocument?e=c.host:e=u}e=l}if(X0t(e))return!e.getClientRects().length;if(n!=="legacy-full")return!0}else if(n==="non-zero-area")return _re(e);return!1},Q0t=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var n=0;n<i.children.length;n++){var r=i.children.item(n);if(r.tagName==="LEGEND")return $w.call(i,"fieldset[disabled] *")?!0:!r.contains(e)}return!0}i=i.parentElement}return!1},yO=function(e,i){return!(i.disabled||M1(i)||z0t(i)||J0t(i,e)||q0t(i)||Q0t(i))},sq=function(e,i){return!(Z0t(i)||DI(i)<0||!yO(e,i))},eSt=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},dMe=function(e){var i=[],n=[];return e.forEach(function(r,a){var s=!!r.scopeParent,o=s?r.scopeParent:r,l=G0t(o,s),u=s?dMe(r.candidates):o;l===0?s?i.push.apply(i,u):i.push(o):n.push({documentOrder:a,tabIndex:l,item:r,isScope:s,content:u})}),n.sort(H0t).reduce(function(r,a){return a.isScope?r.push.apply(r,a.content):r.push(a.content),r},[]).concat(i)},tSt=function(e,i){i=i||{};var n;return i.getShadowRoot?n=vO([e],i.includeContainer,{filter:sq.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:eSt}):n=lMe(e,i.includeContainer,sq.bind(null,i)),dMe(n)},iSt=function(e,i){i=i||{};var n;return i.getShadowRoot?n=vO([e],i.includeContainer,{filter:yO.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):n=lMe(e,i.includeContainer,yO.bind(null,i)),n},AS=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return $w.call(e,mO)===!1?!1:sq(i,e)},nSt=sMe.concat("iframe").join(","),zj=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return $w.call(e,nSt)===!1?!1:yO(i,e)};function oq(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function rSt(t){if(Array.isArray(t))return oq(t)}function kre(t,e){var i=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=pMe(t))||e){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,s=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var l=i.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{s||i.return==null||i.return()}finally{if(o)throw a}}}}function aSt(t,e,i){return(e=cSt(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function sSt(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function oSt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xre(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),i.push.apply(i,n)}return i}function Ore(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?xre(Object(i),!0).forEach(function(n){aSt(t,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):xre(Object(i)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))})}return t}function lSt(t){return rSt(t)||sSt(t)||pMe(t)||oSt()}function uSt(t,e){if(typeof t!="object"||!t)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var n=i.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function cSt(t){var e=uSt(t,"string");return typeof e=="symbol"?e:e+""}function pMe(t,e){if(t){if(typeof t=="string")return oq(t,e);var i={}.toString.call(t).slice(8,-1);return i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set"?Array.from(t):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?oq(t,e):void 0}}var Ag={getActiveTrap:function(e){return e?.length>0?e[e.length-1]:null},activateTrap:function(e,i){var n=Ag.getActiveTrap(e);i!==n&&Ag.pauseTrap(e);var r=e.indexOf(i);r===-1||e.splice(r,1),e.push(i)},deactivateTrap:function(e,i){var n=e.indexOf(i);n!==-1&&e.splice(n,1),Ag.unpauseTrap(e)},pauseTrap:function(e){var i=Ag.getActiveTrap(e);i?._setPausedState(!0)},unpauseTrap:function(e){var i=Ag.getActiveTrap(e);i&&!i._isManuallyPaused()&&i._setPausedState(!1)}},dSt=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},pSt=function(e){return e?.key==="Escape"||e?.key==="Esc"||e?.keyCode===27},HP=function(e){return e?.key==="Tab"||e?.keyCode===9},hSt=function(e){return HP(e)&&!e.shiftKey},fSt=function(e){return HP(e)&&e.shiftKey},Lre=function(e){return setTimeout(e,0)},VE=function(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return typeof e=="function"?e.apply(void 0,n):e},ZA=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},mSt=[],gSt=function(e,i){var n=document,r=mSt,a=Ore({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isolateSubtrees:!1,isKeyForward:hSt,isKeyBackward:fSt},i),s={containers:[],containerGroups:[],tabbableGroups:[],adjacentElements:new Set,alreadyInert:new Set,nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,manuallyPaused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},o,l=function(N,A,_){return N&&N[A]!==void 0?N[A]:a[_||A]},u=function(N,A){var _=typeof A?.composedPath=="function"?A.composedPath():void 0;return s.containerGroups.findIndex(function(x){var O=x.container,$=x.tabbableNodes;return O.contains(N)||_?.includes(O)||$.find(function(F){return F===N})})},c=function(N){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=A.hasFallback,x=_===void 0?!1:_,O=A.params,$=O===void 0?[]:O,F=a[N];if(typeof F=="function"&&(F=F.apply(void 0,lSt($))),F===!0&&(F=void 0),!F){if(F===void 0||F===!1)return F;throw new Error("`".concat(N,"` was specified but was not a node, or did not return a node"))}var j=F;if(typeof F=="string"){try{j=n.querySelector(F)}catch(H){throw new Error("`".concat(N,'` appears to be an invalid selector; error="').concat(H.message,'"'))}if(!j&&!x)throw new Error("`".concat(N,"` as selector refers to no known node"))}return j},d=function(){var N=c("initialFocus",{hasFallback:!0});if(N===!1)return!1;if(N===void 0||N&&!zj(N,a.tabbableOptions))if(u(n.activeElement)>=0)N=n.activeElement;else{var A=s.tabbableGroups[0],_=A&&A.firstTabbableNode;N=_||c("fallbackFocus")}else N===null&&(N=c("fallbackFocus"));if(!N)throw new Error("Your focus-trap needs to have at least one focusable element");return N},p=function(){if(s.containerGroups=s.containers.map(function(N){var A=tSt(N,a.tabbableOptions),_=iSt(N,a.tabbableOptions),x=A.length>0?A[0]:void 0,O=A.length>0?A[A.length-1]:void 0,$=_.find(function(H){return AS(H)}),F=_.slice().reverse().find(function(H){return AS(H)}),j=!!A.find(function(H){return DI(H)>0});return{container:N,tabbableNodes:A,focusableNodes:_,posTabIndexesFound:j,firstTabbableNode:x,lastTabbableNode:O,firstDomTabbableNode:$,lastDomTabbableNode:F,nextTabbableNode:function(G){var W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,q=A.indexOf(G);return q<0?W?_.slice(_.indexOf(G)+1).find(function(Z){return AS(Z)}):_.slice(0,_.indexOf(G)).reverse().find(function(Z){return AS(Z)}):A[q+(W?1:-1)]}}}),s.tabbableGroups=s.containerGroups.filter(function(N){return N.tabbableNodes.length>0}),s.tabbableGroups.length<=0&&!c("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(s.containerGroups.find(function(N){return N.posTabIndexesFound})&&s.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},h=function(N){var A=N.activeElement;if(A)return A.shadowRoot&&A.shadowRoot.activeElement!==null?h(A.shadowRoot):A},f=function(N){if(N!==!1&&N!==h(document)){if(!N||!N.focus){f(d());return}N.focus({preventScroll:!!a.preventScroll}),s.mostRecentlyFocusedNode=N,dSt(N)&&N.select()}},m=function(N){var A=c("setReturnFocus",{params:[N]});return A||(A===!1?!1:N)},g=function(N){var A=N.target,_=N.event,x=N.isBackward,O=x===void 0?!1:x;A=A||ZA(_),p();var $=null;if(s.tabbableGroups.length>0){var F=u(A,_),j=F>=0?s.containerGroups[F]:void 0;if(F<0)O?$=s.tabbableGroups[s.tabbableGroups.length-1].lastTabbableNode:$=s.tabbableGroups[0].firstTabbableNode;else if(O){var H=s.tabbableGroups.findIndex(function(Q){var J=Q.firstTabbableNode;return A===J});if(H<0&&(j.container===A||zj(A,a.tabbableOptions)&&!AS(A,a.tabbableOptions)&&!j.nextTabbableNode(A,!1))&&(H=F),H>=0){var G=H===0?s.tabbableGroups.length-1:H-1,W=s.tabbableGroups[G];$=DI(A)>=0?W.lastTabbableNode:W.lastDomTabbableNode}else HP(_)||($=j.nextTabbableNode(A,!1))}else{var q=s.tabbableGroups.findIndex(function(Q){var J=Q.lastTabbableNode;return A===J});if(q<0&&(j.container===A||zj(A,a.tabbableOptions)&&!AS(A,a.tabbableOptions)&&!j.nextTabbableNode(A))&&(q=F),q>=0){var Z=q===s.tabbableGroups.length-1?0:q+1,K=s.tabbableGroups[Z];$=DI(A)>=0?K.firstTabbableNode:K.firstDomTabbableNode}else HP(_)||($=j.nextTabbableNode(A))}}else $=c("fallbackFocus");return $},v=function(N){var A=ZA(N);if(!(u(A,N)>=0)){if(VE(a.clickOutsideDeactivates,N)){o.deactivate({returnFocus:a.returnFocusOnDeactivate});return}VE(a.allowOutsideClick,N)||N.preventDefault()}},y=function(N){var A=ZA(N),_=u(A,N)>=0;if(_||A instanceof Document)_&&(s.mostRecentlyFocusedNode=A);else{N.stopImmediatePropagation();var x,O=!0;if(s.mostRecentlyFocusedNode)if(DI(s.mostRecentlyFocusedNode)>0){var $=u(s.mostRecentlyFocusedNode),F=s.containerGroups[$].tabbableNodes;if(F.length>0){var j=F.findIndex(function(H){return H===s.mostRecentlyFocusedNode});j>=0&&(a.isKeyForward(s.recentNavEvent)?j+1<F.length&&(x=F[j+1],O=!1):j-1>=0&&(x=F[j-1],O=!1))}}else s.containerGroups.some(function(H){return H.tabbableNodes.some(function(G){return DI(G)>0})})||(O=!1);else O=!1;O&&(x=g({target:s.mostRecentlyFocusedNode,isBackward:a.isKeyBackward(s.recentNavEvent)})),f(x||s.mostRecentlyFocusedNode||d())}s.recentNavEvent=void 0},b=function(N){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;s.recentNavEvent=N;var _=g({event:N,isBackward:A});_&&(HP(N)&&N.preventDefault(),f(_))},I=function(N){(a.isKeyForward(N)||a.isKeyBackward(N))&&b(N,a.isKeyBackward(N))},S=function(N){pSt(N)&&VE(a.escapeDeactivates,N)!==!1&&(N.preventDefault(),o.deactivate())},w=function(N){var A=ZA(N);u(A,N)>=0||VE(a.clickOutsideDeactivates,N)||VE(a.allowOutsideClick,N)||(N.preventDefault(),N.stopImmediatePropagation())},T=function(){if(s.active)return Ag.activateTrap(r,o),s.delayInitialFocusTimer=a.delayInitialFocus?Lre(function(){f(d())}):f(d()),n.addEventListener("focusin",y,!0),n.addEventListener("mousedown",v,{capture:!0,passive:!1}),n.addEventListener("touchstart",v,{capture:!0,passive:!1}),n.addEventListener("click",w,{capture:!0,passive:!1}),n.addEventListener("keydown",I,{capture:!0,passive:!1}),n.addEventListener("keydown",S),o},U=function(N){s.active&&!s.paused&&o._setSubtreeIsolation(!1),s.adjacentElements.clear(),s.alreadyInert.clear();var A=new Set,_=new Set,x=kre(N),O;try{for(x.s();!(O=x.n()).done;){var $=O.value;A.add($);for(var F=typeof ShadowRoot<"u"&&$.getRootNode()instanceof ShadowRoot,j=$;j;){A.add(j);var H=j.parentElement,G=[];H?G=H.children:!H&&F&&(G=j.getRootNode().children,H=j.getRootNode().host,F=typeof ShadowRoot<"u"&&H.getRootNode()instanceof ShadowRoot);var W=kre(G),q;try{for(W.s();!(q=W.n()).done;){var Z=q.value;_.add(Z)}}catch(K){W.e(K)}finally{W.f()}j=H}}}catch(K){x.e(K)}finally{x.f()}A.forEach(function(K){_.delete(K)}),s.adjacentElements=_},C=function(){if(s.active)return n.removeEventListener("focusin",y,!0),n.removeEventListener("mousedown",v,!0),n.removeEventListener("touchstart",v,!0),n.removeEventListener("click",w,!0),n.removeEventListener("keydown",I,!0),n.removeEventListener("keydown",S),o},E=function(N){var A=N.some(function(_){var x=Array.from(_.removedNodes);return x.some(function(O){return O===s.mostRecentlyFocusedNode})});A&&f(d())},P=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(E):void 0,M=function(){P&&(P.disconnect(),s.active&&!s.paused&&s.containers.map(function(N){P.observe(N,{subtree:!0,childList:!0})}))};return o={get active(){return s.active},get paused(){return s.paused},activate:function(N){if(s.active)return this;var A=l(N,"onActivate"),_=l(N,"onPostActivate"),x=l(N,"checkCanFocusTrap"),O=Ag.getActiveTrap(r),$=!1;O&&!O.paused&&(O._setSubtreeIsolation(!1),$=!0);try{x||p(),s.active=!0,s.paused=!1,s.nodeFocusedBeforeActivation=h(n),A?.();var F=function(){x&&p(),T(),M(),a.isolateSubtrees&&o._setSubtreeIsolation(!0),_?.()};if(x)return x(s.containers.concat()).then(F,F),this;F()}catch(j){throw O===Ag.getActiveTrap(r)&&$&&O._setSubtreeIsolation(!0),j}return this},deactivate:function(N){if(!s.active)return this;var A=Ore({onDeactivate:a.onDeactivate,onPostDeactivate:a.onPostDeactivate,checkCanReturnFocus:a.checkCanReturnFocus},N);clearTimeout(s.delayInitialFocusTimer),s.delayInitialFocusTimer=void 0,s.paused||o._setSubtreeIsolation(!1),s.alreadyInert.clear(),C(),s.active=!1,s.paused=!1,M(),Ag.deactivateTrap(r,o);var _=l(A,"onDeactivate"),x=l(A,"onPostDeactivate"),O=l(A,"checkCanReturnFocus"),$=l(A,"returnFocus","returnFocusOnDeactivate");_?.();var F=function(){Lre(function(){$&&f(m(s.nodeFocusedBeforeActivation)),x?.()})};return $&&O?(O(m(s.nodeFocusedBeforeActivation)).then(F,F),this):(F(),this)},pause:function(N){return s.active?(s.manuallyPaused=!0,this._setPausedState(!0,N)):this},unpause:function(N){return s.active?(s.manuallyPaused=!1,r[r.length-1]!==this?this:this._setPausedState(!1,N)):this},updateContainerElements:function(N){var A=[].concat(N).filter(Boolean);return s.containers=A.map(function(_){return typeof _=="string"?n.querySelector(_):_}),a.isolateSubtrees&&U(s.containers),s.active&&(p(),a.isolateSubtrees&&!s.paused&&o._setSubtreeIsolation(!0)),M(),this}},Object.defineProperties(o,{_isManuallyPaused:{value:function(){return s.manuallyPaused}},_setPausedState:{value:function(N,A){if(s.paused===N)return this;if(s.paused=N,N){var _=l(A,"onPause"),x=l(A,"onPostPause");_?.(),C(),M(),o._setSubtreeIsolation(!1),x?.()}else{var O=l(A,"onUnpause"),$=l(A,"onPostUnpause");O?.(),o._setSubtreeIsolation(!0),p(),T(),M(),$?.()}return this}},_setSubtreeIsolation:{value:function(N){a.isolateSubtrees&&s.adjacentElements.forEach(function(A){if(N){var _=A.inert||A.hasAttribute("inert");_&&s.alreadyInert.add(A),A.inert=!0}else s.alreadyInert.has(A)||(A.inert=!1)})}}}),o.updateContainerElements(e),o};const vSt=()=>{const t={selectorTrigger:"[data-drawer-trigger]",selectorTarget:"[data-drawer-target]",selectorClose:"[data-drawer-close]",leftAlignment:"drawer--left",visibleClass:"is-visible",activeClass:"is-active",speedClose:350,speedOpen:50},e={};let i=!1,n,r;const a=ege;let s;const o=I=>r=I,l=()=>{Mt(r)&&r&&r()&&(r=void 0);const I=document.getElementById(a);I&&(I.classList.remove(t.visibleClass),document.documentElement.style.overflow="",setTimeout(function(){n?(I.classList.add(t.visibleClass),document.documentElement.style.overflow="hidden",Mt(n?.callback)&&n.callback()):(I.classList.remove(t.activeClass),i=!1),n=!1,s?.deactivate()},t.speedClose))},u=I=>{const S=document.getElementById(a);S&&(S.classList.contains(t.leftAlignment)||S.classList.add(t.leftAlignment),m(S,!1,I))},c=I=>{const S=document.getElementById(a);S&&(S.classList.remove(t.leftAlignment),m(S,!1,I))},d=I=>{const w=document.getElementById(a)?.querySelector(".drawer__title");w&&(w.innerHTML=I)},p=I=>{const w=document.getElementById(a)?.querySelector(".drawer__footer");w&&(Js(w),Mt(I)?e.footer=I(w,l):w.innerHTML=I||"")},h=I=>{const w=document.getElementById(a)?.querySelector(".drawer__content");w&&(Js(w),Mt(I)?e.content=I(w,l):w.innerHTML=I)},f=I=>{const w=document.getElementById(a)?.querySelector(".drawer__wrapper");w&&(w.style.width=I)},m=(I,S,w)=>{i=!0,I.classList.add(t.activeClass),document.documentElement.style.overflow="hidden",S&&(s=gSt(I),s.activate()),Mt(w)&&w&&w(),setTimeout(function(){I.classList.add(t.visibleClass)},t.speedOpen)},g=({title:I,content:S,side:w,width:T,footer:U,callback:C,onClose:E}={})=>{if(S&&h(S),E&&o(E),I&&d(I),T&&f(T),p(U),i)n={callback:C};else if(w){if(w===ti)return c(C);if(w===hi)return u(C)}else{const P=document.getElementById(a);P&&m(P,U,C)}},v=function(I,S){let w=S.parentNode;for(;w;){if(w===I)return!0;w=w.parentNode}return!1},y=function(I){const S=I.target,w=document.querySelector(".drawer__wrapper");(!v(w,S)||S.classList.contains("drawer__close"))&&l()},b=I=>{I.key==="Escape"&&l()};return document.addEventListener("click",y,!1),document.addEventListener("keydown",b,!1),{settings:t,open:g,close:l,setTitle:d,setContent:h,setFooter:p,attributes:e}},Fre=t=>/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?\d)(?=.*?[#?!@$%^&*-]).{8,12}$/.test(t);function ySt(t){let e;const i=o=>o===e.password.value,r=[{onInput:({inputs:o})=>{const l=document.getElementById("registerButton");l&&(i(o.passwordConfirm.value)&&Fre(o.password.value)&&Vr(2)(o.givenName.value)&&Vr(2)(o.lastName.value)?l.removeAttribute("disabled"):l.setAttribute("disabled",""))},control:"passwordConfirm"}];Yn({title:"Register",content:o=>e=mr(o,[{error:"First name must be at least 2 characters long",iconLeft:"fa-regular fa-user",validator:Vr(2),placeholder:"First name",autocomplete:"off",label:"First Name",field:"givenName"},{error:"Last name must be at least 2 characters long",validator:Vr(2),placeholder:"Last name",autocomplete:"off",label:"Last name",field:"lastName"},{error:"Must contain upper/lower, number, and special character",placeholder:"minimum 8 characters",iconLeft:"fa-solid fa-lock",validator:Fre,autocomplete:"off",label:"Password",field:"password",type:"password"},{placeholder:"minimum 8 characters",error:"Passwords do not match",iconLeft:"fa-solid fa-lock",label:"Re-enter Password",validator:i,field:"passwordConfirm",autocomplete:"off",type:"password"}],r),buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{const o=e.lastName.value,l=e.givenName.value,u=e.password.value,c=t?.data?.inviteKey,d=()=>{Ht({message:"Success",intent:"is-success "})},p=f=>{Ht({message:f?.message,intent:"is-danger"})},h=f=>{f?.status===200&&f?.data?.success?d():p(f?.data)};N0t(l,o,u,c).then(h,p)},intent:"is-primary",id:"registerButton",label:"Register",disabled:!0,close:!0}],onClose:()=>It.router.navigate("/")})}function bSt(){const{tournamentRecord:t}=nt.getTournament();t&&(It.ee.emit(UPe,t.tournamentId),nt.reset())}function $re(){d2(),b0t(),tGe(),bSt(),TPe()}function Fs(){}function hMe(t){return t()}function Bre(){return Object.create(null)}function Qd(t){t.forEach(hMe)}function Ks(t){return typeof t=="function"}function uh(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function ISt(t){return Object.keys(t).length===0}function fMe(t,...e){if(t==null){for(const n of e)n(void 0);return Fs}const i=t.subscribe(...e);return i.unsubscribe?()=>i.unsubscribe():i}function wt(t,e,i){t.$$.on_destroy.push(fMe(e,i))}function ks(t,e,i){return t.set(i),e}function Bw(t){return t&&Ks(t.destroy)?t.destroy:Fs}const wSt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ya(t,e){t.appendChild(e)}function Ps(t,e,i){t.insertBefore(e,i||null)}function ls(t){t.parentNode&&t.parentNode.removeChild(t)}function RZ(t,e){for(let i=0;i<t.length;i+=1)t[i]&&t[i].d(e)}function Pa(t){return document.createElement(t)}function MZ(t){return document.createTextNode(t)}function $u(){return MZ(" ")}function tI(){return MZ("")}function Va(t,e,i,n){return t.addEventListener(e,i,n),()=>t.removeEventListener(e,i,n)}function bO(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function pi(t,e,i){i==null?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function SSt(t){return Array.from(t.childNodes)}function XA(t,e){return new t(e)}let N1;function zP(t){N1=t}function NZ(){if(!N1)throw new Error("Function called outside component initialization");return N1}function TSt(t){NZ().$$.on_mount.push(t)}function USt(t){NZ().$$.after_update.push(t)}function og(t){return NZ().$$.context.get(t)}function L2(t,e){const i=t.$$.callbacks[e.type];i&&i.slice().forEach(n=>n.call(this,e))}const ZS=[],Lm=[];let UT=[];const Vre=[],mMe=Promise.resolve();let lq=!1;function gMe(){lq||(lq=!0,mMe.then(vMe))}function AZ(){return gMe(),mMe}function uq(t){UT.push(t)}const qj=new Set;let _S=0;function vMe(){if(_S!==0)return;const t=N1;do{try{for(;_S<ZS.length;){const e=ZS[_S];_S++,zP(e),DSt(e.$$)}}catch(e){throw ZS.length=0,_S=0,e}for(zP(null),ZS.length=0,_S=0;Lm.length;)Lm.pop()();for(let e=0;e<UT.length;e+=1){const i=UT[e];qj.has(i)||(qj.add(i),i())}UT.length=0}while(ZS.length);for(;Vre.length;)Vre.pop()();lq=!1,qj.clear(),zP(t)}function DSt(t){if(t.fragment!==null){t.update(),Qd(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(uq)}}function ESt(t){const e=[],i=[];UT.forEach(n=>t.indexOf(n)===-1?e.push(n):i.push(n)),i.forEach(n=>n()),UT=e}const Q_=new Set;let MI;function Lc(){MI={r:0,c:[],p:MI}}function Fc(){MI.r||Qd(MI.c),MI=MI.p}function on(t,e){t&&t.i&&(Q_.delete(t),t.i(e))}function Zn(t,e,i,n){if(t&&t.o){if(Q_.has(t))return;Q_.add(t),MI.c.push(()=>{Q_.delete(t),n&&(i&&t.d(1),n())}),t.o(e)}else n&&n()}function Qp(t){return t?.length!==void 0?t:Array.from(t)}function _Z(t,e){Zn(t,1,1,()=>{e.delete(t.key)})}function kZ(t,e,i,n,r,a,s,o,l,u,c,d){let p=t.length,h=a.length,f=p;const m={};for(;f--;)m[t[f].key]=f;const g=[],v=new Map,y=new Map,b=[];for(f=h;f--;){const T=d(r,a,f),U=i(T);let C=s.get(U);C?b.push(()=>C.p(T,e)):(C=u(U,T),C.c()),v.set(U,g[f]=C),U in m&&y.set(U,Math.abs(f-m[U]))}const I=new Set,S=new Set;function w(T){on(T,1),T.m(o,c),s.set(T.key,T),c=T.first,h--}for(;p&&h;){const T=g[h-1],U=t[p-1],C=T.key,E=U.key;T===U?(c=T.first,p--,h--):v.has(E)?!s.has(C)||I.has(C)?w(T):S.has(E)?p--:y.get(C)>y.get(E)?(S.add(C),w(T)):(I.add(E),p--):(l(U,s),p--)}for(;p--;){const T=t[p];v.has(T.key)||l(T,s)}for(;h;)w(g[h-1]);return Qd(b),g}function ru(t){t&&t.c()}function Sl(t,e,i){const{fragment:n,after_update:r}=t.$$;n&&n.m(e,i),uq(()=>{const a=t.$$.on_mount.map(hMe).filter(Ks);t.$$.on_destroy?t.$$.on_destroy.push(...a):Qd(a),t.$$.on_mount=[]}),r.forEach(uq)}function Tl(t,e){const i=t.$$;i.fragment!==null&&(ESt(i.after_update),Qd(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function PSt(t,e){t.$$.dirty[0]===-1&&(ZS.push(t),gMe(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Df(t,e,i,n,r,a,s=null,o=[-1]){const l=N1;zP(t);const u=t.$$={fragment:null,ctx:[],props:a,update:Fs,not_equal:r,bound:Bre(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Bre(),dirty:o,skip_bound:!1,root:e.target||l.$$.root};s&&s(u.root);let c=!1;if(u.ctx=i?i(t,e.props||{},(d,p,...h)=>{const f=h.length?h[0]:p;return u.ctx&&r(u.ctx[d],u.ctx[d]=f)&&(!u.skip_bound&&u.bound[d]&&u.bound[d](f),c&&PSt(t,d)),p}):[],u.update(),c=!0,Qd(u.before_update),u.fragment=n?n(u.ctx):!1,e.target){if(e.hydrate){const d=SSt(e.target);u.fragment&&u.fragment.l(d),d.forEach(ls)}else u.fragment&&u.fragment.c();e.intro&&on(t.$$.fragment),Sl(t,e.target,e.anchor),vMe()}zP(l)}class Ef{$$=void 0;$$set=void 0;$destroy(){Tl(this,1),this.$destroy=Fs}$on(e,i){if(!Ks(i))return Fs;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(i),()=>{const r=n.indexOf(i);r!==-1&&n.splice(r,1)}}$set(e){this.$$set&&!ISt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const kS=[];function CSt(t,e){return{subscribe:qP(t,e).subscribe}}function qP(t,e=Fs){let i;const n=new Set;function r(o){if(uh(t,o)&&(t=o,i)){const l=!kS.length;for(const u of n)u[1](),kS.push(u,t);if(l){for(let u=0;u<kS.length;u+=2)kS[u][0](kS[u+1]);kS.length=0}}}function a(o){r(o(t))}function s(o,l=Fs){const u=[o,l];return n.add(u),n.size===1&&(i=e(r,a)||Fs),o(t),()=>{n.delete(u),n.size===0&&i&&(i(),i=null)}}return{set:r,update:a,subscribe:s}}function yMe(t,e,i){const n=!Array.isArray(t),r=n?[t]:t;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const a=e.length<2;return CSt(i,(s,o)=>{let l=!1;const u=[];let c=0,d=Fs;const p=()=>{if(c)return;d();const f=e(n?u[0]:u,s,o);a?s(f):d=Ks(f)?f:Fs},h=r.map((f,m)=>fMe(f,g=>{u[m]=g,c&=~(1<<m),l&&p()},()=>{c|=1<<m}));return l=!0,p(),function(){Qd(h),d(),l=!1}})}function IO(t){return function(e){return e.key==="Enter"||e.key===" "&&!e.preventDefault()?t.call(this,e):void 0}}function pE(t,e){let i={update(n){typeof n=="string"?t.innerText=n:n?.domNodes?t.replaceChildren(...n.domNodes):n?.html&&(t.innerHTML=n.html)}};return i.update(e),i}function RSt(t,e){const i=n=>{t&&!t.contains(n.target)&&t.dispatchEvent(new CustomEvent(e+"outside",{detail:{jsEvent:n}}))};return document.addEventListener(e,i,!0),{destroy(){document.removeEventListener(e,i,!0)}}}const MSt=86400;function xS(t){if(typeof t=="number")t={seconds:t};else if(typeof t=="string"){let i=0,n=2;for(let r of t.split(":",3))i+=parseInt(r,10)*Math.pow(60,n--);t={seconds:i}}else t instanceof Date&&(t={hours:t.getUTCHours(),minutes:t.getUTCMinutes(),seconds:t.getUTCSeconds()});let e=t.weeks||t.week||0;return{years:t.years||t.year||0,months:t.months||t.month||0,days:e*7+(t.days||t.day||0),seconds:(t.hours||t.hour||0)*60*60+(t.minutes||t.minute||0)*60+(t.seconds||t.second||0),inWeeks:!!e}}function No(t){return new Date(t.getTime())}function Cg(t,e,i=1){t.setUTCFullYear(t.getUTCFullYear()+i*e.years);let n=t.getUTCMonth()+i*e.months;for(t.setUTCMonth(n),n%=12,n<0&&(n+=12);t.getUTCMonth()!==n;)xZ(t);return t.setUTCDate(t.getUTCDate()+i*e.days),t.setUTCSeconds(t.getUTCSeconds()+i*e.seconds),t}function Wj(t,e,i=1){return Cg(t,e,-i)}function Vw(t,e=1){return t.setUTCDate(t.getUTCDate()+e),t}function xZ(t,e=1){return Vw(t,-e)}function jre(t){return t.setUTCHours(0,0,0,0),t}function Ty(t){return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds())}function xy(t,e=19){return t.toISOString().substring(0,e)}function Eh(t,...e){return e.every(i=>t.getTime()===i.getTime())}function cq(t,e){return t.setUTCHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),0),t}function NSt(t,e){t=No(t),e==0?t.setUTCDate(t.getUTCDate()+6-t.getUTCDay()):t.setUTCDate(t.getUTCDate()+4-(t.getUTCDay()||7));let i=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t-i)/1e3/MSt+1)/7)}function A1(...t){return Object.assign(...t)}function XS(...t){return Math.min(...t)}function EI(...t){return Math.max(...t)}function ASt(){return Symbol("ec")}function bMe(t){return Array.isArray(t)}function Mc(t){return typeof t=="function"}function _St(t){return t()}function kSt(t){t.forEach(_St)}function xSt(){}function OSt(t,e,i){i.update(n=>n.set(e,t))}function LSt(t,e,i){e??=t,i.has(e)||i.set(e,setTimeout(()=>{i.delete(e),t()}))}let OZ=ASt();function FSt(t,e){t[OZ]=e}function $St(t){return!!t?.[OZ]}function ek(t){return t[OZ]}function IMe(t,e,i,n=[]){let r=document.createElement(t);r.className=e,typeof i=="string"?r.innerText=i:i.domNodes?r.replaceChildren(...i.domNodes):i.html&&(r.innerHTML=i.html);for(let a of n)r.setAttribute(...a);return r}function Oy(t){return t.getBoundingClientRect()}function OU(t,e){for(;e--;)t=t.parentElement;return t}function JA(t){return Oy(t).height}function WP(t,e,i=document){for(let n of i.elementsFromPoint(t,e)){if($St(n))return n;if(n.shadowRoot){let r=WP(t,e,n.shadowRoot);if(r)return r}}return null}function tk(t,e,i,n){return t.addEventListener(e,i,n),()=>t.removeEventListener(e,i,n)}function Uh(t){return t=A1({},t),t.currentStart=Ty(t.currentStart),t.currentEnd=Ty(t.currentEnd),t.activeStart=Ty(t.activeStart),t.activeEnd=Ty(t.activeEnd),t}function BSt(t){return t.startsWith("list")}function Yj(t){return t.includes("Timeline")}function dq(t,e,i){let n={start:t.start>e?t.start:e,end:t.end<i?t.end:i,event:t};return n.zeroDuration=Eh(n.start,n.end),n}function VSt(t){t.sort((e,i)=>e.start-i.start||i.event.allDay-e.event.allDay)}function jSt(t,e,i,n,r,a){let s=r.formatRange(t.start,e&&t.event.display!=="pointer"&&!t.zeroDuration?cq(No(t.start),t.end):t.start),o;if(i&&(o=Mc(i)?i({event:_g(t.event),timeText:s,view:Uh(a)}):i),o===void 0){let l;switch(t.event.display){case"background":l=[];break;case"pointer":l=[Gre(s,t,n)];break;default:l=[...t.event.allDay?[]:[Gre(s,t,n)],IMe("h4",n.eventTitle,t.event.title)]}o={domNodes:l}}return[s,o]}function Gre(t,e,i){return IMe("time",i.eventTime,t,[["datetime",xy(e.start)]])}function GSt(t,e,i){let n=e.classNames;return t&&(Mc(t)&&(t=t({event:_g(e),view:Uh(i)})),n=[...bMe(t)?t:[t],...n]),n}function _g(t){return wMe(t,Ty)}function Kj(t){return wMe(t,No)}function wMe(t,e){return t=A1({},t),t.start=e(t.start),t.end=e(t.end),t}function Zj(t,e){let i={};if(t.length){VSt(t);let n;for(let r of t){let a=[],s=jre(No(r.start));for(;r.end>s;){if(!e.includes(s.getUTCDay())&&(a.push(No(s)),a.length>1)){let o=s.getTime();i[o]?i[o].chunks.push(r):i[o]={sorted:!1,chunks:[r]}}Vw(s)}if(a.length){r.date=a[0],r.days=a.length,r.dates=a,r.start<a[0]&&(r.start=a[0]);let o=Vw(No(a.at(-1)));r.end>o&&(r.end=o)}else r.date=jre(No(r.start)),r.days=1,r.dates=[r.date];n&&Eh(n.date,r.date)&&(r.prev=n),n=r}}return i}function HSt(t,e,i){t.top=0,t.prev&&(t.top=t.prev.bottom+1),t.bottom=t.top+i;let n=1,r=t.date.getTime();if(e[r]){e[r].sorted||(e[r].chunks.sort((a,s)=>a.top-s.top),e[r].sorted=!0);for(let a of e[r].chunks)if(t.top<a.bottom&&t.bottom>a.top){let s=a.bottom-t.top+1;n+=s,t.top+=s,t.bottom+=s}}return n}function SMe(t,e){t.length=e.length;let i=[];for(let n of t)i.push(n?.reposition?.());return i}function Hre(t,e,i,n){return t.start<i&&t.end>e?n?(bMe(n)||(n=[n]),n.some(r=>t.resourceIds.includes(r.id))):!0:!1}function LU(t){return zSt(t)||qSt(t)||WSt(t)}function _1(t){return t==="background"}function zSt(t){return t==="preview"}function qSt(t){return t==="ghost"}function WSt(t){return t==="pointer"}function YSt(t){return KSt(t,"month")}function KSt(t,e){return{...t,next:"Next "+e,prev:"Previous "+e}}function ZSt(t){return e=>({...e,view:t})}function XSt(t,e){return e.start&&t<e.start||e.end&&t>e.end}function zre(t,e){return e.start&&t<e.start&&(t=e.start),e.end&&t>e.end&&(t=e.end),t}function JSt(t,e){return TMe(t,e)?.eventBackgroundColor}function QSt(t,e){return TMe(t,e)?.eventTextColor}function TMe(t,e){return e.find(i=>t.resourceIds.includes(i.id))}function qre(t,e){return yMe([t,e],([i,n])=>{let r=Mc(n)?{format:n}:new Intl.DateTimeFormat(i,n);return{format:a=>r.format(Ty(a))}})}let Xj=!1;function eTt(t){Xj||(Xj=!0,window.requestAnimationFrame(()=>{t(),Xj=!1}))}function Wre(t,e,i){return EI(e,XS(i,t))}const{window:ny}=wSt;function tTt(t){let e,i;return{c:Fs,m(n,r){e||(i=[Va(ny,"pointermove",t[37]),Va(ny,"pointerup",t[38]),Va(ny,"pointercancel",t[38]),Va(ny,"scroll",t[0]),Va(ny,"selectstart",ik(t[39])),Va(ny,"contextmenu",function(){Ks(ik(t[47]))&&ik(t[47]).apply(this,arguments)}),Va(ny,"touchstart",t[40]),Va(ny,"touchmove",t[46],{passive:!1})],e=!0)},p(n,r){t=n},i:Fs,o:Fs,d(n){e=!1,Qd(i)}}}const Yre=1,Kre=2,Zre=3,Xre=4,Jj=5,QA=6;function jE(t,e){return t.start=e.start,t.end=e.end,t.resourceIds=e.resourceIds,t}function Jre(t){return t.isPrimary&&(t.pointerType!=="mouse"||t.buttons&1)}function ik(t){return e=>{t()&&e.preventDefault()}}function iTt(t,e,i){let n,r,a,s,o,l,u,c,d,p,h,f,m,g,v,y,b,I,S,w,T,U,C,E,P,M,R,N,A,_,x,O,$,F,j,{_iEvents:H,_iClass:G,_events:W,_view:q,_dayGrid:Z,_draggable:K,_bodyEl:Q,datesAboveResources:J,dateClick:ne,dragConstraint:re,dragScroll:oe,eventDragMinDistance:de,eventDragStart:se,eventDragStop:ge,eventDrop:ye,eventLongPressDelay:Te,eventResizeStart:De,eventResizeStop:xe,eventResize:Me,longPressDelay:Oe,resizeConstraint:at,selectable:Fe,select:mt,selectBackgroundColor:Xe,selectConstraint:gt,selectLongPressDelay:ht,selectMinDistance:_e,slotDuration:Ye,slotHeight:Je,slotWidth:ct,unselect:pt,unselectAuto:Se,unselectCancel:he,validRange:we,view:be}=og("state");wt(t,H,st=>i(77,s=st)),wt(t,G,st=>i(82,d=st)),wt(t,W,st=>i(76,a=st)),wt(t,q,st=>i(74,n=st)),wt(t,Z,st=>i(79,l=st)),wt(t,K,st=>i(108,j=st)),wt(t,Q,st=>i(105,O=st)),wt(t,J,st=>i(104,x=st)),wt(t,ne,st=>i(83,p=st)),wt(t,re,st=>i(94,T=st)),wt(t,oe,st=>i(93,w=st)),wt(t,de,st=>i(99,M=st)),wt(t,se,st=>i(97,E=st)),wt(t,ge,st=>i(86,m=st)),wt(t,ye,st=>i(84,h=st)),wt(t,Te,st=>i(102,A=st)),wt(t,De,st=>i(98,P=st)),wt(t,xe,st=>i(87,g=st)),wt(t,Me,st=>i(85,f=st)),wt(t,Oe,st=>i(101,N=st)),wt(t,at,st=>i(96,C=st)),wt(t,Fe,st=>i(107,F=st)),wt(t,mt,st=>i(88,v=st)),wt(t,Xe,st=>i(78,o=st)),wt(t,gt,st=>i(95,U=st)),wt(t,ht,st=>i(103,_=st)),wt(t,_e,st=>i(100,R=st)),wt(t,Ye,st=>i(106,$=st)),wt(t,Je,st=>i(92,S=st)),wt(t,ct,st=>i(91,I=st)),wt(t,pt,st=>i(75,r=st)),wt(t,Se,st=>i(90,b=st)),wt(t,he,st=>i(89,y=st)),wt(t,we,st=>i(81,c=st)),wt(t,be,st=>i(80,u=st));let Ae,ze,We,Le,ft,rt,St,si,Qe,bt,ci,Tt,Li,Jt,Yi,Ri,qi,hn,kt,fi,Xr,Jr,Qr,Lr,Ua,lr,Cu;function zl(st,mi,xi,Oi,yr,Oa){Ae||(Ae=Jre(mi)?xi?xi[1]=="start"?Zre:Kre:j(st)?Yre:QA:QA,Bi()&&(We=st,ch(mi),Oi&&(ft=Oi),yr&&(lr=yr),kt=xi?xi[0]=="x"?"resizingX":"resizingY":"dragging",xi&&(cs()?(fi=No(We.end),hn?(cq(fi,We.start),fi>=We.end&&xZ(fi)):(Wj(fi,$),fi<We.start&&(fi=We.start),ft=We.start)):(fi=No(We.start),hn?(cq(fi,We.end),fi<=We.start&&!Oa&&Vw(fi)):(Cg(fi,$),fi>We.end&&(fi=We.end),ft=We.end,Oa||(ft=Wj(No(ft),$)))),Oa&&!hn&&(Cu=$)),fa(mi)))}function Cf(st){Ae||(Ae=Jre(st)?F&&!BSt(u)?Xre:Jj:QA,Bi()&&(ch(st),kt="selecting",Xr=hn?xS({day:1}):$,We={allDay:hn,start:ft,end:Cg(No(ft),Xr),resourceIds:St?[St.id]:[]},fa(st)))}function Ru(){Ae||(Ae=QA)}function ch(st){window.getSelection().removeAllRanges(),Qe=ci=st.clientX,bt=Tt=st.clientY;let mi=WP(ci,Tt);({allDay:hn,date:ft,resource:St}=ek(mi)(ci,Tt)),Yj(u)?Li=Yi=O:(Li=OU(mi,St?4:3),Yi=OU(mi,St&&(Mr()||x)?2:1)),Wl(),st.pointerType!=="mouse"&&i(1,Lr=setTimeout(()=>{Ae&&(ze=!0,fa(st))},(Rs()?_:A)??N))}function fa(st){if(ze||st&&st.pointerType==="mouse"&&Qt()>=(Rs()?R:M)){ze=!0,vr(st),ks(G,d=kt,d),s[0]||(Rs()?Yl():ep(st,hl()?P:E));let mi=ql(Rf());if(mi){let xi;if({allDay:xi,date:rt,resource:si}=mi,xi===hn){let Oi=jE({},s[0]),yr=C;qi=xS((rt-ft)/1e3),cs()?(Oi.start=Cg(No(We.start),qi),Oi.start>fi&&(Oi.start=fi,qi=xS((fi-We.start)/1e3))):(Oi.end=Cg(No(We.end),qi),Cu&&Cg(Oi.end,Cu),hl()?Oi.end<fi&&(Oi.end=fi,qi=xS((fi-We.end)/1e3)):Rs()?(Oi.end<We.end?(Oi.start=Wj(Oi.end,Xr),Oi.end=We.end):Oi.start=We.start,yr=U):(Oi.start=Cg(No(We.start),qi),St&&(Oi.resourceIds=We.resourceIds.filter(Oa=>Oa!==St.id),Oi.resourceIds.push(si.id)),yr=T));do{if(yr!==void 0&&(Oi=jE(Kj(We),Oi),yr(Rs()?mc(Oi,st):Mu(Oi,We,st))===!1)){ks(H,s[0]=jE(s[0],We),s);break}ks(H,s[0]=jE(s[0],Oi),s)}while(!1)}}}if(w){let mi=S*2,xi=I;eTt(()=>{Li&&(Tt<mi&&window.scrollBy(0,EI(-10,(Tt-mi)/3)),Tt<Jt.top+mi&&(Li.scrollTop+=EI(-10,(Tt-Jt.top-mi)/3)),Tt>window.innerHeight-mi&&window.scrollBy(0,XS(10,(Tt-window.innerHeight+mi)/3)),Tt>Jt.bottom-mi&&(Li.scrollTop+=XS(10,(Tt-Jt.bottom+mi)/3)),Yj(u)&&(ci<Jt.left+xi&&(Li.scrollLeft+=EI(-10,(ci-Jt.left-xi)/3)),ci>Jt.right-xi&&(Li.scrollLeft+=XS(10,(ci-Jt.right+xi)/3))))})}}function Gr(){Bi()&&(Wl(),fa())}function zo(st){Bi()&&st.isPrimary&&(ci=st.clientX,Tt=st.clientY,fa(st))}function pl(st){if(Jr&&b&&!(y&&st.target.closest(y))&&vr(st),Ae&&st.isPrimary){if(ze)if(Rs()){if(Jr=!0,Mc(v)){let mi=mc(s[0],st);v(mi)}}else{We.display=Le;let mi=hl()?g:m;Mc(mi)&&mi({event:_g(We),jsEvent:st,view:Uh(n)});let xi=Kj(We);if(fc(We,s[0]),ma(),mi=hl()?f:h,Mc(mi)){let Oi=We,yr=Mu(We,xi,st);mi(A1(yr,{revert(){fc(Oi,xi)}}))}}else if((io()||Rs())&&Mc(p)&&!Qr){ci=st.clientX,Tt=st.clientY;let mi=WP(ci,Tt);if(mi){let{allDay:xi,date:Oi,resource:yr}=ek(mi)(ci,Tt);p({allDay:xi,date:Ty(Oi),dateStr:xy(Oi),dayEl:mi,jsEvent:st,view:Uh(n),resource:yr})}}ze=!1,Ae=Qe=bt=ci=Tt=We=Le=ft=rt=St=si=qi=Cu=hn=ks(G,d=fi=Xr=lr=void 0,d),Li=Yi=Jt=Ri=void 0,Lr&&(clearTimeout(Lr),i(1,Lr=void 0))}Qr=!1}function Rf(){return WP(Wre(ci,Ua[0],Ua[1]),Wre(Tt,Ua[2],Ua[3]))}function ql(st){if(st){let mi=ek(st)(ci,Tt);if(mi.disabled){if(!c.end||mi.date<c.end)return ql(st.nextElementSibling);if(!c.start||mi.date>c.start)return ql(st.previousElementSibling)}else return mi}return null}function Wl(){Jt=Oy(Li),Ri=Oy(Yi),Ua=[EI(0,Ri.left+(Yj(u)?1:l?0:8)),XS(document.documentElement.clientWidth,Ri.left+Yi.clientWidth)-2,EI(0,Jt.top),XS(document.documentElement.clientHeight,Jt.top+Li.clientHeight)-2]}function ep(st,mi){Mc(mi)&&mi({event:_g(We),jsEvent:st,view:Uh(n)}),Le=We.display,We.display="preview",ks(H,s[0]=Kj(We),s),lr!==void 0&&ks(H,s[0]._margin=lr,s),Cu&&Cg(s[0].end,Cu),We.display="ghost",W.set(a)}function Yl(){ks(H,s[0]={id:"{select}",allDay:We.allDay,start:We.start,title:"",display:"preview",extendedProps:{},backgroundColor:o,resourceIds:We.resourceIds,classNames:[],styles:[]},s)}function ma(){ks(H,s[0]=null,s)}function fc(st,mi){jE(st,mi),W.set(a)}function mc(st,mi){let{start:xi,end:Oi}=_g(st);return{start:xi,end:Oi,startStr:xy(st.start),endStr:xy(st.end),allDay:hn,view:Uh(n),resource:St,jsEvent:mi}}function Mu(st,mi,xi){let Oi;return hl()?Oi=cs()?{startDelta:qi,endDelta:xS(0)}:{startDelta:xS(0),endDelta:qi}:Oi={delta:qi,oldResource:St!==si?St:void 0,newResource:St!==si?si:void 0},A1(Oi,{event:_g(st),oldEvent:_g(mi),view:Uh(n),jsEvent:xi}),Oi}function Qt(){return Math.sqrt(Math.pow(ci-Qe,2)+Math.pow(Tt-bt,2))}function Mr(){return Ae===Yre}function hl(){return Ae===Kre||cs()}function cs(){return Ae===Zre}function io(){return Ae===Jj}function Rs(){return Ae===Xre}function Bi(){return Ae&&Ae<Jj}function vr(st){Jr&&(Jr=!1,ma(),Mc(r)&&r({jsEvent:st,view:Uh(n)}))}function rr(){Qr=!0}q.subscribe(vr);function Kl(st){if(Bi()){let mi=st.target,xi=[],Oi=()=>kSt(xi);xi.push(tk(mi,"touchmove",ik(()=>ze))),xi.push(tk(mi,"touchend",Oi)),xi.push(tk(mi,"touchcancel",Oi))}}function es(st){L2.call(this,t,st)}return[Gr,Lr,H,G,W,q,Z,K,Q,J,ne,re,oe,de,se,ge,ye,Te,De,xe,Me,Oe,at,Fe,mt,Xe,gt,ht,_e,Ye,Je,ct,pt,Se,he,we,be,zo,pl,Bi,Kl,zl,Cf,Ru,vr,rr,es,()=>Lr]}class nTt extends Ef{constructor(e){super(),Df(this,e,iTt,tTt,uh,{drag:41,select:42,noAction:43,handleScroll:0,unselect:44,noClick:45},null,[-1,-1,-1,-1,-1])}get drag(){return this.$$.ctx[41]}get select(){return this.$$.ctx[42]}get noAction(){return this.$$.ctx[43]}get handleScroll(){return this.$$.ctx[0]}get unselect(){return this.$$.ctx[44]}get noClick(){return this.$$.ctx[45]}}function rTt(t){let e,i;return{c:Fs,m(n,r){e||(i=[Va(window,"pointermove",t[3]),Va(window,"scroll",t[0])],e=!0)},p:Fs,i:Fs,o:Fs,d(n){e=!1,Qd(i)}}}function aTt(t){return t.isPrimary&&t.pointerType==="mouse"}function sTt(t,e,i){let n,r,{_iEvents:a,slotDuration:s}=og("state");wt(t,a,f=>i(4,n=f)),wt(t,s,f=>i(7,r=f));let o=0,l=0;function u(){let f=WP(o,l);if(f){let{allDay:m,date:g,resource:v,disabled:y}=ek(f)(o,l);if(!y){let b=m?2:1;n[b]||p(b),ks(a,n[b].start=g,n),ks(a,n[b].end=Cg(No(g),r),n),ks(a,n[b].resourceIds=v?[v.id]:[],n);return}}h()}function c(){u()}function d(f){aTt(f)&&(o=f.clientX,l=f.clientY,u())}function p(f){ks(a,n[f]={id:"{pointer}",title:"",display:"pointer",extendedProps:{},backgroundColor:"transparent",classNames:[],styles:[]},n)}function h(){n[1]&&ks(a,n[1]=null,n),n[2]&&ks(a,n[2]=null,n)}return t.$$.update=()=>{t.$$.dirty&16&&n[0]&&h()},[c,a,s,d,n]}class oTt extends Ef{constructor(e){super(),Df(this,e,sTt,rTt,uh,{handleScroll:0})}get handleScroll(){return this.$$.ctx[0]}}function Qre(t){let e,i,n,r;return{c(){e=Pa("div"),pi(e,"class",i=t[2].resizer+(t[0]?" "+t[2].start:""))},m(a,s){Ps(a,e,s),n||(r=Va(e,"pointerdown",t[11]),n=!0)},p(a,s){s&5&&i!==(i=a[2].resizer+(a[0]?" "+a[2].start:""))&&pi(e,"class",i)},d(a){a&&ls(e),n=!1,r()}}}function lTt(t){let e,i=t[1]&&Qre(t);return{c(){i&&i.c(),e=tI()},m(n,r){i&&i.m(n,r),Ps(n,e,r)},p(n,[r]){n[1]?i?i.p(n,r):(i=Qre(n),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:Fs,o:Fs,d(n){n&&ls(e),i&&i.d(n)}}}function uTt(t,e,i){let n,r,a,s,{event:o}=e,{start:l=!1}=e,{theme:u,eventDurationEditable:c,eventResizableFromStart:d,editable:p}=og("state");wt(t,u,m=>i(2,s=m)),wt(t,c,m=>i(9,r=m)),wt(t,d,m=>i(10,a=m)),wt(t,p,m=>i(8,n=m));let h;function f(m){L2.call(this,t,m)}return t.$$set=m=>{"event"in m&&i(7,o=m.event),"start"in m&&i(0,l=m.start)},t.$$.update=()=>{t.$$.dirty&1921&&i(1,h=!_1(o.display)&&!LU(o.display)&&(!l||a)&&((o.durationEditable??r)||(o.editable??n)))},[l,h,s,u,c,d,p,o,n,r,a,f]}class cTt extends Ef{constructor(e){super(),Df(this,e,uTt,lTt,uh,{event:7,start:0})}}function eae(t){let e,i,n={};return e=new oTt({props:n}),t[16](e),{c(){ru(e.$$.fragment)},m(r,a){Sl(e,r,a),i=!0},p(r,a){const s={};e.$set(s)},i(r){i||(on(e.$$.fragment,r),i=!0)},o(r){Zn(e.$$.fragment,r),i=!1},d(r){t[16](null),Tl(e,r)}}}function dTt(t){let e,i,n,r,a={};e=new nTt({props:a}),t[15](e);let s=t[1]&&eae(t);return{c(){ru(e.$$.fragment),i=$u(),s&&s.c(),n=tI()},m(o,l){Sl(e,o,l),Ps(o,i,l),s&&s.m(o,l),Ps(o,n,l),r=!0},p(o,[l]){const u={};e.$set(u),o[1]?s?(s.p(o,l),l&2&&on(s,1)):(s=eae(o),s.c(),on(s,1),s.m(n.parentNode,n)):s&&(Lc(),Zn(s,1,1,()=>{s=null}),Fc())},i(o){r||(on(e.$$.fragment,o),on(s),r=!0)},o(o){Zn(e.$$.fragment,o),Zn(s),r=!1},d(o){o&&(ls(i),ls(n)),t[15](null),Tl(e,o),s&&s.d(o)}}}function pTt(t,e,i){let n,r,a,s,o,l,u,c,{theme:d,editable:p,eventStartEditable:h,pointer:f,_bodyEl:m,_interaction:g,_iClasses:v,_draggable:y}=og("state");wt(t,d,w=>i(11,a=w)),wt(t,p,w=>i(13,l=w)),wt(t,h,w=>i(14,u=w)),wt(t,f,w=>i(1,c=w)),wt(t,m,w=>i(10,r=w)),wt(t,g,w=>i(0,n=w)),wt(t,v,w=>i(17,o=w)),wt(t,y,w=>i(12,s=w)),ks(g,n.resizer=cTt,n);function b(){for(let w of Object.values(n))w?.handleScroll?.()}function I(w){Lm[w?"unshift":"push"](()=>{n.action=w,g.set(n)})}function S(w){Lm[w?"unshift":"push"](()=>{n.pointer=w,g.set(n)})}return t.$$.update=()=>{t.$$.dirty&24576&&ks(y,s=w=>(w.startEditable??u)||(w.editable??l),s),t.$$.dirty&6144&&ks(v,o=(w,T)=>{let{display:U}=T;return LU(U)?[a[U]]:!_1(U)&&s(T)?[a.draggable]:[]},o),t.$$.dirty&1024&&r&&tk(r,"scroll",b)},[n,c,d,p,h,f,m,g,v,y,r,a,s,l,u,I,S]}class hTt extends Ef{constructor(e){super(),Df(this,e,pTt,dTt,uh,{})}}var fTt={createOptions(t){t.dateClick=void 0,t.dragConstraint=void 0,t.dragScroll=!0,t.editable=!1,t.eventDragMinDistance=5,t.eventDragStart=void 0,t.eventDragStop=void 0,t.eventDrop=void 0,t.eventDurationEditable=!0,t.eventLongPressDelay=void 0,t.eventResizableFromStart=!1,t.eventResizeStart=void 0,t.eventResizeStop=void 0,t.eventResize=void 0,t.eventStartEditable=!0,t.longPressDelay=1e3,t.pointer=!1,t.resizeConstraint=void 0,t.select=void 0,t.selectBackgroundColor=void 0,t.selectConstraint=void 0,t.selectLongPressDelay=void 0,t.selectMinDistance=5,t.unselect=void 0,t.unselectAuto=!0,t.unselectCancel="",t.theme.draggable="ec-draggable",t.theme.ghost="ec-ghost",t.theme.preview="ec-preview",t.theme.pointer="ec-pointer",t.theme.resizer="ec-resizer",t.theme.start="ec-start",t.theme.dragging="ec-dragging",t.theme.resizingY="ec-resizing-y",t.theme.resizingX="ec-resizing-x",t.theme.selecting="ec-selecting"},createStores(t){t._draggable=qP(xSt),t._auxiliary.update(e=>[...e,hTt])}};const pq=!1;var UMe=Array.isArray,mTt=Array.prototype.indexOf,F2=Array.from,DMe=Object.defineProperty,YP=Object.getOwnPropertyDescriptor,gTt=Object.getOwnPropertyDescriptors,vTt=Object.prototype,yTt=Array.prototype,EMe=Object.getPrototypeOf,tae=Object.isExtensible;const Ly=()=>{};function PMe(t){for(var e=0;e<t.length;e++)t[e]()}function CMe(){var t,e,i=new Promise((n,r)=>{t=n,e=r});return{promise:i,resolve:t,reject:e}}const Gl=2,LZ=4,$2=8,RMe=1<<24,zv=16,qv=32,lS=64,B2=128,pf=512,au=1024,pd=2048,Fm=4096,Fd=8192,Fy=16384,FZ=32768,jw=65536,iae=1<<17,MMe=1<<18,hE=1<<19,NMe=1<<20,Og=1<<25,Gw=32768,hq=1<<21,$Z=1<<22,$y=1<<23,Qj=Symbol("$state"),bTt=Symbol(""),lT=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function ITt(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function wTt(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function STt(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function TTt(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function UTt(t){throw new Error("https://svelte.dev/e/effect_orphan")}function DTt(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function ETt(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function PTt(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function CTt(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function RTt(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const MTt=1,NTt=2,AMe=4,ATt=8,_Tt=16,kTt=1,xTt=2,Ql=Symbol(),OTt="http://www.w3.org/1999/xhtml";function LTt(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function _Me(t){return t===this.v}function kMe(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function xMe(t){return!kMe(t,this.v)}let V2=!1,FTt=!1;function $Tt(){V2=!0}let fo=null;function FU(t){fo=t}function BZ(t){return OMe().get(t)}function BTt(t,e){return OMe().set(t,e),e}function jN(t,e=!1,i){fo={p:fo,i:!1,c:null,e:null,s:t,x:null,l:V2&&!e?{s:null,u:null,$:[]}:null}}function GN(t){var e=fo,i=e.e;if(i!==null){e.e=null;for(var n of i)iNe(n)}return t!==void 0&&(e.x=t),e.i=!0,fo=e.p,t??{}}function HN(){return!V2||fo!==null&&fo.l===null}function OMe(t){return fo===null&&ITt(),fo.c??=new Map(VTt(fo)||void 0)}function VTt(t){let e=t.p;for(;e!==null;){const i=e.c;if(i!==null)return i;e=e.p}return null}let NI=[];function LMe(){var t=NI;NI=[],PMe(t)}function j2(t){if(NI.length===0&&!KP){var e=NI;queueMicrotask(()=>{e===NI&&LMe()})}NI.push(t)}function jTt(){for(;NI.length>0;)LMe()}function FMe(t){var e=Wr;if(e===null)return wr.f|=$y,t;if((e.f&FZ)===0){if((e.f&B2)===0)throw t;e.b.error(t)}else $U(t,e)}function $U(t,e){for(;e!==null;){if((e.f&B2)!==0)try{e.b.error(t);return}catch(i){t=i}e=e.parent}throw t}const e_=new Set;let ss=null,Ip=null,mp=[],G2=null,fq=!1,KP=!1;class Qf{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#n=0;#i=0;#l=null;#a=new Set;#r=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#i>0}process(e){mp=[],this.apply();var i={parent:null,effect:null,effects:[],render_effects:[]};for(const n of e)this.#s(n,i);this.is_fork||this.#c(),this.is_deferred()?(this.#o(i.effects),this.#o(i.render_effects)):(ss=null,nae(i.render_effects),nae(i.effects),this.#l?.resolve()),Ip=null}#s(e,i){e.f^=au;for(var n=e.first;n!==null;){var r=n.f,a=(r&(qv|lS))!==0,s=a&&(r&au)!==0,o=s||(r&Fd)!==0||this.skipped_effects.has(n);if((n.f&B2)!==0&&n.b?.is_pending()&&(i={parent:i,effect:n,effects:[],render_effects:[]}),!o&&n.fn!==null){a?n.f^=au:(r&LZ)!==0?i.effects.push(n):qN(n)&&((n.f&zv)!==0&&this.#a.add(n),O1(n));var l=n.first;if(l!==null){n=l;continue}}var u=n.parent;for(n=n.next;n===null&&u!==null;)u===i.effect&&(this.#o(i.effects),this.#o(i.render_effects),i=i.parent),n=u.next,u=u.parent}}#o(e){for(const i of e)(i.f&pd)!==0?this.#a.add(i):(i.f&Fm)!==0&&this.#r.add(i),this.#u(i.deps),lu(i,au)}#u(e){if(e!==null)for(const i of e)(i.f&Gl)===0||(i.f&Gw)===0||(i.f^=Gw,this.#u(i.deps))}capture(e,i){this.previous.has(e)||this.previous.set(e,i),(e.f&$y)===0&&(this.current.set(e,e.v),Ip?.set(e,e.v))}activate(){ss=this,this.apply()}deactivate(){ss===this&&(ss=null,Ip=null)}flush(){if(this.activate(),mp.length>0){if($Me(),ss!==null&&ss!==this)return}else this.#n===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#c(){if(this.#i===0){for(const e of this.#e)e();this.#e.clear()}this.#n===0&&this.#d()}#d(){if(e_.size>1){this.previous.clear();var e=Ip,i=!0,n={parent:null,effect:null,effects:[],render_effects:[]};for(const a of e_){if(a===this){i=!1;continue}const s=[];for(const[l,u]of this.current){if(a.current.has(l))if(i&&u!==a.current.get(l))a.current.set(l,u);else continue;s.push(l)}if(s.length===0)continue;const o=[...a.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var r=mp;mp=[];const l=new Set,u=new Map;for(const c of s)BMe(c,o,l,u);if(mp.length>0){ss=a,a.apply();for(const c of mp)a.#s(c,n);a.deactivate()}mp=r}}ss=null,Ip=e}this.committed=!0,e_.delete(this)}increment(e){this.#n+=1,e&&(this.#i+=1)}decrement(e){this.#n-=1,e&&(this.#i-=1),this.revive()}revive(){for(const e of this.#a)this.#r.delete(e),lu(e,pd),Hw(e);for(const e of this.#r)lu(e,Fm),Hw(e);this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=CMe()).promise}static ensure(){if(ss===null){const e=ss=new Qf;e_.add(ss),KP||Qf.enqueue(()=>{ss===e&&e.flush()})}return ss}static enqueue(e){j2(e)}apply(){}}function GTt(t){var e=KP;KP=!0;try{for(var i;;){if(jTt(),mp.length===0&&(ss?.flush(),mp.length===0))return G2=null,i;$Me()}}finally{KP=e}}function $Me(){var t=nw;fq=!0;var e=null;try{var i=0;for(TO(!0);mp.length>0;){var n=Qf.ensure();if(i++>1e3){var r,a;HTt()}n.process(mp),By.clear()}}finally{fq=!1,TO(t),G2=null}}function HTt(){try{DTt()}catch(t){$U(t,G2)}}let Rg=null;function nae(t){var e=t.length;if(e!==0){for(var i=0;i<e;){var n=t[i++];if((n.f&(Fy|Fd))===0&&qN(n)&&(Rg=new Set,O1(n),n.deps===null&&n.first===null&&n.nodes===null&&(n.teardown===null&&n.ac===null?aNe(n):n.fn=null),Rg?.size>0)){By.clear();for(const r of Rg){if((r.f&(Fy|Fd))!==0)continue;const a=[r];let s=r.parent;for(;s!==null;)Rg.has(s)&&(Rg.delete(s),a.push(s)),s=s.parent;for(let o=a.length-1;o>=0;o--){const l=a[o];(l.f&(Fy|Fd))===0&&O1(l)}}Rg.clear()}}Rg=null}}function BMe(t,e,i,n){if(!i.has(t)&&(i.add(t),t.reactions!==null))for(const r of t.reactions){const a=r.f;(a&Gl)!==0?BMe(r,e,i,n):(a&($Z|zv))!==0&&(a&pd)===0&&VMe(r,e,n)&&(lu(r,pd),Hw(r))}}function VMe(t,e,i){const n=i.get(t);if(n!==void 0)return n;if(t.deps!==null)for(const r of t.deps){if(e.includes(r))return!0;if((r.f&Gl)!==0&&VMe(r,e,i))return i.set(r,!0),!0}return i.set(t,!1),!1}function Hw(t){for(var e=G2=t;e.parent!==null;){e=e.parent;var i=e.f;if(fq&&e===Wr&&(i&zv)!==0&&(i&MMe)===0)return;if((i&(lS|qv))!==0){if((i&au)===0)return;e.f^=au}}mp.push(e)}function zTt(t){let e=0,i=zw(0),n;return()=>{k1()&&(Tn(i),oUt(()=>(e===0&&(n=cm(()=>t(()=>ZP(i)))),e+=1,()=>{j2(()=>{e-=1,e===0&&(n?.(),n=void 0,ZP(i))})})))}}var qTt=jw|hE|B2;function WTt(t,e,i){new YTt(t,e,i)}class YTt{parent;#e=!1;#t;#n=null;#i;#l;#a;#r=null;#s=null;#o=null;#u=null;#c=null;#d=0;#p=0;#f=!1;#h=null;#b=zTt(()=>(this.#h=zw(this.#d),()=>{this.#h=null}));constructor(e,i,n){this.#t=e,this.#i=i,this.#l=n,this.parent=Wr.b,this.#e=!!this.#i.pending,this.#a=H2(()=>{Wr.b=this;{var r=this.#v();try{this.#r=Dd(()=>n(r))}catch(a){this.error(a)}this.#p>0?this.#g():this.#e=!1}return()=>{this.#c?.remove()}},qTt)}#I(){try{this.#r=Dd(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#w(){const e=this.#i.pending;e&&(this.#s=Dd(()=>e(this.#t)),Qf.enqueue(()=>{var i=this.#v();this.#r=this.#m(()=>(Qf.ensure(),Dd(()=>this.#l(i)))),this.#p>0?this.#g():(iw(this.#s,()=>{this.#s=null}),this.#e=!1)}))}#v(){var e=this.#t;return this.#e&&(this.#c=Vy(),this.#t.before(this.#c),e=this.#c),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#i.pending}#m(e){var i=Wr,n=wr,r=fo;$m(this.#a),$c(this.#a),FU(this.#a.ctx);try{return e()}catch(a){return FMe(a),null}finally{$m(i),$c(n),FU(r)}}#g(){const e=this.#i.pending;this.#r!==null&&(this.#u=document.createDocumentFragment(),this.#u.append(this.#c),lNe(this.#r,this.#u)),this.#s===null&&(this.#s=Dd(()=>e(this.#t)))}#y(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#y(e);return}this.#p+=e,this.#p===0&&(this.#e=!1,this.#s&&iw(this.#s,()=>{this.#s=null}),this.#u&&(this.#t.before(this.#u),this.#u=null))}update_pending_count(e){this.#y(e),this.#d+=e,this.#h&&BU(this.#h,this.#d)}get_effect_pending(){return this.#b(),Tn(this.#h)}error(e){var i=this.#i.onerror;let n=this.#i.failed;if(this.#f||!i&&!n)throw e;this.#r&&(qu(this.#r),this.#r=null),this.#s&&(qu(this.#s),this.#s=null),this.#o&&(qu(this.#o),this.#o=null);var r=!1,a=!1;const s=()=>{if(r){LTt();return}r=!0,a&&RTt(),Qf.ensure(),this.#d=0,this.#o!==null&&iw(this.#o,()=>{this.#o=null}),this.#e=this.has_pending_snippet(),this.#r=this.#m(()=>(this.#f=!1,Dd(()=>this.#l(this.#t)))),this.#p>0?this.#g():this.#e=!1};var o=wr;try{$c(null),a=!0,i?.(e,s),a=!1}catch(l){$U(l,this.#a&&this.#a.parent)}finally{$c(o)}n&&j2(()=>{this.#o=this.#m(()=>{Qf.ensure(),this.#f=!0;try{return Dd(()=>{n(this.#t,()=>e,()=>s)})}catch(l){return $U(l,this.#a.parent),null}finally{this.#f=!1}})})}}function KTt(t,e,i,n){const r=HN()?VZ:GMe;if(i.length===0&&t.length===0){n(e.map(r));return}var a=ss,s=Wr,o=ZTt();function l(){Promise.all(i.map(u=>XTt(u))).then(u=>{o();try{n([...e.map(r),...u])}catch(c){(s.f&Fy)===0&&$U(c,s)}a?.deactivate(),wO()}).catch(u=>{$U(u,s)})}t.length>0?Promise.all(t).then(()=>{o();try{return l()}finally{a?.deactivate(),wO()}}):l()}function ZTt(){var t=Wr,e=wr,i=fo,n=ss;return function(a=!0){$m(t),$c(e),FU(i),a&&n?.activate()}}function wO(){$m(null),$c(null),FU(null)}function VZ(t){var e=Gl|pd,i=wr!==null&&(wr.f&Gl)!==0?wr:null;return Wr!==null&&(Wr.f|=hE),{ctx:fo,deps:null,effects:null,equals:_Me,f:e,fn:t,reactions:null,rv:0,v:Ql,wv:0,parent:i??Wr,ac:null}}function XTt(t,e){let i=Wr;i===null&&wTt();var n=i.b,r=void 0,a=zw(Ql),s=!wr,o=new Map;return sUt(()=>{var l=CMe();r=l.promise;try{Promise.resolve(t()).then(l.resolve,l.reject).then(()=>{u===ss&&u.committed&&u.deactivate(),wO()})}catch(p){l.reject(p),wO()}var u=ss;if(s){var c=!n.is_pending();n.update_pending_count(1),u.increment(c),o.get(u)?.reject(lT),o.delete(u),o.set(u,l)}const d=(p,h=void 0)=>{if(u.activate(),h)h!==lT&&(a.f|=$y,BU(a,h));else{(a.f&$y)!==0&&(a.f^=$y),BU(a,p);for(const[f,m]of o){if(o.delete(f),f===u)break;m.reject(lT)}}s&&(n.update_pending_count(-1),u.decrement(c))};l.promise.then(d,p=>d(null,p||"unknown"))}),tNe(()=>{for(const l of o.values())l.reject(lT)}),new Promise(l=>{function u(c){function d(){c===r?l(a):u(r)}c.then(d,d)}u(r)})}function jMe(t){const e=VZ(t);return uNe(e),e}function GMe(t){const e=VZ(t);return e.equals=xMe,e}function HMe(t){var e=t.effects;if(e!==null){t.effects=null;for(var i=0;i<e.length;i+=1)qu(e[i])}}function JTt(t){for(var e=t.parent;e!==null;){if((e.f&Gl)===0)return(e.f&Fy)===0?e:null;e=e.parent}return null}function jZ(t){var e,i=Wr;$m(JTt(t));try{t.f&=~Gw,HMe(t),e=hNe(t)}finally{$m(i)}return e}function zMe(t){var e=jZ(t);if(t.equals(e)||(ss?.is_fork||(t.v=e),t.wv=dNe()),!fE)if(Ip!==null)(k1()||ss?.is_fork)&&Ip.set(t,e);else{var i=(t.f&pf)===0?Fm:au;lu(t,i)}}let mq=new Set;const By=new Map;let qMe=!1;function zw(t,e){var i={f:0,v:t,reactions:null,equals:_Me,rv:0,wv:0};return i}function vh(t,e){const i=zw(t);return uNe(i),i}function WMe(t,e=!1,i=!0){const n=zw(t);return e||(n.equals=xMe),V2&&i&&fo!==null&&fo.l!==null&&(fo.l.s??=[]).push(n),n}function Nc(t,e,i=!1){wr!==null&&(!em||(wr.f&iae)!==0)&&HN()&&(wr.f&(Gl|zv|$Z|iae))!==0&&!Hg?.includes(t)&&CTt();let n=i?oP(e):e;return BU(t,n)}function BU(t,e){if(!t.equals(e)){var i=t.v;fE?By.set(t,e):By.set(t,i),t.v=e;var n=Qf.ensure();n.capture(t,i),(t.f&Gl)!==0&&((t.f&pd)!==0&&jZ(t),lu(t,(t.f&pf)!==0?au:Fm)),t.wv=dNe(),YMe(t,pd),HN()&&Wr!==null&&(Wr.f&au)!==0&&(Wr.f&(qv|lS))===0&&(dp===null?dUt([t]):dp.push(t)),!n.is_fork&&mq.size>0&&!qMe&&QTt()}return e}function QTt(){qMe=!1;var t=nw;TO(!0);const e=Array.from(mq);try{for(const i of e)(i.f&au)!==0&&lu(i,Fm),qN(i)&&O1(i)}finally{TO(t)}mq.clear()}function ZP(t){Nc(t,t.v+1)}function YMe(t,e){var i=t.reactions;if(i!==null)for(var n=HN(),r=i.length,a=0;a<r;a++){var s=i[a],o=s.f;if(!(!n&&s===Wr)){var l=(o&pd)===0;if(l&&lu(s,e),(o&Gl)!==0){var u=s;Ip?.delete(u),(o&Gw)===0&&(o&pf&&(s.f|=Gw),YMe(u,Fm))}else l&&((o&zv)!==0&&Rg!==null&&Rg.add(s),Hw(s))}}}function oP(t){if(typeof t!="object"||t===null||Qj in t)return t;const e=EMe(t);if(e!==vTt&&e!==yTt)return t;var i=new Map,n=UMe(t),r=vh(0),a=rw,s=o=>{if(rw===a)return o();var l=wr,u=rw;$c(null),oae(a);var c=o();return $c(l),oae(u),c};return n&&i.set("length",vh(t.length)),new Proxy(t,{defineProperty(o,l,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&ETt();var c=i.get(l);return c===void 0?c=s(()=>{var d=vh(u.value);return i.set(l,d),d}):Nc(c,u.value,!0),!0},deleteProperty(o,l){var u=i.get(l);if(u===void 0){if(l in o){const c=s(()=>vh(Ql));i.set(l,c),ZP(r)}}else Nc(u,Ql),ZP(r);return!0},get(o,l,u){if(l===Qj)return t;var c=i.get(l),d=l in o;if(c===void 0&&(!d||YP(o,l)?.writable)&&(c=s(()=>{var h=oP(d?o[l]:Ql),f=vh(h);return f}),i.set(l,c)),c!==void 0){var p=Tn(c);return p===Ql?void 0:p}return Reflect.get(o,l,u)},getOwnPropertyDescriptor(o,l){var u=Reflect.getOwnPropertyDescriptor(o,l);if(u&&"value"in u){var c=i.get(l);c&&(u.value=Tn(c))}else if(u===void 0){var d=i.get(l),p=d?.v;if(d!==void 0&&p!==Ql)return{enumerable:!0,configurable:!0,value:p,writable:!0}}return u},has(o,l){if(l===Qj)return!0;var u=i.get(l),c=u!==void 0&&u.v!==Ql||Reflect.has(o,l);if(u!==void 0||Wr!==null&&(!c||YP(o,l)?.writable)){u===void 0&&(u=s(()=>{var p=c?oP(o[l]):Ql,h=vh(p);return h}),i.set(l,u));var d=Tn(u);if(d===Ql)return!1}return c},set(o,l,u,c){var d=i.get(l),p=l in o;if(n&&l==="length")for(var h=u;h<d.v;h+=1){var f=i.get(h+"");f!==void 0?Nc(f,Ql):h in o&&(f=s(()=>vh(Ql)),i.set(h+"",f))}if(d===void 0)(!p||YP(o,l)?.writable)&&(d=s(()=>vh(void 0)),Nc(d,oP(u)),i.set(l,d));else{p=d.v!==Ql;var m=s(()=>oP(u));Nc(d,m)}var g=Reflect.getOwnPropertyDescriptor(o,l);if(g?.set&&g.set.call(c,u),!p){if(n&&typeof l=="string"){var v=i.get("length"),y=Number(l);Number.isInteger(y)&&y>=v.v&&Nc(v,y+1)}ZP(r)}return!0},ownKeys(o){Tn(r);var l=Reflect.ownKeys(o).filter(d=>{var p=i.get(d);return p===void 0||p.v!==Ql});for(var[u,c]of i)c.v!==Ql&&!(u in o)&&l.push(u);return l},setPrototypeOf(){PTt()}})}var rae,KMe,ZMe,XMe;function eUt(){if(rae===void 0){rae=window,KMe=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,i=Text.prototype;ZMe=YP(e,"firstChild").get,XMe=YP(e,"nextSibling").get,tae(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),tae(i)&&(i.__t=void 0)}}function Vy(t=""){return document.createTextNode(t)}function SO(t){return ZMe.call(t)}function zN(t){return XMe.call(t)}function uT(t,e){return SO(t)}function Ih(t,e=!1){{var i=SO(t);return i instanceof Comment&&i.data===""?zN(i):i}}function aae(t,e=1,i=!1){let n=t;for(;e--;)n=zN(n);return n}function tUt(t){t.textContent=""}function JMe(){return!1}function QMe(t){var e=wr,i=Wr;$c(null),$m(null);try{return t()}finally{$c(e),$m(i)}}function eNe(t){Wr===null&&(wr===null&&UTt(),TTt()),fE&&STt()}function iUt(t,e){var i=e.last;i===null?e.last=e.first=t:(i.next=t,t.prev=i,e.last=t)}function Pf(t,e,i){var n=Wr;n!==null&&(n.f&Fd)!==0&&(t|=Fd);var r={ctx:fo,deps:null,nodes:null,f:t|pd|pf,first:null,fn:e,last:null,next:null,parent:n,b:n&&n.b,prev:null,teardown:null,wv:0,ac:null};if(i)try{O1(r),r.f|=FZ}catch(o){throw qu(r),o}else e!==null&&Hw(r);var a=r;if(i&&a.deps===null&&a.teardown===null&&a.nodes===null&&a.first===a.last&&(a.f&hE)===0&&(a=a.first,(t&zv)!==0&&(t&jw)!==0&&a!==null&&(a.f|=jw)),a!==null&&(a.parent=n,n!==null&&iUt(a,n),wr!==null&&(wr.f&Gl)!==0&&(t&lS)===0)){var s=wr;(s.effects??=[]).push(a)}return r}function k1(){return wr!==null&&!em}function tNe(t){const e=Pf($2,null,!1);return lu(e,au),e.teardown=t,e}function nk(t){eNe();var e=Wr.f,i=!wr&&(e&qv)!==0&&(e&FZ)===0;if(i){var n=fo;(n.e??=[]).push(t)}else return iNe(t)}function iNe(t){return Pf(LZ|NMe,t,!1)}function nUt(t){return eNe(),Pf($2|NMe,t,!0)}function rUt(t){Qf.ensure();const e=Pf(lS|hE,t,!0);return(i={})=>new Promise(n=>{i.outro?iw(e,()=>{qu(e),n(void 0)}):(qu(e),n(void 0))})}function aUt(t){return Pf(LZ,t,!1)}function sUt(t){return Pf($Z|hE,t,!0)}function oUt(t,e=0){return Pf($2|e,t,!0)}function jf(t,e=[],i=[],n=[]){KTt(n,e,i,r=>{Pf($2,()=>t(...r.map(Tn)),!0)})}function H2(t,e=0){var i=Pf(zv|e,t,!0);return i}function lUt(t,e=0){var i=Pf(RMe|e,t,!0);return i}function Dd(t){return Pf(qv|hE,t,!0)}function nNe(t){var e=t.teardown;if(e!==null){const i=fE,n=wr;sae(!0),$c(null);try{e.call(null)}finally{sae(i),$c(n)}}}function rNe(t,e=!1){var i=t.first;for(t.first=t.last=null;i!==null;){const r=i.ac;r!==null&&QMe(()=>{r.abort(lT)});var n=i.next;(i.f&lS)!==0?i.parent=null:qu(i,e),i=n}}function uUt(t){for(var e=t.first;e!==null;){var i=e.next;(e.f&qv)===0&&qu(e),e=i}}function qu(t,e=!0){var i=!1;(e||(t.f&MMe)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(cUt(t.nodes.start,t.nodes.end),i=!0),rNe(t,e&&!i),UO(t,0),lu(t,Fy);var n=t.nodes&&t.nodes.t;if(n!==null)for(const a of n)a.stop();nNe(t);var r=t.parent;r!==null&&r.first!==null&&aNe(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function cUt(t,e){for(;t!==null;){var i=t===e?null:zN(t);t.remove(),t=i}}function aNe(t){var e=t.parent,i=t.prev,n=t.next;i!==null&&(i.next=n),n!==null&&(n.prev=i),e!==null&&(e.first===t&&(e.first=n),e.last===t&&(e.last=i))}function iw(t,e,i=!0){var n=[];sNe(t,n,!0);var r=()=>{i&&qu(t),e&&e()},a=n.length;if(a>0){var s=()=>--a||r();for(var o of n)o.out(s)}else r()}function sNe(t,e,i){if((t.f&Fd)===0){t.f^=Fd;var n=t.nodes&&t.nodes.t;if(n!==null)for(const o of n)(o.is_global||i)&&e.push(o);for(var r=t.first;r!==null;){var a=r.next,s=(r.f&jw)!==0||(r.f&qv)!==0&&(t.f&zv)!==0;sNe(r,e,s?i:!1),r=a}}}function GZ(t){oNe(t,!0)}function oNe(t,e){if((t.f&Fd)!==0){t.f^=Fd,(t.f&au)===0&&(lu(t,pd),Hw(t));for(var i=t.first;i!==null;){var n=i.next,r=(i.f&jw)!==0||(i.f&qv)!==0;oNe(i,r?e:!1),i=n}var a=t.nodes&&t.nodes.t;if(a!==null)for(const s of a)(s.is_global||e)&&s.in()}}function lNe(t,e){if(t.nodes)for(var i=t.nodes.start,n=t.nodes.end;i!==null;){var r=i===n?null:zN(i);e.append(i),i=r}}let nw=!1;function TO(t){nw=t}let fE=!1;function sae(t){fE=t}let wr=null,em=!1;function $c(t){wr=t}let Wr=null;function $m(t){Wr=t}let Hg=null;function uNe(t){wr!==null&&(Hg===null?Hg=[t]:Hg.push(t))}let ku=null,Td=0,dp=null;function dUt(t){dp=t}let cNe=1,x1=0,rw=x1;function oae(t){rw=t}function dNe(){return++cNe}function qN(t){var e=t.f;if((e&pd)!==0)return!0;if(e&Gl&&(t.f&=~Gw),(e&Fm)!==0){var i=t.deps;if(i!==null)for(var n=i.length,r=0;r<n;r++){var a=i[r];if(qN(a)&&zMe(a),a.wv>t.wv)return!0}(e&pf)!==0&&Ip===null&&lu(t,au)}return!1}function pNe(t,e,i=!0){var n=t.reactions;if(n!==null&&!Hg?.includes(t))for(var r=0;r<n.length;r++){var a=n[r];(a.f&Gl)!==0?pNe(a,e,!1):e===a&&(i?lu(a,pd):(a.f&au)!==0&&lu(a,Fm),Hw(a))}}function hNe(t){var e=ku,i=Td,n=dp,r=wr,a=Hg,s=fo,o=em,l=rw,u=t.f;ku=null,Td=0,dp=null,wr=(u&(qv|lS))===0?t:null,Hg=null,FU(t.ctx),em=!1,rw=++x1,t.ac!==null&&(QMe(()=>{t.ac.abort(lT)}),t.ac=null);try{t.f|=hq;var c=t.fn,d=c(),p=t.deps;if(ku!==null){var h;if(UO(t,Td),p!==null&&Td>0)for(p.length=Td+ku.length,h=0;h<ku.length;h++)p[Td+h]=ku[h];else t.deps=p=ku;if(k1()&&(t.f&pf)!==0)for(h=Td;h<p.length;h++)(p[h].reactions??=[]).push(t)}else p!==null&&Td<p.length&&(UO(t,Td),p.length=Td);if(HN()&&dp!==null&&!em&&p!==null&&(t.f&(Gl|Fm|pd))===0)for(h=0;h<dp.length;h++)pNe(dp[h],t);return r!==null&&r!==t&&(x1++,dp!==null&&(n===null?n=dp:n.push(...dp))),(t.f&$y)!==0&&(t.f^=$y),d}catch(f){return FMe(f)}finally{t.f^=hq,ku=e,Td=i,dp=n,wr=r,Hg=a,FU(s),em=o,rw=l}}function pUt(t,e){let i=e.reactions;if(i!==null){var n=mTt.call(i,t);if(n!==-1){var r=i.length-1;r===0?i=e.reactions=null:(i[n]=i[r],i.pop())}}i===null&&(e.f&Gl)!==0&&(ku===null||!ku.includes(e))&&(lu(e,Fm),(e.f&pf)!==0&&(e.f^=pf,e.f&=~Gw),HMe(e),UO(e,0))}function UO(t,e){var i=t.deps;if(i!==null)for(var n=e;n<i.length;n++)pUt(t,i[n])}function O1(t){var e=t.f;if((e&Fy)===0){lu(t,au);var i=Wr,n=nw;Wr=t,nw=!0;try{(e&(zv|RMe))!==0?uUt(t):rNe(t),nNe(t);var r=hNe(t);t.teardown=typeof r=="function"?r:null,t.wv=cNe;var a;pq&&FTt&&(t.f&pd)!==0&&t.deps}finally{nw=n,Wr=i}}}async function fNe(){await Promise.resolve(),GTt()}function Tn(t){var e=t.f,i=(e&Gl)!==0;if(wr!==null&&!em){var n=Wr!==null&&(Wr.f&Fy)!==0;if(!n&&!Hg?.includes(t)){var r=wr.deps;if((wr.f&hq)!==0)t.rv<x1&&(t.rv=x1,ku===null&&r!==null&&r[Td]===t?Td++:ku===null?ku=[t]:ku.includes(t)||ku.push(t));else{(wr.deps??=[]).push(t);var a=t.reactions;a===null?t.reactions=[wr]:a.includes(wr)||a.push(wr)}}}if(fE){if(By.has(t))return By.get(t);if(i){var s=t,o=s.v;return((s.f&au)===0&&s.reactions!==null||gNe(s))&&(o=jZ(s)),By.set(s,o),o}}else i&&(!Ip?.has(t)||ss?.is_fork&&!k1())&&(s=t,qN(s)&&zMe(s),nw&&k1()&&(s.f&pf)===0&&mNe(s));if(Ip?.has(t))return Ip.get(t);if((t.f&$y)!==0)throw t.v;return t.v}function mNe(t){if(t.deps!==null){t.f^=pf;for(const e of t.deps)(e.reactions??=[]).push(t),(e.f&Gl)!==0&&(e.f&pf)===0&&mNe(e)}}function gNe(t){if(t.v===Ql)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(By.has(e)||(e.f&Gl)!==0&&gNe(e))return!0;return!1}function cm(t){var e=em;try{return em=!0,t()}finally{em=e}}const hUt=-7169;function lu(t,e){t.f=t.f&hUt|e}const fUt=["touchstart","touchmove"];function mUt(t){return fUt.includes(t)}const vNe=new Set,gq=new Set;function iI(t){for(var e=0;e<t.length;e++)vNe.add(t[e]);for(var i of gq)i(t)}let lae=null;function t_(t){var e=this,i=e.ownerDocument,n=t.type,r=t.composedPath?.()||[],a=r[0]||t.target;lae=t;var s=0,o=lae===t&&t.__root;if(o){var l=r.indexOf(o);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var u=r.indexOf(e);if(u===-1)return;l<=u&&(s=l)}if(a=r[s]||t.target,a!==e){DMe(t,"currentTarget",{configurable:!0,get(){return a||i}});var c=wr,d=Wr;$c(null),$m(null);try{for(var p,h=[];a!==null;){var f=a.assignedSlot||a.parentNode||a.host||null;try{var m=a["__"+n];m!=null&&(!a.disabled||t.target===a)&&m.call(a,t)}catch(g){p?h.push(g):p=g}if(t.cancelBubble||f===e||f===null)break;a=f}if(p){for(let g of h)queueMicrotask(()=>{throw g});throw p}}finally{t.__root=e,delete t.currentTarget,$c(c),$m(d)}}}function gUt(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function vq(t,e){var i=Wr;i.nodes===null&&(i.nodes={start:t,end:e,a:null,t:null})}function lg(t,e){var i=(e&kTt)!==0,n=(e&xTt)!==0,r,a=!t.startsWith("<!>");return()=>{r===void 0&&(r=gUt(a?t:"<!>"+t),i||(r=SO(r)));var s=n||KMe?document.importNode(r,!0):r.cloneNode(!0);if(i){var o=SO(s),l=s.lastChild;vq(o,l)}else vq(s,s);return s}}function Bf(){var t=document.createDocumentFragment(),e=document.createComment(""),i=Vy();return t.append(e,i),vq(e,i),t}function ao(t,e){t!==null&&t.before(e)}function uae(t,e){var i=e==null?"":typeof e=="object"?e+"":e;i!==(t.__t??=t.nodeValue)&&(t.__t=i,t.nodeValue=i+"")}function vUt(t,e){return yUt(t,e)}const OS=new Map;function yUt(t,{target:e,anchor:i,props:n={},events:r,context:a,intro:s=!0}){eUt();var o=new Set,l=d=>{for(var p=0;p<d.length;p++){var h=d[p];if(!o.has(h)){o.add(h);var f=mUt(h);e.addEventListener(h,t_,{passive:f});var m=OS.get(h);m===void 0?(document.addEventListener(h,t_,{passive:f}),OS.set(h,1)):OS.set(h,m+1)}}};l(F2(vNe)),gq.add(l);var u=void 0,c=rUt(()=>{var d=i??e.appendChild(Vy());return WTt(d,{pending:()=>{}},p=>{if(a){jN({});var h=fo;h.c=a}r&&(n.$$events=r),u=t(p,n)||{},a&&GN()}),()=>{for(var p of o){e.removeEventListener(p,t_);var h=OS.get(p);--h===0?(document.removeEventListener(p,t_),OS.delete(p)):OS.set(p,h)}gq.delete(l),d!==i&&d.parentNode?.removeChild(d)}});return bUt.set(u,c),u}let bUt=new WeakMap;class yNe{anchor;#e=new Map;#t=new Map;#n=new Map;#i=new Set;#l=!0;constructor(e,i=!0){this.anchor=e,this.#l=i}#a=()=>{var e=ss;if(this.#e.has(e)){var i=this.#e.get(e),n=this.#t.get(i);if(n)GZ(n),this.#i.delete(i);else{var r=this.#n.get(i);r&&(this.#t.set(i,r.effect),this.#n.delete(i),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),n=r.effect)}for(const[a,s]of this.#e){if(this.#e.delete(a),a===e)break;const o=this.#n.get(s);o&&(qu(o.effect),this.#n.delete(s))}for(const[a,s]of this.#t){if(a===i||this.#i.has(a))continue;const o=()=>{if(Array.from(this.#e.values()).includes(a)){var u=document.createDocumentFragment();lNe(s,u),u.append(Vy()),this.#n.set(a,{effect:s,fragment:u})}else qu(s);this.#i.delete(a),this.#t.delete(a)};this.#l||!n?(this.#i.add(a),iw(s,o,!1)):o()}}};#r=e=>{this.#e.delete(e);const i=Array.from(this.#e.values());for(const[n,r]of this.#n)i.includes(n)||(qu(r.effect),this.#n.delete(n))};ensure(e,i){var n=ss,r=JMe();if(i&&!this.#t.has(e)&&!this.#n.has(e))if(r){var a=document.createDocumentFragment(),s=Vy();a.append(s),this.#n.set(e,{effect:Dd(()=>i(s)),fragment:a})}else this.#t.set(e,Dd(()=>i(this.anchor)));if(this.#e.set(n,e),r){for(const[o,l]of this.#t)o===e?n.skipped_effects.delete(l):n.skipped_effects.add(l);for(const[o,l]of this.#n)o===e?n.skipped_effects.delete(l.effect):n.skipped_effects.add(l.effect);n.oncommit(this.#a),n.ondiscard(this.#r)}else this.#a()}}function SI(t,e,i=!1){var n=new yNe(t),r=i?jw:0;function a(s,o){n.ensure(s,o)}H2(()=>{var s=!1;e((o,l=!0)=>{s=!0,a(l,o)}),s||a(!1,null)},r)}function DO(t,e){return e}function IUt(t,e,i){for(var n=[],r=e.length,a,s=e.length,o=0;o<r;o++){let d=e[o];iw(d,()=>{if(a){if(a.pending.delete(d),a.done.add(d),a.pending.size===0){var p=t.outrogroups;yq(F2(a.done)),p.delete(a),p.size===0&&(t.outrogroups=null)}}else s-=1},!1)}if(s===0){var l=n.length===0&&i!==null;if(l){var u=i,c=u.parentNode;tUt(c),c.append(u),t.items.clear()}yq(e,!l)}else a={pending:new Set(e),done:new Set},(t.outrogroups??=new Set).add(a)}function yq(t,e=!0){for(var i=0;i<t.length;i++)qu(t[i],e)}var cae;function EO(t,e,i,n,r,a=null){var s=t,o=new Map,l=(e&AMe)!==0;if(l){var u=t;s=u.appendChild(Vy())}var c=null,d=GMe(()=>{var v=i();return UMe(v)?v:v==null?[]:F2(v)}),p,h=!0;function f(){g.fallback=c,wUt(g,p,s,e,n),c!==null&&(p.length===0?(c.f&Og)===0?GZ(c):(c.f^=Og,lP(c,null,s)):iw(c,()=>{c=null}))}var m=H2(()=>{p=Tn(d);for(var v=p.length,y=new Set,b=ss,I=JMe(),S=0;S<v;S+=1){var w=p[S],T=n(w,S),U=h?null:o.get(T);U?(U.v&&BU(U.v,w),U.i&&BU(U.i,S),I&&b.skipped_effects.delete(U.e)):(U=SUt(o,h?s:cae??=Vy(),w,T,S,r,e,i),h||(U.e.f|=Og),o.set(T,U)),y.add(T)}if(v===0&&a&&!c&&(h?c=Dd(()=>a(s)):(c=Dd(()=>a(cae??=Vy())),c.f|=Og)),!h)if(I){for(const[C,E]of o)y.has(C)||b.skipped_effects.add(E.e);b.oncommit(f),b.ondiscard(()=>{})}else f();Tn(d)}),g={effect:m,items:o,outrogroups:null,fallback:c};h=!1}function wUt(t,e,i,n,r){var a=(n&ATt)!==0,s=e.length,o=t.items,l=t.effect.first,u,c=null,d,p=[],h=[],f,m,g,v;if(a)for(v=0;v<s;v+=1)f=e[v],m=r(f,v),g=o.get(m).e,(g.f&Og)===0&&(g.nodes?.a?.measure(),(d??=new Set).add(g));for(v=0;v<s;v+=1){if(f=e[v],m=r(f,v),g=o.get(m).e,t.outrogroups!==null)for(const E of t.outrogroups)E.pending.delete(g),E.done.delete(g);if((g.f&Og)!==0)if(g.f^=Og,g===l)lP(g,null,i);else{var y=c?c.next:l;g===t.effect.last&&(t.effect.last=g.prev),g.prev&&(g.prev.next=g.next),g.next&&(g.next.prev=g.prev),ry(t,c,g),ry(t,g,y),lP(g,y,i),c=g,p=[],h=[],l=c.next;continue}if((g.f&Fd)!==0&&(GZ(g),a&&(g.nodes?.a?.unfix(),(d??=new Set).delete(g))),g!==l){if(u!==void 0&&u.has(g)){if(p.length<h.length){var b=h[0],I;c=b.prev;var S=p[0],w=p[p.length-1];for(I=0;I<p.length;I+=1)lP(p[I],b,i);for(I=0;I<h.length;I+=1)u.delete(h[I]);ry(t,S.prev,w.next),ry(t,c,S),ry(t,w,b),l=b,c=w,v-=1,p=[],h=[]}else u.delete(g),lP(g,l,i),ry(t,g.prev,g.next),ry(t,g,c===null?t.effect.first:c.next),ry(t,c,g),c=g;continue}for(p=[],h=[];l!==null&&l!==g;)(u??=new Set).add(l),h.push(l),l=l.next;if(l===null)continue}(g.f&Og)===0&&p.push(g),c=g,l=g.next}if(t.outrogroups!==null){for(const E of t.outrogroups)E.pending.size===0&&(yq(F2(E.done)),t.outrogroups?.delete(E));t.outrogroups.size===0&&(t.outrogroups=null)}if(l!==null||u!==void 0){var T=[];if(u!==void 0)for(g of u)(g.f&Fd)===0&&T.push(g);for(;l!==null;)(l.f&Fd)===0&&l!==t.fallback&&T.push(l),l=l.next;var U=T.length;if(U>0){var C=(n&AMe)!==0&&s===0?i:null;if(a){for(v=0;v<U;v+=1)T[v].nodes?.a?.measure();for(v=0;v<U;v+=1)T[v].nodes?.a?.fix()}IUt(t,T,C)}}a&&j2(()=>{if(d!==void 0)for(g of d)g.nodes?.a?.apply()})}function SUt(t,e,i,n,r,a,s,o){var l=(s&MTt)!==0?(s&_Tt)===0?WMe(i,!1,!1):zw(i):null,u=(s&NTt)!==0?zw(r):null;return{v:l,i:u,e:Dd(()=>(a(e,l??i,u??r,o),()=>{t.delete(n)}))}}function lP(t,e,i){if(t.nodes)for(var n=t.nodes.start,r=t.nodes.end,a=e&&(e.f&Og)===0?e.nodes.start:i;n!==null;){var s=zN(n);if(a.before(n),n===r)return;n=s}}function ry(t,e,i){e===null?t.effect.first=i:e.next=i,i===null?t.effect.last=e:i.prev=e}function bNe(t,e,i){var n=new yNe(t);H2(()=>{var r=e()??null;n.ensure(r,r&&(a=>i(a,r)))},jw)}function dae(t,e){var i=void 0,n;lUt(()=>{i!==(i=e())&&(n&&(qu(n),n=null),i&&(n=Dd(()=>{aUt(()=>i(t))})))})}function INe(t){var e,i,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(i=INe(t[e]))&&(n&&(n+=" "),n+=i)}else for(i in t)t[i]&&(n&&(n+=" "),n+=i);return n}function TUt(){for(var t,e,i=0,n="",r=arguments.length;i<r;i++)(t=arguments[i])&&(e=INe(t))&&(n&&(n+=" "),n+=e);return n}function bq(t){return typeof t=="object"?TUt(t):t??""}function UUt(t,e,i){var n=t==null?"":""+t;return n===""?null:n}function pae(t,e=!1){var i=e?" !important;":";",n="";for(var r in t){var a=t[r];a!=null&&a!==""&&(n+=" "+r+": "+a+i)}return n}function DUt(t,e){if(e){var i="",n,r;return Array.isArray(e)?(n=e[0],r=e[1]):n=e,n&&(i+=pae(n)),r&&(i+=pae(r,!0)),i=i.trim(),i===""?null:i}return String(t)}function pp(t,e,i,n,r,a){var s=t.__className;if(s!==i||s===void 0){var o=UUt(i);o==null?t.removeAttribute("class"):t.className=o,t.__className=i}return a}function eG(t,e={},i,n){for(var r in i){var a=i[r];e[r]!==a&&(i[r]==null?t.style.removeProperty(r):t.style.setProperty(r,a,n))}}function EUt(t,e,i,n){var r=t.__style;if(r!==e){var a=DUt(e,n);a==null?t.removeAttribute("style"):t.style.cssText=a,t.__style=e}else n&&(Array.isArray(n)?(eG(t,i?.[0],n[0]),eG(t,i?.[1],n[1],"important")):eG(t,i,n));return n}const PUt=Symbol("is custom element"),CUt=Symbol("is html");function uP(t,e,i,n){var r=RUt(t);r[e]!==(r[e]=i)&&(e==="loading"&&(t[bTt]=i),i==null?t.removeAttribute(e):typeof i!="string"&&MUt(t).includes(e)?t[e]=i:t.setAttribute(e,i))}function RUt(t){return t.__attributes??={[PUt]:t.nodeName.includes("-"),[CUt]:t.namespaceURI===OTt}}var hae=new Map;function MUt(t){var e=t.getAttribute("is")||t.nodeName,i=hae.get(e);if(i)return i;hae.set(e,i=[]);for(var n,r=t,a=Element.prototype;a!==r;){n=gTt(r);for(var s in n)n[s].set&&i.push(s);r=EMe(r)}return i}function HZ(t,e,i){if(t==null)return e(void 0),i&&i(void 0),Ly;const n=cm(()=>t.subscribe(e,i));return n.unsubscribe?()=>n.unsubscribe():n}const LS=[];function wNe(t,e){return{subscribe:Uc(t,e).subscribe}}function Uc(t,e=Ly){let i=null;const n=new Set;function r(o){if(kMe(t,o)&&(t=o,i)){const l=!LS.length;for(const u of n)u[1](),LS.push(u,t);if(l){for(let u=0;u<LS.length;u+=2)LS[u][0](LS[u+1]);LS.length=0}}}function a(o){r(o(t))}function s(o,l=Ly){const u=[o,l];return n.add(u),n.size===1&&(i=e(r,a)||Ly),o(t),()=>{n.delete(u),n.size===0&&i&&(i(),i=null)}}return{set:r,update:a,subscribe:s}}function ug(t,e,i){const n=!Array.isArray(t),r=n?[t]:t;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const a=e.length<2;return wNe(i,(s,o)=>{let l=!1;const u=[];let c=0,d=Ly;const p=()=>{if(c)return;d();const f=e(n?u[0]:u,s,o);a?s(f):d=typeof f=="function"?f:Ly},h=r.map((f,m)=>HZ(f,g=>{u[m]=g,c&=~(1<<m),l&&p()},()=>{c|=1<<m}));return l=!0,p(),function(){PMe(h),d(),l=!1}})}function L1(t){let e;return HZ(t,i=>e=i)(),e}let Iq=Symbol();function Fr(t,e,i){const n=i[e]??={store:null,source:WMe(void 0),unsubscribe:Ly};if(n.store!==t&&!(Iq in i))if(n.unsubscribe(),n.store=t??null,t==null)n.source.v=void 0,n.unsubscribe=Ly;else{var r=!0;n.unsubscribe=HZ(t,a=>{r?n.source.v=a:Nc(n.source,a)}),r=!1}return t&&Iq in i?L1(t):Tn(n.source)}function kg(t,e){return t.set(e),e}function z2(){const t={};function e(){tNe(()=>{for(var i in t)t[i].unsubscribe();DMe(t,Iq,{enumerable:!1,value:!0})})}return[t,e]}function NUt(t,e,i){return t.set(i),e}function fae(t,e,i,n){var r=n,a=!0,s=()=>(a&&(a=!1,r=cm(n)),r),o;o=t[e],o===void 0&&n!==void 0&&(o=s());var l;return l=()=>{var u=t[e];return u===void 0?s():(a=!0,u)},l}const AUt="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(AUt);$Tt();function mae(t){return e=>{typeof t=="string"?e.innerText=t:t?.domNodes?e.replaceChildren(...t.domNodes):t?.html&&(e.innerHTML=t.html)}}function vv(t=void 0){return t!==void 0?t instanceof Date?vae(t):OUt(t):vae(new Date)}function _Ut(t){if(typeof t=="number")t={seconds:t};else if(typeof t=="string"){let i=0,n=2;for(let r of t.split(":",3))i+=parseInt(r,10)*Math.pow(60,n--);t={seconds:i}}else t instanceof Date&&(t={hours:t.getUTCHours(),minutes:t.getUTCMinutes(),seconds:t.getUTCSeconds()});let e=t.weeks||t.week||0;return{years:t.years||t.year||0,months:t.months||t.month||0,days:e*7+(t.days||t.day||0),seconds:(t.hours||t.hour||0)*60*60+(t.minutes||t.minute||0)*60+(t.seconds||t.second||0),inWeeks:!!e}}function _p(t){return new Date(t.getTime())}function zZ(t,e,i=1){t.setUTCFullYear(t.getUTCFullYear()+i*e.years);let n=t.getUTCMonth()+i*e.months;for(t.setUTCMonth(n),n%=12,n<0&&(n+=12);t.getUTCMonth()!==n;)qZ(t);return t.setUTCDate(t.getUTCDate()+i*e.days),t.setUTCSeconds(t.getUTCSeconds()+i*e.seconds),t}function kUt(t,e,i=1){return zZ(t,e,-i)}function PO(t,e=1){return t.setUTCDate(t.getUTCDate()+e),t}function qZ(t,e=1){return PO(t,-e)}function Bm(t){return t.setUTCHours(0,0,0,0),t}function Bc(t){return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds())}function CO(t,e=19){return t.toISOString().substring(0,e)}function wq(t,...e){return e.every(i=>t.getTime()===i.getTime())}function xUt(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i<=0?i:i-7)),t}function gae(t){return typeof t=="string"&&t.length<=10}function SNe(t,e){return zZ(t,e),t}function TNe(t,e,i){if(kUt(t,e),i.length&&i.length<7)for(;i.includes(t.getUTCDay());)qZ(t);return t}function vae(t){return new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()))}function OUt(t){const e=t.match(/\d+/g);return new Date(Date.UTC(Number(e[0]),Number(e[1])-1,Number(e[2]),Number(e[3]||0),Number(e[4]||0),Number(e[5]||0)))}function q2(...t){return Object.assign(...t)}function Lg(t){return Object.keys(t)}function LUt(){return Symbol("ec")}function FUt(t){return Array.isArray(t)}function _d(t){return typeof t=="function"}function $Ut(t){return t()}function BUt(t){t.forEach($Ut)}const yae=t=>t;let WZ=LUt();function VUt(t,e){t[WZ]=e}function jUt(t){return!!t?.[WZ]}function GUt(t){return t[WZ]}function UNe(t,e,i=document,n=[]){n.push(i);for(let r of i.elementsFromPoint(t,e)){if(jUt(r))return r;if(r.shadowRoot&&!n.includes(r.shadowRoot)){let a=UNe(t,e,r.shadowRoot,n);if(a)return a}}return null}function HUt(t,e,i,n){return{type:t,title:e,currentStart:i.start,currentEnd:i.end,activeStart:n.start,activeEnd:n.end,calendar:void 0}}function RO(t){return t=q2({},t),t.currentStart=Bc(t.currentStart),t.currentEnd=Bc(t.currentEnd),t.activeStart=Bc(t.activeStart),t.activeEnd=Bc(t.activeEnd),t}function zUt(t){return t.startsWith("list")}let qUt=1;function MO(t){return t.map(e=>{let i={id:"id"in e?String(e.id):`{generated-${qUt++}}`,resourceIds:tG(e,"resourceId").map(String),allDay:e.allDay??(gae(e.start)&&gae(e.end)),start:vv(e.start),end:vv(e.end),title:e.title??"",editable:e.editable,startEditable:e.startEditable,durationEditable:e.durationEditable,display:e.display??"auto",extendedProps:e.extendedProps??{},backgroundColor:e.backgroundColor??e.color,textColor:e.textColor,classNames:tG(e,"className"),styles:tG(e,"style")};if(i.allDay){Bm(i.start);let n=_p(i.end);Bm(i.end),(!wq(i.end,n)||wq(i.end,i.start))&&PO(i.end)}return i})}function tG(t,e){let i=t[e+"s"]??t[e]??[];return FUt(i)?i:[i]}function WUt(t){return t.map(e=>({events:e.events,url:e.url&&e.url.trimEnd("&")||"",method:e.method&&e.method.toUpperCase()||"GET",extraParams:e.extraParams||{}}))}function Uy(t){return YUt(t,Bc)}function YUt(t,e){return t=q2({},t),t.start=e(t.start),t.end=e(t.end),t}function DNe(t,e,i){i.update(n=>n.set(e,t))}function KUt(t){BUt(t),t.clear()}function ZUt(t,e,i){e??=t,i.has(e)||i.set(e,setTimeout(()=>{i.delete(e),t()}))}function XUt(t){let e,i;return t&&({start:e,end:i}=t,e&&(e=Bm(vv(e))),i&&(i=Bm(vv(i)))),{start:e,end:i}}function JUt(t,e){return e.start&&t<e.start||e.end&&t>e.end}function QUt(t){let e=[];return ENe(t,0,e),e}function ENe(t,e,i){let n=[];for(let r of t){let a=eDt(r);n.push(a),i.push(a);let s={level:e,children:[],expanded:!0,hidden:!1};VUt(a,s),r.children&&(s.children=ENe(r.children,e+1,i))}return n}function eDt(t){return{id:String(t.id),title:t.title||"",eventBackgroundColor:t.eventBackgroundColor,eventTextColor:t.eventTextColor,extendedProps:t.extendedProps??{}}}function bae(t,e){return ug([t,e],([i,n])=>{let r=_d(n)?{format:n}:new Intl.DateTimeFormat(i,n);return{format:a=>r.format(Bc(a))}})}function Iae(t,e){return ug([t,e],([i,n])=>{let r;if(_d(n))r=n;else{let a=new Intl.DateTimeFormat(i,n);r=(s,o)=>{if(s<=o)return a.formatRange(s,o);{let l=a.formatRangeToParts(o,s),u="",c=["startRange","endRange"],d=[!1,!1];for(let p of l){let h=c.indexOf(p.source);h>=0?d[h]||(u+=tDt(c[1-h],l),d[h]=!0):u+=p.value}return u}}}return{formatRange:(a,s)=>r(Bc(a),Bc(s))}})}function tDt(t,e){let i="";for(let n of e)n.source==t&&(i+=n.value);return i}const PNe=["buttonText","customButtons","theme"];function iDt(t){let e={buttonText:{today:"today"},customButtons:{},date:new Date,datesSet:void 0,dayHeaderFormat:{weekday:"short",month:"numeric",day:"numeric"},dayHeaderAriaLabelFormat:{dateStyle:"full"},displayEventEnd:!0,duration:{weeks:1},events:[],eventAllUpdated:void 0,eventBackgroundColor:void 0,eventClassNames:void 0,eventClick:void 0,eventColor:void 0,eventContent:void 0,eventDidMount:void 0,eventFilter:void 0,eventMouseEnter:void 0,eventMouseLeave:void 0,eventOrder:void 0,eventSources:[],eventTextColor:void 0,eventTimeFormat:{hour:"numeric",minute:"2-digit"},filterEventsWithResources:!1,firstDay:0,headerToolbar:{start:"title",center:"",end:"today prev,next"},height:void 0,hiddenDays:[],highlightedDates:[],lazyFetching:!0,loading:void 0,locale:void 0,resources:[],selectable:!1,theme:{allDay:"ec-all-day",active:"ec-active",bgEvent:"ec-bg-event",bgEvents:"ec-bg-events",body:"ec-body",button:"ec-button",buttonGroup:"ec-button-group",calendar:"ec",colHead:"ec-col-head",day:"ec-day",dayHead:"ec-day-head",disabled:"ec-disabled",event:"ec-event",eventBody:"ec-event-body",eventTime:"ec-event-time",eventTitle:"ec-event-title",events:"ec-events",grid:"ec-grid",header:"ec-header",hidden:"ec-hidden",highlight:"ec-highlight",icon:"ec-icon",main:"ec-main",noBeb:"ec-no-beb",noIeb:"ec-no-ieb",today:"ec-today",title:"ec-title",toolbar:"ec-toolbar",view:"",weekdays:["ec-sun","ec-mon","ec-tue","ec-wed","ec-thu","ec-fri","ec-sat"]},titleFormat:{year:"numeric",month:"short",day:"numeric"},validRange:void 0,view:void 0,viewDidMount:void 0,views:{}};for(let i of t)i.createOptions?.(e);return e}function nDt(t){let e={date:i=>Bm(vv(i)),duration:_Ut,events:MO,eventSources:WUt,hiddenDays:i=>[...new Set(i)],highlightedDates:i=>i.map(n=>Bm(vv(n))),resources:QUt,validRange:XUt};for(let i of t)i.createParsers?.(e);return e}function rDt(t,e){let i=[];for(let n of Lg(t))t[n]!==e[n]&&i.push([n,t[n]]);return i}function aDt(t){return ug(t.view,e=>e?.startsWith("dayGrid"))}function sDt(t){return ug([t._currentRange,t._activeRangeExt],([e,i])=>i({start:_p(e.start),end:_p(e.end)}))}function oDt(t){return ug([t.date,t.duration,t.firstDay],([e,i,n])=>{let r=_p(e),a;return i.months?r.setUTCDate(1):i.inWeeks&&xUt(r,n),a=zZ(_p(r),i),{start:r,end:a}})}function lDt(t){return ug([t._activeRange,t.hiddenDays],([e,i])=>{let n=[],r=Bm(_p(e.start)),a=Bm(_p(e.end));for(;r<a;)i.includes(r.getUTCDay())||n.push(_p(r)),PO(r);return!n.length&&i.length&&i.length<7&&(t.date.update(s=>{for(;i.includes(s.getUTCDay());)PO(s);return s}),n=L1(t._viewDates)),n})}function uDt(t){return ug([t.date,t._activeRange,t._intlTitle,t._dayGrid],([e,i,n,r])=>r?n.formatRange(e,e):n.formatRange(i.start,qZ(_p(i.end))))}function cDt(t){return ug([t.view,t._viewTitle,t._currentRange,t._activeRange],e=>HUt(...e))}function dDt(t){let e=Uc([]),i,n=0,r={};return ug([t.events,t.eventSources,t._activeRange,t._fetchedRange,t.lazyFetching,t.loading],(a,s)=>DNe(()=>{let[o,l,u,c,d,p]=a;if(!l.length){s(o);return}if(!c.start||c.start>u.start||c.end<u.end||!d){i&&i.abort(),i=new AbortController,_d(p)&&!n&&p(!0);let h=()=>{--n===0&&_d(p)&&p(!1)},f=[],m=b=>h(),g=b=>{f=f.concat(MO(b)),s(f),h()},v=CO(u.start),y=CO(u.end);for(let b of l){if(_d(b.events)){let I=b.events({start:Bc(u.start),end:Bc(u.end),startStr:v,endStr:y},g,m);I!==void 0&&Promise.resolve(I).then(g,m)}else{let I=_d(b.extraParams)?b.extraParams():q2({},b.extraParams);I.start=v,I.end=y,I=new URLSearchParams(I);let S=b.url,w={},T;["GET","HEAD"].includes(b.method)?S+=(S.includes("?")?"&":"?")+I:(w["content-type"]="application/x-www-form-urlencoded;charset=UTF-8",T=String(I)),fetch(S,{method:b.method,headers:w,body:T,signal:i.signal,credentials:"same-origin"}).then(U=>U.json()).then(g).catch(m)}++n}c.start=u.start,c.end=u.end}},r,t._queue),[]).subscribe(e.set),e}function pDt(t){let e;t._view.subscribe(n=>e=n);let i={};return ug([t._events,t.eventFilter,t.eventOrder,t.filterEventsWithResources,t.resources],(n,r)=>DNe(()=>{let[a,s,o,l,u]=n,c=[...a];if(_d(s)){let d=a.map(Uy);c=c.filter((p,h)=>s({event:Uy(p),index:h,events:d,view:e}))}l&&(c=c.filter(d=>u.some(p=>d.resourceIds.includes(p.id)))),_d(o)?c.sort((d,p)=>o(Uy(d),Uy(p))):c.sort((d,p)=>d.start-p.start||p.allDay-d.allDay),r(c)},i,t._queue),[])}function hDt(){return wNe(vv(),t=>{let e=setInterval(()=>{t(vv())},1e3);return()=>clearInterval(e)})}function fDt(t){let e=Bm(vv()),i=Uc(e);return t._now.subscribe(n=>{let r=Bm(_p(n));wq(e,r)||(e=r,i.set(r))}),i}class mDt{constructor(e,i){e=e||[];let n=iDt(e),r=nDt(e);n=Sq(n,r),i=Sq(i,r);for(let[s,o]of Object.entries(n))this[s]=Uc(o);this._queue=Uc(new Map),this._tasks=new Map,this._auxiliary=Uc([]),this._dayGrid=aDt(this),this._currentRange=oDt(this),this._activeRangeExt=Uc(yae),this._activeRange=sDt(this),this._fetchedRange=Uc({start:void 0,end:void 0}),this._events=dDt(this),this._mainEl=Uc(void 0),this._now=hDt(),this._today=fDt(this),this._intlEventTime=Iae(this.locale,this.eventTimeFormat),this._intlDayHeader=bae(this.locale,this.dayHeaderFormat),this._intlDayHeaderAL=bae(this.locale,this.dayHeaderAriaLabelFormat),this._intlTitle=Iae(this.locale,this.titleFormat),this._viewTitle=uDt(this),this._viewDates=lDt(this),this._view=cDt(this),this._viewComponent=Uc(void 0),this._filteredEvents=pDt(this),this._interaction=Uc({}),this._iEvents=Uc([null,null]),this._iClasses=Uc(yae),this._iClass=Uc(void 0),this._set=(s,o)=>{Tq(s,this)&&(r[s]&&(o=r[s](o)),this[s].set(o))},this._get=s=>Tq(s,this)?L1(this[s]):void 0;for(let s of e)s.createStores?.(this);i.view&&this.view.set(i.view);let a=new Set([...Lg(n.views),...Lg(i.views??{})]);for(let s of a){let o=wae(n,n.views[s]??{}),l=wae(o,i,i.views?.[s]??{}),u=l.component;gDt(l,this);for(let c of Lg(l)){let{set:d,_set:p=d,...h}=this[c];this[c]={set:PNe.includes(c)?f=>{if(_d(f)){let m=f(o[c]);l[c]=m,d(d===p?m:f)}else l[c]=f,d(f)}:f=>{l[c]=f,d(f)},_set:p,...h}}this.view.subscribe(c=>{if(c===s){this._viewComponent.set(u),_d(l.viewDidMount)&&fNe().then(()=>l.viewDidMount({view:RO(L1(this._view))}));for(let d of Lg(l))this[d]._set(l[d])}})}}}function Sq(t,e){let i={...t};for(let n of Lg(e))n in i&&(i[n]=e[n](i[n]));if(t.views){i.views={};for(let n of Lg(t.views))i.views[n]=Sq(t.views[n],e)}return i}function wae(...t){let e={};for(let i of t){let n={};for(let r of PNe)_d(i[r])&&(n[r]=i[r](e[r]));e={...e,...i,...n}}return e}function gDt(t,e){Lg(t).filter(i=>!Tq(i,e)||i==="view").forEach(i=>delete t[i])}function Tq(t,e){return e.hasOwnProperty(t)&&t[0]!=="_"}var vDt=lg("<h2></h2>"),yDt=lg("<button><i></i></button>"),bDt=lg("<button><i></i></button>"),IDt=lg("<button> </button>"),wDt=lg("<button></button>"),SDt=lg("<button> </button>");function Sae(t,e){jN(e,!0);const i=()=>Fr(b,"$_viewDates",f),n=()=>Fr(E,"$validRange",f),r=()=>Fr(v,"$_today",f),a=()=>Fr(g,"$_currentRange",f),s=()=>Fr(w,"$date",f),o=()=>Fr(T,"$duration",f),l=()=>Fr(U,"$hiddenDays",f),u=()=>Fr(C,"$theme",f),c=()=>Fr(y,"$_viewTitle",f),d=()=>Fr(I,"$buttonText",f),p=()=>Fr(S,"$customButtons",f),h=()=>Fr(P,"$view",f),[f,m]=z2();let{_currentRange:g,_today:v,_viewTitle:y,_viewDates:b,buttonText:I,customButtons:S,date:w,duration:T,hiddenDays:U,theme:C,validRange:E,view:P}=BZ("state"),M=vh(!1),R=vh(!1),N=vh(!1),A=!1;nUt(()=>{i(),n(),e.buttons,cm(()=>{A||(A=!0,e.buttons.includes("prev")&&(Nc(M,!1),n().start&&Nc(M,_(x),!0)),e.buttons.includes("next")&&(Nc(R,!1),n().end&&Nc(R,_(O),!0)),e.buttons.includes("today")&&(Nc(N,r()>=a().start&&r()<a().end,!0),!Tn(N)&&(n().start||n().end)&&Nc(N,_($),!0)),fNe().then(()=>A=!1))})});function _(H){let G=_p(s());H();let W=i().every(q=>JUt(q,n()));return kg(w,G),W}function x(){kg(w,TNe(s(),o(),l()))}function O(){kg(w,SNe(s(),o()))}function $(){kg(w,_p(r()))}var F=Bf(),j=Ih(F);EO(j,17,()=>e.buttons,DO,(H,G)=>{var W=Bf(),q=Ih(W);{var Z=Q=>{var J=vDt();dae(J,()=>mae(c())),jf(()=>pp(J,1,u().title)),ao(Q,J)},K=Q=>{var J=Bf(),ne=Ih(J);{var re=de=>{var se=yDt();se.__click=x;var ge=uT(se);jf(()=>{pp(se,1,`${u().button??""} ec-${Tn(G)??""}`),uP(se,"aria-label",d().prev),uP(se,"title",d().prev),se.disabled=Tn(M),pp(ge,1,`${u().icon??""} ec-${Tn(G)??""}`)}),ao(de,se)},oe=de=>{var se=Bf(),ge=Ih(se);{var ye=De=>{var xe=bDt();xe.__click=O;var Me=uT(xe);jf(()=>{pp(xe,1,`${u().button??""} ec-${Tn(G)??""}`),uP(xe,"aria-label",d().next),uP(xe,"title",d().next),xe.disabled=Tn(R),pp(Me,1,`${u().icon??""} ec-${Tn(G)??""}`)}),ao(De,xe)},Te=De=>{var xe=Bf(),Me=Ih(xe);{var Oe=Fe=>{var mt=IDt();mt.__click=$;var Xe=uT(mt);jf(()=>{pp(mt,1,`${u().button??""} ec-${Tn(G)??""}`),mt.disabled=Tn(N),uae(Xe,d()[Tn(G)])}),ao(Fe,mt)},at=Fe=>{var mt=Bf(),Xe=Ih(mt);{var gt=_e=>{var Ye=wDt();Ye.__click=function(...Je){p()[Tn(G)].click?.apply(this,Je)},dae(Ye,()=>mae(p()[Tn(G)].text)),jf(()=>pp(Ye,1,bq([u().button,`ec-${Tn(G)}`,p()[Tn(G)].active&&u().active]))),ao(_e,Ye)},ht=_e=>{var Ye=Bf(),Je=Ih(Ye);{var ct=pt=>{var Se=SDt();Se.__click=()=>kg(P,Tn(G));var he=uT(Se);jf(()=>{pp(Se,1,bq([u().button,`ec-${Tn(G)}`,h()===Tn(G)&&u().active])),uae(he,d()[Tn(G)])}),ao(pt,Se)};SI(Je,pt=>{Tn(G)!==""&&pt(ct)},!0)}ao(_e,Ye)};SI(Xe,_e=>{p()[Tn(G)]?_e(gt):_e(ht,!1)},!0)}ao(Fe,mt)};SI(Me,Fe=>{Tn(G)==="today"?Fe(Oe):Fe(at,!1)},!0)}ao(De,xe)};SI(ge,De=>{Tn(G)==="next"?De(ye):De(Te,!1)},!0)}ao(de,se)};SI(ne,de=>{Tn(G)==="prev"?de(re):de(oe,!1)},!0)}ao(Q,J)};SI(q,Q=>{Tn(G)==="title"?Q(Z):Q(K,!1)})}ao(H,W)}),ao(t,F),GN(),m()}iI(["click"]);var TDt=lg("<div><!></div>"),UDt=lg("<div></div>"),DDt=lg("<nav></nav>");function EDt(t,e){jN(e,!0);const i=()=>Fr(s,"$headerToolbar",r),n=()=>Fr(o,"$theme",r),[r,a]=z2();let{headerToolbar:s,theme:o}=BZ("state"),l=jMe(()=>{let c={};for(let d of["start","center","end"])c[d]=i()[d]?.split(" ").map(p=>p.split(","))??[];return c});var u=DDt();EO(u,21,()=>Lg(Tn(l)),DO,(c,d)=>{var p=UDt();EO(p,21,()=>Tn(l)[Tn(d)],DO,(h,f)=>{var m=Bf(),g=Ih(m);{var v=b=>{var I=TDt(),S=uT(I);Sae(S,{get buttons(){return Tn(f)}}),jf(()=>pp(I,1,n().buttonGroup)),ao(b,I)},y=b=>{Sae(b,{get buttons(){return Tn(f)}})};SI(g,b=>{Tn(f).length>1?b(v):b(y,!1)})}ao(h,m)}),jf(()=>pp(p,1,`ec-${Tn(d)??""}`)),ao(c,p)}),jf(()=>pp(u,1,n().toolbar)),ao(t,u),GN(),a()}function PDt(t,e){jN(e,!0);const i=()=>Fr(f,"$_activeRange",u),n=()=>Fr(d,"$datesSet",u),r=()=>Fr(y,"$_view",u),a=()=>Fr(m,"$_filteredEvents",u),s=()=>Fr(p,"$eventAllUpdated",u),o=()=>Fr(v,"$_queue",u),l=()=>Fr(h,"$_auxiliary",u),[u,c]=z2();let{datesSet:d,eventAllUpdated:p,_auxiliary:h,_activeRange:f,_filteredEvents:m,_tasks:g,_queue:v,_view:y}=BZ("state");nk(()=>{i(),cm(()=>{_d(n())&&n()({start:Bc(i().start),end:Bc(i().end),startStr:CO(i().start),endStr:CO(i().end),view:RO(r())})})}),nk(()=>{a(),cm(()=>{_d(s())&&ZUt(()=>s()({view:RO(r())}),"eau",g)})}),nk(()=>{o(),cm(()=>{KUt(o())})});var b=Bf(),I=Ih(b);EO(I,1,l,DO,(S,w)=>{var T=Bf(),U=Ih(T);bNe(U,()=>Tn(w),(C,E)=>{E(C,{})}),ao(S,T)}),ao(t,b),GN(),c()}var CDt=lg("<div><!> <!></div> <!>",1);function RDt(t,e){jN(e,!0);const i=()=>Fr(I,"$_events",p),n=()=>Fr(y,"$_interaction",p),r=()=>Fr(S,"$date",p),a=()=>Fr(w,"$duration",p),s=()=>Fr(T,"$hiddenDays",p),o=()=>Fr(v,"$_viewComponent",p),l=()=>Fr(C,"$theme",p),u=()=>Fr(b,"$_iClass",p),c=()=>Fr(U,"$height",p),d=()=>Fr(E,"$view",p),[p,h]=z2();let f=fae(e,"plugins",19,()=>[]),m=fae(e,"options",19,()=>({})),g=new mDt(f(),m());BTt("state",g);let{_viewComponent:v,_interaction:y,_iClass:b,_events:I,date:S,duration:w,hiddenDays:T,height:U,theme:C,view:E}=g,P={...m()};nk(()=>{for(let[se,ge]of rDt(m(),P))cm(()=>{M(se,ge)});q2(P,m())});function M(se,ge){return g._set(se,ge),this}function R(se){let ge=g._get(se);return ge instanceof Date?Bc(ge):ge}function N(){return g._fetchedRange.set({start:void 0,end:void 0}),this}function A(){return i().map(Uy)}function _(se){for(let ge of i())if(ge.id==se)return Uy(ge);return null}function x(se){return se=MO([se])[0],i().push(se),kg(I,i()),Uy(se)}function O(se){let ge=String(se.id),ye=i().findIndex(Te=>Te.id===ge);return ye>=0?(se=MO([se])[0],NUt(I,cm(i)[ye]=se,cm(i)),Uy(se)):null}function $(se){se=String(se);let ge=i().findIndex(ye=>ye.id===se);return ge>=0&&(i().splice(ge,1),kg(I,i())),this}function F(){return RO(L1(g._view))}function j(){return n().action?.unselect(),this}function H(se,ge){let ye=UNe(se,ge);if(ye){let Te=GUt(ye)(se,ge);return Te.date=Bc(Te.date),Te}return null}function G(){return kg(S,SNe(r(),a())),this}function W(){return kg(S,TNe(r(),a(),s())),this}let q=jMe(o);var Z={setOption:M,getOption:R,refetchEvents:N,getEvents:A,getEventById:_,addEvent:x,updateEvent:O,removeEventById:$,getView:F,unselect:j,dateFromPoint:H,next:G,prev:W},K=CDt(),Q=Ih(K);let J;var ne=uT(Q);EDt(ne,{});var re=aae(ne,2);bNe(re,()=>Tn(q),(se,ge)=>{ge(se,{})});var oe=aae(Q,2);PDt(oe,{}),jf(se=>{pp(Q,1,bq([l().calendar,l().view,u()&&l()[u()]])),uP(Q,"role",se),J=EUt(Q,"",J,{height:c()})},[()=>zUt(d())?"list":"table"]),ao(t,K);var de=GN(Z);return h(),de}iI(["pointerdown"]);iI(["click","keydown","pointerdown"]);iI(["click","keydown","pointerdown"]);iI(["click","keydown"]);iI(["pointerdown"]);iI(["click"]);iI(["click"]);function MDt(t,e,i){return vUt(RDt,{target:t,props:{plugins:e,options:i}})}function NDt(t){return yMe([t.date,t.firstDay,t.hiddenDays],([e,i,n])=>{let r=[],a=No(e),s=7;for(;a.getUTCDay()!==i&&s;)xZ(a),--s;for(let o=0;o<7;++o)n.includes(a.getUTCDay())||r.push(No(a)),Vw(a);return r})}function Tae(t,e,i){const n=t.slice();return n[8]=e[i],n}function Uae(t){let e,i,n,r,a,s,o,l;return{c(){e=Pa("div"),i=Pa("span"),a=$u(),pi(i,"aria-label",n=t[2].format(t[8])),pi(e,"class",s=t[0].day+" "+t[0].weekdays?.[t[8].getUTCDay()]),pi(e,"role","columnheader")},m(u,c){Ps(u,e,c),ya(e,i),ya(e,a),o||(l=Bw(r=pE.call(null,i,t[3].format(t[8]))),o=!0)},p(u,c){t=u,c&6&&n!==(n=t[2].format(t[8]))&&pi(i,"aria-label",n),r&&Ks(r.update)&&c&10&&r.update.call(null,t[3].format(t[8])),c&3&&s!==(s=t[0].day+" "+t[0].weekdays?.[t[8].getUTCDay()])&&pi(e,"class",s)},d(u){u&&ls(e),o=!1,l()}}}function ADt(t){let e,i,n,r,a,s,o,l=Qp(t[1]),u=[];for(let c=0;c<l.length;c+=1)u[c]=Uae(Tae(t,l,c));return{c(){e=Pa("div"),i=Pa("div");for(let c=0;c<u.length;c+=1)u[c].c();r=$u(),a=Pa("div"),pi(i,"class",n=t[0].days),pi(i,"role","row"),pi(a,"class",s=t[0].hiddenScroll),pi(e,"class",o=t[0].header)},m(c,d){Ps(c,e,d),ya(e,i);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(i,null);ya(e,r),ya(e,a)},p(c,[d]){if(d&15){l=Qp(c[1]);let p;for(p=0;p<l.length;p+=1){const h=Tae(c,l,p);u[p]?u[p].p(h,d):(u[p]=Uae(h),u[p].c(),u[p].m(i,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=l.length}d&1&&n!==(n=c[0].days)&&pi(i,"class",n),d&1&&s!==(s=c[0].hiddenScroll)&&pi(a,"class",s),d&1&&o!==(o=c[0].header)&&pi(e,"class",o)},i:Fs,o:Fs,d(c){c&&ls(e),RZ(u,c)}}}function _Dt(t,e,i){let n,r,a,s,{theme:o,_intlDayHeader:l,_intlDayHeaderAL:u,_days:c}=og("state");return wt(t,o,d=>i(0,n=d)),wt(t,l,d=>i(3,s=d)),wt(t,u,d=>i(2,a=d)),wt(t,c,d=>i(1,r=d)),[n,r,a,s,o,l,u,c]}class kDt extends Ef{constructor(e){super(),Df(this,e,_Dt,ADt,uh,{})}}function xDt(t){let e,i,n,r,a,s,o,l,u,c,d,p,h;var f=t[8].resizer;function m(y,b){return{props:{start:!0,event:y[0]}}}f&&(i=XA(f,m(t)),i.$on("pointerdown",function(){Ks(t[32](t[8],["x","start"]))&&t[32](t[8],["x","start"]).apply(this,arguments)}));var g=t[8].resizer;function v(y,b){return{props:{event:y[0]}}}return g&&(l=XA(g,v(t)),l.$on("pointerdown",function(){Ks(t[32](t[8],["x","end"]))&&t[32](t[8],["x","end"]).apply(this,arguments)})),{c(){e=Pa("article"),i&&ru(i.$$.fragment),n=$u(),r=Pa("div"),o=$u(),l&&ru(l.$$.fragment),pi(r,"class",a=t[2].eventBody),pi(e,"class",t[4]),pi(e,"style",t[5]),pi(e,"role",u=t[7]?"button":void 0),pi(e,"tabindex",c=t[7]?0:void 0)},m(y,b){Ps(y,e,b),i&&Sl(i,e,null),ya(e,n),ya(e,r),ya(e,o),l&&Sl(l,e,null),t[51](e),d=!0,p||(h=[Bw(s=pE.call(null,r,t[6])),Va(e,"click",function(){Ks(t[7]||void 0)&&(t[7]||void 0).apply(this,arguments)}),Va(e,"keydown",function(){Ks(t[7]&&IO(t[7]))&&(t[7]&&IO(t[7])).apply(this,arguments)}),Va(e,"mouseenter",function(){Ks(t[31](t[9],t[1]))&&t[31](t[9],t[1]).apply(this,arguments)}),Va(e,"mouseleave",function(){Ks(t[31](t[10],t[1]))&&t[31](t[10],t[1]).apply(this,arguments)}),Va(e,"pointerdown",function(){Ks(!LU(t[1])&&t[32](t[8]))&&(!LU(t[1])&&t[32](t[8])).apply(this,arguments)})],p=!0)},p(y,b){if(t=y,b[0]&256&&f!==(f=t[8].resizer)){if(i){Lc();const I=i;Zn(I.$$.fragment,1,0,()=>{Tl(I,1)}),Fc()}f?(i=XA(f,m(t)),i.$on("pointerdown",function(){Ks(t[32](t[8],["x","start"]))&&t[32](t[8],["x","start"]).apply(this,arguments)}),ru(i.$$.fragment),on(i.$$.fragment,1),Sl(i,e,n)):i=null}else if(f){const I={};b[0]&1&&(I.event=t[0]),i.$set(I)}if((!d||b[0]&4&&a!==(a=t[2].eventBody))&&pi(r,"class",a),s&&Ks(s.update)&&b[0]&64&&s.update.call(null,t[6]),b[0]&256&&g!==(g=t[8].resizer)){if(l){Lc();const I=l;Zn(I.$$.fragment,1,0,()=>{Tl(I,1)}),Fc()}g?(l=XA(g,v(t)),l.$on("pointerdown",function(){Ks(t[32](t[8],["x","end"]))&&t[32](t[8],["x","end"]).apply(this,arguments)}),ru(l.$$.fragment),on(l.$$.fragment,1),Sl(l,e,null)):l=null}else if(g){const I={};b[0]&1&&(I.event=t[0]),l.$set(I)}(!d||b[0]&16)&&pi(e,"class",t[4]),(!d||b[0]&32)&&pi(e,"style",t[5]),(!d||b[0]&128&&u!==(u=t[7]?"button":void 0))&&pi(e,"role",u),(!d||b[0]&128&&c!==(c=t[7]?0:void 0))&&pi(e,"tabindex",c)},i(y){d||(i&&on(i.$$.fragment,y),l&&on(l.$$.fragment,y),d=!0)},o(y){i&&Zn(i.$$.fragment,y),l&&Zn(l.$$.fragment,y),d=!1},d(y){y&&ls(e),i&&Tl(i),l&&Tl(l),t[51](null),p=!1,Qd(h)}}}function ODt(t,e,i){let n,r,a,s,o,l,u,c,d,p,h,f,m,g,v,y,b,I,S,w,{chunk:T}=e,{longChunks:U={}}=e,{inPopup:C=!1}=e,{dates:E=[]}=e,{dayMaxEvents:P,displayEventEnd:M,eventAllUpdated:R,eventBackgroundColor:N,eventTextColor:A,eventClick:_,eventColor:x,eventContent:O,eventClassNames:$,eventDidMount:F,eventMouseEnter:j,eventMouseLeave:H,resources:G,theme:W,_view:q,_intlEventTime:Z,_interaction:K,_iClasses:Q,_hiddenEvents:J,_popupDate:ne,_tasks:re}=og("state");wt(t,P,_e=>i(54,a=_e)),wt(t,M,_e=>i(44,f=_e)),wt(t,R,_e=>i(56,u=_e)),wt(t,N,_e=>i(50,I=_e)),wt(t,A,_e=>i(47,v=_e)),wt(t,_,_e=>i(40,n=_e)),wt(t,x,_e=>i(49,b=_e)),wt(t,O,_e=>i(43,h=_e)),wt(t,$,_e=>i(45,m=_e)),wt(t,F,_e=>i(57,c=_e)),wt(t,j,_e=>i(9,S=_e)),wt(t,H,_e=>i(10,w=_e)),wt(t,G,_e=>i(48,y=_e)),wt(t,W,_e=>i(2,p=_e)),wt(t,q,_e=>i(41,l=_e)),wt(t,Z,_e=>i(42,d=_e)),wt(t,K,_e=>i(8,o=_e)),wt(t,Q,_e=>i(46,g=_e)),wt(t,J,_e=>i(53,r=_e)),wt(t,ne,_e=>i(55,s=_e));let oe,de,se,ge,ye,Te,De=1,xe=!1,Me,Oe;TSt(()=>{Mc(c)&&c({event:_g(de),timeText:Te,el:oe,view:Uh(l)})}),USt(()=>{Mc(u)&&!LU(Me)&&LSt(()=>u({view:Uh(l)}),"eau",re)});function at(_e,Ye){return!LU(Ye)&&Mc(_e)?Je=>_e({event:_g(de),el:oe,jsEvent:Je,view:Uh(l)}):void 0}function Fe(_e,Ye){return _e.action?Je=>o.action.drag(de,Je,Ye,C?s:null,[Oy(oe).top-Oy(OU(oe,1)).top,E],T.zeroDuration):void 0}function mt(){oe&&(i(38,De=HSt(T,U,JA(oe))),a===!0?Xe():i(39,xe=!1))}function Xe(){let _e=OU(oe,2),Ye=JA(_e)-JA(_e.firstElementChild)-gt(_e);i(39,xe=T.bottom>Ye);let Je=!1;for(let ct of T.dates){let pt=r[ct.getTime()];if(pt){let Se=pt.size;xe?pt.add(T.event):pt.delete(T.event),Se!==pt.size&&(Je=!0)}}Je&&J.set(r)}function gt(_e){let Ye=0;for(let Je=0;Je<T.days&&(Ye=EI(Ye,JA(_e.lastElementChild)),_e=_e.nextElementSibling,!!_e);++Je);return Ye}function ht(_e){Lm[_e?"unshift":"push"](()=>{oe=_e,i(3,oe)})}return t.$$set=_e=>{"chunk"in _e&&i(33,T=_e.chunk),"longChunks"in _e&&i(34,U=_e.longChunks),"inPopup"in _e&&i(35,C=_e.inPopup),"dates"in _e&&i(36,E=_e.dates)},t.$$.update=()=>{if(t.$$.dirty[1]&4&&i(0,de=T.event),t.$$.dirty[0]&39|t.$$.dirty[1]&1033604){i(1,Me=de.display);let _e=de.backgroundColor||JSt(de,y)||I||b,Ye=de.textColor||QSt(de,y)||v;if(_1(Me))i(5,ge=`width:calc(${T.days*100}% + ${T.days-1}px);`);else{let Je=De;if(de._margin){let[ct,pt]=de._margin;T.date>=pt[0]&&T.date<=pt.at(-1)&&(Je=ct)}i(5,ge=`width:calc(${T.days*100}% + ${(T.days-1)*7}px);margin-top:${Je}px;`)}_e&&i(5,ge+=`background-color:${_e};`),Ye&&i(5,ge+=`color:${Ye};`),xe&&i(5,ge+="visibility:hidden;"),i(5,ge+=de.styles.join(";")),i(4,se=[_1(Me)?p.bgEvent:p.event,...g([],de),...GSt(m,de,l)].join(" "))}t.$$.dirty[0]&4|t.$$.dirty[1]&15364&&i(6,[Te,ye]=jSt(T,f,h,p,d,l),ye),t.$$.dirty[0]&2|t.$$.dirty[1]&512&&i(7,Oe=at(n,Me))},[de,Me,p,oe,se,ge,ye,Oe,o,S,w,P,M,R,N,A,_,x,O,$,F,j,H,G,W,q,Z,K,Q,J,ne,at,Fe,T,U,C,E,mt,De,xe,n,l,d,h,f,m,g,v,y,b,I,ht]}let WN=class extends Ef{constructor(e){super(),Df(this,e,ODt,xDt,uh,{chunk:33,longChunks:34,inPopup:35,dates:36,reposition:37},null,[-1,-1])}get reposition(){return this.$$.ctx[37]}};function Dae(t,e,i){const n=t.slice();return n[20]=e[i],n}function Eae(t,e){let i,n,r;return n=new WN({props:{chunk:e[20],inPopup:!0}}),{key:t,first:null,c(){i=tI(),ru(n.$$.fragment),this.first=i},m(a,s){Ps(a,i,s),Sl(n,a,s),r=!0},p(a,s){e=a;const o={};s&1&&(o.chunk=e[20]),n.$set(o)},i(a){r||(on(n.$$.fragment,a),r=!0)},o(a){Zn(n.$$.fragment,a),r=!1},d(a){a&&ls(i),Tl(n,a)}}}function LDt(t){let e,i,n,r,a,s,o,l,u,c,d,p,h=[],f=new Map,m,g,v,y,b,I=Qp(t[0]);const S=w=>w[20].event;for(let w=0;w<I.length;w+=1){let T=Dae(t,I,w),U=S(T);f.set(U,h[w]=Eae(U,T))}return{c(){e=Pa("div"),i=Pa("div"),n=Pa("time"),s=$u(),o=Pa("a"),l=MZ(""),d=$u(),p=Pa("div");for(let w=0;w<h.length;w+=1)h[w].c();pi(n,"datetime",r=xy(t[3],10)),pi(o,"role","button"),pi(o,"tabindex","0"),pi(o,"aria-label",u=t[6].close),pi(i,"class",c=t[4].dayHead),pi(p,"class",m=t[4].events),pi(e,"class",g=t[4].popup),pi(e,"style",t[2])},m(w,T){Ps(w,e,T),ya(e,i),ya(i,n),ya(i,s),ya(i,o),ya(o,l),ya(e,d),ya(e,p);for(let U=0;U<h.length;U+=1)h[U]&&h[U].m(p,null);t[16](e),v=!0,y||(b=[Bw(a=pE.call(null,n,t[5].format(t[3]))),Va(o,"click",bO(t[13])),Va(o,"keydown",IO(t[13])),Bw(RSt.call(null,e,"pointerdown")),Va(e,"pointerdown",bO(t[15])),Va(e,"pointerdownoutside",t[14])],y=!0)},p(w,[T]){(!v||T&8&&r!==(r=xy(w[3],10)))&&pi(n,"datetime",r),a&&Ks(a.update)&&T&40&&a.update.call(null,w[5].format(w[3])),(!v||T&64&&u!==(u=w[6].close))&&pi(o,"aria-label",u),(!v||T&16&&c!==(c=w[4].dayHead))&&pi(i,"class",c),T&1&&(I=Qp(w[0]),Lc(),h=kZ(h,T,S,1,w,I,f,p,_Z,Eae,null,Dae),Fc()),(!v||T&16&&m!==(m=w[4].events))&&pi(p,"class",m),(!v||T&16&&g!==(g=w[4].popup))&&pi(e,"class",g),(!v||T&4)&&pi(e,"style",w[2])},i(w){if(!v){for(let T=0;T<I.length;T+=1)on(h[T]);v=!0}},o(w){for(let T=0;T<h.length;T+=1)Zn(h[T]);v=!1},d(w){w&&ls(e);for(let T=0;T<h.length;T+=1)h[T].d();t[16](null),y=!1,Qd(b)}}}function FDt(t,e,i){let n,r,a,s,o,l,{buttonText:u,theme:c,_interaction:d,_intlDayPopover:p,_popupDate:h,_popupChunks:f}=og("state");wt(t,u,T=>i(6,l=T)),wt(t,c,T=>i(4,s=T)),wt(t,d,T=>i(17,n=T)),wt(t,p,T=>i(5,o=T)),wt(t,h,T=>i(3,r=T)),wt(t,f,T=>i(0,a=T));let m,g="";function v(){let T=OU(m,1),U=OU(T,3),C=Oy(m),E=Oy(T),P=Oy(U);i(2,g="");let M;if(C.width>=P.width){M=P.left-E.left;let N=E.right-P.right;i(2,g+=`right:${N}px;`)}else M=(E.width-C.width)/2,E.left+M<P.left?M=P.left-E.left:E.left+M+C.width>P.right&&(M=P.right-E.left-C.width);i(2,g+=`left:${M}px;`);let R;if(C.height>=P.height){R=P.top-E.top;let N=E.bottom-P.bottom;i(2,g+=`bottom:${N}px;`)}else R=(E.height-C.height)/2,E.top+R<P.top?R=P.top-E.top:E.top+R+C.height>P.bottom&&(R=P.bottom-E.top-C.height);i(2,g+=`top:${R}px;`)}function y(){m&&(i(2,g=""),AZ().then(()=>{a.length?v():b()}))}function b(T){ks(h,r=null,r)}function I(T){b(),n.action?.noClick()}function S(T){L2.call(this,t,T)}function w(T){Lm[T?"unshift":"push"](()=>{m=T,i(1,m)})}return t.$$.update=()=>{t.$$.dirty&1&&a&&y()},[a,m,g,r,s,o,l,u,c,d,p,h,f,b,I,S,w]}class $Dt extends Ef{constructor(e){super(),Df(this,e,FDt,LDt,uh,{})}}function Pae(t,e,i){const n=t.slice();return n[54]=e[i],n[55]=e,n[56]=i,n}function Cae(t,e,i){const n=t.slice();return n[54]=e[i],n}function Rae(t){let e,i,n,r,a;return{c(){e=Pa("span"),pi(e,"class",i=t[17].weekNumber)},m(s,o){Ps(s,e,o),r||(a=Bw(n=pE.call(null,e,t[15])),r=!0)},p(s,o){o[0]&131072&&i!==(i=s[17].weekNumber)&&pi(e,"class",i),n&&Ks(n.update)&&o[0]&32768&&n.update.call(null,s[15])},d(s){s&&ls(e),r=!1,a()}}}function Mae(t){let e=[],i=new Map,n,r,a=Qp(t[10]);const s=o=>o[54].event;for(let o=0;o<a.length;o+=1){let l=Cae(t,a,o),u=s(l);i.set(u,e[o]=Nae(u,l))}return{c(){for(let o=0;o<e.length;o+=1)e[o].c();n=tI()},m(o,l){for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(o,l);Ps(o,n,l),r=!0},p(o,l){l[0]&1024&&(a=Qp(o[10]),Lc(),e=kZ(e,l,s,1,o,a,i,n.parentNode,_Z,Nae,n,Cae),Fc())},i(o){if(!r){for(let l=0;l<a.length;l+=1)on(e[l]);r=!0}},o(o){for(let l=0;l<e.length;l+=1)Zn(e[l]);r=!1},d(o){o&&ls(n);for(let l=0;l<e.length;l+=1)e[l].d(o)}}}function Nae(t,e){let i,n,r;return n=new WN({props:{chunk:e[54]}}),{key:t,first:null,c(){i=tI(),ru(n.$$.fragment),this.first=i},m(a,s){Ps(a,i,s),Sl(n,a,s),r=!0},p(a,s){e=a;const o={};s[0]&1024&&(o.chunk=e[54]),n.$set(o)},i(a){r||(on(n.$$.fragment,a),r=!0)},o(a){Zn(n.$$.fragment,a),r=!1},d(a){a&&ls(i),Tl(n,a)}}}function Aae(t){let e=t[2][2]&&Eh(t[2][2].date,t[0]),i,n=t[2][0]&&Eh(t[2][0].date,t[0]),r,a,s=e&&_ae(t),o=n&&kae(t);return{c(){s&&s.c(),i=$u(),o&&o.c(),r=tI()},m(l,u){s&&s.m(l,u),Ps(l,i,u),o&&o.m(l,u),Ps(l,r,u),a=!0},p(l,u){u[0]&5&&(e=l[2][2]&&Eh(l[2][2].date,l[0])),e?s?(s.p(l,u),u[0]&5&&on(s,1)):(s=_ae(l),s.c(),on(s,1),s.m(i.parentNode,i)):s&&(Lc(),Zn(s,1,1,()=>{s=null}),Fc()),u[0]&5&&(n=l[2][0]&&Eh(l[2][0].date,l[0])),n?o?(o.p(l,u),u[0]&5&&on(o,1)):(o=kae(l),o.c(),on(o,1),o.m(r.parentNode,r)):o&&(Lc(),Zn(o,1,1,()=>{o=null}),Fc())},i(l){a||(on(s),on(o),a=!0)},o(l){Zn(s),Zn(o),a=!1},d(l){l&&(ls(i),ls(r)),s&&s.d(l),o&&o.d(l)}}}function _ae(t){let e,i,n,r;return i=new WN({props:{chunk:t[2][2]}}),{c(){e=Pa("div"),ru(i.$$.fragment),pi(e,"class",n=t[17].events)},m(a,s){Ps(a,e,s),Sl(i,e,null),r=!0},p(a,s){const o={};s[0]&4&&(o.chunk=a[2][2]),i.$set(o),(!r||s[0]&131072&&n!==(n=a[17].events))&&pi(e,"class",n)},i(a){r||(on(i.$$.fragment,a),r=!0)},o(a){Zn(i.$$.fragment,a),r=!1},d(a){a&&ls(e),Tl(i)}}}function kae(t){let e,i,n,r;return i=new WN({props:{chunk:t[2][0]}}),{c(){e=Pa("div"),ru(i.$$.fragment),pi(e,"class",n=t[17].events+" "+t[17].preview)},m(a,s){Ps(a,e,s),Sl(i,e,null),r=!0},p(a,s){const o={};s[0]&4&&(o.chunk=a[2][0]),i.$set(o),(!r||s[0]&131072&&n!==(n=a[17].events+" "+a[17].preview))&&pi(e,"class",n)},i(a){r||(on(i.$$.fragment,a),r=!0)},o(a){Zn(i.$$.fragment,a),r=!1},d(a){a&&ls(e),Tl(i)}}}function xae(t){let e=[],i=new Map,n,r,a=Qp(t[5]);const s=o=>o[54].event;for(let o=0;o<a.length;o+=1){let l=Pae(t,a,o),u=s(l);i.set(u,e[o]=Oae(u,l))}return{c(){for(let o=0;o<e.length;o+=1)e[o].c();n=tI()},m(o,l){for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(o,l);Ps(o,n,l),r=!0},p(o,l){l[0]&65578&&(a=Qp(o[5]),Lc(),e=kZ(e,l,s,1,o,a,i,n.parentNode,_Z,Oae,n,Pae),Fc())},i(o){if(!r){for(let l=0;l<a.length;l+=1)on(e[l]);r=!0}},o(o){for(let l=0;l<e.length;l+=1)Zn(e[l]);r=!1},d(o){o&&ls(n);for(let l=0;l<e.length;l+=1)e[l].d(o)}}}function Oae(t,e){let i,n,r=e[56],a;const s=()=>e[49](n,r),o=()=>e[49](null,r);let l={chunk:e[54],longChunks:e[1],dates:e[3]};return n=new WN({props:l}),s(),{key:t,first:null,c(){i=tI(),ru(n.$$.fragment),this.first=i},m(u,c){Ps(u,i,c),Sl(n,u,c),a=!0},p(u,c){e=u,r!==e[56]&&(o(),r=e[56],s());const d={};c[0]&32&&(d.chunk=e[54]),c[0]&2&&(d.longChunks=e[1]),c[0]&8&&(d.dates=e[3]),n.$set(d)},i(u){a||(on(n.$$.fragment,u),a=!0)},o(u){Zn(n.$$.fragment,u),a=!1},d(u){u&&ls(i),o(),Tl(n,u)}}}function Lae(t){let e,i;return e=new $Dt({}),{c(){ru(e.$$.fragment)},m(n,r){Sl(e,n,r),i=!0},i(n){i||(on(e.$$.fragment,n),i=!0)},o(n){Zn(e.$$.fragment,n),i=!1},d(n){Tl(e,n)}}}function Fae(t){let e,i,n,r;return{c(){e=Pa("a"),pi(e,"role","button"),pi(e,"tabindex","0"),pi(e,"aria-haspopup","true")},m(a,s){Ps(a,e,s),n||(r=[Va(e,"click",bO(t[34])),Va(e,"keydown",IO(t[34])),Va(e,"pointerdown",bO(t[48])),Bw(i=pE.call(null,e,t[14]))],n=!0)},p(a,s){i&&Ks(i.update)&&s[0]&16384&&i.update.call(null,a[14])},d(a){a&&ls(e),n=!1,Qd(r)}}}function BDt(t){let e,i,n,r,a,s,o,l,u,c,d,p,h,f,m,g,v,y,b,I,S,w,T=t[9]&&Rae(t),U=!t[6]&&Mae(t),C=!t[6]&&Aae(t),E=!t[6]&&xae(t),P=t[8]&&Lae(),M=!t[6]&&t[7].size&&Fae(t);return{c(){e=Pa("div"),i=Pa("div"),n=Pa("time"),s=$u(),T&&T.c(),l=$u(),u=Pa("div"),U&&U.c(),d=$u(),C&&C.c(),p=$u(),h=Pa("div"),E&&E.c(),m=$u(),P&&P.c(),g=$u(),v=Pa("div"),M&&M.c(),pi(n,"datetime",r=xy(t[0],10)),pi(i,"class",o=t[17].dayHead),pi(u,"class",c=t[17].bgEvents),pi(h,"class",f=t[17].events),pi(v,"class",y=t[17].dayFoot),pi(e,"class",b=t[17].day+" "+t[17].weekdays?.[t[0].getUTCDay()]+(t[11]?" "+t[17].today:"")+(t[12]?" "+t[17].otherMonth:"")+(t[13]?" "+t[17].highlight:"")+(t[6]?" "+t[17].disabled:"")),pi(e,"role","cell")},m(R,N){Ps(R,e,N),ya(e,i),ya(i,n),ya(i,s),T&&T.m(i,null),ya(e,l),ya(e,u),U&&U.m(u,null),ya(e,d),C&&C.m(e,null),ya(e,p),ya(e,h),E&&E.m(h,null),ya(e,m),P&&P.m(e,null),ya(e,g),ya(e,v),M&&M.m(v,null),t[50](e),I=!0,S||(w=[Bw(a=pE.call(null,n,t[19].format(t[0]))),Va(e,"pointerdown",function(){Ks(t[18].action?.select)&&t[18].action?.select.apply(this,arguments)})],S=!0)},p(R,N){t=R,(!I||N[0]&1&&r!==(r=xy(t[0],10)))&&pi(n,"datetime",r),a&&Ks(a.update)&&N[0]&524289&&a.update.call(null,t[19].format(t[0])),t[9]?T?T.p(t,N):(T=Rae(t),T.c(),T.m(i,null)):T&&(T.d(1),T=null),(!I||N[0]&131072&&o!==(o=t[17].dayHead))&&pi(i,"class",o),t[6]?U&&(Lc(),Zn(U,1,1,()=>{U=null}),Fc()):U?(U.p(t,N),N[0]&64&&on(U,1)):(U=Mae(t),U.c(),on(U,1),U.m(u,null)),(!I||N[0]&131072&&c!==(c=t[17].bgEvents))&&pi(u,"class",c),t[6]?C&&(Lc(),Zn(C,1,1,()=>{C=null}),Fc()):C?(C.p(t,N),N[0]&64&&on(C,1)):(C=Aae(t),C.c(),on(C,1),C.m(e,p)),t[6]?E&&(Lc(),Zn(E,1,1,()=>{E=null}),Fc()):E?(E.p(t,N),N[0]&64&&on(E,1)):(E=xae(t),E.c(),on(E,1),E.m(h,null)),(!I||N[0]&131072&&f!==(f=t[17].events))&&pi(h,"class",f),t[8]?P?N[0]&256&&on(P,1):(P=Lae(),P.c(),on(P,1),P.m(e,g)):P&&(Lc(),Zn(P,1,1,()=>{P=null}),Fc()),!t[6]&&t[7].size?M?M.p(t,N):(M=Fae(t),M.c(),M.m(v,null)):M&&(M.d(1),M=null),(!I||N[0]&131072&&y!==(y=t[17].dayFoot))&&pi(v,"class",y),(!I||N[0]&145473&&b!==(b=t[17].day+" "+t[17].weekdays?.[t[0].getUTCDay()]+(t[11]?" "+t[17].today:"")+(t[12]?" "+t[17].otherMonth:"")+(t[13]?" "+t[17].highlight:"")+(t[6]?" "+t[17].disabled:"")))&&pi(e,"class",b)},i(R){I||(on(U),on(C),on(E),on(P),I=!0)},o(R){Zn(U),Zn(C),Zn(E),Zn(P),I=!1},d(R){R&&ls(e),T&&T.d(),U&&U.d(),C&&C.d(),E&&E.d(),P&&P.d(),M&&M.d(),t[50](null),S=!1,Qd(w)}}}function VDt(t,e,i){let n,r,a,s,o,l,u,c,d,p,h,f,m,g,{date:v}=e,{chunks:y}=e,{bgChunks:b}=e,{longChunks:I}=e,{iChunks:S=[]}=e,{dates:w}=e,{date:T,dayMaxEvents:U,highlightedDates:C,firstDay:E,moreLinkContent:P,theme:M,validRange:R,weekNumbers:N,weekNumberContent:A,_hiddenEvents:_,_intlDayCell:x,_popupDate:O,_popupChunks:$,_today:F,_interaction:j}=og("state");wt(t,T,Oe=>i(46,p=Oe)),wt(t,C,Oe=>i(45,d=Oe)),wt(t,E,Oe=>i(39,r=Oe)),wt(t,P,Oe=>i(42,l=Oe)),wt(t,M,Oe=>i(17,f=Oe)),wt(t,R,Oe=>i(44,c=Oe)),wt(t,N,Oe=>i(40,a=Oe)),wt(t,A,Oe=>i(38,n=Oe)),wt(t,_,Oe=>i(43,u=Oe)),wt(t,x,Oe=>i(19,g=Oe)),wt(t,O,Oe=>i(41,o=Oe)),wt(t,$,Oe=>i(51,s=Oe)),wt(t,F,Oe=>i(47,h=Oe)),wt(t,j,Oe=>i(18,m=Oe));let H,G,W,q,Z,K,Q,J=new Set,ne="",re,oe,de,se=[];function ge(){ks(O,o=v,o)}function ye(){let Oe=Vw(No(v)),at=G.concat(I[v.getTime()]?.chunks||[]);ks($,s=at.map(Fe=>A1({},Fe,dq(Fe.event,v,Oe),{days:1,dates:[v]})).sort((Fe,mt)=>Fe.top-mt.top),s)}function Te(){Q||SMe(se,G)}function De(Oe){L2.call(this,t,Oe)}function xe(Oe,at){Lm[Oe?"unshift":"push"](()=>{se[at]=Oe,i(16,se)})}function Me(Oe){Lm[Oe?"unshift":"push"](()=>{H=Oe,i(4,H)})}return t.$$set=Oe=>{"date"in Oe&&i(0,v=Oe.date),"chunks"in Oe&&i(35,y=Oe.chunks),"bgChunks"in Oe&&i(36,b=Oe.bgChunks),"longChunks"in Oe&&i(1,I=Oe.longChunks),"iChunks"in Oe&&i(2,S=Oe.iChunks),"dates"in Oe&&i(3,w=Oe.dates)},t.$$.update=()=>{if(t.$$.dirty[0]&1|t.$$.dirty[1]&8192&&i(6,Q=XSt(v,c)),t.$$.dirty[0]&225|t.$$.dirty[1]&48&&!Q){i(5,G=[]),i(10,W=b.filter(Oe=>Eh(Oe.date,v))),J.clear(),i(7,J),i(6,Q),i(36,b),i(0,v),i(35,y),i(5,G),i(44,c);for(let Oe of y)Eh(Oe.date,v)&&G.push(Oe)}if(t.$$.dirty[0]&129&&ks(_,u[v.getTime()]=J,u),t.$$.dirty[0]&1|t.$$.dirty[1]&65536&&i(11,q=Eh(v,h)),t.$$.dirty[0]&1|t.$$.dirty[1]&32768&&i(12,Z=v.getUTCMonth()!==p.getUTCMonth()),t.$$.dirty[0]&1|t.$$.dirty[1]&16384&&i(13,K=d.some(Oe=>Eh(Oe,v))),t.$$.dirty[0]&192|t.$$.dirty[1]&6144&&!Q&&u&&J.size){let Oe="+"+J.size+" more";l?i(14,ne=Mc(l)?l({num:J.size,text:Oe}):l):i(14,ne=Oe)}if(t.$$.dirty[0]&1|t.$$.dirty[1]&1024&&i(8,re=o&&Eh(v,o)),t.$$.dirty[0]&290&&re&&I&&G&&AZ().then(ye),t.$$.dirty[0]&81&&H&&FSt(H,()=>({allDay:!0,date:v,resource:void 0,dayEl:H,disabled:Q})),t.$$.dirty[0]&513|t.$$.dirty[1]&896&&(i(9,oe=a&&v.getUTCDay()==(r?1:0)),oe)){let Oe=NSt(v,r);n?i(15,de=Mc(n)?n({date:Ty(v),week:Oe}):n):i(15,de="W"+String(Oe).padStart(2,"0"))}},[v,I,S,w,H,G,Q,J,re,oe,W,q,Z,K,ne,de,se,f,m,g,T,C,E,P,M,R,N,A,_,x,O,$,F,j,ge,y,b,Te,n,r,a,o,l,u,c,d,p,h,De,xe,Me]}class jDt extends Ef{constructor(e){super(),Df(this,e,VDt,BDt,uh,{date:0,chunks:35,bgChunks:36,longChunks:1,iChunks:2,dates:3,reposition:37},null,[-1,-1])}get reposition(){return this.$$.ctx[37]}}function $ae(t,e,i){const n=t.slice();return n[28]=e[i],n[29]=e,n[30]=i,n}function Bae(t){let e,i=t[30],n;const r=()=>t[25](e,i),a=()=>t[25](null,i);let s={date:t[28],chunks:t[1],bgChunks:t[2],longChunks:t[3],iChunks:t[4],dates:t[0]};return e=new jDt({props:s}),r(),{c(){ru(e.$$.fragment)},m(o,l){Sl(e,o,l),n=!0},p(o,l){i!==o[30]&&(a(),i=o[30],r());const u={};l&1&&(u.date=o[28]),l&2&&(u.chunks=o[1]),l&4&&(u.bgChunks=o[2]),l&8&&(u.longChunks=o[3]),l&16&&(u.iChunks=o[4]),l&1&&(u.dates=o[0]),e.$set(u)},i(o){n||(on(e.$$.fragment,o),n=!0)},o(o){Zn(e.$$.fragment,o),n=!1},d(o){a(),Tl(e,o)}}}function GDt(t){let e,i,n,r,a,s=Qp(t[0]),o=[];for(let u=0;u<s.length;u+=1)o[u]=Bae($ae(t,s,u));const l=u=>Zn(o[u],1,1,()=>{o[u]=null});return{c(){e=Pa("div");for(let u=0;u<o.length;u+=1)o[u].c();pi(e,"class",i=t[6].days),pi(e,"role","row")},m(u,c){Ps(u,e,c);for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(e,null);n=!0,r||(a=Va(window,"resize",t[15]),r=!0)},p(u,[c]){if(c&63){s=Qp(u[0]);let d;for(d=0;d<s.length;d+=1){const p=$ae(u,s,d);o[d]?(o[d].p(p,c),on(o[d],1)):(o[d]=Bae(p),o[d].c(),on(o[d],1),o[d].m(e,null))}for(Lc(),d=s.length;d<o.length;d+=1)l(d);Fc()}(!n||c&64&&i!==(i=u[6].days))&&pi(e,"class",i)},i(u){if(!n){for(let c=0;c<s.length;c+=1)on(o[c]);n=!0}},o(u){o=o.filter(Boolean);for(let c=0;c<o.length;c+=1)Zn(o[c]);n=!1},d(u){u&&ls(e),RZ(o,u),r=!1,a()}}}function HDt(t,e,i){let n,r,a,s,o,l,u,c,{dates:d}=e,{_events:p,_iEvents:h,_queue2:f,_hiddenEvents:m,resources:g,filterEventsWithResources:v,hiddenDays:y,theme:b,validRange:I}=og("state");wt(t,p,A=>i(23,l=A)),wt(t,h,A=>i(20,a=A)),wt(t,m,A=>i(18,n=A)),wt(t,g,A=>i(21,s=A)),wt(t,v,A=>i(22,o=A)),wt(t,y,A=>i(19,r=A)),wt(t,b,A=>i(6,c=A)),wt(t,I,A=>i(24,u=A));let S,w,T,U=[],C,E,P=[],M={};function R(){OSt(()=>SMe(P,d),M,f)}function N(A,_){Lm[A?"unshift":"push"](()=>{P[_]=A,i(5,P)})}return t.$$set=A=>{"dates"in A&&i(0,d=A.dates)},t.$$.update=()=>{if(t.$$.dirty&16777217&&(i(16,C=zre(d[0],u)),i(17,E=Vw(No(zre(d.at(-1),u))))),t.$$.dirty&15400966){i(1,S=[]),i(2,w=[]);for(let A of l)if(Hre(A,C,E,o?s:void 0)){let _=dq(A,C,E);_1(A.display)?A.allDay&&w.push(_):S.push(_)}Zj(w,r),i(3,T=Zj(S,r)),R()}t.$$.dirty&1769472&&i(4,U=a.map(A=>{let _;return A&&Hre(A,C,E)?(_=dq(A,C,E),Zj([_],r)):_=null,_})),t.$$.dirty&262144&&n&&AZ().then(R)},[d,S,w,T,U,P,c,p,h,m,g,v,y,b,I,R,C,E,n,r,a,s,o,l,u,N]}class zDt extends Ef{constructor(e){super(),Df(this,e,HDt,GDt,uh,{dates:0})}}function Vae(t,e,i){const n=t.slice();return n[15]=e[i],n}function jae(t){let e,i;return e=new zDt({props:{dates:t[15]}}),{c(){ru(e.$$.fragment)},m(n,r){Sl(e,n,r),i=!0},p(n,r){const a={};r&1&&(a.dates=n[15]),e.$set(a)},i(n){i||(on(e.$$.fragment,n),i=!0)},o(n){Zn(e.$$.fragment,n),i=!1},d(n){Tl(e,n)}}}function qDt(t){let e,i,n,r,a,s=Qp(t[0]),o=[];for(let u=0;u<s.length;u+=1)o[u]=jae(Vae(t,s,u));const l=u=>Zn(o[u],1,1,()=>{o[u]=null});return{c(){e=Pa("div"),i=Pa("div");for(let u=0;u<o.length;u+=1)o[u].c();pi(i,"class",n=t[2].content),pi(e,"class",r=t[2].body+(t[1]===!0?" "+t[2].uniform:""))},m(u,c){Ps(u,e,c),ya(e,i);for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(i,null);t[13](e),a=!0},p(u,[c]){if(c&1){s=Qp(u[0]);let d;for(d=0;d<s.length;d+=1){const p=Vae(u,s,d);o[d]?(o[d].p(p,c),on(o[d],1)):(o[d]=jae(p),o[d].c(),on(o[d],1),o[d].m(i,null))}for(Lc(),d=s.length;d<o.length;d+=1)l(d);Fc()}(!a||c&4&&n!==(n=u[2].content))&&pi(i,"class",n),(!a||c&6&&r!==(r=u[2].body+(u[1]===!0?" "+u[2].uniform:"")))&&pi(e,"class",r)},i(u){if(!a){for(let c=0;c<s.length;c+=1)on(o[c]);a=!0}},o(u){o=o.filter(Boolean);for(let c=0;c<o.length;c+=1)Zn(o[c]);a=!1},d(u){u&&ls(e),RZ(o,u),t[13](null)}}}function WDt(t,e,i){let n,r,a,s,o,l,{_bodyEl:u,_viewDates:c,_hiddenEvents:d,dayMaxEvents:p,hiddenDays:h,theme:f}=og("state");wt(t,u,y=>i(3,l=y)),wt(t,c,y=>i(11,n=y)),wt(t,d,y=>i(14,a=y)),wt(t,p,y=>i(1,r=y)),wt(t,h,y=>i(12,s=y)),wt(t,f,y=>i(2,o=y));let m,g;function v(y){Lm[y?"unshift":"push"](()=>{l=y,u.set(l)})}return t.$$.update=()=>{if(t.$$.dirty&7171){i(0,m=[]),i(10,g=7-s.length),ks(d,a={},a);for(let y=0;y<n.length/g;++y){let b=[];for(let I=0;I<g;++I)b.push(n[y*g+I]);m.push(b)}}},[m,r,o,l,u,c,d,p,h,f,g,n,s,v]}class YDt extends Ef{constructor(e){super(),Df(this,e,WDt,qDt,uh,{})}}function KDt(t){let e,i,n,r;return e=new kDt({}),n=new YDt({}),{c(){ru(e.$$.fragment),i=$u(),ru(n.$$.fragment)},m(a,s){Sl(e,a,s),Ps(a,i,s),Sl(n,a,s),r=!0},p:Fs,i(a){r||(on(e.$$.fragment,a),on(n.$$.fragment,a),r=!0)},o(a){Zn(e.$$.fragment,a),Zn(n.$$.fragment,a),r=!1},d(a){a&&ls(i),Tl(e,a),Tl(n,a)}}}class ZDt extends Ef{constructor(e){super(),Df(this,e,null,KDt,uh,{})}}var XDt={createOptions(t){t.dayMaxEvents=!1,t.dayCellFormat={day:"numeric"},t.dayPopoverFormat={month:"long",day:"numeric",year:"numeric"},t.moreLinkContent=void 0,t.buttonText.dayGridMonth="month",t.buttonText.close="Close",t.theme.uniform="ec-uniform",t.theme.dayFoot="ec-day-foot",t.theme.popup="ec-popup",t.theme.weekNumber="ec-week-number",t.view="dayGridMonth",t.weekNumbers=!1,t.weekNumberContent=void 0,t.views.dayGridMonth={buttonText:YSt,component:ZDt,dayHeaderFormat:{weekday:"short"},dayHeaderAriaLabelFormat:{weekday:"long"},displayEventEnd:!1,duration:{months:1},theme:ZSt("ec-day-grid ec-month-view"),titleFormat:{year:"numeric",month:"long"}}},createStores(t){t._days=NDt(t),t._intlDayCell=qre(t.locale,t.dayCellFormat),t._intlDayPopover=qre(t.locale,t.dayPopoverFormat),t._hiddenEvents=qP({}),t._popupDate=qP(null),t._popupChunks=qP([])}};let rk;function JDt(){const e=tc()?.provider?.organisationId;if(e){const i=n=>{n?.calendar?iG(n.calendar):Hu.findAllTournaments().then(iG)};Hu.findProvider(e).then(i)}else Hu.findAllTournaments().then(iG)}function iG(t){const e=document.getElementById(zF);if(rk&&e&&Js(e),I0t(),!!e)return rk=MDt(e,{plugins:[XDt,fTt],options:{view:"dayGridMonth",height:"800px",headerToolbar:{start:"prev,next",center:"title",end:""},buttonText:i=>(i.resourceTimeGridWeek="resources",i),resources:[{id:1,title:"Resource A"},{id:2,title:"Resource B"}],scrollTime:"09:00:00",events:eEt(t),eventClick:QDt,eventMouseEnter:tEt,views:{},dayMaxEvents:!0,nowIndicator:!0,selectable:!0}}),{...iM,calendar:rk}}function QDt({event:t}){if(t.id){rk.destroy();const e=t.id;nt.reset();const i=`/${As}/${e}`;It.router.navigate(i)}}function eEt(t){const e=i=>i?.split("T")[0];return t.map(i=>({title:i.tournamentName,start:e(i.startDate),end:e(i.endDate),extendedProps:{tournamentId:i.tournamentId},resourceIds:[i.tournamentId],id:i.tournamentId,color:"#FE6B64"}))}function tEt({event:t,jsEvent:e}){hv(e.target,{content:t.title,showOnCreate:!0,arrow:!0})}var iEt=/([:*])(\w+)/g,nEt="([^/]+)",rEt=/\*/g,aEt="?(?:.*)",sEt=/\/\?/g,oEt="/?([^/]+|)",lEt="(?:/^|^)",uEt="";function CNe(t){return t===void 0&&(t="/"),KZ()?location.pathname+location.search+location.hash:t}function ps(t){return t.replace(/\/+$/,"").replace(/^\/+/,"")}function NO(t){return typeof t=="string"}function cEt(t){return typeof t=="function"}function AO(t){return t&&t.indexOf("#")>=0&&t.split("#").pop()||""}function dEt(t,e){return e.length===0||!t?null:t.slice(1,t.length).reduce(function(i,n,r){return i===null&&(i={}),i[e[r]]=decodeURIComponent(n),i},null)}function _O(t){var e=ps(t).split(/\?(.*)?$/);return[ps(e[0]),e.slice(1).join("")]}function YZ(t){for(var e={},i=t.split("&"),n=0;n<i.length;n++){var r=i[n].split("=");if(r[0]!==""){var a=decodeURIComponent(r[0]);e[a]?(Array.isArray(e[a])||(e[a]=[e[a]]),e[a].push(decodeURIComponent(r[1]||""))):e[a]=decodeURIComponent(r[1]||"")}}return e}function RNe(t,e){var i=_O(ps(t.currentLocationPath)),n=i[0],r=i[1],a=r===""?null:YZ(r),s=[],o;if(NO(e.path)){if(o=lEt+ps(e.path).replace(iEt,function(d,p,h){return s.push(h),nEt}).replace(rEt,aEt).replace(sEt,oEt)+"$",ps(e.path)===""&&ps(n)==="")return{url:n,queryString:r,hashString:AO(t.to),route:e,data:null,params:a}}else o=e.path;var l=new RegExp(o,uEt),u=n.match(l);if(u){var c=NO(e.path)?dEt(u,s):u.groups?u.groups:u.slice(1);return{url:ps(n.replace(new RegExp("^"+t.instance.root),"")),queryString:r,hashString:AO(t.to),route:e,data:c,params:a}}return!1}function MNe(){return!!(typeof window<"u"&&window.history&&window.history.pushState)}function uS(t,e){return typeof t[e]>"u"||t[e]===!0}function pEt(t){if(!t)return{};var e=t.split(","),i={},n;return e.forEach(function(r){var a=r.split(":").map(function(s){return s.replace(/(^ +| +$)/g,"")});switch(a[0]){case"historyAPIMethod":i.historyAPIMethod=a[1];break;case"resolveOptionsStrategy":n||(n={}),n.strategy=a[1];break;case"resolveOptionsHash":n||(n={}),n.hash=a[1]==="true";break;case"updateBrowserURL":case"callHandler":case"updateState":case"force":i[a[0]]=a[1]==="true";break}}),n&&(i.resolveOptions=n),i}function KZ(){return typeof window<"u"}function hEt(t,e){return t===void 0&&(t=[]),e===void 0&&(e={}),t.filter(function(i){return i}).forEach(function(i){["before","after","already","leave"].forEach(function(n){i[n]&&(e[n]||(e[n]=[]),e[n].push(i[n]))})}),e}function tm(t,e,i){var n=e||{},r=0;(function a(){if(!t[r]){i&&i(n);return}Array.isArray(t[r])?(t.splice.apply(t,[r,1].concat(t[r][0](n)?t[r][1]:t[r][2])),a()):t[r](n,function(s){typeof s>"u"||s===!0?(r+=1,a()):i&&i(n)})})()}tm.if=function(t,e,i){return Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]),[t,e,i]};function Gae(t,e){typeof t.currentLocationPath>"u"&&(t.currentLocationPath=t.to=CNe(t.instance.root)),t.currentLocationPath=t.instance._checkForAHash(t.currentLocationPath),e()}function nG(t,e){for(var i=0;i<t.instance.routes.length;i++){var n=t.instance.routes[i],r=RNe(t,n);if(r&&(t.matches||(t.matches=[]),t.matches.push(r),t.resolveOptions.strategy==="ONE")){e();return}}e()}function fEt(t,e){t.navigateOptions&&(typeof t.navigateOptions.shouldResolve<"u"&&console.warn('"shouldResolve" is deprecated. Please check the documentation.'),typeof t.navigateOptions.silent<"u"&&console.warn('"silent" is deprecated. Please check the documentation.')),e()}function mEt(t,e){t.navigateOptions.force===!0?(t.instance._setCurrent([t.instance._pathToMatchObject(t.to)]),e(!1)):e()}var Hae=KZ(),gEt=MNe();function vEt(t,e){if(uS(t.navigateOptions,"updateBrowserURL")){var i=("/"+t.to).replace(/\/\//g,"/"),n=Hae&&t.resolveOptions&&t.resolveOptions.hash===!0;gEt?(history[t.navigateOptions.historyAPIMethod||"pushState"](t.navigateOptions.stateObj||{},t.navigateOptions.title||"",n?"#"+i:i),location&&location.hash&&(t.instance.__freezeListening=!0,setTimeout(function(){if(!n){var r=location.hash;location.hash="",location.hash=r}t.instance.__freezeListening=!1},1))):Hae&&(window.location.href=t.to)}e()}function NNe(t,e){var i=t.instance;if(!i.lastResolved()){e();return}tm(i.lastResolved().map(function(n){return function(r,a){if(!n.route.hooks||!n.route.hooks.leave){a();return}var s=!1,o=t.instance.matchLocation(n.route.path,t.currentLocationPath,!1);if(n.route.path!=="*")s=!o;else{var l=t.matches?t.matches.find(function(u){return n.route.path===u.route.path}):!1;s=!l}if(uS(t.navigateOptions,"callHooks")&&s){tm(n.route.hooks.leave.map(function(u){return function(c,d){return u(function(p){p===!1?t.instance.__markAsClean(t):d()},t.matches&&t.matches.length>0?t.matches.length===1?t.matches[0]:t.matches:void 0)}}).concat([function(){return a()}]));return}else a()}}),{},function(){return e()})}function yEt(t,e){t.match.route.hooks&&t.match.route.hooks.before&&uS(t.navigateOptions,"callHooks")?tm(t.match.route.hooks.before.map(function(i){return function(r,a){return i(function(s){s===!1?t.instance.__markAsClean(t):a()},t.match)}}).concat([function(){return e()}])):e()}function bEt(t,e){uS(t.navigateOptions,"callHandler")&&t.match.route.handler(t.match),t.instance.updatePageLinks(),e()}function IEt(t,e){t.match.route.hooks&&t.match.route.hooks.after&&uS(t.navigateOptions,"callHooks")&&t.match.route.hooks.after.forEach(function(i){return i(t.match)}),e()}function wEt(t,e){var i=t.instance.lastResolved();if(i&&i[0]&&i[0].route===t.match.route&&i[0].url===t.match.url&&i[0].queryString===t.match.queryString){i.forEach(function(n){n.route.hooks&&n.route.hooks.already&&uS(t.navigateOptions,"callHooks")&&n.route.hooks.already.forEach(function(r){return r(t.match)})}),e(!1);return}e()}function SEt(t,e){var i=t.instance._notFoundRoute;if(i){t.notFoundHandled=!0;var n=_O(t.currentLocationPath),r=n[0],a=n[1],s=AO(t.to);i.path=ps(r);var o={url:i.path,queryString:a,hashString:s,data:null,route:i,params:a!==""?YZ(a):null};t.matches=[o],t.match=o}e()}function TEt(t,e){(!t.resolveOptions||t.resolveOptions.noMatchWarning===!1||typeof t.resolveOptions.noMatchWarning>"u")&&console.warn('Navigo: "'+t.currentLocationPath+`" didn't match any of the registered routes.`),e()}function UEt(t,e){t.instance._setCurrent(null),e()}function ANe(t,e){uS(t.navigateOptions,"updateState")&&t.instance._setCurrent(t.matches),e()}var _Ne=[wEt,yEt,bEt,IEt],zae=[NNe,SEt,tm.if(function(t){var e=t.notFoundHandled;return e},_Ne.concat([ANe]),[TEt,UEt])];function Uq(){return Uq=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},Uq.apply(this,arguments)}function qae(t,e){var i=0;function n(){if(i===t.matches.length){ANe(t,e);return}tm(_Ne,Uq({},t,{match:t.matches[i]}),function(){i+=1,n()})}NNe(t,n)}function rG(t){t.instance.__markAsClean(t)}function Dq(){return Dq=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},Dq.apply(this,arguments)}var Wae="[data-navigo]";function DEt(t,e){var i=e||{strategy:"ONE",hash:!1,noMatchWarning:!1,linksSelector:Wae},n=this,r="/",a=null,s=[],o=!1,l,u=MNe(),c=KZ();t?r=ps(t):console.warn('Navigo requires a root path in its constructor. If not provided will use "/" as default.');function d(F){return F.indexOf("#")>=0&&(i.hash===!0?F=F.split("#")[1]||"/":F=F.split("#")[0]),F}function p(F){return ps(r+"/"+ps(F))}function h(F,j,H,G){return F=NO(F)?p(F):F,{name:G||ps(String(F)),path:F,handler:j,hooks:hEt(H)}}function f(F,j,H){var G=this;return typeof F=="object"&&!(F instanceof RegExp)?(Object.keys(F).forEach(function(W){if(typeof F[W]=="function")G.on(W,F[W]);else{var q=F[W],Z=q.uses,K=q.as,Q=q.hooks;s.push(h(W,Z,[l,Q],K))}}),this):(typeof F=="function"&&(H=j,j=F,F=r),s.push(h(F,j,[l,H])),this)}function m(F,j){if(n.__dirty){n.__waiting.push(function(){return n.resolve(F,j)});return}else n.__dirty=!0;F=F?ps(r)+"/"+ps(F):void 0;var H={instance:n,to:F,currentLocationPath:F,navigateOptions:{},resolveOptions:Dq({},i,j)};return tm([Gae,nG,tm.if(function(G){var W=G.matches;return W&&W.length>0},qae,zae)],H,rG),H.matches?H.matches:!1}function g(F,j){if(n.__dirty){n.__waiting.push(function(){return n.navigate(F,j)});return}else n.__dirty=!0;F=ps(r)+"/"+ps(F);var H={instance:n,to:F,navigateOptions:j||{},resolveOptions:j&&j.resolveOptions?j.resolveOptions:i,currentLocationPath:d(F)};tm([fEt,mEt,nG,tm.if(function(G){var W=G.matches;return W&&W.length>0},qae,zae),vEt,rG],H,rG)}function v(F,j,H){var G=P(F,j);return G!==null?(g(G.replace(new RegExp("^/?"+r),""),H),!0):!1}function y(F){return this.routes=s=s.filter(function(j){return NO(F)?ps(j.path)!==ps(F):cEt(F)?F!==j.handler:String(j.path)!==String(F)}),this}function b(){u&&(this.__popstateListener=function(){n.__freezeListening||m()},window.addEventListener("popstate",this.__popstateListener))}function I(){this.routes=s=[],u&&window.removeEventListener("popstate",this.__popstateListener),this.destroyed=o=!0}function S(F,j){return n._notFoundRoute=h("*",F,[l,j],"__NOT_FOUND__"),this}function w(){if(c)return T().forEach(function(F){if(F.getAttribute("data-navigo")==="false"||F.getAttribute("target")==="_blank"){F.hasListenerAttached&&F.removeEventListener("click",F.navigoHandler);return}F.hasListenerAttached||(F.hasListenerAttached=!0,F.navigoHandler=function(j){if((j.ctrlKey||j.metaKey)&&j.target.tagName.toLowerCase()==="a")return!1;var H=F.getAttribute("href");if(typeof H>"u"||H===null)return!1;if(H.match(/^(http|https)/)&&typeof URL<"u")try{var G=new URL(H);H=G.pathname+G.search}catch{}var W=pEt(F.getAttribute("data-navigo-options"));o||(j.preventDefault(),j.stopPropagation(),n.navigate(ps(H),W))},F.addEventListener("click",F.navigoHandler))}),n}function T(){return c?[].slice.call(document.querySelectorAll(i.linksSelector||Wae)):[]}function U(F){return"/"+r+"/"+ps(F)}function C(F){return l=F,this}function E(){return a}function P(F,j,H){var G=s.find(function(Z){return Z.name===F}),W=null;if(G){if(W=G.path,j)for(var q in j)W=W.replace(":"+q,j[q]);W=W.match(/^\//)?W:"/"+W}return W&&H&&!H.includeRoot&&(W=W.replace(new RegExp("^/"+r),"")),W}function M(F){return F.getAttribute("href")}function R(F){var j=_O(ps(F)),H=j[0],G=j[1],W=G===""?null:YZ(G),q=AO(F),Z=h(H,function(){},[l],H);return{url:H,queryString:G,hashString:q,route:Z,data:null,params:W}}function N(){return R(ps(CNe(r)).replace(new RegExp("^"+r),""))}function A(F){var j={instance:n,currentLocationPath:F,to:F,resolveOptions:i};return nG(j,function(){}),j.matches?j.matches:!1}function _(F,j,H){typeof j<"u"&&(typeof H>"u"||H)&&(j=p(j));var G={instance:n,to:j,currentLocationPath:j};Gae(G,function(){}),typeof F=="string"&&(F=typeof H>"u"||H?p(F):F);var W=RNe(G,{name:String(F),path:F,handler:function(){},hooks:{}});return W||!1}function x(F,j,H){return typeof j=="string"&&(j=O(j)),j?(j.hooks[F]||(j.hooks[F]=[]),j.hooks[F].push(H),function(){j.hooks[F]=j.hooks[F].filter(function(G){return G!==H})}):(console.warn("Route doesn't exists: "+j),function(){})}function O(F){return typeof F=="string"?s.find(function(j){return j.name===p(F)}):s.find(function(j){return j.handler===F})}function $(F){F.instance.__dirty=!1,F.instance.__waiting.length>0&&F.instance.__waiting.shift()()}this.root=r,this.routes=s,this.destroyed=o,this.current=a,this.__freezeListening=!1,this.__waiting=[],this.__dirty=!1,this.__markAsClean=$,this.on=f,this.off=y,this.resolve=m,this.navigate=g,this.navigateByName=v,this.destroy=I,this.notFound=S,this.updatePageLinks=w,this.link=U,this.hooks=C,this.extractGETParameters=function(F){return _O(d(F))},this.lastResolved=E,this.generate=P,this.getLinkPath=M,this.match=A,this.matchLocation=_,this.getCurrentLocation=N,this.addBeforeHook=x.bind(this,"before"),this.addAfterHook=x.bind(this,"after"),this.addAlreadyHook=x.bind(this,"already"),this.addLeaveHook=x.bind(this,"leave"),this.getRoute=O,this._pathToMatchObject=R,this._clean=ps,this._checkForAHash=d,this._setCurrent=function(F){return a=n.current=F},b.call(this),w.call(this)}function EEt(){const e=new DEt("/",{hash:!0});It.router=e;const i=({selectedTab:n,renderDraw:r,data:a})=>{d2(),w0t({config:{selectedTab:n,renderDraw:r,...a}})};return e.on(`/${As}/:tournamentId`,n=>{i({data:n?.data})}),e.on(`/${As}/:tournamentId/overview`,n=>{i({data:n?.data,selectedTab:TD})}),e.on(`/${As}/:tournamentId/${bI}/:eventId`,n=>{i({selectedTab:wh,data:n?.data})}),e.on(`/${As}/:tournamentId/${bI}/:eventId/${HE}/:drawId`,n=>{i({selectedTab:wh,renderDraw:!0,data:n?.data})}),e.on(`/${As}/:tournamentId/${bI}/:eventId/${HE}/:drawId/${tH}/:roundsView`,n=>{i({selectedTab:wh,renderDraw:!0,data:n?.data})}),e.on(`/${As}/:tournamentId/${bI}/:eventId/${HE}/:drawId/${eH}/:structureId`,n=>{i({selectedTab:wh,renderDraw:!0,data:n?.data})}),e.on(`/${As}/:tournamentId/${bI}/:eventId/${HE}/:drawId/${eH}/:structureId/${tH}/:roundsView`,n=>{i({selectedTab:wh,renderDraw:!0,data:n?.data})}),e.on(`/${As}/:tournamentId/${bI}/:eventId/${ige}/:drawId`,n=>{i({selectedTab:wh,data:n?.data})}),e.on(`/${As}/:tournamentId/${Tm}/:participantView`,n=>{i({selectedTab:Tm,data:n?.data})}),e.on(`/${As}/:tournamentId/${ib}/:scheduledDate`,n=>{i({selectedTab:ib,data:n?.data})}),e.on(`/${As}/:tournamentId/:selectedTab`,n=>{i({data:n?.data})}),e.on(`/${tf}/:uuid`,$re),e.on(`/${tf}`,$re),e.on(`/${nge}/:inviteKey`,ySt),e.on("/calendar",JDt),e.on("/actionKey/:key",n=>{n?.data?.key,e.navigate("/"),Gj()}),e.on("/",()=>{Gj()}),e.notFound(()=>{e.navigate("/"),Gj()}),e.resolve(),{success:!0}}function PEt(){return new Promise((t,e)=>{AEt();const i=()=>{t()};REt().then(i,e)})}const CEt=t=>(...e)=>aMe()?t(...e):t(...e).catch(i=>console.log(i));function REt(){return new Promise((t,e)=>{new Promise((n,r)=>CEt(Hu.initDB)().then(()=>t(),MEt).then(n,r)).then(t,e)})}function MEt(){It.modal.inform({message:'<h2>Database Upgraded</h2><div style="margin: 1em;">Please Close Browser and Re-launch</div>'})}function NEt(t){const e=r=>Object.keys(r).map(a=>r[a]).join(""),i=e(t);zi.messages.reduce((r,a)=>e(a)===i?!0:r,!1)||zi.messages.push(t)}function AEt(){It.ee.addListener(Hnt,DPe),It.ee.addListener("addMessage",NEt)}const _Et=""+new URL("dragmatch-Va2U120p.png",import.meta.url).href;function aG(){FEt(),V0t(),xEt(),eGe(),Nre("login"),Nre("burger"),P0t("config"),Array.prototype.toSorted||(Array.prototype.toSorted=function(t){return this.slice().sort(t)}),It.drawer=vSt(),PEt().then(kEt,t=>console.log({err:t}))}function kEt(){console.log("%c TMX ready","color: lightgreen"),tMe(),$Et();const t=document.getElementById(RC);t&&(t.onclick=()=>It.router.navigate(`/${tf}`)),EEt(),Rdt()}function xEt(){It.dragMatch=new Image,It.dragMatch.src=_Et,It.ee=new B0t}const OEt="ResizeObserver loop limit exceeded",LEt="ResizeObserver loop completed with undelivered notifications.";function FEt(){zi.device=VEt();const t=nt.version();console.log(`%cversion: ${fK}`,"color: lightblue"),console.log(`%cfactory: ${t}`,"color: lightblue"),BEt()}function $Et(){const t=Uo.topicConstants;cT.setSubscriptions({subscriptions:{[t.MODIFY_MATCHUP]:e=>{const i=e.matchUp?.matchUpId;It.matchUpsToBroadcast.push(i),zi.devNotes&&console.log("MODIFY_MATCHUP",e)}}})}function BEt(){window.addEventListener("error",t=>{if([OEt,LEt].includes(t.message)){const e=document.getElementById("webpack-dev-server-client-overlay-div"),i=document.getElementById("webpack-dev-server-client-overlay");i&&i.setAttribute("style","display: none"),e&&e.setAttribute("style","display: none")}})}function VEt(){const t=jEt();return{isStandalone:t&&"standalone"in t&&t.standalone,isIDevice:t&&/iphone|ipod|ipad/i.test(t.userAgent),isIpad:t&&/iPad/i.test(t.userAgent),isWindows:t&&/indows/i.test(t.userAgent),isMobile:t&&/Mobi/.test(t.userAgent)}}function jEt(){try{return navigator||window.navigator}catch(t){console.log(t);return}}if(window.attachEvent)window.attachEvent("onload",aG);else if(window.onload){const t=window.onload,e=i=>{t(i),aG()};window.onload=e}else window.onload=aG;Xje();Qje();
//# sourceMappingURL=index-S8Wvk3TN.js.map
